<html>
<head>
<title>HTTP Header Injection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTP头注入</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/http-header-injection-4ba857fb9a16?source=collection_archive---------0-----------------------#2022-03-29">https://infosecwriteups.com/http-header-injection-4ba857fb9a16?source=collection_archive---------0-----------------------#2022-03-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/450ac7a2ca1f7ca21ce167ba9a3a2f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zBEp7WGG6xrjSl6l"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@jordanharrison?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">乔丹·哈里森</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b0ac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">什么是HTTP头注入？</strong></p><p id="7167" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">HTTP头注入是一个web安全漏洞，其中web应用程序从用户提供的输入中动态构造头。</p><p id="1687" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">HTTP工作在<em class="le">请求/响应模型</em>上。用户从web服务器请求资源，web服务器相应地响应。HTTP头用于请求必要的资源。标题可以分为两大类。请求和响应头。当用户提供的输入包含在HTTP响应中时，会出现此漏洞。这可能会导致许多问题，如绕过CSRF保护，重定向用户到不同的域或绕过CSRF保护有时。</p><p id="4ed8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">原因</strong></p><figure class="lg lh li lj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lf"><img src="../Images/5a0fd2bab3835994b38ea29458f17781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Owl010ZotdpcSn1L8vBwxA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://developpaper.com/http-host-header-attacks-for-web-security/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="40d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">HTTP头注入的主要原因之一是CRLF注入。当反向代理和web服务器以不同的方式插入HTTP请求时，就会发生CRLF注入。攻击者可以利用CRLF注入绕过限制，访问禁止的页面，甚至导致web缓存中毒。</p><p id="e88a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如:</p><p id="1bb9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们考虑一个容易受到头部注入攻击的网站。它接受URL并在它前面添加一个位置头。假设网址是<strong class="ki iu">www.vulnearblesite.com/page1.php</strong></p><p id="dd83" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">后端获取URL，删除域名并将其更改为<a class="ae kf" href="http://www.sub1.vulneable.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">www.sub1.vulnerable.com</strong></a>，然后将<strong class="ki iu">page1.php</strong>追加到其中。于是就变成了，<a class="ae kf" href="http://www.sub1.vulnerable.com/page1.php" rel="noopener ugc nofollow" target="_blank">www.sub1.vulnerable.com/page1.phpT21</a></p><p id="330b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，它会回应:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="93e6" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">Location: www.sub1.vulnerable.com/page1.php</strong></span><span id="2296" class="lp lq it ll b gy lv ls l lt lu">Note: The Location header is used by the browser to redirect to the mentioned site.</span></pre><p id="03a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">攻击者可以利用这一点将受害者发送到恶意站点。</p><p id="9801" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果URL是，</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="3fc7" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">www.vulnerablesite.com/page1.php</strong>%0d%0a %0d%0a<strong class="ll iu">Location:</strong>%20<strong class="ll iu">www.evilsite.com</strong></span></pre><p id="8adb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当由后端解析时，这将导致添加新的位置头，因为几乎没有新的行字符被添加到URL ( <em class="le"> %0d%0a </em>)，所以服务器将其解释为新的行，并且新的头被添加到具有值<strong class="ki iu">www.evilsite.com</strong>的请求中。这会将受害者引向攻击者拥有的恶意网站。它可用于网络钓鱼目的，添加标头以绕过不同类型的安全保护，如CSRF、添加cookies等。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="7556" class="lp lq it ll b gy lr ls l lt lu">From the server's browser's perspective this would look as:</span><span id="65c2" class="lp lq it ll b gy lv ls l lt lu"><strong class="ll iu">Location: www.sub1.vulnerable.com/page1.php<br/>Location: www.evilsite.com</strong></span></pre><p id="ca53" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">后果</strong></p><p id="2f6b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这可能会导致HTTP主机标头注入，这是HTTP标头注入的一种。其中攻击者注入主机标头，网站将用户重定向到定义的标头。</p><p id="2edc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有时，网站使用主机标头来生成密码重置令牌，即主机标头中的域直接用于密码重置的域，因此这可能会导致密码重置令牌受损。</p><p id="2744" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果应用程序提供缓存的网页、跨站点脚本和网络钓鱼攻击，这也会导致缓存中毒。</p><p id="8854" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">主机表头注入:</strong></p><p id="f31d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一台web服务器上可以托管多个子域。主机头指示web服务器使用哪个子域来检索资源。如果web服务器没有正确地手动加载它，它就可能成为各种攻击的目标。</p><p id="7f1f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，web服务器从用户请求中获取主机头，并使用它来获取<strong class="ki iu"> important.js </strong>文件。这个文件托管在服务器上，源代码中没有添加完整的URL，只有一个带有文件名的/</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="15ba" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">Server-Side Code</strong></span><span id="41a8" class="lp lq it ll b gy lv ls l lt lu">include(‘$_SERVER[‘host’]’.’/important.js’)</span></pre><p id="6610" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您向主机为【vulnsite.com T4】的web服务器发送请求时，由于后端编写的代码不安全，会发生以下情况。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="c5d8" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">Host: vulnsite.com</strong></span><span id="f3f1" class="lp lq it ll b gy lv ls l lt lu"><strong class="ll iu">include(“vulnsite.com/important.js”);</strong></span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lw"><img src="../Images/709de24325c3c3e5263c29080e1adb76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0E1tfiiTvku35JS9BfIDVg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://cpdos.org/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="3168" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果它容易受到主机标头注入的攻击，攻击者就可以利用它来包含易受攻击的脚本。如果攻击者在主机报头(<strong class="ki iu">主机:evil.com</strong>)中提供evil.com，将会发生以下情况。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="68d1" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">include(‘evil.com/important.js’);</strong></span></pre><p id="3f7c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为许多企业使用web缓存服务器，所以该响应会被web服务器缓存，然后也会提供给其他用户，这可能会导致网络钓鱼、使用XSS窃取cookie以及各种其他恶意活动。</p><p id="31ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">补救</strong></p><ul class=""><li id="89fc" class="lx ly it ki b kj kk kn ko kr lz kv ma kz mb ld mc md me mf bi translated">在用户输入或URL中应该允许换行符，并且应该在需要的地方使用白名单来防止换行符被使用。</li><li id="cc45" class="lx ly it ki b kj mg kn mh kr mi kv mj kz mk ld mc md me mf bi translated">检查您是否不支持任何可用于构建类似攻击的额外标头，如X-Forwarded-Host，因为这可能是一个危险信号。请记住，在您的环境中，默认情况下不一定支持这些功能。</li><li id="2f7c" class="lx ly it ki b kj mg kn mh kr mi kv mj kz mk ld mc md me mf bi translated">使用绝对URL时，应该在配置文件中手动设置当前域，使用相对URL时，应该使用该值的值而不是主机头。例如，使用这种操作方法可以消除密码重置中毒的威胁。</li></ul><p id="9989" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">实习实验室</strong></p><p id="9195" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在这些实验中练习</p><ul class=""><li id="3214" class="lx ly it ki b kj kk kn ko kr lz kv ma kz mb ld mc md me mf bi translated"><a class="ae kf" href="https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning/lab-host-header-basic-password-reset-poisoning" rel="noopener ugc nofollow" target="_blank">通过主机头的密码重置中毒</a></li><li id="66a9" class="lx ly it ki b kj mg kn mh kr mi kv mj kz mk ld mc md me mf bi translated"><a class="ae kf" href="https://portswigger.net/web-security/host-header/exploiting/lab-host-header-authentication-bypass" rel="noopener ugc nofollow" target="_blank">通过主机头绕过认证</a></li></ul><p id="f8f3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">结论</strong></p><p id="9308" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">网络变得更加复杂。如果没有应用最佳的编码和安全实践，很容易受到各种漏洞的攻击。因此，定期对您的网站进行渗透测试非常重要，这样您的网站就不会受到漏洞和攻击者的攻击。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="998b" class="lp lq it bd ms mt mu dn mv mw mx dp my kr mz na nb kv nc nd ne kz nf ng nh ni bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kf" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>