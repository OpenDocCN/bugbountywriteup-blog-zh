# Log4j 开发演练(CVE-2021–44228)—INE 实验室

> 原文：<https://infosecwriteups.com/log4j-exploitation-walkthrough-cve-2021-44228-ine-labs-f883a6afa6db?source=collection_archive---------2----------------------->

软件开发人员使用 Log4j 框架来记录用户活动和应用程序的行为，以供后续审查。下面是 log4j 的工作原理。

![](img/2560d576d46da162587b8625807cdbbf.png)

图片来自 GovCERT.ch

让我们试着利用 INE 实验室的 Log4j，如果你想尝试，点击这里的链接。

## **第一阶段——信息收集**

1.  将 demo.ine.local 作为有漏洞的服务器打开。

![](img/e86d6470bcd776a438ff608e01b728db.png)

2.尝试登录，我们看到 web 服务器可以访问命令。

![](img/0d4b7f890682d74e6e4c62a475089093.png)

3.用 nmap -sV <target>收集信息，寻找 web 服务器版本，我们得到了包含 log4j 的 Tomcat 8.5.3。</target>

![](img/1fab61f8d3c71a04b7fdef0d703e7f45.png)

## **第二阶段—概念验证**

1.  在端口 1234 上设置 netcat 监听器

![](img/46b81d89322db73b6312bdb89eabeed4.png)

2.使用 curl 和 log4j 有效负载向端口 1234 发出 http 请求

![](img/af8ef64a004798a32fad41bb6edefa73.png)

3.Netcat 用随机字符获得一些连接，因为有效负载需要 ldap 服务器。所以，这意味着我们可以利用 log4j 的方式:)

![](img/7262543559203569ec96928ba471a0da.png)

## **阶段 3 —利用 log4j**

1.  运行恶意的 LDAP 参考服务器和包含 java 漏洞类的恶意 http 服务器。

![](img/fa41e2f0f7524c10a9daa5714cae6c1d.png)

2.用 Exploit.java 创建反向壳

![](img/73da40fbbe6765e0234f8562d83839d7.png)

3.用源 java 版本 8 和目标 java 版本 8 编译 java 文件。

![](img/7dd945bcd57a4c3c8933096f0367b651.png)

4.在端口 8080 上创建简单的 python http 服务器

![](img/a5e43bfd7a29a9617f54d93a0eb635dc.png)

5.在端口 **1111 上设置 netcat 监听器。**

![](img/5c3a84aad60b73698ebfc597c94eb300.png)

6.使用 curl 和 ldap 服务器运行完整的 jndi 有效负载

![](img/b64863bdf38e86b9ade51a44e761456a.png)

7.LDAP 参考服务器接收连接并重定向到我们的 http 服务器。

![](img/9a0042bb22bf1f48efee9c1fc0520ca1.png)

8.Http 服务器接收连接

![](img/667296ce2da08cef5dab3d260ed80aa2.png)

9.Netcat 监听器也有连接。运行 python 稳定器，获得一个方便的 shell。

![](img/cc2e88a64174c5a36b8032542d7e8e20.png)![](img/54ab720241c806e0b5ad1b8b436e416b.png)

## 结论

Log4j 与 CVE-2021–44228 是 2021 年底的一个著名漏洞。如此多的应用程序受到影响，因为使用 java 版本 8 和 log4j 2，有人会利用此漏洞获得 RCE(远程代码执行)。
今天学到了什么？
不断学习的人..

谢谢