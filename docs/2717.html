<html>
<head>
<title>basic file exploit(100 points)— Binary Exploitation writeup | Pico CTF 2022</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基本文件漏洞利用(100分)—二进制漏洞利用报道|皮科CTF 2022</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/basic-file-exploit-100-points-binary-exploitation-writeup-pico-ctf-2022-66d21d266a72?source=collection_archive---------3-----------------------#2022-12-29">https://infosecwriteups.com/basic-file-exploit-100-points-binary-exploitation-writeup-pico-ctf-2022-66d21d266a72?source=collection_archive---------3-----------------------#2022-12-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b77c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">基本文件利用PicoCTF 2022的二进制利用挑战| Karthikeyan Nagaraj的方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://play.picoctf.org/practice/challenge/252?category=6&amp;page=1"><div class="gh gi kf"><img src="../Images/1731d77cac179f2268fee4815919fff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*t-ZtHt0zq1Blq9LjBxFUyA.png"/></div></a></figure><h2 id="5b0b" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">描述:</strong></h2><ul class=""><li id="e464" class="lj lk iq ll b lm ln lo lp kw lq la lr le ls lt lu lv lw lx bi translated">提供的程序允许你写一个文件，并从中读取你写的内容。</li><li id="77b2" class="lj lk iq ll b lm ly lo lz kw ma la mb le mc lt lu lv lw lx bi translated">试着玩玩它，看看你是否能打破它！</li><li id="e15e" class="lj lk iq ll b lm ly lo lz kw ma la mb le mc lt lu lv lw lx bi translated">用netcat连接程序:<br/> <code class="fe md me mf mg b">nc saturn.picoctf.net 55825</code></li></ul><h2 id="80c2" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">使用的工具— Netcat</h2><h2 id="67a1" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">任务文件:</strong></h2><p id="d65f" class="pw-post-body-paragraph mh mi iq ll b lm ln jr mj lo lp ju mk kw ml mm mn la mo mp mq le mr ms mt lt ij bi translated"><a class="ae mu" href="https://artifacts.picoctf.net/c/542/program-redacted.c" rel="noopener ugc nofollow" target="_blank">https://artifacts.picoctf.net/c/542/program-redacted.c</a></p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h2 id="b592" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">分析:</strong></h2><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="c4a1" class="ng ko iq mg b be nh ni l nj nk">#include &lt;stdio.h&gt;<br/>#include &lt;stdlib.h&gt;<br/>#include &lt;stdbool.h&gt;<br/>#include &lt;string.h&gt;<br/>#include &lt;stdint.h&gt;<br/>#include &lt;ctype.h&gt;<br/>#include &lt;unistd.h&gt;<br/>#include &lt;sys/time.h&gt;<br/>#include &lt;sys/types.h&gt;<br/><br/><br/>#define WAIT 60<br/><br/><br/>static const char* flag = "[REDACTED]";<br/><br/>static char data[10][100];<br/>static int input_lengths[10];<br/>static int inputs = 0;<br/><br/><br/><br/>int tgetinput(char *input, unsigned int l)<br/>{<br/>    fd_set          input_set;<br/>    struct timeval  timeout;<br/>    int             ready_for_reading = 0;<br/>    int             read_bytes = 0;<br/>    <br/>    if( l &lt;= 0 )<br/>    {<br/>      printf("'l' for tgetinput must be greater than 0\n");<br/>      return -2;<br/>    }<br/>    <br/>    <br/>    /* Empty the FD Set */<br/>    FD_ZERO(&amp;input_set );<br/>    /* Listen to the input descriptor */<br/>    FD_SET(STDIN_FILENO, &amp;input_set);<br/><br/>    /* Waiting for some seconds */<br/>    timeout.tv_sec = WAIT;    // WAIT seconds<br/>    timeout.tv_usec = 0;    // 0 milliseconds<br/><br/>    /* Listening for input stream for any activity */<br/>    ready_for_reading = select(1, &amp;input_set, NULL, NULL, &amp;timeout);<br/>    /* Here, first parameter is number of FDs in the set, <br/>     * second is our FD set for reading,<br/>     * third is the FD set in which any write activity needs to updated,<br/>     * which is not required in this case. <br/>     * Fourth is timeout<br/>     */<br/><br/>    if (ready_for_reading == -1) {<br/>        /* Some error has occured in input */<br/>        printf("Unable to read your input\n");<br/>        return -1;<br/>    } <br/><br/>    if (ready_for_reading) {<br/>        read_bytes = read(0, input, l-1);<br/>        if(input[read_bytes-1]=='\n'){<br/>        --read_bytes;<br/>        input[read_bytes]='\0';<br/>        }<br/>        if(read_bytes==0){<br/>            printf("No data given.\n");<br/>            return -4;<br/>        } else {<br/>            return 0;<br/>        }<br/>    } else {<br/>        printf("Timed out waiting for user input. Press Ctrl-C to disconnect\n");<br/>        return -3;<br/>    }<br/><br/>    return 0;<br/>}<br/><br/><br/>static void data_write() {<br/>  char input[100];<br/>  char len[4];<br/>  long length;<br/>  int r;<br/>  <br/>  printf("Please enter your data:\n");<br/>  r = tgetinput(input, 100);<br/>  // Timeout on user input<br/>  if(r == -3)<br/>  {<br/>    printf("Goodbye!\n");<br/>    exit(0);<br/>  }<br/>  <br/>  while (true) {<br/>    printf("Please enter the length of your data:\n");<br/>    r = tgetinput(len, 4);<br/>    // Timeout on user input<br/>    if(r == -3)<br/>    {<br/>      printf("Goodbye!\n");<br/>      exit(0);<br/>    }<br/>  <br/>    if ((length = strtol(len, NULL, 10)) == 0) {<br/>      puts("Please put in a valid length");<br/>    } else {<br/>      break;<br/>    }<br/>  }<br/><br/>  if (inputs &gt; 10) {<br/>    inputs = 0;<br/>  }<br/><br/>  strcpy(data[inputs], input);<br/>  input_lengths[inputs] = length;<br/><br/>  printf("Your entry number is: %d\n", inputs + 1);<br/>  inputs++;<br/>}<br/><br/><br/>static void data_read() {<br/>  char entry[4];<br/>  long entry_number;<br/>  char output[100];<br/>  int r;<br/><br/>  memset(output, '\0', 100);<br/>  <br/>  printf("Please enter the entry number of your data:\n");<br/>  r = tgetinput(entry, 4);<br/>  // Timeout on user input<br/>  if(r == -3)<br/>  {<br/>    printf("Goodbye!\n");<br/>    exit(0);<br/>  }<br/>  <br/>  if ((entry_number = strtol(entry, NULL, 10)) == 0) {<br/>    puts(flag);<br/>    fseek(stdin, 0, SEEK_END);<br/>    exit(0);<br/>  }<br/><br/>  entry_number--;<br/>  strncpy(output, data[entry_number], input_lengths[entry_number]);<br/>  puts(output);<br/>}<br/><br/><br/>int main(int argc, char** argv) {<br/>  char input[3] = {'\0'};<br/>  long command;<br/>  int r;<br/><br/>  puts("Hi, welcome to my echo chamber!");<br/>  puts("Type '1' to enter a phrase into our database");<br/>  puts("Type '2' to echo a phrase in our database");<br/>  puts("Type '3' to exit the program");<br/><br/>  while (true) {   <br/>    r = tgetinput(input, 3);<br/>    // Timeout on user input<br/>    if(r == -3)<br/>    {<br/>      printf("Goodbye!\n");<br/>      exit(0);<br/>    }<br/>    <br/>    if ((command = strtol(input, NULL, 10)) == 0) {<br/>      puts("Please put in a valid number");<br/>    } else if (command == 1) {<br/>      data_write();<br/>      puts("Write successful, would you like to do anything else?");<br/>    } else if (command == 2) {<br/>      if (inputs == 0) {<br/>        puts("No data yet");<br/>        continue;<br/>      }<br/>      data_read();<br/>      puts("Read successful, would you like to do anything else?");<br/>    } else if (command == 3) {<br/>      return 0;<br/>    } else {<br/>      puts("Please type either 1, 2 or 3");<br/>      puts("Maybe breaking boundaries elsewhere will be helpful");<br/>    }<br/>  }<br/><br/>  return 0;<br/>}</span></pre><h2 id="f15e" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">输出:</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/1cc33c2f61c3cb15dfa32bf06d7c7afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*oahe14X6uQVgKCnJrpAHTQ.png"/></div></figure><p id="52d6" class="pw-post-body-paragraph mh mi iq ll b lm nm jr mj lo nn ju mk kw no mm mn la np mp mq le nq ms mt lt ij bi translated">请注意<code class="fe md me mf mg b">program-redacted.c</code>中这个特殊的代码块</p><ul class=""><li id="3677" class="lj lk iq ll b lm nm lo nn kw nr la ns le nt lt lu lv lw lx bi translated">这里条件语句有一个<code class="fe md me mf mg b">puts()</code>函数，如果条件的结果是<code class="fe md me mf mg b">True</code>，它将显示<code class="fe md me mf mg b">flag</code>变量的值</li><li id="965d" class="lj lk iq ll b lm ly lo lz kw ma la mb le mc lt lu lv lw lx bi translated">如果操作数的结果为0，则条件为真。</li><li id="2a1b" class="lj lk iq ll b lm ly lo lz kw ma la mb le mc lt lu lv lw lx bi translated">因此，如果我们将值0放在入口点编号上，我们将得到标志</li></ul><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="6b70" class="ng ko iq mg b be nh ni l nj nk">printf(“Please enter the entry number of your data:\n”);<br/> r = tgetinput(entry, 4);<br/><br/> if(r == -3)<br/> {<br/>     printf(“Goodbye!\n”);<br/>     exit(0);<br/> }<br/> // Notice the below Condition<br/> if ((entry_number = strtol(entry, NULL, 10)) == 0)<br/> {<br/>     puts(flag); // This will Display the Flag if the Condition is True<br/>     fseek(stdin, 0, SEEK_END);<br/>     exit(0);<br/> }</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/c29b70f1bca3975021eb7a5a3921d69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*h4McXCH5yed1AJ1LH2_E8A.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/fba93973c25bc49c9e962d2a645be3ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*zcycp9OASEzhFBy6Nn8PeQ.png"/></div></figure><p id="81ed" class="pw-post-body-paragraph mh mi iq ll b lm nm jr mj lo nn ju mk kw no mm mn la np mp mq le nq ms mt lt ij bi translated"><code class="fe md me mf mg b">[REDACTED]</code>是该程序中标志变量的值。<br/>那么让我们连接到netcat服务器并利用它吧！！</p><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="5950" class="ng ko iq mg b be nh ni l nj nk">nc saturn.picoctf.net 55825</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/34524767b8f5b64476751c23ae5f729a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*maLWHYrHmOz9AlRb-giSCQ.png"/></div></figure><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="40b2" class="ng ko iq mg b be nh ni l nj nk">Ans: picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_68466E2F}</span></pre></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="313d" class="pw-post-body-paragraph mh mi iq ll b lm nm jr mj lo nn ju mk kw no mm mn la np mp mq le nq ms mt lt ij bi translated">请随时通过<a class="ae mu" href="https://www.linkedin.com/in/karthikeyan-nagaraj" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>:)提问</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nx ny di nz bf oa"><div class="gh gi nw"><img src="../Images/6684c4652ef1738b7029b166e22759d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*f7IQ7EdE7qwtJwZW.png"/></div></div></figure><p id="44bf" class="pw-post-body-paragraph mh mi iq ll b lm nm jr mj lo nn ju mk kw no mm mn la np mp mq le nq ms mt lt ij bi translated">感谢您的阅读！！</p><p id="db88" class="pw-post-body-paragraph mh mi iq ll b lm nm jr mj lo nn ju mk kw no mm mn la np mp mq le nq ms mt lt ij bi translated">快乐剥削~</p><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="3f80" class="ng ko iq mg b be nh ni l nj nk">Author: Karthikeyan Nagaraj</span></pre><p id="7354" class="pw-post-body-paragraph mh mi iq ll b lm nm jr mj lo nn ju mk kw no mm mn la np mp mq le nq ms mt lt ij bi translated">ctf，二进制，基本文件利用，基本文件利用，二进制利用，netcat，捕获标志，挑战，写文章，标志，karthikeyan nagaraj，cyberw1ng</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h2 id="c03d" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mu" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>