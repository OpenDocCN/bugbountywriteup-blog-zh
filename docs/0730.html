<html>
<head>
<title>Refocusing in bug hunting, Bonus: An interestingly simple to test CSRF bypass</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重新聚焦于bug搜索，奖励:一个有趣的简单测试CSRF旁路</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/refocusing-in-bug-hunting-bonus-an-interestingly-simple-to-test-csrf-bypass-8595b3312147?source=collection_archive---------1-----------------------#2020-08-01">https://infosecwriteups.com/refocusing-in-bug-hunting-bonus-an-interestingly-simple-to-test-csrf-bypass-8595b3312147?source=collection_archive---------1-----------------------#2020-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="29b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">使用html页面的源…</strong></p><p id="b82b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在寻找bug的过程中，你会不时地陷入困境。您访问范围内的网站，环顾四周，检查哪些burp代理历史记录，那里什么也没有。也就是说，没什么明显的。有时，你可能会止步于此。尤其是如果你像我不久前一样，刚刚踏上旅程。</p><p id="d83a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我去了这个网站，它有一些常见的功能，比如搜索表单、将产品添加到购物车、添加到你的愿望清单以及下订单。</p><p id="3487" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于一个“绿色”的bug猎人来说，最明显的攻击是将xss有效负载放入所有参数中，看看会发生什么。在这种情况下，什么都没有。没有什么有趣的，html标签被正确编码。它看起来像一个死胡同。</p><p id="1b79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，我把它搁置了几个月。当我回来时，我没有使用这个工具来提取网站正在使用的js文件的链接，而是决定通读主页的源代码。这不像真正的交易，只是html源代码。但是，事实证明，很多有趣的javascript代码就在所有html的中间。</p><p id="5f94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有趣的部分是javascript被用于POST和GET请求的部分，这些请求被非常有趣地命名为端点。了解基本的javascript就足以理解代码在做什么，以及如何使用这些端点测试IDOR。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/eb3d332eee0e22e127e18beb30f35403.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*HCXvujN_meohQ8cYJSFkvg.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">一个简单的示例代码</figcaption></figure><p id="6762" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在更改号码或用户名的同时向这些端点发出GET请求，向我显示了其他用户的数据，这些数据显然只能由这些用户访问。</p><p id="71cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">奖励:CSRF绕行</strong></p><p id="a2b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有许多方法可以绕过csrf保护:删除csrf头/参数，用相同长度的不同值替换csrf令牌的值，以及尝试从POST请求切换到GET请求(这种方法严重依赖于受csrf保护的网站功能)</p><p id="c7c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还没有听说过，如果你听说过，我发现它值得重复:改变内容类型。即从非表单内容类型(即应用程序/json、应用程序/x-url编码等)切换。)到内容类型:形式-多部分</p><p id="d700" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是一个截屏示例，根据我的一份报告进行了必要程度的简化，令我惊讶的是，由于它的简单性，它没有被标记为重复，并且我获得了一笔可观的奖金:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi la"><img src="../Images/f610f49e8a269fed4aa7c335c748ef3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYLxDsdVy3d2D7UR4ks2vA.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">请求和响应示例</figcaption></figure><p id="d6ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，csrftoken的content-type:application/x-www-form-urlencoded和错误值给出了403，而content-type:multipart/form-data和省略csrftoken参数及其值给出了200。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="c56a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为在分析以下目标时，您的方法易于自动化:</p><p id="2568" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用burp pro和jsfinder扩展访问网站，</p><p id="20e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查jsfinder在端点方面找到了什么，</p><p id="19ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">试图访问这些端点，</p><p id="f844" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后继续前进。</p><p id="14c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，有时，不是所有的时间，但有时，值得手动阅读一些简单的，看似不感兴趣的东西，如网站及其页面的html源代码。你可能会发现一些有趣的地方。</p><p id="715b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果，或者我应该说，每当你感到困惑时，试试这个:看看夏洛克·福尔摩斯风格的电影和电视节目，以及需要解决多部分谜题的视频游戏(意味着你需要结合多种线索才能找到某种解决方案)，因为它可能会让你的大脑摆脱困惑。</p></div></div>    
</body>
</html>