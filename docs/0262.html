<html>
<head>
<title>Bypassing rate limit abusing misconfiguration rules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绕过速率限制，滥用错误配置规则</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bypassing-rate-limit-abusing-misconfiguration-rules-dcd38e4e1028?source=collection_archive---------0-----------------------#2019-02-15">https://infosecwriteups.com/bypassing-rate-limit-abusing-misconfiguration-rules-dcd38e4e1028?source=collection_archive---------0-----------------------#2019-02-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/5c3d7c1b4df0801b9fe1fc3fb6ccb943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*DaNDzk82rBjYsjv4skvJBQ.png"/></div></figure><p id="8088" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">朋友们好，</p><p id="95e1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这一次，我将与你分享我是如何绕过一个私人程序中所有表单的速率限制的，所以让我们开始吧:)</p><p id="8174" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">稍微讲一下速率限制:</strong></p><blockquote class="ks kt ku"><p id="dd3a" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated">使用速率限制算法来检查用户会话(或IP地址)是否必须基于会话高速缓存中的信息来限制。</p><p id="6d99" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated">如果客户机在给定的时间范围内发出太多请求，HTTP-服务器可以用状态代码429:太多请求来响应。</p></blockquote><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi kz"><img src="../Images/8133b3f64bd63848f119c8d1a05fd79f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dhyap5dZigYH_AKg5sRjdA.png"/></div></div></figure><p id="4ac2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">发现阶段:</strong></p><p id="1119" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在发现过程中我注意到所有的应用功能都受到速率限制的保护，于是我开始思考如何忽略公司实现的这个算法，因为一旦忽略，我就可以对多个应用功能进行暴力攻击，比如:</p><ul class=""><li id="bb33" class="li lj iq jw b jx jy kb kc kf lk kj ll kn lm kr ln lo lp lq bi translated">通过强力创建多个用户</li><li id="f94d" class="li lj iq jw b jx lr kb ls kf lt kj lu kn lv kr ln lo lp lq bi translated">暴力攻击登录页面</li><li id="540d" class="li lj iq jw b jx lr kb ls kf lt kj lu kn lv kr ln lo lp lq bi translated">2FA旁路(不幸的是，应用程序没有实现2FA方法)</li></ul><p id="7495" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第一次尝试:</strong></p><p id="03bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有目的地触发速率限制算法，然后更改我的IP。当执行这样的测试时，我能够发送4个以上的请求，之后，我再次被阻止。</p><p id="cf9c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你注意到什么了吗？</p><p id="8a0a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过这个测试，我感觉到IP正在执行速率限制规则。我发现每4个请求中就有一个被阻止。我们现在可以假设应用程序一直在检查我们通过远程IP发出了多少请求。</p><p id="56ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有意思…</p><p id="1688" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我立即想到了第二种可能性:实现速率限制规则的一个常见错误是，有时创建该规则是为了阻止来自远程IP的暴力攻击，但IP <strong class="jw ir"> 127.0.0.1 </strong>(本地主机)除外</p><p id="8e00" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">第二次尝试:</strong></p><p id="06fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加到HTTP请求头<strong class="jw ir"> X-Remote-IP: 127.0.0.1 </strong></p><p id="c91e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和…速率限制旁路成功完成！</p><p id="db89" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">攻击场景:</strong></p><p id="5b19" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这打开了几个可能性，如:在登录页面上执行暴力(这是由速率限制保护的)</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi kz"><img src="../Images/3ca9b51675cfd15f300de95e26d59c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nx5EErfcQGLBuJmjKlt9GQ.png"/></div></div></figure><p id="fb44" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">执行密码更改垃圾邮件:</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lw"><img src="../Images/4149259b4dbfdcd759f0ea60f01287fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1AbiGrqYjwF_QB58NZx4Rw.png"/></div></div></figure><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lx"><img src="../Images/053dd0482c831673735621cb89576d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ir-YWdGm20C084tIP9xZMg.png"/></div></div></figure><p id="3980" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果应用程序有双因素身份验证，我们也可以对用户密码进行这种攻击，但不幸的是没有启用这种机制:(</p><p id="3aaa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">温馨提示:</strong></p><p id="0d78" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有一个Burp Suite扩展可以自动将bypass头插入到所有HTTP请求中，你可以在这里找到它<a class="ae ly" href="https://portswigger.net/bappstore/ae2611da3bbc4687953a1f4ba6a4e04c" rel="noopener ugc nofollow" target="_blank"/></p><p id="68ae" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是一种让您执行burp入侵者攻击的方式，而不必在您发出的每个请求中手动插入报头。攻击看起来像这样:</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi kz"><img src="../Images/4153c2ebf23da614a922c898481f61b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39rUvn6FTbsLBQwJpfpdpw.png"/></div></div></figure><p id="7296" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，我要感谢整个bug bounty社区，和大家一起学习总是一件非常愉快的事情:)</p><p id="8408" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">希望你喜欢它！</p><p id="41ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里找到我。</p></div></div>    
</body>
</html>