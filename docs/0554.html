<html>
<head>
<title>Finding Path Traversal Vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">查找路径遍历漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/finding-path-traversal-vulnerability-e2506d390569?source=collection_archive---------0-----------------------#2020-04-14">https://infosecwriteups.com/finding-path-traversal-vulnerability-e2506d390569?source=collection_archive---------0-----------------------#2020-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8cb0686a6a49363514f43a06ba8cd758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CKC6c9MYbJbhw_drvEdQ-w.png"/></div></div></figure><p id="5045" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本地文件包含(LFI)也称为路径遍历，它是一个漏洞，可能允许攻击者查看服务器上的敏感文档或文件。它还可能导致远程代码执行、拒绝服务，但是在开始讨论什么是本地文件包含或lfi之前，让我们先了解一下现代web应用程序是如何处理应用程序文件的。</p><h1 id="b22e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">文件处理或包含功能</h1><p id="b0b9" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Web应用程序可能使用文件，也可能包含代码或查看同一服务器上存在或托管的文件中的文本。为了做到这一点，web应用程序可能会使用文件读取机制，为了这个博客，让我们把包含或读取服务器文件的参数称为文件包含函数。</p><p id="53c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/019dba78656a31e912c311c0d1dba0b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*YLuTHoRMr2dumvaZuc4gAg.png"/></div></figure><p id="0019" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码中，“filename”参数的任务是从服务器上的文件中读取内容，这个读取文件的操作可能会受到用户的影响。在编写代码时，开发人员的意图可能只是管理用户选择和输入文件或来自同一服务器上的文件的内容，而开发人员可能没有想到的是，他可能会将控制权交给用户。如果您仔细观察，攻击者可以滥用该功能或特性来请求任何文件或从服务器读取敏感数据。</p><p id="58d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:这是一个示例python脚本，可以编写一个类似的服务器端脚本来做同样的事情。</p><p id="4a23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，根据不同的web应用程序，实现可能会有所不同，它可以是GET方法，也可以是POST方法。问题是<strong class="ka ir">用户或测试者如何找出这些所谓的包含函数</strong>。在recon阶段或通过web应用程序进行一般浏览时，很容易找到这样的包含功能。</p><p id="ef06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面给出的是具有所谓的“包含功能”的URL，作为<strong class="ka ir"> GET </strong>方法请求。</p><p id="2454" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">【http://www.test.com/user/<strong class="ka ir">页面</strong>= one . PHPT8】http://www.test.com/index.php?<strong class="ka ir">文件</strong>=内容<br/>http://www.test.com/main.cgi?<strong class="ka ir">首页</strong>= index . html<br/>http://www.test.com/main/index.html</p><p id="1fc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>并不总是需要url具有包含功能，您只需要假设您可能位于web服务器根目录或web文档目录中。</p><p id="0f68" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且<strong class="ka ir"> POST </strong>请求可能看起来像这样</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/e166508a1bd7c66560a73e86ec1d7ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dgo-ONR_jL-nMBCGxbqmYA.png"/></div></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/3222a99e8439a4c5d17c98de24614360.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*bQM_Ks_hO6jT8fzzpgGICQ.gif"/></div></figure><p id="1138" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">饼干！！</strong></p><p id="407f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，cookie是web应用程序不可或缺的一部分，它有助于使HTTP协议有状态，如果你想了解cookie和会话，还可以做一些其他的工作。请阅读我的前一篇博客。事实证明，cookies也可以用来动态生成页面或模板。</p><p id="da9b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例子</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/fc620ff66aa7a122220ce9d12b38a6b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BsjZMqhh0BGlaAPQuqE9vQ.png"/></div></div></figure><p id="7729" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着cookies也在测试路径遍历或文件包含漏洞的范围之内，你是如何做到这一点的，这将在稍后介绍…..</p><h1 id="549d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">为什么会出现这个漏洞？</h1><p id="6fc8" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">现在你知道许多应用程序使用这种所谓的包含功能来管理图像、模板、代码、静态文本。当这些输入参数或包含函数被错误地验证时，问题就出现了。攻击者利用这一点，能够传递有效负载(已知的文件路径),这可能导致敏感数据泄漏。由于包含函数能够从服务器读取任何文件，它甚至允许攻击者访问服务器的远程外壳。</p><h1 id="cb9b" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">如何搜索本地文件包含？</h1><p id="c908" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">查找路径遍历漏洞相当容易，为了找到这样的漏洞，应该能够执行以下任务。</p><ul class=""><li id="6c54" class="mi mj iq ka b kb kc kf kg kj mk kn ml kr mm kv mn mo mp mq bi translated">枚举包含函数</li><li id="1c40" class="mi mj iq ka b kb mr kf ms kj mt kn mu kr mv kv mn mo mp mq bi translated">测试枚举的包含函数</li></ul><p id="a0d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么如何列举包含函数呢？这很简单，你只需要把下面的问题记在心里。</p><ul class=""><li id="8862" class="mi mj iq ka b kb kc kf kg kj mk kn ml kr mm kv mn mo mp mq bi translated">URL或请求正文中包含函数或文件相关参数在哪里？</li><li id="ac27" class="mi mj iq ka b kb mr kf ms kj mt kn mu kr mv kv mn mo mp mq bi translated">如果您可以在URL或请求正文中看到不寻常的文件扩展名？</li></ul><p id="5508" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例子</p><p id="69c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">http://www.test.com/haha?file=index.html<a class="ae me" href="http://www.test.com/haha?file=index.html" rel="noopener ugc nofollow" target="_blank"/></p><p id="fd86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你能够找到包含函数时，测试它！</p><p id="a173" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例子</p><p id="da5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">【http://www.test.com/haha?file=】<strong class="ka ir">/etc/passwd</strong><strong class="ka ir"/>(已知文件路径)</p><p id="0930" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者</p><p id="5d95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae me" href="http://www.test.com/main/../../etc/passwd" rel="noopener ugc nofollow" target="_blank">http://www.test.com/main/../../etc/passwd</a></p><p id="7f66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您不必只输入“/etc/passwd”。您可以对目录和文件路径使用所有可能的猜测，也可以使用../”跳回或移动到特定目录。</p><p id="e3a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记住一件事很重要，那就是recon阶段很重要，例如/etc/passwd文件路径存在于大多数Linux中，当您在Linux服务器上运行的应用程序上测试有效负载时，它是有意义的。但是，如果在IIS服务器上运行的应用程序上使用“/etc/passwd”有效负载是没有意义的，因为IIS服务器中不存在该文件。所以用外行的话来说，你需要足够敏捷地向inclusion函数询问在那个环境中可能存在的文件。</p><p id="8c01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个操作系统都有不同的路径分隔符。</p><p id="f959" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例子</p><p id="f55a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Unix/Linux </strong></p><p id="078d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根目录:"/"</p><p id="4a1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目录分隔符:“/”</p><p id="eda3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">窗户</strong></p><p id="0810" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根目录:"<drive letter=""> :\ "</drive></p><p id="4b2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目录分隔符:" \ "</p><h1 id="3e5a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">让我们看看它的运行情况</h1><p id="d391" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">为了测试或练习，你可以选择任何一个易受攻击的应用，无论是BWA还是DVWA。我选择了OWASP SKF和Mutillidae和演示。</p><h2 id="f7e4" class="mw kx iq bd ky mx my dn lc mz na dp lg kj nb nc lk kn nd ne lo kr nf ng ls nh bi translated">在Mutillidae测试用例1 GET方法上测试LFI</h2><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="f33d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的测试案例中，很容易找到文件包含函数并传递文件路径。</p><h2 id="bfdb" class="mw kx iq bd ky mx my dn lc mz na dp lg kj nb nc lk kn nd ne lo kr nf ng ls nh bi translated">在OWASP SKF测试案例2 POST方法上测试LFI</h2><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="92b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个测试用例有一个POST请求，执行lfi所需要的只是篡改文件的请求体和请求。然而，在所有其他lfi狩猎实例中，情况并非如此。</p><h2 id="902c" class="mw kx iq bd ky mx my dn lc mz na dp lg kj nb nc lk kn nd ne lo kr nf ng ls nh bi translated">在OWASP SKF测试案例3 POST方法上测试LFI(绕过过滤输入)</h2><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="121c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不同测试案例的目标非常简单，那就是本博客的读者能够建立一种搜寻文件包含漏洞的能力。在上面的测试用例中，开发人员实现了一个过滤机制来过滤掉“../"因此，如果我们愚弄逻辑并修改我们的有效载荷，以便在被过滤掉之后它仍然有意义，那么我们将能够获得数据。而不是使用“../../../etc/passwd”，我用了“…/。/…/./…/./etc/passwd so all "../"将被过滤，最终我们将得到数据。</p><h2 id="0104" class="mw kx iq bd ky mx my dn lc mz na dp lg kj nb nc lk kn nd ne lo kr nf ng ls nh bi translated">在OWASP SKF测试案例4 POST方法上测试LFI</h2><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="7a0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个测试案例中，web服务器完全拒绝了有效负载的所有可能组合，最后，有效负载是双URL编码的，只有在服务器接受并给我们数据时才这样。这也是一个需要测试的场景，因此您可能需要对有效载荷进行编码或双重编码。</p><p id="98d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">专业提示:开发人员并不期望每种形式的编码，所以他们只实现一种基本形式的编码。如果你的有效载荷在第一次尝试中失败了，那就更加努力地尝试，不断地改变你的有效载荷。如果服务器接受UTF8序列，也可以使用Unicode/UTF-8编码。</p><h2 id="1b14" class="mw kx iq bd ky mx my dn lc mz na dp lg kj nb nc lk kn nd ne lo kr nf ng ls nh bi translated">在Cookies测试用例5中测试LFI</h2><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/1556e6cd487204d3248caf874316f8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ktzcYZLooC0cJ-NalBULw.png"/></div></div></figure><p id="8362" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">cookies上的路径遍历测试与URL或POST请求中的包含函数测试一样。参考下面给出的图片，了解如何测试。</p><h1 id="7aab" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">DotDotPwn</h1><p id="c182" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">实际上很难猜测不同环境下所有可能的有效负载或文件路径。别担心，我抓住你了！！。DotDotPwn是一个惊人的目录/路径遍历模糊测试器。模糊测试是一种质量保证技术，涉及发送大量随机数据输入并获得意外响应，因此DotDotpwn有助于模糊或测试大多数可能的文件路径，它还有一个功能，让pentester确定遍历的深度，您还可以根据操作系统环境选择有效负载，它还支持多种协议。</p><h2 id="1c7d" class="mw kx iq bd ky mx my dn lc mz na dp lg kj nb nc lk kn nd ne lo kr nf ng ls nh bi translated"><strong class="ak">步骤1 </strong>打开终端类型:dotdotpwn [space] —帮助</h2><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/1a10fb4bad08598ba7d1079f634aa2b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4JGedMWW_ejZojb83lhyXA.png"/></div></div></figure><p id="fcec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤2 </strong>选择目标和协议，并在命令中键入相关属性在我的例子中，我在Mutillidae上测试了这个工具，并传递了以下命令</p><p id="492b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">【172.16.111.134/mutillidae/index.php T4】dotdotpwn-m http-h？page= </p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/f2971d5009e2e12a57c10e186a632716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w1oXmN1ZXC9jgQGnhIASbw.png"/></div></div></figure><p id="3a62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第三步点击</strong>回车启动</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/4144679d53e57a6adb2f236717b0967d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RywJsit1cc5Ckga1kkvXdQ.png"/></div></div></figure><p id="e3b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个工具会做所有的模糊处理。</p><h1 id="c42b" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">LFI vs RFI还是他们一样？</h1><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/5984fe73f6c703adbb20c35baf024f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*HfGy18T7ezBleJC6npHwSA.gif"/></div></figure><p id="3d11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">路径遍历攻击也称为“目录遍历”、“点-点-斜线”、“目录攀爬”、“回溯”和本地文件包含。让我们先弄清楚本地文件包含实际上是什么，然后我们将跳到远程文件包含。</p><p id="95c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这两个漏洞都是文件包含漏洞，只是包含功能被利用了而已。</p><p id="2858" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本地文件包含中，包含功能会泄漏服务器内存在的意外文件或服务器本地的文件。在远程文件包含中，攻击者传递某个远程服务器中存在的恶意文件的URL或文件路径，包含功能加载恶意文件并在自己的服务器上运行，这可能导致远程外壳或XSS攻击，或者攻击者上传允许他浏览目录等的外壳文件。</p></div></div>    
</body>
</html>