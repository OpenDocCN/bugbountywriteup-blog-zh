<html>
<head>
<title>How I chained P4 To P2 [Open Redirection To Full Account Takeover]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何把P4和P2联系起来的</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-chained-p4-to-p2-open-redirection-to-full-account-takeover-a28b09a94bf7?source=collection_archive---------0-----------------------#2021-01-30">https://infosecwriteups.com/how-i-chained-p4-to-p2-open-redirection-to-full-account-takeover-a28b09a94bf7?source=collection_archive---------0-----------------------#2021-01-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f7f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，</p><p id="a70d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你一切都好。很久以后，我带着一篇关于我如何将开放重定向链接到完整ATO的新文章回来了。我简单讲个故事吧。:P</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="c275" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我报告了“通过引用者响应的令牌泄漏”。过了一段时间，这个问题解决了，所以我决定再次调查这个问题来验证。然后我注意到一个带有“redirectUrl”的端点，在修复这个问题时，他们做了一些更改，并在HTTP请求上添加了一个新参数，然后我将redirect URL更改为google.com。但是当我检查那里的邮件时，它没有被注射google.com。但打开链接后，它成功地重定向到google.com。</p><p id="45f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我想尽快报告，但我想是否有可能连锁？如果可能的话，这是值得报道的。然后我注意到RedirectUrl=是用reset标记反映的。然后我决定举报。</p><p id="41e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这类似于主机头注入，0auth缺陷，但在不同的场景。我认为这将有助于人们找到类似的问题，所以我写了这篇文章与你分享。如果我将其报告为开放重定向，它将被接受为p4，即Bugcrowd上的低优先级风险bug。</p><p id="f374" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于<strong class="jp ir">打开重定向</strong>:</p><p id="31eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当用户访问位于受信任网站上的链接时，攻击者能够将用户重定向到不受信任的站点，就会出现无效重定向漏洞。这种漏洞通常也称为开放重定向。</p><p id="f349" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Portswigger实验室:<a class="ae ks" href="https://portswigger.net/academy/labs/launch/67ab900d88bcd094478d14d157338de5bf87302c124c802219a8ef29a4a65e0f?referrer=%2fweb-security%2fdom-based%2fopen-redirection%2flab-dom-open-redirection" rel="noopener ugc nofollow" target="_blank">https://ports wigger . net/academy/labs/launch/67ab 900d 88 BCD 094478d 14d 157338 de 5 BF 87302 c 124 c 802219 a 8 ef 29 a 4 a 65 e0f？referer = % 2f web-security % 2f基于dom的% 2f open-redirection % 2f flab-DOM-open-redirection</a></p><p id="8cc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重现此问题的步骤:</p><ol class=""><li id="2aeb" class="kt ku iq jp b jq jr ju jv jy kv kc kw kg kx kk ky kz la lb bi translated">首先我通过https://redacted.vulnsite.com/login的<a class="ae ks" href="https://redacted.vulnsite.com/login" rel="noopener ugc nofollow" target="_blank">登录，然后点击忘记密码。</a></li></ol><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lc"><img src="../Images/f002696e070dee2a178b43587aa12ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F60R8EZALyvDKkYloyf9QA.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">易受攻击网站的UI。</figcaption></figure><p id="b8ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.然后我打开burp套件拦截请求，点击“忘记密码”，输入受害者邮件。将请求发送到中继器，并将请求更改为:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/0bbc0915b113b0fc3d0ae83052c608b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*fsMcrf6_ZS394LtQ8DbBvw.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">HTTP请求之前:</figcaption></figure><p id="4550" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并打开一个终端，运行这个命令“python3 -m HTTP。服务器80”来接收请求。</p><p id="87e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lo">然后我把请求改成了{ " redirectUrl ":" http://127 . 0 . 01/？reset-result = { 0 }&amp;reset-callback-uri = { 1 } " }</em></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/5b0738628a9be75b2fa88aa8e7d4cfe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*gcyaYtNKtiOJye1HXQwBAQ.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">在HTTP请求中将redirectUrl更改为127.0.01。</figcaption></figure><p id="7fdd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.当我作为受害者打开重置链接时。它重定向到<a class="ae ks" href="http://127.0.01/reset" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 01/Secret _ reset</a>_ token</p><p id="017a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.当我检查重置链接得到的响应时。</p><p id="37f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我只需将网址(<a class="ae ks" href="https://redacted.vulnsite.com/login" rel="noopener ugc nofollow" target="_blank">https://redacted.vulnsite.com</a>/<a class="ae ks" href="http://127.0.01/reset" rel="noopener ugc nofollow" target="_blank">Secret _ reset</a>_ token)替换为重置链接，就可以重置密码了。现在，我们可以设置一个新的密码，这将导致完全接管帐户。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lq"><img src="../Images/aedb485b1de9602e66aa902c29ad0b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mXD_ggOxvhdBtFy0RGflgw.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">Bugcrowd ASE的回应！</figcaption></figure><p id="7f65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为它类似于主机报头注入。Bugcrowd应用程序安全工程师更改了VRT作为主机标头注入，并提供了很好的注释！❤ :)</p><p id="2785" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我也在学习，但以下是我的一些心得:</strong></p><ol class=""><li id="518c" class="kt ku iq jp b jq jr ju jv jy kv kc kw kg kx kk ky kz la lb bi translated">首次搜寻漏洞披露计划(基于点数、名人堂、基于奖品的竞争较少)。</li><li id="2879" class="kt ku iq jp b jq lr ju ls jy lt kc lu kg lv kk ky kz la lb bi translated">我建议你学习一些漏洞披露程序的方法，并将其应用于付费程序。如果我们直接转到公共付费项目，出现错误或重复的几率会很低，这会导致挫败感。</li><li id="7800" class="kt ku iq jp b jq lr ju ls jy lt kc lu kg lv kk ky kz la lb bi translated">花些时间了解这个平台。例如，Bugcrowd接受限速问题，但Hackerone不接受。(也取决于程序)</li><li id="c29a" class="kt ku iq jp b jq lr ju ls jy lt kc lu kg lv kk ky kz la lb bi translated">仔细阅读计划政策和范围。</li><li id="a350" class="kt ku iq jp b jq lr ju ls jy lt kc lu kg lv kk ky kz la lb bi translated">制作一个清单并应用它。即通过将POST更改为GET的CSRF、密码重置页面中的SQL、通过更改标头的主机标头注入等。</li><li id="fbfa" class="kt ku iq jp b jq lr ju ls jy lt kc lu kg lv kk ky kz la lb bi translated">在报告之前，了解问题的利用和影响。</li><li id="d018" class="kt ku iq jp b jq lr ju ls jy lt kc lu kg lv kk ky kz la lb bi translated">固定后寻找旁路。</li></ol><p id="86e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将感谢您的反馈，以便改进和撰写更多内容。</p><p id="85e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您抽出时间阅读！快乐的黑客/狩猎！</p><p id="ae1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过以下方式与我联系:</p><p id="9c93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">推特</strong>:<a class="ae ks" href="https://twitter.com/bishal0x01" rel="noopener ugc nofollow" target="_blank">https://twitter.com/bishal0x01</a></p><p id="9293" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">insta gram</strong>:<a class="ae ks" href="https://www.instagram.com/bishal0x01/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/bishal0x01/</a></p><p id="c90b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">YouTube</strong>:<a class="ae ks" href="https://www.youtube.com/therbishal" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/therbishal</a></p><p id="ec8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参考资料:<a class="ae ks" href="https://blog.detectify.com/2016/08/15/owasp-top-10-unvalidated-redirects-and-forwards-10/" rel="noopener ugc nofollow" target="_blank">https://blog . detect ify . com/2016/08/15/owasp-top-10-un validated-redirects-and-forwards-10/</a></p><p id="adf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ks" href="https://portswigger.net/web-security/host-header" rel="noopener ugc nofollow" target="_blank">https://portswigger.net/web-security/host-header</a></p></div></div>    
</body>
</html>