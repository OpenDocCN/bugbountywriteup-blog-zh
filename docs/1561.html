<html>
<head>
<title>Bypassed! and uploaded a sweet reverse shell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绕过了！还上传了一个甜甜的反转壳</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bypassed-and-uploaded-a-sweet-reverse-shell-d15e1bbf5836?source=collection_archive---------0-----------------------#2021-09-05">https://infosecwriteups.com/bypassed-and-uploaded-a-sweet-reverse-shell-d15e1bbf5836?source=collection_archive---------0-----------------------#2021-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6932" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">嘿，今天我将展示我是如何发现一个文件上传漏洞的，我绕过了这个漏洞并弹出了一个反向外壳。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/43540378f665d7321e0e8e9548a18f92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E71VWSVOUplfC6juanF3tA.jpeg"/></div></div></figure><p id="9f64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最初是一个私人项目，姑且称之为target.com。他们有一个功能，上传一个只接受jpg，png，jpeg图像的个人资料图片。</p><p id="5140" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我试着上传一个php反向shell文件，你可以从<a class="ae ln" href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php" rel="noopener ugc nofollow" target="_blank"> pentestmonkey </a>获得</p><p id="0d25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">我试着上传了一个反壳，但不幸失败:</strong></p><ul class=""><li id="cd72" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">只是上传。php文件而不是jpg文件。</li><li id="bf2e" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">尝试双扩展名绕过和上传php文件pic.jpg.php或pic.php.jpg</li><li id="cabe" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">更改内容类型过滤，即将内容类型:txt/php更改为image/jpg</li><li id="efae" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">试过区分大小写pic.php5也试过pic.php5，php5。</li><li id="e9b7" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">尝试使用特殊字符绕过pic.php%00、pic.php%0a和pic.php%00</li></ul><p id="09f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所有上述情况根本不起作用，显然它们是公司保留的基本安全补救措施。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="9510" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们尝试一些新的东西，<strong class="kt ir">你听说过幻数吗？</strong></p><p id="6ead" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">基本上每个文件扩展名都有自己的幻数，我拿了一个php-reverse-shell.php文件，用十六进制编辑器在php文件的开头用十六进制工具添加了jpeg的幻数，即<strong class="kt ir"> FF D8 FF E0 </strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mj"><img src="../Images/31e8c17d888d80d37ba064b2ebd3e614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pt8Sqexj4Ggr4ujMi22iFA.png"/></div></div></figure><p id="25a9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我刚刚上传了文件，它工作了！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="b71f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，只要点击查看个人资料，我就可以访问反向外壳。</p><p id="ed7f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">这背后的原因是因为</strong>，</p><p id="b388" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">“图像过滤器正在查看文件开头的‘幻数’,以确定它是否是有效的图像，而这正是我们刚刚忽略的地方。”</p><p id="9932" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">举报、奖励— $*****</p><p id="8885" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望你喜欢我发现的这个关于文件上传漏洞的小故事。</p><p id="3550" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你有任何关于这篇文章的问题想问我，请通过<a class="ae ln" href="https://twitter.com/security_donut" rel="noopener ugc nofollow" target="_blank">Twitter(security _ donut)</a>联系我，我的DMs永远是开放的。</p><p id="3c02" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下一篇文章再见！</p></div></div>    
</body>
</html>