<html>
<head>
<title>Malware Analysis [#1]- NanoCore Rat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">恶意软件分析[#1]-纳米核心鼠</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/malware-analysis-nanocore-rat-6cae8c6df918?source=collection_archive---------0-----------------------#2022-03-27">https://infosecwriteups.com/malware-analysis-nanocore-rat-6cae8c6df918?source=collection_archive---------0-----------------------#2022-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/49a785cce47e580c26ca89c341f63465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*XsyecNqypkWHcmPpLjaaQw.png"/></div></figure><p id="2f34" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在恶意软件分析的这一系列文章中，我将从恶意软件市场<a class="ae ks" href="https://bazaar.abuse.ch/" rel="noopener ugc nofollow" target="_blank">https://bazaar.abuse.ch/</a>随机选取一个样本，我将在不知道它是什么的情况下分析它，(黑盒)方法。</p><p id="c890" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们开始吧…</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="dbd2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们今天的例子:MD5(5846 c 3588 FBC F6 a 5078 b7a 2413 da 0345)。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi la"><img src="../Images/ec4aac3c1858dc9fed3d87398076900e.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*m_miyPSrGqf9_O91ERwREw.png"/></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="39f0" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">恶意软件构成:</h2><p id="fc1b" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">该示例由以下组件组成:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/84b71fe42ffcc17a5fe5313fd711ab0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*b8yaw8d7qhRR181yzMJSgQ.png"/></div></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/a8d07e8e1cf2688188d56691ca877fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2QG8zJitV_MvPXzMZ0LLmg.png"/></div></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="6296" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">1605 f 0 e 74 c 7088 b 8 a2 ca 7190 b 71 c 83 F8 DC 0381 e 57d 817 df 3530 BDA 4 AC 5737511 . exe的静态分析:</h2><p id="ac66" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">将样本上传到PEStudio，我们看到它是32位高熵可执行文件，并使用NSIS(Nullsoft Scriptable Install System)——这是一个创建windows安装程序的专业开源系统——来删除/重写新文件/可执行文件，它还有一个很旧的编译日期，可能是假的，我面对的是ghost恶意软件的样本，而不是以前使用相同的技术来安装恶意软件组件:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/4946a0b21dccad031db6813d5a4f469b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*cV6Xpo1T89Hg1T1-pELazQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">PEStudio</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/c846198b4322eb2c958e84b9f4a58e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*exWNQ3FUfoVQ7OVsC34Q6A.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">PEStudio:覆盖</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/a9c186dea53dd95247dc2822abd0aa12.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*LyvLIn030i7_tm7dAjbR7g.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">PEbear:覆盖Nullsoft标头</figcaption></figure><p id="04ab" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">解压缩NSIS包时，我们得到4个文件，一个是可执行文件，两个可能是外壳代码或加密文件，最后是NSIS脚本:</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="9273" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">1605 f 0 e 74 c 7088 b 8 a2 ca 7190 b 71 c 83 f 8 DC 0381 e 57d 817 df 3530 BDA 4 AC 5737511 . exe的动态分析:</h2><p id="1e01" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">运行此示例时，我们发现它会在%TEMP%文件夹中创建三个文件，然后写入每个文件，还会在%TEMP%文件夹中创建一个文件夹，每次都使用随机名称，并保持其为空:</p><ul class=""><li id="cc5b" class="mq mr iq jw b jx jy kb kc kf ms kj mt kn mu kr mv mw mx my bi translated">ccgkcf.exe。</li><li id="92b5" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">ka9zcqw3l6l48a1uuba。</li><li id="31df" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">cmdkuqqy。</li><li id="e9e7" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">ns*****。tmp。(最后五个字母在每次执行时都会改变)</li></ul><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ne"><img src="../Images/1a61d97fbcb40938c853f64a4347a7b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KY8FtVlmaFrP_y6wEnZDsQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">Procmon:创建<strong class="bd lh"> ka9zcqw3l6l48a1uuba </strong>并写入其中。</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nf"><img src="../Images/1051d9d76bbd5376ba8904c30c846305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OCSzojLIenhSwZEc0OArUQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">Procmon:创建<strong class="bd lh"> cmdkuqqy </strong>并写入其中。</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ng"><img src="../Images/65f6f6d1e61d864500b770c598576f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tINK5BZ_SzNtP3By8PBsVA.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">Procmon:创建<strong class="bd lh">ccgkcf.exe</strong>并写入其中。</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nh"><img src="../Images/03f6e2903e9780b4d4bfbe406c7f50bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zdHC6Xv479spP-Q_V-7hEQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">Procmon:正在创建ns*****。tmp。</figcaption></figure><p id="c61f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在调试器下，我们可以看到它正在创建一个新进程，使用命令行启动<strong class="jw ir"> "ccgkcf.exe" </strong>，使用文件"<strong class="jw ir"> cmdkuqqy" </strong>作为参数，然后退出该进程:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ni"><img src="../Images/68f0484a445c289bce81c8a30d6515a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tPKFYmgIGqSnCqn1fVxITw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">x64dbg:创建流程</figcaption></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="ee43" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">ccgkcf.exe的静态分析:</h2><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/81c449a68f904b5e6fd681e7e6258184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*fM5KshFhcrvNWTwQCLOUQw.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">PEStudio:一般信息</figcaption></figure><p id="3337" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它是一个32位可执行文件，具有新的编译和调试日期，将其上传到<strong class="jw ir"> IDA </strong>我们看到它正在获取命令行参数，并尝试使用“CreateFileW”打开一个文件，如果该函数失败，它将退出，如果成功，它将获取文件大小，为该文件分配内存并读取它，然后继续解密从该文件读取的数据，然后跳转到该文件，这意味着它是一个外壳代码:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/196198c9304fc785c0bd9ff3c28926a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*ZYmPL7Al-j3ngU8wM5I3yQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">IDA:ccgkcf.exe</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/844d36ead95318556f1c9ecb9a61a85a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*NdSGcrvusWGvQQpqFKZT2w.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">伊达:解密函数</figcaption></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="5c67" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">ccgkcf.exe的动态分析:</h2><p id="946b" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">如前所述，在没有任何参数的情况下运行该实例时，进程将退出，并且不会采取任何操作，但是当添加"<strong class="jw ir"> cmdkuqqy" </strong>作为参数时，正如我们看到的安装程序在创建新进程时所做的那样，该示例通过打开"<strong class="jw ir"> cmdkuqqy </strong>"文件来继续其工作，获取其大小，读取并解密它，最后将执行处理为外壳代码:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nm"><img src="../Images/3628a13a9cf81dbf30dd72ff714e5002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_z5AdJRkf7cQDzgCO3DJMg.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">x64dbg:找不到错误路径</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/632b47118e313bf45fddf44a95110be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*MwJmMNSORo2p6K-XPwfB3w.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">x64dbg:添加参数的命令</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi no"><img src="../Images/fcb4a10255a5b530939d6179120e9664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yMeF8SGXsYqbzbtkI-dAlQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">x64dbg:功能成功</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi np"><img src="../Images/7ab592493e235b7a7123199b811b60fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ed9IygonYJaxf5Mz4pVq0w.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">十六进制比较</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nq"><img src="../Images/87ff976f2c5cd4ac0eacd30595852434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jAFZwnuuRLAPudF-91ojsw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">x64dbg:解密后跳转</figcaption></figure><p id="fd8d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">shell代码从加载库和导入模块开始，然后将下面的名字一个字母一个字母地推到内存中:</p><ul class=""><li id="a1ac" class="mq mr iq jw b jx jy kb kc kf ms kj mt kn mu kr mv mw mx my bi translated">ka9zcqw3l6l48a1uuba。</li><li id="295e" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">ratotpvvsmo.exe。</li><li id="9e30" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">gswccl。</li><li id="32a6" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">hhtktvn。</li></ul><p id="6ea5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，它从%TEMP%文件夹中打开"<strong class="jw ir"> ka9zcqw3l6l48a1uuba" </strong>文件以获得它的句柄，然后获得文件大小，分配内存，读取文件并解密从文件中读取的数据，因此我将它转储到一个文件中以供稍后分析:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nr"><img src="../Images/fadfa9741231b63a4beb33b4c1bf1b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAkhiOfCViA_ouwkOQURig.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">接收从文件"<strong class="bd lh"> ka9zcqw3l6l48a1uuba </strong>中读取的数据的缓冲区</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ns"><img src="../Images/1d241eb47b1007249ee34fd9cf8beeff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0iTs7CiLgRFSVXKaBk2trw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">x64dbg:解密数据后</figcaption></figure><p id="ea69" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，它在“C:\&lt;USER&gt;\ AppData \ Roaming”中创建一个名为“<strong class="jw ir"> gswccl </strong>的文件夹，并在其中创建一个名为“<strong class="jw ir">ratotpvvsmo.exe</strong>的文件，并通过更改注册表“HKCU \软件\微软\Windows\CurrentVersion\Run”中名为“<strong class="jw ir"> hhtktvn </strong>”的自动运行值，将该文件用作持久性技术:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nt"><img src="../Images/72c35332b23f724106757eafdc65c1df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMmhcgNx8byVdEGqohvWYg.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">注册表新值；快照的可执行文件路径已更改</figcaption></figure><p id="daf8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过快速查看"<strong class="jw ir"> ratotpvvsmo.exe" </strong>，我们看到它是<strong class="jw ir"> "ccgkcf.exe "可执行文件的副本:</strong></p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nu"><img src="../Images/6bc50c6d2fe700001a9e9878b7909898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qV-ti9iNTm_tssqwreM2Q.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">HashCalc:ccgkcf.exe和ratotpvvsmo.exe的比较<strong class="bd lh"/></figcaption></figure><p id="c534" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">继续分析，我们看到它用自己的名字创建了一个新的进程，并将从"<strong class="jw ir"> ka9zcqw3l6l48a1uuba </strong>"文件中解密的代码注入其中，然后退出该进程</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/a5490b5ee390410fb10f8fea1244e6af.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*wKJdoGag9zV3RFofYdyF0g.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">Procmon:进程注入</figcaption></figure><p id="812a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">值得一提的是，它使用了“Havens gate”技术，这是指远返回，切换到64位模式，也可以作为一种反逆向工程技术，以保护恶意软件。</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="45cf" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">ka9zcqw3l6l48a1uuba的静态分析。解密:</h2><p id="0ef6" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">上传这个实例到PEStudio，我们看到它是32位高熵可执行文件，新的编译和调试日期也有一个可执行资源。从IDA中，我们发现这个实例将从资源中加载可执行文件并退出进程。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nw"><img src="../Images/01695e60213d3824256bb678f74106bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xe-kN1mkA84HIeCS1eMhTQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">PESutdio:ka 9 zcqw3l 6l 48 a 1 uuba . decrypted一般信息</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nx"><img src="../Images/1b74dc69e1a066ea631ad3f8eafe6dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*59jhLS3uI4-IIJMEHv9cnw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">IDA:加载资源文件</figcaption></figure><p id="abb3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我使用“<strong class="jw ir">resource hacker”</strong>在x64dbg中检查完资源文件后将其删除</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="8136" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">资源文件的静态分析(NanoCore Rat):</h2><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ny"><img src="../Images/95c3ef79e17c2b198b2f07c06ccd2e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_CeTx48DNRqPLjV_WhCZQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">纳米核心鼠一般信息</figcaption></figure><p id="dbe6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">上传资源文件，看起来是的。NET可执行文件，当查看该可执行文件的导入或字符串时，有一个很大的哈希导入列表，重要的是，我发现了一个NanoCore ascii字符串，当将文件上传到dnSpy时，我们可以看到它被严重混淆:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nz"><img src="../Images/6bc4be250d1c813a298566b66bfd8208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lXI55koHCfzboAmRvYomA.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">纳米核心鼠串</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oa"><img src="../Images/7b21906110f952da25cd9a2f3f9b72e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQKWo1yqa_jfIrES7yExkQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">dnSpy: NanoCore客户端混淆实例</figcaption></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="b24c" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">资源文件的动态分析(NanoCore Rat):</h2><p id="c950" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">运行NanoCore时，它会在“&lt; <strong class="jw ir">用户&gt; \AppData\Roaming </strong>”文件夹中创建一个文件“<strong class="jw ir"> run.dat </strong>”。它还尝试连接到C2服务器，下面是DNS请求的快照和关于该域的信息:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/041562c740120ff2a1cf6e812e6d9e13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*-_dzJ-6h4IoRe6MDCP8dZg.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">WireShark:为域发送了DNS请求</figcaption></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oc"><img src="../Images/cd39fb79090c96e24f6e32bf9c75d7ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3X_7iH9QRPEmb4k7uwAPYA.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">领域信息</figcaption></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="d5aa" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">雅拉规则和签名:</h2><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi od"><img src="../Images/24be6c1809a247246188305c2247b443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4u1qzETAq8F9HXdwfp9Zg.png"/></div></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="ee77" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">防逆转技术:</strong></p><ul class=""><li id="d474" class="mq mr iq jw b jx jy kb kc kf ms kj mt kn mu kr mv mw mx my bi translated">IsDebuggerPresent。</li><li id="f959" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">远归(天堂之门)。</li><li id="6c42" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated">混淆视听。</li></ul></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="5557" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">链接:</strong></p><ul class=""><li id="0a1a" class="mq mr iq jw b jx jy kb kc kf ms kj mt kn mu kr mv mw mx my bi translated"><a class="ae ks" href="https://bazaar.abuse.ch/sample/1605f0e74c7088b8a2ca7190b71c83f8dc0381e57d817df3530bda4ac5737511/" rel="noopener ugc nofollow" target="_blank">https://bazaar . abuse . ch/sample/1605 f 0e 74 c 7088 b 8 a2 ca 7190 b 71 c 83 f 8 DC 0381 e 57d 817 df 3530 BDA 4 AC 5737511/</a></li><li id="eb7d" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated"><a class="ae ks" href="https://www.virustotal.com/gui/file/1605f0e74c7088b8a2ca7190b71c83f8dc0381e57d817df3530bda4ac5737511/detection/f-1605f0e74c7088b8a2ca7190b71c83f8dc0381e57d817df3530bda4ac5737511-1648116728" rel="noopener ugc nofollow" target="_blank">https://www . virus total . com/GUI/file/1605 f 0e 74 c 7088 b 8 a2 ca 7190 b 71 c 83 f 8 DC 0381 e 57d 817 df 3530 BDA 4 AC 5737511/detection/f-1605 f 0e 74 c 7088 b 8 a2 ca 7190 b 71 c 83 f 8 DC 0381 e 57d 817 df 3530 BDA 4 AC 5737511</a></li><li id="9bea" class="mq mr iq jw b jx mz kb na kf nb kj nc kn nd kr mv mw mx my bi translated"><a class="ae ks" href="https://www.flaticon.com/free-icons/trojan" rel="noopener ugc nofollow" target="_blank">https://www.flaticon.com/free-icons/trojan</a></li></ul></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="f24a" class="lf lg iq bd lh li lj dn lk ll lm dp ln kf lo lp lq kj lr ls lt kn lu lv lw lx bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ks" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>