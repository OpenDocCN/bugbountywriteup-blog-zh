<html>
<head>
<title>WhatsApp Bug Bounty: Bypassing biometric authentication using voip</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WhatsApp Bug Bounty:使用voip绕过生物认证</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/whatsapp-bug-bounty-bypassing-biometric-authentication-using-voip-87548ef7a0ba?source=collection_archive---------0-----------------------#2022-03-06">https://infosecwriteups.com/whatsapp-bug-bounty-bypassing-biometric-authentication-using-voip-87548ef7a0ba?source=collection_archive---------0-----------------------#2022-03-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ca19e32fd2a10b8958148bd923341a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VtO2J9p_9vCp5W391iGCWg.png"/></div></div></figure><p id="d4ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">注:根据负责任的披露政策，这是在脸书的许可下出版的。该漏洞现已修复。</em></p><p id="f27f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Android中，WhatsApp的“屏幕锁定”功能允许用户使用可用的设备生物特征凭证(指纹、Face ID、PIN码和图案)来锁定应用程序。</p><p id="0a5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">“自动锁定”功能将在用户指定的持续时间后自动锁定应用程序。如果用户选择“1分钟”，那么应用程序将在1分钟不活动后被锁定。</p><p id="8aa0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里的问题是，如果用户在1分钟或以后收到某人的WhatsApp呼叫，那么应用程序无法锁定。因此，攻击者可以轻松地绕过生物识别锁，只需拨打电话并拒绝它就可以完全访问应用程序(阅读聊天，发送消息……)。</p><p id="8eb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">旁路步骤:</strong></p><ol class=""><li id="424c" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">启用生物识别锁定并设置自动锁定持续时间(1分钟或任何时间)。</li><li id="6bed" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">关闭应用程序。</li><li id="77a3" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">1分钟或之后，拨打该设备。</li><li id="6fbf" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">拒绝来电，打开WhatsApp。</li></ol><h1 id="ed95" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">技术根本原因</h1><p id="5b38" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">TL；博士；医生</p><p id="b9e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自动锁定实现示例代码:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="bbca" class="mx lm iq mt b gy my mz l na nb">public class App extends Application {</span><span id="6a83" class="mx lm iq mt b gy nc mz l na nb">  public void onCreate() {<br/>    super.onCreate();<br/>    registerActivityLifecycleCallbacks(activityLifecycleCallbacks);<br/>  }<br/><br/>  ActivityLifecycleCallbacks activityLifecycleCallbacks = new ActivityLifecycleCallbacks() {<br/><br/>    public void onActivityResumed(Activity activity) {<br/>       if(!excludedActivityList.contains(activity)) &amp;&amp;     <br/>       SystemClock.<em class="kw">elapsedRealtime</em>() - getAppClosedTime() &gt;=                 USER_SPECIFIED_DURATION) {<br/>           lockTheApp();<br/>        }<br/>    }<br/><br/>    public void onActivityPaused(Activity activity) {<br/>      saveAppClosedTime(SystemClock.<em class="kw">elapsedRealtime</em>());<br/>    }</span><span id="3770" class="mx lm iq mt b gy nc mz l na nb">  };<br/><br/>}</span></pre><p id="cef2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">“任何屏幕不活动监听器”:WhatsApp会在超时后自动锁定，即使用户从聊天、主页或设置屏幕等任何活动中最小化它。为了实现这一点，WhatsApp在{Application.class}中注册了“活动生命周期回调”。</em></p><p id="4c31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">代码流程:</strong></p><ol class=""><li id="d13f" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">收到呼叫时，启动{CallActivity.class}。</li></ol><p id="d313" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.调用结束后，将关闭{CallActivity.class}，并调用方法{onActivityPaused()}。</p><blockquote class="nd ne nf"><p id="c6f4" class="jy jz kw ka b kb kc kd ke kf kg kh ki ng kk kl km nh ko kp kq ni ks kt ku kv ij bi translated">方法:onActivityPaused()</p><p id="eb0d" class="jy jz kw ka b kb kc kd ke kf kg kh ki ng kk kl km nh ko kp kq ni ks kt ku kv ij bi translated"><em class="iq">将当前“设备运行时间”{SystemClock.elapsedTime()}存储为{app关闭时间}。</em></p></blockquote><p id="1665" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.现在，当应用程序重新打开时，将调用方法{ onactivityrasered()}。</p><blockquote class="nd ne nf"><p id="2ecd" class="jy jz kw ka b kb kc kd ke kf kg kh ki ng kk kl km nh ko kp kq ni ks kt ku kv ij bi translated">方法:onActivityResumed()</p><p id="500e" class="jy jz kw ka b kb kc kd ke kf kg kh ki ng kk kl km nh ko kp kq ni ks kt ku kv ij bi translated"><em class="iq">计算当前“设备运行时间”和存储的{应用关闭时间}之间的“时间差”。如果是&gt;{用户指定时长}，那么只有它会锁定app。</em></p></blockquote><p id="276b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在无法锁定是因为通话结束后保存了{app关闭时间}，“时差”为&lt; {user specified duration}.</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="ed19" class="mx lm iq mt b gy my mz l na nb">public void onActivityPaused(Activity activity) {<br/>    if(!excludedActivityList.contains(activity)) {             <br/>        saveAppClosedTime(SystemClock.<em class="kw">elapsedRealtime</em>());<br/>    }<br/>}</span></pre><p id="c69a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">修正:</strong></p><p id="07f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每当暂停/恢复应用程序的任何活动时，都会调用{ onactivityphansted()}和{ onactivityphansted()}方法。</p><p id="b4c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，可以通过检查活动类名并在{CallActivity.class}不保存{app closed time}的情况下修复此问题。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/462e002543a56110406bee38f34d62c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QI9CX0xn5AUNeGypul6gnQ.jpeg"/></div></div></figure></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="63af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢阅读这篇文章。</p><p id="e3f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">推特:<a class="ae nr" href="https://twitter.com/ar_arv1nd" rel="noopener ugc nofollow" target="_blank">https://twitter.com/ar_arv1nd</a></p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="67bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Infosec Writeups团队刚刚完成了我们的第一次虚拟网络安全会议和网络活动。我们有16位出色的演讲者，他们主持了非常有价值和鼓舞人心的会议。要查看发言人名单和主题，并终身获得所有16场演讲的录音版本，请点击此处。</p><div class="ns nt gp gr nu nv"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd ir gy z fp oa fr fs ob fu fw ip bi translated">IWCon2022 — Infosec书面报告虚拟会议</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">iwcon.liv</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jw nv"/></div></div></a></div></div></div>    
</body>
</html>