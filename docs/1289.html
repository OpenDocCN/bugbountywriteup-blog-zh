<html>
<head>
<title>Nailing automation with Bash: Core concepts and implementations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Bash实现自动化:核心概念和实现</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/nailing-automation-with-bash-core-concepts-and-implementations-95a05a613a44?source=collection_archive---------0-----------------------#2021-05-02">https://infosecwriteups.com/nailing-automation-with-bash-core-concepts-and-implementations-95a05a613a44?source=collection_archive---------0-----------------------#2021-05-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/eefdd962d85cf8cd12e61e84fcd73f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v9I3mCH5a04VB6ceKisK5w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:谷歌图片</figcaption></figure><p id="e945" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">嗨，兄弟们，我希望你们都做得很好，每天都在学习新的东西。最近，我在Twitter上发布了一个bash oneliner，它解决了你的一些自动化问题，我收到了很多关于如何使用bash的问题。许多人觉得很难理解，这完全没关系，没什么可担心的。这就是我写这篇博客的原因，如果它能帮助一些人理解bash自动化的基本概念。</p><p id="8fde" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么，什么是bash脚本？Bash是一个命令语言解释器。它在各种操作系统上广泛可用，并且是大多数GNU/Linux系统上的默认命令解释器。这个名字是'<strong class="ke ir">B</strong>ourne-<strong class="ke ir">A</strong>gain<strong class="ke ir">SH</strong>ell '的缩写。Shell是一个宏处理器，它允许交互式或非交互式的命令执行。<strong class="ke ir">脚本</strong>是编写一个程序供外壳执行，而<strong class="ke ir">外壳脚本</strong>是外壳将要执行的文件或程序。这是对我们在这里所做的事情的基本理解。如果你想了解更多，我强烈推荐你关注这个博客:<a class="ae la" href="https://medium.com/sysf/bash-scripting-everything-you-need-to-know-about-bash-shell-programming-cd08595f2fba#:~:text=Bash%20is%20the%20improved%20version,nano%20to%20edit%20a%20file." rel="noopener"> <strong class="ke ir">点击这里:</strong> </a></p><p id="b3d2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个博客并不是要定义bash是如何工作的，也不是整个编程概念。它完全专注于奖金和东西的Bash自动化。在我们深入探讨之前，让我们看看一些需要记住的命令:</p><ul class=""><li id="0732" class="lb lc iq ke b kf kg kj kk kn ld kr le kv lf kz lg lh li lj bi translated"><strong class="ke ir"> Echo </strong> : <strong class="ke ir"> echo </strong>是一个<strong class="ke ir">命令</strong>，它输出作为参数传递的字符串。</li><li id="07d4" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><strong class="ke ir"> Grep </strong> : Grep <strong class="ke ir">是</strong>用来搜索指定文件中的一串字符串。文本搜索模式<strong class="ke ir"> </strong>称为正则表达式。当它找到一个匹配时，它打印结果行。</li><li id="fe23" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><strong class="ke ir"> Sed </strong> : Sed对输入流(一个文件或来自管道的输入)执行基本的文本转换，只需通过流一次，因此非常高效。然而，sed在管道中过滤文本的能力使其与其他类型的编辑器特别不同。</li><li id="ebb0" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><strong class="ke ir"> AWK </strong> : Awk命令在文件中搜索包含模式的文本。当一行或文本匹配时，awk对该行/文本执行特定的操作。</li><li id="9e32" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><strong class="ke ir"> Xargs: </strong> Xargs <strong class="ke ir"> </strong>可用于构建和执行来自标准输入的命令。有些命令像grep可以接受输入作为参数，但是有些命令接受参数，这就是xargs的用武之地。</li></ul><p id="4bf1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这些是我们将在本文中使用的一些命令。还有很多类似<strong class="ke ir"> sort、tee、uniq、cat </strong>这样的命令，但是在这些命令的帮助下，我们可以做很多工作。我还将包括一些包含我们日常使用的自动化工具的一行程序。</p><p id="77d8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么，一个问题出现了，我们可以在哪里使用bash自动化？最好的地方是侦察部分。通过自动化许多事情和合并许多工具，您可以节省大量时间，这样您就不必单独使用每一个工具。下面是一个简单bash脚本的好例子:</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/66d680771a3f243458876c39a1349c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-mjY5o8-2etVqlgV5Y9FDg.png"/></div></div></figure><p id="daad" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这只是向您展示如何将多个工具合并在一起，以在一个地方获得所需的输出。这不是一个非常奇特的方法，但它肯定会节省你的一些时间。</p><p id="5a13" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">另一个例子是，您可以编写一个简单的一行程序，并为此创建一个别名。<em class="lu">别名</em>是一个(通常很短的)名称，shell将其翻译成另一个(通常更长的)名称或命令。别名允许您通过用字符串替换简单命令的第一个标记来定义新命令。例如，假设您有这样一个简单的单行脚本:</p><p id="7fdc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">echo " target . com " | nucleus-t/tools/nucleus-templates-o output . txt</strong></p><p id="ed94" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们可以为这个oneliner创建一个别名，下一次，我们只需要提供一个目标，我们的工具就会处理它。如果你想了解更多关于别名的知识，这里有一篇文章可以帮到你:<a class="ae la" href="https://linuxize.com/post/how-to-create-bash-aliases/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">点击这里:)</strong> </a> <strong class="ke ir"> </strong>简单了解一下，打开你的<strong class="ke ir">。bashrc </strong>文件，并像这样添加您的别名:</p><p id="52da" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">别名域名= sub finder-d target.com-o output . txt</strong></p><p id="bc58" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">把这个存进去之后。bashrc，当我们在终端那里输入<strong class="ke ir">域</strong>的时候，我们会得到和<strong class="ke ir">sub finder-d target.com-o output . txt一样的输出</strong>这是别名的基本概念。还有更多的事情需要探索，我把如何提高自己的技能留给了你。让我告诉你，在别名的帮助下，你可以运行用Python、Go或任何其他语言编写的工具。只要定义好目录和清晰的语法，你就可以开始了。</p><p id="1653" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我多次收到另一个问题，比如我们如何用bash创建一行程序，并在日常自动化中使用它们。嗯，这取决于您想创建哪种用途的一行程序。假设您想要获取所有的URL，并且想要过滤其中的一些特殊单词，这个简单的oneliner将会有所帮助:</p><p id="d09b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> cat target.txt | grep "？url=" | sort -u | tee output.txt </strong></p><p id="86e5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这里，它会抓取所有包含<strong class="ke ir">的网址？url= </strong>参数。之后，我们将得到一个独特的排序输出文件，我们可以在那里做进一步的事情。在这里，如果您不知道<strong class="ke ir">管道(| ) </strong>，它会将您的输出传递给另一个命令进行进一步处理，这样我们就可以得到最后一个使用的命令的输出。<strong class="ke ir"> tee </strong>命令通常用于分割程序的输出，这样它既可以显示，也可以保存在文件中。</p><p id="74c1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">以上是bash的一些基本用法。让我们看看其他一些命令，就像我们在博客前面讨论的那样。让我们举个例子:</p><p id="2d1e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> sed 's/ab/abc/g' file.txt </strong></p><p id="6f6d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是一个非常基本的<strong class="ke ir"> sed </strong>命令的例子。我们在这里所做的是，我们正在替换file.txt中所有的<strong class="ke ir"> ab </strong>到<strong class="ke ir"> abc </strong>。如果你深入思考，这在你为蛮力者创建一个oneliner时会非常方便。sed中的<strong class="ke ir"> s </strong>字符代表<strong class="ke ir">替代</strong>,<strong class="ke ir">g</strong>代表<strong class="ke ir">全局</strong>。<strong class="ke ir"> </strong>现在，如果你理解了这个游戏，我们可以写一个小的单行程序来做一个子域蛮干:</p><p id="f533" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">echo " target . com " | sed 's#^#</strong><a class="ae la" href="http://#'" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">http://# '</strong></a></p><p id="6adb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这里，^用于标记一行的第一个字符。</p><p id="9ab5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你也可以使用awk。正如我已经提到的awk的作用，让我们看一个使用awk的简单bash一行程序:</p><p id="719b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> cat file.txt | awk '{print NR，length($ 0)；}' </strong></p><p id="693f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">awk在这里要做的是，它将打印行号和每行的字符数。所以现在你可以弄清楚如何用awk来自动化你的侦察工作。这些是您可以用来提高自动化技能的一些命令。</p><p id="6cff" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，这里有一些非常有用的一行程序示例:</p><p id="b5fa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">cat domains . txt | gau | cut-d "/"-f 4，5 | sed 's/？。*//' | sort -u </strong></p><p id="585e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个oneliner将从domain.txt中获取所有数据，通过gau传递，并制作一个大的目录列表。稍后，你可以找到一些有用的。我们使用了切割命令，该命令从线中切割零件，并将输出发送到sed。我们已经使用sort -u对唯一的进行了排序。</p><p id="c655" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个oneliner包含已经可用的工具，我们使用管道将一个工具的输出发送到另一个工具:</p><p id="2d82" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">echo " domain . com " | waybackurls | httpx-silent-time out 2-threads 100 | gf redirect | anew</strong></p><p id="cd0b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个小的一行程序要做的是，它将把domain.com发送到<a class="ae la" href="https://github.com/tomnomnom/waybackurls" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> waybackurls </strong> </a>，在那里我们将获得waybackmachine上所有可用的URL。之后，它使用一个名为<a class="ae la" href="https://github.com/projectdiscovery/httpx" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> httpx </strong> </a>的工具来查看哪些域是活动的，哪些是不活动的。然后httpx数据将被发送到<a class="ae la" href="https://github.com/tomnomnom/gf" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> gf </strong> </a>工具，带有<a class="ae la" href="https://github.com/1ndianl33t/Gf-Patterns" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">模式</strong> </a>用于检查重定向。最后，最终的输出将被转换成新的行，用<a class="ae la" href="https://github.com/tomnomnom/anew" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">重新</strong> </a> <strong class="ke ir"> </strong>帮助你在文件中添加新的行。</p><p id="7860" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，最精彩的部分来了。你可以创建一个<strong class="ke ir"> recon.sh </strong>脚本，它将包含这里提到的所有一行程序，一旦它被执行，你将节省很多时间。不仅如此，你可以为他们中的每一个创建一个别名或者任何你想要的方式。主要目的是，编写一些一行程序，用它们创建一个脚本并一次性运行。没有火箭科学。是的，为了更好地理解bash，我强烈建议学习它。如果你也希望如此，udemy的这门课程可以提供帮助，最棒的是它完全免费:<a class="ae la" href="https://www.udemy.com/course/linux-unix-shell-scripting-tutorial/?ranMID=39197&amp;ranEAID=JVFxdTr9V80&amp;ranSiteID=JVFxdTr9V80-zbiIwb8MzzF4I.S0JKla_w&amp;LSNPUBID=JVFxdTr9V80&amp;utm_source=aff-campaign&amp;utm_medium=udemyads" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">Bash scripting</strong></a><strong class="ke ir">。你也可以查看JavaTpoint的bash learning。</strong></p><p id="cc1a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我希望这篇博客能教你一些bash的基本概念。如果你想深入了解，我把它作为一项任务留给你，因为博客不可能涵盖所有内容，我也不想把它搞得太大。这只是为了让您理解如何在自动化中使用bash的基本思想。另外，<strong class="ke ir"> sed和awk本身就很庞大</strong>，它们包含了很多用途。事实上，awk是一个完整的工具，可以在bash中单独使用。然而，你有足够的时间访问谷歌，探索那里的东西。老实说，学习bash并在黑客中实现它也非常有趣和令人惊奇。我敢打赌，一旦你学会了一些bash，你就会开始爱上它。</p><p id="4968" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将是这个博客，我希望你喜欢它。如果您对此有任何疑问、问题或建议，请在<a class="ae la" href="http://twitter.com/manasH4rsh" rel="noopener ugc nofollow" target="_blank"> <em class="lu"> twitter </em> </a>:)上给我发个dm，我将永远乐意协助/学习。</p><p id="a66e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">保重，快乐黑客！</p><p id="8bd1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Adios❤</p><p id="4bbb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">推特:<strong class="ke ir"> @manasH4rsh </strong></p><p id="364d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">领英:<a class="ae la" href="https://www.linkedin.com/in/manasharsh/" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">https://www.linkedin.com/in/manasharsh/</strong></a></p></div></div>    
</body>
</html>