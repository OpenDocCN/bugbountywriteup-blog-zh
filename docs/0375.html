<html>
<head>
<title>Luke — HackTheBox Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">卢克——黑客盒子报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/luke-hackthebox-writeup-65024c28229c?source=collection_archive---------3-----------------------#2019-09-14">https://infosecwriteups.com/luke-hackthebox-writeup-65024c28229c?source=collection_archive---------3-----------------------#2019-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ed48" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">卢克是本周要退休的人。卢克有点像CTF，但也很有趣。我将从配置文件中找到数据库凭证，因此使用JSON Web Tokens ( JWT ),我将通过API获取所有用户的凭证。然后登录到一个登录面板，并抓取一个配置文件，我得到了根用户的密码。然后，我可以访问high port登录面板，并从那里获得root shell。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/e3771a030d4f71d8e7074fde7444f9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*cgj_4_Z5-SkEhzfUlBWyUw.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">信息卡</figcaption></figure><h1 id="025b" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">计数和侦察</h1><p id="46b8" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们从Nmap扫描开始</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/5c5ae6f9a43e5ddda957192502124426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qFtSKFak3MO6y60qBW3FDw.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">Nmap扫描报告</figcaption></figure><p id="a697" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">我们有相当多的港口开放。21(带匿名访问的FTP)，22 ( SSH ) <br/>，80，3000和8000打开。</p><h1 id="34c4" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">FTP — TCP 21</h1><p id="9d3f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在允许匿名访问的情况下，让我们看看有什么内容。<br/>以<code class="fe mp mq mr ms b">anonymous</code>为用户名，以<code class="fe mp mq mr ms b">whatever</code>为密码登录</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mt"><img src="../Images/c5f6fbab18d938e6eaad951c7e8f0c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eP60O8SSFtd6FBGKmamjxw.png"/></div></div></figure><p id="5ea0" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">我们这里有一份有趣的文件<code class="fe mp mq mr ms b"><strong class="ll ir">for_Chihiro.txt</strong></code>。也许我们有一些潜在的用户名<code class="fe mp mq mr ms b"><strong class="ll ir">Chihiro</strong></code>和<code class="fe mp mq mr ms b"><strong class="ll ir">Derry</strong></code>。</p><h1 id="0cca" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">HTTP — 80</h1><p id="43a7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">看着网站。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mt"><img src="../Images/69e77bce9c55f417bb4c50272b2eb9bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S0CietRrZGQEoYB4l_lpVw.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">端口80</figcaption></figure><p id="f33f" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">Runnig <code class="fe mp mq mr ms b">dirb</code>给了我们一些打开的目录。我在这里使用了<code class="fe mp mq mr ms b">dirb</code>，因为我没有找到一些目录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mu"><img src="../Images/430a0698c8645cec8f1eb3bfff81d4eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGVP25VBoEY1pHSep46jUg.png"/></div></div></figure><p id="5a52" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated"><code class="fe mp mq mr ms b">config.php</code>给出了数据库的配置细节。我们得到一些凭证，让我们把它们放在我们的后口袋里，然后进一步枚举。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mv"><img src="../Images/e53c2a348056fd48e27173ba40ca42f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-XwsPqQHCQcKlkSqhakipw.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">配置文件</figcaption></figure><p id="9c9f" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">让我们在找到的目录上使用这些凭证</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mw"><img src="../Images/b8b23b9dabe86eaaebe7b86d18a3b20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4sSxSE1GvQQkrP76VNp_gg.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">信用没有用</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mx"><img src="../Images/2b0b960c69f352e04c0a948d616b03c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrC2YQyj13dY9GhVEtEJcw.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">这里也没有。</figcaption></figure><p id="d3fe" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">当我找到其他凭证时，我将回到上述目录</p><h1 id="0885" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">Node.js — 3000</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi my"><img src="../Images/c0ceb188a8200befc46a8efb298874ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SXVwbS8dt10EAHgUnwZwPA.png"/></div></div></figure><p id="5cb2" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">查看站点，我们得到一条有趣的消息，说没有提供Auth令牌。</p><h2 id="aa99" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated"><code class="fe mp mq mr ms b">*******************************************************<br/>* Wfuzz 2.3.4 - The Web Fuzzer *<br/>********************************************************</code></h2><h2 id="0ab6" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated"><code class="fe mp mq mr ms b">Target: http://10.10.10.137:3000/FUZZ<br/>Total requests: 2588</code></h2><h2 id="3c04" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated"><code class="fe mp mq mr ms b">==================================================================<br/>ID Response Lines Word Chars Payload<br/>==================================================================</code></h2><h2 id="01ef" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated"><code class="fe mp mq mr ms b">000034: C=200 0 L 2 W 13 Ch "login"<br/>000123: C=200 0 L 5 W 56 Ch "users"<br/>001642: C=200 0 L 2 W 13 Ch "Login"<br/>002099: C=200 0 L 5 W 56 Ch "Users"</code></h2><p id="dc45" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在对什么是JWT以及如何使用它们进行身份验证进行了一些研究之后，我发现了这个网站，它解释了如何使用JWT不记名令牌进行身份验证。看一看吧。</p><div class="nl nm gp gr nn no"><a href="https://medium.com/@nieldw/using-curl-to-authenticate-with-jwt-bearer-tokens-55b7fac506bd" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">使用cURL认证JWT无记名令牌</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">我今天学到了什么—2018年8月29日</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div></div></a></div><p id="7b29" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">这里棘手的部分是获得正确的POST参数，因为我们有几个用户名和一个密码，我猜参数是<code class="fe mp mq mr ms b">username</code>和<code class="fe mp mq mr ms b">password</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nx"><img src="../Images/46f2a2465812917c9c671a3c8c57faaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VvuGSuEDoVNfTdskm7YGjQ.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">获得了一个授权令牌</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ny"><img src="../Images/0ac64def8032a94aa2a3779cb638d49b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HT7vyqPmUrDNam9mri4Uug.png"/></div></div></figure><p id="fb0a" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">我目前拥有的用户名和密码，</p><blockquote class="nz oa ob"><p id="4d92" class="lj lk oc ll b lm mk jr lo lp ml ju lr od mm lu lv oe mn ly lz of mo mc md me ij bi translated"><strong class="ll ir"> <em class="iq">千寻<br/>德里<br/>多利<br/>尤里<br/>管理员<br/>和一个密码——zk6 heycyv 6 ze 9 xcg</em></strong></p></blockquote><p id="9728" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">让我们使用这个令牌来验证其他用户名。我为它写了一个小剧本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi og"><img src="../Images/7b609fbafcd243382049d9594db73f23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aGybzLKV4X1WdNdbQ59Svg.png"/></div></div></figure><p id="edc6" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">我们有4套凭证和两个登录地点(/ <code class="fe mp mq mr ms b">management</code>、<code class="fe mp mq mr ms b">login.php</code>)。</p><h1 id="7bce" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">登录/管理</h1><p id="b998" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">下面的证件让我们进去。让我们看看里面有什么。</p><blockquote class="nz oa ob"><p id="27ea" class="lj lk oc ll b lm mk jr lo lp ml ju lr od mm lu lv oe mn ly lz of mo mc md me ij bi translated">用户名:德里</p><p id="6877" class="lj lk oc ll b lm mk jr lo lp ml ju lr od mm lu lv oe mn ly lz of mo mc md me ij bi translated">密码:rZ86wwLvx7jUxtch</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi oh"><img src="../Images/105df0e58c8f12a0076e342822b9ad94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41F37MAyGqeEVJAYv_bO-w.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">我们有3份文件</figcaption></figure><p id="9ac3" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">所有的文件看起来都很有趣。我会一个一个查出来。</p><h2 id="9dd2" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">配置. json</h2><p id="b2b7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们得到了根的证书。这份文件中还提到了<code class="fe mp mq mr ms b">ajenti</code>。也许这些就是<code class="fe mp mq mr ms b">Port 8000</code>的功劳</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mt"><img src="../Images/6c4676dddadf98f19697a817337eaf74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mg9btFV8hbe_W6VYJjZonw.png"/></div></div></figure><h2 id="5f3f" class="mz ks iq bd kt na nb dn kx nc nd dp lb ls ne nf ld lw ng nh lf ma ni nj lh nk bi translated">login.php</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi oi"><img src="../Images/3a5ab7477a17b4b54d33d316af72568a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pypWqxoEtZ0mGndmRN-y7Q.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">又一个登录页面。</figcaption></figure><p id="3079" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">没有任何凭据适用于此网站。我现在假设这是一个兔子洞。既然我们有<strong class="ll ir">一个实体面板的凭证，</strong>让我们在那里登录<strong class="ll ir">。</strong>和<strong class="ll ir">config.php</strong>是我们最初侦察得到的同一份文件</p><h1 id="1d9b" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">8000 —阿让蒂面板</h1><blockquote class="nz oa ob"><p id="a88f" class="lj lk oc ll b lm mk jr lo lp ml ju lr od mm lu lv oe mn ly lz of mo mc md me ij bi translated">Root creds <br/>用户名:root <br/>密码:KpMasng6S5EtTy9Z</p></blockquote><p id="4118" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">我立刻注意到了一个添加新终端的选项，而且这个服务是作为root运行的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mt"><img src="../Images/2b2613537a87a3bf4f8b4ac90bc06472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3-fbqcGI2eNso3LkBfqp0A.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">根深蒂固的</figcaption></figure><p id="3ab7" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">扎根！<br/>这次我就这样了。</p><p id="6a21" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated">落款，<br/> Preetham ( <a class="ae oj" href="https://www.hackthebox.eu/profile/9160" rel="noopener ugc nofollow" target="_blank"> @cyber01 </a>)</p></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="1777" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mm lu lv lw mn ly lz ma mo mc md me ij bi translated"><em class="oc">关注</em> <a class="ae oj" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="oc"> Infosec报道</em> </a> <em class="oc">获取更多此类精彩报道。</em></p><div class="nl nm gp gr nn no"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">信息安全报道</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow kl no"/></div></div></a></div></div></div>    
</body>
</html>