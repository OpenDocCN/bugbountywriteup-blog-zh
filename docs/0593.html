<html>
<head>
<title>Car Hacking with Python — Part 1 Data Exfiltration: GPS and OBDII/CAN Bus</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python入侵汽车——第1部分数据泄漏:GPS和OBDII/CAN总线</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/car-hacking-with-python-part-1-data-exfiltration-gps-and-obdii-can-bus-69bc6b101fd1?source=collection_archive---------1-----------------------#2020-05-18">https://infosecwriteups.com/car-hacking-with-python-part-1-data-exfiltration-gps-and-obdii-can-bus-69bc6b101fd1?source=collection_archive---------1-----------------------#2020-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="abe5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章是我在DEF CON 28汽车黑客村的<a class="ae kl" href="https://www.carhackingvillage.com/defcon28talks" rel="noopener ugc nofollow" target="_blank">演讲的基础。我介绍了一个基于Python的设备，用于从OBDII端口发送和接收CAN消息；还能从行驶中的车辆上获取实时GPS坐标。所有的CAN和GPS数据都被过滤到云端，因此可以通过网络浏览器远程监控汽车。这篇文章是关于我个人使用开源软件和硬件进行汽车黑客攻击的经历:python-can/Flask和</a><a class="ae kl" href="https://beagleboard.org/blue" rel="noopener ugc nofollow" target="_blank"> BeagleBone Blue </a>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/dae988ed891924a422a7ee2b8d3ef8c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RNtEiOL8Yk3dxhL5-y2uvg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">丘帕卡布拉间谍装置</figcaption></figure><p id="576b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我创建了一个单独的<a class="ae kl" href="https://www.hackster.io/sacchet/chupacarbrah-car-hacking-with-beaglebone-and-python-18f137" rel="noopener ugc nofollow" target="_blank">一步一步的关于如何建立间谍设备</a>的教程，也就是我将在本文中使用的ChupaCarBrah。我还分享了在设备上运行的python-can客户端的所有代码；和运行在AWS上的服务器端Flask应用程序。spy设备的第一个版本能够跟踪车辆位置并监控CAN数据(如发动机转速、气温、VIN等)。所有的数据都是通过一个安装在喙骨上的移动LTE调制解调器传输的。JSON格式用于将数据发送到AWS上的Flask应用程序。随着车辆的移动，云上的JSON数据会实时更新，允许您完全远程监控您的车辆。那是在你舒适的家里偷车。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lc ld l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">ChupaCarBrah上路了</figcaption></figure><p id="afce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为这篇文章的后续，我计划再发表两篇文章来扩展当前的ChupaCarBrah功能:</p><p id="e19b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第2部分— ECU CAN消息:</strong>将展示如何篡改直接连接到ECU的CAN总线(因为OBDII通常只提供诊断数据)。我将着重于逆向工程的CAN消息发送精心制作的命令到ECU。出于安全原因，我计划只涵盖无害的命令，如解锁车门，打开电动车窗等；</p><p id="b0d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第3部分——车辆RCE: </strong>我计划扩展ChupaCarBrah应用程序，以更加用户友好的格式显示所有正在传输的数据，例如绘制在地图上的GPS数据。具有实时数据的GUI还将显示来自解码的CAN消息的当前车辆信息(速度、转速等)。我还计划用POST端点来扩展AWS服务，这将允许通过蜂窝网络创建反向HTTP会话来将CAN命令提交给车辆。</p><h1 id="1dc7" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">威胁建模</h1><p id="0c47" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">一般来说，汽车制造商采用一种威胁模型，通过在CAN总线和外部网络之间建立隔离来减少车辆上的攻击面。隔离可以是物理的(空气间隙)或逻辑的(can网关/防火墙)。当CAN和外部网络确实需要连接时，网关是常见的(例如<a class="ae kl" href="https://en.wikipedia.org/wiki/Vehicular_communication_systems" rel="noopener ugc nofollow" target="_blank"> V2V </a>或<a class="ae kl" href="https://en.wikipedia.org/wiki/In-car_entertainment" rel="noopener ugc nofollow" target="_blank"> IVI </a>)。网关通过仅单向转发CAN消息来提供逻辑分离。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mh"><img src="../Images/8df11b551be4c80f6efd5ddcdefa5738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sgtadmC1UfN3g-x_cjgkQA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">用ChupaCarBrah弥合空气间隙</figcaption></figure><p id="3a91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">采用该威胁模型的安全级别将与物理访问CAN总线的难度和/或利用外部连接上的漏洞进入CAN总线的难度成正比。本文的目标是挑战这一点，并从实际角度展示如果攻击者实际进入车辆并安装ChupaCarbrah会发生什么。该间谍设备在隔离的CAN总线和互联网之间建立了一座桥梁，打破了制造商的威胁模式。</p><p id="2d52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，对于使用ChupaCarBrah的完整笔测试，您仍然需要将我在这里展示的内容与其他攻击技术相结合，例如<a class="ae kl" href="https://www.wired.com/2017/04/just-pair-11-radio-gadgets-can-steal-car/" rel="noopener ugc nofollow" target="_blank">密钥欺骗</a>来访问车辆内部。因此，我认为这篇文章暴露的安全风险很低。但是我仍然想让人们意识到制造商考虑CAN消息的<a class="ae kl" href="https://ieeexplore.ieee.org/document/7934878" rel="noopener ugc nofollow" target="_blank">加密解决方案的重要性；以及让车主意识到他们无法完全控制对车辆的物理访问的情况(例如代客泊车、洗车、忘记车门未锁等)。</a></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lc ld l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">ChupaCarBrah装置:不到60秒</figcaption></figure><p id="d28b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦进入车内，攻击者可以迅速将ChupaCarBrah与OBDII港联系起来。这个装置足够小，可以藏在仪表板里面。所用的OBDII分线器电缆将在车辆原装连接器前提供一个额外的OBDII母连接器。如果攻击者足够卑鄙，他/她可能会使用胶水将分离器永久固定在OBDII端口上。它将允许受害者最终将其他OBDII设备连接到车辆上，而不希望注意到rouge ChupaCarBrah设备。</p><h1 id="a695" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">汽车黑客概述</h1><p id="dba3" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">用CAN ( <a class="ae kl" href="https://en.wikipedia.org/wiki/CAN_bus" rel="noopener ugc nofollow" target="_blank">控制器局域网</a>)进行汽车黑客攻击已经被一些作者很好地报道了。如果你想更好地了解汽车厂商如何使用CAN总线来控制你的汽车的发动机和其他组件，我推荐你看一看克雷格·史密斯的<a class="ae kl" href="http://opengarages.org/handbook/ebook/" rel="noopener ugc nofollow" target="_blank">汽车黑客手册。</a></p><p id="deb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我也推荐这篇非常好的文章:<a class="ae kl" href="https://www.instructables.com/id/How-to-Hack-and-Upgrade-Your-Car-Using-CAN-Bus/" rel="noopener ugc nofollow" target="_blank">Jared Reabow</a>的《如何利用CAN总线破解和升级你的汽车》。它特别关注CAN，并提供了非常有用的提示，例如如何猜测波特率以及如何找到并接入车辆中的CAN总线。</p><p id="957a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章结合了这两位作者提出的黑客技术。然后，我更进一步，构建了一个简单的BeagleBone间谍设备，通过蜂窝网络与移动的汽车进行远程交互，同时通过GPS跟踪车辆位置。</p><h1 id="a1d6" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">为什么是BeagleBone蓝？</h1><p id="5aa5" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">长话短说:BeagleBone Blue已经支持CAN，包括一个CAN收发器。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mi"><img src="../Images/725488e6e9a252fce59c02af47abe582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZkOl5HD_UqaKGZxmUxxgw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">BeagleBone蓝色嵌入式CAN收发器</figcaption></figure><p id="840e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着，你不需要额外的斗篷或帽子。你基本上可以使用两根连接线，将你的猎兔犬骨的CAN Hi和CAN Lo引脚分别直接连接到你汽车上OBDII连接器的引脚6和14。不仅如此，BeagleBone还是一台完整的单板电脑，已经预装了<a class="ae kl" href="https://beagleboard.org/latest-images" rel="noopener ugc nofollow" target="_blank">最新镜像</a>包括<a class="ae kl" href="https://en.wikipedia.org/wiki/SocketCAN" rel="noopener ugc nofollow" target="_blank"> SocketCan </a>。</p><p id="55bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它还具有嵌入式WiFi网卡，允许您在不将计算机物理连接到汽车的情况下使用CAN工具。它可以让你将设备“嵌入”到汽车中，让它完全脱离电脑运行。</p><p id="1f24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于长途连接，您可以使用USB LTE调制解调器(这将在接下来的章节中介绍)。</p><p id="aa0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，BeagleBone Blue board是汽车黑客的一个非常好的选择，特别是当其他受欢迎的工具如<a class="ae kl" href="https://linklayer.github.io/cantact/" rel="noopener ugc nofollow" target="_blank"> CANtact </a>在几乎所有美国经销商处售罄时。如果不想使用开源，可以尝试商业产品，如<a class="ae kl" href="https://docs.macchina.cc/p1-docs" rel="noopener ugc nofollow" target="_blank"> Macchina.cc </a>(我自己没有尝试过，但由于它也是基于<a class="ae kl" href="https://beagleboard.org/" rel="noopener ugc nofollow" target="_blank"> BeagleBoard </a>，我相信我在这里介绍的大部分内容仍然适用)。</p><h1 id="974a" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">建造ChupaCarBrah</h1><p id="f144" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">你需要的最少零件是一个<a class="ae kl" href="https://www.amazon.com/seeed-studio-SeeedStudio-BeagleBone-Blue/dp/B07Q22TVLQ/ref=pd_rhf_ee_p_img_1?_encoding=UTF8&amp;psc=1&amp;refRID=AC7G5546KT07GDR3KGCR" rel="noopener ugc nofollow" target="_blank">猎兔犬蓝</a>，一个<a class="ae kl" href="https://www.seeedstudio.com/Grove-Universal-4-Pin-to-Beagleboner-Blue-4-Pin-Female-JST-SH-Conversion-Cable-10-pcs-pack.html" rel="noopener ugc nofollow" target="_blank"> JST/SH连接器</a>，和连接电线。它们应按如下所示进行连接:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/9f9bb5a181657cfe348f7cbf00a35774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZcqBqMApZ31kvuTvrikCtw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">BeagleBone蓝色JST/SH连接器，带有连接到CAN插槽的连接导线</figcaption></figure><p id="9ff8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保你的连接线足够长，这样你就可以正确地将它们连接到汽车的OBDII连接器上。请记住，如果您的电线太长，您可能需要扭曲黄色和绿色(CAN Hi和Lo)以更接近标准CAN电缆的特性。当然，你也可以使用真正的<a class="ae kl" href="https://www.waytekwire.com/item/CB23-00070/Champlain-Cable-23-00070-EXRAD-Can-Bus/" rel="noopener ugc nofollow" target="_blank"> CAN电缆</a>来代替连接线。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mj"><img src="../Images/44468be9c78ee909981e4511f1961435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hgTU0afiEdDa4Ah-X53__g.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">比格犬骨蓝连接到OBDII</figcaption></figure><p id="afa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将允许您启动您的BeagleBone，启动一个套接字CAN接口来发送和接收CAN消息。这就是你开始黑罐头所需要的全部，然而，通过一些额外的部件，你可以显著增加你的猎兔犬骨的能力来创建一个完整的ChupaCarBrah间谍设备。我已经将构建ChupaCarbrah的所有分步说明放在了一篇单独的文章中，所以我可以保持这篇文章的简洁，并将重点放在Python的黑客攻击上。</p><p id="d970" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请参考Hackster.io上的<a class="ae kl" href="https://www.hackster.io/sacchet/chupacarbrah-car-hacking-with-beaglebone-and-python-18f137" rel="noopener ugc nofollow" target="_blank">ChupaCarBrah——使用BeagleBone和Python进行汽车黑客攻击</a>,了解如何创建支持GPS和蜂窝网络的成熟间谍设备的详细信息。</p><h1 id="3198" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">发送和接收CAN消息</h1><p id="0891" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">将BeagleBone连接到OBDII后，按下电源按钮启动它，然后通过SSH连接到它。我建议<a class="ae kl" href="https://github.com/beagleboard/beaglebone-blue/wiki/Frequently-Asked-Questions-(FAQ)#What_is_the_name_of_the_access_point_SSID_and_password_default_on_BeagleBone_Blue" rel="noopener ugc nofollow" target="_blank">尽可能使用WiFi </a>。速度更快，而且你可以在手机数据套餐上省下一些钱。您需要打开点火开关，这样汽车的CAN设备也可以“启动”。你可能想启动引擎，以防止杀死你的汽车电池。</p><p id="585b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在使用Python代码之前，尝试使用socketCAN手动发送和接收一些消息。首先，设置can0 (can zero)接口的波特率并启用它。</p><blockquote class="mk ml mm"><p id="0aaa" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">sudo ip链接设置can0 up类型can比特率500000 <br/> sudo ifconfig can0 up</p></blockquote><p id="5e2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数汽车在OBDII公共汽车上使用500kpbs。使用candump监听can0接口上的消息</p><blockquote class="mk ml mm"><p id="48ac" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">sudo candump can0</p></blockquote><p id="ae54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据您的车辆，您可能已经在总线上看到CAN消息。如果你的总线是安静的，打开一个新的终端，使用cansend发送一些消息:</p><blockquote class="mk ml mm"><p id="6e00" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">sudo can send can 0 7DF # 020902000000000</p></blockquote><p id="6e56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该在运行candump的终端上看到该消息及其响应。如果没有，您可能需要检查您的布线和/或车辆使用的波特率。您刚刚发送的CAN消息将请求车辆VIN号，响应应该类似于下面的截图。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/f7cdc9fa0f2eaa9677b8a0fe3cbde1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*wiJobCL6NyrtmnjjOYdWDQ.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">用于检索车辆VIN的CAN消息</figcaption></figure><p id="4e7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">车辆识别号数据显示在最后3个数字“32 43 34”中，可以从十六进制解码为ASCII码“2C4”:</p><blockquote class="mk ml mm"><p id="870d" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">echo "32 43 34" | xxd -r -p</p></blockquote><p id="61e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">VIN数据格式如下:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ms"><img src="../Images/90ab3910c70cea29eb1e28e84aa75543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIKxFzCCqf9QRXOBx5ZvGA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">VIN数据格式</figcaption></figure><p id="c730" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您向这个<a class="ae kl" href="https://vpic.nhtsa.dot.gov/decoder/Decoder" rel="noopener ugc nofollow" target="_blank">在线NHTSA工具</a>提供您的ASCII VIN，您可以解析您的车辆WMI(世界制造商标识符)并检查其准确性。在我的例子中，“2C4”告诉我的车是一辆在加拿大制造的道奇乘用车。</p><p id="6da8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然您已经确认可以使用socketcan向汽车发送CAN消息，也可以从汽车接收CAN消息，那么您可以使用Python以编程方式来实现这一点:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mt ld l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">发送和接收CAN消息的Python代码</figcaption></figure><p id="bc63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想尝试不同的命令，请参考<a class="ae kl" href="https://github.com/blupants/chupacarbrah/blob/master/obd2_std_PIDs_enabled.csv" rel="noopener ugc nofollow" target="_blank">此表</a>中您可以使用的可用OBDII PID列表。确保在Python脚本中将“模式(十六进制)”的整数值分配给变量“服务_整数”，并将“PID(十六进制)”的整数值分配给变量“pid _整数”。</p><p id="c1bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，如果您想要读取引擎RPM，请使用以下内容更改脚本的第5行和第6行:</p><blockquote class="mk ml mm"><p id="9558" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">service_int = int("1 "，16)</p><p id="5346" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">pid_int = int("0C "，16)</p></blockquote><p id="67be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里找到更多关于OBDII PID的文档。</p><h1 id="8231" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">GPS坐标</h1><p id="def9" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">要获取GPS数据，只需在ChupaCarBrah设备上运行“tio”命令。</p><blockquote class="mk ml mm"><p id="f3fb" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">tio /dev/ttyO2 -b 4800</p></blockquote><p id="dcb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将显示大量的<a class="ae kl" href="http://aprs.gids.nl/nmea/" rel="noopener ugc nofollow" target="_blank"> GPS NMEA语句</a>，但是出于地理定位的目的，您将只对GPRMC语句感兴趣。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mu"><img src="../Images/ee4da7318759b1e2f7b5c5781de5ce9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*30-2khXudpQaD0eZYK2Xiw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">丘帕卡布拉的GPS数据</figcaption></figure><p id="dab7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以通过复制一个GPRMC语句(例如<strong class="jp ir"> $GPRMC，170454.000，A，3500.87097，N，10641.14163，W，0.00，171.40，100520，，，A*79 </strong>)到这个<a class="ae kl" href="https://rl.se/gprmc" rel="noopener ugc nofollow" target="_blank">在线GPRMC工具</a>来解码地理定位语句，它会在地图上标出你的确切位置。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mv"><img src="../Images/c0c6d41aadfa8aa5f0324f621f0d5b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3FCnoI6kNy5ddLnNLudhYQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">GPS GPRMC地理位置标绘在地图上。与海森堡的鸡肉午餐</figcaption></figure><p id="edd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下Python脚本以编程方式检索GPS地理定位GPRMC数据:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mt ld l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">检索GPS地理位置坐标的Python代码</figcaption></figure><h1 id="2422" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">连接到蜂窝网络</h1><p id="ca90" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我使用全息数据计划与诺瓦HOL-诺瓦-R410蜂窝调制解调器，但任何其他运营商或与BeagleBone兼容的蜂窝调制解调器都可以正常工作。只要您能够使用蜂窝数据连接到互联网，一切都应该是好的。</p><p id="f15b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">全息图的一个好处是它们提供了Python SDK。使用数据计划激活SIM卡并安装SDK后，您可以使用这个Python脚本。它允许您通过手机以编程方式连接到互联网，并ping Google来检查连接性。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mt ld l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Python代码将全息蜂窝模式连接到互联网</figcaption></figure><p id="d073" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请参考Hackster.io上的<a class="ae kl" href="https://www.hackster.io/sacchet/chupacarbrah-car-hacking-with-beaglebone-and-python-18f137" rel="noopener ugc nofollow" target="_blank"> ChupaCarBrah教程</a>，了解如何安装全息调制解调器及其SDK的全部细节。</p><h1 id="ef92" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">泄露数据</h1><p id="cf03" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">首先，你需要一个服务器来接收数据。使用<a class="ae kl" href="https://github.com/blupants/chupacarbrah_server" rel="noopener ugc nofollow" target="_blank"> Github </a>上可用的Python<a class="ae kl" href="https://github.com/blupants/chupacarbrah_server/blob/master/chupacarbrah_server.py" rel="noopener ugc nofollow" target="_blank">chupacarbrah _ server . py</a>代码，并将其作为服务部署在AWS上。</p><p id="bdbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里是TL；DR命令这样做:</p><blockquote class="mk ml mm"><p id="ad1d" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">~ $ git clone<a class="ae kl" href="https://github.com/blupants/chupacarbrah_server.git" rel="noopener ugc nofollow" target="_blank">https://github.com/blupants/chupacarbrah_server.git</a><br/>~ $ CD chupacarbrah _ server<br/>~ $ CP chupacarbrah _ server . py application . py<br/>~ $ source virt/bin/activate<br/>(virt)~ $ pip install flask = = 1 . 0 . 2<br/>(virt)~ $ pip freeze&gt;requirements . txt<br/>(virt)~ $ deactivate<br/>~ $ python 3-m pip install AWS CLI<br/></p><p id="cb0a" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">是否要为您的实例设置SSH？(是/否):我选择一个密钥对。1)我的密钥对2) [创建新的密钥对]</p><p id="e0f3" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">~$ eb创建chupacarbrah-env <br/> ~$ eb打开</p></blockquote><p id="0b0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您还需要更多的详细说明，请再次参考Hackster.io上的<a class="ae kl" href="https://www.hackster.io/sacchet/chupacarbrah-car-hacking-with-beaglebone-and-python-18f137" rel="noopener ugc nofollow" target="_blank"> ChupaCarBrah教程</a>。</p><p id="1e42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务运行后，记下URL，这样您就可以将脚本指向BeagleBone，并将数据发送到那里。您可以通过用curl发布一些虚拟数据来确认您的服务已经启动并运行:</p><blockquote class="mk ml mm"><p id="bbaa" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated"><strong class="jp ir">SERVER _ URL =&lt;PUT _ YOUR _ AWS _ SERVICE _ URL _ HERE&gt;T4】</strong></p><p id="21c6" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">curl —标题“Content-Type:application/JSON”\<br/>—请求POST \ <br/> —数据“{ car _ uuid”:“51f 317 EC 266 E4 ADB 95621201 f 87 ba 52”，“VIN”:“2c 4”，“maker”:“Generic”，“log”:{“timestamp”:“202005011120000”，“GPS”:“00”}“\<br/>”$ SERVER _ URL/API/v1/cars”</p><p id="7cc8" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">curl "$SERVER_URL/api/v1/status "</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/3a25384b81951ded29b8b5c1297ca347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x6KVrKRB0IGaiJiMp7Nq4g.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">在AWS上从ChupaCarBrah服务发布和获取虚拟数据</figcaption></figure><p id="068a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦您确认AWS服务正常工作，ssh到BeagleBone并从<a class="ae kl" href="https://github.com/blupants/chupacarbrah" rel="noopener ugc nofollow" target="_blank"> Github </a>克隆chupacarbrah客户端repo。确保编辑<a class="ae kl" href="https://github.com/blupants/chupacarbrah/blob/master/chupacarbrah.py#L17" rel="noopener ugc nofollow" target="_blank"> chupacarbrah.py </a>脚本，并用上一步的AWS服务url设置<strong class="jp ir"> server_url </strong>变量。</p><blockquote class="mk ml mm"><p id="9fcc" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">git克隆<a class="ae kl" href="https://github.com/blupants/chupacarbrah.git" rel="noopener ugc nofollow" target="_blank">https://github.com/blupants/chupacarbrah.git</a><br/>CD chupacarbrah<br/>sudo pyt 3 chupacarbrah . py</p></blockquote><p id="13db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦运行，ChupaCarBrah客户端将消耗所有在<a class="ae kl" href="https://github.com/blupants/chupacarbrah/blob/master/simple.csv" rel="noopener ugc nofollow" target="_blank"> simple.csv </a>上启用的CAN命令，并将它们发送到CAN总线。响应将显示在stdout上，并发送到/tmp/chupacarbrah/日志文件。每隔1分钟，它也会作为JSON发送给AWS服务。</p><p id="e909" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要停止它，请打开一个新的终端(ssh会话)并运行:</p><blockquote class="mk ml mm"><p id="9932" class="jn jo mn jp b jq jr js jt ju jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj kk ij bi translated">sudo touch /tmp/stop</p></blockquote><p id="1557" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了启用/禁用更多的<a class="ae kl" href="https://en.wikipedia.org/wiki/OBD-II_PIDs" rel="noopener ugc nofollow" target="_blank"> OBDII PID命令</a>，您可以编辑文件<a class="ae kl" href="https://github.com/blupants/chupacarbrah/blob/master/obd2_std_PIDs_enabled.csv" rel="noopener ugc nofollow" target="_blank">OBD 2 _ STD _ PIDs _ enabled . CSV</a>通过将“启用”列上的1设置为您要启用的所有命令，将您要禁用的命令设置为零。在启用额外的命令之前，请确保您理解这些命令的作用，并知道您在做什么。simple.csv和obd2_std_PIDs_enabled.csv文件都可以在您刚刚克隆到BeagleBone的chupacarbrah github repo上找到。</p><p id="7c53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开web浏览器，监控JSON数据，该数据每分钟都在更新，包含来自车辆的所有渗出信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mx"><img src="../Images/e1d34099e73cac11f0b0430f3fcfd7fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B7nDjMIRIcFY8dlkbOVuNw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">AWS上ChupaCarBrah服务的JSON虚拟数据示例</figcaption></figure><p id="9751" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能需要刷新浏览器上的页面，以更新显示的数据。因为它使用JSON格式，所以创建前端来使用它和/或与其他应用程序集成非常方便。</p><p id="a7bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是什么？</p><p id="e987" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本系列的第一部分到此结束，共有3篇文章。请继续关注下一部分，我将介绍如何进入ECU CAN消息并为ChupaCarBrah添加更多功能。最终目标是在车辆中创建一个完整的后门，支持远程代码执行。</p></div></div>    
</body>
</html>