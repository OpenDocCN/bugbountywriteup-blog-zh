<html>
<head>
<title>Write-Up 11- Common Linux Privilege Escalation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">书面陈述11-常见的Linux权限提升</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/write-up-11-common-linux-privilege-escalation-92528853b616?source=collection_archive---------0-----------------------#2020-08-09">https://infosecwriteups.com/write-up-11-common-linux-privilege-escalation-92528853b616?source=collection_archive---------0-----------------------#2020-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="a4a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个初学者友好的演练基于TryHackMe平台房间"<a class="ae ko" href="https://tryhackme.com/room/commonlinuxprivesc" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">普通Linux权限提升</strong> </a>"</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/878e55acc93b4d650a822575f1fae2d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/0*i-_wdpP0hgBNg0lG.png"/></div></figure></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><p id="ef3f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我之前的<a class="ae ko" href="https://medium.com/bugbountywriteup/write-up-10-tryhackme-linux-challenges-74408715ece4" rel="noopener"> <strong class="js iu">文章</strong> </a>中，我们学习了一些Linux命令、Linux文件系统、文件权限、工具和服务。我们还利用了一台<a class="ae ko" href="https://medium.com/bugbountywriteup/write-up-09-tryhackme-kenobi-afc2dccd40a2" rel="noopener"> <strong class="js iu">易受攻击的Linux机器</strong> </a> <strong class="js iu"> </strong>使用了不同的涉及权限提升的技术。</p><h2 id="38ef" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">常见的Linux权限提升</h2><p id="f83e" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在本演练中，我们将深入探讨一些常见的Linux权限提升和技术，它们将在渗透测试或玩<a class="ae ko" href="https://medium.com/bugbountywriteup/write-up-03-tryhackme-simple-ctf-e02495e74def" rel="noopener"><strong class="js iu">【CTF】(捕捉旗帜)</strong> </a> <strong class="js iu"> </strong>挑战时派上用场。</p><h2 id="bf3b" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">先决条件</h2><p id="117c" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">虽然房间里有每个主题的详细解释，但预先的知识会让你更容易、更清楚地理解这些概念</p><ol class=""><li id="40c5" class="mc md it js b jt ju jx jy kb me kf mf kj mg kn mh mi mj mk bi translated">了解SSH，列出、复制和写入文件</li><li id="034d" class="mc md it js b jt ml jx mm kb mn kf mo kj mp kn mh mi mj mk bi translated">对Linux文件系统、文件权限等有基本的了解</li></ol><p id="390c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我会鼓励你们自己去探索挑战，自己去完成任务，如果你遇到了困难，可以参考这篇文章。即使你不能进入这个房间，这个演练也是学习Linux特权提升中使用的一些技术的好方法</p><h2 id="7952" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">【任务1】<a class="ae ko" href="https://medium.com/@anon_7/getting-started-with-tryhackme-52f2cc7eb9aa" rel="noopener">入门</a></h2><p id="b6d5" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">让我们从通过OpenVPN连接到THM的网络开始。根据终端上的接口tun0或tun1验证您的IP地址</p><h2 id="8b10" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">[任务2]了解权限提升</h2><p id="871e" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在我们着手解决任务之前，让我们了解什么是权限提升。它在系统级别上从较低的权限向较高的权限前进。通常，某些路径或文件的漏洞或权限会导致权限提升。权限提升允许执行某些命令，而如果用户权限较低，这些命令是不可能执行的。权限提升允许破解密码、绕过访问控制、更改配置等</p><p id="7232" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在即将到来的挑战中，我们将尝试使用不同的技术来提升我们的特权</p><p id="5266" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">【任务3】权限提升方向</strong></p><p id="9782" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有两种类型的权限提升<strong class="js iu">水平</strong>和<strong class="js iu">垂直。</strong>在<strong class="js iu">横向升级</strong>中，你从一个用户转移到另一个用户。在这种情况下，两个用户都是普通用户，而在<strong class="js iu">垂直</strong>方法中，我们将我们的权限从普通用户提升到<strong class="js iu">管理员</strong></p><h2 id="4aa8" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">[任务4]枚举</h2><p id="96ae" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">为了有效的枚举和节省时间，我们将讨论一个有用的工具。<a class="ae ko" href="https://www.linkedin.com/pulse/linenum-linux-enumeration-privilege-escalation-tool-prawez/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> LinEnum </strong> </a>是执行普通权限提升的脚本。你可以在这里  <strong class="js iu">得到这个<a class="ae ko" href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">剧本。</strong>有两种方法可以在目标机器上获得这个脚本。</a></strong></p><p id="67d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">方法一</strong></p><p id="0e00" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">只需从上面提供的链接中复制并粘贴原始脚本，并将其保存在您的目标机器上</p><p id="fec3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">方法二</strong></p><p id="2c65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行一个简单的<strong class="js iu"> python HTTP </strong>服务器，将文件从本地机器传输到目标机器。在你的目标机器上使用<strong class="js iu"> wget </strong>从本地机器获取文件，如下图所示</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/f869900c9a5b6cbe0c95af073ecae980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*a2h3iGKbIar6suoyO87VUw.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">在本地机器上运行简单的HTTP服务器</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mz"><img src="../Images/59d4ed1f1ee784730f26c654cd8d03ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q7IC9Diw8sTpzbsKwhNosA.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">使用wget将所需文件从本地机器提取到目标机器</figcaption></figure><p id="3e93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> LinEnum </strong>输出重要信息，如内核信息、SUID信息、读/写敏感文件和crontab信息。一旦运行该工具来提取特定信息，您将会对它有更多的了解。</p><p id="884b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们使用凭证<strong class="js iu">user 3:password</strong>ssh到目标机器，如下所示</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi na"><img src="../Images/17e3b64e6a3b80ac369aeb4836bb9839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*838_lqiuqifLCVIB0XcyNA.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">通过User3到目标机器</figcaption></figure><p id="1b67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要找出我们刚刚登录的机器的主机名。使用命令<strong class="js iu">主机名</strong>了解机器的名称</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/b91bc7ffe36f90abde75fa1a7034506b.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*N-x_SYXKXOxyQwNvyyT1gg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">主机名</figcaption></figure><p id="6e99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们需要找出系统中有多少用户[x]。我们可以通过检查我们的etc/passwd文件来发现这一点，该文件包含当前系统上所有可用用户密码的散列。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/18948c1fcad308f3c4c18677a28cca6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*fH6I1t2O0fhYvx8Z7KK1aA.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">当前可用用户[x]</figcaption></figure><p id="1a30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要知道当前的shell数量，导航到，<strong class="js iu">etc/shell</strong>路径，并使用如下所示的<strong class="js iu"> cat </strong>命令输出内容</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/5b8f4d13496db723bbd3eb066147bacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*n-LoZK1pcyS2up73h7oEPA.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">etc/shell中可用的shell</figcaption></figure><p id="d521" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们在crontab中找出计划每5分钟运行一次的bash脚本。为此，我们需要在/etc/crontab路径下输出文件。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ne"><img src="../Images/88c7305bde2b8e030526b159fca6f90a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6k-Nobi_-WWlEnZN5rj7_A.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">crontab文件中存在的CronJobs</figcaption></figure><p id="e491" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您运行了<strong class="js iu"> LinEnum </strong>，您可能会发现哪些关键文件的权限发生了变化，因为哪些用户可能会对其拥有权限。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/64a2a0b4b6120b9d3be57db5c4310dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*eZpa5TEda1Vupn3fjogyvQ.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">其读/写权限被更改的关键文件</figcaption></figure><p id="58b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">至此，我们结束了我们的<strong class="js iu">任务4。</strong>记住列举的结果，因为我们接下来的任务将会用到这些信息</p><h2 id="bcb8" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">[任务5]滥用SUID/GUID文件</h2><p id="52e6" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">提升我们特权的另一种方式是滥用SUID/GUID文件。这些是授予用户执行特定命令或执行特定管理级别配置/操作的特殊权限。该权限可能会被利用，并导致权限的纵向提升。文件有一定权限，如读(r)、写(w)和执行(x)。SUID由文件旁边的符号表示，该符号表示授予了用户特殊权限。您可以在房间中了解有关SUID/GUID权限的更多信息</p><p id="9618" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要知道<strong class="js iu">用户3 </strong>目录中拥有这种权限的文件。使用以下命令实现目标</p><blockquote class="ng nh ni"><p id="07b5" class="jq jr nj js b jt ju jv jw jx jy jz ka nk kc kd ke nl kg kh ki nm kk kl km kn im bi translated"><strong class="js iu">find/-perm-u = s-type F2&gt;2&gt;/dev/null</strong></p></blockquote><p id="e5dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面我们来分析一下这个命令</p><p id="846a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">查找</strong> —用于查找文件</p><p id="19bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> / — </strong>将搜索整个文件系统</p><p id="be15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> -perm </strong> —根据权限进行搜索</p><p id="f62e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> -u=s </strong> —设置文件的权限模式</p><p id="6fac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">-键入f</strong>-将仅搜索文件</p><p id="a013" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> 2 &gt; /dev/null — </strong>将忽略错误</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/73188062c299f0e6ff595f67e93cbd88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*-J5TZ533kjHZN_wIB8VupQ.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">查找设置了SUID位的文件</figcaption></figure><p id="c2a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要执行在上一步中设置了SUID位的文件。让我们执行以获得root访问权限，如下所示</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi no"><img src="../Images/d3c2336dc95d34b93bb8324298162be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*QRUzy2BaovSDBvhZWBP4bA.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">获得Root访问权限</figcaption></figure><p id="8839" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的任务5 到此结束</p><h2 id="e1d0" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">[任务6]利用可写/etc/passwd</h2><p id="bf88" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">使用<strong class="js iu"> LinEnum </strong>我们发现<strong class="js iu"> user7 </strong>拥有对/etc/passwd文件的可写权限，这意味着用户可以对文件进行更改。passwd文件包含在系统上创建的用户的密码哈希。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi no"><img src="../Images/3352a1ec3dc6c524840d9788bcfb38d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*RPLbREzv08jSuIZ_qZfoBg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">用户7拥有对etc/passwd的写权限</figcaption></figure><p id="48e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">etc/passwd包含如下所示的内容</p><blockquote class="ng nh ni"><p id="246e" class="jq jr nj js b jt ju jv jw jx jy jz ka nk kc kd ke nl kg kh ki nm kk kl km kn im bi translated"><strong class="js iu">用户:x:0:0:root:/root:/bin/bash </strong></p></blockquote><p id="427c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所有字段由一个<strong class="js iu">冒号(；)</strong>。第三个字段指示用户ID。这里<strong class="js iu"> 0 </strong>表示<strong class="js iu">根用户</strong>。</p><p id="ef2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们需要使用密码“<strong class="js iu">密码</strong>”切换到<strong class="js iu">用户7 </strong></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi np"><img src="../Images/97d23c9049792493002d3b132e674079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*_gzd8jUVOIdJoIfv-LhdUQ.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">SSH用户7</figcaption></figure><p id="ee4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们正在执行的上报类型是纵向的，因为一个普通用户被用来获得根用户访问权限。</p><p id="20fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要添加一个新用户，并给它root访问权限。为此，我们需要为创建的密码生成一个散列，以便它满足密码要求。为了创建散列，我们将使用OpenSSL库，它有广泛的用途，包括创建散列。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/f3c26299f2a6f830a6afea9908ce26e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*SLjb5yNyNjk11ac6g8FCSQ.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">哈希创建</figcaption></figure><p id="2d14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用刚刚在<strong class="js iu"> etc/passwd </strong>文件末尾创建的散列添加一个新用户。我们可以看到一个名为“<strong class="js iu"> new </strong>的用户是用root权限创建的</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/5029e9422a8892316a413fdf1d463204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*wdukWLRLemT1M1wwI0hKHg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">新用户创建</figcaption></figure><p id="85c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们使用之前设置的密码切换到我们的<strong class="js iu">新</strong>用户。当我们切换到新用户时，我们会得到超级用户的提示，如下所示</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/daafaf9f26efdc33f6bb44b7399bd80c.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*fM88eOs8EPhdSNt23SlHRw.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">SSH新用户</figcaption></figure><p id="de95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的<strong class="js iu">任务6 </strong>到此结束。</p><h2 id="7cc1" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">[任务7]转义Vi编辑器</h2><p id="b696" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">要检查当前用户可以执行哪些命令，我们可以使用命令<strong class="js iu"> sudo -l来</strong>了解这一点。我们也可以通过LinEnum找到它，如下所示</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ns"><img src="../Images/323a726e05eb8237138b07889fe1cc6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t6dKjOTgkbGJiahD_IAIxA.png"/></div></div></figure><p id="6e94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们首先切换到用户8，如下所示</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/c9d0b808c38958acc66381b5e2d0f5a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*pecRhAzGdmINJljxmr2tsg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">SSH到用户8</figcaption></figure><p id="817d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了user8的SSH，让我们看看user8可以执行哪些命令。我们知道user8可以使用root权限执行vi编辑器。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nu"><img src="../Images/a8d06d8bbee0eaf61c24631ad276a578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jf6B5YCRo4TDn70onEwASg.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">User8执行vi编辑器的权限</figcaption></figure><p id="13c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要做的就是运行vi编辑器，并在编辑器中输入以下命令来获得root访问权限。</p><blockquote class="ng nh ni"><p id="58f2" class="jq jr nj js b jt ju jv jw jx jy jz ka nk kc kd ke nl kg kh ki nm kk kl km kn im bi translated"><strong class="js iu">:！sh </strong></p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/1f0cd320f9b6a7da05b814ba0548b293.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*ZwDCaE7XB7j2Wo_TDSgtJw.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">根访问</figcaption></figure><h2 id="a055" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">[任务8]利用Crontab</h2><p id="da39" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在这个挑战中，我们尝试使用cronjob提升我们的权限。Cronjobs是系统管理员使用的自动化脚本。Cronjobs在用户指定的时间和日期执行命令。</p><p id="9fe9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要将用户切换到用户4</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/fc5a417b02b6e0549ec62bcbc9f35a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*39dhDQGU1ZRcqlX-5s_9sw.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">SSH到用户4</figcaption></figure><p id="250c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如前所述，我们在crontab中有一个cronjob，它每5分钟运行一次。如果我们有一个可以成为cronjob的一部分的有效负载，并且当它执行时，我们将有一个根shell，那会怎么样呢？</p><p id="f84c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于POC，我们需要使用<strong class="js iu"> msfvenom制作一个有效载荷。-p </strong>标志用于有效载荷，即一个<strong class="js iu">反向netcat shell </strong>，带有我们的<strong class="js iu">本地主机IP </strong>和<strong class="js iu">端口8888 </strong></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nx"><img src="../Images/7701d175055660a6b175dc110e881f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cX_8j90euDkkVPygC9y7NQ.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">使用msfvenom创建有效负载</figcaption></figure><p id="4bf8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">导航到<strong class="js iu">自动脚本</strong>所在的目录。我们需要复制我们刚刚使用msfvenom创建的有效载荷</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ny"><img src="../Images/1ebce7e6a9b91da003102d9664df6630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uvziPhr5MapZrlwVpLQweg.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">autoscript.sh目录</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nz"><img src="../Images/c42afc7d9df04a994e876cdf47f7e9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJqwyzWsYecNlwM3Amiq0g.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">将有效负载复制到autoscript.sh脚本中</figcaption></figure><p id="0cb8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦完成，使用<strong class="js iu"> nc -lvp 8888 </strong>监听进入的连接。我们得等5分钟让克隆人工作。五分钟过去后，我们得到了一个反向的外壳。请注意，我们得到了如下所示的根外壳</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oa"><img src="../Images/5796c6c0c6c70613904ce71b4c42a612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0V4p5CFw3z-jEo8Wv4qxnA.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">反向根壳</figcaption></figure><h2 id="de2d" class="le lf it bd lg lh li dn lj lk ll dp lm kb ln lo lp kf lq lr ls kj lt lu lv lw bi translated">[任务9]利用路径变量</h2><p id="d4fc" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在我们的最后一个任务中，我们将利用<strong class="js iu"> PATH </strong>变量来获得对目标机器的根访问。PATH是一个包含可执行文件的环境变量。</p><p id="1386" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将编辑我们选择的路径变量，并指示它运行特定的命令。为此，我们需要切换到user5并运行脚本命令。一旦我们运行这个命令，我们就会知道脚本列出了当前目录中的所有文档，这与命令<strong class="js iu"> ls是一样的。</strong></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ob"><img src="../Images/61b827927bc708de377604e673fb98b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LwTeE0IoVmV12u-Ovyi1Hw.png"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">执行脚本</figcaption></figure><p id="5632" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们切换到tmp目录，创建一个在ls命令执行时运行的可执行文件。如下所示，我们制作了一个bash可执行外壳，并赋予了它可执行的权限</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/12980eaf8853596737f39b7316a35bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*OOFq_5sBBnAww0N4KGcW9g.png"/></div></figure><p id="d9cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们需要改变路径变量，如下所示。只要我们运行ls命令，它就会将我们带到根shell。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi od"><img src="../Images/fb7c399753c68c7b095548186c60d473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*0LnDyY8ZnK3UggsbzPwZZQ.png"/></div></figure><p id="9d6b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">至此，我们的最终任务结束。我注意到，在与Linux机器交互时，有许多方法可以提升您的权限。上面已经解释的方法/技术通常用于权限提升。</p><p id="ec0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这篇文章。请记住练习您在本演练中学到的工具和技术，以巩固您的知识。直到那时快乐的黑客；)</p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><h1 id="a227" class="oe lf it bd lg of og oh lj oi oj ok lm ol om on lp oo op oq ls or os ot lv ou bi translated">关于我</h1><p id="ede1" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">我是一名网络安全爱好者，正在攻读信息安全硕士学位，并试图进入全职网络安全职业生涯。你可以点击这里阅读更多的文章和演练<a class="ae ko" href="https://medium.com/@anon_7" rel="noopener"/></p></div></div>    
</body>
</html>