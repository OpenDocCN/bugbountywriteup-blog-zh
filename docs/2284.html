<html>
<head>
<title>Account takeover worth $1000</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">价值1000美元的帐户接管</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/account-takeover-worth-1000-611452063cf?source=collection_archive---------0-----------------------#2022-08-19">https://infosecwriteups.com/account-takeover-worth-1000-611452063cf?source=collection_archive---------0-----------------------#2022-08-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/94cd37ee43d4b4c0766b0ec4f2953733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aD3vGKi64LRcyyxB5pzeTA.jpeg"/></div></div></figure><h1 id="30ea" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><blockquote class="kw kx ky"><p id="a511" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="iq">大家好，我是Faique，一名来自印度的bug赏金猎人，欢迎大家阅读我写的关于我如何在一个最大的组织中使用错误配置的2FA和OAuth获得帐户接管的文章。</em></p></blockquote><p id="5ec9" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">我不能透露目标，因为这是私人邀请。在进入漏洞之前，我想让你先了解一切是如何工作的，尤其是身份验证。这将有助于你更清楚地了解漏洞。登录网站有多种方式，但可以分为两种，第一种是使用普通的电子邮件和密码，另一种是使用OAuth，包括Google、GitHub和…</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/d1cb669bd2097a2c5b6f77954d15b27e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gDlUrd38cBFQ8LAmnhJVFQ.png"/></div></div></figure><p id="038a" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">该网站的一个安全特性是2FA，它在这个bug中发挥了重要作用。客户可以使用它来增加额外的安全层。现在让我们来看看程序和bug。</p><p id="5e47" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">我开始了基本的侦察，但没有发现任何东西。所以我转向认证测试，创建了一个帐户，并测试了重复注册，忘记密码错误，SQL注入等等。然后我启用了2FA并强行破解了2FA代码。我尝试了电子邮件、密码登录和Oauth登录，但都没有成功:(</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/0f152cd6afd9463dcfaada5d895423f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*loD8TJyvcrN6e2f3o6VWCg.png"/></div></div></figure><p id="ea57" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">第二天，我在google oauth帐户上启用了2FA，拦截了每一个请求，并像网站向服务器发送2FA代码一样，将juicy发送到中继器。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/e38270da58bd27fa55ec903cb7f022ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcGcrzw-IkbazZciS5KgQw.png"/></div></div></figure><p id="3a45" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">我测试了更多的2FA错误，然后受够了，停止了帐户上的2FA，与此同时，在我去我所有的中继器请求后，我再次发现了上述请求，再次发送，并收到了一个JWT令牌，我想为什么不用一些随机代码如000000来更改验证器代码，并再次发送请求，猜猜我收到了什么JWT令牌</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/ee7829f46b192f9d8c4dccb218208503.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3MgCr_uo7OUdB4rfXQnuA.png"/></div></div></figure><p id="c6c6" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">即使在禁用了账户的2FA之后，我还是能够通过这个请求获得一个JWT代码。这个JWT令牌基本上是用来验证用户身份的cookie。为了确认这确实是一个漏洞，我等了一天，然后再次发送请求，是的，我收到了JWT令牌。那一刻我太激动了。</p><p id="9608" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">我只是需要一种方法来直接登录到被黑的帐户。所以我开始浏览登录的网站，我看到有一个为oauth帐户设置密码的功能，这样任何人都可以使用电子邮件和密码登录。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/c791a537da9dbe66f94c51d9cd47ad5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eZKrGhgyRoEV-XO0Iq3fcA.png"/></div></div></figure><p id="c6b4" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">我使用设置密码请求，并将JWT令牌替换为我收到并发送的令牌。密码被添加了。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/99f283c4b2766ed0e49e8017967308fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FpzJUwOZhnhtlYMHbaYpw.png"/></div></div></figure><p id="6893" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">我现在可以使用电子邮件和密码直接登录，绕过oauth。这个bug不仅影响google oauth登录，还影响所有网站使用的oauth提供者:GitHub、微软、Bitbucket、Azure active directory</p><p id="7fd0" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated"><strong class="lc ir">注意</strong>:只有当用户在其账户上启用然后禁用了2FA时，才可能出现该错误</p><blockquote class="kw kx ky"><p id="969e" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><strong class="lc ir"> <em class="iq">冲击:</em> </strong></p><p id="2d98" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="iq">一旦攻击者获得账户</em></p><p id="ce12" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="iq"> 1。攻击者可以看到并编辑API密钥等机密信息</em></p><p id="adde" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="iq"> 2。编辑组织&amp;产品名称</em></p><p id="d41a" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="iq"> 3。邀请成员加入帐户</em></p><p id="9261" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="iq"> 4。从组织中删除用户</em></p><p id="0768" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="iq"> 5。给账户添加密码</em></p><p id="7f0e" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="iq"> 6。删除账户</em></p></blockquote><p id="7b4d" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated">向站点报告了错误</p><blockquote class="kw kx ky"><p id="3b9f" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><strong class="lc ir"> <em class="iq">时间轴</em> </strong></p><p id="5076" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">8月1日00:09:<em class="iq">报告了bug </em></p><p id="a583" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">8月1日02:20:<em class="iq">第一次被拒绝，因为他们认为这是假阳性</em></p><p id="8927" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">8月1日03:00:<em class="iq">接受并请求耐心</em></p><p id="7274" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">8月5日01:20:<em class="iq">将该漏洞标记为高业务关键安全问题，并给我1000美元</em></p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/9878614effd86dfc131f329ef5f44e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mS659Kf5nx1ZU_NVfTMfaQ.jpeg"/></div></div></figure></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h2 id="b956" class="mt jz iq bd ka mu mv dn ke mw mx dp ki ly my mz km lz na nb kq ma nc nd ku ne bi translated">谢谢你读到这里，我希望你喜欢并从中学习到新的东西。如果你有任何疑问，请随时给我发短信</h2><h2 id="aee0" class="mt jz iq bd ka mu mv dn ke mw mx dp ki ly my mz km lz na nb kq ma nc nd ku ne bi translated"><em class="nf">跟着我上</em></h2><h2 id="9feb" class="mt jz iq bd ka mu mv dn ke mw mx dp ki ly my mz km lz na nb kq ma nc nd ku ne bi translated"><em class="nf">推特:</em><a class="ae ng" href="https://twitter.com/imfaiqu3" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://twitter.com/imfaiqu3</em></a></h2><h2 id="81c4" class="mt jz iq bd ka mu mv dn ke mw mx dp ki ly my mz km lz na nb kq ma nc nd ku ne bi translated"><em class="nf">insta gram:</em><a class="ae ng" href="https://www.instagram.com/faique.exe" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/faique.exe</a></h2><h2 id="6084" class="mt jz iq bd ka mu mv dn ke mw mx dp ki ly my mz km lz na nb kq ma nc nd ku ne bi translated"><em class="nf">领英:</em><a class="ae ng" href="https://www.linkedin.com/in/faiqu3/" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://www.linkedin.com/in/faiqu3/</em></a></h2></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="b018" class="pw-post-body-paragraph kz la iq lc b ld le lf lg lh li lj lk ly lm ln lo lz lq lr ls ma lu lv lw lx ij bi translated"><em class="lb">来自Infosec的报道:Infosec上每天都有很多事情发生，很难跟上。</em> <a class="ae ng" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ir"> <em class="lb">加入我们的每周简讯</em> </strong> </a> <em class="lb">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>