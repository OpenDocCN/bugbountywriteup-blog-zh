<html>
<head>
<title>Multiple bugs in one program leads to €1500</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个程序中的多个错误导致€1500</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/multiple-bugs-in-one-program-leads-to-1500-c35fcde06bc7?source=collection_archive---------1-----------------------#2022-08-02">https://infosecwriteups.com/multiple-bugs-in-one-program-leads-to-1500-c35fcde06bc7?source=collection_archive---------1-----------------------#2022-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4f47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，今天我要谈谈我在同一个程序中发现的三个基本漏洞，我获得了1500€的奖励。</p><p id="c6c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为这三种方法都是相似的，所以将漏洞联系在一起是非常容易的。让我们称之为编辑，因为该公司运行一个私人的错误赏金计划。所以让我们开始吧。</p><blockquote class="kl km kn"><p id="b901" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><strong class="jp ir">一、参数变更&amp; HTTP响应操纵导致客户端管理员PII泄露</strong></p></blockquote><p id="dba1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在编校的应用程序中，用户不能访问客户端的“访问”面板，因为他们没有授权。“访问”按钮包含客户端用户的信息，并允许我们查看哪些用户被授权或未被授权。</p><p id="b029" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们无权访问的客户端实例。只有“属性”选项出现，但我们不能点击它，我们不能访问任何按钮。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/b22bd4f8dd9cbca7baf00cbea7be95b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u_vRKA6X07v9YFw6H6vbiw.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">无访问客户端示例。</figcaption></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi li"><img src="../Images/2ddc38310965d9a96759f947c0ebf0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-JJ0ZLr9kGrVGzRS3tY-6Q.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">完全访问客户端示例。</figcaption></figure><p id="4cec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将能够通过更改参数和使用HTTP响应来访问不可访问的客户端的“访问”按钮。这将向我们显示哪些用户拥有什么权限。此外，它将披露用户的PII信息，如电子邮件，公司，角色。</p><p id="9898" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我进入列出客户的部分，在搜索按钮中输入一个随机的字母。我抓住了请求，面临以下情况。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lj"><img src="../Images/4d7cca1cfc680bf169322dd016383c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qJLvXw5PaP50SaRkOo1DeA.png"/></div></div></figure><p id="149a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">整个请求包含要列出的所有客户端的信息。我查了第一个客户。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lk"><img src="../Images/bbfa723970ce7ae2aec78b22311c443c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eo3SkdmxTu3y6CDddcRPwQ.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">第一个客户的数据</figcaption></figure><p id="c51b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个部分中，两个参数“CurrentLogOnAccesType”:None和“CanControlClientAcces”:false引起了我的注意。我想到了像在其他完全访问客户端示例中看到的那样编辑参数。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ll"><img src="../Images/002476496cb1fc29514af47bdc721fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qTb64gA7qjjO15-b9IZMhA.png"/></div></div></figure><p id="38cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我把参数分别改成了“满”和“真”。同样的信息可用于对请求的响应，我做了同样的事情。我发了请求。</p><p id="8f80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">后来，当我回到页面时，我看到目标客户端已经更改为“完全访问”。“访问”按钮处于活动状态，当我单击它时，我可以看到所有用户的权限。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/611d1930deac3d0fc7cccc2cd3605f92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*GBGuWdf5GdOJhjaOTxprkw.png"/></div></figure><p id="aef5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">后来，由于用户信息在Access部分被返回，我在单击Access按钮时再次捕捉到请求，并查看了请求的响应。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ln"><img src="../Images/769f715a44380c7dd78d4313d93ee421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1iffFU09HJaqJGxJernySw.png"/></div></div></figure><p id="1314" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，攻击者可以激活客户端想要的“访问”功能，尽管没有授权，并且可以看到所有用户的授权。它还可以泄露用户的PII信息，包括管理员和授权用户。</p><blockquote class="kl km kn"><p id="470d" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><strong class="jp ir">二世。“/api/Missions？ClientId= "请求导致泄露没有访问客户端的任务</strong></p></blockquote><p id="0691" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在“Client”部分列出客户端时，我们无法单击“No Access”客户端。在正常情况下，单击具有完全或只读权限的客户端后，我们会被定向到“任务”部分。因此，我们看不到任务和其他信息，因为我们无法点击禁止访问客户端。<br/>但是，我发现了一个请求，它将允许我们访问不允许访问的客户的任务和其他信息。漏洞基本上是IDOR。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/76123ff90703c08ba8203e2660f0b386.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*hcm8MwB80Z6HnxbS72E0dg.png"/></div></figure><p id="9110" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在查看完全访问客户端的任务时，设置按钮引起了我的注意。我逐一查看了备选方案，并在“从约定复制”部分找到了漏洞。我点击了按钮，捕捉到了请求。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lp"><img src="../Images/03689e6a3d1ecbc78eb9d822aa137d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Um7HvZtTmUDVBtlyRtvHEg.png"/></div></div></figure><p id="a2c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到ClientID参数后，我将请求发送到中继器，并开始查找No Access客户机的ID信息。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lq"><img src="../Images/05cb4e3335e91841452067507cce1b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DtYkKf_CO9Z8-ObA2othUg.png"/></div></div></figure><p id="f020" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我转到第一份报告中列出的客户端部分，打开了DevTools。我可以看到那里客户的身份证。</p><p id="e1f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我回到Repeater，用目标ID替换我复制的GUID信息。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/8d77e8f660f66822fb8e079e96668459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*WV5PTiAh_x68JyI1K5W4QA.png"/></div></figure><p id="c74d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为回应，我看到了任务名称和信息，客户日期(此信息无法访问，因为没有访问权限)。<br/>请求直接公开任务信息。我们可以将No Access客户端读为只读。</p><blockquote class="kl km kn"><p id="a40e" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><strong class="jp ir">三。攻击者可以给没有权限的客户端添加任务</strong></p></blockquote><p id="15d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我找到了一种方法来添加随机或有针对性的任务给客户端，即使我在编校的应用程序上没有访问权限(没有访问客户端)。</p><p id="0050" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，当我们想在任务部分创建一个新的任务时，我们只能选择某些客户端。这些客户端只是我们拥有完全访问权限的客户端。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/203caeceaeb5a2c2e5f03a3d11a72466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*Kc-NIeJ9xHPn3wlJwWoTqA.png"/></div></figure><p id="0a92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，我们只能选择完全访问权限的客户端。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/98119c965352ebfe3b0551865566d9ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SANzlFieA2qpsvdRjmjHsw.png"/></div></div></figure><p id="19df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二步，我做了与上面报告中id复制过程相同的操作。我复制了一个不准入客户的ID。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lu"><img src="../Images/203ee804239a9e1aa11e9819308e3267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iaMS0bnbrJzqJ4hvNoWVvA.png"/></div></div></figure><p id="a440" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后回到第一集。我创建了一个新的客户端并保存了请求。我用复制的GUID替换了“ClientId”参数。即使您没有Name参数，也可以更改它。这意味着攻击者也可以添加他们没有的随机任务名称。</p><p id="f1bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常我们看不到任务，因为我们无法访问目标客户端。但是使用第二次报告中的请求(/api/Missions？ClientId=)我确定我的请求是否成功。</p><p id="fd00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，这里存在一个漏洞，使得攻击者能够将任务随机插入目标客户端。此外，如您所见，攻击者可以在第二个报告中看到他们使用请求发送的任务。</p><p id="7eaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前就这些。感谢阅读。下次再见了！</p><p id="6945" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在推特上关注我:<a class="ae lv" href="https://twitter.com/canmustdie" rel="noopener ugc nofollow" target="_blank">https://twitter.com/canmustdie</a></p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><p id="fc7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。 <a class="ae lv" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ko">加入我们的每周简讯</em> </strong> </a> <em class="ko">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>