<html>
<head>
<title>Bypassing Amazon WAF to pop an alert()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绕过Amazon WAF弹出警报()</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bypassing-amazon-waf-to-pop-an-alert-4646ce35554e?source=collection_archive---------0-----------------------#2022-08-29">https://infosecwriteups.com/bypassing-amazon-waf-to-pop-an-alert-4646ce35554e?source=collection_archive---------0-----------------------#2022-08-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/64b4e17fadc0652cb9d234c112dee101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*skG2p9oUdIrz1Bn7WkWzSw.jpeg"/></div></div></figure><p id="383f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嘿，各位，我已经有一段时间没有发表任何东西了。这一次，我将分享我是如何绕过亚马逊WAF让XSS上目标的。如果你对bugbounty感兴趣，这将有助于你建立一种思维模式来创建可以绕过WAFs的有效载荷。否则，这将是一本好书。我保证！</p><p id="fb44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">未知的是，WAF (Web应用程序防火墙)是一种防火墙，用于保护Web应用程序免受常见攻击，如SQL注入、跨站脚本(XSS)等。，通过过滤掉恶意流量。</p><h1 id="73ce" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">发现</h1><p id="74a8" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在内容发现阶段，我试图收集尽可能多的端点。在启用被动扫描扩展的情况下，始终在后台使用Burpsuite代理执行此操作。在花了大量时间之后，我分析了Burpsuite为手动检查端点而生成的站点地图。目标网站本身的功能非常有限，因此，我找不到任何有用的东西。转到robots.txt文件，我看到了一个不允许的端点，即<code class="fe lz ma mb mc b">/index.aspx .</code>这有点奇怪，因为网站是在wordpress上运行的，而带有<code class="fe lz ma mb mc b">.aspx</code>端点的页面是你在Wordpress网站上看不到的。</p><p id="c42c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">页面本身是空白的，但在检查源代码时，我看到了一些HTML和javascript。这让我想知道这个页面的目的是什么。我觉得这个难题缺少了点什么。然后我想起来我可以做一些参数发现。阿琼(<a class="ae md" href="https://github.com/s0md3v/Arjun" rel="noopener ugc nofollow" target="_blank">https://github.com/s0md3v/Arjun</a>)是实现这一目的的绝佳工具。它可以用最少的服务器请求查询大量的参数名称。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/b02dd5b94ce8d92a40140252f6713b5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*FaWsO8AUOSWYy0bBAteXiA.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">使用arjun发现参数</figcaption></figure><p id="628d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这三个参数中，参数<code class="fe lz ma mb mc b">acc</code>反映在网页上的一个<code class="fe lz ma mb mc b">&lt;script&gt;</code>标签中。javascript看起来像这样:</p><pre class="mf mg mh mi gt mn mc mo mp aw mq bi"><span id="cec7" class="mr kx iq mc b gy ms mt l mu mv">xt_multc ='&amp;x1=0&amp;x2=REFLECTION_POINT';</span></pre><p id="fbb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lz ma mb mc b">REFLECTION_POINT</code>是指反映我们参数值的区域。我需要对单引号进行转义，以便能够将javascript注入页面。</p><p id="24ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我用这个参数在页面上快速运行了<code class="fe lz ma mb mc b">kxss</code>,以识别未被清理/编码的特殊字符，并按原样反映出来。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/0bf2b0a7562dc473953afe413018b819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2SJgjkPrYVCFaKzTO6Oe3Q.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">kxss是识别参数中未过滤字符的好工具</figcaption></figure><p id="c961" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以看到，有大量的特殊字符没有被过滤掉，其中，单引号字符也是其中之一。这是个好消息，因为我们现在离目标更近了一步。</p><p id="4836" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一点上，我尝试了一个简单的有效载荷，如<code class="fe lz ma mb mc b">';alert(document.domain);//</code>。晶片启动了，尝试失败了。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/804c1438ee21d8a1e0c8aaf9ef54ecc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjkWmpeDoD_pUHJ05CERzw.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">封锁☠️</figcaption></figure><h1 id="3dcd" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">绕过晶圆</h1><p id="4e56" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在玩了不同的有效载荷后，我得出了一个结论，包含有效javascript函数名如<code class="fe lz ma mb mc b">alert(</code>(是的，如果alert后有一个开括号，就会被屏蔽。没有开括号，不会被阻塞)都被阻塞。我试图通过在警告和左括号之间插入一个注释来绕过它，但同样被阻塞了。</p><p id="0e82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我试着用Burpsuite Intruder模糊基于这个上下文(Javascript字符串中的反射)的有效负载，但结果是没有结果。</p><p id="8b4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用除了<code class="fe lz ma mb mc b">alert()</code>以外的函数Fuzzing，我看到有些函数比如<code class="fe lz ma mb mc b">fetch()</code>和<code class="fe lz ma mb mc b">print()</code>是允许的。虽然，我本可以在我的报告中使用这些来演示概念验证，但我把击败WAF和执行<code class="fe lz ma mb mc b">alert()</code>功能作为一个挑战。</p><p id="093c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不用写<code class="fe lz ma mb mc b">alert(document.domain)</code>，我们可以用<code class="fe lz ma mb mc b">window</code>对象调用<code class="fe lz ma mb mc b">alert </code>函数:<code class="fe lz ma mb mc b">window["alert"](document.domain)</code>。</p><p id="776c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可惜这个有效载荷也被屏蔽了。然后我想起我可以在有效负载之间使用Javascript中的多行注释语法来欺骗WAF，WAF通常基于一组规则和正则表达式运行。</p><p id="323f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后的有效载荷是<code class="fe lz ma mb mc b">';window/*aabb*/['al'%2b'ert'](document./*aabb*/location);//</code>。我将“alert”字符串拆分为“al”和“ert”两部分，然后添加它们。加号需要进行URL编码；否则，它将被解释为空格符号。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/52e92c38b68227b87b4371faae887492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qr6Ztfr7cQO-cui1XYntWA.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">终于发出警报了！</figcaption></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="7486" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢读这篇文章，请考虑跟随并鼓掌。在接下来的几天里，我会带来更多这样的内容。感谢您的阅读，我们后会有期:)</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="1455" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ng">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae md" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="ng">加入我们的每周简讯</em> </strong> </a> <em class="ng">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>