<html>
<head>
<title>When Previewing Becomes Dangerous</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当预览变得危险时</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/when-previewing-becomes-dangerous-bf852558e249?source=collection_archive---------0-----------------------#2019-01-15">https://infosecwriteups.com/when-previewing-becomes-dangerous-bf852558e249?source=collection_archive---------0-----------------------#2019-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b4e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:以下文章发表于2015年11月29日https://FogMarks.com</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/0efc3fe53accb89c59903687fd0761fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*Tk37eRnwHwtXFs8y.jpg"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">鸣谢:谷歌照片</figcaption></figure><p id="61c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi ky translated"><span class="l kz la lb bm lc ld le lf lg di"> P </span> <br/>温习淡然。许多网站和服务提供“发布前预览”或“购买前预览”选项。但是有时候预览变成了一件肮脏的事情。就像你将要听到的这个案例一样。</p><h1 id="2715" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">特征拉伸</h1><p id="5234" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">在你通过网络(或通过电子邮件)向其他用户发送发票请求之前，Blinksale.com提供“发票预览”功能。你在一个简单的小文本框中输入发票信息。当消息被发送时，HTML和Javascript代码被禁止和转义。<br/>在发送发票之前，您可以预览将要发送给客户的信息。点击预览按钮打开一个弹出窗口，显示发票的一个例子。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/e55e2f532924b75f3e698213fdb6f2da.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/0*oT6e0K2A3flfmLs1"/></div></figure><p id="140e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我点击“preview”时，我注意到我插入的“Enter”字符被翻译成GET message body参数(在URL中)上的“<br/>”文本。我把输入改成 <svg onload="alert(document.domain)"> </svg>没用。那是我开始思考的阶段。</p><h1 id="9740" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">有趣的部分</h1><p id="dbfd" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">我决定分析请求中的每个GET参数，并注意到其中一个参数引用了一个模板id。<br/>模板id用一个漂亮的css和一些图片包装消息。它改变输入的背景色、前景色和<strong class="jp ir">字体。然后我想:“嗯，模板决定了输入的字体。也许它也读取输入，并且<strong class="jp ir">上有XSS滤波器？。</strong></strong></p><p id="b52a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想知道:如果模板id是一个不存在的模板怎么办？我把id改成一个随机数，再次输入XSS的有效载荷，然后<strong class="jp ir">砰！成功了。</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/20bfb006be5eeb0a7c928ae1d5edf828.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*Iw57x-EGePJCBMZt.png"/></div></figure><p id="d1ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XSS过滤器是针对每个模板设置的<strong class="jp ir">，这意味着它仅在提供了现有模板id时才工作。当我提供一个不存在的模板id时——没有XSS过滤器，没有漂亮的css或图像，但仍然生成了有效载荷，这导致了漂亮的反射XSS。</strong></p><h1 id="dda6" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">结论</h1><p id="5b95" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">只允许请求的某些参数影响输出可能会有风险。时刻注意你使用的任何参数的影响和重要性，即使是最小的参数。</p><p id="b5bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Blinksale修补了这个问题，并亲自通过电子邮件向我表示感谢。</p></div></div>    
</body>
</html>