<html>
<head>
<title>Multi-Factor Authentication Vulnerabilities</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多因素身份认证漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/multi-factor-authentication-vulnerabilities-7a4b647a7b09?source=collection_archive---------1-----------------------#2022-09-27">https://infosecwriteups.com/multi-factor-authentication-vulnerabilities-7a4b647a7b09?source=collection_archive---------1-----------------------#2022-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b3b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨，我的名字是Hashar Mujahid，在这篇博客中，我们将讨论MFA和最常见的可能出现的MFA漏洞。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/15bc1365de9d828d0521ceae0ef5c2a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/0*XQ6GuSc99C-2TcUk"/></div></figure><p id="161a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以首先要做的是</p><p id="cc67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是多重身份认证？</strong></p><p id="ef78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">许多网站和组织依赖单因素身份验证，用户可以仅使用密码登录其帐户，无需任何额外的安全和验证层。但是，随着社会工程攻击变得越来越复杂，迫切需要一个额外的安全层，如多因素身份验证。在多因素身份认证中，当用户输入其密码以登录时，web应用程序会向用户的验证电子邮件地址发送一个临时代码，只有当用户输入该代码时，他才能与其帐户进行交互。</p><p id="fd4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是双因素身份认证令牌？</strong></p><p id="40ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户经常从某种物理设备上读取验证码。许多高安全性网站现在提供了一种特定的设备来实现这一功能，例如RSA令牌或键盘设备，您可以用它来访问您的网上银行或工作笔记本电脑。这些专用设备除了专门为安全性而构建之外，还提供了立即生成验证码的额外好处。出于同样的原因，网站通常会使用特定的移动应用程序，如Google Authenticator。</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="06f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们必须讨论在实施多因素身份认证时可能出现的一些漏洞。</p><h2 id="b5e2" class="la lb iq bd lc ld le dn lf lg lh dp li jy lj lk ll kc lm ln lo kg lp lq lr ls bi translated"><strong class="ak">完全跳过验证过程:</strong></h2><p id="65fd" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">当用户输入密码，网站提示他输入MFA代码时，您是否可以跳过MFA过程直接访问该帐户是值得检查的。</p><p id="d92e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><p id="d208" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们假设用户在<code class="fe ly lz ma mb b">/login</code>页面输入他的密码，然后网站将用户重定向到<code class="fe ly lz ma mb b">/mfa-verification</code>，你可以尝试将URL从<code class="fe ly lz ma mb b">/mfa-verification</code>改为<code class="fe ly lz ma mb b">/dashboard</code>。</p><p id="8751" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mc" href="https://portswigger.net/web-security/authentication/multi-factor/lab-2fa-simple-bypass" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">实验室:2FA简易旁路</strong> </a> <strong class="jp ir"> : </strong></p><p id="9616" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们必须绕过外交部进入受害者(卡洛斯)的账户页面。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/fd94a9d9b74674a6d543f87aac9b951e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JCnYIzDSV5e5zYfm-GGi6Q.png"/></div></div></figure><p id="b8b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用提供给我们的凭据登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mi"><img src="../Images/45b9c108610e1ab26168ed8e0491e1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B01o3TcjJutL3U3qiKZ6ng.png"/></div></div></figure><p id="5d3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们把<code class="fe ly lz ma mb b">/login2</code>改成<code class="fe ly lz ma mb b">/</code>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mj"><img src="../Images/b2b6aab0fcea64c597da577e59de34a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EgR3O0gUhj-HrpZuOzUQ6g.png"/></div></div></figure><p id="e572" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们完全登录了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mi"><img src="../Images/2011c6fa981f90ba4391dfa5048fb54f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ikP7GoeOXXxaT-x3Yvaokg.png"/></div></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h1 id="aa3f" class="mk lb iq bd lc ml mm mn lf mo mp mq li mr ms mt ll mu mv mw lo mx my mz lr na bi translated">有缺陷的双因素验证逻辑:</h1><p id="c052" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">当双因素身份验证逻辑有缺陷时，网站可能无法正确验证同一用户在完成第一步后正在完成第二步。</p><p id="50d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><p id="865a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第二步中，用户使用密码登录，应用程序分配一个cookie来跟踪该操作是否由同一用户执行。</p><pre class="km kn ko kp gt nb mb nc nd aw ne bi"><span id="501a" class="la lb iq mb b gy nf ng l nh ni">HTTP/1.1 200 OK <br/>Set-Cookie: account=carlos ==&gt; <strong class="mb ir">Pridictable value.</strong><br/> </span></pre><p id="2e62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者可以使用他的帐户启动有效的登录过程，但是将cookie值更改为受害者，并以受害者的身份登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nj"><img src="../Images/177bafa6b255522d6ee33e663a273ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uvn_hRUhcHd2OLp6HaLonw.png"/></div></div></figure><p id="a0e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">登录后，我们将在电子邮件客户端收到一个代码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nk"><img src="../Images/83a53c1cb0e6418fbd4ce3781b404bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gEi-ExcTFxt5jBW_nu_TBg.png"/></div></div></figure><p id="c6b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入代码，用burp suite拦截请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nl"><img src="../Images/b38ae7c022c23b64aede5601da348950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fl-QDtde9FLv7PnxRhxHIw.png"/></div></div></figure><p id="306e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在将这个请求发送到中继器，并更改请求方法，将验证cookie更改为Carlos，这样就为Carlos生成了一个MFA代码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nm"><img src="../Images/74086f602a7be38aae8273e5ccd8d2c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t3AL-8er14iwHVUokEIh-Q.png"/></div></div></figure><p id="2367" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们只需要强行破解那个MFA代码。</p><p id="ca75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到登录页面，输入您的用户名和密码。然后，提交无效的2FA代码。把帖子<code class="fe ly lz ma mb b">/login2</code>发给入侵者，把验证改成卡洛斯。暴力破解MFA代码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/8e1fcb2639a434a21dbcb6196c3a6f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_cxwbNTrygO1XJZXQa5C7w.png"/></div></div></figure><p id="3943" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始蛮力攻击。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mi"><img src="../Images/20db93f923e13fd30a626b34cc35fccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXt64BuXmBxIqY3W6BaGgQ.png"/></div></div></figure><p id="b527" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以复制会话并用当前值替换它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/7c7aa3c7eac2235aa9a3763e4fb9d29e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A8Byv3lcUnaWKdd0McGGvA.png"/></div></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="84d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一部分，我们将学习一些绕过MFA系统的高级技术</p><p id="b56e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我强烈推荐solving portswiggers实验室来练习这些技术。</p><p id="5c54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之前，快乐的黑客❤</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nn no l"/></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="bc50" class="la lb iq bd lc ld le dn lf lg lh dp li jy lj lk ll kc lm ln lo kg lp lq lr ls bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mc" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>，以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>