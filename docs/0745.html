<html>
<head>
<title>Exploiting: SSRF For Admin Access</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用:用于管理员访问的SSRF</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-ssrf-for-admin-access-31c30457cc44?source=collection_archive---------2-----------------------#2020-08-08">https://infosecwriteups.com/exploiting-ssrf-for-admin-access-31c30457cc44?source=collection_archive---------2-----------------------#2020-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="504e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">简介:</strong></p><p id="ed6c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">服务器端请求伪造(SSRF):- SSRF是一种攻击，攻击者可以迫使易受攻击的服务器触发对第三方服务器和/或内部资源的恶意请求。然后，可以利用此漏洞发起特定的攻击，例如跨站点端口攻击、服务枚举和各种其他攻击。</p><p id="27de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通常，攻击者可以完全或部分控制正在发送的请求，服务器会在不进行任何验证的情况下处理该请求。</p><p id="5ea4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">工作中</strong> : SSRF可用于向防火墙后或未公开面对的其他内部资源发出请求。通过使用SSRF，我们可以访问基础架构参数，有时这些参数很容易被利用，进一步利用基础架构。</p><p id="91e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们试图通过下图来理解。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f32ce04ada914527ce80bb50221ec922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oksdn4nvZKI54YI10lEqeg.png"/></div></div></figure><p id="0382" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">攻击者试图访问内部服务器，因为防火墙阻止了对内部服务器的直接访问，所以他/她的访问被拒绝。</p><p id="8513" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以他试图访问公共服务器。他试图在公共服务器上创建一个请求，公共服务器将该请求发送到内部服务器。</p><p id="b3bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">内部服务器将响应由内部资源发送的精心编制的请求</p><p id="c033" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用上述步骤，攻击者获得了他在步骤1中无法获得的内部服务器的访问权限。</p><p id="f52f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">攻击场景:</strong>根据需求，以不同的方式向内部服务器发送请求。</p><p id="edae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">在受防火墙保护的内部网上的内部主机上进行端口扫描:</strong>它使攻击者能够针对防火墙后面的系统执行端口扫描。根据响应的不同，攻击者可以推断出开放和关闭的端口。</p><p id="305a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">枚举服务/泄露敏感信息:</strong>攻击者可以枚举SSH、DICT、SFTP和其他协议的版本<a class="ae la" href="https://test.com/uri?url=sftp://attacker:1112/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu"><em class="lb">https://test.com/uri?url=sftp://attacker:1112/</em></strong></a>这将向攻击者控制的服务器发送请求，泄露所用SFTP的版本。您也可以使用FTP、DICT、GOPHER等其他模式来枚举它们的版本。</p><p id="85e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">攻击内部应用:</strong>可疑参数上的漏洞，因为我们不知道服务器是如何处理参数的。因此攻击者可以通过操纵请求中的参数来访问内部应用程序。</p><p id="93ce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">使用文件处理程序访问本地web服务器文件:<em class="lb">file:///c:/windows/system32/。</em>:</strong></p><p id="177c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">剥削:</strong></p><p id="ff2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的目标是获得对管理仪表板的访问权限，并删除一个从外部无法访问的用户。</p><p id="8563" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该应用程序具有股票特性功能，可从内部系统获取数据。管理接口位于<a class="ae la" href="http://localhost/admin" rel="noopener ugc nofollow" target="_blank"> http://localhost/admin </a>。</p><p id="939a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在通过burp拦截股票URL请求:</p><p id="8b61" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">请求:</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lc"><img src="../Images/6233d550ab3d82fe0a08aebcd9c57e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUNHMjQ1f7O0EHSdnjhdOg.png"/></div></div></figure><p id="9a4a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我们可以清楚地看到主体“stockApi”正在向一个端点发送一个请求，我们可以完全控制这个参数，我们可以根据需要修改它。让我们将这个请求发送到repeater，并尝试修改股票API参数。</p><p id="27ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">请求&amp;响应:</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ld"><img src="../Images/e3bd0ee9a5f347ec9cebbfb4f812fd41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*19Gee6odgygA-dlEtpFWAw.png"/></div></div></figure><p id="4b6f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的屏幕截图中，我们可以看到我们可以使用修改后的请求访问管理面板。我们得到了三个用户名和他们各自的网址来删除现有的帐户。所以我用删除用户端点替换“stock API”URL，并检查结果。</p><p id="1b2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">请求:</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi le"><img src="../Images/32719c7be84b1dc461c352518f5f30e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*h7qP3s_ZPJGXXU5EKyMhZQ.png"/></div></figure><p id="4981" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转发这个请求后，我得到302(重定向)</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lf"><img src="../Images/eaa23a06cee2ae1f99d749cb4a398319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*44pATzML9bl4RnbUWKPIBg.png"/></div></div></figure><p id="4f34" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当我启动follow redirection时，它将我重定向到admin URL，并显示一条消息说该用户已被删除。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lg"><img src="../Images/82fe98b9621f559126b3c5db293ef61e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQWxsIJmH4VtYa4Jttwgzw.png"/></div></div></figure><p id="86de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们有管理员权限。</p><p id="df70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">预防措施/缓解措施</strong></p><p id="5d1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不要相信用户数据和执行数据验证。</p><p id="ec7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将应用程序需要访问的DNS名称或IP地址列入白名单</p><p id="6d0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">禁用未使用的URL模式，如ftp://、s ftp://</p></div></div>    
</body>
</html>