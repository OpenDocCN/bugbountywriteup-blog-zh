<html>
<head>
<title>Injecting Punycode URL Within the Arbitrary Text via Comment Box In Google Photo Sharing Option</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过谷歌照片共享选项中的评论框在任意文本中注入Punycode URL</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/injecting-punycode-url-within-the-arbitrary-text-via-comment-box-in-google-photos-sharing-option-8b424065deb3?source=collection_archive---------0-----------------------#2021-05-04">https://infosecwriteups.com/injecting-punycode-url-within-the-arbitrary-text-via-comment-box-in-google-photos-sharing-option-8b424065deb3?source=collection_archive---------0-----------------------#2021-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="5c98" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">定义:</h1><p id="2ed7" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">HTML注入是一种注入漏洞，当用户控制输入点时会出现这种漏洞，它可以将任意HTML代码注入易受攻击的网页。<br/>有可能注入&lt;一个&gt;标签以及Punycode域，并创建钓鱼评论，从而被攻击者用来通过公开图像来攻击任何人。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lj"><img src="../Images/c1306e34bd10f6febedad12b59083738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fixbrVJK2IukU-VrLF1kdg.png"/></div></div></figure><h1 id="1f78" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">攻击场景:</h1><p id="d77e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">照片分享允许在<a class="ae lv" href="https://photos.google.com/direct/AFxxxxxDqUPppXXXXXXXXXXXrAXXXXXXX" rel="noopener ugc nofollow" target="_blank">https://photos . Google . com/direct/afxxxxdquppxxxxxxxxxxxxxraxxxxxxx</a>上用心形表情符号进行评论和照片上传。在评论时，可以插入任意文本的任何URL，它在评论中表现为一个超链接。HTML &lt; a &gt;元素(或锚元素)通过它的href属性，创建一个指向网页、文件、电子邮件地址、同一页面上的位置或URL可以寻址的任何其他内容的超链接。<br/> <strong class="kn ir">在火狐浏览器中，使用这种任意的内容注入和注入Punycode URL使其更有冲击力。</strong></p><p id="0d9d" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">攻击者可以与多人共享图像/视频，也可以创建可共享的链接。从而使其对公众可用。</p><p id="271d" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">攻击者可以利用注释中注入的文本内容将用户重定向到恶意网站。没有任何警告显示网络钓鱼攻击是可行的。直接注入Punycode域是不可能的，因为它会导致完全删除URL。</p><blockquote class="mb mc md"><p id="6339" class="kl km me kn b ko lw kq kr ks lx ku kv mf ly ky kz mg lz lc ld mh ma lg lh li ij bi translated"><strong class="kn ir">可以绕过限制，通过URL编码值插入Punycode URL。</strong></p></blockquote><p id="6e9d" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">同样在火狐中，IDN _秀_punycode默认是禁用的。这使得它更容易受到URL重定向和通过同形异义词攻击的钓鱼网站的攻击。当用户单击时，没有警告消息表明用户将被重定向到攻击者的(Punycode)域。</p><p id="1b0b" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated"><strong class="kn ir">有效载荷:</strong></p><pre class="lk ll lm ln gt mi mj mk ml aw mm bi"><span id="a7f0" class="mn jo iq mj b gy mo mp l mq mr">&lt;a href=”<a class="ae lv" href="https://www.аррӏе.com" rel="noopener ugc nofollow" target="_blank">https://www.аррӏе.com</a>”&gt;iPhone Black Friday sale&lt;/a&gt;</span></pre><h1 id="1c70" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">复制步骤:</h1><ol class=""><li id="4322" class="ms mt iq kn b ko kp ks kt kw mu la mv le mw li mx my mz na bi translated">参观<a class="ae lv" href="https://photos.google.com/" rel="noopener ugc nofollow" target="_blank">https://photos.google.com/</a></li><li id="3db8" class="ms mt iq kn b ko nb ks nc kw nd la ne le nf li mx my mz na bi translated">在<a class="ae lv" href="http://photos.google.com" rel="noopener ugc nofollow" target="_blank">photos.google.com</a>中选择视频/图像</li><li id="3acd" class="ms mt iq kn b ko nb ks nc kw nd la ne le nf li mx my mz na bi translated">点击共享选项，然后在Google相册中点击发送。</li><li id="df76" class="ms mt iq kn b ko nb ks nc kw nd la ne le nf li mx my mz na bi translated">输入您想要共享的用户名。此外，还可以生成一个可共享的链接以供查看。</li><li id="42a1" class="ms mt iq kn b ko nb ks nc kw nd la ne le nf li mx my mz na bi translated">公共链接将类似于:<a class="ae lv" href="https://photos.app.goo.gl/ophzhxxxxxxxxxx9" rel="noopener ugc nofollow" target="_blank">https://photos.app.goo.gl/ophzhxxxxxxxxxx9</a></li><li id="dab6" class="ms mt iq kn b ko nb ks nc kw nd la ne le nf li mx my mz na bi translated">点击说点什么，然后输入评论。在评论中添加URL，如<a class="ae lv" href="https://google.com" rel="noopener ugc nofollow" target="_blank">https://google.com</a>或<a class="ae lv" href="https://www.аррӏе.com" rel="noopener ugc nofollow" target="_blank">https://www.аррӏе.com</a>(这是Punycode域名)。</li><li id="c2be" class="ms mt iq kn b ko nb ks nc kw nd la ne le nf li mx my mz na bi translated">通过Burpsuite拦截请求，并篡改添加的URL的值。将任意文本(<a>标签)与任何恶意URL一起添加到攻击者想要重定向的位置。</a></li><li id="a3a4" class="ms mt iq kn b ko nb ks nc kw nd la ne le nf li mx my mz na bi translated">以火狐为例。也可以注入Punycode URL，注入任意文字:点击评论喜欢，查看更多照片。</li></ol><pre class="lk ll lm ln gt mi mj mk ml aw mm bi"><span id="624e" class="mn jo iq mj b gy mo mp l mq mr"><strong class="mj ir">Request Body:</strong></span><span id="18ff" class="mn jo iq mj b gy ng mp l mq mr">f.req=[[[“HF8OLc”,”[[\”AF1Qip6767676767676767r_24-KRiu868NGwdddddddddddddddddddddddddddddddddddddA\”],[[[2,\”mypage\”,null,[\”https%3A%2F%2Fwww.%D0%B0%D1%80%D1%80%D3%8F%D0%B5.com\",\"https%3A%2F%2Fwww.%D0%B0%D1%80%D1%80%D3%8F%D0%B5.com\"]]]],\"ZS1CdDZ6dG8yTFBdddddddddddddYS\",null,null,[],null,\"`comment_0\",null,[[\"AF1QipNMmL5__WEl4ODcdOzFEjOeXQRw\",\"99999277788885631999999999995\"],\"https://lh3.googleusercontent.com/JcxcvcvcvbvvbbbbbbbbbbbbbbbbbbbbbwMT-J3vWAycxxxxxxxxxxxxxxxxxxxxxxxxxxx1H-XZU2A\",null,[\"Demo+App\",1,\"male\",\"justmorpheus\"],[null,null,[]],1,\"\",\"\",[],[],null,[\"<a class="ae lv" href="https://www.google.com/url?q=https://lh3.googleusercontent.com/a/AATXAJxUEGFNSdcXVQ_Y5-QmHDcZ32-b9L7TZw-SeY4%5C&amp;sa=D&amp;usg=AFQjCNFSnVwNv_b8sOXV6F25RLsTgZP5mQ" rel="noopener ugc nofollow" target="_blank">https://lh3.googleusercontent.com/a/AATXAJxUjjEGFNSdcXVQ_Y5hhhcZ32-b9L7TZw-SeY4\</a>"],2]]",null,"generic"]]]&amp;at=AP9999999999DfSxzVFVXTRacxcxcxcxcx:16979004365222&amp;</span></pre><p id="3c29" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">8.发送请求并检查200 OK。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nh"><img src="../Images/f2bbb42c224a9e27c630accdc967b0f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MkCQScgtvSz-zIOG7TQ6-w.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">用恶意数据篡改输入的打嗝请求</figcaption></figure><p id="1e2d" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">9.重新加载页面并将鼠标悬停在用任意文本创建的超链接上。</p><p id="2a09" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">10.在Firefox中，任意文本显示为原始域名，而不是Punycode，一旦用户点击链接。它可以被重定向或钓鱼。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nm"><img src="../Images/86adf79abdc566bfe91825e00183a965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IthWVPg1yNArPSfq8S4o8w.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">最终攻击者控制的带有Punycode的图像</figcaption></figure><h1 id="2a30" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结果:</h1><p id="0a06" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">由于社会工程攻击，谷歌将该问题标记为不适用。，这不属于范围。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nn"><img src="../Images/1fbc1d379bad79a781c787dea1603824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bd46Hc5fUGFc4irC0i2vUg.png"/></div></div></figure><h2 id="7c31" class="mn jo iq bd jp no np dn jt nq nr dp jx kw ns nt kb la nu nv kf le nw nx kj ny bi translated"><em class="nz">后来被谷歌修复:P. </em></h2><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi oa"><img src="../Images/b58b533af18b7a4e54883e773368ff39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*anTWM3eWmBZc4w3Vls7LuA.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">重新测试后，问题得到了解决。</figcaption></figure><p id="349a" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">再见，下次见。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><a href="https://www.buymeacoffee.com/justmorpheus"><div class="gh gi ob"><img src="../Images/4bc5de35955c00939383a18fb66b41d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*9vg3-OY14aZN1UpKwIxxZg.png"/></div></a></figure></div></div>    
</body>
</html>