<html>
<head>
<title>Wireshark twoo — Forensics| PicoCTF Write-up | 100 Points</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">wireshark twoo-Forensics | PicoCTF报道| 100分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/wireshark-twoo-forensics-picoctf-write-up-100-points-bb3dbc9e14ec?source=collection_archive---------2-----------------------#2022-12-28">https://infosecwriteups.com/wireshark-twoo-forensics-picoctf-write-up-100-points-bb3dbc9e14ec?source=collection_archive---------2-----------------------#2022-12-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dcc4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Wireshark twoo twoo (100分)— PicoCTF法医挑战报道| Karthikeyan Nagaraj</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/0dbea569dd701b66c53ac4b72a86e85e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*oULHCWSaoVsbmrum6FRUrA.png"/></div></figure><h2 id="5ff0" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">描述:</h2><p id="1d02" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr kw ls lt lu la lv lw lx le ly lz ma mb ij bi translated">你能找到旗子吗？<a class="ae mc" href="https://mercury.picoctf.net/static/7b8e53329b34946177a9b5f2860a0292/shark2.pcapng" rel="noopener ugc nofollow" target="_blank"> shark2.pcapng </a>。</p><h2 id="32e1" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">使用的工具— Wireshark</h2><h2 id="f1ee" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">任务文件:</h2><p id="0d46" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr kw ls lt lu la lv lw lx le ly lz ma mb ij bi translated"><a class="ae mc" href="https://mercury.picoctf.net/static/7b8e53329b34946177a9b5f2860a0292/shark2.pcapng" rel="noopener ugc nofollow" target="_blank">https://mercury . picoctf . net/static/7b8e 53329 b 34946177 a9 b5 f 2860 a 0292/shark 2 . pcapng</a></p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h2 id="86a9" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">分析</h2><ol class=""><li id="2f79" class="mk ml iq ll b lm ln lp lq kw mm la mn le mo mb mp mq mr ms bi translated">在Wireshark中打开<code class="fe mt mu mv mw b">shark2.pcapng</code>任务文件</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mx"><img src="../Images/9f5e6f5ed8acd74d0680af3b014472a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tl06eOPe2XLoHNGhznERfA.png"/></div></div></figure><p id="7e3e" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">让我们找找任何可疑的包裹</p><p id="36c6" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">2.搜索字符串，如flag，txt，pico，因为它是CTF或任何其他相关词类似于我们期望找到的</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/e8a583193c051daecb2562eb998029fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*7CGOl5hNi20FEWFH1dLDMQ.png"/></div></figure><p id="8fc3" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">3.通过搜索单词<code class="fe mt mu mv mw b">flag</code>，我们发现了一个HTTP请求，其中有一个对<code class="fe mt mu mv mw b">/flag</code>的<code class="fe mt mu mv mw b">GET</code>请求</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/29932b10fc92c1aebfb1215a16169224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/1*-yvqqkMSAE6zxxXZD4p1HA.gif"/></div></figure><p id="dd08" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">4.右键单击并跟随HTTP流。</p><pre class="kg kh ki kj gt nj mw nk bn nl nm bi"><span id="ec10" class="nn ko iq mw b be no np l nq nr">GET /flag HTTP/1.1<br/>Host: 18.217.1.57<br/>Connection: keep-alive<br/>Upgrade-Insecure-Requests: 1<br/>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36<br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br/>Accept-Encoding: gzip, deflate<br/>Accept-Language: en-US,en;q=0.9<br/><br/>HTTP/1.0 200 OK<br/>Content-Type: text/html; charset=utf-8<br/>Content-Length: 73<br/>Server: Werkzeug/1.0.1 Python/3.6.9<br/>Date: Mon, 10 Aug 2020 01:39:19 GMT<br/><br/>picoCTF{bfe48e8500c454d647c55a4471985e776a07b26cba64526713f43758599aa98b<br/></span></pre><p id="282a" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">在底部，你可以看到一个类似旗帜的字符串，但不幸的是，这不是旗帜。让我们寻找DNS请求。</p><p id="9468" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">5.在Wireshark中应用dns过滤器</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/b8a1ea16c49be76d068b15a96d050a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*VcedSDOl3EMAb2YF3WYDrQ.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/b7a59b1bde56dbd8ee7fe8d0be6e9fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*mdxkXTEm4iSTfH1Jt7maoQ.png"/></div></figure><p id="990d" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">在这里，我们可以看到在域<code class="fe mt mu mv mw b">reddshrimpandherring.com</code>前面有一些随机的base64编码字符串前缀，所以让我们尝试解码所有内容<br/>，为了做到这一点，我们需要将捕获文件导出为csv格式，以便用python进行进一步分析</p><p id="03a2" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">6.点击<code class="fe mt mu mv mw b">file → Export packet dissections</code>导出截图</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ni"><img src="../Images/1ac31bdaacbb0108cf3ee5ab1c0788a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/1*dg-cPwSOJXv_Hz8N5LNUww.gif"/></div></div></figure><p id="c7e1" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">7.下面的python代码将读取导出的<code class="fe mt mu mv mw b">csv</code>文件中的行，并首先对字符串<code class="fe mt mu mv mw b">“Standard query .+ A (.+)”</code>执行<code class="fe mt mu mv mw b">regular expression search</code>以过滤掉域，因为它有一个字符串“标准查询”</p><p id="f52e" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">8.然后，base64编码部分从域中分离出来到达<code class="fe mt mu mv mw b"> b64_portion</code></p><p id="6a51" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">9.然后<code class="fe mt mu mv mw b">b64_portion</code>被解码并存储到<code class="fe mt mu mv mw b">b64_decoded</code></p><p id="8035" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">10.并且进一步通过Utf-8编码方案对其进行解码，并将其存储到<code class="fe mt mu mv mw b">ascii_portion</code>中，然后基于如果<code class="fe mt mu mv mw b">val(ascii_portion)</code>和如果<code class="fe mt mu mv mw b">current ascii_portion not equals to the end value of result (pre value)</code>满足以下条件，将其添加到结果变量中</p><p id="623f" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">如果给定字符串中的字母为<br/> 1，则<code class="fe mt mu mv mw b">val()</code>方法返回<code class="fe mt mu mv mw b">True</code>。不是字母表和<br/> 2。不是一个数字和<br/> 3。不是“{”和<br/> 4。不是" } "和<br/> 5。不是" _" <br/>否则<code class="fe mt mu mv mw b">False</code></p><pre class="kg kh ki kj gt nj mw nk bn nl nm bi"><span id="11cd" class="nn ko iq mw b be no np l nq nr">import re<br/>import base64<br/><br/>result = ''<br/><br/>def val(s):<br/>    for c in s:<br/>        if not c.isalpha() and not c.isnumeric() and not c == '{' and not c == '}' and not c == '_':<br/>            return False<br/>    return True<br/><br/># Make sure to write the Actual name of csv you used to save.<br/># Here I saved my csv file as capture.csv<br/><br/>with open('capture.csv', 'r') as f:<br/>    line = f.readline()<br/>    while line:<br/>        if 'Standard query' in line:<br/>            m = re.search(r"Standard query .+ A (.+)", line)<br/>            b64_portion = m[1].split('.')[0]<br/>            b64_decoded = base64.b64decode(b64_portion)<br/><br/>            try:<br/>                ascii_portion = b64_decoded.decode('utf-8')<br/><br/>            except:<br/>                pass<br/><br/>            else:<br/>                if val(ascii_portion) and not result.endswith(ascii_portion):<br/>                    result += ascii_portion<br/><br/>        line = f.readline()<br/><br/>print('Flag:', result)</span></pre><p id="1e58" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated"><strong class="ll ir">输出:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/91268e26bd7a94731360a224d63e49eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*QzJOiP0QhgEl_ckeezEfCQ.png"/></div></figure><pre class="kg kh ki kj gt nj mw nk bn nl nm bi"><span id="fc90" class="nn ko iq mw b be no np l nq nr">Ans: picoCTF{dns_3xf1l_ftw_deadbeef}</span></pre></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="3040" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">请随时通过<a class="ae mc" href="https://www.linkedin.com/in/karthikeyan-nagaraj" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>:)提问</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://buymeacoffee.com/cyberw1ng"><div class="gh gi nv"><img src="../Images/3bbcc67f2c463738de4869129603300d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nh1owl6a3HdaRB_Y0y04pw.png"/></div></a></figure><p id="1e31" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">感谢您的阅读！！</p><p id="c6e1" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">捕捉快乐~</p><pre class="kg kh ki kj gt nj mw nk bn nl nm bi"><span id="ae48" class="nn ko iq mw b be no np l nq nr">Author: Karthikeyan Nagaraj</span></pre><p id="fc2f" class="pw-post-body-paragraph lj lk iq ll b lm nc jr lo lp nd ju lr kw ne lt lu la nf lw lx le ng lz ma mb ij bi translated">ctf，forensics，wireshark，捕获旗帜，挑战，报道，旗帜，karthikeyan nagaraj，cyberw1ng</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h2 id="d0f4" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mc" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>