<html>
<head>
<title>Arbitrary File Upload From A Different Angle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从不同角度上传任意文件</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/arbitrary-file-upload-from-a-different-angle-1193ffb80b09?source=collection_archive---------1-----------------------#2019-01-21">https://infosecwriteups.com/arbitrary-file-upload-from-a-different-angle-1193ffb80b09?source=collection_archive---------1-----------------------#2019-01-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b571" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:以下文章发表于2016年1月19日https://FogMarks.com</em><a class="ae km" href="https://fogmarks.com/2016/01/19/arbitrary-file-upload-from-a-different-angle/" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/7d20b2b009bec2c33e43dc999bfd6b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ayA98Z_v_DzpSYAS.jpg"/></div></div></figure><p id="6c1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kz translated">今天我们将讨论任意文件上传，这是一个不太常见的漏洞，但却是最强大的漏洞之一。</p><h1 id="c47b" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">不太常见？为什么？</h1><p id="bb56" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">因为任何有理智的开发人员的平台都会验证他们与之交互的任何文件的内容类型和文件扩展名。但是今天我想向你介绍一种新的验证态度，我建议每个人都使用这种态度——验证内容本身。<br/>如果您希望上传一张图片，请确保图片内容适合图片内容。如果你期待一个html文件——清理它，并确保没有脚本标签存在。有很多库和工具可以做到这一点。</p><p id="6bce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">话虽如此，我遇到的许多公司和开发者对我说:“当我们可以在CDN(内容交付网络)上托管上传的文件时，我们为什么要付出那么多努力？”。嗯，今天的故事就是关于这个。</p><p id="4f15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Freelancer.com</strong>是我第一次接触这种新的攻击媒介。它们允许图片作为个人资料和封面图片上传，DOC和DOCX文件作为简历上传等等。</p><p id="b112" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但他们也有一个很好的功能，用户可以写文章并发布给其他人阅读。<br/>这个表单支持图片上传，可以想象，这些图片正在上传到一个CDN (https://cdn.f-cdn.com/)。<br/>f-cdn.com当然是自由职业者公司的官方CDN。</p><p id="b49f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的开发人员可能认为，由于图像被上传到CDN，不应该进行任何清理和内容验证——表单不支持HTML——所以XSS无法完成，CDN不允许php文件(或任何其他类似文件)被访问——只需下载它们。</p><p id="a9c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，这种态度让我能够上传一个. exe文件到自由职业者公司的官方CDN。</p><p id="7a34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你能想象一个黑客会在官方公司的CDN上托管恶意病毒的场景吗？我希望你知道。<br/>更重要的是，没有大小限制——任何大小的文件都可以托管在CDN上(尽管上传它可能需要时间，并且连接最终可能会被拒绝)。</p><p id="9617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以请记住，使用cdn并不总是最佳选择。是的，XSSes不会影响用户(因为一个不同的域),是的，shells和rce不会直接危及你的服务器。但是错误验证你的CDN托管的文件类型可能会给你的公司带来巨大的损失。请记住这一点。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="ml mm l"/></div></figure></div></div>    
</body>
</html>