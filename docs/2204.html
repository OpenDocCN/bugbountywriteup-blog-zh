<html>
<head>
<title>TryHackMe — Antivirus</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe —防病毒</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-antivirus-2c69a4b3e26e?source=collection_archive---------1-----------------------#2022-07-21">https://infosecwriteups.com/tryhackme-antivirus-2c69a4b3e26e?source=collection_archive---------1-----------------------#2022-07-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d085" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，</p><p id="67d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从新手到极客，每一个熟悉计算机的人都会在某个时候听说过防病毒软件。防病毒是从便携式计算机的早期发展而来的概念。从Windows 95到Windows 11，防病毒是计算机进化的一部分。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/39839cf80330e80598db2ea2593a18ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hcNOZi98jgjd6ktY.png"/></div></div></figure><p id="3da6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">防病毒软件是一种保护机器免受各种恶意软件、病毒和网络攻击的软件，可以帮助我们保护机器的安全。</p><p id="e7ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">传统的反病毒解决方案，如卡巴斯基，AVG，诺顿到恶意软件字节，和Windows Defender，反病毒服务的确切原因是保护机器。</p><p id="bff9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们对它的工作原理知之甚少。我们不打算深入历史，但让我们了解它是如何工作的。</p><p id="4f62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">防病毒软件是一个由扫描器、引擎、数据库和沙盒环境组成的软件包。每个组件都有自己的用途</p><p id="a152" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">防病毒软件使用最新恶意软件的实时签名更新其数据库，并根据签名扫描文件以进行匹配。一旦识别出来，它就采取相应的行动。</p><p id="11c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们深入了解不同类型的扫描以及它在机器上的工作原理。</p><p id="c88d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有3种类型的扫描和检测。1.静态检测2。动态检测3。基于行为的检测</p><h2 id="50d5" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">静态检测:</h2><p id="32a4" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">静态检测是最简单最基本的检测方式。它用恶意软件文件的现有数据库扫描文件。它检查哈希值、校验和以及证明文件完整性的其他相关信息。</p><p id="ffa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此任务中，我们将使用具有静态检测功能的防病毒软件扫描计算机上的文件。</p><p id="244a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们得到了一台运行着名为“clamscam”的杀毒软件的windows 10机器和一堆不同类型的恶意软件样本。</p><p id="b2e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">恶意软件示例文件夹包含以下文件:</p><ol class=""><li id="4b6a" class="lv lw iq jp b jq jr ju jv jy lx kc ly kg lz kk ma mb mc md bi translated"><strong class="jp ir"> EICAR </strong>是一个包含ASCII字符串的测试文件，用于测试反病毒软件的有效性，而不是可能损害您机器的真正恶意软件。任何病毒扫描软件都可以使用这个文件进行测试</li><li id="86b2" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated"><strong class="jp ir"> Backdoor 1 </strong>是一个C#程序，它使用一种众所周知的技术来建立反向连接，包括创建一个进程和执行一个Metasploit框架外壳代码。</li><li id="f455" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated"><strong class="jp ir">后门2 </strong>是一个利用进程注入和加密建立反向连接的C#程序，包括将一个Metasploit外壳代码注入到一个已经存在并正在运行的进程中。</li><li id="8032" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated"><strong class="jp ir"> AV-Check </strong>是一个C#程序，枚举目标机器中的AV软件。请注意，该文件没有恶意。我们将在任务6中更详细地讨论该工具。</li><li id="92e0" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated">notes.txt是一个文本文件</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mj"><img src="../Images/535ce2b6e11eddb402c981ee3513ed66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vy35CZq3unUk33Rgu2tYw.png"/></div></div></figure><p id="3bd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经登录到机器，并使用cmd工具指示AV扫描主机桌面上的样本。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/5b226c4a5e170d22761e1dfbcfcd6298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iyK1DeX3oD89EdeEVwiXfA.png"/></div></div></figure><p id="b133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">AV扫描了他们数据库中的文件并分享了结果。我们检测到两个恶意软件。然而，它错误地将后门2识别为非恶意的，尽管它是恶意的。</p><p id="9b73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以运行clamscan.exe—调试<file_to_scan>，您将看到在扫描过程中加载和使用的所有模块。例如，它使用解包方法来分割文件，并寻找预先定义的恶意字节码值序列，这就是它如何能够检测到C#后门1。</file_to_scan></p><p id="944b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你记得，后门1和后门2是相同的代码，但后门2是加密的。backdoor 1中使用的Metasploit外壳代码的字节码值之前已经确定并添加到ClamAV的数据库中。</p><p id="a8ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，backdoor 2对Metasploit外壳代码使用了一种加密技术(XOR ),导致字节码值的不同序列，这在ClamAV数据库中是找不到的。</p><p id="8afc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而ClamAV能够使用基于md5签名的技术将EICAR.COM测试文件检测为恶意的。</p><p id="6b09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很多时候，反病毒软件无法更新所有反病毒软件的签名。由于黑客总是尝试新的方法来创建恶意软件，有时需要手动将签名添加到AV数据库中。大多数防病毒软件提供报告新签名或直接添加到他们的数据库。</p><p id="c18b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的例子中，由于我们无法识别恶意软件样本，现在我们将后门2的哈希值添加到我们的签名数据库中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/70769e1bac6a7d66dbe606f7b7d06b6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udQh2scED5y0c0X8Q3R-hQ.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/75d7f70c1ded37a8b28c5053aac27543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*txBa0Qt4Z0aVlPtO2pKiGQ.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mn"><img src="../Images/bd9502b535f83a90954a26fab9b02ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5joUBSJhjnLbe_w2wb8Gog.png"/></div></div></figure><p id="3979" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以上步骤描述了添加签名的方式。以下是必需的步骤:</p><ol class=""><li id="9f50" class="lv lw iq jp b jq jr ju jv jy lx kc ly kg lz kk ma mb mc md bi translated">为文件生成MD5签名。</li><li id="15d5" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated">将生成的签名添加到带有扩展名“的数据库中。组屋”。</li><li id="8a70" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated">用我们新的数据库重新扫描ClamAV文件。</li></ol><p id="1a0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我们可以识别不同进程中的模式，并通过添加规则中的所有参数来创建规则，以检测恶意软件。这可以通过YARA法则来实现。</p><p id="c26d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Yara是一个允许恶意软件工程师分类和检测恶意软件的工具。Yara使用基于规则的检测，因此为了检测新的恶意软件，我们需要创建一个新的规则。</p><p id="eda4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要在YARA中编写一个规则，我们应该使用字符串工具分析文件并列出二进制文件中所有人类可读的字符串。因此，我们将看到所有的函数、变量和无意义的字符串。</p><p id="d73e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，如果您仔细观察，我们可以在规则中使用一些独特的字符串来检测该文件。AV检查使用程序数据库(。pdb)，它包含编译期间程序的类型和符号调试信息。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/cfe4cf04fe9f80242f9a16aecb1e8f77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*dkBHbNvYMnvE7d_TDoK0_Q.png"/></div></figure><h2 id="595c" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">什么是程序数据库(PDB)？</h2><h2 id="7bd8" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">默认情况下，当指定/DEBUG时，链接器会创建一个保存调试信息的程序数据库(PDB)。PDB的默认文件名是程序的基本名称和扩展名. pdb</h2><p id="eb4b" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">我们将使用前面命令输出中的路径作为我们将要创建的Yara规则中唯一的字符串示例。签名可以是注册表项、命令等。以下是我们将在检测中使用的亚拉法则:</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="3b49" class="kx ky iq mq b gy mu mv l mw mx">rule thm_demo_rule {<br/>	meta:<br/>		author = "THM: Intro-to-AV-Room"<br/>		description = "Look at how the Yara rule works with ClamAV"<br/>	strings:<br/>		$a = "C:\\Users\\thm\\source\\repos\\AV-Check\\AV-Check\\obj\\Debug\\AV-Check.pdb"<br/>	condition:<br/>		$a<br/>}</span></pre><p id="34cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们解释一下亚拉法则。</p><ul class=""><li id="0985" class="lv lw iq jp b jq jr ju jv jy lx kc ly kg lz kk my mb mc md bi translated">规则的名称以rule thm_demo_rule开头。如果规则匹配，ClamAV将使用此名称。</li><li id="a3ad" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">元数据部分是一般信息，包含作者和描述。</li><li id="fb80" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">strings部分包含我们正在寻找的字符串或字节码。在这种情况下，我们使用的是C#程序的数据库路径，它是在前面的命令执行中获得的。</li><li id="8467" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">请注意，我们在路径中添加了一个额外的\来转义特殊字符，这样就不会违反规则。</li><li id="e4a0" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">在condition部分，我们指定定义的字符串是否在string部分找到，然后标记文件。</li></ul><p id="6450" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，yara规则必须存储在一个. Yara扩展文件中，以便ClamAV进行处理。</p><p id="30e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用我们创建的Yara规则再次重新扫描c:\Users\thm\Desktop\Samples文件夹。我们在桌面上的c:\ Users \ thm \ Desktop \ Files \ thm-demo-1 . Yara中保存了Yara规则的副本。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mz"><img src="../Images/83cbe2d9d48a34ae7f4f93644c76ad0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ITQT9fZ0p32ab-vyUZadw.png"/></div></div></figure><p id="3713" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出结果显示，该文本文件也被标记为恶意文件，因为该文件包含我们在YARA规则中添加的相同字符串。</p><p id="3976" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了避免误判，我们将在规则中指定文件类型。通常，文件的类型可以用幻数来标识，幻数是二进制文件的前两个字节。比如<a class="ae na" href="https://en.wikipedia.org/wiki/DOS_MZ_executable" rel="noopener ugc nofollow" target="_blank">可执行文件</a>(。exe)总是以十六进制的ASCII“MZ”值或“4D 5A”开始。</p><p id="4846" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了证实这一点，让我们使用免费的十六进制编辑器<a class="ae na" href="https://mh-nexus.de/en/hxd/" rel="noopener ugc nofollow" target="_blank"> HxD </a>应用程序来检查AV-Check.exe二进制文件并查看前两个字节。请注意，HxD已经在提供的VM中可用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nb"><img src="../Images/3ab9b55a083d1c2aabd3767203080449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GWKjd5Ztu1_jQjRmoMQAoQ.png"/></div></div></figure><p id="7d02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在Yara规则中包含这一点，只标记。包含我们的签名字符串的exe文件是恶意的。以下是改进后的亚拉法则:</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="6f60" class="kx ky iq mq b gy mu mv l mw mx"><br/>rule thm_demo_rule {<br/>	meta:<br/>		author = "THM: Intro-to-AV-Room"<br/>		description = "Look at how the Yara rule works with ClamAV"<br/>	strings:<br/>		$a = "C:\\Users\\thm\\source\\repos\\AV-Check\\AV-Check\\obj\\Debug\\AV-Check.pdb"<br/>		$b = "MZ"<br/>	condition:<br/>		$b at 0 and $a<br/>}</span></pre><p id="e780" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在新的Yara规则中，我们定义了一个等于MZ的唯一字符串($b)作为。exe文件类型。我们还更新了条件部分，现在包括以下条件:</p><ol class=""><li id="227b" class="lv lw iq jp b jq jr ju jv jy lx kc ly kg lz kk ma mb mc md bi translated">如果在0位置找到字符串“MZ ”,则为文件的开头。</li><li id="cdcc" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated">如果唯一字符串(路径)出现在二进制文件中。</li><li id="b83b" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated">在条件部分，我们用AND运算符对1和2中的两个定义都找到了，那么我们就有了一个匹配。</li></ol><p id="502e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在Desktop\Files\thm-demo-2.yara中找到更新的规则。现在我们有了更新的yara规则，现在让我们再试一次。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/1531272d564301d557a80094aaec0bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ik_N-EaWFbT1bUPe6j7ZWg.png"/></div></div></figure><p id="3f38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出显示我们改进了Yara规则以减少假阳性结果。这是反病毒软件工作原理的一个简单例子。因此，反病毒软件供应商努力打击恶意软件，并改进他们的产品和数据库，以提高性能和结果的准确性。</p><p id="684e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基于签名的检测的缺点是，如果二进制文件被修改，文件将具有不同的哈希值。因此，如果有人知道反病毒软件寻找什么以及如何分析二进制文件，就很容易绕过基于签名的检测技术，如后面的房间所示。</p><p id="5146" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在任务来了。我们给了两个问题来完成。</p><ol class=""><li id="00b8" class="lv lw iq jp b jq jr ju jv jy lx kc ly kg lz kk ma mb mc md bi translated">我们需要使用ClamAV的sigtool获得AV-Check.exe的哈希值。</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/93915cdb953d445b8b3000f1ceeefc48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mFzy4CQm2exyH1zdqlezjA.png"/></div></div></figure><p id="1d35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.我们应该通过使用字符串命令遍历AV-Check.exe的二进制文件来获得一个标志。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/a00f4e578d7f2b0afb83041dd487f757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*s2CFH_FPHuRuylTNobRCpA.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/0ce2cf8a47b8e8a9e2304560afcf86cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*19FOfJvwVuEeyvqIEdVFrg.png"/></div></div></figure><h2 id="e15f" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">动态检测</h2><p id="b725" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">在动态检测中，我们实时监控文件的行为来识别恶意进程。</p><p id="7016" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">动态检测更侧重于使用不同的方法在运行时检查文件。下图显示了动态检测扫描流程:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/367568d2a870d1fdb7e12da637ad1e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OnIzOtB45VZ03ueb.png"/></div></div></figure><p id="91d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Windows系统文件是最常被用来执行恶意软件的工具之一。这些反病毒软件会监控这些文件的API调用来检测恶意软件。一旦进程被执行，他们将监控窗口挂钩</p><pre class="km kn ko kp gt mp mq mr ms aw mt bi"><span id="26cc" class="kx ky iq mq b gy mu mv l mw mx">A <em class="nh">hook</em> is a mechanism by which an application can intercept events, such as messages, mouse actions, and keystrokes. A function that intercepts a particular type of event is known as a <em class="nh">hook procedure</em>. A hook procedure can act on each event it receives, and then modify or discard the event.</span></pre><p id="0627" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一种动态检测方法是沙盒。</p><p id="656c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">沙箱是一种虚拟化环境，用于运行与主机分离的恶意文件。这通常在隔离环境中进行，主要目的是分析恶意软件在系统中的行为方式。一旦恶意软件被确认，将基于二进制文件的特征创建唯一的签名和规则。</p><h2 id="1056" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">启发式和行为检测</h2><p id="a78f" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">启发式和行为检测在当今的现代反病毒产品中已经变得必不可少。现代反病毒软件依靠这种类型的检测来检测恶意软件。启发式分析使用各种技术，包括静态和动态启发式方法:</p><ol class=""><li id="3bfc" class="lv lw iq jp b jq jr ju jv jy lx kc ly kg lz kk ma mb mc md bi translated">静态启发式分析是提取恶意软件源代码的过程。然后，将提取的源代码与其他众所周知的病毒源代码进行比较。这些源代码是预先已知的，并在启发式数据库中预定义。如果匹配达到或超过阈值百分比，代码将被标记为恶意代码。</li><li id="6570" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk ma mb mc md bi translated">动态启发式分析基于预定义的行为规则。安全研究人员分析了隔离和安全环境中的可疑软件。根据他们的发现，他们将该软件标记为恶意软件。然后，创建行为规则来匹配目标机器内的软件恶意活动。</li></ol><p id="c110" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是行为规则的示例:</p><ul class=""><li id="22b5" class="lv lw iq jp b jq jr ju jv jy lx kc ly kg lz kk my mb mc md bi translated">如果一个进程试图与包含用户的NTLM散列、Kerberos票据等等的LSASS.exe进程进行交互</li><li id="19fd" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">如果进程打开监听端口并等待从命令和控制(C2)服务器接收命令</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/bc299860e6b4b90eaa486c744542c541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hHesVemd48abdsj-.png"/></div></div></figure><h2 id="f812" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">检测摘要:</h2><p id="e4ee" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">在图中，你可以看到一个可疑的Foobar.zip文件被传递给反病毒软件进行扫描。</p><ul class=""><li id="6957" class="lv lw iq jp b jq jr ju jv jy lx kc ly kg lz kk my mb mc md bi translated">反病毒软件识别出它是一个压缩文件(。zip)。</li><li id="1209" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">软件识别并应用解压缩功能来提取文件(Foobar.exe)。</li><li id="e93a" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">接下来，它识别文件类型以知道使用哪个模块，然后执行pe解析操作来提取二进制文件的信息和其他特征。</li><li id="5002" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">接下来，它检查文件是否打包；如果是，它就解包代码。</li><li id="4f29" class="lv lw iq jp b jq me ju mf jy mg kc mh kg mi kk my mb mc md bi translated">最后，它将收集的信息和二进制文件传递给反病毒引擎，在那里它试图检测它是否是恶意的，并给我们结果。</li></ul><p id="427c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为安全专业人员，您需要了解防病毒产品如何随着新型病毒攻击而更新。</p><p id="1952" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读:)</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="3982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。加入我们的每周简讯，以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！<a class="ae na" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"><em class="nh"/></a></p></div></div>    
</body>
</html>