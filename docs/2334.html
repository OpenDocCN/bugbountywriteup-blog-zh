<html>
<head>
<title>S3 Bucket: Cloud Trail Log Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">S3桶:云轨迹日志分析</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/s3-bucket-cloud-trail-log-analysis-ddefee0f025f?source=collection_archive---------2-----------------------#2022-08-31">https://infosecwriteups.com/s3-bucket-cloud-trail-log-analysis-ddefee0f025f?source=collection_archive---------2-----------------------#2022-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c1f97a37dc126bd5e2fe7b6cee006442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nhA9WMZTk5dWIKhg.png"/></div></div></figure><p id="1171" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章提供了我在<a class="ae kw" href="https://cyberdefenders.org/blueteam-ctf-challenges/84" rel="noopener ugc nofollow" target="_blank"> CyberDefenders </a>网站上解决由<a class="ae kw" href="https://twitter.com/0xdabbad00" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> Scott Piper </em> </a>创建的<strong class="ka ir"> Bucket </strong> CTF挑战的方法，这是一个蓝色团队专注的挑战，要求你分析AWS云轨迹日志的副本，并找出允许成功妥协发生的错误配置。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="8e9c" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">放弃</h1><p id="c8b2" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">我喜欢在一篇文章之前添加一个简短的免责声明，以鼓励人们在阅读本文之前尝试一下这个房间，因为在这篇文章中显然会有<strong class="ka ir">剧透</strong><strong class="ka ir"/>。我相信，如果你先自己尝试一下，然后在遇到困难或需要提示时再来写这篇文章，你会更喜欢CTF。因此，没有任何进一步的拖延，让我们开始吧！</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="d952" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">网络卫士问答</h1><p id="e256" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 1。</em> </strong> <strong class="ka ir"> <em class="kx">用于配置凭证的完整AWS CLI命令是什么？</em>T19】</strong></p><p id="390d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AWS CLI将您使用“<em class="kx"> aws configure </em>指定的敏感凭证信息存储在名为“<em class="kx"> credentials </em>”的本地文件中，该文件位于名为“”的文件夹中。<em class="kx"> aws </em>"在你的主目录下。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="62c3" class="mr lg iq mn b gy ms mt l mu mv">aws configure</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/fcb4d57a5656753efc2c6bc6c827f6fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sU336zOPck97wQfghswzlw.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">用于配置凭据的AWS CLI命令。</em></figcaption></figure><p id="174c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">T29】2。 </strong> <strong class="ka ir"> <em class="kx">桶“flaws2-logs”的“创建”日期是什么时候？</em> </strong></p><p id="001b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我登录到AWS管理仪表板并选择S3服务，在那里我看到有一个名为“<em class="kx"> flaws2-logs </em>”的单个存储桶，它是创建于“<em class="kx">2018年11月19日，20:54:31 (UTC+00:00) </em>”。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/cf7b6d27766b6f06a0ae9abab623f512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BEnyStrd9jxU4b-leczsVg.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb"> S3桶“flaws2_logs”详情。</em></figcaption></figure><p id="f71d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 3。</em> </strong> <strong class="ka ir"> <em class="kx">第一个生成的事件叫什么名字——按时间？</em>T49】</strong></p><p id="cdea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">选择S3桶"<em class="kx"> flaws2_logs </em>"并向下导航文件夹结构，我可以看到桶中存储了八个日志对象，从上到下按最旧到最新排序。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/385e22bb4c2f59c2a2bccafe5ab53935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQKmfA5roBtrkwuwCmIzgA.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb"> S3斗物体。</em></figcaption></figure><p id="c2aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我下载了所有八个日志文件，并使用了命名约定"<em class="kx"> CloudTrail-#。json </em>”，其中“<em class="kx"> CloudTrail-1.json </em>”最老。我打开“<em class="kx"> CloudTrail-1.json </em>”文件，看到生成的第一个事件名是“<em class="kx"> AssumeRole </em>”。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/b026261e5071a0c0a2a83b1c3db86558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rPZIicn1b7oZNwCWG_TkA.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">根据时间生成的第一个事件的名称。</em></figcaption></figure><p id="a2e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 4。</em></strong><strong class="ka ir"><em class="kx">UTC时间2018–11–28 23:03:20事件是由哪个源IP地址生成的？</em>T71】</strong></p><p id="d7ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在回顾了Cloud Trail logs JSON结构之后，我决定创建一个名为“<em class="kx"> json_print.py </em>的简单python脚本来回答这个问题。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/ce2536106fc231c2ac5ac5eda85ce0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppsB-NowIkeEf5Ni7iSDeA.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">“JSON-print . py”python脚本。</figcaption></figure><p id="ab09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">执行这个脚本后，我可以看到源IP地址是"<em class="kx"> 34[。]234[.]236[.]212 </em>”。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="11ee" class="mr lg iq mn b gy ms mt l mu mv">python3 json-print.py CloudTrail-4.json</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/ba2334ead0f76603955465d203e40500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*vJexC1gvvkqH5JRHsTMoIQ.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">源IP地址是“34[。]234[.]236[.]212" </em> <em class="nb">生成了日期为2018年11月28日23:03:20 UTC </em>的事件</figcaption></figure><p id="5130" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在VirusTotal中搜索IP地址，显示其属于亚马逊AWS基础设施。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/5ea413c371d9fa8e9a4b73d4367b1020.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*xjQhEodwIyiWyUgvijKsVg.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">属于亚马逊AWS基础设施的IP地址。</em></figcaption></figure><p id="b861" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 5。</em> </strong> <strong class="ka ir"> <em class="kx">哪个IP地址不属于亚马逊AWS基础设施？</em> </strong></p><p id="a95c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回顾上图中的IP地址，我可以看到IP地址"<em class="kx"> 104[。]102[.]221[.]250 </em>”。查看VirusTotal中的IP地址显示，它不属于亚马逊AWS基础设施。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/5edc00505e1445e9ddb4001364879ccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*Z704jyNMW5GMwWYoGuJG5A.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb"> IP地址不属于亚马逊AWS基础设施。</em></figcaption></figure><p id="59e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 6。</em> </strong> <strong class="ka ir"> <em class="kx">哪个用户发出了“ListBuckets”请求？</em>T29】</strong></p><p id="6a07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看日志文件“<em class="kx"> CloudTrail-7.json </em>”，可以看到单个事件。我决定使用一个名为<a class="ae kw" href="https://beautifier.io/" rel="noopener ugc nofollow" target="_blank">beautiier . io</a>的网站来帮助格式化JSON代码。我可以看到用户“<em class="kx"> level3 </em>”发出了“<em class="kx"> ListBuckets </em>”请求。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/2217f91e020303adf85856d4bf7194b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*wuZM7QM3Bi-zKhWSLPp0FA.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">“level 3”用户发出了“ListBuckets”请求。</em></figcaption></figure><p id="22f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">7<em class="kx">。</em> </strong> <strong class="ka ir"> <em class="kx">用户“level1”发出的第一个请求是什么？</em>T47】</strong></p><p id="ef63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看日志文件"<em class="kx"> CloudTrail-2.json </em>，我可以看到一个事件，它显示用户发出的第一个请求"<em class="kx"> level1 </em>"是"<em class="kx"> CreateLogStream </em>"。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/92f8f6027b8c008dba3d751f50e90488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*LQP6C4s1yafUYNlggyiEdw.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">“级别1”用户发出了“创建日志流”请求。</em></figcaption></figure></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="807b" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">事件调查</h1><p id="4c91" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">利用从回答上述问题中获得的信息，我开始进一步调查该事件。当测试S3的时候，你首先要做的事情之一就是看看S3桶的政策是什么。存储桶策略和访问控制列表(ACL)用于访问控制，充当允许和拒绝访问S3资源的前线。我们可以使用aws-cli检索“<em class="kx"> flaws2-logs </em>”存储桶的存储桶策略，或者通过S3管理控制台查看该策略。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="f1ea" class="mr lg iq mn b gy ms mt l mu mv">aws s3api get-bucket-policy --bucket flaws2-logs</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/0069283a2c2f5e8e8657d61db7fb44c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*6ARk04cD9cWIzp-M_N_sFA.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">“flaws 2-logs”存储桶策略。</em></figcaption></figure><p id="80a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可以看到，使用星号通配符将主体(即可以请求对AWS资源进行操作的人或应用程序)设置为任何人，并且S3操作“<em class="kx"> GetObject </em>”允许从桶中检索对象。我还可以看到任何人都可以执行“<em class="kx"> ListBucket </em>”和“<em class="kx"> GetBucketLocation </em>”动作。多年来，由于开放亚马逊S3桶，一些大公司发生了大量严重的数据泄露。为了测试"<em class="kx"> flaws2-logs </em> " S3桶的开放性，我可以尝试通过它的URL访问它。存储桶的URL格式有两种选择:</p><ul class=""><li id="c86a" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated"><a class="ae kw" href="http://s3.amazonaws.com/[bucket_name]/" rel="noopener ugc nofollow" target="_blank"><em class="kx">http://S3 . Amazon AWS . com/[bucket _ name]/</em></a></li><li id="4970" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/[bucket_name].s3.amazonaws.com/"><em class="kx">http://[bucket _ name]. S3 . Amazon AWS . com/</em></a></li></ul><p id="6f18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">私有存储桶将返回“拒绝访问”的消息，并且不会显示任何存储桶内容。但是，对于公共存储桶，单击URL将列出该存储桶中包含的前1000个文件。键入“<em class="kx">http://s3.amazonaws.com/flaws2-logs/</em>”显示该桶是可公开访问的，我可以看到存储在桶中的八个云轨迹日志。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/7020727423fb1aa5972a5d6e7f865f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*PO-cgOvqoD1b6iCnWiyTFQ.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">“flaws 2-logs”桶可公开访问。</em></figcaption></figure><p id="ed3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然我们已经确认了公众可以访问这个bucket，以及可以执行哪些请求，那么接下来我将更详细地查看日志。如果我查看日志文件"<em class="kx"> CloudTrail-7.json </em>，我可以看到一个"<em class="kx"> ListBucket </em>"来自用户的请求"<em class="kx"> level3 </em>"。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/2217f91e020303adf85856d4bf7194b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*wuZM7QM3Bi-zKhWSLPp0FA.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">“level 3”用户发出了“ListBuckets”请求。</em></figcaption></figure><p id="b2e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查该角色时，我们看到描述中声明该角色只应由ECS服务运行，因为AssumeRolePolicyDocument只允许一个原则。<em class="kx"> 104[。]102[.]221[.]250 </em> " IP地址也不属于亚马逊AWS基础设施。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="6707" class="mr lg iq mn b gy ms mt l mu mv"><em class="kx">aws --profile target_security iam get-role --role-name level3</em></span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/b8e851e76aaf879dc8ce11e9a088c711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*A68dcBHqmKI9sQ9eOorTfw.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">“level 3”角色描述。</em></figcaption></figure><p id="e526" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基于这些详细信息，我们可以假设ECS容器一定被黑客攻击了，凭据被盗了，因为通常情况下，我们会看到资源(在本例中是ECS)从其自己的IP而不是"<em class="kx">104[]发出AWS API调用。]102[.]221[.]250 </em>”。回顾之前的事件，我可以看到用户“<em class="kx"> level1 </em>”执行了“<em class="kx"> ListImages </em>”、“<em class="kx"> BatchGetImage </em>”和“<em class="kx"> GetDownloadUrlForLayer </em>”请求。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="311d" class="mr lg iq mn b gy ms mt l mu mv">python3 json-print.py CloudTrail-5.json</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/431f3ed06c960bd8df76e78ac7ab96c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*70OShmmQAlSeynhrP92SVg.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">“level 1”执行了“BatchGetImage”和“GetDownloadUrlForLayer”请求。</em></figcaption></figure><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="668e" class="mr lg iq mn b gy ms mt l mu mv">python3 json-print.py CloudTrail-4.json</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/a00cbddf67f42884a8a84f435726dd3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4iAfMEK8PITrbUIf1TtcHQ.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">“level 1”执行了“ListImages”请求。</em></figcaption></figure><p id="ce1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查"<em class="kx"> ListImages </em>"请求，我可以看到事件在请求参数中包含一个名为"<em class="kx"> level2 </em>"的存储库。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/583d2b2f37a63a56ce8ec05d12f58d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*Dzl37FTmz5JoZpOQvIVKIQ.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb">事件在请求参数中包含一个名为“level2”的存储库。</em></figcaption></figure><p id="f538" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以查看弹性容器注册中心(ECR)的策略，我们看到主体是"<em class="kx"> * </em>"，这意味着这些操作对任何人都是公开的。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="5e90" class="mr lg iq mn b gy ms mt l mu mv">aws --profile target_security ecr get-repository-policy --repository-name level2</span></pre><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/d3342f7088e58a528ccb556345fa54de.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*vNO1F6F7O1q1oHyrTYULMA.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated"><em class="nb"> ECR“二级”储存库。</em></figcaption></figure></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="2c6b" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">事故影响和建议</h1><p id="3674" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">亚马逊S3被认为是一个公众可访问的平台。这意味着通过正确的URL和权限，可以从任何地方通过HTTP请求访问任何bucket，就像普通浏览器访问网站一样。公共水桶是AWS和S3最大的健康风险之一。据报道，由于S3糟糕的安全状况导致的错误配置，导致了大量数据泄露。存储桶策略和存储桶或对象ACL允许您将其配置为任何人都可以访问。许多管理员忽略了这一点，让他们的S3资源开放，而不知道他们这样做。当然，AWS有强调这一点的提示和警告，并试图防止这种类型的安全漏洞，但这并没有阻止许多敏感数据通过这个简单的错误泄漏的发生。</p><p id="09eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">建议包括:</p><ul class=""><li id="b6dc" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated"><strong class="ka ir">S3水桶的监控</strong>。没有监控，就没有稳定的方法来检查对您的S3环境的访问。</li><li id="430b" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated"><strong class="ka ir">S3环境的测试和审计</strong>。像漏洞评估甚至简单的渗透测试这样简单的事情将有助于突出可以容易修复的问题。</li><li id="b95c" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated"><strong class="ka ir">避免宽松政策</strong>。如果策略允许太多用户访问S3资源，那么如果这些帐户受到威胁，就会出现问题。</li></ul></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="de56" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结束语</h1><p id="a89c" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">我真的很喜欢通过这个CTF工作，并有机会了解更多关于调查云踪迹日志以发现成功入侵的迹象。谢谢你一直读到最后，继续黑下去😄！</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="2691" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae kw" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kx">加入我们的每周简讯</em> </strong> </a> <em class="kx">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>