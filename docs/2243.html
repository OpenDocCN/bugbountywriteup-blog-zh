<html>
<head>
<title>Smart contract security best practices: PART 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">智能合约安全性最佳实践:第1部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/smart-contract-security-best-practices-part-1-c35b640ee2ff?source=collection_archive---------3-----------------------#2022-08-05">https://infosecwriteups.com/smart-contract-security-best-practices-part-1-c35b640ee2ff?source=collection_archive---------3-----------------------#2022-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f6ea0cd34e1844a36da70def0cdc9c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BeMtN1SG9nltxVa0o42LbQ.png"/></div></div></figure><p id="082c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大家好，希望你们做得好，今天，我们将讨论智能合同安全性，这是每个开发人员在创建智能合同之前都应该知道的事情。智能合约是在区块链上运行的代码片段，处理数百万美元的交易。一个简单的缺陷就可能导致一百万美元的损失。为了避免这种情况，我们今天将学习安全最佳实践。</p><p id="490c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们开始吧</p><p id="957c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">状态更改必须在外部调用之前完成:</strong></p><p id="35b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据Consensys的说法，“如果你正在调用一个不受信任的外部合同，<em class="kw">避免调用后的状态变化</em>为了更好地理解它，让我们看一看易受攻击的代码。</p><p id="b848" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">举例:</strong></p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/e04d0263ea813ad49a7f94c99ed933f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KLOF-UZk36MP-4XsgYQ8Nw.png"/></div></div></figure><p id="e050" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上述合同有两个功能，即存款和取款。把它想象成一家银行。用户可以存钱，也可以取钱。</p><p id="ee49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里的问题是没有检查用户是否有足够的钱来取款。</p><p id="5186" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二个可能是。<strong class="ka ir"> <em class="kw">调用()</em> </strong> <em class="kw"> </em>函数。这可能会导致可重入攻击。注意<code class="fe lc ld le lf b">.call()</code>对减轻重入攻击没有任何作用，所以必须采取其他预防措施。</p><p id="e101" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第三个缺陷可能是balance在将金额转移给调用者后被更新。</p><p id="67d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">那么如何解决这个问题呢？</strong></p><p id="3930" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了解决这个问题，我们需要使用检查-效果-交互模式。</p><p id="b051" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">什么是检查-效果-交互模式？</strong></p><p id="dacd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">支票-效果-交互模式是指在将资金转移到外部合同之前必须执行的各种检查。这样才能防止资金流失。</p><p id="d378" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们来看看固定代码。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/146b1e4ffe344959f6c407d4a38b25fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p_Mx56vx4Gt6Si8fIuCA4w.png"/></div></div></figure><p id="2f6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的合同中，取款功能有一定的检查，包括1)用户是否有足够的余额</p><p id="ad38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2)在转移资金之前完成状态更改</p><p id="6e49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3)<strong class="ka ir"><em class="kw">的用法。转移()</em> </strong>功能代替<strong class="ka ir"> <em class="kw">。调用()。</em> </strong>注意，<strong class="ka ir"> <em class="kw"> transfer() </em> </strong>功能有一个气体上限2300，这种方式会防止重入攻击。</p><p id="7d13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在2022年前六个月损失的钱是2021年全年的两倍。为了避免这些攻击，开发人员应该将安全最佳实践纳入他们的智能合同中。</p><p id="9b48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要了解更多关于web3安全性的信息，请在Twitter上关注我。</p><p id="a22a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lh" href="https://twitter.com/UV_virus" rel="noopener ugc nofollow" target="_blank">https://twitter.com/UV_virus</a></p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="f8b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。 <a class="ae lh" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kw">加入我们的每周简讯</em> </strong> </a> <em class="kw">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>