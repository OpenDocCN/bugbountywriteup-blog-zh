<html>
<head>
<title>Brave Browser Script Blocker Bypass Vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">勇敢的浏览器脚本拦截器绕过漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/brave-browser-script-blocker-bypass-vulnerability-fffd659c5a7?source=collection_archive---------0-----------------------#2018-10-13">https://infosecwriteups.com/brave-browser-script-blocker-bypass-vulnerability-fffd659c5a7?source=collection_archive---------0-----------------------#2018-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="88a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我想分享我几天前发现的<a class="ae kl" href="https://brave.com" rel="noopener ugc nofollow" target="_blank">勇敢浏览器</a>中的一个漏洞。勇敢浏览器是一个开源浏览器，具有广告拦截和跟踪保护功能。它包括一个内置的JavaScript拦截器，允许用户选择性地阻止用户指定域上的JavaScript。我找到了绕过阻断器的方法。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/bb3a454eefd6504387dc4dc2a4135b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VdMUyDh8UfNdvycEVgNtCA.png"/></div></div></figure><p id="fab8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现的这个bug是受最近披露的Tor浏览器NoScript bypass漏洞的启发，<a class="ae kl" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-16983" rel="noopener ugc nofollow" target="_blank">CVE-2018–16983</a>[1]。NoScript的问题是:如果你将一个网页的<code class="fe ky kz la lb b">Content-Type</code>设置为<code class="fe ky kz la lb b">text/html;/json</code>，那么这个页面就可以执行JavaScript，即使用户在Tor中将安全级别设置为“最安全”。NoScript是一个Firefox插件，而Brave是基于<a class="ae kl" href="https://github.com/brave/muon" rel="noopener ugc nofollow" target="_blank"> muon </a>，一个从<a class="ae kl" href="https://electronjs.org/" rel="noopener ugc nofollow" target="_blank"> Electron </a>修改而来的框架，所以Brave的内置脚本拦截器不太可能遭受同样的漏洞。尽管如此，我还是决定在Brave上测试一下。</p><p id="1b46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我写了一个非常简单的PoC:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="3265" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了设置<code class="fe ky kz la lb b">Content-Type</code>，我用Fiddler AutoResponder钩了一个URL，比如<code class="fe ky kz la lb b">http://example.com/index.html</code>:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi le"><img src="../Images/c7b8a2deb1d495bfa6981bc121a7675f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PfmwOkcclctwCOotg6v40w.png"/></div></div></figure><p id="7382" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原来<code class="fe ky kz la lb b">&lt;script&gt;alert(1);&lt;/script&gt;</code>被执行了，但是<code class="fe ky kz la lb b">&lt;script src="js.js"&gt;&lt;/script&gt;</code>被封杀了。然后我把<code class="fe ky kz la lb b">Content-Type</code>换成了正常的<code class="fe ky kz la lb b">text/html</code>。结果是一样的。所以很明显<code class="fe ky kz la lb b">Content-Type</code>是不相关的。外部JavaScript文件被正确阻止，但内联JavaScript被错误地允许，即使脚本被设置为禁用。</p><p id="5fac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">演示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lf"><img src="../Images/a5371ebe61d6e6a02893c774e380abd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8anWmGGKxkdMbVE6jMyjPw.jpeg"/></div></div></figure><p id="6a29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在2018年9月26日向HackerOne 上的<a class="ae kl" href="https://hackerone.com/brave" rel="noopener ugc nofollow" target="_blank"> Brave Software报告了这个漏洞。很快</a><a class="ae kl" href="https://github.com/brave/browser-laptop/issues/15232" rel="noopener ugc nofollow" target="_blank">三分</a>和<a class="ae kl" href="https://github.com/brave/muon/pull/651" rel="noopener ugc nofollow" target="_blank">固定</a>。固定版本于10月8日在<a class="ae kl" href="https://github.com/brave/browser-laptop/releases/tag/v0.25.2dev" rel="noopener ugc nofollow" target="_blank">版本0.25.2 </a>发布。这个漏洞也是David Albert独立发现的。</p><p id="7fce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">参考文献</strong></p><p id="1d82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[1]<a class="ae kl" href="https://www.zdnet.com/article/exploit-vendor-drops-tor-browser-zero-day-on-twitter/" rel="noopener ugc nofollow" target="_blank">https://www . zdnet . com/article/exploit-vendor-drops-tor-browser-zero-day-on-Twitter/</a></p></div></div>    
</body>
</html>