<html>
<head>
<title>Identifying &amp; Escalating HTTP Host Header Injection attacks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">识别和升级HTTP主机报头注入攻击</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/identifying-escalating-http-host-header-injection-attacks-7586d0ff2c67?source=collection_archive---------0-----------------------#2020-10-30">https://infosecwriteups.com/identifying-escalating-http-host-header-injection-attacks-7586d0ff2c67?source=collection_archive---------0-----------------------#2020-10-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f4d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">HTTP主机头的目的是帮助识别客户机想要与哪个后端组件通信。一些错误的配置和有缺陷的业务逻辑会使网站暴露于通过<em class="kl"> HTTP主机头</em>的各种攻击。在深入研究之前，让我们先了解一些基本术语。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/8fccaea9e212fb8a4b2bc54d18be4224.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*LkyNvhGLdza7ySwoJRW44Q.gif"/></div></figure><h2 id="8170" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated"><strong class="ak">什么是HTTP头？</strong></h2><p id="4f75" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated"><strong class="jp ir"> HTTP头</strong>让客户机和服务器通过HTTP请求或响应传递附加信息。HTTP头由不区分大小写的<strong class="jp ir"><em class="kl"/></strong>名称、冒号(<code class="fe ls lt lu lv b">:</code>)和值组成。</p><h2 id="2741" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated"><strong class="ak">什么是主机头？</strong></h2><p id="11c8" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated"><em class="kl">主机</em>请求头是强制头(根据HTTP/1.1 ),它指定请求要发送到的服务器的主机和端口号。</p><p id="293e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果没有包含端口，则默认端口是所请求服务的默认端口，<em class="kl"> 443表示HTTPS URL，80表示HTTP URL。</em></p><p id="00ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例:<code class="fe ls lt lu lv b">Host: mysite.net</code></p><h2 id="7f9a" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">什么是转发头？</h2><p id="d168" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated"><code class="fe ls lt lu lv b">Forwarded</code>报头包含来自反向代理服务器的信息，当请求路径中涉及代理时，这些信息会被更改或丢失。</p><p id="077c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该割台的替代和实际标准版本为<code class="fe ls lt lu lv b">X-Forwarded-For</code>、<code class="fe ls lt lu lv b">X-Forwarded-Host</code>和<code class="fe ls lt lu lv b">X-Forwarded-Proto headers</code>。</p><p id="f3d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个头用于调试、统计和生成位置相关的内容，并且通过设计，它暴露了隐私敏感信息，例如客户端的IP地址。</p><p id="be39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例:<code class="fe ls lt lu lv b">X-Forwarded-For: yoursafesite.net</code></p><h1 id="2110" class="lw kv iq bd kw lx ly lz kz ma mb mc lc md me mf lf mg mh mi li mj mk ml ll mm bi translated">什么是主机头攻击？</h1><p id="8168" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated"><em class="kl"> HTTP主机头</em>攻击利用易受攻击的网站，这些网站以不安全的方式处理主机头的值。如果服务器隐式信任主机头，并且未能正确验证或转义它，则攻击者可能能够使用此输入来注入有害的有效负载，从而操纵服务器端的行为。</p><h2 id="d39c" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">到底是什么缺陷，哪里可能出错？</h2><p id="44e1" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">以前，每个IP地址只能承载一个域的内容。但今天，在同一个IP地址下访问多个网站和应用程序是很常见的。因为多个应用可通过相同的IP地址访问，关于通过代理虚拟托管或路由流量。寻找原点很容易迷路。因此，应用程序依赖于<strong class="jp ir">主机</strong>头来指定预期的接收者。</p><h1 id="9493" class="lw kv iq bd kw lx ly lz kz ma mb mc lc md me mf lf mg mh mi li mj mk ml ll mm bi translated">如何测试应用程序是否容易受到主机头注入的攻击？</h1><p id="90de" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">对主机头注入的测试很简单，您需要做的就是确定您是否能够修改<strong class="jp ir"> <em class="kl">主机</em> </strong> <em class="kl"> </em>头，并且仍然能够达到目标应用程序的请求。如果是这样，检查应用程序并观察这对响应有什么影响。</p><p id="e018" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下图描述了来自web应用程序的有效请求-响应。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/2d8e16eb708fc1359e974dcdd0714f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ceoX3XhyUfCjJguZAzXAQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">主持人:demo.testfire.net</figcaption></figure><p id="c7c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 1。提供一个任意的主机头- </strong>尝试在请求中提供一个随机的主机，并观察应用程序的行为。如果收到200 OK，攻击可能会进一步升级。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mw"><img src="../Images/62470b2e6bc4cbb0dea4a5a016d8dc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*npHitORGbHxfOYfCuUhW8w.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">主持人:attackersite.net——200好吧</figcaption></figure><p id="00f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。注入重复的主机头- </strong>尝试注入多个<em class="kl">主机</em>头，如果收到一个200 OK，你可以把它当作一个肯定。但是在这里，在这种情况下，应用程序不能识别多个主机头。因此，会收到400状态代码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mx"><img src="../Images/ed1e5c04e5df1315ce84119e703e83ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fP_HYmaV2jL485hfS4w87g.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">多个主机标头</figcaption></figure><p id="6814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。添加换行- </strong>尝试在<em class="kl">主机</em>标题中添加带有“attackersite”的换行。寻找一个成功的200 OK响应。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi my"><img src="../Images/79f8846eb77398a3aad18bc7d08e4bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0l4BNwK3MW4BCWBl-9Wxmg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">换行— 200可以</figcaption></figure><p id="6644" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。注入主机覆盖头- </strong>尝试注入主机覆盖头，如-<code class="fe ls lt lu lv b">X-Forwarded-Host, X-Host, X-Forwarded-Server, X-HTTP-Host-Override<br/>Forwarded</code>；通过一个成功的200 OK响应来查看报头是否被支持。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mz"><img src="../Images/22321804c1a61f0aa4aff028372bb14f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VF3MrhruejeenEgqt4wVtw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">x-转发-主机:attackersite.com-200 OK</figcaption></figure><p id="1776" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5。提供绝对URL- </strong>尝试在主机头中的请求&amp; attackersite中提供绝对URL。关注一个成功的200 OK。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi na"><img src="../Images/77bc37e198b528a3ebd62b63b01dfea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZOoOXEff_rI5zyORqf5rQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">绝对URL — 200可以</figcaption></figure><h1 id="0a63" class="lw kv iq bd kw lx ly lz kz ma mb mc lc md me mf lf mg mh mi li mj mk ml ll mm bi translated">作为攻击者你能做什么？</h1><p id="3da5" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">如果不对头值进行适当的验证，攻击者可以提供无效的输入，使web服务器:</p><ol class=""><li id="12e3" class="nb nc iq jp b jq jr ju jv jy nd kc ne kg nf kk ng nh ni nj bi translated">将请求分派给列表中的第一个虚拟主机</li><li id="b167" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">导致重定向到攻击者控制的域</li><li id="041f" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">执行web缓存中毒</li><li id="e633" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">操作密码重置功能</li><li id="b8d1" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">操纵特定功能中的业务逻辑缺陷</li><li id="2185" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">执行基于路由的SSRF</li><li id="e559" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">披露经典的服务器端漏洞，如SQL注入</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/310ebc7bd20f8447c8e6842e878ad2b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/1*hhPOwNYXrmKtt83urSIpzQ.gif"/></div></figure><h1 id="6514" class="lw kv iq bd kw lx ly lz kz ma mb mc lc md me mf lf mg mh mi li mj mk ml ll mm bi translated">升级攻击—如何利用配置错误的主机头？</h1><p id="6a95" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">HTTP主机报头漏洞通常是由于<strong class="jp ir">错误的假设“报头不是用户可控制的”而产生的。</strong>这在主机头中创建了某种信任，并导致不正确的验证或用户输入的逃逸。</p><h2 id="5f3e" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">执行web缓存中毒</h2><p id="3665" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">看看<em class="kl">主机</em>头是否反映在没有HTML编码的<em class="kl">响应标记</em>中，或者甚至直接用于脚本导入。</p><p id="1dfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ls lt lu lv b">GET / HTTP/1.1<br/>Host: attackersite.com</code> <br/> <br/>当受害者访问易受攻击的应用程序时，web缓存会提供以下内容。<br/> <code class="fe ls lt lu lv b">&lt;link src=”http://attackersite.com/link" /&gt;</code></p><h2 id="988c" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">导致重定向到攻击者控制的域</h2><p id="5aba" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">尝试使用上述方法:将应用程序重定向到攻击者控制的域。查看攻击者的域中是否泄露或记录了任何敏感的令牌或密钥。</p><h2 id="a80f" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">操作密码重置功能</h2><p id="86ff" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">当创建使用<em class="kl">生成的秘密令牌</em>的密码重置链接时，如果密码重置功能包括<em class="kl">主机</em>报头值。</p><p id="382d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果应用程序处理一个<em class="kl">攻击者控制的域</em>来创建一个密码重置链接，受害者可以<strong class="jp ir">点击电子邮件中的链接</strong>和<strong class="jp ir">允许攻击者获得重置令牌</strong>，从而重置受害者的密码。</p><blockquote class="nq nr ns"><p id="551b" class="jn jo kl jp b jq jr js jt ju jv jw jx nt jz ka kb nu kd ke kf nv kh ki kj kk ij bi translated">…电子邮件…</p><p id="50c1" class="jn jo kl jp b jq jr js jt ju jv jw jx nt jz ka kb nu kd ke kf nv kh ki kj kk ij bi translated">点击以下链接重置您的密码:<code class="fe ls lt lu lv b">http://www.attackersite.com/account.php?module=login&amp;action=resetpassword&amp;token=&lt;YOUR_SECRET_TOKEN&gt;</code></p><p id="65b9" class="jn jo kl jp b jq jr js jt ju jv jw jx nt jz ka kb nu kd ke kf nv kh ki kj kk ij bi translated">…电子邮件…</p></blockquote><h2 id="4cbe" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">导致重定向到受限内部站点— SSRF</h2><p id="e466" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">易受攻击的主机标头也可能导致SSRFs，请注意是否可以通过重定向访问内部受限站点。</p><div class="nw nx gp gr ny nz"><a href="https://medium.com/bugbountywriteup/server-side-request-forgery-ssrf-exploitation-technique-9bc4b4045fbd" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">服务器端请求伪造— SSRF:利用技术</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">服务器端请求伪造，或SSRF，是一个漏洞，允许攻击者使用易受攻击的服务器进行…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on ks nz"/></div></div></a></div><p id="6f86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">&amp;记住是否:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/b0cd6e505eab7fd3587aad620c8caa95.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*l9NSm3KdujDLjxPGvgzmbQ.png"/></div></figure><p id="3cd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再见。</p><p id="6637" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">参考文献:</strong></p><div class="nw nx gp gr ny nz"><a href="https://portswigger.net/web-security/host-header" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">HTTP主机标头攻击|网络安全学院</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">在这一节中，我们将讨论错误的配置和有缺陷的业务逻辑如何将网站暴露给各种…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">portswigger.net</p></div></div><div class="oi l"><div class="op l ok ol om oi on ks nz"/></div></div></a></div><div class="nw nx gp gr ny nz"><a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/17-Testing_for_Host_Header_Injection" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">WSTG -最新</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">一个web服务器通常在同一个IP地址上托管几个web应用程序，通过…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">owasp.org</p></div></div><div class="oi l"><div class="oq l ok ol om oi on ks nz"/></div></div></a></div></div></div>    
</body>
</html>