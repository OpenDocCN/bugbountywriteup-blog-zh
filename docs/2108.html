<html>
<head>
<title>Malware Analysis [#2] — FFDroider</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">恶意软件分析[#2] — FFDroider</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/malware-analysis-ffdroider-21a3fc0fe40f?source=collection_archive---------2-----------------------#2022-05-30">https://infosecwriteups.com/malware-analysis-ffdroider-21a3fc0fe40f?source=collection_archive---------2-----------------------#2022-05-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/8ddb1296ed241efa28788b8b56ea3b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*C6OTNDOm4fL036YTnPjDwQ.png"/></div></figure><p id="e313" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是针对FFDroider stealer恶意软件的恶意软件分析报告，这是一种新的恶意软件，于2022年4月首次发现。</p><p id="649a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们今天的例子:MD5(B1 d 856 a Fe 8 ffd 2649843d 64 affe 9d 4 c 3)</p></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><h2 id="2abd" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated">静态分析:</h2><p id="04b8" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">在PEStudio中查看我们的示例，我们可以看到它是一个32位示例，具有高熵和最近编译的日期，并且该文件是在调试模式下编译的，它的原始名称也是“FbRobot.exe ”,并且有许多URL模式和大量资源列表:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/b1868f79800893b0ca3e25fb581184cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*wua9r-jppTgqBrb9M0QiPQ.png"/></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mc"><img src="../Images/ae14e44eff2ae666ae98300cd42dcbca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Pn1awcP5dZdjSqHiM6wTg.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">PEStudio:一般信息</figcaption></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/4d55e24488da1f473a2538e59f78d39d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*xKJCutnKSglkzAE1Xw9dtg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">PEStudio:一般信息</figcaption></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mm"><img src="../Images/1f4d63e718f655d4e5684bacb7bda5f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6-Da472_5hkerpn_Lckvg.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">资源文件</figcaption></figure><p id="005d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它有很多资源，但除了用中文写的“string.txt”文件外，没有什么值得一提的，所以我翻译了它，下面的图是文件的一些部分及其翻译:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mn"><img src="../Images/4fa5e0c3ab459af8f7fe75658dc10ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gv2X2XOhhn7lAJrNNfbZuA.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/5741d8978a76c165a700d21befb3dd36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*tvtj8eoewMWlJkU6_a9yxA.png"/></div></figure><p id="0f04" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">查看导入的功能，我们有许多网络连接功能:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/f49affdec29372d9557d264b88d791e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*vIcX4t9OP5yMqmOHPqxTmg.png"/></div></figure><p id="8bf4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从“检测它容易”看起来像是。正文”部分已打包:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mq"><img src="../Images/1936b913267bb9286e29ae20437a9505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0vqOE2n-ydpZLoiVHaesA.png"/></div></div></figure></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><h2 id="7244" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated">动态分析:</h2><p id="61bb" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">运行示例时，它创建一个名为“VcpVideoV1.0.1”的目录，并在其中创建自己的副本</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mr"><img src="../Images/fc0fbaf582d6a5d30e389fb0fe7dd4d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C6m49Tfy3i3pb5IZqDuXIA.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ms"><img src="../Images/663ca8805742ab84bd49d7ec9aff51ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehheI6OwVRCsuxztmIQkoA.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mt"><img src="../Images/939bce69b273db7b62dccdad07847192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrlbm1rrxcWOEbe5TBnNOQ.png"/></div></div></figure><p id="fde2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，我们可以看到它在“HKCU \软件”下创建了一个名为“ffdroider\FFDROIDER”的注册表项:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mu"><img src="../Images/539532dc087159066a04e1f394d2b0ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8LcWJdevvpr2jYXBHK7Swg.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/cf75f0173ce23a406e1c1a0233173714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*iTkxCU2wuM9iF1VzD4r9Og.png"/></div></figure><p id="dcaf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它还在执行示例的同一个目录中创建一个名为“d”的SQLite数据库文件，然后开始从Chrome目录中读取cookies并写入“d”文件，然后开始查询:</p><ul class=""><li id="c3ae" class="mw mx iq jw b jx jy kb kc kf my kj mz kn na kr nb nc nd ne bi translated">WebCache。</li><li id="aa9d" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">用户固定的应用程序。</li><li id="517e" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">开始菜单。</li><li id="0372" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">图书馆。</li><li id="f42d" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">链接。</li><li id="4fce" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">临时目录。</li><li id="27f3" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">Internet临时文件。</li></ul><p id="547c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">列表继续下去，我发现“d”文件是“Cookies”文件的副本:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nk"><img src="../Images/3f1f3e9f0a86568cd0c956a4876ed754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQVMfo4U8PchuO2It7lRZw.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nl"><img src="../Images/33c9dbff4440f76745c8e2734664d49b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z3BoySMprpdni7LvaW2rsw.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">图:“d”文件和“Cookies”文件的比较</figcaption></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nm"><img src="../Images/13c69ee802fc7eb58e1b622fa71932f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tV_KXs1n0U5ndCLCejnX4Q.png"/></div></div></figure><p id="4b99" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">用“sqlite browser”检查“d”文件，我发现了两个表，一个用于“Cookies ”,另一个用于“meta ”:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nn"><img src="../Images/125ff056a6318556f69715dcddcb7d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ta0v-CZueNK1YFdxhOy6AA.png"/></div></div></figure><p id="34a3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">恶意软件开始一个循环:</p><ul class=""><li id="d511" class="mw mx iq jw b jx jy kb kc kf my kj mz kn na kr nb nc nd ne bi translated">从“Cookie”文件读取并写入“d”文件。</li><li id="4b70" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">查询文件和目录。</li><li id="5a43" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">使用参数“-PID:123”启动新的“iElowutil.exe”进程以完成其工作，然后退出。</li></ul><p id="96df" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">“iElowutil.exe”是一个代理进程，它处理需要在低完整性级别进行处理的操作。发生这种情况是因为Internet Explorer和一套其他本机Windows应用程序需要检查提要和网页快讯以获取更新，这是由ielowutil.exe处理的，</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi no"><img src="../Images/9c2dab0a3a444426e0c0217d3045e77e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8uuKibM_3PjTFe-mmtc8YA.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi np"><img src="../Images/798c142d7caa9ca95457f277c8ed760d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TZgGtHkHKM7na26Qih1f3g.png"/></div></div></figure><p id="3045" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">该示例使用文件名创建了到C2服务器的2个internet连接:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nq"><img src="../Images/4c04466ef6a25d92395f93a381475986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EUlOjb1k5NDJDayV0lZ8ZQ.png"/></div></div></figure></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><h2 id="3367" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated"><strong class="ak">倒车:</strong></h2><p id="f161" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">开始时，恶意软件通过对象名为“37238328–1324242–5456786–8 fdff 0–67547552436675”的“CreateMutex”函数启动，如果该函数没有失败，它将使用“GetLastError”并将结果与“183(0xb 7)= Error _ already _ Exists<strong class="jw ir"/>进行比较，根据微软文档参见链接:</p><div class="nr ns gp gr nt nu"><a href="https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">系统错误代码(0-499) (WinError.h) - Win32应用程序</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">描述WinError.h头文件中定义的错误代码0-499，供开发人员使用。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">docs.microsoft.com</p></div></div><div class="od l"><div class="oe l of og oh od oi js nu"/></div></div></a></div><p id="9f84" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果它不存在，它将继续执行，但如果函数失败或错误消息为“Error_already_Exists ”,它将继续执行带有“&lt;&lt;&lt; Exit with same app&gt;&gt; &gt;”字符串的“OutputDebugStringA”函数。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/460f292dbc9c2e79b068857d385566b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*49oDbIkCebg-WYzCNRMkgQ.png"/></div></figure><p id="2d14" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，它通过调用“SHGetSpecialFolderPathW”函数在Documents文件夹中创建一个名为“VlcpVideosV1.0.1”的目录，该函数将检索一个特殊文件夹的路径，该路径由其<a class="ae ok" href="https://docs.microsoft.com/en-us/windows/win32/shell/csidl" rel="noopener ugc nofollow" target="_blank"> CSIDL </a>标识。使用的参数是“CSIDL _我的文档”来获取文档文件夹的路径，然后它将“//VlcpVideosV1.0.1”附加到路径中，并调用“PathFileExistW”来确定文件夹的路径是否有效，如果无效，它将使用“CreateDirectoryW”函数创建目录，然后使用“CopyFileW”将自身复制到新创建的目录中:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ol"><img src="../Images/5d6978cfe793eff01b622aaed857f4f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QP9DcGpwe8igioyJekFz7Q.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi om"><img src="../Images/e884c7461129aa5c9f5ca1aefaf2a647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOtOyIRyGQWj2nxlFPAZ7w.png"/></div></div></figure><p id="dde9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，恶意软件开始动态加载一些库并导入一个加密函数，解密函数实际上很简单，它从第一个字母与数字“5”进行异或运算开始，这个数字在每次循环后增加“1”，这意味着字符串[0]与“5”进行异或运算，字符串[1]与“6”进行异或运算，并一直进行到字符串的末尾。解密的字符串是:</p><ul class=""><li id="fa9e" class="mw mx iq jw b jx jy kb kc kf my kj mz kn na kr nb nc nd ne bi translated">加载库a。</li><li id="1020" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">Wininet.dll。</li><li id="ffcf" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">InternetGetCookieExW。</li><li id="8170" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">Ieframe.dll。</li><li id="f0af" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">IEGetProtectedModeCookie。</li><li id="a19f" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">netapi32.dll。</li><li id="52dd" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">NetWkstaGetInfo。</li><li id="c03b" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">NetApiBufferFree。</li><li id="4f8c" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">advapi32.dll。</li><li id="6167" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">RegCreateKeyW。</li><li id="a30b" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">iphlpapi.dll</li><li id="5fe8" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">GetAdaptersInfo。</li></ul><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/1225916cc1e5c343b582c5f636375642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*lVG9B_mPTPf5UQVRRb5-ZA.png"/></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/e9130d2ed75fabf750700f6738ac45af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*Zmd4VGvrwyPm7NaSnaQBng.png"/></div></figure><p id="308e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，恶意软件开始准备通过建立HTTP请求连接到"152.32.193.91/seemorebty/il.php C2服务器？e= <filename>":</filename></p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi op"><img src="../Images/151c2c5ac8d3607c1df6ff7eaf535f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*E35U_ALAYwhRP9KhbOez9A.png"/></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi oq"><img src="../Images/433bdc459a2f11a2b2de4b9840ae9acc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ecu8x70iC6BM8KpSYYOrMA.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi or"><img src="../Images/40be5d9a7ee3c53ddeb6aa1a4f5fee1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*bSn7tK1VZG4ZQzazsKoLGA.png"/></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi os"><img src="../Images/ed40b886537e6a5cb8f42dcf29228c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LJXy3yo-_6BM6C1E4lHXcA.png"/></div></div></figure><p id="1eba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，恶意软件开始使用前面提到的相同解密函数解密Chrome目录的路径，并打开Cookies文件:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ot"><img src="../Images/d2b39f0c0d68a7622ca361fce6e61edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-PuXFH-7sbqB0VD-wqSQFg.png"/></div></div></figure><p id="b69d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，恶意软件尝试检查名为“d”的SQLite文件是否存在，如果不存在，它将创建它，之后，它尝试打开另外两个名为“d-journal”“d-wal”的文件，但即使无法找到它们，也没有创建它们，然后读取、查询和写入的过程开始循环:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ou"><img src="../Images/adcce3b190bf179a5f4e494c1a993c6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_eutq7RE_y0i9RmufeuK7g.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/6ffde2c752c3fc41f9f8c010813fdfd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*SdSsxqJbduF029EJb5xTFg.png"/></div></figure><p id="ff59" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，它开始设置顶级域名，将其添加为“amazon”域名，然后添加“https://www。”到域:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ow"><img src="../Images/16545c02a87fa349a037ebc98f61e967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MumfiB9MdQG3Xo6N0hpM7Q.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ox"><img src="../Images/656e4ebf41f709d52c684e9b8adb26a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*TW6gr7_LlukwftK3fsJkdw.png"/></div></div></figure><p id="1fd1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，它将开始建立一个新的HTTP get请求，然后尝试打开名为“install.exe”的文件，这可能是从C2安装的第二阶段。我试图模仿恶意软件的请求来安装第二阶段，但没有从C2服务器获得任何响应(最新的样本IP地址):</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi oy"><img src="../Images/cde0e7ee5dd44e978e4176aaf9a13d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mrivRrTnvHtjB6jmEUhp8Q.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/dfe4f96cc9a4590de1947676d5de0afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*vKVcGNvFeXjiWzqPKso8qw.png"/></div></figure><p id="cc8b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它还尝试使用“ShellExecuteExW”执行名为“tmp.exe”的文件，然后删除名为“install.exe”的文件:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/1528447c278ce17ade73cd5520049005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*uYgMKF7BfVQFDMRE5TwHSg.png"/></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pb"><img src="../Images/c52b9edc5e351529f45934cc91de52c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h52lMOU-3BvUl2New0WZiA.png"/></div></div></figure><h2 id="4554" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated">C2基础设施:</h2><p id="673a" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated">该示例的C2服务器IP已关闭，因此我查找了向“MalwareBazaar”报告的最新示例，并获得了C2服务器的IP地址，然后我去检查了基础架构，以下是我的发现:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pc"><img src="../Images/5bb5547f70c57fbf8ee763f51fd31d32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhGYyQUwe0jmqTgw2Skn_g.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pd"><img src="../Images/925516ac98e4517a4ac99ce46f1d8fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9EcyqeLCJ-cc0p2vJYvGSQ.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pe"><img src="../Images/da48dea33f747a8cc9f75ecee939b961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pTURt6Fx5fKqW38z4ICjvg.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pf"><img src="../Images/c74caa6bfea9aa7fc442aa56e8527609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jGYxDIRfLEf6v7fDQILXXA.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/d227e4c4363ce3e4cd208a21507c88cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*4f3CuJPpc6S3dceA3ceLcA.png"/></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ph"><img src="../Images/9845f6c7157a31b3e0626c05b9464023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GrQsb-sWhKJpkisi_4QbeA.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pi"><img src="../Images/dfa5848ef41d757b2c60d65ddecc389e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q5M6Yd_ORGkea7kNpzPiMA.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pj"><img src="../Images/9248868de283466b3b030e02ad5957c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pBZq8dbGltWTnUKzxbEpeg.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/6393d53f15216d8497bae82b2320f0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*phSEDdx71AvQfCDkJkPlQw.png"/></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/424437f0bea3d718e8a7b7b446789b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*CDkPCfiR8TFuYoZN0708YA.png"/></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pm"><img src="../Images/e82f0f796f572865a9ca0fd86d8d38e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N0xDHHKqooNvVRx-I9DJqQ.png"/></div></div></figure><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi pn"><img src="../Images/ff145fcffae31be5500c642855ef2e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*38bdHexJkyhrNOcMayVeXA.png"/></div></div></figure><h2 id="223d" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated">妥协的标志:</h2><p id="f861" class="pw-post-body-paragraph ju jv iq jw b jx ls jz ka kb lt kd ke kf lu kh ki kj lv kl km kn lw kp kq kr ij bi translated"><strong class="jw ir">网络指标:</strong></p><ul class=""><li id="29a3" class="mw mx iq jw b jx jy kb kc kf my kj mz kn na kr nb nc nd ne bi translated">https://152.32.193.91/seemorebty/</li></ul><p id="e8ef" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">主机指示灯:</strong></p><ul class=""><li id="5b3a" class="mw mx iq jw b jx jy kb kc kf my kj mz kn na kr nb nc nd ne bi translated">FFdroider</li><li id="209e" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">vlcpvideo 1 . 0 . 1</li><li id="92f5" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">FB机器人</li></ul><h2 id="c7f9" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated">雅拉规则和签名:</h2><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi po"><img src="../Images/138a032c62f64e732e19450c2366e89a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wYd9W0nO30RH2spIxWVtg.png"/></div></div></figure><h2 id="e5b3" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated">防逆转技术:</h2><ul class=""><li id="9389" class="mw mx iq jw b jx ls kb lt kf pp kj pq kn pr kr nb nc nd ne bi translated">IsDebuggerPresent。</li><li id="2e97" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">OutputDebugString。</li><li id="8e34" class="mw mx iq jw b jx nf kb ng kf nh kj ni kn nj kr nb nc nd ne bi translated">加密一些输入和字符串。</li></ul><h2 id="2820" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated">链接:</h2><div class="nr ns gp gr nt nu"><a href="https://www.flaticon.com/free-icons/fraud" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">2047个免费的欺诈图标</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">很抱歉您取消了Premium订阅，但您仍可以享受Flaticon收藏，但有以下限制…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">www.flaticon.com</p></div></div><div class="od l"><div class="ps l of og oh od oi js nu"/></div></div></a></div></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><h2 id="92f0" class="kz la iq bd lb lc ld dn le lf lg dp lh kf li lj lk kj ll lm ln kn lo lp lq lr bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ok" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>