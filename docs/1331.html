<html>
<head>
<title>SSL Pinning &amp; AWS Certificate Manager</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SSL锁定和AWS证书管理器</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/ssl-pinning-aws-certificate-manager-e414c4fb2aa3?source=collection_archive---------0-----------------------#2021-05-19">https://infosecwriteups.com/ssl-pinning-aws-certificate-manager-e414c4fb2aa3?source=collection_archive---------0-----------------------#2021-05-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="dd98" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">您是否因为利用<a class="ae ep" href="https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html" rel="noopener ugc nofollow" target="_blank"> ACM </a>进行自动化证书管理而无法在移动应用中实现SSL锁定？让我们讨论一种可能的解决方法，帮助我们保护传输中的数据，同时让托管服务就位，以避免手动证书管理的开销。</h2><div class=""/><div class=""><h2 id="e522" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">只是安全性和稳定性之间的另一个权衡？</h2></div><h1 id="2ff0" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">介绍</h1><p id="5b29" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">保护数据安全的一个关键方面是保护传输中的数据，即流入/流出移动应用程序和后端的数据必须得到充分保护，以防止对手实施中间人攻击。</p><h2 id="87d7" class="mf ks it bd kt mg mh dn kx mi mj dp lb ls mk ml ld lw mm mn lf ma mo mp lh iz bi translated">安全地实现TLS还不够吗？</h2><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mq"><img src="../Images/a798f86b9759fc3eb83ddd71b1bce0ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dj02i0pN7lwI1t1r.png"/></div></div></figure><p id="fe09" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">当正确实现时(例如，仅允许安全密码套件、最新的协议版本、<a class="ae nh" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=87150715" rel="noopener ugc nofollow" target="_blank">)没有覆盖默认行为以在握手期间禁用检查</a>等。)TLS <strong class="ll jd"> <em class="ni">看似足够</em> </strong>确保传输中敏感数据的机密性和完整性，阻挡重放攻击，提供双方认证。但是，在TLS中，服务器的真实性是根据服务器的SSL/TLS证书来决定的，该证书是由认证机构(CA)颁发的。</p><p id="d3cf" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">因此，所提供的整体安全性主要基于信任模型<strong class="ll jd">工作，其中ca必须被信任。由于它从根本上是以信任为基础的，因此会出现违反信任/安全妥协的情况，这有时会让利益相关方对仅使用TLS来保护传输中的数据没有信心:</strong></p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nj"><img src="../Images/b5b63ed2afb8bd6193f134a78a861eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*prnaFzef_tJSKc7B.png"/></div></div></figure><ul class=""><li id="544b" class="nk nl it ll b lm nc lp nd ls nm lw nn ma no me np nq nr ns bi translated">CAs可能不遵循安全最佳实践，并可能受到威胁- <a class="ae nh" href="https://www.itnews.com.au/news/diginotar-investigators-uncover-woeful-security-271685" rel="noopener ugc nofollow" target="_blank"> DigiNotar案例研究</a></li><li id="006b" class="nk nl it ll b lm nt lp nu ls nv lw nw ma nx me np nq nr ns bi translated">CAs为域颁发证书的违反信任行为- <a class="ae nh" href="https://www.thesslstore.com/blog/symantec-re-issue-thousands-of-ssl-certificates-will-be-distrusted-tuesday/" rel="noopener ugc nofollow" target="_blank"> Symmentec为google.com错误颁发证书</a>，<a class="ae nh" href="https://www.computerworld.com/article/2501291/trustwave-admits-issuing-man-in-the-middle-digital-certificate--mozilla-debates-punishment.html" rel="noopener ugc nofollow" target="_blank"> TrustWave为间谍活动颁发证书</a>等。</li><li id="d4d8" class="nk nl it ll b lm nt lp nu ls nv lw nw ma nx me np nq nr ns bi translated">根据2014年完成的<a class="ae nh" href="https://www.youtube.com/watch?v=tJFfDOQT46k&amp;t=1556s" rel="noopener ugc nofollow" target="_blank">研究</a>，33%的ca/分ca从未颁发过公共SSL证书</li></ul><p id="859d" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">确实需要一个额外的安全层来保护我们的用户，以防可信CA的信任破坏/妥协，以防止对手获得我们的域的伪造证书并执行中间人攻击。这就是移动安全人士推荐SSL pin的原因</p><h1 id="7c09" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">SSL/TLS固定</h1><p id="04a8" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">SSL固定是一种帮助我们提供传输层安全性并保护传输中的数据的技术。它不信任每个CA，而是在SSL握手期间的基本检查(证书有效性、证书完整性等)之上仅信任一组证书元数据(即证书校验和/公钥校验和),从而大大减少了攻击面。)</p><p id="fb09" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">只有白名单中的证书哈希/证书的公钥哈希用于通信时，才允许通信，这有助于我们改进基于信任模型构建的安全模型。</p><p id="59bd" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">在高层次上，可以使用以下两种方法之一来实现它:</p><ul class=""><li id="205c" class="nk nl it ll b lm nc lp nd ls nm lw nn ma no me np nq nr ns bi translated"><strong class="ll jd">证书锁定:</strong>当客户端验证握手期间收到的证书的校验和时，锁定校验和。</li><li id="6670" class="nk nl it ll b lm nt lp nu ls nv lw nw ma nx me np nq nr ns bi translated"><strong class="ll jd">公钥锁定:</strong>客户端验证从握手过程中收到的证书中提取的公钥的校验和，并锁定公钥的校验和。</li></ul><p id="c2cb" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">你可以在这里阅读更多关于SSL固定<a class="ae nh" href="https://appmattus.medium.com/android-security-ssl-pinning-1db8acb6621e" rel="noopener">的细节。</a></p><h2 id="90f4" class="mf ks it bd kt mg mh dn kx mi mj dp lb ls mk ml ld lw mm mn lf ma mo mp lh iz bi translated">公钥锁定和证书轮换</h2><p id="f334" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">SSL证书需要在一段时间后更新，因此锁定证书变得非常麻烦，因为每次更新都需要强制更新，这很不方便，因为这会降低用户体验。</p><p id="1e2f" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">公钥锁定帮助我们克服这一点，同时维护UX，当我们锁定公钥(SPKI，SubjectPublicKeyInfo)而不是证书时，我们不需要在每次轮换证书时强制更新，因为在更新证书时可以使用相同的密钥对，即，当证书被更新时，其校验和会改变，但由于密钥保持不变，校验和保持不变，所以我们不需要在每次轮换证书时强制更新。</p><h1 id="1535" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">依赖ACM的应用程序的SSL固定</h1><p id="749d" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">到目前为止，我们已经了解了为什么一个安全的TLS实现是不够的，以及SSL Pinning如何帮助我们提高安全性。话虽如此，虽然看起来公钥锁定可以解决问题，但在我们非常依赖<em class="ni">托管服务</em>的现代，不幸的是，SSL锁定似乎不是一个可扩展的解决方案。</p><p id="32f7" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">AWS不建议使用<a class="ae nh" href="https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html" rel="noopener ugc nofollow" target="_blank"> ACM(AWS证书管理器)</a>为应用程序实现SSL/TLS锁定。对于那些不知道ACM的人来说，它是一个托管服务，处理创建、存储和更新SSL证书和密钥的复杂性。</p><p id="3f31" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">为了续订证书，ACM生成一个新的公钥-私钥对，这意味着我们不能通过使用相同的密钥对来利用公钥锁定的好处。此外，ACM将在证书到期前60天自动更新证书。</p><p id="f0a8" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">出于这个原因，AWS <a class="ae nh" href="https://aws.amazon.com/premiumsupport/knowledge-center/pin-application-acm-certificate/" rel="noopener ugc nofollow" target="_blank">不建议</a>将您的应用程序绑定到ACM颁发的SSL/TLS证书。</p><h2 id="2066" class="mf ks it bd kt mg mh dn kx mi mj dp lb ls mk ml ld lw mm mn lf ma mo mp lh iz bi translated"><strong class="ak">权衡</strong></h2><p id="68ed" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">依靠托管服务实现稳定的运营是一个事实上的标准，而ACM是广泛使用的托管服务之一。考虑到这一点，可以将运营工程师从手动管理域证书的繁琐任务中解脱出来，但同时也大大降低了因错过续订而导致停机的几率。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ny"><img src="../Images/811e96555ce9f28ddd9886091ce8f6c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r6k2nfbeSfIq7P_U.jpeg"/></div></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk translated">安全性与稳定性</figcaption></figure><blockquote class="od oe of"><p id="90a8" class="lj lk ni ll b lm nc kd lo lp nd kg lr og ne lu lv oh nf ly lz oi ng mc md me im bi translated">虽然这在很大程度上取决于应用程序的安全要求和数据之间的流动，但同时中断的风险也不容忽视，因此这是一个很好的安全工程问题！</p></blockquote><p id="0962" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">或者，如果我们遵循AWS的<a class="ae nh" href="https://aws.amazon.com/premiumsupport/knowledge-center/pin-application-acm-certificate/" rel="noopener ugc nofollow" target="_blank">建议</a>，为ACM颁发的证书锁定根CA，从根本上说，我们仍然依赖信任模型来保证安全性。然而，我们只信任单个CA，而不是信任设备信任存储中的所有CA，这大大减少了攻击面。</p><h1 id="c0f9" class="kr ks it bd kt ku kv kw kx ky kz la lb ki lc kj ld kl le km lf ko lg kp lh li bi translated">证书透明度:一个拯救计划？</h1><p id="20cd" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">Google的证书透明(CT)项目是一个<a class="ae nh" href="https://tools.ietf.org/html/rfc6962#section-2.1.3" rel="noopener ugc nofollow" target="_blank">开放框架</a>，涉及<strong class="ll jd">公开可审计</strong>和<strong class="ll jd">仅附加</strong>所有已颁发证书的日志，可以近乎实时地监控和审计。它使得检测由证书颁发机构错误颁发的SSL证书或从其他无可指责的证书颁发机构恶意获取的SSL证书成为可能。它还可以识别出恶意颁发证书的证书颁发机构。</p><p id="06e8" class="pw-post-body-paragraph lj lk it ll b lm nc kd lo lp nd kg lr ls ne lu lv lw nf ly lz ma ng mc md me im bi translated">我们可以依靠CT来保护传输中的数据？马修·多兰令人惊讶地描述了这种方法，这里<a class="ae nh" href="https://appmattus.medium.com/android-security-certificate-transparency-601c18157c44" rel="noopener">捕捉得非常好</a>。在下一个媒体故事中，我将围绕CT的技术方面，以及如何利用它来为依赖于它的应用程序保护传输中的数据，捕捉更多信息。在那之前，敬请关注:)</p></div></div>    
</body>
</html>