<html>
<head>
<title>WebGoat CSRF 7 8</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">韦山羊CSRF 7 8</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/webgoat-csrf-7-8-916f52dbc3d3?source=collection_archive---------2-----------------------#2020-10-11">https://infosecwriteups.com/webgoat-csrf-7-8-916f52dbc3d3?source=collection_archive---------2-----------------------#2020-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="8a22" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">WebGoat CSRF 7</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/cca4bb32c215f1e07ce926f5cf2c7188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6EPw1xiaOQ9jUNDpsos5A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">WebGoat CSRF第7课</figcaption></figure><p id="6f6c" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这一课与前两节非常相似，但是这一次要发送的有效载荷必须是JSON格式，让我们看看这是如何实现的</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/ce22bc0528fc07e746e13faa962771a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qS97OmSq8EFGoR8M2DtuQw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">具有给定值的请求</figcaption></figure><p id="1974" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">通过用给定的值填充课程表单，HTTP请求用JSON格式的输入值填充，反馈告诉我们解决方案不正确，正如预期的那样</p><p id="4787" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们继续，只是将页面上的表单复制到一个新的html文件中，在这里您可以发现表单清除了所有不必要的div，并添加了一个用于测试的隐藏字段</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">修改的WebGoat CSRF 7 web表单HTML源代码——这个不工作</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/fd9dcb641407c84c8f425c11aa89cc71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*STlT0LABj7djaHmGeUVZTg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">修改了火狐浏览器上的网页山羊CSRF 7网页表单——这个不能用</figcaption></figure><p id="2613" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们填写表格，看看会发生什么</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi md"><img src="../Images/6fd0bcddd79e3fac9edff237fca6740e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8i45WV3BgIlNeVRRu0EYEA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">提交表单时出错</figcaption></figure><p id="661d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">请求不工作，WebGoat回复状态代码500，让我们看看打嗝历史显示什么</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/b7ce7d17b8f1a6e500e1a45be8955750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ogD_NIr9zVx7X6TxpIn-Rw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">打嗝时的请求和错误响应</figcaption></figure><p id="0cde" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这里的请求根本不是WebGoat所期望的，这是一个普通的POST表单提交，它永远不会在这里工作</p><p id="3cbd" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">WebGoat课程页面建议去阅读<a class="ae me" href="http://pentestmonkey.net/blog/csrf-xml-post-request" rel="noopener ugc nofollow" target="_blank">http://pentestmonkey.net/blog/csrf-xml-post-request</a>是最重要的，在这里PentestMonkey清楚地解释了如何从一个HTML文件和一个简单的表单开始伪造一个所需格式的HTTP请求，也就是说，基本上，这就是我在这里试图实现的</p><p id="da53" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">如果需要更多帮助，这里有来自WebGoat GitHub的【https://github.com/WebGoat/WebGoat/wiki/Main-Exploits】T2页面，以及正确的有效载荷和更多解释</p><p id="3862" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">经过阅读和研究，一个新的HTML文件是为了伪造正确的要求</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">修改后的WebGoat CSRF 7 web表单HTML源代码——这个确实有效</figcaption></figure><p id="e4c8" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先:表单enctype="text/plain "强制浏览器创建一个请求，而不对来自客户端的数据内容进行编码</p><p id="00f4" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">第二:为了创建有效的JSON有效负载，请求必须具有课程页面上可用的内容，并且该文本具有以下字符，以便伪造JSON有效负载</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="be24" class="mk jo iq mg b gy ml mm l mn mo">" : { }</span></pre><p id="a45b" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">幸运的是，只要使用相同类型的引号作为开始和结束字符，HTML标记属性分隔符可以是“or ”,所以这两个表单属性</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="ce42" class="mk jo iq mg b gy ml mm l mn mo">name='{"name": "WebGoat", "email": "webgoat@webgoat.org", "content": "WebGoat is the best!!", "ignoreme":"'<br/> <br/>value='sdfsdfdf"}'</span></pre><p id="2370" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">有效的HTML属性允许我们在请求中放入JSON格式的数据体吗</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/ec2bf2b09b94695def51579531e4a355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*aFQ6-RIx1-CWdBKfqEYqrQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">火狐浏览器上的WebGoat CSRF 7网页表单——这个确实有效</figcaption></figure><p id="933d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们利用这两个方面提交表单</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/0f6880e03c3cb187e031028f8796eddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f9C-es43_t_v-C_ucNsNfQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">成功！！</figcaption></figure><p id="e983" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">WebGoat回复了这个包含标志的JSON消息</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/55a81462af6d401bffd135e78510a465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NR8LKhvOIjf5ByUVzTK2sQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">打嗝的要求</figcaption></figure><p id="ed93" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在Burp上，我们可以看到添加了“ignoreme”属性的正确JSON格式的伪造请求</p><p id="bfed" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在课程页面中输入标志来完成它</p><h1 id="b7bb" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">WebGoat CSRF 8</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ms"><img src="../Images/8603666b64565f2d8f8da6cb41d42e79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jqUqvfc-78nMPqRS7gVAIA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">WebGoat CSRF第8课</figcaption></figure><p id="465b" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们从WebGoat登录页面结构开始创建一个表单</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我的网络山羊CSRF第八课形式上的Git Gists</figcaption></figure><p id="e29f" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">第一个是一个简单的版本，只有基本的组件，第二个有一些修改，使其自动提交和显示一个空白页</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/3bf0848d5f455e60d4106dad73447dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkmdOq_Lu76tYhNnZuv_QQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在WebWolf上上传的表单文件</figcaption></figure><p id="39a4" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">将其上传到WebWolf，并在新的选项卡上打开</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/34b463d5f672e90632b156955ca7e65c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*RKR8xDiRyaIr5JGCiwLT0w.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">页面是空白的，因为HTML文件中的所有内容都已被隐藏</figcaption></figure><p id="b535" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">然后切换到课程页面，点击“已解决！”按钮来完成课程</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mv"><img src="../Images/aaf83bd31d1692ab6a61a62e3c50cc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*jVsgPeBFJxtYWJBVXFvhrQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">具有已更改用户的web山羊用户菜单</figcaption></figure><p id="5dd2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">您现在以csrf- <your_username>用户身份登录，重新加载任何web山羊页面，并在右上角菜单上检查您的用户，以检查是否有新的登录</your_username></p><p id="54bd" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">网络山羊CSRF 7-8到此结束</p><p id="8ee6" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我希望你喜欢它。</p><p id="6e7f" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">PVXs—<a class="ae me" href="https://twitter.com/pivixih" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pivixih</a></p></div></div>    
</body>
</html>