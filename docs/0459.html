<html>
<head>
<title>GraphQL IDOR leads to information disclosure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GraphQL IDOR导致信息泄露</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/graphql-idor-leads-to-information-disclosure-175eb560170d?source=collection_archive---------0-----------------------#2019-12-24">https://infosecwriteups.com/graphql-idor-leads-to-information-disclosure-175eb560170d?source=collection_archive---------0-----------------------#2019-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c5b58d051264aacb606100c0543442ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6CzhXa1PKSErpb9m"/></div></div></figure><p id="3bc8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你好世界！，我是Eshan Singh又名<em class="kw"> R0X4R </em>。我在这里分享一下我最近对GraphQL IDOR(不安全的直接对象引用)导致信息泄露的发现。那么，我们开始吧。我正在登录…</p><p id="8096" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">graph QL是什么？</strong></p><p id="5b4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GraphQL基金会定义“GraphQL是一种用于API的开源数据查询和操作语言，是一种用现有数据完成查询的运行时。”如今，GraphQL正被用来代替Rest-API。</p><p id="e501" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">漏洞</strong></p><p id="cd27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在为redacted.com做recon(一个私人项目，根据他们的隐私政策，我不能透露他们的名字)时，我发现这个web应用程序正在使用GraphQL进行API管理。</p><p id="f870" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我首先尝试了内省查询来提取敏感信息。通过查询后，我看到一个名为Users的字段，所以我通过了</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="49fb" class="lg lh iq lc b gy li lj l lk ll">Query: {__type (name: \”Users\”) {name fields{name type{name kind ofType{name kind}}}}}”}</span></pre><p id="6672" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在“用户”字段中枚举类型定义的查询，然后我看到“用户”类型包含一些字段，即电子邮件、移动电话号码、用户id、位置和api_key。因此，我又传递了一个查询来提取这些字段携带的信息，但是我得到了403未授权的响应。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="6a6e" class="lg lh iq lc b gy li lj l lk ll">Query: {Users{email,mobile_number,user_id,api_key}}</span></pre><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/97441888320d524617467afdf40c6371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*dyBdGiYnj6UbDD_J"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">来源:<a class="ae lr" href="https://imgflip.com/memetemplate/100827024/Sad-meme" rel="noopener ugc nofollow" target="_blank">https://imgflip.com/memetemplate/100827024/Sad-meme</a></figcaption></figure><p id="a9c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，我认为这个网络应用程序并不脆弱，所以我开始寻找XSS。我点击了我的个人资料，然后我编辑了我的名字并截取了请求，然后我看到了一些有趣的东西；在请求新的编辑之前，web应用程序会提取用户以前的信息。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="d86b" class="lg lh iq lc b gy li lj l lk ll">Request: {“operationName”:”CurrentUserData”,”variables”:{“id”:” — base64 encode — “},”query”:”query CurrentUserData($id: ID!) {\n User(id: $id) {\n id\n email\n name\n mobile_number\n apiHostUrl\n SiteAdminUrl\n pages(first: 50) {\n nodes {\n id\n faviconUrl\n name\n code\n manageUrl\n __typename\n }\n __typename\n }\n __typename\n }\n}\n”}</span></pre><p id="7b12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我将该请求发送到中继器，在该请求中，有一个名为“id”的变量，它包含base64中的内容。所以，我解码了base64编码字符串</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="2c50" class="lg lh iq lc b gy li lj l lk ll">Decode: oph:cloud:redacted::user/p5yhwx30</span><span id="4cb4" class="lg lh iq lc b gy ls lj l lk ll">First Account: r0x4r@hhacker.com</span><span id="84eb" class="lg lh iq lc b gy ls lj l lk ll">Second Account: bcr_rox4r@hacker.com</span></pre><p id="e2de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">“P5yhwx30”是我的“id”于是，我在redacted.com上又创建了一个账号，复制了它的“id:oph:cloud:redited::user/d5mzk1 m2”。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/4533ae06e52b2eb055e41c457e11145a.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/0*Sq50CD4kelmy8Ez_"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">来源:<a class="ae lr" href="https://winkgo.com/wp-content/uploads/2019/03/happy-memes-make-you-smile-more-02.jpg?ezimgfmt=ng:webp/ngcb3" rel="noopener ugc nofollow" target="_blank">https://winggo . com/WP-content/uploads/2019/03/happy-memes-make-you-smile-more-02 . jpg？ezimgfmt=ng:webp/ngcb3 </a></figcaption></figure><p id="1845" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后从第二个账号注销，用第一个账号登录。现在我传递相同的查询，但是我用我的第二个“id”改变了我的“id ”,然后嘣！我得到了信息。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/cdcdf44e17f588cbd151cdb96f2031ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ey_gW0LYHE2BKpHK"/></div></div></figure><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/a17811181d85ec21af80a7a2b5f5829f.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/0*74wh3Ph20avFkyEQ"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">来源:<a class="ae lr" href="https://me.me/i/oh-yeah-meme-creator-funny-oh-yeah-meme-generator-b8bd2dcfd4db44bb961bcd638a4b2659" rel="noopener ugc nofollow" target="_blank">https://me . me/I/oh-yeah-meme-creator-funny-oh-yeah-meme-generator-b 8 BD 2d CFD 4d b 44 bb 961 BCD 638 a4 b 2659</a></figcaption></figure><p id="4eec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是有一个问题等待着我，那就是我如何获得另一个用户id。因此，在枚举之后，我发现其他用户的“id”在他们的个人资料页面源代码中。我只需进入他们的个人资料，查看他们个人资料页面的来源，然后我搜索“var_userID”，我得到了他们的“ID”</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/81b4670fb133f61193ee75092cdeeaf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*YrgvT7H9ST_QFk9G.gif"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">来源:<a class="ae lr" href="https://media1.tenor.com/images/17d912fad3b04c322b0c2678adeccf97/tenor.gif?itemid=10323706" rel="noopener ugc nofollow" target="_blank">https://media 1 . tenor . com/images/17d 912 fad 3 b 04 c 322 b 0c 2678 ade CCF 97/tenor . gif？itemid=10323706 </a></figcaption></figure><p id="1df4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">披露:</strong></p><p id="ea08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">于2019年11月15日向redacted.com报告</p><p id="0df5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">他们在2019年12月7日奖励了我3位数的赏金。</p><p id="0dd2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢和问候！</p><p id="87f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">埃尚·辛格又名R0X4R</p><p id="d52a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正在注销…</p></div></div>    
</body>
</html>