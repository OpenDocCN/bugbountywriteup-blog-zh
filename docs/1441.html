<html>
<head>
<title>Hackeando Voy, Hackeando Vengo — El Caso BiciMAD Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客攻击我,黑客攻击我来了 – BiciMAD Go案件</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackeando-voy-hackeando-vengo-el-caso-bicimad-go-e256adf6fe8?source=collection_archive---------4-----------------------#2021-07-02">https://infosecwriteups.com/hackeando-voy-hackeando-vengo-el-caso-bicimad-go-e256adf6fe8?source=collection_archive---------4-----------------------#2021-07-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fd82" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">马德里公共自行车租赁服务中的漏洞</h2></div><p id="d676" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2014年,马德里市议会通过推出自己的公共自行车租赁服务(T0) BiciMAD(T1)来大力推动移动出行。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/23a255cf364159c3e15f2b876643d1f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mceSZ4MhPnzpKFh3srWIUw@2x.jpeg"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">使用BiciMAD,您可以从264个可用站点中的任何一个站点上骑自行车。</figcaption></figure><p id="f6f4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个故事中,我将解释我如何在<em class="le">BiciMAD Go</em>服务中发现一个<strong class="kk iu">漏洞,该漏洞允许攻击者预订所有可用的自行车</strong>。</p><blockquote class="lv lw lx"><p id="c4c7" class="ki kj le kk b kl km ju kn ko kp jx kq ly ks kt ku lz kw kx ky ma la lb lc ld im bi translated"><strong class="kk iu">免责声明</strong>:本故事中表达的观点是作者的观点,并不反映BiciMAD的观点。此事件已得到适当通知,并已采取适当措施解决。</p></blockquote></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="1757" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">关于BiciMAD Go</h1><p id="dfe2" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">在2020年秋天 - 一个难以忘怀的年份 - <em class="le"> BiciMAD </em>增加了一种名为<em class="le"> BiciMAD Go </em>的新模式,其中包括454辆免费自行车。</p><p id="01d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与现有自行车的区别在于,后者不需要在旅程结束时停靠在车站上。您可以将它们放在允许区域内的任何地方。</p><p id="1ca7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">找到这些自行车的最简单方法是使用<em class="le">BiciMAD</em>的官方应用程序。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ng"><img src="../Images/8b73dd332144814aa82ff0968a48be61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFPYBPD6pZcBwLD1U-24eg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">在应用程序地图中,您可以找到车站,免费使用的自行车和禁区</figcaption></figure><p id="270d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以预订自行车10分钟,以防止其他用户在您之前抓住它。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ng"><img src="../Images/45b56eaba9c9d56f130993ab143b079b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJw9ImigXyrbOjic_QBAXw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">预订自行车会给你足够的时间到达你的位置,没有人会把它从你。</figcaption></figure><p id="6ec4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我是一个非常好奇的人,对网络安全充满热情,所以当我看到像这样的功能时,我会想到在哪些关键点可能存在实现错误 。所以当我看到预订自行车的选项时,我想:</p><blockquote class="nh"><p id="7251" class="ni nj it bd nk nl nm nn no np nq ld dk translated">可以同时预订多辆自行车吗?</p></blockquote><p id="92a7" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated"><strong class="kk iu">允许用户一次预订多辆自行车可能会损害自行车的可用性</strong>,因此可以期待某种控制。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ng"><img src="../Images/c3c40b6ab05125933d1a873061e2875c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PWcYTVCFXzNTJMxtsfbiQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">尝试预订另一辆自行车时,App 中会出现描述性错误</figcaption></figure><p id="f60b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">为了有效,此控件应该在服务器上运行</strong>,但这不是我第一次在客户端看到这种类型的控件,在那里很容易跳过它。</p><p id="6e6d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了了解在<em class="le"> BiciMAD </em>应用程序的网络级别发生了什么,我设置了一个代理<a class="ae nf" href="https://www.zaproxy.org/" rel="noopener ugc nofollow" target="_blank"> <em class="le"> OWASP ZAP </em> </a>来查看应用程序和服务器之间的请求交换。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nw"><img src="../Images/872c1da547296a8b5e749cb4d81c3039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ck6NjADjWZ5GDtGqwVwKkg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">使用代理,我们可以看到应用程序和BiciMAD服务器之间的请求交换</figcaption></figure><p id="4f52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在检查捕获的网络流量后,我发现<strong class="kk iu">控件已在服务器端</strong>上正确实现。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nx"><img src="../Images/7d0c1f9dc1bc8f4ee4d7b2eb440b58d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4RtXHofK32UoOEVCmztCA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">在预订请求中,我们可以看到服务器的响应,包括错误</figcaption></figure><p id="9a98" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外,我意识到<strong class="kk iu">如果您在预订10分钟后尝试预订另一辆自行车,您将被罚款30分钟</strong>。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ny"><img src="../Images/badb7fe2ad4fe9d5712c01bd0f5dcdee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*an2t7ngtce3upM9NodEjYw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">在预订请求的响应中,我们可以看到临时的惩罚窗口</figcaption></figure><p id="39c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此控制可防止用户通过每 10 分钟预订一辆自行车来损害自行车的可用性。</p><blockquote class="nh"><p id="52b2" class="ni nj it bd nk nl nm nn no np nq ld dk translated">鉴于有几个控制措施可以保护自行车的可用性,这似乎是故事的结局......不是吗?</p></blockquote><h1 id="3d0f" class="mi mj it bd mk ml nz mn mo mp oa mr ms jz ob ka mu kc oc kd mw kf od kg my mz bi translated">一个安全漏洞</h1><p id="2d9d" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated"><strong class="kk iu">某些控制措施的存在并不意味着这些控制措施得到了很好的实施(T5)。看一看自行车预订请求,我意识到<strong class="kk iu">我的NIF正在发送到</strong>报头。</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oe"><img src="../Images/85050689c4a3b8866d0b3e0574482fe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PWMMCmnFoq5mXpE0HpqB6Q.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">预订请求中的“nif”字段引起了我的注意</figcaption></figure><p id="2623" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将用户的NIF发送到头<strong class="kk iu">允许攻击者轻松更改值</strong>,所以我开始怀疑......</p><blockquote class="nh"><p id="a715" class="ni nj it bd nk nl nm nn no np nq ld dk translated">此 NIF 是否会在服务器上进行验证?</p></blockquote><p id="345a" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">使用Postman,我复制了预订请求<strong class="kk iu">,将我的NIF替换为00000013B</strong>——一个无效的NIF——并且<strong class="kk iu">请求似乎被接受了</strong>。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="of og l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">此分类下一篇: What The Hell - Obama &amp; <a class="ae nf" href="https://giphy.com/gifs/wtf-obama-wth-pPhyAv5t9V8djyRFJH" rel="noopener ugc nofollow" target="_blank"> Giphy</a></figcaption></figure><p id="5b07" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过预订终端点的查询,我能够验证自行车是否已正确预订。更糟糕的是,<strong class="kk iu">在</strong>服务器上没有对该字段的任何验证。</p><p id="a8af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着<strong class="kk iu">可以使用任意值</strong>预订任何自行车,例如<em class="le"> '1',</em> <em class="le"> 'hello' </em>,甚至可以将字段留空。所以我问自己...</p><blockquote class="nh"><p id="95f9" class="ni nj it bd nk nl nm nn no np nq ld dk translated">是否可以利用此漏洞对 BiciMAD Go 执行拒绝服务攻击?</p></blockquote></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="2ab1" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">剥削</h1><p id="ce80" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated"><strong class="kk iu">拒绝服务(DoS) </strong>是一种攻击类型,其中恶意攻击者<strong class="kk iu">试图破坏设备或资源</strong>的正常操作,使其不可用或响应时间非常慢。</p><p id="f040" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我对这些“道德黑客”的意图是帮助提高我使用的应用程序的安全性,以便将来对每个人都更安全。</p><p id="479c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">拒绝 <em class="le"> BiciMAD Go </em> 服务将对 <em class="le"> BiciMAD </em> 造成经济后果,并将跨越道德黑客的界限,除了法律影响之外。</p><blockquote class="nh"><p id="50b1" class="ni nj it bd nk nl nm nn no np nq ld dk translated">凭借所收集的证据和一些技术知识,很明显,这次袭击是可以进行的。</p></blockquote><p id="b14f" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">虽然我不想损害自行车的可用性,但我想对一小群自行车进行<strong class="kk iu">概念验证。</strong></p><p id="191c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">开始工作,创建一个脚本,使用随机生成的NIF在我家附近预订一组选定的自行车。</p><p id="e6ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后,我运行了脚本,走到街上,试图使用预订的自行车。当我尝试解锁它们时,该应用程序显示了一个错误,确认自行车已经预订。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ng"><img src="../Images/d2b82a5759a60a7c1e18ed47a2a43e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMbV6Z7SZmZCL5SaTzqYhQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">应用程序中显示的错误确认拒绝服务攻击是可能的</figcaption></figure><p id="eda6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">10分钟后,我让我的妻子再次运行脚本,以便我可以确认自行车在10分钟内仍然不可用。</p><p id="af8b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> 暂时惩罚控制被证明是完全无用的 </strong>,因为惩罚似乎被分配给用户的NIF,这可以随机生成。</p><p id="3e29" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦确认攻击是可行的,现在是时候通知<strong class="kk iu">事件</strong>,以便可以纠正它,并提供复制它的所有技术细节。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="eb57" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">最终反思</h1><p id="10ad" class="pw-post-body-paragraph ki kj it kk b kl na ju kn ko nb jx kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">此漏洞允许攻击者使用任意 NIF 预订任何自行车,从而影响自行车的可用性。</p><p id="bdd8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还发现可以使用其他用户的NIF预订自行车,<strong class="kk iu">也会影响<em class="le">BiciMAD Go</em></strong>服务的完整性。</p><p id="9a00" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在经济方面,服务价格 <em class="le"> BiciMAD Go </em> - 每分钟0.19欧元 - 使这项服务成为<strong class="kk iu"> BiciMAD  </strong>的重要资产。</p><p id="7d09" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我看来,易于利用以及<em class="le"> BiciMAD Go</em>对服务的影响将此安全漏洞转化为<strong class="kk iu">高严重性</strong>漏洞。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/b0cbfe935c24b9fc2065a022adab8d57.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*7sljyHZWSDbWWlEAUUMlcg.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">我自己提出的向量<a class="ae nf" href="https://nvd.nist.gov/vuln-metrics/cvss" rel="noopener ugc nofollow" target="_blank">CVSS</a>v3.1 返回的基本分数为 7.6</figcaption></figure><p id="654a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然利用此漏洞可以执行的最具破坏性的攻击是拒绝服务,但它也可以用于<strong class="kk iu">在某些地区悄悄地减少自行车的可用性</strong>,这对竞争对手公司来说非常有利。</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><blockquote class="lv lw lx"><p id="1f08" class="ki kj le kk b kl km ju kn ko kp jx kq ly ks kt ku lz kw kx ky ma la lb lc ld im bi translated">如果你喜欢这个故事,并有兴趣在<a class="ae nf" href="https://medium.com/@h_martos" rel="noopener">Medium</a>、<a class="ae nf" href="https://twitter.com/h_martos" rel="noopener ugc nofollow" target="_blank">Twitter</a>或<a class="ae nf" href="https://www.linkedin.com/in/hector-martos-gomez/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>关注更多。</p><p id="b845" class="ki kj le kk b kl km ju kn ko kp jx kq ly ks kt ku lz kw kx ky ma la lb lc ld im bi translated">谢谢你的时间!</p></blockquote></div></div>    
</body>
</html>