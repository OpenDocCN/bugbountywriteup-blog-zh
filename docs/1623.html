<html>
<head>
<title>CAP Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">上限增加</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cap-fd9434b52241?source=collection_archive---------2-----------------------#2021-10-06">https://infosecwriteups.com/cap-fd9434b52241?source=collection_archive---------2-----------------------#2021-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8a3a78e6e31d9c02c2f4993765a1f1a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ykfzdew48Z9zoH6E.png"/></div></div></figure><p id="11e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">CAP是一个简单的Linux机器，它以自己的名字提供了大部分需要解决的信息。</p><p id="92df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们直接攻击这台机器。</p><ol class=""><li id="289a" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir">扫描和枚举:</strong></li></ol><blockquote class="lf lg lh"><p id="e3d7" class="jy jz li ka b kb kc kd ke kf kg kh ki lj kk kl km lk ko kp kq ll ks kt ku kv ij bi translated">nmap -A -T4 -p 21，22，80 10.129.119.234 -o扫描</p></blockquote><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/beaf903842ab34d8590922ea8c3262aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMt9cq5KE2riOhTStQ_kiA.png"/></div></div></figure><p id="3e25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">FTP:</strong><br/>vsftpd 3.03没有已知漏洞，也不支持匿名登录。</p><p id="acc7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">宋承宪:</strong></p><p id="5f32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个版本的SSH没有已知的漏洞。</p><p id="fc5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我们需要通过托管在端口80的网站找到FTP/SSH服务的一些凭证。</p><p id="de09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我第一次尝试运行gobuster，但没有发现任何有用的东西。因此，只要列举网站，我们就能找到它提供的不同东西。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/cc19267025346ebd17bf93156f1f7814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gr4HRE2yxWPkWVJT6SzDNw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated"><strong class="bd lw">首页</strong></figcaption></figure><p id="f602" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以观察到两件事:<br/> 1)它提供的不同服务<br/> 2)有权访问该站点的某个人的姓名。</p><p id="ea98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在不同的服务中，第一个产生一些pcap文件，机器名被cap可能不是某种巧合</p><p id="50df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以访问这个页面，我们可以看到webiste一直在路径/data/pcapid <br/>中给我们pcap文件，其中pcapid =连续的数字，如(1，2，3，…..)<br/>每次我们尝试访问页面/每5秒，如站点中所述，pcapid就会增加。</p><p id="2e9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开始/第一个pcapid为1，包含我们对机器进行的所有扫描的信息。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lx"><img src="../Images/8440ddc5e548552d03600981006fcb71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhXxx0I8AZGV9WE6QEwQWQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated"><strong class="bd lw">/数据/1 </strong></figcaption></figure><p id="b261" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2)用户:</strong></p><p id="5abc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果有/data/1，我尝试了/data/0。我们得到了一个包含一些条目的pcap文件…</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/c79b7465e50c5d39fad68bc266bd8205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tD1a09SdpQnPV4n0P1NfDg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated"><strong class="bd lw"> /data/0 </strong></figcaption></figure><p id="2256" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过分析pcap，我们获得了用户nathan的凭证。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ly"><img src="../Images/5fc02dff0c3bafdf522070073e61c88a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-kaxg2fLlnJ191ykZoE-1g.png"/></div></div></figure><p id="7d8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用它登录ftp，我们可以在主目录中获得user.txt。</p><p id="42c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是SSH登录的凭证，因此我们可以以用户Nathan的身份获得一个shell。</p><p id="5839" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3)词根:</strong></p><p id="8e2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要特权来访问根标志..</p><p id="27d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在机器上寻找一些有趣的文件时，我找到了运行服务器应用程序的app.py文件。因为我注意到了类似这样的事情。</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/d87fd658e0ad3d0b964037a29dea66ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGDnTCx2fG1AQ4uUaRB0Hg.png"/></div></div></figure><p id="8399" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一开始看到这个，我想我们一定是滥用了这个命令来获得命令注入，但是在本地尝试没有成功。</p><p id="235b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我看到了字符串os.setuid(0 ),这是根权限，并提出了一个问题，python如何将其设置为根权限？？</p><p id="37da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后在谷歌上搜索了一下，我读到了Linux的功能。</p><p id="e107" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在通读这段代码时，我立即明白了这行代码的作用，以及我们如何使用它来找到根标志..</p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/697911432b54e5e68ac771091981bb3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7kZpbZbZuRmdZMaeNNUWxg.png"/></div></div></figure><p id="e0dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">getcap命令告诉我们分配给特定程序的不同功能。</p><p id="2d89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Python被赋予了setuid和net_bind_service，这意味着python可以将setuid设置为它想要的任何值..</p><p id="e357" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">漏洞利用:</strong></p><figure class="ln lo lp lq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/4a1bc93b79fe1111edf333948a5f6fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_cRU4wEDZLA1sqUoagwpLw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">特权提升利用</figcaption></figure></div></div>    
</body>
</html>