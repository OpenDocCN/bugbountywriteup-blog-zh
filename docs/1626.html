<html>
<head>
<title>Origin IP found, D-DOS &amp; WAF Cloudflare protection bypassed</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">发现原始IP，绕过D-DOS和WAF Cloudflare保护</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/origin-ip-found-d-dos-waf-cloudflare-protection-bypassed-41fc280ccf8f?source=collection_archive---------0-----------------------#2021-10-08">https://infosecwriteups.com/origin-ip-found-d-dos-waf-cloudflare-protection-bypassed-41fc280ccf8f?source=collection_archive---------0-----------------------#2021-10-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c873" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">低垂的虫子</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/1b38373352a58210c455286a322abd3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vPvrgVx6-rKF8s12-1psjQ.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae lb" href="https://i.ytimg.com/vi/6gaplYfYpKI/maxresdefault.jpg" rel="noopener ugc nofollow" target="_blank">https://i.ytimg.com/vi/6gaplYfYpKI/maxresdefault.jpg</a></figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lc"><img src="../Images/c59d79d36a0d40ba4183e22e9296715d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DkxJbT6MJtgY4eRUQoFCEw.png"/></div></div></figure><h1 id="78b3" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">1.图标哈希:</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mb"><img src="../Images/9a522cedacd5df13f7995d76ca24dd2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*unfwB9xF1hulmsjbHCB8-A.png"/></div></div></figure><p id="b1ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【https://github.com/Dheerajmadhukar/Lilly】工具:<a class="ae lb" href="https://github.com/Dheerajmadhukar/Lilly" rel="noopener ugc nofollow" target="_blank"/></p><p id="c0df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过检索favicon哈希，使用被动侦察工具查找Cloudflare等cdn/WAFs背后的真实IP。对于相同的哈希值，将搜索所有可能的IP、端口和SSL/TLS证书，以验证范围内的目标。</p><h1 id="0dd9" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">2.完成Shodan侦察:</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/62e5cabe7665ec1ba0ef0c28dbdc44ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y6y_EGq-t0XnsO6jc6Ocrg.png"/></div></div></figure><p id="fdea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">工具:</strong><a class="ae lb" href="https://github.com/Dheerajmadhukar/karma_v2" rel="noopener ugc nofollow" target="_blank">https://github.com/Dheerajmadhukar/karma_v2</a></p><p id="3ac1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Infosec研究人员、渗透测试人员、漏洞猎人可以使用𝚔𝚊𝚛𝚖𝚊 𝚟𝟸来查找深层信息、更多资产、WAF/CDN绕过的IPs、内部/外部基础设施、公开暴露的漏洞以及更多关于其目标的信息。</p><h1 id="8ff7" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak"> 3。Bash自动化图标</strong></h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi md"><img src="../Images/c7387bcdb2b79bcb062367cd599c87d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12_w8coQm-Vapgp89Grs0Q.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><strong class="bd lf">找到</strong><a class="ae lb" href="https://twitter.com/hashtag/CDNs?src=hashtag_click" rel="noopener ugc nofollow" target="_blank"><strong class="bd lf">【CDNs】</strong></a><strong class="bd lf">/</strong><a class="ae lb" href="https://twitter.com/hashtag/WAFs?src=hashtag_click" rel="noopener ugc nofollow" target="_blank"><strong class="bd lf">【WAFs】</strong></a><strong class="bd lf">像</strong><a class="ae lb" href="https://twitter.com/hashtag/cloudflare?src=hashtag_click" rel="noopener ugc nofollow" target="_blank"><strong class="bd lf">【cloud flare】</strong></a><strong class="bd lf">使用被动侦察通过检索</strong><a class="ae lb" href="https://twitter.com/hashtag/favicon?src=hashtag_click" rel="noopener ugc nofollow" target="_blank"><strong class="bd lf">【favicon】</strong></a><strong class="bd lf">【hash】。[需要Shodan Premium API]</strong></figcaption></figure><p id="0b0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">推文:</strong><a class="ae lb" href="https://twitter.com/Dheerajmadhukar/status/1378369856907616259" rel="noopener ugc nofollow" target="_blank">https://Twitter . com/Dheerajmadhukar/status/1378369856907616259</a></p><h1 id="e12d" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak"> 4。历史DNS数据存储库</strong></h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi me"><img src="../Images/81f27f457f036f01e075b0e16fa0e485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7aeg4ZJjEmet221k_Qpj9g.png"/></div></div></figure><p id="49c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">链接:</strong>T46】https://securitytrails.com/dns-trails</p><p id="e665" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">面向安全公司、需要深入调查的研究人员、发现DNS记录的可疑变化以及防止未来欺诈或犯罪活动的数据。</p><h1 id="9ad5" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak"> 5。有时SPF/DMARC/DKIM记录</strong></h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/bdae9d1c9452bfe85172fd17e8da638f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5HMV0d3P6nU3HAB-zksig.png"/></div></div></figure><p id="1f69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你所有的MX记录，域名，黑名单和SMTP诊断在一个集成的工具。输入一个<strong class="jp ir">域名</strong>或<strong class="jp ir"> IP地址</strong>或<strong class="jp ir">主机名。</strong></p><p id="b29b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">还有更多……</strong></p><blockquote class="mg mh mi"><p id="26ae" class="jn jo mj jp b jq jr js jt ju jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj kk ij bi translated">让游戏开始吧。。。</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/38e313a94a2e88ae04d71472bdf65ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*9EAQtG-BgZTZ6M1gvTwhdA.gif"/></div></figure><blockquote class="mg mh mi"><p id="8efb" class="jn jo mj jp b jq jr js jt ju jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj kk ij bi translated"><strong class="jp ir">漏洞详情</strong></p></blockquote><p id="0fc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">描述:</strong></p><p id="3890" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在最初的资产评估期间，我发现了一个使用D-DOS保护的“sub.redacted.tld”子域。我发现sub.redacted.com站点暴露了其IP，这可能允许绕过反DDoS机制和WAF，这很重要。</p><p id="54ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">域名“sub . redated . TLD”目前解析为x.x.x.1、x.x.x.2、x.x.x.3和IPv6 xxxx:xxxx:xdex:x29:xcde:XXX:xx40:x8x 1—归Cloudflare所有，我能够使用Favicon Hash确定当前的源服务器IP。</p><p id="3306" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">影响:</strong> <br/>正如许多其他提交材料中所报告的，Cloudflare绕过可以产生重大影响，因为任何对手现在都能够直接与源服务器通信，从而使他们能够执行未经过滤的攻击(如拒绝服务)，以及数据检索和WAF绕过。</p><blockquote class="mg mh mi"><p id="8916" class="jn jo mj jp b jq jr js jt ju jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj kk ij bi translated"><strong class="jp ir">验证步骤【概念验证】</strong></p></blockquote><p id="b001" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">复制步骤:</strong></p><ol class=""><li id="34e9" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">只需访问:<em class="mj">https://redated . TLD</em></li><li id="dd1e" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">找出绝对网址获取favicon . ico:<br/><em class="mj">https://redacted.tld/img/icons/redacted/favicon.ico</em></li><li id="861e" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">现在为这个图标生成散列:</li><li id="48ab" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">$ curl-s-L-k "<em class="mj">https://redacted.tld/img/icons/redacted/favicon.ico</em>" |<em class="mj">python 3-c '导入mmh3，sys，编解码器；print(mm H3 . hash(codecs . encode(sys . stdin . buffer . read()，" base64 "))'</em></li></ol><p id="28f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出:<br/> -645272014</p><p id="4e3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.我们准备用上面的哈希值在**SHODAN**上搜索，as:<br/>$ SHODAN search http . favicon . hash:-645272014</p><p id="3a93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出:</p><p id="6eb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">* x . x . x . x * 80 hostname . redated . TLD HTTP/1.1 200 OK \ r \ n服务器:nginx/1 . 18 . 0 \ r \ n日期:2020年11月19日星期四23:39:07 GMT \ r \ n内容类型:text/html \ r \ n内容长度:199766 \ r \最后修改时间:2020年11月3日星期二16:02:21 GMT</p><p id="018b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:根据输出，IP[x . x . x . x]&amp;“hostname . redated . TLD”指向一个名为* sub . redated . TLD *的子域</p><p id="b1ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.要验证晶片是否被绕过，可以使用<strong class="jp ir"> wafw00f </strong>:</p><p id="8cf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 6a) </strong>执行:<br/>$ wafw 00 f-a<a class="ae lb" href="https://sub.redacted.tld" rel="noopener ugc nofollow" target="_blank">https://sub . redated . TLD</a>T39】输出:<br/> [+]站点<a class="ae lb" href="https://sub.redacted.tld" rel="noopener ugc nofollow" target="_blank">https://sub . redated . TLD</a>在Cloudflare (Cloudflare Inc.) WAF后面。</p><p id="db2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 6b) </strong>执行:<br/>$ wafw 00 f-a<a class="ae lb" href="http://x.x.x.x" rel="noopener ugc nofollow" target="_blank">http://x . x . x</a><br/>输出:<br/> [-]通用检测未检测到晶圆</p><p id="f7ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.<strong class="jp ir">建议:</strong> <br/>我的建议符合Cloudflare自己的指导方针[ref。:<a class="ae lb" href="https://support.cloudflare.com/hc/en-us/articles/201897700-Step-4-Recommended-First-Steps-for-all-Cloudflare-users" rel="noopener ugc nofollow" target="_blank"><em class="mj">https://support . cloudflare . com/HC/en-us/articles/2018 97 700-Step-4-Recommended-First-Steps-for-all-Cloudflare-users</em></a>】源服务器必须专门与cloud flare的IP地址范围进行通信，否则—如cloud flare博客上的这篇帖子中所述[Ref .:<a class="ae lb" href="https://blog.cloudflare.com/ddos-prevention-protecting-the-origin/" rel="noopener ugc nofollow" target="_blank"><em class="mj">【https://blog . cloud flare . com/DDOS-prevention-protecting-the-origin/</em></a>】，拥有反向代理提供的保护基本上就变得没用了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/1fa52f0da0570c29026d83a294752ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/1*TXES_m2b_8E3kdMiob2NOQ.gif"/></div></figure><p id="1725" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你得到一些动力去做bug奖金，并在下一篇文章中再次见到你。</p><p id="a3a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mj">推特简介:</em></strong><em class="mj">@</em><a class="ae lb" href="https://twitter.com/Dheerajmadhukar" rel="noopener ugc nofollow" target="_blank">Dheerajmadhukar</a></p><p id="df24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mj"> LinkedIn简介:</em></strong><em class="mj">@</em><a class="ae lb" href="https://www.linkedin.com/in/dheerajtechnolegends/" rel="noopener ugc nofollow" target="_blank">dheerajtechnolegends</a></p><p id="36cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mj"> GitHub简介:</em></strong><a class="ae lb" href="https://github.com/Dheerajmadhukar/" rel="noopener ugc nofollow" target="_blank">@ Dheerajmadhukar</a></p></div></div>    
</body>
</html>