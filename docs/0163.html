<html>
<head>
<title>TokyoWesterns CTF 4th 2018 Writeup — Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">东京西部4th 2018年第4期报道—第4部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tokyowesterns-ctf-4th-2018-writeup-part-4-f64e1583b315?source=collection_archive---------0-----------------------#2018-09-09">https://infosecwriteups.com/tokyowesterns-ctf-4th-2018-writeup-part-4-f64e1583b315?source=collection_archive---------0-----------------------#2018-09-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4207" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">世界协调时+2时间2018年9月9日上午01:33</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/1c9da5b7cc70637469923e371fa052d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQBylNhVvUhxlQ2t0oGNXQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">东京西部4th 2018年第4期报道—第4部分</figcaption></figure><p id="65cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">又来了，又一个我在比赛中从Tokyo westerns CTF 2018第四届平台得到的密码学挑战。这个挑战需要数学，这就是为什么我花了一天时间来解决这个问题，我将在下面详细解释。</p><h1 id="d354" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">革命安全安沟—156分</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/418e21b0f96982020b2e2182c23925e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FARRUUeETQ5S4WPqoMe9Zw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">革命安全</figcaption></figure><blockquote class="ma mb mc"><p id="7b0e" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated"><strong class="jp ir">挑战:</strong><a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/challenge/revolutional-secure-angou-de97106aa248a41a40fdd001fc5f7b4b4f28a39eb6bcabf8401b108b7a8961c5.7z" rel="noopener ugc nofollow" target="_blank">revolutional-secure-angou . 7z</a></p></blockquote><p id="cee4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是本次挑战中给出的三个文件:加密文本<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/flag.encrypted" rel="noopener ugc nofollow" target="_blank"> <em class="md"> flag.encrypted </em> </a>和公钥<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/publickey.pem" rel="noopener ugc nofollow" target="_blank"> <em class="md"> publickey.pem </em> </a>和脚本ruby<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/generator.rb" rel="noopener ugc nofollow" target="_blank"><em class="md">generator . Rb</em></a>作为生成器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/e15432ff42ed7f6327b40b050b5fdb0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*GP2IxexxTZ6YnkjBflWFfA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">革命性的安全安沟文件</figcaption></figure><p id="edd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们读一下生成器，试着理解它，因为它是用来加密标志信息的。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f5bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，这是<a class="ae mh" href="https://www.ruby-lang.org/en/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Ruby </strong> </a>中<a class="ae mh" href="https://www.openssl.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> OpenSSL </strong> </a>的一个实现，我们有一个指数<strong class="jp ir"> e </strong>和两个1024位的质数<strong class="jp ir"> p </strong>和<strong class="jp ir"> q </strong>，用于生成模数，然后生成公钥，用于加密标志并生成加密文本作为<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/flag.encrypted" rel="noopener ugc nofollow" target="_blank"> <em class="md">标志。</em></a></p><p id="990f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相应地，这就是应用<a class="ae mh" href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> RSA </strong> </a>算法对消息进行加密这也是我们的目标。为了达到它，我们必须解密<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/flag.encrypted" rel="noopener ugc nofollow" target="_blank"> <em class="md">标志。用<a class="ae mh" href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> RSA </strong> </a>加密</em> </a>。</p><p id="21a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">众所周知，<a class="ae mh" href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> RSA </strong> </a>中的加密需要公钥，这意味着模数<strong class="jp ir"> N </strong>和公共指数<strong class="jp ir"> e </strong>。我们有<strong class="jp ir"> e </strong>如上面的生成器脚本所示，让我们提取<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/publickey.pem" rel="noopener ugc nofollow" target="_blank"><em class="md">public key . PEM</em></a>文件以便找到模数<strong class="jp ir"> N </strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/3a24ea975af1745ea8ce9df9df077a14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-a_l5VVgMqzwRNNsmy7Lxw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">从publickey.pem中提取模数N和公共指数e</figcaption></figure><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="a753" class="mr lc iq mn b gy ms mt l mu mv"><strong class="mn ir">N = 16809924442712290290403972268146404729136337398387543585587922385691232205208904952456166894756423463681417301476531768597525526095592145907599331332888256802856883222089636138597763209373618772218321592840374842334044137335907260797472710869521753591357268215122104298868917562185292900513866206744431640042086483729385911318269030906569639399362889194207326479627835332258695805485714124959985930862377523511276514446771151440627624648692470758438999548140726103882523526460632932758848850419784646449190855119546581907152400013892131830430363417922752725911748860326944837167427691071306540321213837143845664837111<br/>e = 65537</strong></span></pre><p id="4fe7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所知，<a class="ae mh" href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">RSA</strong></a><strong class="jp ir"/>中的解密需要私钥，即模数N和私钥指数<strong class="jp ir"> d </strong>。如上所示，我们有<strong class="jp ir"> N </strong>，我们必须计算<strong class="jp ir"> d. </strong>为了做到这一点，我们必须计算<strong class="jp ir"> e </strong>和<strong class="jp ir"> </strong> <a class="ae mh" href="https://simple.wikipedia.org/wiki/Euler%27s_totient_function" rel="noopener ugc nofollow" target="_blank">欧拉函数</a><strong class="jp ir">φ</strong>的逆模。phi是未知的，因为你需要质数<strong class="jp ir"> p </strong>和<strong class="jp ir"> q </strong>来计算它，而这些质数也是未知的。你不能因式分解<strong class="jp ir"> N </strong>。</p><p id="0b01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们在<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/generator.rb" rel="noopener ugc nofollow" target="_blank"> <em class="md"> generator.rb </em> </a>脚本中有一句有趣的台词:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="b9d5" class="mr lc iq mn b gy ms mt l mu mv"><strong class="mn ir">q = OpenSSL::BN.new(e).mod_inverse(p)</strong></span></pre><p id="e53b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="f812" class="mr lc iq mn b gy ms mt l mu mv"><strong class="mn ir">q = mod_inverse(p)</strong></span></pre><p id="68c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过一天的分析，并试图找到一个好的数学解决方案，这里是我最后的数学解决方案:</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="d040" class="mr lc iq mn b gy ms mt l mu mv"><strong class="mn ir">q = mod_inverse(p)<br/>q = e ^ (-1) mod p<br/>q * e = 1 mod p<br/>q * e = k * p + 1                            # k is multiplier</strong></span></pre><p id="7e51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们用<strong class="jp ir"> q </strong>乘以上面的等式。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="90be" class="mr lc iq mn b gy ms mt l mu mv"><strong class="mn ir">q * q * e = q * (k * p + 1)<br/>(q ^ 2) * e = (k * p * q) + q<br/>(q ^ 2) * e = (k * N) + q                          # N = p * q<br/>((q ^ 2) * e) - q = k * N<br/>q = ((k * N) / e) ^ 2</strong></span></pre><p id="626b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">模数<strong class="jp ir"> N </strong>已知，公共指数<strong class="jp ir"> e </strong>已知，所以想法是强行<strong class="jp ir"> k </strong>直到找到质数<strong class="jp ir"> q </strong>除以模数<strong class="jp ir"> N </strong>。然后计算<strong class="jp ir"> q </strong>然后计算<strong class="jp ir">φ</strong>然后计算私钥指数<strong class="jp ir"> d </strong>然后使用私钥解密<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/flag.encrypted" rel="noopener ugc nofollow" target="_blank">flag . encryptedT19】即模数<strong class="jp ir"> N </strong>和私钥指数<strong class="jp ir"> d </strong>。</a></p><p id="9803" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我的<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/rsa.py" rel="noopener ugc nofollow" target="_blank"> <em class="md">脚本</em> </a> python我用来自动化我的数学求解和暴力<strong class="jp ir"> k </strong>然后计算直到解密<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/crypto/revolutional%20secure%20angou/flag.encrypted" rel="noopener ugc nofollow" target="_blank"><em class="md">flag . encrypted</em></a>并找到标志:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="cf54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结果:</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mw"><img src="../Images/d15522c6c6f088eb99e617feee695513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jqKzhTNYy60doNKvo4NYjA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">rsa.py脚本的结果</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/09f516c4c529ff687af3a6759ed28ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GeOTsOBmJwnmVhyHvmonnw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">交出革命安全的安国旗帜</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mx"><img src="../Images/9acd6dce5fa8252f5e7f93dc33535a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q1gh-GPciFiEyDxksK-ucA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">革命的安全问题已经解决</figcaption></figure><blockquote class="ma mb mc"><p id="fe33" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">标志为:<strong class="jp ir">tw CTF { 9 c10a 83 c 122 a9 adfe 6586 f 498655016d 3267 f 195 }</strong></p></blockquote><p id="7753" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个很好的挑战，有太多的乐趣，尤其是在数学部分。再次感谢东京西部团队。如果你正在寻找我的文章的其他部分，这里是列表:</p><ul class=""><li id="3ae1" class="my mz iq jp b jq jr ju jv jy na kc nb kg nc kk nd ne nf ng bi translated"><a class="ae mh" href="https://medium.com/bugbountywriteup/tokyowesterns-ctf-4th-2018-writeup-part-1-78558397cb7b" rel="noopener"> <strong class="jp ir">东京西部4th 2018年第4期报道—第1部分</strong> </a></li><li id="f053" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nd ne nf ng bi translated"><a class="ae mh" href="https://medium.com/bugbountywriteup/tokyowesterns-ctf-4th-2018-writeup-part-2-81c77cffe7ec" rel="noopener"> <strong class="jp ir">东京西部4th 2018年第4期报道—第二部分</strong> </a></li><li id="f8fe" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nd ne nf ng bi translated"><a class="ae mh" href="https://medium.com/bugbountywriteup/tokyowesterns-ctf-4th-2018-writeup-part-3-1c8510dfad3f" rel="noopener"> <strong class="jp ir">东京西部4th 2018年第4期报道—第3部分</strong> </a></li><li id="1118" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nd ne nf ng bi translated"><a class="ae mh" href="https://medium.com/@Abdelkad3r/tokyowesterns-ctf-4th-2018-writeup-part-4-f64e1583b315" rel="noopener"> <strong class="jp ir">东京西部4th 2018年第4期报道—第4部分</strong> </a></li><li id="dd7b" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nd ne nf ng bi translated"><a class="ae mh" href="https://medium.com/@Abdelkad3r/tokyowesterns-ctf-4th-2018-writeup-part-5-6d699f07f71c" rel="noopener"> <strong class="jp ir">东京西部4th 2018年第4期报道—第5部分</strong> </a></li></ul></div></div>    
</body>
</html>