<html>
<head>
<title>Write-up: Forced OAuth profile linking @ PortSwigger Academy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向上写:强制OAuth配置文件链接@ PortSwigger Academy</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/write-up-forced-oauth-profile-linking-portswigger-academy-2ce996700c9c?source=collection_archive---------1-----------------------#2022-10-31">https://infosecwriteups.com/write-up-forced-oauth-profile-linking-portswigger-academy-2ce996700c9c?source=collection_archive---------1-----------------------#2022-10-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/af20bebac27643d6daea22f738b371e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*veHXn-YmrwlzMlOd.png"/></div></div></figure><p id="03c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇关于实验室<em class="kw">强制OAuth配置文件链接</em>的文章是我为<a class="ae kx" href="https://portswigger.net/web-security" rel="noopener ugc nofollow" target="_blank"> PortSwigger的网络安全学院</a>所做的系列演练的一部分。</p><p id="03f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">学习路径</strong>:高级主题→ OAuth认证</p><div class="ky kz gp gr la lb"><a href="https://portswigger.net/web-security/oauth/lab-oauth-forced-oauth-profile-linking" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">实验室:强制OAuth配置文件链接|网络安全学院</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">在本实验中，您可以选择将社交媒体配置文件附加到您的帐户，以便您可以通过OAuth登录…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">portswigger.net</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><p id="468b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Python脚本:<a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/blob/main/22_OAuth_authentication/Forced_OAuth_profile_linking/script.py" rel="noopener ugc nofollow" target="_blank"> script.py </a></p><h1 id="74aa" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">实验室描述</h1><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/135a238eee3122b6d01eee10f151bfd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Qp7xAjUnfVESvPnH.png"/></div></div></figure><h1 id="c375" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">步伐</h1><p id="bf3b" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">通常，第一步是分析实验室应用程序的功能。在这个实验室中，它是一个博客系统。我还可以访问一个漏洞服务器，该服务器可以托管一个网页，我可以将该网页发送给受害者。</p><p id="0654" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该应用程序允许我将一个社交媒体档案链接到我的帐户。之后，我可以用它来代替我的凭证登录。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/adfd67c25ffb7de6b1989db53bc69844.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/0*QniAC4lJPocKjaQT.png"/></div></figure><p id="02b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我这样做是为了分析链接帐户所涉及的流量:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/1c7af715c468d2f95e9d0314a75542d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zta0I8IamRQCSpdd.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">链接过程的所有请求</figcaption></figure><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/74b6ea973cd980ba2835e9a305ba7c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cZVhSlBxfXDwQlQ_.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">请求#27启动链接过程</figcaption></figure><p id="3afc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">值得注意的是，这个请求似乎不包含任何标识符，应用程序可以通过这个标识符来验证oauth提供者收到的响应是由当时登录的用户触发的。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/f94da32bd13a71d61a38e13ab35e8dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4M8teODrvN8Fs3HE.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">请求#37完成帐户链接</figcaption></figure><p id="9e02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">果然，一旦我的浏览器和OAuth提供者之间的所有请求都完成了，对OAuth客户机(博客应用程序)的请求就包含了OAuth提供者提供的代码以及我的会话cookie。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="d1c3" class="lq lr iq bd ls lt nn lv lw lx no lz ma mb np md me mf nq mh mi mj nr ml mm mn bi translated">该理论</h1><p id="40ba" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">我现在知道我的应用程序登录和OAuth提供者之间的链接是在链接过程的最后一次重定向时完成的。</p><p id="2ee9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据请求历史，我假设OAuth访问与后一个请求时登录的帐户相关联。</p><p id="df8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我假设我可以从自己的帐户启动OAuth链接，但是将最终请求返回给应用程序。然后，我在漏洞服务器上创建一个包含最终重定向的页面，并将其发送给受害者。</p><p id="3259" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的OAuth帐户应该链接到应用程序的管理员帐户。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h1 id="2024" class="lq lr iq bd ls lt nn lv lw lx no lz ma mb np md me mf nq mh mi mj nr ml mm mn bi translated">恶意负载</h1><p id="08bf" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">由于我的OAuth帐户已经链接到了<code class="fe ns nt nu nv b">wiener</code>的帐户，我等待实验室应用程序超时继续。</p><p id="7117" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我通过开始链接我的OAuth帐户来发起攻击。然后，我将最后一个请求返回给应用程序:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/fdffb1a476e6411f5437f64fd38b6d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DsKTlTBlM92D5Dj3.png"/></div></div></figure><p id="3266" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该请求是由OAuth提供者重定向回应用程序引起的。我转到HTTP历史记录，复制响应并将其作为页面粘贴到我的漏洞服务器上。</p><p id="50fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重要的部分是启动重定向的<code class="fe ns nt nu nv b">Location</code>头，所以我去掉了一些杂波，尤其是cookies:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/e142f31b21755eed6465286b9a315f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6ZF9JAeJpramYYmx.png"/></div></div></figure><p id="bfff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将漏洞发送给受害者，并希望管理员检查该页面。</p><p id="98d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了确定我是否成功，我注销了应用程序，并使用OAuth提供者登录。</p><p id="04f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，管理员遵守了实验室说明并检查了所有页面。我的帐户页面现在显示我的社交媒体帐户链接到博客应用程序的管理员帐户:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/89b49c1544b9c37bf62783ae37617fab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6hwcFcOPKDoSCee4.png"/></div></div></figure><p id="4450" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦我访问管理面板并删除用户<code class="fe ns nt nu nv b">carlos</code>，实验室将更新为</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/412245af185d6e3719b882f619b6f8bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aU8FSCHYd5vfopjb.png"/></div></div></figure></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="7da2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">最初发表于</em><a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/tree/main/22_OAuth_authentication/Forced_OAuth_profile_linking" rel="noopener ugc nofollow" target="_blank"><em class="kw"/></a><em class="kw">。</em></p><p id="f8a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ns nt nu nv b"><a class="ae kx" href="https://medium.com/@frank.leitner/membership" rel="noopener">New to Medium? Become a Medium member to access all stories on the platform and support me at no extra cost for you!</a></code></p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h2 id="8877" class="oa lr iq bd ls ob oc dn lw od oe dp ma kj of og me kn oh oi mi kr oj ok mm ol bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kx" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>