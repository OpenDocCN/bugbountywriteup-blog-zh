<html>
<head>
<title>Full Company Building Takeover</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">全面接管公司大楼</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/company-building-takeover-10a422385390?source=collection_archive---------0-----------------------#2022-10-06">https://infosecwriteups.com/company-building-takeover-10a422385390?source=collection_archive---------0-----------------------#2022-10-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1ea0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，大多数时候你会读到账户接管或基础设施接管，但你以前听说过公司大楼接管吗？今天我将与大家分享一个有趣的漏洞，这是我在Hackerone上搜索一个程序时发现的，所以让我们把我们的目标称为Target-IP.com</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2e0fdf515602555f956f5c8e8644c91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Xo1VKNulaJ9opX-2WtrpA.jpeg"/></div></div></figure><p id="8641" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我从看一眼shodan开始</p><blockquote class="kx ky kz"><p id="4300" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated">ssl: <company ssl="" name=""/></p></blockquote><p id="0113" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在其他IP上花了一些时间后，在结果中发现了一些包含一些登录面板的IP，但我没有发现任何值得报告的内容，直到我找到我们想要的IP，我们的故事开始了</p><p id="2cf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进入IP后，我发现出现登录面板</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi le"><img src="../Images/9305d34dde19b992f7119c50d2305ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0aW9d8oJQo6xe7mn6nRwmg.png"/></div></div></figure><p id="d68f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在收集了一些信息后，我发现这是一个公司之间常用来管理公司建设的产品</p><p id="faf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我开始查看是否有任何公开利用</p><p id="767e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以让我们先来看看searchsploit</p><blockquote class="kx ky kz"><p id="e3bd" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><strong class="jp ir">┌──(omar㉿kali)-[~】<br/>└─$ searchsploit“浮现”</strong></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lf"><img src="../Images/b7cb0b1576c93ef4057f3aa2c0d501ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tO1TQNUw1Mh9v9hRENbpA.png"/></div></div></figure><p id="1798" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很好，这里有些有趣的发现</p><p id="f63e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但不幸的是，它们都不起作用</p><p id="ed05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我在其他网站上完成了对谷歌、packetstorm、GitHub等任何公开攻击的搜索…</p><p id="7cb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发现了一些其他漏洞，但该产品似乎已打了补丁</p><p id="cd83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在分析标题时，我发现了那个标题</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lg"><img src="../Images/05494b5ee6224f7905ecea53b1558b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVPRZLW-1pBCEJfW8NUWJg.png"/></div></div></figure><p id="9e18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PHP版本是PHP/5，我们有登录面板，所以你认为这个版本最好的攻击场景是什么？</p><p id="0866" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是PHP类型的杂耍</p><p id="06c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们转到登录请求</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lg"><img src="../Images/04134141c403c0f114f0257ace16d50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JTP4ciUK3u4gEqXu8gK0nA.png"/></div></div></figure><p id="b744" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参数以字符串形式在POST请求中发送，为了能够测试PHP类型杂耍，我们需要用保存参数数据类型的内容类型来测试它，如果它是字符串或整数，例如JSON</p><p id="0beb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我更改了内容类型和参数，用JSON发送请求</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lh"><img src="../Images/114cbd75d7d20f6dd2b24d3b5f5c763a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYtfrb4_dvIxJl4jFh-Jeg.png"/></div></div></figure><p id="9943" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是后端似乎不接受JSON，因为它不能识别login_id参数，这意味着我们的类型杂耍攻击在开始之前就失败了</p><p id="2bd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，我开始测试它的一些攻击，如登录面板上的SQLI，但它并不脆弱</p><p id="98e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试访问注册端点，也许我可以注册一个新用户作为管理员或特权较少的用户(如注册，注册，注册，创建新用户)</p><blockquote class="kx ky kz"><p id="8839" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><strong class="jp ir">┌──(omar㉿kali)-[~】<br/>└─$</strong>ffuf-w公共-注册-端点-u https:// &lt;目标-IP&gt;/模糊</p></blockquote><p id="6d72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我一无所获</p><p id="b644" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我开始做一些繁重的起毛工作</p><blockquote class="kx ky kz"><p id="631e" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><strong class="jp ir">┌──(omar㉿kali)-[~】<br/>└─$</strong>python 3 dirsearch . py-w my-word list-u https://&lt;target-IP&gt;/-o dirsearch-output . txt</p></blockquote><p id="2e59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在背景上工作的左侧目录搜索</p><p id="d546" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后开始对JS文件进行分析，希望找到一些允许任何类型的破坏访问控制漏洞、强制浏览、暴露令牌或硬编码凭证的端点，我试图通过找到一些源来获得基于DOM的XSS，跟踪它们到接收器或找到任何类型的隐藏参数，在做所有这些工作的同时，我发现dirsearch已经完成了她的工作</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi li"><img src="../Images/34d96b9eb43ab1df6d54f13970a9212c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oBgyCNdCICtT-Tl27scLFw.png"/></div></div></figure><p id="9048" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">乍一看，我以为“test.txt”文件除了一些开发人员响应的流行消息之外，什么也不包含，比如“Hello World！”，“嗨”等等…但是让我们检查一下</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/5f4fa0cfcb5c5a0753ec13722486f9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*geQh6kVLpgL3mlrZ0L9BYg.png"/></div></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="1a7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试在登录面板上输入凭据</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lm"><img src="../Images/1809fb1f57f6af36f238bcb8a8779095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*II5-MkprvArFw1iNUhuT9g.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">注:上图中的数据是根据数据的敏感性编辑的</figcaption></figure><p id="af66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在仪表板上发现的第一件事是包含管理员IP地址和员工进入大楼时间的日志</p><p id="db9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，现在我认为没有必要再完成我的JS分析了😁</p><p id="7606" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以管理员身份访问登录面板后，让我们看看我们能做些什么</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lr"><img src="../Images/ba9b9305a04955195799ce38e028d746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f2c49JuJuLWfQmGnBoM63A.png"/></div></div></figure><p id="289d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现我可以观看公司大楼的现场摄像机</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ls ll l"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lt"><img src="../Images/7edcbc04148e3355671e60b227b81518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGlY6cEYuX8FOTzCG1QHbQ.png"/></div></div></figure><p id="235e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现我可以控制大楼的电梯，门</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lu ll l"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lv"><img src="../Images/e8386060fe202af2502f6dcd54bc03d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ylPwIzHpX8-Bx6KNvOioAg.png"/></div></div></figure><p id="d5b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以收集员工数据，添加新员工并授权他们进入公司大楼</p><h1 id="7da9" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">最终影响:</h1><p id="6126" class="pw-post-body-paragraph jn jo iq jp b jq mu js jt ju mv jw jx jy mw ka kb kc mx ke kf kg my ki kj kk ij bi translated">控制整个建筑</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ls ll l"/></div></figure><p id="452f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你们喜欢这篇报道</p><p id="49a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">别忘了在Twitter上关注</p><p id="0930" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特:<a class="ae mz" href="https://twitter.com/OmarHashem666" rel="noopener ugc nofollow" target="_blank"> @OmarHashem666 </a></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na ll l"/></div></figure><h2 id="243e" class="nb lx iq bd ly nc nd dn mc ne nf dp mg jy ng nh mk kc ni nj mo kg nk nl ms nm bi translated">保持联络</h2><p id="079e" class="pw-post-body-paragraph jn jo iq jp b jq mu js jt ju mv jw jx jy mw ka kb kc mx ke kf kg my ki kj kk ij bi translated"><a class="ae mz" href="https://www.linkedin.com/in/omar-1-hashem/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Linkedin</strong></a><strong class="jp ir">|</strong><a class="ae mz" href="https://www.youtube.com/channel/UCJ1yNtgZP5LRO7ebZXSnAZQ" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Youtube</strong></a><strong class="jp ir">|</strong><a class="ae mz" href="https://twitter.com/OmarHashem666" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Twitter</strong></a></p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><h2 id="d179" class="nb lx iq bd ly nc nd dn mc ne nf dp mg jy ng nh mk kc ni nj mo kg nk nl ms nm bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mz" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>