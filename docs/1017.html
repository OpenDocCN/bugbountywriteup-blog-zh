<html>
<head>
<title>Setup Android Test Lab on an Android Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android Studio上设置Android测试实验室</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/apk-testing-on-an-android-studio-c0addb12550?source=collection_archive---------2-----------------------#2020-12-09">https://infosecwriteups.com/apk-testing-on-an-android-studio-c0addb12550?source=collection_archive---------2-----------------------#2020-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7f06" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在Android设备模拟器上运行APK文件并分析DEX/Smali代码。</h2></div><p id="cf9b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">本文指导您如何在Android Studio上构建Android测试实验室，以逆向工程和测试Android应用程序。它强调了Android应用程序测试所需的一些有用工具的使用。</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/fad262fda4d894155fa31cff07b1b6da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SuDG2C-Rg5vlDpi3"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">照片由<a class="ae lv" href="https://unsplash.com/@rami_alzayat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rami Al-zayat </a>在<a class="ae lv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="566b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">使用的工具:</h1><ul class=""><li id="b789" class="mo mp it kk b kl mq ko mr kr ms kv mt kz mu ld mv mw mx my bi translated">从APK文件中获取小代码。</li><li id="9d20" class="mo mp it kk b kl nd ko ne kr nf kv ng kz nh ld mv mw mx my bi translated"><code class="fe mz na nb nc b">adb</code> - Android Debug Bridge是一个命令行，允许你与设备进行交互。</li><li id="e329" class="mo mp it kk b kl nd ko ne kr nf kv ng kz nh ld mv mw mx my bi translated"><code class="fe mz na nb nc b">Jadx </code>或<code class="fe mz na nb nc b">jadx-gui</code>——从APK文件中获取Java源代码。</li><li id="4f6c" class="mo mp it kk b kl nd ko ne kr nf kv ng kz nh ld mv mw mx my bi translated">Android Studio - Android开发和测试软件。(<em class="le"> GenyMotion是另一款软件，是android应用测试的专用平台。)</em></li></ul></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="8b9f" class="lw lx it bd ly lz np mb mc md nq mf mg jz nr ka mi kc ns kd mk kf nt kg mm mn bi translated">什么是APK？</h1><p id="13ae" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">一个安卓的app是用Java写的。一旦编码完成，android应用开发者使用Android Studio上的<strong class="kk iu"> java2smali </strong>插件将java代码转换成smali语言。所有的文件和文件夹然后被打包成一个APK文件，签名并准备好用于安装和运行应用程序。</p><h1 id="ef5f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">对APK文件进行逆向工程</h1><p id="07ae" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">调试APK文件时，它会提取为构建此应用程序而创建的所有文件/文件夹。</p><blockquote class="nx"><p id="a010" class="ny nz it bd oa ob oc od oe of og ld dk translated">Java源代码-------&gt;。斯马利。DEXEDRINE的简称</p></blockquote><h2 id="44be" class="oh lx it bd ly oi oj dn mc ok ol dp mg kr om on mi kv oo op mk kz oq or mm os bi translated">使用Android Studio进行调试</h2><p id="e94c" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">在android studio中，点击<strong class="kk iu">文件&gt;配置文件或调试APK </strong>并选择您想要分析的APK文件。</p><p id="da41" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">APK的例子取自hackerone ctf。</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ot"><img src="../Images/97de80af151306ce0eda43615ba5e7ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bWYtneRj6HM1Pa41GQd1XA.png"/></div></div></figure><h2 id="613f" class="oh lx it bd ly oi ou dn mc ok ov dp mg kr ow on mi kv ox op mk kz oy or mm os bi translated">使用<code class="fe mz na nb nc b">apktool</code>工具进行调试</h2><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oz"><img src="../Images/bd8a4dd00422d1c1fc6b8d927725d592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VhqI-zKlmktXSXzEzserqQ.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pa"><img src="../Images/30e874a46ac664e8aa19a62694ebf0b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_hKMpus0MEFvJmGrk5cZdg.png"/></div></div></figure><h1 id="a4ec" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">将DEX/Smali代码转换成Java源代码。</h1><p id="cc1b" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">如果您想阅读java代码，那么在您的操作系统上安装<code class="fe mz na nb nc b">jadx</code>将dex/smali代码转换成Java。在这里，我已经在MacOS中安装了我的。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pb"><img src="../Images/6639fd45d87a5069569c5609c621324d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uswqS_AApmmupiTQwXtxcQ.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pc"><img src="../Images/c414b3363653e7defd9109d13f0c8fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*p2vplopsJXnuZDPb9G7f0Q.png"/></div></div></figure><p id="1fba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用jadx-gui，我现在能够阅读Java源代码了。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pd"><img src="../Images/1d6ae3462605c14e5040df504e0b2413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*02rwU_9KvTiKqncJWt3law.png"/></div></div></figure><h1 id="3320" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">运行Android虚拟设备(AVD)</h1><p id="94d2" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated"><strong class="kk iu">我现在想看看这个应用程序是做什么的，以及它在虚拟手机上是如何工作的。</strong></p><p id="6ad8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Android Studio上，导入APK文件后，打开AVD管理器创建一个Android模拟器并安装您选择的系统映像。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/9b4da6debc0d83d412e7294683e0d0fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*t1R8OulgdtimflY34S_wLw.png"/></div></figure><blockquote class="nx"><p id="f8d6" class="ny nz it bd oa ob pf pg ph pi pj ld dk translated"><strong class="ak">根设备</strong> —如果设备是开发版本，那么它是根设备。注意:根设备上的一些应用程序可能会检测到这一点，并将拒绝工作。</p><p id="8f22" class="ny nz it bd oa ob oc od oe of og ld dk translated"><strong class="ak">非根设备</strong> —如果设备是生产版本，那么它是非根设备。24级及以上的系统映像API都是非根的。</p></blockquote><figure class="pl pm pn po pp lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pk"><img src="../Images/0b7b660e7b32ea378bfdf7dd09e2cc1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P0p7j8hVx_ybYDeyMRPufg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">推荐部分的Android Studio非根系统映像。</figcaption></figure><p id="bfd6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">解除虚拟手机设备根的方法:</strong></p><ul class=""><li id="e23e" class="mo mp it kk b kl km ko kp kr pq kv pr kz ps ld mv mw mx my bi translated">使用<a class="ae lv" href="http://www.supersu.com/download" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> SuperSU </strong> </a> app移除root权限。</li><li id="f979" class="mo mp it kk b kl nd ko ne kr nf kv ng kz nh ld mv mw mx my bi translated">使用ES文件管理器取消根。</li><li id="dc9d" class="mo mp it kk b kl nd ko ne kr nf kv ng kz nh ld mv mw mx my bi translated">通过安装OTA更新来解除root。</li><li id="b3f6" class="mo mp it kk b kl nd ko ne kr nf kv ng kz nh ld mv mw mx my bi translated">通过安装库存固件来解除引导。</li></ul><p id="b042" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">Android studio中所有这些推荐的系统镜像都是非根的</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pk"><img src="../Images/db63a51a30ab141fa5410627575bb01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Eyk8zIh-TaLDyf-bjnmiw.png"/></div></div></figure><p id="dd36" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi pt translated"><span class="l pu pv pw bm px py pz qa qb di"> N </span> <strong class="kk iu"> ext，选择您的AVD(根或非根)后，点击绿色箭头运行AVD。</strong></p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="cd76" class="lw lx it bd ly lz np mb mc md nq mf mg jz nr ka mi kc ns kd mk kf nt kg mm mn bi translated">在Mac Android Studio上使用ADB命令行</h1><p id="0857" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">如果你想使用命令行，那么ADB是一个用来连接AVD的工具，允许你运行有用的命令。</p><p id="03a5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用命令行，请首先遵循以下步骤:</p><h2 id="08a8" class="oh lx it bd ly oi ou dn mc ok ov dp mg kr ow on mi kv ox op mk kz oy or mm os bi translated">启用USB调试模式</h2><p id="f27a" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">启用AVD中的<strong class="kk iu">开发者选项</strong>，然后启用<strong class="kk iu"> USB调试模式</strong>:</p><p id="3d78" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">转到<strong class="kk iu">系统设置&gt;关于仿真设备&gt;内部版本号</strong>(点击5次)访问“开发者选项”。</p><p id="10e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，进入<strong class="kk iu">设置&gt;系统&gt;高级&gt;开发者选项</strong>打开USB调试。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi qc"><img src="../Images/960a8d10b55942e070ceb6cc0798ad5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I2CTTt3NHvX5KKrEfP6L_g.png"/></div></div></figure><h1 id="dc4a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">仿真器外壳</h1><p id="0c88" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">在USB调试模式下启动设备仿真器后，在Android Studio终端的MAC终端上点击以下命令，并访问<code class="fe mz na nb nc b">adb</code>路径:</p><p id="ef0e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mz na nb nc b">cd ~/Library/Android/sdk/platform-tools</code></p><blockquote class="qd qe qf"><p id="c0d3" class="ki kj le kk b kl km ju kn ko kp jx kq qg ks kt ku qh kw kx ky qi la lb lc ld im bi translated">在windows its上:<code class="fe mz na nb nc b"><em class="it">%USERPROFILE%\AppData\Local\Android\sdk\platform-tools\</em></code></p></blockquote><p id="3dca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mz na nb nc b">./adb reboot bootloader</code> -重启安卓设备。<strong class="kk iu"> <em class="le">注意:</em> </strong> <em class="le">如果设备/仿真器没有运行，这将不起作用。</em></p><p id="a498" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mz na nb nc b">./adb devices</code> - <em class="le">如果USB调试被禁用，仿真器设备将显示为离线。</em></p><p id="6008" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mz na nb nc b">./adb shell</code> -一旦你进入shell，你可以做<code class="fe mz na nb nc b">su root</code>来提升权限。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi qj"><img src="../Images/492d43191ab5b3548792a50aff629536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26SiayKz4Kf4hTBwiyIUwg.png"/></div></div></figure><p id="8226" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> Apps文件位置路径:</strong> <code class="fe mz na nb nc b">/data/app</code> &amp; <code class="fe mz na nb nc b">/data/data</code></p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="6868" class="lw lx it bd ly lz np mb mc md nq mf mg jz nr ka mi kc ns kd mk kf nt kg mm mn bi translated">将AVD连接到Burpsuite以拦截流量</h1><p id="8670" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated"><strong class="kk iu">现在，我希望我的虚拟电话被Burpsuite拦截，以进一步分析入站/出站流量。</strong></p><h2 id="9555" class="oh lx it bd ly oi ou dn mc ok ov dp mg kr ow on mi kv ox op mk kz oy or mm os bi translated">在AVD中安装Burp的CA证书</h2><p id="f646" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">在Burpsuite上，设置代理设置。</p><p id="9ae7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">转到此<a class="ae lv" href="https://portswigger.net/support/installing-burp-suites-ca-certificate-in-an-android-device" rel="noopener ugc nofollow" target="_blank">端口触发器</a>安装证书的步骤。</p><p id="83ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在你的设备模拟器上，点击<strong class="kk iu">三点&gt;设置&gt;代理</strong>并应用设置。</p><p id="739b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你现在可以开始拦截AVD的流量了。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi qk"><img src="../Images/f8f525d6a26da6d6ef87f935158d6fc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*muX0UvJDY9Akja-Y5aMMEA.png"/></div></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="fd38" class="lw lx it bd ly lz np mb mc md nq mf mg jz nr ka mi kc ns kd mk kf nt kg mm mn bi translated">APK签名者</h1><p id="a284" class="pw-post-body-paragraph ki kj it kk b kl mq ju kn ko mr jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">修改应用程序源代码并重新构建APK文件后，需要对其进行签名。要做到这一点，下载优步APK签名<a class="ae lv" href="https://github.com/patrickfav/uber-apk-signer" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="34a0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mz na nb nc b">java -jar uber-apk-signer.jar -a /path/to/apk</code></p><p id="2fb8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您现在可以运行修改后的应用程序了。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="d607" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">感谢阅读！感谢您的反馈:-) </em></p></div></div>    
</body>
</html>