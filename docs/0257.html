<html>
<head>
<title>Nullcon CTF HackIM - Crypto 2FUN Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nullcon CTF哈基姆-加密2乐趣写起来</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/nullcon-ctf-hackim-crypto-2fun-writeup-4ade2eb3821?source=collection_archive---------0-----------------------#2019-02-06">https://infosecwriteups.com/nullcon-ctf-hackim-crypto-2fun-writeup-4ade2eb3821?source=collection_archive---------0-----------------------#2019-02-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/78c67ae09aec6b985092620e4099398f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cxrIu8bXFPPQi2VJQZ66Dw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Nullcon CTF 2019</figcaption></figure><p id="31cd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">CTF-捕捉旗帜</strong>是挑战自我的好方法。我积极参与这些活动已经有一年多了。这一次，我说服了我的朋友<a class="la lb ep" href="https://medium.com/u/9f03520537f8?source=post_page-----4ade2eb3821--------------------------------" rel="noopener" target="_blank">米德胡尔·瓦尔马</a>和我一起参加<a class="ae lc" href="https://ctf.nullcon.net" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">纳尔康·CTF</strong></a>。他和我是一个很好的团队，我们以前一起参加过CTFs。</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><p id="bdd0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">就在CTF开始后，我们看了一下网络和pwn的挑战，明白没有简单的事情。如果你是一个新手，那么你可能不知道在CTF中常规经验非常重要。你从阅读的文章和之前解决的挑战中获得灵感。</p><p id="31fd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，我们最初专注于加密挑战，因为那里没有技巧。你有完整的逻辑，因为它是加密的，它必须是数学上可解的。</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><p id="e3d4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这一组中比较容易的是<strong class="ke ir"> <em class="lk"> 2FUN </em> </strong>挑战，它涉及到破解一个双重密码以解密其密文被给出的标志。</p><p id="f8ff" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">加密函数是在python脚本中提供的(当然，没有密钥):</p><figure class="ll lm ln lo gt jr"><div class="bz fp l di"><div class="lp lq l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">2fun.py</figcaption></figure><p id="0b37" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">也给出了通过用相同的密钥加密字符串“16位纯文本”获得的密文(该字符串实际上是16字节长，可能是问题设置者的一个打印错误)</p><pre class="ll lm ln lo gt lr ls lt lu aw lv bi"><span id="e527" class="lw lx iq ls b gy ly lz l ma mb">"16 bit plaintext": b’0467a52afa8f15cfb8f0ea40365a6692' <br/>flag (unknown) : b’04b34e5af4a1f5260f6043b8b9abb4f8'</span></pre><p id="01a9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们的目标是解密后来的密文以获得标志。<strong class="ke ir"><em class="lk">fun</em></strong><em class="lk"/>方法是一种采用24位密钥对给定的明文进行加密的密码。孤立地破解这个密码很容易。因为我们有一个已知的明文、密文对，所以我们可以对所有可能的2个⁴密钥(1千万到1亿个时钟周期)进行暴力破解。然而，挑战并不直接应用这个密码。实际的密码是<strong class="ke ir"><em class="lk">too fun</em></strong><em class="lk"/>，它用不同的密钥在纯文本上连续两次应用fun。(因此得名2FUN)。</p><blockquote class="mc md me"><p id="c88e" class="kc kd lk ke b kf kg kh ki kj kk kl km mf ko kp kq mg ks kt ku mh kw kx ky kz ij bi translated">这实际上使得密钥大小为48位，使得简单的暴力破解不可行。</p></blockquote></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><h2 id="06f4" class="lw lx iq bd mi mj mk dn ml mm mn dp mo kn mp mq mr kr ms mt mu kv mv mw mx my bi translated">我们现在怎么破解密码？</h2><p id="e6ff" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">我们还能把<strong class="ke ir"> <em class="lk"> fun </em> </strong>当做黑箱来解决吗，或者我们需要利用它的内部结构？</p><p id="5bd5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">事实证明，我们不需要打开那个黑盒。我们只需要利用<strong class="ke ir"> <em class="lk"> toofun </em> </strong>两次使用相同密码的事实。<strong class="ke ir"> <em class="lk"> toofun </em> </strong>对明文应用<strong class="ke ir"> <em class="lk"> fun </em> </strong>得到中间<em class="lk">密文(ct1) </em>，然后在此之上应用fun得到<em class="lk">最终密文</em>。</p><p id="98ed" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们有一个(明文，最终密文)对。如果我们知道这种情况下的中间密文(ct1)，我们就完成了(因为我们可以通过暴力破解)。</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><h2 id="c383" class="lw lx iq bd mi mj mk dn ml mm mn dp mo kn mp mq mr kr ms mt mu kv mv mw mx my bi translated">我们能找到ct1吗？</h2><p id="2995" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">从toofun的定义来看:</p><pre class="ll lm ln lo gt lr ls lt lu aw lv bi"><span id="cf9a" class="lw lx iq ls b gy ly lz l ma mb">ct1 = fun(key1, '16 bit plaintext')<br/>b’04b34e5af4a1f5260f6043b8b9abb4f8' = fun(key2, ct1)</span></pre><p id="a0bc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们可以将此改写为:</p><pre class="ll lm ln lo gt lr ls lt lu aw lv bi"><span id="3b42" class="lw lx iq ls b gy ly lz l ma mb">ct1 = fun(key1, '16 bit plaintext')<br/>ct1 = funinv(key2, b’04b34e5af4a1f5260f6043b8b9abb4f8')</span></pre><p id="aef9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">其中<strong class="ke ir"><em class="lk">funninv</em></strong>是<strong class="ke ir"> <em class="lk">的【逆/解密】</em> </strong>功能<strong class="ke ir"> <em class="lk">乐趣</em> </strong>。现在我们需要找到满足这些方程的<strong class="ke ir"> <em class="lk"> ct1，key1，key2 </em> </strong>。</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><h2 id="48de" class="lw lx iq bd mi mj mk dn ml mm mn dp mo kn mp mq mr kr ms mt mu kv mv mw mx my bi translated">我们该怎么做？</h2><p id="404b" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated"><strong class="ke ir">诀窍很简单</strong>:我们首先对<strong class="ke ir"> <em class="lk"> key1 </em> </strong>进行蛮力运算，得到<strong class="ke ir"> <em class="lk"> fun(key1、‘16坑明文’)</em></strong><em class="lk">，</em>的所有可能输出，我们将所有这些存储在一个哈希表/字典中。</p><p id="06e6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后我们对<strong class="ke ir"><em class="lk">【key 2】</em></strong>进行蛮力运算，直到找到一个值<strong class="ke ir"> <em class="lk"> funinv(key2，b ' 04b 34 e 5a F4 a 1 f 5260 f 6043 b 8 B9 abb 4 f 8 ')= = fun(key 1，' 16 pit plaintext') </em> </strong> <em class="lk">，</em>使用哈希表进行快速查找。</p><p id="863e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于每个<strong class="ke ir"><em class="lk">key 1</em></strong>&amp;<strong class="ke ir"><em class="lk">key 2</em></strong>的大小只有24位，所以暴力破解是可行的。一旦发现这样的匹配/碰撞，我们就知道<strong class="ke ir"> <em class="lk"> key1 </em> </strong>，<strong class="ke ir"> <em class="lk"> key2 </em> </strong>就大功告成了。</p><p id="775a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要完成这项工作，我们需要实现<strong class="ke ir"> <em class="lk"> funinv </em> </strong>，这并不难。只要反过来读《乐趣的密码》就行了。</p><figure class="ll lm ln lo gt jr"><div class="bz fp l di"><div class="lp lq l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="ak"><em class="ne">fun inv</em></strong>-<strong class="ak">的逆<em class="ne">乐趣</em> </strong>功能</figcaption></figure><p id="d853" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后是如上所述的两遍蛮力:</p><figure class="ll lm ln lo gt jr"><div class="bz fp l di"><div class="lp lq l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">2遍蛮力</figcaption></figure><p id="fb34" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果我没记错的话，在我的笔记本电脑上运行需要1-2个小时。你可以很容易地优化它，让它运行得更快，但我太懒了。</p><p id="923c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最终，当冲突发生时，它会吐出<strong class="ke ir"><em class="lk">key 1</em></strong>+<strong class="ke ir"><em class="lk">key 2</em></strong>，您可以用它来解密标志密文。(可以使用2次调用<strong class="ke ir"> <em class="lk"> funinv </em> </strong>来反转<strong class="ke ir"> <em class="lk"> toofun </em> </strong>)。</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><p id="4441" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这样做给了我们<em class="lk">旗:</em><strong class="ke ir"><em class="lk">hackim 19 { 1337 _ 1n _ m1 DDL 38 f }</em></strong><em class="lk"/>这很适合我们的解决方案:在中间相遇！</p><p id="d089" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">故事的寓意</strong>:用不同的密钥组成一个密码两次肯定会增加密钥空间的大小，但对密码的安全性没有任何影响。</p><p id="2da3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">思考的食粮</strong>:涂两次以上会怎么样？</p><p id="b5a9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">感谢<a class="la lb ep" href="https://medium.com/u/9f03520537f8?source=post_page-----4ade2eb3821--------------------------------" rel="noopener" target="_blank"> Midhul Varma </a>帮助我写报告，感谢Nullcon团队创造了一个平衡和令人敬畏的挑战。</p></div></div>    
</body>
</html>