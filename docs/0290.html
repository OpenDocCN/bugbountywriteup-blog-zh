<html>
<head>
<title>How I gained access to revenue and traffic data of thousands of Shopify stores</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何获得数千家Shopify商店的收入和流量数据的</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-gained-access-to-revenue-and-traffic-data-of-thousands-of-shopify-stores-b6fe360cc369?source=collection_archive---------0-----------------------#2019-04-15">https://infosecwriteups.com/how-i-gained-access-to-revenue-and-traffic-data-of-thousands-of-shopify-stores-b6fe360cc369?source=collection_archive---------0-----------------------#2019-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b12225240311098bd97507a63c296f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-O4M2l-xUktmYvRriHhSiw.png"/></div></div></figure><h1 id="0a48" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">索引</h1><ol class=""><li id="7f05" class="kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><strong class="lb iu">简介</strong></li><li id="f53f" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><strong class="lb iu">几乎不堪一击</strong></li><li id="bac6" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><strong class="lb iu">获取da词表</strong></li><li id="3038" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><strong class="lb iu">失败</strong></li><li id="b588" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><strong class="lb iu">新方法</strong></li><li id="a43d" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><strong class="lb iu">漏洞利用</strong></li><li id="ac8a" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><strong class="lb iu">时间线</strong></li><li id="2555" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated"><strong class="lb iu">外卖</strong></li></ol><p id="7b4d" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated"><em class="mn">在此公开披露之前，Shopify已给予撰写博客文章的许可</em></p><h1 id="f236" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">1.介绍</h1><p id="5d4d" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi mr translated"><span class="l ms mt mu bm mv mw mx my mz di">答</span>大约一年前，当我入侵Shopify程序时，我必须设置几个警报，以便每当一个新的API端点出现在子域和URL列表中时得到通知(这是我为跟踪新API而编写的自定义脚本)。</p><p id="0796" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">几个月后，我收到了一个关于我以前从未见过的新端点的通知，内容类似于:</p><blockquote class="na nb nc"><p id="dfce" class="lw lx mn lb b lc ly lz ma le mb mc md nd me mf mg ne mh mi mj nf mk ml mm lm im bi translated">&gt;/shops/REDACTED/traffic _ data . JSON<br/>&gt;/shops/REDACTED/revenue _ data . JSON</p></blockquote><p id="6004" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">老实说，我没有费心去检查这些端点，只是因为我已经收到了大量针对各种目标的新警报。另一个原因是，我没有积极地搜索任何程序，只是在周末花几个小时，并且主要依靠侦察自动化在每次我得到有趣的警报时快速获胜。</p><p id="2f2b" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated"><em class="mn">回到故事… </em>几个月后，我收到了另一个与相同端点相关的警报:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/9cf9910edcb109faafcd040ca01e9148.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*kzkgky9Guz7KHzr3VcQxTA.png"/></div></figure><p id="a771" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">这意味着最后一个端点已经从子域名源中移除，这对于我来说确实是一个危险信号，我需要深入了解到底发生了什么，并调查它被移除的原因。</p><h1 id="4b1d" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">2.几乎不堪一击</h1><p id="c070" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi translated">经查，<strong class="lb iu">删改的</strong>基本上是一家Shopify店铺的名字(<strong class="lb iu">删改的</strong> .myshopify.com是店铺的链接)。在<a class="ae nl" href="https://exchangemarketplace.com/shops/" rel="noopener ugc nofollow" target="_blank">https://exchangemarketplace.com/shops/</a>(别名<a class="ae nl" href="https://exchange.shopify.com" rel="noopener ugc nofollow" target="_blank">https://exchange.shopify.com</a>)积极上市销售。</p><p id="0f22" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">所以第一件事是检查下面的端点(为了简单[和有趣]，我稍后称之为<strong class="lb iu"> <em class="mn">几乎易受攻击的</em> </strong>端点)</p><pre class="nh ni nj nk gt nm nn no np aw nq bi"><span id="853f" class="nr kc it nn b gy ns nt l nu nv"><em class="mn">(sample data)</em></span><span id="277d" class="nr kc it nn b gy nw nt l nu nv">$ curl -s <a class="ae nl" href="https://exchange.shopify.com/shops/$storeName/revenue_data.json" rel="noopener ugc nofollow" target="_blank">https://exchange.shopify.com/shops/<strong class="nn iu">$storeName</strong>/revenue_data.json</a></span><span id="d93a" class="nr kc it nn b gy nw nt l nu nv">{"2018–03–01":102.81,"2018–04–01":13246.83,"2018–05–01":29865.84,"2018–06–01":45482.13,"2018–07–01":39927.62,"2018–08–01":25864.51,"2018–09–01":14072.72,"2018–10–01":2072.16,"2018–11–01":13544.78,"2018–12–01":26824.54,"2019–01–01":31570.89,"2019–02–01":18336.71}</span></pre><p id="4373" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">显然是泄露了<strong class="lb iu">修改过的</strong>店的收入数据。API端点应该在内部使用，以获取销售数据并以公共图形的形式呈现。在这种情况下，公开商店的数据在exchange marketplace上销售，并在图表中公开显示相同的数据是意料之中的行为:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/3d7babde5dd2a130db02f9fe340537f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FK9IkYCVvc7Ic1c8Qqv4LA.png"/></div></div></figure><p id="88a7" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我发现同一个API又泄漏了另一家商店的收入数据。该商店不久前被出售，并从市场上删除，但由于某种原因，数据仍被返回。</p><p id="6a8c" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">此时，我几乎可以肯定端点容易受到不安全的直接对象引用(IDOR)安全漏洞的攻击，该漏洞在$storeName上迭代。</p><p id="3bd6" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">接下来，我建立了一个新商店，并在同一个易受攻击的API端点上使用$storeName来检查我们是否会获得我们新商店的销售数据，以最终验证漏洞的合法性并将其报告给Shopify</p><pre class="nh ni nj nk gt nm nn no np aw nq bi"><span id="04d8" class="nr kc it nn b gy ns nt l nu nv">$ curl -I <a class="ae nl" href="https://exchangemarketplace.com/shops/$newStore/revenue_data.json" rel="noopener ugc nofollow" target="_blank">https://exchangemarketplace.com/shops/$newStore/revenue_data.json</a></span><span id="5120" class="nr kc it nn b gy nw nt l nu nv"><strong class="nn iu">HTTP/2 404</strong><br/>server: nginx/1.15.9<br/>date: Fri, 29 Mar 2019 20:28:18 GMT<br/>content-type: application/json<br/>vary: Accept-Encoding<br/>vary: Accept-Encoding<br/>x-request-id: 106906213c97052838ccaaaa54d8e438</span></pre><p id="4b8d" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi">404?</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/4ecd1d6f01bd8562a4315574612ef406.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*E4WM_6eVTFMvjKL7IKeRpA.jpeg"/></div></figure><blockquote class="na nb nc"><p id="dc51" class="lw lx mn lb b lc ly lz ma le mb mc md nd me mf mg ne mh mi mj nf mk ml mm lm im bi translated">好的。这不会像预期的那么容易！</p></blockquote><p id="dc02" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">在这一点上，很明显我们还没有概念的工作证明，所以没有什么可以向Shopify报告的。；我必须仔细考虑所有可能的情况，以便弄清楚情况并彻底调查这种行为。</p><p id="a271" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我想到的第一个想法是最终对所有现有的商店进行大规模检查，看看我们是否能从任何商店中获得任何客户数据。第一次挑战？我们需要获得商店名称的单词列表；</p><p id="db9b" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated"><strong class="lb iu">攻击过程如下:</strong></p><ul class=""><li id="2d31" class="kz la it lb b lc ly le mb lg nz li oa lk ob lm oc lo lp lq bi translated">建立商店名称的单词列表(来自storename . myshopify . com)；</li><li id="3b11" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">迭代单词表对抗<strong class="lb iu"> <em class="mn">几乎不堪一击</em> </strong>端点:</li></ul><pre class="nh ni nj nk gt nm nn no np aw nq bi"><span id="3863" class="nr kc it nn b gy ns nt l nu nv">/shops/$storeName/revenue_data.json</span></pre><ul class=""><li id="b441" class="kz la it lb b lc ly le mb lg nz li oa lk ob lm oc lo lp lq bi translated">过滤掉易受攻击的域；</li><li id="e0db" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">分析受影响的商店，找出观察到的行为或最终漏洞的根本原因。</li></ul><h1 id="68d1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">3.获取da单词表</h1><p id="297b" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi translated">我们拥有的第一种方法是检查反向IP，以找到与该IP相关联的'<strong class="lb iu"> A </strong>'类型的所有DNS记录；</p><p id="3b7a" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">该商店位于$storeName.myshopify.com上，快速DNS查询会产生以下结果:</p><pre class="nh ni nj nk gt nm nn no np aw nq bi"><span id="fc16" class="nr kc it nn b gy ns nt l nu nv">; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; <strong class="nn iu">REDACTED</strong>.myshopify.com</span><span id="b349" class="nr kc it nn b gy nw nt l nu nv">&lt;...&gt;</span><span id="e0ff" class="nr kc it nn b gy nw nt l nu nv"><strong class="nn iu">REDACTED</strong>.myshopify.com. 3352 IN CNAME <strong class="nn iu">shops.myshopify.com</strong>.</span><span id="6133" class="nr kc it nn b gy nw nt l nu nv">shops.myshopify.com. 1091 IN A 23.227.38.64</span></pre><p id="b4a7" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">所以<strong class="lb iu">编选的</strong> .myshopify.com有一个<strong class="lb iu">指向shops.myshopify.com的</strong>CNAME，它本身又指向<strong class="lb iu"><em class="mn">23.227.38.64</em></strong>。幸运是，它背后没有反向代理WAF，所以我们可以使用该IP来获取托管在同一IP空间上的域的有效'<strong class="lb iu"> A </strong> ' DNS记录。</p><p id="e5fa" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">为此，我使用了我的一个脚本(在<a class="ae nl" href="https://gist.github.com/ayoubfathi/57c3fef7d4eada575a8b080cc3c4a562" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/ayoubfathi/57 C3 fef 7d 4 eada 575 A8 b 080 cc 3c 4a 562</a>找到它)</p><p id="f281" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我们将对shops.myshopify.com运行它，看看我们可以获得多少记录，运行它会产生以下输出:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/e39f419cafd30055aa399f082d541999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*df7oQ7GgBaM72Y-xM3zN_A.png"/></div></div></figure><p id="a952" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">因此，我们能够使用反向IP获得近1000家商店的网址。</p><p id="4a40" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">现在，我们需要获得与每个域相关的商店链接(即gadgetstore.com→storename . myshopify . com ),去掉＄storename并构建一个商店名称的单词列表，将其输入到我们的测试请求中</p><p id="6ad0" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi">.</p><h1 id="2297" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">4.失败</h1><p id="cc66" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi translated">因此，我构建了一个脚本来执行上述攻击流，并利用我们(我称之为)<strong class="lb iu"> <em class="mn">几乎易受攻击的</em> </strong>端点；它的基本功能如下:</p><ol class=""><li id="d6e7" class="kz la it lb b lc ly le mb lg nz li oa lk ob lm ln lo lp lq bi translated">使用上一个脚本(revIP.py)的输出，并将其提供给当前脚本。</li><li id="b584" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated">删除每个域的HTML源代码，专门寻找. myshopify.com链接。</li><li id="7702" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated">从废弃的链接中提取商店名称。</li><li id="f141" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm ln lo lp lq bi translated">自动应用<strong class="lb iu"> <em class="mn">中的商店名称几乎易受攻击</em> </strong>请求为:</li></ol><pre class="nh ni nj nk gt nm nn no np aw nq bi"><span id="061f" class="nr kc it nn b gy ns nt l nu nv">/shops/$storeName/revenue_data.json</span></pre><p id="9051" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">5.过滤出易受攻击的域并将其输出到标准输出</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="ad9b" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我们已经准备好运行脚本，运行它将产生以下结果！</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi on"><img src="../Images/4d269a834b1d78046951ed57f48f061b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*roUQW6OhEQox4IAnYerJTg.png"/></div></figure><p id="9762" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">只有四个结果？</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/c3e8c0fee0a59efff8de15bb1b7d78ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*CR73paeUYi8I95CVVtpRuw.jpeg"/></div></figure><p id="8a08" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">所以在1000家商店中，我只能确定四家易受攻击的商店，其中三家在exchange marketplace上上市，所以他们应该公开他们的销售数据，一家商店被停用(<em class="mn">幸运，是吧？</em>)</p><p id="1bb8" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">因此，我还没有看到这被认为是一个安全漏洞的任何安全影响。因此，我停止了几个星期的测试(忙碌的生活？)并决定以后再回来探索进一步的可能性，继续挖掘。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi op"><img src="../Images/f2a12b50f793e92df02a6039ba092113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*n-eFetEMQAqV0EwdykTyJA.jpeg"/></div></figure><p id="7825" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">几个星期后，我又回到了前面提到的那个API请求，并开始研究它。我无法从中获得任何有用的信息，所以我决定采用不同的方法来解决这个问题。</p><p id="9cb6" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">为了获得更多的数据进行分析，我们将从对1000家商店进行测试转向更大的样本(根据结果，可能是数千家、数百万家)。我们怎样才能成功呢？下一节将介绍新方法的细节。</p><h1 id="9575" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">5.新方法</h1><p id="d8a8" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi translated">找到所有现有Shopify商店而不遗漏任何商店的最佳方法是什么🤔</p><p id="c7a1" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我首先想到的是扫描互联网，但是当我们有其他人的数据时，我们为什么要这样做呢？</p><p id="2c79" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">在这个特别的研究中，我将使用FDNS。使用这种方法，我们不需要从给定的域列表中生成商店名称。相反，我们将使用FDNS来获得shops.myshopify.com的反向CNAME记录(所有商店都指向它)</p><p id="fc13" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我使用了一个非常规范的实例，并克隆了这项研究所需的数据</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/5ed56f22d79c839807159e8b41d2410c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PzsfEX7dSrpTReZdcc-VPw.png"/></div></div></figure><p id="bf0e" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">现在，我们将寻找与Shopify商家托管其商店的shops.myshopify.com相匹配的CNAME记录。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi or"><img src="../Images/11439da69c10d2d3c8dde8ddf6719f67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mcj1R-kq7jehQNp43vUA-g.png"/></div></div></figure><p id="c694" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">在检查有多少商店可用时，我发现:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi os"><img src="../Images/1843edd586b3793432b14b49365de050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s2RGg23ZYKLDMpyGUNXsag.png"/></div></div></figure><p id="7db4" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">耶！最后，我们有相当多的商店进行测试，而不是1000家商店的有限样本。</p><p id="30c3" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">接下来，让我们根据新的结果构建我们的商店名称新单词列表。它应该产生813684个条目。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ot"><img src="../Images/2c485925407f810fe5b2e41efb2517b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Db8-47F8jpZ40hqwqmUdnQ.png"/></div></div></figure><p id="1d71" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">至此，我们已经完成了单词列表，可以继续进行利用部分了。</p><h1 id="2979" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">6.利用</h1><p id="dfc2" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi translated">那是一个很晚的晚上，我编辑了前面提到的exploit.py脚本，以使用由813K个商店名称组成的新单词列表。</p><figure class="nh ni nj nk gt ju"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="93ba" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">然后SSH到我的盒子，因为单词表很大，我不会考虑等待结果，所以我必须在后台运行脚本，去睡一会儿。</p><p id="d0d7" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">试着睡了大约一个小时…</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/d3e923c5449ef09c04a970857d26d99f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*gzHYXKwPVMLpoe-DrHLWMg.jpeg"/></div></figure><p id="4e27" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我放弃了睡觉的想法，立即打开我的机器，登录到我的远程机器，我看到的是成千上万的403错误</p><p id="6f92" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我很快向同一个子域提出了一个请求，要求再次检查这是否是由于达到了速率限制，或者他们是否将该页面更改为禁止页面，以及…</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ov"><img src="../Images/3deaec83df07ba4cbba3359665086653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wtOh3TV4AQ1wgE-d8WTa_w.png"/></div></div></figure><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ow"><img src="../Images/81098c68d59913dcee510b794864bdfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ICaJOrokSuPz4vdybnNR7g.png"/></div></div></figure><p id="0b68" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">不允许？是的，我称之为“你得到了<strong class="lb iu"><em class="mn"/></strong></p><p id="fd51" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">让它见鬼去吧，这是漫长的一天，我今天需要好好睡一觉…</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="5e73" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">后来，我回来寻找绕过WAF的方法，我意识到bash脚本几乎每秒发出一个请求，对我来说这是一个不错的测试速度，所以我很快编写了另一个脚本来检查我们这次是否会通过(希望他们不会实现一个<a class="ae nl" href="https://community.akamai.com/customers/s/question/0D50f00005RtrAoCAJ/rate-control-in-security-monitor-need-to-understand-the-math?language=en_SG" rel="noopener ugc nofollow" target="_blank">平均阈值</a>收紧到这个数字)</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ox"><img src="../Images/04ce2e8b3f1d6fb9c6ead069472655d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WAgL8DPveQbK3t1Cqha1g.png"/></div></div></figure><p id="c51d" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">它基本上将80万个商店名称作为输入(stores-exchange.txt)，发送一个curl请求来检索销售数据，然后在将数据打印到stdout之前，使用DAP库将商店名称插入到同一个JSON响应条目中。</p><p id="876f" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">这一次我们的脚本将会非常慢，正如你所知道的bash是单线程的，这是我们能够绕过速率限制策略的唯一方法，我运行了脚本并从我的实例中注销…</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="375c" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">几天后，我重新登录到我的实例来检查结果。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oy"><img src="../Images/61780be11208fd0c936ce04d8c9c0c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3spc-q_DVHFqUPrbJ_86w.png"/></div></div></figure><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/8a5624472a507342a92d5feae474681c.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*9X0JeZ2Uk8qtWBYWMC63_A.gif"/></div></figure><p id="42b3" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我们正在获取Shopify商家的销售数据，其中包括从2015年到今天的数千家商店的每月美元收入明细<strong class="lb iu">。</strong></p><p id="338a" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我们有一个易受攻击商店的列表，因此如果我们查询其中任何一家，我们将获得当前商店在其<strong class="lb iu">生命周期</strong>内的<strong class="lb iu">美元</strong>月收入数据的明细:</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/979fc501c65ae3ccbaa602bc2f5b212c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*bOTbjkM6bvvlZ_cJ5hbudA.jpeg"/></div></figure><p id="6c13" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">这是一个Shopify商家<strong class="lb iu">从2015年至今</strong>的销售数据示例。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/7e2aadfff4df969aa3304d3c340a1da2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*xzu4wJKNURwO0QCvFpGIHg.jpeg"/></div></figure><h2 id="4e37" class="nr kc it bd kd pb pc dn kh pd pe dp kl lg pf pg kp li ph pi kt lk pj pk kx pl bi translated">影响</h2><p id="4e3e" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi translated">根据CVSS 3.0，这一特定发现的得分为<strong class="lb iu"> 7.5 —高</strong>，这反映了漏洞的重要性，客户流量和收入数据被暴露，无需特权或用户交互即可访问信息。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pm"><img src="../Images/fdf50c6258fbf0d069d686192ff8f03f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DHfwPac5CWTuRSLp5ZxrHQ.png"/></div></div></figure><p id="ea8c" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">我们在800，000家商户商店中进行了测试，其中+12，100家被曝光，+8700家是易受攻击的商店，我们能够获得他们的销售和流量数据，他们不应公开，3400家预计将公开他们的销售数据，总结如下:</p><ul class=""><li id="35d0" class="kz la it lb b lc ly le mb lg nz li oa lk ob lm oc lo lp lq bi translated">这是在+800，000家商店中测试的</li><li id="e467" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">+12，100人被暴露</li><li id="954a" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">+8700家商店易受攻击，其数据被设置为私有。</li><li id="c86b" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">只有+3400家商店的数据应该是公开的。</li></ul><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/5dad10a453bb38c27110d22cb3311eaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*w0IaJg9iknhaEHpjaLhDjQ.jpeg"/></div></figure><h2 id="80a0" class="nr kc it bd kd pb pc dn kh pd pe dp kl lg pf pg kp li ph pi kt lk pj pk kx pl bi translated">根本原因分析</h2><p id="8169" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi translated">综合以上数据和多几天的研究，我得出的结论是，这是由这个漏洞前几个月才推出的<a class="ae nl" href="http://apps.shopify.com/exchange" rel="noopener ugc nofollow" target="_blank"> Shopify Exchange App </a>(现在商家在积极使用)造成的。任何安装了Exchange应用程序的商家都容易受到攻击。</p><p id="a2e1" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">之后，我迅速将所有的信息和数据整理成一份报告，提交给Shopifybug bounty项目。</p><h1 id="800c" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">7.时间表</h1><ul class=""><li id="28ed" class="kz la it lb b lc ld le lf lg lh li lj lk ll lm oc lo lp lq bi translated">2018年10月13日:首次向Shopify披露</li><li id="0b89" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">2018年10月16日:审判</li><li id="8c68" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">2018年10月16日:已修复(分流后1小时)</li><li id="6118" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">2018年10月17日:需要更多信息</li><li id="bbaa" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">2018年11月1日:报告没有资格获得奖金(违反政策)</li></ul><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pn"><img src="../Images/9805f7b713fbd32ea2e0bc13f6cda9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPLGhmp8_OZQyxjUxZC9Ag.png"/></div></div></figure><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi po"><img src="../Images/f921c407f8b9a57ce651150e6dac2f66.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*itPUAy0JJ8jfocAXG1-LXQ.jpeg"/></div></figure><h2 id="5be2" class="nr kc it bd kd pb pc dn kh pd pe dp kl lg pf pg kp li ph pi kt lk pj pk kx pl bi translated">购物决策之我见</h2><p id="6b77" class="pw-post-body-paragraph lw lx it lb b lc ld lz ma le lf mc md lg mo mf mg li mp mi mj lk mq ml mm lm im bi translated">尽管我不同意针对我的第三次违反，但我还不能适当地确认上述漏洞的存在和合法性。此外，我不能持续地研究这种行为，所以我每周只有几个小时。</p><p id="a4c1" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">然而，关于第二次违反，我同意他们的意见，尽管有几点:</p><ul class=""><li id="2337" class="kz la it lb b lc ly le mb lg nz li oa lk ob lm oc lo lp lq bi translated">我测试的目的是为了展示影响，避免在没有任何概念工作证据的情况下发送理论报告。</li><li id="b5ab" class="kz la it lb b lc lr le ls lg lt li lu lk lv lm oc lo lp lq bi translated">我相信，如果我没有按照我的方式进行，我没有其他方法来证明这个特定安全漏洞的存在。</li></ul><p id="1a7b" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">坦白地说，甚至这份报告的结果也不尽如人意，但最终都是我的错。他们在政策页面上提到<strong class="lb iu">“禁止与非您创建的店铺互动”</strong>。</p><p id="2254" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">因此，我无意中违反了上述政策，尽管我的意图是好的。因此，我完全承担后果，尊重他们的决定。</p><h1 id="3f25" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">8.外卖食品</h1><h2 id="a8fb" class="nr kc it bd kd pb pc dn kh pd pe dp kl lg pf pg kp li ph pi kt lk pj pk kx pl bi translated">请务必仔细阅读政策，一旦发现问题，立即联系相关团队，即使您不确定这是一个漏洞。</h2><blockquote class="na nb nc"><p id="bc28" class="lw lx mn lb b lc ly lz ma le mb mc md nd me mf mg ne mh mi mj nf mk ml mm lm im bi translated">最后，不管结果如何，我很高兴至少这份报告让Shopify免遭潜在的破坏。最后，除了随之而来的金钱补偿之外，这也是驱使我工作并让我满足的任务之一。为每个人提供更安全的互联网！</p></blockquote><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pp"><img src="../Images/bec7be4b6b95cd53bd86b19151ce915e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGUqBj2FgW_TrTynrGvUag.png"/></div></div></figure><p id="65e5" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi mr translated"><span class="l ms mt mu bm mv mw mx my mz di"> M </span>感谢Shopify团队，特别是<a class="ae nl" href="https://twitter.com/yaworsk" rel="noopener ugc nofollow" target="_blank"> Peter Yaworski </a>的大力帮助。我仍然强烈建议入侵他们的程序，因为他们可以快速处理收到的报告。</p></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><p id="9f66" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated">大声喊出来<a class="ae nl" href="https://twitter.com/Yassineaboukir" rel="noopener ugc nofollow" target="_blank"> Yassine Aboukir </a>校对这篇文章。谢谢大家阅读它。欢迎在Twitter上关注我:<a class="ae nl" href="https://twitter.com/_ayoubfathi_" rel="noopener ugc nofollow" target="_blank"> @_ayoubfathi_ </a>或Linkedin: <a class="ae nl" href="https://www.linkedin.com/in/ayoubfathi/" rel="noopener ugc nofollow" target="_blank">阿尤布·法蒂</a></p><p id="2c2a" class="pw-post-body-paragraph lw lx it lb b lc ly lz ma le mb mc md lg me mf mg li mh mi mj lk mk ml mm lm im bi translated"><em class="mn">在此公开披露之前，Shopify已给予撰写博客文章的许可</em></p></div></div>    
</body>
</html>