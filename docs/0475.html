<html>
<head>
<title>How i buy a subdomain of Tokopedia’s website (yeah you read it right)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何购买Tokopedia网站的子域(是的，你没看错)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-bought-my-way-to-subdomain-takeover-on-tokopedia-8c6697c85b4d?source=collection_archive---------0-----------------------#2020-01-20">https://infosecwriteups.com/how-i-bought-my-way-to-subdomain-takeover-on-tokopedia-8c6697c85b4d?source=collection_archive---------0-----------------------#2020-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9674" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">Tl；dr:tokopedia网站的一个子域指向一个可以购买的过期顶级域名，所以很明显我会去买。</em></p><p id="f94a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Assalamualaikum Wr。Wb。(亲爱的读者，愿你平安)</p><p id="bc31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在挖掘一些旧邮件时，我发现了一个关于tokopedia.com的发现，我决定写一篇关于它的文章。Tokopedia是我的祖国印度尼西亚为数不多的几个拥有自己的公共昆虫赏金项目的公司之一。你可以在这里阅读规则和细节:【https://github.com/tokopedia/Bug-Bounty】T2。</p><p id="6bb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在阅读了他们的规则后，我注意到目标主要设置为通配符域(*.tokopedia.com和*.tokopedia.net)。所以我开始使用一些开源工具，比如sublist3r、knockpy、massdns等来列举子域。</p><p id="5d36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现了一些有趣的子域<a class="ae km" href="https://medium.com/bugbountywriteup/information-disclosure-and-reflected-xss-on-tokopedia-1b3a00ec64c6" rel="noopener">，在那里我也发现了一些有趣的发现</a>。但是引起我注意的是REDACTED.tokopedia.com，因为当我访问子域时，我从浏览器得到一个<em class="kl"> ERR_NAME_NOT_RESOLVED </em>错误页面。</p><p id="ea76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的终端中使用<strong class="jp ir"> <em class="kl"> dig </em> </strong>命令，发现CNAME配置指向另一个顶级域名(REDACTED.com)。因此，REDACTED.tokopedia.com实际上是另一个不同领域REDACTED.com的别名。</p><p id="db2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">令人惊讶的是，当我检查whois记录时，该域名实际上已经过期。所以我直接去了namecheap.com，看看是否可以买到，嗯，确实可以。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/eb25683af2b223b79c0841569a027412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QKs2VfnGBIoppkEMXCs8oQ.png"/></div></div></figure><p id="5b96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">困境来了，我当时真的是一文不名(不，说真的)，我连一个8块钱的域名，<strong class="jp ir"> <em class="kl">加</em> </strong>都买不起，我还不确定这个子域到底是不是真的可以接管。我甚至考虑在不购买域名的情况下报告这个漏洞，但我不认为这是个好主意。</p><p id="6ac0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，我决定冒险，向我的朋友借了8美元(是的，不是开玩笑)，然后买下了这个域名。</p><p id="943c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在将它指向一个免费的托管服务后，我再次尝试打开子域，嗯，我成功地接管了子域，因为它现在指向我自己的服务器。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/2e466c1319648cc1a06df8a6611c310b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*Ne3MNQWFseXwUTIRoDpBug.png"/></div></figure><p id="2a6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定为XSS做一些PoC，但是偶然发现了一个问题，因为cookies设置了安全标志，所以网站需要托管在https中。在我为REDACTED.com设置了一个免费的SSL证书后，另一个问题出现了，浏览器抛出了一个隐私警告，因为网站是从REDACTED.tokopedia.com访问的，而证书是为REDACTED.com签名的。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi la"><img src="../Images/850df039e9d48b83474fc5a615061011.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*yj8Ogwe9UuaB5_yK20FiSg.png"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">我从stackoverflow那里得到这个，警告是不同的，但是你得到了这个想法。</figcaption></figure><p id="a19b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们不让我做*.tokopedia.com SSL证书，我决定马上举报。如果用户决定点击<em class="kl">前进到……</em>按钮，我们仍然可以窃取cookies，所以是的。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lf"><img src="../Images/94674f978cd8237640599b78f50614ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*43kD9p_iPgbVeGx4Z46kiA.png"/></div></div></figure><p id="40e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">注:</em> </strong> <em class="kl">如果你发现一个子域被接管，我认为在首页展示一些不必要的东西是不明智的，公司不会喜欢，因为用户可能会看到它，这对他们的声誉不好。这份报告来自我早期作为一个Bug赏金猎人的经历，所以在首页显示“子域已被接管”可能不是个好主意。相反，我们可以在隐藏的html标签上写下我们的PoC，也许在首页上显示“正在维护中”。并且不要忘记随机化我们在那个子域上托管的文件名，这样它就不会被用户偶然发现。</em></p><p id="f3dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，安全团队验证了我的报告，这是一个严重程度很高的有效安全漏洞，他们决定奖励我$$$。</p><p id="7b3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">花8块钱买三位数的赏金？我认为这是一个绝对的胜利。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lg"><img src="../Images/472670a20637453a56fbfa87d34ba9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y6FvvxnlVerizmgYJhn9Vw.jpeg"/></div></div></figure><p id="7d23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Wassalamualaikum Wr。Wb。</p></div><div class="ab cl lh li hu lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="ij ik il im in"><p id="182f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">时间线:</strong></p><ul class=""><li id="d532" class="lo lp iq jp b jq jr ju jv jy lq kc lr kg ls kk lt lu lv lw bi translated"><strong class="jp ir">2019年7月27日:</strong>报告发送。</li><li id="2b94" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated"><strong class="jp ir">2019年7月29日:</strong>安全团队验证了该报告，有效，严重性高。</li><li id="e96e" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated"><strong class="jp ir">2019年7月31日:</strong> Bug修复，他们让我重新测试Bug。他们还询问了我发送奖励的银行信息。</li><li id="b811" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated"><strong class="jp ir">2019年11月20日:</strong> $$$获奖。</li></ul></div><div class="ab cl lh li hu lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="ij ik il im in"><p id="349c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">关注</em> <a class="ae km" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="kl"> Infosec报道</em> </a> <em class="kl">获取更多此类精彩报道。</em></p><div class="mc md gp gr me mf"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd ir gy z fp mk fr fs ml fu fw ip bi translated">信息安全报道</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">medium.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt kx mf"/></div></div></a></div></div></div>    
</body>
</html>