<html>
<head>
<title>Pwning WordPress Passwords</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">密码</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/pwning-wordpress-passwords-2caf12216956?source=collection_archive---------0-----------------------#2018-05-07">https://infosecwriteups.com/pwning-wordpress-passwords-2caf12216956?source=collection_archive---------0-----------------------#2018-05-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/32cfe19fecd652bd0df8b0c1abcf03f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Tx-sVTUTOaDgW_Ac3f7bLw.gif"/></div></div></figure><p id="e904" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的<a class="ae kw" href="https://medium.com/bugbountywriteup/stapler-pt-2-webshells-cronjobs-549b13dbf3d3" rel="noopener">上一篇文章</a>中，我从服务器恢复了<code class="fe kx ky kz la b">mysql</code>凭证，并从那里将一个webshell写到磁盘。这一次，我们将通过转储散列，用<code class="fe kx ky kz la b">John The Ripper</code>破解它们，以及用<code class="fe kx ky kz la b">Hydra</code>强制WordPress登录来进一步利用数据库内容。</p><h2 id="3bc7" class="lb lc iq bd ld le lf dn lg lh li dp lj kj lk ll lm kn ln lo lp kr lq lr ls lt bi translated">获取哈希值</h2><p id="c567" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">为了用一行程序访问<code class="fe kx ky kz la b">mysql</code>服务，我使用了以下代码:</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="4539" class="lb lc iq la b gy mh mi l mj mk">mysql --user=root --password=plbkac --host=192.168.15.151</span></pre><p id="db28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于真实的约定和以明文形式输入密码存在安全问题的情况，您可以省略<code class="fe kx ky kz la b">-password</code>标志，而是在连接时提示您输入密码。</p><p id="234d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦我们连接到服务，我们可以开始枚举里面的东西！首先，让我们列出数据库:</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="72ad" class="lb lc iq la b gy mh mi l mj mk">&gt; show databases;</span></pre><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="fded" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到有几个。今天的兴趣是<code class="fe kx ky kz la b">wordpress</code>，但是<code class="fe kx ky kz la b">loot</code>和<code class="fe kx ky kz la b">proof</code>很有趣，我鼓励每个人自己去看看。</p><p id="abe9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们来列举一下<code class="fe kx ky kz la b">wordpress</code>数据库。为此，我们必须选择它:</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="6db5" class="lb lc iq la b gy mh mi l mj mk">&gt; use wordpress</span></pre><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="e1d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很简单。现在让我们看看这个数据库中有哪些表:</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="f0eb" class="lb lc iq la b gy mh mi l mj mk">&gt; show tables;</span></pre><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="8c02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好吧，酷。这看起来就像是所有需要储存在博客上的东西被保存的地方。让我们看看<code class="fe kx ky kz la b">wp_users</code>表，看看我们是否能得到一些信用:</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="cba1" class="lb lc iq la b gy mh mi l mj mk">&gt; describe wp_users;</span></pre><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="8b8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看看这些字段，我们似乎会对<code class="fe kx ky kz la b">user_login</code>和<code class="fe kx ky kz la b">user_pass</code>感兴趣。要查看这些字段:</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="c427" class="lb lc iq la b gy mh mi l mj mk">&gt; select user_login, user_pass from wp_users;</span></pre><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="e8a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们也可以将这两个文件连接在一起，看起来像<code class="fe kx ky kz la b">user:password</code>:</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="5c32" class="lb lc iq la b gy mh mi l mj mk">&gt; select concat_ws(‘:’, user_login, user_pass) from wp_users;</span></pre><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1d92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以复制并粘贴这个列表，因为它只有16个条目。然而，我们也可以将它写入一个文件，并从服务器中检索它。在我之前的帖子中，我们通过<code class="fe kx ky kz la b">mysql</code>编写了一个webshell，并将其放在<code class="fe kx ky kz la b">/var/www/https/blogblog/wp-content/uploads/</code>目录中。</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="95f1" class="lb lc iq la b gy mh mi l mj mk">select concat_ws(‘:’, user_login, user_pass) from wp_users into outfile ‘/var/www/https/blogblog/wp-content/uploads/creds.txt’;</span></pre><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/cf386a773b3b9a2f5cdd2a034335982d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q40ElXxdWYNNkSjF8seyKA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">用户:通过</figcaption></figure><p id="3ef7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是哈希值。我们可以直接从服务器上获取这个文件，方法是:</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="0c08" class="lb lc iq la b gy mh mi l mj mk">curl -k https://192.168.15.151:12380/blogblog/wp-content/uploads/creds.txt &gt; creds.txt</span></pre><blockquote class="ms mt mu"><p id="6ec0" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">-k</code>忽略服务器的自签名证书</p></blockquote><h2 id="a69a" class="lb lc iq bd ld le lf dn lg lh li dp lj kj lk ll lm kn ln lo lp kr lq lr ls lt bi translated">破解哈希</h2><p id="e365" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">现在我们已经从服务器上获得了密码散列，让我们开始破解吧！由于我在虚拟机中运行Kali，我不能运行<code class="fe kx ky kz la b">hashcat</code>,因为我没有运行它的GPU。我破解哈希的首选是<code class="fe kx ky kz la b">John The Ripper</code>和<code class="fe kx ky kz la b">rockyou</code>单词表。不是因为这些总能让我得到结果，而是因为对于像VulnHub上的许多CTF风格的机器来说，如果散列应该被破解，这些应该可以做到。</p><p id="a66d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些是我以前没有体验过的phpass散列。我试着给<code class="fe kx ky kz la b">John The Ripper</code>一个<code class="fe kx ky kz la b">user:pass</code>格式来破解密码，并将它们关联到与之相关的用户名。然而，该文件导致了一个我没有预料到的格式错误。我能够成功地运行<code class="fe kx ky kz la b">John The Ripper</code>,只需要散列，不需要用户名。</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="f296" class="lb lc iq la b gy mh mi l mj mk">john hashes --wordlist=/usr/share/wordlists/rockyou.txt</span></pre><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/ccd7c669fbbb75ee1847e7cdd41830bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rGoqYXTVsmb5HXlGQCMxkA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">破解哈希</figcaption></figure><p id="f83d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单词表破解了大约一半的哈希。但是现在我遇到了一个不同的问题:哪个密码属于哪个账户？</p><h2 id="9fa2" class="lb lc iq bd ld le lf dn lg lh li dp lj kj lk ll lm kn ln lo lp kr lq lr ls lt bi translated">强力登录WordPress</h2><p id="d67f" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">为了将用户名与破解的密码关联起来，我选择使用<code class="fe kx ky kz la b">hydra</code>。我将用户名复制到一个文件中，将明文密码复制到另一个文件中。强制web登录比ssh之类的其他服务要复杂一些。这是因为您必须提供每个参数的字段名称以及会话cookies，以及不成功的尝试是什么样子的。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/46f79a3e27bd214125f354c967c009d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tizmDXVsmoFvcxMp8KCmTw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">测试请求</figcaption></figure><p id="1a13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了获得必要的字段名，我启动了<code class="fe kx ky kz la b">burpsuite</code>并创建了一个测试登录来拦截在认证尝试期间发送的字段。</p><p id="13b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我输入<code class="fe kx ky kz la b">name</code>作为用户名，输入<code class="fe kx ky kz la b">secret</code>作为密码。当我用<code class="fe kx ky kz la b">burpsuite</code>拦截请求时，我能够看到对于一次登录尝试来说还有其他必要的字段。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/ed6c3c65e97faeef5a2d9eef8b9aff72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IchV4Ec0mBgSEa1_mEj-Sg.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">打嗝</figcaption></figure><p id="f584" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">总之，我需要指定四个字段，<code class="fe kx ky kz la b">log</code>作为用户名，<code class="fe kx ky kz la b">pwd</code>作为密码，<code class="fe kx ky kz la b">wp-submit</code>作为登录名，<code class="fe kx ky kz la b">testcookie</code>等于<code class="fe kx ky kz la b">1</code>。当WordPress重定向一个成功的认证时，页面在源中包含<code class="fe kx ky kz la b">Location</code>；失败的情况并非如此。我们可以将所有这些信息交给<code class="fe kx ky kz la b">hydra</code>来破解这些密码。<code class="fe kx ky kz la b">hydra</code>使用<code class="fe kx ky kz la b">^USER^</code>和<code class="fe kx ky kz la b">^PASS^</code>作为锚字段，在暴力破解尝试中进行迭代。</p><pre class="lz ma mb mc gt md la me mf aw mg bi"><span id="d433" class="lb lc iq la b gy mh mi l mj mk">hydra 192.168.15.151 -s 12380 https-form-post “/blogblog/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location” -L users -P pass</span></pre><blockquote class="ms mt mu"><p id="cf29" class="jy jz mv ka b kb kc kd ke kf kg kh ki mw kk kl km mx ko kp kq my ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">-s</code>指定端口12380 <br/> <code class="fe kx ky kz la b">https-form-post</code>指定通过https发送post请求<br/> <code class="fe kx ky kz la b">/blogblog/wp-login.php</code>是登录页面<br/> <code class="fe kx ky kz la b">log=^USER^</code>指定用户名字段<br/> <code class="fe kx ky kz la b">pwd=^PASS^</code>指定密码字段<br/> <code class="fe kx ky kz la b">&amp;wp-submit=Log In</code>指定登录按钮<br/> <code class="fe kx ky kz la b">&amp;testcookie=1</code>指定cookie名称和值<br/> <code class="fe kx ky kz la b">S=Location</code>表示测试成功，成功将包含“位置”<br/> <code class="fe kx ky kz la b">-L</code>指定用户名列表名称<br/> <code class="fe kx ky kz la b">-P</code>指定密码列表名称</p></blockquote><p id="390c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为这个命令相当长，所以我把它放在一个shell脚本中，以便以后编辑和保存，并把它命名为<code class="fe kx ky kz la b">brute.sh</code>。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/dd5367aa87096d106d5d5377ff246086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-INEcT2MXw0xWlDFmLmxrw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">残忍的</figcaption></figure><p id="5370" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们看到<code class="fe kx ky kz la b">hydra</code>能够在几秒钟内将所有密码匹配到他们的用户名！在具有任何类型的日志记录或监控的机器上进行暴力破解是一件很麻烦的事情。有可能启动入侵防御系统，将我们的IP列入黑名单。然而，由于这台机器没有任何保护措施，我们可以用我们的用户列表和密码列表运行<code class="fe kx ky kz la b">hydra</code>并在没有<code class="fe kx ky kz la b">John The Ripper</code>的情况下得到相同的结果。</p><p id="13d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们能够破解WordPress管理员的多个证书。这些帐户拥有提升的权限，允许他们将任意文件写入机器上的磁盘。这是在盒子上获得外壳的可能途径。</p></div></div>    
</body>
</html>