<html>
<head>
<title>Insecure comparison in PHP — Business Logic Bypass vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP中的不安全比较—业务逻辑旁路漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/insecure-comparison-in-php-business-logic-bypass-vulnerability-83e08190f2e2?source=collection_archive---------2-----------------------#2022-03-11">https://infosecwriteups.com/insecure-comparison-in-php-business-logic-bypass-vulnerability-83e08190f2e2?source=collection_archive---------2-----------------------#2022-03-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/895611071b2d7f73de64efc17b0a8639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKzcgYFyybiTY1Abqs_lnw.png"/></div></div></figure><div class=""/><p id="4b54" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我最近在一个PHP应用程序中发现了一个有趣的漏洞，它属于一个私人bug bounty程序的范围。这个漏洞与SQLi、XSS或IDOR等标准web应用程序问题无关，因此尽管影响相对较小，我还是决定写几段关于它的内容。</p><p id="e9fb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不幸的是，由于NDA，我不会在这篇文章中发布任何截图，但希望描述和伪代码可以让你理解这个问题。</p><h1 id="1cfa" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">应用程序描述</h1><p id="b41e" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">作为测试对象的应用程序具有允许用户创建和发布对象的功能。发布对象之前，需要由创建者在对象创建过程中选择的用户批准。为了防止欺诈活动，现有的安全机制不允许创建者选择自己作为批准者。尝试这样做导致了一个错误。</p><p id="6a0e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从HTTP请求的角度来看，web浏览器向web服务器发送了一个带有多个参数的POST请求。其中两个参数包含创建者和批准者的用户标识——3位数的自然数。</p><p id="112e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">伪PHP代码来呈现机制:</p><figure class="ma mb mc md gt is gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/d529a9922119ae99f2885667c36663b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*iRaJKPqwUBTgSEJJOTEO8A.png"/></div></figure><h1 id="d68a" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">安全问题</h1><p id="67d4" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">了解PHP在值比较方面的问题后，我决定尝试一下，看看如果我将一个浮点数作为<em class="me"> approverid </em>传递会发生什么。</p><p id="586a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我修改了HTTP请求并通过了200.9，作为<em class="me"> approverid </em>的值。令我惊讶的是，应用程序并没有返回一个错误，而是做了一些奇怪的舍入，并设置了一个UserID为201的用户作为批准者。</p><p id="1c03" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了这样的行为，下一步的行动对我来说就很清楚了。我向web服务器发送了一个POST请求，其中201为<em class="me"> creatorid </em>，200.9为<em class="me"> approverid </em>。</p><p id="091f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">应用程序比较了两个值，确定它们不相同，向上舍入<em class="me">批准id </em>值，并成功保存两个值(201和201)。</strong></p><p id="6a98" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">未返回任何错误。创建者能够将自己设置为批准者，并批准自己的对象。这导致应用程序完全绕过了业务逻辑。</p><h1 id="566b" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">摘要</h1><p id="8086" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Bug在提交4小时后被分类并接受。由于业务影响有限，奖金数额相对较小。</p><p id="9759" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，重要的是要记住，如果在关键应用领域(如身份验证、授权)中实施不当，与值比较相关的安全问题可能会带来悲剧性的后果。在无法访问源代码的情况下识别这些问题可能会非常困难，通常需要一些运气或灵光一现。</p><p id="b99b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">狩猎愉快！</p></div></div>    
</body>
</html>