<html>
<head>
<title>Leveraging Template injection to takeover an account.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用模板注入接管一个帐户。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/leveraging-template-injection-to-takeover-an-account-1dba7c4ae315?source=collection_archive---------0-----------------------#2021-03-04">https://infosecwriteups.com/leveraging-template-injection-to-takeover-an-account-1dba7c4ae315?source=collection_archive---------0-----------------------#2021-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/9de5564d1e3039865c87edb42112a783.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*kMv-emVPyH6K6HBtENkofA.png"/></div></figure><p id="c032" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">嗨，我带着一篇有趣的文章回来了，这是关于我去年向一个私人程序报告的一个模板注入错误。</p><p id="676e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我在浏览这个应用程序，试图理解它是做什么的。在浏览应用程序时，我登陆了账户设置页面，寻找测试设置页面时应该查看的常见内容。</p><p id="a444" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在测试了一段时间后，没有发现任何有意义的东西，我想也许我在这里什么也没有得到，应该继续下一个功能。</p><p id="3b00" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第二天，我在探索该应用程序的其他功能时，发现了这个有趣的功能，它允许用户为访问该页面的观众编写定制的消息，有点像带有定制问候的博客帖子。有趣的是，它允许用户访问用户对象的某些属性来创建定制的消息，它甚至允许用户为某些属性设置默认值。</p><p id="1695" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，如果用户想写一篇文章，以给每个浏览者定制的问候开始。他可以做这样的事。</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="12fb" class="lb lc iq kx b gy ld le l lf lg">Hi user.name,</span><span id="c241" class="lb lc iq kx b gy lh le l lf lg">XXXX</span><span id="6e7e" class="lb lc iq kx b gy lh le l lf lg">XXXX</span></pre><p id="47ab" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果一个名为Akash的用户访问这个页面，他会看到</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="f2a4" class="lb lc iq kx b gy ld le l lf lg">Hi Akash,</span><span id="00e6" class="lb lc iq kx b gy lh le l lf lg">XXXX</span><span id="bcc0" class="lb lc iq kx b gy lh le l lf lg">XXXX</span></pre><p id="3b7e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有许多属性可以用来向在应用程序上拥有不同权限的用户显示不同的消息。</p><p id="2575" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我写了一篇博文，开头是这样的问候</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="5d1e" class="lb lc iq kx b gy ld le l lf lg">Hi user.name,</span><span id="7137" class="lb lc iq kx b gy lh le l lf lg">XXXX</span><span id="9631" class="lb lc iq kx b gy lh le l lf lg">XXXX</span></pre><p id="3a3b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从我的帐户访问这个页面，令我惊讶的是，它显示<code class="fe li lj lk kx b">Hi 9,</code>我没有预料到这一点，但后来我回忆起在设置页面测试错误时，我输入我的名字为<code class="fe li lj lk kx b">{{3*3}}</code>，那次什么也没有发生。我没有更改名称，而是继续测试另一个功能。</p><p id="1f8e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它对表达式<code class="fe li lj lk kx b">{{3*3}}</code>求值并显示结果<code class="fe li lj lk kx b">9</code>。这意味着应用程序容易受到客户端模板注入(CSTI)攻击。该应用程序使用AngularJS和用户提交的输入(表达式),该输入位于帐户设置页面下的名称字段中，并在该博客页面上进行评估。</p><p id="cf20" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我在想一种利用这种行为的方法，并继续寻找IDOR，它可能允许攻击者更改用户名并将其替换为有效负载，该有效负载将用户的会话cookies发送到由攻击者控制的服务器，或者通过编程更改他的帐户电子邮件来接管他的帐户。</p><p id="584e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">不幸的是，我找不到IDOR，并得出结论，这种行为本身是不可利用的，因为这只是一个无害的自我注入漏洞。</p><p id="a074" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是等等，还记得我提到过应用程序允许用户为一些属性设置默认值吗？攻击者可以将变量的默认值设置为CSTI有效负载来利用此行为。</p><p id="f9bc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我将这个CSTI有效载荷设为<code class="fe li lj lk kx b">redacted_property</code>的默认值</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="5bb5" class="lb lc iq kx b gy ld le l lf lg">{{a=toString().constructor.prototype;a.charAt=a.trim;$eval(‘a,alert(1),a’)}}</span></pre><p id="841a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并在博客上使用了这个<code class="fe li lj lk kx b">redacted_property</code>，</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="4d5f" class="lb lc iq kx b gy ld le l lf lg">Hi user.name,</span><span id="e5b4" class="lb lc iq kx b gy lh le l lf lg">user.redacted_property</span><span id="b042" class="lb lc iq kx b gy lh le l lf lg">XXXX</span><span id="9c16" class="lb lc iq kx b gy lh le l lf lg">XXXX</span></pre><p id="581b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">访问该页面时，我会看到一个警告弹出窗口，就像经典的XSS概念验证一样。</p><figure class="ks kt ku kv gt jr gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/4e69fac9bb392dcdcf917057f290f7f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*O8FnVWgOvGjtfIr9i-tYyQ.png"/></div></figure><p id="43c8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">攻击者可以利用这一点来窃取用户的会话cookie，或者简单地更改他的电子邮件地址并接管他的帐户，而不是弹出警报。</p><p id="b0ba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我希望你们喜欢读这篇文章，跟着我看更多这样有趣的文章。</p><p id="21e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有任何问题，你可以在推特上给我发消息<a class="ae lm" href="https://twitter.com/0xAkash" rel="noopener ugc nofollow" target="_blank"> @0xAkash </a></p></div></div>    
</body>
</html>