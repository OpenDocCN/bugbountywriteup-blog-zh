<html>
<head>
<title>IDOR on API endpoints.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">API端点上的IDOR。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/idor-on-api-endpoints-e08c740e87a2?source=collection_archive---------0-----------------------#2020-04-03">https://infosecwriteups.com/idor-on-api-endpoints-e08c740e87a2?source=collection_archive---------0-----------------------#2020-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="061d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嘿，伙计们，我在这里分享我最近在一个网站上的发现，这个网站让我写下了我的第一篇文章。因为保密协议，我不能透露公司的名字(NDA)。所以我将用target.com的<strong class="jp ir"> <em class="kl">和T4的</em>作为参考。</strong></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="72f2" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated"><span class="l lr ls lt bm lu lv lw lx ly di">T</span>L；速度三角形定位法(dead reckoning)</h1><p id="b5cd" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我发现在请求一个API的端点时，缺少访问控制策略(中断的访问控制)，这导致我在未经用户允许的情况下编辑/删除任何用户的工作经历和教育细节。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="5c44" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">先决条件</h1><p id="17ee" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">IDOR是什么？<br/> <em class="kl">不安全的直接对象引用(IDOR)是一种访问控制漏洞，当应用程序使用用户提供的输入直接访问对象时会出现这种漏洞。</em></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="958b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，我测试了过去三天的target.com。我发现了一些错误，包括跨站点脚本，速率限制等。我对我所拥有的不满意。所以我开始挖掘更多。经过一个小时的搜索，我的目光停留在一个API请求 的<strong class="jp ir"> <em class="kl">响应上，它是:</em></strong></p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/77daa9c3c9c2e3a64764bdf5749cd1c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a9tqQ6JTTkiciELi_hex3A.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">作品创作<strong class="bd kv">响应</strong></figcaption></figure><p id="e414" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以清楚地看到，这个响应包含一个“id”参数(“id”:2150)。这引起了我的注意。<br/>这个<strong class="jp ir">回复</strong>是因为我在target.com<strong class="jp ir">的个人资料里添加了一段工作经历而产生的。最初的请求是:</strong></p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mu"><img src="../Images/e82de75fbf1c82d02896d6f71b3fe540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z3iI3Jzp1nUE9t3CVn-F0A.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">作品创作<strong class="bd kv">请求</strong></figcaption></figure><p id="6b7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我开始模糊到那个位置。我尝试了一些事情，比如通过在JSON中的请求体中添加一些参数来创建另一个用户的工作体验，但是什么也没有发生。我正准备离开这个端点，但突然我想到了检查工作体验的删除功能。<br/>我删除了个人资料中的工作经历，并捕捉到了请求:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mv"><img src="../Images/a6ff39f88146d6cab8f436f644061bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOKxeWxgIZ0G2DL1CWqaAg.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">删除工作经验的<strong class="bd kv">要求</strong>。</figcaption></figure><p id="bd92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我想你也已经在那个URL中抓住了那个有趣的参数。方法是<strong class="jp ir">删除</strong>，URL是<br/><strong class="jp ir"><em class="kl">https://www.target.com/api/user-firm/2150.</em></strong><em class="kl"><br/></em>请求中的那个数字(<em class="kl">2150</em>’)再次引起了我的注意。现在请看<strong class="jp ir"> <em class="kl">响应</em> </strong>的上述请求:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mv"><img src="../Images/87824711251fe020662f4daf6efc1047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNUK1j7MNQVBZHmeXWIhdA.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">删除工作经历的<strong class="bd kv">回复</strong>。</figcaption></figure><p id="3471" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">响应包含状态码' 204' <em class="kl">没有内容。其中</em>表示工作经历删除成功，该位置没有内容。<br/>现在我按照上面的步骤再次创建了另一个账户。我在这个简介里加了一段工作经历。要求是:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mw"><img src="../Images/ee0e6bb128e0a13678838e4eaa5f7fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lezRQAP_Scf_YTvy3t9Uxg.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">创建工作的请求[第二帐户]</figcaption></figure><p id="4fb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个回答又唤起了我以前的一些想法。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mx"><img src="../Images/c859f29382cb6f389700a932a8f1ac21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dgFdRdlTbLKH2SHSXUm37A.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">创建工作的响应[第二帐户]</figcaption></figure><p id="d979" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的“id”= 2151是我用我的第一个帐户创建的先前工作经验的后续编号。现在我知道这是一致的。现在，从第一个账户开始，我又创造了另一个工作经历。<br/>现在的想法是检查IDOR漏洞。<br/>于是，我利用第一个账号的请求，尝试删除第二个账号的工作经历。<br/>确保您记住第一次工作经历的创建id(2150)。<br/>我的第一个账户的删除请求是:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mv"><img src="../Images/a6ff39f88146d6cab8f436f644061bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOKxeWxgIZ0G2DL1CWqaAg.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">我的第一个帐户的删除请求。</figcaption></figure><p id="3f12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的请求中，我将id的值从2150更改为2151。<strong class="jp ir"> <em class="kl"> <br/> </em> </strong>回应是:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mv"><img src="../Images/87824711251fe020662f4daf6efc1047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNUK1j7MNQVBZHmeXWIhdA.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">回应。</figcaption></figure><p id="fcc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">瞧！！</em>T13】</strong></p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3338" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，我刚刚用我的第一个账户删除了我的第二个账户的工作经历。我再次尝试在网站上添加教育信息。幸运的是，我又成功了。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="f23c" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">影响</h1><p id="900f" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我可以在没有任何许可的情况下编辑/删除target.com网站上注册的整个用户的工作经历和教育细节。</p><h1 id="66df" class="kt ku iq bd kv kw na ky kz la nb lc ld le nc lg lh li nd lk ll lm ne lo lp lq bi translated">小贴士:</h1><blockquote class="nf ng nh"><p id="60f1" class="jn jo kl jp b jq jr js jt ju jv jw jx ni jz ka kb nj kd ke kf nk kh ki kj kk ij bi translated">&gt;必须看到带参数的API端点的响应。<br/> &gt;如果某个数字在API中传递，那么您必须尝试模糊端点并查找IDOR。</p></blockquote></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="718f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个网站是我实习时测试过的。<br/>所以，是的我没有得到任何特殊的赏金。</p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="nl mz l"/></div></figure><p id="abcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您阅读至此。希望你已经学到了一些东西。</p><p id="c589" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想联系我，你可以在这里找到我。<br/> <strong class="jp ir">推特:</strong><a class="ae nm" href="https://twitter.com/abhiunix" rel="noopener ugc nofollow" target="_blank"><em class="kl">https://twitter.com/abhiunix</em></a><br/><strong class="jp ir">领英:</strong><a class="ae nm" href="https://linkedin.com/in/abhiunix" rel="noopener ugc nofollow" target="_blank"><em class="kl">https://linkedin.com/in/abhiunix</em></a></p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="nn mz l"/></div></figure></div></div>    
</body>
</html>