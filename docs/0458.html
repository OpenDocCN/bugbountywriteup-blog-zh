<html>
<head>
<title>How Inspect Element lead to Stored XSS on Bukalapak’s website</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何检查元素导致在Bukalapak的网站上存储XSS</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/from-broken-link-to-sub-folder-takeover-on-bukalapak-3aa985e622c4?source=collection_archive---------0-----------------------#2019-12-23">https://infosecwriteups.com/from-broken-link-to-sub-folder-takeover-on-bukalapak-3aa985e622c4?source=collection_archive---------0-----------------------#2019-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="abc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">Tl；dr:我在Bukalapak网站上发现了一个独特的高严重性错误配置，通过只检查他们页面上的HTML元素，导致存储XSS。</em></p><p id="2a1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Assalamualaikum Wr。Wb。(亲爱的读者，愿你平安)</p><p id="0686" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Bukalapak是印度尼西亚最大的在线市场和“独角兽”创业公司之一。有一天，当我休息的时候，我在他们的网站上买东西，我注意到他们举办了一个Bug赏金计划，我想如果我能把我的名字刻在他们可爱的“<a class="ae km" href="https://bukalapak.github.io/bukabounty/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">名人墙</strong> </a>”上会很酷。</p><p id="e650" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我特别感兴趣的是在他们的一个新功能上寻找漏洞，这个新功能托管在一个特定的子域上，<em class="kl"> REDACTED </em> .bukalapak.com。仅仅因为这是一个新功能，所以我认为他们更有可能错过了一些可能导致漏洞的东西。</p><p id="bec3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">长话短说，过了一段时间，除了一些轻微的或者严重性很低的错误，比如没有敏感动作的点击劫持，限速问题等等，我找不到任何有趣的东西。</p><p id="dc20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，当我检查其中一个页面上的元素以检查我的XSS有效负载是否启动时(遗憾的是，没有)，我在浏览器控制台上发现了一些吸引我眼球的东西。该页面试图获取另一个子域上的图像，但失败并返回浏览器控制台上打印的404响应。URL看起来像这样:</p><p id="20c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://REDACTED.bukalapak.com/img/some-random-text.jpg" rel="noopener ugc nofollow" target="_blank"> <em class="kl"> https:// </em> </a> <em class="kl">编校</em><a class="ae km" href="https://REDACTED.bukalapak.com/img/some-random-text.jpg" rel="noopener ugc nofollow" target="_blank"><em class="kl">. bukalapak . com/img/some-random-text . jpg</em></a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi kn"><img src="../Images/e6323f0ef80fb69b93c027e5f89916cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*tyvx74849u-AcWaDoBczBA.png"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">断开的链接</figcaption></figure><p id="6189" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我很好奇，打开了一个新标签页上的链接，令人惊讶的是，我从亚马逊S3得到了那个漂亮的“NoSuchBucket”错误页面以及Bucket名称。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi kz"><img src="../Images/e99982172ff556ac7aeac335aec8f457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*he_8jAG8dZzwcIBjJbWAjQ.jpeg"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">漂亮…</figcaption></figure><p id="3da2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一点上，我知道接管是最有可能的，但我很好奇，因为以前，我使用的所有与子域接管扫描器相关的工具都无法检测到这一点。所以我去掉了URL，找到了指向无人认领的亚马逊S3桶的主地址。我发现网址是这样的:</p><p id="6bc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://REDACTED.bukalapak.com/img/" rel="noopener ugc nofollow" target="_blank"><em class="kl">https://</em></a><em class="kl">编校</em><a class="ae km" href="https://REDACTED.bukalapak.com/img/" rel="noopener ugc nofollow" target="_blank"><em class="kl">. bukalapak . com/img/</em></a></p><p id="469f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原来,<em class="kl">编辑的</em> .bukalapak.com已经运行良好，它拥有bukalapak网站的另一个功能，并且运行得很漂亮。这就是为什么我决定把它写成“<em class="kl">子文件夹接管</em>”而不是“<em class="kl">子域接管</em>”，因为我接管了一个<em class="kl">子文件夹</em>而不是一个<em class="kl">子域</em>，尽管它有相同的方法。</p><p id="fcf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">喝了一口咖啡后，我开始了接管过程，我做了一个亚马逊S3桶，名字印在错误页面上。在选择地区时，<a class="ae km" href="https://0xpatrik.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Patrik Hudak </strong> </a>在他的博客上实际上已经写了如何猜测地区(<em class="kl">他写了很多关于子域收购的</em> <a class="ae km" href="https://0xpatrik.com/" rel="noopener ugc nofollow" target="_blank"> <em class="kl">惊人文章</em> </a> <em class="kl">，如果你有时间的话应该读一读</em>)，但是考虑到bukalapak是一个来自印度尼西亚的产品，我决定只选择最近的可能地区(亚太地区)，事实证明我是对的。接管完成，子文件夹现在指向我控制的亚马逊S3桶。</p><p id="28dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，通过接管这个子文件夹，我能实现什么呢？</p><p id="0aae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先想到的是存储XSS，我发现他们的cookie被设置为通配符子域，所以基本上他们在任何地方都使用相同的cookie，XSS窃取会话cookie是可能的。第二个，因为这个子文件夹位于他们的一个子域中，所以在任何X-Frame选项设置为相同原点子域的页面上，clickjacking都是可能的，大多数时候都包含敏感动作。我也可以托管钓鱼内容，如果结合XSS和点击劫持，这可能是一个非常强大的攻击载体。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi le"><img src="../Images/5ecf8a0d57da07e6c3f8427fd80fdfd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*85hkA5PECb6eD3bgFfHAEA.png"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">每个人都喜欢的弹出窗口。</figcaption></figure><p id="e84b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但我没有进一步剥削，因为我担心这违反了他们的规定，所以我决定马上报告，让他们决定严重性。令人惊讶的是，他们的网络事件响应者在不到半小时内回复了我的报告！非常冷静的反应时间，他们的安全团队的荣誉。他们让我上传一个特定的文件来确认我的发现，所以我马上就上传了。</p><p id="aa81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Wassalamualaikum Wr。Wb。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="c4cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">时间线:</strong></p><ul class=""><li id="e20c" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">2019年8月13日:报告已发送。</li><li id="fe12" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><strong class="jp ir">2019年8月13日(不到半小时后)</strong>:网络事件响应者回复我的邮件，要求我上传一个特定的文件来确认我的发现。</li><li id="41c3" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><strong class="jp ir">2019年8月14日</strong>:报告已验证，归类为严重级别较高的错误配置。他们要求我把我的数据贴在他们的名人墙上，并支付赏金。</li><li id="4e61" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><strong class="jp ir">2019年8月26日</strong>:他们把我的名字刻在了他们的名人墙上。</li><li id="e75b" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><strong class="jp ir">2019年9月24日</strong>:用感谢信支付$$$。</li><li id="13c0" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><strong class="jp ir">2019年12月23日</strong>:披露安全团队批准的请求，已发布书面报告。</li></ul></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="be92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">关注</em> <a class="ae km" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="kl"> Infosec报道</em> </a> <em class="kl">获取更多此类精彩报道。</em></p><div class="ma mb gp gr mc md"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd ir gy z fp mi fr fs mj fu fw ip bi translated">信息安全报道</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">medium.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr kt md"/></div></div></a></div></div></div>    
</body>
</html>