<html>
<head>
<title>Wayback Machine — A way forward in finding bugs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回溯机——寻找bug的一种方法</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/wayback-machine-a-way-forward-in-finding-bugs-bf03e294475?source=collection_archive---------2-----------------------#2020-07-29">https://infosecwriteups.com/wayback-machine-a-way-forward-in-finding-bugs-bf03e294475?source=collection_archive---------2-----------------------#2020-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/768eb3320ef176440016660043c4a3fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xh5lVPQfPo6t5xqxgSoqWg.png"/></div></div></figure><p id="72de" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你一定听说过在github repos中发现漏洞的人的漏洞奖励。而且，这些都是很好的读物，当然在现实世界中要难得多。至少对我们中的一些人来说。但是，总是有更多的方法可以到达一些有趣的端点，包括泄漏的数据，如api令牌，这些令牌可能仍然有效。</p><p id="70b1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">关于使用Wayback机器寻找旧的有趣文件的想法并不是一个新的想法。有一个工具做得相当好:<a class="ae kz" href="https://github.com/tomnomnom/waybackurls" rel="noopener ugc nofollow" target="_blank">https://github.com/tomnomnom/waybackurls</a></p><p id="39a6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，虽然上面的工具，可能还有许多其他类似的工具为您提供了wayback machine拥有的链接列表，但我需要一种方法来快速验证这些链接是否真的在工作。并且，有了一个5个，甚至10个链接的列表，手动操作很容易。但是，列表越大，事情就越复杂。还有一个问题是，如果链接正常工作，但是(即使它们有不同的页面名称)它们都重定向到主页面或一些自定义404，那么该怎么办？</p><p id="6c60" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输入:waywayback和它的同伴waywayback-ffuf，我按照当时听起来有趣的东西命名，按照我的需要写剧本，它肯定很丑，但它是我的:)</p><p id="22ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，它并不复杂，所以请随意编辑(或者我应该说改进它)以满足您的特定需求，我想将它们合并到一个脚本中是选项之一:)</p><p id="70aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你需要安装ffuf来充分利用这些脚本:【https://github.com/ffuf/ffuf<a class="ae kz" href="https://github.com/ffuf/ffuf" rel="noopener ugc nofollow" target="_blank"/></p><p id="612a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">而且，为了能够在任何目录中运行它，为了更好地组织，创建一个到waywayback和waywayback-ffuf的符号链接，否则我想您必须在脚本中指定各种路径。</p><p id="9c1e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">剧本回顾:</strong></p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="14ae" class="lj lk it lf b gy ll lm l ln lo">#!/bin/bash</span><span id="e047" class="lj lk it lf b gy lp lm l ln lo">DATED=`date +’%m-%d-%Y’`;<br/>prefix=$(cut -f1 -d’:’ &lt;&lt;&lt; “$1”)<br/>save=$(cut -f3 -d’/’ &lt;&lt;&lt; “$1”)<br/>mkdir $prefix-$save<br/>cd $prefix-$save<br/>curl “<a class="ae kz" href="http://web.archive.org/cdx/search/cdx?url=$save*&amp;fl=original&amp;collapse=digest" rel="noopener ugc nofollow" target="_blank">http://web.archive.org/cdx/search/cdx?url=$save*&amp;fl=original&amp;collapse=digest</a>" | sort -u &gt; $prefix-$save[$DATED].txt<br/>sed -i “s/^http.*\/$//” $prefix-$save[$DATED].txt<br/>grep -vE “robots.txt$|robots.txt\/$|.gif$|.jpg$|.jpeg$|.css$|.tiff$|.ico$|.png$|.svg$|.ttf$|.woff$|.woff2$|.eot$” $prefix-$save[$DATED].txt &gt; interesting-$prefix-$save.txt<br/>sort -u interesting-$prefix-$save.txt &gt; interesting-sort-$prefix-$save.txt<br/>wc -l interesting-sort-$prefix-$save.txt<br/>read -p “Press enter to continue unless if there are too many lines”<br/>waywayback-ffuf interesting-sort-$prefix-$save.txt<br/>rm interesting-$prefix-$save.txt</span></pre><p id="f8da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">脚本waywayback-ffuf: </strong></p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="bf78" class="lj lk it lf b gy ll lm l ln lo">#!/bin/bash<br/>cut -d’/’ -f4- $1 &gt; $1-wordlist.txt<br/>prefix=$(cut -f4 -d’-’ &lt;&lt;&lt; “$1”)<br/>save0=$(sed s/interesting-sort-//g &lt;&lt;&lt; “$1”)<br/>save1=$(sed s/http//g &lt;&lt;&lt; “$save0”)<br/>save2=$(sed s/^s-//1 &lt;&lt;&lt; “$save1”)<br/>save=$(sed s/.txt//g &lt;&lt;&lt; “$save2”)<br/>ffuf -mc 200,204,301,302,307,401,403,405 -c -w $1-wordlist.txt -H “X-Forwarded-For: 127.0.0.1” -u “<a class="ae kz" href="https://$save/FUZZ" rel="noopener ugc nofollow" target="_blank">https://$save/FUZZ</a>" -v -o [ffwayback-$prefix-$save].csv -of csv</span></pre><p id="f31f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用法:waywayback https://x.target.com</p><p id="bcd7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它将显示新创建的单词列表中有多少行/单词，至少对我来说，这个想法是我不想处理任何超过一定数量的东西，但这取决于所讨论的目标和我是否有心情等。</p><p id="3035" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，一旦完成(假设你决定通过单词表进行ffufing):</p><p id="c729" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">- cd目标</p><p id="e7d4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">- cut -d '，'-f2，5，6 *csv | grep -E "，200，|，405，|，302，" |更多</p><p id="6be6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你明白了。</p><p id="4706" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">这些脚本背后的基本思想:</strong></p><p id="c0e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">-使用curl与wayback machine api交互并检索数据，同时使用sed和grep创建一个感兴趣的端点列表，并将其放入ffuf的单词列表中</p><p id="8678" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">-使用wc -l来统计找到的链接数量，并提示您是否希望使用新创建的单词列表在目标网站上执行ffuf(虽然ffuf对100K链接没有问题，甚至达到500K也可以接受，但有时太多意味着目标网站有问题，即。假阳性或类似)。</p><p id="76c3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">-使用ffuf和新创建的单词列表来查看什么是误报，什么是有趣/无聊的，添加-H "X-Forwarded-For: 127.0.0.1 "是因为有时它可以绕过waf。</p><p id="d35f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">快速浏览csv结果的一些技巧:</strong></p><p id="6c17" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">cut -d '，'-f2，5，6 *csv | grep "，200，" |更多</p><p id="453e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以上是一个好的开始。它只显示与url、状态代码和页面大小相关的列。如果你看到不同的URL大小相同，那么只需添加| grep -v "，1234 "，其中1234是有问题的大小，如果你发现其他不同的大小被重复了太多次，那么添加:grep -vE "，1234|，4321 "等。</p><p id="c6cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">除了明显好奇的端点之外，还有一些有趣的事情要寻找，比如api令牌/密钥。诚然，在某些情况下，在大多数情况下，它们往往会过期和/或属于随机的低级别用户，但在某些情况下，它们可能仍在运行。并且，它们可能属于管理员、职员和其他公司人员。你可以看到这里的潜力。</p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="d100" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用上面的脚本，我发现了有效的api令牌，并且我还发现了默认单词表没有的端点，因为有问题的公司有他们的非标准命名。有一次，我访问了一些奇怪命名的端点，得到了一个用户名和加密密码的列表，除此之外，它是公开可访问的，所以我为此得到了一笔可观的奖金。</p><p id="3e5d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="lx">当你陷入困境时，有时回顾可以帮助你前进。也就是说，你也应该注意不要在侦察中迷路，如果你不小心的话，这很容易发生。</em></p></div></div>    
</body>
</html>