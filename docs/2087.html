<html>
<head>
<title>How I Found a company’s internal S3 Bucket with 41k Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何找到一家公司的内部S3桶与41k文件</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-found-a-companys-internal-s3-bucket-with-41k-files-94b453e588b5?source=collection_archive---------0-----------------------#2022-05-24">https://infosecwriteups.com/how-i-found-a-companys-internal-s3-bucket-with-41k-files-94b453e588b5?source=collection_archive---------0-----------------------#2022-05-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6978" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现一家公司的S3桶在内部使用，在GitHub或其域中没有被引用。这是我7个月前报告的第一个有效的漏洞，只有通过人工侦察才有可能。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="82f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">关于我— </strong></p><p id="d0e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是Tarun，来自印度的安全研究员和bug猎人。你可能已经从我以前的一篇关于<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/create-your-ultimate-bug-bounty-automation-without-nerdy-bash-skills-part-1-a78c2b109731"> <strong class="jp ir"> <em class="kt">编写自动化脚本而不痛击</em> </strong> </a> <strong class="jp ir"> <em class="kt">脚本</em> </strong>的文章中了解了我。我寻找bug或者开发一些邪恶的软件。跟我来</p><blockquote class="ku kv kw"><p id="4d55" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">https://github.com/tarunKoyalwar</p><p id="8489" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">https://twitter.com/KoyalwarTarun</p><p id="79fe" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">中型=<a class="ae ks" href="https://medium.com/@zealousme" rel="noopener">https://medium.com/@zealousme</a></p><p id="87f6" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">获得新工具和文章的更新</p></blockquote><p id="79c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">侦察— </strong></p><p id="52e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有许多方法可以找到特定程序的S3桶，最常见的方法是从<strong class="jp ir"> <em class="kt">打嗝代理</em> </strong>、<strong class="jp ir"> <em class="kt"> hakrawler </em> </strong>、<strong class="jp ir"> go <em class="kt"> spider、</em> </strong>或<strong class="jp ir"> <em class="kt"> GitHub </em> </strong>。还有其他一些方法可以找到s3存储桶，也许我会写一篇关于这个的新文章。</p><p id="fcdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一个新手，我遵循着<a class="ae ks" href="https://drive.google.com/file/d/1aG_qqRvNW-s5_8vvPk5rJiMSMeNL2uY9/view" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kt">JHaddix</em></strong><em class="kt">v4方法论</em> </a>，范围有限，做ASN或垂直枚举毫无意义，但我还是访问了<a class="ae ks" href="https://www.crunchbase.com" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kt">Crunchbase</em></strong></a>并搜索了该程序的公司名称。在细节部分，我发现<strong class="jp ir">也被称为</strong>标题，带有<strong class="jp ir"><em class="kt">FooBar Inc .</em></strong>(已编辑)。当我发现这个标题时，我检查了是否有一个GitHub org的名字类似于这个。我找到了，但是没有公开回复。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi la"><img src="../Images/e8aea7819f08a6460f510d61a67d9680.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*ZZRJxCER2aOAQld2gxh0VA.jpeg"/></div></figure><p id="2415" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">灰色战争</strong></p><p id="746e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GrayHatWarfare是一个很好的地方来搜索和过滤S3桶，但唯一糟糕的是他们的<a class="ae ks" href="https://buckets.grayhatwarfare.com/packages" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kt"/></strong><em class="kt"/></a>定价，特别是对新手来说，因为很少有人找到一个开放的S3桶。在我找到另一个名字后，我搜索了它和其他一些名字的变体，如foodev等。通过访问以下网址。</p><p id="4ece" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ks" href="https://buckets.grayhatwarfare.com/buckets" rel="noopener ugc nofollow" target="_blank">https://buckets.grayhatwarfare.com/buckets</a></p><blockquote class="ku kv kw"><p id="11b7" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">只有当您注册并且只能访问有限的存储桶时，此功能才可用。新桶定期更新，但该功能只对高级用户开放。</p></blockquote><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ld"><img src="../Images/f6ae47eafdc4a2a73c1241d5d8cf1fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h3J9uvRuLzc2qRA9quNIdA.png"/></div></div></figure><p id="f508" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我搜索了一下，发现了一个名为<strong class="jp ir"> foositedev </strong>的桶，里面有41K的文件。我决定使用aws-cli。您可以参考<a class="ae ks" href="https://manishmshiva.medium.com/aws-cli-installation-and-configuration-d33a23980adf" rel="noopener">这里的</a>进行设置和配置。</p><p id="0135" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> S3桶枚举— </strong></p><p id="3772" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用aws-cli检查S3存储桶的权限。S3存储桶有5个主要权限，您可以使用下面的命令测试每个权限。</p><blockquote class="ku kv kw"><p id="2cd0" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">LIST =列出S3存储桶的所有文件</p></blockquote><pre class="kl km kn ko gt li lj lk ll aw lm bi"><span id="0f0e" class="ln lo iq lj b gy lp lq l lr ls">aws s3 ls s3://bucketName</span></pre><blockquote class="ku kv kw"><p id="c0a4" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">读取=读取特定对象(文件)</p></blockquote><pre class="kl km kn ko gt li lj lk ll aw lm bi"><span id="4d95" class="ln lo iq lj b gy lp lq l lr ls">aws s3 cp s3://bucketName/PathtoFile  LocalFile</span></pre><blockquote class="ku kv kw"><p id="ebb6" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">写=写/覆盖/删除特定对象(文件)</p></blockquote><pre class="kl km kn ko gt li lj lk ll aw lm bi"><span id="eb34" class="ln lo iq lj b gy lp lq l lr ls">aws s3 cp poc.txt s3://bucketName/poc.txt</span></pre><blockquote class="ku kv kw"><p id="035a" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">读取访问控制权限</p></blockquote><pre class="kl km kn ko gt li lj lk ll aw lm bi"><span id="96e1" class="ln lo iq lj b gy lp lq l lr ls">aws s3api get-bucket-acl --bucket bucketName</span></pre><blockquote class="ku kv kw"><p id="7068" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">WRITE_ACP =写/修改访问控制权限</p></blockquote><pre class="kl km kn ko gt li lj lk ll aw lm bi"><span id="de1e" class="ln lo iq lj b gy lp lq l lr ls">aws s3api put-bucket-acl --acl public-read-write --bucket bucketName</span></pre><p id="d1bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kt">续— </em> </strong></p><p id="c4ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上述命令后，我能够发现bucket启用了<code class="fe lt lu lv lj b">READ_ACP,LIST,READ</code>权限。它有41k个文件，所以下载所有文件是不可行的。我遇到了下面的命令，它列出了桶中的所有对象</p><pre class="kl km kn ko gt li lj lk ll aw lm bi"><span id="e4f7" class="ln lo iq lj b gy lp lq l lr ls">aws s3 ls --summarize --human-readable --recursive s3://bucketName</span></pre><p id="263e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它列出了所有文件及其路径、文件总数以及桶的总大小(23.6 GB)。我决定在通过使用<code class="fe lt lu lv lj b">grep</code>进行节点模块、HTML、gif、jpeg等过滤来查看一些之后再看一看。所有这些都没用。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="lw kr l"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">资料来源:Giphy</figcaption></figure><p id="dc6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将输出保存到文件中，并创建了一个bash脚本来输出不同的文件类型及其频率。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mb kr l"/></div></figure><p id="02e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上述脚本后，在输出中有不同类型的文件，其中我找到了一些名为“users”的CSV文件，我用<code class="fe lt lu lv lj b">wget -i urls.txt -P directory</code>下载了它们。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mc"><img src="../Images/105aca11e3cafe1cf973df4fdc6e2de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JXu_8loYWpy5Ft2YeOC6nw.png"/></div></div></figure><p id="79c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些CSV文件是他们数据库的备份，包含用户名、电子邮件、电话号码、地址和许多其他PII(总共32列)，其中许多电子邮件是员工电子邮件，并带有@companyname电子邮件。我写了一份报告，详细描述了一下，提交了上去。它很快被接受，我得到了250美元的奖励，并且提交的内容被标记为高严重性。</p><p id="fb9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管它是一家价值100万美元的公司，但它的奖金非常低，500美元=关键，250美元=高，100美元=中等，0美元=低，而且不接受任何P4或P5。在这份报告之后，我只在同一个程序上搜寻了4个月，发现了大约18个漏洞，有重复的、中等的、高的和6个严重的，但没有低严重性的漏洞。</p><blockquote class="ku kv kw"><p id="e585" class="jn jo kt jp b jq jr js jt ju jv jw jx kx jz ka kb ky kd ke kf kz kh ki kj kk ij bi translated">在medium &amp; twitter上关注我，这样你就不会错过我即将发表的文章</p></blockquote></div></div>    
</body>
</html>