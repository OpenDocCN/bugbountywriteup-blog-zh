<html>
<head>
<title>Adding Root Certificate to Android With Magisk Module</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Magisk模块向Android添加根证书</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/adding-root-certificate-to-android-with-magisk-module-92493a7e9e4f?source=collection_archive---------5-----------------------#2022-09-20">https://infosecwriteups.com/adding-root-certificate-to-android-with-magisk-module-92493a7e9e4f?source=collection_archive---------5-----------------------#2022-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/72df8cc5117acc5b3e3d47c2fe0a40a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTjFJ6c3v9H0GSInwKYSOw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Android Pentesting</figcaption></figure><p id="5cd9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了在android应用程序中执行动态渗透测试，我们需要绕过sslpinning安全措施。为了规避这一措施，有必要在android系统的根证书中添加Burp Suite证书。</p><p id="cc2d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">用Magisk在有根的android设备上安装根证书非常容易。这个过程包括几个步骤。</p><h2 id="4797" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">导出burp套件证书</h2><p id="92ef" class="pw-post-body-paragraph kc kd iq ke b kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv lx kx ky kz ij bi translated">我们需要转到Burp suite工具中的“选项”选项卡，然后单击“导入/导出CA证书”按钮。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/ca35cc138b4c2cb9ec5d6ed7011cdaf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*abC1bIEuEeXLMX-ve0RTTg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">出口证明书</figcaption></figure><p id="ff0c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在”中导出证书后。der "格式，我们需要再执行几个步骤。</p><p id="792a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">创建X.509证书表单”。der "文件:</p><p id="c928" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="md">OpenSSL x509-通知DER-in cacert . DER-out cacert . PEM</em></p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/7b3608c0ac1598d574efff46735abc19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*3XHUXAyoOu4-7vfgX3U28w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用openssl创建X.509</figcaption></figure><p id="d986" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">创建pem文件后，需要计算x509(pem)文件的哈希值:</p><p id="e766" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="md">OpenSSL x509-inform PEM-subject _ hash _ old-in cacert . PEM | head-1</em></p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/bb8fa578814de07f2283698e615c01ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9m13U8JkfkfUgCa4EVg4cA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">计算哈希</figcaption></figure><p id="579b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">应该使用此输出值创建扩展名为. 0的文件。Pem文件应该导出到此“. 0”文件。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/ccec99dd8fd4693f270990bdaecc9533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*D0GuxeVxUM2FNI36ZUMcDA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">正在创建“. 0”</figcaption></figure><blockquote class="mh mi mj"><p id="1e26" class="kc kd md ke b kf kg kh ki kj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky kz ij bi translated">重要提示:您的哈希值和证书可能与上面的图片不同。</p></blockquote><h2 id="7545" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">创建Magisk模块</h2><p id="5c72" class="pw-post-body-paragraph kc kd iq ke b kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv lx kx ky kz ij bi translated">有必要使用来自这个<a class="ae mn" href="https://github.com/NVISOsecurity/MagiskTrustUserCerts" rel="noopener ugc nofollow" target="_blank"> github repo </a>的信息来创建Magisk模块。生成的证书的结构应该是这样的。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/486a519711dc500b7321168ecf36104e.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*5pukri6l5HZmXy6lD4fbUg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Magisk模块结构</figcaption></figure><p id="e287" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">应该将创建的“. 0”扩展名文件移动到“/system/etc/security/cacerts”文件中。主目录中的module.prop文件包含有关该模块的信息。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/2dee2269aaf081a01ea5086702907464.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*sgpn3C9jySZQkTqjf7u82w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">模块.属性文件</figcaption></figure><p id="19b5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">该文件的内容可以更改。</p><p id="54e3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">/META-INF/com/Google/Android/update-binary文件的内容应该如下所示。</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h2 id="42dc" class="la lb iq bd lc ld le dn lf lg lh dp li kn lj lk ll kr lm ln lo kv lp lq lr ls bi translated">安装Magisk模块</h2><p id="4005" class="pw-post-body-paragraph kc kd iq ke b kf lt kh ki kj lu kl km kn lv kp kq kr lw kt ku kv lx kx ky kz ij bi translated">完成这些操作后，需要安装magisk模块。首先，需要将magisk文件存档为zip格式。</p><p id="f9ea" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有必要创建包含主目录的zip文件。当zip文件打开时，module.prop、META-INF和系统文件应该可以直接查看。</p><p id="bf7a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">创建zip文件后，我们可以通过magisk安装我们创建的模块。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/5261a3ab25d81b0184eb4c4d0d86b637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AiDF1zbs884K6S25FXIgrg.png"/></div></div></figure></div></div>    
</body>
</html>