<html>
<head>
<title>Angstrom CTF 2018 — web challenges [writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">angstrom CTF 2018-网络挑战[报道]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/angstrom-ctf-2018-web-challenges-writeup-8a69998b0123?source=collection_archive---------0-----------------------#2018-03-23">https://infosecwriteups.com/angstrom-ctf-2018-web-challenges-writeup-8a69998b0123?source=collection_archive---------0-----------------------#2018-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9cdf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总体来说，CTF的体验还是不错的。前4个网络挑战超级简单。我们在接下来的4个挑战中学到了一些新东西。</p><h1 id="ac07" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak"> Web 1(源Me 1) : </strong></h1><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/ff32c422dc1949bfcc09c06fce3baa4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_gGDDaO82oJ1rhs3eC-15Q.png"/></div></div></figure><p id="1db8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到<code class="fe lw lx ly lz b">Login</code>的链接出现在以下页面</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ma"><img src="../Images/c2a27af0e7aee38f4b07a9fa665bf05c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U9atph7g346de7gAIP8vpQ.png"/></div></div></figure><p id="78f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看源代码暴露了管理员的密码</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mb"><img src="../Images/8f89daad9538c86a861b366a79511a50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6m1Gp4mSQC9wMS6xGAsXcg.png"/></div></div></figure><p id="f2ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以用户名<code class="fe lw lx ly lz b">admin </code>和密码<code class="fe lw lx ly lz b">f7s0jkl</code>登录返回了标志</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mc"><img src="../Images/cc9cb0e9757f0dcda8c38a2aaa3f625d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kAfnpDfGsYD-MZmQY10sEA.png"/></div></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="26ed" class="km kn iq bd ko kp mk kr ks kt ml kv kw kx mm kz la lb mn ld le lf mo lh li lj bi translated"><strong class="ak"> Web 2 (GET ME) : </strong></h1><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mp"><img src="../Images/9d0a24682ffd58699809d1e1c8e418d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PyCYAGM7IzCLYKkyu03Wqw.png"/></div></div></figure><p id="a761" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">挑战链接位于以下页面</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mq"><img src="../Images/7b7b27aaae9557bf9d2f3f39c51f2343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1iyh1PMN4UUxMKn9By57A.png"/></div></div></figure><p id="9752" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提交时，</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mr"><img src="../Images/793ac0c0b1a677eace91b11fd2df6b59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NvNVljngYvqmW-8CSU2kyg.png"/></div></div></figure><p id="0c29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，这看起来很简单。修改了<code class="fe lw lx ly lz b">auth</code>参数，因为<code class="fe lw lx ly lz b">true</code>返回了标志。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ms"><img src="../Images/94e349d3bfd850f557abe9335916d624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61EMCCRBeYuPpbgJ9Gz1gw.png"/></div></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="dfa7" class="km kn iq bd ko kp mk kr ks kt ml kv kw kx mm kz la lb mn ld le lf mo lh li lj bi translated"><strong class="ak"> Web 3(续):</strong></h1><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mt"><img src="../Images/b35128ee46c0aaf5adee08307bcf9fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wl90A1OmeaVPVFvTfLH_vg.png"/></div></div></figure><p id="fb78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">顾名思义，这是一个SQL注入挑战。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/798f6a53e1fda6249e78e3cf0cc61835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9kgFTiYwHnw4Yu8A9L0JA.png"/></div></div></figure><p id="03fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以尝试了用户名和密码的基本<code class="fe lw lx ly lz b">1' OR '1'='1</code>有效负载，它工作了</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/34c971a1f21643f9ef6b3ed0a4d6edf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Jse1uO2peHYPQ9lmtFlEw.png"/></div></div></figure><p id="7d0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">归还了旗帜。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/fed84ccb9054c3c32a43886fd4daa63f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hw-pxRP-p3-ZAINMnJP3dQ.png"/></div></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="bf5d" class="km kn iq bd ko kp mk kr ks kt ml kv kw kx mm kz la lb mn ld le lf mo lh li lj bi translated"><strong class="ak">第四网(消息来源ME 2) : </strong></h1><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mv"><img src="../Images/650901a6b283aea602c599531636c119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7DxF6yAB57KwYpch7EXC9Q.png"/></div></div></figure><p id="512f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到<code class="fe lw lx ly lz b">site</code>的链接在下面的页面登陆。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mw"><img src="../Images/93074fe1442616f0f18aed5c56904103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TtLUNhg4-kqE4xH9zOExAA.png"/></div></div></figure><p id="78cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在查看页面源代码时，我们得到了用户名和密码验证的逻辑</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mx"><img src="../Images/863a06c60799b242addebc748b70e3cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LI2DY2FCEnkVAvy1cQLwWg.png"/></div></div></figure><p id="014e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以按照逻辑md5( <password>)应该是BDC 87 b 9 c 894 da 5168059 e 00 ebffb 9077。试图通过<a class="ae kl" href="https://crackstation.net/" rel="noopener ugc nofollow" target="_blank">破解站</a>破解哈希。我们拿到了密码。</password></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi my"><img src="../Images/593a3b87ea547b5d89e92db415ae4cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bVvsnMNEKZHsAV2XaUaYug.png"/></div></div></figure><p id="bb23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以用户名<code class="fe lw lx ly lz b">admin</code>和密码<code class="fe lw lx ly lz b">password1234</code>提交返回了标志。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mz"><img src="../Images/74e9065dfcd113b6f20e46bbff7ae5f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64K-HsrqsNPK630HuwuWLw.png"/></div></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="aa20" class="km kn iq bd ko kp mk kr ks kt ml kv kw kx mm kz la lb mn ld le lf mo lh li lj bi translated"><strong class="ak"> Web5 (MADLIBS) : </strong></h1><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi na"><img src="../Images/f1b6257571a9ed93ed4124774f886497.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12bUDXrdMV1QWwW5ZpePoQ.png"/></div></div></figure><p id="c7d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到<code class="fe lw lx ly lz b">website</code>的链接出现在以下页面</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nb"><img src="../Images/f46dbd2e33dc3aeb6a5e48a1be2e4c9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZipJmY7-5suZOwtZCOUcFg.png"/></div></div></figure><p id="aad7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择其中一个故事，并添加一些随机值来理解工作流程</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nc"><img src="../Images/e35a753e1026f195f9fd07e634ec6ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8e-tMcLE_ecq7vxeTw_Jzg.png"/></div></div></figure><p id="f2fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在提交了样本数据之后，我们得到了下面的页面，它清楚地显示了模板中填充了我们给出的值。此时我们猜测可能是模板注入。底部有一个链接<code class="fe lw lx ly lz b">get-source</code>。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nd"><img src="../Images/9b232d1ae08e3479d26316cd6ec46e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Igb8zAnNidsgVXGuKvkRkQ.png"/></div></div></figure><p id="7c80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在访问/get-source页面时，我们获得了正在运行的应用程序的完整源代码。</p><pre class="ll lm ln lo gt ne lz nf ng aw nh bi"><span id="a9cd" class="ni kn iq lz b gy nj nk l nl nm">from flask import Flask, render_template, render_template_string, send_from_directory, request<br/>from jinja2 import Environment, FileSystemLoader<br/>from time import gmtime, strftime<br/>template_dir = './templates'<br/>env = Environment(loader=FileSystemLoader(template_dir))<br/><br/><br/>madlib_names = ["The Tale of a Person","A Random Story"]<br/>story_fields = {<br/>    "The Tale of a Person":['Author Name','Adjective','Noun','Verb'],<br/>    "A Random Story":['Author Name','Adjective','Noun','Any first name','Verb']<br/>    }<br/><br/>app = Flask(__name__)<br/>app.secret_key = open("flag.txt").read()<br/><br/>@app.route("/",methods=["GET"])<br/>def home():<br/>    return render_template("home.html",libs=madlib_names)<br/>    <br/>@app.route("/form/&lt;templatename&gt;",methods=["GET"])<br/>def madlib(templatename):<br/>    global madlib_names<br/>    if templatename in madlib_names:  <br/>        return render_template("home.html",libs=madlib_names,title=templatename,fields=story_fields[templatename])<br/>    else:<br/>        error_message = 'The MadLib with title "' + templatename + '" could not be found.'<br/>        return render_template("home.html",libs=madlib_names,message=error_message)<br/><br/>@app.route("/result/&lt;templatename&gt;",methods=["POST"])<br/>def output(templatename):<br/>    <br/>    if templatename not in madlib_names:    <br/>        return "Template not found."<br/>    <br/>    inpValues = []<br/>    for i in range(len(story_fields[templatename])):<br/>        if not request.form[str(i+1)]: <br/>            return "All form fields must be filled"<br/>        else:<br/>            inpValues.append(request.form[str(i+1)][:24])<br/>        <br/>    authorName = inpValues.pop(0)[:12]<br/>    try:<br/>        comment = render_template_string('''This MadLib with title %s was created by %s at %s''' % (templatename, authorName, strftime("%Y-%m-%d %H:%M:%S", gmtime())))<br/>    except:<br/>        comment = "Error generating comment."<br/>    return render_template("_".join(templatename.lower().split())+".html",libtitle=templatename,footer=comment, libentries=inpValues)<br/>    <br/><br/>@app.route("/get-source", methods=["GET","POST"])<br/>def source():<br/>    return send_from_directory('./','app.py')<br/><br/>if __name__ == "__main__":<br/>    app.run(host='0.0.0.0', port=7777, threaded=True)</span></pre><p id="5151" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看上面的代码，很明显应用程序使用了<a class="ae kl" href="http://jinja.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> jinja2 </a>模板引擎。并且该标志被设置为app对象的<code class="fe lw lx ly lz b">secret_key</code>属性。</p><pre class="ll lm ln lo gt ne lz nf ng aw nh bi"><span id="829b" class="ni kn iq lz b gy nj nk l nl nm">app.secret_key = open("flag.txt").read()</span></pre><p id="4827" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一部分，</p><pre class="ll lm ln lo gt ne lz nf ng aw nh bi"><span id="3096" class="ni kn iq lz b gy nj nk l nl nm">inpValues = []<br/>    for i in range(len(story_fields[templatename])):<br/>        if not request.form[str(i+1)]: <br/>            return "All form fields must be filled"<br/>        else:<br/>            inpValues.append(request.form[str(i+1)][:24])<br/>        <br/>    authorName = inpValues.pop(0)[:12]<br/>    try:<br/>        comment = render_template_string('''This MadLib with title %s was created by %s at %s''' % (templatename, authorName, strftime("%Y-%m-%d %H:%M:%S", gmtime())))</span></pre><p id="d955" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从请求参数上给出的值中追加了<code class="fe lw lx ly lz b">inpValues</code>数组。请求参数被限制为24个字符，然后通过弹出<code class="fe lw lx ly lz b">inputValues</code>的第一个索引来分配<code class="fe lw lx ly lz b">authorname</code>，并且只取前12个字符。</p><p id="3cf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，它被传递给“render_template_string”方法。因此有效负载应该少于或等于12个字符。</p><p id="94b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以首先尝试我们的通用模板注入有效负载<code class="fe lw lx ly lz b">{{7*7}}</code>，只是为了确认应用程序容易受到模板注入的攻击</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mr"><img src="../Images/5adc28e4360e1f0246b20f9ce2a67a62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAhNLg6YcHsUmk1uR84oTA.png"/></div></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">是的，所以我们这里有一个模板注入！！</figcaption></figure><p id="eabe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，它是脆弱的。现在的挑战是检索有效载荷少于12个字符的标志。我们已经知道这个标志在app对象中是secret_key。</p><p id="75df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在互联网上搜索——是否有任何全局对象在内存中拥有所有赋值？在更多的谷歌搜索之后，我们知道flask有这个<code class="fe lw lx ly lz b">config</code>对象，它有所有与会话相关的值。</p><p id="3bd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以用<code class="fe lw lx ly lz b">{{config}}</code>代替<code class="fe lw lx ly lz b">{{7*7}}</code>，我们得到了我们的国旗。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nr"><img src="../Images/3c3785aabd941bbf4489dd082d664ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKwtrAH-T4UpLd-AuojcaA.png"/></div></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="9353" class="km kn iq bd ko kp mk kr ks kt ml kv kw kx mm kz la lb mn ld le lf mo lh li lj bi translated"><strong class="ak"> Web 6 (MD5) : </strong></h1><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mv"><img src="../Images/650901a6b283aea602c599531636c119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7DxF6yAB57KwYpch7EXC9Q.png"/></div></div></figure><p id="1115" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到<code class="fe lw lx ly lz b">site</code>的链接出现在以下页面</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ns"><img src="../Images/71f5fc713d7f9af1ceef90379598c334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XUeqghXiTkrkzhIKucNDRA.png"/></div></div></figure><p id="a9f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在检查源代码链接时，我们得到了以下内容</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nt"><img src="../Images/c9b0a77784a7688dcee2785304954307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y9Krf4TGRtNJrdTKwbCLnA.png"/></div></div></figure><p id="2dbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以很明显，标志在secret.php，输入参数<code class="fe lw lx ly lz b">str1</code>和<code class="fe lw lx ly lz b">str2</code>不应该相同，但是md5散列应该相等。怎么了？首先，我们认为——这是一种哈希碰撞吗？？</p><p id="ea34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要..</p><p id="1263" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事情是这样的—如果我们将str1=somevalue作为str1[]=somevalue发送，$_GET["str1"]将返回<code class="fe lw lx ly lz b">Array</code>而不是<code class="fe lw lx ly lz b">somevalue</code>。所以我们需要以str 1[]= any和str2=Array的形式发送参数。当在散列函数中连接时，<code class="fe lw lx ly lz b">Array</code>将被添加到两边的字符串中(对于两个参数),显然这将返回相同的散列。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nr"><img src="../Images/71e3bb17840bc33bcf5e54093d1fba02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d6kJA0oUwy2oOf7jsAKAAw.png"/></div></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h2 id="8970" class="ni kn iq bd ko nu nv dn ks nw nx dp kw jy ny nz la kc oa ob le kg oc od li oe bi translated">Web 7(文件存储):</h2><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi of"><img src="../Images/3a524ece725725f8a5464b3949cf30bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5gHhdKT4QmPpbBDYPkmiw.png"/></div></div></figure><p id="cd7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件存储网站是注册页面上的登录。目标是找到管理员的密码。我们在访问该页面时没有任何线索。但是后来事情变得很有趣。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi og"><img src="../Images/83e89bc842c1adfcfffa50f210d9ce8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GaxMwfb9qygJUEggUlYrg.png"/></div></div></figure><p id="ec2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，只需输入一个admin作为用户名，一个虚拟值作为密码，以便理解工作流。它返回了错误的密码。然后注册成为新用户。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi oh"><img src="../Images/f737779f92dbc73c663756944eed155f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wsl_zAZzEXgsipR_SDQvAw.png"/></div></div></figure><p id="274c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该应用程序需要URL和密码来下载文件。打起嗝来，检查请求和响应。检查url中的/flag.txt，应用程序返回“文件已经存在”</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nr"><img src="../Images/6d83a56104249118abba347023f6cf6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ixDFp_1byPFOrYxEhLaQzQ.png"/></div></div></figure><p id="04e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，该应用程序可能会检查服务器中已经存在的相同文件名，文件名是根据我们在url路径上给出的名称分配的。所以尝试了一个随机文件来检查它如何响应。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi oi"><img src="../Images/33e07feef4b8aab45edc793043d185d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qCZ3svRTH5l-DrSwFN0XUQ.png"/></div></div></figure><p id="c195" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以它实际上将文件写入文件目录。试图猜测文件夹名称，并尝试了各种SSRF技术和失败。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi oj"><img src="../Images/bf3e6746d3b07e774356f731a9aa4ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7Cm_ErakstqxoiAIrVjTQ.png"/></div></div></figure><p id="cf0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之后我们放弃了一个打开的暗示。提示是“解决不了？Git gud。”所以服务器上有一个本地git repo。我们实际上尝试了/。主路径上的git路径不在/files/ path上。</p><p id="1d72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">学习:到处列举！</p><p id="02e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们最终发现在files下有一个. git目录。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ok"><img src="../Images/4b650ba4bb434f52b5c388ac14a994ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PSVgcfFNWrW-CKL7TqbbFQ.png"/></div></div></figure><p id="6d34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但它不是一个开放的目录。所以实际上需要通过文件的确切路径来获取每个文件。因此，首先我们检查了提交日志。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ol"><img src="../Images/68fcb8ddec87570ef145010f56668375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MiIJxi1sO1JknbvoB6Srzw.png"/></div></div></figure><p id="4af5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发现有一个初始提交。所以我们从对象目录下载了那个对象。通常，在git结构中，散列将是对象的路径，前两个字符是父目录，其余的是文件名。git对象是压缩的数据格式，可以通过使用zlib包的简单python程序进行解压缩。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/3004c3418490f2463b91fe818d0005d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqmhYPStNUibli4tmkfskA.png"/></div></div></figure><p id="bf1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们以gpg签名结束。也不知道该怎么做。</p><p id="89d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几小时过去了..</p><p id="1a25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们检查了索引文件(妈的！我们应该先检查这个)</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/e4f54566b4ea483caaf90adb658f5a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XZVIOpVgyabz0LLikdzUQw.png"/></div></div></figure><p id="28c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们可以看到服务器上的文件。Index.py是主应用程序。所以试图直接得到，但是..</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi om"><img src="../Images/b130359e43423f907857dfed02e57c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ap6QLi2A481IbEH94bfK-Q.png"/></div></div></figure><p id="b8c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以下载了部分可读的索引文件。并搜索了如何阅读git索引文件。并在<a class="ae kl" href="https://gist.github.com/DQNEO/d6ee3bcc8162d4a80bb86203d6cc31c9" rel="noopener ugc nofollow" target="_blank"> gist </a>上找到了一个名为<a class="ae kl" href="https://gist.github.com/DQNEO/d6ee3bcc8162d4a80bb86203d6cc31c9#file-parse_git_index-c" rel="noopener ugc nofollow" target="_blank"> parse_git_index.c </a>的实用程序。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/9fd97afc4f1dd68e7c9e502526689661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZqsObMUphar1msXUtLjrA.png"/></div></div></figure><p id="8a19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们又有了哈希值，所以使用之前的技术下载了解压缩的index.py文件</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/2c8323d9c50a6f5c1cff52147b4bd03b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0o-myIhBZSXcuEhH96beEQ.png"/></div></div></figure><p id="b74b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">整个代码是</p><pre class="ll lm ln lo gt ne lz nf ng aw nh bi"><span id="c70f" class="ni kn iq lz b gy nj nk l nl nm"><strong class="lz ir">from </strong>flask <strong class="lz ir">import </strong>Flask, request, render_template, abort<br/><strong class="lz ir">import </strong>os, requests<br/><br/>app = Flask(__name__)<br/><br/><strong class="lz ir">class </strong>user:<br/>    <strong class="lz ir">def </strong>__init__(self, username, password):<br/>        self.username = username<br/>        self.__password = password<br/>        self.files = []<br/>    <strong class="lz ir">def </strong>getPass(self):<br/>        <strong class="lz ir">return </strong>self.__password<br/><br/>users = {}<br/><br/>users[<strong class="lz ir">"admin"</strong>] = user(<strong class="lz ir">"admin"</strong>, os.environ[<strong class="lz ir">"FLAG"</strong>])<br/><br/><br/><strong class="lz ir">def </strong>custom500(error):<br/>    <strong class="lz ir">return </strong>str(error), 500<br/><br/>@app.route(<strong class="lz ir">"/"</strong>, methods=[<strong class="lz ir">"GET"</strong>, <strong class="lz ir">"POST"</strong>])<br/><strong class="lz ir">def </strong>mainpage():<br/>    <strong class="lz ir">if </strong>request.method == <strong class="lz ir">"POST"</strong>:<br/>        <strong class="lz ir">if </strong>request.form[<strong class="lz ir">"action"</strong>] == <strong class="lz ir">"Login"</strong>:<br/>            <strong class="lz ir">if </strong>request.form[<strong class="lz ir">"username"</strong>] <strong class="lz ir">in </strong>users:<br/>                <strong class="lz ir">if </strong>request.form[<strong class="lz ir">"password"</strong>] == users[request.form[<strong class="lz ir">"username"</strong>]].getPass():<br/>                    <strong class="lz ir">return </strong>render_template(<strong class="lz ir">"index.html"</strong>, user=users[request.form[<strong class="lz ir">"username"</strong>]])<br/>                <strong class="lz ir">return "wrong password"<br/>            return "user does not exist"<br/>        elif </strong>request.form[<strong class="lz ir">"action"</strong>] == <strong class="lz ir">"Signup"</strong>:<br/>            <strong class="lz ir">if </strong>request.form[<strong class="lz ir">"username"</strong>] <strong class="lz ir">not in </strong>users:<br/>                users[request.form[<strong class="lz ir">"username"</strong>]] = user(request.form[<strong class="lz ir">"username"</strong>], request.form[<strong class="lz ir">"password"</strong>])<br/>                <strong class="lz ir">return </strong>render_template(<strong class="lz ir">"index.html"</strong>, user=users[request.form[<strong class="lz ir">"username"</strong>]])<br/>            <strong class="lz ir">else</strong>:<br/>                <strong class="lz ir">return "user already exists"<br/>        elif </strong>request.form[<strong class="lz ir">"action"</strong>] == <strong class="lz ir">"Add File"</strong>:<br/>            <strong class="lz ir">return </strong>addfile()<br/>    <strong class="lz ir">return </strong>render_template(<strong class="lz ir">"loggedout.html"</strong>)<br/><br/><em class="on">#beta feature for viewing info about other users - still testing<br/></em>@app.route(<strong class="lz ir">"/user/&lt;username&gt;"</strong>, methods=[<strong class="lz ir">'POST'</strong>])<br/><strong class="lz ir">def </strong>getInfo(username):<br/>    val = getattr(users[username], request.form[<strong class="lz ir">'field'</strong>], None)<br/>    <strong class="lz ir">if </strong>val != None: <strong class="lz ir">return </strong>val<br/>    <strong class="lz ir">else</strong>: <strong class="lz ir">return "error"<br/><br/></strong>@app.route(<strong class="lz ir">"/files/&lt;path:file&gt;"</strong>, methods=[<strong class="lz ir">"GET"</strong>])<br/><strong class="lz ir">def </strong>getFile(file):<br/>    <strong class="lz ir">if "index.py" in </strong>file:<br/>        <strong class="lz ir">return "no! bad user! bad!"<br/>    return </strong>open(file, <strong class="lz ir">"rb"</strong>).read()<br/><br/><strong class="lz ir">def </strong>addfile():<br/>    <strong class="lz ir">if </strong>users[request.form[<strong class="lz ir">"username"</strong>]].getPass() == request.form[<strong class="lz ir">"password"</strong>]:<br/>        <strong class="lz ir">if </strong>request.form[<strong class="lz ir">'url'</strong>][-1] == <strong class="lz ir">"/"</strong>: downloadurl = request.form[<strong class="lz ir">'url'</strong>][:-1]<br/>        <strong class="lz ir">else</strong>: downloadurl = request.form[<strong class="lz ir">'url'</strong>]<br/>        <strong class="lz ir">if </strong>downloadurl.split(<strong class="lz ir">"/"</strong>)[-1] <strong class="lz ir">in </strong>os.listdir(<strong class="lz ir">"."</strong>):<br/>            <strong class="lz ir">return "file already exists"<br/>        </strong>file = requests.get(downloadurl, stream=True)<br/>        f = open(downloadurl.split(<strong class="lz ir">"/"</strong>)[-1], <strong class="lz ir">"wb"</strong>)<br/>        first = True<br/>        <strong class="lz ir">for </strong>chunk <strong class="lz ir">in </strong>file.iter_content(chunk_size=1024*512):<br/>            <strong class="lz ir">if not </strong>first: <strong class="lz ir">break<br/>            </strong>f.write(chunk)<br/>            first = False<br/>        f.close()<br/>        users[request.form[<strong class="lz ir">"username"</strong>]].files.append(downloadurl.split(<strong class="lz ir">"/"</strong>)[-1])<br/>        <strong class="lz ir">return </strong>render_template(<strong class="lz ir">"index.html"</strong>, user=users[request.form[<strong class="lz ir">"username"</strong>]])<br/>    <strong class="lz ir">return "bad password"<br/><br/>if </strong>__name__ == <strong class="lz ir">"__main__"</strong>: app.run(host=<strong class="lz ir">"0.0.0.0"</strong>)</span></pre><p id="e04a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查代码时，创建了一个admin用户对象，其标志值为password。</p><pre class="ll lm ln lo gt ne lz nf ng aw nh bi"><span id="7524" class="ni kn iq lz b gy nj nk l nl nm">users[<strong class="lz ir">"admin"</strong>] = user(<strong class="lz ir">"admin"</strong>, os.environ[<strong class="lz ir">"FLAG"</strong>])</span></pre><p id="e7f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后发现了这个有趣的隐藏功能来查看所有用户信息</p><pre class="ll lm ln lo gt ne lz nf ng aw nh bi"><span id="5541" class="ni kn iq lz b gy nj nk l nl nm"><em class="on">#beta feature for viewing info about other users - still testing<br/></em>@app.route(<strong class="lz ir">"/user/&lt;username&gt;"</strong>, methods=[<strong class="lz ir">'POST'</strong>])<br/><strong class="lz ir">def </strong>getInfo(username):<br/>    val = getattr(users[username], request.form[<strong class="lz ir">'field'</strong>], None)<br/>    <strong class="lz ir">if </strong>val != None: <strong class="lz ir">return </strong>val<br/>    <strong class="lz ir">else</strong>: <strong class="lz ir">return "error"</strong></span></pre><p id="687c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原来是这么回事！<br/>检查用户类后，有三个属性——用户名、_ _密码和文件。</p><p id="694c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们需要用admin __password替换请求上的字段参数的<username>。但是失败了。</username></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ms"><img src="../Images/0481d325e3ff3d812294d479b441b0cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uguyu6uVUfkZaCEgcH93kA.png"/></div></div></figure><p id="f454" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户名属性有效，但_ _密码无效</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ms"><img src="../Images/0481d325e3ff3d812294d479b441b0cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uguyu6uVUfkZaCEgcH93kA.png"/></div></div></figure><p id="7603" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直到这时，我才知道双下划线有特殊的含义，也不知道如何处理它。所以我创建了同一个用户类，并创建了一个新对象，使用__dict__检查了该对象的所有属性</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi oo"><img src="../Images/7e886d56fb5ebbd78741c96ef2ac4445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vfOJ24pIFTlx2Yl2nOhTBA.png"/></div></div></figure><p id="c112" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哦..在谷歌搜索了同样的概念后。<br/>` _ _ _ '表示` _classname__attributename`。</p><p id="1417" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧。于是，要求归档为<code class="fe lw lx ly lz b">_user__password</code>，我们得到了旗帜！</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi op"><img src="../Images/7c91be91303f403b43ad2b79901b6ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RkLOTQKWr3-L-xCrydpUgA.png"/></div></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h2 id="83e8" class="ni kn iq bd ko nu nv dn ks nw nx dp kw jy ny nz la kc oa ob le kg oc od li oe bi translated">Web 8(最佳网站):</h2><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi oq"><img src="../Images/e7422ac6b3eb05eee73832f74f35e43a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVowMAV2eooIVpqyrC0cNQ.png"/></div></div></figure><p id="211c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个挑战花了我们两天时间来解决，因为我们在寻找一个错误的漏洞。在了解情况后，我们能够在不到15分钟的时间内解决它，多么好的游戏XD..</p><p id="9646" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">挑战链接出现在模板页面上</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/45a0844ae8417fd49c24d7a90e224383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cdTdnltaH5WapF52CWZtkA.png"/></div></div></figure><p id="e7dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以第一步我们检查了页面源代码。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi or"><img src="../Images/fe2a5d3ad010338817641bc01ef086d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eHibX8df0y3c6Nj61gZVMQ.png"/></div></div></figure><p id="5b10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们获得了log.txt的链接，并检查任何可用的信息</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi os"><img src="../Images/a73949742b3275955b8da952e420f3d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TemN23fJEZjSeUuTXXWlg.png"/></div></div></figure><p id="9988" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一开始没什么帮助。然后移到主页，检查所有请求，其中一个请求不是对静态资源的调用</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/e16b30ce915f8f44ed71d510a7ba093f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ub8bVCFEwP-IuQ_LtV6hkQ.png"/></div></div></figure><p id="84d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过查看id的结构，我们能够猜测这些都是mongodb对象id。但这是我们最初知道的唯一事情。然后搜索了所有的NoSQL注射文件，并尝试了地狱的有效载荷，我们无法弄清楚幕后到底发生了什么。由于我们以前没有在mongodb上的经验，我们花了两天时间试图理解NoSQL上的注入概念。没有任何帮助。</p><p id="3612" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后有一个想法——如果这不是一个注入漏洞呢？？</p><p id="60e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的。那时，我们知道了这个<a class="ae kl" href="https://docs.mongodb.com/manual/reference/method/ObjectId/#ObjectIDs-BSONObjectIDSpecification" rel="noopener ugc nofollow" target="_blank"> objectId </a>是如何工作的</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ot"><img src="../Images/2b7487fd5d67d507b3008231f8357d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89y4WptmzPgMoI1hbg1VQA.png"/></div></div></figure><p id="14e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以ObjectId是一个具有上述结构的十六进制字符串。<br/>例如让我们拿一个ObjectId—5a ad 412 be 07 E1 e 001 FCE 6d 2，</p><p id="629f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5aad412b — e07e1e — 001c — fce6d2 <br/>它是这样工作的</p><p id="c0e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5aad412b —一个4字节的值，表示自Unix纪元<br/> e07e1e以来的秒数— 3字节机器标识符<br/> 001c — 2字节进程id<br/>fce6d 2—3字节计数器，以随机值开始</p><p id="2c08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以这里的<code class="fe lw lx ly lz b">machine identifier</code>和<code class="fe lw lx ly lz b">process id</code>应该是一样的。并且变化的因素是时间戳和计数器值。</p><p id="b8f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">起初，我们想到了强制字节计数器(我们认为集合中的所有记录都可以一次插入)。那失败了！<br/>我们又查了log.txt。哦，妈的！我们忘了那个。日志中已经记录了插入时间。</p><p id="9efe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们刚刚将时间戳从2018年3月17日星期六16:24:17 GMT+0000 (UTC)转换为unix时间戳</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ou"><img src="../Images/8023a71d69529566267d9cf217b77a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BIHef2nx5r-7Leg_bwaGuQ.png"/></div></div></figure><p id="a03f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并将其转换成十六进制</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ov"><img src="../Images/0b150889a590a1978da756134daa8331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ou9-s5p-RtbWql6vH9quMQ.png"/></div></div></figure><p id="1294" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以现在我们有了十六进制时间戳、机器标识符和进程id(已经知道)。我们已经知道字节计数器是一个一个递增的(查看第五张截图)。</p><p id="e00d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">id分别为5 aad 412 be 07 E1 e 001 c<strong class="jp ir">fce6d 2</strong>，5 aad 412 be 07 E1 e 001 c<strong class="jp ir">fce6d 3</strong>，5 aad 412 be 07 E1 e 001 c<strong class="jp ir">fce6d 4</strong></p><p id="ffbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以下一个增加的值应该是<strong class="jp ir"> fce6d5。</strong>这就是我们对旗帜的最终反对意见—<strong class="jp ir">5a ad 4131 e 07 E1 e 001 FCE 6d 5</strong></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nr"><img src="../Images/97495fe09575505e5126b270a5e13ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vXJHU8RJTY-wxNzIPvwpHw.png"/></div></div></figure><p id="5fce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">终于！</p><p id="0e15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向创造了这个令人敬畏的CTF的蒙哥马利·布莱尔高中的学生致敬！</p><p id="c6c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-H4 ckx 0 r 5团队</p></div></div>    
</body>
</html>