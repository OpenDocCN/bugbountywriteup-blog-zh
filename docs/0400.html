<html>
<head>
<title>How I was able to bypass OTP code requirement in Razer [The story of a critical bug]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何在Razer中绕过OTP代码要求的</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-was-able-to-bypass-otp-token-requirement-in-razer-the-story-of-a-critical-bug-fc63a94ad572?source=collection_archive---------0-----------------------#2019-10-16">https://infosecwriteups.com/how-i-was-able-to-bypass-otp-token-requirement-in-razer-the-story-of-a-critical-bug-fc63a94ad572?source=collection_archive---------0-----------------------#2019-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6387" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是来自尼泊尔的@dhakal_ananda，这是我的第一篇博文。事不宜迟，让我们继续讨论bug。</p><p id="73bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以这个故事很长。在Razer在Hackerone上公开之前，它是一个私人项目，如果你们大多数人在它公开的时候看过的话，就会知道，我也被邀请参加这个私人项目。但是我不知道为什么我没有黑进程序，只是拒绝了邀请。过了一段时间，它公开了，当我看到它时，它引起了我的注意。我对这个程序非常感兴趣，并立即开始了黑客活动。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="e0a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我对绕过安全功能更感兴趣，而不是搜索XSS和SQLi，所以我开始绕过OTP令牌，因为它在第一眼就引起了我的注意。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ks"><img src="../Images/53eae326fcc72aa9c7ca141162b968ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJ9VAFuBZWXoj3VMg0yCIg.png"/></div></div></figure><p id="9e6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我困惑了几次，发现应用程序使用了一个长令牌来验证是否输入了OTP代码。仅在输入有效的OTP代码后才提供OTP令牌。</p><p id="8a3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们怎么做才能绕过代码呢？？我不知道你的<strong class="jp ir"> <em class="kz">黑客头脑</em> </strong>是否想到了这一点，但没错，这是<strong class="jp ir">使用攻击者的令牌来验证受害者的令牌</strong>。我试过那种方法，它奏效了。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="la kr l"/></div></figure><h2 id="c8ea" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">以下是重现该问题的方法:</h2><ol class=""><li id="d204" class="lu lv iq jp b jq lw ju lx jy ly kc lz kg ma kk mb mc md me bi translated">登录到攻击者的帐户</li><li id="e789" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">转到<a class="ae mk" href="https://hackerone.com/redirect?signature=f932cf1f285dd2c9c3206ddde9ecb8cd5d9988d0&amp;url=https%3A%2F%2Frazerid.razer.com%2Faccount" rel="noopener ugc nofollow" target="_blank">https://razerid.razer.com/account</a>并点击电子邮件字段</li><li id="6656" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">您将看到一个对话框，提示您需要输入OTP代码</li><li id="2cd3" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">输入有效代码并拦截更改电子邮件的请求</li><li id="8f08" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">将请求发送到中继器</li><li id="8aac" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">假设您有受害者的凭据，登录受害者的帐户</li><li id="f405" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">拦截更改名称的请求</li><li id="5ad3" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">复制用户id和用户令牌，并将其保存在一个文件中</li><li id="47ab" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">根据发送到中继器的请求，将受害者的用户id和用户令牌粘贴到攻击者的用户id和用户令牌字段中</li><li id="c3d4" class="lu lv iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">提交请求，看到电子邮件地址被添加到受害者的帐户中，而不需要OTP令牌</li></ol><pre class="kl km kn ko gt ml mm mn mo aw mp bi"><span id="dbae" class="lb lc iq mm b gy mq mr l ms mt">POST /api/emily/7/user-security/post HTTP/1.1<br/>Host: razerid.razer.com<br/>Connection: close<br/>Content-Length: 260<br/>Accept: application/json, text/plain, */*<br/>Origin: <a class="ae mk" href="https://razerid.razer.com" rel="noopener ugc nofollow" target="_blank">https://razerid.razer.com</a><br/>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36<br/>DNT: 1<br/>Sec-Fetch-Mode: cors<br/>Content-Type: application/json;charset=UTF-8<br/>Sec-Fetch-Site: same-origin<br/>Referer: <a class="ae mk" href="https://razerid.razer.com/account/email" rel="noopener ugc nofollow" target="_blank">https://razerid.razer.com/account/email</a><br/>Accept-Encoding: gzip, deflate<br/>Accept-Language: en-GB,en-US;q=0.9,en;q=0.8<br/>Cookie: ...</span><span id="9042" class="lb lc iq mm b gy mu mr l ms mt">{"data":"&lt;COP&gt;&lt;User&gt;&lt;ID&gt;user_id&lt;/ID&gt;&lt;Token&gt;user_token&lt;/Token&gt;&lt;OTPToken&gt;otp_token_value_here&lt;/OTPToken&gt;&lt;login&gt;&lt;email&gt;attacker-email@example.com&lt;/email&gt;&lt;method&gt;add&lt;/method&gt;&lt;primary&gt;1&lt;/primary&gt;&lt;/login&gt;&lt;/User&gt;&lt;ServiceCode&gt;0060&lt;/ServiceCode&gt;&lt;/COP&gt;"}</span></pre><p id="d7f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kz">注意:这个复制的步骤与我提交的报告不一样。这是使用可开发的POC进行复制的简化和实际步骤。</em></p><p id="4c28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我这样做是因为应用程序没有验证cookies和其他东西。它验证的只是用户标识、用户令牌和动态口令令牌。但是OTP_token只有在有效时才有效。未验证它是否属于特定用户。这意味着我可以在受害者的请求中粘贴攻击者的令牌，绕过受害者帐户的OTP验证。T13】</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mv kr l"/></div></figure><p id="b718" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kz">你知道吗？？这个过程最终并不顺利。这是真实的故事。</em> </strong></p><p id="e510" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我提交了报告，复制步骤如下。下面的复制步骤和上面的复制步骤最后是一样的。只是下面的复制步骤很复杂，不容易理解。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mw"><img src="../Images/d629c7af9b67efb10e97dc3db0892f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2u73s4Tg1EAeIDjlGSeJJA.png"/></div></div></figure><p id="7b48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，你可以按照这些步骤复制访问受害者的设置，这也是我一开始发现的。这是通过改变反应和做事情和事情和事情，但是，从上述复制步骤，团队成员认为，这将需要物理访问受害者的设备/浏览器。我已经模糊了这么多，以获得这些繁殖的最后步骤，但Hackerone triage团队成员要求更多关于它的信息，说了这样的话:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mx"><img src="../Images/fe1704b13c059e3a11dc310eb9b4d3bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3wJwTZ9dcUPcHZFZqS-6A.png"/></div></div></figure><p id="2b99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我当时就想"<em class="kz">搞什么鬼？</em></p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="my kr l"/></div></figure><p id="a51e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我确实在做那件事。我回答了一些没有答案的狗屎问题，如果我现在看到它。在我回复后，该成员以<strong class="jp ir">信息丰富为由关闭了报告。</strong>我让他让内部团队评估这个问题。内部团队成员说这不是一个有效的问题，也就是说，他也不清楚我想说什么。我请他打开问题，以便我可以自行关闭，因为他们似乎根本不理解它。<em class="kz">更明确的说，我也没有像现在这样理解</em>。然后他打开报告让我自我关闭，因为这对我的信号没有负面影响。</p><p id="9ed2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kz"># bugbounty提示:在你提交这样的bug之前，确保你有清晰的复制步骤。尽可能简化步骤。你能理解的bug不能被团队成员理解，你可能会像我一样，最终得到一个N/A或信息。</em></p><p id="a0f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我完全放下了报告，继续前进。在继续前进3天后，我回到了报告上，因为我意识到了一件事。大多数应用程序要求你在登录时输入2FA代码，但当我试图更改敏感信息时，它会询问。因此，我在报告中评论说，我绕过了2FA的要求，所以它一定是一个有效的漏洞。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mz"><img src="../Images/61a361129fb16fd9263e86fb1c0ef7fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1ajA_AW4YED28hAOpSiHQ.png"/></div></div></figure><p id="0597" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">过了一天，我收到了一个回复，大概是这样的:</p><blockquote class="na nb nc"><p id="09d8" class="jn jo kz jp b jq jr js jt ju jv jw jx nd jz ka kb ne kd ke kf nf kh ki kj kk ij bi translated">如果你有一个PoC，你只能访问受害者用户的Razer ID帐户和密码，然后可以访问或更改个人资料信息，这将是一个有效的报告。</p></blockquote><p id="8612" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而我就像<strong class="jp ir">挑战接受了！！</strong></p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ng kr l"/></div></figure><p id="d1f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该团队成员向我提供了一个测试帐户的电子邮件地址和密码，以更改电子邮件地址。我在没有访问OTP令牌的情况下更改了该帐户的电子邮件地址，并删除了之前的电子邮件。之后，我说我已经更改了电子邮件地址，你不能使用以前的电子邮件访问该帐户。</p><p id="f89a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kz">在这次黑客攻击中，我和我的兄弟以及我的表弟在一起，在我一大早完全利用了这个漏洞之后，我们真的在大喊大叫</em></p><p id="e7c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一天后，他重新打开了报告，并将状态更改为<strong class="jp ir">triaded</strong>，严重性设置为<strong class="jp ir"> Critical。</strong>我真的很高兴，因为我能够展示一个概念验证并利用这个漏洞。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="nh kr l"/></div></figure><p id="a7fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kz">两天后，我想我应该写一篇关于这个问题的文章，并为它保存一个视频。但在我创建视频概念验证之前，它就被修复了。</em></p><p id="ec60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我为此获得了总计1000美元的奖金。赏金是750美元，奖金是250美元，因为这个误会非常非常长。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ni kr l"/></div></figure><p id="a5d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kz"># bugbounty提示:确保模糊参数，并在另一个用户的会话中使用一个用户的令牌。有时，可能存在令牌验证，但缺少用户令牌验证。</em></p><p id="2e91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过几天的分流，我发现了另一个OTP旁路，这个问题已经解决了。这是一个非常快速有效的解决方案，奖金还在等待中。</p><p id="5164" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你们喜欢这篇很长的博文。请随意发送一些反馈，我会非常感激。下一篇文章再见。</p><p id="1b86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kz">哈克罗尼简介:https://hackerone.com/dhakal_ananda</em></p><p id="94a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kz">推特简介:</em><a class="ae mk" href="https://twitter.com/dhakal_ananda" rel="noopener ugc nofollow" target="_blank"><em class="kz">https://twitter.com/dhakal_ananda</em></a></p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="e8c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kz">关注</em> <a class="ae mk" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="kz"> Infosec报道</em> </a> <em class="kz">获取更多此类精彩报道。</em></p><div class="nq nr gp gr ns nt"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">信息安全报道</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh kx nt"/></div></div></a></div></div></div>    
</body>
</html>