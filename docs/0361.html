<html>
<head>
<title>Hail Frida!! The Universal SSL pinning bypass for Android applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">弗里达万岁！！Android应用程序的通用SSL锁定旁路</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hail-frida-the-universal-ssl-pinning-bypass-for-android-e9e1d733d29?source=collection_archive---------0-----------------------#2019-08-24">https://infosecwriteups.com/hail-frida-the-universal-ssl-pinning-bypass-for-android-e9e1d733d29?source=collection_archive---------0-----------------------#2019-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dd14ab164adf6c86de5686071ed8ea5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZ1WcMxWbfBrSZ-fXALwWg.png"/></div></div></figure><p id="6377" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi kw translated"><span class="l kx ky kz bm la lb lc ld le di">大家好</span>在这篇文章中，我将解释如何使用frida框架绕过android应用程序的SSL固定。我会试着更详细更清楚地解释所有的事情。</p><p id="b65d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">本文将涵盖:</strong></p><ol class=""><li id="653b" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated"><em class="lo">Frida和SSL pin简介</em></li><li id="d19d" class="lf lg iq ka b kb lp kf lq kj lr kn ls kr lt kv lk ll lm ln bi translated"><em class="lo">要求</em></li><li id="4c86" class="lf lg iq ka b kb lp kf lq kj lr kn ls kr lt kv lk ll lm ln bi translated"><em class="lo">设置和安装</em></li><li id="bb5e" class="lf lg iq ka b kb lp kf lq kj lr kn ls kr lt kv lk ll lm ln bi translated">Frida服务器设置</li><li id="aeae" class="lf lg iq ka b kb lp kf lq kj lr kn ls kr lt kv lk ll lm ln bi translated">设置BurpSuite</li><li id="8f55" class="lf lg iq ka b kb lp kf lq kj lr kn ls kr lt kv lk ll lm ln bi translated">推送代理的CA证书:</li><li id="a1e7" class="lf lg iq ka b kb lp kf lq kj lr kn ls kr lt kv lk ll lm ln bi translated">绕过SSL锁定的脚本注入</li><li id="1a59" class="lf lg iq ka b kb lp kf lq kj lr kn ls kr lt kv lk ll lm ln bi translated">一言以蔽之</li><li id="fcf8" class="lf lg iq ka b kb lp kf lq kj lr kn ls kr lt kv lk ll lm ln bi translated">解决纷争</li></ol></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="9992" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">1.Frida <em class="mz">和SSL pin</em>简介</h1><p id="fee5" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">Frida框架是SSL pinning bypass的最后一站。</p><p id="aa0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据frida <a class="ae nf" href="https://www.frida.re/docs/home/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">网站</strong> </a>:</p><blockquote class="ng nh ni"><p id="6a64" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">“这是本机应用程序的<a class="ae nf" href="https://addons.mozilla.org/en-US/firefox/addon/greasemonkey/" rel="noopener ugc nofollow" target="_blank"> Greasemonkey </a>，或者用更专业的术语来说，这是一个动态代码工具套件。它允许你将JavaScript片段或你自己的库注入到Windows、macOS、GNU/Linux、iOS、Android和QNX上的本地应用程序中。Frida还为您提供了一些构建在Frida API之上的简单工具。这些可以按原样使用，根据您的需要进行调整，或者作为如何使用API的示例。”</p></blockquote><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/fad16944a9eff87198dd6ed94b06bacf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*42qQYWNSdimNUEW4okfdgw.jpeg"/></div></div></figure><blockquote class="ng nh ni"><p id="cd8a" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">证书锁定是将远程服务器信任的证书硬编码在应用程序本身中，以便它将忽略设备证书存储，并将信任他自己的硬编码证书，进一步的应用程序将使用该证书“安全地”与远程服务器通信。</p></blockquote><p id="e0fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如今，当我们甚至开始对大多数移动应用程序的HTTP请求进行动态分析时，SSL锁定旁路是需要完成的主要步骤，因为组织更加关注数据隐私和网络上数据的安全传输，以免受到中间人(MiTM)攻击等线程的攻击。</p><p id="c72a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Frida是一个框架，它将脚本注入到本地应用程序中，以在运行时操纵应用程序的逻辑，这是一种测试移动应用程序的更动态的方法。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="16a9" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">2.要求</h1><p id="fe3c" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">在表演魔术之前，让我们收集并满足所有要求。第一次设置需要一些时间，因为需求列表很长。一旦我们完成了所有的设置，从下一次它将是小菜一碟。如果你在任何一步卡住了，在博客的最后有<em class="lo"/><strong class="ka ir"><em class="lo">故障排除</em></strong><em class="lo"/>一节。建议将所有下载的内容保存在一个文件夹中。</p><p id="2e7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">一、根设备/仿真器:</strong></p><p id="128c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将需要一个根设备或模拟器，因为我们需要注入脚本到设备的根目录。这个我用的是genymotion。Genymotion易于安装和使用，可以从下面下载。</p><blockquote class="ng nh ni"><p id="dc4b" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated"><a class="ae nf" href="https://www.genymotion.com/fun-zone/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">【https://www.genymotion.com/fun-zone/】</strong></a></p></blockquote><p id="48b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦我们安装完genymotion，我们需要安装一个android设备。安卓7+版本就好走了。我将使用具有以下配置的'<em class="lo"> Google pixel XL' </em>设备。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/a580fd14c5f9056ab2130fca772da1bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*_WFyTAo9-G7Zcq_XDGGoHg.jpeg"/></div></figure><p id="0b55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">二。Python frida包安装:</strong></p><p id="59ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从这里安装Python for windows。</p><blockquote class="ng nh ni"><p id="6a20" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated"><a class="ae nf" href="https://www.python.org/downloads/windows/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="iq">https://www.python.org/downloads/windows/</em></strong></a></p></blockquote><p id="5110" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要为frida服务器安装一些python包。为此，请在终端中输入以下命令:</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="c464" class="nx mc iq nt b gy ny nz l oa ob">python -m pip install Frida<br/>python -m pip install objection<br/>python -m pip install frida-tools</span><span id="b079" class="nx mc iq nt b gy oc nz l oa ob">or</span><span id="0b80" class="nx mc iq nt b gy oc nz l oa ob">pip install Frida<br/>pip install objection<br/>pip install frida-tools</span></pre><p id="4ec0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">三。平台工具(亚行):</strong></p><p id="206e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从以下链接下载windows平台工具:</p><blockquote class="ng nh ni"><p id="3df9" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated"><a class="ae nf" href="https://dl.google.com/android/repository/platform-tools-latest-windows.zip" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="iq">https://dl . Google . com/Android/repository/platform-tools-latest-windows . zip</em></strong></a></p></blockquote><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/3afe88addc42f93f6dfda196d00f28ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*VEwoPGbBF-YTJqo3WjE0bA.png"/></div></figure><p id="c337" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">四。下载注射脚本:</strong></p><p id="f591" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要从下面下载注入脚本，我们将把它推入设备，以便注入目标应用程序。</p><blockquote class="ng nh ni"><p id="b2f3" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated"><a class="ae nf" href="https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="iq">https://codeshare . Frida . re/@ PCI polloni/universal-Android-SSL-pinning-bypass-with-Frida/</em></strong></a></p></blockquote><p id="32e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者您可以将此代码作为<strong class="ka ir"> fridascript.js </strong>保存在与adb相同的文件夹中。</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="077f" class="nx mc iq nt b gy ny nz l oa ob">/* <br/>   Android SSL Re-pinning frida script v0.2 030417-pier</span><span id="cd2a" class="nx mc iq nt b gy oc nz l oa ob">$ adb push burpca-cert-der.crt /data/local/tmp/cert-der.crt<br/>   $ frida -U -f it.app.mobile -l frida-android-repinning.js --no-pause</span><span id="f9b3" class="nx mc iq nt b gy oc nz l oa ob"><a class="ae nf" href="https://techblog.mediaservice.net/2017/07/universal-android-ssl-pinning-bypass-with-frida/" rel="noopener ugc nofollow" target="_blank">https://techblog.mediaservice.net/2017/07/universal-android-ssl-pinning-bypass-with-frida/</a><br/>   <br/>   UPDATE 20191605: Fixed undeclared var. Thanks to <a class="ae nf" href="http://twitter.com/oleavr" rel="noopener ugc nofollow" target="_blank">@oleavr</a> and <a class="ae nf" href="http://twitter.com/ehsanpc9999" rel="noopener ugc nofollow" target="_blank">@ehsanpc9999</a> !<br/>*/</span><span id="c8bd" class="nx mc iq nt b gy oc nz l oa ob">setTimeout(function(){<br/>    Java.perform(function (){<br/>     console.log("");<br/>     console.log("[.] Cert Pinning Bypass/Re-Pinning");</span><span id="f81b" class="nx mc iq nt b gy oc nz l oa ob">var CertificateFactory = Java.use("java.security.cert.CertificateFactory");<br/>     var FileInputStream = Java.use("java.io.FileInputStream");<br/>     var BufferedInputStream = Java.use("java.io.BufferedInputStream");<br/>     var X509Certificate = Java.use("java.security.cert.X509Certificate");<br/>     var KeyStore = Java.use("java.security.KeyStore");<br/>     var TrustManagerFactory = Java.use("javax.net.ssl.TrustManagerFactory");<br/>     var SSLContext = Java.use("javax.net.ssl.SSLContext");</span><span id="4a07" class="nx mc iq nt b gy oc nz l oa ob">// Load CAs from an InputStream<br/>     console.log("[+] Loading our CA...")<br/>     var cf = CertificateFactory.getInstance("X.509");<br/>     <br/>     try {<br/>      var fileInputStream = FileInputStream.$new("/data/local/tmp/cert-der.crt");<br/>     }<br/>     catch(err) {<br/>      console.log("[o] " + err);<br/>     }<br/>     <br/>     var bufferedInputStream = BufferedInputStream.$new(fileInputStream);<br/>    var ca = cf.generateCertificate(bufferedInputStream);<br/>     bufferedInputStream.close();</span><span id="7bc8" class="nx mc iq nt b gy oc nz l oa ob">var certInfo = Java.cast(ca, X509Certificate);<br/>     console.log("[o] Our CA Info: " + certInfo.getSubjectDN());</span><span id="8ff8" class="nx mc iq nt b gy oc nz l oa ob">// Create a KeyStore containing our trusted CAs<br/>     console.log("[+] Creating a KeyStore for our CA...");<br/>     var keyStoreType = KeyStore.getDefaultType();<br/>     var keyStore = KeyStore.getInstance(keyStoreType);<br/>     keyStore.load(null, null);<br/>     keyStore.setCertificateEntry("ca", ca);<br/>     <br/>     // Create a TrustManager that trusts the CAs in our KeyStore<br/>     console.log("[+] Creating a TrustManager that trusts the CA in our KeyStore...");<br/>     var tmfAlgorithm = TrustManagerFactory.getDefaultAlgorithm();<br/>     var tmf = TrustManagerFactory.getInstance(tmfAlgorithm);<br/>     tmf.init(keyStore);<br/>     console.log("[+] Our TrustManager is ready...");</span><span id="4665" class="nx mc iq nt b gy oc nz l oa ob">console.log("[+] Hijacking SSLContext methods now...")<br/>     console.log("[-] Waiting for the app to invoke SSLContext.init()...")</span><span id="2676" class="nx mc iq nt b gy oc nz l oa ob">SSLContext.init.overload("[Ljavax.net.ssl.KeyManager;", "[Ljavax.net.ssl.TrustManager;", "java.security.SecureRandom").implementation = function(a,b,c) {<br/>      console.log("[o] App invoked javax.net.ssl.SSLContext.init...");<br/>      SSLContext.init.overload("[Ljavax.net.ssl.KeyManager;", "[Ljavax.net.ssl.TrustManager;", "java.security.SecureRandom").call(this, a, tmf.getTrustManagers(), c);<br/>      console.log("[+] SSLContext initialized with our custom TrustManager!");<br/>     }<br/>    });<br/>},0);</span></pre></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="8999" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">3.设置和安装:</h1><p id="3537" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated"><strong class="ka ir">一、将设备连接到adb: </strong></p><p id="b670" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要将我们的设备连接到adb，以便在设备上运行命令。但首先转到<em class="lo">设置&gt; &gt;开发者选项</em>并启用设备中的调试模式，以便adb可以与设备通信。</p><p id="8086" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到提取平台工具的文件夹，运行以下命令将设备连接到adb</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="bd1f" class="nx mc iq nt b gy ny nz l oa ob">//adb connect &lt;ip of device:port&gt;<br/>adb connect 192.168.1.190:5555</span></pre><p id="d337" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果弹出窗口出现在设备中，请单击“允许”。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/051bd6395e9d4f005c3ef65f9d4a6d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAQcWV36trLxPMVR1jf3Wg.png"/></div></div></figure><p id="854d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要检查设备是否连接到adb:</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="7a8a" class="nx mc iq nt b gy ny nz l oa ob">adb devices</span></pre><p id="7053" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到您的设备的ip以及设备名称。</p><p id="ca03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">二。为支持的android设备的arch版本下载frida服务器:</strong> <br/>我们需要根据我们设备的arch版本为我们的android设备下载frida服务器包。</p><blockquote class="ng nh ni"><p id="f39c" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated"><a class="ae nf" href="https://github.com/frida/frida/releases/" rel="noopener ugc nofollow" target="_blank">https://github.com/frida/frida/releases/</a></p></blockquote><p id="e7ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要找出设备的arch版本，请运行以下命令。</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="edc4" class="nx mc iq nt b gy ny nz l oa ob">adb shell getprop ro.product.cpu.abi</span></pre><p id="5786" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果设备配置与上述相同，可缩短下载时间:</p><blockquote class="ng nh ni"><p id="7e26" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated">弗里达-服务器-12.4.7-android-x86.xz <br/>弗里达-服务器-12.4.7-android-x86_64.xz</p></blockquote><p id="90c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">四。在设备中安装目标应用程序。</strong></p><p id="062f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装您的应用程序谁的SSL pin必须在我们的设备绕过。打开应用程序，并让它在后台运行。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="c012" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">4.Frida服务器设置:</h1><p id="494e" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">在注入我们的脚本之前，我们需要在设备中运行frida服务器。请遵循以下步骤:</p><p id="56cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> I .将frida服务器推入设备:</strong></p><p id="7cfd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要把我们的frida服务器文件推进到设备中。提取并复制adb文件夹中的“<em class="lo">frida-server-12 . 4 . 7-Android-x86”</em>文件，将文件重命名为“Frida-server”。之后，运行以下命令。</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="9e31" class="nx mc iq nt b gy ny nz l oa ob">//adb push &lt;path_of_frida_server_folder&gt;&lt;space&gt;&lt;/data/local/tmp&gt;</span><span id="6192" class="nx mc iq nt b gy oc nz l oa ob">adb push C:\ADB\frida-server /data/local/tmp</span></pre><p id="0698" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">二。给弗里达服务器权限:</strong></p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="bfab" class="nx mc iq nt b gy ny nz l oa ob">adb shell chmod 777 /data/local/tmp/frida-server</span></pre></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="d600" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated"><strong class="ak"> 5。设置BurpSuite的:</strong></h1><p id="0c88" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">遵循这个令人敬畏的指南来为android设备设置代理:</p><blockquote class="ng nh ni"><p id="74a5" class="jy jz lo ka b kb kc kd ke kf kg kh ki nj kk kl km nk ko kp kq nl ks kt ku kv ij bi translated"><a class="ae nf" href="https://support.portswigger.net/customer/portal/articles/1841101-configuring-an-android-device-to-work-with-burp" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">https://support . portswigger . net/customer/portal/articles/1841101-configuring-an-Android-device-to-work-with-burp</strong></a></p></blockquote></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="cfde" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">6.推送代理的CA证书:</h1><p id="a2e3" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">为了能够<a class="ae nf" href="https://guidedhacking.com/register/" rel="noopener ugc nofollow" target="_blank">拦截流量</a>，frida需要访问我们Burpsuite的CA证书。我们将推送在步骤5中下载的相同证书。在BurpSuite设置中。</p><p id="165e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将证书放入设备，放入frida-server所在的位置，将其命名为<em class="lo"> cert-der.crt </em>(为了避免任何问题，这个名称和路径已经在fridascript.js中提到过)</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="85e0" class="nx mc iq nt b gy ny nz l oa ob">// adb push &lt;path to cacert.der&gt; /data/local/tmp/cert-der.crt<br/>adb push cacert.der /data/local/tmp/cert-der.crt</span></pre></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="c355" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated"><strong class="ak"> 7。绕过SSL固定的脚本注入:</strong></h1><p id="3020" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">现在是真正魔术的时候了。我们将把<strong class="ka ir"> 'fridascript.js' </strong>注入到目标应用中。</p><p id="ef17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">一、将fridascript.js推送到设备:</strong></p><p id="45fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将fridascript.js复制到adb文件夹中，并运行以下命令将fridascript.js推送到设备中。</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="d103" class="nx mc iq nt b gy ny nz l oa ob">//adb push &lt;path_to_fridascript.js_folder&gt; /data/local/tmp<br/>adb push C:\ADB\fridascript.js /data/local/tmp</span></pre><p id="0679" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">二。检查并运行设备</strong>中的frida服务器</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="226f" class="nx mc iq nt b gy ny nz l oa ob">adb shell /data/local/tmp/frida-server &amp;</span></pre><p id="340c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将在设备中运行frida-server。也许你不会在终端中得到这个命令的任何输出。</p><p id="1f57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">三。列出设备上所有正在运行的进程:</strong></p><p id="7bce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要找出我们的目标应用程序的id。我们将列出设备上所有正在运行的服务，包括您的应用程序流程。</p><p id="d41d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开新终端，键入以下命令。</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="2e4d" class="nx mc iq nt b gy ny nz l oa ob">frida-ps -U</span></pre><p id="3e19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">四。找到应用程序的包名。</strong></p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/a1a0b0b49bb0fa7c72a8d9796f0ea43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*kFQ8zBh9TT3jjqMUyN4KqQ.png"/></div></figure><p id="04d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> V .将fridascript.js挂钩到目标应用:</strong></p><p id="792d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们将使用以下命令将fridascript.js与本机应用程序挂钩:</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="344c" class="nx mc iq nt b gy ny nz l oa ob">//frida -U -f &lt;your_application_package_name&gt; -l &lt;path_to_fridascript.js_on_your_computer&gt; --no-paus</span><span id="3ad9" class="nx mc iq nt b gy oc nz l oa ob">frida -U -f com.twitter.android -l D:\frida\fridascript.js --no-paus</span></pre><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/0dd15b7eb6ee2d8b97228ac7af7e3bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twPxbDXLD64sYfXplq1q5g.png"/></div></div></figure><p id="ea8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">六。绕过了！！</strong></p><p id="5974" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦一切顺利，目标应用程序的所有流量都会被拦截到BurpSuite中。只要我们拦截进入BurpSuite的流量，我们就需要保持frida服务器的运行。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/947903ee029abd8564083c719c00eb5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jpMMcQedWy8Y4N4awj_-0w.png"/></div></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="d886" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">8.简而言之:</h1><p id="bd0e" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated"><strong class="ka ir"> 1。在genymotion <br/> 2上下载并安装设备。安装弗里达和异议工具</strong></p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="75a5" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">python -m pip install Frida<br/>python -m pip install frida-tools<br/>python -m pip install objection</strong></span><span id="e6cc" class="nx mc iq nt b gy oc nz l oa ob"><strong class="nt ir">or</strong></span><span id="7552" class="nx mc iq nt b gy oc nz l oa ob"><strong class="nt ir">pip install Frida<br/>pip install frida-tools<br/>pip install objection</strong></span></pre><p id="7438" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3。下载亚行平台工具<br/> 4。下载弗里达注射脚本<br/> 5。将设备连接到adb </strong></p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="729c" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">//adb connect &lt;ip of device:port&gt;</strong></span></pre><p id="cddf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 6。下载frida服务器的支持android设备的arch版本<br/> 7。找出设备的arch版本</strong></p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="02da" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">adb shell getprop ro.product.cpu.abi</strong></span></pre><p id="8f50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 8。在设备中安装目标应用程序。<br/> 9。将frida服务器推入设备:</strong></p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="0a1b" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">//adb push &lt;path of frida-server folder&gt;&lt;space&gt;&lt;/data/local/tmp&gt;</strong></span></pre><p id="ab89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 10。将权限授予弗里达服务器:</strong></p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="e39c" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">adb shell chmod 777 /data/local/tmp/frida-server</strong></span></pre><p id="895b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 11。设置burpsuite <br/> 12。推送代理的CA证书</strong></p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="1c19" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">// adb push &lt;path to cacert.der&gt; /data/local/tmp/cert-der.crt</strong></span></pre><p id="3f0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 13。将fridascript.js推入设备:</strong></p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="446f" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">//adb push &lt;path to fridascript.js folder&gt; /data/local/tmp</strong></span></pre><p id="5c9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">14。检查并运行设备中的frida服务器</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="6b6b" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">adb shell /data/local/tmp/frida-server &amp;</strong></span></pre><p id="3ba3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">15。列出设备上所有正在运行的进程:</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="3eb8" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">frida-ps -U</strong></span></pre><p id="edb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">16。找到应用程序的包名<br/> 17。将fridascript.js与目标应用程序挂钩</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="7cfe" class="nx mc iq nt b gy ny nz l oa ob"><strong class="nt ir">//frida -U -f &lt;your_application_package_name&gt; -l &lt;path_to_fridascript.js_on_your_computer&gt; --no-paus</strong></span></pre><p id="4efe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">18。在BurpSuite拦截交通。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="cf22" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">9.故障排除:</h1><p id="1252" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated"><strong class="ka ir"> 1。ADB守护程序无法连接</strong></p><p id="3422" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您遇到这样的错误:</p><pre class="nn no np nq gt ns nt nu nv aw nw bi"><span id="1c51" class="nx mc iq nt b gy ny nz l oa ob">adb devices<br/>adb server is out of date. killing...<br/>cannot bind 'tcp:5037'<br/>ADB server didn't ACK<br/>*failed to start daemon*<br/>error:</span></pre><p id="279e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一、开放环境系统属性&gt; &gt;高级&gt; &gt;环境变量<br/> ii。点击路径，删除C:/Android或adb工具指向的路径的条目<br/> iii。将所有平台工具复制到genymotion&gt;tools文件夹<br/> iv中。创建新路径，并将路径添加到genymotion &gt; &gt;工具文件夹中。</p><p id="c47a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2。frida/ pip不被识别为内部或外部命令</strong> <br/>一.开放环境系统属性&gt; &gt;高级&gt; &gt;环境变量<br/>二.创建新路径并添加Python &gt; &gt;脚本文件夹的路径</p><p id="32a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3。将应用程序安装到设备时出现Arm转换错误。</strong></p><p id="e2bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一.从这里下载arm翻译文件<br/><a class="ae nf" href="https://androidfilehost.com/?fid=23252070760974384" rel="noopener ugc nofollow" target="_blank">【https://androidfilehost.com/?fid=23252070760974384】T42</a><br/>二.如果使用物理设备<br/> iii，将文件拖放到设备仿真器或从恢复中刷新该文件。重新启动设备，您将能够拖放安装目标应用程序</p><p id="e2f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 4。无法生成:生成Android应用程序时不支持“argv”选项</strong></p><p id="eacc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查计算机上的fridascript.js路径。路径可能不正确。您必须给出fridascript.js文件的绝对路径。<a class="ae nf" href="https://www.computerhope.com/issues/ch001708.htm" rel="noopener ugc nofollow" target="_blank">绝对路径？</a></p><p id="c29c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 5。已启动frida服务器，但无法列出服务</strong></p><p id="353d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">断开并重新连接设备中的wifi。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/299fb58e31cbf2affc4bd258e9aece68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*K2wHwYDnwVqrHzSyUhBf5w.jpeg"/></div></figure><p id="c45b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢阅读这篇文章。你真棒！！如果您遇到任何问题，请在评论中告诉我，我会努力解决并添加到故障排除部分。掌声感谢！！😄</p></div></div>    
</body>
</html>