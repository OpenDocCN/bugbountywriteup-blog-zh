<html>
<head>
<title>SSRF leads to access AWS metadata.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SSRF导致访问AWS元数据。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/ssrf-leads-to-access-aws-metadata-21952c220aeb?source=collection_archive---------0-----------------------#2022-08-27">https://infosecwriteups.com/ssrf-leads-to-access-aws-metadata-21952c220aeb?source=collection_archive---------0-----------------------#2022-08-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9ffacc8a739c353938ca06434253e362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xrVRJWHHSlANh_lg"/></div></div></figure><p id="ade1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi kw translated"><span class="l kx ky kz bm la lb lc ld le di">你好</span> <strong class="ka ir">队友们</strong>，我是来自印度的阿卡什·帕蒂尔(@skypatil98)。在过去的两年半里，我一直在昆虫赏金领域工作。我之前的博客都是关于<a class="ae lf" href="https://skypatil.medium.com/idor-leads-to-change-the-password-of-all-users-ato-b598f610a009" rel="noopener"> <strong class="ka ir"> IDOR导致所有用户</strong><strong class="ka ir">【ATO】</strong></a>修改密码的，这是我在一个私人程序上发现的。如果你还没有看过那个博客，你可以点击这个<a class="ae lf" href="https://skypatil.medium.com/idor-leads-to-change-the-password-of-all-users-ato-b598f610a009" rel="noopener">链接来阅读。如果有任何语法错误，请留下来。不浪费任何时间，我们将从这篇文章开始。</a></p><p id="ab37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">那么让我们开始吧！😉</strong></p><h1 id="ae70" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">什么是SSRF？</h1><p id="086f" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">在服务器端请求伪造(SSRF)攻击中，攻击者可以诱导服务器上的功能读取或更新内部资源。攻击者可以读取服务器配置(如AWS元数据),连接到内部服务(如启用http的数据库),或者对不打算公开的内部服务执行post请求。了解更多关于SSRF的信息。</p><blockquote class="mj mk ml"><p id="b735" class="jy jz mm ka b kb kc kd ke kf kg kh ki mn kk kl km mo ko kp kq mp ks kt ku kv ij bi translated"><em class="iq">我们先把目标当成</em> <code class="fe mq mr ms mt b"><em class="iq">reducted.com</em></code> <em class="iq">因为我不能透露节目名称。</em></p></blockquote><p id="93bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我检查了burp http历史上的每个请求，因此我使用Burp Search来查找可能的参数，</p><pre class="mu mv mw mx gt my mt mz na aw nb bi"><span id="b478" class="nc lh iq mt b gy nd ne l nf ng">url={target}<br/>file={target}<br/>filename={target}<br/><a class="ae lf" href="https://github.com/lutfumertceylan/top25-parameter/blob/master/ssrf-parameters.txt" rel="noopener ugc nofollow" target="_blank"><strong class="mt ir">top 25 params</strong></a></span></pre><p id="a615" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且找到了一个长这样的<strong class="ka ir"> url= </strong>。</p><p id="8c91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mq mr ms mt b"><em class="mm">reducted.com/gadgets/proxy/?url=</em></code></p><h1 id="cf58" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">1)尝试打开重定向</h1><p id="dbda" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">这个网址就像https://reducted.com/gadgets/proxy/?url=https://evil.com的</p><p id="4dcd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是失败了:(它抛出了一个错误</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/f35b1c08402e27e4b140d3526f358da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSAPWAzVHVF5c0VCz-ObeQ.jpeg"/></div></div></figure><h1 id="bd89" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">2)为XSS尝试</h1><p id="1fdd" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">网址是这样的</p><p id="a8c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lf" href="https://reducted.com/viewimage/?url=javascript:alert(1);" rel="noopener ugc nofollow" target="_blank"/><a class="ae lf" href="https://reducted.com/gadgets/proxy?url=?url=https://evil.com" rel="noopener ugc nofollow" target="_blank">/小工具/代理</a> / <a class="ae lf" href="https://reducted.com/viewimage/?url=javascript:alert(1);" rel="noopener ugc nofollow" target="_blank">？URL = JavaScript:alert(1)；</a></p><p id="eff8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lf" href="https://reducted.com/viewimage/?url=http://14.rs" rel="noopener ugc nofollow" target="_blank"/><a class="ae lf" href="https://reducted.com/gadgets/proxy?url=?url=https://evil.com" rel="noopener ugc nofollow" target="_blank">/小工具/代理</a> / <a class="ae lf" href="https://reducted.com/viewimage/?url=http://14.rs" rel="noopener ugc nofollow" target="_blank">？url=http://14.rs </a></p><p id="7395" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lf" href="https://reducted.com/viewimage/?url=http://brutelogic.com.br/poc.svg" rel="noopener ugc nofollow" target="_blank"/><a class="ae lf" href="https://reducted.com/gadgets/proxy?url=?url=https://evil.com" rel="noopener ugc nofollow" target="_blank">/小工具/代理</a> <a class="ae lf" href="https://reducted.com/viewimage/?url=http://brutelogic.com.br/poc.svg" rel="noopener ugc nofollow" target="_blank">？URL = http://brute logic . com . br/POC . SVG</a></p><p id="b571" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是失败了:(</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/4b92c1326ac39067e4b31325b1619f31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPMsq0RDQNIDZG3Bat_CwA.jpeg"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">它抛出一个不允许的错误方法</figcaption></figure><h1 id="05bd" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">3)为LFI尝试</h1><p id="97e1" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">网址好像是<a class="ae lf" href="https://reducted.com/viewimage/?url=file:///etc/passwd" rel="noopener ugc nofollow" target="_blank">https://reducted.com/gadgets/proxy/?url=file:///etc/passwd</a></p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/591f8479836c3d8c372ad0aaf944dd99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFlp00VlZ3B8xyAyrIiOlg.jpeg"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">但是失败了<strong class="bd li"> :( </strong>错误url模式只有HTTP或HTTPS。</figcaption></figure><p id="9a8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我尝试了URL模式来读取内部，并让服务器执行这些操作[ <code class="fe mq mr ms mt b">file:///</code>、<code class="fe mq mr ms mt b">dict://</code>、<code class="fe mq mr ms mt b">ftp://</code>、<code class="fe mq mr ms mt b">gopher://</code>，但是<strong class="ka ir">:(失败！</strong></p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/4f0ed9dc0822e51b1dee82c9938d9375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDQH-LluT3bbmFBOOvqGlA.jpeg"/></div></div></figure><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/91b76704d702a18527194f5d59c0aae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rGXv17aGeal_Ai5r7kw-sQ.jpeg"/></div></div></figure><p id="7c37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我访问了这个网址，但是它没有加载内容，一个简单的文本文件被反射和下载，里面什么也没有。</p><ul class=""><li id="4ea2" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated"><strong class="ka ir">读取AWS元数据</strong></li></ul><p id="8772" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在做了很多其他事情后，我没有得到任何结果，所以我记得AWS的神奇IP只是为了试一试，我用下面的IP替换了URL参数，这是AWS使用的神奇IP。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e07dc3aa485f08bd649dcb8781251c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*byO9YhE7UxDgct_vuYEZMw.png"/></div></figure><p id="7ed2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像这样创建URL:</p><pre class="mu mv mw mx gt my mt mz na aw nb bi"><span id="5767" class="nc lh iq mt b gy nd ne l nf ng"><a class="ae lf" href="https://reducted.com/viewimage/?url=file:///etc/passwd" rel="noopener ugc nofollow" target="_blank">https://reducted.com/gadgets/proxy/?url=</a><a class="ae lf" href="http://169.254.169.254/latest/meta-data" rel="noopener ugc nofollow" target="_blank">http://169.254.169.254/latest/meta-data</a></span></pre><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/6883a580b3cab73f1f82e677f4266d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8LpcwywtcZsBbNvZcdWnxA.jpeg"/></div></div></figure><p id="6e54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这下载了一个<code class="fe mq mr ms mt b">reducted.txt</code>文件，打开它显示如下信息</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/2ed9d0fed588dae8d04779d89fd1e5a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aeC7dLUTVJr6Ktko5LOsOQ.jpeg"/></div></div></figure><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/d414df1b5c9bf0a934cbce2c79f42aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-5tBYnXwDzbQ4I8BUL0vA.jpeg"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">AWS元数据</figcaption></figure><h1 id="99c0" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">缓解措施:</h1><ol class=""><li id="f2bf" class="nm nn iq ka b kb me kf mf kj nx kn ny kr nz kv oa ns nt nu bi translated">白名单和DNS解析</li><li id="6b8e" class="nm nn iq ka b kb ob kf oc kj od kn oe kr of kv oa ns nt nu bi translated">输入验证</li><li id="0f56" class="nm nn iq ka b kb ob kf oc kj od kn oe kr of kv oa ns nt nu bi translated">响应处理</li><li id="9798" class="nm nn iq ka b kb ob kf oc kj od kn oe kr of kv oa ns nt nu bi translated">禁用未使用的URL模式</li><li id="f096" class="nm nn iq ka b kb ob kf oc kj od kn oe kr of kv oa ns nt nu bi translated">内部服务认证</li></ol><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/130c284b454802b00f2f3ad479b9dd6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*lp3SbVpcYmR2AM9wU2FFkg.jpeg"/></div></figure><p id="721b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看到悬赏金额后，我就想..<strong class="ka ir">😭😭😭😭😭</strong></p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/0695728bdd31ec95cf91d014ecc31429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*PEPp2H0Hp4LWTffGBFpNDg.gif"/></div></figure><p id="bb45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">参考文献:</strong></p><ul class=""><li id="c7ff" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated"><a class="ae lf" href="https://hackerone.com/reports/53088" rel="noopener ugc nofollow" target="_blank">https://hackerone.com/reports/53088</a></li><li id="5b53" class="nm nn iq ka b kb ob kf oc kj od kn oe kr of kv nr ns nt nu bi translated"><a class="ae lf" href="https://sanderwind.medium.com/escalating-ssrf-to-rce-7c0147371c40" rel="noopener">https://sanderwind . medium . com/upgrading-ssrf-to-rce-7c 0147371 c 40</a></li><li id="cdbb" class="nm nn iq ka b kb ob kf oc kj od kn oe kr of kv nr ns nt nu bi translated"><a class="ae lf" href="https://medium.com/@briskinfosec/ssrf-server-side-request-forgery-ae44ec737cb8" rel="noopener">https://medium . com/@ briskinfosec/ssrf-server-side-request-foregraphy-AE 44 EC 737 CB 8</a></li><li id="ed18" class="nm nn iq ka b kb ob kf oc kj od kn oe kr of kv nr ns nt nu bi translated"><a class="ae lf" href="https://medium.com/geekculture/ssrf-vulnerability-from-a-developers-perspective-3d1562f29c7c" rel="noopener">https://medium . com/geek culture/ssrf-vulnerability-from-a-developers-perspective-3d 1562 f 29 c7c</a></li><li id="6305" class="nm nn iq ka b kb ob kf oc kj od kn oe kr of kv nr ns nt nu bi translated"><a class="ae lf" href="https://corneacristian.medium.com/top-25-server-side-request-forgery-ssrf-bug-bounty-reports-136928356eca" rel="noopener">https://corneacristian . medium . com/top-25-server-side-request-foregraphy-ssrf-bug-bounty-reports-136928356 ECA</a></li></ul><p id="892e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢阅读。如果你有任何问题，你可以在<a class="ae lf" href="https://twitter.com/skypatil98" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">推特</strong> </a>上给我发短信😊</p></div><div class="ab cl oi oj hu ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ij ik il im in"><p id="ee02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mm">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae lf" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="mm">加入我们的每周简讯</em> </strong> </a> <em class="mm">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>