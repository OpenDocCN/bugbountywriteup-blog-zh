<html>
<head>
<title>S3 Bucket Misconfiguration in Amazon</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亚马逊的S3桶配置错误</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/s3-bucket-misconfiguration-in-amazon-a7da6a6e02ea?source=collection_archive---------1-----------------------#2018-08-11">https://infosecwriteups.com/s3-bucket-misconfiguration-in-amazon-a7da6a6e02ea?source=collection_archive---------1-----------------------#2018-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="379c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">描述</strong></h2></div><h2 id="4a8e" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">概要:</strong></h2><p id="e93a" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">在试图访问<a class="ae lu" href="https://www.amazon.in/" rel="noopener ugc nofollow" target="_blank"><strong class="ld ir">https://www . Amazon . in</strong></a><strong class="ld ir"/>上的一个联系人美国页面时，我发现了一个错误配置的s3存储桶。在这个场景中，s3存储桶的错误配置允许任何用户向S3存储桶上传和删除任何文件:<a class="ae lu" href="https://bbcomm-mgr-ui-attachments-eu.s3.amazonaws.com/login.html" rel="noopener ugc nofollow" target="_blank">https://bbcomm-mgr-ui-attachments-eu.s3.amazonaws.com</a></p><blockquote class="lv lw lx"><p id="38c5" class="lb lc ly ld b le lz jr lg lh ma ju lj mb mc ll lm md me lo lp mf mg lr ls lt ij bi translated">在寻找联系客户服务时，我看到页面有上传功能，所以为什么不尝试上传一些php外壳。打开我的打嗝拦截器，试图绕过文件上传。它允许png，jpeg和gif格式。但每次我试图上传，它显示错误的反应，但后来我启动蜘蛛找出任何其他网页链接到这个网页。我看到有一个s3存储桶与我试图上传的文件相同。复制链接后，我可以下载我的文件。哇啊！我能够找到配置错误的亚马逊桶。客户经理可以从这个桶中下载发送给他们的附件。当你向零售商询问发票收据时，你可以附上图片、pdf等。附件被上传到s3存储桶。</p></blockquote><h2 id="591b" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">目标:</strong></h2><p id="ede0" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated"><a class="ae lu" href="https://bbcomm-mgr-ui-attachments-eu.s3.amazonaws.com/login.html" rel="noopener ugc nofollow" target="_blank">https://bbcomm-mgr-ui-attachments-eu.s3.amazonaws.com</a></p><h2 id="7ee7" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">概念验证</strong></h2><p id="1c40" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">1) <strong class="ld ir"> </strong>访问网址:<br/><a class="ae lu" href="https://bbcomm-mgr-ui-attachments-eu.s3.amazonaws.com/login2.html" rel="noopener ugc nofollow" target="_blank">https://bbcomm-mgr-ui-attachments-eu . S3 . Amazon AWS . com/login 2 . html</a></p><p id="c3ab" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated">2)尝试在桶中写入和删除文件:</p><p id="2038" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated">a)书写命令:<br/>使用卷曲书写index.html</p><p id="4232" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated">curl -XPUT -d '  <h1>上传由just morpheus' '<a class="ae lu" href="https://bbcomm-mgr-ui-attachments-eu.s3.amazonaws.com/index.html" rel="noopener ugc nofollow" target="_blank">https://bbcomm-mgr-ui-attachments-eu.s3.amazonaws.com/index.html</a></h1></p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mh"><img src="../Images/517bae12f4cd480dc9f0c206fa5e0196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XA-dCXox3oOGa1Ip64EVTA.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">index.html</figcaption></figure><p id="d518" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated">b)使用AWS CLI: <br/>移动和复制命令:</p><ol class=""><li id="a235" class="mx my iq ld b le lz lh ma ko mz ks na kw nb lt nc nd ne nf bi translated">AWS S3 mv login.html S3://bbcomm-mgr-ui-attachments-eu-grants read = uri =<a class="ae lu" href="http://acs.amazonaws.com/groups/global/AllUsers" rel="noopener ugc nofollow" target="_blank">http://acs.amazonaws.com/groups/global/AllUsers</a></li></ol><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ng"><img src="../Images/6bc26dbd6bce896e2b11a77f1847932a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8wWFcul3CynGO0jitt4K7A.png"/></div></div></figure><ol class=""><li id="b6c4" class="mx my iq ld b le lz lh ma ko mz ks na kw nb lt nc nd ne nf bi translated">AWS S3 CP login2.html S3://bbcomm-mgr-ui-attachments-eu-grants read = uri =<a class="ae lu" href="http://acs.amazonaws.com/groups/global/AllUsers" rel="noopener ugc nofollow" target="_blank">http://acs.amazonaws.com/groups/global/AllUsers</a></li></ol><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nh"><img src="../Images/43f13372b45c84dabde5e54792f71373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YzaKgMbbtCEAHyHyWrDRWA.png"/></div></div></figure><p id="6837" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated">删除命令:</p><ol class=""><li id="5b91" class="mx my iq ld b le lz lh ma ko mz ks na kw nb lt nc nd ne nf bi translated">AWS S3 RM S3://bbcomm-mgr-ui-attachments-eu/log in . html</li><li id="8beb" class="mx my iq ld b le ni lh nj ko nk ks nl kw nm lt nc nd ne nf bi translated">AWS S3 RM S3://bbcomm-mgr-ui-attachments-eu/index . html</li></ol><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nn"><img src="../Images/decc974ff62f99f278280e74b9410c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BeWT1tMNO37CW7v5BjwNKA.png"/></div></div></figure><p id="c4c2" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated"><strong class="ld ir">结果:</strong> <br/>我们现在拥有对an Amazon.in存储桶的完全写/执行权限。<br/>还尝试使用dirbuster强行打开目录，发现了一个文件夹。<br/>可用于下载机密文件，也可用于网络钓鱼。</p><h2 id="a468" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">解决方案:</strong></h2><p id="ed5b" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">不要允许任何人进行完全的读/写/执行访问。<br/>见文档:<a class="ae lu" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-overview.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Amazon S3/latest/dev/access-control-overview . html</a></p><h2 id="599d" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">参考与感谢:</strong></h2><p id="8cc9" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated"><a class="ae lu" href="https://blog.detectify.com/2017/07/13/aws-s3-misconfiguration-explained-fix/" rel="noopener ugc nofollow" target="_blank">https://blog . detect ify . com/2017/07/13/AWS-S3-错误配置-解释-fix/</a><br/><a class="ae lu" href="https://medium.com/@jonathanbouman/how-i-hacked-apple-com-unrestricted-file-upload-bcda047e27e3" rel="noopener">https://medium . com/@ jonathanbouman/how-I-hacked-apple-com-unrestricted-file-upload-bcda 047 e 27 e 3</a></p><p id="63d5" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated">特别提及@kunal_mahar —信息安全分析师。</p><h2 id="ad10" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">时间线:</strong></h2><p id="8b7a" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">2018年10月7日:发现并向亚马逊举报。<br/>2018年10月7日:已确认Bug并已分配案例id。2018年3月8日:亚马逊安全团队修复了一个错误。<br/>2018年12月8日:发布概念验证。</p><p id="93b6" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated">PS:亚马逊没有名人堂或奖励，因为它在协调披露政策下工作</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><a href="https://www.buymeacoffee.com/justmorpheus"><div class="gh gi no"><img src="../Images/4bc5de35955c00939383a18fb66b41d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*9vg3-OY14aZN1UpKwIxxZg.png"/></div></a></figure></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><p id="ec6f" class="pw-post-body-paragraph lb lc iq ld b le lz jr lg lh ma ju lj ko mc ll lm ks me lo lp kw mg lr ls lt ij bi translated"><em class="ly">关注</em> <a class="ae lu" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="ly"> Infosec报道</em> </a> <em class="ly">获取更多此类精彩报道。</em></p><div class="nw nx gp gr ny nz"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">信息安全报道</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on mr nz"/></div></div></a></div></div></div>    
</body>
</html>