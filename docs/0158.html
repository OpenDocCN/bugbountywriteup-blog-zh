<html>
<head>
<title>Pimp My Shell — 5 Ways to Upgrade a Netcat Shell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">给我的Shell拉皮条——升级Netcat Shell的5种方法</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/pimp-my-shell-5-ways-to-upgrade-a-netcat-shell-ecd551a180d2?source=collection_archive---------0-----------------------#2018-09-07">https://infosecwriteups.com/pimp-my-shell-5-ways-to-upgrade-a-netcat-shell-ecd551a180d2?source=collection_archive---------0-----------------------#2018-09-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/aec5ed98a121752193ffce36a53ba30e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*V5k7BJLMSP6fhpWFitdpVQ.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">斗争是真实的</figcaption></figure><p id="19cc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">每当我用<a class="ae la" href="http://sectools.org/tool/netcat/" rel="noopener ugc nofollow" target="_blank"> netcat </a>捕捉到一个反向shell时，尽管我最初很兴奋，但当我想起这些shell往往有多么可怕的局限性时，我的热情很快就消失了。因此，我决定编译一个有用的命令列表，让这些shells更加可用。希望在阅读完本文后，您能够像ssh连接一样轻松地在反向shells中导航。</p><h1 id="188d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.用Python繁殖TTY</h1><p id="fdb9" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">这可能是您对netcat shell所能做出的最大改进。PTY 是一个伪终端功能库，是标准Python库的一部分。如果远程系统安装了python，那么您在一行代码中就得到了一个伪终端:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2d86" class="mn lc iq mj b gy mo mp l mq mr">python -c ‘import pty;pty.spawn(“/bin/bash”)’</span></pre><p id="082f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">与运行<code class="fe ms mt mu mj b">bash -i</code>不同，PTY让您能够运行像<code class="fe ms mt mu mj b">su</code>这样的命令来登录其他本地帐户，或者运行<code class="fe ms mt mu mj b">ssh</code>来登录其他主机。</p><p id="d428" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Pelebus为生成交互式bash进程的其他方法列出了一个很棒的一行程序列表。然而，其中一些方法可能无法整合我们将在后续步骤中添加的一些功能。</p><h1 id="e106" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.带STTY的制表符结束</h1><p id="0970" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">每当我试图键入长文件路径或避免键入错误的文件名时，这是一个很好的功能，但我却错过了。然而，这涉及到几个步骤，我通常最终不得不翻遍笔记来找到它们。</p><p id="a19c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您还没有伪终端功能，这可能会有点混乱。如果您无法执行第1步中的python命令，请自担风险。</p><p id="9ff0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，键入以下命令作为netcat shell的背景:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5a3a" class="mn lc iq mj b gy mo mp l mq mr">Ctrl+z</span></pre><p id="e3b9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这会显得你好像失去了你的外壳。放心吧！我们会拿回来的。接下来，在本地shell中键入:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c19a" class="mn lc iq mj b gy mo mp l mq mr">stty raw -echo</span></pre><p id="af7c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，通过键入以下命令在前台显示netcat shell:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ea6a" class="mn lc iq mj b gy mo mp l mq mr">fg + [Enter x 2]</span></pre><p id="4106" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这应该会返回带有制表符自动完成的shell！</p><h1 id="fe26" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">3.保持清洁；清空屏幕</h1><p id="89de" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">有时候，能够从头开始工作并清除终端中的所有杂物是件好事。要在netcat shell中做到这一点，我们必须运行两个命令。</p><p id="a4e1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在本地计算机的shell中，键入:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="273c" class="mn lc iq mj b gy mo mp l mq mr">echo $TERM</span></pre><p id="c266" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您应该得到一些输出作为响应。根据您的系统设置，此输出可能会有所不同(<code class="fe ms mt mu mj b">screen</code>、<code class="fe ms mt mu mj b">xterm</code>等)。在Kali Linux上默认情况下，<code class="fe ms mt mu mj b">$TERM</code>被设置为<code class="fe ms mt mu mj b">screen</code>。</p><p id="b110" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在netcat shell类型中:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4d51" class="mn lc iq mj b gy mo mp l mq mr">export TERM=screen</span></pre><p id="71a3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在你可以清空你的屏幕了！</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h2 id="b8d1" class="mn lc iq bd ld nc nd dn lh ne nf dp ll kn ng nh lp kr ni nj lt kv nk nl lx nm bi translated">重新初始化终端(可选)</h2><p id="6f44" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">回到netcat shell，我们可以通过键入以下命令来重新初始化终端:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e7b5" class="mn lc iq mj b gy mo mp l mq mr">reset</span></pre><p id="d7c3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您应该得到一个提示，询问您<code class="fe ms mt mu mj b">"Terminal Type?"</code>这是您输入<code class="fe ms mt mu mj b">echo $TERM</code>命令输出的地方。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="c157" class="lb lc iq bd ld le nn lg lh li no lk ll lm np lo lp lq nq ls lt lu nr lw lx ly bi translated">4.历史课</h1><p id="e11e" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">我们当中有谁没有轻微地输入了一个很长的命令，并希望您可以通过按下向上箭头来返回该命令？现在你可以了！</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a054" class="mn lc iq mj b gy mo mp l mq mr">export SHELL=bash</span></pre><p id="571e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">就是这样！</p><h1 id="f9dd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">5.宽屏幕</h1><p id="7d3e" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">有时，当您在默认的netcat shell中键入一个很长的单行程序时，您用完了该行的空间，文本开始换行并覆盖自身。太可怕了。我们不需要那个。</p><p id="1492" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要查看本地计算机的大小，请键入:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c714" class="mn lc iq mj b gy mo mp l mq mr">stty size</span></pre><p id="b596" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将返回两个数字(行、列)。</p><p id="ee60" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要使netcat终端更大(比如说100 x 100)，设置rows和cols变量，如下所示:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5f73" class="mn lc iq mj b gy mo mp l mq mr">stty rows 100 cols 100</span></pre><h1 id="ea4f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">额外资源</h1><p id="2677" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">如果您对向netcat shells添加功能的其他方法感兴趣，或者只是想深入了解这个主题，下面是一些我认为有用的资源:</p><ul class=""><li id="90a5" class="ns nt iq ke b kf kg kj kk kn nu kr nv kv nw kz nx ny nz oa bi translated">https://netsec.ws/?p=337<a class="ae la" href="https://netsec.ws/?p=337" rel="noopener ugc nofollow" target="_blank"/></li><li id="6423" class="ns nt iq ke b kf ob kj oc kn od kr oe kv of kz nx ny nz oa bi translated"><a class="ae la" href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty" rel="noopener ugc nofollow" target="_blank">http://pentest monkey . net/blog/post-exploration-without-a-tty</a></li><li id="9e1d" class="ns nt iq ke b kf ob kj oc kn od kr oe kv of kz nx ny nz oa bi translated"><a class="ae la" href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/" rel="noopener ugc nofollow" target="_blank">https://blog . ROP nop . com/upgrading-simple-shell-to-full-interactive-ttys/</a></li></ul></div></div>    
</body>
</html>