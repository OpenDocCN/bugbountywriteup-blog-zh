<html>
<head>
<title>Threat Modelling Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">威胁建模无服务器</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/threat-modelling-serverless-b8021f37f1ef?source=collection_archive---------0-----------------------#2019-05-08">https://infosecwriteups.com/threat-modelling-serverless-b8021f37f1ef?source=collection_archive---------0-----------------------#2019-05-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e40f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前几天我和我的同事<a class="ae kl" href="https://twitter.com/nebrius" rel="noopener ugc nofollow" target="_blank">布赖恩·休斯</a>会面，讨论他为JSConf EU开发的<strong class="jp ir">无服务器应用</strong>的安全性(关于他的开发不会有剧透，别担心)。我们曾在一起出差时讨论过威胁建模的想法，他想尝试一下。由于<a class="ae kl" href="https://twitter.com/_nu11p0inter" rel="noopener ugc nofollow" target="_blank">塔尔·梅拉梅德</a>把我拉进了<a class="ae kl" href="https://www.owasp.org/index.php/OWASP_Serverless_Top_10_Project" rel="noopener ugc nofollow" target="_blank"> OWASP无服务器十大项目</a>，我最近对无服务器应用特别好奇，所以我很兴奋有机会潜入这个兔子洞。</p><p id="c617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">布莱恩的应用架构:</p><ul class=""><li id="8a68" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated"><a class="ae kl" href="https://azure.microsoft.com/services/functions/?WT.mc_id=azuremedium-blog-tajanca" rel="noopener ugc nofollow" target="_blank"> Azure Functions App </a> (MSFT无服务器)</li><li id="e18c" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">JWT代币为Auth，它们将是短命的</li><li id="8b2e" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">他的应用程序将允许其他Azure用户调用它，并带有参数，它将做一些令人兴奋的事情(见？不剧透！)</li></ul><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/9320df64ee52c8d52cb1dafdf766d60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UB7V402AJQc0r1bHYjJdfQ.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">布赖恩·休斯、南韩、非军事区</figcaption></figure><p id="746a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦布莱恩解释了他的应用程序将会做什么，他告诉我他的安全顾虑:谁能访问他的应用程序？他们能进入他的Azure订阅的其他领域吗？他应该使用哪种类型的认证令牌呢？他将如何处理会话管理？所有这些绝对是合理的担忧，我印象深刻！</p><p id="309d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们讨论了他关心的每一个问题，以及减轻每一个风险的可能的技术解决方案。例如，只使用JWTs来发送随机的会话令牌值，从不发送密码或敏感数据，也从不发送实际上与重要内容相对应的数字，比如使用某人的SIN号作为他们的会话ID号，这是敏感信息和不安全的直接对象引用。我提醒他，jwt是编码的，不是加密的，因此它们不是传输数据的安全方式。还有，我建议他围绕这个应用(防火墙)创建一个<a class="ae kl" href="https://docs.microsoft.com/azure/virtual-network/security-overview?WT.mc_id=azuremedium-blog-tajanca" rel="noopener ugc nofollow" target="_blank">虚拟网络</a>，以防有人进入，这将意味着他们无法进入他的网络和订阅的其余部分。</p><p id="6a34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意</strong> : <a class="ae kl" href="https://tools.ietf.org/html/rfc7516" rel="noopener ugc nofollow" target="_blank"> RFC 7516 </a>允许加密JWT令牌，点击链接了解更多信息。</p><p id="6d27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们谈论了我的担忧，开始是一堆关于Bryan的用户和数据的问题。</p><ul class=""><li id="6e1d" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">你想从你的用户那里得到什么数据？有什么敏感的吗？</li></ul><p id="72fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他要求他们的GitHub信息，这样他就可以让他们访问他的无服务器应用程序，这样他就可以授予他们访问权限，但仅此而已。这一条数据是<em class="lq">敏感</em>信息。</p><ul class=""><li id="03d4" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">你的用户是谁？他们使用你的应用的动机是什么？</li></ul><p id="40a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些用户是与会者，他们想学习如何调用像API这样的无服务器应用程序，然后让他的应用程序做它会做的很酷的事情。这是一个学习的机会，而且很有趣。</p><ul class=""><li id="fb96" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">让我们假设你有一个恶意用户，他们如何攻击你的应用程序？</li></ul><p id="1b13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先担心的是拒绝服务或暴力式攻击。为了避免这些攻击媒介，他应该遵循<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-best-practices?WT.mc_id=azuremedium-blog-tajanca" rel="noopener ugc nofollow" target="_blank"> Azure Functions最佳实践指南，</a>具体来说，他应该将maxConcurrentRequests设置为一个较小的数字(以避免分布式拒绝服务)，通过启用“dynamicThrottlesEnabled”标志来添加节流(将请求减慢到一个合理的速度，这将停止脚本攻击)，并且理想情况下还应该为maxOutstandingRequests设置一个较小的数字，以确保没有人溢出他的请求缓冲区，这也将导致拒绝服务。(注意这是CIA:可用性中的“A”)</p><p id="f2ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我担心的其他攻击是有人发送格式错误的请求，试图从他的应用程序中引出意外行为，如崩溃、删除或修改数据，允许用户注入他们自己的代码或其他潜在问题。我们讨论了使用白名单进行用户输入验证，并拒绝所有格式不正确的请求，或者包含任何不是“a-z，A-Z，0–9”的字符的请求。(注意这是对完整性和可用性的攻击)</p><p id="3050" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在这里列出的最后一个攻击媒介是用户可能试图访问数据本身，即所有其他用户的订阅id(机密性)。这是这个列表中最重要的风险，因为你是这些数据的守护者，如果你丢失了这些数据，并且他们因此被成功攻击，这可能会导致灾难性的声誉损害(对会议，对他作为应用程序的创造者，对他的雇主微软)。当我解释这一点时，确保他的用户及其数据在使用他的系统期间和之后得到保护成了他的首要任务。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lr"><img src="../Images/d5b2a43824ed0eb5ff1d387e40dea0cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5PnvqXgywmEjrZjkVW_j9w.jpeg"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">Tanya Janca，韩国，非军事区，2019年</figcaption></figure><ul class=""><li id="c016" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">您将这些数据保留多长时间？你把它存放在哪里？你是怎么储存的？</li></ul><p id="45e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最初Bryan希望避免一起使用数据库；没有数据收集意味着没有东西可偷。尽管他仍在研究这是否有可能，但目前他的计划是使用数据库。</p><p id="8860" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他决定将这些数据保存到会议结束后，然后全部销毁(因此这种风险只有48小时)。它将存储在数据库中(我们讨论了静态和传输中的加密，以及总是使用参数化查询，并为调用这些查询的数据库用户应用最小特权(可能是只读的或读/写的，但不是DBO)。</p><ul class=""><li id="d46e" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">这个会议在哪个国家举行？你会服从GDPR吗？</li></ul><p id="baec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将在欧洲，因此受GDPR。我把他介绍给了Miriam Wiesner，她是MSFT的一名员工，有着测试和安全评估的背景，碰巧住在欧盟，因此应该很熟悉。我说她会比我有更好的建议。</p><p id="7e2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谈话持续了大约一个小时，但我想你已经明白了。</p><p id="bf77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无服务器的关键是要记住，几乎所有相同的web应用程序漏洞仍然适用，如注入或拒绝服务(DOS)攻击，仅仅因为没有涉及服务器，并不意味着您不需要关注您的应用程序的安全性。</p><p id="68c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想跟上布赖恩·休斯，看看他的项目成果，你可以在<a class="ae kl" href="https://dev.to/nebrius" rel="noopener ugc nofollow" target="_blank"> Dev上关注他。到</a>。</p><p id="a261" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这个非正式的威胁模型对你有所帮助。</p><h1 id="03ca" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated"><strong class="ak">欲了解更多，请查看我的书，</strong> <a class="ae kl" href="https://aliceandboblearn.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">爱丽丝和鲍勃学习应用安全</strong> </a> <strong class="ak">和我的在线培训学院，</strong> <a class="ae kl" href="https://academy.wehackpurple.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">我们黑紫色</strong> </a> <strong class="ak">！</strong></h1><h2 id="ce69" class="mq lt iq bd lu mr ms dn ly mt mu dp mc jy mv mw mg kc mx my mk kg mz na mo nb bi translated">我有一个邮件列表，请订阅，这是免费的！</h2></div></div>    
</body>
</html>