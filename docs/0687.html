<html>
<head>
<title>Exploiting Imported Libraries to Bypass WAF</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用导入的库绕过WAF</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-imported-libraries-to-bypass-cloudflare-waf-7aed99186c5a?source=collection_archive---------2-----------------------#2020-07-14">https://infosecwriteups.com/exploiting-imported-libraries-to-bypass-cloudflare-waf-7aed99186c5a?source=collection_archive---------2-----------------------#2020-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e6af" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将P5内容注入P3反映了XSS</h2></div><p id="74ce" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我之前没有成功的一个私人项目宣布了一个新的范围项目——他们的主登陆页面<code class="fe lb lc ld le b"><a class="ae lf" href="http://www.redacted.com/service/?zipCode=12345" rel="noopener ugc nofollow" target="_blank">www.redacted.com/*</a></code>。最初的范围只包括他们的移动应用程序，虽然我在移动目标上取得了一些成功，但我的专业知识是在web应用程序中发现稍微模糊的逻辑错误。</p><p id="8590" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在进行了我通常的基本侦察后，没有任何感兴趣的东西跃入我的眼帘，因为这是一个基本上静态的网站，提供关于该公司各种业务产品的内容，并重定向到当前范围之外的子域名。我开始搜索一个带有URL参数的页面，发现在一个搜索框中输入一个美国邮政编码会重定向到<code class="fe lb lc ld le b">www.redacted.com/service/?zipCode=12345</code>，其值反映在&lt;输入框&gt;中。开始测试的时间到了。</p><h1 id="3fdc" class="lg lh iq bd li lj lk ll lm ln lo lp lq jw lr jx ls jz lt ka lu kc lv kd lw lx bi translated">最初的立足点— HTML内容注入</h1><p id="6922" class="pw-post-body-paragraph kf kg iq kh b ki ly jr kk kl lz ju kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">我很快发现这个<input/>字段缺少<strong class="kh ir">最关键的</strong>净化，这允许攻击者使用“来逃避<em class="md">值</em>属性，并进一步允许使用&gt;来关闭标签。在这一点上，我发现了一个漏洞，但内容注入可以理解为P5，值得一分，没有奖金，因为没有实际的安全影响。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/74858affe7b2577f1cc6ae347b0baef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QwacgZJhmBm4zIeLMKyTsQ.jpeg"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">zipCode参数易受内容注入和可能的进一步利用的攻击。这里显示的是输入标签的几个属性，现在作为文本浮动在输入框的下面。</figcaption></figure><p id="e777" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我宁愿坐在这个注射一个月，试图升级它，而不是提交一个P5，然后继续前进。我立即开始致命一击，并尝试注射<strong class="kh ir">&gt;&lt;脚本&gt;警报(1)；&lt;/脚本&gt; </strong>。在这种情况下，我通常不会有很高的期望，尤其是对于这样规模和地位的公司，但这肯定值得一试。然而，正如我所料，回应是一个区块。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/a3f8753d10eea4d101177f011b895492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*OcbPhTP8TilGC_Sx-zXleA.jpeg"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">403块来自可疑云闪晶片响应。</figcaption></figure><h1 id="b1a4" class="lg lh iq bd li lj lk ll lm ln lo lp lq jw lr jx ls jz lt ka lu kc lv kd lw lx bi translated">侦察时间到了</h1><p id="13bc" class="pw-post-body-paragraph kf kg iq kh b ki ly jr kk kl lz ju kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">开发一个允许通过过滤器的HTML标签、属性和事件的列表将使我能够尝试创建一个注入字符串，这将导致成功的利用。虽然<strong class="kh ir"> &lt;脚本&gt; </strong>、<strong class="kh ir"> &lt;样式&gt; </strong>、<strong class="kh ir"> &lt; img &gt; </strong>都被屏蔽，但是<strong class="kh ir"> &lt; a &gt; </strong>、<strong class="kh ir"> &lt; svg &gt; </strong>、<strong class="kh ir"> &lt;对象&gt; </strong>、<strong class="kh ir"> &lt; div &gt; </strong>是允许的。检查每个允许的标签的属性，<strong class="kh ir"> &lt; svg src= &gt; </strong>和<strong class="kh ir"> &lt; object data= &gt; </strong>会导致阻塞——这绝非易事。我还应该提一下<strong class="kh ir"> alert() </strong>和<strong class="kh ir"> confirm() </strong>被阻止，但<strong class="kh ir"> prompt() </strong>没有被阻止。此外，内联样式也返回403。转到事件，看起来所有的事件都被屏蔽了，但我偶然注意到一个相当模糊的事件，<strong class="kh ir"> onwebkitanimationstart </strong>成功地通过了！</p><p id="232c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我发现的每个用这个事件触发XSS的例子都涉及到内联样式的使用。下面是一个来自<a class="mv mw ep" href="https://medium.com/u/a90d4c9f2c62?source=post_page-----7aed99186c5a--------------------------------" rel="noopener" target="_blank">蛮力逻辑</a>的例子:</p><pre class="mf mg mh mi gt mx le my mz aw na bi"><span id="ee73" class="nb lh iq le b gy nc nd l ne nf">&lt;style&gt; <br/>div{width:100px;height:100px;-webkit-animation-name:n;}@-webkit-keyframes n{}<br/>&lt;/style&gt;</span><span id="f85f" class="nb lh iq le b gy ng nd l ne nf">&lt;vulntag attrib=""onwebkitanimationstart=alert(9)&gt;</span><span id="5816" class="nb lh iq le b gy ng nd l ne nf">&lt;div&gt;<br/>    <br/>&lt;!-- <a class="ae lf" href="http://twitter.com/brutelogic" rel="noopener ugc nofollow" target="_blank">@brutelogic</a> --&gt;</span></pre><p id="1195" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于我不能注入样式，我在检查器控制台中搜索webkit-animation，看看是否有我可以利用的现有类，并发现了<a class="ae lf" href="https://getbootstrap.com/docs/4.0/components/progress/" rel="noopener ugc nofollow" target="_blank">引导进度</a>栏。具体来说，通过类<code class="fe lb lc ld le b">class="progress-bar progress-bar-striped progress-bar-animated"</code>的动画条纹特性将充当触发器。</p><h1 id="4a33" class="lg lh iq bd li lj lk ll lm ln lo lp lq jw lr jx ls jz lt ka lu kc lv kd lw lx bi translated">斗牛中的最后一剑</h1><p id="6af4" class="pw-post-body-paragraph kf kg iq kh b ki ly jr kk kl lz ju kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">有了计划之后，我开始制作一个新的注入字符串进行测试，使用Bootstrap文档创建包装器div和组件div。</p><pre class="mf mg mh mi gt mx le my mz aw na bi"><span id="a27c" class="nb lh iq le b gy nc nd l ne nf">https://www.redacted.com/service/?zipCode="&gt;&lt;div class=progress&gt;&lt;div onwebkitanimationstart=prompt(document.domain) class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"&gt;</span></pre><p id="fb86" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">经过几个晚上的渐进工作，确定漏洞，进行侦察以确定什么可以绕过过滤器，并最终利用现有的库来提供必要的触发器，我成功地展示了影响，并将P5内容注入升级到P3反映的跨站点脚本！您可以在输入框正下方的蓝色进度条中看到webkit动画。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nh"><img src="../Images/7f5959188fb465a745c4afbe1a0bb411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vivhFXc6vUZeLPuyQzkEYA.jpeg"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">使用Bootstrap的进度条成功进行XSS进样。</figcaption></figure><h1 id="9cee" class="lg lh iq bd li lj lk ll lm ln lo lp lq jw lr jx ls jz lt ka lu kc lv kd lw lx bi translated">外卖食品</h1><p id="7911" class="pw-post-body-paragraph kf kg iq kh b ki ly jr kk kl lz ju kn ko ma kq kr ks mb ku kv kw mc ky kz la ij bi translated">不立即报告漏洞总是存在固有的风险，因为另一个黑客可能会捷足先登。然而，如前所述，我对识别一个没有明显影响的漏洞所带来的回报(或缺乏回报)不感兴趣，主要原因是:网络安全是关于管理风险的；如果您不能<strong class="kh ir">证明</strong>一个安全影响，您的漏洞将不会被优先修复，从而使漏洞无法被恶意行为者利用。</p><p id="5602" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您在尝试绕过WAF或其他注入过滤器时遇到困难，请始终浏览源代码，看看目标提供了什么——通常您会发现成功利用漏洞所需的东西已经加载到页面中了！</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="8d21" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在社交媒体上不太活跃，但你可以在<a class="ae lf" href="https://www.linkedin.com/in/greg-gibson/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上找到我，或者在各种安全松弛或不和谐的服务器上找到我！</p></div></div>    
</body>
</html>