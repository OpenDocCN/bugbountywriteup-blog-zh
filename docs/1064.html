<html>
<head>
<title>Story of a really cool SSRF bug.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个非常酷的SSRF臭虫的故事。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/story-of-a-really-cool-ssrf-bug-cf88a3800efc?source=collection_archive---------0-----------------------#2021-01-13">https://infosecwriteups.com/story-of-a-really-cool-ssrf-bug-cf88a3800efc?source=collection_archive---------0-----------------------#2021-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="dfb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好！我叫韦丹特，也叫贝吉塔(在<a class="ae kl" href="https://twitter.com/_justYnot" rel="noopener ugc nofollow" target="_blank">推特</a>)。我是网络安全爱好者，也是bug赏金猎人。这是我第一次写2021。这篇文章是关于一个<a class="ae kl" href="https://portswigger.net/web-security/ssrf" rel="noopener ugc nofollow" target="_blank"> SSRF </a>的漏洞，这个漏洞允许我访问目标公司的AWS元数据。所以让我们开始吧，</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/3e8d6beaf9d076f82184f03f5805c8dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ttswXi0LMA4DfuZuQBAU2Q.jpeg"/></div></figure><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="ku kv l"/></div></figure><h2 id="bf15" class="kw kx iq bd ky kz la dn lb lc ld dp le jy lf lg lh kc li lj lk kg ll lm ln lo bi translated">关于目标的一些信息</h2><p id="1fe2" class="pw-post-body-paragraph jn jo iq jp b jq lp js jt ju lq jw jx jy lr ka kb kc ls ke kf kg lt ki kj kk ij bi translated">目标web应用程序就像一个具有许多功能的社交媒体平台。让我们假设它是www.target.com</p><h2 id="7b6f" class="kw kx iq bd ky kz la dn lb lc ld dp le jy lf lg lh kc li lj lk kg ll lm ln lo bi translated">发现:-</h2><p id="5ac0" class="pw-post-body-paragraph jn jo iq jp b jq lp js jt ju lq jw jx jy lr ka kb kc ls ke kf kg lt ki kj kk ij bi translated">由于目标有很多功能，我决定先测试主要的web应用程序，而不是做任何侦察。所以我启动了burp suite，将目标添加到scope中，并开始抓取web应用程序。当蜘蛛运行时，我开始测试网络应用的不同功能。我试图找到不同的漏洞，如XSS，IDORs，SQLi，速率限制攻击，业务逻辑错误等。大约两个小时，但没有运气:(</p><p id="f6dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正准备放弃这个目标，然后突然想起我开始蜘蛛网络应用程序，所以我去了打嗝的目标标签，有许多网页抓取和许多新的参数。然后，我开始搜索有趣的参数，大约5分钟后，我收到了以下请求</p><p id="bdd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lu"> GET /proxy/proxy.php？url=some_URL </em></p><p id="dbe3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到这个请求后，我立即启动了burp collaborator，生成了一个有效负载，并将其输入到url=参数中，然后发送了这个请求。我在burp collaborator中收到了带有DNS和HTTP请求的回调请求。此时我真的很开心。</p><p id="7ced" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我尝试访问localhost(127.0.0.1)和/etc/passwd文件，但是这次我没有得到任何响应。因此，我复制了从burp合作者那里获得的IP，并对其使用了Whois和dig命令，并了解到该IP属于目标公司的AWS实例。所以这次我尝试访问IP 169.254.169.254，它在Amazon EC2和其他云计算平台中用于向云实例分发元数据。所以我提出了以下要求</p><p id="1857" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GET /proxy/proxy.php？url= <code class="fe lv lw lx ly b"><em class="lu">http://169.254.169.254/latest/meta-data</em></code></p><p id="26f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">得到了如下的回应:-</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lz"><img src="../Images/0d563429babf341afcfd1c168b44b9a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XD9yaI2tUXP4m2QGq73dBg.png"/></div></div></figure><p id="0ac3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，我尝试访问AWS秘密访问密钥，以显示SSRF的影响，并提出以下请求:-</p><p id="f855" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GET /proxy/proxy.php？url= <code class="fe lv lw lx ly b"><em class="lu">http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance/</em></code></p><p id="6921" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并在响应中获得了AWS秘密访问密钥！我对这个发现非常高兴！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi me"><img src="../Images/1eabf2f53dad9d6360cbd3890684f9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NEFCP25t2kKSILEWiaHauA.jpeg"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">SSRF到AWS-元数据访问。</figcaption></figure><p id="e1ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我很快写了一份很好的报告并发送给公司，他们在2天内修复了这个漏洞。不幸的是，我没有因此得到任何奖励，因为目标公司有一个负责任的披露计划，但不管怎样，我从这个漏洞中学到了很多新东西，我希望你也能学到一些新东西:)</p><p id="fb00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你对这篇报道有任何疑问，你可以通过这里的联系我<a class="ae kl" href="https://twitter.com/_justYnot" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="07c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你们都喜欢阅读这篇文章。下次见，再见，黑客快乐！</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj kv l"/></div></figure></div></div>    
</body>
</html>