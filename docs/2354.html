<html>
<head>
<title>CVE-2022-31625: PHP Vulnerability due to uninitialized array</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CVE-2022-31625:由于未初始化的数组导致的PHP漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cve-2022-31625-php-vulnerability-due-to-uninitialized-array-30b04f6536f?source=collection_archive---------2-----------------------#2022-09-10">https://infosecwriteups.com/cve-2022-31625-php-vulnerability-due-to-uninitialized-array-30b04f6536f?source=collection_archive---------2-----------------------#2022-09-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="93c8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">由于pg_query_params()函数中未初始化的数组，在PHP中发现了一个漏洞。由<a class="ae kf" href="https://www.instagram.com/_ansh_vyas/" rel="noopener ugc nofollow" target="_blank"> anshul vyas </a>撰写</h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/d26cb10bf0de0a0ac1d99a9097777eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pFEjKy_LhJA70aj3.png"/></div></div></figure><h2 id="ef80" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated"><strong class="ak">描述</strong></h2><p id="9f0d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lb lx ly lz lf ma mb mc lj md me mf mg ij bi translated">在PHP 7 . 4 . 30以下的7.4.x版本、8.0.20以下的8.0.x版本和8.1.7以下的8.1.x版本中，当pdo_mysql扩展带有mysqlnd驱动程序时，如果允许第三方提供要连接的主机和连接的密码，过长的密码会触发PHP中的缓冲区溢出，从而导致远程代码执行漏洞。</p><p id="9ec0" class="pw-post-body-paragraph lo lp iq lq b lr mh jr lt lu mi ju lw lb mj ly lz lf mk mb mc lj ml me mf mg ij bi translated"><strong class="lq ir">严重程度- </strong> 8.8(高)</p><h1 id="ec5a" class="mm kt iq bd ku mn mo mp kx mq mr ms la jw mt jx le jz mu ka li kc mv kd lm mw bi translated"><strong class="ak">漏洞分析</strong></h1><h2 id="3488" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">易受攻击代码</h2><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mx"><img src="../Images/97f84ad59c87224f305b5bf25a316700.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vXm_KksnZOOOq-D_"/></div></div></figure><p id="527e" class="pw-post-body-paragraph lo lp iq lq b lr mh jr lt lu mi ju lw lb mj ly lz lf mk mb mc lj ml me mf mg ij bi translated">在“PHP_FUNCTION”中，使用“safe_emalloc”来申请指针数组“params ”,但它没有初始化，导致“params”数组包含内存中的剩余数据或指针。如果出现异常，代码将执行` _php_pgsql_free_params `函数来释放整个指针数组:</p><p id="aec8" class="pw-post-body-paragraph lo lp iq lq b lr mh jr lt lu mi ju lw lb mj ly lz lf mk mb mc lj ml me mf mg ij bi translated">emalloc()使用php自己的内存分配器(它针对php的工作负载进行了优化，并强制使用最大内存)。应该尽可能使用emalloc()，如果PHP可能释放或重新分配内存区域，就必须使用它。</p><p id="dab3" class="pw-post-body-paragraph lo lp iq lq b lr mh jr lt lu mi ju lw lb mj ly lz lf mk mb mc lj ml me mf mg ij bi translated">由于pg_query_params()函数中未初始化的数组，在PHP中发现了一个漏洞。当使用Postgres数据库扩展时，向参数化查询提供无效参数可能会导致PHP试图释放内存，使用未初始化的数据作为指针。这可能导致RCE漏洞或拒绝服务。</p><h2 id="ad4d" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">补丁代码</h2><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi my"><img src="../Images/a1cb1ca2c3cd7e5e442ae77fcb7c5686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nnp37KOQpairxjLA"/></div></div></figure><p id="6d32" class="pw-post-body-paragraph lo lp iq lq b lr mh jr lt lu mi ju lw lb mj ly lz lf mk mb mc lj ml me mf mg ij bi translated">此内存未初始化漏洞很容易转化为UAF漏洞，其利用比CVE-2022–31626更容易。很有可能通过远程堆风水实现任意内存释放，然后通过UAF实现远程代码执行。受影响的客户需要尽快进行补丁升级和保护。</p><p id="d461" class="pw-post-body-paragraph lo lp iq lq b lr mh jr lt lu mi ju lw lb mj ly lz lf mk mb mc lj ml me mf mg ij bi translated">UAF代表释放后使用，是一个与程序运行期间不正确使用动态内存相关的漏洞。如果在释放一个内存位置后，一个程序没有清除指向那个内存的指针，攻击者就可以利用这个错误来攻击这个程序。目前官方修复版本已经发布，用户可以升级到以下安全版本:PHP 8.1.7，PHP 8.0.20和PHP 7.4.30。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h2 id="5ab3" class="ks kt iq bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kf" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>