<html>
<head>
<title>How I hacked into a Telecom Network — Part 3 (Playing with Tunnels: Stealthy SSH &amp; Dynamic Tunnels)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何侵入电信网络的——第3部分(玩隧道:秘密的SSH和动态隧道)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-hacked-into-a-telecom-network-part-3-playing-with-tunnels-stealthy-ssh-dynamic-tunnels-5ac26557d0eb?source=collection_archive---------0-----------------------#2020-07-14">https://infosecwriteups.com/how-i-hacked-into-a-telecom-network-part-3-playing-with-tunnels-stealthy-ssh-dynamic-tunnels-5ac26557d0eb?source=collection_archive---------0-----------------------#2020-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="988f" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><em class="iq">TLDR；一家电信公司的红队项目。立足于公司的网络监控系统(NMS)。通过HTTP隧道传输SSH的反向外壳问题已排序。当通过HTTP获得SSH时变成了完全忍者。在网络内部代理以获取内部网络扫描。使用SS7应用程序访问CDRs和VLR。</em></p></blockquote></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><h2 id="4573" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">回顾:一家电信公司的红队项目。找到了感兴趣的子域，在那个子域上做了全端口扫描，找到了端口12000/tcp，14000/tcp，14100/tcp找到了JBoss的一个运行实例(我真幸运！)，为RCE开发了JBoss，为外壳稳定性实现了HTTP上的TCP隧道。</h2></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><p id="c5f0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">有关详细信息，您可以查看以下链接:<br/> <a class="ae ls" href="https://medium.com/bugbountywriteup/how-i-hacked-into-a-telecom-network-part-1-getting-the-rce-167c2bb320e6" rel="noopener"> <strong class="jt ir"> <em class="js">第1部分—获取RCE</em></strong></a><strong class="jt ir"><em class="js"><br/></em></strong><a class="ae ls" href="https://medium.com/bugbountywriteup/how-i-hacked-into-a-telecom-network-part-2-playing-with-tunnels-tcp-tunneling-b4cef2837938" rel="noopener"><strong class="jt ir"><em class="js">第2部分—玩隧道:TCP隧道<br/></em></strong></a><a class="ae ls" href="https://medium.com/@TheCyb3rAlpha/how-i-hacked-into-a-telecom-network-part-4-getting-access-to-cdrs-ss7-applications-vlrs-9a8cf95e2648" rel="noopener"><strong class="jt ir"><em class="js">第4部分—获取CDRs、SS7应用&amp; VLRs </em> </strong> </a></p></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><blockquote class="jn jo jp"><p id="2b20" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">免责声明:这篇文章很长，所以请耐心等待，享受旅程吧！</p></blockquote><p id="b727" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">在前面的<a class="ae ls" href="https://medium.com/@TheCyb3rAlpha/how-i-hacked-into-a-telecom-network-part-2-playing-with-tunnels-tcp-tunneling-b4cef2837938" rel="noopener"> <strong class="jt ir"> <em class="js">部分</em> </strong> </a>中，我提到了我遵循的步骤，我配置了TCP隧道over HTTP和SSH端口转发，以使用端口2222/tcp从我的服务器访问NMS服务器的端口22/tcp。在这篇博文中，我将展示我是如何实现<strong class="jt ir"> SSH动态隧道</strong>来进一步利用网络的。</p></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><h1 id="4c20" class="lt kx iq bd ky lu lv lw lb lx ly lz le ma mb mc li md me mf lm mg mh mi lq mj bi translated">秘密SSH访问</h1><p id="de42" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lf mm ke kf lj mn ki kj ln mo km kn ko ij bi translated">当您连接到SSH服务器时，连接详细信息会存储在日志文件中。要检查这些连接细节，您可以在*nix系统中执行“w”命令。</p><blockquote class="jn jo jp"><p id="dfd0" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">许多<a class="ae ls" href="https://en.wikipedia.org/wiki/Unix-like" rel="noopener ugc nofollow" target="_blank">Unix</a><a class="ae ls" href="https://en.wikipedia.org/wiki/Operating_system" rel="noopener ugc nofollow" target="_blank">操作系统</a>上的命令<strong class="jt ir"> w </strong>提供了登录到计算机的每个用户的快速摘要，每个用户当前正在做什么，以及所有活动对计算机本身施加了什么<a class="ae ls" href="https://en.wikipedia.org/wiki/Load_(computing)" rel="noopener ugc nofollow" target="_blank">负载</a>。该命令是其他几个Unix程序的一个命令组合:<a class="ae ls" href="https://en.wikipedia.org/wiki/Who_(Unix)" rel="noopener ugc nofollow" target="_blank"> who </a>、<a class="ae ls" href="https://en.wikipedia.org/wiki/Uptime" rel="noopener ugc nofollow" target="_blank"> uptime </a>和<a class="ae ls" href="https://en.wikipedia.org/wiki/Ps_(Unix)" rel="noopener ugc nofollow" target="_blank"> ps -a </a>。来源:<a class="ae ls" href="https://en.wikipedia.org/wiki/W_(Unix)" rel="noopener ugc nofollow" target="_blank"> <strong class="jt ir"> <em class="iq">维基百科</em> </strong> </a></p></blockquote><p id="051b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">所以基本上，源IP被保存了，这对红队来说是危险的。由于这是一个RTE，我不能冒险让管理员知道我在C2的位置。(别担心，我使用的ABPTTS外壳是从我的服务器连接的，我已经为<a class="ae ls" href="https://en.wikipedia.org/wiki/IDN_homograph_attack#:~:text=The%20internationalized%20domain%20name%20(IDN,the%20attack%2C%20although%20technically%20homoglyph" rel="noopener ugc nofollow" target="_blank"> IDN同形异义攻击</a>买了一个域名，以减少我被发现的机会)</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mp"><img src="../Images/16ad42d0a67bc53d5146d1d3e3837892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O4K2Oc5Aqp7lUrOzvlhV-A.png"/></div></div></figure><p id="e554" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">为了让秘密的连接工作，我检查了主机文件以收集更多的信息，我发现这个服务器在网络中被大量使用。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nb"><img src="../Images/d8ab5037105beeb1184f1515f0cecb14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0lyP0eKqcgtT5qoUl4m8w.png"/></div></div></figure><p id="1c39" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">这样的服务器已经被监控了，所以我在想办法在这种情况下尽可能的隐蔽。NMS已经在监控网络，所以我想它一定是在监控自己，包括所有与服务器的网络连接。这意味着我不能通过HTTP上的TCP隧道使用正常的端口扫描。</p><p id="15ab" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">用SSH加密我的服务器和NMS服务器之间的通信怎么样？要不是SSH连接，我的主机名/IP将会存储在日志文件中，用户名也很容易识别。</p><p id="be0e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">在本例中，我的服务器的用户名是“harry ”,为这个用户生成一个密钥并存储在authorized_keys文件中并不是一个好的选择。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/226fd5e309e3cc224c1f3ca194462244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*vOpIEaw_rvPy6O2sxxEygw.gif"/></div></figure><h2 id="c8da" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">然后我想出了一个主意(分步骤)，</h2><ol class=""><li id="eb68" class="nd ne iq jt b ju mk jy ml lf nf lj ng ln nh ko ni nj nk nl bi translated">在我的服务器上创建用户“nms”(该用户已经在NMS服务器中创建)。</li><li id="27d5" class="nd ne iq jt b ju nm jy nn lf no lj np ln nq ko ni nj nk nl bi translated"><em class="js">把我的服务器主机名从OPENVPN改成</em> <strong class="jt ir"> <em class="js">【编校】</em> </strong> <em class="js"> _NMS </em> <strong class="jt ir"> <em class="js">【编校】。</em> </strong> <em class="js">(与NMS服务器相同)</em></li><li id="22a2" class="nd ne iq jt b ju nm jy nn lf no lj np ln nq ko ni nj nk nl bi translated"><em class="js">在我的服务器上为‘nms’用户生成SSH密钥，并将公钥复制到NMS服务器中。(授权_钥匙)</em></li><li id="5c3d" class="nd ne iq jt b ju nm jy nn lf no lj np ln nq ko ni nj nk nl bi translated"><em class="js">配置运行在NMS上的SSH服务器启用root登录(</em><strong class="jt ir"><em class="js">PermitRootLogin</em></strong><em class="js">)、TCP端口转发&amp;网关端口。(SSH -g开关以防万一)</em></li><li id="d1d7" class="nd ne iq jt b ju nm jy nn lf no lj np ln nq ko ni nj nk nl bi translated">将NMS服务器配置为SOCKS代理，以便我进一步利用网络。(动态SSH隧道)</li><li id="b5ff" class="nd ne iq jt b ju nm jy nn lf no lj np ln nq ko ni nj nk nl bi translated">SOCKS隧道现在被加密了，我可以使用这个隧道通过Metasploit进行内部网络扫描。</li></ol><h2 id="567c" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">实施时间！</h2><p id="6e6d" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lf mm ke kf lj mn ki kj ln mo km kn ko ij bi translated">我首先在我的服务器上添加用户“nms ”,这样我就可以生成特定于用户的SSH密钥。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nr"><img src="../Images/9974dd182d2da1b6fc5362a061fa6761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zq_cxuit1scSVLMwWmEzAw.png"/></div></div></figure><p id="f23e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">我甚至把我的服务器的主机名改成了与NMS服务器完全相同的主机名，这样当我使用SSH登录时，日志将显示一个用户登录条目为nms@ <strong class="jt ir">【修订】</strong> _NMS <strong class="jt ir">【修订】</strong></p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ns"><img src="../Images/839dd132920f3dee0652498df5ebc34a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUqbgGvl2cysFb-cBQQKKg.png"/></div></div></figure><p id="d5ef" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">接下来，我在我的服务器上为‘NMS’用户生成了SSH密钥。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nt"><img src="../Images/13a2f71d982662a5a669e588ea44a3e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIpyqZWkUIn9i9MnG13IuQ.png"/></div></div></figure><p id="089a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">我还必须更改NMS服务器上的SSH配置，所以我从服务器上下载了<strong class="jt ir"> sshd_config </strong>文件，并在里面做了一些改动。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e6726fb478afb5171c399240f47dc021.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*Y5nuvD-kguEsiLTicX9xEw.png"/></div></figure><p id="cc63" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated"><strong class="jt ir"> AllowTCPForwarding </strong>:该选项用于通过SSH启用TCP端口转发。</p><p id="1eb5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated"><strong class="jt ir"> GatewayPorts </strong>:该选项启用端口绑定到接口，而不是远程端口上的回环。(我启用此选项是为了以防万一，如果我想要来自此服务器上其他内部系统的反向shell，它将通过反向端口转发将shell转发给我)</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/b85d34bdf501efec4c7540e85a38d81c.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*fH5CMwpW6Qq3kcQgOeOZcw.png"/></div></figure><p id="4c4e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated"><strong class="jt ir"> PermitRootLogin </strong>:该选项允许客户端使用‘root’连接到SSH服务器。</p><p id="0ac0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated"><strong class="jt ir"> StrictModes </strong>:该选项指定SSH在接受登录之前是否应该检查用户在主目录中的权限。</p><p id="88c6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">现在配置已经完成，我很快将sshd_config文件上传(更像是覆盖)到NMS服务器上。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nw"><img src="../Images/a8747d653f788f27cc5e64988c56823c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aMDelzh15wYug-VT-u4Dew.png"/></div></div></figure><p id="cbc9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">我还将SSH公钥复制到“root”用户的authorized_keys文件中</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nt"><img src="../Images/44da1dc255d657fcf564814092e9f644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qmeg4-E7QudQdTZfNHbEbg.png"/></div></div></figure><p id="d799" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">一切都设置好之后，我试着连接测试，只是为了检查我是否能在NMS服务器上使用“root”进行SSH。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nx"><img src="../Images/20ebb12cac71be807e4a33da793ed965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPHwNpsyHfu3FwxkOzjmIQ.png"/></div></div></figure><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/17915b68456c891da88895fea422ce22.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/1*z4hrzVsCjN6U1udjTeS7qA.gif"/></div></figure><p id="76cc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">Booyah！😎😎😎</p><p id="a4dd" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">SSH over TCP over HTTP(通过ABPTTS shell (JSP)在HTTP连接上创建的SSH端口转发TCP隧道)</p></div><div class="ab cl kp kq hu kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ij ik il im in"><h1 id="0540" class="lt kx iq bd ky lu lv lw lb lx ly lz le ma mb mc li md me mf lm mg mh mi lq mj bi translated">动态端口转发(动态SSH隧道)</h1><p id="1561" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lf mm ke kf lj mn ki kj ln mo km kn ko ij bi translated">让我们看看<a class="ae ls" href="https://en.wikipedia.org/wiki/Port_forwarding#Dynamic_port_forwarding" rel="noopener ugc nofollow" target="_blank"> <strong class="jt ir"> <em class="js">维基百科</em> </strong> </a>对此是怎么说的——</p><blockquote class="jn jo jp"><p id="9f46" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><strong class="jt ir">动态端口转发</strong> (DPF)是一种通过使用防火墙针孔穿越防火墙或NAT的按需方法。目标是使客户端能够安全地连接到一个可信的服务器，该服务器作为一个中介，用于向一个或多个目标服务器发送/接收数据。</p><p id="bc0c" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">DPF可以通过设置一个本地应用程序来实现，比如SSH，作为一个<strong class="jt ir"> SOCKS代理服务器</strong>，它可以用来处理通过网络或互联网的数据传输。</p><p id="db23" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">建立连接后，DPF可用于为连接到不可信网络的用户提供额外的安全性。由于数据在被转发到其原始目的地之前必须通过安全隧道到达另一个服务器，<strong class="jt ir">用户被保护免受局域网上可能发生的数据包嗅探。</strong></p></blockquote><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/3e1eba96788073e2e2bbd6dbbd056c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*flVt33g4eZAChBx_S6_JSg.gif"/></div></figure><p id="1fb7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">所以我所要做的就是创建一个动态SSH隧道，这样NMS服务器就可以充当代理服务器。我使用袜子隧道的一些好处是:</p><ol class=""><li id="faee" class="nd ne iq jt b ju jv jy jz lf oa lj ob ln oc ko ni nj nk nl bi translated"><em class="js">通过NMS服务器(</em> <strong class="jt ir"> <em class="js">)间接访问其他网络设备/服务器，NMS服务器成为我的网关</em> </strong> <em class="js"> ) </em></li><li id="bc25" class="nd ne iq jt b ju nm jy nn lf no lj np ln nq ko ni nj nk nl bi translated"><em class="js">因为有了</em> <strong class="jt ir"> <em class="js">动态SSH隧道</em> </strong> <em class="js">，所有从我的服务器始发到NMS服务器的流量都得到了加密(</em> <strong class="jt ir"> <em class="js">使用了</em></strong><em class="js"/><strong class="jt ir"><em class="js">SSH连接，记得吗？</em>T35<em class="js">)</em></strong></li><li id="8b6c" class="nd ne iq jt b ju nm jy nn lf no lj np ln nq ko ni nj nk nl bi translated">即使服务器管理员坐在NMS服务器上监控网络，他也不能马上找到根本原因。(一个专门的肯定会加入点)</li><li id="681e" class="nd ne iq jt b ju nm jy nn lf no lj np ln nq ko ni nj nk nl bi translated"><em class="js">连接很稳定(多亏了HTTP Keep-Alive)，现在所有这些递归隧道都运行顺畅，没有任何连接中断，因为我在HTTP上实现了TCP隧道。</em></li></ol><p id="82ed" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">当我通过SSH登录到NMS服务器时，下面是“w”命令向我显示的内容:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi od"><img src="../Images/1e5d3d54994ed7bf943c714036b11db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UiejslSQ7EMOCj8BuWhBXQ.png"/></div></div></figure><p id="8dce" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">现在我所要做的就是创建SOCKS隧道，我使用命令:<strong class="jt ir"> <em class="js"> ssh -NfCq -D 9090 -i &lt;私钥/身份文件&gt;&lt;user @ host&gt;-p&lt;ssh自定义端口&gt; </em> </strong></p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi nt"><img src="../Images/3b01a46e295fe9df9745ee483b22bda3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YSe4RKSizS9uJpDj8grMxw.png"/></div></div></figure><p id="c951" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">为此，sshd_config文件中的'<strong class="jt ir"><em class="js">PermitRootLogin</em></strong>'已被更改(以root用户身份登录到NMS服务器)。</p><p id="bb72" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated"><strong class="jt ir">担心服务器管理员会对设置</strong>有什么想法？通常，当SSH连接打开时，服务器管理员有时会检查登录的<strong class="jt ir">用户名</strong>，用于登录的<strong class="jt ir">授权密钥</strong>，但大多数时候，他会检查发起连接的<strong class="jt ir">主机名/IP </strong>。</p><p id="8d7d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">在我的例子中，我使用端口2222/tcp(感谢HTTP上的tcp隧道)启动了从地址为127.0.0.1的服务器到目的地址为127.0.0.1的NMS服务器的连接(同样！).现在，由于这种设置，他将看到的只是由nms服务器使用存储为用户“NMS”的授权密钥(公钥)发起的<strong class="jt ir"> <em class="js">到NMS服务器</em> </strong> SSH的连接(这就是为什么我在我的主机上创建了相同的用户来生成密钥)，即使管理员检查了known_hosts文件，他看到的也只是“nms@ <strong class="jt ir">【修订】</strong> _NMS <strong class="jt ir">【修订】</strong>”用户连接到SSH</p><p id="f169" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">为了确认SOCKS隧道，我检查了服务器上的连接表，端口9090/tcp处于<strong class="jt ir"> LISTEN </strong>状态。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi oe"><img src="../Images/00340edb050c00cf684b5bb1a1324570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YH1HXPUSRGYEcVlwZ8HgiQ.png"/></div></div></figure><p id="c5e7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">厉害！袜子隧道准备好了！</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0a3725620a5874513d6190c23aad2d9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*1ynwKAEOO7GUJYInkcqlKQ.gif"/></div></figure><p id="eb97" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">剩下我要做的就是使用Metasploit的SOCKS隧道进行进一步的网络开发，这将在下一篇文章(最后一部分)中介绍:</p><p id="e490" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated"><a class="ae ls" href="https://medium.com/@TheCyb3rAlpha/how-i-hacked-into-a-telecom-network-part-4-getting-access-to-cdrs-ss7-applications-vlrs-9a8cf95e2648" rel="noopener"> <strong class="jt ir"> <em class="js">第4部分—访问cdr、SS7应用&amp;vlr</em></strong></a></p><h1 id="7d72" class="lt kx iq bd ky lu of lw lb lx og lz le ma oh mc li md oi mf lm mg oj mi lq mj bi translated">亲提示！</h1><p id="d3b5" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lf mm ke kf lj mn ki kj ln mo km kn ko ij bi translated">当您通过SSH连接到服务器时，会自动分配一个<a class="ae ls" href="https://en.wikipedia.org/wiki/Pseudoterminal" rel="noopener ugc nofollow" target="_blank"> <strong class="jt ir"> <em class="js">伪TTY </em> </strong> </a>。当然，当您通过SSH(一行程序)执行命令时，这种情况不会发生。因此，每当您想通过SSH建立隧道或创建SOCKS隧道时，可以尝试使用-T开关来禁用伪TTY分配。您也可以使用下面的命令:</p><blockquote class="jn jo jp"><p id="d630" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><strong class="jt ir"> ssh -NTfCq -L &lt;本地端口转发&gt; &lt; user@host &gt; </strong></p><p id="adee" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><strong class="jt ir"> ssh -NTfCq -D &lt;动态端口转发&gt; &lt; user@host &gt; </strong></p></blockquote><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ok"><img src="../Images/c4a53df9c0bceec0c7347e7e74472a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LqAV2g5z7wOL8yOaKtkj3A.png"/></div></div></figure><p id="2968" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lj kh ki kj ln kl km kn ko ij bi translated">要检查所有SSH开关，您可以参考SSH手册<a class="ae ls" href="https://linux.die.net/man/1/ssh" rel="noopener ugc nofollow" target="_blank"><strong class="jt ir"><em class="js"/></strong></a>(<strong class="jt ir">强烈推荐！</strong>)。当使用交换机创建隧道时(如上所示)，您可以创建一个没有TTY分配的隧道，并且隧道端口将正常工作！</p><h1 id="54d9" class="lt kx iq bd ky lu of lw lb lx og lz le ma oh mc li md oi mf lm mg oj mi lq mj bi translated">推广时间！</h1><p id="8d08" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb lf mm ke kf lj mn ki kj ln mo km kn ko ij bi translated">如果你们想了解更多关于我使用的技术及其背后的基本概念，可以阅读我的书(与<strong class="jt ir"><em class="js">@ himan Shu _ hax</em></strong><em class="js">)</em></p><blockquote class="jn jo jp"><p id="a7f0" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><strong class="jt ir"> <em class="iq">动手红队战术</em></strong>——<a class="ae ls" href="https://www.amazon.in/Hands-Penetration-Testing-Metasploit-vulnerabilities-ebook/dp/B07MT8DDBR" rel="noopener ugc nofollow" target="_blank">亚马逊</a>，<a class="ae ls" href="https://www.packtpub.com/in/networking-and-servers/hands-red-team-tactics" rel="noopener ugc nofollow" target="_blank"> PacktPub </a></p></blockquote><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ol"><img src="../Images/49183e9f12fed4d46b3e035adceddb8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I-o-JTOEm8llRpfA.jpg"/></div></div></figure><blockquote class="jn jo jp"><p id="626a" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><strong class="jt ir"> <em class="iq">用Metasploit</em></strong>——<a class="ae ls" href="https://www.amazon.in/Hands-Penetration-Testing-Metasploit-vulnerabilities-ebook/dp/B07MT8DDBR" rel="noopener ugc nofollow" target="_blank">亚马逊</a>，<a class="ae ls" href="https://www.packtpub.com/in/networking-and-servers/hands-web-penetration-testing-metasploit" rel="noopener ugc nofollow" target="_blank"> PacktPub </a>进行实际操作的Web应用渗透测试</p></blockquote><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ol"><img src="../Images/0bad1ace10ecc835b82b0fbb2be73fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fJ_MJL4kLbCSD9Vb.jpg"/></div></div></figure></div></div>    
</body>
</html>