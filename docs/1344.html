<html>
<head>
<title>Ethical Hacking Stories — Denial-of-Service to BiciMAD Bikes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">道德黑客故事——拒绝为BiciMAD自行车提供服务</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/ethical-hacking-stories-denial-of-service-to-bicimad-bikes-e16e4b3f6bbb?source=collection_archive---------1-----------------------#2021-05-27">https://infosecwriteups.com/ethical-hacking-stories-denial-of-service-to-bicimad-bikes-e16e4b3f6bbb?source=collection_archive---------1-----------------------#2021-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8c1f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">马德里公共自行车租赁服务中存在一个漏洞，使得攻击者能够预订所有可用的自行车</h2></div><p id="b852" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2014年，马德里市对移动性做出了重大承诺，部署了自己的自行车租赁服务，名为<a class="ae le" href="https://www.accessiblemadrid.com/en/blog/bicimad-public-bike-rental-service-madrid" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> BiciMAD </em> </a>。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/2ce0a4de3afbc8dd5f7aaf2baf41b84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuaXKPL6j-dPr02I9hAB2Q@2x.jpeg"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">有了BiciMAD，你可以从264个车站中的任何一个骑自行车</figcaption></figure><p id="f7c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个故事将向你展示我如何在<em class="lf"> BiciMAD </em>服务中发现<strong class="kk iu">的一个漏洞，这个漏洞</strong> <strong class="kk iu">允许攻击者预订所有可用的自行车</strong>。</p><blockquote class="lw lx ly"><p id="fce1" class="ki kj lf kk b kl km ju kn ko kp jx kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated"><strong class="kk iu">免责声明</strong>:本故事中表达的观点仅代表作者本人，不代表BiciMAD公司的观点。事件得到了适当通报，并采取了相关措施予以解决。敏感信息隐藏在以下截图中。</p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="8bc3" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">比奇马德围棋赛</h1><p id="f235" class="pw-post-body-paragraph ki kj it kk b kl nb ju kn ko nc jx kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">2020年秋天，马德里增加了454辆自由浮动自行车，采用了一种叫做<em class="lf"> BiciMAD Go </em>的新形式。BiciMAD自行车的不同之处在于它们不需要停靠在车站。你可以把它们放在允许区域内的任何地方。</p><p id="5f2f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">找到一辆这样的自行车最便捷的方式就是使用官方的<em class="lf">bici mad</em><a class="ae le" href="https://www.bicimad.com/index.php?s=app" rel="noopener ugc nofollow" target="_blank"><em class="lf">App</em></a>。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ng"><img src="../Images/cd5721063edf2ae9c8158d7998064cb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yq9T3D0mHTDpLx-b_bmUow.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">带数字的标记代表BiciMAD站，而其他标记表示BiciMAD Go自行车</figcaption></figure><p id="3b28" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以预订一辆BiciMAD Go自行车，以避免另一个用户在接下来的10分钟内骑走这辆自行车。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ng"><img src="../Images/f7dfe03c7341ad8cd3c78d732cf26304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YmheBk0YCvm4dU5Z7IcE1g.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">预订一辆自行车会给你足够的时间到达自行车的位置</figcaption></figure><p id="5df4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一天，一个问题出现在我的脑海里:</p><blockquote class="nh"><p id="9886" class="ni nj it bd nk nl nm nn no np nq ld dk translated">我可以同时预订多辆自行车吗？</p></blockquote><p id="44a8" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">允许用户同时预订多辆自行车可能会影响自行车的可用性，所以我希望有某种控制。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ng"><img src="../Images/901d33f9fc15679e0a71a9941d3ca093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pwSPblR_9-s1DV6WjR-7Aw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">有一个控件可以防止用户在同一时间段内预订多辆自行车</figcaption></figure><p id="e3a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这应该是一个服务器端控件，但这不是我第一次在客户端看到这些控件，它们很容易被绕过。</p><p id="dc2d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了在网络层了解<em class="lf"> BiciMAD </em> <em class="lf"> App </em>中发生了什么，我设置了一个<a class="ae le" href="https://www.zaproxy.org/" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> OWASP ZAP </em> </a>代理。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nw"><img src="../Images/933b0cfd7961b91e0001cdfba50e8cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Npoq2tS_rvl-Rr7Xdqd5g.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">通过代理，我可以看到BiciMAD应用程序和服务器之间的请求交换</figcaption></figure><p id="ce23" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在检查了由<em class="lf"> BiciMAD </em> <em class="lf"> App </em>产生的网络流量后，我发现<strong class="kk iu">在<em class="lf"> App </em>中显示的错误确实是服务器端错误</strong>。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nx"><img src="../Images/4f7595496ff31ec30098fa64c71552d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOdD3LqoRFoF3m7dzLgy9w.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">来自服务器的响应确认服务器端控制已经就绪</figcaption></figure><p id="d788" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我注意到，如果你试图在10分钟预订限制后预订另一辆自行车，将会受到时间惩罚。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ny"><img src="../Images/2194b3c65e634ae28aac993da4db09c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8sxqiIcq3VH4t49SwL6__g.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">在预订限制之后和处罚日期之前预订自行车将导致30分钟的锁定</figcaption></figure><p id="4447" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">这种控制将防止用户损害自行车的可用性。</strong></p><blockquote class="nh"><p id="a667" class="ni nj it bd nk nl nm nn no np nq ld dk translated">所以…这似乎是故事的结尾。也可能不是…</p></blockquote><h1 id="d20f" class="mj mk it bd ml mm nz mo mp mq oa ms mt jz ob ka mv kc oc kd mx kf od kg mz na bi translated">安全漏洞</h1><p id="23e2" class="pw-post-body-paragraph ki kj it kk b kl nb ju kn ko nc jx kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">看了一下预订请求，我意识到<strong class="kk iu">我的身份证号码是在标题</strong>中发送的。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oe"><img src="../Images/7ac088776d81f8a5074c058e131d6e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dN1fVJzDaCJE1UzRXHVnEQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">“nif”字段引起了我的注意</figcaption></figure><p id="df5f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在一个头<strong class="kk iu">中发送用户的国家<em class="lf"> ID </em>号允许攻击者轻易地伪造值</strong>，所以我开始怀疑…</p><blockquote class="nh"><p id="2f2e" class="ni nj it bd nk nl nm nn no np nq ld dk translated"><strong class="ak">身份证号会在服务器上验证吗？</strong></p></blockquote><p id="7356" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">使用<a class="ae le" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> <em class="lf">邮递员</em> </a>，我复制了预订请求<strong class="kk iu">，用“<em class="lf">00000013 b</em>”</strong>替换我的<em class="lf"> ID </em>，并且<strong class="kk iu"> </strong>请求<strong class="kk iu">似乎成功了</strong>。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="of og l"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">什么鬼<em class="oh">’</em>时刻由奥巴马和<a class="ae le" href="https://giphy.com/gifs/wtf-obama-wth-pPhyAv5t9V8djyRFJH" rel="noopener ugc nofollow" target="_blank">吉菲</a></figcaption></figure><p id="8a74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过对预订端点的<em class="lf"> GET </em>请求，我能够验证自行车是否被成功预订。此外，我发现<strong class="kk iu">没有对用户的国家<em class="lf"> ID </em>字段进行输入验证</strong>，因此<strong class="kk iu">我可以使用任意值</strong>来预订任何自行车，例如'<em class="lf"> 1 </em>'、'<em class="lf"> hi </em>'，甚至是一个空ID。</p><p id="db8c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我发现自己在问…</p><blockquote class="nh"><p id="cb81" class="ni nj it bd nk nl nm nn no np nq ld dk translated">我能利用这个漏洞对BiciMAD Go bikes进行拒绝服务攻击吗？</p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="8a12" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">剥削</h1><p id="e0d5" class="pw-post-body-paragraph ki kj it kk b kl nb ju kn ko nc jx kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated"><strong class="kk iu"> <em class="lf">拒绝服务</em> </strong> ( <em class="lf"> DoS </em>)是一种网络攻击，其中恶意行为者旨在<strong class="kk iu">通过中断设备的正常功能，使资源或设备对其目标用户不可用</strong>。</p><p id="32a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">我使用这些<em class="lf">道德黑客</em>的意图是</strong> <strong class="kk iu">增加我使用的</strong>应用程序的安全性，以便它们在未来对每个人都更安全。</p><p id="23d0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个<em class="lf"> DoS </em>会导致<em class="lf"> BiciMAD </em>的经济损失，并且会越过道德黑客的界限——除了法律影响。</p><blockquote class="nh"><p id="cd9a" class="ni nj it bd nk nl nm nn no np nq ld dk translated">根据以前的漏洞证据，很明显这种攻击可以成功实施</p></blockquote><p id="5cde" class="pw-post-body-paragraph ki kj it kk b kl nr ju kn ko ns jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">虽然我不想损害bici mad Go T1自行车的可用性，但我想用一小组自行车T5对攻击T3 T4进行T2概念验证。</p><p id="8be7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我创建了一个脚本，使用随机生成的<em class="lf">id</em>在我的区域附近预订了一组选定的自行车。</p><p id="9900" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我运行脚本，走到街上，试着骑上选中的自行车。当我试图解锁它们时，<em class="lf">应用</em>显示一个错误，确认它们已经被预订了。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ng"><img src="../Images/4f7776dc155e96a0aaba55678ec28e9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O81FZdnelaxPzF6WRmPTag.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">应用程序中的错误确认了预订的自行车不可用</figcaption></figure><p id="c648" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">十分钟后，我让我的妻子再次运行脚本，这样我就可以验证自行车仍然不可用。</p><p id="e055" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">时间惩罚控制被证明是完全无用的</strong>，因为惩罚似乎被应用于用户的<em class="lf"> ID </em> — <em class="lf">，该ID可以随机生成</em>。</p><p id="26b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在确认攻击可行后，是时候<strong class="kk iu">报告漏洞</strong>以便修复了。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><h1 id="3a2c" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">最后的想法</h1><p id="159c" class="pw-post-body-paragraph ki kj it kk b kl nb ju kn ko nc jx kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">这个漏洞使得攻击者可以用任意的国民身份证号码预订任何自行车，严重影响了自行车的可用性。</p><p id="4570" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还发现，用另一个<em class="lf"> BiciMAD </em>用户的<em class="lf"> ID </em>预订自行车是可能的，这也<strong class="kk iu">影响了预订服务的完整性</strong>。</p><p id="3432" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我看来，利用的容易程度以及对<em class="lf"> BiciMAD </em>服务的影响使得这个安全漏洞成为一个<strong class="kk iu">高严重性漏洞</strong>。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/a27e063d6b3d76107b76dbc9cad43beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*Ug6qZlZhuLyTHuyw0wtD2w.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">根据<a class="ae le" href="https://nvd.nist.gov/vuln-metrics/cvss" rel="noopener ugc nofollow" target="_blank">通用漏洞评分系统</a>，我提议的CVSS 3.1向量返回了7.6的基础分数</figcaption></figure><p id="eef1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尽管对该漏洞最有害的利用是<em class="lf">拒绝服务</em>，但它也可以被<strong class="kk iu">利用，悄悄减少某些地区的自行车可用性</strong>——让竞争对手获得竞争优势。</p></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><blockquote class="lw lx ly"><p id="d2cd" class="ki kj lf kk b kl km ju kn ko kp jx kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated">如果你喜欢这个故事，你想阅读更多，请在<a class="ae le" href="https://medium.com/@h_martos" rel="noopener">媒体</a>、<a class="ae le" href="https://twitter.com/h_martos" rel="noopener ugc nofollow" target="_blank">推特</a>或<a class="ae le" href="https://www.linkedin.com/in/h%C3%A9ctor-martos-g%C3%B3mez-99838776/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上关注我。</p><p id="4679" class="ki kj lf kk b kl km ju kn ko kp jx kq lz ks kt ku ma kw kx ky mb la lb lc ld im bi translated">感谢阅读！</p></blockquote></div></div>    
</body>
</html>