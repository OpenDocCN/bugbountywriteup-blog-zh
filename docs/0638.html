<html>
<head>
<title>From ‘Weak Permissions on Windows Service’ to ‘Shell’ | Privilege Escalation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从“Windows服务上的弱权限”到“外壳“|权限提升”</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/weak-permissions-on-windows-service-privilege-escalation-e8fa97ce4a54?source=collection_archive---------1-----------------------#2020-06-16">https://infosecwriteups.com/weak-permissions-on-windows-service-privilege-escalation-e8fa97ce4a54?source=collection_archive---------1-----------------------#2020-06-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ae2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">…用户对服务exe具有“写”访问权限；服务二进制路径的文件夹。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/0098b3ea62adbdbea601eba7f75e2f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e5pRHYZH4GUCdJjaYVcdEg.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">错误配置的服务| <a class="ae le" href="https://www.pexels.com/photo/computer-content-control-data-270700/" rel="noopener ugc nofollow" target="_blank">像素</a></figcaption></figure><p id="2fa9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lf">假设你在受害者的Windows操作系统机器上运行powershell。</em></p><p id="e4a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lf">这篇文章讨论了作为“本地系统”运行的易受攻击的服务如何被标准用户利用，并获得权限提升成为“管理员”。</em></p></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><p id="608e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下载<a class="ae le" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1" rel="noopener ugc nofollow" target="_blank"> PowerUp.ps1 </a>并导入IMG 1中所示的模块。—我们现在准备好出发了！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ln"><img src="../Images/96956b688ba39e150acfc443352279b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tlpp1LILhlkR2gEcBMz9yA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">IMG 1号。执行Invoke-AllChecks函数来检查任何系统配置错误。</figcaption></figure><blockquote class="lo"><p id="1866" class="lp lq it bd lr ls lt lu lv lw lx kn dk translated">调用所有检查</p></blockquote><p id="c120" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">powerup.ps1的这个函数检查系统配置错误，并列出可能被利用的攻击媒介。</p><blockquote class="lo"><p id="4c23" class="lp lq it bd lr ls md me mf mg mh kn dk translated">sc.exe—Windows服务的服务控制</p></blockquote><p id="e083" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">这个内置的窗口可执行文件允许查询windows服务的配置细节。如我们所见，此易受攻击的服务“SQLWriter”作为“LocalSystem”运行。因此，利用此服务可以让我们获得系统级权限。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mi"><img src="../Images/12dd98cdd4ef6e41e403da0fd4041005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrbbtf26AC4x5mMEZc29xQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">IMG 2。显示SQLWriter服务配置详细信息。</figcaption></figure><blockquote class="lo"><p id="557e" class="lp lq it bd lr ls lt lu lv lw lx kn dk translated">从“用户”权限升级到本地组“管理员”权限</p></blockquote><p id="920c" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">正如我们在“IMG一号”中看到的和“IMG-2”一样，名为“SQLWriter”的服务具有LocalSystem特权，也具有弱服务权限。此易受攻击的服务将允许本地用户获得管理员级别的权限。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mj"><img src="../Images/1abd060c94ea1a165ae3b256cc22d267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2kUn8Wu5aeMxwES0d_1lhQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">IMG 3。</figcaption></figure><blockquote class="lo"><p id="a863" class="lp lq it bd lr ls lt lu lv lw lx kn dk translated">从本地组“管理员”升级到“系统”</p></blockquote><figure class="ml mm mn mo mp kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mk"><img src="../Images/cc9630f7aed29b0ceb1c5bc24b0f1504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JjpUm_-YPyesu3oibbK1gw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">IMG 4。</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mq"><img src="../Images/74f19d549803030fb4ade0df34eadf22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MSjjcEPPxJQAQbUaZk1hlg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">IMG 5号。</figcaption></figure><p id="509f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">IMG-4。-“SQL writer”的二进制路径与命令外壳可执行文件一起注入。</p><p id="803b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">IMG五号。obj是用“LocalSystem”注入的</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mr"><img src="../Images/95b42ef320ec165e96f442f242893fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pt1w__ASHNMPyV9TrJgobg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">IMG 6。“SQLWriter”服务的已修改二进制路径</figcaption></figure><p id="83ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，在执行“SQLWriter”服务之前，在攻击者的机器上启动netcat。</p><blockquote class="ms mt mu"><p id="f1bf" class="jq jr lf js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">$ nc -lvnp 9998。—来自攻击者的机器</p><p id="f9a9" class="jq jr lf js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">$ net start sqlwriter —从受害者的机器上</p></blockquote><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi my"><img src="../Images/08e8d2a49c3f93375e6e49172c0c285d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dS-JBHAGv6ikkOT5P-qBgQ.png"/></div></div></figure></div></div>    
</body>
</html>