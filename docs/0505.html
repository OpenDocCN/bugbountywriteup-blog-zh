<html>
<head>
<title>Networking basics: What is the Address Resolution Protocol and how to hack it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络基础:什么是地址解析协议，如何破解</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/networking-basics-what-is-the-address-resolution-protocol-and-how-to-hack-it-96c30ccea14c?source=collection_archive---------0-----------------------#2020-03-04">https://infosecwriteups.com/networking-basics-what-is-the-address-resolution-protocol-and-how-to-hack-it-96c30ccea14c?source=collection_archive---------0-----------------------#2020-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="818d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python的ARP介绍和ARP欺骗/代理攻击教程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/23696d11f20d214afb57d18669b86cd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e0Xvs8iURPRS_ABK8wuAFA.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h2 id="c44e" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">地址解析协议(ARP)简介</h2><p id="712b" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">ARP代表地址解析协议，是网络用来将系统的IP地址映射到计算机上的物理地址(也称为MAC地址)的协议。</p><p id="58b6" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">您可以将MAC地址视为唯一的序列号，用于在世界上标识您的机器。它通常是42或64位标识符，需要通过WiFi或以太网在本地连接上进行通信。</p><p id="fa52" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">而互联网协议(IP)地址可以被认为是唯一的系统标签，用于标识您在网络中的位置，以便其他计算机知道如何通过其他网络与您通信。IP地址通常是动态的，这意味着当你进入一个网络时(例如打开你的笔记本电脑访问工作WiFi),<a class="ae mv" href="https://www.lifewire.com/what-is-dhcp-2625848" rel="noopener ugc nofollow" target="_blank">DHCP</a>将为你提供一个新的IP地址(并不总是这样！).你可以在这里阅读更多关于静态和动态IP地址的信息:【https://whatismyipaddress.com/dynamic-static<a class="ae mv" href="https://whatismyipaddress.com/dynamic-static" rel="noopener ugc nofollow" target="_blank">。</a></p><blockquote class="mw mx my"><p id="4daa" class="lx ly mz lz b ma mq ju mc md mr jx mf na ms mh mi nb mt mk ml nc mu mn mo mp im bi translated">“为了进一步解释，我们假设您的MAC地址是您的物理邮箱，您的IP地址是您的邮政地址，互联网是您的邮局，路由器是您的邮政运营商。现在你的邮局会知道你的邮政地址，并能够给你发送一封邮件。然后你就可以通过邮递员接收邮件了。由于您的邮箱和邮政地址都在邮件的接收端，我们可以说邮政承运人知道您的地址和邮箱，但您的邮局不知道，除了您的邮政地址。”—<a class="ae mv" href="https://theydiffer.com/difference-between-a-mac-address-and-an-ip-address/#IP_Address" rel="noopener ugc nofollow" target="_blank">https://they difference . com/difference-a-MAC-Address-and-a-IP-Address/# IP _ Address</a></p></blockquote><h2 id="f63b" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">如果MAC地址是唯一的，为什么我们需要IP地址？</h2><p id="c0dc" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">要让网络将数据包(数据)传送到您的计算机，它必须知道如何在每个外部网络之间传输，以将信息传送到您的本地网络，然后最终传送到您的物理机。诸如<a class="ae mv" href="https://medium.com/bugbountywriteup/bgp-the-weak-link-in-the-internet-what-is-bgp-and-how-do-hackers-exploit-it-d899a68ba5bb" rel="noopener"> BGP </a>之类的路由协议使用IP地址来确定外部网络之间数据包的下一个目的地。这是通过查看IP地址并确定最长的前缀匹配来完成的。与IP地址不同，MAC地址没有层次结构；因此，网络不知道将数据包转发到哪里。</p><h2 id="7a82" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">ARP是如何工作的？</strong></h2><p id="010a" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">这个视频很好地解释了ARP是如何工作的，但是对于那些想要快速运行的人来说，请继续阅读。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ee47" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu">场景</strong>:电脑A、B、C、D都在同一个局域网内(比如你家)。计算机A希望向计算机b发送信息，让我们看看这是如何做到的。</p><ol class=""><li id="6f7b" class="nf ng it lz b ma mq md mr lk nh lo ni ls nj mp nk nl nm nn bi translated">计算机A检查其ARP缓存，以确定它是否可以将目标IP地址映射到MAC地址(也称为计算机B)。<em class="mz">(注:运行</em> <code class="fe no np nq nr b"><em class="mz">arp -an</em></code> <em class="mz">)检查你机器的ARP缓存</em></li><li id="dfc2" class="nf ng it lz b ma ns md nt lk nu lo nv ls nw mp nk nl nm nn bi translated">如果地址没有列在ARP缓存中，那么计算机A通过整个网络发送广播消息，询问该IP地址的所有者。(<em class="mz">注意:广播消息是用FF-FF-FF-FF-FF-FF的MAC地址</em>创建的)</li><li id="fb5a" class="nf ng it lz b ma ns md nt lk nu lo nv ls nw mp nk nl nm nn bi translated">然后，该IP地址的所有者将包含与该IP地址相关联的MAC地址的ARP数据包发送回计算机a。</li><li id="b934" class="nf ng it lz b ma ns md nt lk nu lo nv ls nw mp nk nl nm nn bi translated">收到请求后，计算机A将MAC地址存储在其ARP缓存中，现在可以与计算机B通信，直到缓存过期。</li></ol><h2 id="3e84" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">ARP欺骗的基础知识</h2><p id="a574" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">现在我们知道了两台计算机之间的通信是如何开始的，我们如何利用这一点呢？ARP请求是一个未经验证的请求，这意味着任何设备都可以自由回复并声明自己是该IP地址的所有者。这将允许攻击者谎报ip地址的所有权，发回ARP回复，并导致发送者错误地更新其缓存，这意味着将来发送的信息将发送给攻击者，而不是预定的目标。这可能是执行拒绝服务(DOS)攻击的有效方式。或者，攻击者可以设置一个ARP代理，基本上是在两台计算机之间的任何通信中充当中间人，而它们中的任何一台都不知道。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h2 id="a904" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">如何进行ARP欺骗</strong></h2><p id="a8c0" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">理论已经足够好了，让我们深入了解一下，并实际执行一次ARP欺骗攻击。为此，我将使用python 3作为语言选择，因为它有强大的Scapy库。</p><p id="d996" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">这个脚本将利用Scapy库。这是他们网站上对Scapy的描述:</p><blockquote class="mw mx my"><p id="b67d" class="lx ly mz lz b ma mq ju mc md mr jx mf na ms mh mi nb mt mk ml nc mu mn mo mp im bi translated">Scapy是一个强大的基于Python的交互式包操作程序和库。它能够伪造或解码大量协议的数据包，通过网络发送它们，捕获它们，使用pcap文件存储或读取它们，匹配请求和回复，等等。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/88000733fa04b966b7bc4f1b1f183ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iEIhHbOEozvCYc2yKx-RtA.png"/></div></div><figcaption class="ny nz gj gh gi oa ob bd b be z dk translated"><a class="ae mv" href="https://scapy.readthedocs.io/en/latest/usage.html#simple-one-liners" rel="noopener ugc nofollow" target="_blank">https://scapy . readthe docs . io/en/latest/usage . html #简单的一行程序</a></figcaption></figure><p id="eaeb" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">让我们试着理解这里发生了什么。从顶部的一行我们可以看到，我们发送了两个数据包。一个<a class="ae mv" href="https://www.networkworld.com/article/3225865/ethernet-frames-and-packets-whats-the-difference.html" rel="noopener ugc nofollow" target="_blank">以太网帧</a>正在被发送到目的MAC地址<code class="fe no np nq nr b">clientMac</code>并且一个ARP数据包也正在被发送(该<code class="fe no np nq nr b">/</code>被用来堆叠数据包)。但是在这个ARP数据包中使用的所有这些附加参数是什么呢？要理解这一点，我们需要了解ARP数据包是如何构造的，以及Scapy如何理解ARP数据包。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/899f9d1e526004f1776f4abaa5d93e48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1h3_9mhXrDdE8mPyGAjBWw.png"/></div></div><figcaption class="ny nz gj gh gi oa ob bd b be z dk translated">左边和右边的ARP数据包是Scapy ARP数据包</figcaption></figure><p id="49a7" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">现在我们知道<code class="fe no np nq nr b">psrc</code>是我们设置给<code class="fe no np nq nr b">gateway IP</code>的源协议地址。<code class="fe no np nq nr b">pdst</code>也表示被设置为<code class="fe no np nq nr b">client IP</code>的目标/目的地协议地址。<code class="fe no np nq nr b">op</code> param是一个enum，对于ARP请求(默认)它的值为1，对于ARP回复它的值为2。</p><p id="5773" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">最后，我们在<code class="fe no np nq nr b">send</code>函数上设置了几个参数，即<code class="fe no np nq nr b">inter</code>和<code class="fe no np nq nr b">loop</code>。Inter用于指定发送每个数据包的时间间隔(以秒为单位),而loop是不言自明的。</p><p id="8bde" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><em class="mz">注:见</em> <a class="ae mv" href="https://scapy.readthedocs.io/en/latest/api/scapy.layers.l2.html#scapy.layers.l2.arpcachepoison" rel="noopener ugc nofollow" target="_blank"> <em class="mz">此处</em> </a> <em class="mz">有一个简单的函数可以毒化ARP缓存。</em></p><h2 id="6d41" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">创建ARP欺骗脚本</h2><p id="a70b" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">使用上面讨论的所有内容，并借助scapy的强大功能，我们可以创建一个脚本来欺骗本地网络和网关上的任何目标，让自己成为中间人。这是如何做到的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="od ne l"/></div><figcaption class="ny nz gj gh gi oa ob bd b be z dk translated">ArpSpoofer.py</figcaption></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><p id="a8eb" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><em class="mz">免责声明:请勿将上述脚本用于任何非法活动。这纯粹是出于教育目的，我不负责因执行上述脚本而导致的任何损害。</em></p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><p id="4c60" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><em class="mz">关注</em> <a class="ae mv" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="mz"> Infosec报道</em> </a> <em class="mz">获取更多此类精彩报道。</em></p><div class="oe of gp gr og oh"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd iu gy z fp om fr fs on fu fw is bi translated">信息安全报道</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">medium.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov ks oh"/></div></div></a></div></div></div>    
</body>
</html>