<html>
<head>
<title>HackTheBox Canvas CTF Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HackTheBox画布CTF特写</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-canvas-ctf-writeup-75b0f4682ef5?source=collection_archive---------3-----------------------#2022-10-04">https://infosecwriteups.com/hackthebox-canvas-ctf-writeup-75b0f4682ef5?source=collection_archive---------3-----------------------#2022-10-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0e9bed82d46ecb8103a1db24be1eb50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_q1qNJf8CM543SwvZ-Meog.png"/></div></div></figure><p id="42cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">描述:</strong></p><p id="b90f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们想更新我们的网站，但我们不能，因为开发人员谁编码今天离开了。你能看一下吗？</p><p id="df24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">解决方案:</strong></p><p id="9fb9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">解压后的文件内容，我们从任务中可以看到我们得到了一些文件，这似乎是网站的文件，包括javascript，CSS和dashborad.html，和index.html。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="ab gu cl la"><img src="../Images/204e1e2d292f514607329a52ec716d0d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*9smN0WWByQvIo2ds36ajnA.png"/></div></figure><p id="1bb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">起初，我想到让我们在浏览器中打开index.html，看看到底有什么！！</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="ab gu cl la"><img src="../Images/5edf0ded4ce5e6c653e4e83e85c5a3c0.png" data-original-src="https://miro.medium.com/v2/format:webp/1*kdvYC--jGsTVHdXukZSX_A.png"/></div></figure><p id="ea41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，我们得到了一些登录页面，因为所有内容都是静态的，这意味着javascript代码将被用于身份验证目的，所以出于好奇，我输入了一些随机的凭证，然后得到了这个弹出窗口:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="ab gu cl la"><img src="../Images/1789420d4224238b949e6c5182c0e17b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*EtJ6HXHife6V0dCIZPJrjQ.png"/></div></figure><p id="9f14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，意味着javascript代码被用来计算错误的尝试。三次尝试失败后，用户名和密码字段将变得不可点击。(我们可以让它正常；只需刷新页面)</p><p id="166b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在尝试计算出信用额度后，我随机使用了通用尝试信用额度<strong class="ka ir"> admin: admin </strong>，我得到了这个弹出窗口！！</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="ab gu cl la"><img src="../Images/5b53ac275627bfd7dc714fb6eb7c9b62.png" data-original-src="https://miro.medium.com/v2/format:webp/1*20KqRJa8anc2uPVQeRxkYQ.png"/></div></figure><p id="dc11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们被重定向到dahsboard.html，它包含了旗帜模板，而不是真正的旗帜。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="ab gu cl la"><img src="../Images/58223070bd6b94f7a0a226d8ae6b013b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*TrbdwJMQqDlqAu9YRtFgXg.png"/></div></figure><p id="328f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我试图查看源代码和其他cookies，但是没有任何有趣的东西出现。到目前为止，我还没有分析javascript文件。所以我们来分析一下。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="ab gu cl la"><img src="../Images/49b0f351d7478a3216b25eb128907f26.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ekj1rKZS4iM6YTlLyajbWA.png"/></div></figure><p id="7fc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开javascript文件后，一切都是乱码。javascript混淆是为了让它更难理解。所以让我们来讨论一下，我将使用一个在线工具:<a class="ae lb" href="https://lelinhtinh.github.io/de4js/" rel="noopener ugc nofollow" target="_blank">https://lelinhtinh.github.io/de4js/</a></p><p id="7cae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你可以看到去模糊化的javascript源代码:</p><pre class="kw kx ky kz gt lc ld le lf aw lg bi"><span id="48df" class="lh li iq ld b gy lj lk l ll lm">'use strict';<br/><br/>var _0x4e0b = ["toString", "username", "console", "getElementById", "log", "bind", "disabled", "apply", "admin", "prototype", '{}.constructor("return this")( )', " attempt;", "value", "constructor", "You have left ", "trace", 'return /" + this + "/', "table", "length", "__proto__", "error", "Login successfully"];<br/>(function (params, content) {<br/><br/>    var fn = function (selected_image) {<br/>        for (; --selected_image;) {<br/>            params["push"](params["shift"]());<br/>        }<br/>    };<br/><br/>    var build = function () {<br/>        var target = {<br/>            "data": {<br/>                "key": "cookie",<br/>                "value": "timeout"<br/>            },<br/>            "setCookie": function (value, name, path, headers) {<br/>                headers = headers || {};<br/><br/>                var cookie = name + "=" + path;<br/><br/>                var _0x3f3096 = 0;<br/><br/>                var url = 0;<br/>                var key = value["length"];<br/>                for (; url &lt; key; url++) {<br/>                    var i = value[url];<br/><br/>                    cookie = cookie + ("; " + i);<br/>                    var char = value[i];<br/>                    value["push"](char);<br/>                    key = value["length"];<br/>                    if (char !== !![]) {<br/><br/>                        cookie = cookie + ("=" + char);<br/>                    }<br/>                }<br/><br/>                headers["cookie"] = cookie;<br/>            },<br/>            "removeCookie": function () {<br/>                return "dev";<br/>            },<br/>            "getCookie": function (match, href) {<br/>                match = match || function (canCreateDiscussions) {<br/>                    return canCreateDiscussions;<br/>                };<br/>                var v = match(new RegExp("(?:^|; )" + href["replace"](/([.$?*|{}()[]\/+^])/g, "$1") + "=([^;]*)"));<br/><br/>                var test = function (callback, i) {<br/>                    callback(++i);<br/>                };<br/>                return test(fn, content), v ? decodeURIComponent(v[1]) : undefined;<br/>            }<br/>        };<br/><br/>        var init = function () {<br/><br/>            var test = new RegExp("\\w+ *\\(\\) *{\\w+ *['|\"].+['|\"];? *}");<br/>            return test["test"](target["removeCookie"]["toString"]());<br/>        };<br/><br/>        target["updateCookie"] = init;<br/><br/>        var array = "";<br/>        var _0x4ac08e = target["updateCookie"]();<br/>        if (!_0x4ac08e) {<br/>            target["setCookie"](["*"], "counter", 1);<br/>        } else {<br/>            if (_0x4ac08e) {<br/>                array = target["getCookie"](null, "counter");<br/>            } else {<br/>                target["removeCookie"]();<br/>            }<br/>        }<br/>    };<br/>    build();<br/>})(_0x4e0b, 386);<br/><br/>var _0x20fe = function (level, ai_test) {<br/><br/>    level = level - 0;<br/>    var rowsOfColumns = _0x4e0b[level];<br/>    return rowsOfColumns;<br/>};<br/>var _0x35c856 = function () {<br/><br/>    var y$$ = !![];<br/>    return function (ch, myPreferences) {<br/><br/>        var voronoi = y$$ ? function () {<br/><br/>            var getPreferenceKey = _0x20fe;<br/>            if (myPreferences) {<br/>                var bytes = myPreferences[getPreferenceKey("0x11")](ch, arguments);<br/>                return myPreferences = null, bytes;<br/>            }<br/>        } : function () {};<br/>        return y$$ = ![], voronoi;<br/>    };<br/>}();<br/>var _0x4ac08e = _0x35c856(this, function () {<br/><br/>    var checkApplyFunction = function () {<br/><br/>        var check = _0x20fe;<br/>        var B713 = checkApplyFunction[check("0x1")](check("0x4"))()[check("0x1")]("^([^ ]+( +[^ ]+)+)+[^ ]}");<br/>        return !B713["test"](_0x4ac08e);<br/>    };<br/>    return checkApplyFunction();<br/>});<br/>_0x4ac08e();<br/>var _0x4c641a = function () {<br/><br/>    var y$$ = !![];<br/>    return function (ch, myPreferences) {<br/><br/>        var voronoi = y$$ ? function () {<br/><br/>            var getPreferenceKey = _0x20fe;<br/>            if (myPreferences) {<br/>                var bytes = myPreferences[getPreferenceKey("0x11")](ch, arguments);<br/>                return myPreferences = null, bytes;<br/>            }<br/>        } : function () {};<br/>        return y$$ = ![], voronoi;<br/>    };<br/>}();<br/>var _0x2548ec = _0x4c641a(this, function () {<br/><br/>    var rel2Mstr = _0x20fe;<br/>    var el;<br/>    try {<br/>        var render = Function("return (function() " + rel2Mstr("0x14") + ");");<br/>        el = render();<br/>    } catch (_0x57823f) {<br/><br/>        el = window;<br/>    }<br/>    var uids = el[rel2Mstr("0xc")] = el[rel2Mstr("0xc")] || {};<br/><br/>    var levels = [rel2Mstr("0xe"), "warn", "info", rel2Mstr("0x8"), "exception", rel2Mstr("0x5"), rel2Mstr("0x3")];<br/><br/>    var j = 0;<br/>    for (; j &lt; levels[rel2Mstr("0x6")]; j++) {<br/>        var intval = _0x4c641a[rel2Mstr("0x1")][rel2Mstr("0x13")]["bind"](_0x4c641a);<br/>        var i = levels[j];<br/>        var same = uids[i] || intval;<br/>        intval[rel2Mstr("0x7")] = _0x4c641a[rel2Mstr("0xf")](_0x4c641a);<br/>        intval["toString"] = same[rel2Mstr("0xa")][rel2Mstr("0xf")](same);<br/>        uids[i] = intval;<br/>    }<br/>});<br/>_0x2548ec();<br/><br/>var attempt = 3;<br/><br/>function validate() {<br/><br/>    var _ = _0x20fe;<br/>    var oldValue = document["getElementById"]("username")["value"];<br/>    var newValue = document[_("0xd")]("password")[_("0x0")];<br/>    if (oldValue == _("0x12") &amp;&amp; newValue == _("0x12")) {<br/>        return alert(_("0x9")), window["location"] = "dashboard.html", ![];<br/>    } else {<br/>        attempt--;<br/>        alert(_("0x2") + attempt + _("0x15"));<br/>        if (attempt == 0) {<br/>            return document[_("0xd")](_("0xb"))["disabled"] = !![], document[_("0xd")]("password")[_("0x10")] = !![], document[_("0xd")]("submit")[_("0x10")] = !![], ![];<br/>        }<br/>    }<br/>}<br/>var res = String["fromCharCode"](72, 84, 66, 123, 87, 51, 76, 99, 48, 109, 51, 95, 55, 48, 95, 74, 52, 86, 52, 53, 67, 82, 49, 112, 55, 95, 100, 51, 48, 98, 70, 117, 53, 67, 52, 55, 49, 48, 78, 125, 10);</span></pre><p id="4fcd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我试图理解代码，但并没有完全理解</p><p id="9b69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是最后一个变量<code class="fe ln lo lp ld b">res</code>并没有在任何地方使用，而且似乎很有趣。其中使用了代码<code class="fe ln lo lp ld b">String.fromCharCode</code>。我们只需解码它，就能理解那个变量的值是什么</p><pre class="kw kx ky kz gt lc ld le lf aw lg bi"><span id="ad3b" class="lh li iq ld b gy lj lk l ll lm">72, 84, 66, 123, 87, 51, 76, 99, 48, 109, 51, 95, 55, 48, 95, 74, 52, 86, 52, 53, 67, 82, 49, 112, 55, 95, 100, 51, 48, 98, 70, 117, 53, 67, 52, 55, 49, 48, 78, 125, 10</span></pre><p id="5dda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，我将使用<strong class="ka ir"> cyberchef </strong>，首先，让我们替换中间的空格，然后我们可以使用<strong class="ka ir"> magic </strong>或十进制中的<strong class="ka ir">作为配方</strong></p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/6ffd6e0260a9256b7b26771ac2bc5011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N55C-viKatSBgzVUp9UI8w.png"/></div></div></figure><p id="434b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所见，我们得到了我们的旗帜！！！！</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/e2e7d3618cf9ef61298aace92f0152e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*yxzIuWWpZDZtuHuvSTZpqA.gif"/></div></figure><p id="05d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢你看我的文章！！👊👊</p><p id="91a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请在媒体和其他社交平台上关注我，支持我:</p><p id="18a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lb" href="https://surya-dev.medium.com/" rel="noopener">https://surya-dev.medium.com/</a></p><p id="4711" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lb" href="https://twitter.com/kryolite_secure" rel="noopener ugc nofollow" target="_blank">https://twitter.com/kryolite_secure</a>/</p><p id="677d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">https://<a class="ae lb" href="http://www.instagram.com/kryolite_security/" rel="noopener ugc nofollow" target="_blank">www.instagram.com/kryolite_security/</a></p><p id="bb62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lb" href="https://github.com/surya-dev-singh/" rel="noopener ugc nofollow" target="_blank">https://github.com/surya-dev-singh/</a></p><p id="7b4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你们可以订阅我🙌在YouTube上:<strong class="ka ir">我在那里发布演练和其他道德黑客相关的视频。</strong></p><div class="ls lt gp gr lu lv"><a href="https://www.youtube.com/channel/UCNKXlqfPevPg2Cv1R5YZ6Jw" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">Kryolite安全公司</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">你好世界！在Kryolite Security上，你可以找到关于道德黑客、网络安全、渗透测试、CTFs的视频…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">www.youtube.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj jw lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a rel="noopener  ugc nofollow" target="_blank" href="/bitb-browser-in-the-browser-attack-e2008c405701"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">BITB(浏览器中的浏览器)攻击</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">使用BITB攻击使网络钓鱼几乎不可检测！！</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">infosecwriteups.com</p></div></div><div class="me l"><div class="mk l mg mh mi me mj jw lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://systemweakness.com/attacktive-directory-tryhackme-90465c2d48ea" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">攻击目录—利用易受攻击的域控制器[TryHackMe]</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">99%的企业网络使用AD。但是您能利用易受攻击的域控制器吗？</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">systemweakness.com</p></div></div><div class="me l"><div class="ml l mg mh mi me mj jw lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a rel="noopener  ugc nofollow" target="_blank" href="/baron-samedit-cve-2021-3156-tryhackme-76d7dedc3cff"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">巴隆·萨姆迪特·CVE</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">在Unix Sudo程序中探索CVE-2021–3156的教程演练。</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">infosecwriteups.com</p></div></div><div class="me l"><div class="mm l mg mh mi me mj jw lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://systemweakness.com/dirty-pipe-cve-2022-0847-tryhackme-7a652910596b" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">脏管道:CVE-2022–0847</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">利用Linux内核中的脏管道(CVE-2022–0847)的交互式实验室的tryhackme演练</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">systemweakness.com</p></div></div><div class="me l"><div class="mn l mg mh mi me mj jw lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://systemweakness.com/nmap-the-complete-guide-part-1-4f6464c94edd" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">Nmap —完整指南[第1部分]</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">Nmap侦察—完整指南</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">systemweakness.com</p></div></div><div class="me l"><div class="mo l mg mh mi me mj jw lv"/></div></div></a></div><h2 id="77be" class="lh li iq bd mp mq mr dn ms mt mu dp mv kj mw mx my kn mz na nb kr nc nd ne nf bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lb" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>