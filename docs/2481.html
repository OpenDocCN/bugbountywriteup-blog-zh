<html>
<head>
<title>Banking Trojan Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">银行木马分析</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/banking-trojan-analysis-edb374bdb9d9?source=collection_archive---------2-----------------------#2022-10-27">https://infosecwriteups.com/banking-trojan-analysis-edb374bdb9d9?source=collection_archive---------2-----------------------#2022-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/083d9c2f15d5729d22c5dbf46c125e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lSTiKxNyxiDSM7-dhEqObg.png"/></div></div></figure><p id="18c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我最近偶然发现了一个有趣的恶意文档，我想为您分析一下。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/1147d3c5901f75b03a8740316985a232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k8WiB55i8mx_rm94"/></div></div></figure><p id="2d92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最初的扫描显示，该文件是由一些大的名字，如谷歌，赛门铁克，Fortinet检测…</p><p id="5e97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，让我们看看我们能找到什么，如果我们挖得更深一点！</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/24566aa12bc1e392ecaf0c0803aed4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L-I6XoezR_2CpGQi"/></div></div></figure><p id="7bda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行File命令验证它是一个HTML文档。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/9463b9896db272c0c623c7d8cd7776c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QFdaC7DV20RQpMgt"/></div></div></figure><p id="404d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在检查初始HTML (stage1)文档时，我们可以看到页面立即执行带有onload函数的javascript。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ld"><img src="../Images/ee98e64a84681a9c9422ffb95a61dced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aABkIZgIRzOUTUP6P4ibZQ.png"/></div></div></figure><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi le"><img src="../Images/b3fab577f9d3b93f05a6f2636f664b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eytxxCipcOJXtlf2"/></div></div></figure><p id="2f29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该功能似乎正在加载漏洞利用的第二阶段。这是base64编码的数据。我们可以从代码中看出它是image/svg+xml，但是我们也可以通过获取base64编码的有效负载来验证它。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/16a9e6bb1bbc77576771a9c5722f835d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/0*ExDYa3BpkHTYVb1L"/></div></figure><p id="be47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">酷毙了。现在我们有了第二阶段的文件，让我们继续分析。</p><p id="76f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以在文本编辑器中打开stage2文件，并对其进行一些语法突出显示，以获得更好的可视性。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/395d421f69f287e392146b8154ef34a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UvxF5lLCCXYYmCHF"/></div></div></figure><p id="da12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到这里有javascript代码。让我们创建一个stage3文件，并将javascript代码移动到一个单独的文档中，以便进一步分析。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/fbc6cb8c542c33e2ea6724cf1714ad2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l0Porv9XR-BhlR_R"/></div></div></figure><p id="4a6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">变量名很容易混淆。我们可以尝试从逻辑上理解代码和混淆的变量。并清理它，以更好地了解发生了什么。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/8f810b8885cf946b542842a644b4910b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D7sFLmI1VPFiu_bdV5noTQ.png"/></div></div></figure><p id="9eff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在一些基本的清理之后，我们可以看到在第36行有一个函数调用，参数设置为我们的下一个有效载荷和整数512。该函数似乎循环通过base64编码的有效负载，对其进行解码，并将其写入文件。</p><p id="47be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">似乎我们应该期待下一阶段的文件是一个存档！</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/8b4f7f6cf51fcff3a14d70de9bc35f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/0*VaJDX5C5t96csoRI"/></div></figure><p id="b9b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们所怀疑的，我们只剩下一个Zip存档数据。让我们看看里面有什么。</p><p id="89f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将该文件重命名为filestage4.zip，并对其运行unzip。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lj"><img src="../Images/dcb4fdb71b515f816cdffa91f181373c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QN0Xc9_lMbHCq1Hb"/></div></div></figure><p id="a6ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当试图解压文件时，要求输入密码。经过老约翰的修改，我们破解了密码，结果是“abc111”。</p><p id="17ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但这对我来说没有任何意义，至于为什么我必须破解密码才能提取恶意软件。后来当我在any.run上打开恶意软件时，我意识到密码是在最初的HTML文件中给出的。LOL。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lk"><img src="../Images/85f60994e297f2db154cec606235faac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vdoUzrDEBT-4Sf3l"/></div></div></figure><p id="669a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">无论如何…让我们继续前进…</p><p id="f436" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从档案中提取文件给我们一个. iso文件。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/6994d8d6594748da954add97619d4535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lKom0Nmal2Um9GzT"/></div></div></figure><p id="dbe2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我挂载了图像文件来查看它的内容。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/3909fade58e346a541b69d2412d54524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mUmt2Lo6FugwXjdI"/></div></div></figure><p id="e154" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将它移动到/tmp目录，并卸载映像，这样我就不会忘记它。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/64f7a7aefefe8d1f214b4f8a554bea4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/0*CMIGnPpQsyoM9dhk"/></div></figure><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/bc6af086912bd64e3611c248e8874da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/0*i9Gd_t-HX7kp1SXN"/></div></figure><p id="6e7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在图像中，我们看到了以下文件。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/1db9f12563aaaa1ce4a5d32792d39b45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iLiCUBNAyApP3I89"/></div></div></figure><p id="b1c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ComplianceReportCopy.lnk是一个windows快捷方式文件</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/491e82f311022c1b1ee44224c33c0468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l2i5t5eyS_ZeFEzB"/></div></div></figure><p id="261a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">impulsed . cmd和broadsheets.dat看起来特别有趣</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/122baf783d621119fc1d6d83506d60c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_8in9jwAygshFxgf"/></div></div></figure><p id="5947" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">impulsed . cmd是一个dos批处理文件，似乎在做一些字符串混淆。</p><p id="5c76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它似乎正在构建字符串“copy % systemroot % \ System32 \ 1vr 32 . exe % temp \ given bind . com ”,并且似乎还在运行broadsheets.dat</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/5ace6fd6d504c27ef1e9e85f7b6f7981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F25e6pafoGlHjh9c"/></div></div></figure><p id="baad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">哦！多汁的Windows PE32可执行文件。喜欢看。让我们把它上传到Virustotal，看看它是否能捕捉到什么。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/5e8f8ebcbf26d995c03549f7f0bae766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xt83Au5vDq-eaorg"/></div></div></figure><p id="d7ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">哇哦。迅速升级:)</p><p id="96df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大多数AVs将可执行文件标识为Qbot。</p><p id="9ce6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">QBot是一个模块化的信息窃取者。自2007年以来，它已经活跃了多年。它在历史上被称为银行特洛伊木马，这意味着它从受感染的系统中窃取金融数据，并且是一个使用C2服务器进行有效负载定位和下载的加载程序。</p><p id="8dc8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">QBot，也称为Qakbot、QBot、QuackBot和Pinkslipbot，仍然是对组织的一种危险和持续的威胁，并且已经成为全球领先的银行特洛伊木马之一。</p><p id="e7d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Toodaloo。黑客快乐！</p><h1 id="65a8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">IOCs</h1><p id="8dbf" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">7 c 8 b 1 ddfedaad 57 AC 7021 D5 ea 976 df 64281 df 373</p><p id="b82a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">da 8615 c 02 da 6941 b 17 a 50 f 778 f 8090 f 581595 e7a</p><p id="8a6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">d6d 88 aff8e 2 a 0308470755 acdd 72 BC 0 c 8574 BBA</p><p id="6a27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">a 8 a 0 af 138368 e 734 de 4c 19 FB 4 AC 766 f 5577 a2 f 897 Fe 88 e 4c 27 f 0 C4 C2 D3 FB 3 aa 8</p></div></div>    
</body>
</html>