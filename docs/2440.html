<html>
<head>
<title>Why do Deserialization Vulnerabilities occur?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么会出现反序列化漏洞？</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/why-do-deserialization-vulnerabilities-occur-577aafd39785?source=collection_archive---------0-----------------------#2022-10-11">https://infosecwriteups.com/why-do-deserialization-vulnerabilities-occur-577aafd39785?source=collection_archive---------0-----------------------#2022-10-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/86c499d3a60015f3c57c32b2ab8e6ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VUUVxdI0qSHdO_ksAExrqQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在<a class="ae kf" href="https://unsplash.com/s/photos/hacking?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kf" href="https://unsplash.com/@towfiqu999999?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Towfiqu barb huya</a>拍摄的照片</figcaption></figure><p id="caf1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">简介</strong></p><p id="d892" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">网络应用不再是21世纪初的样子了。它们进化成了完全不同的东西。此外，它们有能力存储和分析复杂的数据结构。虽然这增加了复杂性，但如果处理不当，也增加了不可想象的后果的可能性。</p><p id="acbb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将最终导致权限升级，这几乎总是会危及用户数据，导致组织的声誉和财务资源的损失。我们将要讨论的漏洞之一是不安全的反序列化。</p><p id="544d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不安全的反序列化曾经在OWASP十大漏洞中排名第八，现在已经与其他漏洞并列，并被重命名为软件和数据完整性故障。</p><p id="2d57" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">什么是反序列化漏洞，为什么会出现？</strong></p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/98656d14e30d1192bbe66cc91f811d0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3lxylWiLpfvLfCPLwQMJNA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://medium.com/tech-learnings/serialization-filtering-deserialization-vulnerability-protection-in-java-349c37f6f416" rel="noopener">来源</a></figcaption></figure><p id="eac0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你认为web应用程序如何处理、存储和传输数据对象？</p><p id="62c6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，考虑这样一个场景，其中应用程序有许多不同的角色，并且应用程序希望在同一个会话cookie或参数中管理身份验证和授权，以同时解决两个难题。这意味着不需要进行耗时的操作，例如从颁发给用户的会话ID中检索权限；相反，您可以简单地从cookie或header中检索角色，然后将特定的权限分配给用户，这样用户跟踪也会很容易？</p><p id="aca5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面详细讨论一下。</p><p id="37ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有许多不同的属性将被分配给具有会话id的用户，例如</p><ol class=""><li id="be42" class="lj lk it ki b kj kk kn ko kr ll kv lm kz ln ld lo lp lq lr bi translated">用户名</li><li id="88eb" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">个人资料_图片</li><li id="ecaf" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">作用</li></ol><p id="b368" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您登录到应用程序时，在磁盘上传输或保存的是该对象的序列化形式。</p><p id="e22d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">什么是序列化？</strong></p><p id="b45b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将对象转换成字节流或平面结构称为序列化。这个“字节流”也是对象的一个扁平版本。现在可以通过网络发送，并保存在磁盘、文件和数据库中。但是，这个字节流如何转换回对象，以便我们以相同的权限再次访问应用程序呢？</p><p id="a743" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">反序列化</strong></p><p id="9993" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在编程语言中，反序列化是指将数据流转换为对象。现在它已经恢复到了原来的状态，您可以在方便的时候继续使用这个应用程序。</p><p id="e736" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是这怎么会是一个漏洞呢？</p><p id="4554" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果攻击者篡改字节流，而应用程序直接对其进行反序列化，这可能是一个漏洞。这可能导致权限升级、信息泄露，甚至远程执行代码。</p><p id="e053" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">剥削场景</strong></p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/3806070302716b322c8ed69271314fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*URB5cAjusaYx1JiEnv--sQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://medium.com/@bdemir/the-anatomy-of-deserialization-attacks-b90b56328766" rel="noopener">来源</a></figcaption></figure><p id="c06f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑一个定义了用户角色的动态web应用程序。默认情况下，如果任何用户注册了一个帐户，他将获得一个非管理员用户帐户。假设您用用户名ronald注册了一个帐户。web应用程序生成一个序列化的对象，然后将其作为cookie分配给用户。此内容是base64编码的。</p><p id="a007" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">tzo 0 oijvc 2 vyijoyontzog6 invzzxjuyw 1 Li jtzojy 6 injvbmfszci 7 czo 2 oijzdgf 0 dx mio 3m 6 oto IBM 90 igfkbwluijt 9cg = =</strong></p><p id="6911" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于这是base64编码，在解码时，我们得到:</p><p id="346a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> O:4:“用户”:2:{s:8:“用户名”；生:6:“罗纳德”；s:6:“地位”；s:9:“非admin”；} </strong></p><p id="b696" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">仔细查看cookie会发现对象的名称是“User ”,它有两个字段，用户名和状态，因为我们可以看到我们的用户名是ronald，状态是<strong class="ki iu">而不是admin </strong>。(s:9指“not admin”是一个字符串，长度为9)。</p><p id="04b9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们将<strong class="ki iu"> not admin改为admin </strong>，将s:9改为s:5(因为admin的长度是5个字符)，我们会得到以下结果:</p><p id="01e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> O:4:“用户”:2:{s:8:“用户名”；生:6:“罗纳德”；s:6:“地位”；s:5:“admin”；} </strong></p><p id="6cb4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对它进行Base64编码，我们得到:</p><p id="4c4f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">tzo 0 oijvc 2 vyijoyontzog6 invzzxjuyw 1 Li jtzojy 6 injvbmfszci 7 czo 2 oijzdgf 0 dx mio 3m 6 ntoiyywrtaw 4 io 30k</strong></p><p id="943b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们用被篡改的cookie替换了cookie，web应用程序将对它进行反序列化，并最终授予我们管理员访问权限。</p><p id="43a3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">补救</strong></p><p id="02c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些漏洞的出现是因为服务器直接执行或解析来自客户端的输入。攻击者可以轻易地利用服务器对客户端和用户的信任。</p><p id="6260" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以应用的一些补救机制有:</p><ol class=""><li id="ca05" class="lj lk it ki b kj kk kn ko kr ll kv lm kz ln ld lo lp lq lr bi translated">除非必要，否则应避免用户输入。</li><li id="e33c" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">Cookies和其他序列化对象必须经过签名，以防止它们被篡改。</li></ol><p id="2745" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">结论</strong></p><p id="e33d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了数据存储和传输，复杂数据结构的串行化是必要的。这有助于减少带宽，使存储和传输容易，并防止错误。但是，如果服务器反序列化提供给它的所有内容，而不验证输入是否被篡改，这可能会导致服务器受到影响。不安全的反序列化问题在php、python和Java中很常见。开发人员应该确保使用安全的函数，并采取必要的预防措施来防止不安全的反序列化。</p></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h2 id="fd54" class="mf mg it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kf" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>