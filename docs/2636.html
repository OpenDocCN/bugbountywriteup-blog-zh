<html>
<head>
<title>Portswigger Lab: JWT authentication bypass via algorithm confusion with no exposed key, a slightly different walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Portswigger实验室:通过算法混淆绕过JWT身份验证，没有暴露密钥，这是一个略有不同的演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/portswigger-lab-jwt-authentication-bypass-via-algorithm-confusion-with-no-exposed-key-a-slightly-e28602b6ef70?source=collection_archive---------4-----------------------#2022-12-12">https://infosecwriteups.com/portswigger-lab-jwt-authentication-bypass-via-algorithm-confusion-with-no-exposed-key-a-slightly-e28602b6ef70?source=collection_archive---------4-----------------------#2022-12-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2ea3" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">，或者我是如何再次认识到RTFM的重要性的</h2></div><p id="5e07" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的意思是，完全诚实地说，这篇文章开始时是我脑中的一个巨大抱怨，当时我正致力于解决<a class="ae le" href="https://portswigger.net/web-security/jwt/algorithm-confusion/lab-jwt-authentication-bypass-via-algorithm-confusion-with-no-exposed-key" rel="noopener ugc nofollow" target="_blank">实验室的问题</a>，但最终证明我错了。因此，这里有一个与本实验室解决方案下的社区演练不同的演练。而且，如果你认为自己在看起来应该聪明的时候不够聪明，从而导致沮丧/愤怒，请记住深呼吸，冷静下来，把事情想清楚。当你慢慢来的时候，你会惊讶于你能走多远，即使你确信你已经正确地做了所有的事情，你认为解决方案只是你错过的一件小事，所以你尝试并加速寻找它。但是，你当然找不到它，因为它不仅仅是一件小事。你会发现你更加愤怒，因为你一直在精神上穿过这个迷宫，你找不到奶酪，但你可以闻到它，这让你发疯。相反，只要从一开始就慢慢开始，奶酪的味道就不会均匀地散布在整个迷宫中，让你不知该往哪个方向走。这意味着，你可以更快地吃到奶酪，而不会失去冷静。我不知道为什么迷宫和奶酪的比喻，但你去:)</p><p id="ab4f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">聪明的部分</strong></p><p id="9226" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在后面的部分——建议使用合适的工具而不是简化的版本——这让我感到疯狂或愚蠢，或者两者兼而有之。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/eaa31beb2e70132afe0bd6e2f83f803a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-5fRjdQ5YGVAvEVHsp29A.png"/></div></div></figure><p id="5a18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我的意思是，接受挑战: )起初，这似乎只是达到相同结果的不同方式。剧透——我错了。</p><p id="5452" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">设置非常简单:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lr"><img src="../Images/9ed585c7dade2ce9f089b07f2509692c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SzvEvjYyq7eNGCI4A_GZIQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">docker，不用担心依赖性等。</figcaption></figure><p id="5ff9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们到了好的部分，根据实验室的解决方案，它似乎是不言自明的:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lw"><img src="../Images/c23a5245d10a07f996194860511456aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQRRFTb2aZk3ZDn21xpNsQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">简单:)</figcaption></figure><p id="f0ae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们到了另一部分，让我心烦意乱的部分:</p><p id="3637" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">你说我应该有JWT和Base64？</strong></p><p id="0095" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，请记住，我使用的不是该工具的简化版本，而是“复杂”的jwt伪造者工具，相比之下，它提供了看起来非常复杂的输出:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lx"><img src="../Images/3af41ea3dc192c9430dcb7199384e9ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W05zMXnlx2qAakqGh4Tn6g.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">复杂的输出，除了JWT之外没有任何base64编码</figcaption></figure><p id="7878" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我就不跟你说我试图将各种东西编码到base64中，试图用它签署被篡改的jwt会话并失败，然后不得不深呼吸几下冷静下来的截图了。</p><p id="bbce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">切到:</p><p id="6b78" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> RTFM </strong></p><p id="e3a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，解决方案是要么说，拧它并抓住简化的工具，或者阅读在…哦，我不知道，工具本身的github repo上找到的页面。在两条路中，我选择了人迹较少的一条，这使一切都变得不同，因为我学到了一些新东西:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ly"><img src="../Images/96f440f207d95277525fc85b1990938d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSU-4xv5rmcLh26Ext87Gg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">突出显示的部分非常重要</figcaption></figure><p id="05f7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，这个亮点如何解决我的问题呢？这一行:开始RSA公钥，这看起来很明显，因为它不是秘密，不需要猜测，它实际上和代码中的注释一样。对吗？不对。事实证明，至少在这种情况下，这很重要。我试图让“复杂”工具输出的正确部分工作，但这并不是完全错误的。我只是没有完全按照说明去做。如中所示，需要进行base64编码的文本实际上是由“复杂”工具生成的x509.pem文件。整个事情都要被编码。但是，在我无限的智慧(更像是愚蠢)中，我认为我应该只对BEGIN公钥和END公钥之间的文本进行编码，而不是这两行。这是错误的。</p><p id="aa79" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是简化工具呈现输出的方式，这使得实验室的使用和求解变得极其简单:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lz"><img src="../Images/18a365e8dcc02757d50e0160973cb807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5elIPzelvU56t3fm-L-OzA.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">准备复制/粘贴，有JWT文本，有Base64编码的x509密钥，不需要做任何更多的事情</figcaption></figure><p id="2546" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">顺便说一下，这是它如何使用“复杂”工具的:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ma"><img src="../Images/88a5dd71e8f4179a04247db838e3d9d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-pAqHm7fsc5yCkKmGWU3OA.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">第1部分:要进行base64编码的内容</figcaption></figure><p id="0eb8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后你就可以对整个事情进行编码:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mb"><img src="../Images/5300162571aedf6d97757fcabb59f38a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dpNa_klKDEcSPJzgFTqG9Q.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">第二部分:正确的方法</figcaption></figure><p id="f65b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我最初做错时得到的结果，这解释了为什么它不起作用:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mc"><img src="../Images/9171ea89796785ea3deb65c16b95dbe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eRrIBAdaQznaco-2gRlKPQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">请注意当您省略顶部和底部行时的主要区别，这当然是意料之中的</figcaption></figure><p id="f083" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">将所有这些放在一起</strong></p><p id="758e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">剩下的就交给读者了。我是说，现在都在这里了。最难的部分已经结束了，现在只需要使用社区版也提供的burp工具/扩展，并输入从您选择的工具中获得的值。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="1b8a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是为什么有时候你不得不把自我关在门外。我还了解到我必须更多地研究密码学，这有点讽刺，因为我在很多年前，在寻找bug之前，就已经对它很感兴趣了，但却找不到一种方法将所有的理论应用到实际的黑客攻击中。我想现在我知道在哪里可以再次使用它了，希望如此:)</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="0880" class="mk ml it bd mm mn mo dn mp mq mr dp ms kr mt mu mv kv mw mx my kz mz na nb nc bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae le" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>