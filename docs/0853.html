<html>
<head>
<title>Jailbreaking iOS without a Mac (1/4): The Plan</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在没有Mac的情况下越狱iOS(1/4):计划</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/jailbreaking-ios-without-a-mac-1-4-the-plan-b49c0edc1759?source=collection_archive---------1-----------------------#2020-09-29">https://infosecwriteups.com/jailbreaking-ios-without-a-mac-1-4-the-plan-b49c0edc1759?source=collection_archive---------1-----------------------#2020-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e160" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用带有(半)合法工具的Linux安装未签名的iOS应用(越狱的前提条件是什么)。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/9f522e7957dbcfa99f38ddcc22b13ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SCV_sBf7Z8apjA8s"/></div></div></figure><p id="8a79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑以下情况:我们有一个工厂安装的iOS设备(<strong class="jp ir">这里是iPhone 5S </strong>)带有最近的<a class="ae kx" href="https://en.wikipedia.org/wiki/IOS_version_history#iOS_12" rel="noopener ugc nofollow" target="_blank"> iOS版本</a> (12.4.8)，我们想越狱它。<strong class="jp ir">我们有一个Linux桌面</strong>(以下指南中的<a class="ae kx" href="https://www.archlinux.org/" rel="noopener ugc nofollow" target="_blank"> Arch Linux </a>)，一个用于iPhone设备的<a class="ae kx" href="https://en.wikipedia.org/wiki/Lightning_(connector)" rel="noopener ugc nofollow" target="_blank"> lightning </a>线缆，仅此而已。比如<strong class="jp ir">我们没有安装<a class="ae kx" href="https://en.wikipedia.org/wiki/MacOS" rel="noopener ugc nofollow" target="_blank"> macOS </a>的正版苹果硬件</strong>。</p><p id="2c92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有很多免费的iOS越狱解决方案。大部分是分布在<a class="ae kx" href="https://en.wikipedia.org/wiki/.ipa" rel="noopener ugc nofollow" target="_blank">的iOS应用。ipa </a>文件格式包。越狱程序的先决条件是在iPhone设备上安装和运行这些应用程序。</p><p id="df77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览越狱解决方案，<a class="ae kx" href="https://twitter.com/Pwn20wnd" rel="noopener ugc nofollow" target="_blank"> Pwn20wnd </a>的那个叫<strong class="jp ir"> unc0ver </strong>的好像比较合适。最新版本可以从“官方”<a class="ae kx" href="https://unc0ver.dev/" rel="noopener ugc nofollow" target="_blank"> unc0ver.dev </a>网站下载(更早的版本带源码也可以在其专用的<a class="ae kx" href="https://github.com/pwn20wndstuff/Undecimus" rel="noopener ugc nofollow" target="_blank"> github repo </a>中获得)。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/07ca4c72e3e18e67f3618b916c6d1c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmu3Mxog0ka5o9zwRumxJQ.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">最先进的越狱工具。iOS 11.0–13.5</figcaption></figure><p id="1433" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">唯一的问题是<strong class="jp ir">我们不能在非越狱设备<strong class="jp ir">上安装它</strong>，因为它缺少有效的签名</strong>。</p><h1 id="f21c" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">签名问题</h1><p id="afd4" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">虽然在Android设备上安装第三方应用程序可以使用自签名证书，但iOS(无越狱)<strong class="jp ir">只接受由官方Apple CA </strong>签名的证书。如果没有Apple CA批准的签名。无法安装和运行ipa包文件。</p><p id="4c04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有各种级别的代码签名解决方案:</p><ul class=""><li id="d13d" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">使用(付费)开发者帐户:对于Apple Store，企业级开发/测试(在多个设备上)</li><li id="0c6d" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">免费Apple ID:用于在个人设备上进行开发/测试。</li></ul><p id="6be1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，通过Apple Store分发类似越狱的恶意应用是不可能的。</p><p id="b24e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时候你可以找到一些签署了某种企业级开发证书的可下载越狱应用，可能会起作用(通过lightning cable空中安装或侧装后，在iOS设置中接受开发证书)，但迟早会被苹果屏蔽(证书会被撤销)。此外，这些越狱应用程序可能与“官方”越狱发行版略有不同，因此使用这些应用程序显然是一个额外的风险因素。</p><p id="9321" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最干净的解决方案应该是<strong class="jp ir">使用一个免费的Apple ID绑定到要越狱的设备</strong>上，<strong class="jp ir">为unc0ver app创建一个自定义的有效签名</strong>。</p><h1 id="22aa" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用免费的Apple ID进行代码签名</h1><p id="bcba" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">̵i̵s̵(在撰写本文时)有一个简单的多平台GUI解决方案，用于代码签名和部署iOS应用程序(as。ipa文件)下载到iOS设备，使用的是一个名为<a class="ae kx" href="http://www.cydiaimpactor.com/" rel="noopener ugc nofollow" target="_blank"> Cydia Impactor，</a>的免费苹果ID，但不幸的是(在苹果/XCode API升级后)在2019年它停止了工作。</p><p id="7472" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有替代的第三方解决方案(不是针对Linux，而是在Windows上)现在可能可以工作，直到签名过程中有一些更新的升级，但是<strong class="jp ir">有一个健壮的、官方的代码签名方法:使用苹果开发者工具XCode本身</strong>。在设备绑定免费Apple ID的情况下使用XCode对app(尤其是unc0ver越狱app)进行签名后，就可以在iPhone上安装运行了。</p><p id="bc9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只有一个小问题:XCode只能在macOS上运行。</p><h1 id="b337" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">运行没有苹果硬件的macOS</h1><p id="50c5" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">所以问题是:有没有可能在Linux操作系统上运行XCode(或者在非苹果正版硬件上)？感谢一些伟大的人，这是可能的。</p><p id="80a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个有趣的项目叫做<a class="ae kx" href="https://github.com/darlinghq/darling" rel="noopener ugc nofollow" target="_blank"> Darling </a>，它是一个用于Linux的macOS仿真层(可以把它想象成在Linux上运行Windows二进制文件的<a class="ae kx" href="https://www.winehq.org/" rel="noopener ugc nofollow" target="_blank"> Wine </a>)。不幸的是，这是在早期阿尔法状态，运行XCode(和连接iPhone)仍然没有工作。</p><p id="f550" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个更难的解决方案是虚拟化:myspaghetti/macos-virtualbox是virtualbox最新macos系统的“按钮”安装程序。只要运行这个脚本，它就可以下载和安装所有东西，而无需用户交互。很快，一个几乎全功能的macOS虚拟化系统就准备好了。但是USB出现了一个问题:无法将iPhone设备连接到访客macOS虚拟机。</p><p id="4e2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个<strong class="jp ir">高效的虚拟化平台是</strong> <a class="ae kx" href="https://wiki.archlinux.org/index.php/KVM" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> QEMU/KVM </strong> </a>。由<a class="ae kx" href="https://twitter.com/DhiruKholia" rel="noopener ugc nofollow" target="_blank"> Dhiru Kholia </a>开发的<a class="ae kx" href="https://github.com/kholia/OSX-KVM" rel="noopener ugc nofollow" target="_blank"> OSX-KVM </a>项目是一个在QEMU/KVM(例如在Linux主机上)上下载、安装和运行macOS的最新解决方案。这个解决方案的一个很大的优点就是QEMU/KVM <strong class="jp ir">支持</strong> <a class="ae kx" href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">使用IOMMU从主机到访客的PCI passthrough </strong> </a>(如果你的<a class="ae kx" href="https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware" rel="noopener ugc nofollow" target="_blank">硬件支持IOMMU </a>)。因此，有可能将整个USB设备传递给访客，并且通过这种方式<strong class="jp ir">有可能将iPhone连接到虚拟macOS系统</strong>(而不用担心主机和访客上不工作、不兼容的USB驱动程序)。</p><p id="da20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们在OSX-KVM项目中使用QEMU/KVM，并使用IOMMU遍历整个USB控制器。在此之后，可以使用XCode对连接的iPhone进行代码签名(甚至重新签名)。</p><h1 id="8f79" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">这个计划</h1><p id="175f" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">所以让我们总结一下:</p><ul class=""><li id="ab00" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">使用<a class="ae kx" href="https://github.com/kholia/OSX-KVM" rel="noopener ugc nofollow" target="_blank"> OSX-KVM </a>项目安装QEMU/KVM虚拟化macOS系统(第2/4部分)</li><li id="7b7e" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">配置USB控制器的PCI直通，以将iPhone连接到来宾虚拟机(第3/4部分)</li><li id="0fd4" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">使用XCode为连接的iPhone签署unc0ver越狱应用程序(或其他任何东西)并安装它(第4/4部分)。</li></ul><p id="ffae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">优于其他解决方案的优点:</p><ul class=""><li id="5a22" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">因此，<strong class="jp ir">你也将拥有一台功能齐全的macOS </strong>虚拟机，并与iPhone相连。</li><li id="5408" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">与使用一键式解决方案相比，我们可以更好地理解和控制流程。</li><li id="9fd2" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">这个过程的理论<strong class="jp ir">将在未来</strong>起作用，而第三方解决方案将在苹果升级和修改API或其他之后失效。</li><li id="4aaf" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">“只”需要信任官方的越狱应用，<strong class="jp ir">不需要信任完全未知来源的可能的恶意二进制文件。</strong></li><li id="2cb3" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">没有必要在你的主机上安装危险的(可能是恶意的)工具。甚至macOS虚拟机也保持干净。</li><li id="2921" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">一切都是免费的。</li></ul><p id="d7f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">缺点:</p><ul class=""><li id="5f54" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">这个过程肯定比其他一键式(或无线)解决方案<strong class="jp ir">复杂得多</strong>。</li><li id="3ac1" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">你需要一个<strong class="jp ir">有足够资源的最新主机硬件</strong>。</li></ul><p id="943d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">细节将在接下来的部分中介绍。请继续关注，第2部分是关于安装虚拟化macOS系统的。</p></div></div>    
</body>
</html>