<html>
<head>
<title>Write-up: JWT authentication bypass via flawed signature verification @ PortSwigger Academy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">报道:通过有缺陷的签名验证绕过JWT认证</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/write-up-jwt-authentication-bypass-via-flawed-signature-verification-portswigger-academy-2107eddec3b7?source=collection_archive---------0-----------------------#2022-08-21">https://infosecwriteups.com/write-up-jwt-authentication-bypass-via-flawed-signature-verification-portswigger-academy-2107eddec3b7?source=collection_archive---------0-----------------------#2022-08-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1caeb61a134e92cfe2383090e37e6f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aQa8-igCvbAE4A2H.png"/></div></div></figure><p id="5e48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇关于实验室<em class="kw">通过有缺陷的签名验证绕过JWT认证</em>的文章是我为<a class="ae kx" href="https://portswigger.net/web-security" rel="noopener ugc nofollow" target="_blank"> PortSwigger的Web安全学院</a>准备的演练系列的一部分。</p><p id="1144" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">学习路径</strong>:高级主题→ JWT攻击</p><div class="ky kz gp gr la lb"><a href="https://portswigger.net/web-security/jwt/lab-jwt-authentication-bypass-via-flawed-signature-verification" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">实验室:通过有缺陷的签名验证绕过JWT认证|网络安全学院</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">练习利用现实目标的弱点。记录你从学徒到专家的进步。看哪里…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">portswigger.net</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><p id="1d70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Python脚本:<a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/blob/main/23_JWT_attacks/JWT_authentication_bypass_via_flawed_signature_verification/script.py" rel="noopener ugc nofollow" target="_blank"> script.py </a></p><h1 id="bb69" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">实验室描述</h1><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/5c50c6a01831fbd89fd13448242ad580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Xz2P0uGMCN-r5KXb.png"/></div></div></figure><h1 id="b9e9" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">步伐</h1><p id="9e9f" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">实验室应用程序处理jwt。我使用扩展<code class="fe my mz na nb b">JSON Web Tokens (JWT4B)</code>来避免一直手动解码和编码jwt。</p><h1 id="ec58" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">分析</h1><p id="df26" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">通常，第一步是分析实验室应用程序的功能。在本实验中，这是一个博客页面。</p><p id="79b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">实验室描述提到了经过认证的功能，所以我使用<code class="fe my mz na nb b">wiener</code>的凭证登录。马上，Burp Proxy通知我响应包含一个JWT:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/9ea09e1a78d44715213dff450be2c4f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TRYVmSH7bhVKKZlH.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">JWT在对我登录的响应中显示</figcaption></figure><p id="b726" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我试图以用户<code class="fe my mz na nb b">wiener</code>的身份访问<code class="fe my mz na nb b">/admin</code>页面时，我收到消息<code class="fe my mz na nb b">Admin interface only available if logged in as an administrator</code>。</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="75f9" class="lq lr iq bd ls lt no lv lw lx np lz ma mb nq md me mf nr mh mi mj ns ml mm mn bi translated">该理论</h1><p id="b565" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">JWT在这里并没有展示出什么与众不同的东西:</p><ul class=""><li id="8332" class="nt nu iq ka b kb kc kf kg kj nv kn nw kr nx kv ny nz oa ob bi translated">有效载荷包含我的用户名。</li><li id="f30c" class="nt nu iq ka b kb oc kf od kj oe kn of kr og kv ny nz oa ob bi translated">该令牌受RS256签名保护。</li></ul><p id="ac72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我没有私钥，所以如果我操作这个令牌，我就不能创建有效的签名。</p><p id="cb64" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，有两个问题可能指向严重的漏洞:</p><ul class=""><li id="266d" class="nt nu iq ka b kb kc kf kg kj nv kn nw kr nx kv ny nz oa ob bi translated">网站信任令牌中指定的算法吗？</li><li id="aa00" class="nt nu iq ka b kb oc kf od kj oe kn of kr og kv ny nz oa ob bi translated">网站验证签名了吗？</li></ul><p id="232c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些漏洞中的任何一个都将允许我创建任意有效的令牌。由于回答这些问题很琐碎，所以首先要测试。</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="af98" class="lq lr iq bd ls lt no lv lw lx np lz ma mb nq md me mf nr mh mi mj ns ml mm mn bi translated">检查空算法</h1><p id="c636" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">jwt签名的一种可能的算法是<code class="fe my mz na nb b">null</code>算法。它基本上说明了令牌来自可信的来源，并且不需要签名验证。</p><p id="1695" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在处理不受信任的客户端输入时，这可能是一个安全问题。web应用程序必须在验证此类输入的过程中始终执行算法，而忽略令牌中提供的算法。</p><p id="651c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了测试它，我将请求发送到<code class="fe my mz na nb b">/my-account</code>页面以打嗝中继器，并将算法更改为<code class="fe my mz na nb b">none</code>。在JWT中，签名组件为空。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/4c6bd2f76bf6f286c296a0842c92c840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z_eUQg-SYA_0bWBC.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">具有空算法的JWT仍然提供对认证内容的访问</figcaption></figure><p id="d08f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对该请求的响应导致我的普通帐户页面。这确认了后端信任并使用令牌中提供的算法来提供对经过身份验证的内容的访问。</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="d5e8" class="lq lr iq bd ls lt no lv lw lx np lz ma mb nq md me mf nr mh mi mj ns ml mm mn bi translated">恶意请求</h1><p id="9d6e" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">为了滥用这一点，我修改了浏览器中的cookie。我把我的用户名改成<code class="fe my mz na nb b">administrator</code>，算法改成‘无’，重新编码前两部分，去掉签名部分。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/b7c68b447545ee09173e10cd6e4d28c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/0*6Q8HL0lYjqLp_zCI.png"/></div></figure><p id="4b1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我重新加载帐户页面并转到<code class="fe my mz na nb b">Admin panel</code>:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/fb7934503854ec5a49c9870dbb98c7c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NjIBVJ3Jmq3YNzp5.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">管理功能现已可用</figcaption></figure><p id="6624" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我点击删除用户<code class="fe my mz na nb b">carlos</code>的链接后，实验室更新为</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/42427c420332ab68f00183ec28ed0abd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pwWs5XXAsfbbguNR.png"/></div></div></figure></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="164c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">原载于</em><a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/tree/main/23_JWT_attacks/JWT_authentication_bypass_via_flawed_signature_verification" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://github.com</em></a><em class="kw">。</em></p><p id="aa40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe my mz na nb b"><a class="ae kx" href="https://medium.com/@frank.leitner/membership" rel="noopener">New to Medium? Become a Medium member to access all stories on the platform and support me at no extra cost for you!</a></code></p><p id="8df4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae kx" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kw">加入我们的每周简讯</em> </strong> </a> <em class="kw">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>