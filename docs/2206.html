<html>
<head>
<title>Let’s Understand Path Traversal Vulnerabilities</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们了解路径遍历漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/lets-understand-path-traversal-vulnerabilities-e4263dcb4e39?source=collection_archive---------1-----------------------#2022-07-22">https://infosecwriteups.com/lets-understand-path-traversal-vulnerabilities-e4263dcb4e39?source=collection_archive---------1-----------------------#2022-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/71e9620208df9d44f613e76c59cfc9d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cFk5Ddgy1dOcaS8o"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/s/photos/hacking?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kf" href="https://unsplash.com/@stillnes_in_motion?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">静止不动</a></figcaption></figure><h1 id="721a" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h1><p id="794c" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们知道应用程序安全性的重要性，它用于保护组织的数据及其物理资产。由于当今世界各种组织普遍受到各种各样的破坏和攻击，保护自己的公司免受上述威胁是绝对必要的。为了成功地实现应用程序安全性，必须遵循各种框架和原则，如由SANS和OWASP提供的那些。每个框架都向开发人员说明用户输入验证的重要性，包括用户输入的净化、正确的语法、适当的长度以及接受输入的业务标准操作程序(SOP)。这是必要的，因为大多数攻击是由不正确的用户输入验证引起的。输入验证适用于许多不同类型的攻击，我们将在这篇博客中讨论路径操纵漏洞。</p><h1 id="61c2" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">什么是路径操纵漏洞？</h1><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/248c83ca5af85064f10c14bbdfde0e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MyfuovIrj8GfH6sO"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://www.cloudprotector.com/path-traversal/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="4408" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">攻击者可以利用此漏洞，通过更改应用程序访问文件或呈现文件时所使用的路径或参数，来访问位于Webroot文件夹以外位置的文件和目录。由于攻击者可以控制参数并修改它，这就允许攻击者使用“”../"序列或其url编码模式，通过使用绝对文件路径。当用于提取文件的应用程序的任何参数都没有输入验证，并且应用程序的任何参数都没有输入验证时，就会出现这种情况。攻击者能够使用这种方法来访问位于webroot目录以外的目录中的文件。这些文件可能是敏感的，如网站的源代码，也可能是系统文件。</p><h1 id="43eb" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">它们为什么会发生？</h1><p id="1244" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">当应用程序接受文件路径作为用户输入来读取文件，但不对所提供的文件路径执行任何形式的验证时，此漏洞通常会表现出来。让我们来看看这段代码:应用程序将文件名作为输入，然后追加。txt”添加到文件名的末尾，然后使用新形成的路径来访问文件。正如您所看到的，由于文件名参数没有输入验证，攻击者可以很容易地使用本地文件接口(LFI)来修改文件路径，然后访问存储在服务器上的敏感文件。</p><blockquote class="mm mn mo"><p id="2527" class="le lf mp lg b lh mh lj lk ll mi ln lo mq mj lr ls mr mk lv lw ms ml lz ma mb im bi translated"><em class="it">User _ File = new File inputstream(CFG . getproperty(" sub ")+"。txt ")；</em></p><p id="37c6" class="le lf mp lg b lh mh lj lk ll mi ln lo mq mj lr ls mr mk lv lw ms ml lz ma mb im bi translated"><em class="it">User _ read = User _ file . read(arr)；</em></p><p id="53b1" class="le lf mp lg b lh mh lj lk ll mi ln lo mq mj lr ls mr mk lv lw ms ml lz ma mb im bi translated"><em class="it">out . println(arr)；</em></p></blockquote><p id="e0a7" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">如果以极高的权限执行应用程序，恶意用户就有可能查看存储在服务器上的所有文件。可以通过在文件名中注入空字节来实现这一点，这样可以绕过“.”。txt”实现，它被附加到文件名的后面。符号“../"可被攻击者用来访问位于web根目录之外的文件。这包括包含敏感信息的文件。</p><h1 id="c9a4" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">我们如何利用它们？</h1><p id="18e4" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">假设我们有一个应用程序，即“example.com”。该应用程序是使用PHP开发的，它使用文件名和路径获取图像:</p><blockquote class="mm mn mo"><p id="45bf" class="le lf mp lg b lh mh lj lk ll mi ln lo mq mj lr ls mr mk lv lw ms ml lz ma mb im bi translated"><em class="it">&lt;img src = "/fetch _ image . PHP？filename = 1 . png "&gt;T7】</em></p></blockquote><p id="d6a4" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">这些图像存储在/var/www/images/位置。“文件名”参数从下面提到的路径中检索图像:</p><p id="f3de" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><em class="mp"> /var/www/images/logo.png </em></p><p id="f769" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">因为可能没有从上述位置获取图像的验证“文件名”参数。</p><p id="dc6c" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">为了充分利用这一点，我们需要修改图像路径，如下所示</p><blockquote class="mm mn mo"><p id="47be" class="le lf mp lg b lh mh lj lk ll mi ln lo mq mj lr ls mr mk lv lw ms ml lz ma mb im bi translated"><a class="ae kf" href="https://test.com/images?filename=/etc/passwd" rel="noopener ugc nofollow" target="_blank"><em class="it">https://example.com/fetch_image?filename=/etc/passwd</em></a></p></blockquote><p id="83e1" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">由于提供了文件的完整路径，它将直接从目录中访问文件，并向您显示结果。</p><p id="9968" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">使用点号点号正斜杠(../)符号来绕过LFI保护</strong>:当代码中嵌入了另一个文件路径时，攻击者将需要使用某种形式的../ notation，以便成功地逃离它们被困的目录。因此，在这个特定的实例中，这是攻击者能够轻易利用的基本攻击场景。攻击者可以使用../ notation来访问webroot目录之外的文件</p><p id="8ff8" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">因此，当攻击者试图获取敏感文件时，他会提供“../../..“文件名”参数中的“/”序列。</p><p id="ffd5" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">理想的路径如下所示:</p><blockquote class="mm mn mo"><p id="8b9e" class="le lf mp lg b lh mh lj lk ll mi ln lo mq mj lr ls mr mk lv lw ms ml lz ma mb im bi translated"><a class="ae kf" href="https://test.com/images?filename=../../../etc/passwd" rel="noopener ugc nofollow" target="_blank"><em class="it"/>https://test.com/images?filename=../../../etc/passwd</a></p></blockquote><p id="1e05" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">攻击者一输入这些信息，就退出webroot所在的目录，并检索敏感文件。这三个连续的“../“从它现在所在的三个目录“/var/www/images”开始。因此，威胁参与者有可能进入“/root”目录并读取其中的文件。</p><p id="fa9c" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">使用PHP包装器绕过LFI保护</strong></p><p id="2f0e" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">对“的验证../”符号已经由开发人员实现，所以一旦应用程序检测到../符号，它会阻止攻击，并且通常会显示一条错误消息。如今，开发人员遵循各种各样的安全建议，以保护他们的应用程序免受这些类型的攻击。</p><p id="14f6" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">在这种情况下，对手可以通过使用“PHP包装器”来避免被验证抓住。当攻击者提供相对路径，并且该路径不是以../或任何windows驱动器号，时间提供的路径将应用于PHP包装器当前使用的工作目录。这是因为PHP包装器有一个内置的本地文件系统，可以在这种情况下使用。不管脚本当前存储在什么位置，路由通常都是起作用的。</p><p id="01d4" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">当攻击者通过PHP包装程序时，在使用“FileName”参数时，所提供的路径将被格式化如下:</p><p id="2858" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><a class="ae kf" href="https://test.com/images?filename=php://filter/convert.base64encode/resource=etc/passwd" rel="noopener ugc nofollow" target="_blank"><em class="mp">https://example.com/fetch_images?filename = PHP://filter/convert . base 64 encode/resource = etc/passwd</em></a></p><p id="e30c" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">"<em class="mp">php://filter/convert . base64 encode/resource "</em>这个有效负载强制PHP对提到的文件进行base64编码，然后在用户界面上使用或呈现。</p><p id="b912" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">补救</strong></p><ul class=""><li id="82c7" class="mt mu it lg b lh mh ll mi lp mv lt mw lx mx mb my mz na nb bi translated">将可以访问的文件列入白名单。</li><li id="04e2" class="mt mu it lg b lh nc ll nd lp ne lt nf lx ng mb my mz na nb bi translated">在没有用户输入的情况下使用函数的“文件系统”调用。</li><li id="f1e7" class="mt mu it lg b lh nc ll nd lp ne lt nf lx ng mb my mz na nb bi translated">不包括[../]在用户输入的路径中。如果函数看到，这种类型的输入在那里进行净化。</li><li id="8465" class="mt mu it lg b lh nc ll nd lp ne lt nf lx ng mb my mz na nb bi translated">根据语法、长度等验证用户输入。</li><li id="e1f4" class="mt mu it lg b lh nc ll nd lp ne lt nf lx ng mb my mz na nb bi translated">实施严格的访问控制策略来限制用户，使他们无法访问将要保存文件的目录。</li></ul><h1 id="4703" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="4886" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果开发人员遵循LFI提倡的最佳实践，攻击者可能根本无法避开路径遍历漏洞。然而，有许多潜在的方法可以让攻击者绕过这个问题。</p><p id="863b" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">如果攻击者成功地泄露了属于某个组织的个人身份信息或其他敏感数据，则此漏洞可能是一个严重程度很高的漏洞。</p><p id="cdf0" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">因此，在采取绝对必要的预防措施的同时将其付诸实施。</p></div><div class="ab cl nh ni hx nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="im in io ip iq"><p id="8a7f" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。加入我们的每周简讯，以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！<a class="ae kf" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"><em class="mp"/></a></p></div></div>    
</body>
</html>