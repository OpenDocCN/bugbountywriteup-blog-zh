<html>
<head>
<title>Exploiting Execute After Redirect (EAR) vulnerability in HTB Previse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用HTB版本中的重定向后执行(EAR)漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-execute-after-redirect-ear-vulnerability-in-htb-previse-92ea3f1dbf3d?source=collection_archive---------2-----------------------#2022-01-10">https://infosecwriteups.com/exploiting-execute-after-redirect-ear-vulnerability-in-htb-previse-92ea3f1dbf3d?source=collection_archive---------2-----------------------#2022-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/29cabc4d48fdf9e7bc28718882dd854f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HG4_UoxibveODru08Tfgqw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:www.wallpaperflare.com<a class="ae kc" href="http://www.wallpaperflare.com" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><h1 id="16a4" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">简短的介绍</h1><blockquote class="lb lc ld"><p id="19a2" class="le lf lg lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc ij bi translated">重定向后执行(EAR)是一种攻击，攻击者忽略重定向并检索针对经过身份验证的用户的敏感内容。成功利用EAR漏洞可能导致应用程序完全受损。</p></blockquote><p id="374a" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">考虑一个具有登录功能的web应用程序。拥有帐户的用户只能通过登录来访问此web应用程序中的内容/功能。未经身份验证的用户将被重定向到登录页面，以便他们首次登录并获得经过身份验证的会话。这是重定向后执行或EAR漏洞可能出现的许多情况之一。在不正确的代码实现中会出现一个EAR漏洞，开发人员会认为重定向后执行会停止。然而，事实并非如此，页面的其余部分也会被执行。</p><p id="f3b4" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">下面的代码片段显示了这样一个实现:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="7eff" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">如果你眼尖的话，你可能已经注意到了。如果你没赶上，没问题。让我给你看看。PHP代码检查用户是否经过身份验证。如果没有，它会将他们重定向到位于<code class="fe mm mn mo mp b">/login</code>的登录页面。但是没有人告诉程序在重定向后停止执行所有代码。因此，所有应该只在用户拥有有效会话时运行的代码也将被执行。如果我们使用代理工具，比如BurpSuite或ZAP(是的，我喜欢这两个工具)，我们可以将<code class="fe mm mn mo mp b">302 Found</code>重定向的响应修改为<code class="fe mm mn mo mp b">200 OK</code>响应。我们稍后将进入这一部分。让我们先快速修复代码。</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="f2b9" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">通过简单地调用<code class="fe mm mn mo mp b">die()</code>函数，我们能够停止代码的执行。剩余的代码现在不会执行。</p><h1 id="ebf1" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">演示—有趣的部分:)</h1><p id="a687" class="pw-post-body-paragraph le lf iq lh b li mq lk ll lm mr lo lp md ms ls lt me mt lw lx mf mu ma mb mc ij bi translated">有趣的部分来了，是吗？HTB盒子上的网站Previse(现已退役)易受此EAR漏洞的攻击。我首先用一个叫做dirbuster的工具来模糊文件名。这些文件中的大多数都以302 Found状态代码响应。这里需要注意的一点是，响应中的Content-Length头的值非常高，这在重定向响应中并不常见。</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/00a45958f294ca2da097e72a20071f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h59vnNuSdSKJH4X8-e4-nw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用dirbuster对文件进行模糊处理</figcaption></figure><p id="b450" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">如果我们使用cURL等不遵循重定向的工具访问任何这样的页面(作为未经身份验证的用户)，我们可以清楚地看到只有经过身份验证的用户才能看到的内容。</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/9024ce8b549f0942304213a8adaf7264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-oWttp7VcpmRdEX2kBFYSQ.png"/></div></div></figure><p id="e04d" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">它可以让攻击者窃取私人敏感数据，并执行未经授权的操作。</p><p id="160a" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">我们可以使用BurpSuite内置的匹配和替换特性来自动将302重定向转换为200 OK响应。但是请记住，它可能会与某些页面冲突，并且行为怪异。</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/42d463d94caae00ec5acb1b9f3dfc93d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*QNVNr6gH9BKk88j0s6dIOw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在BurpSuite上匹配和替换</figcaption></figure></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="4bd2" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated">我希望你喜欢阅读这篇文章。如果你有任何问题，随时联系我。通过我的社交网络与我联系</p><div class="nf ng gp gr nh ni"><a href="https://www.linkedin.com/in/manash-saikia-065146176/" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">Manash Saikia —安全顾问实习生— Payatu | LinkedIn</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">查看世界上最大的职业社区LinkedIn上Manash Saikia的个人资料。Manash有3个工作列在他们的…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.linkedin.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw jw ni"/></div></div></a></div><p id="8027" class="pw-post-body-paragraph le lf iq lh b li lj lk ll lm ln lo lp md lr ls lt me lv lw lx mf lz ma mb mc ij bi translated"><a class="ae kc" href="https://twitter.com/manash036" rel="noopener ugc nofollow" target="_blank">https://twitter.com/manash036</a></p></div></div>    
</body>
</html>