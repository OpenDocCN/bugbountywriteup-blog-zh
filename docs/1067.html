<html>
<head>
<title>How to use Ghidra to Reverse Engineer Mobile Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Ghidra对移动应用进行逆向工程</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-to-use-ghidra-to-reverse-engineer-mobile-application-c2c89dc5b9aa?source=collection_archive---------0-----------------------#2021-01-16">https://infosecwriteups.com/how-to-use-ghidra-to-reverse-engineer-mobile-application-c2c89dc5b9aa?source=collection_archive---------0-----------------------#2021-01-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq"><p id="7cbd" class="jr js it bd jt ju jv jw jx jy jz ka dk translated">Ghidra是一个免费的开源软件，用于包括移动应用在内的可执行程序(二进制)的逆向工程。Ghidra支持在多种操作系统平台上安装，包括Windows、Linux和MacOS。</p></blockquote><figure class="kc kd ke kf kg kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kb"><img src="../Images/24dd19dcd051a316a9d52192e02d2894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOUlrrKt0CewfmvqJ0r7Jg.png"/></div></div></figure><h1 id="fe91" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">安装Ghidra</h1><p id="9a2f" class="pw-post-body-paragraph lm ln it lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi ka im bi translated">这里我已经在Linux上安装了Ghidra。</p><ul class=""><li id="9281" class="mj mk it lo b lp ml lt mm lx mn mb mo mf mp ka mq mr ms mt bi translated">下载<a class="ae mu" href="https://ghidra-sre.org/" rel="noopener ugc nofollow" target="_blank">吉卓拉</a>。</li><li id="f788" class="mj mk it lo b lp mv lt mw lx mx mb my mf mz ka mq mr ms mt bi translated">下载ghidra时，打开linux终端并安装所需的依赖项，然后我们才能运行Ghidra: <code class="fe na nb nc nd b">sudo apt install openjdk-11-jdk</code></li><li id="0a64" class="mj mk it lo b lp mv lt mw lx mx mb my mf mz ka mq mr ms mt bi translated">解压缩下载的Ghidra包&gt;打开ghidra文件夹并运行<code class="fe na nb nc nd b">./ghidraRun</code>这将打开Ghidra-GUI。</li></ul><p id="584c" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">一旦Ghidra开始运行，您就可以开始了！</strong></p><h1 id="f808" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">为什么出于安全目的执行逆向工程？</h1><ul class=""><li id="1b0c" class="mj mk it lo b lp lq lt lu lx nh mb ni mf nj ka mq mr ms mt bi translated">执行恶意软件分析</li><li id="ab61" class="mj mk it lo b lp mv lt mw lx mx mb my mf mz ka mq mr ms mt bi translated">移除复制保护方案/序列号保护</li><li id="2e61" class="mj mk it lo b lp mv lt mw lx mx mb my mf mz ka mq mr ms mt bi translated">逆转加密产品以挑战其安全级别</li><li id="df61" class="mj mk it lo b lp mv lt mw lx mx mb my mf mz ka mq mr ms mt bi translated">要查找硬编码的凭据</li><li id="f36c" class="mj mk it lo b lp mv lt mw lx mx mb my mf mz ka mq mr ms mt bi translated">要删除密码提示</li></ul><h1 id="43f7" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">用Ghidra逆向工程Android APK文件</h1><p id="c708" class="pw-post-body-paragraph lm ln it lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi ka im bi translated">这里，作为一个例子，我们将把一个APK文件反汇编和反编译成汇编代码和Java源代码。</p><p id="47f6" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">下图显示了如何创建(自上而下)和反向工程(自下而上)可执行二进制文件的高级流程图。</strong></p><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nk"><img src="../Images/56b2883ff31baea016874ff047d0dbc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zgQe5LtYutLBrQsMMEX46Q.png"/></div></div></figure><p id="bec9" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">需要考虑的事情:</strong></p><p id="ea91" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">大多数编程语言都有解释器和编译器。即python可以作为编译程序或解释语言来执行。</p><p id="bb61" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">大多数命令行工具、CLI和powershells、unix shells也是一种解释语言。</p><p id="6aaa" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">高级语言翻译器(解释器/编译器)通常将源代码直接翻译成机器代码。然而，翻译器和反汇编器可以将代码生成汇编语言。</p><h2 id="6009" class="np kp it bd kq nq nr dn ku ns nt dp ky lx nu nv lc mb nw nx lg mf ny nz lk oa bi translated">在吉德拉进口APK</h2><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ob"><img src="../Images/d5c00059a105d27a985cd3a6448f400d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LrkzUSwrv-B9OMGyclhD0A.png"/></div></div></figure><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oc"><img src="../Images/ae1b9655bed4abaed09442d0df557891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CY8heWDE3jhGfVwLYiO42A.png"/></div></div></figure><h2 id="558a" class="np kp it bd kq nq nr dn ku ns nt dp ky lx nu nv lc mb nw nx lg mf ny nz lk oa bi translated">第一步</h2><p id="2451" class="pw-post-body-paragraph lm ln it lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi ka im bi translated">在Ghidra-GUI中，首先创建项目目录:选择<strong class="lo iu">文件&gt;新建项目&gt;非共享项目</strong>，输入项目目录路径和项目名称。</p><p id="21a7" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">在这里我创建了一个名为<strong class="lo iu"> Mobile_App </strong>的目录。</p><h2 id="572a" class="np kp it bd kq nq nr dn ku ns nt dp ky lx nu nv lc mb nw nx lg mf ny nz lk oa bi translated"><strong class="ak">第二步</strong></h2><ul class=""><li id="18c8" class="mj mk it lo b lp lq lt lu lx nh mb ni mf nj ka mq mr ms mt bi translated">我导入了一个Android软件包(APK)文件，Android用它来分发和安装应用程序。app文件名为<strong class="lo iu"> diva-beta.apk </strong></li><li id="b9bd" class="mj mk it lo b lp mv lt mw lx mx mb my mf mz ka mq mr ms mt bi translated">选择<strong class="lo iu">文件&gt;导入文件&gt; diva-beta.apk </strong>然后选择<em class="od"> </em> <strong class="lo iu">批量</strong>以包含所有文件和文件夹，或者您可以选择<strong class="lo iu">文件&gt;批量导入</strong>进行相同的操作。</li><li id="1143" class="mj mk it lo b lp mv lt mw lx mx mb my mf mz ka mq mr ms mt bi translated">将<strong class="lo iu">深度限制</strong>设置为更高的值，并<strong class="lo iu">重新扫描</strong>以搜索<strong class="lo iu">类</strong>文件。</li></ul><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/e8e74ff4b09b25c33f83c4762a492dd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*dHjIFuv_35WN4oDSUZy1fA.gif"/></div></div></figure><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/66b58fc23f71ace49c0a36007ed9ff08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0wEqHjdDy4nLjI1Hj2o1Ww.png"/></div></div></figure><p id="8f9a" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">注意，diva-beta.apk提取了两个文件:classes.dex和lib。</p><p id="3734" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">Ghidra将这两个文件解包为编译后的java文件(。类)和编译的动态链接共享对象库(。所以文件)。</p><div class="nl nm nn no gt ab cb"><figure class="og kh oh oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/2ce8f9bb6fe7558c48281541e47b6231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*E3rtvGoC2QUM0sbnM6kSiw.png"/></div></figure><figure class="og kh oh oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/ea39961655d7b69c540016edc68d446b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*dhsWzZAChpZBos59_gegKw.png"/></div></figure></div><h1 id="80c3" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">反汇编和反编译导入的批处理文件</h1><p id="6cfb" class="pw-post-body-paragraph lm ln it lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi ka im bi translated">双击任何编译文件或共享库文件。这将打开“分析选项”。<strong class="lo iu">选择所有</strong>和<strong class="lo iu">进行分析。</strong></p><p id="08b4" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">在这里，我已经打开了<strong class="lo iu"> hardcode2Activity.class </strong>文件来分析它的反汇编和反编译数据。</p><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi om"><img src="../Images/8bd9ab8170a05c41f8828eeb26bd5c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*i0DSPFCA7XBTuAWwW6O27A.gif"/></div></div></figure><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi on"><img src="../Images/bb7fcecb6420325c619a8ec6bdaf5ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R9m5u1Uxg4psIhMviDRA2w.png"/></div></div></figure><p id="9c5e" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">反编译器</strong> —显示源代码</p><p id="5824" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">拆卸器</strong> —显示装配代码。</p><p id="9bce" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">程序树— </strong>突出显示代码部分。</p><p id="2415" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">符号树</strong> —按以下类别显示程序中的符号:外部、函数、标签、类和名称空间。</p><p id="8998" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">数据类型管理器</strong> —显示3种数据类型:“内置”、“用户定义”和“派生”。它允许用户定位、组织和应用程序的数据类型。</p><p id="4471" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><strong class="lo iu">控制台脚本</strong> —显示脚本的输出。</p><h1 id="9879" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">分析导入的批处理文件</h1><p id="f9af" class="pw-post-body-paragraph lm ln it lo b lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi ka im bi translated">从程序树中，双击任何源代码，以反编译和反汇编模式查看和分析它。虽然对于反编译的代码，我会用我个人的<code class="fe na nb nc nd b">jadx-gui</code>,它是一个“JAVA索引”反编译程序。</p><p id="c108" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">查看源代码，您可以看到DivaJni类的对象引用已经被创建(实例化)。然后用它来决定是允许访问还是拒绝访问。</p><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oo"><img src="../Images/9c05503a9a948791a513fc2ebdd5ac8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S4AHPlulI8wQpXiCZKCLUQ.png"/></div></div></figure><div class="nl nm nn no gt ab cb"><figure class="og kh op oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/2460ce101aadbda3f6cf6c6bdcfe2485.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*GYtpF8kSvIQq9aLRH7c4iA.png"/></div></figure><figure class="og kh oq oi oj ok ol paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/0ce5343a910d21c76d6766a5a74f686b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*cAIbwPPjqYNDtoMKmJ9VSA.png"/></div></figure></div><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi or"><img src="../Images/68fb89dd442c7002655991a143b2c53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aN1lONGg4jBOq6MPms7pxQ.png"/></div></div></figure><p id="b69b" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">注意Ghidra <strong class="lo iu">数据类型管理器</strong>下的HardcodeActivity.class包含两个类文件。这意味着这个任务的应用程序(hardcode2activity)正在使用两个类文件来执行一个活动。我们也可以从反编译的源代码中看出这一点，它正在实例化<strong class="lo iu"> Divajni </strong>类。</p><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/35447388e72680e34e6a9a22600e4215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I5mRIar0Z4dL_fijVDPe0A.png"/></div></div></figure><p id="bb27" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">接下来打开Divajni.class，下面反编译的源代码告诉我们，加载了一个名为<strong class="lo iu"> divajni </strong>的库。太好了！</p><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi os"><img src="../Images/40625d4b2a60b2636099ae264d403e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5kw6JF8wMup2S4gZ4_DVLQ.png"/></div></div></figure><figure class="nl nm nn no gt kh gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/4e64fb5ca80b5200122a2d71374c938d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*gxEovouNrlxYmUkuXcu7bA.png"/></div></figure><p id="7647" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">从lib文件夹打开<strong class="lo iu"> libdivajni.so </strong>文件的时间到了。</p><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ou"><img src="../Images/e6ad8e836f831d6b47e1219c3e6368fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dOA5S8pkNHfOVmNaP1aZWQ.png"/></div></div></figure><p id="8aff" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">在菜单栏上转到:<strong class="lo iu">搜索&gt;中的字符串</strong> &gt; <strong class="lo iu">检查pascal字符串</strong></p><p id="19d7" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">你会注意到底部有两个可疑的字符串。</p><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ov"><img src="../Images/a10fda1b981a3d7e352ed45c2f3ce7f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mOJgjWCtbuEqx1SVmy18kQ.png"/></div></div></figure><p id="e6c7" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">双击以上两个字符串中的任何一个，反汇编程序就会引导你找到它的位置。对我来说，允许访问的关键是<strong class="lo iu">olsdfgad；左侧</strong></p><p id="b365" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated">该硬编码供应商密钥可在<strong class="lo iu">libdivajni.so/.rodata</strong>文件中找到</p><figure class="nl nm nn no gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ow"><img src="../Images/444ebe50674bc1f7d3c76e129019d8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yh-9KUXqGZ8xg1JXTacxeQ.png"/></div></div></figure></div><div class="ab cl ox oy hx oz" role="separator"><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc"/></div><div class="im in io ip iq"><p id="f54a" class="pw-post-body-paragraph lm ln it lo b lp ml lr ls lt mm lv lw lx ne lz ma mb nf md me mf ng mh mi ka im bi translated"><em class="od">感谢阅读。感谢您的反馈:-) </em></p></div></div>    
</body>
</html>