<html>
<head>
<title>The YouTube bug that allowed unlisted uploads to any channel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">YouTube允许未列出的上传到任何频道的错误</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/the-youtube-bug-that-allowed-uploads-to-any-channel-3b41c7b7902a?source=collection_archive---------1-----------------------#2020-10-27">https://infosecwriteups.com/the-youtube-bug-that-allowed-uploads-to-any-channel-3b41c7b7902a?source=collection_archive---------1-----------------------#2020-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f80c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6月下旬，我收到了YouTube的一份测试新产品的邀请:这是一个视频制作工具，可以轻松地将带有自定义字体和徽标的广告放在一起。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3837506d4d69d3285e9a19c8eb86c458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2oCdsiZLI4tRah5o7zgPA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我收到的通知我测试版的邮件。</figcaption></figure><p id="bc25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不知道他们从哪里得到我的信息——我肯定接触过网上每一个可信的测试者表单——但这提供了一个机会。新产品通常不会对攻击如此强硬。当我在请求访问一天后试图登录该网站时，令我惊讶的是，它让我进去了。(奇怪，因为我没有像他们说的那样收到任何通知。)</p><p id="71b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个工具非常简单，它是这样工作的:你选择一个模板，用颜色、照片和文本定制它，然后服务器为你渲染它。为了更好地了解它的工作原理，我打开了调试代理的瑞士军刀:<a class="ae lb" href="https://www.charlesproxy.com/" rel="noopener ugc nofollow" target="_blank"> Charles。然后我看着车流穿过，跟着台阶走。</a></p><p id="8176" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">起初，我并没有特别注意到什么——文件上传功能是安全的，他们使用长的加密字符串来标识资源，并且所有字段都经过了清理。真扫兴。但是当我走到最后一步时，我注意到了一些事情。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lc"><img src="../Images/ba649f08e85efc5481e0857b09dc30b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJmNlb2Dza0zSFwcWAtbWw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">视频生成器的上传屏幕。</figcaption></figure><p id="4f8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个菜单，允许你从与你的谷歌账户相关的频道中进行选择，在这个菜单下面，有一个小小的免责声明:<em class="ld">你的视频将被保存到你的频道，作为“未列出”</em>所以服务器同时呈现<em class="ld">和</em>上传视频，并给我选择上传频道的选项。这敲响了警钟。我必须知道它是如何工作的。</p><p id="dd9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">YouTube上的每个频道都有自己的ID，通常是这样的:<code class="fe le lf lg lh b">UCxXX0xx_X0XxxXXxxxx00Xx</code>。你通常可以在频道URL或任何视频页面的来源中找到它们。当我回去查看该网站如何获得我的账户上的YouTube频道时，我发现服务器的响应如下:</p><pre class="km kn ko kp gt li lh lj lk aw ll bi"><span id="731f" class="lm ln iq lh b gy lo lp l lq lr">HTTP/1.1 200 OK<br/>Content-Type: application/json; charset=utf-8</span><span id="d9d7" class="lm ln iq lh b gy ls lp l lq lr">{<br/>    "1": [{<br/>            "1": "<strong class="lh ir">UCBCW8XFPYIENZPC659Pk0kg</strong>",<br/>            "2": "Ryan Kovatch",<br/>            "3": "https://yt3.ggpht.com/a/..."<br/>    }]<br/>}</span></pre><p id="73d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我的频道ID。然后我点击“保存”看看会发生什么。</p><pre class="km kn ko kp gt li lh lj lk aw ll bi"><span id="da41" class="lm ln iq lh b gy lo lp l lq lr">POST /u/0/videobuilder/_/rpc/Image2VideoUiService/UploadToYouTube HTTP/1.1<br/>Host: director.youtube.com<br/>Content-Length: 483<br/>Content-Type: application/x-www-form-urlencoded</span><span id="c9a2" class="lm ln iq lh b gy ls lp l lq lr">__ar=%7B%221%22%3A%7B%221%22%3A%22AFbu1Vq...%22%7D%2C%222%22%3A%22UCBCW8XFPYIENZPC659Pk0kg%22%2C%223%22%3A%221%22%2C%224%22%3A%22Created+with+YouTube+Video+Builder+using+template+%5C%22Introduce+your+brand+%286s%29.%5C%22%22%2C%225%22%3A%222755bb19-6e4b-4cd4-beca-46cc29f26625%22%7D</span></pre><p id="4715" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">表单请求。解码后，<code class="fe le lf lg lh b">__ar</code>的值为:</p><pre class="km kn ko kp gt li lh lj lk aw ll bi"><span id="98f8" class="lm ln iq lh b gy lo lp l lq lr">{<br/>    "1":{<br/>        "1":"AFbu1Vq..."<br/>    },<br/>    "2":"<strong class="lh ir">UCBCW8XFPYIENZPC659Pk0kg</strong>",<br/>    "3":"Main message",<br/>    "4":"Created with YouTube Video Builder using template \"Introduce your brand (6s).\"",<br/>    "5":"2755bb19-6e4b-4cd4-beca-46cc29f26625"<br/>}</span></pre><p id="e542" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，这是我的频道ID。旁边是标题、描述和模板ID。当我想通了这一点，我的第一步是用我的测试帐户的渠道ID交换它。然后…</p><pre class="km kn ko kp gt li lh lj lk aw ll bi"><span id="855d" class="lm ln iq lh b gy lo lp l lq lr">HTTP/1.1 200 OK</span></pre><p id="5271" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嘣。服务器返回了一个ID来跟踪上传的进度，然后我在YouTube上获得了一个链接。果不其然，它被作为一个未公开的视频上传到了一个我不拥有的频道。我马上就举报了。</p><p id="5425" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后我就收到了这封邮件，好吧。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lt"><img src="../Images/6a1aa8f9847ab8b9bd7505dc37d409cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pFS_MUG8n4utCkTxiAFxUA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">不会吧，真的吗？</figcaption></figure><p id="bee6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我就去睡觉了。</p><h1 id="03c7" class="lu ln iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">第二天</h1><p id="81ac" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">凌晨时分发生了许多活动。我的报告似乎引起了不小的轰动。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/53b22963025c18fbc5769ca8f6451118.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*LEWH6Vh78nKkTVEAVKuL-A.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">首先，在早上6点。</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/53f8273706f9b018bc6b6f841b3a96ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*s-jd13QrjPh4TJ_r0gkLUg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">30分钟后。</figcaption></figure><p id="fb17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我醒来时发现“接得好！”在我的邮箱里。这促使我认真思考这样一个问题的含义——在YouTube这样的平台上，它会加速错误信息的传播。那种动摇选举和威胁民主的东西。我不得不深入挖掘。</p><p id="6a70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一点上，限制是a .)我不能公开上传视频，b .)我只能上传网站创建的视频，而不是我自己的。根本问题是非常有害的，但如果我能找到绕过这些问题的方法，问题会严重得多。于是我重新审视了一下<code class="fe le lf lg lh b">UploadToYouTube</code>函数。</p><pre class="km kn ko kp gt li lh lj lk aw ll bi"><span id="07d5" class="lm ln iq lh b gy lo lp l lq lr">{<br/>    "1":{<br/>        "1":"<strong class="lh ir">AFbu1Vq...</strong>"<br/>    },<br/>    "2":"UCBCW8XFPYIENZPC659Pk0kg",<br/>    "3":"Main message",<br/>    "4":"Created with YouTube Video Builder using template \"Introduce your brand (6s).\"",<br/>    "5":"2755bb19-6e4b-4cd4-beca-46cc29f26625"<br/>}</span></pre><p id="cf38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那个标识符？这是一个包含视频文件信息的加密字符串。(其实要长很多。)我后来才知道这叫做<code class="fe le lf lg lh b">scottyResourceId</code>，YouTube上到处都用它来识别上传到他们服务器上的数据。一个想法突然出现在我的脑海中:如果我可以上传一个文件到另一个YouTube网站，从那里提取资源ID，并在这个API中使用它，会怎么样？这将允许我上传一个自定义视频，并指向它的服务器。</p><p id="c523" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我打开了YouTube Studio并上传了一个测试文件。服务器的回应是:</p><pre class="km kn ko kp gt li lh lj lk aw ll bi"><span id="7d85" class="lm ln iq lh b gy lo lp l lq lr">HTTP/1.1 200 OK<br/>X-GUploader-UploadID: ...<br/>X-Goog-Upload-Status: final<br/>Content-Length: 405<br/>Server: UploadServer<br/>Connection: keep-alive</span><span id="88fd" class="lm ln iq lh b gy ls lp l lq lr">{<br/>    "status":"STATUS_SUCCESS",<br/>    "scottyResourceId":"<strong class="lh ir">ACKujmz...</strong>"<br/>}</span></pre><p id="4c6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">答对了。这个ID以<code class="fe le lf lg lh b">ACK</code>开头，但是和另一个一样长。我向视频构建器发送了一个新的<code class="fe le lf lg lh b">UploadToYouTube</code>请求，这次是用来自YouTube Studio的ID，然后……得到了一个错误。</p><pre class="km kn ko kp gt li lh lj lk aw ll bi"><span id="8518" class="lm ln iq lh b gy lo lp l lq lr">com.google.apps.framework.request.CanonicalCodeException:<br/>com.google.security.keymaster.KeyUnavailableException:</span><span id="f9e4" class="lm ln iq lh b gy ls lp l lq lr"><strong class="lh ir">No matching decryption key found; ciphertext had key hash XXYYZZ but no key version matched it; existing versions:keyhashes are 1:YYZZXX, 2:ZZXXYY, 3:YYXXZZ, 4:XXZZYY, see go/key_unavailable_exception.</strong></span><span id="e33a" class="lm ln iq lh b gy ls lp l lq lr">Code: PERMISSION_DENIED</span></pre><p id="bc49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以没用。但是像这样的异常实际上可能是比它们阻止的功能更严重的问题<em class="ld">。</em>在这种情况下，服务器试图解密资源ID，但是由于它来自另一个服务器，它无法找到正确的解密密钥来使用。当这个异常被抛出时，它包含了它存储的所有键的散列。这是一次严重的数据泄露。</p><p id="8119" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我报了，又得到一个“接得好！”围绕将视频从不公开变为公开的进一步研究并不成功，所以我就此打住。</p><h1 id="3261" class="lu ln iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">结论</h1><p id="a62b" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">即使是游戏中最大的玩家也容易出现这样的错误。有时它们更明显，有时更难发现，但它们就在那里。我希望我的第一篇文章对那些试图找到第一笔bug奖金的人有所帮助，或者可能已经有一些了。没有什么无法穿透的应用程序。</p><h1 id="0e4f" class="lu ln iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">时间表</h1><h2 id="437d" class="lm ln iq bd lv my mz dn lz na nb dp md jy nc nd mh kc ne nf ml kg ng nh mp ni bi translated">所有时间都是太平洋标准时间。</h2><ul class=""><li id="6ce4" class="nj nk iq jp b jq mr ju ms jy nl kc nm kg nn kk no np nq nr bi translated"><strong class="jp ir">收到邀请</strong>6月22日上午9:53</li><li id="341a" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated"><strong class="jp ir">报告第一个bug</strong>6月23日晚上10:44</li><li id="5c73" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated"><strong class="jp ir">被审判为P1</strong>6月24日上午6:10</li><li id="bc12" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated"><strong class="jp ir">“接得好！”并升级到S1</strong>6月24日上午6:40</li><li id="bcaf" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated"><strong class="jp ir">报告第二个bug</strong>6月24日下午6:09</li><li id="65c3" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated"><strong class="jp ir">“接得好！”并升级到p2s 2</strong>6月25日凌晨2:02</li><li id="3e2e" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated"><strong class="jp ir">小组奖励6337美元奖金</strong>7月2日上午11:20</li><li id="aef9" class="nj nk iq jp b jq ns ju nt jy nu kc nv kg nw kk no np nq nr bi translated"><strong class="jp ir">两个错误都被确认为已修复</strong>10月16日下午3:01</li></ul></div></div>    
</body>
</html>