<html>
<head>
<title>JSON Escaping Out In The Wild (The 10-Minutes XSS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JSON逃到野外(10分钟XSS)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/json-escaping-out-in-the-wild-the-10-minutes-xss-70db21fb6c6e?source=collection_archive---------0-----------------------#2019-01-21">https://infosecwriteups.com/json-escaping-out-in-the-wild-the-10-minutes-xss-70db21fb6c6e?source=collection_archive---------0-----------------------#2019-01-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="af7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:以下文章发表于2016年13月2日</em><a class="ae km" href="https://fogmarks.com/2016/02/13/json-escaping-out-in-the-wild/" rel="noopener ugc nofollow" target="_blank"><em class="kl">【https://FogMarks.com】</em></a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/c462ec75fba3355adf65c607afe1695f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMS-RY_6rgGG-tPTwHsqgQ.png"/></div></div></figure><blockquote class="kz la lb"><p id="b3ce" class="jn jo kl jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">这个案例研究关注JSON的核心方面和实用程序，特别是它的转义方法。</p></blockquote><p id="951d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi lf translated">oundCloud.com和其他许多公司一样，使用JSON从服务器获取用户相关信息。这个想法很简单，服务器首先向客户端发送HTML(以及javascript、CSS、图片等)，然后Javascript代码使用AJAX从服务器获取数据。</p><p id="4e21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，来自服务器的数据以JSON格式返回，javascript代码知道如何解析它并将数据插入页面的正确位置。<br/>返回的数据(可能)被JSON转义机制转义，所以任何恶意的有效负载都不会起作用。</p><p id="6786" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里应该问的主要问题是:我们可以利用浏览器获取数据的方式吗？我们能让它获取任意的HTML或Javascript代码吗？</p><p id="5d26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，简单的回答是否定的。<br/>长的回答(<strong class="jp ir">开始这项研究后10分钟</strong>)是肯定的。</p><p id="0f29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">起初，我决定把重点放在通知区域(https://soundcloud . com/notifications)，在那里我注意到当滚动完成时AJAX请求正在被执行(以获取旧的通知)。</p><p id="bc8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我之前在SoundCloud的不同位置插入了一些有效载荷，并分析了AJAX请求更多通知的方式。<br/>为了安全地打印“坏”字符('、"、&lt;、…)。)，JSON通过在任何“坏”字符前加一个\ char来转义它们。</p><p id="b81f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我开始思考。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/c0cbee211a04862b3b339b1a08337565.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/0*RxC7TAqQpEEDtAfC"/></div></figure><p id="ad14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我自己逃跑呢？JSON还会逃吗？</p><p id="9117" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，的确如此。JSON转义机制对已经转义的有效负载进行了“双重转义”。剩下要做的就是预先逃脱一个有效载荷，这导致在通知区域存储XSS。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="lp lq l"/></div></figure><h2 id="63ff" class="lr ls iq bd lt lu lv dn lw lx ly dp lz jy ma mb mc kc md me mf kg mg mh mi mj bi translated">JSON转义必须正确完成</h2><p id="61ff" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">这样做的唯一原因是开发人员认为没有人会在提交输入之前“预先转义”他们的输入。JSON机制总是对输入进行转义(通过在输入前添加“或”字符)。如果你希望用户的输入由第三方代码输出，你应该:<br/> 1。绝不允许直接使用HTML/Script标签。如果必须的话，允许用户使用“特殊字符”来设计他们的输入(比如*bold*而不是&lt; b &gt;)。<br/> 2。了解机理。JSON在文本前添加“或”。因此，如果您接受来自用户的这些字符，只需用<strong class="jp ir"> URL对它们进行编码。</strong></p><p id="5b1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将借此机会指出，SoundCloud的响应团队是我合作过的最快的团队。看看披露的时间表。</p><h2 id="bf41" class="lr ls iq bd lt lu lv dn lw lx ly dp lz jy ma mb mc kc md me mf kg mg mh mi mj bi translated">披露时间表</h2><p id="108b" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">13/02/2016 23:00 —发现并报告漏洞。<br/>2016年2月14日08:00—Soundcloud确认存在漏洞。<br/> 14/02/2016 14:00 —漏洞已修补，奖金已发放(HoF + Swag)。</p></div></div>    
</body>
</html>