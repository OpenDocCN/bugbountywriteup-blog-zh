<html>
<head>
<title>Troubleshooting SIEM Collector Issues</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SIEM收集器问题疑难解答</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/intro-to-troubleshooting-siem-collector-issues-be92d01d19a6?source=collection_archive---------1-----------------------#2022-11-07">https://infosecwriteups.com/intro-to-troubleshooting-siem-collector-issues-be92d01d19a6?source=collection_archive---------1-----------------------#2022-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="57a6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">蓝队足球活动</h2></div><p id="1138" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">安全信息&amp;事件管理(SIEM) </strong>提供安全事件的整合视图，并对潜在威胁立即做出响应。</p><p id="e224" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">市场上有几家SIEM提供商。一些已知的有:微软Azure Sentinel，IBM，LogRhythm，Splunk，AlienVault等。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/16b8bbf045638c1a9aeb92fbe4410d36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p5w7G_PToHL2a-Kv"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">由<a class="ae lu" href="https://unsplash.com/@reskp?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Jametlene Reskp </a>在<a class="ae lu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="78ae" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">什么是收藏家？</h2><p id="448a" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">Collector只是一个用于从源收集日志并将其转发给SIEM的设备。每个设备上安装的日志转发代理用于促进源和收集器之间的收集。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mt"><img src="../Images/aca60edd57bc2e9dc54a1a8b42cfa8c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2F4S80qoUOxZN1N-lPgcQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">高级SIEM体系结构流程图</figcaption></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mu"><img src="../Images/c38811eddf3206c20f81ddcee2716649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OvvB_tQ7TShMgngcG1u6uQ.png"/></div></div></figure><p id="1658" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安全分析师角色的其中一项任务可能要求您对一些基本的SIEM收集器相关问题进行故障排除。这包括:</p><ul class=""><li id="07f2" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated">收集器高磁盘使用率</li><li id="55c8" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">自动关闭规则(ACR)无法关闭警报</li><li id="07b3" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">原木损失</li><li id="2293" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">收集器索引范围预警</li><li id="83ef" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">查询API和统计API问题</li><li id="5490" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">任务运行者问题</li><li id="e9c4" class="mv mw it kk b kl ne ko nf kr ng kv nh kz ni ld na nb nc nd bi translated">SIEM离线—红灯警报！</li></ul><h2 id="e3cd" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">收集器问题疑难解答</h2><p id="682d" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">如果收集器运行的是Linux操作系统，那么登录到收集器后，使用下面显示的命令进行查询。</p><ul class=""><li id="0b9d" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><strong class="kk iu">检查收集器的健康状态</strong></li></ul><p id="73b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">分析师应该执行的另一项检查是收集器的“健康状态”——这可以通过查询以下内容来查找任何潜在的问题。</p><pre class="lf lg lh li gt nj nk nl bn nm nn bi"><span id="bede" class="no lw it nk b be np nq l nr ns">df -h ##check for any high disk volume usage<br/>sudo sostat #check for buffer queue and index date range<br/>top #check what's using the processor and memory</span></pre><ul class=""><li id="0630" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><strong class="kk iu">高CPU使用率</strong></li></ul><p id="220c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当关于日志收集器超过平均阈值的警报触发时，通过登录到该收集器的设备(<em class="nt">大概是linux操作系统</em>)并运行以下命令进行调查:</p><pre class="lf lg lh li gt nj nk nl bn nm nn bi"><span id="bce5" class="no lw it nk b be np nq l nr ns">top #check what's using the processor and memory<br/>#Restart any services to resolve the issue.</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="ab gu cl nu"><img src="../Images/c90dbca7a47d8d8cb4212e1f76a07f6f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*JpwgSLF4FDaRH_Wffd2MRw.png"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated"><strong class="bd lx">顶部</strong></figcaption></figure><ul class=""><li id="0959" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><strong class="kk iu">高磁盘使用率</strong></li></ul><p id="58c2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果日志收集器已达到超过95%的临界阈值，请重新启动主机以清除一些磁盘空间并稳定磁盘使用水平。</p><pre class="lf lg lh li gt nj nk nl bn nm nn bi"><span id="e1ad" class="no lw it nk b be np nq l nr ns">df -h #check for any high disk volume usage<br/>#Reboot Host, wait for sometime and then check the disk space status again.</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="ab gu cl nu"><img src="../Images/a1a8569e75916b1be1d34759bf23fb22.png" data-original-src="https://miro.medium.com/v2/format:webp/1*B7OEAdykoNk6Pd0y__avhA.png"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated"><strong class="bd lx"> df -h </strong></figcaption></figure><ul class=""><li id="83b9" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><strong class="kk iu">解决ACR问题</strong></li></ul><p id="d1e7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用以下工具定位停滞的作业(正在运行的流程):</p><pre class="lf lg lh li gt nj nk nl bn nm nn bi"><span id="e9ac" class="no lw it nk b be np nq l nr ns">ps aux | grep &lt;proc_name&gt;</span></pre><p id="95fb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果ACR脚本运行超过10分钟，则尝试使用以下步骤重新启动它:</p><pre class="lf lg lh li gt nj nk nl bn nm nn bi"><span id="4f03" class="no lw it nk b be np nq l nr ns">ps aux | grep &lt;autoclose script&gt; #Search PID for autoclose script<br/>kill -9 &lt;PID&gt; #Kill the process. The service should then re-start on its own</span></pre><ul class=""><li id="b186" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><strong class="kk iu">调查日志丢失(LoL)问题—查询每小时日志计数</strong></li></ul><p id="039e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果收集器未能在规则中定义的设定时间内接收到事件日志，则会触发该规则。然后为该问题创建警报。</p><pre class="lf lg lh li gt nj nk nv nw aw nx bi"><span id="a33d" class="lv lw it nk b gy ny nz l oa ns">In SIEM, select the specific collector that is not receiving the logs. Now run the query against that collector to return the list of Azure Security logs received per hour. This allows analyst to see when the last log was received.</span></pre><ul class=""><li id="78d1" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><strong class="kk iu">收集器索引范围警报</strong></li></ul><pre class="lf lg lh li gt nj nk nl bn nm nn bi"><span id="0eab" class="no lw it nk b be np nq l nr ns">sudo sostat #check for buffer queue and index date range</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ob"><img src="../Images/1ae3b447e558eb1871f8a5b17347ea39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z3RPxQkGVv7kxdrLmWci7g.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated"><strong class="bd lx"> sudo sostat </strong></figcaption></figure><ul class=""><li id="82e5" class="mv mw it kk b kl km ko kp kr mx kv my kz mz ld na nb nc nd bi translated"><strong class="kk iu">解析查询API和统计API </strong></li></ul><p id="2bd0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不正常的查询API和统计API表示web服务器暂时不可用。这可以通过运行以下命令来解决:</p><pre class="lf lg lh li gt nj nk nl bn nm nn bi"><span id="686a" class="no lw it nk b be np nq l nr ns">systemctl status &lt;webserver i.e. apache2&gt; #check the status of the webserver.<br/>systemctl restart &lt;webserver i.e. apache2&gt; #restart the webserver</span></pre><p id="695a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那都是乡亲们！</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="b08b" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lu" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>