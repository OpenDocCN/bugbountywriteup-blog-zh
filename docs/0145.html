<html>
<head>
<title>Distorted and Undeletable Posts in Facebook Group</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">脸书组中扭曲和不可删除的帖子</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/distorted-and-undeletable-posts-in-facebook-group-9424e15f5551?source=collection_archive---------0-----------------------#2018-08-12">https://infosecwriteups.com/distorted-and-undeletable-posts-in-facebook-group-9424e15f5551?source=collection_archive---------0-----------------------#2018-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/9f2af645cd1077b70be3c54f9c3dcfc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*M55nvLRS0LzUWUsif7eyoQ.png"/></div></figure><p id="33a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Sup伙计们，今天我想和大家分享一个有趣的bug，是我通过他们的<a class="ae ks" href="https://www.facebook.com/whitehat/dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> BugBounty程序</strong> </a>在facebook群中发现的，那就开始吧:)</p><p id="c0ac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<strong class="jw ir">6月18日</strong>的一天，我试图在<strong class="jw ir"> facebook组</strong>中测试<strong class="jw ir">直播视频</strong>选项，因为我以前从未测试过，所以我在我的<strong class="jw ir">测试组</strong>(攻击者组)中创建了直播视频，我花了一些时间玩这个选项，寻找一些可能会引导我找到有效bug的东西，但不幸的是，我在里面什么也没找到:(</p><p id="fdb6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以我想通过点击<strong class="jw ir">三个点</strong>来删除<strong class="jw ir">我的现场视频</strong>帖子，我看到了这个:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/27b61efc1eb3c9161951fd79f6b1be05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*WgLx2bM4Wo4yWFekeiRATg.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">单位选项将出现在发布选项中，如果您在组中启用了单位</figcaption></figure><p id="56c3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如上图所示，有一个名为<strong class="jw ir">单位的选项。</strong></p><p id="e7dc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">什么是单元:</strong>单元功能，允许您利用小组作为在线课程内容的平台，或者简单地按主题组织您的帖子，有关更多详细信息，请查看此<a class="ae ks" href="https://www.facebook.com/marismith/posts/-newsflash-another-new-facebook-feature-you-can-add-units-to-facebook-groups-cur/10154506210385009/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">链接</strong> </a>。</p><p id="2f08" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">注意:只有组管理员可以在单元中创建、编辑、删除或添加帖子。</strong></p><p id="ab1d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我对自己说，我记得我以前已经测试过那个选项(单位选项)，但我没有发现任何有趣的东西，但当我再次看到它时，我对自己说，让我们再试一次，因为我从未在这个地方测试过，所以我单击<strong class="jw ir">“添加到新单位”</strong>，我看到了这个:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/c43f18c6578fee3168e096183327b711.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*Kwnz-wYaF2Z1nkwPMR_tUg.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">当你创建一个新的单元时，这个窗口会弹出，填写详细信息并创建一个新的</figcaption></figure><p id="e1af" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我随机填写了详细信息，并用<strong class="jw ir"> Burpsuite </strong>拦截了请求，请求如下:</p><blockquote class="ld le lf"><p id="1706" class="ju jv lg jw b jx jy jz ka kb kc kd ke lh kg kh ki li kk kl km lj ko kp kq kr ij bi translated">POST/groups/learning/create _ with _ POST/？<strong class="jw ir">组标识= </strong>【我的测试组标识】&amp; <strong class="jw ir">帖子标识= </strong>【我的帖子标识】&amp; dpr=1 HTTP/1.1</p><p id="a97b" class="ju jv lg jw b jx jy jz ka kb kc kd ke lh kg kh ki li kk kl km lj ko kp kq kr ij bi translated">jazoest =[number]&amp; FB _ dtsg =[anti _ csrft]&amp;<strong class="jw ir">单元名称= </strong> bla &amp; <strong class="jw ir">单元描述= </strong> bla &amp; <strong class="jw ir">帖子标题= </strong> bla</p></blockquote><p id="2d56" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我看到上面的请求时，两件事引起了我的注意，<strong class="jw ir"> group_id= </strong>和<strong class="jw ir"> post_id= </strong></p><p id="6ced" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">我问了自己两个问题:</strong></p><p id="af49" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">1-如果我将我的<strong class="jw ir"> group_id </strong>值更改为另一个组id(受害者组)会发生什么，是否可以创建新的单位并将我的帖子(视频直播帖子)添加到另一个组(受害者组)中。</p><p id="c254" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">2-如果我将我的<strong class="jw ir"> post_id </strong>值更改为另一个组(受害者组)的其他帖子id会发生什么，是否可以将其他组(受害者组)的帖子添加到我的测试组(攻击者组)中我的单位。</p><p id="3c96" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好吧让我们来看看:)，所以我把<strong class="jw ir"> group_id </strong>的值改成了另一个组(受害者组)，但是没用:(</p><h1 id="a552" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">扭曲帖子:</h1><p id="b3af" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">好的。让我们尝试用另一个组(Victim_group)的另一个帖子id来更改<strong class="jw ir"> post_id </strong>值，响应如下:</p><blockquote class="ld le lf"><p id="0735" class="ju jv lg jw b jx jy jz ka kb kc kd ke lh kg kh ki li kk kl km lj ko kp kq kr ij bi translated">HTTP/1.1 200 OK<br/><br/>for(；；);{"__ar":1，" payload":null，" jsmods ":{ " require ":[[" server redirect "，" redirectPageTo "，[]，[" \/groups \/[<strong class="jw ir">attack _ group _ id</strong>]\/learning _ content \/？filter = filter number&amp;post =<strong class="jw ir">【victim _ post _ id】</strong>，false，false]]}，" js":["IO8eo "，" EizOb"]，" bootloadable":{}，" resource _ map ":{ " IO8eo ":{ " type ":" js "，" src ":" https:\/\/static . xx . fbcdn . net \/rsrc . PHP \/v3 ioay 4 \/yo \/l \/en _ US \/rcr</p></blockquote><p id="f2be" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我看到上面的回应时，我直接切换到受害者小组帐户，我检查了帖子，我看到了以下内容:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/0c49be63d40bfe8cf025fe3eb819ac92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*NEtKF0cydeI3EdGIVuzUyA.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">当攻击者从受害者组添加“仅文本发布”到他的单位时，附件不可用出现</figcaption></figure><p id="a8e1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如你在上面看到的，我能够扭曲<strong class="jw ir">受害者组</strong>中的帖子<strong class="jw ir">(仅文本帖子)</strong>，并使其看起来像上面的丑陋形式。</p><h1 id="bb72" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">不可删除的帖子:</h1><p id="bd58" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">我试图再次重现该bug，并将其应用于<strong class="jw ir">另一个受害者组(noobs组)</strong>，只是为了确保该bug在所有类型的组中都有效，因此我从我的组<strong class="jw ir">获得请求作为攻击</strong> r，并将<strong class="jw ir"> post_id </strong>值替换为受害者组<strong class="jw ir">【noobs组】</strong>的<strong class="jw ir"> post_id，知道(该帖子是我的，但在受害者组中，我不是管理员)， 回复给我200 o.k，一切都很顺利，但是当我查看我在<strong class="jw ir">受害者组(noobs组)</strong>的帖子时，我看到了这个:</strong></p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/796df29cebb8bd0efd00bd2759a612c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*Icq2jAnHsrlMnR-UJcR8Ug.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">删除我，如果你能的话，这是攻击单位的标题，它出现在受害者组的帖子上面</figcaption></figure><p id="5097" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如你在上面看到的，<strong class="jw ir">我看到我的单位名称</strong>出现在我在受害者组的帖子中，嗯，这很奇怪，当我在第一个受害者组测试这个bug时，我看到了<strong class="jw ir">、</strong>，但当我在另一个受害者组<strong class="jw ir"> (noobs组)</strong>、<strong class="jw ir">再次测试时，我能够将我单位的名称放在任何帖子的上方，并使帖子不能被其所有者和组管理员删除</strong>，这真的很奇怪，对吧！！！！</p><p id="116b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Wtf是怎么回事！！玩了一点，想通了，下面是bug影响的结论:</p><h1 id="4e19" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak">这个bug有两个影响:</strong></h1><p id="5dc5" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">1-如果帖子的所有者不是攻击者组中的成员，攻击者只能对受害者组中任何成员(管理员、版主、普通用户)的文本帖子<strong class="jw ir">进行篡改。</strong></p><p id="60aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">2-攻击者可以发布任何帖子(照片、视频、事件..等等)受害者群组<strong class="jw ir">中的任何成员(管理员、版主、普通用户)</strong>不可删除<strong class="jw ir">也可以将他的单位标题放在vicim帖子上面，</strong>只需邀请他的群组(攻击者群组)中帖子的所有者即可。</p><h1 id="73d8" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><strong class="ak">巧合</strong></h1><p id="c71c" class="pw-post-body-paragraph ju jv iq jw b jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr ij bi translated">在我把窃听器提交给脸书证券交易委员会后。团队，我记得我以前在facebook上读到过<strong class="jw ir">无法删除的帖子</strong>，所以我在谷歌上搜索，我看到了这个:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/eff7f234467a47888b41f7ed8a7a842d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*w7S0LB0-Up44V-iWqbj5wQ.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">其他bug猎人已经在2018年5月9日在我之前发现了这个bug</figcaption></figure><p id="009a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我看到那个视频<strong class="jw ir">时，它是同一个bug，但是来自不同的端点</strong>，同时我对wtf感到震惊！！！我说，如果他在youtube上披露了漏洞，这意味着漏洞已被修复，但为了确保我们找到这位研究人员并与他联系，所以我找到了他的facebook账户<a class="ae ks" href="https://www.facebook.com/richard.telleng" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir"/></a>，我与他谈论了漏洞，我告诉他漏洞仍在工作，他告诉我漏洞已被修复<strong class="jw ir">，facebook已经为此奖励了他</strong>，<strong class="jw ir">我还通知了脸书证券交易委员会。团队讲述了整个故事。</strong></p><p id="a2cf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我只想感谢<a class="ae ks" href="https://www.facebook.com/richard.telleng" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">Richard Telleng</strong></a><strong class="jw ir"/>(在我之前发现漏洞的<strong class="jw ir"> </strong>研究员)他的诚实和礼貌，你真是一个伟大的家伙，非常感谢你的巨大支持，我真的很感谢我的兄弟。</p><p id="a20c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">时间线:</strong> <br/>六月。2018年18月—初步报告<br/>6月。2018年7月20日——报道审判<br/>。2018年31日— Bug修复<br/>7月。2018年8月31日—修复确认<br/>2018年8月2日—奖励</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/1c972bcb00ec66dcba646dc6110171ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*BFnQSUP3RstAEbHXogiqng.png"/></div></figure><p id="4367" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我要感谢<strong class="jw ir">脸书安全团队</strong>的赏金。</p><p id="937d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> PoC视频:</strong></p><figure class="ku kv kw kx gt jr"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="6de5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">武道:</strong></p><p id="f696" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">1-试着从不同的方面检查你正在测试的选项，有可能你会从中发现一些有趣的东西。</p><p id="e670" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">2-如果你面临着和我一样的情况，试着联系另一个研究员，问他这个bug是否已经修复，并且对他说实话。</p><p id="168b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">3-对安全团队也要诚实，只是为了确保每件事都很清楚。</p><p id="dc3b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">谢谢你</p><p id="eccd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://www.facebook.com/JubaBaghdad.iq" rel="noopener ugc nofollow" target="_blank">萨马德·哈桑</a> ( <a class="ae ks" href="https://twitter.com/JubaBaghdad" rel="noopener ugc nofollow" target="_blank">朱巴巴格达</a>)</p></div></div>    
</body>
</html>