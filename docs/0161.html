<html>
<head>
<title>TokyoWesterns CTF 4th 2018 Writeup — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">东京西部4th 2018年第4期报道—第1部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tokyowesterns-ctf-4th-2018-writeup-part-1-78558397cb7b?source=collection_archive---------1-----------------------#2018-09-08">https://infosecwriteups.com/tokyowesterns-ctf-4th-2018-writeup-part-1-78558397cb7b?source=collection_archive---------1-----------------------#2018-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5724" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">世界协调时+2时间2018年03月09日下午18:39</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/66c593881410f0251b3d266ddbf04fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zytH-e09WxqLwd4OtdbLEg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">东京西部4th 2018年第4期报道—第1部分</figcaption></figure><p id="76c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TokyoWesterns CTF第四届2018是第四届TokyoWesterns CTF竞赛，由来自日本的TokyoWesterns团队组织。</p><p id="5fce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一场很好的比赛，在不同的类别(网络、反向、Pwnable、加密、热身、杂项)中，组织表现出色，充满了乐趣和实际挑战。</p><p id="1d9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我刚刚开始这个CTF，从开始(世界协调时01/09/2018 01:00:00星期六)到结束(世界协调时03/09/2018 01:00:00星期日)。所以几乎我玩了48小时。</p><p id="1d7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从第一个挑战开始，这个挑战是我在逆转了很长时间后解决的。</p><h1 id="ae15" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">反转—十二月十二月</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/5cb501b1c42cbbc4255676d86a8e625e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zYbBqFgbkf54am0kLecOA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">反转—十二月十二月</figcaption></figure><blockquote class="ma mb mc"><p id="7c60" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated"><strong class="jp ir">挑战:</strong> <a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/challenge/dec_dec_dec-c55c231bfbf686ab058bac2a56ce6cc49ae32fe086af499571e335c9f7417e5b" rel="noopener ugc nofollow" target="_blank"> dec_dec_dec </a></p></blockquote><p id="5a4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是ELF 64位二进制，让我们执行它:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mi"><img src="../Images/77de4294f6081b45d1e4e4566f437324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5XwE3uCNSn_N4wXj4vqEg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">十二月十二日</figcaption></figure><p id="201f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">似乎我们必须找到正确的标志，为此我们必须遵循以下流程:</p><h2 id="8045" class="mj lc iq bd ld mk ml dn lh mm mn dp ll jy mo mp lp kc mq mr lt kg ms mt lx mu bi translated">静态分析</h2><p id="db7b" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">我用IDA Pro分析了这个二进制文件，让我们再来一次:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/e75c96201122030d5ac14bb310838d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q31fkn9KGRghtqRAQglNiA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">IDA Pro中的dec_dec_dec</figcaption></figure><p id="8bc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如你所看到的，根据main()函数，strcmp比较输入和标志，如果它们相同，那么标志是正确的，否则它是不正确的。</p><p id="c365" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先想到的是<a class="ae mh" href="http://angr.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> angr </strong> </a> <strong class="jp ir"> </strong>框架。我花了很长时间试图用angr来解决这个问题，但对我来说很难，因为要对旗帜进行编码需要3个操作。我们回过头来看看我用angr解这个二进制的时候发生了什么。</p><p id="ca22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我的第一个剧本:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">angrbug_1187.py</figcaption></figure><p id="2c3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用了线程并添加了<strong class="jp ir"> 0x400000 </strong>，因为<a class="ae mh" href="https://en.wikipedia.org/wiki/Position-independent_code" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> PIE </strong> </a>被退回，然后我试图在<strong class="jp ir"> <em class="md">(正确的函数地址= 0x1075) </em> </strong>中找到正确的输入，并避免错误的输入<strong class="jp ir"> <em class="md">(错误的函数地址= 0x1120) </em> </strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/3ac908bdd63c45d93b0c33cdb5618b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*6egUz-Tm07MMW-OU6zFlFg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">启用饼图</figcaption></figure><p id="964f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实上，我刚刚尝试了这个脚本，但不确定我会用这个100%解决它，因为我知道有三个函数来编码flag，用这个脚本解决它并不容易。但是让我们试一试吧！</p><p id="878e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结果:</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/e00c152cd384c8de3a43a7af06a650f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BRAAaaHVD9j_FsJMJEMMNQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">angr框架中的bug</figcaption></figure><p id="277a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看来这是个bug！！！</p><p id="606e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我举报了:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/angr/angr/issues/1187" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">copy()获得意外的关键字参数“stashes”错误问题#1187 angr/angr</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">你好，我只是想报告新的错误:PoC import angr main = 0x 104 a find = 0x 1075 avoid =[0x 1120]p =…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kv ni"/></div></div></a></div><p id="6998" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几分钟后，Shellphish团队成员之一(@rhelmot)回复我:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nx"><img src="../Images/b31885118a3abcc6340ef7348b6ecc65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KiwaHR3IzQ8nA_G8sbTWAg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">angr框架中的错误被标记为重复</figcaption></figure><p id="3033" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯……这是一个bug，标记为<a class="ae mh" href="https://github.com/angr/angr/issues/1032" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> #1032 </strong> </a> <strong class="jp ir"> </strong>的重复，关闭！</p><p id="f4c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用了线，实际上它已经坏了一段时间了。这是我在angr框架上复制的bug。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">发现了一个错误(重复)</figcaption></figure><p id="5306" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们回到挑战。在尝试用angr框架解决它很长时间后，我还是没能解决它。所以我决定用静态分析来解决。</p><p id="0074" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/main.c" rel="noopener ugc nofollow" target="_blank"> <em class="md">主</em> </a>功能:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/c0954f40f69de75fd8a54216a8aa4542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*NO_IsXGbyiH2h4MqlF3vcA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">主要功能</figcaption></figure><p id="3aa9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，输入是in参数，传入3个函数(<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/sub_860.c" rel="noopener ugc nofollow" target="_blank"> <em class="md"> sub_860 </em> </a> <em class="md">，</em><a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/sub_F59.c" rel="noopener ugc nofollow" target="_blank"><em class="md">sub _ F59</em></a><em class="md">，</em> <a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/sub_BE7.c" rel="noopener ugc nofollow" target="_blank"> <em class="md"> sub_BE7 </em> </a>)然后与编码标志进行比较:</p><pre class="km kn ko kp gt nz oa ob oc aw od bi"><span id="d6d5" class="mj lc iq oa b gy oe of l og oh"><strong class="oa ir">s2 = "</strong><a class="ae mh" href="http://twitter.com/25" rel="noopener ugc nofollow" target="_blank"><strong class="oa ir">@25</strong></a><strong class="oa ir">-Q44E233=,&gt;E-M34=,,$LS5VEQ45)M2S-),7"</strong></span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oi"><img src="../Images/e26cfc2d4e4afb325642b6abb998f634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ih25nX2Iqqpwr8PEJmiTaw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">s2(编码标志)</figcaption></figure><p id="fad8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了手动反转，我们必须分别对这三个函数逐一进行静态分析。先说第一个(<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/sub_860.c" rel="noopener ugc nofollow" target="_blank"> <em class="md"> sub_860 </em> </a> <em class="md">)。</em></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7317" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我手动反过来，发现那是<a class="ae mh" href="https://en.wikipedia.org/wiki/Base64" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">base64</strong></a><strong class="jp ir"/>编码功能:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/15577780db7c34c64cf0cd7f6ef5701e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*FIunqd-j9rrjwS-B3uvydw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">sub_860函数(base64) 1</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ok"><img src="../Images/78d97898bb6397685bf88109d2c6e05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11iTHwnDjxchl3yY7X3fFw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">sub_860函数(base64) 2</figcaption></figure><p id="c7a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我手动反转了第二个函数(<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/sub_F59.c" rel="noopener ugc nofollow" target="_blank"> <em class="md"> sub_F59 </em> </a>)。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="2f71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现那是<a class="ae mh" href="https://en.wikipedia.org/wiki/ROT13" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">rot 13</strong></a><strong class="jp ir"/>的密码功能:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ol"><img src="../Images/ab559a64de3be3c1d6cec9ddffec94f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:938/format:webp/1*Jb_P7sf9j6HRCdHL2mLPoA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">sub_F59功能(rot13)</figcaption></figure><p id="13ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我分析了第三个也是最后一个函数(<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/sub_BE7.c" rel="noopener ugc nofollow" target="_blank"> <em class="md"> sub_BE7 </em> </a>)。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="3ebf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很难手动反转它，因为它很长，但我尽了最大努力，编写了许多脚本，以便在python中构建编码函数来编码消息，然后将使用它来生成字节的标志，这将在结果中给我编码的标志。这是我的第一个想法，我有另一个想法是建立编码功能，然后在python中将其转化为解密功能。但是我没能成功地做到这些想法。</p><p id="dafc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我考虑使用<a class="ae mh" href="https://github.com/longld/peda" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> GDB-PEDA </strong> </a>进行调试，并且我突破进入<em class="md"> strcmp </em>以便查看这个函数是如何工作的以及标志的加密是如何发生的。然后我手动强制，直到直接找到标志的所有字节。下面是我在调试方法中遵循的过程，我一直使用它直到找到标志:</p><p id="4aca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我之前提到的我们必须强行进入<em class="md"> strcmp </em>函数，并且我们知道<a class="ae mh" href="https://en.wikipedia.org/wiki/Position-independent_code" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">派</strong> </a>被启用。所以我们必须先绕过<a class="ae mh" href="https://en.wikipedia.org/wiki/Position-independent_code" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">派</strong> </a>，为了做到这一点我们必须将断点分成<strong class="jp ir"><em class="md">base _ address+strcmp _ address</em></strong>。</p><ol class=""><li id="99ce" class="om on iq jp b jq jr ju jv jy oo kc op kg oq kk or os ot ou bi translated">找到<strong class="jp ir"> <em class="md">基_地址</em> </strong>:</li></ol><p id="7c79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们必须找到二进制地址的起始点:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ov"><img src="../Images/30ce772ca40c062d0a7622a5b5dcc19e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cdIpZc8pDYHEmk22OuJSxw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">起点地址</figcaption></figure><p id="4fef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后将断点放入其中<strong class="jp ir"> <em class="md"> (0x730) </em> </strong>然后运行程序，然后使用以下命令显示映射的地址空间:</p><pre class="km kn ko kp gt nz oa ob oc aw od bi"><span id="d46b" class="mj lc iq oa b gy oe of l og oh"><strong class="oa ir">gdb-peda$</strong> info proc mappings</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ow"><img src="../Images/c04933e9a9d000025a05762b532d8e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7QyAiD3m30H00P93rA56UQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">gdb-peda(查找基址…)</figcaption></figure><p id="e42b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上图，<strong class="jp ir"> <em class="md">基址</em> </strong>为:<strong class="jp ir"><em class="md">0x 55555554000</em></strong></p><p id="c609" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.找到<strong class="jp ir"><em class="md">strcmp _ address</em></strong>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ox"><img src="../Images/f197d7f1a472c39050398a01c01cfd69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81hywD8xAhCq4HFVVyn9Cg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">调用strcmp</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oy"><img src="../Images/a74210ade63196e8e85460e40694ef14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujTRpJ_urNRcs-OHnYdNQQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">strcmp地址</figcaption></figure><p id="9bf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上图，strcmp_address为:<strong class="jp ir"> <em class="md"> 0x710 </em> </strong></p><p id="98ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.断点进入<strong class="jp ir"><em class="md">base _ address+strcmp _ address</em></strong>:</p><p id="7b7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="md">0x 55555554000+0x 710 = 0x 55555554710</em></strong></p><pre class="km kn ko kp gt nz oa ob oc aw od bi"><span id="c717" class="mj lc iq oa b gy oe of l og oh"><strong class="oa ir">gdb-peda$</strong> b * 0x555555554710<br/><strong class="oa ir">gdb-peda$</strong> r TWCTF{</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oz"><img src="../Images/1c4256a94e64c407a6a439a73f3a763d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18Ns324xxxKcjlkKaXGYOA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">gdb-peda(暴力标志…)</figcaption></figure><p id="6de7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如上图所示，我只是把<strong class="jp ir"> "TWCTF{" <em class="md"> </em> </strong>(标志格式)<strong class="jp ir"> <em class="md"> </em> </strong> <em class="md">作为输入，也就是上面ida pro中所示的</em><strong class="jp ir"><em class="md"/>S1<em class="md"/></strong>，并移入<strong class="jp ir"> $rdi </strong>寄存器，与上面ida pro中所示的编码标志<strong class="jp ir"> s2 </strong>进行比较，并移入<strong class="jp ir"> $rsi </strong>寄存器。因此，我们可以强制其他字节的标志，直到获得类似的编码信息，这是在上面的<strong class="jp ir"> $rsi </strong>寄存器。</p><pre class="km kn ko kp gt nz oa ob oc aw od bi"><span id="dc53" class="mj lc iq oa b gy oe of l og oh"><strong class="oa ir">gdb-peda$</strong> r TWCTF{base64_rot13_uu}</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pa"><img src="../Images/66e2b2ffbbaa70b3e607323aac5172ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vlY-9wSeWxCwS0fX6M5gLg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">gdb-peda(国旗已被损坏)</figcaption></figure><p id="2860" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，我们在两个寄存器中得到相似的编码信息，最后:</p><blockquote class="ma mb mc"><p id="2b89" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated"><strong class="jp ir"> strcmp(s1，s2) = 0 </strong></p></blockquote><p id="97ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">意味着程序将跳转到正确的功能，并向我们显示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/a914d9416b1df3b0b5bd85bafa672b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:264/format:webp/1*3Ky0N3nDfXt8w7wpkTsdIQ.png"/></div></figure><p id="3c5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们回到我们的手动反向，经过长时间的搜索我才发现第三个函数<strong class="jp ir">(</strong><a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/TokyoWesterns%20CTF%204th%202018/reversing/dec%20dec%20dec/sub_BE7.c" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="md">sub _ BE7</em></strong></a><strong class="jp ir"><em class="md">)</em></strong><em class="md">是</em><a class="ae mh" href="https://fr.wikipedia.org/wiki/Uuencode" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">uuencode</strong></a><em class="md"/>函数<em class="md">。</em></p><p id="c6f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一般来说，程序接受输入，并在经过3个函数后对其进行3次编码:<strong class="jp ir">base64 encode&gt;rot 13&gt;uuencode。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pc"><img src="../Images/d381922554792b2b1ff69a2189e63a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZDIdThXJm1j7J4pLFh4Q_Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">所有加密函数都已知后的主函数</figcaption></figure><p id="7d2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要解密它，我们必须颠倒上面提到的过程，它将是这样的:<strong class="jp ir">u decode&gt;rot 13&gt;base64 decode。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pd"><img src="../Images/a0b81bf4e292b5505d4826f4073346bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_hBQCTCYLmnb8opNr-0dPg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">标志已被解码</figcaption></figure><p id="85b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成标志并提交:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/c3d81a935eae8a4f839d44050cd704cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6DIO0zw8inygazoBLvjTNQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">dec_dec_dec已求解</figcaption></figure><blockquote class="ma mb mc"><p id="4d9c" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">标志为:<strong class="jp ir"> TWCTF{base64_rot13_uu} </strong></p></blockquote><p id="3379" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我知道这很长…但我希望它也能有所帮助。如果你有兴趣阅读更多…请查看这篇文章的第二部分<a class="ae mh" href="https://medium.com/@Abdelkad3r/tokyowesterns-ctf-4th-2018-writeup-part-2-81c77cffe7ec" rel="noopener"><strong class="jp ir"/></a>。</p></div></div>    
</body>
</html>