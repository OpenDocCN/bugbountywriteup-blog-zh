<html>
<head>
<title>Disclose private attachments in Facebook Messenger Infrastructure - 15,000$</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">披露Facebook Messenger基础设施中的私人附件- 15，000美元</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/disclose-private-attachments-in-facebook-messenger-infrastructure-15-000-ae13602aa486?source=collection_archive---------0-----------------------#2019-02-13">https://infosecwriteups.com/disclose-private-attachments-in-facebook-messenger-infrastructure-15-000-ae13602aa486?source=collection_archive---------0-----------------------#2019-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c782c190c943c1baf2968aea9c32d764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9BSl9MHF1hIqAVfYme0MBg.png"/></div></div></figure><p id="da1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大家好，今天我想和大家分享我目前为止在脸书发现的最关键的bug，让我们开始吧:)</p><p id="fe01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2019年1月22日凌晨4点我正在抽烟，突然想到了<a class="ae kw" href="https://portal.facebook.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">门户脸书</strong> </a>。</p><h1 id="cb77" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是门户脸书</h1><p id="65f2" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">脸书门户是来自脸书的视频通信设备。更多详情见此<a class="ae kw" href="https://portal.facebook.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">链接</strong> </a></p><p id="eb70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我之前已经测试过<strong class="ka ir">portal.facebook.com</strong>了，没有发现任何东西，但是当我再次打开网站，切换到<strong class="ka ir">账户设置的时候，</strong>我看到了以前没有看到的<strong class="ka ir">新</strong>的东西，见下图:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/adbd2e0d8751f71177f78eea38c791b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49o9YjgRRwwcApCLTaIX4w.jpeg"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">在门户网站脸书支持机器人聊天</figcaption></figure><p id="fe79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我注意到您可以上传附件，例如，<strong class="ka ir">图像、视频和文件</strong>，当我看到我说我需要测试<strong class="ka ir">这个上传功能</strong>时，我上传了普通图像并用Burpsuite拦截了请求，以查看post请求中的参数类型，然后我看到了:</p><blockquote class="mj mk ml"><p id="6173" class="jy jz mm ka b kb kc kd ke kf kg kh ki mn kk kl km mo ko kp kq mp ks kt ku kv ij bi translated">POST/messaging/send/HTTP/1.1<br/>主持人:【www.facebook.com】T21</p><p id="d22a" class="jy jz mm ka b kb kc kd ke kf kg kh ki mn kk kl km mo ko kp kq mp ks kt ku kv ij bi translated">client = mercury &amp; action _ type = ma-type:user-generated-message &amp; body = &amp; periodic _ TTL _ mode = 0 &amp; has _ attachment = true &amp;<strong class="ka ir">image _ ids[0]= 123</strong>&amp;message _ id = 111&amp;offline _ threading _ id = 123</p></blockquote><p id="fd2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如你在上面的请求中看到的，有一个有趣的参数<strong class="ka ir">叫做<strong class="ka ir"> image_ids[0] </strong>，它指的是我在门户网站脸书聊天上传的图片，我说如果我<strong class="ka ir">把这个ID </strong>改成<strong class="ka ir">其他用户图片ID </strong>，我能公开他的图片吗！！！？？其他附件(文件、视频、音频消息)呢！！在门户聊天中做了大量测试后，我注意到以下情况:</strong></p><ul class=""><li id="a693" class="mq mr iq ka b kb kc kf kg kj ms kn mt kr mu kv mv mw mx my bi translated">我可以向其他用户披露通过聊天发送的任何附件，这些附件包括(<strong class="ka ir">图像、文件、视频和音频消息</strong></li><li id="9120" class="mq mr iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated">它适用于所有脸书聊天基础设施(<strong class="ka ir">脸书主聊天、信使、门户聊天和工作场所聊天</strong>)</li><li id="d488" class="mq mr iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated">我能够从任何聊天(脸书主聊天，信使，工作场所和门户聊天)中重现这个错误，这没关系，因为<strong class="ka ir">是相同的</strong></li><li id="647c" class="mq mr iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated">我不得不在Burpsuite的<strong class="ka ir">代理标签</strong>中保持请求活动，以成功重现bug，将它发送到<strong class="ka ir">中继器</strong>会给我一个错误(直到现在也不知道为什么)</li></ul><h1 id="5571" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我的想法:</h1><p id="ec0c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">想象一下，如果一个恶意的黑客发现了这个漏洞，并创建了一个工具来暴力破解其他用户的ID(图像ID，视频ID，文件ID和音频消息ID)，更不用说我们谈论的是每天使用脸书聊天的数百万用户，想象一下，如果他泄露了一个非常重要的人的音频消息，照片或视频…例如，如果我们谈论的是<strong class="ka ir">的隐私</strong>，这真的很危险。</p><p id="30fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我直接向<strong class="ka ir">脸书安全团队</strong>报告了此事，他们给了我一笔可观的赏金<strong class="ka ir"> 15k，</strong>非常感谢这些家伙的赏金:)</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/fc2e3399e0774860b0f5aa87a334973f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*2E_OaJAD3KvGxAKXTh3QYw.jpeg"/></div></figure><p id="0164" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi">Also I would like to thanks my brothers <a class="ae kw" href="https://www.facebook.com/Kassembazoun" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Kassem Bazzoun</strong></a><strong class="ka ir">,</strong><a class="ae kw" href="https://www.facebook.com/robots.tx" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">張啟元</strong></a><strong class="ka ir"> and </strong><a class="ae kw" href="https://www.facebook.com/max.pasqua" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Max Pasqua</strong></a> for their great support :)</p><p id="c4ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">时间表:</strong><br/>2019年1月22日—初始报告<br/>2019年2月04日—报告分类<br/>2019年2月13日—错误修复<br/>2019年2月13日—修复确认<br/>2019年2月13日—奖励15k</p><p id="d11d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">概念验证视频:</strong></p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="443f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">外卖:</strong></p><p id="0e1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1-试着不时地测试你的目标，有时你会像我一样看到一些你从未见过的东西。</p><p id="912a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2-不要相信回应，得到一个错误并不意味着结束:)</p><p id="f82a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢你</p><p id="12eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">萨尔马德·哈桑 ( <a class="ae kw" href="https://twitter.com/JubaBaghdad" rel="noopener ugc nofollow" target="_blank">朱巴巴格达</a></p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="6773" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mm">关注</em> <a class="ae kw" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="mm"> Infosec报道</em> </a> <em class="mm">获取更多此类精彩报道。</em></p><div class="no np gp gr nq nr"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">信息安全报道</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">medium.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of jw nr"/></div></div></a></div></div></div>    
</body>
</html>