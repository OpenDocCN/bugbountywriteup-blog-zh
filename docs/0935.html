<html>
<head>
<title>HTB Tabby [writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTB·塔比</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-tabby-writeup-e5d25fb57329?source=collection_archive---------1-----------------------#2020-11-07">https://infosecwriteups.com/htb-tabby-writeup-e5d25fb57329?source=collection_archive---------1-----------------------#2020-11-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1848" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">目录遍历| LXD | RCE |弱密码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/701ec7ed30beea9ff142fe447248bda4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*TopNQ-rBiqKPfWMuDzjz3A.png"/></div></figure><h1 id="4624" class="kq kr it bd ks kt ku kv kw kx ky kz la jz lb ka lc kc ld kd le kf lf kg lg lh bi translated">摘要</h1><p id="5c3b" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该网站利用了一个不充分的安全验证，即回溯系统的敏感文件。信息泄漏导致访问host-manager门户，暴露其版本易受远程代码执行的攻击。</p><p id="4cef" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">发现该用户是某个组的成员，如果该组被利用，就会让该用户成为超级用户！</p><p id="40cd" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated"><strong class="lk iu">使用的工具:</strong> <code class="fe mj mk ml mm b">nmap</code> | <code class="fe mj mk ml mm b">apt-file</code> | <code class="fe mj mk ml mm b">fcrackzip</code> |囊袋| <code class="fe mj mk ml mm b">msfconsole</code></p><h1 id="e767" class="kq kr it bd ks kt ku kv kw kx ky kz la jz lb ka lc kc ld kd le kf lf kg lg lh bi translated">侦察和计数</h1><p id="48f3" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu"> Nmap扫描</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/b28893a0149a4e0acadf8aa393c1fc85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Son_j7lb9bOceLq1iRHXKA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">运行nmap以查找开放的端口</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mw"><img src="../Images/0923507ea52559483127fa7a8fe5dbaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A1WAyYm6A9KJUVz1x72ecg.png"/></div></div></figure><p id="3159" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">该网站的源代码揭示了一个可能被利用的<code class="fe mj mk ml mm b">file </code>参数:</p><p id="c9db" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated"><code class="fe mj mk ml mm b">http://megahosting.htb/news.php?files=statment</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mx"><img src="../Images/f4ae6390c7be0135e5eab9badbe65c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*onW9kjpUdvqni70nM5CpZw.png"/></div></div></figure><p id="4c22" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">在本地机器的<strong class="lk iu"> /etc/hosts </strong>文件中添加IP地址主机名。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi my"><img src="../Images/322eb60fa70a4d5cead51830618e330d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*hoXHYBc9OA6Be538HB6KeQ.png"/></div></figure><p id="da86" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">在burpsuite中，我尝试了如下所示的点点斜线攻击:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mz"><img src="../Images/c4b02aa9ec7c92a1344355cd099c04eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkpVngZ7hhv7lD1XZG6Pcg.png"/></div></div></figure><p id="a6da" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">文件参数确实容易受到<strong class="lk iu">点点斜线攻击</strong>。它不限制用户访问上层文件系统目录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi na"><img src="../Images/608c4189f29304ad662ad1a1114124f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jGGsSh8TUUym2oCjdRf7hA.png"/></div></div></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="7ee7" class="ni kr it bd ks nj nk dn kw nl nm dp la lr nn no lc lv np nq le lz nr ns lg nt bi translated">端口8080上的Tomcat9</h2><p id="664c" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在<a class="ae nu" href="http://10.10.10.194:8080" rel="noopener ugc nofollow" target="_blank">http://10 . 10 . 10 . 194:8080</a>上，在页面底部提到了以下内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi nv"><img src="../Images/e61ba03d67ce690414ca311957933b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5aa8Mtz7wNXmeBQxzqtyYA.png"/></div></div></figure><h2 id="3bab" class="ni kr it bd ks nj nk dn kw nl nm dp la lr nn no lc lv np nq le lz nr ns lg nt bi translated">Tomcat9用户文件位置搜索</h2><p id="f8a8" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nw">我试图通过我们发现的LFI漏洞来搜索上述xml文件。但是没有快乐。</em></p><p id="6ea1" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">所以现在为了理解Tomcat文件系统结构以找到潜在的用户名/密码，我使用了工具<code class="fe mj mk ml mm b">apt-file</code> <strong class="lk iu">。</strong></p><p id="d095" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">我安装了<code class="fe mj mk ml mm b">apt-file</code>命令来理解tomcat文件的结构和敏感文件的位置。这样，我就可以在端口80上发现LFI漏洞中注入相同的文件位置。</p><blockquote class="nx ny nz"><p id="fa4e" class="li lj nw lk b ll me ju ln lo mf jx lq oa mg lt lu ob mh lx ly oc mi mb mc md im bi translated">$ sudo apt-get安装apt文件</p><p id="d1e7" class="li lj nw lk b ll me ju ln lo mf jx lq oa mg lt lu ob mh lx ly oc mi mb mc md im bi translated">$ sudo apt-文件更新</p><p id="ee72" class="li lj nw lk b ll me ju ln lo mf jx lq oa mg lt lu ob mh lx ly oc mi mb mc md im bi translated">$ sudo apt-文件搜索tomcat | grep用户</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi od"><img src="../Images/ca9ed728ccfc0f55953c28ba93661658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TqeJLm_HgDFgpRAmm5BjKg.png"/></div></div></figure><p id="a217" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">在浏览器上，您会注意到<strong class="lk iu"> tomcat-users.xml </strong>文件中的内容是空白的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi oe"><img src="../Images/3d50520a25b550dfdc5e64ead578c1d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-cApNLMBb-xEmKtpSsmA9w.png"/></div></div></figure><p id="2c20" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">但是，如果您使用burpsuite并访问“tomcat-users.xml”文件的相同位置，您将能够看到响应头中的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi of"><img src="../Images/8399f70ba4871b613c6e31ee4cd0df8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZD04HHQLzM9SvydiB2dhw.png"/></div></div></figure><p id="b0be" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">下面是回复标题，您可以在其中找到用户名和密码，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi og"><img src="../Images/25a1de3a4ebf1026ebf9b968b91f804c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUmPbzniFVoVWyNbzZ-Bcg.png"/></div></div></figure><h2 id="a817" class="ni kr it bd ks nj nk dn kw nl nm dp la lr nn no lc lv np nq le lz nr ns lg nt bi translated">端口8080上的主机管理器</h2><p id="fafd" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以上凭据适用于以下门户:</p><blockquote class="nx ny nz"><p id="934a" class="li lj nw lk b ll me ju ln lo mf jx lq oa mg lt lu ob mh lx ly oc mi mb mc md im bi translated"><a class="ae nu" href="http://megahosting.htb:8080/host-manager" rel="noopener ugc nofollow" target="_blank">http://megahosting.htb:8080/host-manager</a></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi oe"><img src="../Images/92379040300361dbed06086a67bd2c50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kn-5WtErwxdEkxSVbnmPDg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi oh"><img src="../Images/3978a6a23db6f1ad063346cb613d9a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SIvgndPyrYl2CS_2uCFR6A.png"/></div></div></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="6c74" class="kq kr it bd ks kt oi kv kw kx oj kz la jz ok ka lc kc ol kd le kf om kg lg lh bi translated">反向外壳</h1><p id="ca0f" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">CVE 2020–1938版本9.0.31</p><p id="9812" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated"><a class="ae nu" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1938" rel="noopener ugc nofollow" target="_blank"> Tomcat 9.0.31 </a>的默认配置易受攻击，从而导致远程代码执行(RCE)。关于这个漏洞的更多信息可以在<a class="ae nu" href="http://tomcat.apache.org/security-9.html#Fixed_in_Apache_Tomcat_9.0.31" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><blockquote class="on"><p id="2f77" class="oo op it bd oq or os ot ou ov ow md dk translated">在运行任何漏洞利用之前，我会将机器重置为全新安装，以确保正确的漏洞利用正常工作。</p></blockquote><p id="e5e8" class="pw-post-body-paragraph li lj it lk b ll ox ju ln lo oy jx lq lr oz lt lu lv pa lx ly lz pb mb mc md im bi translated">使用<code class="fe mj mk ml mm b">msfconsole</code>，我在<code class="fe mj mk ml mm b">exploit/multi/http/tomcat_mgr_deploy</code>模块下创建了以下设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi pc"><img src="../Images/2030f124668ecb3afba4d6813b11c663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xxMtYwasQ7Nhk1Rht0laoQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/32875b3d1c7150d0a6e7b39e54494bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*Mm3YrLaqL9Gv_4tvO0-Wxg.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi gj"><img src="../Images/70224955a56c49dcde39dcd3b05e6bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFS-DXzAcZUfuXy3QbK5Lg.png"/></div></div></figure><h2 id="666f" class="ni kr it bd ks nj nk dn kw nl nm dp la lr nn no lc lv np nq le lz nr ns lg nt bi translated">成功！！！</h2><blockquote class="on"><p id="20e4" class="oo op it bd oq or os ot ou ov ow md dk translated">但是坚持住！</p></blockquote><figure class="pf pg ph pi pj kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi pe"><img src="../Images/e64c571c46c05eb0bc8f52ea7f09e5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4zKrudiU8pNBrJbZl5iwsg.png"/></div></div></figure><p id="0839" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">无法从<code class="fe mj mk ml mm b">tomcat</code>用户处检索到<code class="fe mj mk ml mm b">user.txt</code>文件。</p><p id="d645" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">我们需要<code class="fe mj mk ml mm b">ash</code>用户账号密码来获取<code class="fe mj mk ml mm b">user.txt</code>文件。</p><h1 id="eecd" class="kq kr it bd ks kt ku kv kw kx ky kz la jz lb ka lc kc ld kd le kf lf kg lg lh bi translated">横向运动</h1><p id="faad" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu">横向权限提升</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi pk"><img src="../Images/4272fa6b5ad150a25bee8e1453900d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pEHSN1T56ML6wMvqlho9QQ.png"/></div></div></figure><p id="61fe" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">在<code class="fe mj mk ml mm b">/var/www/html/files</code>中你会发现一个有趣的<code class="fe mj mk ml mm b">16162020_back.zip</code>文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi pl"><img src="../Images/8a597b5f354ab276a67cffc2b8847c6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cbX0lLR7uV7xsLRK78ntBg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated"><strong class="bd ks">我发现下载zip文件最简单的方法是这样的！</strong></figcaption></figure><p id="2ef3" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">在尝试解压这个文件时，我发现它有密码保护。</p><p id="06e1" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">我运行命令<code class="fe mj mk ml mm b">fcrackzip -u -c a -D -p /usr/share/wordlists/rockyou.txt '/home/komal/Documents/htb/tabby/16162020_backup.zip'</code>来破解密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi oe"><img src="../Images/fbe1e62580a72c14e4ad29601a99487a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IUcmsv4kHbNy5Dr_FUvT2w.png"/></div></div></figure><p id="7a6e" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">解压文件夹并查看文件内容后，我没有找到任何感兴趣的东西:-(</p><p id="692b" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated"><strong class="lk iu">直到……我这样做了……</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/ba286d06c04ce21a5bde9e99ed89c1e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*c0IuJuv1xYx1rwcg8yA6TQ.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">这是一个糟糕的密码策略</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/fd7ca40b904320084cb40c6c512df60e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*XR98DcWN37nU_sCEMQL0fA.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">成功了！！！</figcaption></figure><blockquote class="on"><p id="ae27" class="oo op it bd oq or po pp pq pr ps md dk translated">第二阶段的任务一已经完成了！</p></blockquote></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="8f5c" class="kq kr it bd ks kt oi kv kw kx oj kz la jz ok ka lc kc ol kd le kf om kg lg lh bi translated">垂直权限提升</h1><p id="5742" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">用户<code class="fe mj mk ml mm b">ash</code>群透露是LXD群成员。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi pt"><img src="../Images/d026eddb14ee307d667640af0d10bd1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eqvQXfj9k1WYO-qg14wYFA.png"/></div></div></figure><p id="eccf" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">LXD (Linux守护进程)—Linux容器管理程序</p><p id="5806" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">LXC (Linux容器)</p><ul class=""><li id="176a" class="pu pv it lk b ll me lo mf lr pw lv px lz py md pz qa qb qc bi translated">如果用户是<code class="fe mj mk ml mm b">lxd</code>组的成员，那么这可能会导致获得根用户访问权限。更多关于lxd漏洞的信息可以在<a class="ae nu" href="https://www.exploit-db.com/exploits/46978" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li></ul><blockquote class="on"><p id="6a42" class="oo op it bd oq or po pp pq pr ps md dk translated"><code class="fe mj mk ml mm b">'lxc'</code>是一个linux命令，通过它可以运行LXD的所有功能。</p></blockquote><figure class="pf pg ph pi pj kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi qd"><img src="../Images/043a537c15bd55cb36ba5b95b37b3076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X11rMBc6MBXsllRj02ca9w.png"/></div></div></figure><p id="bede" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">通过运行如上所示的<code class="fe mj mk ml mm b">lxc list</code>命令，我们可以看到如何开始运行我们的第一个LXD实例:</p><blockquote class="nx ny nz"><p id="577d" class="li lj nw lk b ll me ju ln lo mf jx lq oa mg lt lu ob mh lx ly oc mi mb mc md im bi translated"><code class="fe mj mk ml mm b"><em class="it">lxd init</em></code></p><p id="8120" class="li lj nw lk b ll me ju ln lo mf jx lq oa mg lt lu ob mh lx ly oc mi mb mc md im bi translated"><code class="fe mj mk ml mm b"><em class="it">lxc launch ubuntu:18.04</em></code> —运行这个命令对我不起作用，所以我采取了不同的方法。</p></blockquote><p id="bac3" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated"><strong class="lk iu">但首先:</strong></p><p id="0a86" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">在我的攻击者机器上，我从github下载了Alpine container builder脚本’,并运行以下命令:</p><blockquote class="nx ny nz"><p id="1c06" class="li lj nw lk b ll me ju ln lo mf jx lq oa mg lt lu ob mh lx ly oc mi mb mc md im bi translated">git克隆<a class="ae nu" href="https://github.com/saghul/lxd-alpine-builder.git" rel="noopener ugc nofollow" target="_blank">https://github.com/saghul/lxd-alpine-builder.git</a>T2【CD lxd-alpine-builder . git<br/>。/build-阿尔卑斯山</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi qe"><img src="../Images/67d4990ce28639a28fe0620baac90000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQ1IsKjtQKln4uVmP3fH_w.png"/></div></div></figure><p id="9c3b" class="pw-post-body-paragraph li lj it lk b ll me ju ln lo mf jx lq lr mg lt lu lv mh lx ly lz mi mb mc md im bi translated">成功执行后，您将看到“alpine-v 3.12-x86 _ 64–2020 07 01 _ 1615 . tar . gz”文件已创建。现在，把这个文件放在你的本地网络主机上，然后传输到ash。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi qf"><img src="../Images/61a7c6ee9ba300a9efc88502cf9dceb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZWr7yM97hDbhKRsgpsEnw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">启动apache2 web服务器来托管gz文件。</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi qg"><img src="../Images/57e2c5deae90ca52b45ebd8825682e8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JReW5fszdO4QZRM2JL1HtA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">gz文件通过wget检索到ash@tabby机器中。</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi qh"><img src="../Images/2a3cd2b50250a9b5ad294722c571e18d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KjDi7PdiTUftfvB0Efdk3Q.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">导入lxc图像，并将图像名称设置为“alpine”</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi qi"><img src="../Images/5c2c9bad85cd645e2f540600fb7203bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zfr6TQpUE1e44GASBMIfjg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">在这里，我们创建了一个名为“newprofile”的新容器，并将其设为特权容器。</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi qj"><img src="../Images/e14b6a2318cb20620602f51592c19074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Jwul3lhUGU6GstH1eVd4g.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">在这里，通过特权容器(newprofile)，我们将主机的文件系统(容器磁盘源=/)挂载到路径“mnt”目录(路径=/mnt)以获得根目录。</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi qk"><img src="../Images/0b3a1221f4ccb5f043b17b3ce354c023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u0uIlFRBYaFiqbSOPk4k2w.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">启动容器后，我们现在可以在“lxc list”下看到其活动状态为“running”。</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi ql"><img src="../Images/d38b006d181b1abb4bac155d44b2bb5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0f4pJ1FD50HUy75TM5ZM-Q.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">最后，特权容器被滥用来获取外壳</figcaption></figure><blockquote class="on"><p id="6303" class="oo op it bd oq or po pp pq pr ps md dk translated">第二阶段的任务II已经完成了！</p></blockquote><figure class="pf pg ph pi pj kn gh gi paragraph-image"><div class="gh gi qm"><img src="../Images/233b28800f2ad553b981742b0ed27802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/1*5Hp3dPxiEtieV5-uB59wYw.gif"/></div></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="c1d0" class="kq kr it bd ks kt oi kv kw kx oj kz la jz ok ka lc kc ol kd le kf om kg lg lh bi translated">补救</h1><ul class=""><li id="aa73" class="pu pv it lk b ll lm lo lp lr qn lv qo lz qp md pz qa qb qc bi translated">实施适当的ACL控制来停止回溯文件和目录。</li><li id="9e42" class="pu pv it lk b ll qq lo qr lr qs lv qt lz qu md pz qa qb qc bi translated">从标准用户帐户中删除LXD组。</li><li id="8d10" class="pu pv it lk b ll qq lo qr lr qs lv qt lz qu md pz qa qb qc bi translated">避免出于不同目的使用相同的密码。</li><li id="e6ef" class="pu pv it lk b ll qq lo qr lr qs lv qt lz qu md pz qa qb qc bi translated">始终使用至少10个字符的唯一密码/密码短语。</li></ul></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="d286" class="kq kr it bd ks kt oi kv kw kx oj kz la jz ok ka lc kc ol kd le kf om kg lg lh bi translated">参考资料:</h1><ul class=""><li id="b2b2" class="pu pv it lk b ll lm lo lp lr qn lv qo lz qp md pz qa qb qc bi translated"><a class="ae nu" href="https://www.rs-online.com/designspark/an-intro-to-linux-file-system-management" rel="noopener ugc nofollow" target="_blank">https://www . RS-online . com/design spark/an-intro-to-Linux-file-system-management</a></li><li id="b67f" class="pu pv it lk b ll qq lo qr lr qs lv qt lz qu md pz qa qb qc bi translated"><a class="ae nu" href="https://github.com/saghul/lxd-alpine-builder.git" rel="noopener ugc nofollow" target="_blank">https://github.com/saghul/lxd-alpine-builder.git</a></li></ul></div></div>    
</body>
</html>