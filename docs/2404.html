<html>
<head>
<title>Write-up: Authentication bypass via flawed state machine @ PortSwigger Academy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">书面陈述:通过有缺陷的状态机@ PortSwigger Academy绕过身份验证</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/write-up-authentication-bypass-via-flawed-state-machine-portswigger-academy-e7448edeeb3d?source=collection_archive---------6-----------------------#2022-09-28">https://infosecwriteups.com/write-up-authentication-bypass-via-flawed-state-machine-portswigger-academy-e7448edeeb3d?source=collection_archive---------6-----------------------#2022-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8c718e26fcc0991a5978e3ff6623ba07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xPdTKgWIwhguz6cU.png"/></div></div></figure><p id="539f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇关于通过有缺陷的状态机绕过实验室<em class="kw">认证的文章是我为<a class="ae kx" href="https://portswigger.net/web-security" rel="noopener ugc nofollow" target="_blank"> PortSwigger的Web安全学院</a>所做的系列演练的一部分。</em></p><p id="a319" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">学习路径</strong>:服务器端主题→业务逻辑漏洞</p><div class="ky kz gp gr la lb"><a href="https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-authentication-bypass-via-flawed-state-machine" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">实验室:通过有缺陷的状态机绕过认证|网络安全学院</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">练习利用现实目标的弱点。记录你从学徒到专家的进步。看哪里…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">portswigger.net</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><p id="418a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Python脚本:<a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/blob/main/05_business_logic_vulnerabilities/Authentication_bypass_via_flawed_state_machine/script.py" rel="noopener ugc nofollow" target="_blank"> script.py </a></p><h1 id="82d4" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">实验室描述</h1><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/da2526d9ac0344ced311368bbc837043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6VDB0_M1nNcoszWI.png"/></div></div></figure><h1 id="7f2e" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">步伐</h1><p id="813c" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">通常，第一步是分析实验室应用程序的功能。在这个实验室中，它是一个商店网站。环顾四周，我用提供的凭证登录。</p><p id="55dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">立即引起注意的是，登录是一个两阶段的过程。提供用户名和密码后，我可以选择我想登录的角色:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/c76d199b6485a5918ef15c645bd3b0e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/0*7NogVMFc1IaaMPUj.png"/></div></figure><p id="1a6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样的选择确实有意义。它允许拥有更高权限的用户在不需要权限时限制他们的权限。这既减少了日常活动中的攻击面，也降低了犯愚蠢和昂贵错误的风险。至少，如果处理得当的话。为此建立两个专用帐户既容易又不容易出错。</p><p id="9a66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我选择<code class="fe mz na nb nc b">user</code>并查看Burp代理中的<code class="fe mz na nb nc b">/role-selector</code>请求:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/a8479bcd1df36dc64b5a3cadc59b832c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PB2LXyiFFnmLxsPY.png"/></div></div></figure></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="5d60" class="lq lr iq bd ls lt nl lv lw lx nm lz ma mb nn md me mf no mh mi mj np ml mm mn bi translated">尝试1:调整角色</h1><p id="2d56" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">第二个登录阶段包含用户角色。页面上列出了可供我选择的角色。我不知道在邮寄这张表格的过程中是否会进行另一次检查。</p><p id="a82f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我将角色更改为“admin”或“administrator ”,会发生什么情况？当然不知道角色名字，但值得一试。</p><p id="1c61" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不幸的是，这不会导致任何事情，既不会出错也不会有更多的特权。这表明在处理该帖子时，它会根据允许的角色进行验证，并默认为非管理员角色。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="802e" class="lq lr iq bd ls lt nl lv lw lx nm lz ma mb nn md me mf no mh mi mj np ml mm mn bi translated">尝试2:放弃请求</h1><p id="7a2a" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">说到缺省，如果第二个完整的请求被丢弃会发生什么？常识表明，如果在第二阶段完成之前发出任何请求，会话就会被丢弃。很容易发现。</p><p id="549b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Burp代理，我用<code class="fe mz na nb nc b">wiener:peter</code>登录，但是将<code class="fe mz na nb nc b">GET</code>请求完全丢弃给<code class="fe mz na nb nc b">/role-selector</code>。之后，我手动浏览到<code class="fe mz na nb nc b">/my-account</code>，看到应用拒绝常识，默认为admin:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/d9f52d4eaa9b555949c2945220550520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rRvMHv3YDehhtptB.png"/></div></div></figure><p id="9937" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我只需进入管理面板，使用链接删除用户<code class="fe mz na nb nc b">carlos</code>。连同删除操作的确认消息，实验室更新为:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/d2dacc658d658e9b3d0d4db062584654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sOeStieFYVt58MdD.png"/></div></div></figure></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="f75b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">最初发表于</em><a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/tree/main/05_business_logic_vulnerabilities/Authentication_bypass_via_flawed_state_machine" rel="noopener ugc nofollow" target="_blank">T5【https://github.com】</a><em class="kw">。</em></p><p id="f211" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mz na nb nc b"><a class="ae kx" href="https://medium.com/@frank.leitner/membership" rel="noopener">New to Medium? Become a Medium member to access all stories on the platform and support me at no extra cost for you!</a></code></p><h2 id="4fbd" class="ns lr iq bd ls nt nu dn lw nv nw dp ma kj nx ny me kn nz oa mi kr ob oc mm od bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kx" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>