<html>
<head>
<title>Tryhackme: AgentSudo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tryhackme: AgentSudo</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-agentsudo-fcc701caeae3?source=collection_archive---------2-----------------------#2022-04-26">https://infosecwriteups.com/tryhackme-agentsudo-fcc701caeae3?source=collection_archive---------2-----------------------#2022-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4f09" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">游戏攻略</h2></div><h1 id="124f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="3b5b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">乡亲们好，这次让我们根<strong class="kz ir"> AgentSudo </strong>从<strong class="kz ir"> Tryhackme </strong>评为易机。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/e77498e5cce5241477cdd6c8505757f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*kKqRJgNN1CdO_7O1Cl1HZQ.png"/></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="9f25" class="kf kg iq bd kh ki mi kk kl km mj ko kp jw mk jx kr jz ml ka kt kc mm kd kv kw bi translated">首字母</h1><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="4d0d" class="ms kg iq mo b gy mt mu l mv mw">export IP=10.10.220.97</span></pre><h2 id="0f90" class="ms kg iq bd kh mx my dn kl mz na dp kp lg nb nc kr lk nd ne kt lo nf ng kv nh bi translated">端口扫描</h2><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="8930" class="ms kg iq mo b gy mt mu l mv mw">rustscan -a $IP --ulimit 5000 | tee rust.txt</span></pre><p id="22b5" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">发现3个开放端口<code class="fe nn no np mo b">21, 22, 80</code></p><h2 id="328c" class="ms kg iq bd kh mx my dn kl mz na dp kp lg nb nc kr lk nd ne kt lo nf ng kv nh bi translated">nmap</h2><p id="747f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们深入挖掘这些港口</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="4837" class="ms kg iq mo b gy mt mu l mv mw">nmap -sC -sV -p21,22,80 oN nmap $IP -Pn </span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/5ed2b2c237e604482d4b382eee2f971a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0YWptE03XLcnyVot0ad-gw.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">nmap扫描结果</figcaption></figure><h2 id="72f5" class="ms kg iq bd kh mx my dn kl mz na dp kp lg nb nc kr lk nd ne kt lo nf ng kv nh bi translated">进一步侦察</h2><p id="c2c7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">尝试FTP匿名登录→运气不好(不允许)</p><h2 id="a2eb" class="ms kg iq bd kh mx my dn kl mz na dp kp lg nb nc kr lk nd ne kt lo nf ng kv nh bi translated">端口80: http</h2><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/c61cc77575c5e87fb5d2647d14a85974.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*Rgco2vqHLBNCiXR_rGwVfg.png"/></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">foport 80</figcaption></figure><p id="7bee" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">在端口80上发现此文本，尝试更改用户代理标头→不成功</p><p id="f012" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">但是后来，当我换了浏览器，发现了这个，同样的方法也起作用了</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi oa"><img src="../Images/8d349d68610475c94e7b336b37eefd18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXVex9t_Ak07qPmvaawC-Q.png"/></div></div></figure><p id="60c3" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">有了这个我们知道用户的密码是脆弱的，让我们暴力破解它</p><h2 id="eeff" class="ms kg iq bd kh mx my dn kl mz na dp kp lg nb nc kr lk nd ne kt lo nf ng kv nh bi translated">端口21: FTP</h2><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/21d42e1f8c4949ce89e566dd90953b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*nhNFpCs9n32fQURNESa87A.png"/></div></figure><p id="e110" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">拿到密码了</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/a5326eb6db9d54ecf5cc1742a2960c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*zA0GPGL4EJVRDdrbiSqRQA.png"/></div></figure><p id="255f" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">在ftp服务器上找到了三个文件</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi od"><img src="../Images/97379341f7b61b9ea021904ed89671d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*rdcMCkfg1L6gIC7cEHV-fg.png"/></div></figure><p id="61ce" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">其中两个是图像，我认为是兔子洞(与上一个相同)XD</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/93fe0a1a77d50b38679261154066c821.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*-2oKcXJSRJFXhWB9OX0bMQ.png"/></div></figure><p id="303b" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">另一个文件包含注释</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi of"><img src="../Images/85f15ec0c1ac6c477ebe16d942bf63c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wDB0agAUCrZAkLfpWSOdVA.png"/></div></div></figure><p id="85ca" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">有了这张纸条，我知道了图片不是:D的兔子洞</p><p id="00b1" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">深入挖掘后，我在一张图片中发现了一个zip文件</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi og"><img src="../Images/249e96bae55c0bb5ce4155f9c014a3b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ko28JcRYiJ1z1gjWo2ASzg.png"/></div></div></figure><p id="15ba" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">发现该文件被加密。首先将文件转换成john可读的</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="b4c6" class="ms kg iq mo b gy mt mu l mv mw">/usr/sbin/zip2john &lt;image_name&gt; &gt; forjhon</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi oh"><img src="../Images/7acb6bf5178af0bf2794207fd7e13547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4LSzRJ85B4oyHNEGZUulTQ.png"/></div></div></figure><p id="0764" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">现在用约翰破解它</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi oi"><img src="../Images/c22ee0e457d8a6cf7dffcb0258a585aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lu8CXOuSK_SULFtBQf5ZzA.png"/></div></div></figure><p id="3085" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">破解后，zip文件包含另一个注释</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/b8eadf9e8e85919e7ea92c336ed39cce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*mDbBnY7HiJ6TVi3kTXf_Og.png"/></div></figure><p id="7745" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">这个奇怪的词很可疑，在cyberchef.io上查了一下，发现它是base64编码的XD</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/4251870bd7ae1af61355738bb29cfe04.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*jLblA-9oV92qYRydZe0s4g.png"/></div></figure><p id="de7e" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我检查了另一个图像，并用这个作为密码，它的工作！！:o</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/2dcd5b08d6af815a368773306f9c595a.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*YR0vND1qE1L7h4k28x8B7A.png"/></div></figure><p id="e922" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">同样，该文件包含另一个笔记，(我就像有多少笔记离开XD)</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fe94eeaec162b7dac0b22296840dbde7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*okBJi3bI9WPPlxxXminW5g.png"/></div></figure><p id="c234" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我们在这张纸条上找到了ssh密码，耶</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="700d" class="kf kg iq bd kh ki mi kk kl km mj ko kp jw mk jx kr jz ml ka kt kc mm kd kv kw bi translated">用户</h1><p id="ff67" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">登录ssh，我们得到了用户标志</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi on"><img src="../Images/408b68551800941cd5d840790f01a137.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*r0f14M7f2jP36dAsg7dMXw.png"/></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="4af3" class="kf kg iq bd kh ki mi kk kl km mj ko kp jw mk jx kr jz ml ka kt kc mm kd kv kw bi translated">根</h1><p id="455c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">当你的用户密码是</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="df29" class="ms kg iq mo b gy mt mu l mv mw">sudo -l</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi oo"><img src="../Images/1ca3192bfe8ca2e80c8e9041bfdfcc5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ts5iNXbBGXVGAy2vPPPRyg.png"/></div></div></figure><blockquote class="op oq or"><p id="2924" class="kx ky os kz b la ni jr lc ld nj ju lf ot nk li lj ou nl lm ln ov nm lq lr ls ij bi translated">这告诉我们，除了/bin/bash之外，用户james可以以root身份运行任何命令</p><p id="06ba" class="kx ky os kz b la ni jr lc ld nj ju lf ot nk li lj ou nl lm ln ov nm lq lr ls ij bi translated">实际上有一个CVE(<strong class="kz ir">CVE-2019–14287</strong>)在这上面命名为“<strong class="kz ir"> <em class="iq">须藤安全绕过</em> </strong>”，有趣的部分是我了解了这个CVE/bug同一周XD <br/>了解更多关于这个CVE <a class="ae ow" href="https://tryhackme.com/room/sudovulnsbypass" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ir">这里</strong> </a></p></blockquote><p id="5666" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">要利用这一点，只需运行命令</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="37ba" class="ms kg iq mo b gy mt mu l mv mw">sudo -u#-1 /bin/bash</span></pre><p id="06e6" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我们是根</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/a11d9f275e4c3ec8075341857ff2bb26.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*8QQrjm3w_COmxGvw1jBDdw.png"/></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="4e59" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">至此，我们完成了这台机器，感谢您抽出时间阅读本博客(网址:</p><p id="ab78" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">|| <a class="ae ow" href="https://tryhackme.com/room/agentsudoctf" rel="noopener ugc nofollow" target="_blank">房间</a> || <a class="ae ow" href="https://twitter.com/namx05" rel="noopener ugc nofollow" target="_blank">推特</a> ||</p></div></div>    
</body>
</html>