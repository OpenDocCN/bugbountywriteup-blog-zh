<html>
<head>
<title>Part 1: The Ultimate Pen Test Drop Box Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第1部分:最终的笔测试投件箱演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/part-1-build-a-cloud-based-command-and-control-server-and-attack-drop-box-with-a-cellular-b3e9e063dedd?source=collection_archive---------0-----------------------#2021-09-28">https://infosecwriteups.com/part-1-build-a-cloud-based-command-and-control-server-and-attack-drop-box-with-a-cellular-b3e9e063dedd?source=collection_archive---------0-----------------------#2021-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="74f0" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">介绍</h1><p id="ccfa" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我的职业生涯中，一次又一次出现需要远程访问的情况。根据工作角色的不同，客户分为内部客户(全国各地的其他部门)和外部客户(世界各地向我们支付咨询费用的客户)。为了避免大量的旅行和酒店开支以及避免冗长的繁文缛节，我发现最好的方法是建立一个远程投件箱。本文假设您至少知道底层协议的名称，但我们将定义一些关键术语，如“投件箱”和“命令和控制”。不要担心这会很有趣，尽可能直接。</p><h1 id="332d" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">3部分系列</h1><p id="664d" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了避免这篇文章太长，我把配置过程分成了3个部分:</p><ol class=""><li id="8097" class="lj lk iq kn b ko ll ks lm kw ln la lo le lp li lq lr ls lt bi translated">构建基于云的命令和控制服务器</li><li id="e219" class="lj lk iq kn b ko lu ks lv kw lw la lx le ly li lq lr ls lt bi translated">构建攻击下拉框</li><li id="79f4" class="lj lk iq kn b ko lu ks lv kw lw la lx le ly li lq lr ls lt bi translated">安装蜂窝反向链接(硬件/软件)</li></ol><h1 id="9381" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">什么是远程投件箱？</h1><p id="972e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">远程投件箱是您发送给客户的计算设备。客户将把您的设备插入一个活动的以太网端口，投件箱将根据您选择的协议自动建立一个到您的命令和控制架构的出站连接。</p><h1 id="0fab" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">等待命令和控制，我如何建立它？</h1><p id="faa1" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">就我们的目的而言，本文将介绍如何建立一个简单的基于云的服务器来捕捉你的投件箱通信，并允许你从任何地方通过隧道连接到你的投件箱。</p><h1 id="3539" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">命令和控制设置</h1><h1 id="6d32" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">步骤1 —购买域名(不需要)</h1><p id="6925" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">进入domains.google.com &gt;获得一个新域&gt;搜索一个酷的名称并购买它(我将使用我的stealing.io域)&gt; DNS设置&gt;使用自定义名称服务器:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/1ab6c7d150389e3e380d85320979efb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*eXW8iSq9YVUaeKggUuL5OQ.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">谷歌域名指向数字海洋DNS</figcaption></figure><p id="53d1" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt;自定义资源记录&gt;输入以下TXT记录:{</p><p id="79bf" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">_ acme-challenge:" hfwfdb 5 RRC _ 2 ibbhnljtn 0 lyvvojvl 7-A-rrdYJsAwY "，</p><p id="784a" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">_ acme-challenge . www:" yh ci 0 yaugwy 2 qrdlao 94 jzscnxnl 1h 0 ygsvovf 1 yj 1a "</p><p id="db8c" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi">}</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/015dc388cf93bb68239d55adfaf1bea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*Sn4YWC-crS5scKSQBFRMvw.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">自定义资源记录</figcaption></figure><p id="9e47" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">你完了！我们现在有一个域名(网站)名称指向数字海洋的DNS服务器进行解析。完美！</p><h1 id="bc6e" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">步骤2 —数字海洋(DO)设置</h1><p id="774c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">注册一个DO帐户&gt;登录&gt;创建一个Droplet &gt;选择一个映像&gt;[选择] Ubuntu &gt;选择您想要的任何版本&gt;选择一个计划&gt;[选择]基本&gt;[选择] $5/mo &gt;选择一个数据中心区域&gt;[选择]您想要的任何地方&gt; VPC网络&gt;[保留为默认]&gt;验证&gt;[选择]密码&gt;创建根密码(使其长且复杂，这是临时使用的，稍后将被禁用) &gt;有多少个Droplet？&gt;[选择] 1 Droplet &gt;选择一个主机名&gt;[输入]您的创意主机名(我的将是killbit-CNC)&gt;创建Droplet</p><p id="ae60" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">现在，您将在仪表板中看到您的droplet，其中IP地址已分配给我们的droplet:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/96df48debf708d0fb1418500e5bf340d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*3dpsdyLAma6V7pT0TPn29Q.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">Ubuntu服务器运行</figcaption></figure><p id="f31a" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">是时候将我们的DNS记录映射到我们的CnC droplet了:</p><p id="59fe" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">创建&gt;域/DNS &gt;添加域&gt;[输入]您的域&gt;[单击]添加域</p><p id="c46d" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">创建新记录&gt;主机名&gt;[输入]您想要使用的子域名，如“连接”&gt;将从下拉菜单&gt;创建记录中指向&gt;[选择]您的droplet</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/6b3a5d07a105205be9b08250d4085e6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*oAwxN2VepsQ2KzKacOFL_Q.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">配置DNS解析</figcaption></figure><p id="9d36" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">新记录现在应该出现了。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3674162a81e5ec436b4e31edf0d86e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*lIkpfyvtwEPMxr1W9pt_Vw.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">你现在应该有一个像这样的A记录</figcaption></figure><p id="e3df" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">现在使用您之前为Ubuntu root帐户创建的凭证SSH到您的Droplet。您使用的命令应该类似于</p><p id="06e9" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt; ssh root @[子域。域名您已注册]</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/4e224399cccaaf598e28128f93482285.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*EyjTd-KpcFR8sjC3LUNddA.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">使用Putty通过SSH连接到我们在D.O .的服务器。</figcaption></figure><p id="0e18" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">从putty[选择]打开&gt;[选择]是，出现接受证书的提示</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/dd2b9de0ce57eaa3685d77d71981aa5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*5SrxHFkBccxOsLYPCud58A.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">选择是</figcaption></figure><p id="1e00" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt;[输入]密码提示</p><p id="1f96" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">您现在应该有一个终端屏幕:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/36cbb73aa7288667428b7ec18f739e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*6MTubrB9-z739Mlbp3TQWA.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">欢迎来到你的根终端</figcaption></figure><p id="f3e8" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">创建一个新用户，并将其添加到sudoers组</p><p id="b3ed" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt; adduser输入用户名你想要的</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d0f022b53ceac16ccdba86ea0ab19cc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*z-RORCpR1D0oZVKh0DowEw.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">创建新用户</figcaption></figure><p id="ad67" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt;设置密码&gt;[回车][回车][回车]&gt;是</p><p id="a3e1" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">现在向您创建的用户发布sudo priveledges</p><p id="5eee" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt; visudo</p><p id="9fd2" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">在第30行的根条目后添加:</p><p id="3191" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt;[ENTER]用户名ALL=(ALL:ALL) ALL</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/c175e541de45457eb8cf3b53584e7646.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*07lJWyXOHpVPUL2RUvuNCg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">授予用户Sudo权限</figcaption></figure><p id="4d29" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt; CTRL+O [ENTER]</p><p id="1217" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt; CTRL+X</p><p id="afbd" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">与Ubuntu断开连接。</p><p id="b02f" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">作为新用户通过SSH连接到您的服务器:</p><p id="99d6" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt; ssh<a class="ae mx" href="mailto:new_user@subdomain.domain" rel="noopener ugc nofollow" target="_blank">new _ user @ subdomain . domain</a></p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi my"><img src="../Images/764c29ff27390d6729a83df21c45eeef.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*Tlx-kBPRwHC1smAVR2aj8A.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">服务器上的新用户外壳</figcaption></figure><h1 id="1072" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">强化SSH配置</h1><p id="6ebc" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">通过打开Putty密钥生成器&gt;单击生成&gt;摆动鼠标&gt;保存公钥和私钥&gt;转换&gt;导出OpenSSH密钥，使用Putty生成密钥对</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d3daa91aa55b5ba1e3fb988dc675e4f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*rj-sOGVOsTPh9A6X35rxGA.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">用Putty处理SSH密钥</figcaption></figure><p id="bb78" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">现在，您可以将您的公共openssh格式的密钥放在/home/中的CnC服务器上的authorized_keys文件中。您的用户的ssh目录。将您的putty会话指向私有Putty密钥(。ppk)在连接&gt; SSH &gt;验证&gt;用于验证的私钥文件下:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi na"><img src="../Images/f53f43c618f0836190ab41a5c6f16806.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*Kt7bpbcY34mpcsG9EW1Vkw.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">Putty中的SSH密钥身份验证配置</figcaption></figure><p id="3f59" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">在CnC服务器上，将OpenSSH格式的公钥添加到用户的~/home/下的authorized_keys文件中。ssh目录。现在去更改SSH配置，以防止将来基于密码进入您的CnC服务器，并有效地阻止针对您的服务器的SSH暴力。</p><p id="e01f" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">&gt; vim /etc/ssh/sshd_config</p><p id="b624" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">进行以下更改:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/6f8dd6852553ae3db95c00269db4691f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o1TUH8uD5WHABNImr8R_aw.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">对SSHD配置的编辑</figcaption></figure><p id="6125" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">您需要重复SSH过程，让您的投件箱使用第二组密钥自动连接回CnC服务器。由于您需要从CnC运行到收存箱，因此生成收存箱密钥将更加容易:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ng"><img src="../Images/08fadc80c88d8f5dab09ecaf0086fa25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jsdm7C6m5XtddCxgDeicVA.png"/></div></div></figure><p id="65a7" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">然后再从下拉框到CnC:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nh"><img src="../Images/d032f57bffc41ac8bcaa7b39ce8a4e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wclFXNE5ykpje5NEh5RHfw.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">生成ssh密钥并将它们复制到您的服务器的命令</figcaption></figure><p id="1e53" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">现在是更新托管在数字海洋的数控服务器的好时机。继续运行命令(这些需要很长时间才能完成，所以要做好准备):</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/e108f364b5a5bcef2b22da23909401df.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*vJwjd9vB67QAlor1SQNwVg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">更新服务器的命令</figcaption></figure><p id="5f7f" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated"><strong class="kn ir">我们将在下一篇文章中构建我们的Dropbox:</strong></p><p id="367f" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">第2部分:<a class="ae mx" href="https://killbit.medium.com/part-2-build-the-pen-test-drop-box-69278526886a" rel="noopener">构建笔测试下拉框</a></p><p id="c111" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated"><strong class="kn ir">之后是:</strong></p><p id="710d" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">第3部分:<a class="ae mx" href="https://killbit.medium.com/part-3-pen-test-dropbox-adding-a-cellar-backlink-8c8d5cfde667" rel="noopener"> Pen Test DropBox —添加一个单元格反向链接</a></p><p id="6bd1" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">如果你喜欢我的内容和我在这里提供的工作，请考虑发送一些咖啡爱我的方式@【https://www.buymeacoffee.com/killbit T2】</p><p id="f09e" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">你友好的邻居黑客，</p><p id="6378" class="pw-post-body-paragraph kl km iq kn b ko ll kq kr ks lm ku kv kw ml ky kz la mm lc ld le mn lg lh li ij bi translated">杀手</p></div></div>    
</body>
</html>