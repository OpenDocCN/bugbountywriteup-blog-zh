<html>
<head>
<title>Fastly Subdomain Takeover $2000</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速子域接管2000美元</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/fastly-subdomain-takeover-2000-217bb180730f?source=collection_archive---------0-----------------------#2022-11-21">https://infosecwriteups.com/fastly-subdomain-takeover-2000-217bb180730f?source=collection_archive---------0-----------------------#2022-11-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f00e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">虫子赏金——从零到英雄</h2></div><h2 id="83bc" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">显示本用户信息</h2><p id="7cf7" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我的名字是Alexandar Thangavel，又名ValluvarSploit，是一名全职的bug猎人和培训师。我喜欢侦察。我是ValluvarSploit安全公司的创始人兼首席执行官。在ValluvarSploit Security，我们提供一对一的在线培训。更多信息，请查看我们的LinkedIn页面。</p><h2 id="20c0" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">目标</h2><p id="f753" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">今天，我要分享我如何发现快速子域接管漏洞，并赢得我的第一个四位数奖金。让我们开始吧。</p><h2 id="7759" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">背景故事</strong></h2><p id="ddf4" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">这是从2022年10月2日周日开始的。这一天像往常一样开始。我早上6点醒来，完成日常工作，检查我的移动数据余额(剩余1.3 GB)，启用我的移动热点，连接我的笔记本电脑，并继续在一个私人程序上狩猎。我在目标应用程序上花了几个小时，但什么也没发现，所以休息了一会儿。我曾经至少半年重温一次我以前的私人项目。因此，我查看了我的私人邀请，选择了一个旧程序，并开始执行子域枚举(让我们称我们的目标为redacted.com)。</p><h2 id="b602" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">子域接管</strong></h2><p id="af5d" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">当攻击者控制一个域的子域时，就会发生子域接管。发生这种情况是因为DNS配置错误/失误。</p><h2 id="01ec" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">子域枚举</h2><p id="8e4a" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我用Google Dorking、<a class="ae lu" href="https://github.com/OWASP/Amass" rel="noopener ugc nofollow" target="_blank">OWASP mass</a>和<a class="ae lu" href="https://github.com/OJ/gobuster" rel="noopener ugc nofollow" target="_blank"> Gobuster </a>工具开始了子域枚举。</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="274d" class="me kg iq ma b be mf mg l mh mi"># Passive Subdomain Enumeration using Google Dorking<br/>site:*.redacted.com -www -www1 -blog<br/>site:*.*.redacted.com -product<br/><br/># Passive Subdomain Enumeration using OWASP Amass<br/>amass enum -passive -d redacted.com -config config.ini -o amass_passive_subs.txt<br/><br/># Subdomain Brute force using Gobuster<br/>gobuster dns -d redacted.com -w wordlist.txt - show-cname - no-color -o gobuster_subs.txt</span></pre><p id="d1bb" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">枚举子域后，删除重复条目，并使用<a class="ae lu" href="https://github.com/tomnomnom/anew" rel="noopener ugc nofollow" target="_blank">新</a>工具将它们合并成一个文件(subdomains.txt)。</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="c3e3" class="me kg iq ma b be mf mg l mh mi"># Merging subdomains into one file<br/>cat google_subs.txt amass_passive_subs.txt gobuster_subs.txt | anew subdomains.txt</span></pre><p id="d29e" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">然后将subdomains.txt文件传递给我的cname.sh shell脚本，枚举cname记录并存储在cnames.txt中</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="ab04" class="me kg iq ma b be mf mg l mh mi"># Enumerate CNAME records<br/>./cname.sh -l subdomains.txt -o cnames.txt<br/><br/># We can use HTTPX tool as well<br/>httpx -l subdomains.txt -cname cnames.txt</span></pre><p id="5775" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">然后将subdomains.txt文件传递给<a class="ae lu" href="https://github.com/projectdiscovery/httpx" rel="noopener ugc nofollow" target="_blank"> HTTPX </a>工具。探测了实时网站并存储在servers_details.txt中。</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="943a" class="me kg iq ma b be mf mg l mh mi"># Probe for live HTTP/HTTPS servers<br/>httpx -l subdomains.txt -p 80,443,8080,3000 -status-code -title -o servers_details.txt</span></pre><h2 id="7f3c" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">分析</h2><p id="cc9c" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我开始分析cnames.txt文件，发现一个子域指向两个不同的CNAME记录。我在子域上运行dig命令，得到如下结果:</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="40fd" class="me kg iq ma b be mf mg l mh mi">dig next.redacted.com CNAME</span></pre><figure class="lv lw lx ly gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mo"><img src="../Images/74dd1aa579ea0045c6d545a16fb2d7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fM_jKc7Ag4JMXTSuqUw_cg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">CNAME记录的DNS查询</figcaption></figure><p id="a875" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">这个子域有两个CNAME记录。第一个CNAME记录指向webflow.io域，第二个CNAME记录指向fastly.net(快速服务)域。每当我们有多个CNAME记录时，第一个CNAME记录会将我们重定向到下一个CNAME记录，以此类推。重定向将继续，直到我们到达最后一个CNAME记录。</p><p id="b72a" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">我开始分析servers_details.txt文件，寻找有趣的东西，发现了这一行。注意状态代码和网站标题。</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="f642" class="me kg iq ma b be mf mg l mh mi">https://next.redacted.com [500] [246] [Fastly error: unknown domain next.redacted.com]</span></pre><p id="cbdd" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">状态码是“500”，标题是“快速错误:未知域名next . redated . com”。通过查看CNAME记录(“redated . fastly . net”)和网站指纹“Fastly错误:未知域”，我们可以确认这是Fastly子域接管。如果一个网站有这个指纹，那么它可能是易受攻击的。然而，我以前多次遇到过这种快速指纹，它并不脆弱。只有在满足某些条件时，它才是脆弱的，所以这是一种边缘情况。</p><p id="b43e" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">在大多数情况下，我们不能接管快速服务。例如以下情况，</p><figure class="lv lw lx ly gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi na"><img src="../Images/68a91aa42334d43d31846b8b41b15029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVsWU_j9v4g4eba-zOYSRw.png"/></div></div></figure><p id="c172" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">但是，如果该域名尚未被其他客户占用，那么我们可以要求该域名并完全接管该子域。</p><h2 id="9fcf" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">确认漏洞</h2><p id="4301" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我去了快手官网，执行了以下步骤，<br/> 1。我用临时邮件在fastly.com T2创建了一个账户。<br/> 2。登录到我的快速仪表板，点击“创建一个交付服务”按钮。<br/> 3。输入目标子域名(next . redated . com)并点击添加按钮。</p><p id="50ac" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">我期望出现错误消息(“域名已被另一个客户占用”)，但是没有出现错误消息。我被重定向到下一页“主机页面”。我很惊讶。</p><figure class="lv lw lx ly gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nb"><img src="../Images/7212bfcaa94016e420cdf89646143512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hpg374XpIVfcAGmMzE9q8Q.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">快速申请域名</figcaption></figure><h2 id="d6a9" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">POC创建步骤</h2><p id="f9fe" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">漏洞被确认后，我登录到我的VPS服务器，创建了一个名为“hosting”的目录。然后在“hosting”目录下创建一个简单的HTML文件，名为“index.html”。</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="672d" class="me kg iq ma b be mf mg l mh mi">mkdir hosting<br/><br/>cd hosting<br/><br/>nano index.html</span></pre><p id="436d" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">“index.html”文件包含以下代码，</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="eb29" class="me kg iq ma b be mf mg l mh mi">&lt;!DOCTYPE html&gt;<br/><br/>&lt;html&gt;<br/>    &lt;head&gt;&lt;title&gt;STO PoC&lt;/title&gt;&lt;/head&gt;<br/>    &lt;body&gt;<br/>        &lt;h1&gt;ValluvarSploit PoC&lt;/h1&gt;<br/>    &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="bb39" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">之后，我在当前工作目录下的端口80上启动了一个简单的Python web服务器，</p><pre class="lv lw lx ly gt lz ma mb bn mc md bi"><span id="554c" class="me kg iq ma b be mf mg l mh mi">python3 -m http.server 80</span></pre><p id="10ce" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">然后，我转到Fastly仪表板，在Hosts页面中添加了我的VPS服务器的公共IP地址。</p><figure class="lv lw lx ly gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nc"><img src="../Images/6663e5a2052518f83ebd768977ad5b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cfvpss0E9rP3RfhLjENzjA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">VPS配置</figcaption></figure><p id="1b5a" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">几秒钟后，我打开了一个新的浏览器窗口，访问了“<a class="ae lu" href="http://next.redacted.com/index.html`" rel="noopener ugc nofollow" target="_blank">http://next.redacted.com/index.html</a>”页面。我的PoC文件已成功呈现。我已经写了一份详细的报告，并在HackerOne上提交了。</p><figure class="lv lw lx ly gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nd"><img src="../Images/9e52dcd0d8e43852f168d6043d07d08a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wa1N10QOOpD8LfFQF8D0QQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">概念证明</figcaption></figure><h2 id="8f3f" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">通过监控服务器日志进行学习</h2><p id="d26a" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我让我的Fastly服务运行了3天，并监控服务器日志中的敏感信息。观看其他bug猎人的方法很有趣。</p><figure class="lv lw lx ly gt mp gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/4843ca04d7c29243a89470e1ecf84b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*ArdrD-1E4dK2jmw9W4H80A.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">有趣地监控服务器日志</figcaption></figure><h2 id="9ee8" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">报酬</h2><p id="15e7" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我的报告被归类为高严重性漏洞，并在10天内奖励了2000美元。</p><figure class="lv lw lx ly gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nf"><img src="../Images/eb063f1b121b5b61f50fac435b9d6793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EusfsNh9StrfGXko77QGw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">报酬</figcaption></figure><h2 id="62dc" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">关键要点</h2><p id="fa47" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">1.至少每6个月重温一次你的老目标。<br/> 2。子域枚举是关键。尽可能多地枚举子域。<br/> 3。不要放弃。</p><p id="f7ef" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">感谢您花时间阅读我的文章。</p><p id="edee" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated">跟我来:</p><p id="754e" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated"><a class="ae lu" href="https://twitter.com/ValluvarSploit" rel="noopener ugc nofollow" target="_blank">推特</a></p><p id="15f7" class="pw-post-body-paragraph lb lc iq ld b le mj jr lg lh mk ju lj ko ml ll lm ks mm lo lp kw mn lr ls lt ij bi translated"><a class="ae lu" href="https://www.linkedin.com/in/alexandar-t-345230220" rel="noopener ugc nofollow" target="_blank">领英</a></p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><h2 id="6b6b" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lu" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>