<html>
<head>
<title>Cyber Apocalypse CTF 2022 — Web — Amidst Us Write-up</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络启示录CTF 2022 —网络—在美国报道中</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cyber-apocalypse-ctf-2022-web-amidst-us-write-up-a6864e23c3b9?source=collection_archive---------3-----------------------#2022-05-19">https://infosecwriteups.com/cyber-apocalypse-ctf-2022-web-amidst-us-write-up-a6864e23c3b9?source=collection_archive---------3-----------------------#2022-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9aa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">提示:</strong></p><p id="de98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们<br/>中，阿米塔斯部落是一个臭名昭著的雇佣潜伏间谍组织。我们有可信的理由相信他们与德雷格合作，所以我们必须采取行动揭露他们的身份。尤利西斯和邦妮潜入了他们的总部，在一台未上锁的电脑上发现了这个神秘的入口。尽管能见度很低，你能黑进去让他们进入吗？</p><p id="e113" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">开始:</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/cf71c1ab910a05281eddd091a4f9cc4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9QM-ov9bTiqcPem98umooQ.png"/></div></div></figure><p id="d9a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个网络挑战，我们有应用程序的源代码，所以我们正在下载它，并在从真正的网站上获得标志之前，在我们的本地测试它。</p><p id="e83b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们正在检查网站及其功能，</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kx"><img src="../Images/3b42c5a2ca60e2e4a949291517a5abc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uLl-p3fnP1SiIRb3TQC6w.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/5b9325d01599754b61126f449eb8d26f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZaDV1ic5P9ExMh2Z6B-XhA.png"/></div></div></figure><p id="0afe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网站就像一个暗室，我们有手电筒。我正在检查任何可点击的东西，我发现如果我们点击不明飞行物，它给上传图像的机会。当我上传它时，图像呈现在同一个页面上..</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kz"><img src="../Images/bd749cecb32bd616e987886478f28837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ths-5KOcTlqWUSJgHQN3Q.png"/></div></div></figure><p id="e442" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有另一个互动部分，我们可以改变一些东西的颜色..</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi la"><img src="../Images/f326c48eb41a8d802aad49fea6914d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-n3IsuNQqHY_ezjoA3n6KQ.png"/></div></div></figure><p id="406a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我试图拦截他们时，我做不到..为了拦截它们，你可能需要告诉它代理图像和东西，默认是隐藏css，图像和二进制文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lb"><img src="../Images/b609804bf97df9f66bb7805a74dc2731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XfF6-aOVDGywHpDWqRLh3w.png"/></div></div></figure><p id="c9b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于打嗝套件，请遵循以下路径..</p><p id="36d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代理&gt;选项&gt;拦截客户端请求&gt;&gt;取消选中文件扩展名选项。</p><p id="1f2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们可以拦截请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lc"><img src="../Images/6dee775ac598b67397fb0796d0297ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R3WnLoaxUJNA5FO54535uQ.png"/></div></div></figure><p id="70b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我检查源代码时，我总是检查应用程序所需的东西，看看是否有任何版本漏洞。在这个应用上，我们看到了Pillow 8.4.0。问题是为什么特别需要这个版本。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ld"><img src="../Images/8fea1178d002cf580824586174c28b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hxKAaZT3CAMO_jKV9T6Ag.png"/></div></div></figure><p id="89a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们研究它时，我们了解到该应用程序使用Pillow来处理图像，如果通过eval运行(它正在这样做)<a class="ae le" href="https://security-tracker.debian.org/tracker/CVE-2022-22817" rel="noopener ugc nofollow" target="_blank">https://security-tracker.debian.org/tracker/CVE-2022-22817</a></p><p id="24fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们回头看看代码，看看是否有eval函数。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lf"><img src="../Images/55e8bb5a86352c26131fba36349384d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2oMt62JboTp9o5Q1cnxFbg.png"/></div></div></figure><p id="5490" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，有一个来自ImageMath的eval函数..</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lg"><img src="../Images/651d0ab20a9bf05ba4391a9897e1bd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fpaxVVXhvDqrIWNAqW_hqQ.png"/></div></div></figure><p id="4198" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的代码，这是转换图像从base64等..</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/4cfd2e02085d7762676574848608ca44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*yY9PhwtcHWiWYzCyOAuAPw.png"/></div></figure><p id="9ba7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于路由部分，它只是检查它是JSON还是包含image..因此，将我们的有效载荷注入背景rgb颜色是最好的方法..从源代码中，我们确切地知道路径，所以我们可以写一些路径的标志。(如果您没有rce漏洞的源代码，首先可以尝试id、whoami或ping方法)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi li"><img src="../Images/929216e705998db2e41a9545af462d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3oPWGNCHN8QIL_Xf03Xhw.png"/></div></div></figure><p id="0a3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于它是外部网站，我没有得到一个反国旗外壳..它需要ngrok或外部ip，所以这是最简单的方法。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/5d42ed8db199732471d815971e93aca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*XVfEYSqGWywuOf1nLkZ8YQ.png"/></div></figure></div></div>    
</body>
</html>