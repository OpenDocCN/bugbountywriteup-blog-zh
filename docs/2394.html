<html>
<head>
<title>CVE-2022–36934: An integer overflow in WhatsApp leading to remote code execution in an established video call</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CVE-2022–36934:WhatsApp中的整数溢出导致在已建立的视频通话中远程执行代码</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cve-2022-36934-an-integer-overflow-in-whatsapp-leading-to-remote-code-execution-in-an-established-e0fc4e2cd900?source=collection_archive---------0-----------------------#2022-09-27">https://infosecwriteups.com/cve-2022-36934-an-integer-overflow-in-whatsapp-leading-to-remote-code-execution-in-an-established-e0fc4e2cd900?source=collection_archive---------0-----------------------#2022-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5faa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作者:<a class="ae kl" href="https://www.instagram.com/_ansh_vyas/" rel="noopener ugc nofollow" target="_blank">安舒尔·维亚斯</a></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/1dd0f988c3528014685fdd80d33f7852.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BsaAkEesPktijJsd"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><a class="ae kl" href="https://unsplash.com/@eyestetix?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Eyestetix工作室</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="113c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">概观</h1><p id="b234" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">已建立的视频呼叫中的位数可能会因整数溢出而增加，从而导致远程代码执行(RCE)。根据位数，它可以高于或低于最小可表示值。攻击者可以通过写入更大的值来覆盖系统内存的其他部分，并滥用此功能来远程执行代码。攻击者可以通过操纵WhatsApp组件视频调用处理程序来利用此RCE漏洞，从而触发基于堆的缓冲区溢出并接管WhatsApp Messenger。</p><h1 id="6668" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">整数溢出</h1><p id="ed25" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在大多数编程语言中，通常为整数值分配一定数量的位。例如，使用32位整数数据类型，space可以保存范围从0到4，294，967，295的无符号整数或范围从2，147，483，648到2，147，483，647的有符号整数。通常，最高有效位(第一位)表示一个整数在有符号整数中是正数还是负数。如果执行计算4，294，967，295 + 1，当您尝试存储大于整数类型最大值的值时会发生什么，这完全取决于语言和编译器。</p><p id="42d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，许多语言和编译器根本不会产生任何错误，而是执行模运算、循环和截断，或者以其他未定义的方式运行。上面的例子通常得到0。有符号整数可能会产生更多意想不到的结果。当有符号整数超过其最大值时，结果通常为负。例如，2，147，483，647 +1通常是2，147，483，648。当超过最小值(下溢)时，通常返回负数。例如，2，147，483，648-1通常为2，147，483，647。</p><p id="e432" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与加法、减法或乘法等典型运算相反，类型转换过程也可能导致整数溢出。例如，一个整数可能被一个操作视为无符号整数，而被另一个操作视为有符号整数，从而导致对值的错误解释。如果在计算缓冲区长度时出现整数溢出，缓冲区可能会溢出。</p><h1 id="facf" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">缓冲区溢出</h1><p id="4b08" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在软件应用程序中达到其地址边界的结果是，当其内存区域写入相邻的内存区域时，会发生缓冲区溢出。堆栈和堆是软件漏洞代码中溢出的两个常见目标。堆是一个内存区域，程序可以请求内存块以供其使用。</p><p id="e2da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在缓冲区溢出中，信息被放入分配的内存区域。它们是不同类型的溢出。开发人员必须在计算机内存中划出一些空间，然后才能向内存中写入任何内容。在应用程序的执行过程中，他们需要存储大量的变量和信息。</p><p id="c842" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，为了检查您将什么放入缓冲区，开发人员需要非常小心。如果您将缓冲区设置为特定的大小，您不希望其他人存储比该缓冲区更大的内容，否则会出现缓冲区溢出。每当以特定的方式使用缓冲区溢出时，缓冲区溢出对于坏人来说是非常强大的。</p><p id="a0f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题是，找到一种特定的情况，允许您以总是为您提供某种结果并且不会导致计算机崩溃的方式溢出缓冲区，这是极其困难的。相反，向计算机请求特殊权限，如操作系统的root访问权限或管理员访问权限。因此，如果您可以用易受溢出影响的应用程序或操作系统重复执行缓冲区溢出，坏人现在就可以访问使用它的所有系统。我们试图通过修补或修改可能易受缓冲区溢出攻击的应用程序来避免这种情况。这显示了缓冲区溢出可能导致的后果的一个简化示例。</p><p id="b48e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，它确实说明了您是如何利用缓冲区溢出来操纵信息的。我们在内存中有两个变量A和B。没有为变量a分配任何字节。它有一些可用的字节，但是在内存中的特定区域没有增加。然而，变量B包含数据。就坏人而言，更改变量B将允许他们获得对您计算机的额外访问权限。它十进制有1979，十六进制是零七BB。</p><p id="1246" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了改变这个字节，也就是十六进制的零七，他们打算做点别的。因此，他们会将信息添加到变量A中，这些信息会溢出到变量b中。我们的计划是将过量的信息添加到变量A中。如您所见，这溢出到下一个字节中。它是e- x- c- e- s- s- i- v- e，通常在末尾是一个字节。现在65在B前面，十六进制值就变了。使用十进制单位，六五零零等于25，856，这是一个与原来存在的数字非常不同的数字。我们所做的只是改变了存储在A中的内容，我们设法修改了存储在B中的内容，这是不应该发生的。此时，您的缓冲区溢出发生了，坏人可能操纵变量为所欲为。</p><h1 id="04f1" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="ba23" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">旧版本的OpenSSH中的一个错误导致了缓冲区溢出，这是整数溢出的结果</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="45e6" class="mk ld iq mg b gy ml mm l mn mo">nresp = packet_get_int(); <br/><strong class="mg ir">if</strong> (nresp &gt; 0) <br/>{  <br/>     response = xmalloc(nresp*sizeof(<strong class="mg ir">char</strong>*));  <br/>     <strong class="mg ir">for</strong> (i = 0; i &lt; nresp; i++)   <br/>          response[i] = packet_get_string(NULL); <br/>}</span></pre><p id="b01e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在nresp为1073741824且sizeof(char*)为4(这是典型值)的情况下，表达式nresp*sizeof(char*)会导致溢出。xmalloc()分配了一个0字节的缓冲区。攻击者可能通过利用后续循环执行任意代码，这将导致堆缓冲区溢出。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h2 id="852f" class="mk ld iq bd le mw mx dn li my mz dp lm jy na nb lq kc nc nd lu kg ne nf ly ng bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kl" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>