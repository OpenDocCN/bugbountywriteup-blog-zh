<html>
<head>
<title>TryHackMe | Wekor Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe | Wekor报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-wekor-writeup-a01b851f651d?source=collection_archive---------3-----------------------#2021-03-09">https://infosecwriteups.com/tryhackme-wekor-writeup-a01b851f651d?source=collection_archive---------3-----------------------#2021-03-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/171f11af792059f0917760396b48f3bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EnzgzoNnql5RpoCW258Pow.png"/></div></div></figure></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><h1 id="893e" class="kf kg iq bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated"><strong class="ak">概述</strong></h1><p id="51f2" class="pw-post-body-paragraph ld le iq lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">嘿，你们好吗？我带着另一篇文章回来了，这一次是尝试ustoun0的Wekor。这是一台非常棒的机器，比我最初想象的要难。</p><div class="mb mc gp gr md me"><a href="https://tryhackme.com/room/wekorra" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">TryHackMe | Wekor</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">涉及Sqli、WordPress、vhost枚举和识别内部服务的CTF挑战；)</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">tryhackme.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms jw me"/></div></div></a></div><div class="mb mc gp gr md me"><a href="https://tryhackme.com/p/ustoun0" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ir gy z fp mj fr fs mk fu fw ip bi translated">TryHackMe | ustoun0</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">TryHackMe是一个免费的学习网络安全的在线平台，使用动手练习和实验室，通过您的…</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">tryhackme.com</p></div></div><div class="mn l"><div class="mt l mp mq mr mn ms jw me"/></div></div></a></div><p id="f4cc" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">我们从简单的端口扫描开始，看到端口80是开放的。在最初的网站上做一些目录蛮力，我们得到另一个网站的位置。在访问该网站时，我们发现了一个SQL注入漏洞。从那里，我们利用SQLMap提取信息。浏览这些信息，我们找到了一些WordPress凭证。登录WordPress，我们编辑一个PHP页面，得到一个反向shell。进入机器后，我们枚举Memcached服务来查找用户密码。一旦完成，我们反转一个elf二进制文件，并伪造一个系统二进制文件来获得根目录。那么，没有别的话要说了，我们开始吧。</p><h1 id="800b" class="kf kg iq bd kh ki mz kk kl km na ko kp kq nb ks kt ku nc kw kx ky nd la lb lc bi translated">我们闯进去吧！</h1><p id="eff4" class="pw-post-body-paragraph ld le iq lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">像往常一样，从NMap扫描开始。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="4538" class="nn kg iq nj b gy no np l nq nr">sudo nmap -sS -sV -sC -oA nmap/wekor *THM Box IP* -vv</span></pre><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/dc0cdbd7f6c7184a6a5121c26ec8fe90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oiIyU68f-7QXe1vFc8ybQw.png"/></div></div></figure><p id="6aa8" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">在运行NMap时，我们只打开了两个端口22(ssh)和80(HTTP)。让我们访问80端口上的网站。</p><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/a4107dd00188695c1064a110a8474ef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fGFojmbUghk2ZcONPgf_Fw.png"/></div></div></figure><p id="374a" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">在访问网站时，我们会收到一条信息。</p><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/922877a157888f38288b919a062c4a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2r1I2Mrpj3l4STkqk2bmw.png"/></div></div></figure><p id="dfd1" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">网站上还有一个robots.txt，在访问robots.txt时，我们会看到许多不同的目录路径。可悲的是，除了一个“/comingrealysoon”之外，所有这些都将我们重定向到404(未找到)。<br/>在这里，我们发现实际的网站可以在“/it-next”位置找到。让我们访问网站。</p><p id="a6a0" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">在访问网站时，我们看到这是一些公司的网站，提供计算机解决方案。经过一番探索，我们看到在网站的结帐部分有一个表单域，在那里他们要求提供优惠券代码。<br/>在测试一个可能的SQL注入时，试图输入一个单引号，网站显示一条错误信息。</p><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/20730d1ab6bc8841048bb17fcf95dfaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EK44VFctnNAnYnQQ1YUaaQ.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">使用“'或1 = 1---”，不带双引号，将得到实际的优惠券代码。</figcaption></figure><p id="db4b" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">“Apply Coupon”字段肯定容易受到SQL注入的攻击，所以让我们对它运行SQLMap，看看我们能发现什么。</p><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/4e6869d0ff825c7e40852eb32ad5e266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pj0a6ehDnlqjnbN2nHbJzg.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk translated">是的，我确实中途换壳了。不要问我为什么，我对我的行为没有任何解释</figcaption></figure><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="758a" class="nn kg iq nj b gy no np l nq nr">sqlmap -r $PWD/ApplyCoupon.req --dump-all --batch</span></pre><blockquote class="nx ny nz"><p id="1054" class="ld le oa lf b lg mu li lj lk mv lm ln ob mw lq lr oc mx lu lv od my ly lz ma ij bi translated">Here -r:要将SQLMap指向实际的请求，请给它完整的路径，否则它会出错。- dump-all:转储本地机器上通过SQLi获得的所有数据。- batch:为任何提示提供默认值，以便流程不会在后台暂停，等待用户交互。</p></blockquote><p id="6763" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated"><strong class="lf ir">附言</strong>您可以使用任何代理工具轻松捕获请求。</p><p id="1dc1" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">因为，我主要用打嗝来满足我的“代理”需求，我可以给你一点帮助。只需将burp设置为拦截模式，代理您的浏览器执行burp，一旦burp拦截到请求，右键单击请求，然后单击保存项目。现在您可以将文件传递给SQLMap。一个小小的信息，用“*”替换您需要测试的变量的值。SQLMap将只测试这个特定的变量，从而节省时间。正如他们所说，时间就是金钱。</p><p id="c1ad" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">捕捉请求的方法在您使用的任何其他工具上几乎应该是相同的。</p><p id="44c9" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">一段时间后，SQLMap完成它的工作。我们有大量的信息，但有趣的是“WordPress”文件夹，里面有不同用户的用户名和密码。哈希属于WordPress(MD5)类别。使用hashcat和<a class="ae oe" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwj20uW6o6PvAhUFOisKHc1xCKkQFjAAegQIBBAD&amp;url=https%3A%2F%2Fgithub.com%2Fbrannondorsey%2Fnaive-hashcat%2Freleases%2Fdownload%2Fdata%2Frockyou.txt&amp;usg=AOvVaw3snAERl1mU6Ccr4WFEazBd" rel="noopener ugc nofollow" target="_blank"> rockyou </a>单词表，我们可以很容易地破解密码散列。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="d42a" class="nn kg iq nj b gy no np l nq nr">hashcat -m 400 -a 0 hashfile.txt /path/to/the/wordlist</span></pre><p id="7508" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">所有的密码哈希都被破解了，除了管理员密码哈希，看起来有人在遵守规则。</p><p id="c3ce" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">但是，我们没有找到任何WordPress博客。而且，在这个网站上没有什么可以发现的了。所以，让我们试试虚拟主机暴力破解，使用GoBuster。在GoBuster完成运行后，我们看到我们有一个结果，web站点有一个子域“site”，这是一个WordPress博客。<br/>导航到“/wp-admin”我们得到一个登录表单。让我们尝试使用我们得到的凭证。</p><p id="e1b0" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">使用第一组凭证，我们没有得到任何有趣的东西。杰弗里只是一个普通的WordPress用户，没有任何权利。<br/>尝试第二套凭证，我们看到Yura是WordPress admin，牛逼！。这意味着我们可以得到一个反向壳。</p><p id="44ac" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">要获得反向外壳，导航到“主题编辑器”，在那里我们可以编辑任何模板，我决定编辑“404.php”。通过<a class="ae oe" href="https://github.com/pentestmonkey" rel="noopener ugc nofollow" target="_blank"> pentestmonkey </a>粘贴<a class="ae oe" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwj20uW6o6PvAhUFOisKHc1xCKkQFjAAegQIBBAD&amp;url=https%3A%2F%2Fgithub.com%2Fbrannondorsey%2Fnaive-hashcat%2Freleases%2Fdownload%2Fdata%2Frockyou.txt&amp;usg=AOvVaw3snAERl1mU6Ccr4WFEazBd" rel="noopener ugc nofollow" target="_blank"> php-reverse-shell </a>，对脚本的ip和port字段进行必要的修改，并保存模板。</p><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/500eec8fd0045108b60c6153025b6168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tDV2NS34FEecxXdQm_SQ-g.png"/></div></div></figure><p id="bf38" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">从那里，导航到/WP-content/themes/twenty twenty one/404 . PHP，同时使用NetCat监听端口，以接收反向shell。</p><p id="864c" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">进入机器后，我们看到我们以“www-data”的身份登录。运行linPEAS，我们没有发现任何有趣的东西。寻找机器上运行的服务，我们看到一个服务正在较高的端口11211上运行。使用一些Google-Fu，我们发现这个服务的名字是“Memcached ”,我们可以枚举这个服务，因为它可能存储一些信息。有了这些信息，让我们试着列举服务。</p><p id="7dd7" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated"><em class="oa">等等，什么是Memcached，我们为什么要在里面寻找信息？</em></p><p id="a42f" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">Memcached是一个分布式内存缓存系统。就像Linux机器上的交换分区一样，只是它通常运行在服务器上。发生的情况是，每当服务器耗尽内存(RAM)时，它将获取一些在某个时间之前请求的信息，将这些信息移动到缓存系统，以便它可以为当前任务释放内存。为了跟踪时间，服务器使用过期超时。一旦信息过期，它会自动将信息转移到Memcached服务。如果再次需要该信息，服务器可以只使用缓存的信息，而不是一遍又一遍地为查询进行计算。</p><p id="b854" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">所以，我们走吧。我们可以使用Telnet连接到服务。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="e701" class="nn kg iq nj b gy no np l nq nr">telnet localhost 11211<br/>stats items (shows everything in the cache)<br/>stats cachedump 1 0 (dump everything in the slab id(1))<br/>get user (user query information in the cache)<br/>get password (password query information in the cache)</span><span id="49e4" class="nn kg iq nj b gy of np l nq nr">press Ctrl+] to bring up the telnet prompt<br/>type close to exit from telnet</span></pre><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/18fbe46dc0f35b77ca473ce3109cce90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppE4p2_I0lI5cZmZd__6OQ.png"/></div></div></figure><p id="796b" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">我们得到用户Orka的密码。<br/>在机器上再次运行linPEAS，我们发现我们的用户可以在<strong class="lf ir"> "/usr/sbin" </strong>目录中写。让我们记住这个信息，因为它很快会被证明是非常有用的。<br/>运行sudo -l，我们看到我们的用户只能运行一个elf二进制，“比特币”作为root。运行可执行文件时，它会提示我们输入密码，但我们没有。</p><p id="3287" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">将二进制文件传输到我们的机器，并使用ghidra反转它，我们找到所需的密码，我们看到二进制文件正在对脚本“tranfer.py”进行系统调用。<br/>二进制文件使用绝对路径调用脚本，sudoers文件中的二进制文件使用了绝对路径，但是，它使用相对路径调用python二进制文件。并且<em class="oa">记住</em>，我们可以<strong class="lf ir">将</strong>写入"/usr/sbin "，它的优先级(在这台机器中)高于"/usr/bin "，实际的python二进制文件就驻留在那里。<br/>这意味着，系统会先在“/usr/sbin”中查找python二进制文件，然后再到其他地方查找，这意味着我们可以放置自己的伪程序，给它相同的名称，系统会执行它，而不是实际的python二进制文件。</p><p id="764d" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">让我们cd到"/usr/sbin "，然后:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="afe3" class="nn kg iq nj b gy no np l nq nr">touch python (create a file named python)<br/>vim python   (put in the bogus code)<br/>     #!/bin/bash<br/>     /bin/bash<br/>     :wq!<br/>chmod +x python (give it executable permission)</span></pre><p id="2590" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">让我们尝试执行我们的伪python二进制文件。</p><figure class="ne nf ng nh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/b56727a1d8795154533ac595b581b13c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjmqLyoP3giWMuGpQTPRYQ.png"/></div></div></figure><p id="d97d" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">瞧，我们得到了我们的根壳。</p><p id="8d77" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">这就是那个盒子，希望你们喜欢。</p><p id="b7d8" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">如果你有任何建议，请在评论中告诉我。</p><p id="46a4" class="pw-post-body-paragraph ld le iq lf b lg mu li lj lk mv lm ln lo mw lq lr ls mx lu lv lw my ly lz ma ij bi translated">祝你有美好的一天！</p></div></div>    
</body>
</html>