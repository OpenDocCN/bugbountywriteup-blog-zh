<html>
<head>
<title>Zippy Challenge writeup CyberHack CTF</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CTF网络黑客大挑战</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/zippy-challenge-writeup-cyberhack-ctf-80eb1d422249?source=collection_archive---------0-----------------------#2020-06-08">https://infosecwriteups.com/zippy-challenge-writeup-cyberhack-ctf-80eb1d422249?source=collection_archive---------0-----------------------#2020-06-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8053" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Zippy是网络黑客CTF在网络类别下面临的挑战之一。这是一个非常有趣的挑战，因为我们需要利用PHP zip文件解析器来获取我们的标志。由于web应用程序经常处理zip文件，这个挑战非常接近于现实世界的场景。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/69ea23dbe4ac4153bca7363c2f2162a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*NxkZ__fgvJmjm39KjuX57g.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">活力挑战</figcaption></figure><p id="1f85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，挑战陈述了我们能破坏上传zip功能，并且提供了挑战的URL。当访问这个网址时，它显示了这样一个页面。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi kx"><img src="../Images/6baf1f25da444a1a40521701bc7c78f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZK3ymdFwC5Ijof2zD9M3GQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">快速登录</figcaption></figure><p id="2228" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它要求用户名和密码，这里的解决方案是一种情况，但如何采取这样的挑战也是重要的一部分。我会试着解释我的想法。所以，CTF的第一件事就是检查网络服务器上的公共文件。有时候这对你来说很容易。我首先检查了这个URL上的robots.txt文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/03e090209408bab340d547ea95c7d647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*eRepN5FNMQReuIvIxV9Dwg.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">robots.txt</figcaption></figure><p id="042d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件不存在，但我们仍然想登录到这里，这样我们就可以上传我们的zip文件进行检查。所以接下来的事情是检查这个页面的来源。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/e2d84b46bb8474944caf7e78e04bad80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*jwq5H_oNpY3RdCRRkEKuhg.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">查看页面源</figcaption></figure><p id="b0ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个注释告诉我们凭证是这个文件的名称，而页面源代码中只有一个名为“<strong class="jp ir"> admin.gif </strong>的文件，所以我们的用户名和密码是admin。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi le"><img src="../Images/6603c4e9528eb84dc06f080019613bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*HYWR27XumihM0AF8yt92NA.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">上传页面。</figcaption></figure><p id="5504" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我登录了，现在有一个上传文件选项和一个提示，说明标志在/etc/flag文件中。因此，我们的目标是读取该文件以获取我们的标志。所以，我很快压缩了一个简单的php shell并上传到这个页面。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lf"><img src="../Images/197af34f82ad533e3c934273b96b9c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eDksHNkt4XcI08VSAf01ww.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Shell上传</figcaption></figure><p id="bd0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它只是显示了我上传的zip文件中的文件内容。接下来我想到的是尝试用zip:// filter读取一个文件。米语证券公司不久前发布了一个技巧。</p><p id="5717" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参赛:https://twitter.com/yumi_sec/status/1253620834691887105<a class="ae lg" href="https://twitter.com/yumi_sec/status/1253620834691887105" rel="noopener ugc nofollow" target="_blank"/></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lh"><img src="../Images/f6b1d9b291709ed417d3fd16a0380db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5941UtRAxiXHXBnDGxzdw.jpeg"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">zip:// filter trick。</figcaption></figure><p id="cebb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个挑战没有成功，因为管理员可能根本没有保存上传的文件。那么，发生了什么事，zip文件被解压缩，其中的文件只是显示(猫)在输出中。</p><p id="a4fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">搜索了一段时间后，我知道了一个叫做<strong class="jp ir">“Zip Slip”</strong>的问题，它显示了用各种语言编写的Zip文件解析器中的问题。因此，这种利用就像将文件放入一个zip文件中，该文件带有特制的文件名，例如:<strong class="jp ir">"../etc/passwd" </strong>当zip解析器提取它时，会导致服务器后端的文件路径遍历。你可以在这里阅读更多关于滑码的信息。</p><div class="li lj gp gr lk ll"><a href="https://snyk.io/research/zip-slip-vulnerability" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd ir gy z fp lq fr fs lr fu fw ip bi translated">Snyk - Zip Slip漏洞</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">Zip Slip是一个广泛存在的任意文件覆盖关键漏洞，通常会导致远程命令…</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">snyk.io</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz kr ll"/></div></div></a></div><p id="10a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我搜索了如何创建一个名为“的文件../../etc/flag "因为这是我们的目标。我开始知道我们可以使用符号链接来做到这一点。之后，我们可以在zip命令中使用“symlinks”标志将该符号链接添加到zip文件中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/f2b6463827fd73cd81dfc487844d41a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*fX2LH2-BYkM35jsboRDI8g.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">首次测试</figcaption></figure><p id="46b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦上传，它给出了一个路径错误。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mb"><img src="../Images/7feeea07727fd9ec918ac33fc45ca848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GuNflW0o4jOBVAiVgbmgmQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">路径错误</figcaption></figure><p id="8f68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们可以看到我们上传的文件的完整路径得到显示，并显示类似“没有这样的文件或目录”的错误。出现这个错误是因为我们不在标志目录中，但我们需要往回遍历更多。所以，第二个有效载荷是<strong class="jp ir">../../../../../etc/flag" </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/279e78c66b7558c36575a48ca67450e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*BVI8Q_bROynT5TcDJE_tJQ.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">第二有效载荷</figcaption></figure><p id="6045" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样的过程压缩和上传文件，手指交叉。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi md"><img src="../Images/eaea568349c432b18548c9ecfdc09bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*2Ng9m2sGRWowV9-C6ajxyA.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">旗</figcaption></figure><p id="20fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它工作了，我们得到了我们的标志文件内容。所以国旗。这可以肯定是一个真实世界的场景。为了避免这种情况，可以在解压zip文件时适当地清理文件名中的特殊字符。</p><p id="562d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢CyberHack CTF团队设置了这个。！！</p><p id="f58a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你愉快！！黑客快乐！！</p></div></div>    
</body>
</html>