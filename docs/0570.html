<html>
<head>
<title>Simple Logic: Leads to account takeover.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简单的逻辑:导致账户被接管。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/simple-logic-leads-to-account-takeover-63fec69e88b7?source=collection_archive---------0-----------------------#2020-04-29">https://infosecwriteups.com/simple-logic-leads-to-account-takeover-63fec69e88b7?source=collection_archive---------0-----------------------#2020-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5d74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我和XSS分手已经有几个星期了，我真的爱上了逻辑错误。这是如此具有挑战性，给了我很多想法来测试它们，在某一点上，我的记事本几乎看起来像狗屎。</p><p id="445a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定休息一段时间，和我的朋友聊天。她在一家顶级科技公司做远程实习生，她正在给一些人转发一些邮件。她问我你能为我做一段时间吗。既然是远程工作，我就接受了。我所要做的就是改变整个邮件中的Hi<strong class="jp ir">【name】</strong>并添加一些关于彼此独特的任务的信息。我有一个想法，如果我把一个人的任务加到另一个人身上会怎么样。等等，我感觉到了什么！！！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/1e0c6640295e3d7d101e78fb0aaf7562.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*Nab-SVWhMWFj2i2mucpceQ.gif"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">我感觉到了什么！</figcaption></figure><p id="e27d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你不明白其中的逻辑，那很好。</p><h1 id="214c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">深入研究</h1><p id="d731" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我决定选择一个目标来测试这个场景，所以我开始选择几个不同领域的顶级web应用程序。我选的第一个是一个事件管理门户，但是它宕机了<strong class="jp ir">(-_-)HTTP 503；</strong></p><p id="6326" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我选择了一个被认为是该国领先的交易平台之一的网站，交易者/投资者可以在这里投资股票市场。呼钱宝贝！！</p><p id="b2bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样没有注入，只有逻辑错误！！</p><p id="722f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定创建两个账户，分别是sriram.victim@gmail.com的<strong class="jp ir">和sriram.attacker@gmail.com的</strong>和<strong class="jp ir">。<em class="ma"> </em> </strong> <em class="ma">我自己的这个邮箱ID请不要发垃圾邮件，用在这里是为了让读者容易理解。</em></p><p id="2698" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我去了我最喜欢的目的地“忘记密码”页面，请求给我的受害者账户<strong class="jp ir">sriram.victim@gmail.com</strong>发送一封密码重置邮件，并决定分析这个请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/b70ee8bf908e176c3dfee4102a5084f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VwW34CmIWJE_8LHS5Gty5A.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">受害者密码重置请求</figcaption></figure><p id="3227" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发送密码重置邮件的请求相当复杂。我觉得有些可疑！我收到的邮件里的重置链接是干净的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mg"><img src="../Images/6392ed1a367ce2b67f3373c673537d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfO94PNsJ6wh-KdEm91htA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">重置受害者帐户的链接</figcaption></figure><p id="ee5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我决定复制一个原始请求，不做任何修改地发送给中继器，并将原始请求转发给服务器。几分钟后，我决定将<em class="ma"> emailId </em>更改为攻击者邮件Id，即<strong class="jp ir"> </strong>原始请求中的<strong class="jp ir">sriram.attacker@gmail.com</strong>，该请求保存在<strong class="jp ir"> </strong>中继器和<strong class="jp ir"> </strong>转发的请求中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mh"><img src="../Images/a3dfdf755566eeb226e2690d394103e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ZfXRZWcyiILmndRZqQciA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">已发送的请求中的修改邮件。</figcaption></figure><p id="bc21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不相信我去了我的攻击者的邮件，令我惊讶的是，我收到了一封邮件，但与我提供的邮件ID和不同的令牌。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mi"><img src="../Images/1bc2498075fac9612e3f46e199e52133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0bavYJ3NVUoGLfcMtF50Fg.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">攻击者重置邮件</figcaption></figure><p id="6ad7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">加油！我期待的是寄到受害者邮箱的令牌。但是我收到了我的<em class="ma"> emailId </em>，它是攻击者的邮件Id和一个新令牌。啊！伙计，这种情况在这里行不通。我点击了我在攻击者邮件上收到的链接，我发现的内容几乎让我震惊。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/980caf2e83dac8065353625d0edecee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*pyF8lLyrJQQvox7CdB3ATQ.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">受害者帐户的密码重置。</figcaption></figure><p id="6f9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我能够为受害者的帐户设置密码，即使我在重置链接上收到了不同的令牌和不同的电子邮件Id。我真的很震惊，但我想知道这到底是怎么发生的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/277c85b11bb2b11e0bd190e244d1ceb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/1*ZysDQNUy_EHOJKxd5AqZAw.gif"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk">:) ❤</figcaption></figure><p id="038f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过认真了解，我发现这是由于在密码重置请求上使用的cookie。命名为<strong class="jp ir"> <em class="ma"> JSESSIONID </em> </strong> <em class="ma">的cookie。</em>该cookie负责发送密码重置链接。</p><p id="32b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为已经使用<strong class="jp ir"><em class="ma">JSESSIONID</em></strong>cookie向受害者的帐户发送了一封带有密码重置邮件的邮件。我需要用不同的邮件ID重新发送具有相同的<strong class="jp ir"> <em class="ma"> JSESSIONID </em> </strong>的请求，这样相同的链接将被发送给我，即:攻击者的邮件ID，因为受害者的密码重置链接被分配给了<strong class="jp ir"><em class="ma">jession ID</em></strong>cookie。</p><p id="93ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等等，但是攻击者收到的重置链接中的邮件和令牌是不同的，那么怎么可能重置受害者帐户的密码。</p><p id="675c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是因为，有一个<code class="fe ml mm mn mo b">&lt;a href&gt;</code>标签用来屏蔽邮件上的原始链接。还有一个链接用于在后端重置密码。即使链接看起来不同，它也会被重定向到发送给受害者的相同目的地。</p><p id="2cd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们去了另一个逻辑错误，导致帐户接管。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/2a7fed84dd47c20e62823ead467f5300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/1*XE8COnis2S2IphmQ2CbOHg.gif"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">找到你了！</figcaption></figure><h1 id="06f2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">吸取教训！</h1><p id="34b6" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">开发商加油！我相信你吸取了教训。对于bug猎人，请分析密码重置请求，特别是如果其中有多个cookies，发送原始请求并更改邮件ID，然后再次发送。你一定在那里发现一些可疑的东西。</p><h1 id="107a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">时间线:</h1><p id="c3ac" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated"><strong class="jp ir">2020年1月:</strong>向组织报告问题。</p><p id="264d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">2020年1月:</strong>几个小时后与安保人员接通。</p><p id="23ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">2020年1月:</strong>问题在第二天就得到解决，并得到了组织的认可，在其交易平台上提供了礼品卡和终身访问权限。</p><p id="1f74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2020年4月:写完发表。</p><p id="711b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那是快速补丁❤！！</p><p id="8a8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，如果你喜欢这个，写下来鼓掌👏(50X)，那我们来连线:</p><p id="6510" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">推特:</strong>T33】https://www.twitter.com/sriramoffcl</p><p id="2023" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Instagram:</strong><a class="ae mq" href="https://www.instagram.com/sriram_offcl/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/sriram_offcl </a></p><p id="eb08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">LinkedIn:</strong><a class="ae mq" href="https://www.linkedin.com/in/sriramkesavan/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/sriramkesavan </a></p><p id="7f99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">电子邮件:   sriramkesavan98@gmail.com | <strong class="jp ir"> Donate: </strong> <a class="ae mq" href="https://www.paypal.me/sri123" rel="noopener ugc nofollow" target="_blank"> https://paypal.me/sri123 </a></p><p id="c6da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 和平 </strong> ⚠️ <strong class="jp ir">！！(T19)</strong></p></div></div>    
</body>
</html>