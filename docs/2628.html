<html>
<head>
<title>Write-up: DOM XSS in document.write sink using source location.search @ PortSwigger Academy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">特写:文档中的DOM XSS。使用源位置编写接收器。搜索@ PortSwigger Academy</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/write-up-dom-xss-in-document-write-sink-using-source-location-search-portswigger-academy-c8e270203773?source=collection_archive---------2-----------------------#2022-12-10">https://infosecwriteups.com/write-up-dom-xss-in-document-write-sink-using-source-location-search-portswigger-academy-c8e270203773?source=collection_archive---------2-----------------------#2022-12-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8719ec44de80b878b388c3e09820bcde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kGiNtvlVenDWkfkz.png"/></div></div></figure><p id="d8a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇关于document . write sink using source location . search中的实验室<em class="kw"> DOM XSS的文章</em>是我为<a class="ae kx" href="https://portswigger.net/web-security" rel="noopener ugc nofollow" target="_blank"> PortSwigger的Web安全学院</a>编写的演练系列的一部分。</p><p id="c584" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">学习路径</strong>:客户端主题→跨站点脚本</p><div class="ky kz gp gr la lb"><a href="https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-document-write-sink" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">实验室:文档中的DOM XSS。使用源位置编写接收器。搜索|网络安全学院</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">练习利用现实目标的弱点。记录你从学徒到专家的进步。看哪里…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">portswigger.net</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><p id="bdd6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Python脚本:<a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/blob/main/11_cross_site_scripting_XSS/DOM_XSS_in_document.write_sink_using_source_location.search/script.py" rel="noopener ugc nofollow" target="_blank"> script.py </a></p><h1 id="af14" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">实验室描述</h1><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/1a487200218d8ead82a8cc5524127387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VrzZjUar3rfg8Prs.png"/></div></div></figure><h1 id="0625" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">步伐</h1><p id="6bff" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">实验室应用程序是一个具有搜索功能的博客网站。执行搜索后，搜索词将包含在结果页面中。</p><p id="5ef6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个简单的XSS尝试失败了:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/a2c2224b24b886934864e55f5a97464f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mHs69rQOwylE7Q_E.png"/></div></div></figure><p id="808a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看页面源代码，显示的搜索词编码正确。然而，它也显示了javascript将搜索词从URL中取出，并将其写入img-tag以进行某种类型的跟踪:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d91499d39c52b1089ea1f1a71513aa84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/0*WbeGTiqsTCtj3UiP.png"/></div></figure><p id="3ea5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用浏览器工具，我可以检查生成的HTML。可以看出，我的搜索词是在没有任何明显保护措施的情况下嵌入的:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6c8fbe8ee83e82a5e2a794b0562bd2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/0*IHEmdFpheXHq03e5.png"/></div></figure><p id="d0cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当然，脚本标签在这里是在一个字符串中，所以它们是无害的。但是，如果我可以通过注入双引号来终止字符串，那么我就可以自由地操纵结果HTML。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="54ae" class="lq lr iq bd ls lt ni lv lw lx nj lz ma mb nk md me mf nl mh mi mj nm ml mm mn bi translated">恶意负载</h1><p id="e643" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">注入<code class="fe nn no np nq b">"&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;</code>会产生下面的HTML:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/a652a06f08bbf34ee59844a7864ae736.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/0*skv9KbktdfJG4gAf.png"/></div></figure><p id="4c94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以看到，我关闭了src-string和img-tag，随后是触发警告框的有效JavaScript代码。原始内容的剩余部分<code class="fe nn no np nq b">"&gt;</code>显示为纯文本，在此不做干涉:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/b07fc85bd3ff1bbc3bda0d9d1787953e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/0*qpMlk7TOIf2piFnB.png"/></div></figure><p id="a64c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同时，实验室更新到</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/87586217f3aba56c408b486152a04d53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8nHPdh2zqUPLmpf8.png"/></div></div></figure></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h1 id="2f05" class="lq lr iq bd ls lt ni lv lw lx nj lz ma mb nk md me mf nl mh mi mj nm ml mm mn bi translated">供选择的</h1><p id="7f49" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">同样的结果可以通过注入<code class="fe nn no np nq b">" onload="alert(document.domain)</code>来实现，它向<code class="fe nn no np nq b">img</code>标签添加了一个属性，并产生了这个HTML:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/4371bf83f96b10ad7868a2aaffa7bdc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/0*XlkZ8gTFLAMK2hJa.png"/></div></figure></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="e348" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">原载于</em><a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/tree/main/11_cross_site_scripting_XSS/DOM_XSS_in_document.write_sink_using_source_location.search" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://github.com</em></a><em class="kw">。</em></p><p id="4ebb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nn no np nq b"><a class="ae kx" href="https://medium.com/@frank.leitner/membership" rel="noopener">New to Medium? Become a Medium member to access all stories on the platform and support me at no extra cost for you!</a></code></p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><h2 id="ecd4" class="nv lr iq bd ls nw nx dn lw ny nz dp ma kj oa ob me kn oc od mi kr oe of mm og bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kx" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>