<html>
<head>
<title>USB Forensics 101</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">USB取证101</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/usb-forensics-101-444faf737c4c?source=collection_archive---------3-----------------------#2022-11-08">https://infosecwriteups.com/usb-forensics-101-444faf737c4c?source=collection_archive---------3-----------------------#2022-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="6f89" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">欢迎来到我的USB取证101指南。</p><p id="69c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">受我完成的USB取证基础知识的Pluralsight课程的启发，我决定尝试自己解释这些基础知识。作为一个目标导向型的人，我知道决定写一篇博客将有助于我理解所学内容，并帮助我组织我头脑中的新知识——你知道他们说什么，一个人只有在能够向一个五岁的孩子解释一个话题时，才能完全理解这个话题。虽然这对于一个五岁的孩子来说可能有点沉重(尽管它可能会被证明是一个有效的睡前催眠曲)，但它应该传达了我从只知道USB的存在到理解它如何在引擎盖下工作所学到的东西。</p><h1 id="7b52" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">基础</h1><p id="f226" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">首先，我们来了解一下，在没有插入任何USB设备的情况下，主机看到自己的USB是什么样的。为此，我们将需要<code class="fe lr ls lt lu b">lsusb</code>实用程序。让我们试一试——确保没有任何东西插入您的USB端口。</p><p id="843c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lr ls lt lu b">lsusb</code>预装在Linux上。如果你像我一样使用macOS，你需要先用<code class="fe lr ls lt lu b">brew install lsusb</code>安装它。运行<code class="fe lr ls lt lu b">lsusb -t</code>命令，将输出显示为一棵树。其他有用的语法可以是<code class="fe lr ls lt lu b">lsusb | sort -k 2</code>，它根据总线号对输出进行排序，或者是<code class="fe lr ls lt lu b">lsusb -v</code>，verbose标志输出关于所列设备的更多详细信息。</p><pre class="lv lw lx ly gt lz lu ma mb aw mc bi"><span id="d0e8" class="md kp it lu b gy me mf l mg mh">Kingas-MacBook-Pro:~ kingakieczkowska$ lsusb -t<br/>...<br/>0.Dev 000: iBridge Bus, <br/>/:  Bus 000.Dev 001: USB 3.1 Bus, <br/>/:  Bus 128.Dev 000: Apple T2 Controller, <br/>/:  Bus 128.Dev 000: FaceTime HD Camera (Built-in), <br/>/:  Bus 128.Dev 000: Ambient Light Sensor, <br/>/:  Bus 128.Dev 000: Headset, <br/>    |__ Bus 128.Dev 008: Apple Internal Keyboard / Trackpad, 480M<br/>/:  Bus 128.Dev 000: Touch Bar Display, <br/>/:  Bus 128.Dev 000: Touch Bar Backlight,</span></pre><p id="e0ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输出为我们提供了总线号、设备号、设备名和设备的最大信号速率(速度)——这是一行末尾的数字，上面用绿色标记。由于这可能比我们在机器上什么都没插的情况下看到的设备要多得多，所以让我们仔细看看:</p><ul class=""><li id="f13e" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">iBridge是一个USB设备，在内部用作TouchBar的接口；</li><li id="c28e" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">USB 3.1总线是所有用户设备将连接的总线；</li><li id="19aa" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">总线128上的所有设备都被预先构建到机器中。</li></ul><p id="053a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我有一台MacBook Pro，所以要真正使用我的USB，我需要一个该死的加密狗(是的，我知道，这很荒谬)。让我们看看当我插入一个带有另一个USB C端口和两个USB A端口的加密狗时会有什么变化(USB A是您最常见的“常规”USB)。加密狗还有一个HDMI端口，允许USB C到HDMI的连接。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/2d3e3226e781a6b52ae7a9905577e711.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/0*uMTYxNhFV7Cccooe"/></div></figure><p id="fb04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们检查一下插上加密狗后<code class="fe lr ls lt lu b">lsusb</code>中出现了什么。</p><pre class="lv lw lx ly gt lz lu ma mb aw mc bi"><span id="111e" class="md kp it lu b gy me mf l mg mh">Kingas-MacBook-Pro:~ kingakieczkowska$ lsusb -t<br/>...<br/>0.Dev 000: iBridge Bus, <br/>  Bus 000.Dev 001: 3.0 root hub, 5000M<br/>/:  Bus 000.Dev 001: USB 3.1 Bus, <br/>    |__ Bus 000.Dev 001: USB3.0 Hub, 5G<br/>    |__ Bus 020.Dev 001: USB2.0 Hub, 480M<br/>        |__ Bus 020.Dev 002: USB 2.0 BILLBOARD, 12M<br/>/:  Bus 128.Dev 000: Apple T2 Controller, <br/>/:  Bus 128.Dev 000: FaceTime HD Camera (Built-in), <br/>/:  Bus 128.Dev 000: Ambient Light Sensor, <br/>/:  Bus 128.Dev 000: Headset, <br/>    |__ Bus 128.Dev 008: Apple Internal Keyboard / Trackpad, 480M<br/>/:  Bus 128.Dev 000: Touch Bar Display, <br/>/:  Bus 128.Dev 000: Touch Bar Backlight,</span></pre><p id="27a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">淡紫色线条代表根集线器、两个新的集线器——USB 3.0和USB 2.0——以及一个新的广告牌设备。我们一个一个来看。<br/>根hub是直接与我们机器的USB接口。接下来，您可能想知道为什么在插入一个USB加密狗后会出现两个USB集线器？这是因为为了向后兼容，实际上每个USB3.0都包含一个USB2.0。USB3.0架构与USB2.0有着天壤之别，否则就不可能使用与USB3.0不兼容的设备。您可以将USB3.0与USB2.0兼容的设备一起使用，但该设备只能达到USB2.0每秒480兆位的最大速度，而<strong class="js iu">不能达到</strong> USB3.0每秒5千兆位的最大速度。<br/>最后，有一个USB2.0广告牌设备显示为连接到USB2.0集线器。这实际上是加密狗内的一个内置设备，便于USB C &lt; - &gt; HDMI连接。<br/>让我们将USB记忆棒插入集线器/加密狗的一个可用端口，看看会发生什么。</p><pre class="lv lw lx ly gt lz lu ma mb aw mc bi"><span id="a02b" class="md kp it lu b gy me mf l mg mh">Kingas-MacBook-Pro:~ kingakieczkowska$ lsusb -t<br/>...<br/>0.Dev 000: iBridge Bus, <br/>  Bus 000.Dev 001: 3.0 root hub, 5000M<br/>/:  Bus 000.Dev 001: USB 3.1 Bus, <br/>    |__ Bus 000.Dev 001: USB3.0 Hub, 5G<br/><strong class="lu iu">        |__ Bus 000.Dev 004: USB DISK, 5G</strong><br/>    |__ Bus 020.Dev 001: USB2.0 Hub, 480M<br/>        |__ Bus 020.Dev 002: USB 2.0 BILLBOARD, 12M<br/>/:  Bus 128.Dev 000: Apple T2 Controller, <br/>/:  Bus 128.Dev 000: FaceTime HD Camera (Built-in), <br/>/:  Bus 128.Dev 000: Ambient Light Sensor, <br/>/:  Bus 128.Dev 000: Headset, <br/>    |__ Bus 128.Dev 008: Apple Internal Keyboard / Trackpad, 480M<br/>/:  Bus 128.Dev 000: Touch Bar Display, <br/>/:  Bus 128.Dev 000: Touch Bar Backlight,</span></pre><p id="f0c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">洋红色粗线表示USB磁盘存在。因为它兼容USB3.0，所以它连接到USB3.0集线器，我们可以看到它的最大信号速率为5 gbps。</p><p id="33e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，让我们看看当我们连接一个旧键盘时会发生什么。</p><pre class="lv lw lx ly gt lz lu ma mb aw mc bi"><span id="ce52" class="md kp it lu b gy me mf l mg mh">Kingas-MacBook-Pro:~ kingakieczkowska$ lsusb -t<br/>...<br/>0.Dev 000: iBridge Bus, <br/>  Bus 000.Dev 001: 3.0 root hub, 5000M<br/>/:  Bus 000.Dev 001: USB 3.1 Bus, <br/>    |__ Bus 000.Dev 001: USB3.0 Hub, 5G<br/>        |__ Bus 000.Dev 003: USB DISK, 5G<br/>    |__ Bus 020.Dev 001: USB2.0 Hub, 480M<br/><strong class="lu iu">        |__ Bus 020.Dev 005: Composite Device, 1.5M</strong><br/>        |__ Bus 020.Dev 003: USB 2.0 BILLBOARD, 12M<br/>/:  Bus 128.Dev 000: Apple T2 Controller, <br/>/:  Bus 128.Dev 000: FaceTime HD Camera (Built-in), <br/>/:  Bus 128.Dev 000: Ambient Light Sensor, <br/>/:  Bus 128.Dev 000: Headset, <br/>    |__ Bus 128.Dev 008: Apple Internal Keyboard / Trackpad, 480M<br/>/:  Bus 128.Dev 000: Touch Bar Display, <br/>/:  Bus 128.Dev 000: Touch Bar Backlight,</span></pre><p id="d328" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">开始了。我的旧键盘的信号速率是1.5M，显然与USB3.0不兼容(它真的很旧了)——因此连接到USB2.0集线器。还有——复合设备到底是什么？有时被插设备的名称会提供不多的信息，因此明智的做法是习惯于比较插入东西前后<code class="fe lr ls lt lu b">lsusb</code>的输出，这是识别您想要研究的设备的方法。</p><p id="4dfd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所有上述连接都是由主机控制器促成的。每台机器至少有一个在硬件层面管理USB总线上的数据。</p><h1 id="9729" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">USB 主机通信</h1><p id="503f" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">让我们深入了解USB设备实际上是如何与主机通信的。</p><h1 id="a3ad" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">端点</h1><p id="1ed9" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">USB端点是一条“虚拟线路”，它既是设备的数据接收器，也是设备的数据源。有四种类型的USB端点。这些类型还决定了在其上发生的数据传输的类型，因此下面同时是端点和传输类型:</p><ul class=""><li id="af77" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated"><strong class="js iu">中断<br/> </strong>鼠标(就像我们上面看到的那个)和键盘使用，低速(事实证明鼠标和键盘并不经常发送那么多数据)。有趣的事实是:这个中断实际上并没有以任何方式中断主机。它必须等到被主机轮询后才能发送任何请求。</li><li id="3477" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><strong class="js iu">控制</strong>大多数USB设备使用的<br/>；具有该端点的设备必须能够响应标准USB设备请求，如获取地址、设置地址、获取描述符、设置描述符、获取状态、清除特征、设置特征等。GET_STATUS通知端点的状态。后者获取、设置、清除和设置设备上不同功能的布尔值。</li><li id="b307" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><strong class="js iu"> Bulk <br/> </strong>用于性能良好，不允许低速传输；被USB大容量存储(USBMS)设备广泛使用。</li><li id="b3b4" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><strong class="js iu">同步</strong> <br/>主要用于流媒体等对时间要求苛刻的应用；每当需要保证带宽时。</li></ul><p id="441f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">值得注意的是，每个端点都有一个指定的方向。该方向始终相对于主机，而不是设备:1表示主机的输入，0表示主机的输出。USB2.0设备最多可以有32个端点(16个输入，16个输出)，而USB3.0设备支持更多端点(最多96个或254个，具体取决于底层架构)。重要的是要记住，单个设备可能会使用多个端点，更多信息请点击这里的<a class="ae na" href="https://www.cambrionix.com/articles_support/endpoint-limitation-usb-hubs" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="7fad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以清楚地看到Wireshark中用于通信的端点类型。选择一个数据包，向下滚动到USB URB (URB代表USB请求块)部分，然后选择Endpoint以检查该特定数据包使用的传输类型和方向。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/1413255615f61b82b33f7bd25b80741a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*xGuXOxQRk_kg8Fmy"/></div></div></figure><p id="c9e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">控制转移是有趣的，因为它将被用来发送描述设备的数据，如品牌、语言等。这对你的法医调查非常有帮助。这是通过描述符传达的。</p><h1 id="5bfe" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">描述符</h1><p id="67d9" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">你会看到主机向设备发送了相当多的请求，包括<code class="fe lr ls lt lu b">GET_DESCRIPTOR Request</code>和设备相应的回复——<code class="fe lr ls lt lu b">GET_DESCRIPTORS Response</code>。我们最感兴趣的是响应，因为它们包含了设备报告给主机的信息。在Wireshark中，您可以过滤您的捕获，只显示具有<code class="fe lr ls lt lu b">bDescriptorType</code>字段的数据包，只需将<code class="fe lr ls lt lu b">usb.bDescriptorType</code>放入过滤栏即可。这将向您显示请求和响应。为了只过滤响应，我们将在过滤栏中添加<code class="fe lr ls lt lu b">&amp;&amp; !usb.bmRequestType</code>。这是因为只有请求才会有<code class="fe lr ls lt lu b">bmRequestType</code>字段，添加感叹号会反转过滤器，留给我们所有没有<code class="fe lr ls lt lu b">bmRequestType</code>字段的数据包。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/220c3ae572c29389ae10188ed036f2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/0*JiGy1KkV1l8PJ6pn"/></div></figure><p id="4715" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">许多不同类型的描述符携带了许多有趣的信息。它们都共享一个公共结构，当描述符的第一个字节指定描述符的长度，第二个字节指定类型，剩余的数据形成实际的描述符。描述符类型如下:</p><ul class=""><li id="36ea" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">设备描述符(0x01)</li><li id="6ac2" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">配置描述符(0x02)</li><li id="b6b3" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">字符串描述符(0x03)</li><li id="ac6f" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">接口描述符(0x04)</li><li id="f761" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">端点描述符(0x05)</li></ul><p id="e4ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以在任何包含描述符的包中观察到这一点。下面是一个<strong class="js iu">配置描述符</strong>的例子；当在Wireshark中选择该部分的标题时，它将在下面的原始数据视图中突出显示字节，以便您可以亲自调查每个人。这是一个USB记忆棒的配置描述符——在法医调查情况下，我们可能不知道这一点，因此了解有关设备的详细信息，例如它不是自供电的，不具备远程唤醒的能力(就像鼠标或其他HID可能会做的那样)。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/fdd3db7a862aa13cee5ef0b3f6554143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*rQX6gaEz_qbNmc4b"/></div></figure><p id="2e7f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">设备描述符</strong>提供了更多关于设备的详细信息，比如厂商和产品识别信息。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/7ae8cb09a5df3e9b047eedbed9203f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/0*xtWyLsFZqwLt57um"/></div></figure><p id="30e0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">字符串描述符是一个有趣的描述符。它是可选的，您可以在其中找到的信息取决于设备。有趣的是，它支持由特定代码表示的多种语言——例如，英语(美国)是0x0409，德语是0x0407，这可能对您的法庭调查有意义。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/136308a44e84ed50b5a488e81948cd7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*QgCCXU39SO5PnXuy"/></div></figure><p id="443d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">字符串描述符中的信息是人类可读的格式，例如可以显示设备的名称，如下所示。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/fb362a089fa8630ed8ec6e39d854f9d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*szKfulYD3giH1lcY"/></div></figure><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/b4944d16fd451d4f3fd4eb93e03a5cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*w2QrIacUn4wyaJ0t"/></div></figure><p id="6f94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用Wireshark过滤器来缩小特定描述符的搜索范围——只需弹出<code class="fe lr ls lt lu b">usb.bDescriptorType == 0x01</code>来过滤设备描述符，或者用十六进制值替换不同类型的描述符来过滤这些描述符。</p><h1 id="c83c" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">USB设备类别</h1><p id="23e5" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">我们要看的USB协议的最后一个特征是设备类别。所有USB设备都有一个设备类别属性。完整列表可在此<a class="ae na" href="https://en.wikipedia.org/wiki/USB#Device_classes" rel="noopener ugc nofollow" target="_blank">获得</a>以供参考。在某些情况下，设备类别将未指定(值将为0x00)。然后，我们需要查看特定的接口类来确定设备是什么。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/46314d3660b1bb935bb0c6573fd8723a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*yknnYgr0O2l7vzNs"/></div></figure><p id="12cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">应用过滤器仅显示包含接口描述符的数据包—<code class="fe lr ls lt lu b">usb.bDescriptorType == 0x04</code>—接口描述符可以很快找到，揭示设备的更多特征—例如是HID和鼠标…</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/08a88b62e7cfe6cb1c90ce926ad4c756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*iiBSEcKl7lggxXET"/></div></figure><p id="1d11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">…或者USB大容量存储设备。</p><figure class="lv lw lx ly gt mx gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/8d242da6f932cc402af035986299b4e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*-4aCuJbZUuO8aU0X"/></div></figure><h1 id="19bc" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">额外收获:嗅探USB流量的实用技巧</h1><p id="94b8" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated"><strong class="js iu"> macOS: </strong>你必须运行<code class="fe lr ls lt lu b">sudo ifconfig XHC20</code>才能在Wireshark中看到接口并嗅探它上面的流量。此外，在开始Wireshark捕获之前，请确保您确实断开了所有设备与USB端口的连接，因为您希望能够捕获它们的全部通信，因此一旦开始捕获，您就可以将它们插上电源。<br/> <strong class="js iu"> Linux: </strong>您需要运行sudo <code class="fe lr ls lt lu b">modprobe usbmon</code>，然后通过运行<code class="fe lr ls lt lu b">sudo wireshark &amp;</code>以root身份运行Wireshark，以便能够嗅探usbmon接口上的流量。</p><p id="5a36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你在macOS上，你想要嗅的接口将会是XHC(扩展主机控制器)。接口号对应总线号— XHC20是总线020，XHC0是总线000，依此类推。不幸的是，当我直接在Mac上进行嗅探时，我无法正确显示数据，所以我将嗅探部分转移到Kali VM上。</p><p id="5eb7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">嗯，那是相当多的东西，所以让我们暂时就此结束吧。我希望上面的内容能让我们了解USB通信是什么样子，以及它们由什么组成。接下来，我将调查大容量存储设备取证，所以请留意下一部分。</p><p id="9305" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢收听！</p><p id="a59d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="nj">看看我下面这篇关于USB取证102的文章。</em>T11】</strong></p><div class="nk nl gp gr nm nn"><a href="https://medium.com/@kieczkowska/usb-forensics-102-42f275bd137b" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">USB取证102</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">欢迎来到USB取证102，这是我的第101篇文章的继续，这篇文章探讨了使用USB时留下的取证人工制品…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">medium.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob my nn"/></div></div></a></div><h2 id="7ccd" class="md kp it bd kq oc od dn ku oe of dp ky kb og oh lc kf oi oj lg kj ok ol lk om bi translated">来源</h2><ul class=""><li id="cc94" class="mi mj it js b jt lm jx ln kb on kf oo kj op kn mn mo mp mq bi translated"><a class="ae na" href="https://www.pluralsight.com/courses/usb-forensics-fundamentals" rel="noopener ugc nofollow" target="_blank">https://www . plural sight . com/courses/USB-forensics-fundamentals</a></li><li id="0374" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><a class="ae na" href="http://www.usbmadesimple.co.uk/" rel="noopener ugc nofollow" target="_blank">http://www.usbmadesimple.co.uk/</a></li><li id="ccee" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><a class="ae na" href="https://www.beyondlogic.org/usbnutshell/" rel="noopener ugc nofollow" target="_blank">https://www.beyondlogic.org/usbnutshell/</a></li><li id="4c8c" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><a class="ae na" href="https://www.usb.org/defined-class-codes" rel="noopener ugc nofollow" target="_blank">https://www.usb.org/defined-class-codes</a></li><li id="c837" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated"><a class="ae na" href="https://www.cambrionix.com/articles_support/endpoint-limitation-usb-hubs" rel="noopener ugc nofollow" target="_blank">https://www . cambrionix . com/articles _ support/endpoint-limit-USB-hubs</a></li></ul></div></div>    
</body>
</html>