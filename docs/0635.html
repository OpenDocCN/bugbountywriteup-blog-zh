<html>
<head>
<title>Business logic flaw in the invitation system allows to Takeover any account at a private company</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">邀请系统中的业务逻辑缺陷允许接管私人公司的任何账户</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/business-logic-flaw-in-invitation-system-allows-to-takeover-any-account-at-private-company-daaf898966b0?source=collection_archive---------0-----------------------#2020-06-15">https://infosecwriteups.com/business-logic-flaw-in-invitation-system-allows-to-takeover-any-account-at-private-company-daaf898966b0?source=collection_archive---------0-----------------------#2020-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="135e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">朋友们好，</p><p id="4a41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将解释我如何利用一家私人公司的邀请系统下的业务逻辑缺陷，在未经用户同意的情况下接管他们服务中的任何帐户。</p><h1 id="18b0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">首先要做的事情:</strong></h1><p id="b838" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我有一个名为“仇杀”的团队，有一个新的目标启动了一个公开的bug赏金计划，我们通过google dork找到了这个计划，所以我们决定进行第一次“批判性”调查</p><p id="3079" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，我开始以普通用户的身份使用应用程序，同时使用流量拦截工具(例如Burp Suite)捕获和读取所有请求。</p><p id="ef32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该应用程序允许我们在“用户”部分邀请新用户加入组织帐户</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/347460b8f09e77673e4abf4404b48e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W3mgcw2QpFRe195_0G658A.png"/></div></div></figure><p id="6a40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">被邀请的用户将在他们的邮箱中收到一封带有如下令牌的电子邮件</p><p id="a573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ma" href="https://app.redacted.com/reset-multi-user-password/INVITE-TOKEN-HERE" rel="noopener ugc nofollow" target="_blank">https://app . redated . com/reset-multi-user-password/INVITE-TOKEN-HERE</a></p><p id="5287" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你是一个Bug猎人，那么上面的端点应该引起你的注意，因为它引起了我的注意，特别是在<code class="fe mb mc md me b">reset-multi-user-password</code>中</p><p id="baed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我解释的那样，创建这个函数是为了给公司的帐户添加一个用户，为什么他们称这个为“重置密码”端点呢？</p><p id="d85a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">带着这个问题，我决定更深入地研究，当接受<code class="fe mb mc md me b">invitation</code>时，应用程序向端点<code class="fe mb mc md me b">/activate-invited-user</code>发送一个<code class="fe mb mc md me b">POST</code>请求以及请求正文中的邀请电子邮件。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mf"><img src="../Images/ce261e41359253ca269b9b886bfe9b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3y78TUVhxnRMEHLBqqE6nQ.png"/></div></div></figure><p id="49d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题就在这里，<strong class="jp ir">邀请的用户</strong>控制着请求体中的<strong class="jp ir">邮件和密码</strong>，我想:</p><p id="c518" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“被邀请的用户通过<code class="fe mb mc md me b">reset-multi-user-password</code>端点接收邀请令牌，用户<strong class="jp ir">控制</strong>被邀请的<strong class="jp ir"/><strong class="jp ir">电子邮件和新密码，</strong>如果我将被邀请的电子邮件更改为<code class="fe mb mc md me b">owner@victim.com</code>并连同新密码一起转发请求会怎样？”</p><p id="5a49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我捕获了“accept invite”请求，并将<code class="fe mb mc md me b">email</code>更改为“owner@victim.com”以及一个新密码，如下所示</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mg"><img src="../Images/f8e96f05d041796260a4293dc37b5439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t0PdbPaS_7qBOJoa0ZBHHw.png"/></div></div></figure><p id="2040" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务器接受了我的请求，然后我用新密码登录“owner@victim.com”来确认接管。</p><p id="3032" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我向安全团队发送了一封电子邮件，用下面的<strong class="jp ir">概念验证</strong>描述了漏洞及其影响:</p><ol class=""><li id="b6f6" class="mh mi iq jp b jq jr ju jv jy mj kc mk kg ml kk mm mn mo mp bi translated">登录您在<a class="ae ma" href="https://app.redacted.com" rel="noopener ugc nofollow" target="_blank">https://app.redacted.com</a>的账户</li><li id="4270" class="mh mi iq jp b jq mq ju mr jy ms kc mt kg mu kk mm mn mo mp bi translated">现在邀请任何你也控制在“用户”部分的电子邮件</li><li id="85d3" class="mh mi iq jp b jq mq ju mr jy ms kc mt kg mu kk mm mn mo mp bi translated">点击邀请链接，你会看到一个页面，要求你为账户创建一个新的密码，拦截请求</li><li id="6150" class="mh mi iq jp b jq mq ju mr jy ms kc mt kg mu kk mm mn mo mp bi translated">只需将<code class="fe mb mc md me b">email</code>更改为应用程序中的任何其他用户帐户，然后转发请求</li><li id="ec42" class="mh mi iq jp b jq mq ju mr jy ms kc mt kg mu kk mm mn mo mp bi translated">现在，您已经使用邀请令牌为“受害者”电子邮件设置了新密码</li></ol><p id="6ba2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安全团队很快对该漏洞进行了分类并解决了问题。</p><h1 id="c3d9" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">外卖:</strong></h1><p id="6c5e" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">始终观察所有的端点名称，如果您看到与平常不同的东西，尝试更深入，您可能会发现一些有趣的行为。</p><p id="7ebb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的时间:)</p><p id="bcde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">丹尼尔_v</p><p id="f2db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仇杀白帽队</p><p id="ed0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ma" href="https://twitter.com/d4niel_v" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae ma" href="https://bugcrowd.com/daniel_v" rel="noopener ugc nofollow" target="_blank"> BugCrowd简介</a> | <a class="ae ma" href="https://hackerone.com/daniel_v" rel="noopener ugc nofollow" target="_blank"> H1简介</a> | <a class="ae ma" href="https://www.linkedin.com/in/daniel-morais-968463120/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a></p></div></div>    
</body>
</html>