<html>
<head>
<title>TLDR CTF Write Up: Vulnversity/TryHackMe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TLDR·CTF撰文:Vulnversity/TryHackMe</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tldr-ctf-write-up-vulnversity-tryhackme-ab814501b1ef?source=collection_archive---------5-----------------------#2021-05-17">https://infosecwriteups.com/tldr-ctf-write-up-vulnversity-tryhackme-ab814501b1ef?source=collection_archive---------5-----------------------#2021-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e81" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">CTF写下你在进入房间前应该阅读的内容</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a9698e2905ab37ac78dc0663485cc6a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7N0us4wtS4HEpY9GXPE_jQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来自tryhackme.com的照片</figcaption></figure><h1 id="fbe9" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">系列简介</h1><p id="7c54" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi mm translated">ybersecurity一直是我想涉足的领域，或者至少是将我的数据科学技能应用到其中。不是因为“机器人先生”式的好莱坞黑客场景，不是那个。相反，我被它吸引是因为它体现了好奇心、对知识的渴望、解决问题的能力以及总是修修补补的心态。</p><p id="47ce" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">进入<a class="ae na" href="https://tryhackme.com/" rel="noopener ugc nofollow" target="_blank"> TryHackMe </a>，这是一个流行的在线平台，让你通过许多简短的游戏化实验室(具有特定目的和配置的虚拟机)学习网络安全。它也非常适合初学者。您不必构建自己的家庭实验室并处理那些虚拟机配置。它们已经是现成的，随时可以被利用。它可以让你接触到其他人的智慧(由其他专家或同行开发的CTF室)，而如果你建立自己的家庭实验室，你就无法获得这些智慧。这一系列文章将记录我对挑战的感受以及我从挑战中学到的东西，有点像TLDR的风格。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="dd0d" class="ky kz it bd la lb ni ld le lf nj lh li jz nk ka lk kc nl kd lm kf nm kg lo lp bi translated">对TLDR·CTF的报道有什么期待</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/cb3150ab9fd1d4c2719000e63dd9002c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BJyTUYB3WO1CPm96"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来自tryhackme.com的照片</figcaption></figure><p id="c765" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated"><strong class="ls iu">可能会有帮助，如果你:</strong></p><p id="76a1" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">✔️想要从20，000英尺的高度了解这个房间的情况<br/> ✔️想要所有线索来帮助您完成整个旅程，但仍想自己解决问题<br/> ✔️完成了房间的布置，但仍想看看有哪些好的收获</p><p id="7a5b" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated"><strong class="ls iu">如果您需要:</strong>，您可能需要查看其他评论</p><p id="753b" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">🔶想要一个详细的逐步记录来指导你通过挑战<br/>为此，我推荐这个<a class="ae na" href="https://0xa94.medium.com/tryhackme-vulnversity-ca0bdcc73386" rel="noopener">记录</a>。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="db50" class="ky kz it bd la lb ni ld le lf nj lh li jz nk ka lk kc nl kd lm kf nm kg lo lp bi translated">总体感觉</h1><p id="2256" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">到我们今天要讨论的房间:TryHackMe: Vulnversity。如果选择<a class="ae na" href="https://tryhackme.com/paths" rel="noopener ugc nofollow" target="_blank">进攻试探</a>路径就是第一个实房(第一个<em class="no">入门</em>和<em class="no">教程</em>太容易数了)。总的来说，我觉得这个房间设计得很好。它需要一些Linux命令行知识，但不需要太复杂。它将整个任务分解成小块，因此没有一个子任务太难处理。它将侦察、利用、利用后的典型黑客攻击过程浓缩到这些简单的任务中，向您介绍工具，并引导您完成思考过程。注意，你仍然需要自己做一些研究。这个房间不会什么都喂你。但这正是乐趣所在，对吗？</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="e4e0" class="ky kz it bd la lb ni ld le lf nj lh li jz nk ka lk kc nl kd lm kf nm kg lo lp bi translated">尝试这个房间的理由</h1><blockquote class="np"><p id="f9b2" class="nq nr it bd ns nt nu nv nw nx ny ml dk translated">1.学习基本的黑客流程(侦查-&gt;利用-&gt;利用后)<br/> 2。熟悉一些非常必要的黑客工具(<strong class="ak"> nmap </strong>、<strong class="ak"> GoBuster、</strong>T5】BurpSuite、<strong class="ak"> systemctl </strong>等)。)<br/> 3。体验一下特权升级和反向外壳。</p></blockquote></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="6b60" class="ky kz it bd la lb ni ld le lf nj lh li jz nk ka lk kc nl kd lm kf nm kg lo lp bi translated">使用的战略/战术</h1><p id="7f8f" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">➡️使用<strong class="ls iu"> Nmap </strong>获取开放端口和服务的信息- &gt;发现80端口开放，<br/>网站使用<strong class="ls iu"> GoBuster </strong>搜索web服务器上的文件夹- &gt;在<strong class="ls iu">内部</strong>文件夹中找到上传表单<br/> ➡️使用<strong class="ls iu"> BurpSuite </strong>拦截请求并找出支持的上传格式- &gt; <strong class="ls iu"> PHP: </strong>否；<strong class="ls iu"> phtml: </strong>是的！<br/> ➡️上传扩展名为`. phtml '的反向外壳有效载荷绕过过滤:在反向外壳内获得一个反向外壳<br/> ➡️，使用<strong class="ls iu"> find </strong>搜索可用于权限提升的SUID文件-&gt;find<strong class="ls iu">/bin/system CTL</strong><br/>➡️创建一个<strong class="ls iu"> SystemD </strong>服务文件，使用<strong class="ls iu"> /bin/systemctl </strong>启用并运行它，获得root访问权限！赢了！</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="0252" class="ky kz it bd la lb ni ld le lf nj lh li jz nk ka lk kc nl kd lm kf nm kg lo lp bi translated">使用的工具/命令</h1><h2 id="96e1" class="nz kz it bd la oa ob dn le oc od dp li lz oe of lk md og oh lm mh oi oj lo ok bi translated">Nmap</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/bc71f51e0f86abe1c1f99eae298c3856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EpKUSAdKOCLDsfOO.jpg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae na" href="https://www.linuxadictos.com/" rel="noopener ugc nofollow" target="_blank">Linux瘾君子</a></figcaption></figure><p id="de11" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">Nmap在侦察过程中是如此重要，这个任务只是皮毛。使用的一些选项:</p><p id="f63d" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated"><strong class="ls iu"> -sV </strong>:尝试确定运行<br/> <strong class="ls iu">的服务版本:-p xxx或-p- </strong>:端口扫描端口xxx或扫描所有端口<br/> <strong class="ls iu"> -A: </strong>启用操作系统和版本检测，执行内置脚本以进一步枚举</p><h2 id="868d" class="nz kz it bd la oa ob dn le oc od dp li lz oe of lk md og oh lm mh oi oj lo ok bi translated">GoBuster</h2><p id="ae8b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated"><a class="ae na" href="https://github.com/OJ/gobuster" rel="noopener ugc nofollow" target="_blank"> GoBuster </a>是一款URIs/DNS子域暴力破解工具。它是在Go中开发的，将枚举你给它的主机名，并吐出目录和文件夹。如果有一个预先构建的单词表，效果会更好。实验室中使用的命令是:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="9a23" class="nz kz it on b gy or os l ot ou"><br/> gobuster dir -u http://&lt;ip&gt;:3333 -w &lt;word list location&gt;<br/></span></pre><p id="d079" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">如果你使用Kali Linux，单词列表可以很容易地放在<em class="no"> /usr/share/wordlists </em>下。有人提到<a class="ae na" href="https://github.com/maurosoria/dirsearch" rel="noopener ugc nofollow" target="_blank"> dirsearch </a>在这里是一个可行的替代方案。使用该工具，您可以找到一个<strong class="ls iu">上传</strong>文件夹，您可以将文件上传到网络服务器上。</p><h2 id="50ec" class="nz kz it bd la oa ob dn le oc od dp li lz oe of lk md og oh lm mh oi oj lo ok bi translated">BurpSuit</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/a1f9159b25ea4417b858253b836f7416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uzSdWgeEq6uUKlbM"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片来自<a class="ae na" href="https://portswigger.net/burp" rel="noopener ugc nofollow" target="_blank"> PortSwigger </a></figcaption></figure><p id="b191" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">尝试上传一些文件，你会发现大多数扩展名被阻止。如何进行？进入<a class="ae na" href="https://portswigger.net/burp" rel="noopener ugc nofollow" target="_blank"> BurpSuite </a>，据<a class="ae na" href="https://wiki.archlinux.org/title/Burp_suite" rel="noopener ugc nofollow" target="_blank"> Arch Wiki </a>介绍，它是一个用于执行web应用安全测试的“<em class="no">集成平台。嗯，我们只是用它来拦截一些网络请求，并尝试不同的文件扩展名，看看哪个实际上没有被阻止。<br/>它的主旨是尝试上传一些东西，使用<em class="no"> BurpSuite </em>拦截它，然后用预先加载的各种文件扩展名的单词表(例如<em class="no"> php、php5、phtml </em>等)更改文件扩展名部分。)来测试哪一个实际上可以绕过网络服务器过滤器。<br/>一旦发现(<em class="no"> phtml </em>)，只要上传一个反向shell的PHP脚本并上传到webserver，在浏览器上加载，那么你的监听<strong class="ls iu"> nc -lvnp 1234 </strong>会话就会得到反向shell。</em></p><h2 id="541f" class="nz kz it bd la oa ob dn le oc od dp li lz oe of lk md og oh lm mh oi oj lo ok bi translated">系统ctl</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/62d268765862bc2ac59a58293a6bc9bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*0guHD1M6zpwj5TUHqxH3YA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae na" href="https://brand.systemd.io/" rel="noopener ugc nofollow" target="_blank">https://brand.systemd.io/</a></figcaption></figure><p id="4c7b" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">一旦我们有了反向外壳，最后的事情将是特权升级。一种方法是使用SUID权限搜索可执行文件。我们用<em class="no">查找</em>来完成:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="a6f2" class="nz kz it on b gy or os l ot ou"><br/>find / -user root -perm -4000 -exec ls -ldb {} \;<br/></span></pre><p id="02b9" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">在返回的结果中，<em class="no"> /bin/systemctl </em>脱颖而出。我们可以创建一些服务文件(例如<em class="no"> root.service </em>)并让<em class="no"> systemctl </em>开始获取特权:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="3f6a" class="nz kz it on b gy or os l ot ou">TF=”root.service”<br/>echo ‘[Service]<br/>Type=oneshot<br/>ExecStart=/bin/sh -c “cat /root/root.txt &gt; /tmp/flag.txt”<br/>[Install]<br/>WantedBy=multi-user.target’ &gt; $TF</span></pre><p id="648a" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">注意这里你不能在远程shell中使用像<strong class="ls iu"> vim </strong>或<strong class="ls iu"> nano </strong>这样的文本编辑器，只需echo到文件中即可。不是最理想的，但能完成任务。一旦有了<em class="no"> root.service </em>文件，运行<em class="no"> systemctl </em>来启用/启动它:</p><pre class="kj kk kl km gt om on oo op aw oq bi"><span id="da49" class="nz kz it on b gy or os l ot ou">/bin/systemctl enable /tmp/output/root.service<br/>/bin/systemctl start /tmp/output/root.service</span></pre><p id="d195" class="pw-post-body-paragraph lq lr it ls b lt mv ju lv lw mw jx ly lz mx mb mc md my mf mg mh mz mj mk ml im bi translated">服务正常启动后，一个简单的<em class="no"> cat /temp/flag.txt </em>会给我们想要通过房间的标志。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="906a" class="ky kz it bd la lb ni ld le lf nj lh li jz nk ka lk kc nl kd lm kf nm kg lo lp bi translated">参考</h1><ul class=""><li id="7a3c" class="ox oy it ls b lt lu lw lx lz oz md pa mh pb ml pc pd pe pf bi translated">TryHackMe </li><li id="0e05" class="ox oy it ls b lt pg lw ph lz pi md pj mh pk ml pc pd pe pf bi translated">TryHackMe: Vulnversity </li><li id="72f7" class="ox oy it ls b lt pg lw ph lz pi md pj mh pk ml pc pd pe pf bi translated"><a class="ae na" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank"> nmap </a></li><li id="6d16" class="ox oy it ls b lt pg lw ph lz pi md pj mh pk ml pc pd pe pf bi translated"><a class="ae na" href="https://github.com/OJ/gobuster" rel="noopener ugc nofollow" target="_blank">捉鬼敢死队</a></li><li id="2a1a" class="ox oy it ls b lt pg lw ph lz pi md pj mh pk ml pc pd pe pf bi translated"><a class="ae na" href="https://github.com/maurosoria/dirsearch" rel="noopener ugc nofollow" target="_blank">目录搜索</a></li><li id="c511" class="ox oy it ls b lt pg lw ph lz pi md pj mh pk ml pc pd pe pf bi translated"><a class="ae na" href="https://portswigger.net/burp" rel="noopener ugc nofollow" target="_blank">泡沫塑料</a></li><li id="4742" class="ox oy it ls b lt pg lw ph lz pi md pj mh pk ml pc pd pe pf bi translated"><a class="ae na" href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php" rel="noopener ugc nofollow" target="_blank"> php反向外壳</a></li><li id="6665" class="ox oy it ls b lt pg lw ph lz pi md pj mh pk ml pc pd pe pf bi translated"><a class="ae na" href="https://gtfobins.github.io/gtfobins/systemctl/#suid" rel="noopener ugc nofollow" target="_blank"> SUID escalation </a></li></ul></div></div>    
</body>
</html>