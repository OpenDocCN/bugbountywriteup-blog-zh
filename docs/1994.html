<html>
<head>
<title>Understanding Python 2 Vulnerabilities</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解Python 2漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/python-2-vulnerabilities-c3a3779f6fc?source=collection_archive---------2-----------------------#2022-04-08">https://infosecwriteups.com/python-2-vulnerabilities-c3a3779f6fc?source=collection_archive---------2-----------------------#2022-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/58c04b7975a88f637cc26567bd08877e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EQTZx3EXk64dIp45"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kf" href="https://unsplash.com/@hiteshchoudhary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Hitesh Choudhary </a>拍摄的照片</figcaption></figure><h1 id="9a98" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">简介</strong></h1><p id="efd6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">Python编程基金会已经发表声明，宣布他们已经选择在2020年1月1日让Python2退役，立即生效。</p><p id="9ba3" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">此外，他们表示“如果您需要Python 2软件方面的帮助，许多志愿者会很乐意帮助您，但是随着时间的推移，愿意帮助您的志愿者数量将会减少。”这篇博文将详细探讨原因是什么，安全后果是什么，以及发现和利用了哪些安全缺陷。</p><p id="bf4b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">Python 2.0的最终版本发布于<strong class="lg iu">2000年</strong>10月16日。从那时起，Python编程基金会一直在不断推出更新，添加特性，并对编程语言进行重大更改。2006年，他们推出了Python 3.0，但那时大多数人已经体验了Python 2。许多人没有考虑升级到Python 3.0，所以他们同时使用Python 2和Python 3。</p><p id="e36d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">即使Python2不再得到官方支持，我们也不能忽视这样一个事实，即绝大多数商业应用程序仍然是用Python 2开发的，绝大多数组织没有转用Python3的计划。GitHub上的大多数存储库都是用Python2编写的，而且绝大多数包都适用于Python2。你上一次用pip3代替pip安装自己喜欢的软件包是什么时候？</p><p id="666e" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">截至目前，Python2 和Python3共列出<strong class="lg iu"> 85个漏洞。所有这些漏洞的精选列表可以在<a class="ae kf" href="https://python-security.readthedocs.io/vulnerabilities.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。漏洞是在Python核心和包中发现的。虽然它们中的大多数可能没有公开可用的漏洞，但它非常有利于许多使用易受攻击组件的公司。</strong></p><p id="c791" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在这篇博文中，我们将讨论Python2中的一个漏洞，该漏洞可用于泄露敏感值，并最终导致绕过关键检查。</p><h1 id="b085" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">python 2中的漏洞</strong></h1><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/ed2790553539d5e0bb3ea3b5180065a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9iy3cO3A5me6tTzRsSg8vw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Python2中的漏洞</figcaption></figure><p id="b909" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这里，我们将利用Python2中的<strong class="lg iu"> input() </strong>函数。需要注意的是，这个漏洞只能在Python2中找到。</p><p id="8b08" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">Python2有两种方式接受输入，即<strong class="lg iu"> input() </strong>和<strong class="lg iu"> raw_input() </strong>。<strong class="lg iu"> raw_input() </strong>在Python3中被移除，该功能被赋予Python3中的input()。但是Python2的输入()发生了什么变化呢？</p><p id="833b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们先来了解一下Python2和Python3的区别。</p><p id="38fd" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><strong class="lg iu"> input(): </strong>该函数将按原样接受输入，并且不会修改其类型。</p><p id="ff49" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><strong class="lg iu"> raw_input(): </strong>该函数将接受来自用户的输入，并将其转换为字符串类型，除非另有明确说明。</p><p id="6a8d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在下面的例子中，我创建了一个接受用户输入的Python程序。它首先通过<strong class="lg iu">输入</strong>函数接受输入，然后使用<strong class="lg iu"> raw_input </strong>函数接受输入。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mm"><img src="../Images/1daddaf942f0586fc5326d371963d9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yllyjgHeOKtFNuwYZjC-1A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">两种输入功能的区别</figcaption></figure><p id="bb1b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">从上面的代码片段可以看出，对于相同的整数类型输入，<strong class="lg iu"> raw_input函数</strong>会自动将其转换为字符串类型，而<strong class="lg iu"> input函数</strong>不会显示这种行为，并且函数的数据类型也不会改变。</p><h1 id="ebb5" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">但这是如何成为漏洞的呢？</strong></h1><p id="ed84" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">利用此漏洞，恶意用户可以提供与python程序中定义的变量相同的输入值。这反过来不会被Python2解释器解释为输入，并可能导致认证和其他逻辑绕过。我们通过一个简单的例子来理解这一点。</p><p id="7e39" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><strong class="lg iu">例1 </strong></p><p id="5eda" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">假设我们已经为管理员帐户编写了一个Python脚本。它接收用户提供的密码，然后将其与硬编码的值进行比较。如果值等于“<strong class="lg iu"> 1234abcd </strong>，则只打印“<strong class="lg iu">登录成功</strong></p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mn"><img src="../Images/0428f0092ed23df26c2262383de03867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpI59-mG5M4YBNQ7vTTpuQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">源代码</figcaption></figure><p id="81bc" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我写的片段如上图所示</p><p id="1d3d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">一切看起来都很好，直到您意识到用户无需提供密码就可以登录。用户只需知道保存密码值的<strong class="lg iu">变量</strong>的名称。因此，用户只需提供<em class="mo"> passwd </em>作为输入，因为只有字符串匹配，所以用户将能够登录。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mn"><img src="../Images/90fe3fb675a67d4f4b4ee59233cbd307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q2BxawX4qRggypDsxWKZyQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">利用漏洞</figcaption></figure><p id="9ae2" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><strong class="lg iu">例2 </strong></p><p id="851f" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们可以举的另一个例子是一个简单的python程序，它接受用户的输入，然后将其打印在屏幕上。我们只是使用input()函数来获取用户输入。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/f475fa18f760f7a36dfbba1084c14c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJ917jaQNUcjxfzWI8cbJA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">源代码</figcaption></figure><p id="ae90" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这里，如果您提供2+2作为输入，它将由<strong class="lg iu"> input() </strong>函数执行。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/dca11f68564477431eec0e1cbab0299c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CuW4-Khm4-jvLXvQNitKQg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">利用这个漏洞</figcaption></figure><p id="c686" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><em class="mo">注意:该漏洞不适用于Python3 </em></p><p id="344c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如你所料，这可能是非常有害的，并会产生危险的后果。这可能会导致一些严重的漏洞或拒绝服务，因为用户可能会向他们提供一个很长的字符串，如5666666666666666666666666666 * * 4646，这可能需要大量的时间和资源来处理。</p><p id="6977" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">例如，如果恶意用户导入操作系统模块，他就可以在服务器上执行代码，从而导致远程代码执行。下面提供了其中的一个片段。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/71c9aff686fc77c40b2dce9f4523fbeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*06_5LJNXj5cC4pNqeFaPgg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">代码执行</figcaption></figure><p id="aac0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">从上面的片段可以明显看出，我们已经导入了os模块，它提供了与操作系统交互的功能。</p><p id="399b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这表明input函数(Python2中)不仅接受用户的输入，还执行它。</p><h1 id="fd40" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">结论</strong></h1><p id="6fe4" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">这些只是Python2编程语言中被发现的众多缺陷中的一小部分。尽管目前可能无法使用公共漏洞。但是，已发现漏洞这一事实表明，这些漏洞具有潜在的可利用性。因此，有必要迁移到Python3。将来可能会发现更多的漏洞。由于大量组织仍在Python2上运行，攻击者可能正在挖掘Python2源代码，以便发现和利用漏洞。当风险很高时，攻击者愿意竭尽全力来获得对其目标的优势。</p></div></div>    
</body>
</html>