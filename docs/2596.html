<html>
<head>
<title>Reverse Engineering a Native Desktop Application (Tauri App)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对本机桌面应用程序进行逆向工程(Tauri App)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/reverse-engineering-a-native-desktop-application-tauri-app-5a2d92772da5?source=collection_archive---------2-----------------------#2022-12-05">https://infosecwriteups.com/reverse-engineering-a-native-desktop-application-tauri-app-5a2d92772da5?source=collection_archive---------2-----------------------#2022-12-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4c9c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你可以从中提取一些秘密！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3babd948d28a3badb2377915d1558ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lwh-z5mrp7P3YMaQTwCkdA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Tauri Natives应用</figcaption></figure><blockquote class="kv kw kx"><p id="1530" class="ky kz la lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><strong class="lb ir">备注</strong> : <br/>问候各位读者！在你阅读这篇内容之前，我想提醒你，这是基于我的研究和发现，所以如果你遇到或碰巧看到一个<strong class="lb ir">误导信息</strong>，我很想听听你的意见，我对任何应该正确陈述的信息都非常开放。</p><p id="d96b" class="ky kz la lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">这篇文章是基于我在一个挑战中遇到的，这个挑战是在一个最大的国家CTF中设计的，印尼的Cyber Jawara 2022，它是由一个了不起的问题设定者<a class="lv lw ep" href="https://medium.com/u/3c1ed62c011f?source=post_page-----5a2d92772da5--------------------------------" rel="noopener" target="_blank"> Rendi犹达</a>创建的。该挑战涉及一个名为Tauri App的原生桌面应用程序。我还想对我的团队、快乐三友和所有CJ参与者和利益相关者表示感谢，感谢他们组织了这次令人惊叹的活动。向你们致敬！</p></blockquote></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="7b43" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">背景</h1><p id="109c" class="pw-post-body-paragraph ky kz iq lb b lc mw jr le lf mx ju lh my mz lk ll na nb lo lp nc nd ls lt lu ij bi translated">你以前听说过<a class="ae ne" href="https://tauri.app/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir"> Tauri </strong> </a>吗？你可能以前不知道，因为我们大多数人都知道更多关于<a class="ae ne" href="https://electronjs.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir"> Electron.js </strong> </a>，一个用于构建独立应用程序的框架包装器。这两者是一样的东西，然而这两者之间有一些显著的差异。</p><p id="8d11" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">一般来说，<strong class="lb ir"> Tauri </strong> GitHub页面已经提供了它们的表格视图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/b35fc8559fe14d89ca07c06ef5f3090c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/0*LX14AXeobIbTQTII.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Tauri与Electron.js对比</figcaption></figure><p id="dced" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">如果我们谈论资源消耗，<strong class="lb ir"> Tauri </strong>赢了这场比赛，因为它不依赖<a class="ae ne" href="https://www.chromium.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir">铬</strong> </a>。有许多文章对此进行了更详细的解释，我们不打算在这里进一步讨论。</p><p id="5eb6" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">我们想要实现的是，要了解这个<strong class="lb ir"> Tauri </strong>应用程序的<strong class="lb ir">安全性如何，我们要么从<strong class="lb ir"> Tauri </strong>的预期行为中探索它，要么只是由决定在单个桌面应用程序中迁移其应用程序与Tauri的用户/开发人员发生的错误配置。这可以通过这种方式来完成，因为有时用户可能会“意外地”<strong class="lb ir">降级</strong>内置应用的<strong class="lb ir">安全特性</strong>，因为没有将其方面放在第一位。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/5cf337adb24a4f21278670fc0aa36733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWWK_wtfcOtdNF3PdaFMog.png"/></div></div></figure><p id="c0f9" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">这里涉及到的场景是<strong class="lb ir"> Tauri应用</strong>如何在针对特定操作系统的二进制文件中保护用户/开发人员的资产，尤其是在<strong class="lb ir"> Linux </strong>中。</p><p id="fbda" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">你可以这样想象，我们知道只用<strong class="lb ir"> HTML </strong>、<strong class="lb ir"> CSS </strong>和<strong class="lb ir"> JS </strong>，我们可以创建一个很棒的网站，所以我们也可以尝试将我们的网站提升为一个单一的桌面应用，我们选择<strong class="lb ir"> Tauri </strong>来处理它。然而，作为一名“菜鸟”开发人员，您不小心将您的<strong class="lb ir">硬编码API键</strong>或者甚至是另一个机密数据(如<strong class="lb ir">基于PII的</strong>数据)嵌入到Javascript中，因为它有一个相关的功能。你希望Tauri应用程序保护这些资产吗？让我们开始吧！</p><p id="ef9b" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">作者使用了以下工具来辅助逆向工程过程:</p><ul class=""><li id="24fd" class="nh ni iq lb b lc ld lf lg my nj na nk nc nl lu nm nn no np bi translated"><a class="ae ne" href="https://hex-rays.com/ida-pro/" rel="noopener ugc nofollow" target="_blank"> IDA六角射线</a></li><li id="97f8" class="nh ni iq lb b lc nq lf nr my ns na nt nc nu lu nm nn no np bi translated">GDB ( <a class="ae ne" href="https://github.com/hugsy/gef" rel="noopener ugc nofollow" target="_blank">全球环境基金</a>)</li><li id="1d19" class="nh ni iq lb b lc nq lf nr my ns na nt nc nu lu nm nn no np bi translated">弗里达</li></ul></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="897a" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated"><strong class="ak">“从发展到变革”视角</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/bcc70d62a0c08b4dd73185052076d698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ar5lPdnvMLTQJcb1sM21wQ.png"/></div></div></figure><p id="3723" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">Tauri的后端绑定正在使用一种<strong class="lb ir"> Rust </strong>语言。捆绑应用程序本身总是有一个<strong class="lb ir">核心</strong>进程，它服务于一个<strong class="lb ir"> OEP </strong>(原始入口点)或一个用户/开发者应用程序的<code class="fe nw nx ny nz b">_start</code>。有趣的事实是，这个原生应用程序不需要<strong class="lb ir"> Chromium </strong>来呈现指定的应用程序，但它利用了从<a class="ae ne" href="https://docs.rs/wry/latest/wry/#:~:text=Wry%20is%20a%20Cross%2Dplatform,re%2Dexports%20APIs%20from%20tao." rel="noopener ugc nofollow" target="_blank"> WRY </a>派生的<strong class="lb ir"> WebView库</strong>。这意味着以后所有的HTML、CSS和JS都将加载到<strong class="lb ir"> WebView、</strong>中，就像Android如何使用<strong class="lb ir"> WebView </strong>来加载基于网络的内容一样，因为它包含一个浏览器引擎。</p><p id="0da7" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">为了第一次构建基础应用，<strong class="lb ir"> Tauri </strong>需要知道用户/开发者的类似JSON的配置文件，这就是为什么有一个东西叫做<a class="ae ne" href="https://tauri.app/v1/api/config/" rel="noopener ugc nofollow" target="_blank"><strong class="lb ir">Tauri . conf . JSON</strong></a><strong class="lb ir">。</strong>从<strong class="lb ir"> Tauri </strong> Github示例中可以看出，总体结构可能是这样的，我们将重点关注的是<strong class="lb ir"> build </strong>对象，因为它保存了源代码的位置。我们稍后解释的是，不仅是一个HTML文件将被加载到<strong class="lb ir"> Tauri </strong>上下文，还有一些文件，假设还有一个JS。因此，<strong class="lb ir"> distDir </strong>或<strong class="lb ir"> devPath </strong>可能指向特定的src-tauri目录。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="8b5c" class="oe mf iq nz b be of og l oh oi">{<br/>  "$schema": "../../core/config-schema/schema.json",<br/>  "build": {<br/>    "distDir": ["index.html"],<br/>    "devPath": ["index.html"],<br/>    "beforeDevCommand": "",<br/>    "beforeBuildCommand": ""<br/>  },<br/>  "package": {<br/>    "productName": "The Basic Rookie Dev App",<br/>    "version": "0.1.0"<br/>  },<br/>  "tauri": {<br/>    "bundle": {<br/>      "active": true,<br/>      "targets": "all",<br/>      "identifier": "com.tauri.dev",<br/>      "icon": [<br/>        "../.icons/32x32.png",<br/>        "../.icons/128x128.png",<br/>        "../.icons/128x128@2x.png",<br/>        "../.icons/icon.icns",<br/>        "../.icons/icon.ico"<br/>      ],<br/>      "resources": [],<br/>      "externalBin": [],<br/>      "copyright": "",<br/>      "category": "DeveloperTool",<br/>      "shortDescription": "",<br/>      "longDescription": "",<br/>      "deb": {<br/>        "depends": []<br/>      },<br/>      "macOS": {<br/>        "frameworks": [],<br/>        "exceptionDomain": ""<br/>      }<br/>    },<br/>    "allowlist": {<br/>      "all": false<br/>    },<br/>    "windows": [<br/>      {<br/>        "title": "Aseng was here~!",<br/>        "width": 800,<br/>        "height": 600,<br/>        "resizable": true,<br/>        "fullscreen": false<br/>      }<br/>    ],<br/>    "security": {<br/>      "csp": "default-src 'self'"<br/>    }<br/>  }</span></pre><p id="e20b" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">最后，这个JSON配置文件将被加载和构建，因为来自应用程序的<strong class="lb ir"> main.rs </strong>将处理它并将其传递给上下文生成器和Codegen，稍后作为一个<strong class="lb ir">结构</strong>。下面是主<strong class="lb ir">锈</strong>代码的样本，来自这里的同一个链接<a class="ae ne" href="https://github.com/tauri-apps/tauri/blob/dev/examples/helloworld/main.rs" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="2448" class="oe mf iq nz b be of og l oh oi">#![cfg_attr(<br/>  all(not(debug_assertions), target_os = "windows"),<br/>  windows_subsystem = "windows"<br/>)]<br/><br/>fn main() {<br/>  tauri::Builder::default()<br/>    .run(tauri::generate_context!(<br/>      "../../examples/helloworld/tauri.conf.json"<br/>    ))<br/>    .expect("error while running tauri application");<br/>}</span></pre><p id="495d" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">如果我们看一下来自<a class="ae ne" href="https://github.com/tauri-apps/tauri/blob/dev/core/tauri-codegen/src/context.rs" rel="noopener ugc nofollow" target="_blank">https://github . com/Tauri-apps/Tauri/blob/dev/core/Tauri-codegen/src/context . RS</a>的片段，我们的资产也将从这段代码中处理。我们定义的每个资产都被仔细地从它的扩展中解析出来，然后通过配置对象的数组进行解析。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="e840" class="oe mf iq nz b be of og l oh oi">use tauri_utils::assets::AssetKey;<br/>use tauri_utils::config::{AppUrl, Config, PatternKind, WindowUrl};<br/>use tauri_utils::html::{<br/>  inject_nonce_token, parse as parse_html, serialize_node as serialize_html_node,<br/>};<br/><br/>#[cfg(feature = "shell-scope")]<br/>use tauri_utils::config::{ShellAllowedArg, ShellAllowedArgs, ShellAllowlistScope};<br/><br/>use crate::embedded_assets::{AssetOptions, CspHashes, EmbeddedAssets, EmbeddedAssetsError};<br/><br/>/// Necessary data needed by [`context_codegen`] to generate code for a Tauri application context.<br/>pub struct ContextData {<br/>  pub dev: bool,<br/>  pub config: Config,<br/>  pub config_parent: PathBuf,<br/>  pub root: TokenStream,<br/>}<br/><br/>fn map_core_assets(<br/>  options: &amp;AssetOptions,<br/>  target: Target,<br/>) -&gt; impl Fn(&amp;AssetKey, &amp;Path, &amp;mut Vec&lt;u8&gt;, &amp;mut CspHashes) -&gt; Result&lt;(), EmbeddedAssetsError&gt; {<br/>  #[cfg(feature = "isolation")]<br/>  let pattern = tauri_utils::html::PatternObject::from(&amp;options.pattern);<br/>  let csp = options.csp;<br/>  let dangerous_disable_asset_csp_modification =<br/>    options.dangerous_disable_asset_csp_modification.clone();<br/>  move |key, path, input, csp_hashes| {<br/>    if path.extension() == Some(OsStr::new("html")) {<br/>      #[allow(clippy::collapsible_if)]<br/>      if csp {<br/>        let mut document = parse_html(String::from_utf8_lossy(input).into_owned());<br/><br/>        if target == Target::Linux {<br/>          ::tauri_utils::html::inject_csp_token(&amp;mut document);<br/>        }<br/><br/>        inject_nonce_token(&amp;mut document, &amp;dangerous_disable_asset_csp_modification);<br/><br/>        if dangerous_disable_asset_csp_modification.can_modify("script-src") {<br/>          if let Ok(inline_script_elements) = document.select("script:not(empty)") {<br/>            let mut scripts = Vec::new();<br/>            for inline_script_el in inline_script_elements {<br/>              let script = inline_script_el.as_node().text_contents();<br/>              let mut hasher = Sha256::new();<br/>              hasher.update(&amp;script);<br/>              let hash = hasher.finalize();<br/>              scripts.push(format!("'sha256-{}'", base64::encode(hash)));<br/>            }<br/>            csp_hashes<br/>              .inline_scripts<br/>              .entry(key.clone().into())<br/>              .or_default()<br/>              .append(&amp;mut scripts);<br/>          }<br/>        }<br/><br/>        #[cfg(feature = "isolation")]<br/>        if dangerous_disable_asset_csp_modification.can_modify("style-src") {<br/>          if let tauri_utils::html::PatternObject::Isolation { .. } = &amp;pattern {<br/>            // create the csp for the isolation iframe styling now, to make the runtime less complex<br/>            let mut hasher = Sha256::new();<br/>            hasher.update(tauri_utils::pattern::isolation::IFRAME_STYLE);<br/>            let hash = hasher.finalize();<br/>            csp_hashes<br/>              .styles<br/>              .push(format!("'sha256-{}'", base64::encode(hash)));<br/>          }<br/>        }<br/><br/>        *input = serialize_html_node(&amp;document);<br/>      }<br/>    }<br/>    Ok(())<br/>  }<br/>}<br/><br/>//.... [SNIP] .......<br/> <br/>let app_url = if dev {<br/>    &amp;config.build.dev_path<br/>  } else {<br/>    &amp;config.build.dist_dir<br/>  };<br/><br/>  let assets = match app_url {<br/>    AppUrl::Url(url) =&gt; match url {<br/>      WindowUrl::External(_) =&gt; Default::default(),<br/>      WindowUrl::App(path) =&gt; {<br/>        if path.components().count() == 0 {<br/>          panic!(<br/>            "The `{}` configuration cannot be empty",<br/>            if dev { "devPath" } else { "distDir" }<br/>          )<br/>        }<br/>        let assets_path = config_parent.join(path);<br/>        if !assets_path.exists() {<br/>          panic!(<br/>            "The `{}` configuration is set to `{:?}` but this path doesn't exist",<br/>            if dev { "devPath" } else { "distDir" },<br/>            path<br/>          )<br/>        }<br/>        EmbeddedAssets::new(assets_path, &amp;options, map_core_assets(&amp;options, target))?<br/>      }<br/>      _ =&gt; unimplemented!(),<br/>    },<br/>    AppUrl::Files(files) =&gt; EmbeddedAssets::new(<br/>      files<br/>        .iter()<br/>        .map(|p| config_parent.join(p))<br/>        .collect::&lt;Vec&lt;_&gt;&gt;(),<br/>      &amp;options,<br/>      map_core_assets(&amp;options, target),<br/>    )?,<br/>    _ =&gt; unimplemented!(),<br/>  };<br/><br/>// .....  [SNIP] ......</span></pre><p id="cd6a" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">稍后，问题来了。</p><blockquote class="oj"><p id="4b9b" class="ok ol iq bd om on oo op oq or os lu dk translated">我们对Tauri App 如何保护我们的资产感兴趣。它们是<strong class="ak">加密的</strong>吗？它们是否以与转换过程不同的格式存储？它们<strong class="ak">存储</strong>在一个Tauri专用云存储中吗？或者它们被存储在一个<strong class="ak">纯文本</strong>中从而不受保护？</p></blockquote><p id="8108" class="pw-post-body-paragraph ky kz iq lb b lc ot jr le lf ou ju lh my ov lk ll na ow lo lp nc ox ls lt lu ij bi translated">看了这些片段之后，我们知道有一个对处理我们主要资产的<code class="fe nw nx ny nz b">tauri_utils</code>的引用，这就是事情变得有趣的地方。让我们来看看下面的片段，它摘自<a class="ae ne" href="https://github.com/tauri-apps/tauri/blob/dev/core/tauri-utils/src/assets.rs" rel="noopener ugc nofollow" target="_blank">https://Github . com/Tauri-apps/Tauri/blob/dev/core/Tauri-utils/src/assets . RS</a>上的官方<strong class="lb ir"> Tauri </strong> Github</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="351c" class="oe mf iq nz b be of og l oh oi">/// Represents a container of file assets that are retrievable during runtime.<br/>pub trait Assets: Send + Sync + 'static {<br/>  /// Get the content of the passed [`AssetKey`].<br/>  fn get(&amp;self, key: &amp;AssetKey) -&gt; Option&lt;Cow&lt;'_, [u8]&gt;&gt;;<br/><br/>  /// Gets the hashes for the CSP tag of the HTML on the given path.<br/>  fn csp_hashes(&amp;self, html_path: &amp;AssetKey) -&gt; Box&lt;dyn Iterator&lt;Item = CspHash&lt;'_&gt;&gt; + '_&gt;;<br/>}<br/><br/>/// [`Assets`] implementation that only contains compile-time compressed and embedded assets.<br/>#[derive(Debug)]<br/>pub struct EmbeddedAssets {<br/>  assets: phf::Map&lt;&amp;'static str, &amp;'static [u8]&gt;,<br/>  // Hashes that must be injected to the CSP of every HTML file.<br/>  global_hashes: &amp;'static [CspHash&lt;'static&gt;],<br/>  // Hashes that are associated to the CSP of the HTML file identified by the map key (the HTML asset key).<br/>  html_hashes: phf::Map&lt;&amp;'static str, &amp;'static [CspHash&lt;'static&gt;]&gt;,<br/>}<br/><br/>impl EmbeddedAssets {<br/>  /// Creates a new instance from the given asset map and script hash list.<br/>  pub const fn new(<br/>    map: phf::Map&lt;&amp;'static str, &amp;'static [u8]&gt;,<br/>    global_hashes: &amp;'static [CspHash&lt;'static&gt;],<br/>    html_hashes: phf::Map&lt;&amp;'static str, &amp;'static [CspHash&lt;'static&gt;]&gt;,<br/>  ) -&gt; Self {<br/>    Self {<br/>      assets: map,<br/>      global_hashes,<br/>      html_hashes,<br/>    }<br/>  }<br/>}<br/><br/>impl Assets for EmbeddedAssets {<br/>  #[cfg(feature = "compression")]<br/>  fn get(&amp;self, key: &amp;AssetKey) -&gt; Option&lt;Cow&lt;'_, [u8]&gt;&gt; {<br/>    self<br/>      .assets<br/>      .get(key.as_ref())<br/>      .map(|&amp;(mut asdf)| {<br/>        // with the exception of extremely small files, output should usually be<br/>        // at least as large as the compressed version.<br/>        let mut buf = Vec::with_capacity(asdf.len());<br/>        brotli::BrotliDecompress(&amp;mut asdf, &amp;mut buf).map(|()| buf)<br/>      })<br/>      .and_then(Result::ok)<br/>      .map(Cow::Owned)<br/>  }<br/><br/>  #[cfg(not(feature = "compression"))]<br/>  fn get(&amp;self, key: &amp;AssetKey) -&gt; Option&lt;Cow&lt;'_, [u8]&gt;&gt; {<br/>    self<br/>      .assets<br/>      .get(key.as_ref())<br/>      .copied()<br/>      .map(|a| Cow::Owned(a.to_vec()))<br/>  }</span></pre><p id="4be4" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">当你读到这些片段时，你的第一反应是什么？虽然特定的资产被用一些哈希验证、随机ID和其他东西标记为“T0”，但我们的资产并没有被加密，然而我们的资产只是使用无损数据压缩系统<a class="ae ne" href="https://github.com/google/brotli" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir"> Brotli </strong> </a>进行了<strong class="lb ir">压缩。根据这份官方陶日文件-&gt;<a class="ae ne" href="https://tauri.app/v1/guides/building/app-size/" rel="noopener ugc nofollow" target="_blank"/>【https://tauri.app/v1/guides/building/app-size/】的引用，我们需要注意这部分内容:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/df4caa0c6da164fc0eb8051c65818123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_wTeHOh1J_UEbvMm-IS-w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Tauri资产压缩功能</figcaption></figure><p id="1d13" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">原来<strong class="lb ir"> Brotli压缩</strong>实际上是默认启用的，但不知何故用户也有能力<strong class="lb ir">禁用</strong>这个功能，因为这被认为是一个优先选项。另一件我们需要注意的事情是从安全文档本身来说的(<a class="ae ne" href="https://tauri.app/v1/references/architecture/security/" rel="noopener ugc nofollow" target="_blank">https://tauri.app/v1/references/architecture/security/</a>)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/5ab394ee1b2222be39e9adcce54c05ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GhYEDlHvbNvlmwa0ecj9WQ.png"/></div></div></figure><p id="025a" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">有一些CSP注入作为来自上下文生成器和Codegen的初始设置和处理，最后一点使挑战变得更加困难，因为我们不能轻松地反编译本机桌面应用程序二进制文件。</p><p id="ce65" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">关于文档中提到的<strong class="lb ir"> ASAR </strong>文件参考的一些快速注释实际上只是一个简单的tar-archive文件格式，并且<strong class="lb ir">解包器</strong>已经存在，参考这个<a class="ae ne" href="https://stackoverflow.com/questions/38523617/how-to-unpack-an-asar-file" rel="noopener ugc nofollow" target="_blank">回答</a>。<strong class="lb ir"> ASAR </strong>文件本身也可以从静态分析中检索，甚至可以使用用于取证目的的著名文件切割工具，如<a class="ae ne" href="https://www.kali.org/tools/binwalk/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir"> binwalk </strong> </a>，然而在<strong class="lb ir"> Tauri App </strong>的情况下，这并不那么容易，因为<strong class="lb ir">所有的资产</strong>都是在<strong class="lb ir">运行时完全加载的。</strong>这意味着压缩和解压缩机制也将在<strong class="lb ir">运行时</strong>完成。这个问题的最终解决方案是什么？由于资产处理是在运行时完成的，我们也将在运行时调试应用程序，因此我们将结合使用<strong class="lb ir">静态</strong>和<strong class="lb ir">动态</strong>分析。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="ab35" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">投入挑战</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/21391ffe8283cfeb4882bf311af81f00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4aPYIT7iskbfQhXpTsgOag.png"/></div></div></figure><p id="6067" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">我们已经知道了<em class="la">Tauri应用如何工作的背景故事</em>，所以我们现在将更多地关注挑战。给定一个<strong class="lb ir"> Linux二进制文件</strong>，它是从一个简单的网站验证程序的实际项目中派生出来的，这个场景与作者之前所说的一样，被包装在一个单一的桌面应用程序中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/847b6df2a7db84ab86550c963bc061bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7ZUyec-84VGSO3N-TBlqrw.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Tauri应用二进制</figcaption></figure><p id="42f8" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">这项挑战的目标非常简单，因为有一个特殊的页面提示用户输入密码进行验证，从而将应用程序升级到<strong class="lb ir"> pro </strong>版本。为了理解应用程序背后的逻辑，我们需要知道输入是如何传递和验证的，这意味着我们必须<strong class="lb ir">泄露</strong>Tauri应用程序的源代码，或者来自创建者本身的<strong class="lb ir">原始资产</strong>。</p><p id="c78b" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">让我们来看看静态分析会有什么帮助，我们将使用IDA来反编译<strong class="lb ir"> Rust </strong>二进制文件。Rust本身有时会成为反编译器的噩梦，因为这种语言似乎有类似于被破坏的函数名，就像C++是如何解释的一样。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="9c5a" class="oe mf iq nz b be of og l oh oi">// ... [SNIP] ...<br/>do<br/>  {<br/>    v21 = v20 + 1;<br/>    if ( v20 == -1 )<br/>      std::thread::ThreadId::new::exhausted::h8b15b09161259129();<br/>    v22 = v20;<br/>    v20 = _InterlockedCompareExchange64(&amp;std::thread::ThreadId::new::COUNTER::h3a05da468aebc0a6, v21, v20);<br/>  }<br/>  while ( v22 != v20 );<br/>  v19[4] = (void *)v21;<br/>  *((_DWORD *)v19 + 10) = 0;<br/>  fds.sa_handler = v12;<br/>  fds.sa_mask.__val[0] = v3;<br/>  fds.sa_mask.__val[1] = v4;<br/>  std::sys_common::thread_info::set::hd2260a9241afaa5b();<br/>  std::sys_common::backtrace::__rust_begin_short_backtrace::h9567a838cd73883d(&amp;helloworld::main::hf56bc84460f29d43);<br/>  if ( std::rt::cleanup::CLEANUP::h49cafe1e845be7b2 != 3 )<br/>  {<br/>    LOBYTE(v25) = 1;<br/>    fds.sa_handler = (__sighandler_t)&amp;v25;<br/>    std::sync::once::Once::call_inner::he7c95df8c763a30d();<br/>  }<br/><br/>// ... [SNIP] ...</span></pre><p id="a8c5" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">这就是应用程序入口点的预处理程序是如何启动的，它使用一个信号处理程序作为IPC或进程间通信机制来调用<code class="fe nw nx ny nz b">helloworld::main::&lt;somehash&gt;</code>。如果我们按照它的CF/控制流向函数，我们会注意到前面讨论过的一些东西。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="bdbd" class="oe mf iq nz b be of og l oh oi">qmemcpy(v7, "flag-viewer", 11);<br/>  v10 = alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(5uLL);<br/>  v12 = v11;<br/>  *(_DWORD *)v10 = 774975024;<br/>  *(_BYTE *)(v10 + 4) = 48;<br/>  v13 = _rust_alloc(0x138uLL, 8uLL);<br/>  if ( !v13 )<br/>    goto LABEL_25;<br/>  v14 = v13;<br/>  v131 = v2;<br/>  v132 = v12;<br/>  v133 = v10;<br/>  v134 = v7;<br/>  *(_QWORD *)v250 = alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(4uLL);<br/>  *(_QWORD *)&amp;v250[8] = v15;<br/>  **(_DWORD **)v250 = 1852399981;<br/>  *(_QWORD *)&amp;v250[16] = 4LL;<br/>  std::sys::unix::os_str::Slice::to_owned::hafd5ea8305043fe1();<br/>  v16 = (void *)alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(0xBuLL);<br/>  qmemcpy(v16, "Flag Viewer", 11);<br/>  qmemcpy((void *)v14, v250, 0x40uLL);<br/>  *(_DWORD *)(v14 + 64) = *(_DWORD *)&amp;v250[64];<br/>  *(_DWORD *)(v14 + 68) = 2;<br/>  *(_QWORD *)(v14 + 112) = 0LL;<br/>  *(_QWORD *)(v14 + 136) = 0LL;<br/>  *(_QWORD *)(v14 + 152) = 0LL;<br/>  *(_QWORD *)(v14 + 168) = 0x4089000000000000LL;<br/>  *(_QWORD *)(v14 + 176) = 0x4082C00000000000LL;<br/>  *(_QWORD *)(v14 + 184) = 0LL;<br/>  *(_QWORD *)(v14 + 200) = 0LL;<br/>  *(_QWORD *)(v14 + 216) = 0LL;<br/>  *(_QWORD *)(v14 + 232) = 0LL;<br/>  *(_QWORD *)(v14 + 248) = v16;<br/>  *(_QWORD *)(v14 + 256) = v17;<br/>  *(_QWORD *)(v14 + 264) = 11LL;<br/>  *(_QWORD *)(v14 + 272) = 0LL;<br/>  *(_QWORD *)(v14 + 296) = 0x100000100010001LL;<br/>  *(_DWORD *)(v14 + 304) = 33554433;<br/>  *(_WORD *)(v14 + 308) = 0;<br/>  v135 = v14;<br/>  *(_BYTE *)(v14 + 310) = 0;<br/>  v18 = (void *)alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(0xDuLL);<br/>  v129 = v19;<br/>  qmemcpy(v18, "com.tauri.dev", 13);<br/>  v130 = v18;<br/>  v20 = _rust_alloc(0x78uLL, 8uLL);<br/>  if ( !v20 )<br/>    goto LABEL_25;<br/>  v21 = (_QWORD *)v20;<br/>  v22 = alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(0x13uLL);<br/>  v84 = v23;<br/>  *(_OWORD *)v22 = *(_OWORD *)"../.icons/32x32.png../.icons/128x128.png../.icons/128x128@2x.png../.icons/icon.icns../.icons/icon.icodefault-src 'self'public";<br/>  *(_DWORD *)(v22 + 15) = 1735290926;<br/>  v24 = alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(0x15uLL);<br/>  v82 = v25;<br/>  *(_QWORD *)(v24 + 13) = 0x676E702E38323178LL;<br/>  *(_OWORD *)v24 = *(_OWORD *)"../.icons/128x128.png../.icons/128x128@2x.png../.icons/icon.icns../.icons/icon.icodefault-src 'self'public";<br/>  v26 = alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(0x18uLL);<br/>  v80 = v27;<br/>  *(_QWORD *)(v26 + 16) = 0x676E702E78324038LL;<br/>  *(_OWORD *)v26 = *(_OWORD *)"../.icons/128x128@2x.png../.icons/icon.icns../.icons/icon.icodefault-src 'self'public";<br/>  v28 = alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(0x13uLL);<br/>  v79 = v29;<br/>  *(_OWORD *)v28 = *(_OWORD *)"../.icons/icon.icns../.icons/icon.icodefault-src 'self'public";<br/>  *(_DWORD *)(v28 + 15) = 1936614249;<br/>  v30 = alloc::raw_vec::RawVec$LT$T$C$A$GT$::allocate_in::h0ef84f43d0508836(0x12uLL);<br/>  v21[12] = v30;<br/>  v21[13] = v31;<br/>  *(_OWORD *)v30 = *(_OWORD *)"../.icons/icon.icodefault-src 'self'public";<br/>  *(_WORD *)(v30 + 16) = 28515;</span></pre><p id="a7d8" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">从这个函数中我们可以解读出什么？如果您忘记了这些字符串指示，您可能想要向上滚动，这些字符串是从前面的<strong class="lb ir"> tauri.conf.json </strong>中派生出来的。看起来有一个加载这些<strong class="lb ir">数组对象</strong>的过程，因为有许多函数需要从单个源复制到目的地的能力(在结构、向量和数组的上下文中)。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="4935" class="oe mf iq nz b be of og l oh oi">v431 = "Tauri Programme within The Commons ConservancyMake tiny, secure apps for all desktop platforms with Taurierror "<br/>         "while running tauri application";<br/>  v432 = 46LL;<br/>  v433 = "Make tiny, secure apps for all desktop platforms with Taurierror while running tauri application";<br/>  v434 = 59LL;<br/>  ((void (__fastcall *)(_BYTE *, _BYTE *, _BYTE *))tauri::app::Builder$LT$R$GT$::build::h7c64c955f54959e3)(<br/>    v246,<br/>    v238,<br/>    v250);<br/>  memcpy(v225, &amp;v246[1], 0x5FuLL);<br/>  if ( v247 != 3 )<br/>  {<br/>    memcpy(&amp;v250[96], &amp;v246[96], 0x90uLL);<br/>    qmemcpy(&amp;v250[248], v248, 0x68uLL);<br/>    v250[0] = v246[0];<br/>    memcpy(&amp;v250[1], v225, 0x5FuLL);<br/>    *(_QWORD *)&amp;v250[240] = v247;<br/>    ((void (__fastcall *)(__m256i *, _BYTE *))_$LT$tauri..app..AppHandle$LT$R$GT$$u20$as$u20$core..clone..Clone$GT$::clone::h22f9c9fdb5774633)(<br/>      v236,<br/>      &amp;v250[224]);<br/>    v59 = *(_QWORD *)&amp;v250[216];<br/>    v60 = _InterlockedIncrement64(*(volatile signed __int64 **)&amp;v250[216]);<br/>    if ( !((v60 &lt; 0) ^ v61 | (v60 == 0)) )<br/>    {<br/>      if ( *(_QWORD *)&amp;v250[16] == 3LL )<br/>        core::panicking::panic::hf0565452d0d0936c();<br/>      *(_OWORD *)v238 = *(_OWORD *)v250;<br/>      *(_QWORD *)&amp;v238[16] = *(_QWORD *)&amp;v250[16];<br/>      memcpy(&amp;v238[24], &amp;v250[24], 0xC0uLL);<br/>      v62 = *(_QWORD *)&amp;v238[88];<br/>      v63 = _InterlockedIncrement64(*(volatile signed __int64 **)&amp;v238[88]);<br/>      if ( !((v63 &lt; 0) ^ v61 | (v63 == 0)) )<br/>      {<br/>        v64 = *(_QWORD *)v238;<br/>        v65 = _InterlockedIncrement64(*(volatile signed __int64 **)v238);<br/>        if ( !((v65 &lt; 0) ^ v61 | (v65 == 0)) )<br/>        {<br/>          v66 = *(_QWORD *)&amp;v238[80];<br/>          v67 = ((__int64 (__fastcall *)(_BYTE *))tao::event_loop::EventLoop$LT$T$GT$::create_proxy::h6f86f7baa55289ee)(&amp;v238[120]);<br/>          qmemcpy(v226, &amp;v238[120], sizeof(v226));<br/>          *(_QWORD *)&amp;v246[16] = *(_QWORD *)&amp;v238[112];<br/>          *(_OWORD *)v246 = *(_OWORD *)&amp;v238[96];<br/>          *(_QWORD *)&amp;v246[24] = v67;<br/>          *(_QWORD *)&amp;v246[32] = v68;<br/>          qmemcpy(&amp;v246[40], v236, 0x80uLL);<br/>          *(_QWORD *)&amp;v246[168] = v59;<br/>          *(_QWORD *)&amp;v246[176] = v64;<br/>          *(_QWORD *)&amp;v246[184] = v62;<br/>          *(_QWORD *)&amp;v246[192] = v66;<br/>          ((void (__fastcall __noreturn *)(__m256i *, _BYTE *))tao::event_loop::EventLoop$LT$T$GT$::run::h9b4fce1a6961520f)(<br/>            v226,<br/>            v246);<br/>        }<br/>      }<br/>    }<br/>    BUG();<br/>  }<br/>  memcpy(v238, v225, 0x5FuLL);<br/>  if ( v246[0] != 28 )<br/>  {<br/>    v250[0] = v246[0];<br/>    memcpy(&amp;v250[1], v238, 0x5FuLL);<br/>LABEL_31:<br/>    core::result::unwrap_failed::hfaddf24b248137d3();<br/>  }<br/>  if ( v120 )<br/>    free(v119);<br/>  ((void (__fastcall *)(__int64 *))core::ptr::drop_in_place$LT$tauri_utils..config..FsAllowlistScope$GT$::h59f25386f9484a44)(&amp;v174);<br/>  v54 = (void *)v180;<br/>  ((void (__fastcall *)(__int64, __int64))_$LT$alloc..vec..Vec$LT$T$C$A$GT$$u20$as$u20$core..ops..drop..Drop$GT$::drop::h7a5477a2103cf4a6)(<br/>    v180,<br/>    v181.m256i_i64[1]);<br/>  if ( v181.m256i_i64[0] )<br/>    free(v54);<br/>  if ( v181.m256i_i64[2] &amp;&amp; v181.m256i_i64[3] )<br/>    free((void *)v181.m256i_i64[2]);<br/>  v55 = (char *)v184;<br/>  if ( *((_QWORD *)&amp;v185 + 1) )<br/>  {<br/>    v56 = 88LL * *((_QWORD *)&amp;v185 + 1);<br/>    v57 = 0LL;<br/>    do<br/>    {<br/>      if ( *(_QWORD *)&amp;v55[v57 + 8] )<br/>        free(*(void **)&amp;v55[v57]);<br/>      v57 += 88LL;<br/>    }<br/>    while ( v56 != v57 );<br/>  }<br/>  if ( (_QWORD)v185 )<br/>    free(v55);<br/>  ((void (__fastcall *)(__int64 *))core::ptr::drop_in_place$LT$tauri_utils..config..FsAllowlistScope$GT$::h59f25386f9484a44)(&amp;v187);<br/>  ((void (__fastcall *)(__int64, _QWORD))_$LT$alloc..vec..Vec$LT$T$C$A$GT$$u20$as$u20$core..ops..drop..Drop$GT$::drop::h7a5477a2103cf4a6)(<br/>    8LL,<br/>    0LL);<br/>  ((void (__fastcall *)(__int64 *))core::ptr::drop_in_place$LT$tauri_utils..config..FsAllowlistScope$GT$::h59f25386f9484a44)(&amp;v232);<br/>  return ((__int64 (__fastcall *)(__int64 *))core::ptr::drop_in_place$LT$tauri_utils..config..FsAllowlistScope$GT$::h59f25386f9484a44)(&amp;v227);<br/>}</span></pre><p id="3ffa" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">最后，调用<strong class="lb ir"> Tauri </strong>构建器，这是二进制本地应用程序的根或基础。在控制流执行期间，会调用许多分支。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/31b3ae6562adbf7645fe0e51574cf445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W_vvUVnJG2oO1-U510-jLQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Tauri应用程序构建器控制流外部参考</figcaption></figure><p id="3afb" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">这可能会令人困惑，而且要花很多时间才能弄清楚每个函数的行为。作者注意到检查资产位置<strong class="lb ir">可能是有利的，而不必遍历所有那些函数</strong>。我们将采用两种可选的方法来提取和泄漏源代码。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="fbf1" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">解构者的艺术</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/348dd5685c85f13c729f1e241f6c54d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51qf8lwItp-He5vNDQhSLw.png"/></div></div></figure><p id="31dc" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">你听说过一个构造函数。ctor)或解构者(。dtor)工作？如果你对<strong class="lb ir"> Rust </strong>更感兴趣，你可能想看看这个<a class="ae ne" href="https://crates.io/crates/static_init/0.1.3" rel="noopener ugc nofollow" target="_blank">板条箱</a>，但是由于作者更有能力用C语言解释它，我们将在下面举一个例子。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="47cf" class="oe mf iq nz b be of og l oh oi">#include &lt;stdio.h&gt;<br/>void pre_main() __attribute__((constructor));<br/>void post_main() __attribute__((destructor));<br/><br/>void pre_main() {<br/>   puts("Yup I'm called before the main() function");<br/>}<br/><br/>void post_main() {<br/>   puts("Eh? I'm called after all the main() is completed! No matter how many iterations ~");<br/>}<br/><br/>int main() {<br/>   puts("Hello seng.");  <br/>   return 0;<br/>}</span></pre><p id="2754" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">解释这个概念很简单，<strong class="lb ir">构造函数</strong>负责在主函数被调用之前执行某些东西，但另一方面，<strong class="lb ir">析构函数</strong>负责在主函数被完成或调用之后执行某些命令。</p><p id="f978" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">这两个函数在低层是如何工作的？有一个来自<a class="ae ne" href="https://www.exploit-db.com/papers/13234" rel="noopener ugc nofollow" target="_blank">https://www.exploit-db.com/papers/13234</a>的很好的解释，因为我也喜欢隐藏一个系统调用，比如滥用这两个来隐藏某个函数调用或系统调用，它具有反逆向工程方法论的能力。请注意这几行:</p><blockquote class="kv kw kx"><p id="735a" class="ky kz la lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">研究glibc初始化代码表明' __libc_csu_fini '和' __libc_csu_init '函数在启动流中有特殊的用途。<br/>“_ _ libc _ CSU _ init”充当构造函数。这个任务将在真正的程序之前被调用，在我们的例子中是main()函数。<br/>是放置程序相关初始化代码的理想位置。“__libc_csu_fini”函数充当析构函数。它的工作是<br/>作为最后一个函数被调用，从而确保程序没有留下任何东西，并且干净利落地退出。</p><p id="7da2" class="ky kz la lb b lc ld jr le lf lg ju lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">在共享库编程中，程序员有两个函数' _init '和' _fini '，它们是共享库构造函数和<br/>析构函数。我们的可执行文件也有这两个功能。只是在我们的情况下，它们是整合机制的一部分。</p></blockquote><p id="55ae" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">总结一下，析构函数(。dtor)与Tauri二进制应用程序？我们知道有几个库链接并导入到二进制文件本身。可能在这些库中，有一个可能包含这些属性，因此我们注意到这些<strong class="lb ir">在最后导出了</strong>函数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/417c928fff6821d5d59af109fa2f6073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pTCfhdx252MNkYuHXzM4qQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Tauri应用程序二进制导出</figcaption></figure><p id="c074" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">虽然在_init构造函数中只有一个指针，但是在_fini析构函数中没有<strong class="lb ir"> none </strong>，流程<strong class="lb ir">保持不变</strong>。析构函数总是在main及其外部引用分支中的所有功能被调用后被调用。</p><p id="ffcd" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">由于<strong class="lb ir"> Tauri App </strong>在<strong class="lb ir">运行时加载用户/开发者的资产，</strong>有一个类似的概念，就像Android如何准备其<strong class="lb ir"> MainActivity </strong>完成，这就是这个想法的来源。为什么我们不在<strong class="lb ir"> _fini析构函数</strong>上设置一个断点，这样在所有那些<strong class="lb ir">资产</strong>被加载之后，有<strong class="lb ir">的概率</strong>在<strong class="lb ir">堆内存区域中<strong class="lb ir">资产</strong>仍然可用，这就是所谓的“雕刻内存”。</strong></p><p id="a936" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">我们将根据挑战的预期行为使用字符串指示。我们知道在发布版本中，作者的名字"<strong class="lb ir"> vidner </strong>"是以HTML静态格式弹出的，所以我们可以使用<code class="fe nw nx ny nz b">search-pattern</code>的<strong class="lb ir"> GEF GDB </strong>特性(也称为<code class="fe nw nx ny nz b">grep</code>别名)来实现。我们还应该重新设置地址，因为它支持PIE。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/ce4533da55ef37c6e25fdd519449f944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u0G61WZX_UgJtG05jka1cA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">GDB调试</figcaption></figure><p id="1c6d" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">让我们尝试grep "<strong class="lb ir">vid ner</strong>"字符串，看看它是否能成功找到HTML指示。我们将在GEF中使用“<strong class="lb ir">搜索模式</strong>”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/b6962f42fa5292b1be87361f789d31f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ira03l7GGDLrvBYb8ne3HQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">堆内存中的Vidner字符串指示</figcaption></figure><p id="53f6" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">我们成功地找到了指示，下一步我们将使用GDB功能将地址偏移量中的某个值作为字符串打印出来<code class="fe nw nx ny nz b">x/s</code></p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="054f" class="oe mf iq nz b be of og l oh oi">gef➤  x/10s 0x5555559c7289-200<br/>0x5555559c71c1: "a\322UUU"<br/>0x5555559c71c7: ""<br/>0x5555559c71c8: "\360a\322UUU"<br/>0x5555559c71cf: ""<br/>0x5555559c71d0: "&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta content=\"ie=edge\" http-equiv=\"X-UA-Compatible\"&gt;\n    &lt;meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"&gt;\n    &lt;meta content=\"vidner\" name=\"author\"&gt;\n    &lt;title&gt;Flag Viewer&lt;/title&gt;\n    &lt;link href=\"https://fonts.gstatic.com\" rel=\"preconnect\"&gt;\n    &lt;link href=\"https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;amp;display=swap\" rel=\"stylesheet\"&gt;\n    &lt;link href=\"./css/styles.css\" rel=\"stylesheet\"&gt;\n  &lt;meta content=\"script-src 'self' 'sha256-LiAOJW+SxhRQ1D3FA8oo/AjCouFSGU4xYS5EfRdWEx4=' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU='; default-src 'self'\" http-equiv=\"Content-Security-Policy\"&gt;&lt;/head&gt;\n  &lt;body&gt;\n    &lt;header&gt;\n      &lt;div class=\"logo\"&gt;\n        &lt;img alt=\"logo\" src=\"./images/logo.svg\"&gt;\n      &lt;/div&gt;\n      &lt;button class=\"btn\"&gt;\n        &lt;img alt=\"About\" src=\"./images/icon-hamburger.svg\"&gt;\n      &lt;/button&gt;\n    &lt;/header&gt;\n    &lt;main&gt;\n      &lt;button id=\"prev\"&gt;&amp;lt;&lt;/button&gt;\n      &lt;div class=\"card-container\"&gt;&lt;/div&gt;\n      &lt;button id=\"next\"&gt;&amp;gt;&lt;/button&gt;\n      &lt;div class=\"about\"&gt;\n        &lt;h1&gt;About&lt;/h1&gt;\n        &lt;p id=\"changeme\"&gt;This is a release build, have fun with it.&lt;/p&gt;\n        &lt;h2&gt;- vidner&lt;/h2&gt;\n        &lt;div&gt;\n          &lt;h3 id=\"message\"&gt;Upgrade&lt;/h3&gt;\n          &lt;br&gt;\n          &lt;input id=\"key\" name=\"key\" placeholder=\"password-that-you-guys-need-to-have\" type=\"text\"&gt;\n          &lt;button id=\"upgrade\" name=\"upgrade\"&gt;⬆&lt;/button&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    &lt;/main&gt;\n    &lt;script src=\"./js/scripts.js\"&gt;&lt;/script&gt;\n  \n\n&lt;/body&gt;&lt;/html&gt;U"</span></pre><pre class="ph oa nz ob bn oc od bi"><span id="126e" class="oe mf iq nz b be of og l oh oi">&lt;head&gt;<br/> &lt;meta charset=\ "UTF-8\"&gt;<br/> &lt;meta content=\ "ie=edge\" http-equiv=\ "X-UA-Compatible\"&gt;<br/> &lt;meta content=\ "width=device-width, initial-scale=1.0\" name=\ "viewport\"&gt;<br/> &lt;meta content=\ "vidner\" name=\ "author\"&gt;<br/> &lt;title&gt;Flag Viewer&lt;/title&gt;<br/> &lt;link href=\ "https://fonts.gstatic.com\" rel=\ "preconnect\"&gt;<br/> &lt;link href=\ "https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;amp;display=swap\" rel=\ "stylesheet\"&gt;<br/> &lt;link href=\ "./css/styles.css\" rel=\ "stylesheet\"&gt;<br/> &lt;meta content=\ "script-src 'self' 'sha256-LiAOJW+SxhRQ1D3FA8oo/AjCouFSGU4xYS5EfRdWEx4=' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU='; default-src 'self'\" http-equiv=\ "Content-Security-Policy\"&gt;<br/>&lt;/head&gt;<br/><br/>&lt;body&gt;<br/> &lt;header&gt;<br/>  &lt;div class=\ "logo\"&gt; &lt;img alt=\ "logo\" src=\ "./images/logo.svg\"&gt; &lt;/div&gt;<br/>  &lt;button class=\ "btn\"&gt; &lt;img alt=\ "About\" src=\ "./images/icon-hamburger.svg\"&gt; &lt;/button&gt;<br/> &lt;/header&gt;<br/> &lt;main&gt;<br/>  &lt;button id=\ "prev\"&gt;&amp;lt;&lt;/button&gt;<br/>  &lt;div class=\ "card-container\"&gt;&lt;/div&gt;<br/>  &lt;button id=\ "next\"&gt;&amp;gt;&lt;/button&gt;<br/>  &lt;div class=\ "about\"&gt;<br/>   &lt;h1&gt;About&lt;/h1&gt;<br/>   &lt;p id=\ "changeme\"&gt;This is a release build, have fun with it.&lt;/p&gt;<br/>   &lt;h2&gt;- vidner&lt;/h2&gt;<br/>   &lt;div&gt;<br/>    &lt;h3 id=\ "message\"&gt;Upgrade&lt;/h3&gt;<br/>    &lt;br&gt;<br/>    &lt;input id=\ "key\" name=\ "key\" placeholder=\ "password-that-you-guys-need-to-have\" type=\ "text\"&gt;<br/>    &lt;button id=\ "upgrade\" name=\ "upgrade\"&gt;⬆&lt;/button&gt;<br/>   &lt;/div&gt;<br/>  &lt;/div&gt;<br/> &lt;/main&gt;<br/> &lt;script src=\ "./js/scripts.js\"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/><br/>&lt;/html&gt;</span></pre><p id="7fc8" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">最后，在<strong class="lb ir"> _fini解构器</strong>中放置断点后，HTML内容从内存堆中恢复。然而，我们还没有发现密码的算法验证，因为它位于原始源应用程序的<strong class="lb ir"> JS文件夹</strong>中。但是这实际上并不重要，因为所有的<strong class="lb ir">资产</strong>仍然保留在内存区域中，我们将使用基于输入id的字符串指示，<strong class="lb ir">键</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pi"><img src="../Images/03bb914f56f38d4cde5708a5cf831b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9EIlAyFsZ5p5Cwxt8TIuQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">关键模式指示</figcaption></figure><p id="4a00" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">您会注意到地址0x 55555 ce 3a 67、0x 55555 ce 3a 7a、0x 55555 ce 40 e 3、0x555555ce40f5和0x555555ce4175中的一些内容。Javascript引用了我们的<strong class="lb ir">输入</strong>的<strong class="lb ir">值</strong>，并在其中进行一些算法验证。让我们试着把它们也扔掉。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="7b3a" class="oe mf iq nz b be of og l oh oi">gef➤  x/s 0x555555ce39db-443<br/>0x555555ce3820: "lags/ukraine.png',\n    title: 'ukraine',\n  },\n  {\n    image: './flags/china.png',\n    title: 'china',\n  },\n  {\n    image: './flags/japan.png',\n    title: 'japan',\n  },\n  {\n    image: './flags/indonesia.png',\n    title: 'indonesia',\n  },\n  {\n    image: './flags/usa.png',\n    title: 'usa',\n  },\n  {\n    image: './flags/malaysia.png',\n    title: 'malaysia',\n  },\n  {\n    image: './flags/not-flag.png',\n    title: 'not-flag'\n  }\n];\n\nfunction rc4(key, str) {\n\tvar s = [], j = 0, x, res = '';\n\tfor (var i = 0; i &lt; 256; i++) {\n\t\ts[i] = i;\n\t}\n\tfor (i = 0; i &lt; 256; i++) {\n\t\tj = (j + s[i] + key.charCodeAt(i % key.length)) % 256;\n\t\tx = s[i];\n\t\ts[i] = s[j];\n\t\ts[j] = x;\n\t}\n\ti = 0;\n\tj = 0;\n\tfor (var y = 0; y &lt; str.length; y++) {\n\t\ti = (i + 1) % 256;\n\t\tj = (j + s[i]) % 256;\n\t\tx = s[i];\n\t\ts[i] = s[j];\n\t\ts[j] = x;\n\t\tres += String.fromCharCode(str.charCodeAt(y) ^ s[(s[i] + s[j]) % 256]);\n\t}\n\treturn res;\n}\n\nHTMLElement.prototype.empty = function() {\n  while (this.firstChild) {\n      this.removeChild(this.firstChild);\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  fillCards();\n  const next = document.getElementById(\"next\");\n  const prev = document.getElementById(\"prev\");\n  next.addEventListener(\"click\", function () {\n    const currCard = document.querySelector(\".card.view\");\n    const nextCard = currCard.nextElementSibling\n      ? currCard.nextElementSibling\n      : document.querySelector(\".card-container\").firstElementChild;\n    currCard.classList.remove(\"view\");\n    nextCard.classList.add(\"view\");\n  });\n\n  prev.addEventListener(\"click\", function () {\n    const currCard = document.querySelector(\".card.view\");\n    const prevCard = currCard.previousElementSibling\n      ? currCard.previousElementSibling\n      : document.querySelector(\".card-container\").lastElementChild;\n    currCard.classList.remove(\"view\");\n    prevCard.classList.add(\"view\");\n  });\n\n  document.addEventListener(\"keydown\", function (e) {\n    if (e.key === \"ArrowLeft\") prev.click();\n    else if (e.key === \"ArrowRight\") next.click();\n    else return false;\n  });\n\n  document.querySelector(\"#upgrade\").addEventListener(\"click\", function () {\n    const key = document.getElementById(\"key\");\n    const msg = document.querySelector(\"#message\");\n    if (key.value === rc4(key.getAttribute(\"placeholder\"), atob(\"+KXDg64ffbAnFhbDbfvFqoK8jEOsod1qhvEXXPWzXnc2I5u/tkcf+eQ=\"))) {\n      data[6].image = rc4(key.value, atob(\"sSWO4RshtePKZSKVyaGTLfZsFXGREULgLLgFgKtLweWHQWGz+oVm6qocDzecEGOA2aR5pg95NkibE2H0aA==\"));\n      data[6].title = \"flag\";\n      msg.textContent = \"Correct!!, now not-flag should evolve to a flag\",\n      fillCards();\n    } else {\n      msg.textContent = \"Wrong password!!\";\n    }\n  });\n\n  document.querySelector(\".btn\").addEventListener(\"click\", function () {\n    const img = this.children[0];\n    document.querySelector(\".about\").classList.toggle(\"view\");\n    setTimeout(function () {\n      img.setAttribute(\n        \"src\",\n        img.getAttribute(\"src\") === \"./images/icon-cross.svg\"\n          ? \"./images/icon-hamburger.svg\"\n          : \"./images/icon-cross.svg\"\n      );\n    }, 800);\n  });\n});\n\nfunction fillCards() {\n  const container = document.querySelector(\".card-container\");\n  container.empty();\n  data.forEach((data) =&gt; {\n    const card = document.createElement(\"div\"),\n      cardImage = document.createElement(\"div\"),\n      img = document.createElement(\"img\"),\n      url = document.createElement(\"a\");\n    img.setAttribute(\"src\", data.image);\n    img.setAttribute(\"alt\", data.title);\n    url.textContent = data.title;\n    card.classList.add(\"card\");\n    cardImage.classList.add(\"card-image\");\n    if (data.title === \"ukraine\") {\n      card.classList.add(\"view\");\n    }\n    cardImage.appendChild(img);\n    card.appendChild(cardImage);\n    card.appendChild(url);\n    container.appendChild(card);\n  });\n}\n\005"</span></pre><p id="0603" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">虽然垃圾场不是那么完美，但我们得到了这个想法。它将我们的输入与转换后的数据进行比较，转换后的数据通过硬编码密钥<strong class="lb ir">和输入占位符本身传递给RC4流密码。我们可以将它写入Javascript，并再次将输出传递给<strong class="lb ir"> Tauri应用</strong>，并获得正确的标志。</strong></p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="51e4" class="oe mf iq nz b be of og l oh oi">function rc4(key, str) {<br/>    var s = [],<br/>        j = 0,<br/>        x, res = '';<br/>    for (var i = 0; i &lt; 256; i++) {<br/>        s[i] = i;<br/>    }<br/>    for (i = 0; i &lt; 256; i++) {<br/>        j = (j + s[i] + key.charCodeAt(i % key.length)) % 256;<br/>        x = s[i];<br/>        s[i] = s[j];<br/>        s[j] = x;<br/>    }<br/>    i = 0;<br/>    j = 0;<br/>    for (var y = 0; y &lt; str.length; y++) {<br/>        i = (i + 1) % 256;<br/>        j = (j + s[i]) % 256;<br/>        x = s[i];<br/>        s[i] = s[j];<br/>        s[j] = x;<br/>        res += String.fromCharCode(str.charCodeAt(y) ^ s[(s[i] + s[j]) % 256]);<br/>    }<br/>    return res;<br/>}<br/><br/><br/>console.log(rc4("password-that-you-guys-need-to-have",atob("+KXDg64ffbAnFhbDbfvFqoK8jEOsod1qhvEXXPWzXnc2I5u/tkcf+eQ=")))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/3927152eb816d80d9749802394981908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQSpQcFJIDJNdqEs1Nn4PA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/41f121b93389091ea7495733b10337b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uuXS7rOTifuKDJPjbS80CQ.png"/></div></div></figure></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="97e0" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">用二进制仪器进行Brotli解压缩</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/fb4f40f346e2cbc6788d3a25a49fc037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G7tdCE0Os8ED1skQLYjP4w.png"/></div></div></figure><p id="3709" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">第二种方法对这个<strong class="lb ir"> Tauri应用</strong>更精确，因为我们将结合我们的背景知识的细节，了解它<strong class="lb ir"> </strong>如何在默认情况下用Brotli压缩存储我们的<strong class="lb ir">资产</strong>。</p><p id="48a8" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">回到IDA的静态分析，我们知道有几个对<strong class="lb ir"> BrotliDecompressor </strong>的函数调用。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pm"><img src="../Images/6fb3a4534ee6b015d86b399a37329fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rL6Y8b9jyZ8ZKl56WJiLZw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">布罗特利减压器</figcaption></figure><p id="c069" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">这些调用被分类，如果我们看一看<strong class="lb ir"> 0xBAF20 </strong>处的最终函数调用，我们可以认为它是解压缩内容的最终产品，因为它解压缩了可以被认为是<strong class="lb ir">资产</strong>的流，而高位地址保存了特定解压缩子程序的功能。</p><p id="c35c" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">那么，我们如何检查从二进制文件传入某个本机函数的参数呢？这里出现了Frida的角色，它是我们将要使用的二进制工具之一。Frida使用一个名为<strong class="lb ir">拦截器</strong>的Javascript API来拦截本地函数中的调用，我们可以使用返回值，在特定的区间范围内修补一些地址，打印出寄存器或参数等等，就像下面的Frida官方文档告诉它的那样。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pn"><img src="../Images/fb37a4c7e8ada9b786083a9e745cff43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aUZM3_-PVlLiMJTIcQVQCA.png"/></div></div></figure><p id="eae6" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">首先，作者试着调试在这个函数中传递了什么样的信息，比如参数。我们还需要检查从IDA传递了多少参数。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="dd0c" class="oe mf iq nz b be of og l oh oi">__int64 __fastcall brotli_decompressor::decode::BrotliDecompressStream::h6fd4311faa5fd5ae(<br/>        _QWORD *a1,<br/>        unsigned __int64 *a2,<br/>        _BYTE *a3,<br/>        unsigned __int64 a4,<br/>        _QWORD *a5,<br/>        _QWORD *a6,<br/>        __int64 a7,<br/>        unsigned __int64 a8,<br/>        __int64 a9,<br/>        __int64 a10)</span></pre><p id="bf2e" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">传递了10个参数，我们不知道它是大小、地址指针还是空值，所以让我们试着检查所有参数。我们将使用<strong class="lb ir">拦截器</strong>和<strong class="lb ir">brot Li _ compressor::decode::brot lide compressstream::h6fd 4311 FAA 5 FD 5 AE</strong>的地址，也将使用另一个Javascript API <strong class="lb ir">模块</strong>对其进行重新设置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi po"><img src="../Images/da5b0b3e92ae6d390763e0013de6c255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b7ymeUVKDF8TMX52TiYoUw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">Frida JS API文档，关于使用偏移地址进行重置</figcaption></figure><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="d4fa" class="oe mf iq nz b be of og l oh oi">Interceptor.attach(Module.findBaseAddress("flag-viewer").add(0xbaf20), {<br/>        onEnter: function(args) {<br/>            console.log("[+] Hooked brotlidecompress!");<br/>            this.arg0 = args[0];<br/>            this.arg1 = args[1];<br/>            this.arg2 = args[2];<br/>            this.arg3 = args[3];<br/>            this.arg4 = args[4];<br/>            this.arg5 = args[5];<br/>            this.arg6 = args[6];<br/>            this.arg7 = args[7];<br/>            this.arg8 = args[8];<br/>            this.arg9 = args[9];<br/><br/>        },<br/>        onLeave: function(retval) {<br/>            <br/>            send(ptr(this.arg0));<br/>            send(ptr(this.arg1));<br/>            send(ptr(this.arg2));<br/>            send(ptr(this.arg3));<br/>            send(ptr(this.arg4));<br/>            send(ptr(this.arg5));<br/>            send(ptr(this.arg6));<br/>            send(ptr(this.arg7));<br/>            send(ptr(this.arg8));<br/>            send(ptr(this.arg9));<br/>        }<br/>    });</span></pre><p id="1f21" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">准备好脚本后，我们可以使用下面的命令用<strong class="lb ir"> Frida </strong>来执行它。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="73d6" class="oe mf iq nz b be of og l oh oi">frida -f ./flag-viewer -l your_script_name.js</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/f3dfb684d1961120074df2e3de3df714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJnRSFgMQXKt8A9JXG4l2Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">挂钩地址视图及其返回数据</figcaption></figure><p id="da08" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">如果我们仔细检查，大多数参数包含指针地址，但第四个和第八个参数不包含，而是返回某种大小数据。我们不应该读这些，因为它会触发<strong class="lb ir">访问冲突</strong>。所以我们要读的是排除了第四个和第八个参数的指向地址。稍后，我们可以将我们的Frida脚本修改成这样。</p><pre class="kg kh ki kj gt oa nz ob bn oc od bi"><span id="8581" class="oe mf iq nz b be of og l oh oi">Interceptor.attach(Module.findBaseAddress("flag-viewer").add(0xbaf20), {<br/>        onEnter: function(args) {<br/>            console.log("[+] Hooked brotlidecompress!");<br/>            this.arg0 = args[0];<br/>            this.arg1 = args[1];<br/>            this.arg2 = args[2];<br/>            this.arg3 = args[3];<br/>            this.arg4 = args[4];<br/>            this.arg5 = args[5];<br/>            this.arg6 = args[6];<br/>            this.arg7 = args[7];<br/>            this.arg8 = args[8];<br/>            this.arg9 = args[9];<br/><br/>        },<br/>        onLeave: function(retval) {<br/>            <br/>            try{<br/>                console.log(ptr(this.arg0).readCString());<br/>            }catch(err){<br/>                console.log("Exception!")<br/>            }<br/>            try{<br/>                console.log(ptr(this.arg1).readCString());<br/>            }catch(err){<br/>                console.log("Exception!")<br/>            }<br/>            try{<br/>                console.log(ptr(this.arg2).readCString());<br/>            }catch(err){<br/>                console.log("Exception!")<br/>            }<br/>            try{<br/>                console.log(ptr(this.arg4).readCString());<br/>            }catch(err){<br/>                console.log("Exception!")<br/>            }<br/>            try{<br/>                console.log(ptr(this.arg5).readCString());<br/>            }catch(err){<br/>                console.log("Exception!")<br/>            }<br/>            try{<br/>                console.log(ptr(this.arg6).readCString());<br/>            }catch(err){<br/>                console.log("Exception!")<br/>            }<br/>            try{<br/>                console.log(ptr(this.arg8).readCString());<br/>            }catch(err){<br/>                console.log("Exception!")<br/>            }<br/>            try{<br/>                console.log(ptr(this.arg9).readCString());<br/>            }catch(err){<br/>                console.log("Exception!")<br/>            }<br/>        }<br/>    });</span></pre><p id="5d27" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">再次运行脚本，我们将看到所有的 <strong class="lb ir">解压缩资产</strong>都成功了，包括CSS、HTML和Javascript。我们设法泄露了原始应用程序的<strong class="lb ir">源代码</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7f2f1a9b0efee1977a06d1761821052a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*VlJPEWEV2pYibLb6f9U8ZQ.gif"/></div></div></figure><p id="f2f4" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">作者还要感谢Maulvi Alfansuri，在2天的比赛结束后，他帮助Frida JS编写了这个脚本，他也有一些技巧来应对现实世界中的Android挑战。也可以随时联系他！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="5bdb" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">关键要点</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pq"><img src="../Images/be9ebf0a42646c5cad4ae835743bc320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kzzhrfV-hoRN8T-ixEgj-A.png"/></div></div></figure><p id="e949" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">我们知道当使用<strong class="lb ir"> Tauri App </strong>作为选择时，该应用可以有多轻便，但事实上，想要迁移其由web组件组成的基础设施的用户或开发者不应存储可能非常敏感的<strong class="lb ir">硬编码数据</strong>。本演示的结论是，我们有能力泄漏您的应用程序源代码，因为只有压缩用于存储所需基础架构应用程序的资产。在<a class="ae ne" href="https://cwe.mitre.org/data/definitions/798.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir"> CWE-798:硬编码凭证的使用</strong> </a>中提到了“人”造成的这个漏洞。</p><p id="6ab7" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">作者让读者选择是<strong class="lb ir"> Electron.js </strong>还是<strong class="lb ir"> Tauri </strong>适合您的应用程序在单个桌面应用程序中迁移。我希望你通过阅读这些内容可以学到一些新的东西，到我写完这篇文章的时候，<strong class="lb ir"> Tauri应用程序版本已经是1.2了。</strong>也许他们的开发人员也想考虑加强他们的核心基础设施，以获得更大的逆向工程弹性，这样他们就可以实施更多的加密实施来保护资产，甚至尝试实施反逆向工程方法。</p><p id="3cbb" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">感谢您阅读此内容！订阅并关注我，了解更多网络安全话题😁。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h1 id="1138" class="me mf iq bd mg mh mi mj mk ml mm mn mo jw mp jx mq jz mr ka ms kc mt kd mu mv bi translated">参考</h1><div class="pr ps gp gr pt pu"><a href="https://tauri.app/" rel="noopener  ugc nofollow" target="_blank"><div class="pv ab fo"><div class="pw ab px cl cj py"><h2 class="bd ir gy z fp pz fr fs qa fu fw ip bi translated">使用web前端| Tauri Apps构建更小、更快、更安全的桌面应用程序</h2><div class="qb l"><h3 class="bd b gy z fp pz fr fs qa fu fw dk translated">Tauri是一个为所有主流桌面平台构建微小、高速二进制文件的框架。开发人员可以集成…</h3></div><div class="qc l"><p class="bd b dl z fp pz fr fs qa fu fw dk translated">tauri.app</p></div></div><div class="qd l"><div class="qe l qf qg qh qd qi kp pu"/></div></div></a></div><div class="pr ps gp gr pt pu"><a href="https://www.exploit-db.com/papers/13234" rel="noopener  ugc nofollow" target="_blank"><div class="pv ab fo"><div class="pw ab px cl cj py"><h2 class="bd ir gy z fp pz fr fs qa fu fw ip bi translated">攻击性安全利用数据库档案</h2><div class="qb l"><h3 class="bd b gy z fp pz fr fs qa fu fw dk translated">虐待。还有。乐趣和利润的来源-本文…</h3></div><div class="qc l"><p class="bd b dl z fp pz fr fs qa fu fw dk translated">www.exploit-db.com</p></div></div><div class="qd l"><div class="qj l qf qg qh qd qi kp pu"/></div></div></a></div><div class="pr ps gp gr pt pu"><a href="https://github.com/tauri-apps/tauri" rel="noopener  ugc nofollow" target="_blank"><div class="pv ab fo"><div class="pw ab px cl cj py"><h2 class="bd ir gy z fp pz fr fs qa fu fw ip bi translated">GitHub - tauri-apps/tauri:用web构建更小、更快、更安全的桌面应用程序…</h2><div class="qb l"><h3 class="bd b gy z fp pz fr fs qa fu fw dk translated">使用web前端构建更小、更快、更安全的桌面应用程序。- GitHub - tauri-apps/tauri:构建…</h3></div><div class="qc l"><p class="bd b dl z fp pz fr fs qa fu fw dk translated">github.com</p></div></div><div class="qd l"><div class="qk l qf qg qh qd qi kp pu"/></div></div></a></div><div class="pr ps gp gr pt pu"><a href="https://jonaskruckenberg.github.io/tauri-docs-wip/quick-start/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="pv ab fo"><div class="pw ab px cl cj py"><h2 class="bd ir gy z fp pz fr fs qa fu fw ip bi translated">Tauri文档WIP</h2><div class="qb l"><h3 class="bd b gy z fp pz fr fs qa fu fw dk translated">编辑描述</h3></div><div class="qc l"><p class="bd b dl z fp pz fr fs qa fu fw dk translated">jonaskruckenberg.github.io</p></div></div></div></a></div><div class="pr ps gp gr pt pu"><a href="https://learnfrida.info/" rel="noopener  ugc nofollow" target="_blank"><div class="pv ab fo"><div class="pw ab px cl cj py"><h2 class="bd ir gy z fp pz fr fs qa fu fw ip bi translated">弗里达手册</h2><div class="qb l"><h3 class="bd b gy z fp pz fr fs qa fu fw dk translated">Frida手册，学习桌面系统(Windows、Linux、MacOS)中二进制插装基础知识的资源</h3></div><div class="qc l"><p class="bd b dl z fp pz fr fs qa fu fw dk translated">learnfrida.info</p></div></div></div></a></div><div class="pr ps gp gr pt pu"><a href="https://frida.re/docs" rel="noopener  ugc nofollow" target="_blank"><div class="pv ab fo"><div class="pw ab px cl cj py"><h2 class="bd ir gy z fp pz fr fs qa fu fw ip bi translated">欢迎</h2><div class="qb l"><h3 class="bd b gy z fp pz fr fs qa fu fw dk translated">观察并重新编程在Windows、macOS、GNU/Linux、iOS、watchOS、tvOS、Android、FreeBSD和QNX上运行的程序</h3></div><div class="qc l"><p class="bd b dl z fp pz fr fs qa fu fw dk translated">frida.re</p></div></div></div></a></div><div class="pr ps gp gr pt pu"><a href="https://docs.rs/tauri/latest/tauri/" rel="noopener  ugc nofollow" target="_blank"><div class="pv ab fo"><div class="pw ab px cl cj py"><h2 class="bd ir gy z fp pz fr fs qa fu fw ip bi translated">陶里锈病</h2><div class="qb l"><h3 class="bd b gy z fp pz fr fs qa fu fw dk translated">Tauri是一个为所有主流桌面平台构建微小、高速二进制文件的框架。开发人员可以集成…</h3></div><div class="qc l"><p class="bd b dl z fp pz fr fs qa fu fw dk translated">文件</p></div></div></div></a></div><div class="pr ps gp gr pt pu"><a href="https://docs.rs/brotli/latest/brotli/fn.BrotliDecompress.html" rel="noopener  ugc nofollow" target="_blank"><div class="pv ab fo"><div class="pw ab px cl cj py"><h2 class="bd ir gy z fp pz fr fs qa fu fw ip bi translated">brotli - Rust中的brotli压缩</h2><div class="qb l"><h3 class="bd b gy z fp pz fr fs qa fu fw dk translated">板条箱“brotli”中铁锈“brot Li de compress”fn的API文件。</h3></div><div class="qc l"><p class="bd b dl z fp pz fr fs qa fu fw dk translated">文件</p></div></div></div></a></div><p id="f44d" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated">随时欢迎支持我！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.buymeacoffee.com/aseng"><div class="gh gi ql"><img src="../Images/9792ecbdc5be949e3714ef8e34d83483.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*_9trEB4VZofAP8AO.png"/></div></a></figure><p id="ca34" class="pw-post-body-paragraph ky kz iq lb b lc ld jr le lf lg ju lh my lj lk ll na ln lo lp nc lr ls lt lu ij bi translated"><a class="ae ne" href="https://trakteer.id/felix-alexander-swfnt/tip?open=true" rel="noopener ugc nofollow" target="_blank">https://trakteer.id/felix-alexander-swfnt/tip?open=true</a></p></div></div>    
</body>
</html>