<html>
<head>
<title>How a line of code resulted in a $20,000 bug bounty from GitLab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一行代码如何从GitLab获得2万美元的bug奖金</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-this-easy-vulnerability-resulted-in-a-20-000-bug-bounty-from-gitlab-d9dc9312c10a?source=collection_archive---------0-----------------------#2022-07-31">https://infosecwriteups.com/how-this-easy-vulnerability-resulted-in-a-20-000-bug-bounty-from-gitlab-d9dc9312c10a?source=collection_archive---------0-----------------------#2022-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4c7e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">数字标识的隐患</h2></div><h1 id="0e6a" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">摘要</h1><p id="08d0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Web应用程序有如此多不同的对象，通过使用<a class="ae lw" href="https://www.techopedia.com/definition/5547/primary-key" rel="noopener ugc nofollow" target="_blank">主键</a>能够唯一地识别所有这些对象是很重要的。我们通常认为数字id是一个很好的标识符；例如，我们可以为每个用户使用唯一的10位数字。然而，使用确定性id经常会导致一个常见的漏洞<a class="ae lw" href="https://portswigger.net/web-security/access-control/idor" rel="noopener ugc nofollow" target="_blank">不安全的直接对象引用(IDOR) </a>。在这种类型的漏洞中，web应用程序无法检查攻击者(假设用户1111)是否应该能够查看/编辑受害者(假设用户2222)的资源。</p><p id="4fa5" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">通常，这些漏洞并不在极其明显的地方；大多数应用程序都试图考虑IDORs，你可能无法使用IDORs从你的帐户中删除其他用户的帐户。但是，在那些可能被忽略的地方，或者看起来没有必要进行访问检查的地方，可能存在着潜在的危险。当HackerOne用户<code class="fe mc md me mf b">saltyyolk</code>发现一个关键的IDOR bug时，GitLab就发生了这种情况，导致了20，000美元的bug奖金。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/0e611d300f83f114f7b77a430714e93a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q8df8dhpfcAcknz5iHA78A.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">人工智能生成的图像“浮点数插图”在craiyon.com</figcaption></figure><h1 id="eb5c" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated"><strong class="ak">漏洞利用</strong></h1><blockquote class="mw mx my"><p id="58f0" class="la lb mz lc b ld lx ju lf lg ly jx li na lz ll lm nb ma lp lq nc mb lt lu lv im bi translated">我将在HackerOne 查看<code class="fe mc md me mf b">saltyyolk</code>的总结和报告<a class="ae lw" href="https://hackerone.com/reports/743953" rel="noopener ugc nofollow" target="_blank">。请阅读原始摘要进行深入的技术分析。</a></p></blockquote><p id="5a94" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated"><a class="ae lw" href="https://about.gitlab.com/" rel="noopener ugc nofollow" target="_blank"> GitLab </a>是一个与GitHub非常相似的DevOps平台，但它更适合企业使用。在GitLab中，用户可以创建项目，但是如果用户已经有了一个项目，他们也可以导入一个。</p><p id="dd84" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">在这个特性中，用户很可能会导入不同GitLab项目的导出版本。在这个导出中，有一个提供项目数据的<code class="fe mc md me mf b">project.json</code>文件。在这个<code class="fe mc md me mf b">JSON</code>文件中，有一个名为<code class="fe mc md me mf b">issues</code>的值数组，包含了所有<a class="ae lw" href="https://about.gitlab.com/handbook/marketing/project-management-guidelines/issues/" rel="noopener ugc nofollow" target="_blank"> GitLab Issues </a>的id，这些id作为GitLab项目规划的重要部分，与项目相关。</p><p id="c80a" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">在<code class="fe mc md me mf b">saltyyoke</code>的利用中，<code class="fe mc md me mf b">issues</code>数组被留空，而<code class="fe mc md me mf b">issue_ids</code>数组被添加了攻击者想要窃取的问题的id。因为id是数字的，所以理论上可以窃取他们想要的所有问题。<em class="mz">注:</em> <code class="fe mc md me mf b"><em class="mz">saltyyoke</em></code> <em class="mz">创建的原始PoC可以在GitLab </em>  <em class="mz">这里找到</em> <a class="ae lw" href="https://gitlab.com/gitlab-org/gitlab/-/issues/37286" rel="noopener ugc nofollow" target="_blank"> <em class="mz">。</em></a></p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nd"><img src="../Images/30615172d164f08e1ecd2dd5da8111a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HAl5PNZ7Tpl-SWV-o3WEQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">saltyyolk提供的PoC project.json文件。来源:GitLab问题报告</figcaption></figure><p id="dd4c" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated"><code class="fe mc md me mf b">saltyyolk</code>还注意到，这种利用不仅限于问题功能，还包括GitLab的其他功能，如<a class="ae lw" href="https://docs.gitlab.com/ee/user/project/issue_board.html" rel="noopener ugc nofollow" target="_blank">电路板</a>、<a class="ae lw" href="https://docs.gitlab.com/ee/user/project/merge_requests/" rel="noopener ugc nofollow" target="_blank">合并请求</a>等等。这些“<a class="ae lw" href="https://www.educative.io/blog/what-is-foreign-key-database" rel="noopener ugc nofollow" target="_blank">外键</a>在导入过程中没有被排除，因此影响了最终的导入过程。因此，用户可以通过引用他们的id来导入不属于他们的不同问题。</p><h1 id="03d0" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">为什么这笔赏金值2万美元？</h1><p id="c93c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">本质上，这里的错误是GitLab导入过程可以简单地将问题的id导入到攻击者新创建的项目中，而不验证这些问题是否属于攻击者。</p><p id="7892" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">这严重侵犯了用户的隐私，因为非常敏感的项目信息可能会泄露，例如集群id和秘密CI密钥。因此，从表面上看，这类似于私人信息被盗，这已经够糟糕了。然而，<code class="fe mc md me mf b">saltyyolk</code>进一步强调，这些窃取的信息可能被用来破坏受害者团队的关键基础设施，例如破坏构建/部署管道或使其他用户无法访问内容。这个IDOR的双重影响对GitLab来说将是灾难性的，这就是它被给予关键评级以及20，000美元奖金的原因。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ne"><img src="../Images/bbdfb4477b6613c76dc8be4442ae83b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3UHhUbhsSFDs_pRc.jpg"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">不，不是吉姆！</figcaption></figure><p id="a0d9" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">再次祝贺<code class="fe mc md me mf b">saltyyolk</code>这个惊人的发现，它可能挽救了数百万数据被盗的用户，以及您应得的20，000美元奖金！提醒(也是鼓励)臭虫不必复杂到造成巨大的破坏。</p><p id="0644" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated">感谢您通读，请在下面留下任何建设性的反馈、建议或问题！如果你喜欢，请考虑在Medium上跟随我或者<a class="ae lw" href="https://www.buymeacoffee.com/robertocyberkid" rel="noopener ugc nofollow" target="_blank">请我喝杯咖啡</a>。在roberto.cyberkid@gmail.com联系我，在<a class="ae lw" href="https://twitter.com/CyberKidLama" rel="noopener ugc nofollow" target="_blank">推特</a>关注我，在<a class="ae lw" href="https://www.linkedin.com/in/roberto-lama-9a126a123/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我！</p></div><div class="ab cl nf ng hx nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="im in io ip iq"><p id="5b69" class="pw-post-body-paragraph la lb it lc b ld lx ju lf lg ly jx li lj lz ll lm ln ma lp lq lr mb lt lu lv im bi translated"><em class="mz">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae lw" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc iu"> <em class="mz">加入我们的每周简讯</em> </strong> </a> <em class="mz">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>