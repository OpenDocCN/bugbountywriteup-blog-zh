<html>
<head>
<title>Android InsecureBankv2 Walkthrough: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android安全银行2演练:第2部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/android-insecurebankv2-walkthrough-part-2-429b4ab4a60f?source=collection_archive---------1-----------------------#2020-07-28">https://infosecwriteups.com/android-insecurebankv2-walkthrough-part-2-429b4ab4a60f?source=collection_archive---------1-----------------------#2020-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9e56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将继续介绍由GitHub用户<em class="kl"> dineshshetty </em>创建的<em class="kl">安全银行v2 </em> Android应用程序。查看<strong class="jp ir">第1部分</strong>，了解如何设置应用程序以及我已经演示过的一些应用程序的不安全性。我在下面的参考资料中留下了应用程序GitHub库的链接。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/986c5446f38e14fc9a30a004832033dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*-SwxVdI20TEENDs9wuGJaw.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="668b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">放弃</h1><p id="6151" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">正如我在第1部分中提到的，我写这篇文章是出于学习更多关于Android移动应用程序安全性的兴趣。这篇文章显然会包含关于<em class="kl">安全银行v2 </em> Android应用程序中存在的漏洞的剧透。我鼓励读者尽可能多地利用漏洞，如果您遇到困难或希望看到利用不安全的潜在不同方法，请稍后再来阅读本文。我们开始吧😄！</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="fb31" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">易受攻击的Android应用程序组件</h1><p id="07a1" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">继续我在<strong class="jp ir">第1部分</strong>中的<em class="kl"> InsecureBankv2 </em>应用<em class="kl"> </em>的演练，我决定使用一个名为<strong class="jp ir"> Drozer </strong>的工具来识别应用的Android组件的任何漏洞。我可以使用Drozer <strong class="jp ir"> </strong>来列举应用程序的攻击面，并使用下面的命令找到任何漏洞。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="9307" class="mj lc iq mf b gy mk ml l mm mn">run app.package.attacksurface com.android.insecurebankv2</span></pre><p id="67a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行上面的命令后，会提供以下输出。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/f0b21788254a212815303cf70b977f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*Oqgnw-xQQj2DV1eOBrDMzA.png"/></div></figure><p id="09ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看输出，我可以看到应用程序已经<strong class="jp ir">导出了</strong> <strong class="jp ir">五个活动</strong>、<strong class="jp ir">一个广播接收器</strong>和<strong class="jp ir">一个内容提供者</strong>。如果组件是在应用程序清单文件中导出的，那么设备上的任何应用程序只要拥有适当的权限，就可以访问这些组件。应用程序还将清单属性<strong class="jp ir">debuggeable</strong>设置为true，使应用程序能够被调试。这为分析应用程序中易受攻击的组件提供了一个有用的起点。</p><blockquote class="mp mq mr"><p id="f075" class="jn jo kl jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">注意:值得一提的是，所有这些信息也可以手动在应用程序的AndroidManifest.xml文件中找到。</p></blockquote></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h2 id="ac7d" class="mj lc iq bd ld mv mw dn lh mx my dp ll jy mz na lp kc nb nc lt kg nd ne lx nf bi translated">导出的活动</h2><p id="c016" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">Drozer根据上述结果确定了五项输出活动。我已经在第1部分中提到了应用程序的登录功能是如何由于导出的活动而被绕过的。要找到关于这些活动的更多信息，可以使用Drozer列出应用程序的所有导出活动。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="23bb" class="mj lc iq mf b gy mk ml l mm mn">run app.activity.info -a com.android.insecurebankv2</span></pre><p id="e560" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的输出显示了应用程序导出的所有活动的列表。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e373679deb9857963813f70caf8ef951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*rUeOnqulcTsmnQL7ULgWZQ.png"/></div></figure><p id="5ebc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出显示了活动的名称以及启动它所需的权限。这些活动的权限都是<strong class="jp ir"> null </strong>，这意味着任何应用程序都可以启动它们。使用第1部分中看到的ADB或Drozer，我可以启动这些活动并绕过登录活动。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="3f40" class="mj lc iq mf b gy mk ml l mm mn">run app.activity.start --component com.android.insecurebankv2 com.android.insecurebankv2.PostLogin</span></pre><p id="5c67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的Drozer命令可以用来启动“<em class="kl"> PostLogin </em>活动。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/472372a0d64586c31bb07cc6675a8eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*0fTpdBl5rvNzO18kfb4oCQ.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h2 id="2550" class="mj lc iq bd ld mv mw dn lh mx my dp ll jy mz na lp kc nb nc lt kg nd ne lx nf bi translated">导出的广播接收器</h2><p id="3947" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">应用程序已导出一个广播接收器。</p><blockquote class="mp mq mr"><p id="dec0" class="jn jo kl jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>广播接收器被设计用于监听系统范围内的广播事件(如网络活动、应用程序更新等)。)然后如果广播消息与广播接收机内的当前参数匹配，则触发某个事件。</p></blockquote><p id="8b60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Drozer，我可以通过下面的命令找到关于这个接收器的更多信息。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="24cf" class="mj lc iq mf b gy mk ml l mm mn">run app.broadcast.info -a com.android.insecurebankv2 -i </span></pre><p id="9104" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将返回以下信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b0de6b8643984d6fc2b1e00eeeb050b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*88nqU_lHSjF83uP3TDGNww.png"/></div></figure><p id="a86a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到接收者的名字叫做"<em class="kl"> MyBroadCastReceiver </em>"并且已经用<strong class="jp ir"> null </strong>权限导出。已经为该组件设置了一个<strong class="jp ir">意图过滤器</strong>，带有接收者订阅的广播动作(即“<em class="kl"> theBroadcast </em>”)。在我可以通过查看源代码来利用它之前，确定这个广播接收器做什么是很重要的。文件“<em class="kl">MyBroadcastReciever.java</em>”包含接收广播时将执行的源代码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nj"><img src="../Images/1892b0ca498daefe97c296520a08eabe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zOHUYdsfeuZHWrDzO4eS-A.png"/></div></div></figure><p id="b054" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在源代码中，我可以看到用于触发广播接收器的intent有两个参数(即“<em class="kl">phone number</em>”&amp;“<em class="kl">new pass</em>”)被检索。然后"<em class="kl"> mySharedPreferences </em>"文件中的凭证被检索和解码/解密，然后组合成一个字符串，该字符串将使用"<em class="kl"> smsManager </em>"类作为<strong class="jp ir">文本消息</strong>发送。利用目前收集到的信息，我可以用Drozer触发广播接收器。下面的命令使用了"<em class="kl"> theBroadcast </em>"动作，并传递了两个字符串参数，这两个参数是触发接收器和执行接收器代码所必需的。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="a234" class="mj lc iq mf b gy mk ml l mm mn">run app.broadcast.send --action theBroadcast --extra string phonenumber 123456789 --extra string newpass supersecurepass</span></pre><p id="97fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在可以在我的模拟器上看到应用程序已经发送了一条SMS消息，其中包含用户的旧密码和我指定的新密码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/f82856c4da7c71869acab85ee97b898c.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*CTNxSI2XAPaKdkuoZoyTEQ.png"/></div></figure><p id="5668" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这演示了任何应用程序(包括恶意应用程序)如何能够向该广播接收器发送意图，从而使其不受任何限制地被触发。</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h2 id="682a" class="mj lc iq bd ld mv mw dn lh mx my dp ll jy mz na lp kc nb nc lt kg nd ne lx nf bi translated">导出的内容提供商</h2><p id="e621" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">应用程序已导出内容提供者。</p><blockquote class="mp mq mr"><p id="d6fb" class="jn jo kl jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>内容提供商用于与其他应用程序共享应用程序数据，这些数据通常存储在数据库或文件中。</p></blockquote><p id="7c8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以使用下面的命令使用Drozer来了解这个导出的内容提供者的更多信息。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="ebc3" class="mj lc iq mf b gy mk ml l mm mn">run app.provider.info -a com.android.insecurebankv2</span></pre><p id="482d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下图显示了返回的关于内容提供商的信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi np"><img src="../Images/b6cbcaefbbc9e6262196e6de62c1d5a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*teJj4fAHx9e6OVBnOvyMQQ.png"/></div></div></figure><p id="330d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">读写权限被设置为<strong class="jp ir"> null </strong>，这意味着没有什么可以阻止我通过内容提供者查询数据存储。为了查询这个内容提供者，我可以使用Drozer来识别URI的的任何可访问的<strong class="jp ir">内容。</strong></p><blockquote class="mp mq mr"><p id="de60" class="jn jo kl jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">注意:内容提供商URI的begin是“<strong class="jp ir"> <em class="iq"> content:// </em> </strong>”，可以用来重构一个路径，该路径可以从内容提供商那里检索数据。</p></blockquote><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="7548" class="mj lc iq mf b gy mk ml l mm mn">run scanner.provider.finduris -a com.android.insecurebankv2</span></pre><p id="3a60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发现了一个可访问的内容提供商URI，如下图所示。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/8eda8194a9dd6faf2ac4aab2b14c16e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1KcEr00xmbJgTvC86jvdQ.png"/></div></div></figure><p id="d6c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Drozer，我可以使用下面的命令标识的<strong class="jp ir">内容URI </strong>来查询这个内容提供者。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="6b32" class="mj lc iq mf b gy mk ml l mm mn">run app.provider.query content://com.android.insecurebankv2.TrackUserContentProvider/trackusers</span></pre><p id="2fa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将从SQLite数据库返回一个用户名和用户ID表，该数据库跟踪内容提供者名称所暗示的用户登录。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nr"><img src="../Images/418ecdd7a8bdde41ca951d0765d759ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mSQqYlErc0YC_iYDYYK-Bg.png"/></div></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="bc75" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Android清单文件安全性</h1><p id="cb62" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">除了声明应用程序的组件(即活动、服务、广播接收器和内容提供者)之外，清单文件还用于定义属性以启用某些功能并声明应用程序所需的权限。如果开发人员启用或误用了某些属性，他们的应用程序就容易受到攻击。</p><h2 id="6b31" class="mj lc iq bd ld mv mw dn lh mx my dp ll jy mz na lp kc nb nc lt kg nd ne lx nf bi translated">调试模式已启用</h2><p id="7c91" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">Drozer发现该应用程序是可调试的。这是由于开发人员在清单文件中将<strong class="jp ir">Android:debuggeable</strong>属性设置为<strong class="jp ir"> true </strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ns"><img src="../Images/78fc0f63bc0617d3fef7ddc843224593.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wg4KkBmaj8pHhCIWHkcnXw.png"/></div></div></figure><p id="6951" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果某个应用程序被标记为可调试，那么攻击者就可以通过获取该应用程序的权限来访问该应用程序的数据。例如，我可以在我的模拟器上启动一个shell，然后切换到非root用户。然后我可以使用<strong class="jp ir"> run-as </strong>来查看这个包的目录的内容，在这里我通常没有权限。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nt"><img src="../Images/436f908abfe230693db80741228730ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qd3xC_ZKiK0m2a1oYDbDYA.png"/></div></div></figure><p id="b980" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我甚至可以使用run-as来检索通常安全存储在应用程序数据目录中的文件。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="f92a" class="mj lc iq mf b gy mk ml l mm mn">adb exec-out run-as com.android.insecurebankv2 cat databases/mydb &gt; mydb-copy</span></pre><p id="f616" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一种方法是使用名为<strong class="jp ir"> jdp </strong> (Java调试器)的工具来调试应用程序并发现有趣的信息。第一步是使用<strong class="jp ir"> jdwp </strong>来识别应用程序运行在哪个端口上。在目标应用程序关闭时运行以下命令，然后在应用程序处于活动状态时再次运行该命令。注意已经出现的新端口号。</p><blockquote class="mp mq mr"><p id="3a66" class="jn jo kl jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">注意:应用程序端口很可能与本文中看到的不同。</p></blockquote><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="1ac3" class="mj lc iq mf b gy mk ml l mm mn">adb jdwp</span></pre><p id="6c1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我可以在应用程序端口和我的工作站之间创建一个与ADB的通信通道。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="5791" class="mj lc iq mf b gy mk ml l mm mn">adb forward tcp:7777 jdwp:2906</span></pre><p id="eea3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<strong class="jp ir"> jdb </strong>，我将调试器附加到目标应用程序。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="5c48" class="mj lc iq mf b gy mk ml l mm mn">jdb -attach localhost:7777</span></pre><p id="a1e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当附加调试器时，应该显示以下输出。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nu"><img src="../Images/549ef9e9c150fa8d983bf8c84218f8da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMAdSmv91-7hf3PAFS-4Jg.png"/></div></div></figure><p id="1247" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以通过使用“<em class="kl">类</em>”和“<em class="kl">方法</em>”命令来查看应用程序中有哪些类和方法。我还可以使用<strong class="jp ir"> jdb </strong>在某些方法上设置一个<strong class="jp ir">断点</strong>，并通过使用“<em class="kl">stop in”</em>命令来控制app的执行。例如，我可以看到“<em class="kl"> LoginActivity </em>”类中有哪些方法。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="c41a" class="mj lc iq mf b gy mk ml l mm mn">&gt; methods com.android.InsecureBankv2.LoginActivity</span></pre><p id="0e4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这提供了一长串方法。我决定使用“<em class="kl"> creatUser() </em>”方法来演示如何更改局部变量的值。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nv"><img src="../Images/9fa32bb68a8d5b2ee7028d7b4b0fc819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGwILtOBSddhr5ghFd8qwA.png"/></div></div></figure><p id="6463" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在这个方法上设置了一个<strong class="jp ir">断点</strong>，然后单击create user按钮。</p><blockquote class="mp mq mr"><p id="3764" class="jn jo kl jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">注意:如果你没有看到一个创建用户按钮，那么看看这个文章系列的第1部分如何修补APK。</p></blockquote><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="0689" class="mj lc iq mf b gy mk ml l mm mn">&gt; stop in com.android.InsecureBankv2.LoginActivity.createUser()</span></pre><p id="a458" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这会导致命中断点。我可以使用“<em class="kl"> step </em>命令来执行下一行代码，并使用“<em class="kl"> locals </em>命令来查看代码执行中某一点的任何局部变量，如下图所示。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nw"><img src="../Images/2dea323a094328d5e27019ff1628023e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSUgAZVMr4gca9qM1AR30Q.png"/></div></div></figure><p id="b27c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以使用“<em class="kl"> set </em>更改显示的文本信息，然后使用“<em class="kl"> run </em>继续执行代码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/78c5075e58fd5c4c731a12d1dfdaefae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*GPrCeY4DQp4gG0GbjGa3uQ.png"/></div></figure><p id="ba09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将打印我的新邮件，而不是原来的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/2efbbe974575712dab41db3c19d17e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*OAOPxGgQX2mDXM2AzTq40g.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h2 id="52e6" class="mj lc iq bd ld mv mw dn lh mx my dp ll jy mz na lp kc nb nc lt kg nd ne lx nf bi translated">应用程序备份已启用</h2><p id="674a" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">应用程序在清单文件中将<strong class="jp ir"> android:allowBackup </strong>属性设置为<strong class="jp ir"> true </strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nz"><img src="../Images/d1825176ad28e95b0c0f8b60d25c68e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2s4kMdxOkt8P4zx5zyxzPQ.png"/></div></div></figure><p id="28d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这使得攻击者能够通过ADB备份应用程序数据，即使该设备不是根设备。我可以使用<strong class="jp ir"> adb backup </strong>命令来创建“<em class="kl">com . htbridge . insecurebank v2</em>”包的备份。根据您使用的Android操作系统版本，系统可能会提示您输入密码，稍后您将需要输入密码来解压缩备份文件。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="fe80" class="mj lc iq mf b gy mk ml l mm mn">adb backup com.android.insecurebankv2</span></pre><p id="4048" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将创建一个必须解压缩的“<em class="kl"> backup.ab </em>”文件。我可以通过使用<strong class="jp ir"> abe.jar </strong>文件将备份文件转换成tar文件来完成这个任务。我还提供了创建备份文件时使用的密码(即密码)，如下所示。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="3218" class="mj lc iq mf b gy mk ml l mm mn">java -jar abe.jar unpack backup.ab application-data.tar password</span></pre><p id="6b4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我可以解压缩"<em class="kl"> application-data.tar" </em>文件，并查看备份文件的内容。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="b044" class="mj lc iq mf b gy mk ml l mm mn">tar xvf application-data.tar</span></pre><p id="678a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过查看备份的内容，我可以看到诸如“<em class="kl"> mySharedPreferences </em>”和“<em class="kl"> mydb </em>”之类的文件，它们包含关于用户的敏感信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oa"><img src="../Images/7b48cd570a16cb07b0851a80e84a5285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K9S7uWRbK_R7GxWgaBU_zw.png"/></div></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="d418" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">不安全日志记录</h1><p id="fc71" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在本文之前展示的一些源代码片段中，您可能已经注意到应用程序在执行大量任务时会产生<strong class="jp ir">日志消息</strong>。例如，每当用户尝试登录时,“DoLogin”活动都会生成一条调试日志消息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ob"><img src="../Images/f7762e3351bba1547b2e54d044240d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BOxKmJ0tbBWU4T7aBksBsA.png"/></div></div></figure><p id="5362" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些日志可以使用<strong class="jp ir">日志目录</strong>进行转储。下面的命令将显示应用程序运行时的所有日志消息。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="3cfa" class="mj lc iq mf b gy mk ml l mm mn">adb logcat | grep "$(adb shell ps | grep com.android.insecurebankv2  | awk '{print $2}')"</span></pre><p id="71a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我试图在<strong class="jp ir"> logcat </strong>运行时登录，我会看到一条日志消息，显示我用来成功登录的用户名和密码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oc"><img src="../Images/251db2ec16529cdaa3303fb98ae4a89a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*THLAjdiHlKY_Z9bMPfJ_Bg.png"/></div></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="751c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">意图嗅探和注入</h1><p id="51d4" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">应用程序容易受到意图嗅探和意图注入的攻击。</p><blockquote class="mp mq mr"><p id="55d1" class="jn jo kl jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">注意:意图是一个消息传递对象，您可以使用它来请求另一个应用程序组件的操作。</p></blockquote><p id="407e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序在更改用户密码时使用隐含的意图。该消息被广播到设备上的每个应用程序，并且包含敏感数据。</p><blockquote class="mp mq mr"><p id="a578" class="jn jo kl jp b jq jr js jt ju jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj kk ij bi translated">注意:有两种类型的意图，隐含的和明确的。一个<strong class="jp ir">明确的意图</strong>是你用来启动一个特定的应用组件，比如你的应用中的一个特定的活动或服务。一个<strong class="jp ir">隐含意图</strong>指定一个动作，该动作可以调用设备上能够执行该动作的任何应用。</p></blockquote><p id="72c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以使用<strong class="jp ir"> Drozer </strong>执行<strong class="jp ir">意图嗅探</strong>，并查看意图的敏感内容。以下命令用于注册一个广播接收器，该接收器可以根据<strong class="jp ir">动作</strong>嗅探特定意图。通过前面对清单文件的分析，我知道了接收者意图过滤器所使用的动作(即“<em class="kl"> theBroadcast </em>”)组件</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="5fcd" class="mj lc iq mf b gy mk ml l mm mn">run app.broadcast.sniff --action "theBroadcast"</span></pre><p id="2dba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我试图更改密码时，Drozer会收到我的意图，我可以查看敏感数据。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/7e98832dbdae6dd9a2cd3040ea1d3104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*YGVSGO4TQrCLoWNBmOyG_w.png"/></div></figure><p id="e162" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">意图注入攻击</strong>通过将意图注入应用程序组件来执行应用程序工作流通常不允许的任务。我在前面演示了如何通过注入包含我自己的数据的组件来利用一个易受攻击的广播接收器。</p><pre class="kn ko kp kq gt me mf mg mh aw mi bi"><span id="fc03" class="mj lc iq mf b gy mk ml l mm mn">run app.broadcast.send --action theBroadcast --extra string phonenumber 123456789 --extra string newpass supersecurepass</span></pre></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="1bfd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结束语</h1><p id="8292" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">这就结束了我的Android应用程序的第2部分。在<strong class="jp ir">第3部分</strong>中，我将会看到更多可以在应用程序中发现的漏洞，并演示它们是如何被利用的。感谢您阅读到最后，我们将在第3部分再见😄！</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="b632" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">参考</h1><ul class=""><li id="2d56" class="oe of iq jp b jq lz ju ma jy og kc oh kg oi kk oj ok ol om bi translated"><a class="ae on" href="https://github.com/dineshshetty/Android-InsecureBankv2" rel="noopener ugc nofollow" target="_blank">https://github.com/dineshshetty/Android-InsecureBankv2</a></li><li id="ea3b" class="oe of iq jp b jq oo ju op jy oq kc or kg os kk oj ok ol om bi translated"><a class="ae on" href="https://book.hacktricks.xyz/mobile-apps-pentesting/android-app-pentesting/drozer-tutorial" rel="noopener ugc nofollow" target="_blank">https://book . hack tricks . XYZ/mobile-apps-pentest/Android-app-pentest/drozer-tutorial</a></li><li id="deef" class="oe of iq jp b jq oo ju op jy oq kc or kg os kk oj ok ol om bi translated"><a class="ae on" href="https://wiki.sei.cmu.edu/confluence/display/android/DRD03-J.+Do+not+broadcast+sensitive+information+using+an+implicit+intent" rel="noopener ugc nofollow" target="_blank">https://wiki . sei . CMU . edu/confluence/display/Android/drd 03-j .+Do+not+broadcast+sensitive+information+using+an+implicit+intent</a></li></ul></div></div>    
</body>
</html>