<html>
<head>
<title>HackTheBox — Spectra Machine Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子— Spectra Machine演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-spectra-machine-walkthrough-9339f01b65a0?source=collection_archive---------3-----------------------#2021-07-02">https://infosecwriteups.com/hackthebox-spectra-machine-walkthrough-9339f01b65a0?source=collection_archive---------3-----------------------#2021-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b120" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好，所有伟大的黑客和渗透测试人员。我的名字是<a class="ae kl" href="https://twitter.com/0xShantanuKul" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">山塔努库尔卡尼</strong> </a>。我是<strong class="jp ir">安全顾问</strong>，兼职<strong class="jp ir"> Bug赏金猎人</strong>。最近我开始在HTB上解决机器问题，我能够pwned <strong class="jp ir"> Spectra Machine </strong>。因为这台机器现在退役了，所以我想告诉你我是如何获得这台机器的root访问权限的。让我们开始吧，不要浪费时间。</p><p id="f02d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">侦察:</strong></p><p id="b087" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像往常一样，我们从检查开放的端口和使用NMAP运行服务开始。所以我开始扫描目标如下:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/776a48e46c72d62087b014df5f88f594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHTmXvzI66xbnJwP6Qrnbg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">NMAP结果</figcaption></figure><p id="233c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据NMAP的结果，P <strong class="jp ir"> ort 80 </strong>是打开的，因此目标上必须有Web应用程序在运行。端口<strong class="jp ir"> 22用于SSH </strong>。所以我立即在浏览器中输入一个IP地址，打开了一个网络应用。</p><h2 id="6731" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">枚举:</h2><p id="594a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">正如猜测的那样，target上运行着一个web应用程序，看起来像是一个问题跟踪门户。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ma"><img src="../Images/cd318dc4b858a652e8a51c50114f05d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jsduljNG5iDrwLseOEnThw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">在端口80上运行的Web应用程序</figcaption></figure><p id="9969" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经在我的系统上修改了<strong class="jp ir"> /etc/hosts </strong>文件，以探索在这台<strong class="jp ir"> Spectra </strong>机器上运行的Web应用程序。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/2618b163f228c38b1ee9d28806f3fee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*xXR7a7eATlhyLktvyHr-Qw.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">在/etc/hosts文件中添加了Spectra.htb</figcaption></figure><p id="7fbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击<strong class="jp ir"><em class="mc">软件问题跟踪</em></strong>和<strong class="jp ir">【测试】</strong>页面后，我看到其中一个页面指向我们有博客的主页。如果我们观察用户的博客，那么我们可以看到它是管理员。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi md"><img src="../Images/f70d9bfecd214d734c35dab84323bbff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HyJQJ5NGGgrf0pHYheH6kA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">管理员的博客页面</figcaption></figure><p id="1d64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在其他页面，我们看到在<strong class="jp ir">测试</strong>文件夹中有多个WordPress PHP文件。我们已经打开了多个文件，我们在wp-config.php.save的源代码中看到了凭证</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi me"><img src="../Images/a2dd3bf0ff72e9adc4606e6e5846815d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQcDzJEDZXcyRk5tsfR6dw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">wp-config.php.save的源代码</figcaption></figure><p id="ad36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我试着在<strong class="jp ir"> WP管理员登录</strong>页面使用这些凭证，但是没有成功。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/57dce7a5cc8b93bb438dc45353c98e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*-xllqpPYboZsPcWeRf2vvg.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">错误的凭据和未知的用户名错误</figcaption></figure><p id="b939" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，我看到一个错误，叫做<strong class="jp ir">未知用户名</strong>。然后我想起来我们有一个用户是从博客页面得到的管理员。很快，我输入了管理员的<strong class="jp ir">用户和<strong class="jp ir">密码:devteam01 </strong>，现在我可以作为管理员成功登录了。</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mg"><img src="../Images/ca23783cb344bbaddbc5d3c5db218734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pkJd_o7RNgRRtTiOpr-qnA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">以管理员身份登录</figcaption></figure><p id="fd72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个版本的WordPress，谷歌上有几个漏洞，我尝试了很多，但我不能成功利用。所以我决定使用<strong class="jp ir"> searchsploit </strong>来搜索漏洞。</p><h2 id="6034" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">流量计外壳:</h2><p id="c424" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我在我的Kali VM中启动Metasploit，并搜索任何已知的对WP管理外壳的利用。我又发现了一个，所以立即开始使用。开始使用exploit，完成初始配置，我能够成功地获得meterpreter外壳。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mh"><img src="../Images/124a8c81d71b454c0077656158ec9d89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxiDDR-7F-cIB812Vo4RHg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">仪表外壳</figcaption></figure><p id="c000" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我马上想知道我们有多少用户？所以我很快做了<strong class="jp ir"> cat /etc/passwd </strong>，我注意到这里有两个用户katie和nginx。</p><blockquote class="mi mj mk"><p id="1a0c" class="jn jo mc jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">nginx:x:20155:20156::/home/nginx:/bin/bash<br/>凯蒂:x:20156:20157::/home/凯蒂:/bin/bash</p></blockquote><p id="b373" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用户标志:</strong></p><p id="66bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我已经有了meterpreter shell，所以我开始使用一些命令，并且知道我们有<strong class="jp ir"> opt文件夹。所以我检查了它的内容，发现有一个autologin.conf文件。</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mo"><img src="../Images/7c547e284fa650f5dce17a3bcd47ce70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpGzcvKd4VvHi6K7ZGUbhA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">autologin.conf.orig文件包含</figcaption></figure><p id="93ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查了上面提到的目录，并检查了那里是否存在任何文件。所以基本上它使用一个passwd文件进行自动登录。检查了文件，在里面发现了一个密码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/e8ca7647ac2777205900d20c78948026.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*uggZcvMcqpGwf7qlOa1ObA.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">自动登录文件中的密码。</figcaption></figure><p id="82f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我立即为我们的用户<strong class="jp ir"> Katie </strong>尝试了那个密码，并且我能够使用这些凭证成功地SSH目标。检查文件夹的内容，发现<strong class="jp ir"> user.txt </strong>在那里。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mq"><img src="../Images/78d857874e992ccbbe7dd98214eae256.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3bJFSddOpxc1rIaSl-dIQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">SSH和user.txt</figcaption></figure><p id="7f14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">权限提升和根标志:</strong></p><p id="183c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在获得<strong class="jp ir"> user.txt </strong>之后，现在是考虑权限提升的时候了。在我的测试过程中，我发现这一部分非常难，也非常有趣。它实际上考验的是你的知识、技术能力和逻辑。所以检查了<strong class="jp ir"> sudo特权</strong>，发现该用户可以在没有密码的情况下执行“<strong class="jp ir"> /sbin/initctl </strong>”，密码<strong class="jp ir">与root </strong>相同。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/2316bdaa7248e214160c031927c5a711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*TOJrlKEXueBbpCqkke6Lrg.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Katie用户上的sudo -l</figcaption></figure><p id="0f29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我迅速移动到那个目录，检查它包含什么文件。</p><blockquote class="mi mj mk"><p id="f70b" class="jn jo mc jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">katie@spectra /etc/init $ ls -la</p><p id="98b5" class="jn jo mc jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">rw-rw--1根开发者478 2020年6月29日test . conf<br/>-rw-rw--1根开发者478 2020年6月29日test1 . conf<br/>-rw-rw--1根开发者478 2020年6月29日test10 . conf<br/>-rw-rw--1根开发者478 2020年6月29日test2 . conf<br/>-rw-rw--1根开发者478 2020年6月29日2020年test9.conf</p></blockquote><p id="6a2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们可以使用<strong class="jp ir"> initctl </strong>来控制系统启动和停止进程。我已经检查了test.conf文件，并开始探索是否可以从这里得到任何路径成为根用户。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ms"><img src="../Images/1f6157bf201c93557ce352d3f4ca5072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LA9ntEqrK3wZglLggEdZKw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">cat test.conf</figcaption></figure><p id="15e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在经历了大量的GitHub、medium、google链接以及尝试了一些脚本之后，我发现这个简单的脚本可以完成我们的工作，所以我很快编辑了<strong class="jp ir"> test.conf文件</strong>并保存了它。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/b2b1fdf606d025c1b70defdb3f0c013b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39ITnaFyP0CKFAOa96xkqA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">修改的test.conf文件</figcaption></figure><p id="013c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，我再次启动了<strong class="jp ir">测试进程</strong>，并使用简单的命令进行权限提升，该命令是“<strong class="jp ir"> /bin/bash -p </strong>”。我在那里有根。登顶旗帜，成功<strong class="jp ir">刷谱</strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mu"><img src="../Images/c67319dfad25a79c73f242112c28d198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHb7wyjwdGJ8dKFeQ7L3nQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">猫根. txt</figcaption></figure><p id="9c89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> user.txt和root.txt </strong>标志都是正确的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mv"><img src="../Images/d34f3d3d1d75f970cc00f1a6afc1c0d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6V4EDV8G0LT0tw3GBQPqFA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">获得的积分。</figcaption></figure><p id="47c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然这是一台来自HTB的简单机器，但对于像我这样的初学者来说，在这上面工作总是具有挑战性。我学到了很多东西，比如WordPress漏洞、Metasploit、bash和特权提升方法。</p><p id="305c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢我的文章，请在推特上联系我。</p><p id="473b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再次感谢..！！</p></div></div>    
</body>
</html>