<html>
<head>
<title>Bastion — HackTheBox Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Bastion — HackTheBox详细报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bastion-hackthebox-writeup-3c57d89476e4?source=collection_archive---------0-----------------------#2019-09-08">https://infosecwriteups.com/bastion-hackthebox-writeup-3c57d89476e4?source=collection_archive---------0-----------------------#2019-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="af84" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak"> <em class="kf"> Bastion是一个有趣的盒子，需要通过远程共享挂载VHD文件，并通过SSH破解一些SAM哈希才能进入盒子。对于privesc，我将在mRemoteNG的备份配置文件中找到管理员的凭据。稍后，我将使用找到的凭据以管理员身份登录来完成这个框。说了这么多，让我们直接开始吧。</em> </strong></h2></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi kg"><img src="../Images/3787135edf6e3bf48b7adf8ef737db1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UsOfKwT9QMDwuPW05zBpDw.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">信息卡</figcaption></figure><h1 id="92f3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">计数和侦察</h1><p id="4f46" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">像往常一样，让我们从Nmap扫描开始。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mk"><img src="../Images/3b0f7fca739f1ad265bc07897eb156fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w7APP9OmPurlRfE_4SsFMQ.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">NMAP扫描所有TCP端口</figcaption></figure><p id="9db4" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><code class="fe mq mr ms mt b"><strong class="lq ir">nmap</strong></code>给出了一些有趣的Windows服务:<strong class="lq ir"> SMB (135/139/445) </strong>和<strong class="lq ir"> SSH ( 22 ) </strong></p><h1 id="d5fc" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">SMB枚举</h1><p id="29a8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><code class="fe mq mr ms mt b">smbmap</code>不显示任何空会话。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mu"><img src="../Images/2d14e16745e068649a618aa2388e47ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tCSk31DlXeC07gndYhkFoQ.png"/></div></div></figure><p id="2a81" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">让我们试着以某个<code class="fe mq mr ms mt b">invalid user</code>的身份登录。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mv"><img src="../Images/83a713319869b118bca486624001504c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LNTznuYYC9r2rz4h-60RSw.png"/></div></div></figure><p id="2d3d" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><strong class="lq ir">备份</strong>分享看起来很有趣。让我们看看有什么。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mw"><img src="../Images/5adc0770591417d8c29c3bca089fedee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52SunbU75tcPk4Kdn4htoQ.png"/></div></div></figure><p id="c0a2" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">有一个有趣的文件`<strong class="lq ir"> note.txt </strong>和一个文件夹`<strong class="lq ir"> WindowsImageBackup </strong></p><p id="8145" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">还有一个`<strong class="lq ir">备份</strong>文件夹。让我们看看备份文件夹里有什么。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi mx"><img src="../Images/bc23500344d8570df4db150d771329c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zh7vLHLQdZqGiDwnV9Bwsg.png"/></div></div></figure><p id="05a1" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">里面有很多东西。我感兴趣的是VHD文件(上图中突出显示的)和<code class="fe mq mr ms mt b">BackupSpecs.xml</code>文件。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi my"><img src="../Images/3695f361c2a1830cda9424319038240b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IylxvukEPkAtvMl-dYBECg.png"/></div></div></figure><p id="1eca" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">BackupSpecs.xml讲卷9 B9 cfbc 3–369 e-11e 9-a17c-806 E6 f 6 e 6963和9 B9 cfbc 3–369 e-11e 9-a17c-806 E6 f 6 e 6963。</p><h1 id="f1ee" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">通过远程共享装载VHD文件</h1><p id="7a3a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我看到了这篇优秀的文章<a class="ae mz" href="https://medium.com/@klockw3rk/mounting-vhd-file-on-kali-linux-through-remote-share-f2f9542c1f25" rel="noopener">通过远程共享在Kali Linux上安装VHD文件</a></p><p id="d075" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">浏览上述文章中的步骤，这是通过远程共享挂载VHD文件的命令。</p><blockquote class="na nb nc"><p id="5ea4" class="lo lp nd lq b lr ml jr lt lu mm ju lw ne mn lz ma nf mo md me ng mp mh mi mj ij bi translated"><strong class="lq ir">mount-t CIFS-o username = guest//10 . 10 . 10 . 134/Backups/mnt/bastion/</strong></p></blockquote><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nh"><img src="../Images/ef7a5559c060adff45dbe4f18745b97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-d8n9sTjEMDCYALBkUHVRw.png"/></div></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ni"><img src="../Images/c3e4d00e032699ad4b486942ebd90751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G6oKdpNpCTiciTHkT4tZ0g.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">针对VHD映像的文件命令</figcaption></figure><blockquote class="na nb nc"><p id="4ad4" class="lo lp nd lq b lr ml jr lt lu mm ju lw ne mn lz ma nf mo md me ng mp mh mi mj ij bi translated"><strong class="lq ir">guest mount—add/mnt/bastion/WindowsImageBackup/L4mpje-PC/Backup \ 2019–02–22 \ 124351/9 B9 cfbc 4–369 e-11e 9-a17c-806 e6f 6 e 6963 . vhd—inspector—ro/mnt/vhd-v</strong></p></blockquote><p id="f686" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在guestmount命令完成执行后，我们可以通过查看/mnt/vhd文件夹来查看VHD文件中有什么</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nj"><img src="../Images/dff7218eafa34eb822f1c8569000abbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pmUXQzWIcGXbmK38bigug.png"/></div></div></figure><p id="6020" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">因为我们可以访问Windows文件系统，所以让我们首先使用这些文件来获取NTLM散列</p><blockquote class="na nb nc"><p id="f9b1" class="lo lp nd lq b lr ml jr lt lu mm ju lw ne mn lz ma nf mo md me ng mp mh mi mj ij bi translated"><strong class="lq ir">T27】C:\ windows \ system32 \ config \ SYSTEM<br/>C:\ windows \ system32 \ config \ SAMT30】</strong></p></blockquote><p id="641f" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">使用samdump2，我们可以转储NTLM哈希。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nk"><img src="../Images/72feca8afe4bc957570a6a55689381ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLTZKX_FY0VYBpQAzyGzCQ.png"/></div></div></figure><h1 id="0b3c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">破解哈希</h1><p id="d5c5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">用下面的命令破解散列</p><h2 id="a640" class="nl kx iq bd ky nm nn dn lc no np dp lg lx nq nr li mb ns nt lk mf nu nv lm nw bi translated">hashcat-m 1000 hashes/usr/share/word lists/rock you . txt—force</h2><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nx"><img src="../Images/f11d4f6e511648658a9098e704203bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NhYaLm_3ZUKu8OGa7Zu7RQ.png"/></div></div></figure><blockquote class="na nb nc"><p id="576c" class="lo lp nd lq b lr ml jr lt lu mm ju lw ne mn lz ma nf mo md me ng mp mh mi mj ij bi translated"><em class="iq"> Hashcat奏效了！！</em> <br/> <strong class="lq ir"> <em class="iq">用户:L4mpje </em> </strong></p><p id="0a64" class="lo lp nd lq b lr ml jr lt lu mm ju lw ne mn lz ma nf mo md me ng mp mh mi mj ij bi translated"><strong class="lq ir"> <em class="iq">密码:bureaulampje </em> </strong></p></blockquote><h1 id="a798" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">外壳为L4mpje</h1><p id="a231" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">用上面的密码以L4mpje的身份登录，我们进入了系统。</p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi ny"><img src="../Images/e46429fe921af4006182598dfe446479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RZSkLH1zUG3iPwdwarcEYg.png"/></div></div></figure><p id="e848" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">我们可以从这里获得user.txt标志。</p><h1 id="dd04" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">Privesc: L4mpje -&gt;管理员</h1><p id="c764" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于权限提升，我通常在运行任何枚举脚本之前尝试手动查找感兴趣的文件。在这样做的时候，我最终找到了一个名为<strong class="lq ir"> mRemoteNG的文件夹。</strong></p><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi nz"><img src="../Images/9843b6c7fe626a313661249733214e9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R2uSQmqa5Rjw008xX9taOg.png"/></div></div></figure><p id="20e7" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">在谷歌上快速搜索一下mRemoteNG就可以看到这个，</p><blockquote class="na nb nc"><p id="3cc1" class="lo lp nd lq b lr ml jr lt lu mm ju lw ne mn lz ma nf mo md me ng mp mh mi mj ij bi translated">一个开源的、选项卡式的、多协议的远程连接管理器。mRemoteNG为mRemote增加了bug修复和新功能。它允许您在一个简单而强大的选项卡式界面中查看所有的远程连接。</p></blockquote><p id="87c4" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">经过一番研究，我发现存储在mRemoteNG中的密码可以被解密，也碰到了这个工具。</p><div class="oa ob gp gr oc od"><a href="https://github.com/haseebT/mRemoteNG-Decrypt" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">hase ebt/mRemoteNG-解密</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">github.com</p></div></div></div></a></div><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi om"><img src="../Images/77651b03f96dbd3dc49b77e12666b8be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7E4k2BoJ7kfuIXTfFvDuxQ.png"/></div></div><figcaption class="ks kt gj gh gi ku kv bd b be z dk translated">confCons.xml文件</figcaption></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi on"><img src="../Images/11d5359fa278b64cb11cff3b7bb43f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*msWKVTiRo40d-vpY0Lwdkw.png"/></div></div></figure><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi oo"><img src="../Images/8b39719327d7f1606a446b3be3e7e1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GbpTQeXbFe-5Rl9Nuoosg.png"/></div></div></figure><blockquote class="na nb nc"><p id="a4ea" class="lo lp nd lq b lr ml jr lt lu mm ju lw ne mn lz ma nf mo md me ng mp mh mi mj ij bi translated">就在那里。我们已经得到了管理员的密码。<br/>用户:管理员</p><p id="80c3" class="lo lp nd lq b lr ml jr lt lu mm ju lw ne mn lz ma nf mo md me ng mp mh mi mj ij bi translated">密码:thXLHM96BeKL0ER2</p></blockquote><h1 id="99fe" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">作为管理员的Shell</h1><figure class="kh ki kj kk gt kl gh gi paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gh gi op"><img src="../Images/7c20d1a89c225c3cb224699046a5d9d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cf-F5rYoYtugzy21JradoA.png"/></div></div></figure><p id="597d" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated">以管理员身份登录，我们成为管理员。<br/>我就说到这里，如果你喜欢这篇文章，请鼓掌。<br/>非常感谢您的反馈。</p><p id="889e" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><strong class="lq ir">感谢并快乐黑客，<br/>Preetham(</strong><a class="ae mz" href="https://www.hackthebox.eu/profile/9160" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="nd">@ cyber 01</em></strong></a><strong class="lq ir"><em class="nd"/>)</strong></p></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><p id="baa0" class="pw-post-body-paragraph lo lp iq lq b lr ml jr lt lu mm ju lw lx mn lz ma mb mo md me mf mp mh mi mj ij bi translated"><em class="nd">关注</em> <a class="ae mz" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="nd"> Infosec报道</em> </a> <em class="nd">获取更多此类精彩报道。</em></p><div class="oa ob gp gr oc od"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">信息安全报道</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc kq od"/></div></div></a></div></div></div>    
</body>
</html>