<html>
<head>
<title>Pen-Testing Salesforce Apps: Part 1 (Concepts)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">笔测试Salesforce应用程序:第1部分(概念)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/in-simple-words-pen-testing-salesforce-saas-application-part-1-the-essentials-ffae632a00e5?source=collection_archive---------1-----------------------#2021-06-17">https://infosecwriteups.com/in-simple-words-pen-testing-salesforce-saas-application-part-1-the-essentials-ffae632a00e5?source=collection_archive---------1-----------------------#2021-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="49f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之:对于笔测试人员和安全研究人员</p><p id="4ef3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于笔测试Salesforce SAAS应用程序的两部分博客。第1部分侧重于理解Salesforce基础知识，第2部分侧重于实际的Pen测试步骤。我们开始吧。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/2aa6bf06be915545c56c1a14391aaa0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*A0KLxoh7mC2q6RxaVixCjQ.png"/></div></figure><h1 id="24a9" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Salesforce SAAS应用程序简介</h1><p id="a239" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated"><strong class="jp ir"> SAAS </strong>或软件即服务，是一种软件交付模式，通过网络可以访问软件。在某种程度上，它就像一个web应用程序。此外，使用SAAS就像是一种特权，SAAS应用程序的基础设施和平台完全由供应商管理。</p><p id="0175" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> CRM </strong>或客户关系管理，帮助商业机构维持与客户的关系。已经开发了有效管理CRM的软件。现在，不要与这里的“客户”一词混淆，例如，让我们考虑一个电子商务应用程序，电子商务公司将使用CRM来维护与其供应商(而不是购买的客户)的关系，检查他们的活动，提供关于他们如何做的分析并提供支持。</p><p id="f058" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Salesforce为CRM提供SAAS应用程序。这些SAAS应用程序可以通过管理面板完全管理和定制，这意味着您可以使用管理面板本身立即使SAAS应用程序运行。所需的编码工作是最小的，它涉及到一种<a class="ae kl" href="https://trailhead.salesforce.com/en/content/learn/modules/platform_dev_basics/platform_dev_basics_code#:~:text=Apex%3A%20Salesforce's%20proprietary%20programming%20language,combination%20of%20Apex%20and%20JavaScript." rel="noopener ugc nofollow" target="_blank"> Salesforce编程技术</a>。</p><ul class=""><li id="a6fd" class="lx ly iq jp b jq jr ju jv jy lz kc ma kg mb kk mc md me mf bi translated"><strong class="jp ir"> Lightning组件框架</strong>:类似于AngularJS或React的UI开发框架。这也包括<strong class="jp ir">光环</strong>组件。</li><li id="72ec" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir"> Apex </strong> : Salesforce的专有编程语言，具有类似Java的语法。</li><li id="c3f4" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir"> Visualforce </strong>:一种标记语言，允许您使用看起来很像HTML的代码创建自定义Salesforce页面，并且可以选择使用Apex和JavaScript的强大组合</li></ul><p id="278d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过其他编程语言定制也是允许的，但前者是最受欢迎的。</p><h1 id="d6f3" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">这与传统的web应用程序笔式测试有何不同？</h1><p id="5e8b" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">请记住，Salesforce SAAS应用程序是一种可以像web应用程序一样访问的软件。对于web应用程序部分，您仍将应用所有传统的web应用程序笔测试技能，但软件部分有所不同。该软件为管理其数据和用户提供了单独的访问控制。这些安全控制主要是通过管理面板访问的，弄乱这些安全控制会导致不当授权漏洞，从而导致敏感数据泄漏。</p><blockquote class="ml mm mn"><p id="27c7" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated">为了利用这些错误配置的安全控制，笔测试人员需要理解HTTP请求参数中的Salesforce格式。攻击的表面仍然是通过web，但我们利用这些漏洞的方式与传统方法不同</p></blockquote><h1 id="ce31" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Salesforce特定漏洞利用</h1><p id="45b2" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">对于Salesforce，有几个漏洞具有独特的利用方法。</p><p id="e5ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">不当授权</strong> - Salesforce提供安全控制来管理其数据和用户。错误配置它们会导致不适当的授权漏洞，从而导致敏感数据泄漏。然而，要利用这一点，您需要理解Salesforce HTTP请求参数的格式。</p><p id="3feb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mo">注意-如果使用除Salesforce编程技术之外的任何其他编程语言，这可能不适用。</em> </strong></p><p id="3577" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> SOQL注入- </strong> SOQL是Salesforce的SQL查询语言，但其范围仅限于SELECT语句。如果用户输入被直接注入到SOQL查询中，用户可以修改查询以提取比允许用户看到的更多的数据。同样，要利用这一点，您需要理解SOQL的查询格式，并相应地应用有效负载。</p><h1 id="7393" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Salesforce术语</h1><p id="e9c6" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">让我们快速浏览一下进行笔式测试所需的术语。</p><ul class=""><li id="8dd3" class="lx ly iq jp b jq jr ju jv jy lz kc ma kg mb kk mc md me mf bi translated"><strong class="jp ir">对象</strong>就像存储数据的表格。有两种类型。</li><li id="edde" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir">标准对象</strong>，Salesforce提供的预格式化表格。这将适用于所有使用Salesforce SAAS应用程序的组织。</li><li id="8836" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir">自定义对象，</strong>由组织创建的对象或表格。这将只对创建它的组织可用。</li><li id="a05a" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir">字段</strong>类似于列</li><li id="eec2" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir">记录</strong>像行</li><li id="0bc9" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir">控制器</strong>包含<strong class="jp ir">动作</strong>，这些是从对象(或表格)中检索数据的功能。<strong class="jp ir">参数</strong>被传递给这些函数。有两种类型</li><li id="62da" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir">标准控制器</strong>，访问Salesforce对象的预格式化函数。所有使用Salesforce SAAS应用程序的组织都可以使用这些控制器</li><li id="0dfa" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated"><strong class="jp ir">自定义控制器，</strong>开发用于访问Salesforce对象的新功能。这将只对创建它的组织可用。</li><li id="ba37" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">在Salesforce中，未经身份验证的用户被称为<strong class="jp ir">访客用户</strong></li></ul><h1 id="6140" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">了解HTTP请求中的Salesforce格式</h1><p id="01aa" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">现在我们已经对Salesforce SAAS应用程序有了一个很好的了解，让我们看看HTTP请求参数并理解其中的Salesforce格式。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/d8a8e04a1533964b7f9827847795a3b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_HTeETFinppmrgoK1-oWw.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">Salesforce HTTP请求(编码)</figcaption></figure><p id="c5ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">POST参数上的快速url解码向我们展示了这一点:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nb"><img src="../Images/a317fbc4b1c085767181de56bbd861c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3uEucQ18NxkVkYojEHOCA.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">Salesforce HTTP请求(已解码)</figcaption></figure><p id="4b9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">POST主体中有四个参数。</p><ul class=""><li id="33fd" class="lx ly iq jp b jq jr ju jv jy lz kc ma kg mb kk mc md me mf bi translated">消息</li><li id="bb1b" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">氛围.背景</li><li id="dc43" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">aura.pageURI</li><li id="8999" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">光环.令牌</li></ul><p id="736a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们感兴趣的主题实际上是消息参数，特别是其中的“<strong class="jp ir">描述符</strong>和“<strong class="jp ir">参数</strong>”键值对。其他的不感兴趣。不过，万一你发现什么有趣的东西，请告诉我。</p><p id="c893" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们试着把这个和我们的术语联系起来。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nb"><img src="../Images/b80863b9da539b95f3c703c07bc414d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VbXECH8UVTFERZKqZ8Ibzg.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">Salesforce HTTP请求—控制器、操作和参数</figcaption></figure><p id="bf16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">暂时忘记名字，你所要理解的是ComponentController包含getComponentDef函数，它将名字作为一个参数，或者它是一个带参数的函数，与一个对象(或表)交互并获取数据，有时可以是<strong class="jp ir">记录</strong>。</p><p id="bd61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，从一个对象(表)中提取数据的函数是直接在HTTP请求中公开的吗？是的，确实如此。</p><p id="b1ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果权限配置错误，事情就会变得一团糟。</p><h1 id="22fd" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">将错误配置映射到笔测试</h1><p id="3ceb" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">让我们来看看权限是如何分配的，如果你想详细了解这个，你可以在这里阅读我的博客<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/in-simple-words-pen-testing-salesforce-saas-application-part-2-fuzz-exploit-eefae11ba5ae">。</a></p><p id="d0df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，分别为<strong class="jp ir"> <em class="mo">对象、</em> </strong>字段和记录设置权限。在这三者中，我们作为笔测试人员非常关心记录权限，因为它们是真实的数据。可能导致权限配置错误的两种情况。</p><ol class=""><li id="d338" class="lx ly iq jp b jq jr ju jv jy lz kc ma kg mb kk nc md me mf bi translated">通过管理面板向用户提供<strong class="jp ir">过许可记录权限</strong></li></ol><p id="8c97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.请记住Apex(一种具有类似Java语法的专有编程语言)，当使用某些方法如<strong class="jp ir"> @Remote Action </strong>或<strong class="jp ir"> @AuraEnabled </strong>时，如果没有执行适当的检查，它可以覆盖UI权限并为记录打开更大的权限</p><blockquote class="ml mm mn"><p id="0df2" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated">但是从笔测试人员的角度来看，这些真正的意思是，如果我们识别对象和控制器并用正确的参数模糊它们，我们应该能够检索到具有错误配置的权限的记录</p></blockquote><p id="ae67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们能够以未经身份验证的用户或Salesforce中所谓的访客用户的身份检索这些记录，这被认为是至关重要的。但是，Salesforce推出了许多关于访客用户安全性的升级。</p><p id="3aad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你喜欢阅读这篇博客:)你现在开始阅读<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/in-simple-words-pen-testing-salesforce-saas-application-part-2-fuzz-exploit-eefae11ba5ae"> Part -2 </a>，fuzz和exploit Salesforce应用程序。日安！</p><h2 id="0005" class="nd kv iq bd kw ne nf dn la ng nh dp le jy ni nj li kc nk nl lm kg nm nn lq no bi translated">参考</h2><p id="4d7b" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated"><a class="ae kl" href="https://trailhead.salesforce.com/en/content/learn/modules/platform_dev_basics/platform_dev_basics_code#:~:text=Apex%3A%20Salesforce's%20proprietary%20programming%20language,combination%20of%20Apex%20and%20JavaScript" rel="noopener ugc nofollow" target="_blank">https://trail head . sales force . com/en/content/learn/modules/platform _ dev _ basics/platform _ dev _ basics _ code #:~:text = Apex % 3A % 20 sales force的% 20专有% 20编程% 20语言，组合% 20 of % 20 Apex % 20和%20JavaScript </a>。</p></div></div>    
</body>
</html>