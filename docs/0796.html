<html>
<head>
<title>Unhiding the hidden</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">取消隐藏</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/unhiding-the-hidden-2ef44192c10b?source=collection_archive---------1-----------------------#2020-08-30">https://infosecwriteups.com/unhiding-the-hidden-2ef44192c10b?source=collection_archive---------1-----------------------#2020-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0ea3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第一次虫子奖励体验——530美元</h2></div><p id="f79d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本博客旨在帮助开发人员了解攻击者如何利用安全错误配置来获得对受限功能的未授权访问。一个非常简单的弱点(如果我现在想起来的话)，但我的大部分时间和精力都花在了寻找正确的兴趣点上。作为一名未经认证的用户，我可以访问只有内部管理员才能使用的某些功能，其中包括创建具有管理权限的新用户、修改系统条目和配置、查看和更新日志、重新生成访问令牌等。</p><p id="9e69" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第一步:侦察</strong></p><p id="f3dd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我的目标是“<em class="lb">domain.com</em>”。一个开源的子目录枚举工具给我指出了一个有趣的子域，比如“<em class="lb">iambroot.domain.com</em>”。我在子域上运行了一个快速网络扫描来检查有趣的开放端口——只有端口443和80是开放的。</p><p id="caf5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第二步:黑盒</strong></p><p id="742f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">端口443上的子域“<em class="lb">iambroot.domain.com</em>”加载了一个没有其他表单域功能的基本登录页面——没有注册过程、密码重置或联系表单。只是一个简单的旧登录页面，允许用户使用有效的用户名/密码组合登录，如果用户在登录过程中遇到问题，可以通过消息联系管理员。我尝试了一些基本的身份验证绕过测试案例，并决定转移到另一个目标，假设我到达了一个死胡同。但在此之前，我花了一些时间检查了发送到/来自子域的流量(打嗝日志)。</p><p id="8f68" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在浏览Burp日志时，一个应用程序响应引起了我的注意！</p><p id="1d8b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">步骤3:对管理员模块的未授权访问</strong></p><p id="154a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当“<em class="lb">iambroot.domain.com</em>”域名被访问时，从服务器发回的一个响应显示了几个非常“可疑”的参数；类似这样的。</p><blockquote class="lc ld le"><p id="e788" class="kf kg lb kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">" admin":"false "，" allowDeploy":"false "，" allowManage":"false "</p></blockquote><p id="5391" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我很快刷新了站点，在Burp中捕获了相同的请求，并在响应中修改了上述参数的值，如下所示。</p><blockquote class="lc ld le"><p id="2d39" class="kf kg lb kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">" admin":"true "，" allowDeploy":"true "，" allowManage":"true "</p></blockquote><p id="6ed7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嘣！</p><figure class="li lj lk ll gt lm"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="61b0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个“隐藏的”管理员模块出现在屏幕上。该模块开放了25个以上的管理员功能，但问题是每当访问25个以上的功能时，该网站都会将我重定向回登录页面。</p><p id="b301" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">步骤4:未经授权访问管理员功能</strong></p><p id="238c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中一个管理员功能是创建一个新用户，但当我尝试访问该功能时，应用程序将我重定向到登录页面。由于响应修改工作过一次，我认为它会再次工作，因此拦截了相同的请求来检查服务器发送的响应。</p><p id="29bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请求的响应看起来像下面的截图。当访问任何管理员功能时，应用服务器发送回“401未授权”状态代码，从而触发对登录页面的请求。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lp"><img src="../Images/d9d4b237ef112ee14cb6d4ef128ea169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L2mvebMqEQy3dlpPzsYnsQ.png"/></div></div></figure><p id="e310" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我截取了相同的请求，并对响应做了一些小的修改，如下面的截图所示。嘣！</p><p id="9741" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我现在可以查看管理员功能，而无需应用程序将我重定向到登录页面。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lw"><img src="../Images/38e934fb09d37f8de855ec378ca82f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*joMnwLGE7-b4eH_6V_ipIA.png"/></div></div></figure><p id="fe32" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用同样的方法，我可以访问管理员模块中所有可用的功能。但是不出所料，当我尝试提交表单时，应用程序再次将我重定向到登录页面。通过修改响应，我只能绕过客户端验证；应用程序的服务器端验证阻止我成功创建新用户。</p><p id="438a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以这是个死胡同。我所能做的就是对管理员模块和其中的单个功能进行只读访问。我不能在应用程序中提交表单或执行未经授权的操作。</p><figure class="li lj lk ll gt lm"><div class="bz fp l di"><div class="lx lo l"/></div></figure><p id="54c6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">影响，你可能会问。没什么！但是积极的一面是，我可以在服务器验证请求之前查看表单提交请求，从而发回一条“401未授权”的错误消息。</p><p id="2ad5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">步骤5:跨站点请求伪造(CSRF) </strong></p><p id="f5b4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在应用程序请求中观察到的另一件事是缺少请求验证令牌，这可能导致CSRF攻击。现在我知道了管理员表单提交请求的样子，我制作了一个示例CSRF有效负载，当“真正的”管理员被诱骗执行有效负载时，它将创建一个新用户。</p><p id="e050" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第六步:责任披露</strong></p><p id="0fd1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为漏洞披露计划的一部分，我通过电子邮件向公司的安全团队发送了我的观察结果。他们通过以下方式解决问题—</p><ol class=""><li id="35a4" class="ly lz iq kh b ki kj kl km ko ma ks mb kw mc la md me mf mg bi translated">对所有请求应用服务器端验证，从而防止未经身份验证的用户查看管理员模块及其功能。</li><li id="bb2d" class="ly lz iq kh b ki mh kl mi ko mj ks mk kw ml la md me mf mg bi translated">在请求头中添加请求验证令牌。</li><li id="9908" class="ly lz iq kh b ki mh kl mi ko mj ks mk kw ml la md me mf mg bi translated">移除对整个子域的公共访问，因为它看起来像“【iambroot.domain.com】T4”子域，仅供内部使用。</li></ol><p id="0f7c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从字面上什么也没有，但登录页面，我可以访问管理员的功能，并与CSRF链，以显示一些损害。</p><figure class="li lj lk ll gt lm"><div class="bz fp l di"><div class="mm lo l"/></div></figure><p id="b76a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你问我——检查日志。一直都是。检查。日志。</p><h2 id="4429" class="mn mo iq bd mp mq mr dn ms mt mu dp mv ko mw mx my ks mz na nb kw nc nd ne nf bi translated">非常感谢博客上的反馈和见解。欢迎随时发表评论或在<a class="ae ng" href="https://twitter.com/prabhu_ved" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。</h2></div></div>    
</body>
</html>