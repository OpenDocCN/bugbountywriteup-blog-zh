<html>
<head>
<title>Root Me — TryHackMe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Root我— TryHackMe</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/root-me-tryhackme-36bcfe49fd22?source=collection_archive---------0-----------------------#2021-10-29">https://infosecwriteups.com/root-me-tryhackme-36bcfe49fd22?source=collection_archive---------0-----------------------#2021-10-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="403d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">升级的艺术</h2></div><p id="7742" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">欢迎回来神奇的黑客在这个博客中，我带来了另一个有趣的话题<strong class="kh ir"> <em class="lb"> RootMe </em> </strong>演练，这是基于文件上传和获取外壳查找标志。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/dbbed108d2cb4e668c53c9e94831a81a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Evaje5md1cXMV8BN"/></div></div></figure><p id="cbad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不浪费时间，让我们进入演练。首先，我执行了Nmap扫描，无论是否获得了任何有用的信息。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lo"><img src="../Images/0b210396f5423eca2e91473d7b77f5fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46eewfWKSbyTjJGC8Y_NYw.png"/></div></div></figure><p id="9565" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我有两个打开的端口，分别是端口22和80。然后我在浏览器上打开了80条没什么意思的信息。</p><p id="27f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用Gobuster工具搜索任何隐藏目录或一些有用的目录。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lp"><img src="../Images/fe089eb8e4a781e058fa74ef91f6a9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ETrX1B36D3jok4ObpN3L0g.png"/></div></div></figure><p id="0ff5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我找到有用的目录比如<strong class="kh ir">/上传</strong>和<strong class="kh ir">/面板。</strong></p><p id="5836" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在浏览器中重定向到/panel目录并检查信息，我在那里看到一个上传功能。我采取了PHP-逆向shell.php和修改的IP与我的IP和我改变端口号，并开始监听Netcat。</p><blockquote class="lq lr ls"><p id="271b" class="kf kg lb kh b ki kj jr kk kl km ju kn lt kp kq kr lu kt ku kv lv kx ky kz la ij bi translated"><strong class="kh ir"> nc -lvnp 4444 </strong></p></blockquote><p id="a83b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我上传了<strong class="kh ir">PHP-reverse-shell.php</strong>但是很遗憾无法工作。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lw"><img src="../Images/0c87d5550277cf7a492600ada6258204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dD2RnobxmPisxOJvHv40g.png"/></div></div></figure><p id="c85d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我参考了谷歌搜索中的一些绕过技术，它让我绕过。</p><p id="7d85" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而不是。我用的php。phtml扩展。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/a3d13653c52fff01251ab8d1772affaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*s6GJWcp1rddBI2-SITEHpQ.png"/></div></figure><p id="ee9a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我导航到/上传位置，我点击了文件Vola！！！</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/f39ad22ad059d7ddf88f1270495ffee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*s4mQtBdvaDYci3uR4dkXOA.png"/></div></figure><p id="5fae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后用python-c ' import pty；pty . spawn("/bin/bash ")；"用于查找用户标志的权限升级</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lz"><img src="../Images/38423208416248c7cbd1a53aa31c911e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CgboYp6yMlPPwic-REaIFA.png"/></div></div></figure><p id="128f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">find/-在user.txt文件所在的位置键入f -name user.txt</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/162f0312c608d4f7f970d3ec874a22c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*_bJWwm12KEN1lKmPxUSZXg.png"/></div></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/2ea0019a86f83a34f7f3bd92986efd86.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*PpG_JdwT-EXHpf0DSVkBNw.png"/></div></figure><p id="c5f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用上面的命令找到了user.txt的位置。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mc"><img src="../Images/7834d9966380799087083116e010bfed.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*f-AkErFQF3At0vIIaDTFMg.png"/></div></div></figure><p id="ff16" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我浏览了那个位置，找到了用户标志。</p><p id="a3a7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一个任务是找到根标志。我们知道，为了访问根目录，我们需要SUID。</p><p id="a0b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这次我使用的是基于访问根目录的反向shell。</p><p id="c4dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先挖掘目标任何奇怪的文件，以获得对根目录的访问权限</p><p id="db65" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">要查找具有SUID权限的文件，我们可以使用命令:<br/></em><strong class="kh ir"><em class="lb">find/-type f-user root-perm-4000 2&gt;/dev/null</em></strong></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi md"><img src="../Images/8c82bac204f4661aca97f154bca5245a.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*h-D-M6m82y7D9rYwEPwMGQ.png"/></div></figure><p id="c644" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用GTFObins网站的python反向shell来升级SUID权限。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi me"><img src="../Images/f5b6b9849f652217d844af3b37bca933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*umMX8-OGz2sO5TFhy9iNUQ.png"/></div></div></figure><p id="e035" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Python -c '导入OS；os.execl("/bin/sh "，" sh "，"-p ")；"</p><p id="4981" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这让我获得了超级用户权限。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/99d71855605eb39098144608c25f6535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*mxD2777zcNr-d6GpSKLM-g.png"/></div></figure><p id="6f4c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我终于也找到了根旗。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/e006d705c34552ac8e0b5398857119a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*t_EZUKoJUeKHyEziLUPBOg.png"/></div></figure></div></div>    
</body>
</html>