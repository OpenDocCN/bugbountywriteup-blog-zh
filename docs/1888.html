<html>
<head>
<title>TryHackMe: Gallery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe:画廊</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/thmgallery-25845096170d?source=collection_archive---------1-----------------------#2022-02-14">https://infosecwriteups.com/thmgallery-25845096170d?source=collection_archive---------1-----------------------#2022-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7aad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">游戏攻略</p><p id="e88f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好。！不浪费时间，让我们利用画廊-&gt;</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/21591ae51157016552d989b8a2788c7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d6c1gzTZNaqxwOnhYUcNsA.png"/></div></div></figure><p id="cadf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从我的首字母开始</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="69c8" class="lc ld iq ky b gy le lf l lg lh">export IP=10.10.195.122</span></pre></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="d43a" class="lp ld iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">侦察</h1><h2 id="c6f9" class="lc ld iq bd lq mm mn dn lu mo mp dp ly jy mq mr mc kc ms mt mg kg mu mv mk mw bi translated">nmap</h2><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="7e43" class="lc ld iq ky b gy le lf l lg lh">nmap -sC -sV -Pn -oN nmap $IP</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/d4e9a865be4a47aa4d3b585119e81e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*TTX4swbUbDlRq3wNHaYE4w.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">nmap _结果. txt</figcaption></figure><p id="f0fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有两个开放的端口:<code class="fe nc nd ne ky b">80 &amp; 8080</code></p><p id="4c88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">端口80有默认的Apache服务器网页。</p><h2 id="dee8" class="lc ld iq bd lq mm mn dn lu mo mp dp ly jy mq mr mc kc ms mt mg kg mu mv mk mw bi translated">目录暴力破解</h2><p id="1eeb" class="pw-post-body-paragraph jn jo iq jp b jq nf js jt ju ng jw jx jy nh ka kb kc ni ke kf kg nj ki kj kk ij bi translated">让我们一起去玩“捉鬼敢死队”:</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="ccb9" class="lc ld iq ky b gy le lf l lg lh">gobuster dir -u $IP -w /opt/medium.txt</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/c140a20f0240d5c91042df4bc32cadc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:150/format:webp/1*TntFLU3U624VqUFTKSE7Mw.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">gobuster_result.png</figcaption></figure></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="f862" class="lp ld iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">剥削</h1><h2 id="a081" class="lc ld iq bd lq mm mn dn lu mo mp dp ly jy mq mr mc kc ms mt mg kg mu mv mk mw bi translated">SQLi</h2><p id="4a35" class="pw-post-body-paragraph jn jo iq jp b jq nf js jt ju ng jw jx jy nh ka kb kc ni ke kf kg nj ki kj kk ij bi translated">访问http://$IP/gallery，我们有登录页面</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/c190f55c1ae9bea5519cca312b1e603f.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*Xz5LoKjbT4rMK2uoinstag.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">login_page.png</figcaption></figure><ul class=""><li id="ee9f" class="nm nn iq jp b jq jr ju jv jy no kc np kg nq kk nr ns nt nu bi translated">尝试了一些默认密码→没有成功。</li><li id="3534" class="nm nn iq jp b jq nv ju nw jy nx kc ny kg nz kk nr ns nt nu bi translated">尝试基本sqli语法→成功</li></ul><p id="0805" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在用户名字段中</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="302f" class="lc ld iq ky b gy le lf l lg lh">'or 1=1 -- -</span></pre><p id="8493" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将密码留空，我们就可以登录了:)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oa"><img src="../Images/485db2e711dfa2e7f057a738b95a0de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NDr8K4NGigcXsX9ydVfH7A.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">Post_login.png</figcaption></figure><p id="e14d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，有一个简单的图像画廊系统，即sqli(参考下文)的利用</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/8d16a4deac9417d2dffae29213653447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*Rt6Fm0bLhdScCTJgmVSv-Q.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">brup.png</figcaption></figure><p id="b248" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们保存这个<code class="fe nc nd ne ky b">right_click&gt;save&gt;test.req </code> &amp;把它放入<strong class="jp ir"> sqlmap </strong></p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="1b5c" class="lc ld iq ky b gy le lf l lg lh">sudo sqlmap -r test.req --dbs</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/22a216ee12bd28e2ce307f57ca5d78d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*CPLJmzCb6P0mlAbfSFQlRw.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">sqlmap.png</figcaption></figure><p id="ad6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们发现了两个数据库:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi od"><img src="../Images/2cf5e176ae264decedcf75bdf8ba6ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:374/format:webp/1*QSQz2vOEL6TecWhdxqthgg.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">database.png</figcaption></figure><p id="a4e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在去拿桌子:</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="5130" class="lc ld iq ky b gy le lf l lg lh">sudo sqlmap -r test.req --current-db gallery_db --tables</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/86b6de263abef4db546c30ff44709a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*giGSVCdlmqHyH5wIHflyYA.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">tables.png</figcaption></figure><p id="f9b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在获取列:</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="0dfb" class="lc ld iq ky b gy le lf l lg lh">sudo sqlmap -r test.req --current-db gallery_db -T users --columns</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi of"><img src="../Images/d48d954d0d9ed311b00325df4cc74e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/format:webp/1*sLVkXoyRIT_kH1e1JlIxdg.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">列</figcaption></figure><p id="da7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们转储一些数据</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="998e" class="lc ld iq ky b gy le lf l lg lh">sudo sqlmap -r test.req --current-db gallery_db -T users -C username,password --dump</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/7432c18a12496d8248b4c15775e48cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*pcHjeQC4CrNvFBxI8yu3pw.png"/></div></figure><p id="0c00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们发现了管理哈希(我们可以破解，但这是一个兔子洞)</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h2 id="64ab" class="lc ld iq bd lq mm mn dn lu mo mp dp ly jy mq mr mc kc ms mt mg kg mu mv mk mw bi translated">壳</h2><p id="f04d" class="pw-post-body-paragraph jn jo iq jp b jq nf js jt ju ng jw jx jy nh ka kb kc ni ke kf kg nj ki kj kk ij bi translated">经过一番冲浪，发现可以上传图片(/任意文件)。我启动了我的监听器并上传了php文件，我们得到了<strong class="jp ir">外壳</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oh"><img src="../Images/2a0aaba43f96239e931bf6287b1c45aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xyhj0cwrqoafNnjCnSy1fA.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">Shell.png</figcaption></figure><h2 id="3d3d" class="lc ld iq bd lq mm mn dn lu mo mp dp ly jy mq mr mc kc ms mt mg kg mu mv mk mw bi translated">user.txt</h2><p id="39e8" class="pw-post-body-paragraph jn jo iq jp b jq nf js jt ju ng jw jx jy nh ka kb kc ni ke kf kg nj ki kj kk ij bi translated">我花了大约4个多小时来寻找各种特权提升技术，但是什么也没找到。</p><p id="fbc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">后来我的朋友给了我一些提示，然后我在备份文件夹里发现了一些有趣的凭据:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/720a2c3d0edcce6318745bedb35b3572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*3932nFwp28I8-oeW9PZZZw.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">兔子洞. png</figcaption></figure><p id="605b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再说一次，这些只是兔子洞，没关系。</p><p id="0f95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们继续，后来我发现了。bash _历史</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/345ffca0cc51533de66d562515144613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*N1Mg7m2Z-taXQ2l8sPJeig.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">。bash_history.png</figcaption></figure><p id="9723" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里您可以看到用户mike的密码。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="8919" class="lc ld iq ky b gy le lf l lg lh">su mike</span></pre><p id="108e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入密码，我们是迈克·:D</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/cf7a2878784d32e97ef7be2f1392f929.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*z8YKCBWPNU8gOeKVfCWCvA.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">user.txt.png</figcaption></figure><h1 id="36e1" class="lp ld iq bd lq lr ol lt lu lv om lx ly lz on mb mc md oo mf mg mh op mj mk ml bi translated">根</h1><h2 id="3454" class="lc ld iq bd lq mm mn dn lu mo mp dp ly jy mq mr mc kc ms mt mg kg mu mv mk mw bi translated">root.txt</h2><p id="8dbe" class="pw-post-body-paragraph jn jo iq jp b jq nf js jt ju ng jw jx jy nh ka kb kc ni ke kf kg nj ki kj kk ij bi translated">跑着<code class="fe nc nd ne ky b">sudo -l</code>，我们发现</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oq"><img src="../Images/f7e33eb9631ad3c183df64e91ae37abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P4WFxviYUfECCdNQVzhcGQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">须岛县</figcaption></figure><p id="153c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户mike可以sudo身份运行/opt/rookit.sh文件</p><p id="faaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们检查一下这个文件:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi or"><img src="../Images/819740fa661b6daed498a591cf7afdbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*AkIxMoHO10yMB2NhG6H-Iw.png"/></div></figure><p id="4462" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，我们可以通过nano访问esc，查看GTFObins</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="a3a8" class="lc ld iq ky b gy le lf l lg lh">sudo /bin/bash /opt/rootkit.sh</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/c08554a0d977bb9273e573b2a78630f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*24ulUUOXqCtM57Lp8rnF_Q.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">纳米私人ECS technique.png</figcaption></figure><p id="91f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后都是urs:)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/56de5c7d5a16d399bad55d7177ea297b.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*Ue7kU1ufbSWYV8qkk3br_Q.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">root.txt</figcaption></figure><p id="1d42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您阅读本文。希望你喜欢。</p><h1 id="e5f2" class="lp ld iq bd lq lr ol lt lu lv om lx ly lz on mb mc md oo mf mg mh op mj mk ml bi translated">参考资料:</h1><p id="73c4" class="pw-post-body-paragraph jn jo iq jp b jq nf js jt ju ng jw jx jy nh ka kb kc ni ke kf kg nj ki kj kk ij bi translated">|| <a class="ae ou" href="https://namx05.github.io/" rel="noopener ugc nofollow" target="_blank">网站</a>|<a class="ae ou" href="https://twitter.com/namx05" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae ou" href="https://gtfobins.github.io/" rel="noopener ugc nofollow" target="_blank">GTFObins</a>|<a class="ae ou" href="https://tryhackme.com/room/gallery666" rel="noopener ugc nofollow" target="_blank">THM Room</a>|<a class="ae ou" href="https://www.exploit-db.com/exploits/50198" rel="noopener ugc nofollow" target="_blank">SQLi exploit</a>| |</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="9bb7" class="lp ld iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae ou" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="ov ow gp gr ox oy"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd ir gy z fp pd fr fs pe fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">iwcon.live</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm kv oy"/></div></div></a></div></div></div>    
</body>
</html>