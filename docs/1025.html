<html>
<head>
<title>Doctor: HackTheBox Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">医生:黑客盒子演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/doctor-htb-walkthrough-70bcb9eedefd?source=collection_archive---------0-----------------------#2020-12-15">https://infosecwriteups.com/doctor-htb-walkthrough-70bcb9eedefd?source=collection_archive---------0-----------------------#2020-12-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="569c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">描述</h2></div><p id="ec94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">博士是<a class="ae le" href="https://app.hackthebox.eu/machines/278" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">上一个不错的VM黑客盒子</strong> </a> <strong class="kk iu">。</strong>我必须说HTB上的简单盒子比TryHackMe上的中等盒子更难懂。只需在/etc/hosts文件中添加doctors.htb，就可以了。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/9353e222ce7aaead0eed0e179538305e.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/1*SpAGThEMkakx5hpTrxZZ5Q.gif"/></div></figure><blockquote class="ln lo lp"><p id="cc1e" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated">获得的知识</p></blockquote><ol class=""><li id="be8b" class="lu lv it kk b kl km ko kp kr lw kv lx kz ly ld lz ma mb mc bi translated">列举</li><li id="3b40" class="lu lv it kk b kl md ko me kr mf kv mg kz mh ld lz ma mb mc bi translated">服务器端模板注入</li><li id="0e9c" class="lu lv it kk b kl md ko me kr mf kv mg kz mh ld lz ma mb mc bi translated">在<strong class="kk iu">中获得反向外壳的两种方式</strong></li><li id="c6a2" class="lu lv it kk b kl md ko me kr mf kv mg kz mh ld lz ma mb mc bi translated">枚举adm相关文件</li><li id="5869" class="lu lv it kk b kl md ko me kr mf kv mg kz mh ld lz ma mb mc bi translated">使用SplunkWhisperer2提升权限</li></ol><blockquote class="ln lo lp"><p id="fd48" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated">端口扫描</p></blockquote><p id="4986" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">像往常一样，首先用Nmap扫描网络，寻找开放的端口和服务。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/1109764a552d001c63a79859cd89feb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aV5WG7m0uyJ4pauk-d-SBA.png"/></div></div></figure><blockquote class="ln lo lp"><p id="6f57" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated">网络侦察</p></blockquote><p id="ce4d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们先列举一下80端口。我决定启动一个gobuster扫描，得到了一些有用的东西。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mn"><img src="../Images/febbf475dd6d0d466f637578f8874b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lh7hYLAfv1NLox7iQvfzOw.png"/></div></div></figure><p id="6480" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们有一个登录门户。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mo"><img src="../Images/aba07e6bf6028ed30a1a2d18ef02aab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQxJSurLoTIxEEdEZCCH8Q.png"/></div></div></figure><p id="e31c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我先试着去了SQL注入，但是什么也没发生。然后我注册了一个新账号，这次我很幸运。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mp"><img src="../Images/c0c97c8d0ef60958ce49c379fc31a1cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wvXFbTAsUabM7eerLkR1Vg.png"/></div></div></figure><p id="d928" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，如果你记得我们在目录扫描中得到URI<strong class="kk iu">/存档</strong>。我打开了它，但什么也没有，但页面源有一些有用的东西。无论我在<strong class="kk iu">“新消息”</strong> - &gt; <strong class="kk iu">标题</strong>字段中键入什么，都会在/archive页面源中得到反映。</p><blockquote class="ln lo lp"><p id="c8d3" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated">了解服务器端模板注入</p></blockquote><p id="4da4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Web应用程序经常使用模板系统，如<a class="ae le" href="http://twig.sensiolabs.org/" rel="noopener ugc nofollow" target="_blank"> Twig </a>和<a class="ae le" href="http://freemarker.org/" rel="noopener ugc nofollow" target="_blank"> FreeMarker </a>在网页和电子邮件中嵌入动态内容。当用户输入以不安全的方式嵌入模板时，就会发生模板注入。在模板中不安全地嵌入用户输入使得<a class="ae le" href="https://portswigger.net/web-security/server-side-template-injection" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">服务器端模板注入</strong> </a>，这是一个非常容易被误认为<a class="ae le" href="https://portswigger.net/web-security/cross-site-scripting" rel="noopener ugc nofollow" target="_blank">跨站脚本</a> (XSS)或完全遗漏的致命漏洞。模板注入可能是由开发人员的错误引起的，也可能是为了提供丰富的功能而故意暴露模板引起的，就像维基、博客、营销应用程序和内容管理系统通常所做的那样。一些最常用的服务器端模板引擎有<strong class="kk iu"> Smarty、樱井真子、Twig和Jinja2。</strong></p><p id="d021" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">到目前为止，我们知道它容易受到SSTI漏洞的攻击，但我们不知道这里使用的是哪种模板。</p><blockquote class="ln lo lp"><p id="3a44" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated"><strong class="kk iu">识别模板方法1 </strong></p></blockquote><p id="9b10" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此图显示了如何识别模板类型的步骤。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/b42c273a73398db32330850d7a2d0fb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*5KIQYet7HMuknUcl7Ooz7g.png"/></div></figure><p id="8467" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在标题字段{ 5 * 5 }--&gt; { { 5 * 5 } }--&gt; { { 5 * ' 5 ' } }--&gt;结果55555中输入。这证明我们有Jinja2。</p><blockquote class="ln lo lp"><p id="b421" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated"><strong class="kk iu">识别模板方法2 </strong></p></blockquote><p id="3380" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这一次我们有了一个工具可以为我们做这件事，但我们也应该知道手动过程【https://github.com/epinna/tplmap<a class="ae le" href="https://github.com/epinna/tplmap" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu"/></a></p><p id="0469" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">只需输入命令<strong class="kk iu">。/TPL map . py-u '</strong><a class="ae le" href="http://doctors.htb/home\?page\=1'" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">http://doctors.htb/home\?page\=1'</strong></a><strong class="kk iu"/>你就能知道所用的模板名了。从这里我们可以得到<strong class="kk iu">反壳</strong>也但是我失败了。你可以试试这个。</p><blockquote class="ln lo lp"><p id="ecb8" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated">获得反向外壳-方法1</p></blockquote><p id="6431" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们已经有了足够的反向外壳信息。使用<a class="ae le" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#methodology" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">python payload</strong></a>，只修改IP_address。发布消息…</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mr"><img src="../Images/e86fd1cac9b3b30b6d7834af046e8c7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tNYacIg2NwxMW63Da1K49A.png"/></div></div></figure><p id="6902" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">…并刷新<strong class="kk iu">URI/档案库</strong>，启动一个新的终端并监听连接。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ms"><img src="../Images/79609efbc3bd66b9dcbca62b087ce8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ozc_jgNQsHngDOWZlSR73w.png"/></div></div></figure><blockquote class="ln lo lp"><p id="2357" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated">获得反向外壳-方法2</p></blockquote><p id="3d85" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在搜索这篇文章的时候，我在youtube上看到了一个视频，显示了利用<strong class="kk iu">内容字段</strong>来获得一个反向外壳。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mt"><img src="../Images/93708fa0eb41ffb72d2bf1005fa7a88a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p1JtLyY1ZmiEMcx5_kkPtQ.png"/></div></div></figure><p id="a819" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我不知道怎么做，但如果有人知道，请在评论区向我解释。</p><p id="e5e5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">继续，我列举了机器，显示我们有一个用户名shaun。有一点需要注意的是，我们在团体中有(adm)。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/6edc7efd4c4ba35481456437e2561a25.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*unDZw3cBcVNBWXlH81YxZQ.png"/></div></figure><p id="35ca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在网上搜了一下，得知<a class="ae le" href="https://superuser.com/questions/86347/whats-difference-between-group-admin-and-adm" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> adm </strong> </a>是Ubuntu上一个只对查看/var/log(历史上曾叫/var/adm)中所有日志文件有好处的组。</p><p id="ff7a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">导航到/var/log/apache2路径并获得文件<strong class="kk iu">备份。</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mv"><img src="../Images/4e342fc068ca0f9ababdc52350507c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RYYGSKFnmDoOEDRYzSXy3Q.png"/></div></div></figure><p id="1a09" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于这是一个备份文件，我试图通过<strong class="kk iu"> grep获取用户shaun的凭证。</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mw"><img src="../Images/d65dd0063dd2b4ffc8b8182670ee43d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NuUJYpEfYQbtLXSsAV07LQ.png"/></div></div></figure><blockquote class="ln lo lp"><p id="71d6" class="ki kj lq kk b kl km ju kn ko kp jx kq lr ks kt ku ls kw kx ky lt la lb lc ld im bi translated">权限提升</p></blockquote><p id="02a6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">切换到shaun帐户，并尝试他是否有sudo权限，但没有任何有用的东西，而是首先访问第一个flag <strong class="kk iu"> /home/shaun </strong>路径。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/768067d1d095c30024de33c4218fb320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*iY1xyzrfEaZGV38XF-mXvw.png"/></div></figure><p id="3bbe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在互联网上搜索如何滥用Splunk来提升特权，我创建了一个不错的<a class="ae le" href="https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">博客</strong> </a> <strong class="kk iu"> </strong>，它指引我使用<strong class="kk iu"/><a class="ae le" href="https://github.com/cnotin/SplunkWhisperer2" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">pysplunkwhisper 2</strong></a><strong class="kk iu">。</strong></p><p id="36d2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">克隆该工具，像我一样指定有效负载，并在新的终端中监听传入的连接。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi my"><img src="../Images/aa891afe4f3b6474fb3bbefca0fe60a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BU96b6GLnwat0a_eBrPyXw.png"/></div></div></figure><p id="ad88" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好了，我们现在有了根访问权限。导航到最后一个标志的/根目录。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/e87081562e611b526d763c897afc2419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*JfMCPgG1kt88dNpwoIowOA.png"/></div></figure><p id="3444" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如需更多演练，请继续关注…</p><h1 id="db69" class="na nb it bd nc nd ne nf ng nh ni nj nk jz nl ka nm kc nn kd no kf np kg nq nr bi translated">在你走之前</h1><p id="7b63" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr nu kt ku kv nv kx ky kz nw lb lc ld im bi translated">访问我的Funbox系列漫游的:-</p><div class="nx ny gp gr nz oa"><a href="https://shubham-singh.medium.com/funbox-7-easyenum-walkthrough-vulnhub-3c1ef0f1c2ef" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">FUNBOX-7: EASYENUM漫游(Vulnhub)</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">描述</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">shubham-singh.medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ll oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://github.com/Mr-Lazzy/Funbox-Walkthrough-s" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">懒虫先生/fun box-漫游-s</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="op l ol om on oj oo ll oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://github.com/Mr-Lazzy/Vulnhub_Walkthrough" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd iu gy z fp of fr fs og fu fw is bi translated">懒人先生/Vulnhub _演练</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">GitHub是超过5000万开发人员的家园，他们一起工作来托管和审查代码、管理项目和构建…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="oq l ol om on oj oo ll oa"/></div></div></a></div><p id="5e63" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">鼓掌👏如果你喜欢你所读的。欢迎反馈。</p></div></div>    
</body>
</html>