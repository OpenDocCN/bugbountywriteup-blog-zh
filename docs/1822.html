<html>
<head>
<title>Demystifying JA3: One Handshake at a Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭秘JA3:一次一个握手</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/demystifying-ja3-one-handshake-at-a-time-c80b04ccb393?source=collection_archive---------0-----------------------#2022-01-22">https://infosecwriteups.com/demystifying-ja3-one-handshake-at-a-time-c80b04ccb393?source=collection_archive---------0-----------------------#2022-01-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="261c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近我在用BurpSuite浏览一个网站，发现这个网站屏蔽了我的请求。为了解开这个秘密，我无意中发现了一种不可思议的TLS指纹技术，叫做JA3。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="35b1" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">背景</h1><p id="01ad" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">对客户端进行指纹识别并根据一组特定的规则阻止它们并不新鲜。许多公司确实有智能的方法来识别客户(一个原因是检测机器人和恶意流量)，通过使用cookie来唯一地跟踪用户。2013年斯诺登泄密后，<a class="ae lv" href="https://www.eff.org/deeplinks/2013/11/encrypt-web-report-whos-doing-what" rel="noopener ugc nofollow" target="_blank">许多网站</a>开始默认采用HTTPS版本。<a class="ae lv" href="https://tlseminar.github.io/tls-outside-the-web/" rel="noopener ugc nofollow" target="_blank">许多应用</a>像恶意软件，物联网设备也使用TLS安全地连接到服务器。因此，TLS协议的流行和广泛应用导致了研究和发现新的方法来对用户进行独特的指纹识别。</p><h2 id="ef06" class="lw kt iq bd ku lx ly dn ky lz ma dp lc jy mb mc lg kc md me lk kg mf mg lo mh bi translated">HTTPS连接是如何工作的？</h2><p id="fa19" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">简而言之，HTTPS是两种东西的结合:</p><ul class=""><li id="72bc" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">TCP(传输控制协议)—三次握手</li><li id="7373" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">TLS(传输层安全性)客户端-服务器协商</li></ul><p id="f1bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TCP握手，也称为三次握手，是客户端和服务器建立TCP会话的过程。下图说明了如何建立TCP连接。</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/e347d8612ee62a4e0c0ff01527ba3cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/1*o2li9Wsfamo4SbOJv89qpg.gif"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">TCP三向握手</figcaption></figure><p id="0278" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> TCP三次握手</strong></p><ul class=""><li id="367b" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">客户端发送SYN(同步序列号)，通知服务器开始通信。</li><li id="9818" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">服务器发送SYN-ACK(确认)集。ACK —表示信号已被接收，并同步到序列号，它必须以该序列号开始下一个数据段</li><li id="2f2a" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">客户端用作为确认的ACK包进行响应，因此进一步的通信继续进行。</li></ul><p id="4a97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这发生在OSI模型 的<a class="ae lv" href="https://networkengineering.stackexchange.com/a/23539" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">层4。</strong></a></p><p id="4814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> TLS客户端-服务器协商</strong></p><p id="10f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lv" href="https://tls13.ulfheim.net/" rel="noopener ugc nofollow" target="_blank"> TLS握手</a>是一系列步骤，在这些步骤中，客户端和服务器就加密算法、协议版本达成一致，并通过交换和验证密钥来相互认证。这个过程可以自我解释如下:</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/e99023212b293b873e1f22bdcf07a769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/0*5iPRSSnHYNa22GPI.gif"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">TLS握手过程— <a class="ae lv" href="https://www.ibm.com/docs/en/ibm-mq/7.5?topic=ssl-overview-tls-handshake" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="d1ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，这个过程发生在OSI模型的<a class="ae lv" href="https://wentzwu.com/2020/08/21/what-osi-layer-does-tls-operate-and-why/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">会话层(第5层)</strong> </a>中</p><p id="98e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">TLS指纹识别的起源</strong></p><p id="7cf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">早期的TLS指纹研究来自于<a class="ae lv" href="https://twitter.com/synackpse" rel="noopener ugc nofollow" target="_blank">李兄弟</a> <a class="ae lv" href="https://blog.squarelemon.com/tls-fingerprinting/" rel="noopener ugc nofollow" target="_blank">博客</a>，后来，工程师在<a class="ae lv" href="https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967" rel="noopener ugc nofollow" target="_blank"> Salesforce </a> <a class="ae lv" href="https://twitter.com/4A4133" rel="noopener ugc nofollow" target="_blank">约翰·奥尔豪斯</a>，<a class="ae lv" href="https://twitter.com/4a7361" rel="noopener ugc nofollow" target="_blank">杰夫·阿特金森</a>，<a class="ae lv" href="mailto:josh@ascendantcom.com" rel="noopener ugc nofollow" target="_blank">乔希·阿特金斯</a>即兴创作了JA3和JA3S。JA3可以被认为是现代的用户代理，以前用于通过HTTP连接跟踪用户。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="22be" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">JA3</h1><p id="98ca" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">JA3是在使用TLS连接服务器的客户机上执行的指纹识别机制。这是通过对在TLS协商过程的第一步中接收的ClientHello数据包执行一系列操作来完成的。</p><p id="16cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">早些时候，许多网站基于用户代理来采集用户的指纹。在最近的时间里，它花了几秒钟来模仿它，JA3 fingerprint是一个很少为人所知的指纹解决方案，被许多公司使用，如在其bot管理工具中使用的<a class="ae lv" href="https://github.com/cloudflare/cloudflare-docs/blob/production/products/bots/src/content/concepts/ja3-fingerprint.md#analytics" rel="noopener ugc nofollow" target="_blank"> Cloudflare </a>。</p><h2 id="20f4" class="lw kt iq bd ku lx ly dn ky lz ma dp lc jy mb mc lg kc md me lk kg mf mg lo mh bi translated">JA3是如何计算的？</h2><p id="5adf" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">让我们首先研究ClientHello包，以理解JA3是如何计算的:</p><p id="e047" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据TLSv1.2的<a class="ae lv" href="https://tools.ietf.org/html/rfc5246/" rel="noopener ugc nofollow" target="_blank"> RFC5246 </a>，ClientHello数据包定义为</p><pre class="mx my mz na gt nj nk nl nm aw nn bi"><span id="4031" class="lw kt iq nk b gy no np l nq nr">struct {<br/>          ProtocolVersion client_version;<br/>          Random random;<br/>          SessionID session_id;<br/>          CipherSuite cipher_suites&lt;2..2^16-2&gt;;<br/>          CompressionMethod compression_methods&lt;1..2^8-1&gt;;<br/>          select (extensions_present) {<br/>              case false:<br/>                  struct {};<br/>              case true:<br/>                  Extension extensions&lt;0..2^16-1&gt;;<br/>          };<br/>      } ClientHello;</span></pre><p id="d2b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那里</p><ul class=""><li id="929e" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">client_version —客户端支持的最高TLS协议版本</li><li id="b61c" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">随机—客户端生成的随机结构。</li><li id="51aa" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">session_id —客户端希望用于此连接的会话的id。</li><li id="b664" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">cipher_suites —客户端支持的加密选项列表<em class="ns">，首先是客户端的首选项。</em></li><li id="76fd" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">compression_methods —客户端支持的压缩方法列表，<em class="ns">按客户端偏好排序。</em></li><li id="0129" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">扩展—这是一个可选字段，客户可以请求扩展功能。</li></ul><p id="9cb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">扩展字段可以有在<a class="ae lv" href="https://datatracker.ietf.org/doc/html/rfc4492" rel="noopener ugc nofollow" target="_blank"> RFC4492 </a>中定义的<code class="fe nt nu nv nk b">EllipticCurve,EllipticCurvePointFormat</code>。因此，考虑到所有这些因素，我们可以有超过<a class="ae lv" href="https://httptoolkit.tech/blog/tls-fingerprinting-node-js/" rel="noopener ugc nofollow" target="_blank"> 2万亿种</a>的方式来发送ClientHello消息</p><pre class="mx my mz na gt nj nk nl nm aw nn bi"><span id="a8e7" class="lw kt iq nk b gy no np l nq nr"><strong class="nk ir">CipherPermutations = 20!<br/>ExtensionPermutations = 15!<br/>CurvePermutations = 4!<br/>CurveFormatPermutations = 3!<br/>TotalPermutations = 20! + 15! + 4! + 3! = 2432903315851008030</strong></span></pre><p id="7213" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">独特的方式来单独识别和指纹客户。</p><p id="d998" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">JA3是使用从如上定义的ClientHello分组中获取的以下5个参数来计算的:</p><pre class="mx my mz na gt nj nk nl nm aw nn bi"><span id="9487" class="lw kt iq nk b gy no np l nq nr">SSLVersion,Cipher,SSLExtension,EllipticCurve,EllipticCurvePointFormat</span></pre><blockquote class="nw nx ny"><p id="3026" class="jn jo ns jp b jq jr js jt ju jv jw jx nz jz ka kb oa kd ke kf ob kh ki kj kk ij bi translated"><a class="ae lv" href="https://github.com/salesforce/ja3#how-it-works" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> JA3 </em> </a> <em class="iq">收集客户端Hello包中以下字段的十进制字节值；</em> SSL版本、接受的密码、扩展列表、椭圆曲线和椭圆曲线格式<em class="iq">。然后，它将这些值按顺序连接在一起，使用“，”分隔每个字段，使用“-”分隔每个字段中的每个值。</em></p></blockquote><p id="85f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着TLS 1.2的升级，<a class="ae lv" href="https://datatracker.ietf.org/doc/html/rfc4492" rel="noopener ugc nofollow" target="_blank"> RFC4492 </a>被修改为<a class="ae lv" href="https://datatracker.ietf.org/doc/html/rfc8422" rel="noopener ugc nofollow" target="_blank"> RFC8422 </a>，椭圆曲线字段被进一步称为<em class="ns"> supported_groups </em>，因此我们使用Wireshark数据包中的该字段来计算JA3。</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oc"><img src="../Images/86a727f2fd09d3626118ea2ffc1e30b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0MatwNJfAmP-pR5VNlewAA.gif"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">来自TLS <strong class="bd ku"> ClientHello </strong>数据包的JA3计算步骤</figcaption></figure><p id="0715" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GREASE(生成随机扩展并保持可扩展性)是由谷歌推出的IETF草案<a class="ae lv" href="https://tools.ietf.org/html/draft-davidben-tls-grease-00" rel="noopener ugc nofollow" target="_blank">定义的一种技术，用于防止TLS生态系统中的可扩展性故障。它会在ClientHello数据包中引入无效的随机值，但不会产生任何影响，并确保所有新编写的代码都能处理意外值。对于JA3指纹的计算，我们忽略这一点。</a></p><p id="c5cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> BurpSuite！？两个指纹？</strong></p><p id="0bbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在进一步调查时，我发现BurpSuite有如下两个指纹:</p><ul class=""><li id="bb0d" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated"><strong class="jp ir">第一包</strong>—2d 5 BD 942 ebf 308 df 61 e 1572861d 146 f 6(771，4866–4865–4867–49196–49195–52393–49200–52392–49199–159–52394–163–158–162–49188–49192–49192</li><li id="e3ca" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><strong class="jp ir">下一个连续数据包</strong>—EB 5 FDC 72 f 0a 76657 DC 6 ea 233190 C4 e1c(771，4866–4865–4867–49196–49195–52393–49200–52392–49199–159–52394–163–158–162–49188–49192–4992</li></ul><p id="e926" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是Wireshark数据包的实际差异(ClientHello数据包的扩展文件部分)</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oh"><img src="../Images/74512364b8e6ff931241a4a4edabb4bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Oh3cN-QgTNKz2XayP7yVw.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">BurpSuite发送的两个数据包的差异</figcaption></figure><p id="15a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第一个数据包中，我们可以观察到RFC7301中定义的一个名为<em class="ns">的附加字段。它包含客户端支持的协议id列表。</em></p><p id="39ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如<a class="ae lv" href="https://datatracker.ietf.org/doc/html/rfc7301#section-1" rel="noopener ugc nofollow" target="_blank"> RFC7301 </a>中所定义:</p><p id="838e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">"<em class="ns">当在单个服务器- <br/>侧端口号(例如端口443)上支持多个应用协议时，客户端和服务器需要<br/>协商用于每个连接的应用协议。希望在不增加客户端和服务器之间的网络往返的情况下完成这种协商，因为每次往返都会降低最终用户的体验。此外，基于协商的<br/>应用协议</em>允许证书选择将是<br/>有利的</p><p id="e1e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于这个原因，为BurpSuite生成了两个JA3指纹，不像任何其他浏览器在每个包中实际发送<em class="ns">应用层协议协商</em>。为什么？<a class="ae lv" href="https://twitter.com/0xrtt/status/1483135631782182913?s=20" rel="noopener ugc nofollow" target="_blank">大概需要问问BurpSuite的创作者了。</a></p><p id="df2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ja3er.com<strong class="jp ir">—</strong>这个网站<strong class="jp ir">不应该被用来寻找你的JA3指纹</strong>，因为它给出了一个错误的JA3值，正如这个<a class="ae lv" href="https://github.com/salesforce/ja3/issues/71" rel="noopener ugc nofollow" target="_blank"> Github问题</a>和<a class="ae lv" href="https://twitter.com/kingbase/status/1420683077878124545" rel="noopener ugc nofollow" target="_blank">这个tweet </a>所描述的。为了让您有个概念，您可以检查如下所示的差异:</p><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/1187c0d2bb147c1387a8f0a748e7ff62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*kDs7Y9mAVQRIZF7gqSm36Q.png"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">ja3er.com生成的JA3指纹的差异</figcaption></figure><h1 id="4ca6" class="ks kt iq bd ku kv oj kx ky kz ok lb lc ld ol lf lg lh om lj lk ll on ln lo lp bi translated">JA3s和JARM</h1><p id="a4db" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">我们从客户端发送的ClientHello数据包收到的响应数据包是ServerHello数据包，这可用于使用ServerHello消息的以下字段计算唯一指纹:</p><p id="7239" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe nt nu nv nk b">TLSVersion,Cipher,Extensions</code></p><p id="01b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例:</p><p id="d428" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe nt nu nv nk b">md5(769,47,65281–0–11–35–5–16) = </code>4835 b19f 14997673071435 CB 321 f 5445</p><p id="22a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务器将对不同的客户端做出不同的响应，它们将始终对相同的客户端做出相同的响应。</p><p id="b4aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，JA3和JA3s是更被动的指纹检测方法，但更积极的方法是JARM。</p><p id="8e4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在JARM，我们发送10个特制的TLS数据包，以获得具有不同协议版本和密码的服务器的最独特的响应。此外，JARM指纹散列是混合模糊散列；它使用可逆和不可逆散列算法的组合来产生62个字符的指纹，而不像JA3、JA3S那样使用MD5。你可以在这里阅读关于JARM<a class="ae lv" href="https://engineering.salesforce.com/easily-identify-malicious-servers-on-the-internet-with-jarm-e095edac525a" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><p id="7353" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用JARM指纹在互联网上搜索服务器，以使用以下引擎找到特定恶意软件使用的C&amp;C服务器之类的东西:</p><ul class=""><li id="f6f0" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">Shodan.io在<a class="ae lv" href="https://www.shodan.io/search?query=ssl.jarm%3A07d14d16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1" rel="noopener ugc nofollow" target="_blank">这里</a></li><li id="13ca" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><a class="ae lv" href="https://securitytrails.com/" rel="noopener ugc nofollow" target="_blank">安全轨道</a></li><li id="fb74" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><a class="ae lv" href="https://www.binaryedge.io/" rel="noopener ugc nofollow" target="_blank">二进制边缘</a></li><li id="95e4" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><a class="ae lv" href="https://www.riskiq.com/blog/external-threat-management/jarm-incident-response/" rel="noopener ugc nofollow" target="_blank"> RiskIQ </a></li><li id="fec0" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><a class="ae lv" href="https://medium.com/palo-alto-networks-developer-blog/fingerprinting-ssl-servers-using-jarm-and-python-6d03f6d38dec" rel="noopener">帕洛阿尔托网络公司</a></li><li id="9ec0" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><a class="ae lv" href="https://censys.io/" rel="noopener ugc nofollow" target="_blank"> Censys </a></li><li id="61d0" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated"><a class="ae lv" href="https://wangzhan.360.cn/296.html" rel="noopener ugc nofollow" target="_blank"> 360 </a></li></ul><h2 id="be76" class="lw kt iq bd ku lx ly dn ky lz ma dp lc jy mb mc lg kc md me lk kg mf mg lo mh bi translated">含义和应用</h2><p id="0d7e" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">JA3和JA3s使用MD5散列来识别数据包，不像JARM使用模糊散列来识别发出请求的客户端。使用MD5有一些安全隐患，如哈希冲突，但是作者使用MD5来支持旧客户端，并建议记录整个字符串(MD5哈希完成之前的字符串)以供进一步分析。此外，在某些情况下，一些浏览器可能有相同的JA3指纹，使它们难以识别。尽管如此，浏览器支持的密码顺序在最近的每一个版本中都有所改变，这使得指纹识别变得很容易。</p><p id="3c7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，随着<strong class="jp ir"> ECH — </strong> <a class="ae lv" href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-esni" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">加密客户端Hello </strong> </a>的引入，这种指纹识别只能在服务器端对分组进行解密之后执行，而不是由参与分组从客户端到服务器的明文传输的每个实体进行指纹识别。</p><p id="6b8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些令人兴奋的应用如下:</p><ul class=""><li id="8d5b" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">基于JA3指纹重定向特定于端点的流量，并通过扩展<a class="ae lv" href="https://github.com/fooinha/nginx-ssl-ja3" rel="noopener ugc nofollow" target="_blank">这个</a>项目只允许特定的JA3指纹。</li><li id="72b0" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">拦截Bot、DDOS流量(<a class="ae lv" href="https://developers.cloudflare.com/bots/concepts/ja3-fingerprint" rel="noopener ugc nofollow" target="_blank"> Cloudflare </a>会这么做)，在某些情况下也会拦截连接。</li><li id="2176" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">JA3广泛用于采集指纹，并追踪恶意软件C&amp;C。<a class="ae lv" href="https://sslbl.abuse.ch/" rel="noopener ugc nofollow" target="_blank">https://sslbl.abuse.ch/</a>包含恶意JA3指纹的签名，供蓝队在其网络中阻止这些指纹。</li><li id="daa3" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">WAF阻止BurpSuite流量，以防止被黑客攻击:D(在我的情况下)</li></ul><figure class="mx my mz na gt nb gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/3c4b8bebab766109d8494e2e6c3a95c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*UjuGnWDV4l3FPRuvgAma6g.jpeg"/></div></figure><p id="154e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，“<em class="ns">没有什么是防黑客攻击的</em>”，是的，你也可以模仿你的TLS应用程序发送的JA3指纹，如<a class="ae lv" href="https://cucyber.net/" rel="noopener ugc nofollow" target="_blank"> CU Cyber </a>在<a class="ae lv" href="https://medium.com/cu-cyber/impersonating-ja3-fingerprints-b9f555880e42" rel="noopener"> their </a>中所解释的，使用一个叫做<a class="ae lv" href="https://github.com/CUCyber/ja3transport" rel="noopener ugc nofollow" target="_blank"> ja3transport </a>的工具或使用另一个叫做<a class="ae lv" href="https://github.com/Danny-Dasilva/CycleTLS" rel="noopener ugc nofollow" target="_blank"> CycleTLS </a>的项目</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="61a7" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">结尾部分</h1><p id="f409" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">因此，在我的探索过程中，我发现我使用我的BurpSuite访问的网站可能使用JA3指纹识别机制来唯一地识别和阻止来自BurpSuite的TLS流量。你可以在BurpSuite上使用<a class="ae lv" href="https://www.zaproxy.org/" rel="noopener ugc nofollow" target="_blank"> OWASP ZAP </a>(它将浏览器的指纹发送到服务器)或者通过上面讨论的一些代理来代理你的流量，以绕过WAF设置的JA3限制。</p><p id="5db9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">进一步探索:</strong></p><p id="d9dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有待进一步探索的是:</p><ul class=""><li id="1590" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">针对QUIC客户的JA3—<a class="ae lv" href="https://quicwg.org/base-drafts/rfc9001.html" rel="noopener ugc nofollow" target="_blank">https://quicwg.org/base-drafts/rfc9001.html</a>，<a class="ae lv" href="https://tools.ietf.org/id/draft-ietf-quic-tls-25.html" rel="noopener ugc nofollow" target="_blank">https://tools.ietf.org/id/draft-ietf-quic-tls-25.html</a></li><li id="7fb4" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">用于TLSv1.3的JA3，其中<a class="ae lv" href="https://blog.cloudflare.com/encrypted-client-hello/" rel="noopener ugc nofollow" target="_blank"> ClientHello被加密</a>(验证是否可以在服务器端完成)</li></ul><h1 id="0aee" class="ks kt iq bd ku kv oj kx ky kz ok lb lc ld ol lf lg lh om lj lk ll on ln lo lp bi translated">资源/参考:</h1><p id="457b" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">请访问我的原始博客链接<a class="ae lv" href="https://blog.rtcms.dev/2022/01/20/ja3/" rel="noopener ugc nofollow" target="_blank">这里</a>获取撰写这篇博文的详尽资源/参考资料列表。</p><p id="636c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请在推特上关注我，了解更多这样有趣的博客——https://twitter.com/0xrtt<a class="ae lv" href="https://twitter.com/0xrtt" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="c203" class="lw kt iq bd ku lx ly dn ky lz ma dp lc jy mb mc lg kc md me lk kg mf mg lo mh bi translated">Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和充满力量的讨论会议。<a class="ae lv" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册</a>。</h2><div class="op oq gp gr or os"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd ir gy z fp ox fr fs oy fu fw ip bi translated">IWCon - Infosec书面报告虚拟会议</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">iwcon.live</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg nc os"/></div></div></a></div></div></div>    
</body>
</html>