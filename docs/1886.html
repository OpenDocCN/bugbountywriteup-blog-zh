<html>
<head>
<title>Intigriti’s February XSS Challenge Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Intigriti的二月XSS挑战赛演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/extreme-short-scripting-game-intigritis-february-xss-challenge-c19938fecc74?source=collection_archive---------1-----------------------#2022-02-13">https://infosecwriteups.com/extreme-short-scripting-game-intigritis-february-xss-challenge-c19938fecc74?source=collection_archive---------1-----------------------#2022-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3089" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天，我将在<a class="ae kl" href="https://twitter.com/intigriti/status/1490667161307783178" rel="noopener ugc nofollow" target="_blank"> Intigriti的</a>二月XSS挑战赛0222上分享我的解决方案。</p><p id="d5c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它叫做<strong class="jp ir"> <em class="km"> XSS(极短脚本)游戏。</em> </strong>它暗示可能会有一些曲折，需要我们使用尽可能少的字符来解决挑战。</p><p id="a461" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该解决方案需要满足以下标准才能被接受:</p><ul class=""><li id="4df8" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated">应该在最新版本的Chrome <strong class="jp ir">和</strong> FireFox上工作。</li><li id="b4cd" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">应该执行<code class="fe lb lc ld le b">alert(document.domain)</code>。</li><li id="1877" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">应该利用同一域中的跨站点脚本漏洞。</li><li id="5d36" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">不应该是自我XSS或与MiTM攻击有关。</li><li id="acc8" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">应该不需要用户交互。</li></ul><h1 id="2632" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">最初印象</h1><p id="add6" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在挑战开始时，迎接我们的是一个需要两个输入的表单。一个问我们的名字，另一个问我们以前是否玩过这个游戏。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mi"><img src="../Images/b784aeb67625d4385a0f7dd32ac40303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkt7s9ghQJu8VV2qZ7GHuw.png"/></div></div></figure><p id="1acc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提交后，会出现一个弹出窗口问候我们<em class="km">欢迎回来！使用<strong class="jp ir">DOM</strong>T22】innerHTML属性加载我们的输入</em></p><figure class="mj mk ml mm gt mn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/7a15a827e0b2bdf8255f540fc19dc4b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*Vtn1gUaCGDIerEA2McF3UQ.png"/></div></figure><p id="0e60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提交后，我们得到以下网址。我们的名字反映在<code class="fe lb lc ld le b">q</code>参数中</p><pre class="mj mk ml mm gt mx le my mz aw na bi"><span id="832c" class="nb lg iq le b gy nc nd l ne nf"><a class="ae kl" href="https://challenge-0222.intigriti.io/challenge/xss.html?q=Echidonut&amp;first=yes" rel="noopener ugc nofollow" target="_blank">https://challenge-0222.intigriti.io/challenge/xss.html?q=Echidonut&amp;first=yes</a></span></pre><p id="63e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">玩XSS挑战赛的第一件事显然是给页面一个有效载荷来执行JavaScript。<code class="fe lb lc ld le b">&lt;svg/onload=alert(1)&gt;</code></p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/37838080e71ae4f96e5c7c011d9a3fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*oGWhh9TO13KbOUVcKNG6eg.png"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated"><svg/></figcaption></figure><p id="aa3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">名称字段未经净化，易受多姆XSS攻击。</p><h1 id="bb85" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">真的那么容易吗？</h1><p id="ea70" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">当然不是。挑战要求我们<code class="fe lb lc ld le b">alert(document.domain)</code>。</p><p id="d9aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于<strong class="jp ir"> DOM innerHTML属性</strong>我们应该知道的一件事是，它不允许通过<code class="fe lb lc ld le b">&lt;script&gt;</code>标签执行JavaScript。我们唯一的选择是使用<strong class="jp ir">事件处理程序</strong>来实现JavaScript执行。</p><p id="d3d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试图给它一个像<code class="fe lb lc ld le b">&lt;svg/onload=alert(document.domain)&gt;</code>一样的有效载荷，但意想不到的事情发生了。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/adb20bf518e03a193d47f939915253af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*gygCDtFlz7Uz7GxqjA0S_A.png"/></div></figure><p id="8153" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在检查源代码时，它明确地将输入限制为最多24个字符。</p><figure class="mj mk ml mm gt mn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="9b00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的输入存储在<code class="fe lb lc ld le b">qs</code>变量中。</p><h1 id="47f1" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">制作≤ 24个字符的有效负载</h1><p id="57ea" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">如果我们的输入<code class="fe lb lc ld le b">qs</code>仅限于24个字符，我们应该跳出框框思考。换句话说，在变量之外思考<strong class="jp ir">。</strong></p><p id="099f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">引起我注意的一件事是<code class="fe lb lc ld le b">uri</code></p><pre class="mj mk ml mm gt mx le my mz aw na bi"><span id="3db0" class="nb lg iq le b gy nc nd l ne nf">var uri = decodeURIComponent(location.href)</span></pre><p id="f4ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">变量<code class="fe lb lc ld le b">uri</code>只是我们的URL，<em class="km">经过了“一些”修改。</em>我们可以在URL中注入有效载荷，稍后在eval()中使用。</p><p id="f37a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现一个短的XSS有效载荷是这样的方法。在这里找到了<a class="ae kl" href="https://github.com/terjanq/Tiny-XSS-Payloads" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="mj mk ml mm gt mx le my mz aw na bi"><span id="4f8c" class="nb lg iq le b gy nc nd l ne nf">&lt;svg/onload=eval(`'`+uri)&gt;</span></pre><p id="3a4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该有效载荷的长度为<strong class="jp ir"> 26 </strong>个字符。只比限制多了两个字符。如果我们能把这个去掉两个字符，我们就能解决这个挑战。我看不到其他拯救角色的方法。从这里唯一可能的是</p><pre class="mj mk ml mm gt mx le my mz aw na bi"><span id="7c08" class="nb lg iq le b gy nc nd l ne nf">&lt;svg/onload=eval(uri)&gt;</span></pre><p id="7f57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以在URL中注入我们的有效负载</p><pre class="mj mk ml mm gt mx le my mz aw na bi"><span id="ce9d" class="nb lg iq le b gy nc nd l ne nf">https://challenge-0222.intigriti.io/challenge/xss.html?q=&lt;svg/onload=eval(uri)&gt;&amp;first=yes#;alert(document.domain);//</span></pre><p id="e86a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们有一个错误。<code class="fe lb lc ld le b">Uncaught SyntaxError: Unexpected end of input</code></p><p id="d28f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我花了太多时间来思考这部分。我差一点就能得到XSS，但是现在我得到了一个错误。我决定在我的IDE中复制这个错误，使事情更有条理</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi nm"><img src="../Images/d2cdf21bfcf4e5cce644bf732a9f9fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mc6XEAbQu2i019Ry"/></div></div></figure><h2 id="680c" class="nb lg iq bd lh nn no dn ll np nq dp lp jy nr ns lt kc nt nu lx kg nv nw mb nx bi translated">我意识到来自URL的双斜杠导致有效载荷是单行注释！</h2><p id="7738" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">与多行注释/**/不同，单行注释//不能以另一个注释结束。避免单行注释的唯一方法是另起一行。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/ba01a0d153e505f7976faa69ecd2a977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/0*5tZ2jCcTqmeupBP7"/></div></figure><p id="a155" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只控制网址。怎样才能给<code class="fe lb lc ld le b">uri</code>变量再加一行呢？嗯，是变量声明中的漏洞。它不小心用了<code class="fe lb lc ld le b">decodeURIComponent()</code>。我们可以通过URL编码CRLF <code class="fe lb lc ld le b">%0d%0a</code>来添加新的一行</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/a0b539d0c4f3ed9a24f24f095da394ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*3WI4_KLXp9etTdmx4HaP1A.png"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated">第170行中的错误导致的漏洞</figcaption></figure><p id="ed47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CRLF是XSS挑战中缺失的一块拼图。我们唯一需要做的就是添加它，应该会有一个<code class="fe lb lc ld le b">document.domain</code>的弹出窗口</p><pre class="mj mk ml mm gt mx le my mz aw na bi"><span id="7be3" class="nb lg iq le b gy nc nd l ne nf">https://challenge-0222.intigriti.io/challenge/xss.html?q=&lt;svg/onload=eval(uri)&gt;&amp;first=yes#%0d%0aalert(document.domain);//</span></pre><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/5dcf726eefb85ea511d72a597213c61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/0*z0LZeCFFxkg3HKDr"/></div></figure><p id="c487" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km">挑战现已解决，至少我是这么认为的……..</em></p><p id="06b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的解决方案在最新版本的Firefox上无法运行。按照规则，解决方案必须能在Chrome和Firefox上运行</p><h1 id="52a1" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><strong class="ak">解决方案</strong></h1><p id="1e01" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">我对这个问题做了更多的调查。不仅仅是我对Chrome中的<code class="fe lb lc ld le b">svg load</code>处理程序感到惊讶，其他人都没有。为了解决这个挑战，我使用了<code class="fe lb lc ld le b">&lt;style onload=eval(uri)&gt;</code> <strong class="jp ir">正好24个字符</strong>，而不是<code class="fe lb lc ld le b">&lt;svg&gt;</code></p><pre class="mj mk ml mm gt mx le my mz aw na bi"><span id="8c51" class="nb lg iq le b gy nc nd l ne nf">https://challenge-0222.intigriti.io/challenge/xss.html?q=&lt;style onload=eval(uri)&gt;&amp;first=yes#%0d%0aalert(document.domain);//</span></pre><p id="1aed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在火狐浏览器上看到了甜蜜的弹出窗口</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/036f5872b143cac78afe85b2dfa842f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*TqZbCmTdQr40Sy4ZbV8dkA.png"/></div></figure><p id="fc8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我要感谢<a class="ae kl" href="http://intigriti.com" rel="noopener ugc nofollow" target="_blank"> Intigriti </a>主办这次挑战。我了解了很多关于DOM XSS的知识，以及Firefox在使用<code class="fe lb lc ld le b">innerHTML</code>插入事件处理程序时对待<code class="fe lb lc ld le b">svg</code>事件处理程序的不同寻常的方式</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><p id="fdf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想知道Firefox中这种不寻常现象的原因，我在他们的网站上做了一个错误报告。</p><div class="oj ok gp gr ol om"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1754727" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd ir gy z fp or fr fs os fu fw ip bi translated">1754727 -如果使用innerHTML加载，SVG onload事件不起作用</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">Core - DOM: Core &amp; HTML中未确认的(nobody)。最后更新2022-02-10。</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">bugzilla.mozilla.org</p></div></div></div></a></div><p id="375d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">据称这是由以前的一个错误引起的(CVE-2020–15676)。我目前只知道这些。感谢阅读，并保持安全</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><h1 id="1c48" class="lf lg iq bd lh li ov lk ll lm ow lo lp lq ox ls lt lu oy lw lx ly oz ma mb mc bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae kl" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="oj ok gp gr ol om"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd ir gy z fp or fr fs os fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">iwcon.live</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ms om"/></div></div></a></div></div></div>    
</body>
</html>