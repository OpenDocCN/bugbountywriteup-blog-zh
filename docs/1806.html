<html>
<head>
<title>SSH to Red Hat with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Docker对红帽的SSH</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/ssh-to-red-hat-with-docker-e84066d2b065?source=collection_archive---------2-----------------------#2022-01-16">https://infosecwriteups.com/ssh-to-red-hat-with-docker-e84066d2b065?source=collection_archive---------2-----------------------#2022-01-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="83ba" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Red Hat和ssh制作一个docker容器</h2></div><p id="0ca0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Docker是一个开发、运输和运行应用程序的开放平台。您将能够在本地机器上拥有一个隔离的环境，并使用少量的资源。</p><p id="5615" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有人使用docker来运行他们易受攻击的应用程序，因为docker具有隔离性，并且适合做渗透测试实验室。所以今天我想在docker中运行sshd服务。</p><p id="23d0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击了解更多关于docker <a class="ae lb" href="https://en.wikipedia.org/wiki/Docker_(software)" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><h2 id="5272" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">拉图像</h2><p id="2e3c" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">所有docker图片均在hub.docker.com提供。您可以选择您喜欢的图像作为运行docker容器的基础。对于本教程，我将使用红帽UBI 8。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ma"><img src="../Images/962d6fb56fbbbad82756bb618c4be82a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-2U2qgwFxgMf1IMzMlyqA.png"/></div></div></figure><p id="cbb5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">出于安全考虑，我建议您始终从经过<strong class="kh ir">认证的发行商处获取图片。</strong></p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mm"><img src="../Images/61e5d8907e8fa638676a74db79ce6eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3brJvoSRis501a013dBjfA.png"/></div></div></figure><p id="e66c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，你必须在你的电脑/你的虚拟机上安装docker。然后运行下面的命令。</p><pre class="mb mc md me gt mn mo mp mq aw mr bi"><span id="d1b9" class="lc ld iq mo b gy ms mt l mu mv">docker pull redhat/ubi8</span></pre><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mw"><img src="../Images/8a41e767fb5a55fea07cd990c0e19091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jVBiwkl55qE-4JXG8pI4Qw.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">拉动docker图像</figcaption></figure><p id="1299" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果已经完成，运行此命令查看图像列表</p><pre class="mb mc md me gt mn mo mp mq aw mr bi"><span id="1aa7" class="lc ld iq mo b gy ms mt l mu mv">docker image ls</span></pre><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/2c2ba4d44f16ad8c2588538b1312bb14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*h9ddcStFADGHTvmGEE75Mw.png"/></div></figure><p id="0eb1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你的<strong class="kh ir"> docker image ls </strong>命令显示如上图，恭喜你已经提取了图像并保存在你的计算机上。</p><h2 id="c7a0" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">运行集装箱</h2><p id="15b9" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">在Docker中，命令"<strong class="kh ir"> run" </strong>意味着创建并启动你的容器。</p><pre class="mb mc md me gt mn mo mp mq aw mr bi"><span id="c948" class="lc ld iq mo b gy ms mt l mu mv">docker run -it --name ssh-test -p 10022:22 <!-- -->fca12da1dc30</span></pre><p id="d85c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">注</strong>:</p><p id="3f3e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nc nd ne mo b">-it</code> <strong class="kh ir"> </strong>:与容器的交互外壳一起运行</p><p id="8801" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nc nd ne mo b">--name ssh-test</code>:容器名为<strong class="kh ir"> ssh-test </strong></p><p id="088d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nc nd ne mo b">-p 10022:22</code>:本地机器端口10022，docker容器端口22</p><p id="6338" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> fca12da1dc30 </strong>:图像ID。</p><p id="20dd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦运行容器，它将生成一个带有随机主机名的交互式shell:</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/8835fcbe6c1547a754cdf3ba43fd14e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*jPnlc2NYXGiwvIVdtjYUkA.png"/></div></figure><h2 id="c126" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">安装sshd</h2><p id="d841" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">运行更新包存储库，</p><pre class="mb mc md me gt mn mo mp mq aw mr bi"><span id="c6f5" class="lc ld iq mo b gy ms mt l mu mv">usr/bin/yum update</span></pre><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ng"><img src="../Images/fd827ac09344ebdfa92901f8e0f7d1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q1J1QkqJ9ZuIErUzTKgL-Q.png"/></div></div></figure><p id="e1d6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并安装openssh-server，</p><pre class="mb mc md me gt mn mo mp mq aw mr bi"><span id="479b" class="lc ld iq mo b gy ms mt l mu mv">usr/bin/yum install openssh-server</span></pre><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nh"><img src="../Images/7f7d70247c6d5d47cb4689e285906659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tymt-An8a3zfqDD5SYKtsQ.png"/></div></div></figure><p id="066b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，使用以下内容生成主机密钥:</p><pre class="mb mc md me gt mn mo mp mq aw mr bi"><span id="fadf" class="lc ld iq mo b gy ms mt l mu mv">ssh-keygen -A</span></pre><p id="0600" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有最后一步，启动ssh服务器，运行<code class="fe nc nd ne mo b">/usr/sbin/sshd &amp;</code>。</p><h2 id="84d7" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">测试</h2><p id="8245" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">在测试之前，我想使新用户成为<strong class="kh ir">贾维斯</strong>。</p><pre class="mb mc md me gt mn mo mp mq aw mr bi"><span id="d515" class="lc ld iq mo b gy ms mt l mu mv">useradd --home /home/jarvis jarvis<br/>passwd jarvis</span></pre><figure class="mb mc md me gt mf gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/8c0a2efcbbcbb4b5535030d576b3bfd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*oqsVjiGtw_xgoGx21OsIug.png"/></div></figure><p id="b888" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打开新选项卡并访问ssh。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nj"><img src="../Images/49c7d8e32cead8a8890311858f11e9c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hyXAUE4LFNKS6UtyEimhJQ.png"/></div></div></figure><h2 id="9219" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">从虚拟机访问怎么样？</h2><p id="cee5" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">尝试使用用户名<strong class="kh ir"> jarvis </strong>和端口<strong class="kh ir">10022 ssh到您的主机(您的docker正在运行)。</strong>但是，要确保你的虚拟机和你的主机有<strong class="kh ir">桥接</strong>。</p><figure class="mb mc md me gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi nk"><img src="../Images/7a097da0579253fd758f11f232857268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u2IDsMhE3h6Qy-DGVsCcSA.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">从windows虚拟机到docker的ssh</figcaption></figure><h2 id="e954" class="lc ld iq bd le lf lg dn lh li lj dp lk ko ll lm ln ks lo lp lq kw lr ls lt lu bi translated">结论</h2><p id="0615" class="pw-post-body-paragraph kf kg iq kh b ki lv jr kk kl lw ju kn ko lx kq kr ks ly ku kv kw lz ky kz la ij bi translated">实际上，docker为您提供了到docker容器的直接连接。如果运行sshd，它将使您的docker不会再次被隔离。但是如果你想了解任何操作系统，docker是比虚拟机更好的方法，因为那个容器只需要你的一点资源(ram/存储)。</p></div></div>    
</body>
</html>