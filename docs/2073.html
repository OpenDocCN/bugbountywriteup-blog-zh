<html>
<head>
<title>Active Directory Overview</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">活动目录概述</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/active-directory-overview-98692e1b0233?source=collection_archive---------0-----------------------#2022-05-18">https://infosecwriteups.com/active-directory-overview-98692e1b0233?source=collection_archive---------0-----------------------#2022-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d34d0466738fb51910c4461c15b8970f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQGpZGkSuehv--YEXUweMQ.png"/></div></div></figure><p id="e92e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近，我学习了更多关于Active Directory的知识，以及它在当今现代网络中是如何使用的。本文试图提供活动目录基础知识的概述，并利用由用户<a class="ae kw" href="https://tryhackme.com/p/Cryillic" rel="noopener ugc nofollow" target="_blank"> Cryillic </a>创建的标题为“<strong class="ka ir">活动目录基础知识</strong>”的<a class="ae kw" href="https://tryhackme.com/room/activedirectorybasics" rel="noopener ugc nofollow" target="_blank"> TryHackMe </a>房间，获得一些关于该服务的实践经验。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="7925" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">什么是活动目录？</h1><p id="34bf" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">Active Directory是微软开发的用于管理Windows域网络的<a class="ae kw" href="https://jumpcloud.com/blog/what-is-active-directory-anyway" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">目录服务</strong> </a>，用于存储网络对象的信息。目录服务的目的是描述如何在IT网络中组织网络对象，以便允许IT管理员控制用户对这些网络资源的访问。如果用户想要访问网络资源，目录服务将要求用户使用用户名和密码根据目录的用户数据库来鉴定其身份。如果用户名和密码有效，用户就可以访问该资源。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/b3a41ff816a0155202a42d1b2493c1ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vfwm0g9E5RqNTSZC4kU3xw.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">目录服务。</figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="839f" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Active Directory是如何工作的？</h1><p id="cbc8" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">活动目录由一个<a class="ae kw" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc736627(v=ws.10)" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">数据库</strong> </a>和一组<a class="ae kw" href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">服务</strong> </a>组成，将用户与网络资源联系起来。服务控制网络环境中发生的活动，数据库包含关于网络对象的信息。主活动目录服务是<strong class="ka ir">活动目录域服务(AD DS) </strong>。微软为AD DS提供如下描述:</p><blockquote class="mq mr ms"><p id="139e" class="jy jz mt ka b kb kc kd ke kf kg kh ki mu kk kl km mv ko kp kq mw ks kt ku kv ij bi translated">目录服务(如Active Directory域服务(AD DS ))提供了存储目录数据并使这些数据可供网络用户和管理员使用的方法。例如，AD DS存储有关用户帐户的信息，如姓名、密码、电话号码等，并使同一网络上的其他授权用户能够访问这些信息。</p></blockquote><p id="f29f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">任何安装了AD DS服务器角色的Windows服务器都称为<a class="ae kw" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc786438(v=ws.10)" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">(DC)</strong></a>。组织可以有多个DC，它们位于Active Directory的中心，控制域的其余部分。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/7e4204c6e4e2dade81890181789606e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KiKfagcC-i20SDuh3NlXKg.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">域控制器(DC)。</figcaption></figure><p id="e36d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc736627(v=ws.10)" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> AD DS存储数据库</strong> </a>(目录)包含域中AD <strong class="ka ir">对象</strong>(即用户、计算机、应用程序、打印机、共享文件夹)的相关信息，只能通过域控制器进程和协议访问。它由<strong class="ka ir"> Ntds.dit </strong>文件组成，这是一个包含所有活动目录DC信息以及域用户密码散列的数据库。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/d6b0910476b147442d279a401993757f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IIQKKDvHNg_7npna6D96jA.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">AD DS存储数据目录。</figcaption></figure><p id="c2aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建DC时，它带有默认的<a class="ae kw" href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">组</strong> </a> <strong class="ka ir"> </strong>和两个默认的<strong class="ka ir">用户</strong>(即管理员和访客)。活动目录中的用户和组由管理员决定。在Active Directory网络中，您会发现四种主要类型的用户，包括:</p><ul class=""><li id="2a6e" class="mz na iq ka b kb kc kf kg kj nb kn nc kr nd kv ne nf ng nh bi translated">域管理员:控制域，并且是唯一可以访问DC的人。</li><li id="8fd3" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated"><strong class="ka ir">服务帐户</strong>:除了服务维护之外，这些帐户大部分情况下从未使用过，它们是Windows服务(如SQL)将服务与服务帐户配对所必需的</li><li id="e1e1" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated"><strong class="ka ir">本地管理员</strong>:可以作为管理员对本地机器进行更改，甚至可以控制其他普通用户，但是不能访问域控制器</li><li id="383b" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated">领域用户:这些是你的日常用户。</li></ul><p id="5c09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Active Directory组通过将用户和对象组织到具有指定权限的组中，使得向用户和对象授予权限变得更加容易。Active Directory组有两种主要类型:</p><ul class=""><li id="d435" class="mz na iq ka b kb kc kf kg kj nb kn nc kr nd kv ne nf ng nh bi translated"><strong class="ka ir">安全组</strong>:用于为大量用户指定权限。</li><li id="33cf" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated"><strong class="ka ir">分发组</strong>:用于指定邮件分发列表。</li></ul></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="55e8" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Active Directory的结构是怎样的？</h1><p id="a7d2" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">活动目录结构由几个逻辑层组成:</p><ul class=""><li id="9136" class="mz na iq ka b kb kc kf kg kj nb kn nc kr nd kv ne nf ng nh bi translated"><strong class="ka ir">组织单位(OU) </strong>:组织域内的对象。包含用户、组、计算机和其他ou。ou允许您在一个域内组织对象，而不需要额外的工作和创建额外域的低效率。</li><li id="80c9" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated"><strong class="ka ir">域</strong>:用于分组和管理对象。一个域创建一个管理边界。</li><li id="4abc" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated"><strong class="ka ir">树</strong>:多个域的组合。</li><li id="2af1" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated">森林:一棵树或多棵树的集合。一个林创建一个安全边界，不同林中的对象不能相互交互，除非每个林的管理员在它们之间创建信任。</li></ul><p id="e0a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下图说明了Active Directory数据结构。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ed65a5c14369ec6628a68ab1ef08d202.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/0*Qrhuzrdib3lGZNds.gif"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated"><a class="ae kw" href="https://www.distributednetworks.com/active-directory/module2/activeDirectory-logical-structure.php" rel="noopener ugc nofollow" target="_blank">活动目录结构。</a></figcaption></figure><p id="8049" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果用户想要访问另一个域中的资源，则需要建立一个<a class="ae kw" href="https://docs.microsoft.com/en-us/azure/active-directory-domain-services/concepts-forest-trust" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">信任关系</strong> </a>。信任概述了林内部域的通信方式，并且可以扩展到外部域，在某些情况下甚至可以扩展到林。有两种类型的信任决定域如何通信:</p><ul class=""><li id="9c20" class="mz na iq ka b kb kc kf kg kj nb kn nc kr nd kv ne nf ng nh bi translated"><strong class="ka ir">方向</strong>:信任从信任域流向受信任域的方向。在下面的例子中，<strong class="ka ir">单向</strong>信任意味着<em class="mt">域A </em>中的用户可以访问<em class="mt">域B </em>中的资源，反之则不行。在<strong class="ka ir">双向</strong>信任中，<em class="mt">域A </em>信任<em class="mt">域B </em>，<em class="mt">域B </em>信任<em class="mt">域A </em>。</li></ul><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/5f600c799a2ca4b9c12eada5d31dff94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SNLLvMsshKtVXCM9wz9-xQ.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">定向信任类型。</figcaption></figure><ul class=""><li id="8aa8" class="mz na iq ka b kb kc kf kg kj nb kn nc kr nd kv ne nf ng nh bi translated"><strong class="ka ir">可传递的</strong>:信任关系扩展到两个域之外，包括其他受信任的域。<strong class="ka ir">可传递信任</strong>可用于扩展与其他域的信任关系。<strong class="ka ir">不可传递的</strong>信任可用于拒绝与其他域的信任关系。</li></ul><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/af95ddedd2a23fe9d0a2cb27fd7c5077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yuGyU7_-hHlz4P4ueKoxcg.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">可传递信任类型。</figcaption></figure><p id="ec28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Active Directory还使用<strong class="ka ir">域策略</strong>，这些策略规定了服务器如何运行以及它将遵循和不遵循哪些规则。它们只是作为Active Directory的规则手册，域管理员可以根据需要进行修改和变更。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="4507" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Active Directory域服务和身份验证</h1><p id="bc5a" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">DC向域或树的其余部分提供域服务，以管理身份、权限和对网络资源的访问。下面列出了默认的域服务:</p><ul class=""><li id="75a9" class="mz na iq ka b kb kc kf kg kj nb kn nc kr nd kv ne nf ng nh bi translated"><strong class="ka ir">轻量级目录访问协议(LDAP) </strong>:提供应用程序和目录服务之间的通信。</li><li id="1379" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated"><strong class="ka ir">证书服务</strong>:允许域控制器创建、验证和撤销公钥证书。</li><li id="3c0d" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated"><strong class="ka ir"> DNS，LLMNR，NBT-NS </strong>:用于识别IP主机名的域名服务。</li></ul><p id="91e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Active Directory有两种主要的身份验证类型:</p><ul class=""><li id="6cec" class="mz na iq ka b kb kc kf kg kj nb kn nc kr nd kv ne nf ng nh bi translated">Kerberos:Active Directory的默认认证服务使用票据授予票据和服务票据来认证用户，并允许用户访问域中的其他资源。</li><li id="f55d" class="mz na iq ka b kb ni kf nj kj nk kn nl kr nm kv ne nf ng nh bi translated"><strong class="ka ir"> NTLM </strong>:默认的Windows认证协议使用加密的质询/响应协议。</li></ul></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="b77a" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">活动目录结构示例</h1><p id="95e8" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">使用上面介绍的理论，我们可以开始考虑一个活动目录设置的例子是什么样子的。假设你有一家名为“<strong class="ka ir"> <em class="mt"> Techsy </em> </strong>”的公司。与任何公司一样，<em class="mt"> Techsy </em>拥有多种网络资源(即用户、组、计算机、打印机、应用程序、文件共享等。).这些网络资源可以放入称为<strong class="ka ir">组织单位(OU) </strong>的逻辑管理组中，管理任务可以通过向OU分配权限来委托。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/77376457dd27bd7a5579265b1db02dc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*Brl0Eti-Ptpw0GaqU6S2ew.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">组织单位(OU)示例。</figcaption></figure><p id="6e69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在可以将相关的对象分组到<strong class="ka ir">域</strong>中。通常，域对应于公司中的部门或地理位置。例如，“<em class="mt"> Techsy </em>”可能有财务、法律和销售部门。由于Active Directory域使用<strong class="ka ir"> DNS命名约定</strong>，您可以创建被视为子域的子域。在创建任何其他域之前，您应该始终为整个网络创建顶级域(例如techsy.com)。然后，您可以为每个部门创建子域。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/175dc7cd598f743a299c007e41b46442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*fBBtJZuxm9OYTS3-hWdz0A.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">域示例。</figcaption></figure><p id="d6fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的域示例中，至少有一个<strong class="ka ir">域控制器(DC) </strong>，它是负责域的服务器。域名示例还代表了一个<strong class="ka ir">树</strong>结构，因为所有三个子域名(即销售、法律和财务)都来自一个公共根域名(即techsy.com)。那些组成树的域通过<strong class="ka ir">传递信任</strong> <em class="mt">相互关联。</em></p><p id="d186" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这可以更进一步，两棵树可以连接起来创建一个<strong class="ka ir">森林</strong>。例如，假设“<em class="mt"> Techsy </em>”收购了“<em class="mt"> Marketzen </em>”，它已经有了自己的根域名“<em class="mt">market Zen . com”</em>，还有自己的几个子域。然后，您可以从这两个域树中创建一个林，这样这两个域就可以相互信任。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/e479e39f29b13b8c8e6d537e4c8f6b32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PoJSIvkAG6g8VubI16rm5Q.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">森林的例子。</figcaption></figure><p id="4551" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Active directory林还维护一个称为全局目录的数据库。<strong class="ka ir"> <em class="mt">全局目录</em> </strong> <em class="mt"> </em>是一种超级目录，它包含了一个目录林中所有对象的信息，与域无关。然后，如果在当前域中找不到用户帐户，将在全局目录中搜索该帐户。全局目录提供了对定义帐户的域的引用。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="c830" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">活动目录动手实验</h1><p id="51d2" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">为了获得一些实践经验，我将使用名为“<strong class="ka ir"> <em class="mt">活动目录基础知识</em> </strong>”的<a class="ae kw" href="https://tryhackme.com/room/activedirectorybasics" rel="noopener ugc nofollow" target="_blank"> TryHackMe </a>工作室。我在TryHackMe中启动了基于浏览器的机器。几分钟后，我的机器启动了，我看到了<a class="ae kw" href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/manage/ad-ds-simplified-administration" rel="noopener ugc nofollow" target="_blank">服务器管理器管理控制台</a>。我可以看到安装了服务器角色AD DS，这意味着这台计算机是DC。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/609e055cf8a0fb5d1e8d1d9a545a838a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dfY7fEIjMWX0URxF_QP2BA.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">服务器角色。</figcaption></figure><p id="fa23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还可以看到安装了<a class="ae kw" href="https://social.technet.microsoft.com/wiki/contents/articles/1137.active-directory-certificate-services-ad-cs-introduction.aspx" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Active Directory证书服务(AD CS) </strong> </a>角色，该角色为颁发和管理公钥基础设施(PKI)证书提供可定制的服务。还安装了<strong class="ka ir"> DNS </strong>服务器角色，这是AD DS在安装时需要的。我可以通过导航选项卡上的<strong class="ka ir">工具</strong>链接找到更多信息。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e30d4d10fbab0bb57c62e502da474013.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*Zza9RyWZzEJRXW9kU2vTsw.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">服务器管理器工具。</figcaption></figure><p id="efc3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我选择“<em class="mt"> Active Directory用户和计算机</em>，我可以看到安装AD DS时存在的默认OU列表。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/4b3a2e8d61f879d65fda272ae3e98079.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*5b9ByDmFsZ1vM7At0xEwOg.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">组织单位。</figcaption></figure><p id="cb1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<strong class="ka ir"> <em class="mt">用户</em> </strong>中“默认OU”为新用户和组，我可以得到该域上所有用户的列表。在下图中，我们可以看到两个默认用户(即管理员和来宾)以及由域管理员创建的其他用户。您可能还发现了SQL服务用户的密码在描述中被公开。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/29544acbe6484263a304502fed2e3bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*Nkg-RhVm3tBUaDw9s5wgTA.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">域用户。</figcaption></figure><p id="4aff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可以检查每个用户的属性，并查看他们被分配了哪些组。例如，“<em class="mt"> SQL服务</em>用户帐户，其密码在描述中公开，具有管理员特权(不太安全😬！).</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/02fe560ee6623d8e88ba1ee1eee91947.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*XEuAH2Va7ZP_cCoHW9kDUA.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">SQL Services用户帐户组成员身份。</figcaption></figure><p id="a550" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我选择“<em class="mt">活动目录域和信任关系</em>”，我可以看到计算机的FQDN是“<strong class="ka ir"> <em class="mt"> CONTROLLER.local </em> </strong>”，我还可以检查存在什么信任关系，在本例中是没有。该信息也应位于“<em class="mt"> Active Directory用户和计算机</em>”下。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/a8183ad5024c4e3e92164a30806d528b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*uzSfEHapMgcG-JBrFbuRaw.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">域名和信任关系。</figcaption></figure><h2 id="820f" class="nz lf iq bd lg oa ob dn lk oc od dp lo kj oe of ls kn og oh lw kr oi oj ma ok bi translated">PowerShell</h2><p id="5e66" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">PowerShell也可以用来查看活动目录的内部设置。<a class="ae kw" href="https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters/powerview" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> PowerView </strong> </a>是一个方便的PowerShell工具，可以用来在渗透测试中执行DC的枚举。要使用PowerView，我们可以导航到存储PowerShell脚本的位置，加载一个绕过执行策略的PowerShell，并导入PowerView模块。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/52b5a43a11344cd0480a654a264180ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*h_LJzGaOBJYcqV9ftpDnuQ.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">导入PowerView模块。</figcaption></figure><p id="a96b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在可以收集与前面看到的相同的信息，但是要使用PowerShell。在列出域用户时，我可以看到之前没有列出的另一个用户(即“<em class="mt"> krbtgt </em>”)。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/9cc838de5305cdf9601d631436887a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*nxodwqKWfNyUqbcr4J00Cg.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">PowerShell列出的域用户。</figcaption></figure><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/3f28d9c7eab5cbc7e2f4a1dd01cf079e.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*68ep6j0-LDJlFm11JFbyLg.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk translated">PowerShell列出的域组。</figcaption></figure><p id="45f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这只是您使用PowerView可以收集的信息的皮毛，值得您自己花时间进一步探索。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="7ad6" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结束语</h1><p id="28dc" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">希望这篇关于Active Directory的短文有助于提供它是什么以及它如何工作的基本概述。Active Directory是一个值得深入了解的大话题，被大多数大公司广泛使用。谢谢你看完，继续黑！😄</p></div></div>    
</body>
</html>