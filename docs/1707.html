<html>
<head>
<title>[Day 6] Web Exploitation Patch Management Is Hard | Advent of Cyber 3 (2021)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[第6天]网络利用补丁管理很难|网络3的到来(2021年)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/day-6-web-exploitation-patch-management-is-hard-advent-of-cyber-3-2021-ed97027121cb?source=collection_archive---------1-----------------------#2021-12-11">https://infosecwriteups.com/day-6-web-exploitation-patch-management-is-hard-advent-of-cyber-3-2021-ed97027121cb?source=collection_archive---------1-----------------------#2021-12-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b930" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">本地文件包含漏洞</h2></div><p id="6b31" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在此任务中，我们将了解本地文件包含(LFI)漏洞的基本知识。此漏洞使我们能够从网站查看或修改文件。</p><p id="0128" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">让我们来破解这个问题……</strong></p><p id="2d9a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1.部署连接的虚拟机并四处查看。我们的web应用程序的入口点是什么？</p><blockquote class="lb lc ld"><p id="3d7f" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">犯罪</p></blockquote><p id="9a92" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只要打开网页。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi li"><img src="../Images/bf7e9ad0caa0de6a32178ef3216b9601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*968n1cH_RchnuG1fj-_V2w.png"/></div></div></figure><p id="9b65" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.使用入口点执行LFI来读取/etc/flag文件。国旗是什么？</p><blockquote class="lb lc ld"><p id="1220" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">THM { d29e 08941 cf 7 Fe 41 df 55 f1 a 7 da 6 C4 c 06 }</p></blockquote><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi lu"><img src="../Images/1df10239d643d134f9b039432de41573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yomHLztABUApgOh1yrI7mA.png"/></div></div></figure><p id="de11" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.使用PHP过滤技术读取index.php的源代码。$flag变量的值是什么？</p><blockquote class="lb lc ld"><p id="007d" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">THM { 791 d43d 46018 a0d 89361 DBF 60 D5 d9 EB 8 }</p></blockquote><p id="e0e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用<strong class="kh ir"> php过滤器</strong>和LFI技术打开文件，将文件转换成base64格式。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi lv"><img src="../Images/7ba489ae9dba7709bbe0421ca63121e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhG6gG-LhAiefE9_0RPYcw.png"/></div></div></figure><p id="ba5e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后你可以用<a class="ae lw" href="https://gchq.github.io/CyberChef/" rel="noopener ugc nofollow" target="_blank">网吧</a>解码文本。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi lv"><img src="../Images/e388750c8374d5b2f1e3d8b4dd012078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yFyWmuCNFoYkqpcHhewZFw.png"/></div></div></figure><p id="3909" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.麦克斯基迪忘记了他的登录凭证。你能帮助他登录以恢复服务器的一个密码吗？</p><p id="15d4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">既然您已经阅读了index.php，那么就有了一个登录凭证PHP文件的路径。使用PHP过滤技术读取其内容。用户名和密码是什么？</p><blockquote class="lb lc ld"><p id="ff57" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">McSkidy:A0C315Aw3s0m</p></blockquote><p id="d38f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从<strong class="kh ir">index.php</strong>我们看到代码包含了到<strong class="kh ir">的链接。/includes/creds.php </strong>，而且很有意思。让我们将文件编码为base64。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi lx"><img src="../Images/d9b11144406cf4231f10689a6ff7005a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZqC15-8msifrKvhWRMuug.png"/></div></div></figure><p id="2ec8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用赛博咖啡馆再次解码，就这样..</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi ly"><img src="../Images/71c5ac77320742dc660a6ba4ff29d6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QklsRLcAThj2l8LuggPwOw.png"/></div></div></figure><p id="f547" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">5.使用凭据登录web应用程序。帮助麦克斯基迪恢复服务器的密码。flag.thm.aoc服务器的密码是多少？</p><blockquote class="lb lc ld"><p id="47c4" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">THM { 552 f 313 b 52 E3 C3 DBF 5257d 8 c 6 db 7 f 6 f 1 }</p></blockquote><p id="dde5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用上一个问题中的凭据登录网站。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi lz"><img src="../Images/24bdd934dbf4c44461a275e6c2295a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GYLONsEWScPBMGXw18mr_g.png"/></div></div></figure><p id="c68e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只需点击密码恢复链接，我们就可以获得标志。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi ma"><img src="../Images/2252a9addd045ddfc7c51f19f0d663e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxSKUBkao3-EQwa_1x6HFA.png"/></div></div></figure><p id="dcfb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">6.web应用程序记录所有用户的请求，只有授权用户才能读取日志文件。使用LFI通过日志文件页面获得RCE。web服务器的主机名是什么？日志文件的位置在<strong class="kh ir">。/includes/logs/app _ access . log .</strong></p><blockquote class="lb lc ld"><p id="5c8c" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">lfi-AOC-awesome-59 aed ca 683 fff 9261263 bb 084880 c 965</p></blockquote><p id="ef7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为网站总是把访问日志保存在。/includes/logs/app_access.log，我们可以用php有效负载来更改用户代理。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/eb882cfacb7759feafcef89484f60343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*yspxoObBXnZEEOL6OipXXA.png"/></div></figure><p id="c1b2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后，操纵URL来访问日志并在web中运行。主机名在系统的行中。</p><figure class="lj lk ll lm gt ln gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi mc"><img src="../Images/a33e32438d6947c9b82509db49080733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c8OkfZbx3LrjQ25Wx8XJlw.png"/></div></div></figure><p id="34bf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">结论</strong></p><p id="e59f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您使用php代码并连接到网站中的其他文件时，本地文件包含是一个漏洞。我们知道这是一个非常重要的漏洞，我在<strong class="kh ir"> TryHackMe </strong>中有一个补救角色:</p><ol class=""><li id="f1d2" class="md me iq kh b ki kj kl km ko mf ks mg kw mh la mi mj mk ml bi translated">使用最新版本更新系统和服务，包括web应用程序框架。</li><li id="dd59" class="md me iq kh b ki mm kl mn ko mo ks mp kw mq la mi mj mk ml bi translated">关闭PHP错误，以避免泄漏应用程序的路径和其他潜在的泄露信息。</li><li id="35c2" class="md me iq kh b ki mm kl mn ko mo ks mp kw mq la mi mj mk ml bi translated">web应用程序防火墙(WAF)是帮助减轻Web应用程序攻击的好选择。</li><li id="7a69" class="md me iq kh b ki mm kl mn ko mo ks mp kw mq la mi mj mk ml bi translated">如果您的web应用程序不需要，请禁用一些导致文件包含漏洞的PHP功能，如allow_url_fopen on和allow_url_include。</li><li id="8ee3" class="md me iq kh b ki mm kl mn ko mo ks mp kw mq la mi mj mk ml bi translated">仔细分析web应用程序，只允许需要的协议和PHP包装器。</li><li id="94aa" class="md me iq kh b ki mm kl mn ko mo ks mp kw mq la mi mj mk ml bi translated">永远不要相信用户输入，并确保针对文件包含实现正确的输入验证。</li><li id="67d6" class="md me iq kh b ki mm kl mn ko mo ks mp kw mq la mi mj mk ml bi translated">实现文件名和位置的白名单以及黑名单。</li></ol><p id="81ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您有兴趣了解有关文件包含漏洞的更多信息，请查看TryHackMe上的<a class="ae lw" href="https://tryhackme.com/room/fileinc" rel="noopener ugc nofollow" target="_blank">文件包含室</a>。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="e5e8" class="my mz iq bd na nb nc nd ne nf ng nh ni jw nj jx nk jz nl ka nm kc nn kd no np bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae lw" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="nq nr gp gr ns nt"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">iwcon.live</p></div></div><div class="oc l"><div class="od l oe of og oc oh ls nt"/></div></div></a></div></div></div>    
</body>
</html>