<html>
<head>
<title>CORS and Its Misconfigurations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CORS及其错误配置</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cors-and-its-misconfigurations-1654ee04d140?source=collection_archive---------2-----------------------#2021-10-22">https://infosecwriteups.com/cors-and-its-misconfigurations-1654ee04d140?source=collection_archive---------2-----------------------#2021-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5cb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在了解CORS之前，我们需要了解SOP(同源政策)。SOP是作为一种安全机制构建的，以保护web应用程序不会从另一个网站请求资源。</p><p id="3dbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单地说，your-website.com无法从another-website.com获得资源。因此，要访问资源，这两个网站必须有<code class="fe kl km kn ko b">same protocol(HTTP/HTTPS)</code>、<code class="fe kl km kn ko b">same domain name</code>、<code class="fe kl km kn ko b">same port number(80/443)</code>。</p><blockquote class="kp kq kr"><p id="abb4" class="jn jo ks jp b jq jr js jt ju jv jw jx kt jz ka kb ku kd ke kf kv kh ki kj kk ij bi translated">注意:-即使像api.your-website.com这样的子域也无权从其根域(your-webiste.com)获取域，因为根据SOP的规则，这两个网站有不同的域。</p></blockquote><p id="9580" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您的网站(your-website.com)需要访问api.your-website.com，那么我们需要为该网站启用/配置CORS(跨来源资源共享)来访问资源。</p><p id="317e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要配置CORS，网站会设置<code class="fe kl km kn ko b">Access-Control-Allow-Origin</code>、<code class="fe kl km kn ko b">Access-Control-Allow-Credentials</code>等标头。虽然配置cors有更多的头文件，但这些是目前广泛使用的方法。</p><p id="cedc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Access-Control-Allow-Origin:-</strong>这个Cors头的值可以是2个东西，</p><p id="e856" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1)<strong class="jp ir">another-website.com</strong>:-这里可以有一个特定的网站，告知只有该网站被允许访问资源</p><p id="8850" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2) *:-可以有*表示任何网站无论域、协议、端口都可以访问资源。</p><p id="b0eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">访问-控制-允许-凭证:- </strong>(对/错)第三方网站可以执行特权操作。请将此想象成一个攻击者在进行只有您(经过身份验证的用户)才能进行的更改。</p><p id="9dbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在配置Cors时，当开发人员以错误的方式设置这些头时，就会发生错误配置。这种类型的错误配置可能因部署而异。以下是最常见的配置及其相应的风险。</p><ol class=""><li id="0ef3" class="kw kx iq jp b jq jr ju jv jy ky kc kz kg la kk lb lc ld le bi translated"><strong class="jp ir">利用CORS标题中配置错误的通配符(*)</strong></li></ol><p id="42a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">cors最常见的错误配置是在“Access-Control-Allow-Origin”中使用通配符，这表示任何域都可以访问资源，而与SOP的规则无关。</p><p id="87b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:-</p><p id="659e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ks"> GET /api/userinfo.php <br/>主机:-</em><a class="ae lf" href="http://www.victim.com" rel="noopener ugc nofollow" target="_blank"><em class="ks">www.victim.com</em></a><em class="ks"><br/>出处:-</em><a class="ae lf" href="http://www.victim.com" rel="noopener ugc nofollow" target="_blank"><em class="ks">www.victim.com</em></a></p><p id="c018" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您发送上述请求时，通常会收到如下响应</p><pre class="lg lh li lj gt lk ko ll lm aw ln bi"><span id="6ad7" class="lo lp iq ko b gy lq lr l ls lt">_HTTP/1.0 200 OK <br/>Access-Control-Allow-Origin: * <br/>Access-Control-Allow-Credentials: true </span></pre><p id="2cdb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，在这里作为攻击者，我们可以将origin设置为`<a class="ae lf" href="https://attacker.com`" rel="noopener ugc nofollow" target="_blank"> https://attacker.com` </a>并发送请求。然后，我们将得到与上面相同的响应，因为根据通配符配置，任何域都可以访问资源。</p><p id="bd95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2) <strong class="jp ir">信任域名前通配符作为来源</strong></p><p id="1641" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CORS错误配置被利用的另一种常见方式是允许与部分有效的域名共享信息。例如，考虑下面的请求。</p><p id="37ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ks">GET/API/userinfo . PHP<br/>Host:provider . com<br/>Origin:requester . com</em></p><p id="9e32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对上述请求的响应将是</p><p id="5f24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ks"> HTTP/1.0 200 OK <br/>访问控制允许来源:requester.com<br/>访问控制允许凭证:真</em></p><p id="7d16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑一下，如果一名开发人员将CORS配置为验证“Origin header”URL，而白名单中的域名只是“requester.com”。现在，当攻击者创建如下请求时。</p><p id="59a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ks"> GET /api/userinfo.php <br/>主机:example.com<br/>连接:关闭<br/>产地:attackerrequester.com</em></p><p id="02c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谦逊的服务器会回应</p><p id="ee94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ks"> HTTP/1.0 200 OK <br/>访问控制允许来源:attackerrequester.com<br/>访问控制允许凭证:真</em></p><p id="9844" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发生这种情况是因为后端的验证不佳，它只是检查是否存在“requester.com”。</p><p id="3e30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这些，非常感谢阅读:)</p></div></div>    
</body>
</html>