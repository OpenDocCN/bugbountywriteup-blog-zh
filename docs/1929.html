<html>
<head>
<title>[THM] Brooklyn Nine Nine Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">布鲁克林九九报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/thm-brooklyn-nine-nine-writeup-c145a3a3491c?source=collection_archive---------4-----------------------#2022-03-07">https://infosecwriteups.com/thm-brooklyn-nine-nine-writeup-c145a3a3491c?source=collection_archive---------4-----------------------#2022-03-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9b7512c8162525d690793c3ec8151a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmwjVqAFQMHF9t8uDZdCug.png"/></div></div></figure><p id="2053" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://tryhackme.com/room/brooklynninenine" rel="noopener ugc nofollow" target="_blank"> Brooklyn Nine Nine </a>是TryHackMe中的一个简单机器，我们将在其中使用基本的枚举，并对隐写术进行一些研究。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="9a48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们用<a class="ae kw" href="https://github.com/robertdavidgraham/masscan" rel="noopener ugc nofollow" target="_blank"> MASSCAN </a>看看哪些端口是打开的:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="2efe" class="ln lo iq lj b gy lp lq l lr ls">masscan -p- --rate 10000 10.10.115.97</span></pre><ul class=""><li id="28b1" class="lt lu iq ka b kb kc kf kg kj lv kn lw kr lx kv ly lz ma mb bi translated"><code class="fe mc md me lj b">-p-</code>:枚举所有TCP端口，从1到65535</li><li id="a0b7" class="lt lu iq ka b kb mf kf mg kj mh kn mi kr mj kv ly lz ma mb bi translated"><code class="fe mc md me lj b">--rate</code>:每秒向主机发送多少数据包</li></ul><blockquote class="mk ml mm"><p id="1f10" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated">我更喜欢使用MASSCAN来枚举端口，因为它比nmap快得多，所以在发现端口后，我们可以使用nmap来单独检查这些端口中运行的服务。</p></blockquote><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/6a2a575fa6f4fdac6dff6426f00bfd6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucEEPOqOf0aQzXHTzeAHIw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">质量扫描输出</figcaption></figure><p id="fe08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">发现开放端口后，我们可以使用<a class="ae kw" href="https://nmap.org/" rel="noopener ugc nofollow" target="_blank"> nmap </a>来检查服务器中正在运行哪些服务:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="a0ff" class="ln lo iq lj b gy lp lq l lr ls">nmap -p21,22,80 -Pn -sV 10.10.115.97</span></pre><ul class=""><li id="3b38" class="lt lu iq ka b kb kc kf kg kj lv kn lw kr lx kv ly lz ma mb bi translated"><code class="fe mc md me lj b">-p</code>:我们要扫描的港口</li><li id="5ca9" class="lt lu iq ka b kb mf kf mg kj mh kn mi kr mj kv ly lz ma mb bi translated"><code class="fe mc md me lj b">-Pn</code>:跳过主机发现，将所有主机视为在线</li><li id="8abf" class="lt lu iq ka b kb mf kf mg kj mh kn mi kr mj kv ly lz ma mb bi translated"><code class="fe mc md me lj b">-sV</code>:检查服务/版本信息</li></ul><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/ee664fe777ef840b87a970afdc4733f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y8vOFWk9DjG_WGO7n4STUA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">nmap输出</figcaption></figure><p id="a9f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从输出中，我们看到端口<strong class="ka ir"> 80 </strong>是打开的，它正在运行http服务，所以让我们在浏览器上检查一下。该页面只是一个图像，但如果我们检查源代码，我们会发现一个有趣的注释:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/141c94d0bb643775286fe715a4115ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9NNPfU5Bkm3CcvK5t4fKSg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated"/></figure><blockquote class="mk ml mm"><p id="8587" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated"><a class="ae kw" href="https://en.wikipedia.org/wiki/Steganography" rel="noopener ugc nofollow" target="_blank">隐写术</a>是将一条信息隐藏在另一个对象内的技术，例如<a class="ae kw" href="https://en.wikipedia.org/wiki/Steganography#Hiding_an_image_within_a_soundfile" rel="noopener ugc nofollow" target="_blank">在音频文件中隐藏一段文本</a>，所以我们只有在查看音频文件的声谱图时才能看到消息。</p></blockquote><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/b58a94766fea5a3e4122a94314524403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9SH_JNCUsa_htIVZ97Jtw.png"/></div></div></figure><p id="7f99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，我们在源代码中引用了上面的图像，所以我们可以假设我们应该研究它。让我们下载图片:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="c772" class="ln lo iq lj b gy lp lq l lr ls">wget <a class="ae kw" href="http://10.10.115.97/brooklyn99.jpg" rel="noopener ugc nofollow" target="_blank">http://10.10.115.97/brooklyn99.jpg</a></span></pre><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/cdb21e936b3395b09a56f114864ea84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cRuqGQRF52s7UP5jpyXPsQ.png"/></div></div></figure><h1 id="650e" class="na lo iq bd nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bi translated">接近机器</h1><p id="253c" class="pw-post-body-paragraph jy jz iq ka b kb nx kd ke kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv ij bi translated">通常，如果我们有密码，我们可以从图像中提取信息。在这种情况下，我们没有密码，但幸运的是，有一个非常好的(而且非常快)工具，我喜欢用它来应对隐写术挑战，它叫做<a class="ae kw" href="https://github.com/RickdeJager/stegseek" rel="noopener ugc nofollow" target="_blank"> Stegseek </a>。</p><p id="1b19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用<strong class="ka ir"> rockyou.txt </strong>单词表(一个<em class="mn">实际上是</em>大的密码列表)来破解这个密码并检索消息:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="d1cc" class="ln lo iq lj b gy lp lq l lr ls">stegseek brooklyn99.jpg /usr/share/wordlists/rockyou.txt</span></pre><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/78e6d5c777ad50811c496eed68daf575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ikajs9e0wx5wjSgW4EwjKA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">Stegseek输出</figcaption></figure><p id="6be1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Stegseek在这个图像中找到了另一个文件，让我们来读一下:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/d5a2dd3a354492e87b73cd64f45f9f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1aoZKIpz75sP_c6oGDBcg.png"/></div></div></figure><p id="5f91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嘿！因为我们有Holt的密码，我们可以检查我们是否能够使用<a class="ae kw" href="https://en.wikipedia.org/wiki/Secure_Shell" rel="noopener ugc nofollow" target="_blank"> SSH </a>用这些凭证登录机器:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/ad9eba18ab97f09ab039e78d946b9a0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ncho0mvJLvTTUXFVM0GD2w.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">机器访问✅</figcaption></figure><p id="f0e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以在目录和文件中查找用户标志:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="111a" class="ln lo iq lj b gy lp lq l lr ls">cat /home/holt/user.txt</span></pre><h1 id="e7e1" class="na lo iq bd nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bi translated">权限提升</h1><p id="631b" class="pw-post-body-paragraph jy jz iq ka b kb nx kd ke kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv ij bi translated">在寻找权限提升向量时，我总是测试的第一件事是列出用户的权限，并检查当前用户是否可以作为root用户执行任何操作:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="5d8a" class="ln lo iq lj b gy lp lq l lr ls">sudo -l</span></pre><ul class=""><li id="ce6c" class="lt lu iq ka b kb kc kf kg kj lv kn lw kr lx kv ly lz ma mb bi translated"><code class="fe mc md me lj b">-l</code>:列出用户的权限</li></ul><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/5b7143b9d25373d10c65f82fddc6b941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pYBUsctaq6u21T4sUos5QA.png"/></div></div></figure><p id="0e73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">似乎用户<code class="fe mc md me lj b">holt</code>被允许在这台机器上作为根用户运行<code class="fe mc md me lj b">nano</code>命令。我们可以使用<a class="ae kw" href="https://gtfobins.github.io/gtfobins/nano/#sudo" rel="noopener ugc nofollow" target="_blank"> GTFOBins </a>来检查我们如何利用它:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="9f5e" class="ln lo iq lj b gy lp lq l lr ls">sudo nano<br/>^R^X<br/>reset; sh 1&gt;&amp;0 2&gt;&amp;0</span></pre><blockquote class="mk ml mm"><p id="c00d" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated"><code class="fe mc md me lj b">^R</code>表示<code class="fe mc md me lj b">ctrl+r</code>，而<code class="fe mc md me lj b"><em class="iq">^X</em></code>表示<code class="fe mc md me lj b"><em class="iq">ctrl+x</em></code></p><p id="5bfd" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated">来自GTFOBins:如果二进制文件在<code class="fe mc md me lj b"><em class="iq">sudo</em></code>之前被允许作为超级用户运行，它不会放弃提升的特权，并且可以用于访问文件系统、升级或维护特权访问。</p></blockquote><p id="7cca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以在终端中，我们使用:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="74b9" class="ln lo iq lj b gy lp lq l lr ls">sudo nano</span></pre><p id="7b44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Nano是一个文本编辑器，所以当我们执行二进制文件时，会出现一个界面，现在我们可以按住<code class="fe mc md me lj b">ctrl+r</code>:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/24868ce8161c8b2ae9ef70c78bc8adbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7_E-iWX3boIXxV3Bebxtg.png"/></div></div></figure><p id="7d21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后<code class="fe mc md me lj b">ctrl+x</code>:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/4ec77bfd8bfaffc7642b7523cb2c10f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L8S2EkDjugOCq3KM3V4Lhg.png"/></div></div></figure><p id="e0f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们只需要编写命令<code class="fe mc md me lj b">reset; sh 1&gt;&amp;0 2&gt;&amp;0</code>:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/9ccfd8c9331f9aeaf38d4be67fc25fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gc_ZJChhK0OTLdYkQVl7lg.png"/></div></div></figure><p id="e7ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只需点击几次回车键，屏幕就会清晰一点，我们就有了root！</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/7039050e2fe3241908864133deea3c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_RgX8RFk5sEd_9ogMDSPpQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">特权升级✅</figcaption></figure><p id="2a44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以读取根标志:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="66d2" class="ln lo iq lj b gy lp lq l lr ls">cat /root/root.txt</span></pre><h1 id="e61e" class="na lo iq bd nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bi translated">结论</h1><p id="f60d" class="pw-post-body-paragraph jy jz iq ka b kb nx kd ke kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv ij bi translated">首先，布鲁克林九九是我最喜欢的电视节目之一，所以这是一个非常有趣的开发机器。将隐写术加入其中真的很有趣，让我们能够学习和使用一些我们在CTFs中不经常看到的不同东西。</p><p id="b015" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">九-九！</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="0356" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Infosec Writeups团队刚刚完成了我们的第一次虚拟网络安全会议和网络活动。我们有16位出色的演讲者，他们主持了非常有价值和鼓舞人心的会议。要查看演讲者和主题列表，请点击此处。</p><div class="oj ok gp gr ol om"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="on ab fo"><div class="oo ab op cl cj oq"><h2 class="bd ir gy z fp or fr fs os fu fw ip bi translated">IWCon2022 — Infosec书面报告虚拟会议</h2><div class="ot l"><h3 class="bd b gy z fp or fr fs os fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="ou l"><p class="bd b dl z fp or fr fs os fu fw dk translated">iwcon.live</p></div></div><div class="ov l"><div class="ow l ox oy oz ov pa jw om"/></div></div></a></div></div></div>    
</body>
</html>