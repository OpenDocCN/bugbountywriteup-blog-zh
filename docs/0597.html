<html>
<head>
<title>Found Stored Cross-Site Scripting — What’s Next? — Privilege Escalation like a Boss :D</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">找到存储的跨站点脚本—下一步是什么？—像老板:D一样特权升级</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/found-stored-cross-site-scripting-whats-next-privilege-escalation-like-a-boss-d-8fb9e606ce60?source=collection_archive---------1-----------------------#2020-05-19">https://infosecwriteups.com/found-stored-cross-site-scripting-whats-next-privilege-escalation-like-a-boss-d-8fb9e606ce60?source=collection_archive---------1-----------------------#2020-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/76ccc2c5149fb7d2244d635fb1c9c0a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*501HuqvUpp0PqB2QoB17CQ.png"/></div></div></figure><p id="2d25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">跨站点脚本是有史以来最突出的攻击之一。它仍然在野外被开发。跨站点脚本并不总是弹出一个带有一些随机的疯狂字符串或域或cookies的警告框。跨站点脚本漏洞可能会与其他易受攻击的问题联系在一起，造成严重影响。人们在他们的报告中写道，这是一个明显的影响<strong class="ka ir">攻击者可以窃取受害用户的会话cookies】，但这里的问题是有多少人实际上利用了它？通常对于存储的XSS，优先级是“中到高”，但是如果您真的可以窃取会话cookies，您可以接管“受害者会话”并做不使严重性为“严重”的事情。</strong></p><p id="d223" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">写这篇文章的目的是解释<strong class="ka ir">跨站脚本的重要性，将它与其他攻击联系起来，并利用低挂果实获得更高的利润。</strong></p><p id="3a38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你好，黑客和赏金猎人们，在这篇文章中，我将谈论<strong class="ka ir">我是如何用一个简单的存储的跨站点脚本和一些低挂的果实链接来执行权限升级到管理员帐户的。</strong></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="5643" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">简单地说，这个故事讲的是- </strong></h1><ul class=""><li id="1c99" class="mb mc iq ka b kb md kf me kj mf kn mg kr mh kv mi mj mk ml bi translated">XSS和存储的XSS快速概览</li><li id="8612" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">利用跨站点脚本</li><li id="d03c" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">寻找低垂的果实</li><li id="883a" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">链接漏洞</li><li id="fa3b" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">获取管理员的会话Cookies</li><li id="f50b" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">劫持管理会话和攻击者对管理员的权限提升</li><li id="e51b" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">开始管理的乐趣:D</li></ul></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="0bd2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">跨站点脚本(XSS)在野外被利用，甚至在现在。XSS有多种场景和类型，但为了坚持这篇文章，让我们快速了解一下<strong class="ka ir">存储的XSS是什么。</strong></p><p id="3fe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当应用程序按原样接受用户提供的输入时，允许用户输入<strong class="ka ir">恶意javascript代码</strong>，一旦执行，可能会导致严重的问题，如窃取会话cookies、将用户重定向到攻击者控制的网站等等。在<strong class="ka ir">存储XSS的情况下，</strong>JavaScript代码保留在应用中，并且每当<strong class="ka ir">与代码的交互发生时，执行代码的动作。</strong></p><p id="e349" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">比如:</strong>假设某社区网站上有一个用户简介。攻击者可以在公开的描述中插入恶意代码。现在，每当普通用户访问攻击者的个人资料时，描述中的代码就会被执行。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="5b76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近，我在开发一个与上面功能相同的私人程序，该程序容易受到用户资料描述字段中存储的<strong class="ka ir">跨站脚本的攻击。让我们将应用程序称为“www . target . com”</strong></p><p id="6da0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">应用程序的通常流程是:</p><ol class=""><li id="6147" class="mb mc iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mj mk ml bi translated">管理员用户可以添加多个具有受限角色的用户。</li><li id="f7af" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mu mj mk ml bi translated">管理员邀请用户加入组织。</li><li id="4ee8" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mu mj mk ml bi translated">被邀请的用户创建一个个人资料，所有用户的信息都可以在“人的目录”下看到。</li></ol><p id="87a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我从执行存储的XSS开始，并通过Bugcrowd进行了报告。第二天，当我再次测试该应用程序时，我突然想到，我想实时利用XSS来获得更多的乐趣。</p><p id="508f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我想进一步增加影响，所以我开始寻找一些其他的方法来链接漏洞。XSS已经是非自我XSS(自我XSS是一个用户必须自己输入代码才能获得执行)。我检查了cookies中是否存在<strong class="ka ir">“安全和httpOnly标志”。</strong></p><p id="6c17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">设置了这些标志的cookie不会从典型的XSS执行中检索到，通常，会话cookie会将这些标志设置为真。因此，XSS的影响实际上并不是<strong class="ka ir">通过窃取会话cookies来接管会话。</strong></p><p id="9daa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">酷毙了。所以现在我们有一个存储的XSS和不安全的饼干。所以我使用了一个简单的Cookie抓取器有效负载，它将Cookie重定向到一个远程服务器。</p><p id="52f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，我们已经→ <strong class="ka ir">一个完美的会话劫持方法。</strong></p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="9230" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我用管理员帐户登录，并导航到“人民的目录”。我一访问，就在我的远程服务器上获得了“Admin User”的会话cookies。</p><p id="99cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，我使用会话Cookies来访问“Admin”的会话。我转到“用户”，将我的攻击者用户的角色更改为<strong class="ka ir">“管理员”。</strong></p><p id="60fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，低特权用户拥有作为<strong class="ka ir">管理员的完全访问权限。为了好玩(仅限我的测试账户)，我继续从攻击者的账户中删除了原来的管理员。</strong></p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="nb na l"/></div></figure><p id="1386" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">报告时的初始严重性—高(p2) </strong></p><p id="c514" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">更新了利用后的严重性—严重(p1) +奖励(用于报告)</strong></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="914a" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">外卖</strong></h1><ul class=""><li id="3e55" class="mb mc iq ka b kb md kf me kj mf kn mg kr mh kv mi mj mk ml bi translated">在开始寻找bug之前，一定要绘制应用程序的功能图，这有助于系统化。</li><li id="fc8a" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">不要一发现错误就兴奋地急于提交，想想有哪些可能的升级。</li><li id="f35f" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">始终检查<strong class="ka ir">不安全的cookie</strong>并尝试实际显示会话劫持的实时利用。</li><li id="4033" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">链，链，链&amp;尽可能的链漏洞。</li><li id="40ff" class="mb mc iq ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">写好报告。你可以跟着我写关于<a class="ae nc" href="https://medium.com/bugbountywriteup/effective-vulnerability-report-writing-quick-triages-to-bonus-always-a-win-41b37188c63f" rel="noopener"> <strong class="ka ir">的好报道</strong> </a></li></ul></div></div>    
</body>
</html>