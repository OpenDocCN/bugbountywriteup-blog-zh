<html>
<head>
<title>Angler Exploitation Kit Infection 1 — Malware Traffic Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angler漏洞利用工具包感染1 —恶意软件流量分析</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/angler-exploitation-kit-infection-1-malware-traffic-analysis-b746514d42c8?source=collection_archive---------3-----------------------#2022-02-05">https://infosecwriteups.com/angler-exploitation-kit-infection-1-malware-traffic-analysis-b746514d42c8?source=collection_archive---------3-----------------------#2022-02-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/df15b6b995d790fc7c39f172335d5a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6s2r56rxpmyh2myYXTAoqQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.mcsuk.org/news/eight-scary-halloween-sea-creatures/" rel="noopener ugc nofollow" target="_blank">琵琶鱼</a></figcaption></figure><p id="b531" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我使用NetworkMiner、Wireshark和Brim来分析一个PCAP文件，该文件捕获了属于Angler漏洞利用工具包感染的网络流量。PCAP的文件属于蓝队在<a class="ae kc" href="https://cyberdefenders.org/blueteam-ctf-challenges/21" rel="noopener ugc nofollow" target="_blank">网络卫士</a>网站上的聚焦挑战，名为“<em class="lb">恶意软件流量分析3 </em>”，由<a class="ae kc" href="https://twitter.com/malware_traffic" rel="noopener ugc nofollow" target="_blank"> Brad Duncan </a>创建。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="f446" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">放弃</h1><p id="98a6" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">我喜欢在文章之前添加一个简短的免责声明，以鼓励人们在阅读本文之前尝试挑战，因为在这篇文章中显然会有<strong class="kf ir">剧透</strong><strong class="kf ir"/>。我相信，如果你先自己尝试，然后在遇到困难或需要提示时再回来写这篇文章，你会更喜欢这个挑战。因此，没有任何进一步的拖延，让我们开始吧！</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="b3b1" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">挑战问题</h1><blockquote class="mm mn mo"><p id="f136" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">1.受感染的Windows主机的IP地址是什么？</p></blockquote><p id="094f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从使用NetworkMiner打开挑战PCAP文件开始。向下查看NetworkMiner <strong class="kf ir"> hosts </strong>选项卡，我们可以看到一系列内部私有IP地址，包括一台Windows机器的地址。由于我们在组织的内部专用网络中看不到任何其他Windows计算机，我们可以假设这很可能是受感染的Windows虚拟机，但我们需要执行更深入的分析来确认这一点。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/0da125308703c3fb1ab5705d79c23434.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*1Oe1FkHBYFXRHHaanUgl0A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">受感染的Windows主机的IP地址。</figcaption></figure><blockquote class="mm mn mo"><p id="4055" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">2.漏洞利用工具包(EK)的名称是什么？(两个字)</p></blockquote><p id="27c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要找到漏洞利用工具包(EK)名称，我们可以将整个PCAP上传到VirusTotal并查看snort警报。这里，我们知道使用了<strong class="kf ir">钓鱼器EK </strong>。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/3cd5aaee6b90c1b0d6d25e7cef6b5b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*CVq5GfL8EVeHb7cvqiKHeA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Angler EK的病毒总数Snort警报。</figcaption></figure><blockquote class="mm mn mo"><p id="b9f1" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">3.提供漏洞工具包的FQDN是什么？</p></blockquote><p id="9ce8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们继续查看为上传的PCAP文件提供的VirusTotal详细信息，我们可以看到有三个HTTP请求被标记为有趣。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/8a81b7e81f548e4e35467542b4c117c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EgEgnBJptaU-9xC9yFGXQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">VirusTotal有趣的HTTP请求。</figcaption></figure><p id="58c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看这些请求的详细信息，我可以看到下载了两个flash文件和一个ZIP文件。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/ea40a414d57b5022eb6340d475ba9c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*UBCqrkOg2RIFD49428MBJg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">闪存文件版本9。</figcaption></figure><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/995541e726e01ae21c72dd64a41f8151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*KV3mTx8zFEwf7Z4JMOZkzQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">闪存文件版本14。</figcaption></figure><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/95ec2c5d6a23e585a143971c4ed42ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*k3OQQ4sphGZz8178sbYFvA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">ZIP存档文件。</figcaption></figure><p id="1707" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我可以用Wireshark导出这些文件，然后上传到VirusTotal。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/1497ebc7495c4b7b36df13f9da11da0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*vduuTCh4mTHX_LOlaNJ43w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">病毒总计闪存文件版本9。</figcaption></figure><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/0d759f352ea906670496f858ea71f0e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*kdL-oy6FrA06EUGne1h1QA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">病毒总计闪存文件版本14</figcaption></figure><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/f1b2c4fd7dc48f2631bd62d23ae7451e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*WaZdkuAHpFFj9m3vAOHGeg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">病毒总压缩存档文件。</figcaption></figure><p id="6f2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们检查VirusTotal提供的ZIP存档的详细信息，我们会看到与该文件相关联的一个名称引用了“<em class="lb"> AnglerEK </em>”。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/de22b9741ace9f027f8ce31d2d5e2f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*fKA557J6H1aA1MVX_8_77w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">VirusTotal对AnglerEK的引用，用于ZIP存档。</figcaption></figure><p id="945a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这表明与下载ZIP存档相关的FQDN用于下载Angler EK。</p><blockquote class="mm mn mo"><p id="7193" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">4.指向漏洞利用工具包登录页面的重定向URL是什么？</p></blockquote><p id="5aaa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在NetworkMiner的“sessions”选项卡下，我们可以看到Windows虚拟机第一次访问漏洞利用工具包登录页面。往回看，我可以看到Windows虚拟机在被重定向到漏洞利用工具包登录页面之前访问的FQDN。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/5322a2891ef572778da7451501518d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*7dMWRxE3T0n_aGOwXw0Afg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">NetworkMiner会话时间表。</figcaption></figure><p id="294c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">转到Wireshark，我们可以过滤HTTP流量，并找到上面突出显示的第一个FQDN的HTTP流。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/025643d6f065cc49de05a16c2b874815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*KTsBJARWtrcFB5ksSkdEpQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">“lifeinsidedetroit”网站的HTTP流。</figcaption></figure><p id="08a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我可以看到Windows VM从“<em class="lb"> adstairs </em>”网站访问了“<em class="lb"> lifeinsidedetroit </em>”网站，之前看到的恶意flash文件就是在这里下载的。发出POST请求，在响应中，我们可以看到EK登录页面的链接。如果我们继续跟踪这个流，我们可以看到指向漏洞利用工具包登录页面的重定向URL。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e8d5477527305f59ab293e6eccd44684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*mWU9KTAK5ACbj2NlTLtIYQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">重定向指向漏洞利用工具包登录页面的URL。</figcaption></figure><p id="65b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看上面对HTTP GET请求的响应，我可以看到在网站的HTML代码中隐藏了大量可疑的base64编码文本。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f8df5982b001a76dc723005905b03edd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*1NfXDyWeV-1SIjtlSWyegw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">HTML页面中隐藏的可疑Base64文本块。</figcaption></figure><p id="4ef2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在访问了上面的网页之后，我们可以看到下一个HTTP GET请求检索了被标识为Angler EK的ZIP存档文件(<strong class="kf ir"> PK </strong>文件头)。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/e94c92ede66f462e986911ecbf178a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*ttyCBrMGZXB9DXKQBEcoOg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">HTTP GET请求检索Angler EK。</figcaption></figure><blockquote class="mm mn mo"><p id="3a07" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">5.被入侵网站的FQDN是多少？</p></blockquote><p id="5d76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之前我们看到Windows VM从“<em class="lb"> adstairs </em>”网站访问了“<em class="lb"> lifeinsidedetroit </em>”网站。我们可以通过查看Wireshark中“<em class="lb"> adstairs </em>”网站的HTTP流来继续追溯我们的步骤。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d59e030ad49ce962a9072f441cdf9c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*eoT7S1xCi_ObNI-O6E_u-Q.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">HTTP GET请求检索恶意Flash版本9文件。</figcaption></figure><p id="80e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看HTTP流，我们可以在referrer请求头中看到受损网站的FQDN。然后我们可以看到一个HTTP GET请求来下载flash文件(<strong class="kf ir"> CWS </strong>文件头)。</p><blockquote class="mm mn mo"><p id="f5af" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">6.哪个TCP流显示正在传送恶意软件负载？提供流编号</p></blockquote><p id="408c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以过滤属于提供漏洞利用工具包的FQDN的HTTP对象。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/b7638193f5fadb26cb95c734f2625b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*swvkuaOenyNMOz8nrI0KtQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">过滤属于发送漏洞利用工具包的FQDN的HTTP对象。</figcaption></figure><p id="8335" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以看到恶意软件有效载荷和闪存文件的数据包编号。如果我们使用mime _ type "<em class="lb">application/octet-stream</em>"跟踪TCP流中的数据包编号，我们可以看到流编号。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/db19982289248f485a6f216dd4605940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*EDkQsXodEnLTlL9zgOnQ8A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">TCP流显示正在传送的恶意软件负载。</figcaption></figure><blockquote class="mm mn mo"><p id="9fbb" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">7.C&amp;C服务器的IP地址是什么？</p></blockquote><p id="69c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据之前PCAP上传的VirusTotal详细信息，我们可以看到恶意软件正在使用SSL加密。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/f04e42732e7c623b8bfce207741ec3d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*62CN-zCQYsW5aM58GNVMGw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">病毒总数SSL。</figcaption></figure><p id="4b7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们导航到Wireshark中的“<em class="lb">统计数据&gt;会话&gt; TCP选项卡</em>，并按照数据包数量从高到低对会话进行排序，我们可以看到前几个会话正在使用端口443(即HTTPS)。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/aeb43f5d1fd62f9c89a0a02ab4dc6247.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*ZsS3RwrRsMel5zuaONMurg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">按数据包数量排序的TCP会话。</figcaption></figure><p id="b6d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以排除第一个IP地址，它与“<a class="ae kc" href="https://developers.google.com/fonts/faq" rel="noopener ugc nofollow" target="_blank"><em class="lb">【fonts.gstatic.com】</em></a>”相关。在NetworkMiner的“hosts”选项卡下，我们可以看到上面以红色突出显示的第二个顶级IP地址有一个可疑的FQDN。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/aeee4c2af242bde03493a9096041f4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*LKDaJuyDxsYhmAgH8DqzzQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">可疑的FQDN。</figcaption></figure><p id="7c11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用Brim查看SSL流量事件，我们还可以看到主机的两个证书都是<a class="ae kc" href="https://attack.mitre.org/techniques/T1587/003/" rel="noopener ugc nofollow" target="_blank">自签名的</a>，这是一种用于加密C2流量的常用技术。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/13b1ae73514252110bbb9278150ceb19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7pPkjYHiU51Nexk1sw-BA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">自签名证书。</figcaption></figure><p id="0964" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于该IP地址有一个可疑的FQDN，正在与Windows VM交换大量的数据包，并且正在使用带有自签名证书的端口443(通常使用SSL加密来隐藏C &amp; C对话),我们可以相当有把握地说这是C &amp; C服务器IP地址。</p><blockquote class="mm mn mo"><p id="89cc" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">8.SSL证书的到期日期是什么时候？</p></blockquote><p id="14de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在NetworkMiner中，我们可以在files选项卡下找到自签名证书。选择该文件将为我们提供SSL证书的到期日期。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/c68f0c836c64ac0bd9e7e5b33c06dc68.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*2FWISJmmI2IfSms3AdlVcA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">NetworkMiner SSL证书到期日期。</figcaption></figure><p id="b919" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以使用<a class="ae kc" href="https://www.wireshark.org/lists/wireshark-users/201003/msg00080.html" rel="noopener ugc nofollow" target="_blank"> Wireshark </a>，通过查看包含SSL握手消息“certificate”的数据包，找到SSL证书的到期日期。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/a70360cd6e1b050575383e1fe89d5ad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*optb78GpJJoztI5LiwopFw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">SSL握手消息。</figcaption></figure><p id="d8ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以展开数据包的详细信息，并获得到期日期。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/2dece5887cb7b2154eff4ea88cd6c215.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*63oWyfe5ZMOFw05QBhatqw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Wireshark SSL证书到期日期。</figcaption></figure><blockquote class="mm mn mo"><p id="44f7" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">10.恶意域名提供了一个ZIP存档。此存档中包含的DLL文件的名称是什么？</p></blockquote><p id="bfb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要找到ZIP存档中包含的DLL文件的名称，我们可以将该文件上传到VirusTotal，并在relations选项卡中查看任何捆绑文件。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f6c20e7745e0ab6c47913c6deedd5f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*l7Qpv2ta3aOQ_DS2NGbJ4g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">VirusTotal捆绑文件。</figcaption></figure><p id="234f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以看到ZIP存档中包含的DLL文件的名称。我们还可以使用Wireshark查看捆绑的文件，并检查对下载ZIP存档的HTTP GET请求的响应:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/f4f0320c55a7fe6cf8b34c8aa4a99d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*TuR3pojdvLYQmX3m0m5nTA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Wireshark捆绑文件。</figcaption></figure><blockquote class="mm mn mo"><p id="39d7" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">11.提取恶意软件的有效载荷，去除它的泡沫，并删除开头的外壳代码。这将为您提供用于感染的实际负载(一个DLL文件)。有效载荷的MD5哈希是什么？</p></blockquote><p id="005d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从在Wireshark中导航到“<em class="lb">文件&gt;导出对象&gt; HTTP </em>”并提取恶意软件有效载荷开始。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/297c8a24e616cb69aa5433b6422ac218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*ocbsZNyDfaewmaWUnkKe1Q.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">从Wireshark提取恶意软件负载。</figcaption></figure><p id="fd8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们在Wireshark中查看这个恶意软件负载，我们可以看到大量可疑的重复文本。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/97e26995f4535d0e5b1c593c96060f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*RkgNw46fcDr343ysD88lnQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">可疑的重复文本。</figcaption></figure><p id="5976" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们需要检查使用了什么模糊处理。在网上做一些研究，我们可以找到几篇<a class="ae kc" href="https://forensicblogs.com/tag/angler-ek/page/9/" rel="noopener ugc nofollow" target="_blank">文章</a>展示Angler EK如何使用<a class="ae kc" href="https://www.geeksforgeeks.org/xor-cipher/#:~:text=XOR%20Encryption%20is%20an%20encryption,match%20with%20the%20correct%20one." rel="noopener ugc nofollow" target="_blank"> XOR </a>加密。我们还可以看到Angler EK使用过的一些XOR密钥。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/25542258a61ce1393671da26cab07659.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*YlhzUogF7g6f-LdeZmz69g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Angler EK使用的XOR密钥。</figcaption></figure><p id="ca0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看上面的可疑文本块，我们可以使用CyberChef检查Angler EK之前使用的任何XOR密钥是否与可疑的重复文本匹配。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/b10ff5316276ce623947834dee3c7ba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0tgUFSEa7A8ah4wFuaHEuA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">CyberChef XOR密钥。</figcaption></figure><p id="b465" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到XOR密钥“<em class="lb"> adR2b4nh </em>”的匹配。接下来，我们将恶意软件有效负载上传到CyberChef，并将其与识别出的密钥进行异或运算。然后，我们可以将输出下载到一个新文件中。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/eb74b236654007c622b7810aeab5040f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TNNgtGYgbPOjizPu_ChxLA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">将恶意软件负载与CyberChef中的密钥进行异或运算。</figcaption></figure><p id="bfa9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们需要删除文件开头的外壳代码。我们可以通过使用binwalk提取PE文件来实现这一点。</p><pre class="mt mu mv mw gt ny nz oa ob aw oc bi"><span id="e468" class="od lk iq nz b gy oe of l og oh">$ binwalk -D='.*' download.dat</span><span id="a06a" class="od lk iq nz b gy oi of l og oh">DECIMAL       HEXADECIMAL     DESCRIPTION<br/>-----------------------------------------------------------------<br/>1425          0x591           Microsoft executable, portable (PE)</span></pre><p id="c3db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦文件被提取，我们就可以计算文件的MD5哈希。</p><pre class="mt mu mv mw gt ny nz oa ob aw oc bi"><span id="8760" class="od lk iq nz b gy oe of l og oh">$ md5sum 591 </span><span id="1f04" class="od lk iq nz b gy oi of l og oh"><strong class="nz ir">3dfa337e5b3bdb9c2775503bd7539b1c</strong>  591</span></pre><blockquote class="mm mn mo"><p id="de45" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">12.PE文件编译期间启用了哪两种保护方法？(逗号分隔)</p></blockquote><p id="645b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我首先使用<strong class="kf ir"> pesec </strong>来标识第一种保护方法:</p><pre class="mt mu mv mw gt ny nz oa ob aw oc bi"><span id="d017" class="od lk iq nz b gy oe of l og oh">$ pesec 591</span></pre><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/b5f6c66f9a02319c8619b15a41f098ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*2eTEqOHw7hfkBuxFY0zM6g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">SEH保护方法。</figcaption></figure><p id="1c01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我可以看到第一种保护方法是<strong class="kf ir"> SEH </strong>，但我无法识别第二种保护方法。</p><blockquote class="mm mn mo"><p id="8319" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">13.DLL文件是什么时候编译的？</p></blockquote><p id="2fe2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们将PE文件上传到VirusTotal，我们可以看到该文件的编译时间:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/be7c3a71368423bb29c116f78596b566.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*-uoRZp2F7TOSwVt5jIsQzg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">DLL文件编译时间。</figcaption></figure><blockquote class="mm mn mo"><p id="e349" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">14.Flash文件与重定向URL一起使用。使用了什么URL来检索这个flash文件？</p></blockquote><p id="df5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之前，我们看到Windows VM从“<em class="lb"> adstairs </em>”网站访问了“<em class="lb"> lifeinsidedetroit </em>”网站，恶意flash文件就是从这个网站下载的。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/025643d6f065cc49de05a16c2b874815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*KTsBJARWtrcFB5ksSkdEpQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">与重定向URL结合使用的Flash文件。</figcaption></figure><blockquote class="mm mn mo"><p id="1409" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">15.被利用漏洞的CVE是什么？</p></blockquote><p id="c0b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们回头看看展示Angler EK如何使用XOR加密的文章，我们可以看到与XOR密钥相关的CVE。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/25542258a61ce1393671da26cab07659.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*YlhzUogF7g6f-LdeZmz69g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">被利用的弱点的CVE。</figcaption></figure><blockquote class="mm mn mo"><p id="4c8c" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">16.受感染主机使用的web浏览器版本是什么？</p></blockquote><p id="303a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用Wireshark或NetworkMiner来查看<strong class="kf ir"> Web浏览器用户代理</strong>字段。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/ddf1248b264c5dbeaf218618dfaa99f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*r60xtOG8wWIraEJ0u_cDKw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">NetworkMiner web浏览器版本。</figcaption></figure><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/faf11548cc0935dc484e4b2ba36d02ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*sknX02pAPGsyHBuPzIQY4A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Wireshark网络浏览器版本。</figcaption></figure><p id="40bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以看到正在使用的web浏览器版本是Microsoft Internet Explorer版本9。</p><blockquote class="mm mn mo"><p id="90f5" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">17.具有最高RTT的DNS查询是什么？</p></blockquote><p id="7be8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了找到具有最高<a class="ae kc" href="https://www.imperva.com/learn/performance/round-trip-time-rtt/" rel="noopener ugc nofollow" target="_blank"> RTT </a>的DNS查询，我们可以使用Wireshark来<a class="ae kc" href="https://stackoverflow.com/questions/28726136/time-difference-between-two-packets-in-wireshark#:~:text=Here's%20how%20I%20did%20it,5.&amp;text=Then%2C%20go%20to%20View%20%3E%20Time,taken%20between%20those%20two%20packets." rel="noopener ugc nofollow" target="_blank">显示数据包之间的时间差</a>。然后，我们可以从最长时间到最短时间对数据包进行排序，并过滤DNS数据包，以获得具有最高RTT的DNS查询。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/6a74da2b72568975dc2274f4fb0ae198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lu9lFiPP_sYQ_DkqyVemPA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">具有最高RTT的DNS查询。</figcaption></figure><blockquote class="mm mn mo"><p id="1b6c" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">18.出现最多的SSL证书颁发者的名称是什么？(一个词)</p></blockquote><p id="ed0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用NetworkMiner，在文件选项卡下，过滤<strong class="kf ir">。cer </strong>文件扩展名。我们可以看到出现最多的SSL证书颁发者是<strong class="kf ir"> Google </strong>。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/b6c65670ee972b9fef7b6e30f7f06085.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*R6d2sMxQscvGFP2FjsVyyg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">网络矿工证书文件。</figcaption></figure><p id="5be4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以使用Brim来过滤SSL事件，并统计一个唯一的颁发者出现的次数。</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi op"><img src="../Images/9a01354b8eb8f399d0cbae37c825ae53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*GxrSHQ0tLuFaKf5BrKNCAA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Brim SSL证书颁发者。</figcaption></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="d8f4" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结束语</h1><p id="3d7e" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">我发现这个挑战对于使用NetworkMiner、Brim和Wireshark进行练习来说非常棒。我也真的很喜欢通过这个PCAP挑战文件工作，并了解如何钓鱼开发工具包感染Windows虚拟机。谢谢你一直读到最后，继续黑下去😄！</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="1d1a" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae kc" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="oq or gp gr os ot"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd ir gy z fp oy fr fs oz fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">iwcon.live</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph jw ot"/></div></div></a></div></div></div>    
</body>
</html>