<html>
<head>
<title>WhiteHat Grand Prix 2018 Quals Writeup — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">怀特哈特大奖赛2018年质量报告-第3部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/whitehat-grand-prix-2018-quals-writeup-part-3-54a500ddda0e?source=collection_archive---------0-----------------------#2018-08-28">https://infosecwriteups.com/whitehat-grand-prix-2018-quals-writeup-part-3-54a500ddda0e?source=collection_archive---------0-----------------------#2018-08-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fffc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">世界协调时+2时间2018年8月27日下午13:14</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d12ea7f990fe96e30745dde9a8d95571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UOLg2-H4GY0zpCXMgTQ77w.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">怀特哈特大奖赛2018年质量报告-第3部分</figcaption></figure><p id="7582" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个很好的反向挑战，只是我们必须在理解加密函数的工作原理后反向它。</p><h1 id="58c6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">re06</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/f1c207a8bb4847a4e239f932e60d3e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*blX9pWI6UZkKrbC3U6Almw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">re06挑战赛</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/1b65ebc7ca17125532ca2cd44d0a5e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*EQuC2KK4z_ss0W1O9QIy6A.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">re06文件(reverse.exe)</figcaption></figure><blockquote class="mb mc md"><p id="f4c2" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated"><strong class="jp ir">挑战:</strong>【material.grandprix.whitehatvn.com/re06/】T2</p></blockquote><p id="28fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是win32 GUI(。Net)二进制，我们用<a class="ae mi" href="https://www.red-gate.com/products/dotnet-development/reflector/index" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">来读取分析一下吧。净反射器</strong> </a>或<a class="ae mi" href="https://github.com/0xd4d/dnSpy/releases" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> DNSpy </strong> </a>:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/973487dde08531abd9800a614b29f3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*qV5aEBdaQKQ81-taMuZhAw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">reverse.exe接口</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/8cfe8e1f130985f093962c308070c2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*6L61cD1q0HmPMw0fdAv8Hg.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">reverse.exe接口(错误的键)</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/bbc2f5ac768e2a3ea108607778c9bbad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*DNIWmc8B24DpNsrlAeTgAw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">PEiD(reverse.exe)</figcaption></figure><h2 id="e16e" class="mm lc iq bd ld mn mo dn lh mp mq dp ll jy mr ms lp kc mt mu lt kg mv mw lx mx bi translated">反编译:</h2><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi my"><img src="../Images/a01d9104e5360de09d58e1955baa4aef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1cz0xReDFBaqBnzydwmxfw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">DNSpy(主窗口—reverse.exe)</figcaption></figure><p id="fbd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里是<a class="ae mi" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re06/MainWindow.cs" rel="noopener ugc nofollow" target="_blank"> <em class="me">主窗口</em> </a>:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="79cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，我用<a class="ae mi" href="https://github.com/0xd4d/dnSpy/releases" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> DNSpy </strong> </a>反编译了二进制，找到了main函数(MainWindow)。</p><h2 id="618e" class="mm lc iq bd ld mn mo dn lh mp mq dp ll jy mr ms lp kc mt mu lt kg mv mw lx mx bi translated">分析:</h2><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nb"><img src="../Images/96634a1258bdb6d36a2e45737b57cc0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FhpOu9Z0AFLT31zLnOs-Jg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">btn _检查_点击</figcaption></figure><p id="a649" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的输入使用<a class="ae mi" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re06/Enc.cs" rel="noopener ugc nofollow" target="_blank"> <em class="me"> Enc </em> </a>函数加密，带3个自变量<strong class="jp ir"> (text，e，n) </strong>带<strong class="jp ir"> text </strong>和<strong class="jp ir"> e = 9157 </strong>和<strong class="jp ir"> n = 41117 </strong>。然后是检查条件，检查加密输入<strong class="jp ir">(标志)</strong>是否正确。</p><p id="f3db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您在<a class="ae mi" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re06/Enc.cs" rel="noopener ugc nofollow" target="_blank">中看到的<em class="me"> Enc </em>中的</a>功能；文本中的每个字母都有迭代，并通过具有3个参数(m，e，n)的<a class="ae mi" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re06/mod.cs" rel="noopener ugc nofollow" target="_blank"> <em class="me"> mod </em> </a>函数传递，该函数计算幂，然后给我们加密文本<strong class="jp ir"> c </strong>:</p><blockquote class="mb mc md"><p id="f03a" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated"><strong class="jp ir"> pow(m，e，n) = c </strong></p></blockquote><p id="f358" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且看起来是这样的<a class="ae mi" href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> RSA加密</strong> </a> <em class="me">的每个字母</em>由<em class="me"> </em>使用<a class="ae mi" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re06/Enc.cs" rel="noopener ugc nofollow" target="_blank"> <em class="me"> Enc </em> </a>函数。</p><blockquote class="mb mc md"><p id="af76" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">m: text = &gt;消息(text = FLAG =？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？)</p><p id="1d74" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated"><strong class="jp ir"> e: 9157 = &gt;公共指数</strong></p><p id="c6bc" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated"><strong class="jp ir"> n: 41117 = &gt;模数</strong></p><p id="f0d1" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated"><strong class="jp ir"> c: flag = &gt;加密文本</strong></p><p id="7ebe" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated"><strong class="jp ir"> d:？？？？= &gt;私人指数</strong></p></blockquote><h2 id="dc9f" class="mm lc iq bd ld mn mo dn lh mp mq dp ll jy mr ms lp kc mt mu lt kg mv mw lx mx bi translated">解密:</h2><p id="d984" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">为了解密，我们必须找到<strong class="jp ir">私钥(d，n) </strong>。我们有<strong class="jp ir"> n </strong>和<strong class="jp ir"> e </strong>，这意味着我们有<strong class="jp ir">公钥(e，n) </strong>。因此，让我们计算<strong class="jp ir"> d </strong>以便找到私钥，然后解密<strong class="jp ir"> c </strong>。</p><p id="4d39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一次，我试图将<a class="ae mi" href="http://www.factordb.com/index.php?query=41117" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"/><strong class="jp ir">n</strong></a>因式分解，但我做不到，后来又试图强行分解<strong class="jp ir"> d </strong>，但很难。</p><p id="974a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">于是，我用<a class="ae mi" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re06/mod.cs" rel="noopener ugc nofollow" target="_blank"> <em class="me"> mod </em> </a>函数生成<strong class="jp ir"> num2 </strong>并反转<a class="ae mi" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re06/Enc.cs" rel="noopener ugc nofollow" target="_blank"> <em class="me"> enc </em> </a>函数，在<strong class="jp ir"> mod(m，e，n) = num2 </strong>时通过暴力破解<strong class="jp ir"> c </strong>。但是我在很长时间后找到了这个解决方案… 0ops！！！😔</p><p id="f10d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我的<a class="ae mi" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re06/re06.py" rel="noopener ugc nofollow" target="_blank">脚本</a>解密<strong class="jp ir"> c </strong>:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mz na l"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/2fb7254f21d4d7ef038a8d7c147f4c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*CYOKfplz-B6axOaZWBhEzw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">re06.py输出(结果)</figcaption></figure><p id="c167" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出:<strong class="jp ir">怀特哈特{ N3xT _ t1 m3 _ I _ wi11 _ Us3 _ l4rg 3 _ nUmb3r }</strong></p><p id="85d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来试试:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/7624bb2760bda006ba846801ccb47300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*w3a-TyNJioUC8yU5jUO3CQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">reverse.exe接口(正确的键)</figcaption></figure><p id="8f91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SHA1把它做成正确的旗帜。</p><blockquote class="mb mc md"><p id="ff8d" class="jn jo me jp b jq jr js jt ju jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj kk ij bi translated">标志是:<strong class="jp ir">怀特哈特{ be 1 f 21d 22 D6 ca 5854 be 238772 C7 AC 594 EAD C5 ab 0 }</strong></p></blockquote><p id="0ddf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个很好的挑战，但我讨厌用<em class="me">加密</em>反转部分来制造好的<em class="me">解密</em>函数，因为我浪费了很长时间寻找<strong class="jp ir"> d </strong>并试图用<strong class="jp ir"> RSA </strong>直接解密，这似乎是不可能的，但我仍然在想，有一些方法可以让我们通过直接使用RSA来解决这个挑战。</p><p id="c4cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你有兴趣阅读更多关于这篇文章的内容，请查看<a class="ae mi" href="https://medium.com/bugbountywriteup/whitehat-grand-prix-2018-quals-writeup-part-1-f299f9126bbb" rel="noopener"> <strong class="jp ir">第一部分</strong> </a>和<a class="ae mi" href="https://medium.com/bugbountywriteup/whitehat-grand-prix-2018-quals-writeup-part-2-4da3c66526cc" rel="noopener"> <strong class="jp ir">第二部分</strong> </a>。</p></div></div>    
</body>
</html>