<html>
<head>
<title>Reversing Microsoft’s Windows95 Product Key Check Mechanism</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">逆转微软的Windows95产品密钥检查机制</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/reversing-microsofts-windows95-product-key-check-mechanism-ca7e825014b6?source=collection_archive---------0-----------------------#2021-05-14">https://infosecwriteups.com/reversing-microsofts-windows95-product-key-check-mechanism-ca7e825014b6?source=collection_archive---------0-----------------------#2021-05-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b631" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们回到过去，看看25年前需要什么才能确保安全！</p><h1 id="8b60" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">放弃</h1><blockquote class="lj lk ll"><p id="1555" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated">Microsoft Windows95是微软公司的注册资产，于1995年8月24日发布供一般使用。本文纯粹出于教育目的，无意损害任何公司/个人拥有的任何软件/产品。</p><p id="c202" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated">随着Windows95的停止(主流支持于2000年12月31日结束，扩展支持于2001年12月31日结束)以及产品密钥检查算法和策略在后续版本中更加先进，我们现在可以安全地讨论这个话题了。</p></blockquote><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/d8083daf27338eb074fd6289455706b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/0*YsWn22qnqX8jbHMS"/></div></figure><p id="92f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi ly translated"><span class="l lz ma mb bm mc md me mf mg di"/>你知道<strong class="jp ir">111–1111111</strong>是一个有效的Windows95产品密钥，那么<strong class="jp ir">000–0000007</strong>也是吗？我没有。有一天，我正在浏览YouTube，通过stacksmashing关于这个主题的视频[ <a class="ae mh" href="https://www.youtube.com/watch?v=cwyH59nACzQ" rel="noopener ugc nofollow" target="_blank"> THIS </a> ]发现了这个问题，他在视频中讨论了这个问题的工作原理，并分析了一些代码，这让我很好奇，于是<strong class="jp ir">我决定自己来做</strong>并反转负责产品密钥检查的库文件。</p><p id="4245" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我就是这样做的，现在我想和你分享我的经验，像往常一样，我试着确保你可以轻松地重现结果，所以我上传了所有的项目文件和源文件供你下载:)</p><p id="3fdb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想看的可以看视频，但这里我们会讨论更多。</p><blockquote class="lj lk ll"><p id="e818" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated">文章难度等级:</p><p id="1c0f" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated">理解—初学者</p><p id="39ce" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated">实现和复制—中间</p></blockquote><h1 id="c342" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">下载资产</h1><p id="954f" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">如果你愿意的话，下面是你在这篇文章后面需要做的事情。<code class="fe mn mo mp mq b">[All files uploaded on Google Drive]</code></p><div class="mr ms gp gr mt mu"><a href="https://drive.google.com/drive/folders/1MZSUI3jzLpDLCqKWHeboi7reebREryjV?usp=sharing" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">Windows95文章资产- Google Drive</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">文件夹包含所有的个人文件，你可以使用文件夹链接下载所有一次或只下载setupx.dll和Ghidra文件，如果你想。drive.google.com</h3></div></div><div class="nc l"><div class="nd l ne nf ng nc nh lw mu"/></div></div></a></div><ol class=""><li id="2778" class="ni nj iq jp b jq jr ju jv jy nk kc nl kg nm kk nn no np nq bi translated"><a class="ae mh" href="https://drive.google.com/file/d/1daadKO2pcWX9If9Q8pojnmYQB8QszWnu/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Windows95 ISO </a></li><li id="9066" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated"><a class="ae mh" href="https://drive.google.com/file/d/1QTnpF50QPeshD5jpFlCFiNV03wu3SCrM/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">setupx.dll</a></li><li id="5e5c" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated"><a class="ae mh" href="https://drive.google.com/file/d/13nMxFSIM-toiJXJqvTrLkn1FYeKQSkGD/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Ghidra项目文件</a></li></ol><h1 id="557f" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">设置虚拟机/串行密钥检查点。</h1><p id="e614" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi ly translated"><span class="l lz ma mb bm mc md me mf mg di"/>我已经使用VMware Workstation 16 Pro安装了Win95，这个过程非常简单，如果你愿意，你可以按照下面给出的文章进行操作，我添加了一些截图，只是为了追溯到90年代。对于本文，我们将在产品密钥提示处停止。</p><div class="lr ls lt lu gt ab cb"><figure class="nw lv nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><img src="../Images/289a9df3082d26d8b71eb44c93a20c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*V1smOmZ0pnnYjX_qINAJPA.png"/></div></figure><figure class="nw lv og ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><img src="../Images/8f5c1947cafa0fcae7a9ec3597d6004c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*o3QnBqaCyYydZTUQKnHDTw.png"/></div></figure></div><div class="ab cb"><figure class="nw lv oh ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><img src="../Images/147df046b25f934632dfbd28594d610f.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*wAZ6ddSoCmjwaMJYSnHBnA.png"/></div></figure><figure class="nw lv oi ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><img src="../Images/9e246752294f8a2a3ba1a11c467415ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*uYw19juaNdkq9Rs744ZSZg.png"/></div></figure></div><p id="2a49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">VMWare官方文章:<a class="ae mh" href="https://www.vmware.com/support/ws3/doc/ws32_guestos10.html" rel="noopener ugc nofollow" target="_blank"> Windows 95安装指南(vmware.com)</a></p></div><div class="ab cl oj ok hu ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ij ik il im in"><h1 id="e550" class="kl km iq bd kn ko oq kq kr ks or ku kv kw os ky kz la ot lc ld le ou lg lh li bi translated">好东西</h1><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/52f004a67e3dfd20bace906608be9bf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*Pjv9fysKjUB3yhVAaHjEhw.png"/></div></figure><h2 id="d12b" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">我的分析堆栈</h2><ol class=""><li id="32ac" class="ni nj iq jp b jq mi ju mj jy pi kc pj kg pk kk nn no np nq bi translated"><strong class="jp ir">主机OS : </strong> <a class="ae mh" href="https://saketupadhyay.medium.com/5-step-pre-built-malware-analysis-lab-f70e59521e31" rel="noopener"> Windows 10 Pro。对于工作站</a></li><li id="22ae" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated"><strong class="jp ir">分析OS:</strong><a class="ae mh" href="https://www.kali.org/docs/wsl/win-kex/" rel="noopener ugc nofollow" target="_blank">Kali Linux(Windows Subsystem for Linux[WSL]v 2.0)</a></li><li id="b5c6" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated"><a class="ae mh" href="https://www.7-zip.org/download.html" rel="noopener ugc nofollow" target="_blank"> 7z </a>，cabextract，<a class="ae mh" href="https://www.hex-rays.com/ida-free/" rel="noopener ugc nofollow" target="_blank"> IDA </a>，<a class="ae mh" href="https://ghidra-sre.org/" rel="noopener ugc nofollow" target="_blank"> Ghidra </a></li></ol><h2 id="488f" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">提取ISO</h2><p id="d520" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">如果你下载了我在上面上传的资源，你应该有一个<code class="fe mn mo mp mq b">.7z</code>文件，你可以使用7zip存档管理器提取它，你会得到ISO。</p><p id="dd3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在ISOs类似于zip存档，它们是无损的，把所有文件存储在一个容器里，就是这样。ISO通常不压缩数据，它只是将数据存档。</p><p id="9ede" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以你可以使用任何存档管理软件提取ISO，我用的是7zip。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pl"><img src="../Images/5a7e112d70001fd41131ee6b46683d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTTyZx3wj5HiFJ1sMLbFPQ.png"/></div></div></figure><p id="6906" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后你会有一个文件夹，里面会有ISO的所有内容。</p><p id="d275" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到此文件夹，因为我们将在此继续下一步。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pm"><img src="../Images/b289057c6dfa6a243f96091589f65d57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UORfzNvTLNo5zllV1jMn9A.png"/></div></div></figure><p id="2b72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我打开PowerShell并使用<code class="fe mn mo mp mq b"><strong class="jp ir">bash</strong></code>激活我的WSL发行版</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pn"><img src="../Images/285ba44e9665e70c04325a814ed2dedc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPxI9Z7Ju9OsPgw9UDRwhg.png"/></div></div></figure><h2 id="294b" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">寻找负责“产品识别”的代码/库</h2><p id="0865" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">windows安装程序中的大多数文件都打包在。cab或cab文件。</p><blockquote class="lj lk ll"><p id="2da1" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated">Cabinet是Microsoft Windows的一种存档文件格式，支持无损数据压缩和用于维护存档完整性的嵌入式数字证书。~维基</p></blockquote><p id="92b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了提取这些文件，我使用了Linux中的<code class="fe mn mo mp mq b">cabextract</code>工具。你可以通过你的软件包管理器安装它—</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi po"><img src="../Images/fb33ab429e46a151cd32854fddf65679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ARmR2kC_YVh0CbptH9-Sfw.png"/></div></div></figure><p id="36cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装后，我们提取WIN95文件夹中的所有CAB文件</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pp"><img src="../Images/33081a7dfb5060fb216887cdeb0b2b4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gT99QraVJSy6Q0nWOqdPcg.png"/></div></div></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pn"><img src="../Images/4e87bdfef18ecf18f8148215e7d62288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wdlGrNriKlFDhveT9oUBNg.png"/></div></div></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pq"><img src="../Images/5b17431ed7d4708b91cc974f9b189583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbCExAdhNPg1lJ62q3sJUQ.png"/></div></div></figure><p id="12b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这之后，你的WIN95目录将会被windows95用来安装的资源所填充。</p><p id="88bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们将使用grep搜索字符串<strong class="jp ir"> <em class="lm">【产品标识】</em> </strong>。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pn"><img src="../Images/27201f5eabc798a1321c5487b6c03194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dLKLAo2BDsjjJOygAP-d0w.png"/></div></div></figure><p id="5111" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们把<code class="fe mn mo mp mq b"><strong class="jp ir">suwin.exe</strong></code>作为潜在的目标，但是根据经验，我知道这些关键的函数不是在单个可执行文件中实现的，而是通过动态库或者<code class="fe mn mo mp mq b"><strong class="jp ir">DLLs</strong></code> <strong class="jp ir"> </strong>加载的，所以我们将试着列出这个过程中使用的库。</p><p id="e78c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们在Ghidra中打开<code class="fe mn mo mp mq b"><strong class="jp ir">suwin.exe</strong></code>,查看二进制文件的<code class="fe mn mo mp mq b"><strong class="jp ir">IMPORTS TABLE</strong></code></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/6882c54a4c77b84bafb6e1d64c05c06a.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*xJzP5AbJ0NIYt4s-j7jwvg.png"/></div></figure><p id="bfd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以看到6个导入的库</p><p id="fade" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中，我们可以丢弃GDI、内核、键盘和用户，因为它们做什么很明显。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/50ff5167b4e523bddd13b9ade630fb8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*M8d-sUDY-Ae3AFAVLF1XUQ.png"/></div></figure><p id="afa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有意思的是SETUPX和VERX导入，看VERX的导入函数，看起来这个是用来获取文件版本等文件信息的。所以我们剩下的唯一目标是SETUPX。</p><p id="63cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在解压后的文件夹中搜索，我们得到了对<code class="fe mn mo mp mq b"><strong class="jp ir">setupx.dll</strong></code>动态库文件的引用，该文件由<code class="fe mn mo mp mq b"><strong class="jp ir">suwin.exe</strong></code>使用</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pt"><img src="../Images/48efeba1a503b8debc7726bd2fd07030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YvqTajfijLuQDtNPcxDGmQ.png"/></div></div></figure><p id="bc4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们导入这个库，并在Ghidra中对此进行分析。</p><h2 id="2245" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">在吉德拉进口setupx.dll</h2><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pu"><img src="../Images/5a30e553f6d24f35334264067a7f164f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fLb4DViGY14Zr-Wwl4HYCA.png"/></div></div></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="ab gu cl pv"><img src="../Images/3a08708af610a4ac82a2a253803f3278.png" data-original-src="https://miro.medium.com/v2/format:webp/1*mW-591t7ZT6ydNhRCtcRcQ.png"/></div></figure><p id="2455" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在导入文件并花了一些时间分析库中的函数后，我被弄糊涂了。这里有太多的函数，我不可能检查所有的函数来找到密钥验证机制，所以我查看了函数名并搜索了关键字，还从stacksmashing的视频中获取了一些提示。</p><p id="77d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">寻找像“产品密钥”、“验证”、“产品ID”这样的术语</p><p id="b067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们得到了一些有趣的东西。</p><p id="dac5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，PIDVALIDATE函数有两个参数，由许多switch语句和案例组成。</p><p id="b026" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进一步观察汇编和反编译的代码，我觉得这些开关条件似乎是用来检查Windows操作系统的类型，如“家庭”、“专业”、“企业”、“OEM”等。</p></div><div class="ab cl oj ok hu ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ij ik il im in"><h1 id="d426" class="kl km iq bd kn ko oq kq kr ks or ku kv kw os ky kz la ot lc ld le ou lg lh li bi translated">有趣的东西</h1><blockquote class="lj lk ll"><p id="2ae8" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated"><strong class="jp ir">注:</strong>我已经清理了一些代码，重命名了一些变量，修正了一些定义，还创建了一些干净的基于GITHUB的gists，让你更容易理解。当你自己尝试时，你不会得到完全相同的结果，因为你必须自己做以上所有的事情，但这很有趣，如果你有兴趣，我建议你尝试一下。</p></blockquote><p id="1072" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">继续…在<strong class="jp ir"> PIDVALIDATE </strong>函数中，我们看到两个我们感兴趣的函数调用。</p><ol class=""><li id="18b1" class="ni nj iq jp b jq jr ju jv jy nk kc nl kg nm kk nn no np nq bi translated"><code class="fe mn mo mp mq b"><strong class="jp ir">PersonalProductKeyCheck(args);</strong></code> <strong class="jp ir"> </strong>功能负责检查家庭用户钥匙。</li><li id="e2c4" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated"><code class="fe mn mo mp mq b"><strong class="jp ir">OEM_KeyCheck(args);</strong></code>功能负责OEM钥匙检查。</li></ol><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi pw"><img src="../Images/5143a254eebf322f2cce8cd167704e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyM8bLdxFpsVuQsJkLgX6g.png"/></div></div></figure><h2 id="e36d" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">产品密钥检查功能</h2><p id="b41f" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">这是检查家庭用户的实际产品密钥的地方。而且我很惊讶地看到<strong class="jp ir">这个代码有多小</strong>！！</p><p id="e474" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在清理代码和修正一些赋值之后，我们得到了这个—</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi px"><img src="../Images/c5e11cc22c1144ad59adf25c29c4d7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-9i6Mya7YdBq8Zh2a1N5Zw.png"/></div></div></figure><p id="e813" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="lm">为您清理-er代码:</em> </strong></p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="py pz l"/></div></figure><p id="45b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们可以看到我们得到2个参数<code class="fe mn mo mp mq b"><strong class="jp ir">param1 and param2</strong></code>，<code class="fe mn mo mp mq b"><strong class="jp ir">param1</strong></code> <strong class="jp ir"> </strong>是产品密钥<code class="fe mn mo mp mq b"><strong class="jp ir">char*</strong></code> <strong class="jp ir">的字符序列。</strong></p><p id="28db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<em class="lm">第12行</em>中，键的前3位数被复制到<code class="fe mn mo mp mq b"><strong class="jp ir">local_6</strong></code> <strong class="jp ir"> </strong>缓冲区，在<em class="lm">第14行</em>字符序列通过<code class="fe mn mo mp mq b"><strong class="jp ir">atoi</strong></code> <strong class="jp ir"> </strong>库函数被转换为整数，那么这只是一个if条件，它将拒绝任何以<code class="fe mn mo mp mq b">333, 444 ,555, 666, 777, 888 or 999</code>开头的键，这意味着如果一个键以除上述列表之外的<code class="fe mn mo mp mq b">000 — 998</code>开头，它将传递到下一个检查。</p><h2 id="fccd" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">Mod7检查功能</h2><p id="79a6" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">简而言之，这就是检查<strong class="jp ir">下一个7位数数列的和是否能被7 </strong>整除的函数。就是这样。</p><p id="33b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果<strong class="jp ir">数字在0-8</strong>[第13行]之间，并且如果<code class="fe mn mo mp mq b"><strong class="jp ir">—</strong></code> <strong class="jp ir">之后的所有数字之和除以7</strong>[第19行]后的余数为0(零)，则<strong class="jp ir">有效</strong>。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><div class="gh gi qa"><img src="../Images/b6546ca4ab0f7f0fc6a5f6afb0a7b377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VaNCTnMBLtuGjXUVUGo6aQ.png"/></div></div></figure><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="py pz l"/></div></figure><p id="4b40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">也就是说如果你的钥匙满足以上条件，就通过了！</strong></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/084770ce8b3d5e3a45ada28c88028ea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*YERjrXOEmu2rRF0PfpkGSQ.png"/></div></figure><p id="ee97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">示例案例1: </strong></p><p id="fd5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mn mo mp mq b"><strong class="jp ir">Key = 111-1111111</strong></code>，此键有效是因为<code class="fe mn mo mp mq b"><strong class="jp ir">111</strong></code> <strong class="jp ir"> </strong>不在排除列表中，而<code class="fe mn mo mp mq b"><strong class="jp ir">1+1+1+1+1+1+1=7 ; 7%7 = 0</strong></code></p><p id="c004" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">示例案例2: </strong></p><p id="1f54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mn mo mp mq b"><strong class="jp ir">Key = 420-0001677</strong></code>也作为<code class="fe mn mo mp mq b"><strong class="jp ir">420</strong></code> <strong class="jp ir"> </strong>不在排除列表中而<code class="fe mn mo mp mq b"><strong class="jp ir">0+0+0+1+6+7+7=21 ; 21%7 = 0</strong></code></p><h2 id="3d8a" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">OEM密钥检查</h2><p id="7250" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">Windows95也发布了OEM版本，这个关键检查与上面的检查“有些”不同。</p><p id="13b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">OEM密钥采用以下格式:</p><blockquote class="qc"><p id="59ba" class="qd qe iq bd qf qg qh qi qj qk ql kk dk translated">AABB-OEM-XXXXXXX-CCCCC</p></blockquote><p id="73a3" class="pw-post-body-paragraph jn jo iq jp b jq qm js jt ju qn jw jx jy qo ka kb kc qp ke kf kg qq ki kj kk ij bi translated">在哪里，</p><ol class=""><li id="4d41" class="ni nj iq jp b jq jr ju jv jy nk kc nl kg nm kk nn no np nq bi translated">AAA是0-366之间的整数<strong class="jp ir">【第35行】</strong></li><li id="9f96" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated">BB在04–93之间<strong class="jp ir">【第41行】</strong></li><li id="4e0a" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated">OEM是固定字符<strong class="jp ir">【第17行】</strong></li><li id="5cb6" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated">XXXXXXX遵循与上述相同的mod7规则<strong class="jp ir">【第48行】</strong></li><li id="79b1" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated">CCCCC是随机的，根本不检查！</li></ol><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="py pz l"/></div></figure><h1 id="91b9" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">测试我们的分析</h1><h2 id="1bc9" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">第一种情况</h2><p id="09d5" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">激活码= <code class="fe mn mo mp mq b"><strong class="jp ir">34505-OEM-0000007-13370</strong></code>起作用，因为:</p><ol class=""><li id="b7dd" class="ni nj iq jp b jq jr ju jv jy nk kc nl kg nm kk nn no np nq bi">0 &lt; 345 &lt; 366</li><li id="078f" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi">3 &lt; 05 &lt; 94</li><li id="9b86" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated">-OEM-存在</li><li id="0f2b" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi">0+0+0+0+0+0+7=7 ; 7%7=0</li><li id="0d9b" class="ni nj iq jp b jq nr ju ns jy nt kc nu kg nv kk nn no np nq bi translated">13370无所谓。</li></ol><div class="lr ls lt lu gt ab cb"><figure class="nw lv qr ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><img src="../Images/7e2c0cf1a25595c1c48dc5f0b85c87b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*gg1aZDy_Nv12bBU2DaWTZg.png"/></div></figure><figure class="nw lv qs ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><img src="../Images/2da05430fb628d83733c4e39a050bba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*mGqQauGCyZTD0tKySoc-gg.png"/></div></figure></div><h2 id="2214" class="ow km iq bd kn ox oy dn kr oz pa dp kv jy pb pc kz kc pd pe ld kg pf pg lh ph bi translated">第二种情况</h2><p id="74c2" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">激活码= <code class="fe mn mo mp mq b"><strong class="jp ir">35595-OEM-0000696-42069</strong></code></p><div class="lr ls lt lu gt ab cb"><figure class="nw lv qt ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><img src="../Images/b2a8a62cd591aa7b2871e4fe7eb4c050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*haFMHU37s-5D6pH4WBadlg.png"/></div></figure><figure class="nw lv qu ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="oc od di oe bf of"><img src="../Images/fd85bf4a2fbe831bd6c10a57fe027d4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*2oTGrWGWlfSHMXEpqFTUgg.png"/></div></figure></div><p id="540e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">两个都管用！我们可以继续安装。</p></div><div class="ab cl oj ok hu ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ij ik il im in"><h1 id="e349" class="kl km iq bd kn ko oq kq kr ks or ku kv kw os ky kz la ot lc ld le ou lg lh li bi translated">结论</h1><p id="3cef" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">这个小项目很有趣，这也向我们展示了我们在安全性方面取得的进展，从思考<strong class="jp ir"><em class="lm">【7的可分性检查】</em></strong>到多因素认证、专门优化的哈希函数、可信平台模块等。</p><p id="ed2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你喜欢这个爆炸过去的经验😃。</p></div></div>    
</body>
</html>