<html>
<head>
<title>URL Bar Spoofing Flaw in Safari for iOS 12.3 and iOS 13 Beta | CVE-2019-8727</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS 12.3和iOS 13 Beta版Safari中的地址栏欺骗漏洞| CVE-2019-8727</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/url-bar-spoofing-in-safari-for-ios-12-3-and-ios-13-beta-cve-2019-8727-d87490f8ee29?source=collection_archive---------0-----------------------#2019-10-02">https://infosecwriteups.com/url-bar-spoofing-in-safari-for-ios-12-3-and-ios-13-beta-cve-2019-8727-d87490f8ee29?source=collection_archive---------0-----------------------#2019-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="880e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在处理基于浏览器的对地址栏的攻击时，我学到了一种在safari中仍然可以欺骗地址栏的方法。以前的攻击都不起作用，但当尝试类似的东西时，浏览器的行为有所不同。最初，我无法将页面保持足够长的时间让键盘出现，然后将鼠标悬停在页面上以获得虚拟键盘。<br/>所以在研究了多个函数并在一个函数内部调用一个函数导致了加载页面的足够延迟之后。<br/>在更新至iOS 12.3版本(最新版本)和iOS 13的iPhone 5s上的Safari上测试。<br/> <strong class="jp ir">为CVE-2019-8727的概念验证(POC)创建这个工作漏洞真的很有趣，也很有挑战性。</strong></p><h1 id="f547" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">总结:</h1><p id="f63c" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">iPhone的Safari浏览器存在URL栏欺骗漏洞。URL栏欺骗是一种可用于网络钓鱼攻击的漏洞。<br/>由于不安全的设计原则，safari未能处理<strong class="jp ir"> setTimeout </strong>和<strong class="jp ir"> setInterval方法</strong>，导致不存在的端口加载网页延迟。而Safari会保留页面一段时间，并通过自动对焦和虚拟键盘使用它，从而创建一个虚假页面，重定向到一个真正的域，从而触发URL栏欺骗。</p><p id="0898" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">iOS版Safari浏览器在全球的使用率约为15%-20%。这个缺陷以及这个问题一直存在于iOS 13测试版中(在测试时)。</strong></p><h1 id="fe68" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">影响:</h1><p id="adf9" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">因为在页面仍在加载时触发URL欺骗iOS的功能会导致浏览器继续加载URL，但会从父选项卡加载不同的内容，然后在页面中创建屏幕键盘，这在金融机构中很常见。完全加载并完成所花费的时间足以让用户钓鱼。还可以通过在页面的title标签中设置链接，让用户下载假冒的应用。</p><p id="c049" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它还可以被用作鱼叉式网络钓鱼，向一组用户发送多个类似的链接，然后检查哪个用户访问了哪种网站。</p><h1 id="39c4" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">预期行为:</h1><p id="3c8d" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">浏览器应该显示真实的URL位置，而不是伪造的。</p><h1 id="0187" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">复制步骤:</h1><ol class=""><li id="26ee" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">创建一个欺骗地址栏的HTML代码。</li><li id="c142" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">在网站上托管恶意页面。</li><li id="0228" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">它显示了一个假的facebook页面，带有一个虚拟键盘和自动对焦功能的登录表单。</li></ol><h2 id="38a0" class="mc km iq bd kn md me dn kr mf mg dp kv jy mh mi kz kc mj mk ld kg ml mm lh mn bi translated">网址:<a class="ae mo" href="https://justmorpheus.000webhostapp.com/day2/boa.html" rel="noopener ugc nofollow" target="_blank">https://justmorpheus.000webhostapp.com/day2/boa.html</a></h2><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">网址栏欺骗的概念验证iOS 13测试版</figcaption></figure><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi na"><img src="../Images/8aba12e645eaf4875373c847a1f8d49b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*bYK7fkNQiaS80PNJxR7KAA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">美国银行的虚假欺骗页面</figcaption></figure><h1 id="0aa6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">技术分析:</h1><p id="11d1" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">深入地址欺骗攻击的技术分析，它不仅可以用来欺骗URL，而且在某些情况下还可以绕过SOP。<br/>在上述情况下，代码分为两部分。第一部分包含Html主体中的样式标记，该标记加载CSS代码以及javascript，在Html表单中使用autofocus= "true "加载屏幕键盘。加载相对/绝对URL是不可能的，因为它需要时间来加载样式表，因此由于时间较少，它会显示为链接断开或虚假页面，从而挫败我们的动机。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi na"><img src="../Images/2e6b4a60b3ad0ff153195bce08ca5939.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*c5FhlP-ZNkPGamktjHrwfQ.jpeg"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">没有CSS和其他内容的假脸书页面</figcaption></figure><p id="6750" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后是代码的第二部分:</p><blockquote class="nd ne nf"><p id="54f9" class="jn jo ng jp b jq jr js jt ju jv jw jx nh jz ka kb ni kd ke kf nj kh ki kj kk ij bi translated"><script>setTimeout(function(){ function spoof(){ window . location . assign(" https://www . bank of America . com:8090 ")；} setInterval(恶搞()，50000)；}, 100);</script></p></blockquote><p id="a3b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中包含setTimeout方法，用于将setInterval延迟100毫秒，这足以加载假的屏幕键盘，并在加载CSS的同时自动对焦。然后用SetInterval方法调用spoof函数来加载window.location.assign中的URL，并通过每50000毫秒重新加载一次来加载一个新文档。因此，它每隔50秒就为页面中不存在的端口加载URL。因此，它提供了足够的时间来显示欺骗页面，从而愚弄Safari浏览器。</p><h1 id="27a0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">解决方案:</h1><p id="58db" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">这种类型的错误可以通过重置文档对象模型来修复，例如显示一个白色页面，或者显示一个进度条，或者完全重定向到真正的页面。<br/>苹果还表示，一个逻辑问题通过改进状态管理得到了解决。</p><h1 id="64f2" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">修复:</h1><p id="39c7" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">强烈推荐用户安装苹果iOS 13最新更新。</p><h1 id="dd46" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">时间线:</h1><p id="ec61" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">2019年5月24日:发现并向苹果安全团队报告。<br/>2019年5月31日:需要更多信息。<br/>2019年6月2日:带有更新漏洞的新POC。<br/>2019年9月19日:<a class="ae mo" href="https://support.apple.com/en-us/HT210606" rel="noopener ugc nofollow" target="_blank">苹果</a>与CVE和名人堂发布安全更新。</p><blockquote class="nd ne nf"><p id="1921" class="jn jo ng jp b jq jr js jt ju jv jw jx nh jz ka kb ni kd ke kf nj kh ki kj kk ij bi translated">感谢苹果安全团队解决了这个问题。</p></blockquote><h1 id="a4fa" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">参考:</h1><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="nl nm di nn bf no"><div class="gh gi nk"><img src="../Images/0c29cf5b08d386de700cefc491a375a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*du2F1izKEv0AvWOSitWCzA.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">保持警惕保持安全</figcaption></figure><p id="0da0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mo" href="https://blog.avira.com/safari-address-bar-can-be-tricked-into-displaying-fake-url/" rel="noopener ugc nofollow" target="_blank">https://blog . avira . com/safari-address-bar-can-be-tricked-to-displaying-fake-URL/</a><br/>T3】https://chromium . Google source . com/chromium/src/+/master/docs/security/URL _ display _ guidelines/URL _ display _ guidelines . MD<br/><a class="ae mo" href="https://www.rafaybaloch.com/2018/09/apple-safari-microsoft-edge-browser.html" rel="noopener ugc nofollow" target="_blank">https://www . rafaybaloch . com/2018/09/apple-safari-Microsoft-edge-browser . html</a></p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><a href="https://www.buymeacoffee.com/Pi4DYZz"><div class="gh gi np"><img src="../Images/495cfc88c60da8566b60b63877765f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*reqvQJesS2icA9fc8cOxIQ.png"/></div></a></figure><p id="d334" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ng">关注</em> <a class="ae mo" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="ng"> Infosec报道</em> </a> <em class="ng">获取更多此类精彩报道。</em></p><div class="nq nr gp gr ns nt"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">信息安全报道</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh nb nt"/></div></div></a></div></div></div>    
</body>
</html>