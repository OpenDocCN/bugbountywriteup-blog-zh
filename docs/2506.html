<html>
<head>
<title>Story of a $1k bounty — SSRF to leaking access token and other sensitive information</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一千美元赏金的故事——SSRF泄露访问令牌和其他敏感信息</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/story-of-a-1k-bounty-ssrf-d5c4868680f5?source=collection_archive---------0-----------------------#2022-11-05">https://infosecwriteups.com/story-of-a-1k-bounty-ssrf-d5c4868680f5?source=collection_archive---------0-----------------------#2022-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f636c7a04c2b44d15a5668cac91f77c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SRaAGSHDsAAOREKRzgUrZA.png"/></div></div></figure><p id="8155" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大家好，欢迎来到我的故事，我是如何利用泄露谷歌云访问令牌和其他敏感数据的SSRF在HackerOne上获得第一笔奖金的，在继续之前，我想感谢这个可爱的社区，它在我的整个旅程中帮助了我。</p><p id="2207" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我从我的黑客的私人邀请列表中选择了目标，因此我不能透露目标，所以我将称它为redacted.com。我从recon开始，我创建了一个自动化工具来完成我的recon过程，如收集子域名、获取活动主机、运行nuclei、目录暴力、nmap和获取waybackurls等。在我的自动化完成后，我分析了所有的数据，比如waybackurls和其他数据。</p><p id="fee3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">waybackurls似乎很有趣，所以我很快使用gf模式来获取所有可能易受攻击的ssrf端点</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="80bf" class="lf lg iq lb b gy lh li l lj lk">cat waybackurl | gf ssrf</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/551f6c4d0ffd498abc4e58e17a772eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9UhQNsdiqQrr0Dk-UwFthA.jpeg"/></div></div></figure><p id="3acb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于__host字段从github获取某种数据，我尝试测试ssrf，所以我很快打开了我的Burpsuite，将burp collaborator链接放入__host字段并发送请求，我单击了poll now按钮，是的，我得到了HTTP交互，burp collaborator响应反映在屏幕上。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/38569225afe6351f5012797ce6e5798e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xq0C7QGFnzjTnN5_IOwEIQ.png"/></div></div></figure><p id="240e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我试着用XSS启动了一个Apache服务器并上传了alert JavaScript有效载荷</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ln"><img src="../Images/63962d15dfb07d0ba9f0faf3c7c8d53c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXmlDu538HoQYvnKkFrxdQ.png"/></div></div></figure><p id="2cfb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是我停止了，因为XSS不会如此有影响力，并开始寻找ssrf，在__host参数中我放入了169.254.169.254，在url中我添加了<em class="lo">/latest/meta-data/iam/security-credentials/</em></p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="9410" class="lf lg iq lb b gy lh li l lj lk">https://redacted.redacted.com/latest/meta-data/iam/security-credentials/?__host=169.254.169.254&amp;__proto=https</span></pre><p id="e23d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并发送了请求。但是它返回了<strong class="ka ir"> 502错误网关</strong>然后我将__proto值改为http，但是它也不工作。</p><p id="01f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我想到为什么不尝试其他端点，如谷歌，数字海洋一号的，我得到了一个pdf的帮助，其中有我将提供的所有ssrf端点，最后谷歌云端点给出了一个响应，而不是502。</p><p id="4120" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该响应包含</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="4fa6" class="lf lg iq lb b gy lh li l lj lk">Missing required header: Metadata-Flavour</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/1edb4abe064192b25f388a456d45d7b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QEGNPZubmmkTExALenV6qA.png"/></div></div></figure><p id="bfb0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我很快添加了这个标题，并将它的值设置为Google(得到了pdf的帮助),然后发送请求，然后<em class="lo"> yesss！！它确实起作用了</em></p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/b8c4a766a6263dd9f5afe96a1695a9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v62bBUplrxEaKW1cmPkCzQ.png"/></div></div></figure><p id="9b86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我尝试使用</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a1f9" class="lf lg iq lb b gy lh li l lj lk">GET /computeMetadata/v1/instance/service-accounts/default/token?__host=169.254.169.254&amp;__proto=http</span></pre><p id="6d51" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我尖叫着哇！！我明白了，SSRF做到了:)</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/807c6d327a033ca6577ffe9af98c6a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-me3cdM6AddIJOzuidbWXQ.jpeg"/></div></div></figure><p id="a92b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我尝试并得到了其他细节，如范围，电子邮件，地区和id等。</p><h2 id="a845" class="lf lg iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">报告</h2><p id="7c65" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">我向所有的POC报告了这个漏洞，等到第二天，他们回复了&amp;承认这是一个很酷的发现，并奖励我1000美元奖金</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/1abfd5d7ebeb431817010b0a537c08d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VcH5JxBZe8ewQmsrHhg2pA.png"/></div></div></figure><blockquote class="mp mq mr"><p id="f154" class="jy jz lo ka b kb kc kd ke kf kg kh ki ms kk kl km mt ko kp kq mu ks kt ku kv ij bi translated">PDF:<a class="ae mv" href="https://github.com/faiqu3/ssrf/blob/main/SSRF.pdf" rel="noopener ugc nofollow" target="_blank">SSRF.pdf</a></p></blockquote><p id="0063" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢你们读到这里，我希望你们能从这篇文章中学到一些新的东西。如果你喜欢，请鼓掌并跟我来:</p><h2 id="6d73" class="lf lg iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">推特:<a class="ae mv" href="https://twitter.com/imfaiqu3" rel="noopener ugc nofollow" target="_blank">https://twitter.com/imfaiqu3</a></h2><h2 id="81c4" class="lf lg iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">insta gram:<a class="ae mv" href="https://www.instagram.com/faique.exe" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/faique.exe</a></h2><h2 id="6084" class="lf lg iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">领英:<a class="ae mv" href="https://www.linkedin.com/in/faiqu3/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/faiqu3/</a></h2></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><h2 id="061e" class="lf lg iq bd ls lt lu dn lv lw lx dp ly kj lz ma mb kn mc md me kr mf mg mh mi bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mv" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>