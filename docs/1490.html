<html>
<head>
<title>Gaining Access To GCP Of Google Stadia — 500$ Bounty</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">进入谷歌GCP体育场——500美元奖金</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/gaining-access-to-gcp-of-google-stadia-500-bounty-22f76ecc8e60?source=collection_archive---------0-----------------------#2021-07-28">https://infosecwriteups.com/gaining-access-to-gcp-of-google-stadia-500-bounty-22f76ecc8e60?source=collection_archive---------0-----------------------#2021-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bc17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好世界！</p><p id="b6b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，我只是一个bug bounty文章的消费者。我希望我可以通过写我的冒险来回馈社区！</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="5f84" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">介绍</h2><p id="9355" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">首先，我必须承认这个故事<em class="lq">有点老</em>。事情发生在【2019年7月。</p><p id="7e8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那时，我已经学会了云中基于机器的认证方法。特别是，通过连接到<a class="ae lr" href="https://gist.github.com/BuffaloWill/fa96693af67e3a3dd3fb" rel="noopener ugc nofollow" target="_blank">内部元数据端点</a>，检索服务帐户令牌，并使用泄漏的服务帐户/令牌从外部进行身份验证，利用获得访问云提供商的技术阅读已披露的HackerOne服务器端请求伪造和类似的漏洞报告，是我<em class="lq">成功</em>的关键。这让我想到，与其在单个目标中搜索SSRF(或相关的)漏洞，不如在OSINT这个广阔的世界中碰碰运气。</p><p id="9e32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就我记忆所及，Github当时并没有扫描暴露的令牌。遭遇暴露的凭证是没有痛苦的。</p><h2 id="185f" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">查找搜索查询</h2><p id="90c1" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">当然，第一步是找到找到这些服务帐户的方法。我的方法是在目标中找到一个唯一的字符串来缩小搜索结果。例如，长期AWS IAM访问密钥id以<code class="fe ls lt lu lv b">AKIA</code>开头，临时凭证以<code class="fe ls lt lu lv b">ASIA</code>开头。谷歌服务帐户对我来说是未知的，我需要查找结构，并确定潜在的针头。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/714a8803d00f2653cccaeeb654b6c818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oh94-GI5l_CAswJpnOsrlA.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated"><a class="ae lr" href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/iam/docs/creating-managing-service-account-keys</a></figcaption></figure><p id="a42a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据谷歌云文档，所有的<code class="fe ls lt lu lv b">service-account-email</code>值都以<code class="fe ls lt lu lv b">iam.gserviceaccount.com</code>结尾。</p><p id="c7d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过用那根针搜索，Github搜索结果的质量真的提高了。尽管如此，仍有改进的余地。例如，由于服务帐户通常是JSON结构，不难想象Github用户会在一个. JSON文件中公开他们的服务帐户。搜索查询可能如下所示:</p><pre class="lx ly lz ma gt mm lv mn mo aw mp bi"><span id="cd0d" class="ks kt iq lv b gy mq mr l ms mt">iam.gserviceaccount.com extension:json</span></pre><p id="2da4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，谷歌服务账户也可能以其他文件格式存储。</p><p id="f283" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的例子中，服务帐户令牌写在一个点YAML文件中(该文件用于DevOps自动化工具)。</p><h2 id="223a" class="ks kt iq bd ku kv kw dn kx ky kz dp la jy lb lc ld kc le lf lg kg lh li lj lk bi translated">使用Google云服务帐户</h2><p id="23bf" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">此时，Google服务帐户的所有者仍然不清楚，我需要一种方法来识别所有者。如果AWS或任何类似的证书颁发者允许安全研究人员查找所有者，这不是很好吗？我想这可能会涉及到一些隐私问题，但在某些情况下，这确实会有所帮助。</p><p id="110e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用各种工具来识别主人。我还没有找到比列出所有谷歌云资源，然后试图将这些数据与一家公司关联起来更简单的方法。</p><p id="2d35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，带有小脚本的Google cloud命令行界面非常有帮助。我首先从我的环境中撤销任何以前的访问令牌(因为您不希望针对旧的发现)。</p><pre class="lx ly lz ma gt mm lv mn mo aw mp bi"><span id="57af" class="ks kt iq lv b gy mq mr l ms mt"><strong class="lv ir">➜ </strong>gcloud auth revoke --all</span></pre><p id="5b01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我将暴露的服务帐户复制到一个JSON文件中(假设原始服务帐户也是JSON，否则您可能需要摆弄一下)，并告诉gcloud使用它。</p><pre class="lx ly lz ma gt mm lv mn mo aw mp bi"><span id="6c46" class="ks kt iq lv b gy mq mr l ms mt"><strong class="lv ir">➜ </strong>gcloud auth activate-service-account --key-file service-account.json</span></pre><p id="7fbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Gcloud需要知道可以从JSON文件中检索到的项目id。</p><pre class="lx ly lz ma gt mm lv mn mo aw mp bi"><span id="c43a" class="ks kt iq lv b gy mq mr l ms mt"><strong class="lv ir">➜ </strong>gcloud config set project your-project-name</span></pre><p id="e852" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，您可以使用命令行界面与Google Cloud进行通信。</p><p id="552a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不用手动查询每一个Google云资源，我发现只需要使用下面的脚本<a class="ae lr" href="https://gist.github.com/carnal0wnage/757d19520fcd9764b24ebd1d89481541" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/carnal 0 wnage/757d 19520 fcd 9764 b 24 EBD 1d 89481541</a>就非常方便了(第4行需要更改项目id)。</p><p id="cb82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一种方式是NCC集团的ScoutSuite。你可以在这里找到它<a class="ae lr" href="https://github.com/nccgroup/ScoutSuite" rel="noopener ugc nofollow" target="_blank">https://github.com/nccgroup/ScoutSuite</a>。它可能会给你更好的结果，但在我看来，脚本允许更快的概述。</p><p id="9882" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lq">注意:您的服务帐户可能有权访问其他项目。最好用</em> <code class="fe ls lt lu lv b"><em class="lq">gcloud projects list</em></code> <em class="lq">列出所有可访问的项目，并检查每个项目的信息。</em></p><p id="80e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我喜欢将转储的信息放在代码编辑器中，以便于查看。您可以通过将输出通过管道传输到如下文件中来实现这一点:</p><pre class="lx ly lz ma gt mm lv mn mo aw mp bi"><span id="6449" class="ks kt iq lv b gy mq mr l ms mt"><strong class="lv ir">➜ </strong>bash gcp_enum.sh &gt;&gt; out.txt</span></pre><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mu"><img src="../Images/c4f0522b3ca3f4038f2024295a055f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOz70tjLHN1ch3o-kS_E4Q.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">输出的前48行。</figcaption></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mv"><img src="../Images/0ef1441254ffc7d4fab0f745fa49239a.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*ULNk07Sv5IpQxTX2uPyAWg.png"/></div></div></figure><p id="13f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">产量惊人。109.818行，其中108.466行是桶。许多桶很无聊，因为它们是带后缀的桶；也许是日志文件的“版本化”存储桶？</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mw"><img src="../Images/3ab7064f9464f7fa03b6f590e78b4bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xKAPCyp_OEEXJ1OufEyevQ.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">108.150桶是带后缀的桶</figcaption></figure><p id="9f4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其他316个水桶有有趣的名字；包含单词“<strong class="jp ir">备份</strong>”、“<strong class="jp ir">生产</strong>”、“<strong class="jp ir">自动化</strong>”、“<strong class="jp ir">詹金斯</strong>”、“<strong class="jp ir">视距</strong>”、<strong class="jp ir"> +“备份</strong>”、“<strong class="jp ir">日志”、“gpg”、“ssh”、“部署”、“脚本”、“转储”等等。</strong></p><p id="38a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不仅可以访问这些存储桶，还可以访问BigQuery和其他云资源。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/3048ae6fb7a4588101b85d630067718d.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*02RjLdcnnPjJ_6zNWxI7mQ.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">BigQuery中的Stadia分析数据集</figcaption></figure><p id="a16c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当时，我真的很高兴，认为访问生产数据将为我带来可观的收入，但谷歌付给我500美元的赏金。</p><p id="0a67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> \_(ツ)_/ </strong></p></div></div>    
</body>
</html>