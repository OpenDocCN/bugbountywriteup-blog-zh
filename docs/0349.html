<html>
<head>
<title>How I developed a full-fledged Security Operations Centre using ELK Stack?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用ELK Stack开发一个成熟的安全运营中心？</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-developed-a-full-fledged-security-operations-centre-using-elk-stack-8dfaec821e23?source=collection_archive---------0-----------------------#2019-08-09">https://infosecwriteups.com/how-i-developed-a-full-fledged-security-operations-centre-using-elk-stack-8dfaec821e23?source=collection_archive---------0-----------------------#2019-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/f434e228b8e4a9df30dad4d0f95e46d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8nbj7qYhQVQX43_gHsjqzw.png"/></div></div></figure><div class=""/><blockquote class="jy jz ka"><p id="2e6f" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在网络上检测到与恶意勒索软件签名匹配的数据包。安全行动中心的仪表盘上实时升起了一面红旗。安全团队已经找到哪个用户收到了该数据包，并立即联系了他们，并建议他们需要采取的步骤。</p></blockquote><p id="f1e4" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">您是否意识到在上述场景中刚刚发生了什么？由于安全运营中心持续记录和高级监控，一个可能造成严重破坏的问题已经得到控制。这让我们了解了SOC在现实生活中的重要性。</p><p id="be0f" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">现在，让我们深入了解如何创建您自己的安全运营中心，并帮助您的组织保持领先和安全。</p><h1 id="0184" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">我们开始吧！</h1><p id="88c0" class="pw-post-body-paragraph kb kc jb ke b kf mb kh ki kj mc kl km la md kp kq lb me kt ku lc mf kx ky kz ij bi translated">我是看着各种科幻电影长大的，其中大部分都是基于网络安全的，在网络安全中，犯罪大师试图入侵组织，优秀的黑客试图阻止他们。他们在安全运营中心工作，发现黑客，然后进行反击，找到犯罪黑客，并将其逮捕。</p><p id="be5e" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">开发一些更接近它的东西是我童年的梦想，但直到现在这似乎是一个不可能的任务。当我的同事让我开发这个时，我开始着手这项工作，他指导我研究<a class="ae mg" href="https://www.elastic.co" rel="noopener ugc nofollow" target="_blank">麋鹿栈</a>和<a class="ae mg" href="https://osquery.io" rel="noopener ugc nofollow" target="_blank"> OSquery </a></p><p id="258f" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">因此，让我先向您解释一下安全运行中心是如何运作的。第一步是收集尽可能多的日志，尝试收集不同的日志，如网络日志、系统日志、命令行日志等。您收集的日志越多越好，请记住，您确实需要对它们进行解析才能理解它们。第二步是使用这些日志从中提取数据，并通过专门监控这些日志的某些参数来使用这些数据，然后在控制面板上实时显示这些数据。</p><h2 id="ceff" class="mh le jb bd lf mi mj dn lj mk ml dp ln la mm mn lr lb mo mp lv lc mq mr lz ms bi translated">-日志记录(<a class="ae mg" href="https://osquery.io" rel="noopener ugc nofollow" target="_blank"> OSquery </a>)</h2><figure class="mu mv mw mx gt is gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/1372e4b8a0698b89844f6b6238b23dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*ctDKUg9IePdO50ahQVCanQ.png"/></div></figure><p id="f2cc" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">因此，第一步是生成日志并正确存储它们，以便您可以使用它们从中提取有意义的数据。为了完成这个过程，我们使用OSquery，这个工具是由脸书的devs开发的。所以我们使用OSquery的原因是我们可以编写自己的配置文件，在OSquery守护进程的帮助下，我们开始记录数据并将它们存储在系统中。这些日志可以包含海量的信息，你可以在这里查看<a class="ae mg" href="https://osquery.io/schema/3.3.2" rel="noopener ugc nofollow" target="_blank"/>。根据您的需求，您可以获得大量的日志，然后将其存储起来以备将来使用。</p><p id="e7c5" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">您可以下载osquery并使用它来了解它给出了什么信息以及什么对您来说是重要的。下面提到了我一直使用的默认osquery配置，你可以根据自己的需要进行更改。您可以从<a class="ae mg" href="https://gist.github.com/anand1996aditya/3a6ead64fe97c9529eeb76a518234f0f" rel="noopener ugc nofollow" target="_blank">这里</a>为自己复制配置。</p><figure class="mu mv mw mx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/116102d3a2d2746cb869ef106a644ca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCFSms3JEaN4FIvXeVKNWQ.png"/></div></div></figure><p id="bebd" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">你可以在这里继续进行整个安装过程，深入了解OSquery <a class="ae mg" href="https://osquery.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">。现在我们正在生成大量的日志，让我们找到一种方法来正确地记录它们，并将其显示在仪表板上，以便我们可以获得反馈并了解正在发生的事情。</a></p><h2 id="1c88" class="mh le jb bd lf mi mj dn lj mk ml dp ln la mm mn lr lb mo mp lv lc mq mr lz ms bi translated">-汇总和分析日志(<a class="ae mg" href="https://www.elastic.co" rel="noopener ugc nofollow" target="_blank">麋鹿栈</a>)</h2><p id="cab1" class="pw-post-body-paragraph kb kc jb ke b kf mb kh ki kj mc kl km la md kp kq lb me kt ku lc mf kx ky kz ij bi translated">我们已经获得了大量的日志，但如果我们能弄清楚这意味着什么，这都是垃圾，为此我们需要搜索日志中我们认为是危险信号的详细信息，并将其显示给安全团队。一旦这些危险信号被展示给安全团队，他们就可以着手处理并尝试应对。</p><figure class="mu mv mw mx gt is gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/8c2fdd56979c1497142d9fa23602a35b.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*XNqnRIFrOhRLVFXOTaruUA.png"/></div></figure><p id="f98a" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">我用来将本地机器上保存的日志保存到仪表板的工具如下。</p><h2 id="a5c7" class="mh le jb bd lf mi mj dn lj mk ml dp ln la mm mn lr lb mo mp lv lc mq mr lz ms bi translated">1.弹性搜索</h2><p id="d6e8" class="pw-post-body-paragraph kb kc jb ke b kf mb kh ki kj mc kl km la md kp kq lb me kt ku lc mf kx ky kz ij bi translated">这个工具是一个非常优化和快速的搜索引擎，它在后台使用<a class="ae mg" href="https://lucene.apache.org" rel="noopener ugc nofollow" target="_blank"> Apache Lucene </a>。它是我们项目的首选工具，因为我们生成的日志数量巨大，如果我们不能快速轻松地从中提取数据，那么拥有这些精美日志的意义就变得毫无意义。ElasticSearch需要json格式的数据日志来执行高效的搜索，幸运的是，OSquery以json格式保存了他们的日志。</p><p id="7c32" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">你可以在这里浏览设置ElasticSearch <a class="ae mg" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html" rel="noopener ugc nofollow" target="_blank">的细节，并通读详细的文档来更好地了解它。</a></p><h2 id="22a0" class="mh le jb bd lf mi mj dn lj mk ml dp ln la mm mn lr lb mo mp lv lc mq mr lz ms bi translated">2.搜索</h2><p id="f192" class="pw-post-body-paragraph kb kc jb ke b kf mb kh ki kj mc kl km la md kp kq lb me kt ku lc mf kx ky kz ij bi translated">这些是默认情况下由ELK堆栈提供的监控选项，用于增强您的数据记录功能。Beats可以看作是一堆工具，由<a class="ae mg" href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-getting-started.html" rel="noopener ugc nofollow" target="_blank"> Filebeat </a>、<a class="ae mg" href="https://www.elastic.co/guide/en/beats/auditbeat/current/auditbeat-getting-started.html" rel="noopener ugc nofollow" target="_blank"> Auditbeat </a>、<a class="ae mg" href="https://www.elastic.co/guide/en/beats/packetbeat/current/packetbeat-getting-started.html" rel="noopener ugc nofollow" target="_blank"> Packetbeat </a>、<a class="ae mg" href="https://www.elastic.co/guide/en/beats/heartbeat/current/heartbeat-getting-started.html" rel="noopener ugc nofollow" target="_blank"> Heartbeat </a>等组成。</p><ul class=""><li id="bfad" class="na nb jb ke b kf kg kj kk la nc lb nd lc ne kz nf ng nh ni bi translated">filebeat——它是转发和集中日志数据的运送器。</li><li id="90f0" class="na nb jb ke b kf nj kj nk la nl lb nm lc nn kz nf ng nh ni bi translated">audit beat——安装在服务器上的一个发送器，用于审计系统上用户和进程的活动。</li><li id="61ed" class="na nb jb ke b kf nj kj nk la nl lb nm lc nn kz nf ng nh ni bi translated">Packetbeat -实时网络数据包分析器，可与ElasticSearch一起使用，提供一个<em class="kd">应用程序监控和性能分析系统。</em></li><li id="96be" class="na nb jb ke b kf nj kj nk la nl lb nm lc nn kz nf ng nh ni bi translated">Heartbeat -安装在远程服务器上的守护程序，用于定期检查服务的状态并确定它们是否可用</li></ul><p id="6496" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">beats下的elastic stack还提供了其他工具，您可以在这里找到<a class="ae mg" href="https://www.elastic.co/products/beats" rel="noopener ugc nofollow" target="_blank"/>并根据您的需求实现它们。</p><h2 id="5016" class="mh le jb bd lf mi mj dn lj mk ml dp ln la mm mn lr lb mo mp lv lc mq mr lz ms bi translated">3.基巴纳</h2><p id="0bd4" class="pw-post-body-paragraph kb kc jb ke b kf mb kh ki kj mc kl km la md kp kq lb me kt ku lc mf kx ky kz ij bi translated">Kibana是ELK stack提供的这套工具中我们需要的最后一个工具。它用于帮助系统管理员和安全专业人员可视化他们通过运行各种进程记录的数据。我们可以看看与Kibana同步使用的各种其他弹性堆栈特性。仪表板真的很神奇，可以根据我们的喜好通过传入查询和我们需要的输出进行更改。</p><figure class="mu mv mw mx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/286d82a77c263c615f18e40229bac8fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B65zErUu083c-ZeKHXNN6w.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">基巴纳仪表板</figcaption></figure><p id="48c9" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">你可以通过<a class="ae mg" href="https://www.elastic.co/guide/en/kibana/current/getting-started.html" rel="noopener ugc nofollow" target="_blank">文档</a>来正确配置Kibana，然后你可以吹嘘你自己的安全操作中心。</p><h1 id="da50" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">道德的</h1><p id="6359" class="pw-post-body-paragraph kb kc jb ke b kf mb kh ki kj mc kl km la md kp kq lb me kt ku lc mf kx ky kz ij bi translated">安全运营中心是将安全放在首位的组织的必备设施。从本文中我们可以了解到，设置这些仪表板并不困难，您所需要做的只是根据您的需要更改配置文件，您可以在一个小时内设置自己的SOC。这种SOC提供的控制量确实令人惊叹，您可以通过监视网络上发生的事情，用户正在执行CPU/GPU密集型工作等，使您的组织变得非常安全。</p><blockquote class="jy jz ka"><p id="9039" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">附言:如果你需要任何帮助来为你自己的家或你的组织设置这个，请随时联系我，让我们合作吧！</p></blockquote><p id="b00b" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">如果你喜欢，请鼓掌让我们合作吧。获取、设置、破解！</p><p id="a907" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">网址:【aditya12anand.com】T2|捐赠:【paypal.me/aditya12anand】T4</p><p id="3a51" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">电报:<a class="ae mg" href="https://t.me/aditya12anand" rel="noopener ugc nofollow" target="_blank">https://t.me/aditya12anand</a></p><p id="eee8" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">推特:<a class="ae mg" href="https://twitter.com/aditya12anand?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">twitter.com/aditya12anand</a></p><p id="ef7c" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">领英:<a class="ae mg" href="https://www.linkedin.com/in/aditya12anand/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank">linkedin.com/in/aditya12anand/</a></p><p id="55c4" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">电子邮件:aditya12anand@protonmail.com</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="1777" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">关注</em> <a class="ae mg" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="kd"> Infosec报道</em> </a> <em class="kd">获取更多此类精彩报道。</em></p><div class="ip iq gp gr ir oa"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jc gy z fp of fr fs og fu fw ja bi translated">信息安全报道</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">medium.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo ix oa"/></div></div></a></div></div></div>    
</body>
</html>