<html>
<head>
<title>CyberTalent — Exploiting Shellshock (CVE-2014–6271) on a Remote Server(Inside Lab)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">cyber talent——利用远程服务器上的shell shock(CVE-2014–6271 )(实验室内部)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cybertalent-exploiting-shellshock-cve-2014-6271-on-a-remote-server-inside-lab-b9e1680c0500?source=collection_archive---------1-----------------------#2021-07-19">https://infosecwriteups.com/cybertalent-exploiting-shellshock-cve-2014-6271-on-a-remote-server-inside-lab-b9e1680c0500?source=collection_archive---------1-----------------------#2021-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0375d4dabbc17dcb99306813f6b81c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gruWm7TwnL-qT3Psk7HtPg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:https://www.cybertalents.com</figcaption></figure><blockquote class="kc kd ke"><p id="f92a" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">里面是Cyber talent上的一台机器，被评为中型机器。它提供了一个允许远程代码执行的shellshock漏洞。今天我将使用Metasploit来利用这台机器，这台机器的IP地址是18.185.92.165。</p></blockquote><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi le"><img src="../Images/ec88c4f9a2ba8e333535a48b3f8946a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBfDtZhTFjtw7HNwU0W0XQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:https://cybertalents.com/challenges/machines/inside</figcaption></figure><p id="1046" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated"><strong class="ki ir">枚举</strong></p><p id="a385" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated"><strong class="ki ir"> Nmap </strong></p><p id="268c" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">像往常一样，我使用Nmap从端口扫描开始，检查开放的端口。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ln"><img src="../Images/cd98dba2999b9aceaca604d28e59c17a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N4GG52bskN1YGOR6mE2P6Q.png"/></div></div></figure><p id="d215" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">我扫描了前1000个端口，发现有2个端口(22和3333)是打开的。我开始了另一次Nmap扫描，但这一次，我使用了Nmap版本扫描来做更多的枚举。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/cac72874a2e89edc0637270093c88ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aDoNa1cuA4OynzB4YwGFug.png"/></div></div></figure><p id="8991" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">从Nmap版本扫描输出中，我发现端口3333是一个HTTP服务，这意味着它是一个网站，需要更多的枚举。我在网络浏览器上搜索18.185.92.165:3333。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/b927682c335804045db81e1e3a325cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9XGDOsxHYZMHt7UIhYFFZw.png"/></div></div></figure><p id="a10b" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">手动浏览整个网页后，我没有发现任何有趣的东西，所以我继续使用dirb扫描隐藏的目录。</p><p id="db02" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated"><strong class="ki ir"> Dirb </strong></p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/03bf3fd6c5d275b9594d17a0471282ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*KHvt9xwBhzJwD3uZa4Z-gA.png"/></div></figure><p id="2414" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">通过对隐藏目录的扫描，我发现了一个cgi-bin目录，其状态代码为403(禁止),即无论身份验证如何，都不允许任何人访问该资源。我进一步扫描隐藏目录仍然使用dirb，但在我新发现的目录。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/838273f805b4a125ccedde080dd82f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*EEK_Dn1l6qe9WJqhUqDzew.png"/></div></figure><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/2f1389364a67184bea4954d785496822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*PA51G_tZMb7fyFs0p0Bcfw.png"/></div></figure><p id="a9c9" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">所以我发现了一个新的cgi-bin目录，状态码是200(好的)。我决定使用kali linux中已经安装的另一个工具来检查我们的目标上是否存在漏洞。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/dbe55f7ad5ce474a061cccfd602941b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*govdZVzdVSnj8PYRZd6BhQ.png"/></div></div></figure><p id="44f4" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated"><strong class="ki ir"> Nikto </strong></p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/c8cfb4dd2dfa650a3e6b0e31ccabd141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wYwoIvcFHJVIHY6UfaGrPA.png"/></div></div></figure><p id="e8ed" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">使用nikto I确认我们的目标易受shellshock漏洞(CVE-2014–6271)的攻击。我在google上搜索了对shellshock漏洞的简要描述，发现shellshock允许包含Bash的易受攻击版本的系统被利用来以更高的权限执行命令。我还发现metasploit上存在对此漏洞的利用。所以我继续在我的终端中启动metasploit。</p><p id="c163" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated"><strong class="ki ir">剥削</strong></p><p id="e0d2" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated"><strong class="ki ir"> Metasploit </strong></p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lv"><img src="../Images/cf7ca33a957c8f3224d449b9db320f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEHS_igtsbBmrQtSSFXP-w.png"/></div></div></figure><p id="77fd" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">当我在metasploit中搜索漏洞时，我看到了大量可用的漏洞，但决定使用<em class="kh">漏洞/multi/http/Apache _ mod _ CGI _ bash _ env _ exec</em>漏洞，因为它被评为优秀，并且也被检查为是。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/c228bf1e9d96a6f9513b6ba4f56996b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A5wD5QRRSUdIPZH1JPASEw.png"/></div></div></figure><p id="fb98" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">由于目标是一台远程机器，为了绕过我的kali机器防火墙，我不得不将我的流量传输到一个在线代理。默认情况下，kali machine将限制来自我的反向shell有效负载的所有入站流量。为此，我不得不使用另一个工具“Ngrok”将我的流量转发到远程服务器。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/407684bf0289071c720ee71400b271a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*4Byf8J1zx0MXInTMfCG3-Q.png"/></div></figure><p id="6354" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">用ngrok成功建立隧道后，我必须设置shellshock漏洞利用的选项，将ngrok URL用作我的<strong class="ki ir"> LHOST </strong>，将ngrok端口用作我的<strong class="ki ir"> LPORT </strong>。此外，我必须设置我的<strong class="ki ir"> targeturi </strong>、<strong class="ki ir"> RHOST </strong>和<strong class="ki ir"> payload </strong>。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/86c7504592bd5dfb4cd71348a1d7951c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*r8_zGy12W-YTZNupoYuX5g.png"/></div></figure><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/7c517c06b4261b96e44b76ddbff7470b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w5q-h8WL0s673IQokrJJMw.png"/></div></div></figure><p id="186f" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">现在，我必须在我的本地主机和本地端口上使用metasploit multi/handler设置一个监听器来接收来自我的有效负载的连接。</p><p id="028f" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated"><strong class="ki ir"> <em class="kh"> N/B首先在multi/handler上运行您的“漏洞利用”,作为在cgi-bin上运行“漏洞利用”之前的监听器。</em>T13】</strong></p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/aace2e4c619d3bf1c9846e5166fbf1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2sRwGkzij0oSnFtAbyByaQ.png"/></div></div></figure><p id="c0c1" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">在我的两个metasploit实例上运行“exploit”之后，我收到了一个命令shell会话。</p><p id="8ebf" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">万岁…</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/5859345ea6658b281cfff5eaf7c0d349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*69jMTnygfShPz_hHxP7MLQ.png"/></div></div></figure><p id="5dde" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">我立即在系统目录中手动搜索该标志，是的，我确实找到了该标志。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/e907b31067f9d90f3dd224d6e99efe5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CMk2mQxAIQOhB5BGJxlgGg.png"/></div></div></figure><p id="67ef" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">虽然这台机器在网络人才方面被评为中等，但我能够使用nmap提高我的端口和版本扫描技能，使用dirb枚举隐藏目录，使用nikto评估漏洞，使用metasploit利用漏洞。</p><p id="b5b5" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq lk ks kt ku ll kw kx ky lm la lb lc ld ij bi translated">谢谢你…</p><h1 id="0d04" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">参考</h1><div class="nb nc gp gr nd ne"><a href="https://ngrok.com/download" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">ngrok -下载</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">运行此命令会将您的authtoken添加到ngrok.yml文件中。连接一个帐户会列出你打开的隧道…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">ngrok.com</p></div></div></div></a></div><div class="nb nc gp gr nd ne"><a href="https://en.wikipedia.org/wiki/Shellshock_%28software_bug%29" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">Shellshock(软件错误)-维基百科</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">Shellshock，也称为Bashdoor，是Unix Bash shell中的一系列安全错误，其中第一个是…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">en.wikipedia.org</p></div></div><div class="nn l"><div class="no l np nq nr nn ns jw ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2014-6271" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">CVE CVE 2014-6271</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">CVE是一个记录列表——每个记录都包含一个标识号、一个描述和至少一个公共引用…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">cve.mitre.org</p></div></div></div></a></div><div class="nb nc gp gr nd ne"><a href="https://cybertalents.com/challenges/machines/inside" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">内幕“网络人才</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">网络人才是一个平台，根据他们在不同领域的技能对全球网络安全人才进行排名</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">cybertalents.com</p></div></div><div class="nn l"><div class="nt l np nq nr nn ns jw ne"/></div></div></a></div></div></div>    
</body>
</html>