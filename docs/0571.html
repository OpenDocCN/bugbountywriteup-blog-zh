<html>
<head>
<title>Intro to Nmap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nmap简介</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/intro-to-nmap-192c1796bb39?source=collection_archive---------0-----------------------#2020-04-30">https://infosecwriteups.com/intro-to-nmap-192c1796bb39?source=collection_archive---------0-----------------------#2020-04-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e43a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定写一些关于安全专家常用工具的文章。本系列的目标是介绍一个工具是如何工作的，它在哪里有用，并可能留下一些您可以采用的技巧。我将从一个名为Nmap的扫描工具开始。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/87d535d759ea01f9c34d6ba156341115.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*48lOwt3NGRfABAS7eoWCCQ.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated"><a class="ae kx" href="https://nmap.org/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/</a></figcaption></figure><p id="51ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是Nmap？</strong></p><p id="ab90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自官网，【https://nmap.org/】:</p><pre class="km kn ko kp gt ky kz la lb aw lc bi"><span id="c0a1" class="ld le iq kz b gy lf lg l lh li">Nmap ("Network Mapper") is a free and open source (<a class="ae kx" href="https://nmap.org/data/COPYING" rel="noopener ugc nofollow" target="_blank">license</a>) utility for network discovery and security auditing.  Many systems and network administrators also find it useful for tasks such as network inventory, managing service upgrade schedules, and monitoring host or service uptime.</span></pre><p id="bc59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Nmap的作者是戈登·费奥多·里昂。它的历史很有趣，你可以在这里查看:<a class="ae kx" href="https://nmap.org/book/history-future.html" rel="noopener ugc nofollow" target="_blank">https://nmap.org/book/history-future.html</a>。</p><h2 id="83ee" class="ld le iq bd lj lk ll dn lm ln lo dp lp jy lq lr ls kc lt lu lv kg lw lx ly lz bi translated">Nmap与其他扫描器的区别在于:</h2><p id="a84f" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Nmap最好的一点是它是免费和开源的，非常灵活和通用。Nmap通常用于确定网络中的活动主机、这些主机上的开放端口、这些开放端口上运行的服务以及该端口上该服务的版本标识。它还可以运行漏洞评估脚本来确定服务是否易受攻击。渗透测试人员可以使用它来识别开放端口，以收集有关目标的更多信息，或者安全管理员可以使用它来识别系统中未使用的开放端口。由于其实用性，安全社区长期以来一直认为Nmap是用于网络映射和主机识别的事实上的工具。</p><h2 id="6ca1" class="ld le iq bd lj lk ll dn lm ln lo dp lp jy lq lr ls kc lt lu lv kg lw lx ly lz bi translated">使用Nmap:</h2><p id="d3e6" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">如果你用的是Kali Linux，Nmap肯定是装的。您可以通过运行以下命令进行检查:</p><pre class="km kn ko kp gt ky kz la lb aw lc bi"><span id="420f" class="ld le iq kz b gy lf lg l lh li"># nmap --version</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/505648471966aae30006b7e745d5c576.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*0v1iNVglEd5c_LTtXR9W1g.png"/></div></figure><p id="bc87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用的是Linux的其他发行版，并且计划在不同的操作系统中安装Nmap，那么您可以遵循本页的安装指南:<a class="ae kx" href="https://nmap.org/book/install.html" rel="noopener ugc nofollow" target="_blank">https://nmap.org/book/install.html</a>。</p><h1 id="cd61" class="mg le iq bd lj mh mi mj lm mk ml mm lp mn mo mp ls mq mr ms lv mt mu mv ly mw bi translated">Nmap如何工作(从技术上讲可能不是正确的解释):</h1><p id="4bee" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Nmap的工作原理是向目标发送大量数据包，然后目标以特定的方式做出响应。例如，Nmap可以向目标发送数据包，指定端口80(通常是HTTP服务)。现在目标有了特定的响应，这对应于一种状态(打开、关闭、过滤)。如果端口是打开的，Nmap根据响应识别正在运行的HTTP服务的类型(Apache、Nginx、IIS等)。).然后，使用另一个检查来识别版本，并继续下去。</p><p id="c12e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Nmap有一个服务记录，它映射到对该类型请求的一种类型的响应，最终导致Nmap正确地确定什么服务及其版本。但是这并不是绝对可靠的，因为Nmap有时会将运行在该端口上的服务弄错(如果您没有使用标志进行更繁琐的检查的话)，因为该端口通常用于特定的服务。<strong class="jp ir">注意</strong>Nmap扫描最好以管理员或root权限运行，因为Nmap发送原始数据包，而作为特权用户是发送原始数据包的要求(因为它们远低于OSI模型)。</p><h1 id="584b" class="mg le iq bd lj mh mi mj lm mk ml mm lp mn mo mp ls mq mr ms lv mt mu mv ly mw bi translated">Nmap语法:</h1><p id="8cff" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">现在，在我开始举例之前，我想分解一下Nmap语法通常是如何构造的，因为记住这一点是很好的做法。虽然根据我的经验，标志的顺序在大多数时候并不重要(有些情况下是如此)。事实上，要进行扫描，Nmap只需要一个目标。这种格式不明确，也不是必需的，但是根据文档，Nmap遵循以下格式:</p><pre class="km kn ko kp gt ky kz la lb aw lc bi"><span id="d5a9" class="ld le iq kz b gy lf lg l lh li">nmap [scan type] [options] [target specification]</span></pre><p id="b369" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将以上述格式提供每个字段的简短分类。</p><h2 id="d910" class="ld le iq bd lj lk ll dn lm ln lo dp lp jy lq lr ls kc lt lu lv kg lw lx ly lz bi translated">常见的Nmap扫描类型:</h2><p id="68c9" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Nmap根据您的需要有各种扫描类型。常见的有SYN扫描(-sS)、TCP连接扫描(-sT)、UDP扫描(-sU)。请注意，SYN扫描和TCP扫描利用了<a class="ae kx" href="https://www.geeksforgeeks.org/tcp-3-way-handshake-process/" rel="noopener ugc nofollow" target="_blank">三次握手</a>:</p><ol class=""><li id="7897" class="mx my iq jp b jq jr ju jv jy mz kc na kg nb kk nc nd ne nf bi translated"><strong class="jp ir"> SYN扫描</strong> (-sS)通过向目标发送“SYN”来识别要打开的端口。如果它收到SYN-ACK或SYN，它会将该端口标记为开放。如果它收到一个“RST”，它将端口标记为已过滤。</li><li id="dd4e" class="mx my iq jp b jq ng ju nh jy ni kc nj kg nk kk nc nd ne nf bi translated"><strong class="jp ir"> TCP扫描</strong> (-sT)通过等待三次握手的完成来识别要打开的端口。</li><li id="b282" class="mx my iq jp b jq ng ju nh jy ni kc nj kg nk kk nc nd ne nf bi translated"><strong class="jp ir"> UDP扫描</strong> (-sU)对于识别目标上开放的UDP端口非常有用。它将特定的UDP数据包发送到已知的UDP端口。</li></ol><h2 id="638b" class="ld le iq bd lj lk ll dn lm ln lo dp lp jy lq lr ls kc lt lu lv kg lw lx ly lz bi translated">常见Nmap选项:</h2><p id="4ec8" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Nmap有大量的选项，取决于你的扫描需要什么。基本上，您应该使用以下内容:</p><ol class=""><li id="c2c0" class="mx my iq jp b jq jr ju jv jy mz kc na kg nb kk nc nd ne nf bi translated"><strong class="jp ir">将您的Nmap扫描保存到文件。</strong> Nmap可以分别使用-oN、-oX和-oG标志以3种格式(普通输出、XML输出和greppable输出)保存您的扫描。如果您想以所有格式保存它，请使用-oA标志。还有一个-oS标志，它以脚本kidde或“l33t speak”格式输出您的扫描。</li><li id="8105" class="mx my iq jp b jq ng ju nh jy ni kc nj kg nk kk nc nd ne nf bi translated"><strong class="jp ir">添加详细度标志。</strong> Nmap可以选择使用(-v)标志打印出更多信息。您可以通过将扫描期间的结果打印到标准输出(-vv，-vvv或-v2，-v3)来增加详细程度(例如，已识别的开放端口、扫描问题等。).您也可以使用原因标志(双划线原因)。这些标志有助于您计划下一步要做什么，因为Nmap在扫描后才会显示其结果，所以您已经有了初步数据。</li><li id="36bb" class="mx my iq jp b jq ng ju nh jy ni kc nj kg nk kk nc nd ne nf bi translated"><strong class="jp ir">利用计时选项。</strong>您可以使用其中一个标志-T0、-T1、-T2、-T3、-T4、-T5来使用适合您目的的计时模板，这些标志分别代表偏执、鬼鬼祟祟、彬彬有礼、正常、好斗和疯狂。这些模板决定了扫描的积极程度，并且根据您所在网络的带宽和资源而定。-T0和-T1扫描对IDS规避有用，但可能太慢。当没有提到这些标志时，T3或normal是Nmap的默认行为。</li></ol><h2 id="b78a" class="ld le iq bd lj lk ll dn lm ln lo dp lp jy lq lr ls kc lt lu lv kg lw lx ly lz bi translated">通用Nmap目标规范:</h2><p id="adc6" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Nmap允许各种目标规格，但可以简单的分为两部分:<strong class="jp ir">端口</strong>和<strong class="jp ir"> IP/host </strong>。</p><ol class=""><li id="00b0" class="mx my iq jp b jq jr ju jv jy mz kc na kg nb kk nc nd ne nf bi translated">Nmap允许使用“<strong class="jp ir">-p”</strong>标志的<strong class="jp ir">端口规范</strong>。您可以为特定协议指定单个端口、端口范围、排除的端口和端口:</li></ol><pre class="km kn ko kp gt ky kz la lb aw lc bi"><span id="2e9d" class="ld le iq kz b gy lf lg l lh li"># Specifying a single port(port 21):<br/>nmap -p21 10.10.10.10<br/># Specifying a port range(port 21 to 1000):<br/>nmap -p21-1000 10.10.10.10<br/># Specifying a port range but exclude port 22:<br/>nmap -p21-1000 -exclude-ports 22 10.10.10.10<br/># Specifying a TCP-specific or UDP-specific port:<br/># nmap -sU -sS -p T:21,22,25,80,U:53,161 10.10.10.10 </span></pre><p id="dbc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>要同时扫描特定于TCP和特定于UDP的端口，需要存在-sU标志，并且至少有一种TCP扫描类型(-sT、-sF或-sS)</p><p id="e13f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.Nmap接受<strong class="jp ir">主机名、IP地址、网络范围</strong>、<strong class="jp ir">等。</strong>您还可以使用-iL标志为其提供一个文件，其中包含IP地址或网络列表。它还允许您从目标中排除特定的主机或网络:</p><pre class="km kn ko kp gt ky kz la lb aw lc bi"><span id="c109" class="ld le iq kz b gy lf lg l lh li"># Scanning a specific hostname:<br/>nmap target.domain.com <br/># Scanning a specific IP address:<br/>nmap 10.10.10.10<br/># Scanning a network range:<br/>nmap 10.10.10.1-254 or nmap 10.10.10.0/24<br/># Scanning a network range but exclude few IP addresses:<br/>nmap 10.10.10.0/24 --exclude 10.10.10.167</span></pre><p id="7f38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>如果不指定特定端口，Nmap会扫描最常用的前1000个TCP端口。</p><h1 id="df80" class="mg le iq bd lj mh mi mj lm mk ml mm lp mn mo mp ls mq mr ms lv mt mu mv ly mw bi translated">将所有这些放在一起:</h1><p id="7317" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">以下是Nmap使用的几个具体示例:</p><pre class="km kn ko kp gt ky kz la lb aw lc bi"><span id="f463" class="ld le iq kz b gy lf lg l lh li">Scanning an IP address with no flags used:</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/09984367407afcf964d0744f1758b5d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*WqyL_zpVvgsUOQrnTSb8RQ.png"/></div></figure><p id="fc23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它提到了前1000个TCP端口中，997个被过滤，其中3个是开放的。Nmap能够识别端口80运行http，135运行msrpc，3306运行mysql。</p><pre class="km kn ko kp gt ky kz la lb aw lc bi"><span id="1511" class="ld le iq kz b gy lf lg l lh li">Scanning an IP address but excluding a specific TCP port:</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/f528d5a3dd288c8b61411c2b8385a0c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*hdANUAf6gAV8tiN9HYVagw.png"/></div></figure><p id="8b99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">扫描同一个主机，扫描输出只找到2个端口，因为我故意跳过了端口135。</p><pre class="km kn ko kp gt ky kz la lb aw lc bi"><span id="66a1" class="ld le iq kz b gy lf lg l lh li">Scanning an IP address targeting a specific TCP and UDP port and saving it to a XML file called “specific-ports” with verbosity of level 2:</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nn"><img src="../Images/076edc851840b6ac721033ce4f43ce9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i2Uv8wY1Vqt8TJaqYO4cQA.png"/></div></div></figure><p id="ffe9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我能够扫描TCP和UDP端口，并在扫描仍在运行时得到一个部分已打开的通知，并将它保存到一个XML文件中以备将来使用。</p><h2 id="cd5a" class="ld le iq bd lj lk ll dn lm ln lo dp lp jy lq lr ls kc lt lu lv kg lw lx ly lz bi translated">总结:</h2><p id="a4ea" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">Nmap是一个非常有用的工具，不仅对于安全专业人员，而且对于IT从业者，因为它的多功能性。🍻🍻</p></div></div>    
</body>
</html>