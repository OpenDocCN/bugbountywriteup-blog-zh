<html>
<head>
<title>Module-3 | Introduction -Pentesting &amp; Bypassing AWS/Azure/GCP Cloud WAF Fun &amp; Profit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模块3 |简介-测试和绕过AWS/Azure/GCP云WAF的乐趣和收益</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/module-3-introduction-pentesting-bypassing-aws-azure-gcp-cloud-waf-fun-profit-6b38a836d78f?source=collection_archive---------3-----------------------#2022-05-25">https://infosecwriteups.com/module-3-introduction-pentesting-bypassing-aws-azure-gcp-cloud-waf-fun-profit-6b38a836d78f?source=collection_archive---------3-----------------------#2022-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/1e6fecd028361ad581d827b85a80c233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eulqyvUY36J18tEwCHskFA.png"/></div></div></figure><h1 id="7e9c" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">1.为AWS WAF设置易受攻击的应用程序</h1><blockquote class="kz la lb"><p id="4c65" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">我们将为pentesting WAF设置自定义DVWA。</p></blockquote><p id="4201" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.1.我们需要设置ec2实例，我们将在其中托管DVWA。让我们首先通过单击“<strong class="lf iu">启动实例</strong>”来创建实例。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/c807e4f9124f98e726b0f15a51dfa6d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*La5ofw3bj6v-QqbFznfGVQ.png"/></div></div></figure><p id="0f6b" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.2.为服务器选择一个<strong class="lf iu"> Ubuntu 20.04 AMI </strong>，点击选择。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/d99820e1b9e598455026b5f035976d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Q9ogey_cVkbJecIjOInZA.png"/></div></div></figure><p id="e870" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.3.选择实例类型为<strong class="lf iu"> T2微</strong>，点击<strong class="lf iu">配置实例详情</strong>。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/2867b9ad9340730b2c73cf832a0e2529.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fjpr0G7B2wAM-FWf_mTuHA.png"/></div></div></figure><p id="8b57" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.4.在<strong class="lf iu">配置实例</strong>中，保留所有默认设置。确保<strong class="lf iu">自动分配公共IP </strong>设置为<strong class="lf iu">启用。</strong></p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/40c1c4ca8a100d6ce95f94db146a9529.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2bpiNAmxOy8dYZlXXBZgw.png"/></div></div></figure><p id="37fb" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.5.存储保持8 GB。它将出现在一个免费层。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/d391505dd223171a0eaa72f31d076b14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvC9WW1pyMos3K0EA8GD-w.png"/></div></div></figure><p id="65ca" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.6.接下来，我们需要为<strong class="lf iu"> HTTP流量</strong> &amp; <strong class="lf iu"> SSH </strong>配置安全组。然后添加<strong class="lf iu">源</strong>为<strong class="lf iu">我的IP </strong>为<strong class="lf iu">所有流量</strong> &amp; <strong class="lf iu"> SSH </strong>。</p><blockquote class="kz la lb"><p id="8c7c" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">我们也可以选择端口80，但这是实验室，所以我选择所有流量。对于源，将IP保留为VPN或静态IP。我们将在设定ELB后再次修改这个。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/53ac1a07e4c48f56575a3fbdd15522e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ga6_aTihhc1NL8sRKNFLbw.png"/></div></div></figure><p id="4f58" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.7.查看实例启动并点击<strong class="lf iu">启动</strong>。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/5540cc9f8a11b63de5d58e0b4559abae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QA9xuBDR2AUn9LJQC8TVJg.png"/></div></div></figure><p id="993a" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.8.然后登录到实例，我们将ssh键。我们将为ssh创建或选择一个现有的密钥对到实例中。</p><blockquote class="kz la lb"><p id="dc77" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">给你的密钥对起个名字吧。我们把它命名为<strong class="lf iu"> ssh-key </strong>。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/247c5a10e5074d7e20356064f6ece515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rJAIP9tkywEodJqGteViA.png"/></div></div></figure><p id="4a0f" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.9.检查实例状态，并等待实例启动。实例状态应该是<strong class="lf iu">运行</strong>。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/06ddcf5e231f4772224004c11a287cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQGRQM0GlETvEQ6L2rzZSQ.png"/></div></div></figure><p id="1adf" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.10 .然后，要安装DVWA，我们需要通过ssh登录:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="fd59" class="mo kc it mk b gy mp mq l mr ms">#ssh -i ssh-key.pem ubuntu@34.218.245.107</span></pre><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/0e420e1bb8074a7d30a70dd7a2d6ab90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WqptaBML6eEuNl-zRRPGIQ.png"/></div></div></figure><p id="5e11" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.11.现在我们将安装自定义的DVWA，它是从原来的DVWA派生出来的。</p><blockquote class="kz la lb"><p id="ade9" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">我特意定制了DVWA来表演和展示其他在最初的DVWA中不可能演示的攻击。</p></blockquote><p id="133f" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.12运行下面提到的命令来下载Ubuntu的bash脚本，它将设置预配置的DVWA。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="7c9f" class="mo kc it mk b gy mp mq l mr ms">#sudo su<br/>#wget <a class="ae mu" href="https://raw.githubusercontent.com/justmorpheus/waf-dvwa/main/automate.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/justmorpheus/waf-dvwa/main/automate.sh</a><br/>#chmod +x automate.sh<br/>#bash automate.sh</span></pre><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/2537264e49fb13cbfa088420b76873f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ICo-IX7bpeTX8Dvkjec4A.png"/></div></div></figure><p id="551b" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.13现在检查DVWA安装，让我们通过IP访问实例。我们可以确认它正在工作。</p><blockquote class="kz la lb"><p id="89ce" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">不要公开DVWA，因为它是一个易受攻击的应用程序。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/916c5fa19981c49720de79d6990fdccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XxwovKsHkT8F215REbZBpA.png"/></div></div></figure><p id="574e" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">1.14下面是DVWA存储的XSS的片段，我修改它来测试我的场景。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="fe72" class="mo kc it mk b gy mp mq l mr ms">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;body&gt;</span><span id="ea6e" class="mo kc it mk b gy mw mq l mr ms">&lt;?php  <br/>$input = "https%2525252525253A%2525252525252F%2525252525252Fw3schools.in%2525252525252F";<br/>$temp = urldecode($input);<br/>while($temp != $input) {</span><span id="74ab" class="mo kc it mk b gy mw mq l mr ms">$input = $temp;<br/>  $temp = urldecode($input);</span><span id="5d10" class="mo kc it mk b gy mw mq l mr ms">}<br/>$message= $input;<br/>echo $message;<br/>?&gt;</span><span id="c7c4" class="mo kc it mk b gy mw mq l mr ms">&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="16bf" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">在这一部分，我试图递归解码多次URL编码的字符串。这将解码在任何字符串上执行的多URL编码。我从<a class="ae mu" href="https://stackoverflow.com/questions/22822676/html-url-decode-on-multiple-times-encoded-string" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>那里得到这个。</p><h1 id="ee7f" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">2.设置AWS WAF</h1><p id="f499" class="pw-post-body-paragraph lc ld it lf b lg mx li lj lk my lm ln mb mz lq lr mc na lu lv md nb ly lz ma im bi translated">2.1我们需要设置WAF，但在此之前，我们需要创建一个负载平衡器和目标组。</p><blockquote class="kz la lb"><p id="9675" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">一个<a class="ae mu" href="https://docs.aws.amazon.com/en_pv/elasticloadbalancing/latest/application/load-balancer-target-groups.html" rel="noopener ugc nofollow" target="_blank">目标组</a>告诉负载均衡器将流量定向到哪里:EC2实例，固定的IP地址；或者<a class="ae mu" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank">AWSλ</a>功能等等。</p></blockquote><p id="509e" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.2我们将首先创建一个<strong class="lf iu">目标群体</strong>。选择位于ec2左侧面板的目标组选项，然后点击<strong class="lf iu">创建目标组</strong>。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/c3275630ca7a11b2606b0d9e107bf2ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vztm58in5_cWfxpJuJ0kkw.png"/></div></div></figure><p id="5f57" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.3.我们需要填写目标组名称的详细信息，并保持VPC为默认值。让我们把它保持为<strong class="lf iu"> tg-waf </strong>，然后点击<strong class="lf iu">下一个</strong>。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/dcadb1988fb7cde015b83e3a6e68ef45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZbeyZw2hTrIFlAqF1S8Kg.png"/></div></div></figure><p id="0556" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.4.一旦创建了目标组，我们就需要注册将成为实例的目标。然后选择EC2在目标组中注册。</p><blockquote class="kz la lb"><p id="b478" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">这个ec2是我们安装了易受攻击的DVWA的实例。请确保保持地区不变。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/9b9c03ecac321de129bab84b3661b802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XFgAssajA3a3hS3gAtwQRA.png"/></div></div></figure><p id="7caa" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.5.添加目标后，我们需要单击创建目标组。</p><blockquote class="kz la lb"><p id="1008" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">如果出现错误，我们需要检查“<strong class="lf iu">健康状态详细信息</strong>”。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/b0faa08aed2829be818591839f478db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ogJS0GBWwWJQLb8i25WoA.png"/></div></div></figure><p id="0fe3" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.6.在这里，我们可以检查ec2是否已经成功添加到<strong class="lf iu">目标组</strong>中。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/fca35cce45e5e69942d666eb1906ba77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pc7q1D1B_WYMsQRdroGWbw.png"/></div></div></figure><p id="d07e" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.7.现在，我们将通过“负载平衡器”选项卡配置负载平衡器。点击<strong class="lf iu">创建负载平衡器</strong>。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/bb91efa4218c367ec0b7262701274a50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lkjDvIjZJbuSB4OamMj_yw.png"/></div></div></figure><p id="58a4" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.8.选择<strong class="lf iu">应用负载平衡器</strong>。填写负载平衡器名称并保留VPC的区域。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/ca5a83e7c081afbc4934c3d7710feb8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dPmn9V3RqegPDEx--fGF1A.png"/></div></div></figure><p id="ef87" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.9.我们至少需要选择<strong class="lf iu">两个VPC </strong>，这里我们选择了全部四个。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/c4a1af6a49f1a7595f7522919a53f244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NV0jHMPBknoQj-RjHYI_OQ.png"/></div></div></figure><p id="8ace" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.10.然后在目标类型中选择<strong class="lf iu"> <em class="le"> waf-elb </em> </strong>，即我们之前创建的<strong class="lf iu">目标组。</strong></p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/ada459802ea22ef166a2d053e05aaaab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ag4QpifRSSW3gurOhzAHg.png"/></div></div></figure><p id="d5d3" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.11.创建负载平衡器后，将对其进行设置。我们需要等待资源调配完成。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/97c381eaf7646c8f487db86707f36c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ttgZkEK325iJEoYJBRstQ.png"/></div></div></figure><p id="b399" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.12.从描述中复制ALB <strong class="lf iu"> <em class="le"> DNS名称</em> </strong>。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/e77dadeb906a56c85243e46f21aa517d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rH-TNBewkbFSCxWbOJy-xQ.png"/></div></div></figure><p id="2b8a" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.13.让我们尝试通过ALB访问ec2。</p><blockquote class="kz la lb"><p id="9957" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">这显示了一个错误，因为我们已经更新了ec2的安全组，允许流量通过ALB。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/59763aa9ff58528278ce0efdf76226bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8VLM6I1hc19GBC8nHzVT5g.png"/></div></div></figure><p id="a38c" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.14.现在，让我们对网络进行更改，以便只能通过ELB访问实例。<br/>访问负载平衡器，并在安全中单击安全组。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/8ba4965cc6caa8ef97e2ef5b3ebe6dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*St3Wrl2k4INbezs6q70y3A.png"/></div></div></figure><p id="edef" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.15.在负载平衡器中选择安全组。然后编辑负载平衡器的安全组的入站规则。</p><blockquote class="kz la lb"><p id="23a1" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">确保允许从互联网到ALB的流量。添加0.0.0.0/0，以便在未添加的情况下允许来自公众的流量。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/919a796bbe373693dc1c99948604d00f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rt2TvMCok-rfjWUBxrrWvQ.png"/></div></div></figure><p id="c31c" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.16.然后切换回ec2并打开ec2实例的安全组。然后选择并编辑<strong class="lf iu">入站流量规则。</strong></p><blockquote class="kz la lb"><p id="2610" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">在这里，我们将把ALB安全组添加到ec2实验室入站规则的源中。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/d14e30d525f0089ceaff285354bc9024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9GLCmpWTAZxLE2aHv7eKvw.png"/></div></div></figure><p id="88c6" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.17.我们需要选择并添加允许在端口80上为HTTP的流量，对于源，输入负载平衡器sg-group以允许从ELB到ec2实例的流量。</p><blockquote class="kz la lb"><p id="781f" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">这是一个实验，因此选择了所有流量。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/a69ae0035b8c8871f067246635411d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wuW_3kLdBiQVf5WojgoFiA.png"/></div></div></figure><p id="3128" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">2.18.现在，我们将尝试通过DNS名称访问ALB。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/d8b525f174bfd350a11278b5ca895c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xhsedRLKdj2OSW93fHJkmQ.png"/></div></div></figure><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/672d7ef9970760962e3d372f415b5a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RhJibTUbHYUMnsqWlzX32g.png"/></div></div></figure><h1 id="0c09" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">3.设置AWS WAF</h1><p id="2fa8" class="pw-post-body-paragraph lc ld it lf b lg mx li lj lk my lm ln mb mz lq lr mc na lu lv md nb ly lz ma im bi translated">3.1.在AWS管理控制台中，在顶部的搜索栏中，输入<em class="le"> WAF </em>，在<strong class="lf iu"> Services </strong>下，点击<strong class="lf iu"> WAF &amp; Shield </strong>结果。</p><blockquote class="kz la lb"><p id="d741" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">AWS Shield是来自Amazon的基于订阅的服务，它保护资源免受拒绝服务(DOS)攻击。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/ba088f1a1eb00153ee015e5cac650e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8g7x3rapZtijpLFC4P2hfA.png"/></div></div></figure><p id="3589" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">3.2.在左侧菜单的<strong class="lf iu"> AWS WAF </strong>下，点击<strong class="lf iu"> Web ACLs。</strong></p><p id="81b2" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">3.3.在右侧，单击<strong class="lf iu">创建web ACL。</strong>它将打开一个多步向导加载。然后在<strong class="lf iu"> Web ACL详细信息</strong>部分，向下滚动到<strong class="lf iu">区域</strong>并选择<strong class="lf iu">美国西部(俄勒冈州)。</strong></p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/1fecf9294b6cdc603ef5da2ffac161ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/0*efpj30ymXlLkib8z.png"/></div></figure><blockquote class="kz la lb"><p id="1b55" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">我们正在这个地区创造资源。首先设置区域，因为有时更改区域会导致页面重新加载并删除其他表单字段。<br/>此外，<strong class="lf iu">云观察指标名称</strong>字段应该会自动填充。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/9c7d12bee726615a1612d4fcaaed56a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yqxs_-cKvWlSjqM0KlKdLg.png"/></div></div></figure><p id="c057" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">3.4.在右侧的<strong class="lf iu">关联AWS资源</strong>部分，点击打开的选项中的<strong class="lf iu">添加AWS资源<br/> </strong>，在<strong class="lf iu">资源类型</strong>下，选择<strong class="lf iu">应用负载均衡器。</strong></p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/53dae0df574e2b02d1b6d81c1f6452e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-zzqBRMT5lI6glJqG_yug.png"/></div></div></figure><p id="ab49" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">3.5.然后我们需要启用规则。在步骤2中，添加规则和规则组。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/f2247262ba0f5ade28f7f350d46563f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UM8Ri0b97t6FByaDr6k95Q.png"/></div></div></figure><p id="f845" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">3.6.在<strong class="lf iu">规则</strong>部分，点击<strong class="lf iu">添加规则</strong>并点击<strong class="lf iu">添加受管规则组。<br/> </strong>我们需要启用核心规则集，选择AWS管理的规则组，选择核心规则集。</p><blockquote class="kz la lb"><p id="7cae" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">受管规则组是由AWS或AWS Marketplace销售者提供的预定义规则组。</p><p id="806e" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">来自市场销售者的规则组通常需要订阅并有与之相关的费用。这是使用AWS WAF监控web请求的附加费用。AWS管理的规则组可以免费使用。</p></blockquote><ul class=""><li id="016c" class="nq nr it lf b lg lh lk ll mb ns mc nt md nu ma nv nw nx ny bi translated"><strong class="lf iu"> <em class="le">您也可以使用自己指定的规则创建自己的规则组。我们将在后面的部分看到这一点。</em> </strong></li></ul><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/95bb5f788398d3bbd8497d49b40770e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHJ4T2VjyHwFsTqCIPMfhQ.png"/></div></div></figure><p id="9238" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">3.7要查看可用的AWS提供的规则和规则组，请单击<strong class="lf iu"> AWS管理的规则组。</strong></p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="ab gu cl nz"><img src="../Images/e63b7e00e9ead5125b94140c2aaed2a9.png" data-original-src="https://miro.medium.com/v2/format:webp/0*tcw7vtQGypwdsOOG.png"/></div></figure><p id="7071" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">3.8您将看到该部分展开，以及AWS提供的规则组列表。</p><ul class=""><li id="e466" class="nq nr it lf b lg lh lk ll mb ns mc nt md nu ma nv nw nx ny bi translated">向下滚动到核心规则集，并单击<strong class="lf iu">添加到web ACL </strong>切换。</li><li id="416b" class="nq nr it lf b lg oa lk ob mb oc mc od md oe ma nv nw nx ny bi translated">选择其他相关规则，并从列表中启用其他规则。</li></ul><blockquote class="kz la lb"><p id="5817" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">注意:AWS的总WEB ACL容量是1500个单位。</p></blockquote><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/7b40bc18f423c1c1a7364e9b285df4a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vdqPdyGZz55FmIkXOc0z2g.png"/></div></div></figure><h1 id="828c" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">4.CRS —核心规则集</h1><ul class=""><li id="57a8" class="nq nr it lf b lg mx lk my mb of mc og md oh ma nv nw nx ny bi translated">我们上面创建的ACL没有定义规则，默认情况下允许所有流量进入。不是很有用是吗！要添加规则，您可以自己编写规则和/或使用预定义的管理规则组。使用托管规则组是最简单的入门方式，所以让我们从这里开始。</li><li id="aa81" class="nq nr it lf b lg oa lk ob mb oc mc od md oe ma nv nw nx ny bi translated">ModSecurity是一个开源的基于web的防火墙应用程序(或WAF ),由不同的web服务器支持。它附带了一个核心规则集(CRS ),其中包含各种针对跨网站脚本、不良用户代理、SQL注入、特洛伊木马、会话劫持和其他利用的规则。ModSecurity是使用核心规则集的引擎，即阻止或允许请求的基于签名的规则。</li></ul><p id="6b50" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">关于CRS的更多信息，请访问https://coreruleset.org/<a class="ae mu" href="https://coreruleset.org/" rel="noopener ugc nofollow" target="_blank"><strong class="lf iu"/></a><strong class="lf iu">。也为一个深入的教程由CRS的共同领导之一&amp;一个惊人的人</strong> <a class="ae mu" href="https://twitter.com/ChrFolini" rel="noopener ugc nofollow" target="_blank"> <strong class="lf iu">基督教Folini </strong> </a> <strong class="lf iu">访问</strong><a class="ae mu" href="https://www.netnea.com/cms/tutorials/" rel="noopener ugc nofollow" target="_blank"><strong class="lf iu">https://www.netnea.com/cms/tutorials</strong></a><strong class="lf iu">。</strong></p><blockquote class="kz la lb"><p id="e979" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated"><em class="it">注意</em>:使用AWS CLI，你可以创建一个使用JSON描述规则的Web ACL。您还可以查看现有Web ACL的JSON定义，如果需要，可以很容易地在它们之间复制/粘贴。</p></blockquote><p id="9b3e" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated"><strong class="lf iu"> 4.1使用托管规则组</strong></p><ul class=""><li id="e855" class="nq nr it lf b lg lh lk ll mb ns mc nt md nu ma nv nw nx ny bi translated">受管规则组是一组预定义的规则，由AWS或第三方供应商管理。这些规则集针对各种威胁(如<a class="ae mu" href="https://owasp.org/www-project-top-ten/" rel="noopener ugc nofollow" target="_blank"> OWASP十大威胁列表</a>)提供即时保护，并不断更新以确保抵御新威胁。AWS提供的规则是免费使用的，而第三方规则需要付费订阅。</li><li id="9f5f" class="nq nr it lf b lg oa lk ob mb oc mc od md oe ma nv nw nx ny bi translated">您已经选择了一个规则组来识别包含已知SQL攻击(如SQL注入(有时也称为SQLi)攻击)的web请求。SQL注入攻击通常是包含SQL语法的web请求。安全性差的web应用程序可能会执行SQL语法，而不会安全地对其进行转义。如果攻击者可以在系统的SQL数据库上运行他们选择的SQL，那么他们就可以用它来删除和修改数据。他们还可以利用它获得未经授权的更高级别的访问权限，从而危及整个系统。</li><li id="ea1d" class="nq nr it lf b lg oa lk ob mb oc mc od md oe ma nv nw nx ny bi translated">实现良好的现代web应用程序不应该容易受到这种攻击。然而，大多数信息安全专家推荐一种叫做<a class="ae mu" href="https://en.wikipedia.org/wiki/Defense_in_depth_(computing)" rel="noopener ugc nofollow" target="_blank">深度防御</a>的系统安全方法。这可以概括为将安全控制分层到系统的每个部分。</li><li id="35ed" class="nq nr it lf b lg oa lk ob mb oc mc od md oe ma nv nw nx ny bi translated">当遗留应用程序的安全模型没有被很好地记录或被怀疑是脆弱的时，这种Web ACL规则在将遗留应用程序迁移到云时可能特别有用。</li></ul><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/950e1c7321a2aaaee7b82e606195ba2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hh0QIhFcz0CFtv_gLUwpAg.png"/></div></div></figure><p id="c438" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">4.2.要完成添加受管规则组，请滚动到底部并单击<strong class="lf iu">添加规则。</strong></p><p id="782b" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">4.3.您将返回到向导的<strong class="lf iu">添加规则和规则组</strong>部分。</p><p id="b557" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">4.4.在底部，点击下一个的<strong class="lf iu">。</strong></p><p id="d552" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">4.5.<strong class="lf iu">设置规则优先级</strong>页面允许您指定当Web ACL处理Web请求时规则的评估顺序。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/7e97266d38495f9f3d360cd19b56a79c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zifffCNwZ7iyBsIY-rKAPw.png"/></div></div></figure><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/e0b54b14e6062aacfd2f4122e8152c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1AWlVt7AI1KrhRIZC3oLdw.png"/></div></div></figure><p id="1c25" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">4.6.最后，点击<strong class="lf iu">创建web ACL </strong>。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/f42954d238199e4e7cc33d896d33fc64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cGPZJqVFkBX7Jlnme9zUYw.png"/></div></div></figure><p id="be6d" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">4.7.名为<strong class="lf iu"> waf-demo </strong>的AWS Web应用防火墙已成功创建。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/8565cec041e99e80289659268bb11100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ENAuo14ZAceHz-OKi6pLNA.png"/></div></div></figure><p id="09e3" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">4.8.然后访问负载平衡器DNS名称<a class="ae mu" href="http://waf-loadbalancer-594844706.ca-central-1.elb.amazonaws.com/DVWA/login.php" rel="noopener ugc nofollow" target="_blank">http://waf-Load balancer-594844706 . ca-central-1 . elb . amazonaws . com/DVWA/log in . PHP</a></p><p id="4e94" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">4.9.让我们进入有效载荷并测试晶片。它绝对工作正常。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/58122a412ab706fe374b6ca550d92a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OnQ8Ez92_gT4JWmfDiVlSw.png"/></div></div></figure><p id="d9e9" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mb lp lq lr mc lt lu lv md lx ly lz ma im bi translated">在下一个模块中，我们还将实现Azure &amp; GCP WAF。</p><h1 id="5e0e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">摘要</h1><ul class=""><li id="1dbc" class="nq nr it lf b lg mx lk my mb of mc og md oh ma nv nw nx ny bi translated">参考<a class="ae mu" href="https://medium.com/@justm0rph3u5/module-2-owasp-modsecurity-core-rule-set-pentesting-bypassing-cloud-web-application-firewall-2594e17b35c1" rel="noopener">之前的博客</a>了解核心规则集。</li><li id="08f0" class="nq nr it lf b lg oa lk ob mb oc mc od md oe ma nv nw nx ny bi translated">下一篇博客是关于测试AWS WAF的规则。</li><li id="51db" class="nq nr it lf b lg oa lk ob mb oc mc od md oe ma nv nw nx ny bi translated">常见的方法和假阳性。</li></ul><h1 id="0371" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">参考</h1><ul class=""><li id="29e7" class="nq nr it lf b lg mx lk my mb of mc og md oh ma nv nw nx ny bi translated"><a class="ae mu" href="https://medium.com/@comp87/deep-dive-into-the-aws-web-application-firewall-waf-14148ea0d3d" rel="noopener">https://medium . com/@ comp 87/deep-dive-into-the-AWS-web-application-firewall-waf-14148 ea 0d 3d</a></li><li id="de7c" class="nq nr it lf b lg oa lk ob mb oc mc od md oe ma nv nw nx ny bi translated"><a class="ae mu" href="https://medium.com/secjuice/waf-evasion-techniques-718026d693d8" rel="noopener">https://medium . com/sec juice/waf-escalation-techniques-718026 d693 D8</a></li></ul></div></div>    
</body>
</html>