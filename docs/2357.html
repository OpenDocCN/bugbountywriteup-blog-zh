<html>
<head>
<title>How To Perform Command Injection Attacks (DVWA) For Aspiring Hackers! — StackZero</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对有抱负的黑客进行命令注入攻击(DVWA)！—堆栈零</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-to-perform-command-injection-attacks-dvwa-for-aspiring-hackers-stackzero-c9d521c6f934?source=collection_archive---------0-----------------------#2022-09-12">https://infosecwriteups.com/how-to-perform-command-injection-attacks-dvwa-for-aspiring-hackers-stackzero-c9d521c6f934?source=collection_archive---------0-----------------------#2022-09-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/581ba91c4192f3a33f7b0c9720df50d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Do0SGdMuRWgg-xpT.jpg"/></div></div></figure><h1 id="d6c5" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">介绍</h1><p id="af93" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">嗨读者！在这篇文章中，我想告诉你如何通过使用<a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/what-is-command-injection-and-how-to-exploit-it-stackzero-ac7643bc492">命令注入</a>攻击来攻击<a class="ae lx" href="https://github.com/digininja/DVWA" rel="noopener ugc nofollow" target="_blank"> DVWA </a>。</p><p id="4c71" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">命令注入是最容易理解的攻击之一，然而，从实用的角度来看，并没有太多的在线教程涉及这个主题。<br/>像往常一样，我想尽我最大的努力来解释，以便让你能够毫无问题地找到这种类型的bug。</p><p id="5eec" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">因此，让我们通过在<a class="ae lx" href="https://tryhackme.com/room/dvwa" rel="noopener ugc nofollow" target="_blank"> TryHackMe </a>上运行我们的<a class="ae lx" href="https://medium.com/@stackzero/how-to-install-kali-linux-on-virtualbox-in-a-few-minutes-stackzero-37fb019261cb" rel="noopener"> Kali VM </a>和<a class="ae lx" href="https://github.com/digininja/DVWA" rel="noopener ugc nofollow" target="_blank"> DVWA </a>机器来弄脏我们的手。</p><p id="6aae" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果你不知道如何运行<a class="ae lx" href="https://github.com/digininja/DVWA" rel="noopener ugc nofollow" target="_blank"> DVWA </a>，可以看看本文中<a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/what-is-command-injection-and-how-to-exploit-it-stackzero-ac7643bc492">的专用段落。</a></p><p id="86b7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我已经展示了如何将漏洞转化为任意文件上传和反向外壳，因此在本文中，我将只关注如何绕过过滤器。<br/>这里的目标是显示<em class="md"> /etc/passwd </em>文件的内容。</p><h1 id="cf96" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">命令注入的备忘单</h1><p id="b4c2" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">通常，易受操作系统命令注入攻击的应用程序会接受未经净化或设计不良的过滤器的输入。为了在<a class="ae lx" href="https://github.com/digininja/DVWA" rel="noopener ugc nofollow" target="_blank"> DVWA </a>中运行我们的漏洞，我们想要做的是了解如何在我们的Linux终端中执行更多的命令。</p><p id="4b26" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果你有任何疑问，我邀请你在继续之前阅读这篇文章。</p><p id="b857" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">因此，让我们看看对我们的“链接”目标有用的操作符的最小列表(操作符和命令之间的空格是可选的):</p><ul class=""><li id="8bf2" class="me mf it lb b lc ly lg lz lk mg lo mh ls mi lw mj mk ml mm bi translated"><strong class="lb iu">“与”运算符(&amp; ): </strong>在后台运行一个命令，作为副作用，它声明第一个命令(后台的那个)的结束和第二个命令的开始。</li><li id="435b" class="me mf it lb b lc mn lg mo lk mp lo mq ls mr lw mj mk ml mm bi translated"><strong class="lb iu">分号运算符(；):</strong>分隔两个命令，并允许它们像在两行上一样运行。</li><li id="ac17" class="me mf it lb b lc mn lg mo lk mp lo mq ls mr lw mj mk ml mm bi translated"><strong class="lb iu">管道操作符(|): </strong>第一个命令的输出成为第二个命令的输入。</li><li id="c82d" class="me mf it lb b lc mn lg mo lk mp lo mq ls mr lw mj mk ml mm bi translated"><strong class="lb iu"> OR运算符(||): </strong>仅当第一个命令失败时才执行第二个命令。</li><li id="d2c0" class="me mf it lb b lc mn lg mo lk mp lo mq ls mr lw mj mk ml mm bi translated"><strong class="lb iu"> AND运算符(&amp; &amp; ): </strong>只有在第一条命令成功后<strong class="lb iu">才会执行第二条命令。</strong></li><li id="b572" class="me mf it lb b lc mn lg mo lk mp lo mq ls mr lw mj mk ml mm bi translated"><strong class="lb iu">反斜线运算符(`):</strong>反斜线内的每个命令都在外部命令之前进行计算。</li></ul><h1 id="14db" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤1:命令注入DVWA低安全性</h1><p id="88e9" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">很容易想象，我们应该首先使用凭证登录到机器:</p><ul class=""><li id="b693" class="me mf it lb b lc ly lg lz lk mg lo mh ls mi lw mj mk ml mm bi translated">用户名:<strong class="lb iu">管理员</strong></li><li id="3b52" class="me mf it lb b lc mn lg mo lk mp lo mq ls mr lw mj mk ml mm bi translated">密码:<strong class="lb iu">密码</strong></li></ul><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/96b523ea844bda51e12d065abe16edc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CflKR4BWUN2dWeaGdL6cqQ.jpeg"/></div></div></figure><p id="6802" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">成功登录后，我们可以在左侧栏中将安全级别设置为“低”。</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/e8d5a1ca606806ccf2fe70a0aeb5dbc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4TU2Kz-8VX06-BzV5ENdQ.jpeg"/></div></div></figure><p id="889c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果你看过我的<a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/what-is-command-injection-and-how-to-exploit-it-stackzero-ac7643bc492">之前的教程</a>，这没什么新鲜的，我们可以从实际攻击开始了。</p><p id="ee65" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">让我们点击左侧边栏菜单中的菜单项“命令注入”。</p><p id="05ef" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我们在登陆的页面中有一个输入字段，如果我们尝试提交一个随机的域，比如“google.com ”,输出与ping命令的输出完全相同。</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/c9a82f133adc611a7147ccfb56dbe803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*RuoHFA7tmMnUgBfZuq4waA.jpeg"/></div></figure><p id="eb55" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">所以我们可以猜测服务器执行类似这样的东西:</p><pre class="mt mu mv mw gt my mz na nb aw nc bi"><span id="7bce" class="nd kc it mz b gy ne nf l ng nh">ping &lt;INPUT&gt;</span></pre><p id="9dfd" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">如果没有适当的净化，它将允许我们操纵输入，然后连接许多命令，或者至少应该这样。</p><p id="6c05" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在我们做出假设后，我们应该交叉手指，然后尝试输入:</p><pre class="mt mu mv mw gt my mz na nb aw nc bi"><span id="56b9" class="nd kc it mz b gy ne nf l ng nh">google.com; cat /etc/passwd</span></pre><p id="e2d9" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我们很幸运，输出正是我们从一个易受攻击的应用程序中所期望的:</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/3b88c11dd70816f11ccb515279ac699c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*xTKtAOA4fPLxtlw8XvxNfg.jpeg"/></div></figure><p id="baa6" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">做得好，现在将安全级别设置为“中”，然后跳到第二步。</p><h1 id="4cbd" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤2:命令注入DVWA中等安全性</h1><p id="6a16" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在设置了中等安全级别后，我们之前的漏洞似乎不太管用了，但是我们上面有我们的小抄！<br/>我们可以通过枚举链接操作符来尝试，希望得到一个糟糕的输入检查！</p><p id="cbd4" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">因此，让我们像这样尝试使用&amp;运算符:</p><pre class="mt mu mv mw gt my mz na nb aw nc bi"><span id="a182" class="nd kc it mz b gy ne nf l ng nh">google.com&amp; cat /etc/passwd</span></pre><p id="db0c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">提交后得到的输出是:</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/93bc5150fe85b5f1d7e625e576540704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*JtKdCKwAs0CQKac04ISR2Q.jpeg"/></div></figure><p id="5ace" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">所以我们的命令注入攻击设法通过了中等安全的DVWA的过滤器！</p><h1 id="072b" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤3:命令注入DVWA高安全性</h1><p id="f70d" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">最后，我们在具有高安全级别的<a class="ae lx" href="https://github.com/digininja/DVWA" rel="noopener ugc nofollow" target="_blank"> DVWA </a>，并且我们准备好执行我们的命令注入攻击！</p><p id="638b" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我可以预见，这个级别的目的是向我们展示，即使是稍微复杂一点的过滤器也可能包含某种类型的打印错误。</p><p id="723f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">通常，我们看不到后端代码，解决方案是通过列举所有的可能性。<br/>在这种情况下，我们的目标是理解这个过程，而不是在猜测过程中浪费时间，所以我们会稍微作弊。</p><p id="66af" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我将通过使用右下角的按钮“查看源代码”来查看代码，特别要注意下面列出的过滤器。</p><pre class="mt mu mv mw gt my mz na nb aw nc bi"><span id="00d2" class="nd kc it mz b gy ne nf l ng nh">// Set blacklist <br/>$substitutions = array( <br/>    '&amp;' =&gt; '', <br/>    ';' =&gt; '', <br/>    '| ' =&gt; '', <br/>    '-' =&gt; '', <br/>    '$' =&gt; '', <br/>    '(' =&gt; '', <br/>    ')' =&gt; '', <br/>    '`' =&gt; '', <br/>    '||' =&gt; '', <br/>); <br/>// Remove any of the charactars in the array (blacklist). <br/>$target = str_replace( array_keys( $substitutions ), $substitutions, $target );</span></pre><p id="f013" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">管道运算符后面跟一个空格，我们知道它是可选的。<br/>因此，过滤器不会在没有空格的情况下替换管道运算符，例如，通过以如下方式链接命令:</p><pre class="mt mu mv mw gt my mz na nb aw nc bi"><span id="217b" class="nd kc it mz b gy ne nf l ng nh">google.com|cat /etc/passwd</span></pre><p id="9720" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">所以试试我们的利用方式吧！我们击中目标了！</p><figure class="mt mu mv mw gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/f9a588c9e71d8a8131d20c10b3ef35d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*yB8uI5MKn5Ar9u64XQ6RnQ.jpeg"/></div></figure><p id="8963" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">最后，这一关已经完成，你正在更好地理解的路上，也许会从一些bug奖励计划中获得奖励。</p><h1 id="a5a8" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h1><p id="11ac" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这个演练只是加强了我们在<a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/what-is-command-injection-and-how-to-exploit-it-stackzero-ac7643bc492">上一篇文章</a>中学到的概念，在那篇文章中我解释了这样的漏洞是如何的危险。</p><p id="c8c8" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">Web应用程序安全性非常有趣，也非常有价值，所以如果你喜欢这篇文章，我建议你读一下什么是<a class="ae lx" href="https://medium.com/@stackzero/owasp-top-10-breaches-of-2021-what-you-need-to-know-stackzero-63fa0d262bb5" rel="noopener"> OWASP十大</a>。</p><p id="1f66" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我很荣幸能与您一起踏上学习web应用程序安全性的旅程。我希望您能欣赏我的文章的实用方法，如果答案是肯定的，也请看看:</p><ul class=""><li id="5806" class="me mf it lb b lc ly lg lz lk mg lo mh ls mi lw mj mk ml mm bi translated"><a class="ae lx" href="https://medium.com/codex/the-terrifying-world-of-cross-site-scripting-xss-part-1-stackzero-54be9cdc011a" rel="noopener"> XSS </a></li><li id="f06c" class="me mf it lb b lc mn lg mo lk mp lo mq ls mr lw mj mk ml mm bi translated"><a class="ae lx" href="https://medium.com/codex/sql-injection-what-you-need-to-know-stackzero-abc80bc1ea5e" rel="noopener"> SQL注入</a></li></ul><p id="4124" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">请不要忘记关注我的工作，我希望很快见到你！新文章来了！</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="33ff" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><em class="md">原载于2022年9月12日https://www.stackzero.net</em><a class="ae lx" href="https://www.stackzero.net/command-injection-dvwa/" rel="noopener ugc nofollow" target="_blank"><em class="md"/></a><em class="md">。</em></p><h2 id="bb4f" class="nd kc it bd kd ns nt dn kh nu nv dp kl lk nw nx kp lo ny nz kt ls oa ob kx oc bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lx" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>