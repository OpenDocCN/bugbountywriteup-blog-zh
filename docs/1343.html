<html>
<head>
<title>OAuth 2.0 Hacking Simplified — Part 2 — Vulnerabilities and Mitigation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OAuth 2.0黑客攻击简化版—第2部分—漏洞和缓解</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/oauth-2-0-hacking-simplified-part-2-vulnerabilities-and-mitigation-d01dd6d5fa2c?source=collection_archive---------0-----------------------#2021-05-27">https://infosecwriteups.com/oauth-2-0-hacking-simplified-part-2-vulnerabilities-and-mitigation-d01dd6d5fa2c?source=collection_archive---------0-----------------------#2021-05-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e440931b14231acb190b5e811de1155c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mf3C42gsOF6rh_roJLekbQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">OAuth2</figcaption></figure><p id="4d12" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">大家好，</p><p id="981d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我带着OAuth 2.0黑客简化系列的另一部分回来了。我们已经在<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/oauth-2-0-hacking-simplified-part-1-understanding-basics-ad323cb4a05c">的上一篇文章</a>中讲述了基础知识。我强烈推荐你看完<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/oauth-2-0-hacking-simplified-part-1-understanding-basics-ad323cb4a05c">第一部分</a>。在这篇博客中，我们将深入探讨如何<strong class="ke ir">利用</strong>和<strong class="ke ir">减轻</strong>常见的OAuth漏洞。</p><h1 id="6f72" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">OAuth2漏洞</h1><p id="005b" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">OAuth漏洞的出现是因为OAuth规范在设计上相对模糊和灵活。在OAuth中，绝大多数实现都是完全可选的。此外，OAuth没有太多内置的安全特性。大多数安全配置和额外的安全实现必须由开发人员来完成。</p><p id="279c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> <em class="me">注</em> </strong> <em class="me">:所有演示均来自</em><a class="ae la" href="https://portswigger.net/web-security/oauth" rel="noopener ugc nofollow" target="_blank"><em class="me">Portswigger Academy</em></a><em class="me">。</em></p><p id="76cf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">OAuth的客户端应用程序实现以及OAuth服务本身的配置都可能出现漏洞。在这两种情况下最常见的漏洞是-</p><h2 id="eb0d" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">漏洞:</h2><ul class=""><li id="d23e" class="mr ms iq ke b kf lz kj ma kn mt kr mu kv mv kz mw mx my mz bi translated">隐式授权类型的不正确实现</li><li id="3801" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">有缺陷的CSRF保护</li><li id="b192" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">泄露授权码和访问令牌</li><li id="17b4" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">有缺陷的范围验证</li><li id="50f6" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">未经验证的用户注册</li><li id="6b03" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">主机头注入</li><li id="964c" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">可重用的OAuth访问令牌</li></ul><p id="9c63" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们详细谈谈每一个-</p><ol class=""><li id="4fa8" class="mr ms iq ke b kf kg kj kk kn nf kr ng kv nh kz ni mx my mz bi translated"><strong class="ke ir">隐式授权类型的不当实现</strong></li></ol><p id="a348" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦OAuth提供者向客户端应用程序发送了access_token，应用程序就必须维护一个会话。为了实现这一点，客户端应用程序通常会在一个<code class="fe nj nk nl nm b">POST</code>请求中向服务器提交这些数据，然后为用户分配一个会话cookie，类似于传统的基于密码的登录，有效地让用户登录。然而，服务器没有任何秘密或密码来与客户端应用程序提交的数据进行比较，这意味着它是隐式受信任的。</p><p id="5511" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这种情况下，攻击者只需更改发送到服务器的参数，就可以在访问令牌有效时冒充任何用户。请参见下面的快照以了解-</p><p id="4d7c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">带令牌的正常有效<em class="me"> POST </em>请求，</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/a1b370cbfab4b9f252caf39e1da35cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-DMk14PZjBvj9-mtpwPGJA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">受害用户的邮件</figcaption></figure><p id="187e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">攻击者更改邮件以访问受害者的帐户，</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/9a5e2ad296589233ea59a657bad4181e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aSiTuvc55BhCt6O7Ft3UXw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">攻击者用户的邮件</figcaption></figure><p id="7edf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> 2。有缺陷的CSRF保护</strong></p><p id="53b4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您检查了上面的定义，您就已经知道<code class="fe nj nk nl nm b">state</code>参数是作为客户端应用程序的一种CSRF令牌的形式。如果授权请求没有发送一个<code class="fe nj nk nl nm b">state</code>参数，从攻击者的角度来看这是非常有趣的。这意味着他们可以在欺骗用户的浏览器完成OAuth流之前，自己启动OAuth流。</p><p id="490d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们举个例子。作为用户，我们可以使用社交媒体OAuth登录网站。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/3631b8f8659ab8b83142ee2e7dcd9a0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T0Ejo0reABHR1KUL6zJ5hw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">登录页面</figcaption></figure><p id="4ff1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们正常登录，</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/a4dc754609faaf4ebac2c7551ed54e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*vdPZG9h7bIvV-Eo3kg99vg.png"/></div></figure><p id="8600" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">观察我们作为普通用户登录。让我们通过点击“附加社交档案”来检查OAuth请求</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/760c6dd134e1501ce01eebc0b86e6d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4JN-3vxBE8asMv45TGJHw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">缺少状态参数</figcaption></figure><p id="bcc0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">请求中缺少<code class="fe nj nk nl nm b">state</code>参数，这意味着我们可以使用分配给我们的代码将我们的社交媒体句柄附加到受害者的帐户。让我们先通过转发请求来获取代码-</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/203c59ed45127c26ebf5dc846df2dede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*we50Mk3_7Ek5Go1Izh--3w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">oauth代码</figcaption></figure><p id="f05c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">复制url并创建一个iframe来将有效负载传递给受害者，确保在复制有效代码后丢弃请求。</p><pre class="no np nq nr gt nx nm ny nz aw oa bi"><span id="d067" class="mf lc iq nm b gy ob oc l od oe">&lt;iframe src=<a class="ae la" href="https://ac601f3d1fc2aa2580713e6f004f008c.web-security-academy.net/oauth-linking?code=mXgz2pFQWieUXb8ybK14P97gXZVk6_TVAT2Bitb9MaU" rel="noopener ugc nofollow" target="_blank">https://ac601f3d1fc2aa2580713e6f004f008c.web-security-academy.net/oauth-linking?code=mXgz2pFQWieUXb8ybK14P97gXZVk6_TVAT2Bitb9MaU</a>&gt;&lt;/iframe&gt;</span></pre><p id="89c2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">假设您将该脚本发送到管理员权限帐户，并且他们执行了该脚本，作为攻击者，您可以登录到他们的帐户，从而获得所有管理员功能的访问权限。我们可以实现账户接管！！</p><p id="cd1e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们通过使用社交媒体帐户登录来验证这一点，您可以看到角色现在更改为Admin</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/b3c2eab53a2efe16dfe72e09d0266446.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*vuf7aaYKJWGG94RZ6PegKw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">管理员权限</figcaption></figure><h2 id="f598" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">3.在redirect_uri参数处打开重定向</h2><p id="9883" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">当OAuth提供者没有正确检查<em class="me"> redirect_uri </em>时，攻击者就有可能窃取与其他用户账户相关的授权码。代码或访问令牌可被重定向到攻击者控制的网站，并可用于进一步完成该流程。</p><p id="de28" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们举个例子。启动OAuth流，并将redirect_uri值更改为攻击者控制网站。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/38dc5673a028d8776b7ad46cf710db38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dSNzeauqoHqkzyc-AtCeig.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">已更改redirect_uri</figcaption></figure><p id="64b5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">观察反应</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/2e5cd4e7ceffaf38be6a98a1be95a1c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6x52Sh2fsHyJrQerYUe75Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">反应</figcaption></figure><p id="c0f7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">代码已被重定向到攻击者控制网站(此处为test.com)。现在，攻击者可以使用代码完成OAuth流，并接管受害者的帐户。</p><p id="a1eb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在一般情况下，客户端应用程序在向OAuth服务注册时会提供一个真正回调URIs的白名单，以减轻这种攻击。但是仍然有不同的方法可以绕过这种验证。</p><ul class=""><li id="47e0" class="mr ms iq ke b kf kg kj kk kn nf kr ng kv nh kz mw mx my mz bi translated">攻击者可以尝试在redirect_uri参数中使用@ ( <code class="fe nj nk nl nm b">https://expected-host@evil-host</code>)和#( <code class="fe nj nk nl nm b">https://evil-host#expected-host</code>)字符。</li><li id="b40f" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">攻击者可能会利用OAuth服务的不同组件对URI的解析之间的差异。例如，你可以尝试诸如- <code class="fe nj nk nl nm b"> https://default-host.com &amp;@foo.evil-user.net#@bar.evil-user.net/</code>的技巧</li><li id="f41f" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">攻击者可以通过提交重复的<code class="fe nj nk nl nm b">redirect_uri</code>参数来尝试参数污染漏洞，如下所示- <code class="fe nj nk nl nm b"> <a class="ae la" href="https://oauth-authorization-server.com/?client_id=123&amp;redirect_uri=client-app.com/callback&amp;redirect_uri=evil-user.net" rel="noopener ugc nofollow" target="_blank">https://oauth-authorization-server.com/?client_id=123&amp;redirect_uri=client-app.com/callback&amp;redirect_uri=evil-user.net</a></code></li><li id="06c9" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">攻击者可以尝试本地主机URIs，因为他们经常在开发过程中使用。这可以让你通过注册一个域名来绕过验证，比如<code class="fe nj nk nl nm b">localhost.evil-user.net</code></li></ul><h2 id="5317" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">4.有缺陷的范围验证</h2><p id="c1c2" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">每次当用户登录到授权服务器时，他们都会看到客户端应用程序想要访问的数据列表(如电子邮件、个人资料图片)。</p><p id="d5f9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/oauth-2-0-hacking-simplified-part-1-understanding-basics-ad323cb4a05c"> <em class="me">授权码授权</em> </a>类型，通过安全的服务器到服务器通信请求和发送用户数据。对于攻击者来说，直接操纵是不可能。然而，攻击者可以向OAuth服务注册他们自己的客户端应用程序。</p><p id="3baf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/oauth-2-0-hacking-simplified-part-1-understanding-basics-ad323cb4a05c"> <em class="me">隐式授权</em> </a>类型，访问令牌通过浏览器发送。攻击者可以窃取令牌并直接使用它们，方法是向OAuth端点发送一个普通的基于浏览器的请求，在这个过程中手动添加一个新的范围参数。</p><h2 id="d878" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">5.未经验证的用户注册</h2><p id="901a" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">一些提供OAuth服务的网站允许用户注册帐户，而无需验证他们的所有详细信息，在某些情况下包括他们的电子邮件地址。</p><p id="b078" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">攻击者可以通过使用与目标用户相同的详细信息(如已知的电子邮件地址)向OAuth提供者注册帐户，并通过OAuth提供者的欺诈帐户以受害者的身份登录，来利用这一点。</p><h2 id="a1bd" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">6.主机头注入</h2><p id="25c7" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">如果服务器未验证主机，则有可能通过主机报头注入将令牌重定向到恶意主机。</p><pre class="no np nq nr gt nx nm ny nz aw oa bi"><span id="0ab0" class="mf lc iq nm b gy ob oc l od oe">GET /api/twitter/login?csrf=token HTTP/1.1 <br/>Host: attacker.com/victim.org<br/>Referer: <a class="ae la" href="https://www.victim.org/" rel="noopener ugc nofollow" target="_blank">https://www.victim.org/</a><br/>Cookie:cookie</span></pre><p id="34b4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于我们更改了主机头，它会将Oauth授权链接重定向到攻击者的主机，并泄漏所颁发的令牌。</p><h2 id="46cb" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">7.可重用的OAuth访问令牌</h2><p id="cd97" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">类似于传统的会话管理功能，一旦用户从应用程序注销，令牌应该从后端过期。如果不是这种情况，可以认为这是不良的安全做法，可以利用。</p><h2 id="8b0b" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">8.客户机密泄露</h2><p id="4d03" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">获取client_secret可能允许恶意应用程序模拟您的应用程序，以及它被授予的任何授权。这可能包括重放访问和刷新令牌，以便在未经用户许可的情况下访问用户的帐户。</p><p id="0c55" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">攻击者可以利用泄露的client_secret来访问您的应用程序已被授权访问的用户数据。在2脚或3脚OAuth认证流中使用的共享秘密可能允许攻击者启动SSO流，并解开加密的OAuth令牌。</p><h1 id="0264" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">高级开发</h1><ul class=""><li id="3424" class="mr ms iq ke b kf lz kj ma kn mt kr mu kv mv kz mw mx my mz bi translated">这里有一个很棒的twitter帖子和思维导图，是由<a class="ae la" href="https://twitter.com/hackerscrolls" rel="noopener ugc nofollow" target="_blank"> @hackerscrolls </a>制作的，用来测试OAuth 2.0</li></ul><p id="6e4d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://twitter.com/hackerscrolls/status/1269266750467649538" rel="noopener ugc nofollow" target="_blank">https://Twitter . com/hacker scrolls/status/1269266750467649538</a></p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/b25455e0b7d8219cdad572e8c2c2f533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyXfSl3DiXvh-xmGu6A15w.jpeg"/></div></div></figure><ul class=""><li id="a6af" class="mr ms iq ke b kf kg kj kk kn nf kr ng kv nh kz mw mx my mz bi translated">零日登录苹果—</li></ul><p id="0582" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://bhavukjain.com/blog/2020/05/30/zeroday-signin-with-apple/" rel="noopener ugc nofollow" target="_blank">https://bhavukjain . com/blog/2020/05/30/zero day-sign-in-with-apple/</a></p><h1 id="d76c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">减轻</h1><p id="daf3" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">OAuth的一个关键问题是普遍缺乏内置的安全特性。安全性几乎完全依赖于开发人员使用配置选项的正确组合，并在上面实现他们自己的附加安全措施，例如健壮的输入验证。</p><p id="7b66" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">需要注意的是，客户端应用程序和OAuth服务本身都可能出现漏洞。</p><h2 id="4e98" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">对于OAuth服务提供商</h2><ul class=""><li id="5ff2" class="mr ms iq ke b kf lz kj ma kn mt kr mu kv mv kz mw mx my mz bi translated">验证:只允许完全和精确的匹配，而不使用模式匹配。这可以防止攻击者访问白名单域中的其他页面。</li><li id="c055" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">Enforce <code class="fe nj nk nl nm b">state</code>参数:不可访问的随机值可以帮助保护用户免受类似CSRF的攻击</li><li id="9b0c" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><code class="fe nj nk nl nm b">access_token</code>和<code class="fe nj nk nl nm b">client_id</code>验证:验证访问令牌是发给发出请求的同一个<code class="fe nj nk nl nm b">client_id</code>的。</li><li id="1e76" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><code class="fe nj nk nl nm b">scope</code>验证:检查被请求的作用域，确保它与令牌最初被授予的作用域相匹配。</li></ul><h2 id="f9c0" class="mf lc iq bd ld mg mh dn lh mi mj dp ll kn mk ml lp kr mm mn lt kv mo mp lx mq bi translated">对于OAuth客户端应用程序</h2><ul class=""><li id="5e30" class="mr ms iq ke b kf lz kj ma kn mt kr mu kv mv kz mw mx my mz bi translated"><code class="fe nj nk nl nm b">state</code>参数:即使不强制也要使用。</li><li id="96e2" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><code class="fe nj nk nl nm b">client_secret</code>备选方案:在开发移动或本地桌面OAuth客户端应用程序的情况下，使用<code class="fe nj nk nl nm b">PKCE</code> ( <code class="fe nj nk nl nm b">RFC7638</code>)机制来提供额外的保护，防止访问代码拦截或泄漏。</li><li id="ef25" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">小心授权代码:当加载外部图像、脚本或CSS内容时，它们可能会通过<code class="fe nj nk nl nm b">Referer</code>头泄露。同样重要的是不要将它们包含在动态生成的JavaScript文件中，因为它们可能通过<code class="fe nj nk nl nm b">&lt;script&gt;</code>标签从外部域执行。</li><li id="7799" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated">不仅向<code class="fe nj nk nl nm b">/authorization</code>端点发送一个<code class="fe nj nk nl nm b">redirect_uri</code>参数，还向<code class="fe nj nk nl nm b">/token</code>端点发送一个参数。</li></ul><p id="f31f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">希望你学到了新的东西，喜欢我的博客。保持安全，保持好奇。</p><p id="4065" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">感谢阅读！</p><p id="f6f0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">~Nishith K</p><p id="db11" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">与我联系:</p><ul class=""><li id="4f64" class="mr ms iq ke b kf kg kj kk kn nf kr ng kv nh kz mw mx my mz bi translated"><strong class="ke ir">推特</strong></li></ul><div class="oi oj gp gr ok ol"><a href="https://twitter.com/busk3r" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd ir gy z fp oq fr fs or fu fw ip bi translated">JavaScript不可用。</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">编辑描述</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">twitter.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz jw ol"/></div></div></a></div><ul class=""><li id="7b1e" class="mr ms iq ke b kf kg kj kk kn nf kr ng kv nh kz mw mx my mz bi translated"><strong class="ke ir">领英</strong></li></ul><div class="oi oj gp gr ok ol"><a href="https://in.linkedin.com/in/nishithkhadadiya" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd ir gy z fp oq fr fs or fu fw ip bi translated">Nishith K安全分析师- Net Square Solutions Pvt. Ltd</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">查看世界上最大的职业社区LinkedIn上Nishith K的个人资料。Nishith有3个工作列在他们的…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">in.linkedin.com</p></div></div></div></a></div><h1 id="ea50" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">参考</h1><ul class=""><li id="4c96" class="mr ms iq ke b kf lz kj ma kn mt kr mu kv mv kz mw mx my mz bi translated"><a class="ae la" href="https://portswigger.net/web-security/oauth" rel="noopener ugc nofollow" target="_blank">https://portswigger.net/web-security/oauth</a></li><li id="3958" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><a class="ae la" href="https://apkash8.medium.com/oauth-and-security-7fddce2e1dc5" rel="noopener">https://apkash8.medium.com/oauth-and-security-7fddce2e1dc5</a></li><li id="832b" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><a class="ae la" href="https://twitter.com/hackerscrolls/status/1269266750467649538?s=20" rel="noopener ugc nofollow" target="_blank">https://Twitter . com/hacker scrolls/status/1269266750467649538？s=20 </a></li><li id="9ec3" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><a class="ae la" href="https://github.com/gr455/ctf-writeups/blob/master/hacktivity20/notes_surfer.md" rel="noopener ugc nofollow" target="_blank">https://github . com/gr 455/CTF-writeups/blob/master/hack activity 20/notes _ surfer . MD</a></li><li id="c3ba" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><a class="ae la" href="https://www.arneswinnen.net/2017/06/authentication-bypass-on-ubers-sso-via-subdomain-takeover/" rel="noopener ugc nofollow" target="_blank">https://www . arnes winnen . net/2017/06/authentic ation-bypass-on-ubers-SSO-via-subdomain-take over/</a></li><li id="bf90" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><a class="ae la" href="https://hackerone.com/reports/215381" rel="noopener ugc nofollow" target="_blank">https://hackerone.com/reports/215381</a></li><li id="96b8" class="mr ms iq ke b kf na kj nb kn nc kr nd kv ne kz mw mx my mz bi translated"><a class="ae la" href="https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/" rel="noopener ugc nofollow" target="_blank">https://dhavalkapil.com/blogs/Attacking-the-OAuth-Protocol/</a></li></ul></div></div>    
</body>
</html>