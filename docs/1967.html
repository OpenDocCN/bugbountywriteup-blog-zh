<html>
<head>
<title>Hacking GraphQL — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客图QL —第1部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hacking-graphql-part-1-61d7a31b30c3?source=collection_archive---------1-----------------------#2022-03-25">https://infosecwriteups.com/hacking-graphql-part-1-61d7a31b30c3?source=collection_archive---------1-----------------------#2022-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3308" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在黑客攻击GraphQL系列的第1部分中，我们将讨论GraphQL的基础知识以及攻击者如何利用这项服务。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/5cdf41455b13e2dfe48206c815ff9726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hMkHM5yuWcp1JcqKed-EeQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">黑客图QL —第1部分</figcaption></figure><h1 id="3165" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">什么是GraphQL？</strong></h1><p id="90da" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">简单来说，GraphQL是一种针对API端点的查询语言。它与API端点交互，并从后端获取数据。它是REST和SOAP等API标准的替代品。它可以做标准REST API端点可以做的大部分事情，有时甚至以一种有效和可控的方式做得更多。</p><p id="196d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GraphQL解决了开发人员在使用REST API时面临的许多问题，比如获取比所需更多的数据，或者每个调用都需要一个新的端点。</p><p id="a680" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">摘自官方文档:</strong></p><blockquote class="me mf mg"><p id="b1ac" class="jn jo mh jp b jq jr js jt ju jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj kk ij bi translated">GraphQL是API的查询语言，也是使用您为数据定义的类型系统执行查询的服务器端运行时。GraphQL不依赖于任何特定的数据库或存储引擎，而是由您现有的代码和数据提供支持。</p></blockquote><p id="cd1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">样本GraphQL查询:</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/2211deaf012a3d9443d537453c1b5952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gL3a-PhUIwzKP6CBeJc5Tg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><strong class="bd ld"> GraphQL查询</strong></figcaption></figure><h1 id="ae50" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">请求类型:</strong></h1><p id="fdab" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">GraphQL中有两种主要的请求类型——查询和变异。</p><p id="bcb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">查询:</strong>查询用于读取数据。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="3603" class="mr lc iq mn b gy ms mt l mu mv">{<br/>  "data":{<br/>    "todos":[<br/>      {<br/>        "title": "Learn GraphQL"<br/>       },<br/>      {<br/>        "title": "Learn about queries"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><p id="d575" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查询和响应具有相似的格式，表明您将在GraphQL中得到您所要求的。例如，在上面的代码块中，我们查询了标题。这意味着我们将在随后的响应中获得标题。</p><p id="fbe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">突变:</strong>突变用于插入、更新或删除数据。</p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="aef8" class="mr lc iq mn b gy ms mt l mu mv">mutation{<br/>  insert_todos(objects:[{title:"Learn GraphQL"}]){<br/>    Returning{<br/>      Id<br/>      Created_at<br/>    }<br/>  }<br/>}</span></pre><p id="f6d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，上面的截图描述了一个添加新的待办事项的变化。如果成功，它将返回新插入的待办事项的id和创建日期。</p><p id="e866" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">一些常见的GraphQL端点:</strong></p><p id="339f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很难在一个GraphQL实例中列出所有的端点，但许多实现都使用了类似“Appollo”的框架。以下部分列出了GraphQL实现中使用的常见端点:</p><ul class=""><li id="1acb" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nb nc nd ne bi translated">/v1/*</li><li id="8fb2" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">/v2/*</li><li id="c8ba" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">/beta/*</li><li id="ac3b" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">/图表</li><li id="30fa" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">/graphql</li><li id="91dd" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">/graph QL/控制台</li><li id="48e8" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">/graphql.php</li><li id="b271" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">/graphiql</li><li id="c147" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">/graphic QL . PHP</li></ul><p id="2346" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> GraphQL模式:</strong></p><p id="75c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GraphQL模式是任何GraphQL服务器实现的核心。它描述了连接到GraphQL实例的客户端可用的功能。这就像一个蓝图，客户可以通过查询来了解它。</p><p id="e600" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">自省:</strong></p><p id="d3e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了获得模式，我们可以向GraphQL服务器端点发送一个HTTP请求，请求GraphQL模式。这种类型的HTTP请求称为GraphQL自省查询。</p><p id="7645" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">自省是查询模式中哪些资源可用的主要能力。通过自省，我们可以看到它支持的查询、类型、字段和指令。不幸的是，自省查询在默认情况下是打开的，因此在渗透测试中值得一试。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/7c4076cb3c6df01c1ca8e2a1f26f2dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kgDsQuOlmuAoJzUdccLETg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><strong class="bd ld">自省查询</strong></figcaption></figure><p id="9fff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如何发送自检查询？</strong></p><p id="7084" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">自省查询为我们提供了有关GraphQL支持的查询、类型、字段和指令的详细信息，默认情况下，我们可以在每个GraphQL实例上使用自省查询。让我们看一个正在运行的自省查询。</p><p id="5d0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤1: </strong>使用Burp套件拦截HTTP请求:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/e5b32c669c4b38520393dc7d4890b319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12lIHvtUsNTsH5dqd4Duzg.png"/></div></div></figure><p id="6972" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步:</strong>发送HTTP请求到打嗝中继器:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/9d608880b6cc25c7a885eb539c7f867b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fYhbAPYIK_s0IEWjhIspw.png"/></div></div></figure><p id="a153" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤3: </strong>用一个通用的自省查询替换POST主体，以获取整个后端模式。为此，我们使用了Burp Suite的“GraphQL Raider”扩展。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/e7c18df3b16508a2c88d331351ec29d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9n4xnoY8ZknPCkxR7Yg4Ng.png"/></div></div></figure><p id="b033" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤4: </strong>捕获模式以收集敏感的API调用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/60080a069b53606a14f75233c00165f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dw-ulN-2dUGOst-AyExcIw.png"/></div></div></figure><p id="9d5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">样品自检查询:</strong></p><pre class="km kn ko kp gt mm mn mo mp aw mq bi"><span id="7ded" class="mr lc iq mn b gy ms mt l mu mv">{"query":"\n query IntrospectionQuery {\r\n __schema {\r\n queryType { name }\r\n mutationType { name }\r\n subscriptionType { name }\r\n types {\r\n ...FullType\r\n }\r\n directives {\r\n name\r\n description\r\n locations\r\n args {\r\n ...InputValue\r\n }\r\n }\r\n }\r\n }\r\n\r\n fragment FullType on __Type {\r\n kind\r\n name\r\n description\r\n fields(includeDeprecated: true) {\r\n name\r\n description\r\n args {\r\n ...InputValue\r\n }\r\n type {\r\n ...TypeRef\r\n }\r\n isDeprecated\r\n deprecationReason\r\n }\r\n inputFields {\r\n ...InputValue\r\n }\r\n interfaces {\r\n ...TypeRef\r\n }\r\n enumValues(includeDeprecated: true) {\r\n name\r\n description\r\n isDeprecated\r\n deprecationReason\r\n }\r\n possibleTypes {\r\n ...TypeRef\r\n }\r\n }\r\n\r\n fragment InputValue on __InputValue {\r\n name\r\n description\r\n type { ...TypeRef }\r\n defaultValue\r\n }\r\n\r\n fragment TypeRef on __Type {\r\n kind\r\n name\r\n ofType {\r\n kind\r\n name\r\n ofType {\r\n kind\r\n name\r\n ofType {\r\n kind\r\n name\r\n ofType {\r\n kind\r\n name\r\n ofType {\r\n kind\r\n name\r\n ofType {\r\n kind\r\n name\r\n ofType {\r\n kind\r\n name\r\n }\r\n }\r\n }\r\n }\r\n }\r\n }\r\n }\r\n }\r\n ","variables":null}</span></pre><p id="3490" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">反响可能相当大，难以理解。理解这种反应的最好方法是想象它。这可以通过使用“旅行者”工具来完成。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nm"><img src="../Images/6d082379ab3587a532fed194ffd3eb9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ne83oxuwScxI158AC2kcMw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">旅行者工具</figcaption></figure><p id="4931" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了获得与上面相同的结果，在目标上执行自省查询，并将响应粘贴到‘Voyager’工具中。使用这种方法，攻击者可以轻松识别敏感的API调用并利用它们。</p><p id="bf18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将在<a class="ae nn" href="https://redfoxsec.com/blog/hacking-graphql-part-2/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">黑客图QL —第二部分</strong> </a>中探索更多的攻击媒介。</p><p id="4f0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保持安全，保持健康，负责任地黑客。</p><p id="4925" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">连线我们:</strong> <a class="ae nn" href="https://redfoxsec.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">网站</strong> </a> <strong class="jp ir">，</strong><a class="ae nn" href="https://www.linkedin.com/company/redfoxsec/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">LinkedIn</strong></a><strong class="jp ir">，</strong><a class="ae nn" href="https://twitter.com/redfoxsec" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Twitter</strong></a><strong class="jp ir">，</strong> <a class="ae nn" href="https://www.facebook.com/redfoxsec/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">脸书</strong> </a> <strong class="jp ir">。</strong></p><p id="e17d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【参考文献:<br/><a class="ae nn" href="https://graphql.org/learn" rel="noopener ugc nofollow" target="_blank">https://graphql.org/learn</a><br/><a class="ae nn" href="https://portswigger.net/burp" rel="noopener ugc nofollow" target="_blank">https://portswigger.net/burp</a><br/><a class="ae nn" href="https://apis.guru/graphql-voyager/" rel="noopener ugc nofollow" target="_blank">https://apis.guru/graphql-voyager</a><br/><a class="ae nn" href="https://github.com/portswigger/graphql-raider" rel="noopener ugc nofollow" target="_blank">https://github.com/portswigger/graphql-raider</a></p><p id="31e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae nn" href="https://redfoxsec.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Redfox Security </strong> </a>是一个由专家安全顾问组成的多元化网络，拥有全球化思维和协作文化。通过结合数据驱动、基于研究和手动测试方法，我们自豪地提供强大的安全解决方案。</p><p id="4fb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“如果你想在网络安全领域出类拔萃，就报名参加我们全面的<a class="ae nn" href="https://training.redfoxsec.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">课程</strong> </a>，加入我们的成长和发展之旅。”</p></div></div>    
</body>
</html>