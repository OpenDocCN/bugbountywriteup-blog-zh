<html>
<head>
<title>Weak Cryptography Leads To Open Redirect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">弱加密导致开放重定向</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/weak-cryptography-leads-to-open-redirect-3fe052c12995?source=collection_archive---------1-----------------------#2020-05-30">https://infosecwriteups.com/weak-cryptography-leads-to-open-redirect-3fe052c12995?source=collection_archive---------1-----------------------#2020-05-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/68735f39729c580c944dd112113fb86e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwhVY6gFh3u3jaamVHbcSA.png"/></div></div></figure><p id="8909" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">大家好！</strong>，<br/>希望你一切安好。如果你是一个bug搜索的新手，你可以看看我的<a class="ae kw" href="https://medium.com/bugbountywriteup/introduction-to-bug-bounty-for-noobs-46654bd6e0e2" rel="noopener"> <strong class="ka ir">以前的</strong> </a>博客，今天我将分享我的一个有趣的发现，那就是开放重定向漏洞。</p><p id="edaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">什么是开放重定向？</strong> <br/>当应用程序以不安全的方式将用户可控制的数据合并到重定向的目标中时，就会出现开放重定向漏洞。攻击者可以在应用程序中构建一个URL，导致重定向到任意外部域。这种行为可被利用来促进针对应用程序用户的网络钓鱼攻击。使用可信的应用程序URL、以正确的域为目标并具有有效的SSL证书(如果使用了SSL)的能力增加了网络钓鱼攻击的可信度，因为许多用户即使验证了这些特征，也不会注意到随后重定向到不同的域。</p><p id="4281" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开始吧！，我们称我们的目标为target.com。我的第一步是始终做侦察，因为它在发现bug中起着重要的作用。通过<a class="ae kw" href="https://github.com/tomnomnom/waybackurls" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> waybackurls </strong> </a>工具，我得到了目标的许多端点，然后我通过grep命令过滤了带有“<strong class="ka ir"> redirect </strong>参数的URL，结果是这样的:</p><p id="01a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://login.target.com/login?redirect=aHR0cHM6Ly9hcHAudGFyZ2V0LmNvbS9kYXNoYm9hcmR8MzJ8YUhSMGNITTZMeTloY0hBdWRHRnlaMlYwTG1OdmJTOWtZWE5vWW05aGNtUT0%3D" rel="noopener ugc nofollow" target="_blank">https://login.target.com/login?redirect = ahr 0 CHM 6 ly 9 hchaudgfyz 2 vww 05 agntut 0% 3D</a></p><p id="da46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我复制了重定向值，并将“%3D”更改为“=”(URL-decoded)，所以现在它看起来像这样:</p><p id="aa1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ahr 0 CHM 6 ly 9 hchaudgfyz 2v 0 lmn VBS 9 kyxnoym 9 hcmr 8 mzj 8 yuhsmgnittzmetloy 0 hbdwrhrnlamlywtg 1 odmjtowtzwe 5 vww 05 agntut 0 =</p><p id="a6a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它看起来像Base64编码值，所以我直接解码它，得到这个:</p><p id="5a21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://app.target.com/dashboard|32|aHR0cHM6Ly9hcHAudGFyZ2V0LmNvbS9kYXNoYm9hcmQ=" rel="noopener ugc nofollow" target="_blank">https://app . target . com/dashboard | 32 | ahr 0 CHM 6 ly 9 hchaudgfyz 2v 0 lmn VBS 9 kyxnoym 9 hcmq =</a></p><p id="9111" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有几秒钟，我在想URL后面到底是什么？然后，我知道“32”是从“https”的第一个“h”到“dashboard”的最后一个“d”的URL的长度，在这之后，他们给了一个令牌，它只不过是URL的Base64编码值。</p><p id="4898" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">服务器后端流程:</strong> <br/>用户登录- &gt; Base64解码重定向值- &gt;通过URL长度检查完整性&amp;编码值- &gt;如果一切正常- &gt;重定向</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/bac68232216f5cc3b0f33cce558e7022.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*NchzP_EhNsT9ZqI3jYdomQ.gif"/></div></figure><p id="adc7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你可以想象我的感受，我的下一步是创建一个恶意网站的重定向。所以对于这个，我的第一步是统计URL的长度，然后将URL编码为Base64，很简单知道吗？</p><p id="87e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">创建步骤:</strong> <br/> 1 .先统计一下网址中的字符、符号、数字等的个数:<br/><a class="ae kw" href="https://evil.com" rel="noopener ugc nofollow" target="_blank">https://evil.com</a>=&gt;16</p><p id="fcaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.现在只需对网址进行Base64编码:<br/><a class="ae kw" href="https://evil.com" rel="noopener ugc nofollow" target="_blank">https://evil.com</a>=&gt;ahr 0 CHM 6 ly 9 ldmlslmnvbq = =</p><p id="2af6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.使用管道作为分隔符，将这两个值与恶意URL组合在一起，现在我们的有效负载看起来像:<br/><a class="ae kw" href="https://evil.com|16|aHR0cHM6Ly9ldmlsLmNvbQ==" rel="noopener ugc nofollow" target="_blank">https://evil . com | 16 | ahr 0 CHM 6 ly 9 ldmlslmnvbq = =</a></p><p id="87a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.现在只需对Base64中的有效载荷进行编码:<br/>ahr 0 CHM 6 ly 9 ldmlslmnvbxwxnnxhfiwy 0 hnnkx 5 owxkbwxztg 1 odmjrpt 0 =</p><p id="bf47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5.对“=”进行URL编码，即“%3D”。</p><p id="2055" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只需将最终的Base64编码值放入易受攻击的URL的“redirect”参数中，然后<strong class="ka ir">我们就可以执行</strong>了。</p><p id="b96c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://login.target.com/login?redirect=aHR0cHM6Ly9ldmlsLmNvbXwxNnxhSFIwY0hNNkx5OWxkbWxzTG1OdmJRPT0%3D" rel="noopener ugc nofollow" target="_blank">https://login.target.com/login?redirect = ahr 0 CHM 6 ly 9 ldmlslmnvbxwxnnxhsfiwy0 hnnkx 5 owxkbwxztg 1 odmjrpt 0% 3D</a></p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/f615d5f5676744a17a41ace57a6fc19b.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/1*y8X0bQOjjSHWPoD4TilrHw.gif"/></div></figure><p id="6260" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且登录后，网站顺利重定向到<strong class="ka ir">EVIL.COM</strong>。我希望你喜欢这篇文章！如果你喜欢我的作品<a class="ae kw" href="https://www.buymeacoffee.com/darklotus" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">买</strong> - <strong class="ka ir"> me-a-coffee </strong> </a>关注我的<a class="ae kw" href="https://twitter.com/darklotuskdb" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> twitter </strong> </a>了解一些很酷的技巧。</p><p id="81dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢你</p></div></div>    
</body>
</html>