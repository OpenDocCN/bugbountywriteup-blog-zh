<html>
<head>
<title>CSRF : Web App Security Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CSRF:网络应用安全基础知识</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/csrf-web-app-security-basics-dd4628122fea?source=collection_archive---------2-----------------------#2020-10-03">https://infosecwriteups.com/csrf-web-app-security-basics-dd4628122fea?source=collection_archive---------2-----------------------#2020-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/2566cccd564e5fa93587aa5a8abfc5da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*3-gMs3XOlxsUE6gsnXqIUQ.png"/></div></figure><p id="90b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">跨站点请求伪造(CSRF/XSRF) </strong>也称为一次点击攻击或会话骑行，是一种最终用户在web上执行非故意操作的攻击。比如邮箱地址变更、密码变更、资金转账等。当用户当前已通过身份验证时，可以执行操作。攻击者可以完全控制应用程序，这取决于系统中的缺陷。</p><p id="a445" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你有没有想过，当你往购物车里添加东西时，网站如何知道是不是你，或者它如何区分不同的用户，因为每个进入应用程序的请求都是一个新的请求。答案是<strong class="jw ir"><em class="ks">session cookie</em></strong>。</p><p id="e4ec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">会话cookie包含会话信息，并跟踪用户的输入和操作。它被临时存储，并在一段特定的时间后被删除。</p><p id="de4c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是，如果这些会话cookies帮助攻击者执行用户无意的操作呢？其中一个攻击场景是CSRF。</p><p id="09ac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="ks">举例</em> </strong>:</p><p id="7cd4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Susan(受害者)目前在她的银行网站上通过了身份验证，攻击者知道这些信息。攻击者通过邮件/消息“头奖彩票”向Susan发送恶意链接。苏珊很好奇，点击了链接。该链接在她登录银行网站的同一个浏览器中打开，恶意链接向应用程序发送请求，由于缺乏安全性，特定金额的钱被转移到攻击者的帐户。</p><p id="96c7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="ks">如何/执行</em> </strong>:</p><p id="8ea2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">实施这种攻击需要几个因素的共同作用。</p><ul class=""><li id="29ad" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">服务器仅依靠会话cookie来识别发出请求的用户，而不检查请求的来源。</li><li id="f75e" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">攻击者利用社会工程学的技巧，诱骗受害者在当前登录时点击恶意链接，并从同一浏览器发送链接/请求。</li><li id="7467" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">攻击者发送给受害者的恶意链接/请求必须是看起来合法的对服务器的请求。</li></ul><p id="5e12" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">受害者发送的任何带有cookie/凭据的HTTP请求都将被视为合法，并会对应用程序采取行动，即使受害者代表攻击者发送请求。</p><p id="b23f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">尽管有其局限性，CSRF是非常常见的攻击，应该认真对待。它在<a class="ae lh" href="https://owasp.org/www-pdf-archive/OWASP_Top_10_-_2013.pdf" rel="noopener ugc nofollow" target="_blank">OWASP 10强–2013</a>中排名第八。</p><p id="2b3a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="ks">制作HTTP攻击请求</em> : </strong></p><p id="0192" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以手动创建用于攻击HTTP请求，但有时这很耗时。还有一些工具，如CSRF测试器或CSRF概念生成器。<a class="ae lh" href="https://owasp.org/www-project-zap/" rel="noopener ugc nofollow" target="_blank"> OWASP ZAP </a>一个开源的web应用安全工具可以用来处理这个请求。</p><p id="9a96" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="ks">预防</em> </strong>:</p><p id="9cdc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">以下是一些可用于预防的方法:</p><ol class=""><li id="386a" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr li kz la lb bi translated">不要对状态更改操作使用GET请求。</li><li id="b742" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">框架内置CSRF保护的使用。</li><li id="0308" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">反CSRF代币。</li><li id="9b89" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">双重提交技术。</li><li id="e1b8" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">针对重要变更操作的多因素身份认证(例如OTP或安全问题)。</li><li id="d7f3" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">对所有会话cookie使用“same site”cookie属性。</li><li id="5e29" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">自定义请求标头。</li><li id="d330" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">培训和意识。</li></ol><p id="ebc4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="ks">错误/绕过</em> : </strong></p><p id="ad66" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">以下是CSRF防护实施中的一些错误，攻击者可能会绕过CSRF防护:</p><ol class=""><li id="a2e5" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr li kz la lb bi translated">每个会话的反CSRF令牌不是唯一的，或者令牌是可预测的。</li><li id="fd05" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">当CSRF令牌存在时，一些应用程序验证它，但是通过从请求中移除它，应用程序跳过验证。</li><li id="089e" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">应用程序验证通过POST请求发送的CSRF令牌，但跳过GET请求。</li><li id="11a5" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr li kz la lb bi translated">CSRF令牌在“双重提交”技术中被复制。</li></ol><p id="620b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="ks">参考文献</em> </strong>:</p><div class="lj lk gp gr ll lm"><a href="https://portswigger.net/web-security/csrf" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab fo"><div class="lo ab lp cl cj lq"><h2 class="bd ir gy z fp lr fr fs ls fu fw ip bi translated">什么是CSRF(跨站请求伪造)？教程和示例|网络安全学院</h2><div class="lt l"><h3 class="bd b gy z fp lr fr fs ls fu fw dk translated">在本节中，我们将解释什么是跨站点请求伪造，描述一些常见CSRF的例子…</h3></div><div class="lu l"><p class="bd b dl z fp lr fr fs ls fu fw dk translated">portswigger.net</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma js lm"/></div></div></a></div><div class="lj lk gp gr ll lm"><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab fo"><div class="lo ab lp cl cj lq"><h2 class="bd ir gy z fp lr fr fs ls fu fw ip bi translated">跨站点请求防伪- OWASP备忘单系列</h2><div class="lt l"><h3 class="bd b gy z fp lr fr fs ls fu fw dk translated">跨站点请求伪造(CSRF)是一种攻击类型，当恶意网站、电子邮件、博客、即时…</h3></div><div class="lu l"><p class="bd b dl z fp lr fr fs ls fu fw dk translated">cheatsheetseries.owasp.org</p></div></div></div></a></div><div class="lj lk gp gr ll lm"><a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab fo"><div class="lo ab lp cl cj lq"><h2 class="bd ir gy z fp lr fr fs ls fu fw ip bi translated">跨站点请求伪造</h2><div class="lt l"><h3 class="bd b gy z fp lr fr fs ls fu fw dk translated">跨站请求伪造，也称为一键攻击或会话骑和缩写为CSRF(有时…</h3></div><div class="lu l"><p class="bd b dl z fp lr fr fs ls fu fw dk translated">en.wikipedia.org</p></div></div><div class="lv l"><div class="mb l lx ly lz lv ma js lm"/></div></div></a></div></div></div>    
</body>
</html>