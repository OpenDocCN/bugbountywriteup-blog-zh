<html>
<head>
<title>REST API FUZZING</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">REST API模糊化</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/rest-api-fuzzing-4b82d2d7a67?source=collection_archive---------4-----------------------#2022-10-22">https://infosecwriteups.com/rest-api-fuzzing-4b82d2d7a67?source=collection_archive---------4-----------------------#2022-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3b8fbcc3ca36feb35b72c9b869d7a2bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YxzqtRpwF4fcGubiUj6KCw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">REST API模糊化</figcaption></figure><p id="2327" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">随着技术的发展，应用程序正在向独立于平台的结构过渡。为了实现这种独立性，创建了所有平台都可以与之通信的服务。这些服务现在被称为“网络服务”。</p><p id="570e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Web服务是作为API(应用程序编程接口)构建的，每个服务都有不同的职责和依赖关系。客户端可以使用SOAP或REST API来连接这些API。</p><p id="74e3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当使用“REST API”服务对应用程序执行渗透测试时，有必要了解这些服务是如何工作的。即使REST API服务有内部文档，也很难在渗透测试期间获得文档。因此，在对REST API服务执行渗透测试时，有必要通过对相关服务执行某些模糊化操作来发现应用程序客户端不发送请求的端点或应用程序客户端不发送请求的参数。</p><h1 id="5b83" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">REST API端点命名</h1><p id="1c4e" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">REST API服务的端点对应于URL的“path”值。下图给出了URL语法。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/7e860c1c877ff2c1bb85c10e33dc0699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4AxKPuuFrQ7SohLWO9_Dw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">URL语法</figcaption></figure><p id="b32c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了访问web服务，客户端必须知道这个“路径”，即端点信息。Web服务根据这些端点运行。端点命名没有正式的规则。开发团队的命名惯例在命名相关端点时扮演着重要的角色。</p><p id="5a60" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面列出了执行相同操作的端点的不同命名。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">端点命名</figcaption></figure><p id="7fbb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上表中给出了一些命名约定的例子，但是应该注意，在REST FULL服务中，同一个端点用于对象的CRUD操作。下表给出了REST完整服务的命名示例。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">REST完整API端点命名</figcaption></figure><h1 id="919b" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">REST API端点模糊化</h1><p id="0204" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">在REST API服务中执行渗透测试时，必须发现并测试不显示在应用程序上但为不同服务定义的端点。</p><p id="a05b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">电子商务网站就是一个例子。电子商务网站的客户端拥有用户可以看到和请求的服务是很自然的。可能存在这样的服务，其中可以在客户端上检索产品的图像信息，但是为更新产品的图像信息而开发的端点信息不太可能保留在应用客户端上。因此，渗透测试人员应该根据带来产品图像的端点，寻找一个可以更新产品图像的端点。</p><p id="994e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在执行端点发现时，应该仔细分析开发团队的命名约定。如果开发团队使用“getProduct/{id}”端点来获取产品信息，它很可能使用名为“updateProduct/{id}”等的端点来更新产品。或者，如果它是使用“product/{id}”端点的服务，它可能能够使用“product/{id}/update”端点。除了这些可能性之外，相关服务可以根据HTTP方法来更新产品信息。可以使用PUT或POST方法将请求发送到同一个端点来更新产品信息。</p><p id="d462" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当发现API端点时，应该在上述信息范围内采取行动。如果应用程序使用“product/{id}/image”端点向客户端报告产品映像信息，则应在发现过程中对“product/{id}/”端点执行模糊处理。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/8e53b2639bc786e39350af682d1b5c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yEn8CXRIZ8rxXiy9XegSKA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">ffuf终点模糊</figcaption></figure><p id="ecca" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果应用程序以“getProduct/{id}”的形式向客户端报告产品信息，则应分析该应用程序，并记录使用的关键字:</p><ul class=""><li id="3925" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz mp mq mr ms bi translated">获取产品</li><li id="9651" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">setProduct</li><li id="7852" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">更新产品</li><li id="6209" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">插入产品</li><li id="d27f" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">删除产品</li></ul><p id="81ae" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在使用命名的应用程序中，关键字应该一分为二。表示交易信息的关键字:</p><ul class=""><li id="3e9a" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz mp mq mr ms bi translated">得到</li><li id="4baf" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">设置</li><li id="00a6" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">更新</li><li id="475c" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">插入</li><li id="7539" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">删除</li></ul><p id="b52c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">表示对象信息的单词:</p><ul class=""><li id="a662" class="mk ml iq ke b kf kg kj kk kn mm kr mn kv mo kz mp mq mr ms bi translated">产品</li><li id="d800" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">用户</li><li id="a892" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">轮廓</li><li id="3db4" class="mk ml iq ke b kf mt kj mu kn mv kr mw kv mx kz mp mq mr ms bi translated">账户</li></ul><p id="3084" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">模糊端点时，应使用这些关键字的组合:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/814dffbe989d65f5e5bf90a1c8fd8d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-eG-hVIUQhuKNChBSsboaQ.png"/></div></div></figure><h1 id="33da" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">REST API状态代码</h1><p id="40f5" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">在发现REST API端点时，返回的响应中的HTTP状态代码非常重要。下表给出了一些HTTP状态代码。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="e07a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">即使上表中指定的状态代码有一定的解释，开发人员也可以将这些状态代码用于预期目的之外的用途。</p><p id="4d97" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面的屏幕截图显示了应用程序中未定义的端点的请求和响应。服务器的响应应该是“404”，但却返回了200。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/25db439da4bdbec1abc42485286a755c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-K0zNkmznZhWu_O4o2bFQ.png"/></div></div></figure><p id="423a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在下面的屏幕截图中，它报告了没有为相关端点定义“GET”方法，并给出了“404 Not Found”响应。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/8de2397d708d424037c111b25d2acd0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-JSkPAay74lRP9JlOw237w.png"/></div></div></figure><p id="faba" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在发现过程中，应该对返回的响应进行分析，并确定服务器在何种情况下给出了何种响应，并且应该在模糊化时使用这些信息。</p><h1 id="46fa" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">REST API参数发现</h1><p id="aa35" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">确定端点后，分析相关端点使用的参数在渗透测试中起着重要作用。例如，通过向注册用户的端点发送“isAdmin”或“Admin”参数，可以添加具有高特权的用户。</p><p id="758d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在进行参数发现时，应该分析整个应用程序中使用的参数。</p><p id="64e7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面是对列出用户信息的端点的请求和响应。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/fb91794294ac45c2dd348b7d4f6560ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gV1zLCQ2JjOasB0V1JQVQw.png"/></div></div></figure><p id="039d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在上面的截图中，显示了用户在系统中注册的所有信息。将用户添加到同一个端点的请求和响应如下面的屏幕截图所示。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/12649b8884a0d8400527a8a5508a6d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cBlOssM38LoM87O1gOBc-A.png"/></div></div></figure><p id="f689" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">从客户端发送到服务器的请求中没有“角色”值。默认情况下，web服务用“guest”值填充“role”值。如果在请求中发送了“role”值，则可以绕过服务器上的这个默认进程，获得具有更高权限的用户。</p><p id="bb5b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">并不是每个web服务都向客户端显示用户的所有特征，就像上面的例子一样。在这种情况下，应该使用用于端点发现的相同分析。通过分析开发团队的命名约定，可以操纵看不见的参数。</p></div></div>    
</body>
</html>