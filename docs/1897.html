<html>
<head>
<title>Server Hardening with OpenSCAP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenSCAP强化服务器</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/server-hardening-with-openscap-be072ba2e415?source=collection_archive---------1-----------------------#2022-02-18">https://infosecwriteups.com/server-hardening-with-openscap-be072ba2e415?source=collection_archive---------1-----------------------#2022-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="a12c" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">“SCAP安全指南是以<a class="ae kp" href="http://www.open-scap.org/security-policies/scap-security-guide/#" rel="noopener ugc nofollow" target="_blank"> SCAP </a>文档的形式编写的安全策略。SCAP安全指南中创建的安全策略涵盖了计算机安全的许多领域，并提供了最佳实践解决方案。该指南包含详细描述的规则，还包括针对目标系统优化的成熟补救脚本。SCAP安全指南和OpenSCAP工具可用于自动审计您的系统。”<a class="ae kp" href="http://www.open-scap.org/security-policies/scap-security-guide/" rel="noopener ugc nofollow" target="_blank">http://www . open-scap . org/security-policies/scap-security-guide/</a></p></blockquote><p id="0f56" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">RHEL 7号将在这次演习中使用。</p><p id="b46f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">为了开始，应该安装oscap工具和scap安全指南。</p><p id="b77e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated"><code class="fe kt ku kv kw b">yum install openscap-scanner scap-security-guide</code></p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/001bdcd4ce377ea7d575f8f93aa0c4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tx46B4t5G7qoRdgYkYTsgw.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">安装后，可以使用命令oscap来启动程序</figcaption></figure><p id="2655" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">scap-security-guide包提供了安全策略，其内容可以在<code class="fe kt ku kv kw b">/usr/share/xml/scap/ssg/content/</code>中找到</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/f38ae18f496809dad50ecc57940779ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*Bowa9kq8pg6IGx1UFbQ0Uw.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">/usr/share/XML/scap/SSG/content/directory的内容</figcaption></figure><p id="d87c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">SCAP数据流是从SCAP 1.2版开始使用的一种文件格式，它代表一个XCCDF、OVAL和其他组件文件包。可以使用<code class="fe kt ku kv kw b">oscap info</code>模块检查SCAP数据流文件。</p><p id="c6c2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated"><code class="fe kt ku kv kw b">oscap info /usr/share/xml/scap/ssg/content/ssg-rhel7-ds.xml</code></p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lo"><img src="../Images/47aaff99f69bcb35a3df33b85d0b0091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j9X1HocYYsaxVjABBpuebg.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">关于SCAP数据流的信息</figcaption></figure><p id="1594" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">通过检查，我们可以注意到所选SCAP文档中所有可用的概要文件。我将选择id为xccdf _ org . SSG project . content _ profile _ CIS的<a class="ae kp" href="https://www.redhat.com/en/blog/center-internet-security-cis-compliance-red-hat-enterprise-linux-using-openscap" rel="noopener ugc nofollow" target="_blank"><em class="js">CIS Red Hat Enterprise 7 Benchmark</em></a>概要文件来审计系统。请注意关于远程资源的警告，我们收到此警告是因为SCAP安全指南使用外部文件来检查系统是否是最新的，是否有已知的安全漏洞。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="9143" class="lw lx iq bd ly lz ma dn mb mc md dp me kq mf mg mh kr mi mj mk ks ml mm mn mo bi translated">扫描</h2><p id="caf1" class="pw-post-body-paragraph jq jr iq jt b ju mp jw jx jy mq ka kb kq mr ke kf kr ms ki kj ks mt km kn ko ij bi translated">接下来是使用OpenSCAP扫描系统是否符合CIS基准。</p><pre class="ky kz la lb gt mu kw mv mw aw mx bi"><span id="f717" class="lw lx iq kw b gy my mz l na nb">sudo oscap xccdf eval --fetch-remote-resources --profile xccdf_org.ssgproject.content_profile_cis --results initial_scan.xml --report initial_scan.html /usr/share/xml/scap/ssg/content/ssg-rhel7-ds.xml</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi nc"><img src="../Images/c70a63f931c385f62c62b095ef84aade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*shGvdzA6YXnBg_RTkbzyqg.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">扫描过程</figcaption></figure><p id="f7e9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这将扫描系统并将结果存储在一个xml文件和一个html文件中，html文件将有助于了解系统并查看哪些规则通过了哪些规则失败了。还记得我们在检查SCAP文档时发现的警告说它使用了外部文件吗？<code class="fe kt ku kv kw b">--fetch-remote-resources</code>选项将下载操作所需的文件，该操作需要互联网连接，如果系统没有互联网连接，请参见<a class="ae kp" href="https://access.redhat.com/solutions/5185891" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="f655" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">扫描完成后，可以查看html报告。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi nd"><img src="../Images/534d41d70cba3a38193bee9de81e79cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cy691EWUEbcv1IsySwPKzA.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">初始扫描的HTML报告</figcaption></figure><p id="ca71" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">从报告中，我们可以获得许多信息，如分数，通过和失败的规则数量，失败规则的严重性等。根据我的报告，分数是62.77，这意味着有相当数量的失败规则，该系统不是完全安全的，也不符合CIS。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="345c" class="lw lx iq bd ly lz ma dn mb mc md dp me kq mf mg mh kr mi mj mk ks ml mm mn mo bi translated">补救</h2><p id="9dc5" class="pw-post-body-paragraph jq jr iq jt b ju mp jw jx jy mq ka kb kq mr ke kf kr ms ki kj ks mt km kn ko ij bi translated">为了使系统更符合要求，我们可以修复系统。以下单个命令将评估和修复系统，这种方法称为在线修复。</p><pre class="ky kz la lb gt mu kw mv mw aw mx bi"><span id="849b" class="lw lx iq kw b gy my mz l na nb">sudo oscap xccdf eval --remediate --fetch-remote-resources --profile xccdf_org.ssgproject.content_profile_cis --results scan.xml --report scan.html /usr/share/xml/scap/ssg/content/ssg-rhel7-ds.xml</span></pre><p id="48da" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">执行该命令后，我们首先可以看到oscap是如何扫描系统的，其次是如何修复系统的。在补救阶段，结果将被标记为“已修复”或“错误”。</p><blockquote class="jn jo jp"><p id="b46c" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">“<strong class="jt ir">修复的</strong>结果表明修复后执行的扫描通过。<strong class="jt ir">错误</strong>结果表明，即使应用了补救措施，评估仍未通过。”</p><p id="cce2" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><a class="ae kp" href="http://static.open-scap.org/openscap-1.2/oscap_user_manual.html#_remediate_system" rel="noopener ugc nofollow" target="_blank">http://static . open-scap . org/openscap-1.2/OS cap _ user _ manual . html # _ remediate _ system</a></p></blockquote><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ne"><img src="../Images/1c48a7c49fbdaf67d4c9111a00132461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpSxwGu3FKBnej29YShbxw.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">扫描过程</figcaption></figure><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi nf"><img src="../Images/45972095be12151e6c9bf81e13881e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mM6C_0CNjqAOOvXYImkLWQ.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">补救过程</figcaption></figure><p id="5d40" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">该过程完成后，可以查看生成的html报告。如你所见，现在分数是92.73，系统比以前更安全了。我们已经成功地使用openSCAP对服务器进行了安全加固。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lo"><img src="../Images/644d3c9d469722d688a4503a82983f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBBBobNSUQbTMjVHvDKSMA.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">oscap生成的HTML报告</figcaption></figure></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="56d3" class="lw lx iq bd ly lz ma dn mb mc md dp me kq mf mg mh kr mi mj mk ks ml mm mn mo bi translated">生成和编辑补救脚本</h2><p id="1f80" class="pw-post-body-paragraph jq jr iq jt b ju mp jw jx jy mq ka kb kq mr ke kf kr ms ki kj ks mt km kn ko ij bi translated">由于脚本用于修复系统，我们可以使用openSCAP从概要文件中提取所有规则的修复脚本，并为我们生成一个bash脚本，然后可以根据我们的选择编辑这个bash脚本。我们可以删除某些规则或改变规则的价值。</p><pre class="ky kz la lb gt mu kw mv mw aw mx bi"><span id="ac7f" class="lw lx iq kw b gy my mz l na nb">oscap xccdf generate fix --fetch-remote-resources --profile xccdf_org.ssgproject.content_profile_cis /usr/share/xml/scap/ssg/content/ssg-rhel7-ds.xml &gt; fix.sh</span></pre><p id="b0f6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">生成bash脚本后，我们可以使用文本编辑器进行我们喜欢的任何更改，然后可以执行该脚本来修复系统。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ng"><img src="../Images/337fa2cc8999a2d325884c773b7c2568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iusheumsh7OF8qzAxndc8g.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">在vim中打开补救bash脚本</figcaption></figure><p id="ba3c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们已经成功学习了如何使用OpenSCAP和OpenSCAP的一些基础知识来强化RHEL系统。</p><p id="c4bd" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">那都是乡亲们！</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="fe0d" class="lw lx iq bd ly lz ma dn mb mc md dp me kq mf mg mh kr mi mj mk ks ml mm mn mo bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kp" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>