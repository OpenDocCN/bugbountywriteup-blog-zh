<html>
<head>
<title>How I abused the file upload function to get a high severity vulnerability in Bug Bounty</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何滥用文件上传功能来获取Bug Bounty中的高严重性漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-abused-the-file-upload-function-to-get-a-high-severity-vulnerability-in-bug-bounty-7cdcf349080b?source=collection_archive---------0-----------------------#2022-09-14">https://infosecwriteups.com/how-i-abused-the-file-upload-function-to-get-a-high-severity-vulnerability-in-bug-bounty-7cdcf349080b?source=collection_archive---------0-----------------------#2022-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f4b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，最有趣的功能之一是文件上传，文件上传中的漏洞通常会导致严重或高严重性，所以让我们从我在bug bunting时遇到的这个场景开始</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/e3b858b57140a2a704f7404a16d8649f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJYWCEDRTs2fYGBMa8sjvA.jpeg"/></div></div></figure><p id="95d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们考虑我们的目标领域是target.com</p><p id="0233" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在寻找我们的目标时，我偶然发现了子域edu.target.com，该程序提供的服务是一个教学平台，因为有不同类型的用户，如学生和教师，他们旨在帮助学生学习技术相关的主题，如软件工程机器人等…</p><h1 id="1c24" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">让我们开始我们的故事</h1><p id="d15d" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我遇到了上传功能，试图上传一张图片来分析该功能是如何工作的</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ma"><img src="../Images/f0d9956a8025453f59ccb0864a8082df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6ZNjZfNiIxE0Cq5w3QQbw.png"/></div></div></figure><p id="9ddf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试着上传PHP脚本</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mb"><img src="../Images/7d55ad9a5a8ecfd92275efe95b6b58e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hu0sDdOzuR8sCdNJ30XTBQ.png"/></div></div></figure><p id="1db0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现服务器没有响应</p><p id="d339" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在对应用程序的行为进行了一些分析之后，我发现如果请求没有通过验证，连接将被关闭，服务器将不会响应请求</p><p id="69d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们试着绕过php扩展的验证</p><p id="1fd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们首先通过尝试上传随机扩展来判断应用程序是否正在进行白名单或黑名单验证。如果上传成功，则意味着应用程序正在进行黑名单验证。如果没有，则意味着应用程序正在对特定扩展进行白名单验证</p><p id="7bf3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试着上传图片。奥马尔</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/15422d5612c66b661126ca6d2297ae1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpjFmPDoI1LWOwoawyeCcw.png"/></div></div></figure><p id="c86e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件已成功上传，这意味着应用程序正在进行黑名单验证</p><p id="3be9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我试图用rce.pHp绕过验证</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi md"><img src="../Images/5b8a35d6891d46b4e721f65b020780f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-6cR7D2Ks_VGnb2xP8r-g.png"/></div></div></figure><p id="7d4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上传成功</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="4eaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，我正期待着几天后我的银行账户里会出现5000美元的奖金</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="c9d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们请求我们的PHP脚本执行phpinfo()函数</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mh"><img src="../Images/e4908780a2ff5a19aa498e8e74eff9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHkaiCsDVuRw9ryhSuj6Yg.png"/></div></div></figure><p id="0fea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">rce.pHp没有被处决</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="1ed9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，当时我想到的是，我们似乎能够绕过黑名单验证，但开发人员遵循安全设计，阻止我获得RCE</p><p id="a564" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这可以通过几种方式实现，其中之一是将此标志添加到。htaccess文件，它将使服务器不执行图像上传目录中的PHP文件</p><blockquote class="mi mj mk"><p id="118e" class="jn jo ml jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated">php_flag引擎关闭</p></blockquote><p id="5003" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以防你不知道什么是。htaccess文件</p><h2 id="5d5d" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi translated">注意:</h2><blockquote class="mi mj mk"><p id="05cb" class="jn jo ml jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated">。htaccess文件是分布式配置文件，它提供了一种在每个目录的基础上进行服务器配置更改的方法，我希望开发人员在图像上传目录中使用它来防止RCE</p></blockquote><p id="c8c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据这个，我想到了两个场景</p><h1 id="3c78" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">重写配置和路径遍历:</h1><h2 id="8aeb" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi translated">第一种情况:</h2><p id="e415" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated"><strong class="jp ir">注意:让我们假设我的图像的端点是:</strong></p><p id="1a3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">https://target-domain . com/edu/sub-dir-1/sub-dir-2/sub-dir-3/our-image-此处</strong></p><h2 id="5e66" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi">1.1</h2><blockquote class="nb"><p id="f92b" class="nc nd iq bd ne nf ng nh ni nj nk kk dk translated">可能开发者上传了他们的”。htaccess“文件在<strong class="ak">子目录-1 </strong> /目录中，因此根据这个目录，<strong class="ak">子目录-1 </strong> /目录和子目录(包括我上传php脚本的目录)无法运行php脚本，因此我们可以通过上传不同的文件来利用这种错误配置”。htaccess”文件在<strong class="ak">子目录-1 </strong> / <strong class="ak">子目录-2 </strong> / <strong class="ak">子目录-3 </strong> /上。这种配置允许我更改子目录-3/上的配置，允许我执行php脚本</p></blockquote><p id="6bf4" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">允许运行php脚本的配置</p><blockquote class="mi mj mk"><p id="18ff" class="jn jo ml jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated">php_flag引擎开启</p></blockquote><h2 id="b43e" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi">1.2</h2><blockquote class="nb"><p id="aa70" class="nc nd iq bd ne nf ng nh ni nj nk kk dk translated">好吧，也许开发者没有做这种错误的配置，而且已经上传了。我的目录下的htaccess文件<strong class="ak">子目录-1 </strong> / <strong class="ak">子目录-2 </strong> / <strong class="ak">子目录-3 </strong> /。htaccess在这种情况下我会重写。通过上传文件名来访问文件。htaccess与以前的配置，这将允许我执行php脚本</p></blockquote><p id="d502" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">但不幸的是，我记得文件名被重写，以防我们上传。htaccess将被重写为/sub-dir-1/sub-dir-2/sub-dir-3/32-random-characters . htaccess，这对服务器配置没有影响</p><h2 id="2091" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi translated">第二种情况:</h2><h2 id="6ada" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi">2.0</h2><blockquote class="nb"><p id="9faf" class="nc nd iq bd ne nf ng nh ni nj nk kk dk translated">在第二个场景中，我们将通过对filename参数进行路径遍历来测试它，以防第一个场景失败。阻止我的php脚本执行的htaccess文件，所以我的文件将被上传到另一个目录，而不是在阻止php脚本执行的配置下<a class="ae nq" href="https://target-domain.com/edu/edu/32-random-chars.pHp" rel="noopener ugc nofollow" target="_blank">https://target-domain.com/edu/edu/32-random-chars.pHp</a></p></blockquote><p id="dbb7" class="pw-post-body-paragraph jn jo iq jp b jq nl js jt ju nm jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">众所周知，开发人员从文件名中提取一个扩展名，并将其放入端点扩展名中，因此开发人员可能会使用弱正则表达式，在点之后提取任何内容，并将其放入端点扩展名中，这样我们就可以通过添加一个点来绕过它。)然后使用路径遍历有效负载将我们的脚本上传到另一个目录</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nr"><img src="../Images/fcb419c02fa0f38f7c32b15b59376d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cNhL5FdFQ8vb8a9s7Qv5Jw.png"/></div></div></figure><p id="92e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不起作用，因为正如你所看到的，开发人员似乎以正确的方式实现了正则表达式验证(如果他们使用了它，而没有使用内置函数，如php函数pathinfo())</p><h1 id="ae3b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">SQL注入:</h1><p id="9439" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">开发人员在上传我们的图片时需要将每张图片与其用户联系起来</p><h2 id="09d0" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi translated">那么他们如何做到这一点呢？</h2><p id="45ab" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">正确，使用数据库</p><p id="8660" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，开发人员也在某处保存了我们的文件名参数</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ns"><img src="../Images/dbdabf0f6ff7f88c72ab327cac22781e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRyhUpoBybpIVN6McKp-5w.png"/></div></div></figure><p id="01ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以下一步测试SQLI的文件名参数，我使用了burp套件扫描仪</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nt"><img src="../Images/457636e4d84069fc15a5ced12f4ce5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnhC9hIIadQLr8lFGuwDJw.png"/></div></div></figure><p id="98fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是一无所获</p><h1 id="5689" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">公共利用:</h1><p id="ee38" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">但是也许开发者在上传功能中使用了一个库来处理上传的图像，这可能是易受攻击的</p><p id="773d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我开始测试一些常见库的漏洞，比如image quarterly，它利用了ImageMagick库</p><p id="4f83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CVE-2016–3714，CVE-2016–3718，CVE-2016–3715，CVE-2016–3716，CVE-2016–3717</p><p id="d4d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里找到功勋<a class="ae nq" href="https://imagetragick.com/" rel="noopener ugc nofollow" target="_blank">【https://imagetragick.com/】T2</a></p><p id="dc6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但也不太管用，所以如果我无法获得关键漏洞，那么让我们尝试获得高严重性漏洞</p><h1 id="ac8f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">存储-XSS:</h1><h2 id="b6c4" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi translated"><strong class="ak">第一个场景:</strong></h2><p id="5e4a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">通过上传包含我们的XSS有效载荷的SVG图像，开始测试存储的XSS</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/7f831e2d26862d6dbad6362da5fbfacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cBAnkvGykzlv6B9KSqV7pg.png"/></div></div></figure><p id="9a12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们请求我们的svg XSS有效载荷</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nv"><img src="../Images/5a50600109700c60ba6428749e29a462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sel7aSQexZG1TyT8eci2Iw.png"/></div></div></figure><p id="70bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但不幸的是，应用程序响应强制内容类型:图像/jpeg，所以我们不能以这种方式实现XSS</p><h2 id="ec8b" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi translated">第二种情况:</h2><p id="a553" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated"><strong class="jp ir">在</strong><a class="ae nq" href="https://target.com/techer/profile-id" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://edu.target.com/teacher/profile-id</strong></a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nw"><img src="../Images/87f7c51144cccd46def126125889ec58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1nzLZDVz3wJRWHsX46Zhw.png"/></div></div></figure><p id="23bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我之前告诉您的，服务器端将扩展名放在图像名称中</p><p id="43ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，似乎filename参数中的扩展名是注入XSS有效负载的最佳位置</p><p id="308b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe nx ny nz oa b">XSS.omar" onmouseover=alert(1)</code></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ob"><img src="../Images/6eed336ad002cf1a87a2b37ebca9ad3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F93gkITFTJuJaabJN6cQYQ.png"/></div></div></figure><p id="a7c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是他们似乎在为我们的有效载荷做HTML实体编码，所以我们不能逃脱双引号</p><h1 id="3050" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">应用级DOS攻击:</h1><p id="2484" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">该应用程序在客户端验证图像大小，只允许上传小于1 MB的图像</p><p id="cb09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我尝试通过上传一个大图像来获得DOS，所以我只使用了一个大小超过1 MB的图像来测试服务器端是否有大小验证，但连接再次关闭，服务器没有响应，这意味着有一个图像大小验证来防止这种类型的攻击</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oc"><img src="../Images/54f282a5fa98860262bf8f0a6ddadb1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jC6XhDBk8GMDF8HluBY6jA.png"/></div></div></figure><h1 id="b970" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">信息披露:</h1><p id="ac5b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">但是我注意到我的有效载荷没有改变，这意味着如果我上传一张图片，图片中的所有元数据都不会改变</p><p id="1a63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，是时候射出最后一颗子弹了</p><p id="7729" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我上传了包含GPS定位数据的图片</p><p id="ae75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以在这里找到<a class="ae nq" href="https://github.com/ianare/exif-samples/blob/master/jpg/tests/67-0_length_string.jpg" rel="noopener ugc nofollow" target="_blank">https://github . com/ianare/EXIF-samples/blob/master/jpg/tests/67-0 _ length _ string . jpg</a></p><p id="aa8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将图片上传到网络应用程序后，我再次下载它，检查地理位置数据是否有条纹</p><p id="222e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用ExifTool提取元数据来进行检查</p><blockquote class="mi mj mk"><p id="f25e" class="jn jo ml jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated">┌──(omar㉿kali)-[~/downloads]<br/>└─$ EXIF tool/downloads/EXIF-test . jpg</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi od"><img src="../Images/3c71c23d799673984640d6bf75998c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*O6es4J9nit9qt70zWJ8Fpg.png"/></div></figure><p id="c33a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为web应用程序似乎没有从图像中剥离地理位置数据</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="6567" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在报告这一情况后，由于教育平台的大多数用户是未成年学生，这种信息披露侵犯了他们的隐私，安全团队将其作为P2接受</p><h1 id="910b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">建议的修复:</h1><p id="aea7" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">1-从ImageMagick下载最新版本</p><p id="5230" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2-使用stripImage()方法从图像中剥离元数据</p><blockquote class="mi mj mk"><p id="56f1" class="jn jo ml jp b jq jr js jt ju jv jw jx mm jz ka kb mn kd ke kf mo kh ki kj kk ij bi translated"><?php <br/?> $imageFilePath = '上传的图像'；<br/>$ img = new imagick()；<br/>$ img-&gt;readImage($ imagefile path)；<br/>$ img-&gt;strip image()；<br/>$ img-&gt;write image($ imagefile path)；<br/> $img- &gt;销毁()；<br/>？&gt;</p></blockquote><p id="eae0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你喜欢写文章的人</p><p id="e7a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如有任何问题，请通过Linkedin或Twitter联系我</p><p id="dbfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特:<a class="ae nq" href="https://twitter.com/OmarHashem666" rel="noopener ugc nofollow" target="_blank"> @OmarHashem666 </a></p><h1 id="3001" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">保持联系:</h1><p id="ba79" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated"><a class="ae nq" href="https://www.linkedin.com/in/omar-1-hashem" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Linkedin</strong></a><strong class="jp ir">|</strong><a class="ae nq" href="https://www.youtube.com/channel/UCJ1yNtgZP5LRO7ebZXSnAZQ/videos" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Youtube</strong></a><strong class="jp ir">|</strong><a class="ae nq" href="https://twitter.com/OmarHashem666" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Twitter</strong></a></p><h2 id="4d89" class="mp ky iq bd kz mq mr dn ld ms mt dp lh jy mu mv ll kc mw mx lp kg my mz lt na bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae nq" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>