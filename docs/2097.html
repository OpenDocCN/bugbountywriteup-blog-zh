<html>
<head>
<title>Module-2 | Introduction -Pentesting &amp; Bypassing AWS/Azure/GCP Cloud WAF Fun &amp; Profit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模块2 |简介-测试和绕过AWS/Azure/GCP云WAF的乐趣和收益</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/module-2-introduction-pentesting-bypassing-aws-azure-gcp-cloud-waf-fun-profit-9c87b6276fe7?source=collection_archive---------5-----------------------#2022-05-25">https://infosecwriteups.com/module-2-introduction-pentesting-bypassing-aws-azure-gcp-cloud-waf-fun-profit-9c87b6276fe7?source=collection_archive---------5-----------------------#2022-05-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="1e2d" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">问:什么是核心规则集&amp;为什么它被所有的云waf所利用？<br/>答:我们将尝试了解更多关于核心规则集及其工作原理，并将尝试在apache服务器上实现mod安全性，并了解为什么它被主要的WAFs所利用。</p></blockquote><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/086e6b956c42762ff161e76d98eda1c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-rZYQ4hufBSXDednAQ3XqQ.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">感谢<a class="li lj ep" href="https://medium.com/u/ff26ea5d4b2c?source=post_page-----9c87b6276fe7--------------------------------" rel="noopener" target="_blank">地米斯托克利</a></figcaption></figure><h2 id="2887" class="lk ll it bd lm ln lo dn lp lq lr dp ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">介绍</h2><p id="6b78" class="pw-post-body-paragraph jt ju it jw b jx mg jz ka kb mh kd ke lt mi kh ki lx mj kl km mb mk kp kq kr im bi translated">在开始在云上设置WAF之前，我们需要了解我们将在云WAFs中启用的核心规则集。由于CRS是开源的，我向<strong class="jw iu">security@coreruleset.org</strong>报告，报告中的一些内容被拒绝，其余的被接受，这在博客中有所提及。</p><p id="3148" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">稍后，我将展示未被接受的安全缺陷，以及为什么我认为它们是有效的原因，我还将设置云WAF并绕过CRS规则。</p><h2 id="5edb" class="lk ll it bd lm ln lo dn lp lq lr dp ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">目标</h2><ul class=""><li id="12f9" class="ml mm it jw b jx mg kb mh lt mn lx mo mb mp kr mq mr ms mt bi translated">ModSecurity &amp; OWASP ModSecurity核心规则集的定义。</li><li id="0b47" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">核心规则集的工作。</li><li id="cebc" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">为什么使用OWASP CRS。</li><li id="bddd" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">在Apache上实现CRS。</li><li id="2704" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">CRS配置和偏执水平？</li><li id="473d" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">CRS和云晶圆</li><li id="264b" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">摘要</li></ul><h2 id="0c62" class="lk ll it bd lm ln lo dn lp lq lr dp ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">描述</h2><ul class=""><li id="4794" class="ml mm it jw b jx mg kb mh lt mn lx mo mb mp kr mq mr ms mt bi translated"><strong class="jw iu"> ModSecurity </strong>:它是一个开源的、跨平台的web应用防火墙(WAF) <strong class="jw iu">引擎</strong>，适用于Apache、IIS和Nginx。每个引擎都需要一套规则和条例来执行操作。</li><li id="1e05" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated"><strong class="jw iu"> OWASP CRS </strong> : OWASP核心规则集是一组通用攻击检测规则，用于ModSecurity或兼容Web应用防火墙(WAF)。任何兼容的WAF都可以使用CRS规则，因此所有云提供商都使用这些通用规则集在云上提供WAF。<br/>CRS可以保护web应用程序免受各种安全风险的影响，并在适当调整时将误报率降至最低。</li></ul><h2 id="c89b" class="lk ll it bd lm ln lo dn lp lq lr dp ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">为什么使用OWASP CRS？</h2><p id="b099" class="pw-post-body-paragraph jt ju it jw b jx mg jz ka kb mh kd ke lt mi kh ki lx mj kl km mb mk kp kq kr im bi translated">这些规则本质上是通用的，任何兼容的WAF引擎都可以使用CRS，因此所有主要的云提供商，如亚马逊AWS、微软Azure、谷歌云、Akamai等。都有某种形式的CRS服务。</p><p id="09c3" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">因此，在将CRS用于生产应用程序之前，我们需要了解它的工作原理。</p><h2 id="a01d" class="lk ll it bd lm ln lo dn lp lq lr dp ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">1.CRS的实施</h2><p id="b6ae" class="pw-post-body-paragraph jt ju it jw b jx mg jz ka kb mh kd ke lt mi kh ki lx mj kl km mb mk kp kq kr im bi translated">1.1:在Debian/Ubuntu上安装带有Apache的ModSecurity</p><ul class=""><li id="48e6" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">Apache的ModSecurity模块包含在默认的Debian/Ubuntu存储库中。要安装它，请运行</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="0bcb" class="lk ll it nd b gy nh ni l nj nk">sudo apt install libapache2-mod-security2</span></pre><ul class=""><li id="95ef" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">然后启用该模块。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="beb6" class="lk ll it nd b gy nh ni l nj nk">sudo a2enmod security2</span></pre><ul class=""><li id="0335" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">重启阿帕奇。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="ecab" class="lk ll it nd b gy nh ni l nj nk">sudo systemctl restart apache2</span></pre><p id="2219" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">1.2:配置ModSecurity</p><ul class=""><li id="bc3c" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">在配置文件的<code class="fe nl nm nn nd b">/etc/apache2/mods-enabled/security2.conf</code>中，有一行提到了<code class="fe nl nm nn nd b">IncludeOptional /etc/modsecurity/*.conf</code>，因此我们需要如下所述将<code class="fe nl nm nn nd b">IncludeOptional /etc/modsecurity/*.conf modsecurity.conf-recommended</code>复制到<code class="fe nl nm nn nd b">modsecurity.conf</code>。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="b646" class="lk ll it nd b gy nh ni l nj nk">sudo mv /etc/modsecurity/modsecurity.conf-recommended /etc/modsecurity/modsecurity.conf</span></pre><ul class=""><li id="4c13" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">然后编辑这个文件。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="41e8" class="lk ll it nd b gy nh ni l nj nk">sudo vim /etc/modsecurity/modsecurity.conf</span></pre><ul class=""><li id="a7e9" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">将下面一行<code class="fe nl nm nn nd b">SecRuleEngine DetectionOnly</code>改为<code class="fe nl nm nn nd b">SecRuleEngine On.</code> <br/> ModSecurity将检测并阻止网络攻击，因为我们将模式从仅检测改为仅检测。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="3860" class="lk ll it nd b gy nh ni l nj nk">SecRuleEngine On</span></pre><ul class=""><li id="5ad9" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">然后把SecAuditLogParts改成<strong class="jw iu"> <em class="jv"> ABCEFHJKZ。</em>T9】</strong></li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="b07f" class="lk ll it nd b gy nh ni l nj nk">SecAuditLogParts ABCEFHJKZ</span></pre><ul class=""><li id="3b86" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">保存并关闭。然后我们将重启Apache。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="f94a" class="lk ll it nd b gy nh ni l nj nk">sudo systemctl restart apache2</span></pre><p id="774e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">1.3:安装OWASP核心规则集(CRS)</p><ul class=""><li id="d879" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">为了让ModSecurity保护web应用程序，我们需要定义规则来检测恶意活动并阻止它们。我们可以使用现有的规则集和配置，也可以根据需要进行定制。<strong class="jw iu"> OWASP核心规则集</strong> (CRS)是ModSecurity使用的标准规则集。</li><li id="7742" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">从GitHub下载最新的OWASP CRS。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="a775" class="lk ll it nd b gy nh ni l nj nk">#wget <a class="ae no" href="https://github.com/coreruleset/coreruleset/archive/refs/tags/v3.3.2.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/coreruleset/coreruleset/archive/refs/tags/v3.3.2.tar.gz</a></span></pre><ul class=""><li id="bdff" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">提取文件。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="dc12" class="lk ll it nd b gy nh ni l nj nk">tar xvf v3.3.2.tar.gz</span></pre><ul class=""><li id="a3b2" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">创建一个目录来保存CRS文件。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="ec1a" class="lk ll it nd b gy nh ni l nj nk">sudo mkdir /etc/apache2/modsecurity-crs/</span></pre><ul class=""><li id="3dda" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">将提取的目录移动到<code class="fe nl nm nn nd b">/etc/apache2/modsecurity-crs/</code>。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="f918" class="lk ll it nd b gy nh ni l nj nk">sudo mv coreruleset-3.3.0/ /etc/apache2/modsecurity-crs/</span></pre><ul class=""><li id="4a51" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">转到该目录。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="6991" class="lk ll it nd b gy nh ni l nj nk">cd /etc/apache2/modsecurity-crs/coreruleset-3.3.2/</span></pre><ul class=""><li id="1c95" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">重命名<code class="fe nl nm nn nd b">crs-setup.conf.example</code>文件。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="0263" class="lk ll it nd b gy nh ni l nj nk">sudo mv crs-setup.conf.example crs-setup.conf</span></pre><ul class=""><li id="4e3d" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">我们需要编辑<code class="fe nl nm nn nd b">/etc/apache2/mods-enabled/security2.conf</code>文件。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="bedb" class="lk ll it nd b gy nh ni l nj nk">sudo vim /etc/apache2/mods-enabled/security2.conf</span></pre><ul class=""><li id="1340" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">更改下面提到的加载默认CRS文件的行。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="a282" class="lk ll it nd b gy nh ni l nj nk">IncludeOptional /usr/share/modsecurity-crs/*.load</span></pre><ul class=""><li id="9f3e" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">将其更改为以下内容，以便使用最新的OWASP CRS。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="315f" class="lk ll it nd b gy nh ni l nj nk">IncludeOptional /etc/apache2/modsecurity-crs/coreruleset-3.3.2/crs-setup.conf<br/>IncludeOptional /etc/apache2/modsecurity-crs/coreruleset-3.3.2/rules/*.conf</span></pre><ul class=""><li id="fd3e" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">检查语法，然后重新启动Apache。</li></ul><pre class="kt ku kv kw gt nc nd ne nf aw ng bi"><span id="044f" class="lk ll it nd b gy nh ni l nj nk">sudo apache2ctl -t<br/>sudo systemctl restart apache2</span></pre><p id="177c" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">您可以看到OWASP CRS可以在两种模式下运行:</p><ul class=""><li id="6c64" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated"><strong class="jw iu">异常评分模式</strong>。这是CRS v3.x中使用的默认模式，基于“协作检测”和“延迟阻止”的概念。ModSecurity将根据所有规则检查HTTP请求，并为每个匹配的规则添加一个分数。如果达到阈值，则HTTP请求被视为攻击，将被拦截。</li><li id="4a7d" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated"><strong class="jw iu">独立模式</strong>。这是最基本的操作模式，所有的规则都是“独立的”。ModSecurity将立即阻止HTTP请求，并停止评估剩余的规则。</li></ul><blockquote class="jq jr js"><p id="e3a1" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">入站请求的默认分数为5，出站响应的默认分数为4。</p></blockquote><p id="40fa" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">当在异常评分模式下运行时，有4个偏执水平。</p><ul class=""><li id="1132" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">一级妄想症</li><li id="accb" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">妄想症2级</li><li id="73cc" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">妄想症3级</li><li id="e1d5" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">妄想症4级</li></ul><p id="1141" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">随着妄想症级别的提高，CRS会启用额外的规则，为您提供更高的安全级别。然而，更高的偏执水平也增加了由于错误警报而阻止一些合法流量的可能性。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi np"><img src="../Images/e9c99a210aa05f095d31e3d525721968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMwepJxw8Lip-9xRuQgkjg.png"/></div></div></figure><blockquote class="jq jr js"><p id="935f" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">为了测试<a class="ae no" href="https://twitter.com/ChrFolini" rel="noopener ugc nofollow" target="_blank">，Christian Folini</a>(OWASP<a class="ae no" href="http://twitter.com/CoreRuleSet" rel="noopener ugc nofollow" target="_blank">@ core ruleset</a>项目共同负责人)提供了偏执等级为<strong class="jw iu">4的配置。</strong></p></blockquote><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nq"><img src="../Images/541385057af2885eb2b4b6dcbcbf5fa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4vHnu9hdqNtVfjzcF2p3iw.png"/></div></div></figure><p id="7c19" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">在使用CRS之前，您需要理解这两个基本概念。现在我们可以关闭文件了。各个CRS规则存储在<code class="fe nl nm nn nd b">/etc/apache2/modsecurity-crs/coreruleset-3.3.2/rules/</code>目录中。每个匹配规则都会增加异常分值。</p><p id="308d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">异常分值将根据触发的规则不断增加，并开始阻止恶意流量。这可以通过云WAF日志在事件中检查。</p><blockquote class="jq jr js"><p id="3f3d" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">注意:显然不会有任何请求体，只有GET请求URL会出现在日志中。因此，一旦WAF在生产中实施，减少假阳性将非常棘手。</p><p id="8808" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">在实现CRS时，我能够实现零误报，尽管我不得不禁用一些规则，因为在云中不可能调整配置。然后我创建了自定义规则。</p></blockquote><ul class=""><li id="2f14" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">偏执等级基本就是规则的严格程度。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><a href="https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170330_ModSecurity_CRS_v3_Intro.pdf"><div class="gh gi nr"><img src="../Images/b918131e4c56e4449d82483a1f490b40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yiXN7svmEu8pNv1hOs8GSw.png"/></div></a></figure><ul class=""><li id="fd6d" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">对于一些基本规则，请参考云提供商的文档以获得规则列表。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><a href="https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170330_ModSecurity_CRS_v3_Intro.pdf"><div class="gh gi ns"><img src="../Images/15e2544fa75803ddf70edc9a9a7d23cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIUAZhLWvDcuyqQnGqv7_A.png"/></div></a></figure><ul class=""><li id="f37d" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">云WAF上的误报率很高，因为无法修改配置。<br/>因此，应遵循混合方法(黑名单&amp;白名单)方法。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><a href="https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170330_ModSecurity_CRS_v3_Intro.pdf"><div class="gh gi nt"><img src="../Images/7a59c8a7e1b99e9f585f7c96bcab4410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSB1vwz3JiW8SHiZxqOqSg.png"/></div></a></figure><h1 id="5394" class="nu ll it bd lm nv nw nx lp ny nz oa ls ob oc od lw oe of og ma oh oi oj me ok bi translated">调整CRS</h1><p id="7b63" class="pw-post-body-paragraph jt ju it jw b jx mg jz ka kb mh kd ke lt mi kh ki lx mj kl km mb mk kp kq kr im bi translated">CRS绝对可以防御大量的恶意流量，阻止大多数安全扫描和所有基于自动化/脚本小子的HTTP攻击。<br/>通用方法会出现误报，因为WAF提供商正在提供定制配置，因此一家云提供商的WAF可能与另一家不同。此外，根据测试云WAF时触发的规则，自定义规则会有所不同。<br/>这种默认的云WAF会带来很多误报，每个WAF都需要根据其实施的应用进行测试。</p><p id="d2d9" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated"><strong class="jw iu">这意味着ModSecurity和CRS充当第一道防线，为您赢得时间，并防止遵从。</strong></p><blockquote class="jq jr js"><p id="0d7d" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">这是核心规则集的基础，接下来我将展示在不同的云提供商上设置WAF以及如何测试WAF。然后，我们将编写基于日志的自定义规则。</p></blockquote><h1 id="f10f" class="nu ll it bd lm nv nw nx lp ny nz oa ls ob oc od lw oe of og ma oh oi oj me ok bi translated">摘要</h1><p id="0dca" class="pw-post-body-paragraph jt ju it jw b jx mg jz ka kb mh kd ke lt mi kh ki lx mj kl km mb mk kp kq kr im bi translated">偏执等级设置是一个重要的部分，但最重要和最棘手的功能是异常评分。异常评分意味着CRS不会立即阻止请求。相反，它将检测与阻塞决策分开。当规则因遇到请求中的特定模式而触发时，它会提高请求的异常分值。然后运行一个单独的规则来检查总异常分数。该单独的规则基于异常阈值执行阻止决策。</p><p id="b77e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke lt kg kh ki lx kk kl km mb ko kp kq kr im bi translated">这将根据云发生变化，并且该异常评分将基于云WAF的配置方式。</p><h2 id="c795" class="lk ll it bd lm ln lo dn lp lq lr dp ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">由于云提供商使用开源CRS，因此建议向CRS团队报告。因此，从我的报告中接受了3件事，这将在下面提到。</h2><p id="8e8b" class="pw-post-body-paragraph jt ju it jw b jx mg jz ka kb mh kd ke lt mi kh ki lx mj kl km mb mk kp kq kr im bi translated">我的报告中有三点:😁</p><ul class=""><li id="bf32" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated">将UA SeoScanners添加到受限UA列表中</li><li id="4b72" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">将UA许可系统添加到受限UA列表中</li><li id="3e16" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">尝试将/proc system添加到受限本地文件列表中。理想情况下，整个/proc都在PL1，但我们需要对此进行测试。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ol"><img src="../Images/60077b21b5c4b36e153a4fb22a39619d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pw8YU8M_qwxGuDTDwqUVFQ.png"/></div></div></figure><blockquote class="jq jr js"><p id="78ba" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">就Christian Folini自己而言，Modsecurity CRS是第一道防线，这意味着在默认安装中，许多攻击和绕过都不会被检测到。这并不理想，但是一个合理的妥协，因为对于我们的用户来说，另一种选择是根本没有规则集。</p></blockquote><ul class=""><li id="5f04" class="ml mm it jw b jx jy kb kc lt mz lx na mb nb kr mq mr ms mt bi translated"><strong class="jw iu">联系</strong><a class="ae no" href="https://twitter.com/ChrFolini" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu">Christian folini</strong></a><strong class="jw iu">因为如果您想测试/报告CRS的任何问题，他会很快响应并提供帮助。<br/>向</strong><a class="ae no" href="https://www.netnea.com/cms/tutorials/" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu"/></a>举报CRS中的安全问题。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><a href="https://www.netnea.com/cms/tutorials/"><div class="gh gi om"><img src="../Images/d5db67e9ac6b70ccaead15496e36b606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vNHLltk3Q3_lqegeUgZjaQ.png"/></div></a><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">摘要</figcaption></figure><h2 id="f79d" class="lk ll it bd lm ln lo dn lp lq lr dp ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">参考</h2><ul class=""><li id="455d" class="ml mm it jw b jx mg kb mh lt mn lx mo mb mp kr mq mr ms mt bi translated"><a class="ae no" href="https://www.linuxbabe.com/security/modsecurity-apache-debian-ubuntu" rel="noopener ugc nofollow" target="_blank">https://www . Linux babe . com/security/modsecurity-Apache-debian-Ubuntu</a></li><li id="2e82" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated"><a class="ae no" href="https://kemptechnologies.com/blog/kemp-owasp-crs-load-balancer/" rel="noopener ugc nofollow" target="_blank">https://Kemp technologies . com/blog/Kemp-owasp-CRS-load-balancer/</a></li><li id="3309" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated"><a class="ae no" href="https://www.netnea.com/cms/apache-tutorial-7_including-modsecurity-core-rules/" rel="noopener ugc nofollow" target="_blank">https://www . net nea . com/CMS/Apache-tutorial-7 _ including-modsecurity-core-rules/</a></li><li id="f8a8" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated"><a class="ae no" href="https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20170330_ModSecurity_CRS_v3_Intro.pdf" rel="noopener ugc nofollow" target="_blank">https://owasp . org/www-chapter-London/assets/slides/owasplondon 2017 03 30 _ ModSecurity _ CRS _ v3 _ intro . pdf</a></li><li id="bb6a" class="ml mm it jw b jx mu kb mv lt mw lx mx mb my kr mq mr ms mt bi translated">感谢<a class="ae no" href="https://medium.com/u/ff26ea5d4b2c?source=post_page-----75f315951aa8--------------------------------" rel="noopener">地米斯托克利</a>，我将会继续维护这个以及未来的博客。</li></ul></div></div>    
</body>
</html>