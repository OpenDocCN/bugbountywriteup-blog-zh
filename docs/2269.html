<html>
<head>
<title>Configuring TOR with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python配置TOR</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/configuring-tor-with-python-1a90fc1c246f?source=collection_archive---------0-----------------------#2022-08-12">https://infosecwriteups.com/configuring-tor-with-python-1a90fc1c246f?source=collection_archive---------0-----------------------#2022-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e6f3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Python脚本屏蔽您的IP地址</h2></div><p id="b56c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你曾经建立过一个web scrapper，那么你一定面临过由于产生太多请求而被web服务器阻止的问题，或者你只是想隐藏你的真实IP地址并自动运行你的脚本。</p><p id="5473" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我将解释如何在您的Linux系统上配置TOR，以及如何在Python脚本中实现TOR来屏蔽您的真实IP并绕过基于IP的限制。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/76b96785edd13c0aac36a5ccb39ba7b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*gIwzFlBnywbQyQ8-ioWH7A.jpeg"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">照片由<a class="ae ln" href="https://www.pexels.com/photo/food-man-love-people-11035356/" rel="noopener ugc nofollow" target="_blank">RealToughCandy.com</a>拍摄</figcaption></figure><h1 id="020f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">TOR是什么？</h1><p id="1eca" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">对于那些刚接触黑客和编程的人来说<em class="ml">“Tor，洋葱路由器的缩写，是一个支持匿名通信的免费开源软件”。</em> <strong class="kh ir"> <em class="ml"> Tor网络是一种安全的加密协议，可以确保网络上数据和通信的隐私</em> </strong> <em class="ml">。</em></p><p id="141b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Tor服务/浏览器通过使用一种被称为洋葱路由的技术来工作。洋葱路由器是一个点对点(P2P)覆盖网络，使用户能够匿名浏览互联网。洋葱路由使用多层加密来隐藏通过网络发送的信息的来源和目的地。</p><p id="045d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通常使用TOR浏览器访问TOR网络，但是如果您想在Python脚本中使用它并通过TOR网络运行自动化脚本，该怎么办呢？这正是我们今天要做的！！</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="0668" class="lo lp iq bd lq lr mt lt lu lv mu lx ly jw mv jx ma jz mw ka mc kc mx kd me mf bi translated">Tor安装</h1><p id="1f46" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">Tor的安装取决于您的系统，官方<a class="ae ln" href="https://www.torproject.org/download/" rel="noopener ugc nofollow" target="_blank">网站</a>上有详细介绍。对于大多数基于Debian的系统来说，这是可行的。</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="8c9d" class="nd lp iq mz b gy ne nf l ng nh">sudo apt-get install tor</span></pre><p id="45ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要启动Tor，请运行:</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="1ed5" class="nd lp iq mz b gy ne nf l ng nh">sudo service tor start</span></pre><p id="cd96" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要检查它是否工作，只需从终端运行以下命令:</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="6787" class="nd lp iq mz b gy ne nf l ng nh">curl --socks5 localhost:9050 --socks5-hostname localhost:9050 -s https://check.torproject.org/ | cat | grep -m 1 Congratulations | xargs</span></pre><p id="192c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果一切正常，您将得到这个输出。</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="2a74" class="nd lp iq mz b gy ne nf l ng nh">Congratulations. This browser is configured to use Tor.</span></pre><h1 id="56b4" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">使用Python配置</h1><p id="a227" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">Python请求模块将用于通过TOR网络发送请求。</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="7573" class="nd lp iq mz b gy ne nf l ng nh">sudo pip3 install requests<br/>sudo pip3 install requests[socks]<br/>sudo pip3 install requests[security]<br/>sudo pip3 install cryptography</span></pre><p id="e426" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以使用to请求模块。</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="60ef" class="nd lp iq mz b gy ne nf l ng nh">import requests</span></pre><p id="5b3a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用以下命令在没有Tor的情况下检查您的IP地址:</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="a1e4" class="nd lp iq mz b gy ne nf l ng nh">requests.get('https://ident.me').text</span></pre><p id="b59e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出将是您的原始IP地址。</p><p id="c670" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要在python脚本中使用TOR网络，我们首先需要告诉Python使用代理。</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="fb49" class="nd lp iq mz b gy ne nf l ng nh">proxies = {<br/>    'http': 'socks5://127.0.0.1:9050',<br/>    'https': 'socks5://127.0.0.1:9050'<br/>}</span></pre><p id="5934" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您应该有了一个新的IP地址:</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="e4a6" class="nd lp iq mz b gy ne nf l ng nh">requests.get('https://ident.me', proxies=proxies).text</span></pre></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="f7e8" class="lo lp iq bd lq lr mt lt lu lv mu lx ly jw mv jx ma jz mw ka mc kc mx kd me mf bi translated">获取新身份</h1><p id="8ab6" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们需要在每次发出新请求时或以固定的时间间隔获取新的IP地址，为此，我们需要一个名为<strong class="kh ir">“Stem”的Python模块。</strong></p><p id="ab63" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">stem是一个用于<a class="ae ln" href="https://www.torproject.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> Tor </strong> </a>的Python控制器库。有了它，你就可以使用Tor的<a class="ae ln" href="https://gitweb.torproject.org/torspec.git/tree/control-spec.txt" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">控制协议</strong> </a>针对Tor进程编写脚本。</p><p id="d256" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了更加匿名，我们可以使用<strong class="kh ir">“假用户代理”</strong>模块为每个请求生成一个新的用户代理。这两个模块都可以使用pip安装。</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="06d2" class="nd lp iq mz b gy ne nf l ng nh">sudo pip3 install stem<br/>sudo pip3 install fake_useragent</span></pre><p id="8ff1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Tor控制器还必须配置为请求身份更新。</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="ce37" class="nd lp iq mz b gy ne nf l ng nh">sudo nano /etc/tor/torrc</span></pre><p id="ee82" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将下列行保存在<code class="fe ni nj nk mz b">/etc/tor/torrc</code>文件中。</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="f447" class="nd lp iq mz b gy ne nf l ng nh">ControlPort 9051<br/>CookieAuthentication 1</span></pre><p id="d075" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们重新启动Tor以考虑这些修改:</p><pre class="lc ld le lf gt my mz na nb aw nc bi"><span id="da86" class="nd lp iq mz b gy ne nf l ng nh">sudo service tor restart</span></pre></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="b3cc" class="lo lp iq bd lq lr mt lt lu lv mu lx ly jw mv jx ma jz mw ka mc kc mx kd me mf bi translated">将这一切打包在一个脚本中</h1><p id="d92c" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我们现在已经准备好了一切，我们需要做的就是将这些东西打包到一个脚本中。</p><p id="a73f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们需要导入需要的模块。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nl"><img src="../Images/6746cf79c42a57d6d6b40884808353b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E1HVzcbA623Pk3XmE3VOBg.png"/></div></div></figure><p id="75be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">导入模块后，我们定义我们的代理。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nq"><img src="../Images/2b9fb9d1d42ffac6d10d0e66b1e178a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZwxCZ_sWdGBNbpKzUTsVQ.png"/></div></div></figure><p id="40cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们将为我们的Stem控制器定义一个处理程序。使用这个处理程序，我们将验证我们的请求，并生成信号来获得一个新的IP地址。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nr"><img src="../Images/ecd9c4fa50cb27efdee7df1a04ad730e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e888rUNLEcASBozE2Ozp0g.png"/></div></div></figure><p id="d865" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ml">这里是完整的代码</em></p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="d0cd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这段代码将每10秒生成一个新的IP地址，并在每个请求中使用一个新的用户代理。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nu"><img src="../Images/73288450af9a052eee7cf330ef2cac24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CW_xoPSyghMkBWRnojapuA.png"/></div></div></figure><h2 id="e837" class="nd lp iq bd lq nv nw dn lu nx ny dp ly ko nz oa ma ks ob oc mc kw od oe me of bi translated">此工具的使用案例</h2><p id="4bb2" class="pw-post-body-paragraph kf kg iq kh b ki mg jr kk kl mh ju kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">有很多场景可以使用它，它可以作为一个基础来创建许多惊人的工具来解决问题，如</p><ul class=""><li id="e06f" class="og oh iq kh b ki kj kl km ko oi ks oj kw ok la ol om on oo bi translated">刮除正常网页而不被阻塞</li><li id="84bb" class="og oh iq kh b ki op kl oq ko or ks os kw ot la ol om on oo bi translated">制作深色刮网板</li><li id="9585" class="og oh iq kh b ki op kl oq ko or ks os kw ot la ol om on oo bi translated">屏蔽IP地址的工具</li><li id="6bee" class="og oh iq kh b ki op kl oq ko or ks os kw ot la ol om on oo bi translated">还有更多…..</li></ul></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="bcf7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非常感谢你的阅读。喜欢就分享😇😇</p><p id="8680" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ml">跟我来这里上</em> <a class="ae ln" href="https://mayank-01.medium.com/follow" rel="noopener"> <strong class="kh ir"> <em class="ml">中</em> </strong> </a> <em class="ml">和</em> <a class="ae ln" href="https://mayank-01.medium.com/subscribe" rel="noopener"> <strong class="kh ir"> <em class="ml">订阅邮件列表</em> </strong> </a> <strong class="kh ir"> <em class="ml">💌如果你想在我发表文章时得到它们。✨✨ </em></strong></p><p id="ba09" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ml">我的GitHub:</em><a class="ae ln" href="https://github.com/MayankPandey01" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="ml">mayankpandey 01</em></strong></a><strong class="kh ir"><em class="ml">👨‍💻</em> </strong></p><p id="7ca7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ml">你可以在推特上找到我:</em><a class="ae ln" href="https://twitter.com/intent/follow?screen_name=mayank_pandey01" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="ml">mayank _ pandey 01</em></strong></a><strong class="kh ir"><em class="ml">👻</em>T50】</strong></p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="2cf8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ml">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae ln" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="ml">加入我们的每周简讯</em> </strong> </a> <em class="ml">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>