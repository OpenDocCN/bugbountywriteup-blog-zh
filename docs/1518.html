<html>
<head>
<title>WAF bypasses: Tearing down the wall</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">晶圆旁路:拆除围墙</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/waf-bypasses-tearing-down-the-wall-d08fd0f8374a?source=collection_archive---------1-----------------------#2021-08-12">https://infosecwriteups.com/waf-bypasses-tearing-down-the-wall-d08fd0f8374a?source=collection_archive---------1-----------------------#2021-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8b362d58afda895e7155c9bbb865e0c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RbFWdVggszxS3GKvHq_r5g.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kc">来源:谷歌</strong></figcaption></figure><p id="8bbf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们深入实际的旁路部分之前，理解什么是WAF(Web应用程序防火墙)及其类型非常重要。</p><p id="2698" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗨，伙计们，欢迎来到这个新的博客，在这里，我们将讨论WAFs，它被认为是黑客最大的敌人之一。同样重要的是要记住WAF不同于通常的防火墙(网络防火墙)。这里有一个简单的区别:<strong class="kf ir">网络应用防火墙</strong>是一个网络安全防火墙解决方案，可以保护网络应用免受HTTP/S和基于网络应用的安全漏洞<strong class="kf ir">T5的攻击，其中<strong class="kf ir">网络防火墙</strong>是一个控制对安全局域网的访问以防止未经授权的访问的设备。</strong></p><p id="4e38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，通俗地说，一个<strong class="kf ir"> WAF </strong>位于外部用户和web应用程序之间，用于分析所有HTTP通信。然后，它会在恶意请求到达用户或web应用程序之前检测并阻止它们。因此，WAFs可以保护业务关键型web应用程序和web服务器免受零日威胁和其他应用层攻击。随着企业扩展到新的数字计划，这变得越来越重要，这可能使新的web应用程序和应用程序编程接口(API)容易受到攻击。如果你想进一步了解它，请点击<a class="ae lb" href="https://en.wikipedia.org/wiki/Web_application_firewall" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">此处</strong> </a>:)此外，你也可以浏览这张图片以获得一个大致的想法:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/01ad3aaa27d6a5410585edcc22a5ec6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JpeuClKZ6J63gY8tMJrKyA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kc">来源:谷歌</strong></figcaption></figure><p id="ecb7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，有不同类型的WAF，供应商也是如此。基本上有三种类型的WAFs:</p><ul class=""><li id="0912" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated"><strong class="kf ir">基于网络的WAFs </strong></li><li id="047d" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><strong class="kf ir">基于主机的WAFs </strong></li><li id="1fbd" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><strong class="kf ir">基于云的WAFs </strong></li></ul><p id="a76d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，基于网络的WAFs是基于硬件的，并且由于本地安装而提供了减少延迟的好处。这意味着NWAF安装在靠近应用服务器的地方，很容易访问。</p><p id="88c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基于主机的web应用程序防火墙作为web服务器的模块存在。与基于硬件的WAFs相比，这是一个非常便宜的解决方案，WAFs是为小型web应用程序设计的。大多数WAFs软件都可以很容易地与流行的web服务器集成。</p><p id="79af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基于云的web应用程序防火墙提供了与其他基于软件的WAF解决方案类似的优势，例如低成本和缺少您必须管理的内部资源。当您不想用性能能力来限制自己或者旨在避免需要维护的系统时，基于云的解决方案是一个极好的选择。云服务提供商可以提供无限的硬件池，并提供合格的设置和支持。</p><p id="1ade" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">说得够多了，让我们来看看作为攻击者的一些观点。最常见的需要WAF旁路的攻击是<strong class="kf ir"> XSS </strong>和<strong class="kf ir"> SQLi。</strong>或者你也可以说一些类型的注入攻击需要绕过。因此，我们将看到旁路实际上是如何工作的，以及当WAF被构建来保护攻击时它为什么会工作:)这里我们以<strong class="kf ir"> Cloudflare </strong>为例，因为我们在现实生活场景中经常看到它。然而，还有其他<a class="ae lb" href="https://www.cloudflare.com/en-in/learning/cdn/what-is-a-cdn/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">cdn</strong></a>被用于:</p><ul class=""><li id="05be" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated"><strong class="kf ir">赤麦。</strong></li><li id="f382" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><strong class="kf ir">苏库里。</strong></li><li id="1216" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><strong class="kf ir">亚马逊云锋。</strong></li><li id="9ba2" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><strong class="kf ir">堆栈路径。</strong></li><li id="9059" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">快速地。</li></ul><p id="0482" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设(只是假设)，你得到了一个搜索字段，并尝试了一个简单的有效载荷，如<script> alert(1) </script>。没用:(现在你又试了一个，这次" &gt;<img src="x" onerror="alert(1)"/>。这个也不行。现在，当你检查时，网站阻止了你，你需要现在返回。大概是这样的:</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/af43ff27dfb957dcf087db81ff69afde.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*pP-7glaC8Ts4v3r_Q0yxkw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kc">来源:谷歌</strong></figcaption></figure><p id="b070" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，你应该假设有一个防火墙来阻止你输入任何被过滤的字符。所以才实施的对！好的，这就是旁路发挥作用的地方。旁路只是避开过滤器的技术。所以，把你的黑客头脑放在这里，尝试一些开箱即用的东西。我们将采用正常的有效载荷来理解它是如何绕过晶片的。让我们来看看这个有效载荷:</p><p id="f6d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">% 22% 3E % 3c img % 20 src % 3Dx % 20错误% 3Dx警报(1)%3E </strong></p><p id="272f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这与<strong class="kf ir">"&gt;&lt;img src = x on error = alert(1)&gt;</strong>相同，但有时编码可能有效。现在的问题是，为什么WAF接受这个有效载荷，而这个有效载荷还带有“警报”。简单地理解如下:<strong class="kf ir">waf有一些定义好的规则，它们遵循一种包含过滤字符和单词的检查表。</strong>因此，如果没有在清单中进行过滤，这里可以使用简单的编码。然而，现在WAFs非常先进，他们甚至过滤base-64编码。不管怎样，这就是为什么我们的有效载荷绕过WAFs的基本想法。</p><p id="1a2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有多种方法可以绕过WAF到达XSS。你可以随时用谷歌查看，你应该会得到很多有效载荷和备忘单，但我包括其中一些:</p><ul class=""><li id="7d04" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated"><a class="ae lb" href="https://owasp.org/www-community/xss-filter-evasion-cheatsheet" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> OWASP过滤规避备忘单</strong> </a></li><li id="74b0" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><a class="ae lb" href="https://github.com/citybasebrooks/XSS-Filter-Evasion/blob/master/payloads" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">city base brooks</strong></a>的小抄</li><li id="6cf7" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">有效载荷由<a class="ae lb" href="https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> HackTricks </strong> </a></li></ul><p id="72cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们试图利用SQL注入时，WAFs限制了我们很多次，它不允许我们继续我们的有效负载。例如:如果<strong class="kf ir"> /？id=1+union+select+1，2，3/* </strong>被防火墙屏蔽，我们可以这样试试:</p><p id="86a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> /？id=1+un/**/ion+sel/**/ect+1，2，3 — </strong></p><p id="bd7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而且，如果应用程序易受SQLi攻击，第二个会绕过它。在这里，我们所做的是，我们把我们的有效载荷发送到服务器，它照原样接收，但我们知道它将作为第一个被执行。由于它阻止了<strong class="kf ir">联合，</strong>我们破坏了它并用/**/发送了它。WAF没有阻止它，因为它没有被过滤或组织阻止。同样，如果<strong class="kf ir"> union select 1，2，3，4，5#"] </strong>被阻塞，我们可以将“select”拆分成类似于<strong class="kf ir"> se、【select 1，2，3，4，5】</strong>的内容，它应该会运行良好。以下是SQLi筛选器规避的一些列表:</p><ul class=""><li id="c330" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated"><a class="ae lb" href="https://owasp.org/www-community/attacks/SQL_Injection_Bypassing_WAF" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">OWASP SQLi备忘单</strong> </a></li><li id="7e9c" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><a class="ae lb" href="https://hydrasky.com/network-security/sql-injection-bypass-cheatsheet/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">海德拉斯基的检查表</strong> </a></li></ul><p id="5e31" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗯，还有几件事没提。在你绕过它之前，有些东西会帮助你找出幕后故事。直到你知道你正在穿越哪个防火墙，你才可以盲目的尝试。所以很少有学生能搞清楚:</p><ul class=""><li id="f25f" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated"><a class="ae lb" href="https://github.com/EnableSecurity/wafw00f" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> WafW00F用于识别防火墙</strong> </a></li><li id="f099" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><a class="ae lb" href="https://github.com/0xInfection/Awesome-WAF" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">这个GitHub回购超级好用，帮了大忙:)</strong> </a></li></ul><p id="1755" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我提到的第二个环节是我认为WAFs最好的事情之一。它的工作原理和LiveOverflow的<a class="ae lb" href="https://github.com/EdOverflow/can-i-take-over-xyz" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">我能接管XYZ </strong> </a> <strong class="kf ir">一样。</strong>您可以查看不同cdn和WAFs的详细信息，例如:</p><p id="25f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">云闪</strong></p><ul class=""><li id="b11a" class="lh li iq kf b kg kh kk kl ko lj ks lk kw ll la lm ln lo lp bi translated">可检测性:简单</li><li id="cc31" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">检测方法:</li><li id="8ed1" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">响应头可能有<code class="fe lw lx ly lz b">cf-ray</code>字段值。</li><li id="a379" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><code class="fe lw lx ly lz b">Server</code>标题字段有值<code class="fe lw lx ly lz b">cloudflare</code>。</li><li id="ff2f" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated"><code class="fe lw lx ly lz b">Set-Cookie</code>响应头有<code class="fe lw lx ly lz b">__cfuid=</code> cookie字段。</li><li id="ab91" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">页面内容可能有<code class="fe lw lx ly lz b">Attention Required!</code>或<code class="fe lw lx ly lz b">Cloudflare Ray ID:</code>。</li><li id="887a" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">页面内容可能包含文本形式的<code class="fe lw lx ly lz b">DDoS protection by Cloudflare</code>。</li><li id="669d" class="lh li iq kf b kg lq kk lr ko ls ks lt kw lu la lm ln lo lp bi translated">点击无效网址可能会遇到<code class="fe lw lx ly lz b">CLOUDFLARE_ERROR_500S_BOX</code>。</li></ul><p id="fee2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我强烈建议检查一下，应该会对你有很大帮助。</p><p id="4f21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">WAFs总是挑战被绕过，但也有一些严肃的学习。是的。如果你能以某种方式把它升级到SQLi，你可以得到相当多的钱。所以总是双赢。也有先进的技术，你挖掘得越深，你获得的想法就越多。</p><p id="c432" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，这就是这篇博客的全部内容，我希望你喜欢它。如果你有，请在社区中分享:)你可以在twitter上关注我的任何其他相关内容，我非常感谢你的投入，无论是建议还是我需要做的补充:)</p><p id="14df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保重，快乐黑客！</p><p id="bf28" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再见，❤</p><p id="5991" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">推特:- @manasH4rsh </strong></p></div></div>    
</body>
</html>