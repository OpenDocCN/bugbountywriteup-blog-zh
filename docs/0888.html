<html>
<head>
<title>How To Exploit Mara CMS For Unconfined Arbitrary File Upload</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用Mara CMS进行无限制的任意文件上传</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cve-2020-25042-mara-cms-7-5-arbitrary-file-upload-exploit-writeup-9addb36e0f95?source=collection_archive---------1-----------------------#2020-10-14">https://infosecwriteups.com/cve-2020-25042-mara-cms-7-5-arbitrary-file-upload-exploit-writeup-9addb36e0f95?source=collection_archive---------1-----------------------#2020-10-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cbebf102815ac97abec9b222add0c61b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPF_TjS8GVuTSw3cTGflDA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马拉CMS</figcaption></figure><p id="305b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">简介:</strong> <br/> Mara CMS是一个基于开源文件的内容管理系统。它是使用HTML5和CSS3构建的，并且由于其拖放编辑功能而易于使用。其他功能包括实时编辑，即时预览，回滚等。</p><p id="80d4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">到目前为止，安全研究人员已经在Mara CMS上发现了2个漏洞。它们是Mara CMS contact.php跨站脚本和Mara CMS无限制上传。</p><p id="8678" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">TL；在这篇文章中，我将展示如何利用Mara CMS 7.5中的“任意文件上传”漏洞。攻击者应该拥有管理员或管理者角色的有效凭据，才能利用此漏洞。该问题存在于codebase/handler.php文件中，该文件无法验证上传的文件类型，因此攻击者可以将恶意文件上传到服务器并执行相同的操作。</strong></p><p id="e9cb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">开发方法:</strong></p><p id="d74d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在开发阶段，首先我们需要列举版本并检查Mara CMS版本是否是我们试图开发的版本。对于这一点，可以有各种方法，但据我所知，我们可以通过changes.txt文件来检查它，如下图所示。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi la"><img src="../Images/18d549cebd1471c8aa35cb233a6dd7a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ImcZJ4POrV5uNIEv.png"/></div></div></figure><p id="5adc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦我们确认了版本，我们需要登录到平台，我们可以使用测试文件中给出的默认凭据admin和changeme。平台通知更改默认凭证，但是如果这个平台的管理员懒得忽略这个消息，使得攻击者的日子更容易过。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/51a84460f03bcf62739f25aad96aa297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EyKTgLI-gYSwx6ba.png"/></div></div></figure><p id="bc38" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">万一凭证被更改，攻击者必须想办法通过任何更好的方式获取这些凭证。一旦攻击者登录，就很容易被利用。现在，我们将使用默认凭据登录到平台，并转到易受攻击的URL。这里我们将上传一个简单的PHP脚本来运行我们的命令。以防万一，PHP系统命令被禁用，还有其他PHP函数可以使用，如exec，passthru，shell_exec。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/72d6845f65cf5a15db776c9054270233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5nBYXmacDe8UJVxe.png"/></div></div></figure><p id="ccdf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我快速上传PHP文件，默认上传的目录是img目录，但是我们可以指定'/'，这意味着文件将直接上传到apache目录。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/cf8bd1e5c85d821ddf66a060f7a123c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8GE0GX-hv7wR7aEZ.png"/></div></div></figure><p id="76c0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们已经上传了文件，让我们运行一些命令。由于操作系统是Linux，我将运行Linux命令，但是如果操作系统是windows或其他操作系统，则可以执行后续命令。</p><p id="7d0e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我已经输入了ls，我们可以列出工作目录的内容。类似地，我们可以上传php反向外壳来访问系统，或者使用相同的脚本来获得反向外壳。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/d74f2c51047b51644011461d2470f3cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*IkDD6mpL31UZ-Vsu.png"/></div></figure><p id="82a4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我准备好了PHP反向shell，让我上传它并在系统上获得一个shell。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/64a3db15dc75dbe747c11ef7b57fe7f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0dNo4SsnwelqpNp7.png"/></div></div></figure><p id="bc0f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这样我们就能进入系统。完成了对这一问题的论证。</p><div class="lh li gp gr lj lk"><a href="https://www.youtube.com/@Exploit-Writeup/" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab fo"><div class="lm ab ln cl cj lo"><h2 class="bd ir gy z fp lp fr fs lq fu fw ip bi translated">漏洞利用报告</h2><div class="lr l"><h3 class="bd b gy z fp lp fr fs lq fu fw dk translated">CTF玩家、安全专家、Bug赏金猎人、白帽黑客和渗透测试者的博客你好，我是…</h3></div><div class="ls l"><p class="bd b dl z fp lp fr fs lq fu fw dk translated">www.youtube.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly jw lk"/></div></div></a></div><p id="1c3f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">免责声明:</strong> <br/>本帖仅出于教育目的。本文表达的所有观点、信息或内容都是我自己的，不代表我曾经、现在或将来隶属的任何实体。这里描述的方法和列出的工具现在可能被证明是危险的，甚至是非法的。你对这里的信息采取的任何行动或活动都完全是你自己的风险，我不会对任何形式的滥用负责。</p></div></div>    
</body>
</html>