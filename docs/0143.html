<html>
<head>
<title>Adminer Script Results to Pwning Server?, Private Bug Bounty Program</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理员脚本结果到Pwning服务器？私人昆虫赏金计划</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/adminer-script-results-to-pwning-server-private-bug-bounty-program-fe6d8a43fe6f?source=collection_archive---------0-----------------------#2018-08-11">https://infosecwriteups.com/adminer-script-results-to-pwning-server-private-bug-bounty-program-fe6d8a43fe6f?source=collection_archive---------0-----------------------#2018-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e8f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一个<a class="ae kl" href="https://www.adminer.org/" rel="noopener ugc nofollow" target="_blank">管理员</a>脚本留在服务器上，很可能这个服务器很快就会被典当掉。在这个故事中，我想介绍一种技术，以便在没有有效凭证的情况下利用管理员脚本。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="29cf" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">侦察</h1><p id="8402" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">虽然之前我参加了一个私人的bug bounty计划(在这个故事中，让我们命名为域<code class="fe lw lx ly lz b">milk.tld</code>),我做了一些脚本，子域查找器等侦察，揭示了几个子域，其中之一是<code class="fe lw lx ly lz b">support</code>重定向用户到主域。我通过以下语法由<a class="ae kl" href="https://github.com/xmendez/wfuzz" rel="noopener ugc nofollow" target="_blank"> wfuzz </a>执行了一个动作暴力:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="2bf3" class="mi ku iq lz b gy mj mk l ml mm">https://support.milk.tld/FUZZ</span></pre><p id="b23e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">终于找到了<code class="fe lw lx ly lz b">/login</code>端点。我测试了页面上太多的向量，但没有发现任何缺陷。后来，我用一些字表用<a class="ae kl" href="https://github.com/xmendez/wfuzz" rel="noopener ugc nofollow" target="_blank"> wfuzz </a>对文件名进行了一次暴力破解，发现了一个名为<code class="fe lw lx ly lz b">connect.php</code>的有趣文件，打开后，我看到了adminer.php脚本。</p><figure class="ma mb mc md gt mo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/d0ab23c5a8ffffac7a1df57da0fa791d.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*XHYjMDMzBcO8778RZtpkdw.png"/></div></figure><p id="631f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">常见的情况是暴力攻击，我做了，但一无所获。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="68f5" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">攻击媒介</h1><p id="4da5" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">受以下文章的启发:</p><blockquote class="mr ms mt"><p id="03b2" class="jn jo mu jp b jq jr js jt ju jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj kk ij bi translated"><a class="ae kl" href="https://w00tsec.blogspot.com/2018/04/abusing-mysql-local-infile-to-read.html" rel="noopener ugc nofollow" target="_blank">https://w00 tsec . blogspot . com/2018/04/滥用-MySQL-local-infile-to-read . html</a></p><p id="81df" class="jn jo mu jp b jq jr js jt ju jv jw jx mv jz ka kb mw kd ke kf mx kh ki kj kk ij bi translated"><a class="ae kl" href="https://phonexicum.github.io/infosec/sql-injection.html" rel="noopener ugc nofollow" target="_blank">https://phonexicum.github.io/infosec/sql-injection.html</a></p></blockquote><p id="cd99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我设计了一个攻击场景:</p><ol class=""><li id="e58f" class="my mz iq jp b jq jr ju jv jy na kc nb kg nc kk nd ne nf ng bi translated">在公共IP地址内设置MySQL服务器</li><li id="1463" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nd ne nf ng bi translated">将adminer连接到MySQL服务器(现在用户已经登录到adminer)</li><li id="95ba" class="my mz iq jp b jq nh ju ni jy nj kc nk kg nl kk nd ne nf ng bi translated">通过<code class="fe lw lx ly lz b">read data local infile</code>命令读取本地文件，将结果插入表中</li></ol><figure class="ma mb mc md gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/724644b0ce83ba9827062c3f02e525fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fi9-sFEmSVJ16N7uNiLoXg.jpeg"/></div></div></figure></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="f1ba" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">袭击</h1><p id="fec0" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">只是填写了我之前设置的服务器地址和凭证的adminer登录表单。已成功登录。</p><figure class="ma mb mc md gt mo gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/eb2ebf03dc3c8735c97bfe7dac39e9a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*RFzy-SpadSPqIIWxuHeeeQ.jpeg"/></div></figure><p id="9f67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从客户端读取文件的正确MySQL命令是</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="f74e" class="mi ku iq lz b gy mj mk l ml mm">LOAD DATA LOCAL INFILE '/etc/passwd' <br/>INTO TABLE test.test<br/>FIELDS TERMINATED BY "\n"</span></pre><p id="8f27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是:</p><figure class="ma mb mc md gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi ns"><img src="../Images/5f2809879d448ce19f2e3e5fc21be174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8b9KF0zDZfcBSujY1Ygrtw.jpeg"/></div></div></figure><p id="4427" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是啊！我有能力通过<code class="fe lw lx ly lz b">mysql</code>用户读取文件。我去读了Nginx配置文件。由于每个站点在<code class="fe lw lx ly lz b">/etc/nginx/sites-enabled/</code>中都有一个配置，但是我不知道文件名。我根据公司名称创建了一个列表，并开始强行输入名称。幸运的是，我找到了配置文件(文件名是<code class="fe lw lx ly lz b">mil.tld</code>，与原始域名相比只差了一个字母，没有<code class="fe lw lx ly lz b">.conf</code>扩展名):</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="8bc4" class="mi ku iq lz b gy mj mk l ml mm">/etc/nginx/sites-enabled/mil.tld</span></pre><p id="e9ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是:</p><figure class="ma mb mc md gt mo gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/06d1a6c0d1a497ab688366ff75c39a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*asrO1uRek8JrDvH8vV3IDw.jpeg"/></div></figure><p id="caf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想要的只是一条路。读取<code class="fe lw lx ly lz b">index.php</code>确认门户已被<a class="ae kl" href="https://laravel.com/" rel="noopener ugc nofollow" target="_blank"> Laravel </a>写入。打开<code class="fe lw lx ly lz b">database.php</code>显示了数据库的连接凭证:</p><figure class="ma mb mc md gt mo gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/755eec9966970a471b5bb6c8824b10f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*XZLkTBf8f1WqSNvsNRku7g.jpeg"/></div></figure><p id="4d44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我得到了所有数据库内的凭证显示。我用证书连接到管理员，因此，我有数据库。不幸的是，用户没有<code class="fe lw lx ly lz b">FILE</code>权限，所以我没有通过<code class="fe lw lx ly lz b">into outfile</code> MySQL查询完成上传shell脚本。然而，主要的一点是关于管理员脚本，这可能会导致在类似的情况下典当服务器。与<a class="ae kl" href="https://www.phpmyadmin.net/" rel="noopener ugc nofollow" target="_blank"> phpMyAdmin </a>相比，Admin不太安全，因为它有host字段，这使得黑客在认证前进行了几次场景攻击。作为一个例子，揭示CDNs背后的服务器的真实IP地址为<a class="ae kl" href="https://blog.christophetd.fr/bypassing-cloudflare-using-internet-wide-scan-data/" rel="noopener ugc nofollow" target="_blank"> Cloud-flare </a>。</p></div></div>    
</body>
</html>