<html>
<head>
<title>Hunting for Bugs in Damn Insecure and Vulnerable App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在该死的不安全和易受攻击的应用程序中寻找漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hunting-for-bugs-in-android-app-fe9158a556d3?source=collection_archive---------0-----------------------#2020-12-25">https://infosecwriteups.com/hunting-for-bugs-in-android-app-fe9158a556d3?source=collection_archive---------0-----------------------#2020-12-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="55e2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">DIVA安卓应用</h2></div><p id="edd1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该死的不安全易受攻击的应用DIVA <em class="le">是一个易受攻击的应用，旨在教授Android应用中发现的漏洞。这篇文章将带你发现其中的一些漏洞，并将随着我完成更多与android相关的挑战而不断更新。</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/0b33273be4a75bf57fbcc505796787c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yPe9IXgDnBpP3t52wwOrFQ.jpeg"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated"><a class="ae lv" href="https://pentesttools.net" rel="noopener ugc nofollow" target="_blank">https://pentesttools.net</a></figcaption></figure><p id="16cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第一步。</strong>此处提取<a class="ae lv" href="http://www.payatu.com/wp-content/uploads/2016/01/diva-beta.tar.gz" rel="noopener ugc nofollow" target="_blank">中的DIVA APK文件。</a></p><p id="94dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第二步。</strong>如果你想使用android Studio软件建立Android实验室，请点击这里访问我之前的文章<a class="ae lv" href="https://medium.com/bugbountywriteup/apk-testing-on-an-android-studio-c0addb12550" rel="noopener">。</a></p><p id="14ca" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">步骤三。</strong>一旦你在模拟器上运行了Diva应用程序，如果你想查看java格式的源代码，就在你的Mac或linux终端上运行<code class="fe lw lx ly lz b">jadx-gui</code>。</p><p id="d708" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">第四步。让我们开始吧！</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ma"><img src="../Images/214b9b6e948c3f78c17ebc772badf9cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEMnDf69NFnf4CIjqKN2ZQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">这是我为这个DIVA应用程序使用的一个根android模拟器。</figcaption></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mc"><img src="../Images/952de9743e3455ea260af0a9ac9b7e25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FDmCUmFTq7yBpQALnzNMXA.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="d592" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">1.不安全日志记录</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi mc"><img src="../Images/2d0ba34e3cdf59ab7f5922d862787926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRPPxSTRc3wo-HYtloGTbA.png"/></div></div></figure><p id="48d3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Android Studio终端中，访问<code class="fe lw lx ly lz b">adb</code> <strong class="kk iu"> </strong>命令的绝对路径:</p><p id="d931" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">cd ~/Library/Android/sdk/platform-tools</code></p><p id="0b0a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在启动设备模拟器外壳:<code class="fe lw lx ly lz b">./adb shell</code></p><p id="1861" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行<code class="fe lw lx ly lz b">ps</code>命令，我可以看到<strong class="kk iu"> jakhar.aseem.diva </strong>的<strong class="kk iu"> pid </strong>也就是<strong class="kk iu"> 18976 </strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nb"><img src="../Images/54f9bf8b1cffcbeffce81367b82c8f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDTkroWjR4fVz6Dt8TlTMQ.png"/></div></div></figure><p id="2495" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，要仅查看diva进程的日志，请运行以下命令:</p><p id="68df" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">logcat | grep 18976</code>或者你可以简单地运行<code class="fe lw lx ly lz b">./adb logcat</code>，这将是非常嘈杂的。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nc"><img src="../Images/656215e2764b00f347bd48bf68874080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1J1HQFbAcMyO2BeXOU8oA.png"/></div></div></figure><p id="e594" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所见，此应用程序正在记录敏感信息，如果其他应用程序拥有此设备日志的读取权限，则可以访问这些信息。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="7c1c" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">2.硬编码问题-第一部分</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nd"><img src="../Images/fc63c05c71e8aa823215cce3de1b56aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1aHqJb4Y0KIa1eRRgHLmw.png"/></div></div></figure><p id="7541" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<code class="fe lw lx ly lz b">jadx-gui</code>，我可以查看Java格式的apk源代码。注意这里的硬编码访问键。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ne"><img src="../Images/ffef68107090bdd872ee652d5218cf67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtccP1qjb9rCoDlQgDDPvQ.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nf"><img src="../Images/a769c880c5aaeafddef97fb0d510dae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MnXkT7vtvB54k45Z_6A4XA.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="64a7" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">3.不安全的数据存储第一部分</h1><p id="4455" class="pw-post-body-paragraph ki kj it kk b kl ng ju kn ko nh jx kq kr ni kt ku kv nj kx ky kz nk lb lc ld im bi translated"><em class="le">需要根设备</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nl"><img src="../Images/21839f5df804cd1c73f503e343c63c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fOt7tr33LU6SDFuwMcaRFw.png"/></div></div></figure><p id="df2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个应用程序中，我们可以看到输入的字段细节已经保存。</p><p id="a8e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Android Studio终端上启动一个根虚拟设备外壳，如下图所示，并访问保存该凭证的<strong class="kk iu"> /data/data </strong>文件夹。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nm"><img src="../Images/eeefbafd55381fd68e6d34206382340d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTRp1CG4w_YO0C5imwj3kA.png"/></div></div></figure><p id="b876" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该凭证存储在<strong class="kk iu"> shared_prefs </strong>目录下的中。我知道这一点的原因是因为在它的源代码中(在Jadx-gui中),我可以看到保存凭证的地方也有源代码中提到的SharedPreferences。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nn"><img src="../Images/94b3755096a7a99b796d5cb6daf0c847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8hyBxLFbpWGQdN_jJNhkVQ.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi no"><img src="../Images/b91952f09aa1f0bd44521d7ee28397f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WR0XsfBM8xSr_tndrBYlog.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi np"><img src="../Images/710800f89a0ccea9f27fbe7e7b16464f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LYst85c0Y66Ej0qho_cJPg.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="3883" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">4.不安全的数据存储第二部分</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nq"><img src="../Images/f47df9ae0017ccaff8d9799424d0ac02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vm5tNvwZtoegQtXUFuMwqg.png"/></div></div></figure><p id="9cf1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于第二部分，源代码表明这次凭证存储在SQL数据库中。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nr"><img src="../Images/6c9b76bc9c45f469dc383971ec5a529c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Vxzrdcl3N_dcsiYhJ4xcA.png"/></div></div></figure><p id="e628" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在数据库中有4个文件。在<strong class="kk iu"> ids2 </strong>文件内容中找到了凭证。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ns"><img src="../Images/607ed860e2c7fbe0be5472e61ce7f35f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9AUdcXdu4qnSpoh1LGqyg.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nt"><img src="../Images/0408c71a8cf93b96d660202f895805a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32sxnOLuMUgQQas7cY1jDQ.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="1aed" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">5.不安全的数据存储第三部分</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nu"><img src="../Images/5596ca8625b6acad70c530b8a360bcad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FtbCqZwvl3qScubmb-KxfA.png"/></div></div></figure><p id="ee75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">保存了左图所示的凭证后，我查看了java源代码。</p><p id="2688" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们在下图中看到的，创建了一个临时文件来保存凭据。</p><p id="a7c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">临时文件是在/data/data/jakhar.aseem.diva目录下创建的。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nv"><img src="../Images/53eeb54e0525054449a4f6c5cdc89b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tJNW3fakaoJXtgpFDkQTXA.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nw"><img src="../Images/c004127280953531ecf23e38c73fe577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YsCBBI51au0ltR-f1kH2tg.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="e6fd" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">6.不安全的数据存储第四部分</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nx"><img src="../Images/d587cd767d23f07f056398d73c5b4e89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJXSE_iJmzPVlbRdCQp1Og.png"/></div></div></figure><p id="7b6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在此任务中，当我试图保存我的凭据时，它显示“出现文件错误”。</p><p id="a5d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查看源代码，注意应用程序正在尝试将凭证存储在设备外部存储中。所以在<strong class="kk iu">设置&gt;应用权限&gt;存储&gt;天后</strong>下检查存储权限并授予访问权限</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ny"><img src="../Images/a019b4b76debe4bc13653bb0cf5d8e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nhVW5ALnj1FnAoAZAdcK8g.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nz"><img src="../Images/10fc57496f1febd959cafd3bc0ee7f06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y0TrSNdcXux1SFVPAGPlng.png"/></div></div></figure><p id="51b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在允许存储权限为Diva后，我再次尝试保存凭据，这次成功了！</p><p id="241b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在终端中，您可以看到凭证保存在<strong class="kk iu"> /sdcard/.uinfo.txt </strong>中</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oa"><img src="../Images/7f7ba4bcedca3afa3a8081cdbdd7b4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zngq8VAFIf2EKAPw0PoyjA.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/6af6ca91ee7efd547e022dda2531ad5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*ESI9Wek2Q8KbMthMkXrmgg.png"/></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="572d" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">7.输入验证问题-第一部分</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oc"><img src="../Images/b09a828cc54b6c0e7b1c42f32ec9c37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*arunbIGBBToG-_mLu2VweQ.png"/></div></div></figure><p id="c224" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该应用程序要求输入有效的用户名。如果输入的用户名是正确的，然后应用程序显示用户名密码和信用卡号码。</p><p id="cef4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于存在输入验证问题，我尝试了一个简单的SQL查询来显示用户凭证，如下所示。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="eb3c" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">8.输入验证问题-第二部分</h1><div class="lg lh li lj gt ab cb"><figure class="od lk oe of og oh oi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/5827b4a959cf9c670662c120bfcd0c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*yepnTufAm1yIRSlXi78ipw.png"/></div></figure><figure class="od lk oj of og oh oi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/c516fced26a4b67d6a5f9f45d295c563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*axZo0BH89DgCDB6XTJ8GAA.png"/></div></figure></div><p id="4ce7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我首先访问了一个web URL，看看它是否有效。接下来，我使用<strong class="kk iu"> file:/ protocol </strong>来访问这个设备中的文件，我能够从不同的位置检索所有敏感信息。</p><div class="lg lh li lj gt ab cb"><figure class="od lk ok of og oh oi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/edc51981c79844aab71b16a4c14c77b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:470/format:webp/1*MSX9Bi0LJwSyVa4ComaTJw.png"/></div></figure><figure class="od lk ol of og oh oi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/1ea4fcff098053b38e7aef5ec9bb124c.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*jG4_N_rxWXZ88PANyqTRWg.png"/></div></figure><figure class="od lk om of og oh oi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/a579e6bb173f4ad3d74869bcc021ebb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*P3wo8M8Uv9gpe-r1dQgfMg.png"/></div></figure></div></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="b6fb" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">9.访问控制问题-第一部分</h1><div class="lg lh li lj gt ab cb"><figure class="od lk on of og oh oi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/44f87e647082df4e83a66fb45fd4ddd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*Gzlgbt9tGoi2XyrdM1EpcA.png"/></div></figure><figure class="od lk oo of og oh oi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/7f6bc0faf3412795bbd9757affbaa859.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*XOxk3iJ8VHzVADuO5_LHHw.png"/></div></figure></div><p id="04a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以通过单击“查看API凭据”来查看API凭据。挑战在于从应用程序外部访问API凭证。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi op"><img src="../Images/0d5dba4a78e116ae05945dc9b68504d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4Uku-gEgR4d5qKK_QB2QQ.png"/></div></div></figure><p id="a899" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行<code class="fe lw lx ly lz b">logcat</code>查看点击“查看API凭证”按钮后会发生什么。我们可以看到这里显示的活动管理器名称和操作。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oq"><img src="../Images/5dc2e881415674edb3e02404a1b45fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dAaW-U2-EiWfGGrWHXjfoQ.png"/></div></div></figure><p id="939b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在在adb shell中运行以下命令。这将打开应用程序并显示API凭证。</p><p id="cdb2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">am start jakhar.aseem.diva/.APICredsActivity</code></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi or"><img src="../Images/7a3d025c590c99d6fd24e52b512fcdab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tr0ng1fuG4Ja_8fO4hBthA.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi os"><img src="../Images/260b799eb8be08f35526834cdabdc882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tlvCxS5wmeO4JnvztFr5Ow.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="039f" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">10.访问控制问题-第二部分</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ot"><img src="../Images/cbdd058b887c0ec1bb49abe680bcc6af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2948AmHy2LAeiKbOoJLGew.png"/></div></div></figure><p id="2aa4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里，我们需要在不知道PIN的情况下从应用程序外部访问API凭证(向应用程序注册)。</p><p id="4e12" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">点击<strong class="kk iu">“已注册”</strong>为我们提供API凭证、用户名和密码。</p><p id="5e70" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">点击<strong class="kk iu">“立即注册”</strong>要求我们输入pin。现在检查<code class="fe lw lx ly lz b">logcat</code>输出，以便进一步研究。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ou"><img src="../Images/4fa67b95802c7d89a35ba2a10668e062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9cB8xzXkTqpDNRBPGNhrGQ.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ov"><img src="../Images/b844fef36118ed5bb4fafc8cc42eb2ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5n4px5AnTf9N3QbBOrUHIw.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ow"><img src="../Images/f7c91700ca245b055511f1175e439207.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vgJxnDA3UPPeTrIbPUsoeg.png"/></div></div></figure><p id="3ce5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意chk_pin的<strong class="kk iu">实际值</strong>是<strong class="kk iu"> check_pin </strong></p><p id="f976" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们需要禁用PIN来绕过这个要求并查看API凭证。</p><p id="cb79" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从<code class="fe lw lx ly lz b">logcat</code>我们知道活动经理是<strong class="kk iu">jakhar.aseem.diva/.APICreds2Activity</strong></p><p id="fbd2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">./adb shell am start -n jakhar.aseem.diva/.APICreds2Activity --ez check_pin false</code></p><p id="d251" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le"> - n输入要进行的活动名称</em></p><p id="c88e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le"> - ez是&lt;数据&gt; &lt;布尔&gt; </em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ox"><img src="../Images/f87d8a71ee0267621f433f97d12ea0c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rA6UydSz154uSD5xfv4QGQ.png"/></div></div></figure><p id="a3e2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在检查你的android模拟器，你会发现应用程序已经打开了API证书，不需要PIN。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oy"><img src="../Images/6cc2d1201d504af1546bb947ff05a6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O89Sw5nAae71aOjgsgkpkA.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="d7d8" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">11.访问控制问题-第三部分</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oz"><img src="../Images/577e0044be06ef43319e2b3435e34369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wE23-v_enwObffztmnqGCQ.png"/></div></div></figure><p id="ad6e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该应用程序要求您创建一个PIN码，然后可以用来访问私人笔记。</p><p id="951e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用密码，我可以进入私人笔记。</p><p id="9cd8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查看。xml和。java源代码文件查找代码缺陷:</p><ul class=""><li id="4aca" class="pa pb it kk b kl km ko kp kr pc kv pd kz pe ld pf pg ph pi bi translated">AndroidManifest.xml</li><li id="1c87" class="pa pb it kk b kl pj ko pk kr pl kv pm kz pn ld pf pg ph pi bi translated">访问控制3活动</li><li id="b3a4" class="pa pb it kk b kl pj ko pk kr pl kv pm kz pn ld pf pg ph pi bi translated">访问控制3无活动</li><li id="6c30" class="pa pb it kk b kl pj ko pk kr pl kv pm kz pn ld pf pg ph pi bi translated">notes提供者</li></ul><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi po"><img src="../Images/1442ac89516efcc3784b47861df78cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-PFCAEZSQQJgW_06jkvWg.png"/></div></div></figure><p id="b636" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从<code class="fe lw lx ly lz b">logcat</code>我们可以看出活动经理是<strong class="kk iu">jakhar.aseem.diva/.AccessControl3Activity</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pp"><img src="../Images/c9718c01f7cd753a772bb2bd5a72ea56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lY-HHSJ-mUT7LFvdRTIpzw.png"/></div></div></figure><p id="9df5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">AndroidManifest.xml显示内容提供者<strong class="kk iu">JAK har . aseem . diva . provider . notes provider；android:enabled="true "和android:exported="true" </strong>这意味着其他应用程序的组件可以访问它。</p><p id="db31" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">NotesProvider.java源代码揭示了笔记保存的位置。</p><p id="c65d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">CONTENT _ URI = uri . parse(" CONTENT://JAK har . aseem . diva . provider . notes provider/notes ")；</strong></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pq"><img src="../Images/1da788a29fe0fcaeff0b75b4bbaaa8c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1VqBAwSAFx7W2P8W3lfiw.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pr"><img src="../Images/ddb51c211b89a26406dab3336a9d16aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QDv1RmH0jYNE7HtuyRbMuA.png"/></div></div></figure><p id="3e2b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行下面的命令让我能够在android studio终端中访问笔记。</p><p id="8ee5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">./adb shell content query --uri content://jakhar.aseem.diva.provider.notesprovider/notes</code></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ps"><img src="../Images/b6391c28281ff87ba2dc4b01f3670330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*To2aQCNxAMa1NhEPGocydA.png"/></div></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="d001" class="mk ml it bd mb mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">12.硬编码问题-第二部分</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pt"><img src="../Images/533319270921b14a059724323a3e5d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2w0RvjXYvWjYuOLBCbYPQ.png"/></div></div></figure><p id="f29e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">对于这个活动，我想使用逆向工程工具，而不是使用</em> <code class="fe lw lx ly lz b"><em class="le">jadx-gui</em></code> <em class="le">，因为它只将APK的dex文件反编译成java源代码。分析这些源代码需要查看库。所以)哪些</em> <code class="fe lw lx ly lz b"><em class="le">jadx-gui</em></code> <em class="le">的文件不支持。</em></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pu"><img src="../Images/41d816ba5895fcb32bbdeab260cb70c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bAF5Xo1FseoN0IuZpSEgcA.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi pv"><img src="../Images/a2a787e30eaa2fa6975e79b278a5d585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WctRyJuR6Jb7YXWrVddjWw.png"/></div></div></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/64767d5b791141fa12029a7515305805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*vQwfqcCf0OpnM4qzCYftqQ.png"/></div></figure><p id="62c6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们理解了源代码，就很容易找到供应商密钥。这里有两种不同的方法。</p><ul class=""><li id="e010" class="pa pb it kk b kl km ko kp kr pc kv pd kz pe ld pf pg ph pi bi translated"><strong class="kk iu">使用Ghidra(见以下链接)</strong></li></ul><div class="px py gp gr pz qa"><a href="https://medium.com/bugbountywriteup/how-to-use-ghidra-to-reverse-engineer-mobile-application-c2c89dc5b9aa" rel="noopener follow" target="_blank"><div class="qb ab fo"><div class="qc ab qd cl cj qe"><h2 class="bd iu gy z fp qf fr fs qg fu fw is bi translated">如何使用Ghidra对移动应用进行逆向工程</h2><div class="qh l"><h3 class="bd b gy z fp qf fr fs qg fu fw dk translated">揭开</h3></div><div class="qi l"><p class="bd b dl z fp qf fr fs qg fu fw dk translated">medium.com</p></div></div><div class="qj l"><div class="qk l ql qm qn qj qo lp qa"/></div></div></a></div><ul class=""><li id="a795" class="pa pb it kk b kl km ko kp kr pc kv pd kz pe ld pf pg ph pi bi translated"><strong class="kk iu">使用apktool </strong></li></ul><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi qp"><img src="../Images/4d459a09e5d9df8299efcc871e57ef2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d15C3ymIyTOAtYs9nr1hZg.png"/></div></div></figure><p id="a050" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过运行以下命令，从linux终端提取diva-beta.apk内容:</p><p id="ebe6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">apktool d diva-beta.apk</code></p><p id="e8dc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，查看<strong class="kk iu"> libdivajni.so </strong>文件的内容，注意任何可疑的文本，并将其输入到用户输入字段中，看看是否工作正常。</p><p id="c731" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lw lx ly lz b">strings arm64-v8a/libdivajni.so</code></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi qq"><img src="../Images/353e0b4ddc6c010d32478b7878fd82f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nN8d2SggK8_y8nMIxrdtHw.png"/></div></div></figure></div></div>    
</body>
</html>