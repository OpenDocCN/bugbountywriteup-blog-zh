<html>
<head>
<title>Everything about Cookie and Its Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于Cookie及其安全性的一切</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/everything-about-cookie-and-its-security-f5742381d6e7?source=collection_archive---------4-----------------------#2022-12-20">https://infosecwriteups.com/everything-about-cookie-and-its-security-f5742381d6e7?source=collection_archive---------4-----------------------#2022-12-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jq jr js jt gh gi paragraph-image"><div class="ab gu cl ju"><img src="../Images/4e0198a0aab7cc6d3af80a70bf102a7f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Pchf3dI0XblEn172vq9D_A.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">Vishnu R Nair 在<a class="ae kb" href="https://unsplash.com/@vishnurnair?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="e747" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">什么是饼干，为什么要用它？</strong></p><p id="8e6c" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">HTTP是一种无状态协议，这意味着它无法区分来自同一台计算机、网络或用户的两个连续请求。这是一个主要问题。由于这个原因，用户无法维持其会话，如果我们继续做同样的事情，互联网将与十年前一样，只由一堆静态html页面组成。没有用户帐户，没有定制，等等，如果有任何用户帐户，你需要登录一次又一次地访问每个页面。</p><p id="db1c" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">为了解决这个问题，HTTP必须是有状态的。答案是一块饼干。与你晚餐吃的饼干不同，这些是由你访问的网站创建的小文件。它们由web应用程序生成并存储在您的web浏览器中，以键值对的形式存在。</p><p id="55bd" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">例如:PHPSESSID: xyjaez1081lze23，lang: en </p><p id="c801" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">让我们用一个例子来理解这一点。假设你去一家商店，带回一些餐具。当你到家时，你发现其中一个坏了。所以，你去找店主，告诉他你的问题。但是令你沮丧的是，他回答说他不认识你。这是HTTP没有cookies的初始条件。网络服务器无论如何都不会认出你。</p><figure class="la lb lc ld gt jt gh gi paragraph-image"><div class="ab gu cl ju"><img src="../Images/8b5a28445ca523f2c3d43b9bbf499619.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Rdwm_jQxu0Rm2CWy_VNX2Q.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://devopedia.org/images/article/288/5564.1602410667.png" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="37f6" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">现在考虑一个不同的场景。店主给你收据。收据上有一个号码。这个号码是唯一的，可以用来识别你。他的电脑里还有一份号码的拷贝。当你返回商店时，他向你要代币。他把这个号码和他电脑上的号码进行了比对。然后他认出了你。这正是cookies的作用，与用来记住你的令牌没有什么不同。</p><p id="6e73" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">它们也可以用于各种原因。比如:</p><ol class=""><li id="5415" class="le lf it ke b kf kg kj kk kn lg kr lh kv li kz lj lk ll lm bi translated">记住你的语言偏好。例如，上面的<strong class="ke iu"> lang </strong> cookie已经被设置为<strong class="ke iu"> en。</strong>因为它们已经保存在您的浏览器上，所以会被发送到最初保存它们的站点。这个web应用程序将解析它，并向您发送网站的英文版本。</li><li id="fa57" class="le lf it ke b kf ln kj lo kn lp kr lq kv lr kz lj lk ll lm bi translated">来追踪你。他们也可以用来跟踪你的国家，城市等。</li><li id="b0e9" class="le lf it ke b kf ln kj lo kn lp kr lq kv lr kz lj lk ll lm bi translated">您访问免费服务的次数。</li><li id="57a3" class="le lf it ke b kf ln kj lo kn lp kr lq kv lr kz lj lk ll lm bi translated">最重要的是，保存你的会话数据。</li></ol><p id="838d" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">Cookie中使用了哪些不同的标志？</strong></p><p id="8713" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">它们可能是小文件，但每个cookie本身都有复杂的结构。使它变得复杂的是每个cookie中可能存在的不同标志。这些标志不过是用于不同目的的cookies的属性，或者就像可用于识别这些数字的值的名称。</p><figure class="la lb lc ld gt jt gh gi paragraph-image"><div class="ab gu cl ju"><img src="../Images/1833dcdaf96a535c065b5c8d6c979f42.png" data-original-src="https://miro.medium.com/v2/format:webp/1*P6Mux0zSoT4ffRlKjWkH9Q.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://auth0.com/docs/manage-users/cookies/samesite-cookie-attribute-changes" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="40ee" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">让我们简单地浏览一下所有的标志。</p><ol class=""><li id="c93f" class="le lf it ke b kf kg kj kk kn lg kr lh kv li kz lj lk ll lm bi translated"><strong class="ke iu">安全</strong>:可设置为真或假。如果设置为true，则仅当连接是HTTPS时才发送cookie。这可用于降低MITM攻击的风险，在这种攻击中，攻击者强迫用户浏览HTTP上的网站。如果设置了此标志，cookie将不会通过HTTP传输。</li><li id="b694" class="le lf it ke b kf ln kj lo kn lp kr lq kv lr kz lj lk ll lm bi translated"><strong class="ke iu"> HttpOnly </strong>:如果设置为true，客户端JavaScript将无法访问cookie。这可用于从窃取cookie的XSS攻击中保存cookie。因此客户端javascript将无法访问cookie</li><li id="2b26" class="le lf it ke b kf ln kj lo kn lp kr lq kv lr kz lj lk ll lm bi translated"><strong class="ke iu">域</strong>:包含cookie可以发送到的域或子域。</li><li id="322d" class="le lf it ke b kf ln kj lo kn lp kr lq kv lr kz lj lk ll lm bi translated"><strong class="ke iu">路径</strong>:每条路径上可以有不同的东西。如果开发人员想要为每个路径设置不同的cookie，他可以使用path属性来实现。</li><li id="6631" class="le lf it ke b kf ln kj lo kn lp kr lq kv lr kz lj lk ll lm bi translated"><strong class="ke iu">过期:</strong>用于定义cookie的有效期。</li><li id="c8f6" class="le lf it ke b kf ln kj lo kn lp kr lq kv lr kz lj lk ll lm bi translated"><strong class="ke iu"> SamePath </strong>:用于定义跨站点请求时cookies可以发送的条件。</li></ol><p id="9821" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">什么是域属性，它是如何在Cookie中使用的？</strong></p><p id="5fb0" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">现在让我们扩展一下cookie的域属性。顾名思义，它用于保存域名和子域名。然后，浏览器可以使用它来判断cookie需要发送到哪个域/子域，以及需要禁止从哪个域/子域发送cookie。</p><p id="0479" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">或者，您也可以将其视为设置cookie的范围。一个Web应用程序可以有多个子域，每个子域可以设置自己的cookie。</p><p id="8d31" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">让我们假设网站<a class="ae kb" href="http://www.example.com/" rel="noopener ugc nofollow" target="_blank">www.example.com</a>有4个子域名，每个子域在不同的框架上运行不同的网站。他们自己做饼干。</p><p id="acf3" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">下表很好地解释了这一点。</p><figure class="la lb lc ld gt jt gh gi paragraph-image"><div class="ab gu cl ju"><img src="../Images/0872b6105de22ec22959f24decfbefe2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*vpKNFbh4RULZo7VWnurxrA.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">各个子域的Cookies</figcaption></figure><p id="3c87" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">因此，如果你访问<a class="ae kb" href="http://www.example.com/" rel="noopener ugc nofollow" target="_blank">www.example.com</a>，网络应用程序将为你提供<strong class="ke iu">PHP sesid:wwwexample 1</strong>，作为一个cookie。它会被你的浏览器保存，当你向www.example.com的T4发送请求时，你的浏览器会向网络服务器发送完全相同的cookie。基本上，它识别cookie中的域属性，如果您访问cookie中提到的同一个域，cookie将包含在请求中。</p><p id="f03e" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">例如，如果您访问sub1.example.com，web应用程序会将JSPSESSID: sub1.example2设置为cookie。虽然域是相同的，这是example.com，但子域是不同的。因此，如果您向sub1.example.com发送一个请求，您的浏览器会将<strong class="ke iu"> JSPSESSID:sub1example2 </strong>作为一个cookie发送到web服务器。</p><p id="e7b7" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">相同站点Cookie</p><figure class="la lb lc ld gt jt gh gi paragraph-image"><div class="ab gu cl ju"><img src="../Images/1b21f4030c3329e108265cc79a46b4d4.png" data-original-src="https://miro.medium.com/v2/format:webp/1*kXGbU-RYi8cx-tWgvcLv7Q.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://blog.heroku.com/chrome-changes-samesite-cookie" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="c3fc" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">这是现代浏览器正在使用的一个新属性。</p><p id="5759" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">让我们先了解一下什么是第一方和第三方cookies:</p><p id="c00b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">第一方cookie是由与当前正在访问的域名同名的网站设置的，显示在浏览器的地址栏中。第三方cookie是来自用户当前所在域以外的域的cookie。</p><p id="19fe" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">因此，基本上，相同的站点属性修复了几个利用cookie中的域属性的漏洞(如果请求被发送到cookie中设置的域，cookie将自动包括在内)，如CSRF。</p><p id="5db7" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">因此，如果用户从abc.com被重定向到bcd.com，并且浏览器有一个域为bcd.com的cookie，它将自动包含在重定向请求中。但是，如果设置了相同的站点cookie属性，cookie将不会包含在重定向请求中。</p><p id="35b9" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">同一站点属性中有两个标志。</p><p id="749d" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">严格</strong></p><figure class="la lb lc ld gt jt gh gi paragraph-image"><div class="ab gu cl ju"><img src="../Images/b601c73899c24902c5635c43f2f6f4fb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uN_9aQzt6DBReS6rMaf4EA.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://blog.heroku.com/chrome-changes-samesite-cookie" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="b65d" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">如果设置了strict属性，那么即使用户使用常规链接，strict选项也会禁止浏览器将cookie传输到目标站点。</p><p id="b4f0" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">松懈</strong></p><p id="50c6" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">对于那些希望在用户来自外部链接后保持用户登录的网站来说，lax值是安全性和可用性之间的一个很好的平衡。因此，如果一个用户正在跟踪常规链接，cookie将包含在请求中。</p><p id="6fa3" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">结论</strong></p><p id="05b3" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">Cookies为使web有状态做出了重大贡献，但是它们也增加了攻击面。对手可以利用它们来控制特权功能、执行SQL注入、会话劫持和帐户接管。当然，所有这些都很大程度上取决于应用程序的类型和web应用程序提供的功能，以及它对cookies的依赖。曾经有过这样的例子，攻击者只需翻转cookies中的值，就可以访问只有管理员才能访问的隐藏功能。</p><p id="ae75" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">作为开发人员，您必须检查web应用程序提供了哪些功能，以及cookies是如何与web应用程序集成在一起的。cookie，尤其是会话cookie，应该很难猜测，并且必须根据您的需要设置适当的标志/属性。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h2 id="52b3" class="lz ma it bd mb mc md dn me mf mg dp mh kn mi mj mk kr ml mm mn kv mo mp mq mr bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kb" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>