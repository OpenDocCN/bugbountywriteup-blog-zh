<html>
<head>
<title>When Cookie Hijacking + HTML Injection become dangerous</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当Cookie劫持+ HTML注入变得危险时</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/when-cookie-hijacking-html-injection-become-dangerous-3c649f7f6c88?source=collection_archive---------0-----------------------#2019-01-07">https://infosecwriteups.com/when-cookie-hijacking-html-injection-become-dangerous-3c649f7f6c88?source=collection_archive---------0-----------------------#2019-01-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7161" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">朋友们好，</p><p id="cbb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一次，我将展示我如何获得html注入，以及我如何利用cookie劫持漏洞将它变成一个危险的漏洞。</p><p id="4876" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> HTML注入和Cookie劫持:</strong></p><blockquote class="kl km kn"><p id="d91c" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">HTML注入是一种注入问题，当用户能够控制输入点并能够将任意HTML代码注入易受攻击的网页时，就会发生这种问题。此漏洞可能会产生许多后果，例如泄露可用于冒充受害者的用户会话cookies，或者更一般地说，它可能允许攻击者修改受害者看到的页面内容。</p><p id="0913" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">会话劫持攻击包括利用web会话控制机制，该机制通常针对会话令牌进行管理。</p></blockquote><p id="d41b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">发现阶段:</strong></p><p id="9e31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一次，我必须对客户信息屏幕上的每个输入进行手动测试。我注意到输入没有得到预期的验证，但是如何利用这种类型的vuln，因为它需要登录帐户来“激活”HTML代码？</p><p id="e9c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一次尝试:</strong>尝试利用CSRF登录漏洞，攻击者向受害者发送定制代码，登录攻击者自己的账户。大概是这样的:</p><pre class="ks kt ku kv gt kw kx ky kz aw la bi"><span id="07b7" class="lb lc iq kx b gy ld le l lf lg">&lt;html&gt;<br/>  &lt;! - CSRF Login PoC -&gt;<br/>  &lt;body&gt;<br/>  &lt;script&gt; history.pushState ('', '', '/') &lt;/ script&gt;<br/>    &lt;form action = "https://private-company.com/account/signin" method = "POST"&gt;<br/>      &lt;input type = "hidden" name = "customerlogin" value = "attacker-email@gmail.com" /&gt;<br/>      &lt;input type = "hidden" name = "customerpassword" value = "attacker-password" /&gt;<br/>      &lt;input type = "submit" value = "Submit request" /&gt;<br/>    &lt;/ form&gt;<br/>  &lt;/ body&gt;<br/>&lt;/ html&gt;</span></pre><p id="9988" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的代码没有成功，因为该公司已经通过令牌处理了其客户的登录。</p><p id="7554" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二次尝试:</strong></p><p id="7433" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">饼干劫持！攻击成功是因为托管用户会话的令牌在注销功能后没有过期。浏览器中的cookies会一直存在，直到被手动清除。下面我来展示一下:</p><ol class=""><li id="b93a" class="lh li iq jp b jq jr ju jv jy lj kc lk kg ll kk lm ln lo lp bi translated">我用一个测试账户登录，然后点击“注销”。请注意，在下面的屏幕截图中，注销后cookies仍然存储在浏览器中:</li></ol><figure class="ks kt ku kv gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lq"><img src="../Images/ebdfb9f1c77f499f2e20179804b04dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Glrj5890a3ZUst7BaOPRQ.png"/></div></div></figure><p id="97ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.请注意，管理客户端会话的cookie的有效期是一年。</p><p id="5a58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.我用工具(<a class="ae ly" href="https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg?hl=pt-BR" rel="noopener ugc nofollow" target="_blank"> edit this cookie </a>)复制了cookie，访问了浏览器Mozilla Firefox，用之前截图中的值手动添加了cookie，然后……<strong class="jp ir">完成了！</strong>我被重定向到受害者的个人资料。</p><figure class="ks kt ku kv gt lr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/177120e24c6384888d816b6b55b2e57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*LDCadxq7Gq0UZxEYMt0ygw.png"/></div></figure><p id="6c10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">伟大的成果！是时候练习Html注入并结合这些漏洞进行更有效的演示了。</p><p id="86ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，参数“customer_name”容易受到html注入的攻击。为了确认故障的存在，我用burp suite拦截了请求，并在名称中插入了一个H1标记:</p><figure class="ks kt ku kv gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi ma"><img src="../Images/d607587cd88bf686a1b5146b60a22eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YXnWIqUOt_itVP3F9FQMTQ.png"/></div></div></figure><p id="5244" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有效载荷之后，我给自己的账户发了一封密码恢复邮件:</p><figure class="ks kt ku kv gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mb"><img src="../Images/a3c30b37211635040086a726a252bc8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cwu0LpXuBYYCvwJihS1j0g.png"/></div></div></figure><p id="3f48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">漏洞成功确认！</p><p id="2ab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">可能性:</strong></p><p id="f93d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于name参数容易受到html注入的攻击，所以可以定制一个HTML代码，使其看起来像一个表单，只对用户可见，对吗？也许…</p><p id="feec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们记住，还有一种cookie劫持vuln，它允许攻击者捕获浏览器中存储的cookie，并登录到受害者的帐户。如果应用程序在公共环境中被访问，例如局域网，那么有几种方法可以利用这个漏洞。</p><ol class=""><li id="b2ee" class="lh li iq jp b jq jr ju jv jy lj kc lk kg ll kk lm ln lo lp bi translated">受害者在一个局域网上登录了他的账户。在对公司的应用程序进行操作后，受害者通过注销功能离开账户。</li><li id="711f" class="lh li iq jp b jq mc ju md jy me kc mf kg mg kk lm ln lo lp bi translated"><em class="ko">攻击者访问与受害者相同的公共计算机，捕获cookies并登录受害者的帐户。</em></li><li id="f3f5" class="lh li iq jp b jq mc ju md jy me kc mf kg mg kk lm ln lo lp bi translated"><em class="ko">攻击者定制一个新的HTML代码并插入到易受攻击的字段中。</em></li><li id="51e1" class="lh li iq jp b jq mc ju md jy me kc mf kg mg kk lm ln lo lp bi translated"><em class="ko">受害者在重新访问帐户(在另一台设备上)时，开始看到攻击者定制的“新页面”。</em></li></ol><p id="8431" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，这需要受害者自己的互动，然而，著名的网络钓鱼攻击会有效得多。</p><p id="78e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样，黑客！希望你喜欢。</p><p id="7820" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae ly" href="https://www.linkedin.com/in/daniel-morais-968463120/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>找到我。</p></div></div>    
</body>
</html>