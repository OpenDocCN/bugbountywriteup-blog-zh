<html>
<head>
<title>An exciting journey to find SSRF , Bypass Cloudflare , and extract AWS metadata !</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">寻找SSRF、绕过Cloudflare并提取AWS元数据的激动人心的旅程！</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/an-exciting-journey-to-find-ssrf-bypass-cloudflare-and-extract-aws-metadata-fdb8be0b5f79?source=collection_archive---------1-----------------------#2021-06-13">https://infosecwriteups.com/an-exciting-journey-to-find-ssrf-bypass-cloudflare-and-extract-aws-metadata-fdb8be0b5f79?source=collection_archive---------1-----------------------#2021-06-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d1aa5804db2d1809703116a42c7d0b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UBul9Gwers0GcZEOOHkEbg.png"/></div></div></figure><p id="aabb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以上帝的名义。</p><p id="794e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗨，研究者们，</p><p id="92d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我的第一篇文章，在这篇文章中，我将与你分享我最近的令人兴奋的发现，它让我提取了aws元数据！</p><h1 id="a06a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是ssrf？</h1><p id="c3ce" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我已经知道大多数读者都知道什么是ssrf，但是为了简单的解释，让我们看看portswigger:</p><blockquote class="lz ma mb"><p id="c895" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated">服务器端请求伪造(也称为SSRF)是一个web安全漏洞，使得攻击者能够诱导服务器端应用程序向攻击者选择的任意域发出HTTP请求。</p></blockquote><h1 id="a493" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">故事:</h1><p id="efba" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我正在做一个项目，因为我没有权限透露目标的名字，就叫它redacted.com吧。</p><p id="b037" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在围绕这个程序工作了一会儿之后，我来到了一个端点，大概是这样的~ &gt;<a class="ae mg" href="https://api.onupkeep.com/api/download-pdf?url=http://c1ef8684bfb2.ngrok.io" rel="noopener ugc nofollow" target="_blank">https://redacted.com/api/download-pdf?url=</a>“http://something . com”。</p><p id="e131" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看到这个网址后，我想:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/bce7d4e0f41700d2d4232e7112f19b58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4jMnWEXK9sHcP_ceu-uNBg.jpeg"/></div></figure><p id="08f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我立即启动了我的burp collaborator，并用我的url替换了默认URL，幸运的是，我的burp collaborator收到了HTTP和DNS请求，我得到了burp页面作为响应。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/2dffe9f3607a11c67f10ef0dca131fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gmcw0r2ApTsHxT_ZuCWhug.png"/></div></div></figure><p id="c196" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我想到的第一件事是，让我们把<a class="ae mg" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a>放在那里以获得有趣的响应！</p><p id="6b6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是我得到了:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/739217b7aa3a45fd93ce704238c64333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VQMBJahcGdi9fvIpsJKbpQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">伤心:(</figcaption></figure><p id="6202" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个有保护措施，但我没有放弃，我想尽办法绕过本地主机限制，我尝试了所有这些有效负载:</p><blockquote class="lz ma mb"><p id="75b0" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://127.0.0.1:80" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:80 </a></p><p id="1e6e" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://127.0.0.1:443" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:443 </a></p><p id="153c" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://127.0.0.1:22" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:22 </a></p><p id="ac4e" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://127.1:80" rel="noopener ugc nofollow" target="_blank"> http://127.1:80 </a></p><p id="6aec" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://0" rel="noopener ugc nofollow" target="_blank"> http://0 </a></p><p id="a841" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://0.0.0.0:80" rel="noopener ugc nofollow" target="_blank"> http://0.0.0.0:80 </a></p><p id="d254" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://localhost:80" rel="noopener ugc nofollow" target="_blank"> http://localhost:80 </a></p><p id="c932" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://[::]:80/" rel="noopener ugc nofollow" target="_blank"> http://[::]:80/ </a></p><p id="617c" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated">http://[::]:25/  SMTP</p><p id="3202" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://[::]:3128/" rel="noopener ugc nofollow" target="_blank"> http://[::]:3128/ </a>鱿鱼</p><p id="8c65" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://[0000::1]:80/" rel="noopener ugc nofollow" target="_blank"> http://[0000::1]:80/ </a></p><p id="098a" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated"><a class="ae mg" href="http://[0:0:0:0:0:ffff:127.0.0.1]/thefile" rel="noopener ugc nofollow" target="_blank">http://[0:0:0:0:0:ffff:127 . 0 . 0 . 1]/the file</a></p></blockquote><p id="de4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有很多其他的，你可以在~ &gt;<a class="ae mg" href="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery" rel="noopener ugc nofollow" target="_blank">https://book . hack tricks . XYZ/pentesting-web/ssrf-server-side-request-forge</a>找到。</p><p id="e610" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">甚至我还尝试了其他协议，比如:“file:///”、“sftp://”、“gopher://”等等。</p><p id="dc20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">没有一个能用的！:(</p><p id="763f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">过了一会儿，我突然想到，为什么不尝试用“http://169.254.169.254/”来检索AWS元数据实例呢？。</p><p id="969a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我这么做了，我得到了:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/7ae51544d6121805acb24030f89b05fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkMWbL-6WxJHbrhpL2aopg.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">到处都是云闪。:@</figcaption></figure><h1 id="22c4" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">让某事发生的时间</h1><p id="2532" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我继续研究直到我发现了这个:</p><blockquote class="lz ma mb"><p id="d0ef" class="jy jz mc ka b kb kc kd ke kf kg kh ki md kk kl km me ko kp kq mf ks kt ku kv ij bi translated">有可能是服务器<strong class="ka ir">过滤了SSRF <strong class="ka ir">的原始请求</strong>，而不是</strong>对该请求的可能<strong class="ka ir">重定向</strong>响应。例如，易受SSRF攻击的服务器可能通过<code class="fe nb nc nd ne b">url=https://www.google.com/</code>过滤url参数。但是如果你使用一个<a class="ae mg" href="https://pastebin.com/raw/ywAUhFrv" rel="noopener ugc nofollow" target="_blank"> python服务器用一个302 </a>响应到你想要重定向的地方，你也许能够<strong class="ka ir">访问过滤的IP地址</strong>比如127.0.0.1，或者甚至过滤的<strong class="ka ir">协议</strong>比如gopher。</p></blockquote><p id="ff31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我启动了我的django服务器，并将这段代码插入到我的服务器中:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/72aeedbb3eda802d5ecb8591f52b46d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e31Q2Lv-7PkGsXp2-XXzoQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">我用ngrok连接到我的服务器。</figcaption></figure><p id="4703" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我发送了这个请求并获得了prod，然后我将prod放在我的django服务器中的"<a class="ae mg" href="http://169.254.169.254/latest/meta-data/iam/security-credentials/'" rel="noopener ugc nofollow" target="_blank">http://169 . 254 . 169 . 254/latest/meta-data/iam/security-credentials/</a>YOUR-PROD-HERE "之后，</p><p id="56d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后我得到了:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/e6f906f2471bd3cc558527876d7acbbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JMuS6hwwFLjPnSIBpruL_g.jpeg"/></div></div></figure><p id="545b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这之后我:</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/667ca70ce5ac0908505ca7828cf841ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2C24NSoPuo51n68vfkEiCQ.jpeg"/></div></div></figure><p id="974b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是结束，感谢您阅读我的文章希望你学到了一些东西，并希望我找到更多这样的错误与你分享！❤</p><p id="cf66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的推特:【https://twitter.com/HoseinVita T21】</p></div></div>    
</body>
</html>