<html>
<head>
<title>How to bypass certificate validation (SSL pinning)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何绕过证书验证(SSL固定)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-to-bypass-certificate-validation-ssl-pinning-ef8af8b15c40?source=collection_archive---------1-----------------------#2018-06-20">https://infosecwriteups.com/how-to-bypass-certificate-validation-ssl-pinning-ef8af8b15c40?source=collection_archive---------1-----------------------#2018-06-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ec909438748b4e5ca4261d6c66340d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pvW6WWZNIYK0fQ9N94H2g.png"/></div></div></figure><p id="8768" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章将一如既往的“如何……”这是我从上个月学到的。我写这篇文章是为了不忘记一些特别的东西，并与我所有的订户分享。很惊讶这里有这么多追随者。因为我把我学到的东西作为记事本开始写博客。</p><p id="5764" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以这个技术的想法伴随着这个问题出现在我的脑海里。一旦我测试了一个目标——我用我的打嗝代理看不到任何东西。报警出现在打嗝标签与信息连接被拒绝。握手期间远程主机关闭了连接。或者服务器收到致命警报:unknown_ca</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/df45cd160e10cb7fdd350dce4cd39cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xyl8EjchvHTQ0UqnHiLH_A.png"/></div></div></figure><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/58e89b0de290e1fe8e9266c7363d84f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XjsBJ8CBSz4v4W9FNvKPRA.png"/></div></div></figure><p id="f242" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是应用程序中的SSL pining保护，不允许使用您的打嗝代理进行常见的MITM攻击。我不是移动方面的专业人士，但我总是检查原生应用(iOS/Android)以扩展我的范围。在本地/移动应用程序中，你总能看到一些有趣的主机，或者应用程序使用的有趣路径。大多数情况下，证书问题出现在关注安全性的大品牌和勇敢的开发者身上(脸书、Instagram、优步、一些银行应用..e.t.c)</p><p id="664f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下图中情况简要说明</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/c757198f08bfe64011f95240c8a194db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*Fu0TKcF9QLnBtpcxlbXgrQ.jpeg"/></div></figure><p id="2d49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在互联网上，有一些主要的技术可以帮助你使用SSL pin:</p><ul class=""><li id="2f61" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated"><strong class="ka ir">通过反编译APK并再次编译来禁用代码中的证书锁定。</strong></li></ul><p id="5fb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于Android，使用<a class="ae lm" href="https://github.com/pxb1988/dex2jar" rel="noopener ugc nofollow" target="_blank"> Dex2jar </a>工具可以像这样<strong class="ka ir">sh d2j-dex 2 jar . sh-f your . apk</strong>。但是在这种情况下，不能保证你会在代码中找到正确的位置和正确的修复。例如，在费利佩·利马的那篇文章中，有一些制作的技巧。但正如他所说——这不是一个防弹解决方案，可能不是在所有情况下都有效，这取决于应用程序如何执行锁定或是否执行任何类型的运行时签名检查。</p><ul class=""><li id="0072" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated"><strong class="ka ir">使用手机内部的特殊工具禁用SSL锁定功能(</strong> <a class="ae lm" href="https://github.com/nabla-c0d3/ssl-kill-switch2" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> SSL锁定开关</strong> </a> <strong class="ka ir"> ) </strong></li></ul><p id="3546" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，你需要让你的iOS手机越狱。之后你的手机就不那么安全了。但在我看来，最好是使用特殊的电话，你不使用每天(又名测试设备)。</p><ul class=""><li id="34f0" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated"><strong class="ka ir">使用iOS版IPAPatch工具禁用SSL Pining</strong></li></ul><p id="2323" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此处可用<a class="ae lm" href="https://github.com/Naituw/IPAPatch" rel="noopener ugc nofollow" target="_blank">描述该工艺。这种技术允许不越狱你的手机。但是仍然需要一些应用程序ipa文件的操作(如果我错了，请纠正我)。</a></p><p id="f544" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以在我的理论中，绕过ssl绑定的最佳解决方案是——越狱设备上的SSL终止开关。</p><p id="9484" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们需要为我们的Iphone安装Jailbrake。我用了我的测试设备iPhone 5s ios 10.3.3。</p><p id="e430" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">以下是准备设备的一些步骤。</strong></p><ol class=""><li id="52e4" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv lp lj lk ll bi translated">安装Cydia安装工具— <a class="ae lm" href="http://www.cydiaimpactor.com/" rel="noopener ugc nofollow" target="_blank">撞击器</a></li><li id="6271" class="ld le iq ka b kb lq kf lr kj ls kn lt kr lu kv lp lj lk ll bi translated">然后我们需要下载越狱——我用的是<a class="ae lm" href="https://g0blin.sticktron.net/" rel="noopener ugc nofollow" target="_blank">这个</a>(iOS 10.3–10 . 3 . 3的地精wip越狱)</li></ol><p id="234f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.拖放越狱文件到撞击器区域。</p><p id="245c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.提供iphone凭证来安装此越狱</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/234e40e5c9c6bfd7cbf7de042870148a.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*SWiFiNebAFFQLeyeNUXpCw.png"/></div></figure><p id="74ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，你只需要在"<strong class="ka ir">档案&amp;设备管理"</strong>中确认你的应用程序，然后打开出现在屏幕上的小精灵应用程序，点击越狱和重启按钮。</p><p id="3492" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，你需要安装<a class="ae lm" href="https://github.com/nabla-c0d3/ssl-kill-switch2/releases" rel="noopener ugc nofollow" target="_blank"> SSL Kill Switch </a> tweak，将文件传输到iPhone。为此，我在mac上使用FileZilla，通过sftp连接到我的测试iPhone。建议你在Cydia store上用OpenSSH tweak。有了OpenSSH，将SSL Kill Switch文件传输到你的iphone就变得很容易了。</p><p id="7449" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你知道如何更容易地安装SSL Kill Switch，请在评论中告诉我:)</p><p id="97ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">成功安装后，IOS SSL删除开关开始出现在设置下。切换开关将启用/禁用锁定。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/6def1994860caba1bad232de6b12c8a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yZA6-u5zfIS3HzOnsSI2Ow.png"/></div></div></figure><p id="0f8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的情况是，我确实从一个银行应用程序绕过了SSL pin。在其他许多情况下，它对我也有效。但如果facebook应用程序或instagram应用程序对你不起作用，也不要感到惊讶。这是一个已知的问题，你可以试着用这里的评论<a class="ae lm" href="https://github.com/nabla-c0d3/ssl-kill-switch2/issues/13#issuecomment-360294883" rel="noopener ugc nofollow" target="_blank">中的补丁来修复它。</a></p><p id="d0ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">PS:下次我会尽全力去了解如何用IPAPatch工具进行管理。</p><p id="fbcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">玩得开心点，伙计们！并且有很好的渔获；)</p><p id="26a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也有帮助的链接—<a class="ae lm" href="https://infosecninja.blogspot.com/2017/05/working-with-burpsuite-mobile-assistant.html" rel="noopener ugc nofollow" target="_blank">https://infosecninja . blogspot . com/2017/05/working-with-burp suite-mobile-assistant . html</a></p></div></div>    
</body>
</html>