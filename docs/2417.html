<html>
<head>
<title>HTTP-HOST HEADER ATTACKS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTP-主机标头攻击</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/http-host-header-attacks-55ca4b7786c?source=collection_archive---------0-----------------------#2022-10-04">https://infosecwriteups.com/http-host-header-attacks-55ca4b7786c?source=collection_archive---------0-----------------------#2022-10-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6cf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨！我的名字是Hashar Mujahid，今天我们将学习如何在web应用程序中进行主机头攻击。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/ab01027681ddb66916e4cb50284c538f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wtaRvClBKL6_nmHB.jpg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">HTTP主机标头攻击</figcaption></figure><h1 id="7cf9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">主机头是什么？</strong></h1><p id="b5ce" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">通俗地说，HTTP主机头在请求中是强制的，它包含用户想要访问的网站的域名。</p><p id="6486" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，如果用户想要访问<code class="fe me mf mg mh b">youtube.com</code>。当他发送请求时，该请求的主机报头将包含youtube.com的地址。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/95b1f5440148286537fc65b48e24e180.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*kfEeqmrwMsnYoWfHCxovlw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">例子</figcaption></figure><h1 id="c730" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是HTTP主机头攻击？</h1><p id="fa8a" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">如果web应用程序不验证主机头中的值，那么攻击者可以操纵该值，并利用它将有害的有效负载注入web应用程序。此漏洞可能导致许多其他漏洞，如</p><ul class=""><li id="7a09" class="mj mk iq jp b jq jr ju jv jy ml kc mm kg mn kk mo mp mq mr bi translated">Web缓存中毒</li><li id="2839" class="mj mk iq jp b jq ms ju mt jy mu kc mv kg mw kk mo mp mq mr bi translated">SSRF</li></ul><p id="50cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在某些情况下还包括SQL注入。</p><h1 id="5435" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">它们是如何产生的？</h1><p id="9d72" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">HTTP主机头漏洞的出现是由于开发人员错误地认为用户无法控制主机头值。</p><p id="335f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">web应用程序天生信任主机头中的所有值，并且不验证它们。即使在某些情况下进行了验证，也是非常薄弱的，简单的注射可以绕过验证。</p><h1 id="990b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">主机头注入测试？</h1><p id="2904" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">主机头注入的初始测试很简单，只需在主机头中提供一个任意值，看看是否还能得到有效的响应。</p><p id="158f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><pre class="km kn ko kp gt mx mh my mz aw na bi"><span id="46fa" class="nb lc iq mh b gy nc nd l ne nf">GET / HTTP/1.1<br/>Host: www.attacker.com<br/>[...]</span></pre><p id="4e8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回应:</p><pre class="km kn ko kp gt mx mh my mz aw na bi"><span id="5697" class="nb lc iq mh b gy nc nd l ne nf">HTTP/1.1 302 Found<br/>[...]<br/>Location: http://www.attacker.com/login.php</span></pre><p id="2fbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您得到了有效的响应，这意味着目标容易受到主机标头注入的攻击。</p><p id="2b13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果应用了某种验证，您仍然可以尝试使用各种技术来绕过它，我们稍后将会看到这些技术。</p><h1 id="5210" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">可以进行哪些攻击？</h1><p id="11c1" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">攻击者可以利用此漏洞进行多次攻击。</p><p id="33f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">密码重置中毒:</strong></p><p id="ac70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者可以获得用户名或电子邮件来代表他们提交密码请求，然后他需要拦截该请求并操纵主机头，将该值更改为指向攻击者控制的域。如果主机头注入存在，攻击者将收到重置令牌，并根据自己的喜好重置密码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/984d2ce85e440b93dac4dc0c7c051ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T1vUxK-h__H7PJnsJP3Ing.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">代表受害者提交请求</figcaption></figure><p id="3d4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">拦截请求:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/f4b4e92c651f212a3d0cb0dae9ce9b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*85LgL2N3BMCa-mOjkJhCyw.png"/></div></div></figure><p id="6f68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在操纵主机头指向您的域。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/db96f84497d9854cf2fa76fba95c3a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-AkYRCoKkQXl41nXnYIvw.png"/></div></div></figure><p id="6567" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在访问日志中看到我们有一个重置令牌</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/1122b3f169dfd50fd02ccbced42b8215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zPQwYkYfpcLQWRE7rO2ovg.png"/></div></div></figure><p id="846b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在只需使用这个令牌为Carlos设置一个新密码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/f7a993c939f1989f3a74120c3a434f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jwNJnT0XCl5XDBaLdRl66w.png"/></div></div></figure><p id="f9d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">登录</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/b51603a26c2b335df087ad73163880f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QiZlAaLb1iSVBZUBVVcew.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">解决</figcaption></figure><p id="39c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到主机标头注入漏洞如何导致另一个用户的完全帐户接管。</p><p id="768a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用主机报头注入的认证旁路:</strong></p><p id="8151" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网站仅对内部用户隐藏一些功能，如管理员和网站管理员。但是，如果主机注入漏洞存在，这可以被绕过，因为开发人员作出了错误的假设，即主机标头不是用户可控制的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nm"><img src="../Images/3da529d540e53ca734df3365fdf13fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0tSP--fK3TGkZv19ptxmQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">管理</figcaption></figure><p id="70b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们没有任何凭证，也不能注册一个帐户，所以我们如何解决这个问题…</p><p id="31a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们拦截访问管理面板的请求，并尝试不同的注入。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/221cc548bb179f0836fc7a6b5450d9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HlEpZYZcXXHiabiB5QFoWg.png"/></div></div></figure><p id="8c45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们得到了一个200的响应代码，但是怎么做呢！！！</p><p id="0076" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本地主机解析为<code class="fe me mf mg mh b">127.0.0.1</code>，其中管理面板也是活动的，因此通过更改主机头，我们能够访问管理面板，从而绕过认证机制。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi no"><img src="../Images/6fffc138b60eee21ab9a6f7b6d2dd6f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZzz4jcMYmGDt8eAhuYtiw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">解决</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/8f886600f3e4b15aa6d31ea34edc3f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HUjaRARMPOv-DEdsMHb2ug.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi no"><img src="../Images/d9ddadd3cfeb0717453954b0c8beed2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NCPJHkaT9W-t59jbdPdfA.png"/></div></div></figure><p id="b36b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在接下来的博客中，我们将看到如何利用这个漏洞来执行SSRF和Web缓存中毒以及许多其他高级技术。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h2 id="9ad2" class="nb lc iq bd ld nw nx dn lh ny nz dp ll jy oa ob lp kc oc od lt kg oe of lx og bi translated">现在终于到了讨论如何绕过主机标头中的验证的时候了，这将有助于执行未来的实验。</h2><h2 id="3c2d" class="nb lc iq bd ld nw nx dn lh ny nz dp ll jy oa ob lp kc oc od lt kg oe of lx og bi translated"><strong class="ak">绕过主机头注入验证:</strong></h2><p id="322e" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">有时web应用程序确实会验证主机头中的内容，但是这种验证有时也可以使用各种技术绕过。</p><p id="4dfa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将在这里讨论其中的一些。</p><p id="c5b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">主机头重复:</strong></p><p id="e8db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将插入2个主机头，其中一个将包含恶意的有效载荷，另一个将是原始的，但你可能会有一个问题，这将如何帮助我们绕过验证。</p><p id="2e7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">答案是，其中一个主机头将覆盖另一个主机头的值。我们无法确定哪个主机头将工作并被接受，但不同的技术和系统会以不同的方式处理这一过程。</p><pre class="km kn ko kp gt mx mh my mz aw na bi"><span id="baae" class="nb lc iq mh b gy nc nd l ne nf">GET /example HTTP/1.1 <br/>Host: vulnerable-website.com <br/>Host: evil.com</span></pre><p id="08f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">或</strong></p><pre class="km kn ko kp gt mx mh my mz aw na bi"><span id="86f9" class="nb lc iq mh b gy nc nd l ne nf">GET /example HTTP/1.1 <br/>Host: bad-stuff-here<br/>Host: vulnerable-website.com</span></pre><p id="8f82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">添加换行:</strong></p><p id="4786" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这与插入重复的主机头是一样的，但在主机头中有缩进，服务器将把缩进的头解释为换行，因此，把它作为前一个头的值的一部分。不同的服务器对这种技术会有不同的反应。</p><pre class="km kn ko kp gt mx mh my mz aw na bi"><span id="18b3" class="nb lc iq mh b gy nc nd l ne nf">GET /example HTTP/1.1 <br/>    Host: bad-stuff-here<br/>Host: vulnerable-website.com</span></pre><p id="6d13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注入主机覆盖头:</strong></p><p id="9130" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果主机头被验证，你可以尝试注入一些HTTP方法来覆盖主机头中的值。</p><pre class="km kn ko kp gt mx mh my mz aw na bi"><span id="5e4a" class="nb lc iq mh b gy nc nd l ne nf">GET /example HTTP/1.1 <br/>Host: vulnerable-website.com<br/><strong class="mh ir">X-Forwarded-Host: evil.com<br/></strong><strong class="mh ir">X-Forwarded-Server: </strong><strong class="mh ir">evil.com</strong><strong class="mh ir"><br/>X-HTTP-Host-Override: </strong><strong class="mh ir">evil.com</strong><strong class="mh ir"><br/>Forwarded: </strong><strong class="mh ir">evil.com</strong></span></pre><p id="bb71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">提供绝对URL: </strong></p><p id="e01f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以尝试在<code class="fe me mf mg mh b">GET</code>请求中注入绝对路径或URL，将主机改为evil，看看服务器是否用200响应码响应我们。</p><p id="e674" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><pre class="km kn ko kp gt mx mh my mz aw na bi"><span id="810e" class="nb lc iq mh b gy nc nd l ne nf">GET <strong class="mh ir">https://vulnerable-website.com/</strong> HTTP/1.1 <br/><strong class="mh ir">Host: evil.com</strong></span></pre><p id="423f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一篇博客中，我们将看到如何通过链接主机头注入漏洞来执行不同的攻击。</p><p id="88a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之前，快乐的黑客❤</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oh oi l"/></div></figure><h2 id="2675" class="nb lc iq bd ld nw nx dn lh ny nz dp ll jy oa ob lp kc oc od lt kg oe of lx og bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae oj" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>