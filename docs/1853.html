<html>
<head>
<title>PRACTICAL MALWARE ANALYSIS LAB PART — I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实用恶意软件分析实验室第一部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/practical-malware-analysis-lab-part-i-12e39598a77?source=collection_archive---------2-----------------------#2022-01-30">https://infosecwriteups.com/practical-malware-analysis-lab-part-i-12e39598a77?source=collection_archive---------2-----------------------#2022-01-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi ju"><img src="../Images/8926fb84472d20e18c4453fb376cbbe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t1fNSUsRtbZDiUuiSeTFfA.png"/></div></div></figure><p id="ebf2" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">本实验室使用Lab01–01.exe和Lab01–01.dll的文件。使用本章中描述的工具和技术来获取有关文件的信息，并回答下面的问题。</p><p id="1f9e" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">问题</p><ol class=""><li id="fb83" class="le lf iq ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">将文件上传到http://www.VirusTotal.com/<a class="ae ln" href="http://www.VirusTotal.com/" rel="noopener ugc nofollow" target="_blank">并查看报告。这两个文件是否匹配任何现有的防病毒签名？</a></li></ol><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi lo"><img src="../Images/d9e356a6374650368b6bb9d7e4b93d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0TZHgg7p5bVTjZI-clScw.png"/></div></div></figure><p id="d763" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">这是第一个dll文件。这里我们可以看到VirusTotal将该文件识别为恶意文件。这意味着该文件与恶意文件的签名相匹配。</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi lp"><img src="../Images/32f6105f436f5249e5e7707a87aa9bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xA0ddV_VR8D8eYYaziPOKg.png"/></div></div></figure><p id="f2b7" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">分析第二份文件。它是一个exe(可执行)文件。是的，和第一个一样。证明这个是恶意文件。给定的两个文件是恶意文件。许多反病毒软件检测到这些文件与以前发现的恶意文件的特征相匹配。</p><p id="22b9" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">2)这些文件是何时编译的？</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi lq"><img src="../Images/0043d53ef83021c7b16c44102028826f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_cCIiU8tnnPsPnNCoa7uQ.png"/></div></div></figure><p id="0f5d" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">打开“virustotal详细信息”部分，我们可以看到大量关于恶意文件的详细信息。创建时间与编译时间相同。是exe文件的编译时间。</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi lr"><img src="../Images/7c04a9e9627659541de87267542cc56a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q-IvRFcs3845OLSqkXihRw.png"/></div></div></figure><p id="776e" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">这里我们可以看到dll文件的编译时间。</p><p id="7b85" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">3)是否有迹象表明这些文件被打包或混淆了？<br/>如果是，这些指标是什么？</p><p id="ceab" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">在大多数情况下，恶意软件是打包的。打包器有什么用？很简单。打包程序用于压缩或加密整个程序。它完全改变了程序的结构，很难分析。这是恶意软件作者停止或阻止分析阶段的主要目的。许多打包程序都可以在互联网上找到。在大多数情况下，他们使用其中任何一种。</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/fcd1a03aeda2561b2de3ca6c1e92c05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*h35AvQ-7VY8bimn6R-HyBw.png"/></div></figure><p id="9df8" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">PEiD是一个用于检测程序所使用的打包程序的工具。这里我们可以看到微软Visual C++ 6.0 Dll。但不是打包机。它是一个编译器</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/c4852b7d03feec698f9958035901c1d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*w-cvv922JnhQNpUSY7KBHQ.png"/></div></figure><p id="f347" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">与Dll相同。这两个程序都不使用任何类型的打包程序。但是PEiD太旧了。但这已经足够了</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi lu"><img src="../Images/b5827bc76018afb958672964a4d6123e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G-pkg3hfJEUTZd38SxD-hw.png"/></div></div></figure><p id="d6ff" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">在这里，我介绍一个我最喜欢的和最强大的工具来检测包装。众所周知，检测它很容易。这是一个免费的开源工具，而且非常有效。它给你一个深度报告。</p><p id="f45d" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">4)是否有任何导入暗示了该恶意软件的作用？如果有，它们是哪些进口<br/>？</p><p id="d383" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">大多数恶意软件和其他软件程序都在系统库中使用。为什么？这种方法有助于减小程序的规模，提高工作效率。所以在恶意软件执行时，它会导入系统库函数。如果恶意软件动态链接到库，我们可以通过分析PE头找到导入的库函数</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi lv"><img src="../Images/4e17ace00cd58f1aa079002820b022ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jFuBik3pPpQ8QNxWQxRThA.png"/></div></div></figure><p id="a576" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">在dll的情况下。这里我使用PEstudio来分析可移植的可执行文件。它收集与该可执行文件相关的所有数据。在导入部分，我们可以看到恶意软件使用的库和函数</p><p id="13b4" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">kernel32.dll，ws2_32.dll，msvcrt.dll这个库就是恶意软件用的。</p><blockquote class="lw lx ly"><p id="d290" class="kg kh lz ki b kj kk kl km kn ko kp kq ma ks kt ku mb kw kx ky mc la lb lc ld ij bi translated">内核32。dll文件是一个32位动态链接库文件，在Windows中用于<strong class="ki ir">处理内存管理、输入/输出操作、中断、同步和进程创建</strong>。</p><p id="0c0e" class="kg kh lz ki b kj kk kl km kn ko kp kq ma ks kt ku mb kw kx ky mc la lb lc ld ij bi translated">ws2_32。dll是一个动态链接库，用于<strong class="ki ir">处理网络连接</strong>。它是一个与软件进程相关的小程序，类似于EXE文件，但是它不给出命令。dll文件允许应用程序进行通信。</p><p id="3d12" class="kg kh lz ki b kj kk kl km kn ko kp kq ma ks kt ku mb kw kx ky mc la lb lc ld ij bi translated">msvcrt.dll是一个包含标准C库函数的模块，比如printf、memcpy和cos。它是Microsoft C运行时库的一部分。</p></blockquote><p id="be84" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">我们可以看到一些不需要的函数调用。在某些情况下，它是恶意的</p><ul class=""><li id="fa87" class="le lf iq ki b kj kk kn ko kr lg kv lh kz li ld md lk ll lm bi translated">CreateProcess:这个函数创建并启动一个新的进程。如果恶意软件创建了一个新进程，也需要对新进程进行分析。</li><li id="8c74" class="le lf iq ki b kj me kn mf kr mg kv mh kz mi ld md lk ll lm bi translated">CreateMutexA:该函数创建一个互斥对象，恶意软件可以使用该对象来确保在任何给定的时间只有一个恶意软件实例在系统上运行。恶意软件通常对互斥体使用固定的名称，这可以是检测恶意软件附加安装的良好的基于主机的指示器。</li></ul><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi mj"><img src="../Images/1ee0f8b93e9420b5f3db41ff0d32af26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hseyiTk1euCswuxtcmqy2g.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">LAB001.exe</figcaption></figure><p id="e040" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">在EXE的情况下，</p><ul class=""><li id="5750" class="le lf iq ki b kj kk kn ko kr lg kv lh kz li ld md lk ll lm bi translated">CreateFile:创建新文件或打开现有文件。</li><li id="01d4" class="le lf iq ki b kj me kn mf kr mg kv mh kz mi ld md lk ll lm bi translated">FindFirstFile/FindNextFile:这个函数用于搜索一个目录并枚举文件系统。</li><li id="b922" class="le lf iq ki b kj me kn mf kr mg kv mh kz mi ld md lk ll lm bi translated">CopyFileA:将现有文件复制到新文件中。</li></ul><p id="ffed" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">5)在受感染的系统上，有没有其他文件或基于主机的指标可以让您查找<br/>？</p><p id="c564" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">这里我们需要检查琴弦。它打印文件中可打印字符的序列。我们发现dll和exe不是打包的可执行文件，所以我们可以从字符串中找到一些有趣的东西</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi mo"><img src="../Images/e73b24e195e78685c936c24f9f5fb165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qs6pmxudOb9kuMxresr8Ww.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">LAB001.dll</figcaption></figure><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi lo"><img src="../Images/505dc4392366596dc0cc9a0791791857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hEt8tZ7uZVGc1AxEDDYelw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">LAB001.exe</figcaption></figure><p id="6ce6" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">6)哪些基于网络的指标可用于在<br/>受感染的机器上发现该恶意软件？</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi mo"><img src="../Images/e73b24e195e78685c936c24f9f5fb165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qs6pmxudOb9kuMxresr8Ww.png"/></div></div></figure><p id="603c" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">在这里，您可以看到字符串中存在一个ip地址。有时，该可执行文件会创建一个到该ip地址的外部连接。不确定</p><p id="e68b" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">7)您认为这些文件的用途是什么？</p><p id="a9a4" class="pw-post-body-paragraph kg kh iq ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">我认为这是一个间谍软件或后门。因为它的库函数和字符串信息提供了一种恶意的方法。但我是个菜鸟，所以这些是我的发现。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="e5e8" class="mp mq iq bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae ln" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><p id="b11f" class="pw-post-body-paragraph kg kh iq ki b kj nn kl km kn no kp kq kr np kt ku kv nq kx ky kz nr lb lc ld ij bi translated"><a class="ae ln" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank"><strong class="ki ir">https://iwcon.live/</strong></a></p></div></div>    
</body>
</html>