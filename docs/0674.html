<html>
<head>
<title>My First Bug: Blind SSRF Through Profile Picture Upload</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的第一个错误:盲目的SSRF通过个人资料图片上传</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/my-first-bug-blind-ssrf-through-profile-picture-upload-72f00fd27bc6?source=collection_archive---------0-----------------------#2020-07-08">https://infosecwriteups.com/my-first-bug-blind-ssrf-through-profile-picture-upload-72f00fd27bc6?source=collection_archive---------0-----------------------#2020-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/32a7fc446e3064d69a86950f6d2cea58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GQapgwVcvnk_n_h0"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@ryoji__iwata?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">岩田良治</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="cc2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大家好！这是为我的第一只虫子写的，一只SSRF！</p><p id="fe7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的下一篇文章很可能是关于我学习bugbounty hunting的具体方法，我希望这对新手有很大的帮助。欢迎在medium或twitter上关注我的最新消息。都是:<a class="lb lc ep" href="https://medium.com/u/3e3753492422?source=post_page-----72f00fd27bc6--------------------------------" rel="noopener" target="_blank">@ sway thinking</a></p><h1 id="7d20" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">概述:</h1><ul class=""><li id="afa4" class="mb mc iq kf b kg md kk me ko mf ks mg kw mh la mi mj mk ml bi translated">对新bug猎人的激励和建议…</li><li id="181a" class="mb mc iq kf b kg mm kk mn ko mo ks mp kw mq la mi mj mk ml bi translated">我第一个bug的故事！</li><li id="58d5" class="mb mc iq kf b kg mm kk mn ko mo ks mp kw mq la mi mj mk ml bi translated">学分和额外资源…</li></ul><h1 id="8726" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">对于初学者:</h1><p id="7579" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">在我发现这个甜蜜的bug之前，我连续几天/几周攻击了11个不同的目标(大部分是私人程序)。随着我的进步，有一件事我一直记在心里，即使我没有得到我一直想象中的bugbounty会是什么样子，我也从每个目标身上获得了一些新的东西。</p><p id="3441" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每次我坐下来开始研究一个新的目标时，我都会遇到一些新的有趣的东西，这激发了我的好奇心。这促使我去搜索、询问、阅读和了解这一切。这就像是一只猎犬，捕捉到一种气味，毫不留情地跟踪它，直到你找到它。</p><blockquote class="mu mv mw"><p id="723d" class="kd ke mx kf b kg kh ki kj kk kl km kn my kp kq kr mz kt ku kv na kx ky kz la ij bi translated">"我们总是通过<strong class="kf ir">发现</strong>我们怀疑的东西来为我们的怀疑付出代价."—亨利·D·T</p></blockquote><p id="5556" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过所有这些尝试，我了解了很多不同的漏洞，比如JWT、伊多、XXE，还有我的第一个漏洞SSRF。</p><p id="d9b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有一点我想对那些没有动力的黑客们说清楚，不要把你的奖金或者被分类/解决的错误作为衡量你成功的标准，而是你学到了什么新的东西，你建立了什么新的在线联系，以及你帮助过的其他人。</p><h1 id="1970" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">我第一个bug的故事！</h1><h2 id="9466" class="nb le iq bd lf nc nd dn lj ne nf dp ln ko ng nh lr ks ni nj lv kw nk nl lz nm bi translated">我是如何发现这个bug的:</h2><p id="7af7" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">有一天，我通过CTF在Hackerone上收到了一个私人节目邀请。但是这一天，当我接受邀请时，我有了一个锦囊妙计。我打算花一周的时间专注于这个项目，而不去黑任何其他项目。</p><p id="8e3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">两天之内我就提交了这个bug的报告。T11】</p><p id="47c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我认为有几件事对我特别有帮助。首先，在入侵这个程序之前，我确保我有一些入侵程序的方法和思维导图。前一天我在whimsical.com做了一个，这对我的结构真的有帮助。</p><p id="10de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第一天:</strong></p><p id="c468" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我清单上的第一个bug，也是我花了整个五月学习的一个bug是SSRF。</p><p id="85a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我开始搜索。我发现了一堆带有URL参数和外部链接的可疑端点，所有这些通常都会导致SSRF。然而，重点是我感觉到程序中有几个范围内的域，并且我收获了一些可疑的端点。</p><p id="3d0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">第二天:</strong></p><p id="1c64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在其中一个域上，我发现它们在POST请求中严重依赖XML HTTP请求。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/c56a6852211b33ae34e723af86438558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/1*X3FmOetN4hJIrXaI_CvfTQ.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">*利息水平飙升*</figcaption></figure><p id="3f74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我决定，为什么不呢，让我们尝试XXE的方法而不是SSRF。我把请求的主体改成了一堆不同的XXE有效载荷，但是什么也没有。最后，我决定尝试黑进我的头像的个人资料图片上传。</p><p id="ccf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是有趣的地方。当我看到POST请求上传我的图片时，我意识到这只是一个内容类型的请求，并且主体中有原始图片。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/8ebd96c5564f5c2d29c1641edc66df0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VckDXsmYUZO5Uxlc5S_UXg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">我的帖子请求</figcaption></figure><p id="2f60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我用一个SVG来代替它，看看服务器是否会接受它，并用它来获得更大的攻击面。这是我恶意的SVG图片:</p><pre class="no np nq nr gt nt nu nv nw aw nx bi"><span id="c0d3" class="nb le iq nu b gy ny nz l oa ob">&lt;svg xmlns:svg="<a class="ae kc" href="http://www.w3.org/2000/svg" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2000/svg</a>" ae kc" href="http://www.w3.org/2000/svg" rel="noopener ugc nofollow" target="_blank"&gt;http://www.w3.org/2000/svg" xmlns:xlink="<a class="ae kc" href="http://www.w3.org/1999/xlink" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/1999/xlink</a>" width="200" height="200"&gt; <br/>&lt;image height="30" width="30" <br/>xlink:href="https://controlledserver.com/pic.svg" /&gt; <br/>&lt;/svg&gt;</span></pre><p id="2ab2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在SVG中，使用xlink:href属性，以便服务器请求带有任何提供的URL的图像。引号内的任何图像URL都将作为svg图像上传。通过这一点，我获得了盲目的SSRF在互联网上的任何网址与图像扩展端点。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/a3d784b88d44af9e83106ab436e42781.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/1*0ycqHUJdh6VXovVPdhhA_A.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">实际上是我。</figcaption></figure><h2 id="fad0" class="nb le iq bd lf nc nd dn lj ne nf dp ln ko ng nh lr ks ni nj lv kw nk nl lz nm bi translated">你如何证明影响力？</h2><p id="da8c" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">通过上传恶意图片，我能够:</p><ul class=""><li id="8ac5" class="mb mc iq kf b kg kh kk kl ko od ks oe kw of la mi mj mk ml bi translated">将GET请求作为它们的服务器发送到任何结尾带有图像扩展名的HTTPS URL。</li><li id="7ce8" class="mb mc iq kf b kg mm kk mn ko mo ks mp kw mq la mi mj mk ml bi translated">通过放入到URI的内部路径，对他们的库进行指纹识别，这样我就可以上传内部服务器文件。</li><li id="ccdb" class="mb mc iq kf b kg mm kk mn ko mo ks mp kw mq la mi mj mk ml bi translated">用一个静态的XXE覆盖我的图像，在上面写下我想写的任何东西。</li><li id="8f58" class="mb mc iq kf b kg mm kk mn ko mo ks mp kw mq la mi mj mk ml bi translated">与此同时，我还能够执行臭名昭著的<a class="ae kc" href="https://medium.com/@swaysthinking/kill-em-with-laughter-the-billion-laughs-attack-through-image-uploads-4e9c57ca6434" rel="noopener">十亿次大笑攻击</a>，尽管DOS很遗憾地超出了范围。查看我的博客了解更多信息！</li></ul><h1 id="ee60" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">学分和额外资源</h1><p id="a9f7" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">本博客的修改归功于:</p><blockquote class="mu mv mw"><p id="e174" class="kd ke mx kf b kg kh ki kj kk kl km kn my kp kq kr mz kt ku kv na kx ky kz la ij bi translated"><a class="lb lc ep" href="https://medium.com/u/bc01c676b36f?source=post_page-----72f00fd27bc6--------------------------------" rel="noopener" target="_blank">卢修斯·福克斯</a></p></blockquote><p id="7dff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">作者结论:</strong></p><p id="7ca7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">抱歉，如果这看起来很短！这是我的第一个bug，所以我想写一篇关于它的文章。这里有一些额外的资源，如果你感兴趣的话，可以随意查看。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div class="gh gi og"><img src="../Images/69aa890d86f16d1d1c816131af9ccec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*ghrM5EC2PHj6nmKM4UqO5Q.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">和平了，你们所有人…冷静思考</figcaption></figure><p id="0e4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于那些想比我解释的更深入一点的bugbounty猎人来说，看看这个惊人的<a class="ae kc" href="https://hackerone.com/reports/223203" rel="noopener ugc nofollow" target="_blank">报告</a>关于<a class="ae kc" href="https://hackerone.com/reports/223203" rel="noopener ugc nofollow" target="_blank"> hackerone </a>关于我所做的事情的精确复制。</p><div class="oh oi gp gr oj ok"><a href="https://hackerone.com/reports/223203" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">HackerOne上披露的shopify:SVG服务器端请求伪造(SSRF)</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">我发现一个问题似乎是以下问题的倒退:https://hackerone.com/reports/97501。似乎…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">hackerone.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy jw ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a href="https://medium.com/@swaysthinking/kill-em-with-laughter-the-billion-laughs-attack-through-image-uploads-4e9c57ca6434" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">用笑声杀死他们:“十亿个笑声”通过图片上传攻击</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">黑客总是笑到最后。</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy jw ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a href="https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-perform-ssrf" rel="noopener  ugc nofollow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">实验室:利用XXE实施SSRF攻击|网络安全学院</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">这个实验有一个“Check stock”特性，它解析XML输入并在响应中返回任何意外的值。实验室…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">portswigger.net</p></div></div><div class="ot l"><div class="pa l ov ow ox ot oy jw ok"/></div></div></a></div></div></div>    
</body>
</html>