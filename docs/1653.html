<html>
<head>
<title>TALE OF A VULNERABILITY WHICH LEADS TO ACCOUNT TAKEOVER OF GOVERNMENT ANDROID APPLICATION</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">导致政府ANDROID应用程序帐户被接管的漏洞故事</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tale-of-a-vulnerability-which-leads-to-account-takeover-of-government-android-application-998eaf5adb4d?source=collection_archive---------1-----------------------#2021-10-23">https://infosecwriteups.com/tale-of-a-vulnerability-which-leads-to-account-takeover-of-government-android-application-998eaf5adb4d?source=collection_archive---------1-----------------------#2021-10-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b97e31228fcfd2e4bad7f33b48c3f786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Dnd9woqoHQ7qyx9mk1C6w.jpeg"/></div></div></figure><blockquote class="jy jz ka"><p id="df0c" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">议程</strong>:</p></blockquote><p id="29ea" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">。了解漏洞需要知道的事情</p><p id="b19b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">。此漏洞的描述</p><p id="e1be" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">。识别步骤</p><p id="61df" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">。影响</p><p id="c4e8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">。结论</p><blockquote class="jy jz ka"><p id="156e" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">了解漏洞要知道的事情</strong></p></blockquote><p id="2ee0" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">1.什么是深度链接，深度链接是如何工作的</p><p id="69b2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">2.对O-Auth的基本理解</p><p id="f1ef" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><a class="ae ld" href="https://medium.com/@cappriciosec/how-i-hacked-billion-android-users-social-and-3rd-party-account-a-story-about-5000-bug-c422ca43bd2" rel="noopener">我请求你阅读我以前的博客</a>来理解这个漏洞的工作原理。</p><blockquote class="jy jz ka"><p id="4639" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> <em class="iq">描述</em> </strong> <em class="iq"> : </em></p></blockquote><p id="f3c5" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">任何集成了O-AUTH和自定义DEEPLINK的移动应用程序都会出现这种错误。如果应用程序信任此O-AUTH和自定义深度链接，就有可能利用此漏洞。</p><p id="7685" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir"> <em class="kd">错误配置的O-AUTH DEEPLINK导致帐户被接管</em> </strong></p><p id="73cd" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir">注:</strong> <em class="kd">申请名称不能公开。</em>让我们考虑术语“易受攻击的应用程序”,以深入理解本博客的全部内容。</p><p id="3d51" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">在本应用中，有3种O-Auth登录方式:</em></p><p id="a3c7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">。谷歌OAuth </em></p><p id="16a2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">。微软OAuth </em></p><p id="9744" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">。苹果ID OAuth </em></p><p id="0f4e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">让我们考虑一下这个场景</p><p id="9331" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">当用户打开易受攻击的应用程序并试图使用OAuth功能(特别是Microsoft O-Auth)登录时，它会触发您手机的默认浏览器并要求Microsoft凭据。成功登录后，它将在自定义深度链接(该自定义深度链接包含用户的OAuth令牌)的帮助下自动重定向并触发应用程序。</em></p><p id="f670" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">在之前的博客</em> <a class="ae ld" href="https://medium.com/@cappriciosec/how-i-hacked-billion-android-users-social-and-3rd-party-account-a-story-about-5000-bug-c422ca43bd2" rel="noopener"> <em class="kd"> &lt;链接&gt; </em> </a> <em class="kd">中我已经提到，深度链接配置不当的情况下，部分android应用容易受到这种攻击。</em></p><p id="d07e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir">执行的操作</strong> <em class="kd">:如果之前提到的深度链接恶意软件应用程序被重新设计，就有可能劫持易受攻击的应用程序O-Auth深度链接。</em></p><p id="55c8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">所以现在恶意软件应用程序安装在我的手机上，重复相同的登录过程，但这一次恶意软件应用程序用有效的O-Auth令牌劫持了深度链接。就是这样，通过这个过程，恶意软件应用程序被成功劫持。</em></p><p id="3ed6" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">为了便于理解:</em></p><p id="ac33" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">这是深层链接的一个例子:</em></p><p id="ec70" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd"> vulnerableapp://login？token=ffdryur6iukit7tu756 </em></p><blockquote class="jy jz ka"><p id="dc4c" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">识别步骤:</p></blockquote><p id="25d7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">1.检查任何应用程序中的O-AUTH登录，并检查当您尝试使用O-AUTH登录时是否会触发任何移动浏览器应用程序。</p><p id="f221" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">2.检查JSON文件是否存在于那个特定的应用程序域中(即【https://vulnerable.com】T2/)。众所周知的/assetlinks.json。如果该文件不存在，则可能易受攻击。</p><p id="2614" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">3.用同样易受攻击的应用程序DEEPLINK创建恶意软件应用程序，现在尝试用O-AUTH登录。</p><p id="b463" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir">恶意软件代码</strong></p><p id="c01c" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">将此整合到android manifest.xml文件中，并与您易受攻击的应用程序深度链接</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="188d" class="ln lo iq lj b gy lp lq l lr ls">&lt;intent-filter&gt;<br/>  &lt;data android:scheme="vulnerableapp" android:host="login" /&gt;<br/>&lt;/intent-filter&gt;</span></pre><p id="de7a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">主要Activity.java电码</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="12f9" class="ln lo iq lj b gy lp lq l lr ls">@Override<br/>public void onCreate(Bundle savedInstanceState) {<br/>    super.onCreate(savedInstanceState);<br/>    setContentView(R.layout.main);</span><span id="7e4c" class="ln lo iq lj b gy lt lq l lr ls">    TextView text = (TextView) findViewById(R.id.tid);<br/>    Intent intent = getIntent();<br/>    String action = intent.getAction();<br/>    Uri data = intent.getData();<br/>    text.setText(data.toString());</span><span id="b4c4" class="ln lo iq lj b gy lt lq l lr ls">}</span></pre><p id="8d18" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">该代码用于获取深度链接数据并将其设置为恶意软件应用程序-文本视图，恶意软件应用程序不需要任何权限来执行此攻击。</p><p id="a1a7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir">影响:</strong></p><p id="cdcb" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">利用这个漏洞，很有可能接管账户</em></p><p id="b115" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir">结论:</strong></p><p id="ab35" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">为了确保这一点，请添加。授权域内知名/assetlinks.json。任何O-AUTH登录活动都应仅在该应用程序中执行，但如果它要求允许在任何未知的第三方应用程序中输入凭据，则登录是不安全的。</em></p><p id="b725" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><em class="kd">希望你明白这个漏洞的影响。如果你想了解手机应用程序bug bounty，请点击下面的链接</em></p><p id="d879" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><a class="ae ld" href="https://university.cappriciosec.com/mobileappbugbounty.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="kd">链接</em> </strong> </a></p><p id="2421" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">大学链接<a class="ae ld" href="https://university.cappriciosec.com/" rel="noopener ugc nofollow" target="_blank">https://university.cappriciosec.com/</a></p><p id="35f3" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir">学分</strong></p><p id="01b6" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir"><em class="kd"/></strong><em class="kd">发现的漏洞:-</em><a class="ae ld" href="http://karthithehacker.com" rel="noopener ugc nofollow" target="_blank"><em class="kd">karthihehacker</em></a><em class="kd">(</em><a class="ae ld" href="https://medium.com/u/a14784d94f2c?source=post_page-----c422ca43bd2--------------------------------" rel="noopener"><em class="kd">Karthikeyan)。</em></a>V<em class="kd"/></p><p id="d163" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">作者:- <a class="ae ld" href="https://www.linkedin.com/in/agnes-rusaliya-3b18481b7/" rel="noopener ugc nofollow" target="_blank">艾格尼丝·鲁莎莉娅</a></p><p id="0f71" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><strong class="ke ir">-谢谢</strong></p></div></div>    
</body>
</html>