<html>
<head>
<title>HacktheBox — Postman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客信箱——邮递员</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-postman-2f539f63aa?source=collection_archive---------0-----------------------#2020-03-14">https://infosecwriteups.com/hackthebox-postman-2f539f63aa?source=collection_archive---------0-----------------------#2020-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a3c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于我如何从<a class="ae kl" href="http://hackthebox.eu" rel="noopener ugc nofollow" target="_blank"> Hack the Box </a>解决Postman的文章，这是一个在线平台，在这里你可以玩各种CTF并练习你的渗透测试技能。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/93f321dca59ebe842870dadb9128c336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*2j3KMD5ILPENt6Jkm9bhEg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">https://www.hackthebox.eu/home/machines/profile/215<a class="ae kl" href="https://www.hackthebox.eu/home/machines/profile/215" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><h1 id="54eb" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="ad8e" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">来自Hack the Box的Postman是一个容易评级的盒子，它包括利用一个错误配置的Redis服务，允许您在盒子中放置ssh的公钥。它导致了一个加密的SSH私有密钥，这个密钥很容易被John破解从而获得用户。对于root，我使用Metasploit利用了一个经过验证的漏洞。</p><h1 id="ccab" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">扫描</h1><p id="bef7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我首先用-sV(确定服务/版本信息)和-sC(在端口上运行默认的nmap脚本)运行一个nmap扫描，将其保存为所有格式(-oA)，称之为initial:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="6b7f" class="mg kz iq mc b gy mh mi l mj mk">nmap -sV -sC -oA nmap/initial 10.10.10.160</span></pre><p id="a23f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果显示运行OpenSSH 7.6p1的端口22，运行Apache httpd 2.4.29的端口80，运行miniserver 1.910(Webmin httpd)的端口10000。注意它提到盒子是Ubuntu。我不会为SSH费心，因为这个版本是最新的，而且最近没有对OpenSSH的利用，这在这种情况下是有用的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/a64c61aaac82fe74734bfae517553a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A__gBs3bhd0JB_dSFPVTHg.png"/></div></div></figure><p id="8d4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还用-p- flag扫描了所有TCP端口。请注意，nmap仅扫描前1000个端口(不按顺序，但实际上是前1000个常用端口)。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="3fb8" class="mg kz iq mc b gy mh mi l mj mk">nmap -p- --max-retries 1 -oA nmap/allports-tcp 10.10.10.160</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/69bb6bca341cf422e04f8743a0d25c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*gvYMz1i5jcP8Wpug0Duu4A.png"/></div></figure><p id="00b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它显示端口6379是开放的，这是我的初始扫描所遗漏的。</p><h2 id="bd2c" class="mg kz iq bd la mr ms dn le mt mu dp li jy mv mw lm kc mx my lq kg mz na lu nb bi translated">端口80</h2><p id="c77f" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">访问页面，它提到它正在建设中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nc"><img src="../Images/8c2dae4ae9d524b97bb3fab94f169a11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ik5bR64rgSLSskjYCKAgQ.png"/></div></div></figure><p id="72c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向下滚动提到一个“postman@htb”，还有一个关于cookies的东西。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/a2f1c89bb15228efd6a75a57dcbfdb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*h7vXe6y02CyDOGDqRo450Q.png"/></div></figure><p id="c00b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我运行<a class="ae kl" href="https://github.com/OJ/gobuster" rel="noopener ugc nofollow" target="_blank"> Gobuster </a>来检查感兴趣的目录:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="467f" class="mg kz iq mc b gy mh mi l mj mk">gobuster dir -u <a class="ae kl" href="http://10.10.10.160" rel="noopener ugc nofollow" target="_blank">http://10.10.10.160</a> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o gobuster-root</span></pre><p id="aa85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果显示一个上传文件夹:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/3deb8f3aa4ef11b64b0359c3e55297d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*6XtA_0GKbPng8eo2T202jA.png"/></div></figure><p id="184f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问/上传时，我可以看到网站中使用的图片。我在其他目录中没有发现什么有趣的东西。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/aa56f5bd2c0da19345149344e9deec9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*4I1B_DaacJIoFj1GjrbMIg.png"/></div></figure><h2 id="e8b6" class="mg kz iq bd la mr ms dn le mt mu dp li jy mv mw lm kc mx my lq kg mz na lu nb bi translated">端口10000</h2><p id="29a0" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">由于端口80中没有任何有趣的东西，所以我访问了端口10000，它提到web服务器正在SSL模式下运行。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ng"><img src="../Images/d87fec2de362d0d81b74c6eb4d116b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ZFTmQyW7_GqGd734Z_7Tw.png"/></div></div></figure><p id="4a63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还在hosts文件(/etc/hosts)中添加了一个条目，因为我在解决这个问题时使用的是Kali。访问该页面向服务器邮递员显示登录页面。</p><blockquote class="nh ni nj"><p id="dc16" class="jn jo nk jp b jq jr js jt ju jv jw jx nl jz ka kb nm kd ke kf nn kh ki kj kk ij bi translated">Webmin是用于Unix系统管理的基于web的界面。使用任何现代的网络浏览器，你可以设置用户账户，Apache，DNS，文件共享等等。</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/9c30824e415d474a2c13c4ab03caeb52.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*llXHluk81UB0GVyDsL3qlg.png"/></div></figure><p id="f667" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试使用admin:admin这样的基本凭证登录，但它不起作用:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi np"><img src="../Images/a61969937f6d55186a439d0d2f02a611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3RrNxxEkBDEk_dJ2MuJkA.png"/></div></div></figure><p id="e6a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于它是用于Unix系统管理的基于web的界面，所以我检查了searchsploit，看是否有我可以利用的漏洞:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/3d7cb74ea97d48f59ef8ec808689488c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*2nqqrZhYyfLJehN2xEqD2Q.png"/></div></figure><p id="f2c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为Webmin运行的是1.910版，所以只有少数漏洞可用。一个漏洞是1.910版的RCE，在检查该漏洞时需要有效的登录。</p><h2 id="c537" class="mg kz iq bd la mr ms dn le mt mu dp li jy mv mw lm kc mx my lq kg mz na lu nb bi translated">端口6379 — Redis</h2><p id="1792" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我现在尝试深入研究Redis服务。</p><blockquote class="nh ni nj"><p id="f44e" class="jn jo nk jp b jq jr js jt ju jv jw jx nl jz ka kb nm kd ke kf nn kh ki kj kk ij bi translated">Redis是一个开源的(BSD许可的)、内存中的数据结构存储，用作数据库、缓存和消息代理。它支持数据结构，如字符串、哈希、列表、集合、带有范围查询的排序集合、位图、超级日志、带有radius查询的地理空间索引和流。</p></blockquote><p id="0ba5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先寻找与Redis服务交互的方法。常见的方式有使用telnet和使用redis-cli。当我最初解决这个问题时，我使用telnet，但是对于这篇文章，我使用redis-cli。在这种情况下，使用redis-cli要容易得多，但是最好知道您可以使用telnet与它进行交互。</p><p id="1081" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我首先检查我是否连接正确:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/08e824dd75855f1229244d3cad1cde95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*hWiblo6UAE1o_mpmrckmmA.png"/></div></figure><p id="bcc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我检查我所在的当前目录:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ns"><img src="../Images/31fd5f9b5a0907f9d5becb20e66b06a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*WazBQsb69XWqNndx9HnApQ.png"/></div></div></figure><p id="c787" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发现我在/var/lib/redis，我尝试是否可以改变目录。我这样做是为了看看我是否能猜出这个Redis用户可以访问哪些目录。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/4d31141ca09cfe3b806155732db6f916.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*_mOhorgLQnCqsV-4ANtvOw.png"/></div></figure><p id="979c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我运行config get *来列出所有支持的配置参数。突出的一点是“authorized_keys”。我通常在SSH目录中遇到这种情况。authorized_keys文件包含用户的公钥，这些用户可以使用基于密钥的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/770c020828242021f8b8d2990455fa45.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*f4kPt6SmXz7Aeg4dJQjMSA.png"/></div></figure><p id="0472" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">/var/lib/redis/也有一个条目。ssh:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/49afd0fd855ed3950962860c83ed8c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*uwMYppGsNXUGb1XxPHTypA.png"/></div></figure><p id="9ca8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试着把我的目录改成:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/1aed1f2f7ed5ab93936c3f85111f2d80.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*ItG-8nqbEZC8xl3_1fYl4Q.png"/></div></figure><p id="2b09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">明知一个/。ssh目录在redis文件夹中，然后我寻找关于如何使用/利用Redis的文章。宋承宪又看到了这个页面:<a class="ae kl" href="http://antirez.com/news/96" rel="noopener ugc nofollow" target="_blank">http://antirez.com/news/96</a>。我建议您阅读它，以了解更多关于Redis安全错误配置的信息。</p><p id="bf18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我使用ssh-keygen命令生成一个ssh密钥对:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d307e9c63032548f9876a4f5ba2e6d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*nMPEHnxL8J_04hkmhWg4lw.png"/></div></figure><p id="06d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我使用换行符保存公钥的内容，以确保格式一致:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="8f8b" class="mg kz iq mc b gy mh mi l mj mk">(echo -e "\n\n"; cat sifo.pub; echo -e "\n\n") &gt; foo.txt</span></pre><p id="0843" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我将内容传送到redis-cli命令，并将其转储到内存中:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="fcc7" class="mg kz iq mc b gy mh mi l mj mk">cat foo.txt | redis-cli -h 10.10.10.160  -x set crackit</span></pre><p id="7c24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我将内存中的内容保存到一个名为authorized_keys的文件中</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/d49701449e37905e60f9b847afc3902a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*cAh_DmPmwSyC4KIK9H2CLQ.png"/></div></figure><p id="4cbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我尝试使用Redis用户进行SSH，并且能够这样做。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/8373bbc9ad07c796376e4e0b529ed060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*Qp5vDKOI4RvtgC6iE_Aemw.png"/></div></figure><h2 id="40cd" class="mg kz iq bd la mr ms dn le mt mu dp li jy mv mw lm kc mx my lq kg mz na lu nb bi translated">Redis → Matt</h2><p id="e9e6" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">检查当前目录中的文件，我试图读取bash_history文件中的内容。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/514a88b31aa32c5f7b8d78f0f2c89853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*YGnrKpKOjS11-5d4O9eQDg.png"/></div></figure><p id="a01e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">bash_history文件中有一个“su Matt”条目，提到了一个“id_rsa.bak”和一个sshd_config。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi oa"><img src="../Images/aeeaef8654ae371522d3e0b692b32475.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*dB49bVV9ZuAiPPiQhSHIYA.png"/></div></div></figure><p id="a6b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查了passwd文件，发现有一个用户问题。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/0368b52be14e9e11938ec4ea7cb272cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*hE-MTDzdtvmQK2jrFxnEyA.png"/></div></figure><p id="5514" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我检查Matt拥有的文件:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="df67" class="mg kz iq mc b gy mh mi l mj mk">redis@Postman:~$ find / -user Matt 2&gt;/dev/null<br/>/opt/id_rsa.bak<br/>/home/Matt<br/>/home/Matt/.bashrc<br/>/home/Matt/.bash_history<br/>/home/Matt/.gnupg<br/>/home/Matt/.ssh<br/>/home/Matt/user.txt<br/>/home/Matt/.selected_editor<br/>/home/Matt/.local<br/>/home/Matt/.local/share<br/>/home/Matt/.profile<br/>/home/Matt/.cache<br/>/home/Matt/.wget-hsts<br/>/home/Matt/.bash_logout<br/>/var/www/SimpleHTTPPutServer.py</span></pre><p id="2dda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">似乎/opt中存储了一个id_rsa文件的备份(通常是用于SSH的私钥)。我使用netcat将文件移动到我的机器上:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/bd81fd3f14afd1a1e533500da1fe9631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*TKOdUs3NCJCTz_ArXn0_lg.png"/></div></figure><p id="18da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查它的内容，它是加密的:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/c92f2ab59b77edae5a96273a20304652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*HLqrXaghuLSzxQRsHF4c4g.png"/></div></figure><p id="64e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我试着用约翰破解它。我首先必须将文件转换成John可以接受的格式。这可以使用ssh2john.py来完成:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="b610" class="mg kz iq mc b gy mh mi l mj mk">ssh2john.py id_rsa.bak &gt; id_rsa.enc</span></pre><p id="450d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我用约翰破解它:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="11a1" class="mg kz iq mc b gy mh mi l mj mk">john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa.enc</span></pre><p id="c37d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">密码是电脑2008。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi oe"><img src="../Images/22c3ef1948264e7dad679206d06ffa5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fruo3IRDQ7nHmN4qYTyoow.png"/></div></div></figure><p id="40c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我尝试使用私钥登录，当被要求输入密码时，使用computer2008:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi of"><img src="../Images/16dea33a6180b841e40cf7b3c9af8433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BueZquKD0cydd-uvJXODxw.png"/></div></div></figure><p id="e47e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">登录不成功，提示我以root身份登录，要求我输入密码。我试着使用密码computer2008切换到用户Matt，结果成功了。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi og"><img src="../Images/41d9cfc5a46dac81a36d8b385a8ae176.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*VvDTFz1tU8g7-YQqPOE14Q.png"/></div></div></figure><p id="10ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在可以读取user.txt:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="4455" class="mg kz iq mc b gy mh mi l mj mk">Matt@Postman:~$ cat user.txt <br/>517ad0ec24....</span></pre><h2 id="fb18" class="mg kz iq bd la mr ms dn le mt mu dp li jy mv mw lm kc mx my lq kg mz na lu nb bi translated">马特→根</h2><p id="f7c4" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">然后我检查正在运行的进程，发现Webmin正在以root用户身份运行:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi oh"><img src="../Images/b3a5b56cb201ddb406f27f1b651f7174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hld-SIii26d2MfCyfvAC7w.png"/></div></div></figure><p id="db08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试使用凭据Matt:computer2008登录，并且成功了！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi oi"><img src="../Images/350868ae5cab1dfb373fb54c386e5bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34UcxJy48PstZyphvLCMVQ.png"/></div></div></figure><p id="539e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我回到前面提到的需要凭证的利用。该漏洞使得有权访问“软件包更新”模块的用户能够以超级用户权限执行任意命令。漏洞和利用的细节可以在这里找到:<a class="ae kl" href="https://www.cvedetails.com/cve/CVE-2019-12840/" rel="noopener ugc nofollow" target="_blank">https://www.cvedetails.com/cve/CVE-2019-12840/</a></p><p id="2b2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我运行Metasploit并使用exploit/Linux/http/webmin _ package up _ rce。设置的选项如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi oj"><img src="../Images/b7bd3cfb3ea3ee272047e871191dacbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PM1T8jA-MNLOEh05_PLVw.png"/></div></div></figure><p id="d11d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行该漏洞会导致根外壳:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ok"><img src="../Images/62d110928aa11fbb380856daf8359261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vcomnDH-ECQW5BK_mJGAZQ.png"/></div></div></figure><p id="60b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我可以读root.txt了..</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="6070" class="mg kz iq mc b gy mh mi l mj mk">cat /root/root.txt<br/>a257741c5bed8b....</span></pre><p id="e37a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查了/etc/ssh/sshd_config，发现Matt被拒绝使用ssh登录，因此它无法工作。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/a2077e3cd4227e504c324a3e8c031576.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*5Dho9G_UyGGQVTqe0jz9dA.png"/></div></figure><p id="825d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还试图获得一个shell，我可以通过使用bash -c:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi om"><img src="../Images/f0a894536d9918fa62db82a11570a8f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Afg5PSMlvBbd1nKzfhAoIQ.png"/></div></div></figure><p id="e131" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查了root主目录下的文件，发现bash_history不是空的，它的大小是14350个字符，这意味着也许我可以看到盒子的创建者是如何制作盒子的:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/becd2de2160abd66ef390977ec927dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*PXQWggn8NlPI1_Rl9XErcA.png"/></div></figure><p id="9c57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查前几个命令，它显示了用户如何安装ssh、安装net-tools和添加用户Matt😺</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/f19cb5775b9348c0bcd4bc18cc15e3f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*owFcw8FemI_9JQJx8jcwIg.png"/></div></figure><p id="d1a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我就是这样解决黑客盒子里的邮差的！这是一个非常漫长的旅程，但绝对值得！感谢阅读！🍺</p></div><div class="ab cl op oq hu or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ij ik il im in"><p id="3641" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nk">关注</em> <a class="ae kl" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="nk"> Infosec报道</em> </a> <em class="nk">获取更多此类精彩报道。</em></p><div class="ow ox gp gr oy oz"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="pa ab fo"><div class="pb ab pc cl cj pd"><h2 class="bd ir gy z fp pe fr fs pf fu fw ip bi translated">信息安全报道</h2><div class="pg l"><h3 class="bd b gy z fp pe fr fs pf fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ph l"><p class="bd b dl z fp pe fr fs pf fu fw dk translated">medium.com</p></div></div><div class="pi l"><div class="pj l pk pl pm pi pn ks oz"/></div></div></a></div></div></div>    
</body>
</html>