<html>
<head>
<title>DEFCON 2016 Quals writeup — feedme</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DEFCON 2016 Quals报道— feedme</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/defcon-2016-quals-writeup-feedme-4d90167b448d?source=collection_archive---------2-----------------------#2020-08-10">https://infosecwriteups.com/defcon-2016-quals-writeup-feedme-4d90167b448d?source=collection_archive---------2-----------------------#2020-08-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bba4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨，伙计们，欢迎回到另一篇CTF评论。这次我将向你展示我是如何解决DEFCON 2016 Quals的pwn挑战feedme的。</p><p id="0241" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">先说一点历史:在解决了picoCTF2019 <strong class="jp ir"> <em class="kl">除了</em> </strong>对于幽灵日记、Sice-scream、零到英雄的大部分pwn挑战后，我就厌烦了。主要是因为我是一个完全的新手:/——所以我还不能解决它们……然后一个想法出现在我的脑海中:让我们尝试解决过去DEFCON任务中的1 pwn挑战——一个就够了。于是我搜索了过去的DEFCON任务，偶然发现了这个:<a class="ae km" href="https://github.com/guyinatuxedo/nightmare/tree/master/modules/07-bof_static/dcquals16_feedme" rel="noopener ugc nofollow" target="_blank">https://github . com/guyinatuxedo/nightmare/tree/master/modules/07-BOF _ static/dcquals16 _ feed me</a></p><blockquote class="kn ko kp"><p id="31c2" class="jn jo kl jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">这个回购收集了从初学者到高级的过去事件的许多pwn挑战。我很高兴我找到了这个。于是喊出<br/> <strong class="jp ir"> <em class="iq"> guyinatuxedo，noopnoop，数字寒</em> </strong>和<strong class="jp ir"> <em class="iq">你走近</em> </strong>争夺这个奇妙的资源<strong class="jp ir"> <em class="iq">。</em> </strong></p></blockquote><p id="8094" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要再耽搁了，让我们开始吧。</p><p id="78fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行它:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/807317a6c1c9fe92e3f236219fa76693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvz9yD_W3zK0AXjcc2kRwA.png"/></div></div></figure><p id="4e28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以给它两个输入。显然，我们打碎了堆栈金丝雀，但<em class="kl"> pwntools检测不到金丝雀:(</em>...它说进程终止，子进程退出。然后我不停的“<em class="kl">砸</em>”:)它不停的催生另一个进程。所以我的猜测是程序一次又一次的分叉。</p><p id="c443" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好像是堆栈<strong class="jp ir"> bof </strong>(缓冲区溢出)漏洞。因为它再次打印出我们的输入，所以我尝试使用格式字符串说明符来泄漏金丝雀，但是不起作用:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lf"><img src="../Images/ce23e1b82eb1d5ea201ba8452051347d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJiI5u38-BizpGAPmp5Mew.png"/></div></div></figure><p id="e811" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在Ghidra中打开它，看看发生了什么:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lg"><img src="../Images/5e8842f65695da725d1d82afffc6090f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MK1D0uHTqiZzCV4kWJwM9Q.png"/></div></div></figure><p id="362b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们得到了很多乐趣..功能。我们可以浏览所有这些文件，看看哪个打印出了字符串<em class="kl"> "FEED ME" </em>，或者我们可以搜索对它的引用:</p><ul class=""><li id="6c0c" class="lh li iq jp b jq jr ju jv jy lj kc lk kg ll kk lm ln lo lp bi translated">进入搜索= &gt;内存= &gt;选择字符串，然后输入FEED ME:</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lg"><img src="../Images/61192975d5567f4033f9254f5bbd3c6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hWRuu1AEwHyCt6bRrP_1ow.png"/></div></div></figure><ul class=""><li id="162f" class="lh li iq jp b jq jr ju jv jy lj kc lk kg ll kk lm ln lo lp bi translated">然后双击表格中的位置。选择引用= &gt;显示对地址的引用:</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lg"><img src="../Images/52b318ba613f6bcab21f89bc227dab27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHvh7XWRN37y3rxLDaG8rg.png"/></div></div></figure><p id="c863" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将我们引向我们正在寻找的功能:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lg"><img src="../Images/ad67e6f10d201ab5546ee6b78756c90c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b1l1bsi5Rw0KSTZgUaUWXQ.png"/></div></div></figure><p id="5b6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了更容易理解，我重命名了这些函数。第一个函数只是打印出“喂我！”所以我猜是<strong class="jp ir"> <em class="kl">放</em> </strong>。之后，通过使用一些动态分析，我发现第一个允许我们输入第二行输入的<strong class="jp ir">大小=输入中第一个字符</strong>的ASCII码。因此，如果我们输入“123456 ”,那么第二行的输入大小将是49——在ASCII表中是“1”。然后我们给程序输入第二个输入。在那之后，我猜想下一个函数只是返回指向第二个输入的前16个字符的指针，因为它在下一行与格式说明符"<em class="kl"> %s </em>"一起使用。</p><p id="a4a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，我们知道我们可以给它两个输入，大小在我们的控制之下，我们有一个堆栈金丝雀。</p><blockquote class="kn ko kp"><p id="bdc7" class="jn jo kl jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">对于Canary来说，虽然每次同一个进程重启时金丝雀都不一样(同GS，GS重启)，但是同一个进程中每个线程的金丝雀都是一样的。还有就是通过fork函数打开子进程交互的类，<strong class="jp ir">因为fork函数直接复制父进程的内存，所以创建的每个子进程的金丝雀都是一样的</strong>。我们可以使用这个特性完全逐个字节地爆炸金丝雀。</p><p id="86e3" class="jn jo kl jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated"><a class="ae km" href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/mitigation/canary/" rel="noopener ugc nofollow" target="_blank">https://CTF-wiki . github . io/CTF-wiki/pwn/Linux/remediation/canary/</a></p></blockquote><p id="eb31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，我们可以强暴金丝雀。我想知道我们的尝试次数是否有限制。看看是谁在调用<strong class="jp ir"> feed_me_func。</strong>右键功能= &gt;显示引用:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lg"><img src="../Images/cad7f96ca20b79436d491043a76fd4af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0evBC8AbcnpQsd0LlyjuHA.png"/></div></div></figure><p id="90a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是一个noob，所以根据while循环，我猜想我们有800次尝试:D，我们也没有看到前面输出中的行"<em class="kl"> YUM，got blah blah blah </em>"。这是因为当程序发现我们打碎了金丝雀，它就终止了。因此，如果我们不打碎金丝雀，我们会在输出中看到那条线。这非常有助于我们知道在我们的暴力中我们是否猜到了正确的字节(对于金丝雀)。</p><p id="90f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们知道<strong class="jp ir"> <em class="kl"> NX被启用</em> </strong>所以我们最好的射击是ROP。注意，我们必须给程序正确的输入大小，因为只有当我们给它输入了我们说过的确切的字节数时，进程才会继续，否则它只会等待我们给它输入更多的字节。我花了5分钟才意识到:D</p><p id="0a49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，计划是对金丝雀进行简单的逐字节暴力。这最多花费我们256*3 = 768次尝试(在32位中，金丝雀的最后一个字节将总是\x00 = &gt;金丝雀看起来像XXXXXX00)，我们有800次尝试(我猜是xD)。然后用我们的ROP链覆盖EIP。由于二进制文件是静态链接的，我们可以用ROPgadgets在其中搜索ROP gadgets。</p><blockquote class="kn ko kp"><p id="e2e9" class="jn jo kl jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">当您<strong class="jp ir">静态地</strong>将一个文件链接到一个可执行文件中时，该文件的内容会在链接时包含进来。换句话说，文件的内容被物理地插入到您将要运行的可执行文件中。</p></blockquote><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lq"><img src="../Images/33e32c3d0a7b3b12fce1821221dfa563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v0gxfzFwFcImZj9PbFj2-A.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">粗暴对待金丝雀</figcaption></figure><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lv"><img src="../Images/d7c111af4f4f305247a9ed10feb17b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3Ejo9r0otvgSKF8TvJwQQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">ROP链</figcaption></figure><p id="c538" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们运行它，并希望它的工作:D</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lw"><img src="../Images/247c338684f17b36f7cd12f2313353e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TrJm75DkrMvmNeLhYdEXQg.png"/></div></div></figure><p id="7e26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哦——从没想过像我这样的菜鸟能解决DEFCON的一个挑战，甚至只是资格赛。</p><p id="9836" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论如何，这是一次很棒的经历，我从中学到了很多。非常感谢<strong class="jp ir">噩梦</strong>的作者创造了如此精彩的资源。希望这对您有所帮助，感谢您的阅读:)</p><p id="7e6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你有任何问题，请随时给我发邮件(链接在下面)！黑客快乐！</p><p id="bac6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特:【https://twitter.com/pwnphofun T4】</p><p id="c35d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">github:<a class="ae km" href="https://github.com/wechicken456" rel="noopener ugc nofollow" target="_blank">https://github.com/wechicken456</a></p><p id="7887" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不和谐:tuz#9881</p></div></div>    
</body>
</html>