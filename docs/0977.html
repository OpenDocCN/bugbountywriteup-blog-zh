<html>
<head>
<title>JavaScript Parser to Create Abstract Syntax Tree(AST): Acorn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建抽象语法树(AST)的JavaScript解析器:Acorn</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/javascript-parser-to-create-abstract-syntax-tree-ast-acorn-be9bbfe91bed?source=collection_archive---------5-----------------------#2020-11-22">https://infosecwriteups.com/javascript-parser-to-create-abstract-syntax-tree-ast-acorn-be9bbfe91bed?source=collection_archive---------5-----------------------#2020-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0c4926bd3b2c79c34c169292b6b20ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I4s8XSBohgaezXxgbe2RBA.png"/></div></div></figure><h1 id="7fe5" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">0.前言</h1><p id="ea13" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">JavaScript解析器——Acorn和AST是很有用的东西。它们帮助我们自动高效地编辑源代码。这篇文章向你展示了如何构建和编辑JavaScript代码的AST。</p><p id="a680" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">这个帖子的出处是:<a class="ae lz" href="https://pwnbykenny.com/2020/07/21/javascript-parser-to-create-abstract-syntax-treeast-acorn/" rel="noopener ugc nofollow" target="_blank"> JavaScript解析器创建抽象语法树(AST): Acorn — Pwn作者Kenny </a>。更多类似内容，可以访问这里:<a class="ae lz" href="https://pwnbykenny.com/" rel="noopener ugc nofollow" target="_blank">博士&amp;自动开发JIT编译器— Pwn作者肯尼</a>。这是我的个人网站。欢迎光临！</p><h1 id="9d8d" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">1.内容</h1><ul class=""><li id="073b" class="ma mb iq ky b kz la ld le lh mc ll md lp me lt mf mg mh mi bi translated"><a class="ae lz" href="https://pwnbykenny.com/2020/07/21/javascript-parser-to-create-abstract-syntax-treeast-acorn/#install" rel="noopener ugc nofollow" target="_blank">安装JavaScript解析器— Acorn </a></li><li id="c17b" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated"><a class="ae lz" href="https://pwnbykenny.com/2020/07/21/javascript-parser-to-create-abstract-syntax-treeast-acorn/#create" rel="noopener ugc nofollow" target="_blank">使用Acorn创建抽象语法树</a></li><li id="37a8" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated"><a class="ae lz" href="https://pwnbykenny.com/2020/07/21/javascript-parser-to-create-abstract-syntax-treeast-acorn/#structure" rel="noopener ugc nofollow" target="_blank">理解抽象语法树的结构</a></li><li id="ceb5" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated"><a class="ae lz" href="https://pwnbykenny.com/2020/07/21/javascript-parser-to-create-abstract-syntax-treeast-acorn/#traverse" rel="noopener ugc nofollow" target="_blank">使用Node.js遍历抽象语法树</a></li><li id="770e" class="ma mb iq ky b kz mj ld mk lh ml ll mm lp mn lt mf mg mh mi bi translated"><a class="ae lz" href="https://pwnbykenny.com/2020/07/21/javascript-parser-to-create-abstract-syntax-treeast-acorn/#summary" rel="noopener ugc nofollow" target="_blank">总结</a></li></ul><h1 id="3f76" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">2.安装JavaScript解析器— Acorn</h1><p id="455a" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">引用github <a class="ae lz" href="https://github.com/acornjs/acorn" rel="noopener ugc nofollow" target="_blank">库</a>的话，Acorn是一个小型快速的JavaScript解析器，完全用JavaScript编写，在MIT许可下发布。Acorn可以为JavaScript代码生成抽象语法树。它有3个模块:名为“acorn”的主JavaScript解析器，名为“acorn-loose”的容错解析器，名为“acorn-walk”的语法树遍历器。这篇文章主要关注主解析器。在本节中，我们将介绍它的安装。</p><p id="ee59" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">安装很容易。你只需要在Linux终端运行这个命令:“npm install acorn”。然后，您将看到在当前目录中创建了一个名为“node_modules”的文件夹。并且你会在这个目录下看到可执行的acorn文件:“node_modules/acorn/bin/”。下一节将介绍如何使用它。</p><h1 id="c6a9" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">3.使用Acorn创建AST</h1><p id="b630" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们将在这个目录下创建一个名为“hello.js”的JavaScript文件:“node_modules/acorn/bin/”。这个文件的内容是" var str = ' hello"。接下来，我们在终端中运行这个命令:“acorn hello.js”。然后，您将在终端中看到一个输出。输出是hello.js中JavaScript代码的AST。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="f580" class="mx jz iq mt b gy my mz l na nb">{<br/>  "type": "Program",<br/>  "start": 0,<br/>  "end": 19,<br/>  "body": [<br/>    {<br/>      "type": "VariableDeclaration",<br/>      "start": 0,<br/>      "end": 18,<br/>      "declarations": [<br/>        {<br/>          "type": "VariableDeclarator",<br/>          "start": 4,<br/>          "end": 17,<br/>          "id": {<br/>            "type": "Identifier",<br/>            "start": 4,<br/>            "end": 7,<br/>            "name": "str"<br/>          },<br/>          "init": {<br/>            "type": "Literal",<br/>            "start": 10,<br/>            "end": 17,<br/>            "value": "hello",<br/>            "raw": "'hello'"<br/>          }<br/>        }<br/>      ],<br/>      "kind": "var"<br/>    }<br/>  ],<br/>  "sourceType": "script"<br/>}</span></pre><h1 id="49a9" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">4.理解AST的结构</h1><p id="efdd" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">本节使用第3节中的AST作为示例。AST最重要的是它的节点。毕竟，树是由节点组成的。在上面的AST中，每个节点都以“{”开头，以“}”结尾。根据节点类型的不同，每个节点的结构也略有不同。</p><p id="7941" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">但是所有节点的共同点是它们都有三个属性:类型、开始和结束。“类型”属性指示节点的类型。例如，它可以是“标识符”,这意味着节点保存了一个变量名或函数名等。“开始”和“结束”属性指示节点在源代码中的开始和结束位置。例如，“标识符”节点保存名称“str”。在源代码中，该名称从第4个(闭)字符开始，到第7个(开)字符结束:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="65ee" class="mx jz iq mt b gy my mz l na nb">v a r   s t r   =   '  h  e  l  l  o  '  ;<br/>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17</span></pre><p id="b192" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">除了这3个属性之外，其他属性取决于节点类型。例如,“标识符”节点有一个属性“名称”,因为它记录了一个名称。“Literal”节点有两个附加属性“value”和“raw ”,因为它记录字符串、数字等文字。节点类型太多，无法在此列出。但是您总是可以通过使用acorn解析一些JavaScript代码来找出节点类型的结构，就像hello.js示例一样。你会在AST中找到这个结构。</p><p id="89d3" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">理解了节点的结构之后，您可以通过访问每个节点的属性来遍历AST。每个节点通过其属性连接到其子节点。下一节给出了一个如何遍历AST的例子。</p><h1 id="e34a" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">5.使用Node.js来遍历AST</h1><p id="19f7" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">万一你不知道Node.js，我给你简单描述一下。Node.js是一个JavaScript解释器。它建立在v8之上。Node.js和v8的区别在于，v8运行在浏览器(前端)，而Node.js运行在服务器(后端)。安装Node.js后，可以用它来执行JavaScript代码，像这样:node hello.js。</p><p id="406f" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">在这一节中，我将给出一些代码来遍历第3节中的AST。这只是一个简单的例子，让你知道遍历是如何工作的。代码保存在“node_modules/acorn/bin/”目录下名为“ast.js”的文件中，由Node.js使用以下命令执行:node ast.js。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="b97a" class="mx jz iq mt b gy my mz l na nb">class Visitor {<br/>  /* Deal with nodes in an array */<br/>  visitNodes(nodes) { for (const node of nodes) this.visitNode(node); }<br/>  /* Dispatch each type of node to a function */<br/>  visitNode(node) {<br/>    switch (node.type) {<br/>      case 'Program': return this.visitProgram(node);<br/>      case 'VariableDeclaration': return this.visitVariableDeclaration(node);<br/>      case 'VariableDeclarator': return this.visitVariableDeclarator(node);<br/>      case 'Identifier': return this.visitIdentifier(node);<br/>      case 'Literal': return this.visitLiteral(node);<br/>    }<br/>  }<br/>  /* Functions to deal with each type of node */<br/>    visitProgram(node) { return this.visitNodes(node.body); }<br/>    visitVariableDeclaration(node) { return this.visitNodes(node.declarations); }<br/>    visitVariableDeclarator(node) {<br/>      this.visitNode(node.id);<br/>      return this.visitNode(node.init);<br/>    }<br/>    visitIdentifier(node) { return node.name; }<br/>    visitLiteral(node) { return node.value; }<br/>}</span><span id="988c" class="mx jz iq mt b gy nc mz l na nb">/* Import necessary modules */<br/>var acorn = require('acorn');<br/>var fs = require('fs');<br/>/* Read the hello.js file */<br/>var hello = fs.readFileSync('hello.js').toString();<br/>/* Use acorn to generate the AST of hello.js */<br/>var ast = acorn.parse(hello);<br/>/* Create a Visitor object and use it to traverse the AST */<br/>var visitor = new Visitor();<br/>visitor.visitNode(ast);</span></pre><p id="61e5" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">代码中的注释很清楚。如果您将代码与第3节中的AST进行比较，您会发现它很容易理解。</p><h1 id="b28c" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">6.摘要</h1><p id="6c36" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">这篇文章介绍了如何使用JavaScript解析器acorn创建JavaScript程序的抽象语法树，以及如何使用Node.js遍历抽象语法树。请把所有文件放在这个帖子指定的目录下。否则，系统可能找不到路径。如果你喜欢这个帖子或者觉得有用，请帮我分享到你的社交媒体上~谢谢！</p><p id="b95f" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">这篇帖子来自这里:<a class="ae lz" href="https://pwnbykenny.com/2020/07/21/javascript-parser-to-create-abstract-syntax-treeast-acorn/" rel="noopener ugc nofollow" target="_blank"> JavaScript解析器创建抽象语法树(AST): Acorn — Pwn作者Kenny </a>。更多类似内容，可以访问这里:<a class="ae lz" href="https://pwnbykenny.com/" rel="noopener ugc nofollow" target="_blank">博士&amp;自动开发JIT编译器— Pwn作者肯尼</a>。这是我的个人网站。欢迎光临！</p></div></div>    
</body>
</html>