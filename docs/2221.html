<html>
<head>
<title>How this team accidentally found a SSRF in Slack exposing AWS credentials! A $4000 bug bounty</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这个团队如何意外地发现SSRF在松弛暴露AWS凭证！4000美元的昆虫赏金</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-this-team-accidentally-found-a-ssrf-in-slack-exposing-aws-credentials-a-4000-bug-bounty-513be19286e?source=collection_archive---------0-----------------------#2022-07-29">https://infosecwriteups.com/how-this-team-accidentally-found-a-ssrf-in-slack-exposing-aws-credentials-a-4000-bug-bounty-513be19286e?source=collection_archive---------0-----------------------#2022-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d5a0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">复杂的库导致隐藏的攻击媒介</h2></div><p id="b52c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于所有的bug赏金猎人来说，这是一个鼓舞人心的故事，讲述了SSRF漏洞是如何在Slack中被发现的，以及潜在的许多其他web应用程序，作者是<a class="ae le" href="https://twitter.com/bbuerhaus" rel="noopener ugc nofollow" target="_blank">布雷特·布尔豪斯</a>、<a class="ae le" href="https://twitter.com/daeken" rel="noopener ugc nofollow" target="_blank">科迪·布罗西厄斯</a>、<a class="ae le" href="https://twitter.com/erbbysam" rel="noopener ugc nofollow" target="_blank">萨姆·埃尔布</a>和<a class="ae le" href="https://twitter.com/smiegles" rel="noopener ugc nofollow" target="_blank">奥利维尔·贝格</a>。我将详细介绍他们的详细的“<a class="ae le" href="https://buer.haus/2019/10/18/a-tale-of-exploitation-in-spreadsheet-file-conversions/" rel="noopener ugc nofollow" target="_blank">一个在电子表格文件转换中利用漏洞的故事</a>”的一个更加用户友好的版本，并且我提供的所有材料都来自布雷特的写作。我强烈鼓励读者阅读更多的技术细节。</p><p id="bb9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还将包括Slack关于透明性漏洞的消息</p><blockquote class="lf lg lh"><p id="0027" class="ki kj li kk b kl km ju kn ko kp jx kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">Slack要感谢研究人员为增加开源工具LibreOffice的安全性所做的工作，以及他们对Slack负责任的披露。文件共享的安全性对Slack及其用户至关重要，我们与研究团队合作，在收到报告的24小时内迅速实施了修复。Slack已经确认，没有客户数据被利用这个bug访问。(来源:<a class="ae le" href="https://buer.haus/2019/10/18/a-tale-of-exploitation-in-spreadsheet-file-conversions/" rel="noopener ugc nofollow" target="_blank">Brett buer Haus公司的电子表格文件转换利用的故事</a>)</p></blockquote><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lm"><img src="../Images/3d936b4ee9b5513be5ee17115d8e25d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ogkTIBXgNHjg_4z0t2qjqw.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">人工智能生成的艺术“松弛与悲伤的脸旁边的插图”由craiyon.com</figcaption></figure><h1 id="9b22" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">侦察:电子表格指纹</h1><p id="9491" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">该团队首先通过执行一项名为<a class="ae le" href="https://cyware.com/news/what-is-cybersecurity-fingerprinting-de718f94" rel="noopener ugc nofollow" target="_blank">指纹</a>的网络安全技术进行初步侦察。指纹识别本质上是一个术语，用于收集有关系统的特定信息，以尝试识别程序、服务、操作系统等的类型。正在被那个系统使用。这里有一个<a class="ae le" href="https://securitytrails.com/blog/cybersecurity-fingerprinting" rel="noopener ugc nofollow" target="_blank">很好的链接</a>来学习更多关于指纹识别的知识。</p><p id="0ef7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，团队希望了解使用什么软件来处理电子表格(即<code class="fe mz na nb nc b">XLSX</code>文件)。使用了以下方法:</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi nd"><img src="../Images/9289b67993a1f73921d576063f10f88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCY363CGwddc0wUvaNxviA.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">来自<a class="ae le" href="https://buer.haus/2019/10/18/a-tale-of-exploitation-in-spreadsheet-file-conversions/" rel="noopener ugc nofollow" target="_blank">初始帖子</a>的电子表格指纹方法</figcaption></figure><p id="13b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以在您的应用程序中使用它来看看会发生什么！此外，该小组指出，如果返回原始pdf，其中包含的元数据可以识别用于处理的程序。Excel是众所周知的微软电子表格处理器。<a class="ae le" href="https://www.libreoffice.org/" rel="noopener ugc nofollow" target="_blank"> LibreOffice </a>是一款免费的电子表格处理器，以前被称为OpenOffice。</p><p id="d128" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用这个过程，团队能够识别出Slack是一个使用LibreOffice的应用程序……纯属意外！该团队最初没有测试Slack，但通过在Slack上共享他们自己的文件，他们意识到Slack也在使用LibreOffice处理文件。</p><h2 id="fe62" class="ne md it bd me nf ng dn mi nh ni dp mm kr nj nk mo kv nl nm mq kz nn no ms np bi translated">LibreOffice漏洞1: EPFS和PostScript/GhostScript</h2><p id="f49d" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">团队注意到LibreOffice处理<a class="ae le" href="https://fileinfo.com/extension/epsf" rel="noopener ugc nofollow" target="_blank"> EPFS文件</a>。这些文件通常会被传递到另一个名为<a class="ae le" href="https://www.ghostscript.com/" rel="noopener ugc nofollow" target="_blank"> PostScript/GhostScript </a>的程序/系统，以便进行解释，并且已经报告了几个与此文件处理有关的漏洞，这些文件处理通常会自动执行。例如，这个<a class="ae le" href="https://github.com/farisv/PIL-RCE-Ghostscript-CVE-2018-16509" rel="noopener ugc nofollow" target="_blank"> Github在处理EPFS时，越过了某个python库中的一个RCE漏洞</a>。</p><p id="5e8a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该团队能够开发一个成功的EPFS有效载荷(<a class="ae le" href="https://gist.github.com/ziot/fb96e97baae59e3539ac3cdacbd09430" rel="noopener ugc nofollow" target="_blank">此处链接到代码</a>，具体归功于<a class="ae le" href="https://twitter.com/daeken" rel="noopener ugc nofollow" target="_blank"> Cody Brocious </a>)用于<a class="ae le" href="https://www.acunetix.com/blog/articles/local-file-inclusion-lfi/" rel="noopener ugc nofollow" target="_blank">本地文件包含</a>。使用这种有效载荷有一些细微差别，这是突出显示的<a class="ae le" href="https://buer.haus/2019/10/18/a-tale-of-exploitation-in-spreadsheet-file-conversions/" rel="noopener ugc nofollow" target="_blank"> Brett的作品</a>使得它每次都不工作。</p><p id="b045" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个漏洞似乎在一些应用程序上有效，但在Slack上无效。然而，这并没有让团队停下脚步。</p><h2 id="dd14" class="ne md it bd me nf ng dn mi nh ni dp mm kr nj nk mo kv nl nm mq kz nn no ms np bi translated">LibreOffice漏洞2:远程OLE对象xLinking</h2><p id="deeb" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">通过进一步的测试，团队确定LibreOffice文档可以嵌入<a class="ae le" href="https://en.wikipedia.org/wiki/Object_Linking_and_Embedding" rel="noopener ugc nofollow" target="_blank"> OLE对象</a>，代表对象链接和嵌入。这些对象允许数据在支持不同文档类型的不同应用程序之间平滑转换。OLE对象可能极其危险，网络安全和基础设施安全局(CISA)将OLE漏洞列为2016-2019年间被利用最多的漏洞。</p><blockquote class="nq"><p id="1c84" class="nr ns it bd nt nu nv nw nx ny nz ld dk translated">根据美国政府的技术分析，恶意网络行为者最常利用微软的对象链接和嵌入(OLE)技术中的漏洞。OLE允许文档包含来自其他应用程序(如电子表格)的嵌入内容。继OLE之后，报道第二多的易受攻击的技术是一个广泛使用的Web框架，称为Apache Struts。(来源:<a class="ae le" href="https://www.cisa.gov/uscert/ncas/alerts/aa20-133a" rel="noopener ugc nofollow" target="_blank"> CISA十大经常被利用的漏洞</a>)</p></blockquote><p id="c724" class="pw-post-body-paragraph ki kj it kk b kl oa ju kn ko ob jx kq kr oc kt ku kv od kx ky kz oe lb lc ld im bi translated">然后，该团队开发了一个初步的POC来利用OLE。该团队还不得不做一些小的调整(细节可以在OG帖子中找到)以完全显示结果。这一招奏效了，成功地泄露了Slack中的秘密密钥！</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi of"><img src="../Images/c5884ee94aecb8233275d221d027d2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sjJBarYXu0ywdDVP5SzwRw.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">来自<a class="ae le" href="https://buer.haus/2019/10/18/a-tale-of-exploitation-in-spreadsheet-file-conversions/" rel="noopener ugc nofollow" target="_blank">初始博客帖子</a>的概念验证</figcaption></figure><p id="3f25" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mz na nb nc b">xlink-href</code>是如何被开发的，为什么会成功？该团队深入几个自称的“兔子洞”去了解Python unoconv(通用办公转换器)。在<a class="ae le" href="https://wiki.openoffice.org/wiki/PyUNO_bridge" rel="noopener ugc nofollow" target="_blank"> PyUNO桥</a>中，它主要用于对LibreOffice命令进行API调用，代码在进行转换时会自动更新外部链接。这实质上是更新不可信的链接，允许黑客恶意更改链接到<code class="fe mz na nb nc b">//etc/passwd</code>，然后检索该文件的所有内容。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi og"><img src="../Images/dea08ed58727e4c126a09481843d7031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZZV0eC8AsL8-eSxn.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">从<a class="ae le" href="https://buer.haus/2019/10/18/a-tale-of-exploitation-in-spreadsheet-file-conversions/" rel="noopener ugc nofollow" target="_blank">原始帖子</a>中成功检索AWS密钥</figcaption></figure><h1 id="201b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">这个故事的寓意</h1><h2 id="8404" class="ne md it bd me nf ng dn mi nh ni dp mm kr nj nk mo kv nl nm mq kz nn no ms np bi translated">对于开发人员:</h2><p id="d8cc" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">文档解析需要使用外部库，这些库通常很大、很复杂，并且具有许多可能被遗忘或细微差别很大的特性。要小心，因为这些文件中的许多可能是恶意的，有许多不同的攻击媒介。确保尽可能用沙箱保护该文件处理，以避免泄露敏感信息或允许RCE。</p><h2 id="ce57" class="ne md it bd me nf ng dn mi nh ni dp mm kr nj nk mo kv nl nm mq kz nn no ms np bi translated"><strong class="ak">对于猎人:</strong></h2><p id="11d6" class="pw-post-body-paragraph ki kj it kk b kl mu ju kn ko mv jx kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">不要放弃！这个团队经历了他们的开发和有效载荷的多次迭代，他们很可能经历了比他们发表的更多的迭代。当一个在其他应用程序中被证明有效的攻击媒介在Slack中失败时，他们会继续攻击其他的攻击媒介，直到获得成功的结果。对我来说，一个关键的见解是，这个团队内部并不满足于简单地利用漏洞，而是致力于研究漏洞的根本原因。我强烈建议阅读<a class="ae le" href="https://buer.haus/2019/10/18/a-tale-of-exploitation-in-spreadsheet-file-conversions/" rel="noopener ugc nofollow" target="_blank">他们的完整原帖</a>，因为我获得了很多真知灼见。</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="de95" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">整个团队(<a class="ae le" href="https://twitter.com/bbuerhaus" rel="noopener ugc nofollow" target="_blank"> Brett Buerhaus </a>、<a class="ae le" href="https://twitter.com/daeken" rel="noopener ugc nofollow" target="_blank"> Cody Brocious </a>、<a class="ae le" href="https://twitter.com/erbbysam" rel="noopener ugc nofollow" target="_blank"> Sam Erb </a>和<a class="ae le" href="https://twitter.com/smiegles" rel="noopener ugc nofollow" target="_blank"> Olivier Beg </a>)再次称赞你的出色工作，祝贺你获得4000美元奖金。感谢您通读，请在下面留下任何建设性的反馈、建议或问题！如果你喜欢，请考虑在Medium上跟随我或者<a class="ae le" href="https://www.buymeacoffee.com/robertocyberkid" rel="noopener ugc nofollow" target="_blank">请我喝杯咖啡</a>。在roberto.cyberkid@gmail.com联系我，在twitter上关注我，在LinkedIn上联系我！</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="6694" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="li">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae le" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> <em class="li">加入我们的每周简讯</em> </strong> </a> <em class="li">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>