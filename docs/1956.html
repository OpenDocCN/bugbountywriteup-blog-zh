<html>
<head>
<title>Baron Samedit CVE-2021–3156 [TryHackMe]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">巴隆·萨姆迪特·CVE</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/baron-samedit-cve-2021-3156-tryhackme-76d7dedc3cff?source=collection_archive---------0-----------------------#2022-03-21">https://infosecwriteups.com/baron-samedit-cve-2021-3156-tryhackme-76d7dedc3cff?source=collection_archive---------0-----------------------#2022-03-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4e74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Unix Sudo程序中探索CVE-2021–3156的教程演练。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/8ca088f14996f9b887f524a16a2985de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*esw4ILI_QOq4KQBjRFoFDA.png"/></div></div></figure><p id="7e7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">部署机器，ssh进入机器使用<br/> <code class="fe kx ky kz la b">username:tryhackme</code> <br/> <code class="fe kx ky kz la b">password:tryhackme</code></p><p id="3941" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2021年1月，<a class="ae lb" href="https://qualys.com/" rel="noopener ugc nofollow" target="_blank"> Qualys </a>发布了一篇<a class="ae lb" href="https://blog.qualys.com/vulnerabilities-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit" rel="noopener ugc nofollow" target="_blank">博文</a>详细描述了Unix Sudo程序中一个可怕的新漏洞。</p><p id="0970" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">具体来说，这是一个堆缓冲区溢出，允许任何用户将权限提升到root用户，无需错误配置。</strong> <strong class="jp ir">这个漏洞利用默认设置，对任何用户都有效，不管Sudo权限，这使它更加可怕。</strong>该漏洞已被修补，但影响1 . 8 . 2–1 . 8 . 31 p2和1 . 9 . 0–1 . 9 . 5 P1的任何未修补版本的sudo程序，这意味着它在过去十年中一直存在。</p><p id="5e9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个程序很快就被打了补丁(打了补丁的版本很快就进入了资料库)，所以这个漏洞将不再对最新的目标起作用；然而，它仍然强大得令人难以置信。</p><p id="a7ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此漏洞是sudo程序中的缓冲区溢出。具体来说，就是堆缓冲区溢出。堆是为动态分配内存而保留的，允许程序更灵活地创建和访问值和构造。<br/>我们真正需要了解的是，这种漏洞非常强大，而且影响极其广泛。</p><p id="dc7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，首先，我们可以做些什么来检查一个系统是否容易受到攻击？<br/>幸运的是，有一个非常简单的方法我们可以用来检查；只需在终端中输入以下命令:</p><p id="3cd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kx ky kz la b">sudoedit -s '\' $(python3 -c 'print("A"*1000)')</code></p><p id="80b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果系统易受攻击，这将覆盖堆缓冲区并使程序崩溃:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lc"><img src="../Images/377efa9e8459e4dac585ab18f9a38332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cEWLne4kHwJffF2Cf7yncQ.png"/></div></div></figure><p id="df69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个PoC是从一个名为<a class="ae lb" href="https://twitter.com/lockedbyte" rel="noopener ugc nofollow" target="_blank"> lockedbyte </a>的研究员那里获得的，这里的<a class="ae lb" href="https://github.com/lockedbyte/CVE-Exploits/tree/master/CVE-2021-3156" rel="noopener ugc nofollow" target="_blank">是</a>。</p><p id="cd2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当该建议首次发布时，Qualys并未提供该漏洞的完整代码。其他研究人员很快就复制了这个漏洞；然而。第一个公开可用的漏洞工作副本是由一个名为<a class="ae lb" href="https://twitter.com/bl4sty" rel="noopener ugc nofollow" target="_blank"> bl4sty </a>的研究人员创建的。他们的完整利用代码可以在Github、<a class="ae lb" href="https://github.com/blasty/CVE-2021-3156" rel="noopener ugc nofollow" target="_blank">这里</a>找到。这是我们将用来利用您在第一个任务中部署的机器</p><p id="3e1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该机器的设置允许轻松利用该漏洞。因此，上面链接的Github存储库已经被添加到目标中。</p><p id="c817" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在主目录中，您会看到一个名为“Exploit”的文件夹:</p><p id="0452" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只需要“make”来自动编译代码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ld"><img src="../Images/1285a35bb9eebd51c2eb170aa9622feb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x9DWxxny7PiMTGtrM5O4LA.png"/></div></div></figure><p id="b97c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要选择目标设备操作系统；在这种情况下，我们将使用第0个选项</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/570691ae374f48636364855541f81aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWVKNYXl0GxCcMAaeBQaDg.png"/></div></div></figure><p id="b9ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在只需执行它！！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi le"><img src="../Images/217eb8e58b032b11c0c02fdece052ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUuVDfgpIcUqsv_2RU0dbA.png"/></div></div></figure><p id="f1cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后嘣！！！我们得到了根壳</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lf"><img src="../Images/cef02ef624b12a1a2517373868cddf63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qB_VF7NdLxJtQlolYU4p1g.png"/></div></div></figure></div></div>    
</body>
</html>