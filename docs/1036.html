<html>
<head>
<title>DOS via a billion laughs 😈</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过十亿次大笑😈</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/dos-via-a-billion-laughs-9a79be96e139?source=collection_archive---------1-----------------------#2020-12-23">https://infosecwriteups.com/dos-via-a-billion-laughs-9a79be96e139?source=collection_archive---------1-----------------------#2020-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e9e8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过重复引用消耗任意多的RAM</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0de1c3b641a911b9439a98f27098dca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwDbAVkiin-ZvPpY7ORdVQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="79d5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di"> T </span>何亿笑攻击从2003年开始为人所知(<a class="ae md" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1564" rel="noopener ugc nofollow" target="_blank">来源</a>)。该攻击使用XML文件中的引用，如果所有引用都展开，就会使一个小的源文件在内存中变得很大。它也被称为LOL炸弹、XML炸弹，或者是YAML炸弹和git炸弹的变体。这是一种拒绝服务(DOS)攻击，因为它可以关闭服务。</p><h1 id="92a5" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">为什么你应该关心</h1><p id="9e0d" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">这个有点太具体了，在很多新闻文章里看不出来。然而，有几个大型项目多年来都很脆弱:</p><ul class=""><li id="68cb" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">2003年:libxml2易受攻击(<a class="ae md" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1564" rel="noopener ugc nofollow" target="_blank">CVE-2003–1564</a>)</li><li id="4171" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">2015年:MediaWiki易受攻击(<a class="ae md" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-2942" rel="noopener ugc nofollow" target="_blank">CVE-2015–2942</a>)</li><li id="e020" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">2016: <a class="ae md" href="https://en.wikipedia.org/wiki/Libxml2" rel="noopener ugc nofollow" target="_blank"> libxml2 </a>易受攻击…再次(<a class="ae md" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3705" rel="noopener ugc nofollow" target="_blank">CVE-2016–3705</a>)</li><li id="20d7" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">2016: HTTP/2头压缩被用来构建一个HPACK炸弹(<a class="ae md" href="https://nvd.nist.gov/vuln/detail/CVE-2016-6581" rel="noopener ugc nofollow" target="_blank">CVE-2016–6581</a>)</li><li id="413c" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">2019: Kubernetes易受攻击(<a class="ae md" href="https://github.com/kubernetes/kubernetes/issues/83253" rel="noopener ugc nofollow" target="_blank">来源</a>，<a class="ae md" href="https://nvd.nist.gov/vuln/detail/CVE-2019-11253" rel="noopener ugc nofollow" target="_blank">CVE-2019–11253</a>)</li><li id="b2a0" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">2019: <a class="ae md" href="https://www.mchange.com/projects/c3p0/" rel="noopener ugc nofollow" target="_blank"> c3p0 </a> (JDBC数据库驱动)易受攻击(<a class="ae md" href="https://nvd.nist.gov/vuln/detail/CVE-2019-5427" rel="noopener ugc nofollow" target="_blank">CVE-2019–5427</a>)</li></ul></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="1c91" class="me mf it bd mg mh nw mj mk ml nx mn mo jz ny ka mq kc nz kd ms kf oa kg mu mv bi translated">它是如何工作的</h1><p id="0548" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">下面的XML定义了一个实体<code class="fe ob oc od oe b">ha</code>，然后是一个实体<code class="fe ob oc od oe b">ha2</code>，它包含了两次<code class="fe ob oc od oe b">ha</code>。这种模式不断重复。这意味着<code class="fe ob oc od oe b">ha5</code>间接包含了<code class="fe ob oc od oe b">ha</code>的16倍。你可以看到指数增长，不是吗？</p><pre class="kj kk kl km gt of oe og oh aw oi bi"><span id="1a85" class="oj mf it oe b gy ok ol l om on">&lt;?xml version="1.0"?&gt;</span><span id="8193" class="oj mf it oe b gy oo ol l om on">&lt;!DOCTYPE root [<br/>&lt;!ENTITY ha "😆"&gt;<br/>&lt;!ENTITY ha2 "&amp;ha; &amp;ha;"&gt;<br/>&lt;!ENTITY ha3 "&amp;ha2; &amp;ha2;"&gt;<br/>&lt;!ENTITY ha4 "&amp;ha3; &amp;ha3;"&gt;<br/>&lt;!ENTITY ha5 "&amp;ha4; &amp;ha4;"&gt;<br/>]&gt;</span><span id="6cb0" class="oj mf it oe b gy oo ol l om on">&lt;root&gt;&amp;ha5;&lt;/root&gt;</span></pre><p id="afaf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有了<code class="fe ob oc od oe b">ha31</code>，我们将有两个⁰时报😆。那是十亿次大笑。请注意这是多么的不对称:对于一个小于1kB的文档，攻击者可以让解析器消耗大约千兆字节的内存。这很容易耗尽机器的所有内存，从而使其不可用，直到解析器被终止或机器重新启动。</p><p id="3594" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">亿笑攻击</strong>的一个细微变化叫做<strong class="la iu">二次爆破</strong>。</p><p id="336e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，类似的攻击可能在其他文件格式，如YAML。这里的关键点是那些格式有引用。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="e7bb" class="me mf it bd mg mh nw mj mk ml nx mn mo jz ny ka mq kc nz kd ms kf oa kg mu mv bi translated">我如何抵御十亿次笑声？</h1><p id="dc9b" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">假设您无法直接控制输入，并且根本无法阻止带有攻击的XML攻击您，我可以想到4种方法:</p><ul class=""><li id="dc1e" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated"><strong class="la iu">对引用的惰性评估</strong>:不是一次评估整个文档，而是仅在必要时解析引用。这可能会解决一些问题。</li><li id="355a" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu">不评估引用</strong>:把危险的特性扔出窗外肯定意味着你不再容易受到攻击。但是，您需要确保它不会影响您的用户。沟通这一点可能很难。</li><li id="6003" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu">引用递归深度限制</strong>:解析器本身可以意识到这个问题，并在停止评估引用时设置一个阈值。然而，这也可能导致误报——文档没有被解析，因为解析器认为这是一种攻击。</li><li id="d2eb" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated"><strong class="la iu"> RAM限制</strong>:您可以在资源限制下运行可能执行十亿次攻击的代码。这意味着执行线程/进程接收到一个(可捕获的)异常，并可以继续正常执行。这可能特别意味着，即使没有抛出异常，系统的其余部分也可能是正常的。只有那个线程/进程可能被杀死。</li></ul><p id="fb46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">那么，如何用Python来做这件事呢？</p><p id="d1b1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于XML，最简单的解决方案是使用由Diederik van der Boor 指出的<a class="ae md" href="https://pypi.org/project/defusedxml/" rel="noopener ugc nofollow" target="_blank"> defusedxml </a>包(谢谢！)</p><p id="13ce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">资源限制是最容易的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="c5a3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">限制解析器有时是可能的，有时是不可能的。这取决于您的解析器。有些有类似<code class="fe ob oc od oe b">resolve_entities</code> ( <a class="ae md" href="https://lxml.de/api/lxml.etree.XMLParser-class.html" rel="noopener ugc nofollow" target="_blank"> lxml </a>)的参数。</p><p id="5982" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">限制最大解压缩大小是针对HTTP/2“HPACK”炸弹进行的(<a class="ae md" href="https://python-hyper.org/projects/hpack/en/latest/security/CVE-2016-6581.html#the-solution" rel="noopener ugc nofollow" target="_blank">来源</a>)。</p><h1 id="0f14" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">请参见</h1><p id="c909" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">凯特·墨菲写了一篇关于git炸弹的很棒的文章，看看吧！</p><div class="ot ou gp gr ov ow"><a href="https://kate.io/blog/git-bomb/" rel="noopener  ugc nofollow" target="_blank"><div class="ox ab fo"><div class="oy ab oz cl cj pa"><h2 class="bd iu gy z fp pb fr fs pc fu fw is bi translated">爆炸式的Git仓库</h2><div class="pd l"><h3 class="bd b gy z fp pb fr fs pc fu fw dk translated">如果你是一个喜欢冒险的人(并且能够处理潜在的重启),我邀请你克隆这个小小的repo: $ git克隆…</h3></div><div class="pe l"><p class="bd b dl z fp pb fr fs pc fu fw dk translated">kate.io</p></div></div><div class="pf l"><div class="pg l ph pi pj pf pk ks ow"/></div></div></a></div><h1 id="7c70" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">下一步是什么？</h1><p id="13f7" class="pw-post-body-paragraph ky kz it la b lb mw ju ld le mx jx lg lh my lj lk ll mz ln lo lp na lr ls lt im bi translated">在这个关于应用安全(AppSec)的系列文章中，我们已经解释了攻击者的一些技术😈以及防守队员的技术😇：</p><ul class=""><li id="ef42" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">第1部分:<a class="ae md" href="https://medium.com/faun/sql-injections-e8bc9a14c95" rel="noopener"> SQL注入</a>😈</li><li id="fd1a" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第二部:<a class="ae md" href="https://levelup.gitconnected.com/leaking-secrets-240a3484cb80" rel="noopener ugc nofollow" target="_blank">不要泄露秘密</a>😇</li><li id="9ea3" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第3部分:<a class="ae md" href="https://levelup.gitconnected.com/cross-site-scripting-xss-fd374ce71b2f" rel="noopener ugc nofollow" target="_blank">跨站脚本(XSS) </a>😈</li><li id="c569" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第4部分:<a class="ae md" href="https://levelup.gitconnected.com/password-hashing-eb3b97684636" rel="noopener ugc nofollow" target="_blank">密码哈希</a>😇</li><li id="ea99" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第五部分:<a class="ae md" href="https://medium.com/bugbountywriteup/zip-bombs-30337a1b0112" rel="noopener"> ZIP炸弹</a>😈</li><li id="c0db" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第六部分:<a class="ae md" href="https://medium.com/plain-and-simple/captcha-500991bd90a3" rel="noopener">验证码</a>😇</li><li id="f78b" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第7部分:<a class="ae md" href="https://medium.com/bugbountywriteup/email-spoofing-9da8d33406bf" rel="noopener">电子邮件欺骗</a>😈</li><li id="440c" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第8部分:<a class="ae md" href="https://medium.com/python-in-plain-english/software-composition-analysis-sca-7e573214a98e" rel="noopener">软件组成分析</a> (SCA)😇</li><li id="104a" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第九部分:<a class="ae md" href="https://medium.com/faun/xxe-attacks-750e91448e8f" rel="noopener"> XXE袭击事件</a>😈</li><li id="da25" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第十部分:<a class="ae md" href="https://levelup.gitconnected.com/effective-access-control-331f883cb0ff" rel="noopener ugc nofollow" target="_blank">有效的访问控制</a>😇</li><li id="5a20" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">第十一部分:<a class="ae md" href="https://medium.com/bugbountywriteup/dos-via-a-billion-laughs-9a79be96e139" rel="noopener"> DOS via十亿次大笑</a>😈</li></ul><p id="45a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这即将到来:</p><ul class=""><li id="ec8a" class="nb nc it la b lb lc le lf lh nd ll ne lp nf lt ng nh ni nj bi translated">CSRF😈</li><li id="b0ae" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">磁盘操作系统😈</li><li id="2d1b" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">凭据填充😈</li><li id="095c" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">密码劫持😈</li><li id="0647" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">单点登录😇</li><li id="fd4c" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">双因素认证😇</li><li id="078e" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">备份😇</li><li id="ed44" class="nb nc it la b lb nk le nl lh nm ll nn lp no lt ng nh ni nj bi translated">磁盘加密😇</li></ul><p id="74dd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您对更多关于AppSec / InfoSec的文章感兴趣，请告诉我！</p></div></div>    
</body>
</html>