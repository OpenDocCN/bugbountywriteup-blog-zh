<html>
<head>
<title>How we was able to takeover whole organization via Privilege Escalation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何通过权限提升接管整个组织</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-we-was-able-to-takeover-whole-organization-via-privilege-escalation-4f74b31a84a6?source=collection_archive---------0-----------------------#2021-08-13">https://infosecwriteups.com/how-we-was-able-to-takeover-whole-organization-via-privilege-escalation-4f74b31a84a6?source=collection_archive---------0-----------------------#2021-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f2c3db2909753e1efc765dfc7c2c031f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s6GB9b4BDZ3cQ2E-9pfVaQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">我和我哥哥用HTML入侵世界</figcaption></figure><p id="86e9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">大家好，我又是亚瑟(又名内罗利)</p><p id="44a7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我的兄弟正在学习编程，我正在教他一些东西，他想开始学习bug-bounty，所以我指导了他(我将分享我告诉他开始做的简单技巧)，我们走吧</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="le lf l"/></div></figure><h1 id="6a30" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">选择目标</h1><p id="26c9" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">我们选择了一个有许多角色的目标，这样我们就可以处理访问控制错误配置，我们这样做的目的是允许我们创建一个组织，并为每个用户授予权限，</p><p id="63ac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我哥哥开始扮演角色，盲目地测试每个权限(这不是最佳实践，但对于新来的人来说，他试图发现问题)。</p><h1 id="a5db" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">找到奇怪的许可</h1><p id="8159" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">我哥找了个角色叫<code class="fe mj mk ml mm b">Database Administrator</code></p><p id="3957" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，打开文档来理解这个权限允许我们做什么显示了以下内容</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/82e7f5be3b90ef65f77abb03d2065192.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*IVcFkTsDI4fzu4PKGP-piQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">数据库管理员权限</figcaption></figure><p id="3054" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">hmmm有趣，因为用户可以访问数据库并编辑它，但同时我们不能控制任何用户权限或改变它</p><p id="fc06" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">asamaaly70@gmail.com是数据库管理员<br/>dragonx159753@gmail.com是完全管理员</p><p id="7572" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">数据库管理员不能更改用户权限或邀请用户</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/540cffaeadff7208902ed77ad5991a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ggcjeJn-QiQs641_MO-zrw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">数据库管理员</figcaption></figure><p id="19d5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是管理员可以</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/dcc720cde4a5955516863e53faf2e818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jGBVWu_wgMWnL-mA8mzfhQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">完全管理</figcaption></figure><h1 id="2518" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">思维违背逻辑</h1><p id="dc54" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">现在我们知道<code class="fe mj mk ml mm b">Database Administrator</code>可以访问数据库，并且查看发送的请求，我们发现它包含一个<code class="fe mj mk ml mm b">Graphql</code>查询，那么为什么数据库管理员不能执行这些查询呢？所以当我告诉我的小弟弟他就像</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="mq lf l"/></div></figure><h1 id="d226" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">发现问题</h1><p id="00db" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">拦截负责邀请用户的请求后</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/2979c302c05cb8f651c159ffd147cb23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*FtWNhywVQyP4lSEFfD6-mw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">邀请具有完全权限的用户</figcaption></figure><p id="99b6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们注意到了graphql查询</p><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/e10519dfe137185be7868c674a44e0b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ltw5XfWNBBZWSe6AvJRm6w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">邀请用户请求</figcaption></figure><p id="ef5e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们对<code class="fe mj mk ml mm b">Database Administrator </code>用户cookie使用了相同的请求，我们注意到请求发送成功！</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="mt lf l"/></div></figure><p id="76da" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我哥哥非常高兴，他在一个许多用户使用的产品上发现了他的第一个bug，我们意见不一致，他非常大声XD。</p><h1 id="5441" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">复制的步骤</h1><ol class=""><li id="aa25" class="mu mv iq ke b kf me kj mf kn mw kr mx kv my kz mz na nb nc bi translated">登录为<code class="fe mj mk ml mm b">Database Administrator</code></li><li id="4508" class="mu mv iq ke b kf nd kj ne kn nf kr ng kv nh kz mz na nb nc bi translated">创建临时帐户</li><li id="7838" class="mu mv iq ke b kf nd kj ne kn nf kr ng kv nh kz mz na nb nc bi translated">复制上述请求并向创建的帐户发送邀请</li><li id="8251" class="mu mv iq ke b kf nd kj ne kn nf kr ng kv nh kz mz na nb nc bi translated">接受新帐户的邀请，你将成为完全管理员</li></ol><p id="5766" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">注意，请求中的<code class="fe mj mk ml mm b">roles </code>是静态id，因此我们可以通过创建一个临时组织来获取它们，并拦截请求。</p><p id="9039" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">之后，我们发现这个问题也适用于编辑用户权限请求，所以我们有两种方法来做</p><p id="36bd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是h1说这是重复的，是同一个问题(请不要对此发表评论！反正我们还在争论这一点，祝我们好运吧:)。</p><h1 id="b2f9" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">分流小组的有趣故事</h1><p id="516e" class="pw-post-body-paragraph kc kd iq ke b kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv mi kx ky kz ij bi translated">该报告最初以不适用结束，因为triager没有遵循步骤并选择了错误的角色，所以他得到了禁止响应，</p><p id="03af" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们重新提交了它，也获得了N\A bcs。另一个triager认为角色id是动态的，会从一个组织更改到另一个组织，因此我们无法获得值，除非我们获得完整的管理员帐户。</p><p id="a4e7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我哥哥真的很失望，我花了一周时间向三人组证明这个问题是正确的，</p><p id="b8a1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，我们被判了中等严重程度，并获得了500美元的奖金。</p><p id="8de5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我希望分流过程会更顺利，如果我没有争辩的话..这个问题只是不适用。</p><h1 id="aaa1" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">经验教训</h1><ul class=""><li id="5f19" class="mu mv iq ke b kf me kj mf kn mw kr mx kv my kz ni na nb nc bi translated">当你测试访问控制问题时，总是试图理解每一个角色，而不仅仅是随机测试。</li><li id="5547" class="mu mv iq ke b kf nd kj ne kn nf kr ng kv nh kz ni na nb nc bi translated">当你相信这个问题的时候，试着让报告尽可能的清晰，triagers每天面对大量的报告，他们不明白每个应用程序是如何工作的。</li><li id="e372" class="mu mv iq ke b kf nd kj ne kn nf kr ng kv nh kz ni na nb nc bi translated">你想赚钱…不要对triagers不礼貌，我总是去h1支持，他们总是帮助。</li></ul><p id="3757" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">等待我们的报告，我们从路径遍历中得到一个Xss，再见。</p><figure class="la lb lc ld gt jr"><div class="bz fp l di"><div class="nj lf l"/></div></figure></div></div>    
</body>
</html>