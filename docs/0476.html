<html>
<head>
<title>Blockchain — hacking smart contract with Ethernaut CTF (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">区块链——黑掉与以太CTF的智能合约(上)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/blockchain-hacking-smart-contract-with-ethernaut-ctf-part-1-cb439d6c34fe?source=collection_archive---------0-----------------------#2020-01-23">https://infosecwriteups.com/blockchain-hacking-smart-contract-with-ethernaut-ctf-part-1-cb439d6c34fe?source=collection_archive---------0-----------------------#2020-01-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/dfec740495708892a603ba902b3916f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ain7PRNPPijRPtD6K9ZHfg.png"/></div></div></figure><p id="e1d2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">近年来，区块链及其应用已经成为未来的技术趋势。应用区块链，我们可以解决很多当前技术无法解决的问题，其中最突出的是没有交易中介，不再需要信任第三方。这使得事情变得更简单、更方便、更透明、更值得信赖。</p><p id="946a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，区块链不仅充满优势，而且它仍然是一项非常“新”的技术，需要更多的时间来完成。可以提到一些基本的缺点，例如交易确认速度慢，小额交易的成本高。另一件事是用户体验——普通用户仍然没有准备好区块链的概念，对这项技术的信任仍然需要大量的证明。</p><p id="f23b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有一样东西被认为是完美的“关键”:安全。对于任何产品，无论大小，一次安全事故都可能导致系统崩溃。区块链也是，它并不完美，存在隐藏的安全缺陷，无论是在区块链架构中，还是在这个平台上应用程序的代码中。</p><p id="44aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们将通过Zeppelin的CTF游戏来了解以太坊平台上智能合约的一些安全缺陷，Zeppelin是当今在构建智能合约解决方案方面非常著名的公司。这个CTF叫做ether naut——主要内容是黑客智能合约。</p><p id="982b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">可以在这里加入玩:<a class="ae kz" href="https://ethernaut.zeppelin.solutions" rel="noopener ugc nofollow" target="_blank">https://ether naut . zeppelin . solutions</a></p><p id="e3fb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一些建议:</p><ul class=""><li id="b42d" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">最好有区块链和智能合约方面的知识</li><li id="1ba1" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">如果有Solidity和Web3js的知识就更好了</li><li id="2a53" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">如果你知道如何使用混合IDE或松露就更好了</li></ul><h1 id="f7de" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">齐柏林飞船</h1><p id="0365" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">CTF将包括所有12首曲目，在Ropsten网络上播放。您需要准备一些东西(这些设置很简单，所以您可以自己搜索和安装):</p><ul class=""><li id="0f69" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">安装元掩码</li><li id="ac4e" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">在Ropsten Testnet上创建一个帐户，然后去<a class="ae kz" href="https://faucet.metamask.io/" rel="noopener ugc nofollow" target="_blank">https://faucet.metamask.io/</a>拿些乙醚。</li><li id="033d" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">打开Chrome控制台</li><li id="15a2" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">打开混音IDE<a class="ae kz" href="https://remix.ethereum.org" rel="noopener ugc nofollow" target="_blank">https://remix.ethereum.org</a></li></ul><p id="75a9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在每篇文章中，我们会得到一个实例，实例地址在开始时会返回到控制台上。我们将通过控制台(easy post)或Remix IDE(稍微有点困难&amp;需要代码)与契约实例进行交互</p><h1 id="a713" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">0.你好，以太人</h1><p id="6648" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">这是一个快速教程，很简单，主要是让我们测试内置函数。好了，我们走吧！</p><p id="b2b3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">解决方案<br/> </strong>我们不知道该怎么做但是第9步有提示。我们将从Chrome控制台上的<code class="fe mr ms mt mu b">contract.info()</code>开始</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="7254" class="nd lp it mu b gy ne nf l ng nh">await contract.info()<br/>"You will find what you need in info1()."</span></pre><p id="327e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">发出清除指令，执行功能<code class="fe mr ms mt mu b">info1</code></p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="d35e" class="nd lp it mu b gy ne nf l ng nh">await contract.info1()<br/>"Try info2(), but with "hello" as a parameter."</span></pre><p id="5eb4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">继续<code class="fe mr ms mt mu b">info2</code></p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="650a" class="nd lp it mu b gy ne nf l ng nh">await contract.info2("hello")<br/>"The property infoNum holds the number of the next info method to call."</span><span id="74e3" class="nd lp it mu b gy ni nf l ng nh">await contract.infoNum()<br/>t {s: 1, e: 1, c: Array(1)}<br/>c: [42]<br/>e: 1<br/>s: 1<br/>__proto__: Object</span></pre><p id="1f07" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个很大的数字，我们不需要知道它的用途，但是我们知道下一个被调用的函数将是<code class="fe mr ms mt mu b">info42</code>。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="82d3" class="nd lp it mu b gy ne nf l ng nh">await contract.info42()<br/>"theMethodName is the name of the next method."</span><span id="88d1" class="nd lp it mu b gy ni nf l ng nh">await contract.theMethodName()<br/>"The method name is method7123949."</span><span id="44e2" class="nd lp it mu b gy ni nf l ng nh">await contract.method7123949()<br/>"If you know the password, submit it to authenticate()."</span></pre><p id="be8c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">也就是说，要完成这篇文章，我们需要提交带有参数<code class="fe mr ms mt mu b">password</code>的<code class="fe mr ms mt mu b">authenticate</code>函数。调用<code class="fe mr ms mt mu b">password</code>函数获取密码。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="6d88" class="nd lp it mu b gy ne nf l ng nh">await contract.password()<br/>"ethernaut0"</span><span id="93ca" class="nd lp it mu b gy ni nf l ng nh">contract.authenticate("ethernaut0")</span></pre><h1 id="1093" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">1.撤退</h1><p id="80f8" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">目标:</p><ul class=""><li id="306b" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">占用所有者</li><li id="ec7f" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">从合同中提取所有的钱</li></ul><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="2096" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">后备解决方案</p><ul class=""><li id="f5ab" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">在这节课中，我们将学习<code class="fe mr ms mt mu b">fallback</code>函数。这是智能合约中的一个特殊函数，它没有函数名，在以下情况下使用:合约收到以太网，或有人调用合约中没有的函数或参数不正确。</li><li id="01c8" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">这里有个小技巧:fallback不是回退函数(即使函数的名字是Fallback)，但是<code class="fe mr ms mt mu b">function() payable public</code>是回退函数。从那里我们有了下面的方法:首先调用值小于0.001的函数contribute()来成为贡献者</li></ul><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="aa58" class="nd lp it mu b gy ne nf l ng nh">await contract.contribute({value:toWei(0.0001)})</span></pre><p id="93a7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">检查你是否已经成为一个贡献者。如果结果&gt; 0，那么你就成了贡献者</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="4dfc" class="nd lp it mu b gy ne nf l ng nh">await contract.getContribution().then(x =&gt; x.toNumber())</span></pre><p id="b209" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后发送以太到合同激活回退，然后我们将成为所有者</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="b705" class="nd lp it mu b gy ne nf l ng nh">contract.send(1)</span></pre><p id="a280" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">检查所有者</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="feb4" class="nd lp it mu b gy ne nf l ng nh">await contract.owner()</span></pre><p id="51c6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后取出所有的钱</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="ff2f" class="nd lp it mu b gy ne nf l ng nh">contract.withdraw()</span></pre><h1 id="b712" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">2.余波</h1><p id="3a7a" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated"><strong class="kd iu">目标</strong></p><ul class=""><li id="61c1" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">占用所有者</li></ul><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="eac7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">解决方案</strong></p><p id="4bad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">只需运行<strong class="kd iu"> Fal1out </strong>函数，请注意，该契约故意将字母l拼错为数字，因此它不是构造函数，而只是一个常规函数，其任务是授权所有者。</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="6ab5" class="nd lp it mu b gy ne nf l ng nh">contract.Fal1out()</span></pre><p id="8b6c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">检查它是否已成为所有者</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="fc99" class="nd lp it mu b gy ne nf l ng nh">await contract.owner()</span></pre><p id="0135" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">提交并完成！</p><h1 id="3cc0" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">3.抛硬币</h1><p id="6f94" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">这是一个抛硬币的问题，我们的任务是猜脸或连续10次面朝上。</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="05db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">解答<br/> </strong>首先断言，在红黑相间的情况下，连续猜对10次几乎是不可能的。<br/>认识到函数flip()有面朝下的计算然后提交结果，无法知道计算结果是什么来干扰提交过程。然而，这表明我们可以编写另一个契约，将该函数分成两半，一个函数计算，一个函数提交结果。<br/>该编码了，我们会用Remix IDE代替Chrome控制台。我们将如下编写另一个契约攻击，记住或者用你的实例的地址替换目标变量:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="a00c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">编译此合同并在Remix上手动运行该功能翻转10次，记住将气限和气价设置得稍高一些，以避免断气并更快地确认交易。</p><p id="fcd6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在chrome控制台上，仔细检查猜对的次数，10次就可以了</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="708a" class="nd lp it mu b gy ne nf l ng nh">await contract.consecutiveWins().then(x =&gt; x.toNumber())</span></pre><h1 id="3a6c" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">4.电话</h1><p id="2e47" class="pw-post-body-paragraph kb kc it kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">任务:获得所有权</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="bbd5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">解决方案</strong></p><ul class=""><li id="eac6" class="la lb it kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">你要明白tx.origin不同于msg.sender。</li><li id="3b04" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">如果从契约A调用函数，在调用契约B的函数的函数中，那么tx.origin是你的地址，msg.sender是契约A的地址。</li><li id="6d43" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">坏人可以用这个来攻击一个契约，用另一个契约来攻击。</li><li id="0a51" class="la lb it kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">在本文中，我们将编写另一个契约攻击，如下所示:</li></ul><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="50c5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">编译此合同并在Remix上运行claimOwnership，所有者将属于您。<br/>在chrome控制台上，再次检查合同所有者</p><pre class="mv mw mx my gt mz mu na nb aw nc bi"><span id="86ac" class="nd lp it mu b gy ne nf l ng nh">await contract.owner()</span></pre><p id="8a97" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">提交&amp;全部完成！</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="4fa7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="ns">关注</em> <a class="ae kz" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="ns"> Infosec报道</em> </a> <em class="ns">获取更多此类精彩报道。</em></p><div class="nt nu gp gr nv nw"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd iu gy z fp ob fr fs oc fu fw is bi translated">信息安全报道</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">medium.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jz nw"/></div></div></a></div></div></div>    
</body>
</html>