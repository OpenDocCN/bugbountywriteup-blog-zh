<html>
<head>
<title>First step to an SQL-Injection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL注入的第一步</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/first-steps-to-sql-injection-45fc0d9aae21?source=collection_archive---------0-----------------------#2020-12-17">https://infosecwriteups.com/first-steps-to-sql-injection-45fc0d9aae21?source=collection_archive---------0-----------------------#2020-12-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/00b5c7ea2b2b9a434718ca6dc1e5f218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*biyZT_iZWFnGGBgw"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">克林特·帕特森在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="9714" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下面的文章中，我们将尝试从很少或没有SQL知识开始，执行一个基本的SQL注入。为此，我们将使用由TryHackMe托管的DWVA box。</p><h2 id="b0a3" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">什么是SQL注入？</h2><p id="ea5f" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">SQL注入是在web应用程序中利用未经过滤的用户输入的行为。输入可能包含有效的SQL命令，因此将在解析到SQL server时执行，这可能会导致不必要的更改或数据泄露。</p><h1 id="f2ff" class="lz lc iq bd ld ma mb mc lg md me mf lj mg mh mi lm mj mk ml lp mm mn mo ls mp bi translated">一些基本的SQL和SQL语法</h1><p id="5dca" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">正如你已经知道的，SQL是用来操作数据库的。在我们开始利用它之前，让我们先创建一个基本SQL知识的基础。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/d14b021090d8e5ef3f5c8a67f01b364e.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*--rIu8qEue54BIPKCyM0Hw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图一。我们db中的<strong class="bd ld">用户</strong>表<strong class="bd ld"> </strong>。</figcaption></figure><p id="6b25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们有一个如图1所示的数据表。这张表存在于我们可以访问的某个数据库中。一些支持SQL的服务器可以在一个应用程序中包含多个数据库。假设我们的<strong class="kf ir">用户</strong>表位于一个名为<em class="mv">网站</em>的数据库对象中。作为目标的数据库对象通常由一些配置文件来处理，因此在讨论一些SQL语法时，我们将暂时跳过如何定位数据库对象。</p><h2 id="85b3" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">使用SQL的Hello World</h2><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/5859eb33498c661473f93912a0be364a.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*mbz2ZCfz3MtOIDXIa1OcEQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图二。最基本的SQL命令。</figcaption></figure><p id="b8e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们有图1中显示的数据，并运行<strong class="kf ir">SELECT * FROM users；</strong>命令显示在图2中，会发生什么情况？让我们分解它。关键字可以用紫色来区分(这是atom中标准的高亮格式。sql文件)。<strong class="kf ir"> SELECT </strong>关键字告诉数据库我们想要检索一些数据。明星说嘿，为什么不把你能找到的东西都给我带来。最后，<strong class="kf ir"> FROM users </strong>指定将从哪个表中获取数据。因此，图2中的命令将返回图1中显示的内容(当然，粗体标题除外)。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/845e6468db8bea04a3a9fe00dba75d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*RfQbFThVezfDLCaduSXWhQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图3。一些SQL命令插入一个新用户到我们的数据库。</figcaption></figure><p id="5191" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们知道了如何返回一些数据，但是如果我们想添加一个新用户呢？好吧，让我们运行图3中显示的命令。<strong class="kf ir"> INSERT INTO users </strong>告诉服务器向users表中添加一些新数据。<strong class="kf ir"> (userid，username，password，email) </strong>仅用于指定我们的目标列以及我们想要插入数据的顺序。</p><p id="8f62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们能不能像那样跳到新的一行？是的，我们可以。因为只要没有，SQL server就会将其解释为一个命令；介于两者之间。既然我们有了；在我们命令的结尾，SQL server将把图3中的所有内容解释为一个命令。最后，我们有<strong class="kf ir">个值(“5”、“狮子”、“国王”、“T1”、<a class="ae kc" href="mailto:simba@example.com" rel="noopener ugc nofollow" target="_blank">、<strong class="kf ir">、</strong>、</a>、<strong class="kf ir">”)</strong>，这只是说我们希望输入这些值，服务器将相应地映射这些值，以符合我们之前的规范<strong class="kf ir">(用户id、用户名、密码、电子邮件)</strong>。</strong></p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/751491f9a1d66e255b154f8d80a2d663.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*yVqPTNrP5STgD8IUczx3rA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图4。更新后的表格。</figcaption></figure><p id="22a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在图4中显示了最终的表格。SQL语言中还有很多，但是为了简单起见，我将把它留给您去做更多的研究。</p><h1 id="e5f2" class="lz lc iq bd ld ma mb mc lg md me mf lj mg mh mi lm mj mk ml lp mm mn mo ls mp bi translated">注射</h1><p id="97e4" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">对于本演示，让我们启动<a class="ae kc" href="http://tryhackme.com" rel="noopener ugc nofollow" target="_blank"> tryhackme </a>并启动名为<a class="ae kc" href="https://tryhackme.com/room/dvwa" rel="noopener ugc nofollow" target="_blank"> DVWA </a>的机器，它可以安装在本地机器上，但这样做要容易得多(而且它仍然是免费的)。很难找到盒子吗？<a class="ae kc" href="https://tryhackme.com/room/dvwa" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="be29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您是第一次使用tryhackme，请按照他们的一些指南开始使用并连接到他们的服务。那你准备好了就回来。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/1e0616ffe052328faa18a889dbb1e83e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGEiDzzQGISrIq-evQOvqg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图5。DVWA登录页面。</figcaption></figure><p id="6d7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我假设你现在已经启动了DVWA盒子，并且可以通过tryhackme上显示的ip访问该网站。您应该会看到如图5所示的内容。现在只需登录，用户名使用<em class="mv"> admin </em>，密码使用<em class="mv">密码。你被录取了！这里有很多东西，但首先让我们把困难降低到可维护的东西。点击主菜单中的<strong class="kf ir"> DVWA安全</strong>。然后将下拉难度从<strong class="kf ir">不可能的</strong>改为<strong class="kf ir">低的</strong>。</em></p><p id="5210" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在主菜单中点击<strong class="kf ir"> SQL注入</strong>。很好，现在让我们把手弄脏。试着在文本框里输入一些东西。我发现，通过在单独的查询中分别写入1到5，可以返回一些用户，见图6。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/16bed8aebb3a8df8c6af5865ee119c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*h50l-pHuLWhRNSW48QyWIQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图6。输入1并点击提交后的结果。</figcaption></figure><p id="4ee3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是如果我们输入一个勾号，也就是‘符号，会发生什么呢？很好，我们得到了一个错误消息，参见图7。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/326dddb5a901f46f197c565845ff3acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*7IuTBk6XnnGzBBr-EFoFuA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图7。错误消息。</figcaption></figure><p id="3d12" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">发生了什么事？据推测，后端服务器运行了一些SQL脚本，很可能类似于图8。<strong class="kf ir"> WHERE </strong>关键字用于过滤结果，因此所有返回的记录必须将其id设置为？-象征。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/515f71e99ff86aa9ddb77d5b96af41f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*h0xos7-ZlXFH-yaDvsj10A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图8。后端可能的SQL脚本。</figcaption></figure><p id="9dff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，在将查询发送到SQL-server之前，后端更改了？-输入的符号。最终的查询将如图9所示。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/95e00c148f412fa48317f7e70ed54c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*u_5POnDgs4KIR_ht7h2XOQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图9。最终查询。</figcaption></figure><p id="2bcc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如您所见，SQL server无法理解这三个记号，因此抛出了一个错误。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/d9c91ace76fe7fc484ee14137085c82f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxdltknh_OPoiUzZ4kM6wQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图10。在文本字段中输入123后DVWA的URL。</figcaption></figure><p id="b205" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">经过一点修补，我发现这个url包含了提交的查询。在图10中，您可以看到在<strong class="kf ir"> id= </strong>之后和下面的<strong class="kf ir"> &amp; </strong>之前是传递给查询的输入，这里我只是在文本字段中写了123，然后单击submit。然而，从输入字段传递到URL的信息是URL编码的，这对我来说产生了一些小故障。因此，为了避免这种情况，让我们直接将查询写入URL。</p><h2 id="bc8a" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">变得恶毒</h2><p id="d74a" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">一组两个破折号注释掉同一行中的其余SQL，参见图11。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/2a47a1cec32c733adeb787ea3aee5c17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YePCjcGVvnNhfoxt69xuZg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图11。一个命令和一个注释。</figcaption></figure><p id="945f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它来逃避SQL查询并插入我们自己的SQL命令。让我们编辑URL，使其与图12中的相同。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/560689089a943192fe0903e9c695e812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pCF5WwKe4FhdOMrixq1pKQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图12。注入的SQL命令。</figcaption></figure><p id="5183" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">联合</strong>关键字用于将两个搜索结果连接在一起。<strong class="kf ir"> table_name </strong>是<strong class="kf ir">information _ schema . tables</strong>表<strong class="kf ir"> </strong>中的一列，包含数据库中所有表的名称。所以让我们假设服务器有一些如图8所示的SQL模板。然后，发送到SQL server的查询将类似于图13。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/cdc45d9dbfb5861264647e64b20c225d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f71n1rcTyoOF-1KeRAfaGw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图13。刚刚替换了？-图8中的符号代表图12中的命令。</figcaption></figure><p id="16f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自动突出显示是不言自明的。正如你所看到的。-我们注入到URL中的SQL命令的符号我们现在创建了一个新的有效SQL命令，我们可以编辑它。作为运行该命令的结果，我们得到了如图14所示的结果。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b695ffcf657a8188007b19fcb16ca718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*1buuMYam9564NXdBjq3-Ng.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图14。数据库中的所有表。</figcaption></figure><p id="3b3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我发现的一个特殊的表是<strong class="kf ir">用户</strong>表。让我们进一步列举一下。正如在information_schema.tables中存在table_name一样，在<strong class="kf ir">information _ schema . columns</strong>中也存在一个<strong class="kf ir"> column_name </strong>，但是也可以将其过滤到users表中。让我们运行与图15中相同的URL。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/5e6ab84d940e55ff1f2e9a9d641e1c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CO0b6dSg0L0VhJ72jOhHuQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图15。</figcaption></figure><p id="b71f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">仅供参考，图16将是基于图15发送到SQL server的查询。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/3bb43afa7d906e32ed7ccc283be5cff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R8fKPrSvnl4DQMLquPlNyQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图16。将根据图15发送到SQL服务器的SQL查询。</figcaption></figure><p id="03ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">图15和16的结果我们可以在图17中看到。这里我们可以看到<strong class="kf ir">用户</strong>表包含的所有列名。我会说<strong class="kf ir">密码</strong>栏目是这里最有趣的一个。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/14eda423e27d9b7ce5dbffac0e865bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*dvD4MCJI7-8gThjko3-DSA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图17。users表中的所有列名。</figcaption></figure><p id="b935" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以让我们拿到所有的密码。运行图18中的URL。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/96d77d28821db42ff5be4647f979f636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*1mtiKdXPabFDijtgJ4Dznw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图18。</figcaption></figure><p id="8dd3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们可以看到所有用户及其附带的密码散列，参见图19。故事到此结束。我们现在已经达到了检索所有密码散列的目标。在这之后，需要用hashcat或开膛手约翰之类的工具来破解哈希。但是我不会在这篇文章中讨论这个问题。</p><figure class="mr ms mt mu gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/9212e57836019eb21b6bfa8e1d0fb5e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*_FtiwEwiQ0johW1bfVg9hA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图19。用户及其密码哈希。</figcaption></figure><h1 id="5fc4" class="lz lc iq bd ld ma mb mc lg md me mf lj mg mh mi lm mj mk ml lp mm mn mo ls mp bi translated">如何披露SQL注入</h1><p id="4ba7" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">这篇文章只涵盖了SQL注入的绝对基础，所以我真的不指望你读完这篇文章后会全力以赴。但是，你会不会碰巧发现自己的网站容易受到SQL注入的影响，我希望你能向网站所有者透露。不要一路闯入，在你因为一个tick收到一个错误信息后，联系网站背后的人，告诉他们你是如何产生这个错误的。你不必再做什么了。</p><p id="0074" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有一件事，在适当披露之前，请不要吹嘘你的发现。当你向网站所有者透露后，为什么不吹嘘一下呢？</p><h1 id="12a0" class="lz lc iq bd ld ma mb mc lg md me mf lj mg mh mi lm mj mk ml lp mm mn mo ls mp bi translated">最终想法</h1><p id="d299" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">感谢您阅读全文。我希望你觉得有趣。SQL和SQL注入是一个广泛的话题，我希望这篇文章只是冰山上的一片雪花。祝你在黑客研究中一切顺利。</p></div></div>    
</body>
</html>