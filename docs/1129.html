<html>
<head>
<title>Grafana Admin Panel bypass in Google Acquisition(VirusTotal)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌收购中的Grafana管理面板旁路(VirusTotal)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/grafana-admin-panel-bypass-in-google-acquisition-virustotal-c5ecc9d7b8ae?source=collection_archive---------1-----------------------#2021-02-20">https://infosecwriteups.com/grafana-admin-panel-bypass-in-google-acquisition-virustotal-c5ecc9d7b8ae?source=collection_archive---------1-----------------------#2021-02-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cf0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我从谷歌收购案(VirusTotal)的常见子域侦查开始。这一次我使用了在线子域搜索服务<a class="ae kl" href="https://subdomainfinder.c99.nl/" rel="noopener ugc nofollow" target="_blank">https://subdomainfinder.c99.nl/</a>来快速找到子域。</p><p id="c888" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我发现了一个子域<a class="ae kl" href="https://grafana.internal.virustotal.com/" rel="noopener ugc nofollow" target="_blank">grafana.internal.virustotal.com</a>，子域中的内部一词让我出于好奇访问了那个页面。</p><p id="081f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但遗憾的是，它只针对授权用户。我搜索grafana端点访问/注册，并试图注册新帐户，它显示注册被禁用。</p><p id="b0e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我想如果oath sign in被允许的话，我可以试试用Google，Github或者其他任何服务登录。但是新用户注册时一切都被禁用了。</p><p id="ba5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我知道登录的唯一方法是使用现有的用户名和密码。因为是谷歌收购，我不想尝试对用户名和密码的暴力攻击(管理员可能有非常强的用户名和密码)。</p><p id="1b34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，一切都是徒劳的，我想探索更多的终点，所以访问了grafana的文件。我遇到了<a class="ae kl" href="https://grafana.com/docs/grafana/latest/http_api/user/" rel="noopener ugc nofollow" target="_blank">https://grafana.com/docs/grafana/latest/http_api/user/</a>，其中提到了添加、编辑用户和更改密码的端点。但是提到的功能中很少只有管理员可以使用。</p><p id="b6c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还注意到，在docs页面中，<code class="fe km kn ko kp b">Authorization: Basic YWRtaW46YWRtaW4=</code>在大多数敏感请求中都是作为基本的Auth头发送的。上面的标题是base64编码的，所以尝试解码，结果令人惊讶:</p><pre class="kq kr ks kt gt ku kp kv kw aw kx bi"><span id="9388" class="ky kz iq kp b gy la lb l lc ld">admin:admin</span></pre><p id="2f08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，基本的验证用户名和密码只是admin:admin。</p><p id="57fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我做了一个快速的概念验证，我在Firefox(<a class="ae kl" href="https://mybrowseraddon.com/modify-header-value.html" rel="noopener ugc nofollow" target="_blank">https://mybrowseraddon.com/modify-header-value.html</a>)中安装了修改头值扩展，并将其配置为在对<a class="ae kl" href="https://grafana.internal.virustotal.com/" rel="noopener ugc nofollow" target="_blank">grafana.internal.virustotal.com</a>的所有请求中发送基本授权头。</p><p id="4a1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">令人惊讶的是，我是以管理员身份登录的，拥有完全的权限。我还为自己创建了一个新用户并授予了管理员权限，创建了一个管理员api密钥，还使用生成的api密钥发送了一个带有简单curl请求的poc，以证明我对应用程序拥有完全访问权限。</p><pre class="kq kr ks kt gt ku kp kv kw aw kx bi"><span id="0abb" class="ky kz iq kp b gy la lb l lc ld">curl -H “Authorization: Bearer API_KEY” <a class="ae kl" href="https://www.google.com/url?q=https://grafana.internal.virustotal.com/api/dashboards/home&amp;sa=D&amp;usg=AFQjCNF9CSi4maQcZc3ldDT9_RNzdjET_w" rel="noopener ugc nofollow" target="_blank">https://grafana.internal.virustotal.com/api/dashboards/home</a></span></pre><figure class="kq kr ks kt gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi le"><img src="../Images/ead3fcde5ee8f69ff511af1f1129b3e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGWL7AcfOuM6cCpNQs27cg.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">Grafana管理面板(以管理员身份登录)</figcaption></figure><p id="434a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我还遇到了一个页面，这是通过管理面板泄漏电报api密钥。电报api密钥被用作向virustotal的内部电报组发送通知的挂钩。</p><p id="f419" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我再次使用一个简单的curl请求生成了一个快速poc，通过它我可以使用bot向任何人发送电报消息。</p><pre class="kq kr ks kt gt ku kp kv kw aw kx bi"><span id="8c81" class="ky kz iq kp b gy la lb l lc ld"><a class="ae kl" href="https://www.google.com/url?q=https://api.telegram.org/bot443945044:AAF9DmJHMwwP2FheUkD04BlUf4pt3i5YA0Y/sendMessage?chat_id%3D-1001130484968%26text%3DHi%2520%250AThis%2520is%2520Jayateertha%2520G%252C%250A%250AI%2520reported%2520a%2520grafana%2520admin%2520panel%2520bypass%2520issue%2520earlier.%250Ahttps%253A%252F%252Fissuetracker.google.com%252Fissues%252F176016146%250A%250AThanks%2520and%2520Regards%2520%250AJayateertha%2520G&amp;sa=D&amp;usg=AFQjCNHuDWWtUhBBUelNcXBwHjKcNDDazg" rel="noopener ugc nofollow" target="_blank">https://api.telegram.org/bot_API_KEY/sendMessage?chat_id=userid&amp;text=</a>SOME_URL_ENCODED_TEXT</span></pre><p id="0fee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我对grafana面板有管理员权限和控制权，对telegram bot也有控制权。</p><p id="b4bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我做了一个详细的poc，提到了重现bug的所有步骤以及影响，并提交给了GoogleVRP。这个bug被接受并奖励了xxx美元，因为它是谷歌的收购。</p><p id="13f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">喜欢我的文章吗？在Twitter(<a class="ae kl" href="https://twitter.com/jayateerthaG" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">】@ jayaterthag</strong></a><strong class="jp ir">)和medium上关注我，了解更多关于bugbounty、Infosec、网络安全和黑客攻击的内容。</strong></p></div></div>    
</body>
</html>