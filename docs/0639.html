<html>
<head>
<title>Agent Sudo Walkthrough-Tryhackme</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代理Sudo演练-Tryhackme</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/agent-sudo-walkthrough-tryhackme-d0abf6f2c6a1?source=collection_archive---------0-----------------------#2020-06-18">https://infosecwriteups.com/agent-sudo-walkthrough-tryhackme-d0abf6f2c6a1?source=collection_archive---------0-----------------------#2020-06-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/dd99547a597f0c4af90f601316e5736b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*ROVJ1Xxr97l1arWi-Zqi5Q.png"/></div></figure><p id="5553" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">代理Sudo是由Deskel创建的Tryhackme上的一个简易房间。该机器需要枚举、哈希破解、隐写术和权限提升。</p><p id="94f0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们从Nmap扫描开始了解开放的端口。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ks"><img src="../Images/912c0ad8b6710ea399eeeb1af187b658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SvSWXA_9s7vOvTdetYTKxA.png"/></div></div></figure><p id="3f7e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们有3个端口，所以首先，我们检查网页浏览器的端口80。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi lb"><img src="../Images/56b254afed0ed1661083c8e7b73da9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*GGuNIbBq0vpe85XqQVE7Bw.png"/></div></div></figure><p id="7a3b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，从网页上，我们看到了来自代理r的代理公告。tryhackme提示是将“用户代理”改为“C”。所以我们启动了Burpsuite来拦截这个请求。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/d3d189c8c581f1c2b981e1ae8af675f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*zcP4MyfmhcO3Td4Lx_G9Jw.png"/></div></figure><p id="e3b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在捕获请求后，我们用“C”修改了“用户代理”,并转发请求。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/5800b2c853de2375ec0ab5d4e91b1c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*iGakSBJzy14bO90JqQSz_g.png"/></div></figure><p id="8ac1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们在Burpsuite上收到成功消息后，我们查看了网页。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ld"><img src="../Images/b56a72793f304a51f18b09483ead05d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0zDIvetWOAp-SxSij9Zhhw.png"/></div></div></figure><p id="ab85" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们得到了一个代理的名字，从消息中，我们知道代理的密码很弱，所以现在我们可以用Hydra来强制FTP。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi le"><img src="../Images/76e9245af97e21f7871ce57dd5c781f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*9DN7U9_HXwxxJLw0N8Z5zw.png"/></div></figure><p id="9ffe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们知道了可以通过FTP登录的代理的密码。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/b19671b40d8a6bac9297e547befc897e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*AAqHjyHQaVjBhflLJXkcMw.png"/></div></figure><p id="1bfe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们已经通过FTP成功登录，我们检查了内容，我们得到了图像和一个文本文件，我们使用“get command”下载了所有文件。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/be4c291a80c9db6302b7bade3f63dc23.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*0PSqUzjgbJuftgDnJ5vzvg.png"/></div></figure><p id="3473" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过查看“To_agentJ.txt”文件，该消息是克里斯的登录密码存储在假图片中。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi lh"><img src="../Images/7c46dfe2c2bc678feb2b836a4623c336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OcBWLpMDm-B_tRIYdUh_JQ.png"/></div></div></figure><p id="0a07" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，我们使用“Steghide”来检索一些隐藏的信息，并通过“ExifTool”检查“cutie.png”文件，但在我们尝试使用“binwalk”后，什么也没有出现，我们在“cutie.png”文件中获得了一个zip文件，并从“cutie.png”中提取了它，但它是加密的。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi li"><img src="../Images/8502cd9274ddcbc380b03361196026f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZgAXzhAjKZUcAIlvyIJ9sg.png"/></div></div></figure><p id="b06a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，我们使用“zip2john”来破解这个命令的密码zip文件</p><blockquote class="lj lk ll"><p id="f7b8" class="ju jv lm jw b jx jy jz ka kb kc kd ke ln kg kh ki lo kk kl km lp ko kp kq kr ij bi translated">。/zip2john 8702.zip &gt; Output.txt</p></blockquote><p id="5609" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后我们利用约翰来破解。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi lq"><img src="../Images/e4fc6e95534c25451d4289f4f334c9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BShxiM0PBTFjlOn2ke-ZOA.png"/></div></div></figure><p id="7318" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们得到了“a****”密码，所以我们尝试解压缩zip文件，但是unzip命令不起作用，所以我们使用了这个命令</p><blockquote class="lj lk ll"><p id="dc5d" class="ju jv lm jw b jx jy jz ka kb kc kd ke ln kg kh ki lo kk kl km lp ko kp kq kr ij bi translated">7z e 8702.zip</p></blockquote><p id="0166" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">输入密码并解压zip文件后，我们收到了这条消息。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi lr"><img src="../Images/1a3b820d1d27a577686ffa6d9079efc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4foBPiWbZFz1n-O8yYxeXQ.png"/></div></div></figure><p id="f29b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这条信息来自特工R，我们用电脑破解了这条“Q******”信息。Cyberchef建议自动解码。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ls"><img src="../Images/05c41bf4ac8915f06a9e1569dd8d4670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PMEm74Y2vTThQvFqSea_KA.png"/></div></div></figure><p id="c0b7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们得到了密码，现在只剩下图片文件“可爱的外星人。jpg ”,所以我们使用“隐藏”工具来检索隐藏的信息。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/3bbfa7682307dc672d16cf88a8cea0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*mYZtCLTwP0ndSoFqp7WMig.png"/></div></figure><p id="3710" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">信息被提取到“message.txt ”,在查看消息后，我们得到了用户名和密码。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/3617c7436def39ece31045c625759101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*9AafSbFkoWfCKeiy_UIkiw.png"/></div></figure><p id="a462" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我们使用找到的用户名和密码通过SSH登录到计算机，现在我们可以读取用户标志了</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/487e4d2b316acfb3e9f69a658e1e59ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*xbUrz-wK0a4KvZ6PNnJuNg.png"/></div></figure><h1 id="ac1d" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">特权限制</h1><p id="845a" class="pw-post-body-paragraph ju jv iq jw b jx mu jz ka kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr ij bi translated">我们检查了用户对“sudo -l”命令的权限。</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/1d70f2e584a6efa058f2c800fb49f0fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*A3z5ZWuTZczq-xyYHuLafA.png"/></div></figure><p id="986d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们在谷歌上搜索，发现Sudo 1 . 8 . 28版本存在漏洞，所以我们检查了Sudo的版本</p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/2b37696caf33b937706bcbd948a03c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*-g0y3CoJLkafpnHnii2b1Q.png"/></div></figure><p id="f8b5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们的sudo版本低于1.8.28，所以我们可以利用机器。</p><p id="c2cc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以阅读关于此漏洞的信息</p><p id="39fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae nb" href="https://nvd.nist.gov/vuln/detail/CVE-2019-14287#:~:text=CVE-2019-14287%20Detail&amp;text=In%20Sudo%20before%201.8.,with%20a%20crafted%20user%20ID." rel="noopener ugc nofollow" target="_blank"> CVE-2019-14287 </a></p><figure class="kt ku kv kw gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/f05efdf6dba448ce54c02d6464f638a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*1o_IV9ruJXzvYmMlJcj3nw.png"/></div></figure><p id="576d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">嗯，我们现在是根了！</p><p id="b090" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我希望你已经学到了一些东西</p></div></div>    
</body>
</html>