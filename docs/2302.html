<html>
<head>
<title>Server Side Template Injections Portswiggers Labs Walkthrough.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">服务器端模板注入端口触发器实验室演练。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/server-side-template-injections-portswiggers-labs-walkthrough-5a1a06f057d2?source=collection_archive---------1-----------------------#2022-08-24">https://infosecwriteups.com/server-side-template-injections-portswiggers-labs-walkthrough-5a1a06f057d2?source=collection_archive---------1-----------------------#2022-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6801391ab5f8fada833dcf3af9ba3db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_fRGG5ntaNZoj3T9.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">SSTI</figcaption></figure><p id="e6c1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">嗨，我的名字是哈沙尔·穆贾希德。今天我们将解决一些关于服务器端模板注入的实验。</p><p id="1258" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你想了解什么是服务器端模板注入漏洞，我强烈建议你阅读我以前的<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/server-side-template-injections-by-hashar-mujahid-e5a1a383027e"> <strong class="ke ir">博客</strong> </a>。</p><p id="ed6e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">好的，让我们首先开始，我们需要在头脑中保持这个方便的小图表，它解释了利用SSTI漏洞的步骤。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/dbb326b4a8727ad0907c18d76ce17241.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/0*78xtuZpkn4cB25K6.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">方法学</figcaption></figure><p id="e0c5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将从2号实验开始，因为1号实验已经在之前的博客中解决了。</p><p id="12a8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">实验2: <a class="ae la" href="https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-basic-code-context" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">【基本服务器端模板注入(代码上下文)</strong> </a> <strong class="ke ir"> : </strong></p><p id="f93f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">目标:</p><p id="b6fa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个实验室容易受到<a class="ae la" href="https://portswigger.net/web-security/server-side-template-injection" rel="noopener ugc nofollow" target="_blank">服务器端模板注入</a>的攻击，因为它不安全地使用了Tornado模板。要解决这个实验，请查看Tornado文档以了解如何执行任意代码，然后从Carlos的主目录中删除<code class="fe lg lh li lj b">morale.txt</code>文件。</p><p id="a474" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以使用以下凭证登录自己的帐户:<code class="fe lg lh li lj b">wiener:peter</code>。</p><p id="4d01" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">步骤1:找到易受攻击的端点。</p><p id="3bc4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用给定的凭据登录。登录后，我们可以看到有一个新的首选名称功能。让我们测试一下这个功能。</p><p id="37fa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当我们更改首选名称时，请求看起来像。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lk"><img src="../Images/17fb93b08a04d0bb7df384f3e32ccb61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LSGIfAbdcB-YFI3BsLcwog.png"/></div></div></figure><p id="69bb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们可以看到它使用编码上下文来设置首选用户名。在这个例子中，它使用了用户类昵称的属性。</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="a348" class="lp lq iq lj b gy lr ls l lt lu">user.nickname</span></pre><p id="7276" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">以及我们是否将它设置为它使用的第一个名称。</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="696e" class="lp lq iq lj b gy lr ls l lt lu">user.firstname</span></pre><p id="b9db" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当我们在博客上发表评论说我们的名字根据我们喜欢的名字而改变时，我们可以看到这一点。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lv"><img src="../Images/3e6df3e252deeaa5c441b9546b780fad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJXXfRFOlYI56MkTrzEm-g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">绰号</figcaption></figure><p id="9f6c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将“首选姓名”更改为“名字”。备注中的姓名将更改为“peter”。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/9094d59d237ba0bb46510452ad8aa6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BREg7hkXFFt1D7K_y1-lxg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">西方人名的第一个字</figcaption></figure><p id="f8df" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，我们可以尝试使用我们的首选名称功能，我们可以尝试插入一些恶意的有效载荷。</p><p id="281a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">第二步:识别</p><p id="42e6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">正如在实验描述中已经解释的那样，它使用tornado模板，我们可以尝试查看tornado文档来了解如何执行任意代码。</p><div class="lx ly gp gr lz ma"><a href="https://www.tornadoweb.org/en/stable/template.html#syntax-reference" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">tornado.template -灵活的输出生成- Tornado 6.2文档</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">tornado.template -灵活的输出生成</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">- Tornado 6.2文档tornado.template -灵活输出generationwww.tornadoweb.org</p></div></div></div></a></div><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="3737" class="lp lq iq lj b gy lr ls l lt lu"><em class="mj">### base.html</em><br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;{% block title %}Default title{% end %}&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;ul&gt;<br/>      {% <strong class="lj ir">for</strong> student <strong class="lj ir">in</strong> students %}<br/>        {% block student %}<br/>          &lt;li&gt;<strong class="lj ir"><em class="mj">{{ escape(student.name) }}</em></strong>&lt;/li&gt; ==&gt; <strong class="lj ir">this looks like same implementation that is used in our lab.</strong><br/>        {% end %}<br/>      {% end %}<br/>    &lt;/ul&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;<br/><br/><em class="mj">### bold.html</em><br/>{% extends "base.html" %}<br/><br/>{% block title %}A bolder title{% end %}<br/><br/>{% block student %}<br/>  &lt;li&gt;&lt;span style="bold"&gt;<strong class="lj ir">{{ escape(student.name) }}</strong>&lt;/span&gt;&lt;/li&gt;<br/>{% end %}</span></pre><p id="826c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们现在知道的一切都在<code class="fe lg lh li lj b">{{ }}</code>被评估。</p><p id="808e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们测试一下。</p><p id="328d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将POST/my-account/change-blog-POST-author-display发送到您的中继器，并尝试注入有效负载</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/1a4f3d7df72cf3d59f35e20348e302cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gGvdOFHxo1j8hXHgbiDe5Q.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">有效载荷</figcaption></figure><p id="b465" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们需要在我们的有效载荷前添加<code class="fe lg lh li lj b">}}</code>来转义<code class="fe lg lh li lj b">user.first_name</code>。</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="43c7" class="lp lq iq lj b gy lr ls l lt lu"><strong class="lj ir">user.first_name}}{{7*7</strong> ==&gt; Payload<br/>We will not add closing barces because they are lready included in the backend.</span></pre><p id="a2f6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们刷新我们发表评论的博客。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/d988b8b8e0c32553549d4d6d45a797bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kqMH6RXJrIxpbnWoEzttZg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">评论</figcaption></figure><p id="6785" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们可以看到我们的有效载荷被执行了。</p><p id="980f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">第三步:剥削。</p><p id="ef64" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有一篇关于如何利用tornado模板的很棒的文章。</p><div class="lx ly gp gr lz ma"><a href="https://ajinabraham.com/blog/server-side-template-injection-in-tornado" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">Tornado中的服务器端模板注入</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">这篇文章解释了Python tornado web框架中的服务器端模板注入(SSTI)。龙卷风是一个伟大而简单的…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">ajinabraham.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr jw ma"/></div></div></a></div><p id="cef6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">原来我们可以导入该模块来执行操作系统命令。</p><p id="804e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe lg lh li lj b">{% import *module* %}</code> -允许你导入python模块。</p><p id="594b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">示例:</p><p id="a992" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe lg lh li lj b">{% import os%}</code></p><p id="57c7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们现在可以制造我们的有效载荷。</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="489e" class="lp lq iq lj b gy lr ls l lt lu">{% import os %}{{ os.popen("ls").read() }}</span></pre><p id="aef3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe lg lh li lj b">ls</code>命令列出目录中的内容</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/42bea8050b43ba6f03873b68e798155b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FBZ4aEiwBoujx_PfriLzNQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">有效载荷</figcaption></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/1d244f1d3125796d0b242086e79a7430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E75TLk1mba3xbELSSpsfaQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">morle.txt</figcaption></figure><p id="9ea8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们删除它。</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="7289" class="lp lq iq lj b gy lr ls l lt lu">{% import os %}{{ os.popen("rm morale.txt").read() </span></pre><p id="12f2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在发送请求并重新加载实验室。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/66c9861a180a2137040dfc0a53f46f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAEN6fDerqwKqtLoqbzTpQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">恭喜</figcaption></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="8438" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">实验3: <a class="ae la" href="https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-using-documentation" rel="noopener ugc nofollow" target="_blank">使用文档的服务器端模板注入</a></p><p id="f745" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个实验室容易受到<a class="ae la" href="https://portswigger.net/web-security/server-side-template-injection" rel="noopener ugc nofollow" target="_blank">服务器端模板注入</a>的攻击。要解决这个问题，需要识别模板引擎并使用文档来找出如何执行任意代码，然后从Carlos的主目录中删除<code class="fe lg lh li lj b">morale.txt</code>文件。</p><p id="7079" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以使用以下凭据登录您自己的帐户:</p><p id="f0ea" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe lg lh li lj b">content-manager:C0nt3ntM4n4g3r</code></p><p id="761a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，在本实验中，我们需要首先确定模板引擎。</p><p id="5b41" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们开始吧。</p><p id="4aa8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，登录您的帐户，我们可以从帐户名中看到我们是内容管理员，因此我们肯定会有一些额外的功能。</p><p id="1285" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们可以在产品详细信息页面上看到，我们有权编辑模板。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/ddb6fe23a6a56337ce3ca7329d6fde82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fEHI2FL6bzGMwW2cbzk_RA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">编者ˌ编辑</figcaption></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/95364cfc6979efb9a3db714f667d3abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*5riJb4SO5yihiIU20X8YIQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">端点</figcaption></figure><p id="1505" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是我们的终点。让我们进一步分析一下，</p><p id="8a95" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我在最后添加了我的有效载荷，我们可以看到它被评估</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/3826722396f6fed5e91b6ed799b02ed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwGop7UHJaXy3BdAtg_nUA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">见最后的49。</figcaption></figure><p id="980e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们需要确定使用了哪种类型的模板引擎，以便我们可以进一步利用它。</p><p id="76de" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们需要手动检测模板引擎。有一个很棒的网站可以帮助你指导如何检测模板引擎。</p><div class="lx ly gp gr lz ma"><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">SSTI(服务器端模板注入)</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">模板引擎被设计成通过将固定模板与易变数据相结合来生成网页。服务器端…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">book.hacktricks.xyz</p></div></div><div class="mm l"><div class="nf l mo mp mq mm mr jw ma"/></div></div></a></div><p id="266d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在尝试了不同的有效载荷后，我们在2个有效载荷上得到了相同的结果</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="9582" class="lp lq iq lj b gy lr ls l lt lu">${7*7}<br/>#{7*7} <br/>both resulted 49 in the answer</span></pre><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/60b83265912b092274ce7031c1f6232c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cKVdo4wTks6as4p9S3tj5A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">根据有效载荷，结果相同</figcaption></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/63ef8fcc679ff64969da724cda3e2dd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fig7jHWwDY8TQx4FEv98zQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">java模板已确认</figcaption></figure><p id="b8bd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们可以从使用FreeMaker模板的错误中看到。</p><p id="69ed" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们打开文档，学习如何利用它。</p><p id="de33" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有一个execute类可以帮助我们执行任意代码。</p><div class="lx ly gp gr lz ma"><a href="https://freemarker.apache.org/docs/api/freemarker/template/utility/Execute.html" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">执行(FreeMarker 2.3.31 API)</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">赋予FreeMarker执行外部命令的能力。将派生一个进程，并内联该进程的任何内容…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">freemarker.apache.org</p></div></div></div></a></div><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="ca5e" class="lp lq iq lj b gy lr ls l lt lu">SimpleHash root = new SimpleHash();<br/><br/> root.put( "exec", <strong class="lj ir">new freemarker.template.utility.Execute()</strong> );</span></pre><p id="171f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们可以看到语法是如何工作的。</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="df74" class="lp lq iq lj b gy lr ls l lt lu">The following is executed:<br/> ${exec( "/usr/bin/ls" )}</span></pre><p id="8815" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你不想经历这一切，有一个很好的演练，解释如何执行Freemaker模板上的代码。</p><div class="lx ly gp gr lz ma"><a href="https://ackcent.com/in-depth-freemarker-template-injection/" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">深度Freemarker模板注入- Ackcent</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">在最近的一次参与中，我们的AppSec团队遇到了一个有趣的例子，在…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">ackcent.com</p></div></div><div class="mm l"><div class="ni l mo mp mq mm mr jw ma"/></div></div></a></div><p id="2547" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有效载荷</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="b642" class="lp lq iq lj b gy lr ls l lt lu">&lt;#assign ex="freemarker.template.utility.Execute"?new()&gt; ${ex("id")}</span></pre><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/9ba8b34795f947a53c9f0aa2afa2e2b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G82m8ixOV7aoarQkIUU6uQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">成功</figcaption></figure><p id="ef9e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们完成任务。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/2a3a019d082bbb332c163f1b187d0215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rlHx5SjnNsTITvqTjYBBHg.png"/></div></div></figure><p id="341d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们移除它。</p><pre class="lc ld le lf gt ll lj lm ln aw lo bi"><span id="d5d7" class="lp lq iq lj b gy lr ls l lt lu">&lt;#assign ex="freemarker.template.utility.Execute"?new()&gt; ${ex("rm morale.txt")}</span></pre><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/d671538086d37b1d47ece5b1a63fb134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0_N9pDQvTfoQjaSeTVBMg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">解决</figcaption></figure><p id="a616" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个有点棘手。</p><p id="ed05" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我强烈建议你通读我提供的文章。它真的会拓宽你的理解。</p><p id="40e0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">请跟随我进行更多类似的演练。</p><p id="8da2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">直到下一次。快乐黑客</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nm nn l"/></div></figure></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="7ba4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。 <a class="ae la" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir"> <em class="mj">加入我们的每周简讯</em> </strong> </a> <em class="mj">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>