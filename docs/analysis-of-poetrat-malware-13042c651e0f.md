# Poetrat 恶意软件分析

> 原文：<https://infosecwriteups.com/analysis-of-poetrat-malware-13042c651e0f?source=collection_archive---------3----------------------->

![](img/f37ff7a2e28c61d88195a10c075afd35.png)

> [哈希](#43c3)
> 
> [样品](#51d9)
> 
> [初始静态分析](#98f1)
> 
> [使用沙盒的行为分析](#dffa)
> 
> [什么是宏](#8f9d)
> 
> [VBA 文字的提取](#24f1)
> 
> [VBA 剧本分析](#6769)
> 
> [恶意 Python 代码分析](#cce5)
> 
> [指挥控制服务器(C2)](#9412)

你好，这里是黑客 Yuvaraj，今天我们将分析 Poetrat 恶意软件。Poetrat 是一种**远程访问木马(RAT)** ，这意味着攻击者能够控制和监控受害者的机器。这种恶意软件的目标是阿塞拜疆公共部门和其他重要组织。恶意软件是一个 word 文档。当打开文件时，它会执行一个恶意的 VBA 脚本，将恶意软件放入你的系统。

# 哈希:

MD5:3 aadbf 7 e 527 fc 1a 050 E1 c 97 FEA 1c ba 4d

sha 256:208 EC 23 c 233580 DBF c53 aad 5655845 f 7152 ada 56 DD 6a 5 c 780d 54 e 84 a9 d 227407

# 样本:

[](https://github.com/UVvirus/malware_samples/tree/main/Poetrat) [## 主 UVvirus/malware _ samples/poet rat

### 在 GitHub 上创建一个帐户，为 UVvirus/malware_samples 的开发做贡献。

github.com](https://github.com/UVvirus/malware_samples/tree/main/Poetrat) 

# **初始静态分析:**

通过查看**文件**命令的输出，它说这是一个 word 文件。

![](img/831bfd18f80b850f7a6ed9cd5772906c.png)

通过在 Pestudio 中加载样本，我们可以看到 62 个样本中有 39 个在 Virustotal 中被标记为恶意。

![](img/300cd38a1825d7a6df859d90bf29ba73.png)

# 使用沙盒的行为分析:

让我们在 **ANY 运行恶意软件。运行**沙盒，试着弄清楚它在做什么。

![](img/fac6bbf47975e4921a5acfed5dbdc447.png)

嗯…通过查看上面的图像，我们可以说这个 word 文档正在删除一些 python 文件并执行它们。

注意:- Word 文档可以使用宏实现这种类型的行为。

# 什么是宏:

宏是一系列的命令和指令，你把它们组合成一个单独的命令来自动完成一项任务。

让我们使用 olevba.py 从 word 文档中提取宏

# VBA 文字的提取:

为此，我将使用 olevba 工具。因为它会显示文件是否有任何可疑之处。

![](img/a3ace83312bc0ef802b8179910fd68d8.png)

> cmd: olevba.py poetrat

![](img/696334b1037984e1a3587afb29ff5bc9.png)

# VBA 剧本分析:

首先，它将文档文件 docer.doc 复制到位置**“C:\ Users \ Public \ docer . doc”。**然后从文档中提取最新的 **7074638 字节**并创建一个名为 **smile.zip** 的 zip 文件。

然后解压成**“C:\ Users \ Public \ python 37”。**从 smile.zip 中提取的文件有

launcher.py，皱眉. py，微笑 _ 有趣. py，微笑. py，仿射. py，靠山. py

所有文件看起来都很有趣，但让我们从 launcher.py 开始。

# 恶意 Python 代码分析:

在 launcher.py 中，恶意软件试图通过使用 **good_disk_size()** 方法检查磁盘大小来识别它是否正在沙箱中运行。

如果磁盘大小小于 62GB，那么根据恶意软件，它是一个沙箱。如果发现恶意软件运行在沙盒上，那么它会用 license.txt 文件覆盖 **smile.py、皱眉. py 和 smile_funs.py** 的内容，并终止程序。

![](img/f089800c0650f94f2ad95d8e810f11fc.png)

如果上述情况不成立，那么它将触发**警察()**功能。该功能将启动 **smile.py 和皱眉. py.**

smile.py 模块负责执行截图、上传文件等命令。

第二个模块皱眉. py 用于与 c2(命令和控制)服务器通信。

# 指挥和控制服务器(C2):

dellgenius.hopto.org

hopto.org 被广泛用于实施虐待行为。

# 最终想法:

如果你喜欢我的工作，你可以在这里给我买杯咖啡

[![](img/55f8dd51be2f7a62a32e4f4e73b6c34c.png)](https://buymeacoffee.com/UVvirus)