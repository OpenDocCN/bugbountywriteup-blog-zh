# 敲门

> 原文：<https://infosecwriteups.com/knocking-the-idor-6f80e8126ee4?source=collection_archive---------1----------------------->

*注:以下文章发表于 2016 年 11 月 27 日 https://FogMarks.com*[](https://fogmarks.com/2016/09/13/jumping-over-the-fence/)

*![](img/b583dd829e4d4d73d92d4e252aa1b6ea.png)*

*信用:actionplusbb*

> *很抱歉 11 月没有新帖子，FogMarks 一直忙于体验新的领域和世界。但是现在，我们又回到了宝贝上！*

*T
今天的案例研究是关于一件旧事(我说的“旧事”是指 3 个月前的事)，但由于最近对一家非常知名的公司的流行产品进行了积极的研究，我想介绍并解释一下在您的应用中拥有反 IDOR 机制的巨大重要性。*

## *介绍*

*基本上，IDOR(不安全的直接对象引用)允许攻击者篡改不属于他的对象。这可能是用户的私人凭证([如电子邮件地址](http://fogmarks.com/2016/05/16/how-private-is-your-private-email-address/))、攻击者不应该访问的私人对象([如私人事件](http://fogmarks.com/2016/08/09/private-element-gone-public1/))，或者第三方不应该简单合理地更改(或查看)的公共信息。*

*当攻击者能够乱动不属于他的物体时，后果可能是毁灭性的。我不只是在谈论可能导致业务瘫痪的关键信息泄露(就像脸书最近的发现)，我还在谈论可能导致攻击者在服务器上执行代码的对象。不要如此震惊——这是很有可能的。*

## *从伊多尔到 RCE*

*我不会透露发现这个严重漏洞的公司或软件的名称。我甚至不会说这是一家拥有 QA 和安全响应团队的大公司，可以填满整个商场。两次。
但是，正如你可能已经猜到的，获得对某个你本不应该访问的对象的访问权，有时会允许你在服务器上实际运行命令。*

*虽然我不能谈论具体的漏洞，但我将揭示我从根源上防止 IDOR 的逻辑。*

## *理想地说*

*正在使用防 IDOR 机制(AIM)阻止 IDOR。我们 FogMarks 几年前已经开发了一个，而且，幸运的是，我们的客户从来没有处理过 IDOR 问题。别担心，我们不会让你买的。这种机制只为共享相同代码库的两个大客户而创建。用下面的信息创建你自己的机制，天哪！
不过说真的，AIM 的主要目标是 AIM(拿到游戏这个词了？)某个对象的使用权仅限于创建该对象的用户或有权访问该对象的用户。*

*这是通过将信息存储在数据库中来实现的，**特别是**那些可能成为网络客户端攻击目标的敏感对象。
当一个对象被插入数据库时，该机制为其生成一个唯一的 32 字符长的标识符。这个标识符只被服务器使用，它被称为“SUID”(服务器使用的 ID)。此外，该机制为客户端发布一个 15 个字符长的整数标识符，当然，它被称为“CUID”(客户端使用的 ID)。**CUID 整数是由 32 个字符长的 SUID 的一部分和对象细节(如它的名字)的一部分使用一种特殊的算法制成的。***

*为同一个对象生成两个标识符的想法是不要向客户端透露实际敏感对象的标识符，这样就不会在应用程序的意外部分进行直接访问。*

*由于对象属性往往会改变(例如，像它们的名字一样)，CUID 每隔一段时间就会被替换，逻辑的“核心”是仔细地将 CUID 与 SUID 匹配起来。*

*在用户权限中，还有一个节点列表，其中包含用户有权访问的对象的 SUID。*

*当用户从客户端发出请求时，算法会尝试从提供的 CUID 中生成部分 SUID。如果成功，它会尝试将该部分与用户权限集合中的一个 SUIDs 列表进行匹配。如果它们匹配，发出请求的用户将获得对该对象的**一次有限的**访问。这种一次性访问为一个静态 IP 启用了 x 分钟，直到下一个将 CUID 与 SUID 匹配的过程。*

*当然，所有这些过程都是由一个机制来管理的——目标。
AIM 以队列形式处理请求，因此当处理多个并行请求时，AIM 可能不是完美的解决方案(由于对象可能会被两个不同的用户同时更改)。*

## *结论*

*为了让你的平台免受入侵，访问敏感对象的请求应该只由一种机制来管理。*

*您不必像我一样实现精确的逻辑，并为同一个对象编译两个不同的标识符，但是您应该**明确地只在一个地方管理私有对象的请求和权限。***

*以下是 FogMarks 在一些非常受欢迎的公司中发现的 IDORs 的更多示例(当然，已经打了补丁):*

*下次见！*