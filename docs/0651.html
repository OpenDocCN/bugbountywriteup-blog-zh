<html>
<head>
<title>Lazy Admin Walkthrough-Tryhackme</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">懒惰管理员演练-Tryhackme</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/lazy-admin-walkthrough-tryhackme-158540d2ec24?source=collection_archive---------0-----------------------#2020-06-24">https://infosecwriteups.com/lazy-admin-walkthrough-tryhackme-158540d2ec24?source=collection_archive---------0-----------------------#2020-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8f1b565a66ebdda9a93c1c2c7ac87f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kqRg-M_-f2tagfNcv_GnRw.png"/></div></div></figure><p id="73cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">轻松的Linux机器来练习你的技能。</p><h2 id="5b9d" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">列举</h2><p id="94ac" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">我们做了Nmap扫描来了解开放的端口。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/75889fc7b7f90dc0a99220d622c35a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JjSHd5zDt953WBSPpE3kA.png"/></div></div></figure><p id="2fc8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">扫描显示2个打开的端口(端口80)和(端口22)端口80正在运行Apache。在我们检查了端口80上的网页后，我们得到了Apache的默认网页。所以我们运行Gobuster来获取目录。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/8d9afb7cf6073237b433354a0eb1c156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*An5jhGSHQ5LAk23IKV3iMg.png"/></div></div></figure><p id="9375" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到了一个名为“/content”的目录，所以我们通过浏览来检查这个目录。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/172c0b5d005f75b4b8c9ecff6d813147.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*09qe4r9UsuT1sOPiK1ZMdQ.png"/></div></figure><p id="0782" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到了一个CMS SweetRice的网页，这是一个用于管理网站的内容管理系统。所以我们对“/content”目录运行Gobuster。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/baa943bb7967b522179645c867840c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Guxc2J4vp1ztZjGXHGnXpA.png"/></div></div></figure><p id="9688" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到了更多的目录“/as”目录包含一个登录页面，但我们没有登录的凭据，所以我们检查了其他目录，我们检查了“/inc”目录。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/32f4e7780c15cdfd44ba1494bf681480.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*vvJcpa9hYv22EUcs_7zxMg.png"/></div></figure><p id="7705" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到了一个“mysql_backup/”文件夹，因此我们检查了该文件夹。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/93d74b6e5ea05d79c01f936691ba8942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7uQwTYyZZ8WHPFeCadVZyg.png"/></div></div></figure><p id="e4b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们能够下载可能包含一些有用信息的文件，所以我们检查了MySQL备份数据库。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/2d4309cf250cabc88ac72a1a0b05ef2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJ2_raad-YeSHn0OWP1wZQ.png"/></div></div></figure><p id="58df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下载的文件中，我们通过搜索获得了用户名和密码，但是密码在哈希中，所以我们使用哈希标识符来知道这是哪种类型的哈希。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/038d344de97c6ede6027024af4be1d40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*ccAyHqw2O2y6ccxXaMrlNQ.png"/></div></figure><p id="16cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们知道这是MD5哈希，我们也可以使用crackstation来破解这个哈希，但我们使用了开膛手约翰工具，这是最流行的密码破解工具之一。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/ce187500cc6d797a13c78d6c740ec222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9d_K6GJcxaJdSvpeU98RQ.png"/></div></div></figure><p id="1113" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了用户名和密码，所以我们可以尝试登录到我们找到的“/as”目录</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/77b717f7861daeaf4fd9290e2b372c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ofYbCVIPnOn32HL-kAT3DQ.png"/></div></div></figure><p id="e147" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">提供凭据后，我们可以登录SweetRice的仪表板。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/67822b62849c040e1371397811912298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*i8ruWvz42F8XDINQCbVNVA.png"/></div></figure><p id="a3ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Ads部分，我们可以添加一个脚本来获得反向连接。我已经从<a class="ae mj" href="https://www.google.com/url?sa=t&amp;source=web&amp;rct=j&amp;url=http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet&amp;ved=2ahUKEwirgqHQ1pjqAhXLXCsKHWYsBk4QFjAAegQICBAD&amp;usg=AOvVaw3oXoyESccCKauF2V8n4rj8" rel="noopener ugc nofollow" target="_blank"> pentestmonkey </a>下载了一个Php反向shell脚本，不要忘记更改脚本上的Ip地址和端口。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/b7fa385a7ca5c572171d92d544bf494e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*LeueOozxWfgpLMYBSbmKNA.png"/></div></figure><p id="69a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们点击完成脚本上传。所以我们启动了一个Netcat监听器。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/afc665d9f7c8107fb37c792c07a15efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*l-oWsZK5bXWeaT2FyEJHKg.png"/></div></figure><p id="d215" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们必须点击我们的反向外壳来获得连接。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/211b6f82810e4d63fdfad69bb1c18e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*tzo2IUr1QdclYwsTTUQv4w.png"/></div></figure><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/0620cb6308929c79cce1871fa436b9c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*0EztjT1TqTR5Sz4qqN5bfQ.png"/></div></figure><p id="9902" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击shell.php后，我们得到了一个反向的外壳。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/c7a385c8f125fe2ed7075346709b9486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CP5XZAa460cpemOOdprdWQ.png"/></div></div></figure><p id="9e9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以使用“cat user.txt”命令读取用户标志，我们还可以升级这个shell。</p><blockquote class="mm mn mo"><p id="9864" class="jy jz mp ka b kb kc kd ke kf kg kh ki mq kk kl km mr ko kp kq ms ks kt ku kv ij bi translated">python3 -c '导入ptypty.spawn("/bin/bash ")'</p></blockquote><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/97d5b0733ebef66835ad279e1e02cc6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zHtlwSPgemxNDX0av-4nQ.png"/></div></div></figure><h1 id="689b" class="mt kx iq bd ky mu mv mw lb mx my mz le na nb nc lh nd ne nf lk ng nh ni ln nj bi translated">权限提升</h1><p id="a030" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">因此，我们检查了“sudo -l”命令的权限</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/b283b79204af5f1f7bc6556a4716a46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i9CLRMofVlk94PjGqC8wGw.png"/></div></div></figure><p id="2cdf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到，有一个文件可以用Perl和Sudo来执行，因此我们使用“cat /home/itguy/backup.pl”命令检查了该文件。我们没有权限写入该文件。让我们来读取该文件。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/758e01f7a79eb0ab8f4f35fd7091498f.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*fTaKAKHx4hqK2UC355F46Q.png"/></div></figure><p id="12e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个脚本运行一个bash脚本“/etc/copy.sh”让我们检查一下这个文件</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/a397571754b7a9bed11c213df5d16df4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*3U9E7V3xALFN_7DroQFUFg.png"/></div></div></figure><p id="2831" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们检查了可以写入该文件并执行的权限。已经有一个反向shell脚本，因此我们只需更改IP地址和端口，它将为我们提供一个反向连接。我们尝试使用nano和vim编辑该文件，但没有成功，因此我们使用了“echo”命令。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/27253909d0f624a9693816a89d6d9edd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0dBYocZ1loAmIfMff8xlw.png"/></div></div></figure><p id="6f4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在启动一个Netcat监听器来获得一个反向shell并执行这个文件</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/e81e22c82782516512a83dcc9a8ea942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i86uxlRZwsRamKIZOKn_hg.png"/></div></div></figure><p id="41a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯，我们现在是根了！</p><p id="25c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望你已经学到了一些东西。</p></div></div>    
</body>
</html>