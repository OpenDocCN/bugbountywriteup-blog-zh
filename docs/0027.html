<html>
<head>
<title>Account Take Over Vulnerability in Google acquisition [Famebit]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌收购中的账户接管漏洞[Famebit]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/account-take-over-vulnerability-in-google-acquisition-famebit-e93b1a0a7af9?source=collection_archive---------3-----------------------#2017-11-17">https://infosecwriteups.com/account-take-over-vulnerability-in-google-acquisition-famebit-e93b1a0a7af9?source=collection_archive---------3-----------------------#2017-11-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jn jo jp jq gh gi paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="gh gi gj"><img src="../Images/f83cf5174aa8982e846c1209507a9868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xqTbkRLK9tLhe-IalP_rNg.png"/></div></div></figure><p id="3518" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">问候，</p><p id="44e5" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">我是哈桑·汗·优素福扎伊，今天我将分享我最近在谷歌收购中的发现，即“Famebit”。我能够通过绕过电子邮件更改功能中的CSRF保护来接管受害者帐户。</p><p id="d198" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated"><strong class="jz ir">什么是跨站脚本伪造？</strong></p><p id="2683" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">"<strong class="jz ir">跨站点请求伪造</strong> ( <strong class="jz ir"> CSRF </strong>)是一种攻击，它迫使最终用户在他们当前已通过身份验证的web应用程序上执行不想要的操作"。</p><p id="7ff7" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">我希望你们都知道csrf的基础知识，我们不讨论基础知识，但如果你想学习，你可以在<a class="ae kv" href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)" rel="noopener ugc nofollow" target="_blank"> Owasp </a>查看。</p><p id="bd72" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated"><strong class="jz ir">让我们继续前进^^ </strong></p><p id="625f" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">基本上，我的一个朋友给了我一个网站，让我测试一下。因为我喜欢只在Bug人群私有程序中做笔测试。有一天我太累了，所以我想我们还是去打猎吧。</p><p id="477e" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">每当我开始测试一个Web应用程序时，我通常从/settings页面启动它，因为该页面包含了应用程序的基本功能。因此，当我寻找电子邮件更改功能时，我注意到没有“当前密码保护”。敏感操作中没有当前密码保护被认为是“bugcrowd”平台中的<strong class="jz ir"> p4 </strong>漏洞。所以，向谷歌举报是不值得的。</p><p id="a2e7" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">我检查了执行CSRF攻击的POST请求，但是在头中有X-Famebit-Token头&amp;我的第一个反应是“它不可能绕过，因为它的Google收购站点。Lol？”但是我想让我们试一试。</p><p id="8830" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated"><strong class="jz ir">请求&amp;带有反CSRF报头的响应</strong></p><figure class="kx ky kz la gt jq gh gi paragraph-image"><div class="gh gi kw"><img src="../Images/96f7c90b0664f1f2dc2fa04440d91c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*R9Et1zvHZTAiCY_LL20GlA.png"/></div></figure><p id="d9a5" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated"><strong class="jz ir">请求&amp;没有反CSRF报头的响应</strong></p><figure class="kx ky kz la gt jq gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/03a229b54cf3fc1aedf112220d2a2a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*tCYL2p6nsmBLsuMjjr-Ryw.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">WDF同样回应:D</figcaption></figure><p id="9154" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">因此，<strong class="jz ir"> X-Famebit-Token </strong>没有服务器端验证。这意味着CSRF是可能的。我用burp suite制作了CSRF POC，但是没有效果，响应是404 :/。我当时就想。伙计，为什么这没用。？？？？？？？？？？？？？？？</p><figure class="kx ky kz la gt jq gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/4f5746c5d0e95326a3802fb1158ae605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*MYA8ibrPd5ZqU_ru3GdsvQ.gif"/></div></figure><p id="483c" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">我想到的第一件事可能是它是基于推荐人的CSRF保护，但后来我发现它不是基于推荐人的。</p><p id="9937" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">所以，就像我们让JSON CSRF poc在post数据的末尾追加额外的数据一样&amp;在我的POST请求中是这样的</p><blockquote class="lh li lj"><p id="f2bb" class="jx jy lk jz b ka kb kc kd ke kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt ku ij bi translated">{ " email ":" attack @ hacker . com " }<strong class="jz ir">=</strong></p></blockquote><p id="29a6" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">我也犯了一个错误，认为它的服务器端保护有些how :P但是后来，我明白它不是任何服务器端保护，它只是自动附加在Json Csrf中的额外数据！对吗？(<strong class="jz ir">如不指正我</strong>)</p><p id="ab39" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">我是如何处理“<strong class="jz ir"> = </strong>”这件事的？很简单，我在我的post数据中使用了一个额外的参数ignore。Ignore只是取“=”并忽略它:)</p><p id="31f1" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated"><strong class="jz ir">最终漏洞:</strong></p><blockquote class="lh li lj"><p id="8620" class="jx jy lk jz b ka kb kc kd ke kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt ku ij bi translated"><br/>&lt;表单动作= "【https://famebit.com/auth/changeEmail】" method = " POST "/&gt;<br/>&lt;输入type = " hidden " name = "&amp;# 123；&amp;quot；电子邮件&amp;quot；&amp;# 58；quot;Attacker@hacker.com&amp;quot；&amp;# 44；<strong class="jz ir">&amp;quot；忽略&amp;quot；&amp;# 58；&amp;quot；</strong>" value = "&amp;quot；&amp;# 125；/ &gt; <br/> &lt;输入type = " Submit " value = " Submit Request "&gt;<br/>&lt;/表单&gt; <br/> &lt; /html &gt;</p></blockquote><p id="d525" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated"><strong class="jz ir">发布数据:</strong></p><blockquote class="lh li lj"><p id="d53a" class="jx jy lk jz b ka kb kc kd ke kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt ku ij bi translated">{ " email ":" attack @ hacker . com "，" ignore":"="}</p></blockquote><p id="6e56" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">因此，现在有了CSRF，就有可能改变vicitim的电子邮件，然后攻击者也可以改变密码。<strong class="jz ir">账户接管:</strong> D</p><figure class="kx ky kz la gt jq gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/e33819a32902df9835ce933509a054d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*Vg1-w_nkJzqg69OK2Agmkw.gif"/></div></figure><p id="bd7e" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated"><strong class="jz ir">概念验证:</strong></p><figure class="kx ky kz la gt jq"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="6f1f" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">就是这样，谷歌安全团队一天就搞定了:)。我希望你们学到了一些新的东西:-)</p><p id="4c02" class="pw-post-body-paragraph jx jy iq jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku ij bi translated">#Hack_To_Live#</p><blockquote class="lh li lj"><p id="b38c" class="jx jy lk jz b ka kb kc kd ke kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt ku ij bi translated"><strong class="jz ir">问候，</strong></p><p id="0c8d" class="jx jy lk jz b ka kb kc kd ke kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt ku ij bi translated">哈桑·汗·优素福扎伊</p><p id="a73c" class="jx jy lk jz b ka kb kc kd ke kf kg kh ll kj kk kl lm kn ko kp ln kr ks kt ku ij bi translated"><strong class="jz ir">安全研究员</strong></p></blockquote></div></div>    
</body>
</html>