<html>
<head>
<title>Knocking the IDOR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">敲门</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/knocking-the-idor-6f80e8126ee4?source=collection_archive---------1-----------------------#2019-06-30">https://infosecwriteups.com/knocking-the-idor-6f80e8126ee4?source=collection_archive---------1-----------------------#2019-06-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="32b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:以下文章发表于2016年11月27日https://FogMarks.com</em><a class="ae km" href="https://fogmarks.com/2016/09/13/jumping-over-the-fence/" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi kn"><img src="../Images/b583dd829e4d4d73d92d4e252aa1b6ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/0*WLKw7UC8IXayZIzp.jpg"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">信用:actionplusbb</figcaption></figure><blockquote class="kz la lb"><p id="bc43" class="jn jo kl jp b jq jr js jt ju jv jw jx lc jz ka kb ld kd ke kf le kh ki kj kk ij bi translated">很抱歉11月没有新帖子，FogMarks一直忙于体验新的领域和世界。但是现在，我们又回到了宝贝上！</p></blockquote><p id="11ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi lf translated"><span class="l lg lh li bm lj lk ll lm ln di"> T </span> <br/>今天的案例研究是关于一件旧事(我说的“旧事”是指3个月前的事)，但由于最近对一家非常知名的公司的流行产品进行了积极的研究，我想介绍并解释一下在您的应用中拥有反IDOR机制的巨大重要性。</p><h2 id="8933" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">介绍</h2><p id="6237" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">基本上，IDOR(不安全的直接对象引用)允许攻击者篡改不属于他的对象。这可能是用户的私人凭证(<a class="ae km" href="http://fogmarks.com/2016/05/16/how-private-is-your-private-email-address/" rel="noopener ugc nofollow" target="_blank">如电子邮件地址</a>)、攻击者不应该访问的私人对象(<a class="ae km" href="http://fogmarks.com/2016/08/09/private-element-gone-public1/" rel="noopener ugc nofollow" target="_blank">如私人事件</a>)，或者第三方不应该简单合理地更改(或查看)的公共信息。</p><p id="9d43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当攻击者能够乱动不属于他的物体时，后果可能是毁灭性的。我不只是在谈论可能导致业务瘫痪的关键信息泄露(就像脸书最近的发现)，我还在谈论可能导致攻击者在服务器上执行代码的对象。不要如此震惊——这是很有可能的。</p><h2 id="5d1a" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">从伊多尔到RCE</h2><p id="3cda" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">我不会透露发现这个严重漏洞的公司或软件的名称。我甚至不会说这是一家拥有QA和安全响应团队的大公司，可以填满整个商场。两次。<br/>但是，正如你可能已经猜到的，获得对某个你本不应该访问的对象的访问权，有时会允许你在服务器上实际运行命令。</p><p id="3561" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然我不能谈论具体的漏洞，但我将揭示我从根源上防止IDOR的逻辑。</p><h2 id="3ebb" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">理想地说</h2><p id="dd12" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">正在使用防IDOR机制(AIM)阻止IDOR。我们FogMarks几年前已经开发了一个，而且，幸运的是，我们的客户从来没有处理过IDOR问题。别担心，我们不会让你买的。这种机制只为共享相同代码库的两个大客户而创建。用下面的信息创建你自己的机制，天哪！<br/>不过说真的，AIM的主要目标是AIM(拿到游戏这个词了？)某个对象的使用权仅限于创建该对象的用户或有权访问该对象的用户。</p><p id="0dff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是通过将信息存储在数据库中来实现的，<strong class="jp ir">特别是</strong>那些可能成为网络客户端攻击目标的敏感对象。<br/>当一个对象被插入数据库时，该机制为其生成一个唯一的32字符长的标识符。这个标识符只被服务器使用，它被称为“SUID”(服务器使用的ID)。此外，该机制为客户端发布一个15个字符长的整数标识符，当然，它被称为“CUID”(客户端使用的ID)。<strong class="jp ir">CUID整数是由32个字符长的SUID的一部分和对象细节(如它的名字)的一部分使用一种特殊的算法制成的。</strong></p><p id="f9c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为同一个对象生成两个标识符的想法是不要向客户端透露实际敏感对象的标识符，这样就不会在应用程序的意外部分进行直接访问。</p><p id="062b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于对象属性往往会改变(例如，像它们的名字一样)，CUID每隔一段时间就会被替换，逻辑的“核心”是仔细地将CUID与SUID匹配起来。</p><p id="62dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在用户权限中，还有一个节点列表，其中包含用户有权访问的对象的SUID。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="ee38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当用户从客户端发出请求时，算法会尝试从提供的CUID中生成部分SUID。如果成功，它会尝试将该部分与用户权限集合中的一个SUIDs列表进行匹配。如果它们匹配，发出请求的用户将获得对该对象的<strong class="jp ir">一次有限的</strong>访问。这种一次性访问为一个静态IP启用了x分钟，直到下一个将CUID与SUID匹配的过程。</p><p id="c89e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，所有这些过程都是由一个机制来管理的——目标。<br/>AIM以队列形式处理请求，因此当处理多个并行请求时，AIM可能不是完美的解决方案(由于对象可能会被两个不同的用户同时更改)。</p><h2 id="872b" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">结论</h2><p id="f7dd" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">为了让你的平台免受入侵，访问敏感对象的请求应该只由一种机制来管理。</p><p id="3d4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您不必像我一样实现精确的逻辑，并为同一个对象编译两个不同的标识符，但是您应该<strong class="jp ir">明确地只在一个地方管理私有对象的请求和权限。</strong></p><p id="894e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是FogMarks在一些非常受欢迎的公司中发现的IDORs的更多示例(当然，已经打了补丁):</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="mm mn l"/></div></figure><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="7929" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下次见！</p></div></div>    
</body>
</html>