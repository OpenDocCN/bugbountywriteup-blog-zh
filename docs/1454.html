<html>
<head>
<title>Leveraging Burp Suite extension for finding HTTP Request Smuggling.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Burp套件扩展查找HTTP请求走私。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/leveraging-burp-suite-extension-for-finding-http-request-smuggling-2c0b5321f06d?source=collection_archive---------0-----------------------#2021-07-07">https://infosecwriteups.com/leveraging-burp-suite-extension-for-finding-http-request-smuggling-2c0b5321f06d?source=collection_archive---------0-----------------------#2021-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ee55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">HTTP请求走私经常被遗留在bug bounty发现中。但是通过正确的扩展，您可以在下一个bug bounty程序中自动执行查找HTTP请求走私的任务。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/f44a08041d8c6c3e73d77cf9c31b6178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/0*9hpXnKQIrr7Ctwe2.png"/></div></figure><h1 id="c7d5" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">了解HTTP请求走私</h1><p id="cfa5" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">现代网站通常部署多个代理服务器，将用户请求转发到托管web应用程序的实际服务器。这些前端或代理服务器和实际的后端服务器是云应用程序中最常见的架构。</p><p id="04b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">前端服务器从多个用户那里获得请求，并将它们转发给后端服务器。这两个服务器必须就两个不同用户请求之间的边界达成一致。有时，这些服务器在边界上不一致，攻击者可以通过修改HTTP请求来利用这一点，从而导致HTTP请求走私。</p><blockquote class="lz"><p id="b77b" class="ma mb it bd mc md me mf mg mh mi kn dk translated">当前端和后端服务器对用户请求之间的边界不一致时，HTTP请求走私就产生了。</p></blockquote><p id="1bc5" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">边界(即HTTP请求的结尾)由“内容长度”或“传输编码”HTTP头定义。有些服务器不支持“传输编码”,有些服务器将“内容长度”头作为默认头，如果两者都出现在请求中的话。如果应用程序的前端和后端服务器配置不正确，它们将采用不同的边界值，从而导致请求走私漏洞。</p><pre class="kp kq kr ks gt mo mp mq mr aw ms bi"><span id="c212" class="mt kx it mp b gy mu mv l mw mx">HTTP/1.1 200 OK<br/>Content-Type: text/plain<br/>Transfer-Encoding: chunked<br/>Content-Length: 4</span></pre><blockquote class="my mz na"><p id="468c" class="jq jr nb js b jt ju jv jw jx jy jz ka nc kc kd ke nd kg kh ki ne kk kl km kn im bi translated">两个标题都存在的示例请求。</p></blockquote><p id="a811" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">攻击者可以在HTTP请求中包含两个具有不同边界值的报头。如果前端服务器接受“传输编码”,而后端服务器接受“内容长度”报头，这将导致请求处理中的污染，因为每个报头中的边界值是不同的。反之亦然，前端服务器接受“内容长度”，后端服务器接受“传输编码”。前者叫TE。而后者是CL。TE HTTP请求走私漏洞。</p><p id="389e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">前端和后端服务器的这种不明确的处理导致了HTTP请求走私。这可能会导致获取未经授权的数据、危害应用程序等。</p><p id="fccf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我可以更多地谈论这个漏洞，但这不是这篇文章的目的。</p><h1 id="07fd" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">手动查找HTTP请求走私</h1><p id="f298" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">在使用burp扩展自动执行任务之前，让我们看看如何手动检测它，以便您可以更多地了解这个漏洞。</p><p id="c0d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您只需发送一个修改过的HTTP请求，其中包含内容长度和传输编码头。服务器将花费比平常更多的时间来请求这个被污染的请求。如果有时间延迟，那么您就有了一个HTTP请求走私漏洞。</p><p id="9e0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">示例请求:</strong></p><pre class="kp kq kr ks gt mo mp mq mr aw ms bi"><span id="07e6" class="mt kx it mp b gy mu mv l mw mx">POST / HTTP/1.1</span><span id="b977" class="mt kx it mp b gy nf mv l mw mx">Host: vulnerable-website.com</span><span id="6a77" class="mt kx it mp b gy nf mv l mw mx">Transfer-Encoding: chunked</span><span id="7c7c" class="mt kx it mp b gy nf mv l mw mx">Content-Length: 4</span><span id="b8ab" class="mt kx it mp b gy nf mv l mw mx">0</span><span id="1d3c" class="mt kx it mp b gy nf mv l mw mx">Y</span></pre><p id="6962" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果前端服务器只接受Transfer-Encoding头，那么它将忽略' 0 '之后的所有内容，并将上述不带' Y '的请求发送到后端服务器。</p><p id="9208" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果后端服务器只使用Content-Length头，那么它将只把请求的长度作为4。但是请求的实际长度小于4，因为前端服务器忽略了一些数据。因此后端服务器将等待一段时间来接收剩余的数据。这将造成时间延迟，从而请求走私漏洞的检测。</p><p id="c1cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以修改相同的请求，使用内容长度查找前端服务器的漏洞，使用传输编码头查找后端服务器的漏洞。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/9cf0cc069aa6163f9edc129781f1282e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_murZHklTw6b2DxQbM0jOQ.png"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">HTTP请求走私者，一个Burp套件扩展</figcaption></figure><h1 id="48bb" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用Burp套件扩展查找HTTP请求走私漏洞</h1><h2 id="9756" class="mt kx it bd ky np nq dn lc nr ns dp lg kb nt nu lk kf nv nw lo kj nx ny ls nz bi translated">HTTP请求走私者</h2><p id="fcfc" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">HTTP Request Smuggler是一个burp扩展，它可以帮助您自动执行上述查找此漏洞的手动任务。手动查找这个漏洞是可能的，但是非常繁琐，所以您可以利用burp中的这个现有扩展来查找它。</p><p id="cae9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装扩展后，您可以立即开始使用它。右键单击Burp代理上拦截的请求，然后单击HTTP Request smugger-&gt;走私探测器。然后，它会自动修改拦截的请求，并发送它来找到漏洞。它发送许多修改后的请求来检查这两种类型的漏洞— CL。TE &amp; TE.CL .如果有任何与此相关的发现，您可以在“扫描问题活动”页面上找到它们。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/a2edcb274d2ad133f10b2c1a7a51c53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sY57BjdF1d91rwhNXEXogw.png"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">使用扩展名启动走私调查</figcaption></figure><h2 id="3470" class="mt kx it bd ky np nq dn lc nr ns dp lg kb nt nu lk kf nv nw lo kj nx ny ls nz bi translated">默认打嗝套件主动扫描</h2><p id="27ef" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">如果您主动扫描一个目标，Burp套件将实际查找HTTP请求走私。您可以在Burp套件的主动扫描配置中检查这一点。完成主动扫描后，它还会在“问题活动”页面上报告发现的问题。如果你遇到这个问题，请不要离开它。对其进行处理，并通过HTTP Request Smuggler扩展确认该漏洞。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/be4d41d8527ce58f471748ac6fad290c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UyqwCg7M657FoxdWdSILLg.png"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">Burp主动扫描配置中的HTTP请求走私</figcaption></figure><h1 id="a548" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h1><p id="29c3" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">HTTP请求走私是一个经常被忽视的严重漏洞。实际上，我在一个使用主动扫描和请求走私者扩展的真实系统上发现了一个bug。希望这篇文章能让你了解这个漏洞以及如何检测它。如果你想了解更多关于这个漏洞的信息，你可以看看Port Swigger网站，里面有关于它的详细解释。</p><p id="250d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是“<a class="ae oa" rel="noopener ugc nofollow" target="_blank" href="/leveraging-burp-suite-extension-for-finding-idor-insecure-direct-object-reference-2653f9b89fd4">利用Burp Suite扩展查找IDOR </a>帖子的延续。如果你想要更多这样的，就跟我来。</p><p id="d02a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="nb">亲提示:</em> </strong> <em class="nb">一个帖子你最多可以鼓掌50次，以示你有多喜欢。</em></p></div></div>    
</body>
</html>