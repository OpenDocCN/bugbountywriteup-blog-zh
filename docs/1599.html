<html>
<head>
<title>JWT Misconfiguration leading to Account Takeover.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JWT错误配置导致帐户被接管。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/account-takeover-by-tampering-the-signup-verification-token-9abadc5e4dbf?source=collection_archive---------0-----------------------#2021-09-29">https://infosecwriteups.com/account-takeover-by-tampering-the-signup-verification-token-9abadc5e4dbf?source=collection_archive---------0-----------------------#2021-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7429" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，</p><p id="362f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是来自卡纳塔克邦贝尔高姆的法伊克·贾拉里。</p><p id="b6d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只是想分享我发现的一个奇怪的bug。</p><p id="ae67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以让我们开始吧。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/365bc52c9380cb08f9a95f74eb6bbe69.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/format:webp/1*EGZr5-dStpBaqfANDB9FcA.jpeg"/></div></figure><p id="850c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我不被允许透露公司名称，让我们把它当作“xyz.com”。</p><p id="d86a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以首先我注册了一个账户。之后，我得到了一个链接来验证我的电子邮件。</p><p id="902a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种联系就像https://app.xyz.com/authentication/verify-account?token = eyjhbgcioijiuzi 1 NII SINR 5 CCI 6 ikpxvcj 9……。</p><p id="ea6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我验证了我的帐户，并开始测试web应用程序。</p><p id="8a5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我喜欢玩密码重置功能，所以我开始测试密码重置端点。</p><p id="9150" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试了许多可能的方法来寻找密码重置链接中的错误，但我失败了。</p><p id="734c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我比较了验证帐户链接和密码重置链接。</p><p id="4a73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们都有JWT代币。</p><p id="d74e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">验证帐户链接:https://app.xyz.com/authentication/verify-account?token = eyjhbgcioijiuzi 1 NII SINR 5 CCI 6 ikpxvcj 9……。</p><p id="0a7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">密码重置链接:https://app.xyz.com/authentication/password-reset?token = eyjhbgcioijiuzi 1 NII SINR 5 CCI 6 ikpxvcj 9……。</p><p id="05a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这让我想到…</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/a77516ead5b1c6ffa5c7d7813a4c2944.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*FW-zpBE07-kCCkm2i_7Mvw.gif"/></div></figure><p id="de6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我通过使用<a class="ae ku" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">https://jwt.io/</a>解码来检查这两个JWT令牌</p><p id="18b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这两个令牌具有相同的有效负载，如下所示</p><p id="f25f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">{ <br/> "_id": "123abc456 "、<br/> "email": "abcd@gmail.com "、<br/> "type": "resetPassword "、<br/> "iat": 1632927658、<br/> "exp": 1633014058 <br/> }</p><p id="2be2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">" type":"verifyaccount "用于验证帐户，并且</p><p id="6c04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">" type": "resetPassword "，用于重置密码。</p><p id="28ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是两个令牌之间唯一的区别。</p><p id="0003" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我拿了注册时收到的验证令牌。</p><p id="5a7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将令牌中的“type”更改为“resetPassword ”,保持所有其他字段不变，并使用令牌重置密码。</p><p id="a150" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我通过篡改令牌成功地重置了密码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/cdb0f4f1890370af529ea00b3debe35b.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*xST-8zyiEdjlKdkkOZlklw.gif"/></div></figure><p id="19ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个错误的影响很小，因为我可以使用验证链接重置我自己帐户的密码。</p><p id="3646" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在想如何扩大影响…</p><p id="6765" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我再次检查了令牌，发现令牌中也有“_id”参数。</p><p id="c59a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我开始搜索webapp是否泄露了“user_id”</p><p id="c1b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在web应用程序中，有一个创建团队并邀请其他用户加入团队的选项。</p><p id="7a69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我去了https://app.xyz.com/invite并邀请了其他用户。</p><p id="2686" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在邀请用户的时候通过打嗝拦截了这个请求。</p><p id="08a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我很幸运，响应中有“user_id”。</p><p id="fbda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以很快我又篡改了令牌，编辑了“_id”参数。</p><p id="2741" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我可以用上述方法接管任何账户。</p><p id="3e77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过使用工具<a class="ae ku" href="https://github.com/lc/gau" rel="noopener ugc nofollow" target="_blank"> GAU </a>我也能够找到一些泄露的账户验证链接。</p><p id="4d01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过命令“gau app.xyz.com”</p><p id="2d87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种病毒在几个小时内就被排除了。</p><p id="b3b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也在一天内解决了。</p><p id="9038" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢你的阅读。</p><p id="90d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">喜欢就分享吧。</p></div></div>    
</body>
</html>