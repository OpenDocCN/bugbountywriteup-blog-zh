<html>
<head>
<title>DNS Cache that almost ruined my PoC for a private bug bounty program, and a few tips on avoiding the same</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">几乎毁了我的私人bug赏金程序概念验证的DNS缓存，以及避免同样情况的一些技巧</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/dns-cache-that-almost-ruined-my-poc-for-a-private-bug-bounty-program-and-a-few-tips-on-avoiding-dbc07f1d813b?source=collection_archive---------2-----------------------#2020-07-03">https://infosecwriteups.com/dns-cache-that-almost-ruined-my-poc-for-a-private-bug-bounty-program-and-a-few-tips-on-avoiding-dbc07f1d813b?source=collection_archive---------2-----------------------#2020-07-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="0a67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为一个bug赏金猎人，甚至作为一个想要节省时间的人类，你总是想要一种方法来简化某些任务，然后将那些简单且通常繁琐的活动自动化。这主要是出于把节省下来的时间花在可能从技术上来说是浪费时间的其他事情上的愿望(例如，视频游戏、狂看电影和电视剧等)。)，但那都是做人的一部分嗯？</p><p id="aa80" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当你自动化任何事情时会发生什么？最初，它以一场灾难告终，除非你设法考虑到每一种可能的情况。作为一个bug赏金猎人，自动化往往是一个复杂的bash脚本或等同物，实际上是一行接一行的简单任务，但是将它们串在一起通常是问题的根源。一旦你运行这个脚本，这个问题就会显现出来，如果它在一个很大的目标列表上…好吧，我希望你有一个大硬盘的VPS。</p><p id="c1bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，迟早，错误会被纠正，脚本会完成它的任务。你需要做的就是坐下来看一些网飞的节目，或者如果你没有通过亚马逊订购，但你有prime会员，你可以花时间挖掘看看有什么是免费观看的。最后，你检查结果。如果脚本是为一些RCE或SSRF测试的，你真的希望你的burp合作者或任何你监视pingbacks的地方向你显示aws拥有的IP或任何不是google cache或类似的IP。</p><p id="ec12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后就发生了。根据经验，来自IP的pingback必须来自aws。您执行通常的主机x.x.x.x，在这里，您已经验证了IP地址来自aws。您可能会因为这一点而激动得发抖，因为下一步是验证，最后是概念验证。</p><p id="3203" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个真实的例子中，pingback是通过上传文件中的XXE实现的。验证是通过获取具有XXE有效负载的文件并用我的VPS IP地址和当时不存在的xxe.xml文件编辑它来完成的，以便验证日志中的GET /xxe.xml。在日志中是404，但它做到了。现在，是时候编写PoC了。但是，当我开始挖掘XXE有效载荷时，我有一些时间来思考，处理正在发生的事情，以及可能发生的事情。然后，一个合理的担心是:如果其他人也收到了，并且提交了这个bug，那该怎么办？当然，我提交最初的发现是为了争取一些时间，确保不会浪费在概念验证上，因为我可能已经太晚了。</p><p id="5a21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一段时间后。我收到了这封电子邮件，兴奋之情溢于言表，因为它要么成功，要么失败。他们要求我提供一个概念验证，一个真正的概念验证，展示从他们的aws读取数据的能力。我准备好了。我有我的VPS，我有一个XML文件，我之前用来测试pingback，它在nano中是开放的，我正在输入XXE有效载荷，它将证明影响。一切都结束了。我准备好了包含XXE有效负载第1部分的文件，我仔细检查了我输入的VPS IP地址是否正确，以及xxe.xml是xxe.xml而不是xxe.dtd，反之亦然(你们中的一些人可能知道我在说什么)。一切都很好。然后，我上传文件，并在apache日志中检查在特定aws文件中找到的字符串的GET请求。没什么。15分钟了还是一无所获。我检查了之前的测试，当时我还没有准备好xxe.xml，我算了一下，结果是:当时大概花了5分钟。发生了什么事？这是一个P1错误，这是我的第一个XXE类型，我搞砸了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/01587a704e164052ba226cfc873d4371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EmHhxFvtgD_23xQoxpD3oA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">我做了很多测试:)私人程序因此被大量编辑</figcaption></figure><p id="98d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在思考了一会儿并试图排除它的原因后，我记得有一种东西叫做DNS缓存。但是，如果它不仅仅适用于DNS解析呢？我觉得值得一试，所以我把xxe.xml重命名为xxe1.xml，我试了一下，它成功了。我又试了一次，还是不行，所以我把它重命名为xxe1.xml，它又可以工作了。给你，伙计们。你会学到一些新的日常事物。</p><p id="ff0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">温馨提示:</strong></p><p id="4827" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="le">注意你的有效载荷不要都是同一个子域(即randomstring . burpcollaborator . net)，而是在使用脚本等的时候尝试n+1 . randomstring . burpcollaborator . net。</em></p><p id="72c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="le">根据目标，您可能还需要更改基本域。这一点可能会很棘手，除非你使用http://freenom.com的</em><a class="ae lf" href="http://freenom.com" rel="noopener ugc nofollow" target="_blank"><em class="le"/></a><em class="le">免费注册域名，然后把它们连接到你的VPS。</em></p><p id="8453" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="le">另一个有趣的提示也取决于目标:如果你发送http://有些地方不会执行任何pingback，在这种情况下，在你的VPS上配置自签名SSL是一个好主意，额外的burp collaborator也支持https。</em></p><p id="d0f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于freenom和VPS combo，以后可能会多写一些。</p></div></div>    
</body>
</html>