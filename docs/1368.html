<html>
<head>
<title>All about unrestricted file upload</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">所有关于无限制文件上传</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/all-about-unrestricted-file-upload-a4ecf243b86b?source=collection_archive---------1-----------------------#2021-06-07">https://infosecwriteups.com/all-about-unrestricted-file-upload-a4ecf243b86b?source=collection_archive---------1-----------------------#2021-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bf36dce288d1f0f0dde5418302ddaa52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYcSSdStlrlSfqZTPotwtw.png"/></div></div></figure><p id="b113" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你好黑客们，</p><p id="86c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望你们做得很好，并狩猎大量的昆虫和美元！</p><p id="6007" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我总是喜欢在任何网络应用程序的文件上传功能上寻找漏洞。文件上传中的漏洞通常会给你带来严重程度很高的错误，而且当时也不太安全。那么，今天我们来谈谈网络中一个非常容易被利用的部分，那就是文件上传功能。</p><p id="6975" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在渗透测试中，我们看到了许多文件上传功能，这些功能允许用户将文件从用户的计算机传输到服务器。因为它直接与服务器通信，所以我们必须管理好那里的安全卫生。</p><blockquote class="kw kx ky"><p id="f68e" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><strong class="ka ir">出于安全原因，我们在web应用程序上实现了两种类型的清理:- </strong></p></blockquote><p id="2b4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">客户端验证</strong> —当web应用程序使用客户端验证时，用户的所有输入都在用户的浏览器中进行验证。它不需要往返服务器。这种验证是在浏览器端使用JavaScript或HTML5 attribute等脚本语言完成的。</p><p id="916d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">服务器端验证</strong> —用户提交的输入被发送到服务器，并使用一种服务器端脚本语言(如Asp.net、PHP等)进行验证，这也是防范恶意用户的最佳实践。</p><p id="0d5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但这并不意味着web应用程序在文件上传功能上是完全安全的，有一些方法可以绕过它。所以让我们开始学习如何在这个函数中寻找bug。</p><p id="3f24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">客户端过滤器旁路— </strong>正如我已经提到的，客户端验证是在浏览器上使用脚本语言(如java script)完成的。所以这个java脚本只在你的请求被发送到服务器之前处理它，并验证我们上传的文件类型。如果文件看起来无效，那么它会返回一条错误消息。但主要担心的是，这种安全性过于依赖浏览器，可以通过代理工具(Burp suite，OWASP zap)操纵浏览器，并篡改它以更改上传文件的内容和文件名。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ld"><img src="../Images/0c207e863c0037de9edc659972e8a6a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODUdhrUFVTX_ORl7cYJ9Tg.png"/></div></div></figure><p id="ea4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">绕过文件扩展名检查:- </strong></p><p id="a7ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当服务器通过比较文件扩展名来验证上传的文件时，这种验证基于两种方式进行:将文件扩展名列入黑名单和列入白名单。</p><ol class=""><li id="4979" class="li lj iq ka b kb kc kf kg kj lk kn ll kr lm kv ln lo lp lq bi translated"><strong class="ka ir">尝试在末尾添加特殊字符</strong></li></ol><p id="8d0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">file . PHP % 20<br/>file . PHP % 0a<br/>file . PHP % 00<br/>file . PHP % 0d % 0a<br/>file.php/<br/>file . PHP . \<br/>file。<br/> file.php…<br/> file.pHp5…</p><p id="7838" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2。尝试通过双分机绕过</strong></p><p id="4b04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">file.png.php<br/>file . png . PHP 5</p><p id="3acc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3。尝试通过空字节或添加垃圾数据来绕过</strong></p><p id="94ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">shell . PHP % 00 . JPEG</p><p id="5191" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">shell . PHP % 0 delete 0 . jpg<br/>file . PHP junk 123 png</p><p id="4331" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 4。尝试通过在执行扩展</strong>前添加有效扩展来绕过</p><p id="473b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">file.png.php<br/>file . png . PHP 5</p><p id="13b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 5。尝试通过使用大写和小写字母来绕过</strong></p><p id="1ab1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">file.jPg</p><p id="6a05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">文件。挽救（saving的简写）</p><p id="3305" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">file.asP</p><blockquote class="kw kx ky"><p id="c0a9" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><strong class="ka ir">内容类型验证— </strong>服务器通过检查文件的MIME类型来验证文件的内容，这可以在HTTP请求体中显示。</p></blockquote><ol class=""><li id="3c55" class="li lj iq ka b kb kc kf kg kj lk kn ll kr lm kv ln lo lp lq bi translated"><strong class="ka ir">通过更改内容类型头的值绕过内容类型验证</strong></li></ol><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/edd68c994ef4b21093f711daa0d0fbd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4NEOnSQzN87VKPMtpVMxTA.png"/></div></div></figure><div class="ls lt gp gr lu lv"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">常见MIME类型- HTTP | MDN</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">这里是一个MIME类型的列表，按照文档类型关联，按照它们的通用扩展名排序。两个主要的哑剧…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">developer.mozilla.org</p></div></div><div class="me l"><div class="mf l mg mh mi me mj jw lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://hackerone.com/reports/304098" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">在HackerOne上公开的open-exchange:[XSS/CSRF]过滤器内容类型...</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">你好。我发现了为文件注入任何内容类型技巧。如果内容类型包含`，那么浏览器(Chrome，Firefox)…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">hackerone.com</p></div></div><div class="me l"><div class="mk l mg mh mi me mj jw lv"/></div></div></a></div><blockquote class="kw kx ky"><p id="db72" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><strong class="ka ir">内容长度验证— </strong>服务器检查上传文件内容的长度&amp;限制文件大小不能超过。</p></blockquote><ol class=""><li id="6510" class="li lj iq ka b kb kc kf kg kj lk kn ll kr lm kv ln lo lp lq bi translated"><strong class="ka ir">通过改变内容长度头的值绕过内容类型验证</strong></li></ol><div class="ls lt gp gr lu lv"><a href="https://hackerone.com/reports/203388" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">HackerOne上披露的Gratipay:内容长度限制绕过...</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">你好团队，##简介既然你在规则中提到你的github库上列出的所有库都是…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">hackerone.com</p></div></div><div class="me l"><div class="ml l mg mh mi me mj jw lv"/></div></div></a></div><blockquote class="kw kx ky"><p id="55a9" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><strong class="ka ir">上传文件可实现的10大目标:- </strong></p></blockquote><ul class=""><li id="8e46" class="li lj iq ka b kb kc kf kg kj lk kn ll kr lm kv mm lo lp lq bi translated">SVG:存储的XSS / SSRF / XXE</li><li id="b7e9" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">HTML / JS : HTML注入/ XSS /打开重定向</li><li id="aa10" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">ASP/ASPX/PHP 5/PHP/PHP 3:Webshell/RCE</li><li id="9cf9" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">GIF:存储的XSS / SSRF</li><li id="0da2" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">CSV: CSV注射</li><li id="109d" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">PNG / JPEG:像素洪水攻击(DoS)</li><li id="31ba" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">邮编:RCE途经LFI /多斯</li><li id="6037" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">PDF / PPTX: SSRF /盲人XXE</li><li id="4ab4" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">XML: XXE</li><li id="2422" class="li lj iq ka b kb mn kf mo kj mp kn mq kr mr kv mm lo lp lq bi translated">AVI: LFI / SSRF</li></ul><p id="0949" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参考资料:-</p><div class="ls lt gp gr lu lv"><a href="https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">无限制文件上传</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">上传的文件给应用程序带来了巨大的风险。许多攻击的第一步是获取一些代码到…</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">owasp.org</p></div></div><div class="me l"><div class="ms l mg mh mi me mj jw lv"/></div></div></a></div><p id="314b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望这对你们有用</p><p id="aeb1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">黑客快乐！</p><p id="cc89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">推特账号:-<a class="ae mt" href="https://twitter.com/Xch_eater" rel="noopener ugc nofollow" target="_blank">https://twitter.com/Xch_eater</a></p></div></div>    
</body>
</html>