<html>
<head>
<title>Pentest Notes: Google Cloud Edition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pentest笔记:谷歌云版</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/pentest-notes-google-cloud-edition-2e138bb0f504?source=collection_archive---------4-----------------------#2021-09-16">https://infosecwriteups.com/pentest-notes-google-cloud-edition-2e138bb0f504?source=collection_archive---------4-----------------------#2021-09-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="39a9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">黑掉谷歌所需的一切</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/930e2c288faa9b15fa820fab12a199da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Arpkk0gKCiSDle1v"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">unsplash.com</figcaption></figure><h2 id="a142" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">证明</h2><p id="ea60" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">使用gcloud认证</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="751f" class="kv kw iq ml b gy mp mq l mr ms">#user identity login<br/>gcloud auth login</span><span id="abeb" class="kv kw iq ml b gy mt mq l mr ms">#service account login<br/>gcloud auth activate-service-account --key-file creds.json</span></pre><p id="9884" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">列出gcloud可用的帐户</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="0ec2" class="kv kw iq ml b gy mp mq l mr ms">gcloud auth list</span></pre><h2 id="eff6" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">账户信息</h2><p id="6c5f" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">获取帐户信息</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="0438" class="kv kw iq ml b gy mp mq l mr ms">gcloud config list</span></pre><p id="a2cb" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">列出组织</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="cf1e" class="kv kw iq ml b gy mp mq l mr ms">gcloud organizations list</span></pre><p id="9e4f" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">枚举组织范围内的IAM策略集</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="4038" class="kv kw iq ml b gy mp mq l mr ms">gcloud organizations get-iam-policy &lt;org ID&gt;</span></pre><p id="d41b" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">枚举每个项目设置的IAM策略</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="ce4f" class="kv kw iq ml b gy mp mq l mr ms">gcloud projects get-iam-policy &lt;project ID&gt;</span></pre><p id="21e9" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">列出项目</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="5c5a" class="kv kw iq ml b gy mp mq l mr ms">gcloud projects list</span></pre><p id="8930" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">设置不同的项目</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="1bf7" class="kv kw iq ml b gy mp mq l mr ms">gcloud config set project &lt;project name&gt;</span></pre><p id="695c" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">给出project中启用的所有API的列表</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="999a" class="kv kw iq ml b gy mp mq l mr ms">gcloud services list</span></pre><p id="e44c" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">获取可供用户使用的源代码仓库</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="4390" class="kv kw iq ml b gy mp mq l mr ms">gcloud source repos list</span></pre><p id="552c" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">克隆存储到主目录</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="ed63" class="kv kw iq ml b gy mp mq l mr ms">gcloud source repos clone &lt;repo_name&gt;</span></pre><h2 id="05dd" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">虚拟机</h2><p id="5506" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">列出计算实例</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="01fe" class="kv kw iq ml b gy mp mq l mr ms">gcloud compute instances list</span></pre><p id="aefe" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">获取对实例的外壳访问</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="127e" class="kv kw iq ml b gy mp mq l mr ms">gcloud beta compute ssh --zone "&lt;region&gt;" "&lt;instance name&gt;" --project "&lt;project name&gt;"</span></pre><p id="01bc" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">将公共ssh密钥放在项目的元数据服务上</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="477d" class="kv kw iq ml b gy mp mq l mr ms">gcloud compute ssh &lt;local host&gt;</span></pre><p id="0297" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">如果在实例上，则获取访问范围</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="c9d1" class="kv kw iq ml b gy mp mq l mr ms">curl <a class="ae mz" href="http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/scopes" rel="noopener ugc nofollow" target="_blank">http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/scopes</a> -H &amp;#39;Metadata-Flavor:Google’</span></pre><p id="9982" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">使用谷歌密匙环解密加密数据</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="8256" class="kv kw iq ml b gy mp mq l mr ms">gcloud kms decrypt --ciphertext-file=encrypted-file.enc --plaintext-file=out.txt --key &lt;crypto-key&gt; --keyring &lt;crypto-keyring&gt; --location global</span></pre><h2 id="194b" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">存储桶</h2><p id="6e40" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">列出谷歌存储桶</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="3086" class="kv kw iq ml b gy mp mq l mr ms">gsutil ls</span></pre><p id="9eaf" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">递归列出谷歌存储桶</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="3d46" class="kv kw iq ml b gy mp mq l mr ms">gsutil ls -r gs://&lt;bucket name&gt;</span></pre><p id="3ab3" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">从存储桶复制项目</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="b919" class="kv kw iq ml b gy mp mq l mr ms">gsutil cp gs://bucketid/item ~/</span></pre><h2 id="f2d2" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">web应用程序和SQL</h2><p id="f931" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">列出web应用程序</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="4e20" class="kv kw iq ml b gy mp mq l mr ms">gcloud app instances list</span></pre><p id="2a39" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">列出SQL实例</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="fe86" class="kv kw iq ml b gy mp mq l mr ms">gcloud sql instances list<br/>gcloud spanner instances list<br/>gcloud bigtable instances list</span></pre><p id="d3c1" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">列出SQL数据库</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="0dda" class="kv kw iq ml b gy mp mq l mr ms">gcloud sql databases list --instance &lt;instance ID&gt;<br/>gcloud spanner databases list --instance &lt;instance name&gt;</span></pre><p id="3fe2" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">导出SQL数据库和存储桶</p><p id="efeb" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">首先将存储桶复制到本地目录</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="933d" class="kv kw iq ml b gy mp mq l mr ms">gsutil cp gs://bucket-name/folder/ .</span></pre><p id="5a3c" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">创建新的存储桶，更改perms，导出SQL DB</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="f62d" class="kv kw iq ml b gy mp mq l mr ms">gsutil mb gs://&lt;googlestoragename&gt;<br/>gsutil acl ch -u &lt;service account&gt; gs://&lt;googlestoragename&gt;<br/>gcloud sql export sql &lt;sql instance name&gt; gs://&lt;googlestoragename&gt;/sqldump.gz --database=&lt;database name&gt;</span></pre><h2 id="e35e" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">建立工作关系网</h2><p id="9568" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">列出网络</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="8063" class="kv kw iq ml b gy mp mq l mr ms">gcloud compute networks list</span></pre><p id="a295" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">列出子网</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="c06e" class="kv kw iq ml b gy mp mq l mr ms">gcloud compute networks subnets list</span></pre><p id="7bf2" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">列出VPN隧道</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="c7c1" class="kv kw iq ml b gy mp mq l mr ms">gcloud compute vpn-tunnels list</span></pre><p id="75d6" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">列出互连(VPN)</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="c049" class="kv kw iq ml b gy mp mq l mr ms">gcloud compute interconnects list</span></pre><h2 id="888c" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">容器</h2><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="0b1e" class="kv kw iq ml b gy mp mq l mr ms">gcloud container clusters list</span></pre><p id="4446" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">GCP Kubernetes配置文件~/。kube/config在您通过gcloud认证后生成，并运行:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="e826" class="kv kw iq ml b gy mp mq l mr ms">gcloud container clusters get-credentials &lt;cluster name&gt; --region &lt;region&gt;</span></pre><p id="9ac2" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">如果成功并且用户拥有正确的权限，可以使用下面的Kubernetes命令来获取集群信息:</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="d5ce" class="kv kw iq ml b gy mp mq l mr ms">kubectl cluster-info</span></pre><h2 id="5cdc" class="kv kw iq bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">无服务器</h2><p id="cc0a" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">GCP函数日志分析—可以从与GCP函数相关的日志中获得有用的信息</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="102b" class="kv kw iq ml b gy mp mq l mr ms">gcloud functions list<br/>gcloud functions describe &lt;function name&gt;<br/>gcloud functions logs read &lt;function name&gt; --limit &lt;number of lines&gt;</span></pre><p id="105a" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">GCP云运行分析—可以从描述中获得有用的信息，如环境变量。</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="9712" class="kv kw iq ml b gy mp mq l mr ms">gcloud run services list<br/>gcloud run services describe &lt;service-name&gt;<br/>gcloud run revisions describe --region=&lt;region&gt; &lt;revision-name&gt;</span></pre><p id="4a03" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">Gcloud将凭证储存在~/中。config/gcloud/credentials.db搜索主目录</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="7b0f" class="kv kw iq ml b gy mp mq l mr ms">sudo find /home -name "credentials.db</span></pre><p id="6ec3" class="pw-post-body-paragraph lr ls iq lt b lu mu jr lw lx mv ju lz le mw mb mc li mx me mf lm my mh mi mj ij bi translated">将gcloud目录复制到您自己的主目录，以被入侵用户的身份进行身份验证</p><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="190b" class="kv kw iq ml b gy mp mq l mr ms">sudo cp -r /home/username/.config/gcloud ~/.config<br/>sudo chown -R currentuser:currentuser ~/.config/gcloud<br/>gcloud auth list</span></pre><h1 id="afdd" class="na kw iq bd kx nb nc nd la ne nf ng ld jw nh jx lh jz ni ka ll kc nj kd lp nk bi translated">元数据服务URL</h1><pre class="kg kh ki kj gt mk ml mm mn aw mo bi"><span id="00a7" class="kv kw iq ml b gy mp mq l mr ms">curl "http://metadata.google.internal/computeMetadata/v1/?recursive=true&amp;alt=text" -H "Metadata-Flavor: Google"</span></pre></div></div>    
</body>
</html>