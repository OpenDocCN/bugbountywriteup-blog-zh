<html>
<head>
<title>Curling write-up HackTheBox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">卷曲书写工具盒</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/curling-write-up-hackthebox-5fa9491b6239?source=collection_archive---------0-----------------------#2019-03-30">https://infosecwriteups.com/curling-write-up-hackthebox-5fa9491b6239?source=collection_archive---------0-----------------------#2019-03-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5c5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于Hack The Box平台上最近退役的卷发器的文章。如果你还不知道，Hack The Box是一个网站，你可以通过侵入一系列不同的机器来进一步提高你的网络安全知识。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/9022a1e861be0fd31b79fcbbd0eee34b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*dHDYHCK0RrYK1laKN-a8xw.png"/></div></figure><p id="2cda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Curling的名字可能是由创建者给出的，因为它使用curl对本地文件发出GET请求。Curling是一个使用Joomla的博客网站，Joomla是一个免费的开源内容管理系统(CMS)。这个盒子非常有趣和简单，不需要很多枚举，也不太像CTF。我们从</p><p id="a240" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kt"> nmap -sC -sV 10.10.10.150 </em></p><pre class="km kn ko kp gt ku kv kw kx aw ky bi"><span id="b07b" class="kz la iq kv b gy lb lc l ld le">Nmap scan report for 10.10.10.150<br/>Host is up (0.20s latency).<br/>Not shown: 998 closed ports<br/>PORT   STATE SERVICE VERSION<br/>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 8a:d1:69:b4:90:20:3e:a7:b6:54:01:eb:68:30:3a:ca (RSA)<br/>|   256 9f:0b:c2:b2:0b:ad:8f:a1:4e:0b:f6:33:79:ef:fb:43 (ECDSA)<br/>|_  256 c1:2a:35:44:30:0c:5b:56:6a:3f:a5:cc:64:66:d9:a9 (ED25519)<br/>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br/>|_http-generator: Joomla! - Open Source Content Management<br/>|_http-server-header: Apache/2.4.29 (Ubuntu)<br/>|_http-title: Home<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></pre><p id="d83e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">端口80是开放的，在浏览器中查看网站会将我们带到冰壶网站。有3篇博文和一个登录表单。由于我们到目前为止没有任何凭证，我们可以尝试一些通用的用户名和密码组合，这并不能让我们避免走进死胡同，我们枚举目录。</p><p id="2124" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网页看起来像这样，我们可以在2018年冰壶的第一个帖子下面看到一件有趣的事情！博客帖子。我们有一个似乎是用户名的帖子==&gt; <strong class="jp ir"> FLORIS </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lf"><img src="../Images/f72bb65d322e2d204d97e6a5c85a7c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kt3-yoaemJ19csAj5r500A.png"/></div></div></figure><p id="7d7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从我们枚举目录的结果中，我们看到有/administrator页面。</p><p id="032e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在进入那个页面之前，我们看到了10.10.10.150的源页面，希望从中找到一些东西。</p><p id="3e50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">唉！！！我们在这一页的末尾有一个秘密。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lf"><img src="../Images/3b017c90ff74dbb0fc48e8d697ad7621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PyAtJxDJxaQwYmk3Eon8qg.png"/></div></div></figure><p id="9144" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到10.10.10.150/secret.txt，我们看到了一个base64编码的字符串解码，它给出了<strong class="jp ir"> Curling2018！。</strong>现在我们有了一对凭据，可以在/administrator页面上尝试使用。</p><p id="35cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用芙罗莉丝作为用户名和Curling2018！作为密码，我们成功进入管理控制面板。</p><p id="a386" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有很多事情试图让我们的代码执行，并得到一个外壳许多方式导致一个兔子洞。我尝试的第一件事是去/media，并试图通过在Burpsuite中将它重命名为something.php.png来上传一个包含php代码的png，这给出了一个错误"<em class="kt">你试图上传不安全的文件</em>"你可以在Ippsec的爆米花<a class="ae lk" href="https://www.youtube.com/watch?v=NMGsnPSm8iw" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">视频</strong> </a>中检查这个方法。我尝试的下一件事是在Install Extensions下，我安装了一个简单的文件上传扩展，这是我从这个<a class="ae lk" href="https://extensions.joomla.org/extension/simple-file-upload/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"/></a><strong class="jp ir"/>站点找到的，在更改了所有规则后，我尝试上传一个php脚本，让我上传一个php脚本，但又是一个死胡同，一些内部Joomla函数阻止了任何类型的php脚本上传。</p><p id="8acc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后经过一点谷歌和研究，我发现模板可以用php编写，并可以执行。因此，在模板/样式下，我将beez3设为默认，在模板部分，我找到了网站使用的所有php脚本，它们都是可编辑的！！！！</p><p id="31ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我从<a class="ae lk" href="https://github.com/pentestmonkey/php-reverse-shell" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> git-hub </strong> </a>抓取了php-reverse-shell脚本。粘贴在index.php改变了ip参数放在我的ip和我的终端我监听端口1234。我保存了php文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lf"><img src="../Images/58b83339e293bfc025833a1c75bc454a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1yvRw8_hb_lprGX9qr4ymg.png"/></div></div></figure><p id="9311" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我通过访问<a class="ae lk" href="http://10.10.10.150/index.php" rel="noopener ugc nofollow" target="_blank">http://10 . 10 . 10 . 150/index . PHP</a>来执行这个脚本，然后我立刻通过netcat在我的终端上有了一个shell，这仍然是一个基本的反向shell。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lf"><img src="../Images/75a0d4cdb99636c34bd3333be6f6ed7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pv1rzXhhG7boWw82UaAWaw.png"/></div></div></figure><p id="da0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为这不是一个完全成熟的shell，我仍然是www-data，我不能读取user.txt，但是在/home/floris中，我找到了1个目录管理区和2个名为password_backup和user.txt的文件，在这些文件上运行cat给了我这个</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lf"><img src="../Images/442e064dda5e351274acc1fbd39a09a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wBs6ipOaJF_17h8KQ9XWNw.png"/></div></div></figure><p id="20e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将十六进制转储复制到我的机器上，初始字节看起来很相似，它们是bzip2压缩的。所以我想这一定是一个简单的获得密码的解压挑战。我对这个文件做了如下的反复解压:(更多<a class="ae lk" href="https://www.akashtrehan.com/writeups/OverTheWire/Bandit/level12/" rel="noopener ugc nofollow" target="_blank">点击</a>)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ll"><img src="../Images/4bd03fe59e666040872975a904f88448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wp6eU6Ctg1msx91z3Xd1qQ.png"/></div></div></figure><p id="0bc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后我们有了password.txt，它给了我们密码<strong class="jp ir"> 5d &lt; wdCbdZu)|hChXll </strong>使用floris作为用户名，我们可以成功地使用ssh进入机器，并可以获得用户标志。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lm"><img src="../Images/0c93725f16fd981dde01aca5f8908425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Il8daHbtdQPlLW4xLxiF9A.png"/></div></div></figure><p id="a09f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，在根目录下，我们在/home/floris中有一个管理区目录。这个管理区包含2个文件输入和报告，文件内容是:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lf"><img src="../Images/bedd1f118a5dce8e3094969164b4ceee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P8ij1HuuSLpH0G8QqVOM9w.png"/></div></div></figure><p id="c95d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这看起来像是输入是对某个过程的输入，而报告是执行和显示某个过程的结果。为了正确了解这个过程，我在输入url中输入了我的ip和一个端口，并使用netcat监听那个端口。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lf"><img src="../Images/3b7c1b943ed6763c66eaf15ddfba49a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zaCDQkOG5B1TmbN045wkpA.png"/></div></div></figure><p id="b36e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的终端中，我可以看到user-Agent为<strong class="jp ir"> curl/7.58.0 </strong>，所以curl正在执行这个GET请求。我看到curl是用floris特权运行的(ps -elf| grep curl ),在阅读了curl手册页和一些googling搜索之后，我得出结论，curl也可以获得本地文件。我在我的机器上作为根组中的本地用户使用如下命令进行了尝试</p><pre class="km kn ko kp gt ku kv kw kx aw ky bi"><span id="58ce" class="kz la iq kv b gy lb lc l ld le">curl file:///etc/shadow</span></pre><p id="9f32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我甚至可以通过运行curl而不是root来成功地得到结果。所以在我的小实验之后，我将输入文件编辑为<strong class="jp ir"><em class="kt">URL = " file:///root/root . txt "</em></strong>，当我看到报告文件的内容时，我正盯着根标志。扎根！！！！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lf"><img src="../Images/bb5a76831da72fa5268d7a101b58cc7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLUj7l5YW4aoaZq0aqToeA.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">根标志</figcaption></figure><p id="7e77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你找到了一种无需输入或报告文件就能直接获得根shell的方法，请在下面的评论中与我分享。我知道我本来可以把url替换成“file:///etc/shadow”，抢到root密码。如果还有其他方法，请告诉我。</p><p id="aad3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这个内容，请鼓掌…</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="20fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kt">关注</em> <a class="ae lk" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="kt"> Infosec报道</em> </a> <em class="kt">获取更多此类精彩报道。</em></p><div class="ly lz gp gr ma mb"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd ir gy z fp mg fr fs mh fu fw ip bi translated">信息安全报道</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">medium.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp kr mb"/></div></div></a></div></div></div>    
</body>
</html>