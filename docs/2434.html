<html>
<head>
<title>Everything About Path Traversal Vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于路径遍历漏洞的一切</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/everything-about-path-traversal-vulnerability-c40ba5465bc4?source=collection_archive---------1-----------------------#2022-10-09">https://infosecwriteups.com/everything-about-path-traversal-vulnerability-c40ba5465bc4?source=collection_archive---------1-----------------------#2022-10-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/412a84ff234a65a39e8a6f50cff4ba0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*Q3U83Z8FYycogZGRqndnCQ.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">萨法尔·萨法罗夫在<a class="ae kb" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f1df" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">简介</strong></p><p id="540c" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">网站是为不同的目的而建立的。它可以由几个到几百个静态网页组成。静态网页一个这样的例子是“关于我们”页面。你几乎可以在每个网站上找到它。开发者经常直接从目录中包含静态网页，以显示在网页上。这些可以是pdf文件、word文档，甚至是标准的php文件和脚本。这为开发人员提供了一个非常简单的界面，因为一段代码可以用来获取大量的文件，即使有些东西发生了变化，你只需要改变文件名，没有必要更新所有的链接。我们遇到的一个特别的例子是一个包含en.php文件的网站，它的工作是将当前打开的页面中提供的所有文本转换成英语。如果要求他们将所有文件转换成英语和其他语言，这项任务将非常耗时。只需将文件名传递到en.php中，文件就会完全显示在英文翻译中。这将解决大量的时间和工作，每当开发人员未能执行适当的后端检查的文件名或网址是包括或提取的网页上，问题出现。因此，当攻击者试图包含敏感文件时，结果是不可预测的。路径遍历漏洞，也称为本地文件包含，是一种可以被利用的漏洞。</p><p id="c518" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">什么是路径遍历漏洞，为什么会出现？</strong></p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi la"><img src="../Images/2758bf8e0aa4dceda7047a6407c99d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RN6xYpsMNeBng6oaPXyzQg.png"/></div></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://securityboulevard.com/2021/12/what-is-local-file-inclusion-vulnerability/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="6f95" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">您的web服务器上存在一个路径遍历漏洞，使得攻击者能够访问您的web服务器上的文件，而这些文件在默认情况下是他们不能访问的。为此，他们欺骗web服务器或在其上运行的web应用程序返回不包含在web根文件夹中的文件。当没有对从服务器获取文件的参数进行验证时，这种情况最常见。考虑一下我们假设的站点example.com的代码片段</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/d46feecef87cb67f322c4a6278ffb843.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*EWTBBDZxKMjBQOw3SFEe6A.png"/></div></figure><p id="ec96" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">我们可以看到，站点需要一个名为file的GET参数，并将它的值存储在$file变量中。如果设置了它，后端脚本将尝试从页面的目录中包含它，前提是它存在。如果未设置file参数；它会显示默认的index.php页面。</p><p id="c907" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">现在考虑提供的URL:</p><p id="1b0f" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><a class="ae kb" href="https://www.example.com/file?page=file1.php" rel="noopener ugc nofollow" target="_blank">https://www.example.com/file?file=page1.php</a></p><p id="e7b0" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">我们可以看到，设置了file参数；它将提取它的值(即page1.php)，并检查目录中是否存在具有该文件名的页面。如果是，将显示该页面。这是因为使用了include方法。</p><p id="aad9" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">该脚本将尝试执行以下查询:include(pages/page1.php)</p><p id="f8ed" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">看起来一切都很完美。让我们变得狡猾一点。如果我们尝试一个包含passwd文件的奇特有效负载会怎么样？</p><p id="e569" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">【https://www.example.com/file? T2】文件=../../../../../../../etc/passwd </p><p id="11bc" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">如果文件参数的值包含一对(..)，可以用来从它所在的子文件夹中转义。会有很多点点斜线(../)符号，这将指向根目录，因此我们可以包含根目录中的文件。因为我们使用了/etc/passwd目录，所以将包含/etc目录中的passwd文件。</p><p id="995b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">该脚本将尝试执行以下查询:</p><p id="8249" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">包括(页数/../../../../../../../etc/passwd)</strong></p><p id="3285" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">因为不涉及后端检查，所以它将包含/etc/passwd文件的内容，并获取它们供您使用。</p><p id="9116" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">路径遍历漏洞的出现有多种原因</p><ol class=""><li id="7ec4" class="lk ll it ke b kf kg kj kk kn lm kr ln kv lo kz lp lq lr ls bi translated">使用不安全的方法包含来自服务器的文件</li><li id="c0d9" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">没有应用后端过滤和验证。</li></ol><p id="1a06" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">测试路径遍历漏洞</strong></p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi ly"><img src="../Images/496fd08d617c6c4efb21c4d60ee5de06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9qU5gWurLrdNCxhB3-Ttw.png"/></div></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://www.cloudprotector.com/path-traversal/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="571c" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">在我们开始测试路径遍历漏洞之前，有两件事需要考虑:</p><ol class=""><li id="c79b" class="lk ll it ke b kf kg kj kk kn lm kr ln kv lo kz lp lq lr ls bi translated">接受文件名的参数。</li><li id="8c7e" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">对web服务器进行指纹识别。</li></ol><p id="bc36" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">案例1: </strong></p><p id="5591" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">枚举接受文件名的参数</p><p id="e295" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">大多数在线应用程序可以被配置为接受几个参数，每个参数执行一个特定的活动或功能。很多时候，由于技术限制，您无法列出所有参数。让我们详细讨论它们。</p><ul class=""><li id="4554" class="lk ll it ke b kf kg kj kk kn lm kr ln kv lo kz lz lq lr ls bi translated">接受几个参数的web应用程序允许您尝试猜测与每个参数相关的功能。例如，一些可用于过滤出最近的产品，其他可用于根据一组标准进行排序，等等。如果您知道哪个选项接受一个文件名，您可以试验一下，看看是否可以包含一些已经存在于Linux或Windows操作系统中的默认文件。页面、视图、文件和其他常用参数都是可以用它们来做什么的例子。</li><li id="a39b" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lz lq lr ls bi translated">在某些情况下，您不能完全确定应用程序是否接受文件参数，您可以尝试暴力破解或猜测它。如果您选择暴力方法，您可以尝试像ffuf和wfuzz这样的工具。</li></ul><p id="2efb" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">案例二:</strong></p><p id="d20c" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">对网络服务器进行指纹识别</strong></p><p id="b27a" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">如果您发现了一个LFI漏洞，但无法利用它，您会怎么想？也许有白名单或黑名单，或者也许你正试图包括不适合这种情况的有效载荷。在我的分析中包含错误的有效载荷是什么意思？如果您试图包含作为Linux系统一部分的文件，如/etc/passwd、/etc/hosts，但实际上web服务器是托管在windows平台上的，该怎么办呢？因此，为了节省您的时间和精力，也请尝试对web服务器进行指纹识别。这可以通过使用wappalyzer之类的扩展、nikto、nmap之类的工具，甚至通过查看响应的标题来完成。找到服务器后，您就可以使用特定于该操作系统的有效负载了。</p><p id="6efa" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">在某些测试场景中，即使您发现了LFI，您也可能无法利用它。在这种情况下，您可以尝试:</p><ol class=""><li id="9820" class="lk ll it ke b kf kg kj kk kn lm kr ln kv lo kz lp lq lr ls bi translated">使用URL编码的有效负载。举个例子，../可以变成%2e%2e%2f</li><li id="4885" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">双重URL编码</li><li id="a63b" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">如果应用程序是用PHP开发的，就使用包装器</li></ol><p id="068a" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">整治</strong></p><p id="7872" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">仅仅因为不安全的编码实践或逻辑问题，攻击者就可以访问敏感文件，这使他更容易危害web应用程序。因此，实施以下补救技术非常重要:</p><ol class=""><li id="68f6" class="lk ll it ke b kf kg kj kk kn lm kr ln kv lo kz lp lq lr ls bi translated">永远不要相信用户的输入。</li><li id="ed53" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">使用需要包含的文件的黑名单和白名单。大多数情况下，必须维护白名单</li><li id="2420" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">如无必要，禁用PHP包装器。</li><li id="9ad3" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">晶片使用可能是有帮助的。</li></ol></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><h2 id="1154" class="mh mi it bd mj mk ml dn mm mn mo dp mp kn mq mr ms kr mt mu mv kv mw mx my mz bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kb" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>