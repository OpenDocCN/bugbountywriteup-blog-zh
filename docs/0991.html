<html>
<head>
<title>Hacking the Internal (Tryhackme)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">入侵内部(Tryhackme)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hacking-the-internal-tryhackme-42939bd3f5d6?source=collection_archive---------2-----------------------#2020-11-27">https://infosecwriteups.com/hacking-the-internal-tryhackme-42939bd3f5d6?source=collection_archive---------2-----------------------#2020-11-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="51fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嘿，伙计们，这个帖子是关于我最近在Tryhackme中提到的机器的，它确实是一个很好的侵入机器，因为它涵盖了真实世界的pentest示例，而且你也会了解到真实的pentest环境是什么样子的。务必记下这台机器里的一切。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/eb25e9d93cacdede143865d9a8ae8d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMC9CDqZd96aW1d8sFdHYg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">内部的</figcaption></figure><p id="f8ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">难度:难</p><p id="af97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">内容:</p><ol class=""><li id="a903" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">扫描和信息收集(Nmap、Nikto、Dirb、Wordpress)</li><li id="6308" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">识别缺陷。</li><li id="6b41" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">强制登录页面(wpscan)。</li><li id="3ef7" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">获得反向外壳。</li><li id="902c" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">枚举计算机。</li><li id="1fa8" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">获取user.txt</li><li id="0bf9" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">隧道技术</li><li id="18de" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">权限提升</li></ol><p id="9cf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为这就像一个真实的测试环境，我们必须遵循一定的规则。这里有一份简报可能会有所帮助。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lp"><img src="../Images/7f460e6a8117cafb37a4599874f03c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hu7H0e5Ir4wMcIGJXmZzZg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">交战规则</figcaption></figure><p id="10b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将对此机器进行详细扫描，即针对开放端口和服务的密集Nmap扫描。</p><p id="2835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有一件事，确保编辑/etc/hosts文件，IP应该反映到<strong class="jp ir"> <em class="lq"> internal.thm </em> </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lr"><img src="../Images/8176f7f181fdff39ffc40f2304fc721b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZzzeakkU8fCmqRpG3dfsQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Nmap扫描结果</figcaption></figure><p id="d610" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，我们在端口80上运行web服务器，为了进一步列举，我们将使用dirb和nikto。</p><p id="aa58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目录扫描结果:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ls"><img src="../Images/87f3461da9e5abe59bddc956bcb82d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7YEH4qfqSOIUtZqXoYp4A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">目录扫描结果</figcaption></figure><p id="c32d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Nikto扫描结果:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lt"><img src="../Images/2e2031994b0e0b7e72a4cdd96e4e8e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPmTQ15poovGy5bhGjdYdg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Nikto扫描结果</figcaption></figure><p id="5d1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从dirb和nikto的扫描中没得到什么。有一个wordpress网站正在运行，我们可以执行wpscan来列举用户和易受攻击的插件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lu"><img src="../Images/d0cc16ad1232ad9211d2548e91793646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_YX9yuvHyczUCjQLf8EJHQ.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lv"><img src="../Images/bf496a24eddebdc9669a2d3e12dc805f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SVkaMmLX5NJa2zNPCKh7Kg.png"/></div></div></figure><p id="80d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们发现了一个用户管理员，我们可以使用rockyou.txt作为默认单词列表对登录页面进行暴力攻击。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lw"><img src="../Images/ddfdda1253c1874b64a5a03fa57884cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PynTO6bPEgvI9Wslls5yNA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">成功执行暴力破解</figcaption></figure><p id="74ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们唯一剩下的就是登录到网页，通过主题编辑器得到反向外壳。让我们首先使用凭据登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lx"><img src="../Images/4454c30a25f3393677c800b90d494b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jtqol71VSu7EA-vHQQFJiQ.png"/></div></div></figure><p id="4017" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们在，让我们编辑主题文件来获得反向外壳。跟我来🚀</p><p id="e576" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">进入外观-&gt;主题编辑器-&gt; 404.php</p><p id="9f89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由<a class="ae ly" href="https://github.com/pentestmonkey/php-reverse-shell" rel="noopener ugc nofollow" target="_blank"> pentest monkey </a>用恶意php代码替换404.php的内容。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/b2524e1177c6e088aff79c465b1a7763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vn6y5lOLHMm20SD31eXCcg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">编辑404.php</figcaption></figure><p id="bf77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新文件并访问以下URL:</p><blockquote class="ma mb mc"><p id="1b5e" class="jn jo lq jp b jq jr js jt ju jv jw jx md jz ka kb me kd ke kf mf kh ki kj kk ij bi translated">http://internal . thm/blog/WP-content/themes/twenty seven/404 . PHP</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mg"><img src="../Images/aa9838312e5e660f96da5ef43d9d8077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l5CjUN8a9_pLKDB1JXJpLw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">获取反向外壳</figcaption></figure><p id="f696" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了生成一个稳定的shell，我们总是可以使用python。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/1642c1a6aa13f2e51e9198f767d462f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*g68M4DegRKcC6DEasxfEcw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用python获得稳定的外壳</figcaption></figure><p id="1f7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以要获得user.txt，我们必须将我们的特权升级到<strong class="jp ir"> <em class="lq"> aubreanna </em> </strong>。尝试运行linpeas脚本或手动枚举会很好。我在/opt目录中找到了这个文件，这是我们需要的文件，因为它包含了用户<strong class="jp ir"> <em class="lq"> aubreanna </em> </strong>的凭证。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mi"><img src="../Images/8eb82a584e2f5f37dae413fec2fff196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IvtqmMt3cx2n6LY5OJsZHQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">aubreanna的证书</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mj"><img src="../Images/e0024c0d7d76b3fea745c6a213cd5be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pFgcwFAEz5i5xZEOAmquFg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">获取user.txt</figcaption></figure><p id="d5e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和user.txt一起，我也得到了这个文件。让我给你看看它的内容。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/dc7aa60eac3b512a26be10fb51e374c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*F5jSO-L3QlFJIBK-m9cntA.png"/></div></figure><p id="8f71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">端口8080上运行着一个内部web服务。在这里，我们可以使用socat在任何端口号监听它，这样我们就可以访问它。</p><p id="7f3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">socat 实用程序是两个独立数据通道之间双向数据传输的中继。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/27cbacd9f6b6bef0d889169381ffb850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdX1THoNC4fkTZvH039syw.png"/></div></div></figure><p id="8bce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从<a class="ae ly" href="https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/socat" rel="noopener ugc nofollow" target="_blank">这里</a>获取socat的二进制版本。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/4d401e7f220c96bfc34eaeb1afd847f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_LYbncGhW3_1ZlR5diRLeA.png"/></div></div></figure><p id="d478" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到它的工作。所以现在我们可以浏览网络服务器，看看我们是否能得到什么有趣的东西。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/9dd6044c47aed8b4e908943f5ec22798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*zi8uRg5MsEIvAipzXiIuSw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">登录页面</figcaption></figure><p id="16dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">啊，又来了😧。我尝试了默认用户名/密码，但不起作用。暴力是我们唯一的选择。我将在这里使用九头蛇。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/b15a530910ba02ae20ad9fa146dce911.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2oVy98bUO9dlbbOX07Oxw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">蛮力成功</figcaption></figure><p id="bbad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以登录之后，我们得想办法去拿东西。所以我谷歌了一下我们能对詹金斯做些什么。所以我找到了这个脚本控制台，它允许人们编写和执行Groovy脚本。</p><div class="mp mq gp gr mr ms"><a href="https://blog.pentesteracademy.com/abusing-jenkins-groovy-script-console-to-get-shell-98b951fa64a6" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd ir gy z fp mx fr fs my fu fw ip bi translated">滥用Jenkins Groovy脚本控制台获取Shell</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">Jenkins是领先的开源自动化服务器，用于部署和自动化任何项目。</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">blog.pentesteracademy.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng kv ms"/></div></div></a></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/d74f9dbec961092bfe7a2e43a22e1667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YkopTgkuffT7n8o-ZK9WWA.png"/></div></div></figure><p id="f651" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行脚本，并在相应的端口上等待传入的连接。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/5c38607b239f8df46c58f241e469ae0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*SQyhcpb-X7mgdlmr_8ISow.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">反向外壳</figcaption></figure><p id="1f21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">枚举了一会儿，扫描了一下系统，得到了这个note.txt，这个文件包含了root用户的密码。轻松右转😙</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/802163d8f636f53567791dc15a742418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9cmd6XzECSJeHnl8hA8C2g.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/0e584ed7b56288cf83468bef8e4e2138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*ETGFz6O9fIsEU4QN_80OiA.png"/></div></figure><p id="7904" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你们能理解，随时给我发不和谐的短信</p><p id="7f17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢你😃快乐黑客💻</p></div></div>    
</body>
</html>