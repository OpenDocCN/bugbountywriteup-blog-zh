<html>
<head>
<title>HacktheBox Sauna Write-up</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HacktheBox桑拿报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-sauna-write-up-7c1423a37088?source=collection_archive---------0-----------------------#2020-07-18">https://infosecwriteups.com/hackthebox-sauna-write-up-7c1423a37088?source=collection_archive---------0-----------------------#2020-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/61a199a7211e73d4103644f405c6500d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*EBQbuWg_rrm5dHMNrR6jCQ.png"/></div></figure><p id="75f4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们开始探索盒子的旅程。这是一个有20个点的简单的windows框。我们将利用一些工具来提升权限，例如<a class="ae ks" href="https://github.com/Hackplayers/evil-winrm" rel="noopener ugc nofollow" target="_blank"> EvilWinRm </a>、<a class="ae ks" href="https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/GetNPUsers.py" rel="noopener ugc nofollow" target="_blank"> GetNPUsers </a>、winPEAS、mimikatz.exe和secretdump.py。</p><h1 id="9829" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">列举</h1><p id="b618" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">我们将运行<a class="ae ks" href="https://github.com/21y4d/nmapAutomator" rel="noopener ugc nofollow" target="_blank"> nmapAutomator </a>工具，它将覆盖所有类型的基本枚举。</p><blockquote class="lw lx ly"><p id="6750" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">。/nma自动马达10.10.10.175全部</p></blockquote><p id="51c7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">结果如下</p><blockquote class="lw lx ly"><p id="7b2b" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">10.10.10.175 <br/>主机的Nmap扫描报告已启动(0.30秒延迟)。</p><p id="1df9" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">端口状态服务版本<br/> 53/tcp开放域？<br/>| fingerprint-strings:<br/>| DNSVersionBindReqTCP:<br/>| version<br/>| _ bind<br/>80/TCP open http Microsoft IIS httpd 10.0<br/>| http-methods:<br/>| _潜在风险方法:TRACE<br/>| _ http-server-header:Microsoft-IIS/10.0<br/>| _ http-title:egotic Bank::Home<br/>88/TCP open<br/> 464/tcp开放kpasswd5？<br/>593/TCP open ncacn _ HTTP Microsoft Windows RPC over HTTP 1.0<br/>636/TCP open TCP wrapped<br/>3268/TCP open LDAP Microsoft Windows Active Directory LDAP(Domain:egotistic-bank . local 0，Site:Default-First-Site-Name)<br/>3269/TCP open TCP wrapped<br/>1尽管返回数据，但无法识别服务。如果知道服务/版本，请在https://nmap.org/cgi-bin/submit.cgi?new-service提交以下指纹:<br/>SF-port 53-TCP:V = 7.80% I = 7% D = 7/16% Time = 5 F10 BD 89% P = x86 _ 64-PC-Linux-GNU % r(DNSV<br/>SF:ersionbindrektcp，20，" \ 0 \ x1e \ 0 \ x06 \ x81 \ x04 \ 0 \ x01 \ 0 \ 0 \ 0 \ 0 \ 0 \ 0</p><p id="fdb7" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">5985/tcp打开http微软http API httpd 2.0(SSDP/UPnP)<br/>| _ http-server-header:微软-HTTPAPI/2.0 <br/> |_http-title:未找到<br/> 9389/tcp打开mc-nmf。NET消息组帧<br/> 49667/tcp打开msrpc Microsoft Windows RPC<br/>49673/TCP打开msrpc Microsoft Windows RPC<br/>49674/TCP打开ncacn _ HTTP Microsoft Windows RPC over HTTP 1.0<br/>49675/TCP打开msrpc Microsoft Windows RPC<br/>49686/TCP打开msrpc Microsoft Windows RPC<br/>58118/TCP打开msrpcOS:Windows；CPE: cpe:/o:microsoft:windows</p><p id="3b9a" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">主机脚本结果:<br/>| _ clock-skew:7h 05 m02s<br/>| sm B2-security-mode:<br/>| 2.02:<br/>| _消息签名已启用且需要<br/>| sm B2-time:<br/>| date:2020–07–17t 03:57:44<br/>| _ start _ date:N/A</p></blockquote><p id="2f46" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有一堆端口开放，让我们列出端口，这将有助于利用盒子。端口80上运行着Web服务器。我们在端口389和3268上运行kerberos服务。我们还得到了ldap服务提供者透露的域名——BANK。本地的。</p><p id="015d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我继续用enum4linux枚举，但是没有找到任何用户名。我们甚至试图列举中小型企业，但没有发现有趣的东西。</p><p id="dd7f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们打开HTTP端口时，让我们列举网站。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi md"><img src="../Images/6df36eb85a6374e4af4a651e8916df73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w0j4KqTWNQaBwi1Dy6sciA.png"/></div></div></figure><p id="bba6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">访问该网站后，在“关于我们”中发现了一些用户名</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mm"><img src="../Images/9cfb934136112141e6bd0c8cf81795db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlA7KCommp1DoTITca6ACA.png"/></div></div></figure><p id="b30b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们记下用户名的组合类型，这将有助于我们在ldap和kerberos中进行枚举。下面是我们可以形成user.txt的格式。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/5c118c82c753c9a3f3ef3b376d74ac89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*y-ph4xcCs6HkADKYpSnurg.png"/></div></figure><p id="4f63" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">得到一些用户名后。我们将使用Impacket工具，它有一个GetNPUsers python脚本，仅当用户帐户不需要kerberos每身份验证时，该脚本才返回TGT(票证授予票证)。</p><h1 id="de9c" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">剥削</h1><p id="e1dc" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">现在，我们将针对域名运行GetNPUsers.py，这将为我们提供用户FSmith的TGT。</p><blockquote class="lw lx ly"><p id="7556" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">cmd:-python 3 getnp users . py EGOTISTICAL-BANK.LOCAL/-users file user . txt-output file TGT . txt-DC-IP 10 . 10 . 10 . 175</p></blockquote><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mo"><img src="../Images/83777bc8edd5eada3d17d15bc1018e08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gn86AzuYazna3KG0vUltCg.png"/></div></div></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mp"><img src="../Images/3c01ba4f611918f08f7f14100912fe90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ub3zQFjkjrDiBIs9RsiI7A.png"/></div></div></figure><p id="7dd3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在john使用rockyou.txt文件破解哈希之后，我们获得了</p><blockquote class="lw lx ly"><p id="2641" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">史密斯:中风23</p></blockquote><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mq"><img src="../Images/efb98310c844f7f97531cabb0360c8b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6gHDvQBbShF2sTacxas98w.png"/></div></div></figure><p id="9647" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们将使用evil-winrm登录。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mr"><img src="../Images/d83dc80617e67323794d4282467433b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIrvDH4Xi2Jm_xPzL3-W0A.png"/></div></div></figure><p id="8b54" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为FSmith登录后，我们得到了user.txt文件。现在让我们继续后剥削。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/be1a55d5f59117873e9b55acd51f0143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*Rva_G0Y73MvObpHOrxG9ng.png"/></div></figure><h1 id="d999" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">后剥削</h1><p id="9af1" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">让我们先列出在场的用户。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mt"><img src="../Images/31e2dfc906f288d4b0a2d3ef276f3164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CnP6KbfdCpKsphwCo861GQ.png"/></div></div></figure><p id="1edd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">方法是使用“winPEAS.exe”收集信息并获得svc_loanmgr的密码，因为我们获得了DPAPI主密钥，我们可以使用mimikatz进行攻击。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mu"><img src="../Images/014eec8246c2a38d7bf3bdce3a1a3629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PrJVn4UYQH9Uulo0wS1TAQ.png"/></div></div></figure><p id="3b4b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后执行winPEAS.exe文件。以下是一些有趣的发现。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mv"><img src="../Images/8c8bf8d352270dd8b63813619e184f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tlO0EKzwVHYSpsplnAoQSw.png"/></div></div></figure><p id="6d43" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们已经得到了svc_loanmgr用户的默认密码。</p><p id="b8bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">的结果。/winPEAS.exe我们获得了DPAPI主密钥，我们可以使用mimikatz攻击它。</p><p id="6239" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们通过<a class="ae ks" href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py" rel="noopener ugc nofollow" target="_blank"> secretsdump.py </a>来转储散列</p><blockquote class="lw lx ly"><p id="de54" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">cmd:-python 3 secrets dump . py egotistic-BANK/SVC-loan mgr @ 10 . 10 . 10 . 175</p></blockquote><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mw"><img src="../Images/8ed304f0a8853dee0e72a80506a589f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pbEFiJCEvqEWsGA1gAfJDA.png"/></div></div></figure><p id="53a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们使用管理员散列通过<a class="ae ks" href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py" rel="noopener ugc nofollow" target="_blank"> psexec.py </a>登录</p><blockquote class="lw lx ly"><p id="811d" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated">cmd:-python 3 psexec . py-hashes aad3b 435 b 51404 eeaad3b 435 b 51404 ee:d 9485863 C1 e9 e 05851 aa 40 CB B4 ab 9 dff Administrator @ 10 . 10 . 10 . 175</p></blockquote><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mx"><img src="../Images/ab60c4a3b6444197d3f31c6ddcf202cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UzHR6Kx909Z0DwryrzwfEg.png"/></div></div></figure><p id="7da5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">答对了，我们已经成功地把盒子固定住了。</p><blockquote class="my"><p id="d491" class="mz na iq bd nb nc nd ne nf ng nh kr dk translated">感谢阅读。</p></blockquote><figure class="nj nk nl nm nn jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/bb16dd41285ad610df2224c08caa4834.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*05Th-NUo8revNZyHI-_Tvw.png"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated"><a class="ae ks" href="https://www.hackthebox.eu/profile/196419" rel="noopener ugc nofollow" target="_blank">点击这里</a></figcaption></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/69bbd45abad0b6e8c0a585210797722f.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*xfgmnA7SDu_1emGCuWQqsg.jpeg"/></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated"><a class="ae ks" href="http://buymeacoff.ee/Viston" rel="noopener ugc nofollow" target="_blank">点击这里</a></figcaption></figure></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><div class="me mf mg mh gt oa"><a href="https://github.com/SecureAuthCorp/impacket" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">SecureAuthCorp/impacket</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Impacket是用于处理网络协议的Python类的集合。Impacket专注于提供…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo js oa"/></div></div></a></div><div class="op oq gp gr or oa"><a href="https://github.com/Hackplayers/evil-winrm" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">黑客玩家/邪恶-winrm</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">用于黑客攻击/测试的终极WinRM外壳这个外壳是用于黑客攻击/测试的终极WinRM外壳。WinRM…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="os l ol om on oj oo js oa"/></div></div></a></div><div class="op oq gp gr or oa"><a href="https://0xprashant.github.io/posts/hackthebox-sauna/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">Hackthebox桑拿记录</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">托管在端口80上的网站在“关于我们”上有一些用户名，在名称上做了一些变化，并做了…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">0xprashant.github.io</p></div></div><div class="oj l"><div class="ot l ol om on oj oo js oa"/></div></div></a></div></div></div>    
</body>
</html>