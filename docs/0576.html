<html>
<head>
<title>NSDetect: A Tool To Discover Potential AWS Domain Takeovers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NSDetect:发现潜在AWS领域接管的工具</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/nsdetect-a-tool-to-discover-potential-aws-domain-takeovers-fd0ff1a8b68a?source=collection_archive---------0-----------------------#2020-05-03">https://infosecwriteups.com/nsdetect-a-tool-to-discover-potential-aws-domain-takeovers-fd0ff1a8b68a?source=collection_archive---------0-----------------------#2020-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0a84" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">可能帮你赚/省几十万美元的实用工具！🤑</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8940c7b98cc5aa3800c228d1848a39d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6UHwQcaNof08daG10wmxIA.png"/></div></div></figure><h2 id="167d" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">介绍</h2><p id="37a8" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">AWS确实是一个领先的云平台，被网飞、Airbnb、Lyft、Deliveroo等科技巨头广泛用于各种类型的云服务。在这个故事中，我将谈论自动检测<strong class="ls iu"> AWS NS接管</strong>，这是一个与AWS Route 53服务中的错误配置相关的安全问题。该工具可以被基础设施安全工程师、开发人员工程师、渗透测试人员和漏洞赏金猎人使用(<strong class="ls iu">🤑</strong>)用于自动检测NS接管。</p><p id="a5bf" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">如果你不知道AWS NS接管，我强烈建议你先看看下面的故事，以便更好地理解这个问题。这个故事还谈到了使用<a class="ae mo" href="https://github.com/shivsahni/NSBrute" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu"> NSBrute </strong> </a>的利用技术，渗透测试人员和Bug赏金猎人可以利用这些技术来生成有效的概念证明。</p><div class="mp mq gp gr mr ms"><a href="https://medium.com/@shivsahni2/aws-ns-takeover-356d2a293bca" rel="noopener follow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd iu gy z fp mx fr fs my fu fw is bi translated">AWS NS接管</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">从101到检测和开发</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">medium.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng ks ms"/></div></div></a></div><p id="dbd9" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">为了让已经知道这个问题的人重温一下这个概念，AWS NS接管是一个安全问题，它是由于在使用AWS Route53进行DNS服务时的错误配置而发生的。当我们将AWS名称服务器关联为某个域的<a class="ae mo" href="https://en.wikipedia.org/wiki/Name_server#Authoritative_name_server" rel="noopener ugc nofollow" target="_blank">权威名称服务器</a>而该名称服务器没有关联域的区域文件时，就会出现<strong class="ls iu"> </strong>。</p><p id="f3e5" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">如果管理员在删除域时从AWS Route 53中删除了托管区域，但忘记删除域注册商的悬空指针，就会出现这种情况。</p><p id="e6e4" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">例如，对于我的域名<strong class="ls iu"><em class="nh">shivsahni.com</em></strong>，我提供了AWS域名服务器作为权威域名服务器，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/2debc6a44a3c66fcdf0923e22213d944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_8C1ACN3nhbAQyKN8FCFw.png"/></div></div></figure><p id="2621" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">而在我的AWS控制台中，我已经删除了区域文件，因此相关联的名称服务器没有区域文件，这使得该域可能容易被AWS NS接管。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/94a1776b261bb983f31e8c90ae3fed44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQuamS_fqeOCMHmpvA0snQ.png"/></div></div></figure><h1 id="b9bb" class="nk kv it bd kw nl nm nn kz no np nq lc jz nr ka lg kc ns kd lk kf nt kg lo nu bi translated">AWS NSDetect</h1><p id="fb0a" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">最近我开发了<a class="ae mo" href="https://github.com/shivsahni/NSDetect" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu"> AWS NSDetect </strong> </a>，这是一个Python实用程序，用于识别容易被AWS NS接管的域。该实用程序的范围仅限于识别错误配置。您可以将它与<a class="ae mo" href="https://github.com/shivsahni/NSBrute" rel="noopener ugc nofollow" target="_blank"> NSBrute </a>结合使用，以获取对域的访问权限。</p><h2 id="ae4d" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">使用</h2><p id="1c08" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">如下所示，该脚本将一个包含域列表的文件作为输入，针对此漏洞扫描每个域，最后报告易受攻击的域列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/64f11cdef4426541d6c718711fb1d5f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U7_Gk8kw28N-l0gW4oWvoQ.png"/></div></div></figure><p id="22b6" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">输入文件可以是以下形式:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/a46e8df3a9e89391aa3d7dd3b9c2bfa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rzHvIjt6v2O97-Cc_V8mCA.png"/></div></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="4ab5" class="ku kv it ny b gy oc od l oe of">💡<strong class="ny iu">Pro Tip</strong>💡</span><span id="7540" class="ku kv it ny b gy og od l oe of">You can refer <a class="ae mo" href="https://0xpatrik.com/subdomain-enumeration-2019/" rel="noopener ugc nofollow" target="_blank"><strong class="ny iu">this</strong></a> amazing blog on Subdomain Enumeration by Patrik Hudák(@0xpatrik) to prepare a rich list of domains to scan. Don't forget <strong class="ny iu"><em class="nh">Enumeration Is The Key</em></strong>!</span></pre><p id="3a8a" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">一旦我们对目标进行了充分的侦察，并准备好了域/子域列表，我们就可以将该列表作为工具的输入来扫描列表中的每个域(跳过重复的域)。如下所示，脚本实时显示结果，以红色突出显示的域是易受攻击的域。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/2555a55e7c5c3fc74c6c5144d9f71cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdH3qogNOiXKAljiJvyYag.png"/></div></div></figure><p id="c218" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">一旦有了易受攻击域的列表，就可以使用<a class="ae mo" href="https://github.com/shivsahni/NSBrute" rel="noopener ugc nofollow" target="_blank"> <strong class="ls iu"> NSBrute </strong> </a>接管易受攻击的域，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/e8cf0f5ca8414625eacf55bbe127676d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pnzx4xmSnu8sAyFU.png"/></div></div></figure><h1 id="7e5a" class="nk kv it bd kw nl nm nn kz no np nq lc jz nr ka lg kc ns kd lk kf nt kg lo nu bi translated">补救</h1><p id="1bb2" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">该漏洞有一个简单的修复方法。我们只需要在域名注册机构删除与我们的域名相对应的悬空域名服务器条目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/974b475eb25c8b23172e8207c85f6d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWurpSOzkuNU6Tq9_d7zhg.png"/></div></div></figure><pre class="kj kk kl km gt nx ny nz oa aw ob bi"><span id="59d3" class="ku kv it ny b gy oc od l oe of">Note: While you are doing the POC for NSDetect locally, please keep in mind that <a class="ae mo" href="https://www.siteground.com/kb/what_is_dns_propagation_and_why_it_takes_so_long/" rel="noopener ugc nofollow" target="_blank">DNS Propagation Issues</a> might lead to unexpected results. You may need to provide sufficient time for DNS changes to propagate. In case you still observe the problem, feel free to raise an issue, we can <strong class="ny iu">together</strong> fix it!</span></pre><blockquote class="ok ol om"><p id="067b" class="lq lr nh ls b lt mj ju lv lw mk jx ly on ml ma mb oo mm md me op mn mg mh mi im bi translated">将感谢您的建议，错误报告，拉请求和其他合作！<strong class="ls iu">让我们从黑客手中拯救世界！</strong></p></blockquote><p id="2a69" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">请继续关注微软Azure即将推出的一些很酷的东西。欢迎在<a class="oq or ep" href="https://medium.com/u/504c7870fdb6?source=post_page-----fd0ff1a8b68a--------------------------------" rel="noopener" target="_blank">媒体</a>和<a class="ae mo" href="https://twitter.com/shiv__sahni" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我</p></div></div>    
</body>
</html>