<html>
<head>
<title>Analysis of Poetrat malware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Poetrat恶意软件分析</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/analysis-of-poetrat-malware-13042c651e0f?source=collection_archive---------3-----------------------#2021-10-02">https://infosecwriteups.com/analysis-of-poetrat-malware-13042c651e0f?source=collection_archive---------3-----------------------#2021-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f37ff7a2e28c61d88195a10c075afd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ir73SYHK8WGD-1IiLHZC9g.jpeg"/></div></div></figure><blockquote class="jy jz ka"><p id="3aa3" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#43c3" rel="noopener ugc nofollow">哈希</a></p><p id="8317" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#51d9" rel="noopener ugc nofollow">样品</a></p><p id="9a49" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#98f1" rel="noopener ugc nofollow">初始静态分析</a></p><p id="ede4" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#dffa" rel="noopener ugc nofollow">使用沙盒的行为分析</a></p><p id="d2a2" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#8f9d" rel="noopener ugc nofollow">什么是宏</a></p><p id="5b7f" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#24f1" rel="noopener ugc nofollow">VBA文字的提取</a></p><p id="10d6" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#6769" rel="noopener ugc nofollow"> VBA剧本分析</a></p><p id="6ff9" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#cce5" rel="noopener ugc nofollow">恶意Python代码分析</a></p><p id="7785" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="#9412" rel="noopener ugc nofollow">指挥控制服务器(C2) </a></p></blockquote><p id="6326" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">你好，这里是黑客Yuvaraj，今天我们将分析Poetrat恶意软件。Poetrat是一种<strong class="ke ir">远程访问木马(RAT) </strong>，这意味着攻击者能够控制和监控受害者的机器。这种恶意软件的目标是阿塞拜疆公共部门和其他重要组织。恶意软件是一个word文档。当打开文件时，它会执行一个恶意的VBA脚本，将恶意软件放入你的系统。</p><h1 id="43c3" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">哈希:</h1><p id="a14e" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">MD5:3 aadbf 7 e 527 fc 1a 050 E1 c 97 FEA 1c ba 4d</p><p id="85c0" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">sha 256:208 EC 23 c 233580 DBF c53 aad 5655845 f 7152 ada 56 DD 6a 5 c 780d 54 e 84 a9 d 227407</p><h1 id="51d9" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">样本:</h1><div class="mh mi gp gr mj mk"><a href="https://github.com/UVvirus/malware_samples/tree/main/Poetrat" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd ir gy z fp mp fr fs mq fu fw ip bi translated">主UVvirus/malware _ samples/poet rat</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">在GitHub上创建一个帐户，为UVvirus/malware_samples的开发做贡献。</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">github.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my jw mk"/></div></div></a></div><h1 id="98f1" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">初始静态分析:</strong></h1><p id="7007" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">通过查看<strong class="ke ir">文件</strong>命令的输出，它说这是一个word文件。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/831bfd18f80b850f7a6ed9cd5772906c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r24v4HdGwNiTV60-hy9SiA.png"/></div></div></figure><p id="1eab" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">通过在Pestudio中加载样本，我们可以看到62个样本中有39个在Virustotal中被标记为恶意。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/300cd38a1825d7a6df859d90bf29ba73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*mScJlsXObq1EJBP2u0B_Xg.png"/></div></figure><h1 id="dffa" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用沙盒的行为分析:</h1><p id="5854" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">让我们在<strong class="ke ir"> ANY运行恶意软件。运行</strong>沙盒，试着弄清楚它在做什么。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/fac6bbf47975e4921a5acfed5dbdc447.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*2p9I2ut8dj3U_i92nevAaw.png"/></div></div></figure><p id="2961" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">嗯…通过查看上面的图像，我们可以说这个word文档正在删除一些python文件并执行它们。</p><p id="f081" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">注意:- Word文档可以使用宏实现这种类型的行为。</p><h1 id="8f9d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">什么是宏:</h1><p id="80f2" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">宏是一系列的命令和指令，你把它们组合成一个单独的命令来自动完成一项任务。</p><p id="ee84" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">让我们使用olevba.py从word文档中提取宏</p><h1 id="24f1" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">VBA文字的提取:</h1><p id="c618" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">为此，我将使用olevba工具。因为它会显示文件是否有任何可疑之处。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/a3ace83312bc0ef802b8179910fd68d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OA6TwZzPp0k9LskcZF0ymg.png"/></div></div></figure><blockquote class="jy jz ka"><p id="4f09" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">cmd: olevba.py poetrat</p></blockquote><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/696334b1037984e1a3587afb29ff5bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6yN7wNJZ7nNCG7VMswri3A.png"/></div></div></figure><h1 id="6769" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">VBA剧本分析:</h1><p id="36a2" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">首先，它将文档文件docer.doc复制到位置<strong class="ke ir">“C:\ Users \ Public \ docer . doc”。</strong>然后从文档中提取最新的<strong class="ke ir"> 7074638字节</strong>并创建一个名为<strong class="ke ir"> smile.zip </strong>的zip文件。</p><p id="820a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">然后解压成<strong class="ke ir">“C:\ Users \ Public \ python 37”。</strong>从smile.zip中提取的文件有</p><p id="a653" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">launcher.py，皱眉. py，微笑_有趣. py，微笑. py，仿射. py，靠山. py</p><p id="8482" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">所有文件看起来都很有趣，但让我们从launcher.py开始。</p><h1 id="cce5" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">恶意Python代码分析:</h1><p id="669f" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">在launcher.py中，恶意软件试图通过使用<strong class="ke ir"> good_disk_size() </strong>方法检查磁盘大小来识别它是否正在沙箱中运行。</p><p id="5acc" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如果磁盘大小小于62GB，那么根据恶意软件，它是一个沙箱。如果发现恶意软件运行在沙盒上，那么它会用license.txt文件覆盖<strong class="ke ir"> smile.py、皱眉. py和smile_funs.py </strong>的内容，并终止程序。</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/f089800c0650f94f2ad95d8e810f11fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TNrTNCF5cYt_4j72Hk0oEw.png"/></div></div></figure><p id="d4e8" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如果上述情况不成立，那么它将触发<strong class="ke ir">警察()</strong>功能。该功能将启动<strong class="ke ir"> smile.py和皱眉. py. </strong></p><p id="db9d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">smile.py模块负责执行截图、上传文件等命令。</p><p id="1a74" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">第二个模块皱眉. py用于与c2(命令和控制)服务器通信。</p><h1 id="9412" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">指挥和控制服务器(C2):</h1><p id="d1c3" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">dellgenius.hopto.org</p><p id="3330" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">hopto.org被广泛用于实施虐待行为。</p><h1 id="c97b" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">最终想法:</h1><p id="8788" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">如果你喜欢我的工作，你可以在这里给我买杯咖啡</p><figure class="na nb nc nd gt jr gh gi paragraph-image"><a href="https://buymeacoffee.com/UVvirus"><div class="gh gi nj"><img src="../Images/55f8dd51be2f7a62a32e4f4e73b6c34c.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*VQZ6H9x_DejwzGc_2hlJKA.png"/></div></a></figure></div></div>    
</body>
</html>