<html>
<head>
<title>Chaining vulnerabilities leads to account takeover</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">链接漏洞导致帐户被接管</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/chaining-vulnerabilities-lead-to-account-takeover-b583f0c10591?source=collection_archive---------1-----------------------#2020-12-01">https://infosecwriteups.com/chaining-vulnerabilities-lead-to-account-takeover-b583f0c10591?source=collection_archive---------1-----------------------#2020-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="688a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将解释我是如何将导致一次点击账户接管的五个漏洞串联起来的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d1d5c80f963374f5f39c6863c6b5b556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*poITcqoz_IX3Fq6svcTlJQ.png"/></div></div></figure><blockquote class="kx ky kz"><p id="fd1f" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated">我在一个私人程序中发现了这些漏洞，我将它命名为:<strong class="jp ir"><em class="iq">【target.com】</em></strong>，在我们继续解释之前，我们应该考虑这些漏洞是由于通过API和其他内部函数错误地应用重置密码方法而发生的。</p></blockquote><p id="35fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi le translated"><span class="l lf lg lh bm li lj lk ll lm di"> W </span>当我在这个目标中进行侦察时，我意识到这个应用程序使用不同的API来管理功能和方法，所以我选择测试登录和重置密码方法等主要方法，我无法识别登录方法中的奇怪实现，所以我直接尝试通过重置密码方法重置我的帐户密码。</p><p id="b446" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重置我的帐户密码后，我意识到在reset-password方法请求中有一个奇怪的“to”JSON参数。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ln"><img src="../Images/0ddecbac11810ca111f656c1ee5db660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0f6_21NID0M20cdhTXg4SQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">重置密码请求</figcaption></figure><p id="7d07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在检查我的重置密码电子邮件后，我能够验证这个参数是否反映在重置密码链接中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ls"><img src="../Images/aec562c9dffc67f5e53f5607052d2262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_brJh7hgvP7MVoBBgsi9pw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">重置密码电子邮件</figcaption></figure><p id="63de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我进一步请求确保该参数在重置密码链接中得到反映，我是对的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lt"><img src="../Images/c1fd2ebf42eac820e6ed968e6a4ef51b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sc4Rg9dYrZWuPdc_NMFGgg.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">重置密码电子邮件</figcaption></figure><p id="1e22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我考虑将此升级为open-redirect，这将导致重置密码秘密代码的泄漏，因此我尝试通过Host header、Referer header、Origin header注入Host header，并在“to”JSON参数值中注入Host，我无法注入我自己的主机，这意味着我应该在同一目标主机中找到内部open-redirect，这将导致重置密码秘密代码的泄漏。</p><p id="8732" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在测试了一些不同的方法和功能之后，我能够在这些端点中识别出两个内部开放重定向:</p><pre class="km kn ko kp gt lu lv lw lx aw ly bi"><span id="2645" class="lz ma iq lv b gy mb mc l md me">https://target.com/api/otc/login?response_type=code&amp;client_id=web&amp;redirect_uri=https://host/</span><span id="8f5c" class="lz ma iq lv b gy mf mc l md me">https://target.com/api/oidc/preauthorized?response_type=code&amp;client_id=web&amp;redirect_uri=https://host/</span></pre><p id="030c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些开放重定向泄露了另一个秘密代码，这本身就是一个漏洞，但我选择将其升级为一个链接点击账户接管。</p><p id="1fa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在通过“to”JSON参数值将一个open-redirection注入reset-password链接之后。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mg"><img src="../Images/3ff98c6de368e8e53d55b73f76f2bdbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PnbB2Bv2aa2CdaNC8BrOHw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">重置密码请求</figcaption></figure><p id="79fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以通过点击重置密码邮件中的一个重置密码链接，将重置密码密码和其他密码重定向到我自己的主机。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mh"><img src="../Images/293e356813ed7c1ae99ae136dbf16554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVfeNRj0kDRe8keRIRC04A.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">重置密码电子邮件</figcaption></figure><p id="cd19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而我们在这里，路径中的代码是reset-password秘密代码，查询中的代码是其他秘密代码，都泄露到了我的主机中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mi"><img src="../Images/a014856bf021061ec7157c3d95d94f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4IncmtfzSDnvQHiuGJDyqA.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">我的主办活动</figcaption></figure><p id="b94c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是等等，当我测试重置密码的方法时，我发现了另外两个漏洞，这些漏洞很明显，我可以强迫用户点击中毒链接，从而导致用户完全接管帐户。</p><p id="2e74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个漏洞是重置密码方法中缺乏速率限制，我能够发送2000多个请求，这将DDOS用户电子邮件，并迫使他们点击中毒的重置密码链接，从而导致重置密码秘密代码的泄露。</p><p id="ec30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个漏洞是无法使重置密码秘密代码无效，因此我可以随心所欲地使用重置密码秘密代码，并且该秘密代码不会无效，即使用户请求另一个重置密码秘密代码并重置了他们的密码，泄露给我的主机的重置密码秘密代码也将有效并可用。</p><h1 id="b47e" class="mj ma iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">摘要</h1><blockquote class="kx ky kz"><p id="0bd1" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated">我能够链接五个漏洞:两个内部打开重定向，重置密码链接中的资源注入，重置密码方法中缺乏速率限制，以及无法使重置密码密码无效，我能够将它们升级为一个链接单击帐户接管。</p></blockquote><h1 id="200e" class="mj ma iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">时间表</h1><p id="9f50" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">报告(11月23日)。第一次回应(11月24日)。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="1349" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">别忘了在<a class="ae ns" href="https://twitter.com/ahzsec" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，这样你就不会错过我的新评论和文章。感谢您阅读我的文章，不胜感激。</p></div></div>    
</body>
</html>