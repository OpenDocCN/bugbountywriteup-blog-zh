<html>
<head>
<title>Bypassing 2FA With Cookies!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用饼干绕过2FA！</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bypassing-2fa-with-cookies-ff2c79022f63?source=collection_archive---------1-----------------------#2022-01-21">https://infosecwriteups.com/bypassing-2fa-with-cookies-ff2c79022f63?source=collection_archive---------1-----------------------#2022-01-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/a3863feb8e8a90e4e86ab9e1d7aa4e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*W3m2LM6epd1Bmsfg.png"/></div></figure><p id="047a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果您的帐户启用了双因素身份验证(2FA)，您就不会受到威胁，对吗？</p><p id="51f3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">不完全是。随着技术的进步，攻击者也在进步。网络钓鱼攻击变得更加复杂，攻击者正在寻找绕过2FA的方法。之所以如此，是因为你的浏览器里储存了美味的饼干。会话cookies是向服务器显示用户已经通过身份验证的一种方式。这包括通过2FA挑战。您的浏览器可以使用这些cookie，直到其过期(抱歉)。一旦cookie过期，您将被要求重新认证。</p><p id="6bec" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这取决于应用程序，但有些应用程序可能比其他应用程序有更强的限制。其中包括:</p><ul class=""><li id="3286" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">一次性cookie。</li><li id="96a6" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">受IP、设备或某种指纹的限制。</li><li id="abfa" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">链接到验证cookie的另一个元素(反欺骗)。</li></ul><p id="5ff6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">但并非所有情况都是如此，这正是攻击者所利用的。Outlook、Gmail和社交网络平台等服务都允许cookie被重复使用。攻击者只需要一种提取它们的方法。</p><p id="60ec" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为了向您展示它是如何工作的，我将使用一个名为EditThisCookie的浏览器扩展:<a class="ae lj" href="http://www.editthiscookie.com/" rel="noopener ugc nofollow" target="_blank">http://www.editthiscookie.com/</a></p><p id="1a79" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">你不需要一个花哨的扩展就能看到和查看你的cookies。如果您在浏览器(开发者)中点击F12，您可以在应用程序&gt;存储下看到正在使用的cookies。</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/aba03562844a01c7db8b764d8ea257f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*patGeL6T9v_pQkCU.png"/></div></figure><p id="6ce2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">问题是，你没有提取它们的简单方法。当然，你可以复制和粘贴，但这是冗长的，容易出错。这就是Cookie编辑器让生活变得更容易的地方。使用EditThisCooke，我们可以简单地将cookies导出和导入到不同的浏览器中。</p><p id="3df0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">以Outlook.com为例。我们首先登录我们的帐户。</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/cc0b826bc290bc045eea30759d553483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*vJHitOrNTSUbgKlc.png"/></div></figure><p id="4470" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">输入密码后，我们会批准MFA提示。</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/c9e30036130ce182392ba251ff74293c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*jRblZuZjonfleGOG.png"/></div></figure><p id="83ef" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在我们进来了。下面你可以看到我正在使用两种浏览器。在左边，我用Chrome登录了Outlook。在右边，你可以看到我没有登录Outlook，正在使用Firefox。请记住，cookies是特定于浏览器的。</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/9a37f9db6528cb4e909571ae5e9fdc3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*SDQhAVOwA5WwGhY0.png"/></div></figure><p id="76aa" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有了EditThisCookie，我可以从Chrome导出我的Outlook cookie</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/e79774c061369fed8d62496b3cc36d05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*Cmm6E9_ADBRwT3vr.png"/></div></figure><p id="87b6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">…并将它们导入Firefox。如你所见，我仍然没有登录。</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/ffa1452818eee327bede09cc6eb8b152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*LDWgmsr7v6Rf45nN.png"/></div></figure><p id="431a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">导入后，我再次点击Outlook网站，登录成功。这是因为Firefox用我导入的cookie来证明我已经认证了。</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/c45dc009d9a4b57db1204cbb71f0e5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*zQ6SC424LlxD7w2M.png"/></div></figure><p id="ab74" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">导入后，我再次点击Outlook网站，登录成功。这是因为Firefox使用了我导入的cookie来表明我已经通过了身份验证。</p><p id="ab39" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这是在同一台设备上完成的，但是，如果我使用另一台设备，这也可以工作。如果我将设备1上的cookie导出并导入设备2，我会得到相同的结果(取决于应用程序)。</p><p id="f064" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这基本上就是攻击者现在正在利用的。你可能会想，他们怎么能接触到我的设备呢？</p><p id="216a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">答案是他们并没有试图这么做。虽然我确信这是可以实现的，但风险相当低。攻击者可以使用某种脚本或橡皮鸭提取cookie，但这不太可能。相反，他们希望你去找他们。</p><p id="79d7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这就是EvilGinx2发挥作用的地方:<a class="ae lj" href="https://github.com/kgretzky/evilginx2" rel="noopener ugc nofollow" target="_blank">https://github.com/kgretzky/evilginx2</a></p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/b099e7f987ba48c303c255d1b8844641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*rq8vjAl_egSD-duG.png"/></div></figure><p id="ee72" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">EvilGinx2是一个代理/钓鱼工具，可以提取您的会话cookie。它通过创建一个钓鱼网站来欺骗您输入您的凭据，包括2FA挑战。</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/ee1c85981ef7db3611c3a080fe966ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*5zt9Ej6bKr8kyTxX.png"/></div></figure><p id="3e30" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">EvilGinx2是一个代理/钓鱼工具，可以提取您的会话cookie。它通过创建一个钓鱼网站来欺骗您输入您的凭据，包括2FA挑战。</p><p id="20ef" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">一旦用户被愚弄，Evilginx保存令牌，允许攻击者提取并将其导入他们选择的浏览器。这整个过程使2FA提示失效，因为服务器读取cookie并假设用户已经过身份验证。正如我上面提到的，一些应用程序对cookies有限制。Evilginx的好处是身份验证的来源将是Evilginx服务器。这意味着，攻击可以使用服务器本身的浏览器，绕过任何IP和设备限制。请记住，会话cookie会将源记录为Evilginx服务器，而不是您的客户端。</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/31ef9c6423260ae8b34f42ef5f5753f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/0*UJtoRBHqdQBDa9_u.png"/></div></figure><p id="c539" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">开发人员制作了下面的视频来解释它是如何工作的。</p><figure class="lk ll lm ln gt ju"><div class="bz fp l di"><div class="lq lr l"/></div></figure><p id="7211" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有了云计算，这些“邪恶”的服务器可以以非常低的成本制造出来。我们聊了不到一杯咖啡:<a class="ae lj" href="https://acn.ionos.co.uk/SHBE" rel="noopener ugc nofollow" target="_blank"> IONOS </a>:</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/2b718692295d929652a5c4497f65ee4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qm0ZpHkXTX0QUD_crJV8kw.png"/></div></div></figure><p id="a937" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">那么，您能做些什么来防范这种类型的攻击呢？</p><p id="925b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这种攻击的一个缺陷是DNS记录必须有说服力才能欺骗今天的用户。攻击者会将Evilginx托管在所有人都可以访问的web服务器上。这将要求攻击者设置一个外部IP和DNS记录。因此，他们将不能使用微软的任何官方域名。这适用于谷歌和其他任何有钓鱼网站的网站。攻击者将不得不使用我过去的帖子中描述的技术:【https://xstag0.com/2019/07/11/how-the-phishers-phish/ T4】</p><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/8118e0397d9a0be278f033c5f285cf0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*74ktPy4mNZ1upPjs.png"/></div></figure><p id="fe01" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最简单的解决方法就是教育。现在，攻击者使用HTTPS似乎是真实的，我们真的需要在输入我们的凭据之前检查URL。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><figure class="lk ll lm ln gt ju gh gi paragraph-image"><div class="gh gi me"><img src="../Images/39636fe84e354b1224d3e765c9f1f473.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/0*NzbamVltP-Nom-Ga.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated"><a class="ae lj" href="https://www.buymeacoffee.com/Xstag0" rel="noopener ugc nofollow" target="_blank">xstag 0(buymeacoffee.com)</a></figcaption></figure><h2 id="514e" class="mj mk it bd ml mm mn dn mo mp mq dp mr ki ms mt mu km mv mw mx kq my mz na nb bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lj" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>