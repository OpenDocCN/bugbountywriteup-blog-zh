# 使用 IDOR 的帐户接管和错误 403 的误导情况。

> 原文：<https://infosecwriteups.com/account-takeover-using-idor-and-the-misleading-case-of-error-403-cb42c96ea310?source=collection_archive---------1----------------------->

再次欢迎大家，今天我想和大家分享一个故事，我是如何在 45 分钟内发现一个非常简单的 bug 的。这个 bug 存在了很长时间，在一个公共项目中被顶级猎人遗漏了，有 100 多个已解决的报告。这就是为什么你不应该相信状态代码。

![](img/34b244e3e62c7f131b23d85dc811163d.png)

当时已经很晚了，我也没有那么大的动力，所以我去检查新的程序，看到了这个程序，它看起来很快，功能简单，没有什么花哨的东西，非常适合轻松的狩猎活动。该应用程序看起来非常简单，用户可以与其他账户互动，发表评论和评级的东西。

不管怎样，一旦我创建了一个帐户，我立即去检查我的个人资料，以了解该应用程序是如何工作的，并回答一些非常基本的问题，如:

*   应用程序是否从 api 获取信息，它位于哪里(子域，根域上的路径)？
*   有哪种身份认证，它是如何工作的？
*   是否有任何 id 来识别当前用户？
*   这个 id 是否会在任何地方公开披露？

开始了解应用程序，然后刷新页面，但这一次我保持代理打开并手动转发所有请求，这是我注意到一些有趣的事情的地方，在应用程序中，你可以链接你的 facebook 帐户，连接按钮单独加载在 iframe 中。然而，引起我注意的是它是一个 get 请求，看起来像这样

【https://www.redacted.com/connect/facebook_login? id=[ID] &令牌=[令牌]

没有签名没有哈希:D

该响应包含 facebook 重定向链接，其中包含启动 oauth 流的必要信息，包括帐户 id，因此我立即创建了一个新帐户，并开始使用这两个帐户。想法是，如果我可以控制 iframe 响应，就有可能接管该帐户。

从帐户 A 获取 id，然后转到帐户 B，修改 iframe 请求并转发请求，然后点击帐户 B 上的连接 facebook 按钮，一切都按计划进行，但在从 facebook 重定向后，我得到错误 403，刷新了两个帐户的页面，按钮仍然显示，但后来我有了一个想法，让我们从帐户 A 注销，然后单击连接 facebook，果然我在帐户 A 内使用 facebook 所以我在没有通知用户的情况下接管了帐户，用户甚至不知道他已经连接了 facebook，因为按钮一直在显示。

id 不是一个秘密，我可以通过访问受害者的个人资料得到它，更糟糕的是，即使受害者连接了他们的 facebook，你也可以用这种方法覆盖它。

这不是我第一次得到一个错误，并最终发现攻击有效，你应该总是仔细检查。