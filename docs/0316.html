<html>
<head>
<title>Help — HackTheBox Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">帮助——黑盒子报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/help-hackthebox-writeup-20ef0acb6d82?source=collection_archive---------0-----------------------#2019-06-08">https://infosecwriteups.com/help-hackthebox-writeup-20ef0acb6d82?source=collection_archive---------0-----------------------#2019-06-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e00a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Help本周退役，它是比较容易的机器之一，有点令人沮丧，但我非常喜欢它，因为它迫使我阅读源代码。这个盒子包括通过提交票证选项从web服务器获得一个反向外壳，然后利用内核来找到它。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/347c866e346e3194328e4d335e8b37c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qjAKzCcFsrbJv-XTYjlGAA.png"/></div></div></figure><h2 id="1108" class="kr ks iq bd kt ku kv dn kw kx ky dp kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">让我们跳进来。</h2><h1 id="3906" class="ln ks iq bd kt lo lp lq kw lr ls lt kz jw lu jx ld jz lv ka lh kc lw kd ll lx bi translated"><strong class="ak">计数和侦察</strong></h1><p id="cbe0" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg la mh mi mj le mk ml mm li mn mo mp mq ij bi translated">和往常一样，让我们从一次<strong class="ma ir"> Nmap </strong>扫描开始</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/5d5a1e58f775f829daa80490d4b84f72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*leXH8GVWjKm9TDjLWdiJsA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated"><strong class="bd kt"> NMAP扫描</strong></figcaption></figure><p id="a212" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">看看结果，</p><blockquote class="nb nc nd"><p id="105e" class="ly lz ne ma b mb mw jr md me mx ju mg nf my mi mj ng mz ml mm nh na mo mp mq ij bi translated"><strong class="ma ir"> <em class="iq">我们看到端口22、80和3000都是打开的</em> </strong></p><p id="5b0b" class="ly lz ne ma b mb mw jr md me mx ju mg nf my mi mj ng mz ml mm nh na mo mp mq ij bi translated"><strong class="ma ir"> <em class="iq">端口22—</em></strong><strong class="ma ir"><em class="iq">OpenSSH</em></strong></p><p id="069e" class="ly lz ne ma b mb mw jr md me mx ju mg nf my mi mj ng mz ml mm nh na mo mp mq ij bi translated"><strong class="ma ir"> <em class="iq"> 80 —阿帕奇服务器</em> </strong></p><p id="58de" class="ly lz ne ma b mb mw jr md me mx ju mg nf my mi mj ng mz ml mm nh na mo mp mq ij bi translated"><strong class="ma ir"> <em class="iq"> 3000 — Node.js Express框架(看起来很有趣</em> ) </strong></p></blockquote><p id="22fe" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">查看80端口，我们看到这是Apache2服务器的默认页面。</p><p id="ec2e" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">在端口80上运行gobuster，会出现一个有趣的目录</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/042800ca29bef7af829634fe5285d3a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUjOuVMn5P6BFYvA4_ekGA.png"/></div></div></figure><p id="e97b" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">让我们检查一下我们在<strong class="ma ir"><em class="ne">http://10 . 10 . 10 . 121/support</em></strong>得到了什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/0f8009af6c5f988214286cf4d5bc3f1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PiaZgoxvNzoepfvg9jbKcw.png"/></div></div></figure><blockquote class="nb nc nd"><p id="ed1f" class="ly lz ne ma b mb mw jr md me mx ju mg nf my mi mj ng mz ml mm nh na mo mp mq ij bi translated"><em class="iq">这是一个helpdesz应用程序，快速的谷歌搜索显示</em><strong class="ma ir"><br/>helpdesz是一个基于PHP的免费软件，它允许你用一个基于网络的支持票系统来管理你的站点的支持。</strong></p></blockquote><p id="2ce9" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">我们有一个登录选项和一个提交票证的选项。让我们试着提交一张票。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/d63e292be2a5ec6f33fdd90637829d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCogAUQPzvUvfwphun638Q.png"/></div></div></figure><p id="f123" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">页面说<strong class="ma ir"> <em class="ne"> php </em> </strong>文件不允许(过滤旁路可能)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/3200737d13b581f19a00d61a3bf16073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TTCSEbwLnm0T5qj1mucXig.png"/></div></div></figure><p id="511f" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">这里更重要的一点是找到文件上传的位置。让我们看一下代码，因为它是一个开源应用程序。</p><p id="94ca" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated"><a class="ae nm" href="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php" rel="noopener ugc nofollow" target="_blank">https://github . com/evolution script/HelpDeskZ-1.0/blob/master/controllers/submit _ ticket _ controller . PHP</a></p><div class="nn no gp gr np nq"><a href="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/submit_ticket_controller.php" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">evolutionscript/HelpDeskZ-1.0</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">通过在GitHub上创建一个帐户，为evolutionscript/HelpDeskZ-1.0的开发做出贡献。</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe kp nq"/></div></div></a></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/e62196cdabf3e0d601daac6ec3915cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SIP7RmLbBU92jeQjDXxurg.png"/></div></div></figure><blockquote class="nb nc nd"><p id="be95" class="ly lz ne ma b mb mw jr md me mx ju mg nf my mi mj ng mz ml mm nh na mo mp mq ij bi translated">查看代码，我们看到一个md5在上传的文件名上运行，文件名后面附加了<strong class="ma ir"> time() </strong>函数<strong class="ma ir"> </strong>。尽管如此，我们还是看到一条错误消息，指出不允许使用文件类型。但是它实际上被上传了，我们看到的只是上传后的错误信息。(好看！！！)</p></blockquote><p id="e667" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">但是服务器在另一个时区<strong class="ma ir"> (GMT)。</strong>所以我不得不将服务器响应时间转换为epoch as，PHP time() <strong class="ma ir"> <em class="ne">函数返回当前时间，以Unix Epoch以来的秒数表示。</em>T50】</strong></p><p id="d95f" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">我在这里所做的只是在浏览器中点击提交按钮后从网络选项卡检查响应头(懒得在Burp中拦截请求)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/254506e3055c621c26bbe6fe48dbac1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wa8C9r8JABvRpNxgom1Eew.png"/></div></div></figure><p id="1c8f" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">在那里。【2019年6月07日05:52:14 GMT 为服务器响应时间。它对应的纪元是<strong class="ma ir"> 1559886734。</strong></p><p id="fb79" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">我使用【https://www.epochconverter.com/】做了转换</p><p id="c690" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">太棒了。我们拿到了时间戳和上传目录。忘了说，我已经上传了一个phpshell，是的，让我们得到我们的外壳。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/b702933243c3146c54e94d433285e26a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*-EKZAQP5H0UwfL87cAAA1g.png"/></div></div></figure><p id="1df2" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">这里“<strong class="ma ir">phpshell.php</strong>”是我们的文件名，附加在它后面的是Epoch中的服务器响应时间。</p><p id="80d2" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">我们的文件上传到<strong class="ma ir">http://&lt;HelpDeskBaseUrl&gt;/uploads/tickets/&lt;MD5&gt;。&lt;文件扩展名&gt;T13】</strong></p><p id="d8ce" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">为了抓住你的壳，不要忘记启动你的监听器。浏览至网址<br/><strong class="ma ir">http://10 . 10 . 10 . 121/support/uploads/tickets/04215397 f1 a 751 cf 60 d7e 42 fc 06 a 6767 . PHP</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/eaa363ad9cba71eb9c8ad4a20ae0629b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXyP3mYQRq4SKrkWcisTmg.png"/></div></div></figure><p id="a19a" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">Banggg！！有壳。</p><h1 id="f2dd" class="ln ks iq bd kt lo lp lq kw lr ls lt kz jw lu jx ld jz lv ka lh kc lw kd ll lx bi translated"><strong class="ak">权限提升</strong></h1><p id="f7bb" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg la mh mi mj le mk ml mm li mn mo mp mq ij bi translated">手动查看目录，我找不到任何有趣的东西。还运行<a class="ae nm" href="https://gist.github.com/jsvazic/8fe9dde369f6396f65a1aa795dd77744" rel="noopener ugc nofollow" target="_blank"> <strong class="ma ir"> procmon.sh ( Ippsec进程监控脚本)</strong> </a> <strong class="ma ir"> </strong>就白费了。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="8e52" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">像往常一样，我跑了<a class="ae nm" href="https://github.com/rebootuser/LinEnum" rel="noopener ugc nofollow" target="_blank"> <strong class="ma ir"> LinEnum </strong> </a>也没看出有什么猫腻。但是，内核是旧的。我没有考虑使用内核漏洞的选项，因为这不是我们想要的方式。但是在这里内核漏洞是有意的方式。我继续开发内核。看看下面的内核版本。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/9827ad970bd1ca68e1f865d54bff9aec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TDu3cauIkealKDFbCdhcWw.png"/></div></div></figure><p id="f907" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">快速的谷歌搜索显示了一个权限提升漏洞。让我们在那里运行漏洞并获得root shell。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/b938af654d5b72f48c70f8c97fa1021b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1NuuuRO3VSBnYHl5rBHKGQ.png"/></div></div></figure><p id="35af" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">扎根并完成。如果你还没有，去拿你的旗子。</p><h1 id="3c70" class="ln ks iq bd kt lo lp lq kw lr ls lt kz jw lu jx ld jz lv ka lh kc lw kd ll lx bi translated"><strong class="ak">附加</strong></h1><h2 id="e163" class="kr ks iq bd kt ku kv dn kw kx ky dp kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">端口3000 — Node.js Express框架</h2><p id="3f18" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg la mh mi mj le mk ml mm li mn mo mp mq ij bi translated">检查3000端口时，我们收到了一个JSON响应。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/52daae4ea2494c3d0da138da97247133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*obgyDgzZJwyvc1fnYkiDhQ.png"/></div></div></figure><p id="79fd" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">嗯，也许我们得到了一个潜在的用户名<strong class="ma ir"> ( Shiv ) </strong>。让我们把它放在后面的口袋里，并列举更多。</p><p id="28c1" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">Page说，我们必须用一个给定的查询来获得可信度。我的一个朋友告诉我，它使用的是<strong class="ma ir"> GRAPHQL </strong>，是<a class="ae nm" href="https://en.wikipedia.org/wiki/Representational_state_transfer" rel="noopener ugc nofollow" target="_blank"> <strong class="ma ir"> REST </strong> </a>的替代品。而GraphQL中的端点是<strong class="ma ir"> /graphql </strong></p><h2 id="2fdb" class="kr ks iq bd kt ku kv dn kw kx ky dp kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">而且网址是http:// <site> /graphql？query={query}</site></h2><p id="4f66" class="pw-post-body-paragraph ly lz iq ma b mb mc jr md me mf ju mg la mh mi mj le mk ml mm li mn mo mp mq ij bi translated">经过大量的试验和错误。我设法得到了正确的查询。</p><p id="6d17" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated"><a class="ae nm" href="http://10.10.10.121:3000/graphql?query={user{username,password" rel="noopener ugc nofollow" target="_blank">T1】http://10 . 10 . 10 . 121:3000/graph QL？查询= {用户名，密码 </a> <strong class="ma ir"> }} </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/a791df61fe98ad0b833ee1018ae3641b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frdisNop_jU6VplpyKjmZw.png"/></div></div></figure><p id="17ef" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">使用这些凭证(当然是在破解散列之后)登录到HelpDeskz应用程序，其余一切都是一样的。在野外也有同样的开发，虽然他们需要一些编辑，但我会把它们留给你去尝试。</p><p id="2142" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated">请随时提交任何反馈。</p><p id="f0fe" class="pw-post-body-paragraph ly lz iq ma b mb mw jr md me mx ju mg la my mi mj le mz ml mm li na mo mp mq ij bi translated"><strong class="ma ir">感谢并快乐黑客，<br/>Preetham(</strong><a class="ae nm" href="https://www.hackthebox.eu/profile/9160" rel="noopener ugc nofollow" target="_blank"><strong class="ma ir"><em class="ne">@ cyber 01</em></strong></a><strong class="ma ir"><em class="ne"/>)</strong></p></div></div>    
</body>
</html>