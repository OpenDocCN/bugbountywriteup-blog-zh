<html>
<head>
<title>Horizontall: HackTheBox Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">horizontal:HackTheBox演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/horizontall-hackthebox-walkthrough-13090d7d59a2?source=collection_archive---------0-----------------------#2021-10-16">https://infosecwriteups.com/horizontall-hackthebox-walkthrough-13090d7d59a2?source=collection_archive---------0-----------------------#2021-10-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5353" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">描述</h2></div><p id="d56b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Horizontall是HackTheBox上另一个不错的盒子。只需在/etc/hosts文件中添加horizontall.htb，就可以开始了。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/e62f571b9df1c8dad5c2218945b62957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OlJvn-AFsPCpltxQ1801GQ.jpeg"/></div></div></figure><blockquote class="lq lr ls"><p id="3db3" class="ki kj lt kk b kl km ju kn ko kp jx kq lu ks kt ku lv kw kx ky lw la lb lc ld im bi translated">端口扫描</p></blockquote><p id="08ae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我的端口扫描过程中，我首先使用<a class="ae lx" href="https://tryhackme.com/room/rustscan" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> rustscan </strong> </a>快速找出开放端口的数量…</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ly"><img src="../Images/04c9b9a1fa2e0373646b7601f8ccb6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MizVm-eAkVYcZy5B41yFQw.png"/></div></div></figure><p id="eafd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">…然后在那些开放的端口上开始详细的<strong class="kk iu"> Nmap </strong>扫描。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lz"><img src="../Images/f8b280c820ae341ae4def20dd0d428a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JbXXBYGjdQsXVdsJonjw8Q.png"/></div></div></figure><blockquote class="lq lr ls"><p id="03fc" class="ki kj lt kk b kl km ju kn ko kp jx kq lu ks kt ku lv kw kx ky lw la lb lc ld im bi translated">网络侦察</p></blockquote><p id="d501" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们先列举一下80端口。索引页如下所示。页面源代码不包含任何有用的内容。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ma"><img src="../Images/5fb4f115cb55f0562ed93eeaae3e56b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-UDRkvtIup-JezwWrVevRQ.png"/></div></div></figure><p id="6be4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们开始对URL→<a class="ae lx" href="http://writer.htb/" rel="noopener ugc nofollow" target="_blank">http://horizontall.htb/</a>进行<strong class="kk iu"> ffuf </strong>扫描</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mb"><img src="../Images/1d7440675d634a0faf4da10ca7cd7818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YHhvq2lSd0wq8Sxbn5kDEQ.png"/></div></div></figure><p id="4a9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以上都没有用。我尝试的下一件事是使用wfuzz工具枚举子域。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mc"><img src="../Images/09cccbce27e412048ffbc33f02d14ab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyLpE0WkZfRi4eJvlnsBtg.png"/></div></div></figure><p id="91db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们得到了一个子域，让我们访问它，看看我们能得到什么有用的东西。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi md"><img src="../Images/b51a72dcdb0c7413b75aaf88826e7861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*YeQV_Y-2WgX-HVx4UFnUOQ.png"/></div></figure><p id="d57b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以这里也没有什么有用的，但我再次试图列举任何隐藏目录的FQDN。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi me"><img src="../Images/46c1e935e6ad6ef5423d30471f90b1c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z0ioZlxUkFEuvKYPixNTOA.png"/></div></div></figure><p id="4b9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们到了目录，其中有一个strapi CMS的登录页面。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mf"><img src="../Images/8865afac6bd7e095a1b0168e2d5cdb82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMbk_5kWe9CTxPM4OorGIg.png"/></div></div></figure><p id="c9ee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谷歌搜索strapi登录的默认凭证显示admin: admin，但在这里没有用。接下来，我试图搜索该CMS可用的任何公开漏洞，我得到了这个远程代码执行<a class="ae lx" href="https://www.exploit-db.com/exploits/50239" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">漏洞</strong> </a> <strong class="kk iu"> </strong>但不确定，因为我还不知道版本。</p><p id="6478" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该漏洞很简单，我们必须提供网址(子域一)，脚本会告诉使用CMS版本第一，如果该版本是等同于“3 . 0 . 0-测试版17.4”，然后利用将工作。在下一个password_reset()函数中，漏洞试图重置用户“admin”的密码，并为我们提供带有新凭证的JSON Web令牌。</p><p id="8198" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，基本上我们有一个JSON web令牌，用于在双方之间共享安全信息，并在保护API方面变得越来越流行。<a class="ae lx" href="https://www.akana.com/blog/what-is-jwt" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> JWT </strong> </a>有类似x.y.z的格式，回来利用我们可以通过访问这个URL→<a class="ae lx" href="http://api-prod.horizontall.htb/admin/auth/reset-password" rel="noopener ugc nofollow" target="_blank">http://[子域]. horizontal . htb/[发现路径]/auth/reset-password </a>来确认这个密码剩余路径</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mg"><img src="../Images/a87418dd7bff3e11ddf5afdd9583b8e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AIAtUN0e2Blz13lXCrEIig.png"/></div></div></figure><p id="254d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后一个函数code_exec(cmd)用于触发RCE，但是我们没有得到已经提到的交互式shell。样本输出。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mh"><img src="../Images/a7dbd725f3dd775ae58d05a1564c5586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UbKY7bJOi1gswtxPhErPnQ.png"/></div></div></figure><p id="81de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在当前的漏洞利用中，提到了两个CVE，因此第一个<a class="ae lx" href="https://www.cybersecurity-help.cz/vulnerabilities/22788/" rel="noopener ugc nofollow" target="_blank"> CVE-2019-18818 </a>基于我们已经做过的弱密码恢复，对于下一个<a class="ae lx" href="https://www.cybersecurity-help.cz/vdb/SB2019120606" rel="noopener ugc nofollow" target="_blank">CVE-2019–1609</a>RCE，我们必须找到漏洞利用代码。再次谷歌我能够找到<a class="ae lx" href="https://github.com/dasithsv/CVE-2019-19609/blob/main/exploit.py" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">漏洞</strong> </a>。</p><blockquote class="lq lr ls"><p id="7a4c" class="ki kj lt kk b kl km ju kn ko kp jx kq lu ks kt ku lv kw kx ky lw la lb lc ld im bi translated">获得初始访问权限</p></blockquote><p id="04ae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，对于这个漏洞，我们必须按照<subdomain.horizontall.htb>、<kali_ip>、<jwt earlier="">、&lt;<a class="ae lx" href="http://api-prod.horizontall.htb/" rel="noopener ugc nofollow" target="_blank">http://subdomain.horizontall.htb/</a>&gt;的顺序传递输入，漏洞设置一个“数据”变量，在端口“9001”上附加反向外壳，并在头部分发布带有jwt令牌的数据。</jwt></kali_ip></subdomain.horizontall.htb></p><p id="ef8c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在运行漏洞之前，只需在新终端的端口9001上启动一个nc监听器。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mi"><img src="../Images/3870716d9349359bf56f82405b6f7775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lf-lRimeaDZPto8KAfnLcA.png"/></div></div></figure><p id="bc23" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们以用户strapi身份进行远程访问，并使用这个"<strong class="kk iu">python 3-c ' import pty；pty.spawn("/bin/bash")' </strong>"。</p><p id="6988" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用这个"<strong class="kk iu">find/-type f-user strapi-perm 600 2&gt;/dev/null</strong>命令来查找任何具有读写权限的文件，我得到了路径"<strong class="kk iu"> /opt/strapi/。ssh/authorized_keys </strong>”。因为我们有写访问权，所以我们可以通过SSH附加我们自己的id_rsa密钥来获得访问权。</p><p id="bd75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用ssh-keygen创建id_rsa密钥，并将id_rsa.pub密钥复制到文件<strong class="kk iu"> /opt/strapi/。ssh/authorized _ key。</strong>将文件id_rsa的权限授予chmod 600 id_rsa。<strong class="kk iu"> </strong>现在通过SSH登录得到一个好看的shell。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mj"><img src="../Images/9fa75c8b2c37eb8212205d7c9521f52d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YozhWPaFkPhca3TQHYJrqA.png"/></div></div></figure><p id="8eef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此时，我们可以使用<a class="ae lx" href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">linPEAS</strong></a><strong class="kk iu"/>脚本，但是使用诸如‘netstat’，‘PS’，‘tcpdump’之类的命令进行检查总是有用的。所以使用netstat给了我</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mk"><img src="../Images/b165e64451d3ee6be58674addc880e60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kplHkBcXjwI5APtq16fupA.png"/></div></div></figure><p id="7b9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我试图找到MySQL的凭证，但没有得到任何凭证。其次，我使用<a class="ae lx" href="https://github.com/andrew-d/static-binaries" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">凿子</strong> </a>工具转发端口8000。为了让凿子进入远程机器，我使用了<a class="ae lx" href="https://github.com/sc0tfree/updog" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">更新</strong> </a>工具。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ml"><img src="../Images/b469aa5fd848a117cc03cc4f63677447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtYu4pYOqZRqeNWY9B6mFg.png"/></div></div></figure><p id="e967" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，要转发所需的端口，首先必须运行"<strong class="kk iu">。/chisel server-p[端口号] —在kali机器上反转&amp; </strong>”</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mm"><img src="../Images/6b967cb7713b89f88434d241250fbe8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L2M3hTun2lRaL4s7gyUrxA.png"/></div></div></figure><p id="8691" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">…然后运行"<strong class="kk iu">。/chisel client[kali _ IP]:[kali _ port]R:[port _ to _ listen _ connection]:127 . 0 . 0 . 1:[port _ to _ forward]</strong>"在攻击者框上。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mn"><img src="../Images/74a251511d9d13a7475bc09e47988609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2I_mzCZaAaAiUzj91dd-Uw.png"/></div></div></figure><p id="d435" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">访问网址→ <a class="ae lx" href="http://127.0.0.1:6001" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:6001 </a>在浏览器上访问转发端口8000。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mo"><img src="../Images/fa43db5ddbe301f86c882705e209212d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pyVHOK0g8HjBclnBkBXB6w.png"/></div></div></figure><p id="a462" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在这里没什么可做的，所以我只是谷歌“如何在端口转发后利用Laravel ”,得到了这个<a class="ae lx" href="https://book.hacktricks.xyz/pentesting/pentesting-web/laravel" rel="noopener ugc nofollow" target="_blank">页面</a>说<a class="ae lx" href="https://github.com/hungnt199/CVE-2021-3129_exploit" rel="noopener ugc nofollow" target="_blank">CVE-2021–3129。</a>因此，Laravel容易受到不正确输入验证的攻击，远程攻击者可以通过发送特制的请求来读取和写入系统上的任意文件。复制漏洞代码，并使用它来检查您是否可以执行任何命令。<strong class="kk iu">注意:- </strong>使用URL中转发端口8000的端口。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mo"><img src="../Images/a054b190bd8001672afcd9e4907cd97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jg_iZVhy5wOMVkOKJ1ECuQ.png"/></div></div></figure><p id="7bee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">获取根标志很容易，因为您必须使用cat命令代替whoami来读取标志。</p><h1 id="6203" class="mp mq it bd mr ms mt mu mv mw mx my mz jz na ka nb kc nc kd nd kf ne kg nf ng bi translated">在你走之前</h1><p id="cf63" class="pw-post-body-paragraph ki kj it kk b kl nh ju kn ko ni jx kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">这是我的另一个黑客机器演练:-</p><div class="nm nn gp gr no np"><a href="https://shubham-singh.medium.com/writer-hackthebox-walkthrough-1ff86b33799a" rel="noopener follow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd iu gy z fp nu fr fs nv fu fw is bi translated">编剧:黑客盒子演练</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">描述</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">shubham-singh.medium.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od lo np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://shubham-singh.medium.com/armageddon-hackthebox-walkthrough-6d8e2261a676" rel="noopener follow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd iu gy z fp nu fr fs nv fu fw is bi translated">世界末日:黑客盒子演练</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">描述</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">shubham-singh.medium.com</p></div></div><div class="ny l"><div class="oe l oa ob oc ny od lo np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://github.com/Mr-Lazzy" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd iu gy z fp nu fr fs nv fu fw is bi translated">懒人先生-概述</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">网络安全爱好者🐱‍💻。拉兹先生有7个存储库可用。在GitHub上关注他们的代码。</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">github.com</p></div></div><div class="ny l"><div class="of l oa ob oc ny od lo np"/></div></div></a></div><p id="f59d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">鼓掌👏如果你喜欢的话。</p></div></div>    
</body>
</html>