<html>
<head>
<title>ZIP Bombs 💣😈</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">拉链炸弹💣😈</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/zip-bombs-30337a1b0112?source=collection_archive---------1-----------------------#2020-10-28">https://infosecwriteups.com/zip-bombs-30337a1b0112?source=collection_archive---------1-----------------------#2020-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="06ef" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让您的存储爆炸💥</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c387d77199c1f7acd2bd6029ab5c49ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XBJzjz6OtOUwNoSL"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">斯蒂芬·拉德福德在Unsplash的照片</figcaption></figure><p id="d27f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Zip_bomb" rel="noopener ugc nofollow" target="_blank"> zip炸弹</a>是一个zip文件，它被设计成一旦解压缩就会占用大量空间。最著名的一个叫做<code class="fe lv lw lx ly b">42.zip</code>，大小为<code class="fe lv lw lx ly b"><strong class="lb iu">42kB</strong></code>。它包含递归嵌套的zip文件。在最底层，有一个单独的文件被解压缩到一个<code class="fe lv lw lx ly b">4.3GB</code>的大小。这个文件总共被添加到归档文件中超过一百万次，导致总解压缩大小为<code class="fe lv lw lx ly b"><strong class="lb iu">4.5PB</strong></code>。这远远超过了任何可用存储系统的大小。</p><blockquote class="lz"><p id="d3db" class="ma mb it bd mc md me mf mg mh mi lu dk translated">Zip炸弹是一种减压炸弹。解压炸弹是一种压缩文件，可以解压到一个疯狂的文件大小。解压炸弹是拒绝服务攻击的一种形式。</p></blockquote><p id="12a8" class="pw-post-body-paragraph kz la it lb b lc mj ju le lf mk jx lh li ml lk ll lm mm lo lp lq mn ls lt lu im bi translated">解包这样的档案会在各种系统中导致问题，这些问题都与内存或磁盘空间不足有关。例如，反病毒扫描程序可能会解压缩ZIP文件，从而由于内存耗尽而被杀死。后端服务器可能会填满其磁盘，并且不再能够运行。</p><h1 id="7c4f" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">如何创建一个ZIP炸弹</h1><p id="31bc" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">最简单的拉链炸弹超级容易制造。您可以简单地使用Python中的包:</p><pre class="kj kk kl km gt nl ly nm nn aw no bi"><span id="3316" class="np mp it ly b gy nq nr l ns nt">import os<br/>from tempfile import mkstemp<br/>from zipfile import ZIP_LZMA, ZipFile</span><span id="9206" class="np mp it ly b gy nu nr l ns nt">def create_txt_file(size_in_byte) -&gt; str:<br/>    handle, filepath = mkstemp(suffix=".txt", prefix="zip-txt-")<br/>    os.close(handle)<br/>    with open(filepath, "w") as fp:<br/>        fp.write("0" * size_in_byte)<br/>    return filepath</span><span id="a6ba" class="np mp it ly b gy nu nr l ns nt">def create_zipbomb(inner_file_size=10 ** 6, nb_inner_files=10):<br/>    filepath = create_txt_file(size_in_byte=inner_file_size)<br/>    with ZipFile("zipbomb.zip", "w", ZIP_LZMA) as myzip:<br/>        for i in range(nb_inner_files):<br/>            myzip.write(filepath, f"{i}.txt")<br/>            print(i)<br/>    os.remove(filepath)</span><span id="96df" class="np mp it ly b gy nu nr l ns nt">if __name__ == "__main__":<br/>    create_zipbomb(inner_file_size=10 ** 9, nb_inner_files=10)</span></pre><p id="e8c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大卫·费菲尔德也证明了用散列<code class="fe lv lw lx ly b">42MB</code>并以<strong class="lb iu">非递归</strong>方式提取到<code class="fe lv lw lx ly b">4.5PB</code>可以创建一个zip炸弹。</p><p id="2f3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">还有针对ZIP文件的查询。quine是一个将源代码作为输出的程序。解压缩时，ZIP-quine包含自身。一个比较知名的是<code class="fe lv lw lx ly b">droste.zip</code> ( <a class="ae ky" href="https://alf.nu/ZipQuine" rel="noopener ugc nofollow" target="_blank">来源</a>)，但是还有更多(<a class="ae ky" href="https://research.swtch.com/zip" rel="noopener ugc nofollow" target="_blank">来源</a>)。</p><p id="4239" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您也可以通过研究<a class="ae ky" href="https://www.iso.org/standard/60101.html" rel="noopener ugc nofollow" target="_blank">的ZIP标准</a>并制作文件来手动创建它们。</p><h1 id="db48" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">我应该担心吗？</h1><p id="e2fd" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我不会担心。正如特拉维斯·奥曼迪指出的，58个反病毒程序中有21个可以检测出zip炸弹。6个超时，11个无法处理文件，20个认为文件正常。</p><p id="78ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章更像是一个友好的提醒，提醒人们这种类型的攻击是存在的，并且在解压缩档案时应该小心。</p><p id="b8dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我在几个地方发现了这个话题:</p><ul class=""><li id="c140" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated">2005年:bzip2(<a class="ae ky" href="https://nvd.nist.gov/vuln/detail/CVE-2005-1260" rel="noopener ugc nofollow" target="_blank">CVE-2005–1260</a></li><li id="d1d2" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">2009年:Apache Tika ( <a class="ae ky" href="https://issues.apache.org/jira/browse/TIKA-259?attachmentSortBy=fileName" rel="noopener ugc nofollow" target="_blank">安全解析droste.zip </a>)</li><li id="d3e1" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">2018:阿卡(<a class="ae ky" href="https://nvd.nist.gov/vuln/detail/CVE-2018-16131" rel="noopener ugc nofollow" target="_blank">CVE-2018–16131</a></li><li id="c421" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">2019:Python(<a class="ae ky" href="https://nvd.nist.gov/vuln/detail/CVE-2019-9674" rel="noopener ugc nofollow" target="_blank">CVE-2019–9674</a>)</li><li id="6ab4" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">2019:Info-ZIP(<a class="ae ky" href="https://nvd.nist.gov/vuln/detail/CVE-2019-13232" rel="noopener ugc nofollow" target="_blank">CVE-2019–13232</a></li><li id="96cb" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">2019:ClamAV(<a class="ae ky" href="https://nvd.nist.gov/vuln/detail/CVE-2019-12625" rel="noopener ugc nofollow" target="_blank">CVE-2019–12625</a>)</li><li id="f335" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">2020年:Wireshark(<a class="ae ky" href="https://nvd.nist.gov/vuln/detail/CVE-2020-25866" rel="noopener ugc nofollow" target="_blank">CVE-2020–25866</a>)</li></ul></div><div class="ab cl oj ok hx ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="im in io ip iq"><h1 id="c3d5" class="mo mp it bd mq mr oq mt mu mv or mx my jz os ka na kc ot kd nc kf ou kg ne nf bi translated">在不提取数据的情况下获取ZIP文件的大小</h1><pre class="kj kk kl km gt nl ly nm nn aw no bi"><span id="32ee" class="np mp it ly b gy nq nr l ns nt">import zipfile</span><span id="b3e1" class="np mp it ly b gy nu nr l ns nt">def get_extracted_size(filepath: str) -&gt; int:<br/>    """Get the extracted size in bytes."""<br/>    zp = zipfile.ZipFile(filepath)<br/>    return sum([zinfo.file_size for zinfo in zp.filelist])</span></pre><p id="e777" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很简单，不是吗？</p><p id="e2b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问题是你可以嵌套ZIP文件。因此提取的文件可以再次包含压缩文件。如果您应用递归，您可能希望有一个最大的递归深度，并跟踪使用的内存/磁盘空间。</p></div><div class="ab cl oj ok hx ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="im in io ip iq"><h1 id="238c" class="mo mp it bd mq mr oq mt mu mv or mx my jz os ka na kc ot kd nc kf ou kg ne nf bi translated">反病毒软件的现状</h1><p id="8076" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我很好奇，想知道杀毒软件能不能检测zip炸弹。所以我测试了一些并联系了一些开发者。</p><h2 id="c477" class="np mp it bd mq ov ow dn mu ox oy dp my li oz pa na lm pb pc nc lq pd pe ne pf bi translated">病毒总数</h2><p id="0b27" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">Virustotal提供了一个表格，用户可以上传文件并查看各种程序的结果。以下是我的测试文件的结果:</p><ul class=""><li id="8688" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated"><a class="ae ky" href="https://www.virustotal.com/gui/file/bbd05de19aa2af1455c0494639215898a15286d9b05073b6c4817fe24b2c36fa/detection" rel="noopener ugc nofollow" target="_blank"> 42.zip </a>:只有<a class="ae ky" href="https://en.wikipedia.org/wiki/Fortinet" rel="noopener ugc nofollow" target="_blank"> Fortinet </a>检测到了。12个程序无法处理它。</li><li id="7133" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated"><a class="ae ky" href="https://www.virustotal.com/gui/file/ad187b3c99dcaa837438d580a3886f67ac1799e475e8fced23a02fb44ebaf41f/detection" rel="noopener ugc nofollow" target="_blank"> dorste.zip </a> : <a class="ae ky" href="https://en.wikipedia.org/wiki/Avast" rel="noopener ugc nofollow" target="_blank"> Avast </a>、<a class="ae ky" href="https://en.wikipedia.org/wiki/AVG_AntiVirus" rel="noopener ugc nofollow" target="_blank"> AVG </a>、Cyren、<a class="ae ky" href="https://en.wikipedia.org/wiki/ESET" rel="noopener ugc nofollow" target="_blank"> Eset </a>、<a class="ae ky" href="https://en.wikipedia.org/wiki/Sophos" rel="noopener ugc nofollow" target="_blank"> Sophos </a>、<a class="ae ky" href="https://en.wikipedia.org/wiki/Trend_Micro" rel="noopener ugc nofollow" target="_blank">趋势科技</a>检测到了。10个程序无法处理该文件。</li><li id="f0b8" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated"><a class="ae ky" href="https://www.virustotal.com/gui/file/725d25f1f5ecf498210c546d517e25f70ea07b48423de2a4648db80b56b81f56/detection" rel="noopener ugc nofollow" target="_blank">自建. zip </a>:安天-AVL，百度，MAX检测到了。7超时。11人无法处理。</li></ul><h2 id="be0f" class="np mp it bd mq ov ow dn mu ox oy dp my li oz pa na lm pb pc nc lq pd pe ne pf bi translated">ClamAV</h2><p id="a838" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">ClamAV第一次发布是在2001年，由思科开发，现在是开源的。我已经安装了<code class="fe lv lw lx ly b">ClamAV 0.102.4/25962</code>。我试着用<a class="ae ky" href="https://pypi.org/project/clamd/" rel="noopener ugc nofollow" target="_blank"> clamd </a>装订:</p><pre class="kj kk kl km gt nl ly nm nn aw no bi"><span id="fb9c" class="np mp it ly b gy nq nr l ns nt">import clamd<br/>cd = clamd.ClamdUnixSocket()<br/>cd.scan('/home/moose/bomb.zip')</span></pre><p id="a476" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它对<code class="fe lv lw lx ly b">droste.zip</code>、<code class="fe lv lw lx ly b">42.zip</code>和我的<code class="fe lv lw lx ly b">self-built.zip</code>给出了相同的输出。都没有检测出来。</p><h2 id="5ed3" class="np mp it bd mq ov ow dn mu ox oy dp my li oz pa na lm pb pc nc lq pd pe ne pf bi translated">商业反病毒软件</h2><p id="b0fe" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">我已经通过私人Twitter消息联系了Avast、AVG、ESET、Sophos和趋势科技。我已经解释过，我正在写一篇博文，而且根据VirusTotal的说法，他们的产品不能识别ZIP炸弹。</p><p id="870d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">趋势科技</strong>将我发送到他们的<a class="ae ky" href="https://helpcenter.trendmicro.com/en-US/contact-support/" rel="noopener ugc nofollow" target="_blank">支持站点</a>。我想我给他们写了一张支持票，但是由于这只是一个网络表单，我没有任何副本，所以我不确定。那些联系方式超级烦人，我放弃了去问这个问题。</p><p id="0a9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Sophos把我重定向到他们的支持网站。我已经立案了，正在等待回复。</p><p id="00cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Avast 给了我一个简短的回答，但是我超级不清楚他们到底在做什么。我还在努力澄清。</p><p id="9f7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AVG 回应道，但本质上是告诉我，他们试图在内部找到我的问题的答案。</p><p id="7178" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">相比之下，对ESET的体验是非常积极的。我已经联系了<a class="ae ky" href="https://www.linkedin.com/in/thomas-uhlemann-6661a382/" rel="noopener ugc nofollow" target="_blank"> Thomas Uhlemann </a>，他可以直接告诉我ESET正在做什么:他们检查档案直到深度10，这意味着他们可以限制递归打包的效果。此外，它们还对文件大小、内存使用和扫描的最长时间进行了限制。显然，用户也可以调整这些限制。这个信息也被<a class="ae ky" href="https://help.eset.com/eis/14/en-US/idh_config_threat_sense.html" rel="noopener ugc nofollow" target="_blank">公开记载</a>。</p><h1 id="8461" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">下一步是什么？</h1><p id="332e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在这个关于应用安全(AppSec)的系列文章中，我们已经解释了攻击者的一些技术😈以及防守队员的技术😇：</p><ul class=""><li id="ab68" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated">第1部分:<a class="ae ky" href="https://medium.com/faun/sql-injections-e8bc9a14c95" rel="noopener"> SQL注入</a>😈</li><li id="c26e" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">Part 2: <a class="ae ky" href="https://levelup.gitconnected.com/leaking-secrets-240a3484cb80" rel="noopener ugc nofollow" target="_blank">不要泄密</a>😇</li><li id="e5b6" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">第3部分:<a class="ae ky" href="https://levelup.gitconnected.com/cross-site-scripting-xss-fd374ce71b2f" rel="noopener ugc nofollow" target="_blank">跨站点脚本(XSS) </a>😈</li><li id="da1b" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">第4部分:<a class="ae ky" href="https://levelup.gitconnected.com/password-hashing-eb3b97684636" rel="noopener ugc nofollow" target="_blank">密码哈希</a>😇</li><li id="25cb" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">第5部分:ZIP炸弹😈</li></ul><p id="8b9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这即将到来:</p><ul class=""><li id="aa15" class="nv nw it lb b lc ld lf lg li nx lm ny lq nz lu oa ob oc od bi translated">CSRF😈</li><li id="f080" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">磁盘操作系统😈</li><li id="5f49" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">凭据填充😈</li><li id="44ef" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">密码劫持😈</li><li id="1e4a" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">单点登录😇</li><li id="6d48" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">双因素认证😇</li><li id="d960" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">备份😇</li><li id="dd07" class="nv nw it lb b lc oe lf of li og lm oh lq oi lu oa ob oc od bi translated">磁盘加密😇</li></ul><p id="813c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你对更多的文章感兴趣，请告诉我！(info@martin-thoma.de)</p></div></div>    
</body>
</html>