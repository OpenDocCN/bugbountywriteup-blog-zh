# FOSS:一个穷人的安全分析架构。

> 原文：<https://infosecwriteups.com/foss-a-poor-mans-security-analysis-architecture-9c03899b5933?source=collection_archive---------0----------------------->

老实说，这篇文章并没有涵盖为您的中小型企业构建安全环境的自由和开源软件的全部内容，但是也做出了努力。

> 社区是一个巨大的资源。

这是我的第一篇文章，我试图展示我自己在构建我的安全分析架构方面的经验，我已经为自己的创业公司建立了架构。

# 恶意软件分析实验室

我想为恶意软件和安全分析实验建立一个足够好的平台。

我开始寻找市场上不同的解决方案和产品，但老实说，大多数想法都因为缺乏足够的资金而被否决了。

这并没有使我陷入困境，我决定自己继续前进。我从我的 IT 管理员那里拿出一台服务器级机器和几台工作站终端，决定试一试。

服务器有相当大的 16 GB 内存和一些可用存储空间。

Windows server 2012 及更高版本，虽然对我来说这是一个大材小用的选择。购买 VMWare EXSI 对我们来说太贵了。

我环顾四周，找到了 XEN SERVER，这是一个由 CISCO 开发的基于 Linux 的虚拟机管理程序，它本身包含了许多功能，我立即知道这就是我要找的东西。Xen 服务器的社区版本也是免费的。

XEN 为我提供了 6 个 VM 实例，也给了我一个不错的测试环境。

# 与 FLARE VM 的约会

我的团队收到的工作站支持 virtual box 和 VMWARE player。

虽然 VMWare Workstation 提供了强大的功能，但我没有足够的资金来购买它，所以我决定继续使用 Virtual Box。工作站上的基本操作系统是 Ubuntu 18.04，这是我一直以来最喜欢的 Linux 版本。

随着 Virtual Box 的启动，我带来了各种 windows 操作系统的开发者版本，我将在其中测试我收到的恶意软件。

微软为大多数操作系统平台免费提供 180 天的开发者许可。它们非常适合测试。

我在 virtual box 上启动了几个虚拟机，并根据我的需求对它们进行了调整。

然后我学习了 flare VM，这是一套由 Fireye 策划的高性能工具，需要大约 30 分钟来设置 50 Mbps 的连接，我决定尝试一下。

> 太棒了

当我第一次看到包装在里面的工具时，这是一个迷人的景象。

我听说过的任何用于分析的东西都已经在那里了。因为。net 它有 DNSpy，de4dot，Ghidra 几乎什么都有。它还打包了逆转新老恶意软件语言 Delphi 的工具。调试器的选择包括 xDBG 和 WinDbg。该平台使用 chocolatey 框架来获取软件，该软件是 windows 上的 apt / yum。是不是很酷？

# 设置环境

我在分析工作站上需要的环境主要是运行 Flare VM 的 windows 互连虚拟机、主机上的 wireshark /tcpdump 和 remnux。

一个工作站就能支持所有这些，所以我就继续做了。

数据进入开始了，我建立了一个实验室来测试这些机器上的恶意软件，但是我在 3 个月的时间里收集了一些数据，它的管理成了一个问题。

# 用 MISP 和杜鹃构建关联引擎

我向 GitHub 求助。

尝试了一些产品，如 Maltego 社区版，Yeti 平台和一些更多，但我的信仰在于 MISP 框架。

MISP 是一个恶意软件威胁情报、共享和关联平台，现在由卢森堡计算机事件响应中心(CIRCL)维护，而且它本质上是基于 python 和 PHP 构建的。当我从事调查工作时，我发现需要将某些对象合并到框架中，于是我开发了它们。对相同对象的拉取请求立即被接受，这些对象现在构成了主存储库的一部分。该项目的维护者即将到来，文档也很棒。

到目前为止，我已经花了一些时间进行分析，在 MISP git 上提供的示例的帮助下，我编写了一些定制的 python 脚本，并且很快就开始运行了。

这是我们扩大团队的时候了，现在我在 MISP 上添加了另一个组织，文档帮助我设置了邮件和其他功能，如威胁源。

我还能够为 MISP 的自动化任务编写一些脚本，这些脚本作为补充提供。

随着时间的推移，我们能够为我们的客户生成一个伟大的威胁图片。

然后，我们决定自动化一些基本测试，从而在我们的服务器上设置一个 cuckoo 沙箱。Cuckoo 及其 python 底层代码提供了真正的控制，并与 xen 和 MISP 完美集成。这有助于我们关联威胁情况，并为编写 Yara 规则提供必要的时间。

# 迁移到 GitLab 以实现安全存储

在对我们产生了信任之后，我们的第一个客户向我们提供了某些 red teaming 项目，甚至是代码审计。我们在那里也很慢。

对于 red teaming 项目，我们再次开源，主要使用 Kali Linux、突击队 VM 和数据共享设置 Dradis 实例。

> Dradis 因其古怪的本性而伟大。

但是客户总是需要更多，缺乏视觉化。随着对 MISP 的信任和熟悉，我们决定修改它。在这里和那里做了一些调整，一些脚本和 viola，我们很快就有了一个红队数据协作框架。

我们制作和维护的脚本已经被我们的一些开发者推送到 GitHub 上，但有时我们需要一个更私人的存储。我们从未购买 GitHub 的付费订阅来托管我们的私人回购，而是在我们的服务器上启动了 gitlab 的一个实例。

这就是我们，我们有自己的 repos，可以用来工作和分享。我们甚至能够将脚本与我们的红队协作 MISP 实例集成起来，只需要一点点 git 拉力就可以实现自动化。

# 试验 CI/CD 和自动开发操作

> 接下来是代码审计。

我们必须让一些团队和客户给我们发代码来审查(主要是网站)。这个过程是漫长的，我们需要通过邮件或某些其他媒体来接收它们。但后来我们自己的 gitlab 又来救援了。

我们能够将我们托管的 gitlab 扩展到我们的客户，现在他们可以直接在我们的 prem 上推送他们的代码。

我们目前正致力于将 Gitlab 实例与 Gitlab Runner、dockers 和 kubernets 集成在一起，这样我们就能够编写测试用例，使用自动化测试我们客户的代码安全性。

这个想法是有一个设置，其中我们可以自动化的安全测试环境，我们正在编写测试用例的自动化测试功能，如 SQL 注入，XSS，IDOR 和提供的代码更多。

一旦提交了代码，环境就会启动一个实例，进行基本测试并提供结果，然后团队可以分析并缩短环境设置和基本检查的时间。

# 使用 tiaga 进行项目管理

随着团队规模和工作量的增加，我们会不时地面临项目管理的问题。工作流程以前是用 Excel 管理的，是的，是非常好的老式 Microsoft Excel。但随后它很快就变得杂乱无章，无法应付最后期限和管道。我们在团队的工作环境中混合了瀑布和敏捷。

为了更好的管理，我们决定改用看板，在未来的日子里，我们会喜欢它的。白板很棒，我们希望保持这种棒。看板非常完美，我们开始寻找优秀的内部看板解决方案。

有人建议我们给泰加一个机会，结果证明是完美的。它与我们内部的 Zimbra mail 整合在一起，gitlab 和 MISP 也是如此。我们在那里。

taiga 的特性给了我们更好的管理和对工作流程的控制。我们能够实时创建和管理问题。Assignment 和 todos 集成到 taiga 和 gitlab 中，这对我们帮助很大，更重要的是，这一切都是免费的。

# 与 rocket.chat 通信

为了团队之间的交流，我们设置了良好的旧 slack 通道，并将其与我们的 Gitlab、taiga 和所有良好的开源软件集成在一起。但是它不是免费的。它不支持查看超过 10000 条消息，所以我们决定转向 Rocket Chat。

该软件也是开源的，可以从 rocket 免费获得。聊天和集成很简单，也很优雅。它基于 Python 和 Node JS，这使得它在设计上非常棒。

它像 slack 一样使用 Rest API 进行集成，并且是免费的。

# 构建教程和文档

与大小团队一起工作，我们需要在旅途中生成一定量的文档和教程。我们的员工需要学习很多东西，从 Gitlab 和 git 语法的使用开始，习惯于围绕令人敬畏的 MarkDown 格式打字，等等。

我们决定进入 Gitlab 页面。我们目前正在 gitlab 上移动我们的东西，以便我们的团队可以在内部为他们的脚本、软件和环境设置设置 tut 和 docs。

# 建设我们自己的 NMS

随着年龄的增长，腿的长度会增加。我们现在正在试验很多开源的东西来建立我们自己的网络和资产管理系统。随着我们现在拥有的资产数量的增加，内部审计和资产管理需求也在增长。

# 结论

当一切都设置好并开始运行时，我打算坐在一张舒适的椅子上，盯着我的服务器机架，惊叹不已。我希望这很快会发生。

开源软件很棒，对于初创公司，我建议使用所有的自由/开源软件，因为它为你提供了必要的控制和修改的灵活性。

我们看到我们的朋友和竞争对手抱怨坚持使用特定的产品和技术，然后无法迁移，因为迁移的工作量很大，因此他们的服务最终很昂贵，有时是多余的，因为他们不了解他们使用的产品的本质，但我们的开源环境教会我的一件事是，了解我们使用的任何产品或技术的底层技术， 帮助我们成长为一个书呆子组织，并确保整个团队足够书呆子，无论是管理层还是员工，这就是我们的优势所在。

当你犯了一个错误时，你总是可以重新开始或重置，但是学习和成长从一开始就是我们的座右铭。

现在，我们确切地知道我们在寻找什么，以及一个产品是否值得付出努力和成本，这一点有时是我们的竞争对手所缺乏的。

> “更令人满意的是，我们可以回馈社会”

*关注* [*Infosec 报道*](https://medium.com/bugbountywriteup) *获取更多此类精彩报道。*

[](https://medium.com/bugbountywriteup) [## 信息安全报道

### 收集了世界上最好的黑客的文章，主题从 bug 奖金和 CTF 到 vulnhub…

medium.com](https://medium.com/bugbountywriteup)