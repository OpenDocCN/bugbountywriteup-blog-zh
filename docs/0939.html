<html>
<head>
<title>Unlimited Balance in an Online Transportation Application Account</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在线运输应用程序帐户中的无限余额</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/unlimited-balance-in-an-online-transportation-application-account-1dd042f678a9?source=collection_archive---------3-----------------------#2020-11-08">https://infosecwriteups.com/unlimited-balance-in-an-online-transportation-application-account-1dd042f678a9?source=collection_archive---------3-----------------------#2020-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e4c827454bf3ac4057310801fb248763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_0a1OC2c4V57_vnMkQokqw.jpeg"/></div></div></figure><p id="3807" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在一个著名的在线交通应用程序和它的PWA服务上冲浪。过了一会儿，我注意到支付网关模块中有一个严重的漏洞。让我来解释一下这个场景。</p><p id="cf88" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一步，你应该输入你的手机号码，然后它会发送一个动态口令来验证你的手机。接下来，我试图增加我的帐户余额，我选择10，000的金额，然后单击支付按钮。第一个请求如下:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/f0f9989066657e1e3ba67727898817d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3LwFPpCLmISSIQZiTHkBw.jpeg"/></div></div></figure><p id="cad6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">答案是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/bc23c5e6b92339b7d89147cfd62a2ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pSzkQyju4wMu5PCWwsE_6w.jpeg"/></div></div></figure><p id="7cb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我尝试更改BurpSuite中的金额，将其从10，000增加到20，000，000。要求是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/cbeab952a4503d37ceac50fe5fedb4b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5PFq_RoNf0Q3L9AxwIJFpg.jpeg"/></div></div></figure><p id="8bf9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回应是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ld"><img src="../Images/3ec1157dd746022b3bfb3a3656457c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rZZISAZqLUOImNecmuzynQ.jpeg"/></div></div></figure><p id="6c97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的。我记住了第二次响应的"<strong class="ka ir"> 1EyTR528855989" </strong>值，并继续第一次请求和10，000金额的支付流程。然后它重定向我到支付网关页面，我支付金额。要求是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi le"><img src="../Images/61a6597183b09e4ed0d45d37b6284ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mmEEh3TWLKbsIrbS02KoQg.jpeg"/></div></div></figure><p id="54a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，请求返回到应用程序，以检查并确定支付的金额是为了增加我的余额。要求是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/3fb1c84358a71d530e7ecdf9a670946e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xi0GMVbyKEQBfdlhoiOYQg.jpeg"/></div></div></figure><p id="65c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">真好。我将providerId参数值更改为<strong class="ka ir"> 1EyTR528855989。</strong>该值是我在响应中将金额从10，000更改为20，000，000时获得的值。然后我将请求转发给服务器。非常好。10，000英镑支付成功，我的帐户余额增加到20，000，000英镑。</p><p id="0864" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">这个漏洞的原因是什么？</strong></p><p id="7e5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">增加帐户余额的业务逻辑是，用户被重定向到IPG，其中包含支付的信息和金额，并执行交易。然后将它返回给应用程序，其中包含确认操作身份的信息，应用程序将从用户处接收到的操作身份发送给后台的IPG，并检查操作的状态，最后将交易金额添加到用户帐户中。<br/>当应用程序从支付网关收到交易状态时，支付金额、交易号、参考号、状态、支付时间等信息。都收到了。该应用基于支付网关接收的信息增加账户余额。在某些情况下，网站在交易中依赖用户返回的信息，如金额。在这种情况下，攻击者可以拦截请求并更改金额，然后将其转发到网站，最后金额被应用到他的帐户。<br/>在某些情况下，应用程序存储交易ID、金额等信息。以确定从支付网关返回到网站的交易的状态。当在数据库中创建该记录时，其状态未知，并被设置为初始。当交易从支付网关返回时，它会将其状态更改为失败或成功。<br/>这个问题的安全问题是攻击者创建了两个请求。一个请求是一笔金额为20，000，000的交易，然后丢弃它。复制该记录的交易ID。然后创建另一笔金额为10，000的交易，该交易被发送到IPG并被支付。当这个请求从IPG返回到应用程序时，这个请求的事务ID被被丢弃的请求的事务ID替换。</p><p id="8b69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于没有在交易的后台检查金额值，所以它被认为是成功的，并且攻击者可以通过支付10，000以20，000，000的金额向他的帐户收费。</p><p id="c96b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:该漏洞已被修补，本文仅供研究和学习之用。</strong></p></div></div>    
</body>
</html>