# JSON 逃到野外(10 分钟 XSS)

> 原文：<https://infosecwriteups.com/json-escaping-out-in-the-wild-the-10-minutes-xss-70db21fb6c6e?source=collection_archive---------0----------------------->

*注:以下文章发表于 2016 年 13 月 2 日*[*【https://FogMarks.com】*](https://fogmarks.com/2016/02/13/json-escaping-out-in-the-wild/)

![](img/c462ec75fba3355adf65c607afe1695f.png)

> 这个案例研究关注 JSON 的核心方面和实用程序，特别是它的转义方法。

oundCloud.com 和其他许多公司一样，使用 JSON 从服务器获取用户相关信息。这个想法很简单，服务器首先向客户端发送 HTML(以及 javascript、CSS、图片等)，然后 Javascript 代码使用 AJAX 从服务器获取数据。

在这种情况下，来自服务器的数据以 JSON 格式返回，javascript 代码知道如何解析它并将数据插入页面的正确位置。
返回的数据(可能)被 JSON 转义机制转义，所以任何恶意的有效负载都不会起作用。

这里应该问的主要问题是:我们可以利用浏览器获取数据的方式吗？我们能让它获取任意的 HTML 或 Javascript 代码吗？

嗯，简单的回答是否定的。
长的回答(**开始这项研究后 10 分钟**)是肯定的。

起初，我决定把重点放在通知区域(https://soundcloud . com/notifications)，在那里我注意到当滚动完成时 AJAX 请求正在被执行(以获取旧的通知)。

我之前在 SoundCloud 的不同位置插入了一些有效载荷，并分析了 AJAX 请求更多通知的方式。
为了安全地打印“坏”字符('、"、<、…)。)，JSON 通过在任何“坏”字符前加一个\ char 来转义它们。

所以我开始思考。

![](img/c0cbee211a04862b3b339b1a08337565.png)

如果我自己逃跑呢？JSON 还会逃吗？

嗯，的确如此。JSON 转义机制对已经转义的有效负载进行了“双重转义”。剩下要做的就是预先逃脱一个有效载荷，这导致在通知区域存储 XSS。

## JSON 转义必须正确完成

这样做的唯一原因是开发人员认为没有人会在提交输入之前“预先转义”他们的输入。JSON 机制总是对输入进行转义(通过在输入前添加“或”字符)。如果你希望用户的输入由第三方代码输出，你应该:
1。绝不允许直接使用 HTML/Script 标签。如果必须的话，允许用户使用“特殊字符”来设计他们的输入(比如*bold*而不是< b >)。
2。了解机理。JSON 在文本前添加“或”。因此，如果您接受来自用户的这些字符，只需用 **URL 对它们进行编码。**

我将借此机会指出，SoundCloud 的响应团队是我合作过的最快的团队。看看披露的时间表。

## 披露时间表

13/02/2016 23:00 —发现并报告漏洞。
2016 年 2 月 14 日 08:00—Soundcloud 确认存在漏洞。
14/02/2016 14:00 —漏洞已修补，奖金已发放(HoF + Swag)。