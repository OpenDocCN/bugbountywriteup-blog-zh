<html>
<head>
<title>XXE in Public Transport Ticketing Mobile APP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">公交售票手机APP中的XXE</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/xxe-in-public-transport-ticketing-mobile-app-81ae245c01a1?source=collection_archive---------2-----------------------#2021-07-29">https://infosecwriteups.com/xxe-in-public-transport-ticketing-mobile-app-81ae245c01a1?source=collection_archive---------2-----------------------#2021-07-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="11e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个发现是另一个私人的臭虫奖励计划。目标的范围是一个票务android应用程序(Prod)。这个应用程序是一个主要的德国公共交通票务应用程序。</p><p id="7da5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在登录android应用程序并浏览帐户设置后，我遇到了一个“更改我的数据”选项。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/5cf49a58c40e54b8470dbb0a21b513ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NQJaOfnJGFRaeGeMwMjVug.png"/></div></div></figure><p id="b71c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一个屏幕中，我必须修改我的个人数据</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kx"><img src="../Images/d02455c130872f1c15f43dd5117b3758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0Doaq2DqLx9kCWX9TGU0g.png"/></div></div></figure><p id="6475" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存数据时，我发现以下请求被发送到服务器</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/80850157543ed1c09001dee409cbc26f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JjBl41jl8UKon222VQO3uw.jpeg"/></div></div></figure><p id="3e24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请求格式类似于<code class="fe kz la lb lc b">062.6.26#{some long data}.</code>这看起来很有趣。接下来，我选择了{一些长数据}并发送给解码器。我试着解码，发现是base64。解码的数据是一个XML，如下图所示</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ld"><img src="../Images/7adefd4b1ecb40916e54bc0ce671cecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*22gONAa4Fs7Vd-6ZhbDxxw.jpeg"/></div></div></figure><p id="48a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很好，接下来我加入了下面的XXE载荷</p><pre class="km kn ko kp gt le lc lf lg aw lh bi"><span id="9d74" class="li lj iq lc b gy lk ll l lm ln">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!DOCTYPE aa[&lt;!ELEMENT bb ANY&gt;&lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt;]&gt;</span></pre><p id="f0a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并从主体中调用定义的实体<code class="fe kz la lb lc b">&amp;xxe;</code>如下图所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lo"><img src="../Images/85dd5848c4396b554729ceb76652f902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ci5DzWdgcLR32AUT-0GRkA.jpeg"/></div></div></figure><p id="4c43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我需要做的就是将整个有效载荷编码回base64格式。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lp"><img src="../Images/06979083272b7d071f87a85fa8592c62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cPcaAamOjoqabyFxbDRxg.jpeg"/></div></div></figure><p id="c129" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我替换了原始请求中的有效负载，并将请求转发给服务器。然后，砰！我得到了<code class="fe kz la lb lc b">/etc/passwd</code>的内容</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lq"><img src="../Images/6130f95282ed0b7f6b96d7c65b16cb1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hWc4bD2qpdnah2Jfzgj2iA.jpeg"/></div></div></figure><p id="96ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于应用程序使用的是java，您甚至可以通过使用以下有效负载来列出目录</p><pre class="km kn ko kp gt le lc lf lg aw lh bi"><span id="36d2" class="li lj iq lc b gy lk ll l lm ln">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!DOCTYPE aa[&lt;!ELEMENT bb ANY&gt;&lt;!ENTITY xxe SYSTEM "file://"&gt;]&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lr"><img src="../Images/6e1d8efd4431b9a2236acf8d092f3888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6iPvwZbaV-nG1gS9AxSUAA.jpeg"/></div></div></figure><p id="45ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我主要是在寻找SSH私人密钥，但出于好奇，我试图获取<code class="fe kz la lb lc b">/etc/shadow</code>(感觉幸运的:D)。而且，出乎我意料的是，我得到了(这种情况很少见)。该响应表明它正在以root用户身份运行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ls"><img src="../Images/4904b9aa85df4e9dcf02440b1749ff47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w5fRaa05Z18Bb4c7DRBJuQ.jpeg"/></div></div></figure><p id="c031" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还发现，SSH私有密钥在<code class="fe kz la lb lc b">/home/user/.ssh/</code>目录中太容易找到了。这意味着我们也可以在系统上执行完整的RCE，但该计划不允许完整的升级。因此，我没有尝试，并停止了我的测试，直到这里，并报告相同的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lt"><img src="../Images/e227e90253b9515765926afbe280032d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3BwNRnIjHka4JRcT6orkA.jpeg"/></div></div></figure><p id="be69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">暂时就这样了。下一篇文章再见。保持好奇✌🏻</p><p id="44d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢<a class="lu lv ep" href="https://medium.com/u/504351aeb258?source=post_page-----81ae245c01a1--------------------------------" rel="noopener" target="_blank">巴武克·贾恩</a>、<a class="lu lv ep" href="https://medium.com/u/af3671776a72?source=post_page-----81ae245c01a1--------------------------------" rel="noopener" target="_blank">坎纳特·卡迈勒</a>和金恩的校对。</p></div></div>    
</body>
</html>