<html>
<head>
<title>Exploiting OAuth authentication vulnerabilities Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用OAuth认证漏洞第二部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-oauth-authentication-vulnerabilities-part-ii-6c150f492e62?source=collection_archive---------0-----------------------#2022-09-02">https://infosecwriteups.com/exploiting-oauth-authentication-vulnerabilities-part-ii-6c150f492e62?source=collection_archive---------0-----------------------#2022-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="995a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天我将展示一些可以用来利用OAuth 2.0的技术，并可能允许攻击者完全接管受害者的帐户。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/747971e6ba9f073ce656d82c0b4de5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rWvyS5CsTKIQyrLT76dFQ.jpeg"/></div></div></figure><p id="bcfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">攻击1:有缺陷的CSRF验证导致账户被接管:</strong></p><p id="3b2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每当OAuth进程启动时，客户端应用程序都应该生成一个令牌，该令牌与用户的会话相关联，用于授权目的。这个令牌主要由一个名为state的参数传递。但是如果授权没有发送状态参数，事情就变得有趣了。这意味着没有任何方法来检查由一个用户启动的授权过程实际上是由他自己完成的。</p><p id="ff53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者可以在他那端启动OAuth进程，并欺骗用户在他们那端完成该进程，从而接管他们的帐户。</p><p id="40c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就像一次基本的CSRF袭击。</p><p id="68ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了演示这种攻击，我们可以使用portswiggers提供的实验室环境。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="849e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">利用:<a class="ae le" href="https://portswigger.net/web-security/oauth/lab-oauth-forced-oauth-profile-linking" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">强制OAuth配置文件链接</strong> </a></p><p id="7538" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本实验中，您可以选择将社交媒体档案附加到您的帐户，以便您可以通过<a class="ae le" href="https://portswigger.net/web-security/oauth" rel="noopener ugc nofollow" target="_blank"> OAuth </a>登录，而不是使用普通用户名和密码。由于客户端应用程序对OAuth流的实现不安全，攻击者可以操纵此功能来获得对其他用户帐户的访问权限。</p><p id="154f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要解决这个实验，使用<a class="ae le" href="https://portswigger.net/web-security/csrf" rel="noopener ugc nofollow" target="_blank"> CSRF攻击</a>将你自己的社交媒体资料附加到博客网站上的管理员用户帐户，然后访问管理面板并删除Carlos。</p><p id="800f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">管理员用户将打开你从漏洞服务器发送的任何东西，他们在博客网站上总是有一个活动的会话。</p><p id="e7e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下凭据登录您自己的帐户:</p><ul class=""><li id="422b" class="lf lg iq jp b jq jr ju jv jy lh kc li kg lj kk lk ll lm ln bi translated">博客网站账号:<code class="fe lo lp lq lr b">wiener:peter</code></li><li id="4ba3" class="lf lg iq jp b jq ls ju lt jy lu kc lv kg lw kk lk ll lm ln bi translated">社交媒体简介:<code class="fe lo lp lq lr b">peter.wiener:hotdog</code></li></ul><p id="f1ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们访问实验室环境，并使用提供的凭据登录</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lx"><img src="../Images/96ce507661a3e52b3b1d0a08bb7f43c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YWIbgrRaRhgFMX22J0vJhA.png"/></div></div></figure><p id="a489" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">附上你的社交媒体资料，注意流量，你会看到一个请求名<code class="fe lo lp lq lr b">GET /oauth-linking?code={code}</code>现在记下这个请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ly"><img src="../Images/c0b01e071b3ce92ab71f5d80a8eb870b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mSt1xK2WOhhsGCgUrOXrA.png"/></div></div></figure><p id="39bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">帐户成功链接后，再次启动链接过程，但这一次拦截所有流量，转发除上述请求之外的所有请求，并复制URL。您必须确保放弃此请求。</p><p id="1030" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要设计一个csrf攻击，并欺骗管理员完成OAuth舞蹈。</p><p id="f253" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开漏洞服务器，手工创建一个HTML页面。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/6f6fd0147d0e470acd188d7604c703df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ua8GeL2MpLJab7IWQ8BMBA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">CSRF</figcaption></figure><p id="53fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有效载荷</p><pre class="km kn ko kp gt me lr mf mg aw mh bi"><span id="b2ce" class="mi mj iq lr b gy mk ml l mm mn">&lt;html&gt;<br/>&lt;body&gt;<br/>&lt;img src="<a class="ae le" href="https://0a720008043105e7c1c1140000bb0078.web-security-academy.net/oauth-linking?code=hjNnTLwdBZ8OfwCrIvFSZUhBtC4raT6-2sJ1Cwhi8Lv" rel="noopener ugc nofollow" target="_blank">https://0a720008043105e7c1c1140000bb0078.web-security-academy.net/oauth-linking?code=hjNnTLwdBZ8OfwCrIvFSZUhBtC4raT6-2sJ1Cwhi8Lv</a>"&gt; ===&gt; change the link...<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="3602" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在注销之前的会话。</p><p id="ec23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在存储漏洞并将其发送给受害者。</p><p id="e521" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开访问日志，您将看到一个不同的IP地址访问表单。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/44ac2a6eb42893461ea27b3460965ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gdbUIW6Ry3EFEkruqdN7g.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">管理员访问表单</figcaption></figure><p id="13ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在使用社交档案重新登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mp"><img src="../Images/4ecca149d22bdc7034c3b1f666f3b285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7JFOH_Dt2hlSfRnJEYCDw.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/36cae31ca0adb35977b829607ee2fa7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZ_45kPRc21SiQEdbKoiBw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">已登录</figcaption></figure><p id="5db0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在只需进入管理面板，删除卡洛斯。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lx"><img src="../Images/aced3ae6cc5ec6ee6b3e9de1ba8eb818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mKoQUBMOs2RNr0U-kVtQAw.png"/></div></div></figure><p id="aa78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的实验室解决了。❤</p><p id="5762" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">缓解</strong>:</p><p id="a431" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们讨论一下如何减轻这种攻击。</p><p id="4d7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果应用程序使用一个状态参数，并通过它传递一个与用户会话相关的哈希，并经过适当的验证，那么我们将无法让管理员将他们的社交简档链接到我们的帐户，因为状态参数不会被验证和批准。</p><p id="3bc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您看到OAUTH客户端不使用状态参数来验证当前用户的会话，则该应用程序很可能易受此攻击。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="b35f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你喜欢阅读关于OAuth的文章。</p><p id="f4f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想了解更多关于OAuth利用和渗透测试的知识，请关注我。</p><p id="5744" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直到下一次！快乐黑客❤</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="3601" class="mi mj iq bd mt mu mv dn mw mx my dp mz jy na nb nc kc nd ne nf kg ng nh ni nj bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae le" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>