<html>
<head>
<title>Memory Analysis — Ransomware (BlueTeamLabs)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">内存分析—勒索软件(BlueTeamLabs)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/memory-analysis-ransomware-blueteamlabs-f49765cd5b9c?source=collection_archive---------1-----------------------#2021-07-07">https://infosecwriteups.com/memory-analysis-ransomware-blueteamlabs-f49765cd5b9c?source=collection_archive---------1-----------------------#2021-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="1aa4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">挑战描述:<br/> </strong>客户经理之前打电话给SOC，听起来非常沮丧和愤怒。他说他无法访问他电脑上的任何文件，并不断收到一个弹出窗口，声称他的文件已被加密。你把电脑从网络上断开提取了他机器的内存转储然后开始用波动性分析。继续您的调查，以揭示勒索软件如何工作，以及如何阻止它！</p><p id="0afa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">挑战在于调查记忆文件。为此，我们将使用波动性。</p><p id="5fdc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">波动</strong></p><p id="d552" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">→这是一个内存取证框架，旨在分析易失性内存以进行内存分析。</p><p id="db21" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">易失性存储器</strong></p><p id="0c75" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">→这是一个需要电力来保存<a class="ae ks" href="http://information.best" rel="noopener ugc nofollow" target="_blank">信息的计算机存储器。</a>最好的例子是RAM(随机存取存储器)</p><p id="0ba6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于命令参考:<a class="ae ks" href="https://github.com/volatilityfoundation/volatility/wiki/Command-Reference" rel="noopener ugc nofollow" target="_blank"><em class="kt">https://github . com/volatility foundation/volatility/wiki/Command-Reference</em></a><em class="kt"/><a class="ae ks" href="https://book.hacktricks.xyz/forensics/basic-forensic-methodology/memory-dump-analysis/volatility-examples" rel="noopener ugc nofollow" target="_blank"><em class="kt">https://book . hack tricks . XYZ/forensics/basic-forensic-methodology/memory-dump-analysis/volatility-examples</em></a></p><p id="2e58" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们进入这些具有挑战性的问题。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/2db649f459aa1258dbb1f7efeb0e7566.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*9HvrzEZ4o2_XLbwiDfRczA.png"/></div></figure><p id="a449" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">文件的扩展名是vmem。它们由存储RAM的虚拟系统生成。</p><h1 id="edc4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">1.运行“<a class="ae ks" href="http://vol.py/" rel="noopener ugc nofollow" target="_blank">vol . py</a>-f infected . vmem—profile = win 7 sp 1x 86 PS scan”将列出所有进程。可疑流程的名称是什么？</h1><ul class=""><li id="b273" class="ma mb iq jw b jx mc kb md kf me kj mf kn mg kr mh mi mj mk bi translated">让我们先确定操作系统。</li></ul><pre class="kv kw kx ky gt ml mm mn mo aw mp bi"><span id="73c5" class="mq ld iq mm b gy mr ms l mt mu">volatility -f infected.vmem imageinfo</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/a049a602d8fb432cf9ec91eb9644f548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uPcBJObbTMA87Y5hRqTxgQ.png"/></div></div></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="e177" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">建议的配置文件是Win7SP0x86和Win7SP1x86。</p><p id="26da" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">根据问题，让我们扫描流程。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi na"><img src="../Images/0c7603a86e1b018e60631b7fb91f560f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFK8lLylfg9I-iTRzr0cQA.png"/></div></div></figure><p id="e69c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Ans → @WanaDecryptor</p><ul class=""><li id="a952" class="ma mb iq jw b jx jy kb kc kf nb kj nc kn nd kr mh mi mj mk bi translated">这是一个勒索软件，它加密文件并要求解密赎金</li></ul><h1 id="ab18" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">2.可疑进程的父进程ID是什么？</h1><p id="0ca1" class="pw-post-body-paragraph ju jv iq jw b jx mc jz ka kb md kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi">→ 2732</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nh"><img src="../Images/790c43c0631e374e86cc932783f479cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*OCjsrKRKjs1TyqeR5qOb8w.png"/></div></div></figure><h1 id="5658" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">3.创建此进程的初始恶意可执行文件是什么？</h1><p id="05f3" class="pw-post-body-paragraph ju jv iq jw b jx mc jz ka kb md kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">→or4qtckT.exe</p><pre class="kv kw kx ky gt ml mm mn mo aw mp bi"><span id="0dce" class="mq ld iq mm b gy mr ms l mt mu">volatility -f infected.vmem --profile=Win7SP1x86  cmdline -p 2732</span><span id="a4d3" class="mq ld iq mm b gy ni ms l mt mu">cmdline - shows the cmd executed by the related proecesses</span></pre><p id="4648" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这也可以通过查看父进程id很容易地猜测出来。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nj"><img src="../Images/7f9478a99b65ae95fc322fc6e4cb783a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DkkPP_T8V-6QG2PprEat4g.png"/></div></div></figure><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/1bbac2b8da6397b5363a0b214fbfdb0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*kG33QVHM9EMjU1owsJ4H2Q.png"/></div></figure><p id="2c34" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">wannadecryptor的ppid是2732，or4qtckT.exe的pid也是or4qtckT.exe。这意味着这个过程背后的原因是通过文件or4qtckT.exe运行。</p><p id="94bf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还可以运行dllist插件来查找流程执行路径。</p><pre class="kv kw kx ky gt ml mm mn mo aw mp bi"><span id="2d02" class="mq ld iq mm b gy mr ms l mt mu">volatility -f infected.vmem --profile=Win7SP1x86 dlllist -p 2732</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nl"><img src="../Images/8bf17c0cc433239a86b981f54a6da44c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XB1WViZX7Ly-aOFpf9RKpw.png"/></div></div></figure><h1 id="382f" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">4.如果您深入可疑的PID(<a class="ae ks" href="http://vol.py/" rel="noopener ugc nofollow" target="_blank">vol . py</a>-f infected . vmem—profile = win 7 sp 1 x 86 PS scan | grep(PID here))，找到用于删除文件的进程</h1><p id="b448" class="pw-post-body-paragraph ju jv iq jw b jx mc jz ka kb md kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">→taskdl.exe</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nm"><img src="../Images/a9fb5351422318084a5837a3141695f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9mOr_Gg9wMc2rngsb0KSaw.png"/></div></div></figure><h1 id="5cb7" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">5.找到恶意文件首次执行的路径</h1><p id="ff49" class="pw-post-body-paragraph ju jv iq jw b jx mc jz ka kb md kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated"><strong class="jw ir">→</strong>C:\ Users \ hacker \ Desktop \ or 4 Qt CKT . exe</p><p id="74d7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">看看问题3。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nn"><img src="../Images/5c0ea3518c180481f9067d48f5886c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwREnXtqgUXRViZGvk620w.png"/></div></div></figure><h1 id="0d68" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">6.能识别出是什么勒索软件吗？(做好你的调研！)</h1><p id="28eb" class="pw-post-body-paragraph ju jv iq jw b jx mc jz ka kb md kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">→ WannaCry <br/>快速谷歌搜索会给出答案。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi no"><img src="../Images/816d47fcc6abb18d4a6b92d9ed312f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgDnRuPBJgFiw1f9ZwIPig.png"/></div></div></figure><h1 id="3ce2" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">7.用于加密私钥的勒索软件公钥文件的文件名是什么？(.eky扩展)</h1><p id="de34" class="pw-post-body-paragraph ju jv iq jw b jx mc jz ka kb md kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">→ 00000000.eky</p><p id="9f95" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先转储内存</p><pre class="kv kw kx ky gt ml mm mn mo aw mp bi"><span id="3228" class="mq ld iq mm b gy mr ms l mt mu">volatility -f infected.vmem --profile=Win7SP1x86 memdump --dump-dir dump/ -p 4060</span></pre><p id="91b5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后我们可以简单地使用“字符串”和“grep”命令。</p><pre class="kv kw kx ky gt ml mm mn mo aw mp bi"><span id="151c" class="mq ld iq mm b gy mr ms l mt mu">strings 2732.dmp | grep eky</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi np"><img src="../Images/1bf61a82bbf60ef4e7d7e8736672c2de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aC2nEoi5vZcHfHbyNPltgA.png"/></div></div></figure><p id="e5d8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">谢谢:-)</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="379b" class="lc ld iq bd le lf nq lh li lj nr ll lm ln ns lp lq lr nt lt lu lv nu lx ly lz bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae ks" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="nv nw gp gr nx ny"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">iwcon.live</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om la ny"/></div></div></a></div></div></div>    
</body>
</html>