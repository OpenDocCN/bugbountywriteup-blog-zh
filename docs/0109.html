<html>
<head>
<title>HSTS Bypass Vulnerability in IE Preview</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">IE预览版中的HSTS绕过漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hsts-bypass-vulnerability-in-ie-preview-fa956161fa8?source=collection_archive---------1-----------------------#2018-05-15">https://infosecwriteups.com/hsts-bypass-vulnerability-in-ie-preview-fa956161fa8?source=collection_archive---------1-----------------------#2018-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="54d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我在2015年发现的Internet Explorer preview中的一个旧漏洞的书面报告。这是部分HSTS旁路漏洞。这是我在微软软件中发现的第一个漏洞。没有bug奖金，也没有CVE奖分配给这个bug，但是我在2015年6月因为我的报告而受到了微软的表扬。我完全是偶然发现的。在这篇文章中，我将分享这个漏洞的细节。</p><h1 id="4af3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">背景</h1><p id="6d3b" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">正如我在我的文章<a class="ae lo" href="https://medium.com/bugbountywriteup/find-edges-hsts-preload-list-part-i-2ee5ce6bc5aa" rel="noopener"> <em class="lp"> Find Edge的HSTS预载列表(第一部分)</em> </a>中提到的，HTTP严格传输安全(HSTS)允许网站指示web浏览器应该只使用HTTPS连接到它们的服务器。HSTS对浏览器有两个要求:</p><ol class=""><li id="f7c4" class="lq lr iq jp b jq jr ju jv jy ls kc lt kg lu kk lv lw lx ly bi translated">如果一个链接使用“http:”协议，并且URL的域部分是一个已知的HSTS域，那么浏览器必须在发送请求之前将协议重写为“https:”协议。(例如，如果用户在地址栏中键入<code class="fe lz ma mb mc b">http://github.com/</code>，浏览器应该使用<a class="ae lo" href="https://github.com/" rel="noopener ugc nofollow" target="_blank">https://github.com/</a>)</li><li id="c5c9" class="lq lr iq jp b jq md ju me jy mf kc mg kg mh kk lv lw lx ly bi translated">如果服务器提供的证书不可信，浏览器一定不允许用户忽略证书错误。</li></ol><p id="2e15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个要求背后的原因是，一些证书错误不是由于真正的攻击，而是由于服务器配置错误、客户端时钟偏差、强制网络门户等。但正因为如此，一些用户习惯点击警告信息。通过删除这个不安全的选项，HSTS帮助用户始终保持安全。</p><h1 id="45e3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">弱点</h1><p id="1748" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">Windows 10技术预览版Build 10041上的IE 11中存在该漏洞。这并不影响Windows的已发布版本，因为当时HSTS仅在Windows 10预览版中受支持，而在Windows 7、8或8.1中不受支持。</p><p id="1a0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该漏洞绕过了HSTS的第二个要求。它的工作原理是将任何HTTP或HTTPS请求重定向到HSTS域，然后IE允许用户忽略证书警告。例如，一个用户访问了http://example.com/。一个MITM攻击者将http://example.com的<a class="ae lo" href="http://example.com/" rel="noopener ugc nofollow" target="_blank">重定向到https://github.com/</a>的<a class="ae lo" href="https://github.com/" rel="noopener ugc nofollow" target="_blank">，然后用一个自签名证书拦截TLS请求。因为证书是自签名的，IE向用户显示一个错误页面，但令人惊讶的是，用户可以选择继续访问网站。更糟糕的是，当你悬停在“继续浏览本网站”链接上时，左下方显示的网址是“</a><a class="ae lo" href="http://example.com/" rel="noopener ugc nofollow" target="_blank">http://example.com</a>”，而不是“<a class="ae lo" href="https://github.com/" rel="noopener ugc nofollow" target="_blank">https://github.com</a>”。如果你真的忽略了这个警告，github.com的饼干会被送到MITM。</p><p id="6480" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直接拜访<a class="ae lo" href="https://www.facebook.com/" rel="noopener ugc nofollow" target="_blank">https://www.facebook.com</a>:</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mi"><img src="../Images/6c9c578e7672c46f420a65cbd5edaf3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_VTpOogAmSNjNakhTqW0FA.png"/></div></div></figure><p id="4ecf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当MITM重定向到https://www.facebook.com<a class="ae lo" href="https://www.facebook.com/" rel="noopener ugc nofollow" target="_blank">时的错误页面</a>:</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mi"><img src="../Images/8b34c296b6ad274ee3827e731a29743b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V5x8WAv2sULP3ZNF9cOXHA.png"/></div></div></figure><p id="4d4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户点击警告后:</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mi"><img src="../Images/e98eaafa26b2292bd70e03af14601d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sAzwOZ9J8fy2fv4_MHzjnQ.png"/></div></div></figure><p id="6580" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于这个漏洞只影响测试版的IE，微软说他们不会给这个问题分配一个CVE，但是他们在<a class="ae lo" href="https://docs.microsoft.com/en-us/security-updates/Acknowledgments/2015/acknowledgments2015" rel="noopener ugc nofollow" target="_blank">公告</a>中提到了我。我真的很感激的承认和快速修复。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mu"><img src="../Images/e1c1a205b8dececc9bc49297f2ca65a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-SYht0-QuUSU6m4LEjiynA.jpeg"/></div></div></figure><h1 id="a503" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">时间表</h1><ol class=""><li id="27ae" class="lq lr iq jp b jq lj ju lk jy mv kc mw kg mx kk lv lw lx ly bi translated">2015年3月19日:漏洞发送到MSRC</li><li id="db0b" class="lq lr iq jp b jq md ju me jy mf kc mg kg mh kk lv lw lx ly bi translated">2015年3月19日:MSRC立案21780</li><li id="23f1" class="lq lr iq jp b jq md ju me jy mf kc mg kg mh kk lv lw lx ly bi translated">2015年6月9日:向用户发布补丁</li></ol></div></div>    
</body>
</html>