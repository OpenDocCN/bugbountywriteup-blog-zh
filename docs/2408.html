<html>
<head>
<title>Blockchain Network is Secured! But not the apps and their Integrations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">区块链网络安全了！但不是应用程序和它们的集成</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/blockchain-network-is-secured-but-not-the-apps-and-their-integrations-8077195d2c49?source=collection_archive---------2-----------------------#2022-09-29">https://infosecwriteups.com/blockchain-network-is-secured-but-not-the-apps-and-their-integrations-8077195d2c49?source=collection_archive---------2-----------------------#2022-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="c4d1" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">概观</h1><p id="a809" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在对一个基于区块链的<a class="ae lj" href="https://wesecureapp.com/blog/attacks-on-blockchain/" rel="noopener ugc nofollow" target="_blank"> web应用</a>进行安全评估的过程中，观察到一些功能容易受到未经验证的ETH从管理员钱包传输到攻击者钱包的攻击。这个网络应用程序是一个订票应用程序，用户可以通过一个<a class="ae lj" href="https://wesecureapp.com/blog/how-do-cryptocurrencies-affect-cybersecurity/" rel="noopener ugc nofollow" target="_blank">加密</a>令牌订票和付款。此外，该应用程序与Metamask框架相集成，以支持区块链上的web3事务。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/1b97763c66264a4d90ae4e1c9178d66f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fMQH4qPB5kzMw23E.png"/></div></div></figure><h1 id="43aa" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">工作流程</h1><ol class=""><li id="d8bf" class="lw lx iq kn b ko kp ks kt kw ly la lz le ma li mb mc md me bi translated">用户启动订票功能。假设一张票(T1)需要支付(0.1 ETH)才能转移到管理员的钱包中。</li><li id="677a" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">网络应用程序发送从集成Metamask钱包中转移<strong class="kn ir"> 0.1 ETH </strong>的请求。</li><li id="4a63" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">用户从元掩码签署交易。</li><li id="afba" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">在<strong class="kn ir"> 0.1 ETH </strong>交易成功后，web应用程序通过对<a class="ae lj" href="https://redacted.com/api/v1/wallet/metamask_send_token" rel="noopener ugc nofollow" target="_blank"><strong class="kn ir"/></a>的POST API调用来确认支付</li></ol><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/fc7cb8ac1ba6ed2f8852057331c339fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BQ2PvKEZ6flgG_VY.png"/></div></div></figure><p id="7057" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">5.现在，应用程序从Metamask获得了成功的事务确认，通过POST请求为用户预订了机票</p><p id="1714" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated"><a class="ae lj" href="https://redacted.com/api/v1/booking/book_ticket/" rel="noopener ugc nofollow" target="_blank"><strong class="kn ir">https://Redacted.com/api/v1/booking/book_ticket/</strong></a></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/9b6118fb56121b69a99066664c32e6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j1LVFMxd9R_EtHES.png"/></div></div></figure><p id="e1ce" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">6.这个POST请求是为了一个成功的交易。包含两个参数，即<strong class="kn ir"> transaction_hash </strong>和<strong class="kn ir"> total_tickets。</strong>发现这两个参数没有映射在一起。</p><p id="d83d" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">7.因为它只检查<strong class="kn ir"> transaction_hash，</strong>，所以可以操作另一个参数来预订相同金额的多张票。</p><p id="385f" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">8.恶意用户可以篡改"<strong class="kn ir"> total_tickets" </strong>参数，并可以预订任意数量的门票，仅用于<strong class="kn ir"> 0.1 ETH </strong>。在这个例子中，我们预订了100张0.1日的门票。</p><p id="5d5e" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">9.在进一步利用该漏洞时，发现有一个功能允许用户取消预订并获得相应的退款。</p><p id="5a4f" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">10.当用户取消预订的机票时，后端服务器只验证预订的机票是否有效。验证成功后，开始退款。</p><p id="089f" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">11.访问该功能流时，将执行以下功能:</p><ul class=""><li id="3ba6" class="lw lx iq kn b ko mk ks ml kw mp la mq le mr li ms mc md me bi translated"><strong class="kn ir">Get _ total _ booked _ ticket()</strong></li><li id="514c" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li ms mc md me bi translated"><strong class="kn ir">退款()</strong></li></ul><p id="b1e5" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">12.如果用户的钱包包含有效的票id，则底层服务器执行发送到端点的POST请求:<a class="ae lj" href="https://redacted.com/api/v1/booking/cancel_ticket/" rel="noopener ugc nofollow" target="_blank"><strong class="kn ir">【https://Redacted.com/api/v1/booking/cancel_ticket/】</strong></a>，以<strong class="kn ir">用户ID </strong>和<strong class="kn ir">票ID</strong>作为参数。后端服务器从"<strong class="kn ir"> ticket_id" </strong>中检索票证的值，并将ETH发送到用户的钱包。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/a386c231209f97ca5b5079f95c6ffcf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tyV87N9p0SO-mqL0.png"/></div></div></figure><p id="583e" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">13.任何退款/购买交易都将直接转入/转出管理员的钱包</p><p id="a790" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">14.由于<a class="ae lj" href="https://wesecureapp.com/blog/api-security-top-5-best-practices-to-follow/" rel="noopener ugc nofollow" target="_blank"> API </a>调用缺乏其请求参数之间的正确映射，并且不验证与票号相对应的交易，恶意用户可以很容易地利用这一缺陷来大幅增加票号，并获得超过消费金额的退款。</p><p id="fd36" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">15.在这里，为了购买1张花费0.1 ETH的票，预订了100多张票。一旦开始退款，只需改变门票的数量就可以取回任何金额。</p><p id="73f5" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">16.由于在这种情况下有大量有效票证，威胁参与者可以从管理员的钱包中检索多达<strong class="kn ir"> 10 ETH </strong> (100*0.1=10)，并耗尽管理员钱包中的ETH。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mt"><img src="../Images/3139fe449464d025bcc3ae8cbc05057f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bbvEqOxcGYDKYXz2.png"/></div></div></figure><p id="1028" class="pw-post-body-paragraph kl km iq kn b ko mk kq kr ks ml ku kv kw mm ky kz la mn lc ld le mo lg lh li ij bi translated">17.通过验证来自以太网扫描(一个跟踪所有基于以太网的区块链交易的网站)的区块链哈希，这一支付漏洞得到了进一步证实</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/0de21ee55ee2adae39bd7c89ce891a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ppCJZTdM0d7pXxal.png"/></div></div></figure><h1 id="1805" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="dea6" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">区块链网络确实很难渗透，因为区块链有安全的网络来构建DAPPS，但是<strong class="kn ir">应用架构、</strong> <a class="ae lj" href="https://wesecureapp.com/services/application-security/secure-code-review/" rel="noopener ugc nofollow" target="_blank">源代码</a> <strong class="kn ir">、工作流和配置</strong>对于这种攻击总是开放的。有必要应用<a class="ae lj" href="https://wesecureapp.com/blog/the-penetration-testing-guide-for-compliance-and-audits/" rel="noopener ugc nofollow" target="_blank">安全审计</a>和定期评估来发现工作流程中的漏洞和错误。一个小问题可能会导致未经认证的令牌从钱包中流失，从而对用户以及整个社区造成不良影响。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi mu"><img src="../Images/ee9999e0b1e6b3b14046d1f4d317024e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mZpDS2o08WZmzoBM.jpg"/></div></div></figure><h1 id="190f" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">关于作者</h1><p id="be84" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">基尤尔·塔拉提</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h2 id="71fe" class="nc jo iq bd jp nd ne dn jt nf ng dp jx kw nh ni kb la nj nk kf le nl nm kj nn bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lj" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>