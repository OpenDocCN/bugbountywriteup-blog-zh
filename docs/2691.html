<html>
<head>
<title>Everything about Docker Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">码头保安的一切</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/everything-about-docker-security-ceaef9612ebe?source=collection_archive---------4-----------------------#2022-12-23">https://infosecwriteups.com/everything-about-docker-security-ceaef9612ebe?source=collection_archive---------4-----------------------#2022-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/58b3425648867204ce8ce261b4ff0feb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*QoBhTFOsuvioey3d.jpeg"/></div></figure><p id="9423" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae kv" href="https://unsplash.com/@hackernoon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">黑客正午</a>在<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</p><p id="703d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">Docker是什么，为什么要使用它？</strong></p><p id="0075" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在我们真正进入技术部分之前，让我们假设你为一家公司工作，该公司有两个部门负责服务、产品等的开发和部署。</p><p id="edf7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">他们被称为生产团队和运营团队。经过无数个小时的讨论和会议，最终决定了公司网站的需求。需求被发送到开发团队。现在是他们在网站上工作的时候了。正如你我所知，一个网站需要整合的特性和功能越多，需要导入的库和包就越多。假设他们在NodeJS上工作，有一个express框架，MongoDB作为服务器。当网站最终完成时，他们会在将网站发送到运营团队之前，在开发服务器上检查网站是否运行良好，运营团队的工作是将网站部署到生产服务器上。</p><p id="a2fa" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">您是否想过，在开发服务器上实际开发网站时使用的node、express和其他库的版本可能与安装在生产服务器上的版本不同。</p><p id="2c10" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">结果会怎样？当网站被部署时，它很可能会在生产服务器上抛出错误。生产服务器可能已安装了不推荐使用的库、版本、配置问题，或者开发服务器可能已安装了不推荐使用的库、版本。不管怎样，这都是一个失败的局面，因为最终的结果是网站无法安装。</p><figure class="kx ky kz la gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kw"><img src="../Images/bd9bd8512c46e5f79a86171c0e5e6ab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mlXHsYdqR5UOndS-.png"/></div></div></figure><p id="9079" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae kv" href="https://jfrog.com/knowledge-base/the-basics-a-beginners-guide-to-docker/" rel="noopener ugc nofollow" target="_blank">来源</a></p><p id="7e71" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在考虑一个不同的场景。开发团队制作网站，但现在他们不是将原始代码直接发送给运营团队，而是制作一个容器并将其保存在容器中。把这个容器看作一种沙箱。它有代码、数据库以及配置文件，团队可以安装他们想要包含在容器中的所有依赖项。现在，运营团队所要做的就是将容器连接到网络，然后运行该容器，使网站上线。简而言之，这就是docker。所有的依赖项、工件和配置都可以保存在容器中。该容器将独立运行，不会干扰其他包和依赖项等。就像沙盒或者虚拟机一样。</p><p id="824f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">为什么Docker安装变得易受攻击？</strong></p><figure class="kx ky kz la gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lf"><img src="../Images/5607e45ef4ecb427ab3da2a63f7803df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JdCqaEHDoQKdh6ju.png"/></div></div></figure><p id="b25d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae kv" href="https://www.docker.com/blog/docker-security-scanning/" rel="noopener ugc nofollow" target="_blank">来源</a></p><p id="f683" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">容器技术并不新鲜，但对我们许多人来说却是。为了防止被对手利用，遵循最佳实践是非常必要的。</p><p id="6ba9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">以下是docker安装容易受到攻击的情况。</p><ol class=""><li id="bd14" class="lg lh it jz b ka kb ke kf ki li km lj kq lk ku ll lm ln lo bi translated">一些用户可能对最新版本一无所知，因此可能会安装过时版本的docker引擎和具有一些已知漏洞的底层主机操作系统，也可能会安装一些过时的依赖项..</li><li id="c5c1" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">码头守护进程是任何码头的大脑和心脏。它监听docker API请求，创建和管理docker对象，如图像、容器、网络和卷。默认情况下，它归root用户所有。如果其他任何人获得了对套接字的访问权限，他们将拥有root权限，这是您永远也不想看到的。您还可以通过将守护进程绑定到网络接口来远程使用docker容器。</li><li id="d009" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">在根模式下运行docker是团队要做的事情。当我们配置一个网站时，我们创建一个新用户，并为他分配完成日常任务所需的最低权限。我们不只是用根用户的特权来保持网站运行。但是在docker的情况下我们经常会忘记这一点。</li><li id="0f95" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">安装带有不必要组件的基本映像。如果您在基本映像中安装了不必要的组件和您不了解的组件，将会增加攻击面。</li><li id="da2b" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">泄露敏感信息是主要问题之一。Docker的正常操作需要TLS证书、SSH密钥、凭证等。在docker文件中暴露它们就像把你家的钥匙交给你的敌人一样。</li><li id="9c37" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">安装易受攻击的开源库。信不信由你。当一个特定的软件可以很容易地解决我们的问题时，我们只需点击一下按钮就可以安装它。更重要的是，它是完全免费的。但是由于他们是开源的，他们没有一个团队全天候为他们服务。因此，它们可能存在漏洞，而且许多漏洞可能无法修补。</li><li id="411e" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">允许用户运行系统命令。您可以让用户在新安装的docker容器上运行系统命令。</li></ol><p id="5736" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们能做些什么来确保安装安全？</p><figure class="kx ky kz la gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi lu"><img src="../Images/6541ebc5b31309551a4512527ea0acd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ThG29-H7FamV49-n.jpeg"/></div></div></figure><p id="998f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">来源:Docker</p><p id="677d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">既然我们已经知道了使docker安装易受攻击的一些方法，那么让我们来看看使它们安全的一些方法。</p><ol class=""><li id="087c" class="lg lh it jz b ka kb ke kf ki li km lj kq lk ku ll lm ln lo bi translated">跟踪docker引擎。如果您发现可能危及您安全的漏洞，请尽快修补它。这不会让你晚上睡不着。</li><li id="4dee" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">将守护程序绑定到网络接口时要特别小心。它不仅能让你的docker被你远程访问，也能让你的对手远程访问。如果你必须让它可访问，使用Docker的加密HTTP套接字，因为它支持认证。</li><li id="6fc3" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">API是docker使用的东西，你可以通过配置API来保护你的容器，防止它们被公众访问。或者通过实施基于证书的认证，有可能实施加密通信。</li><li id="d3b0" class="lg lh it jz b ka lp ke lq ki lr km ls kq lt ku ll lm ln lo bi translated">我们知道用提升的特权运行docker可能是有害的。Docker提供了一种“无根模式”。要在无根模式下运行:</li></ol><pre class="kx ky kz la gt lv lw lx bn ly lz bi"><span id="7c2b" class="ma mb it lw b be mc md l me mf">docker context use rootlessdocker run –d –p 8080:80 nginx</span></pre><p id="337f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要检查容器是否在特权模式下运行，</p><pre class="kx ky kz la gt lv lw lx bn ly lz bi"><span id="9639" class="ma mb it lw b be mc md l me mf">docker inspect –format = ‘ ‘ [container_id]</span></pre><p id="7a42" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果它返回true，那么它正在特权模式下运行。如果它抛出一个错误，它不是。</p><p id="b662" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">5.使用docker文件泄漏敏感信息会导致攻击者迅速危害您的容器。像Kubernetes和Docker Swarn这样的容器编排器提供了秘密管理功能，可以解决使用Docker文件泄漏敏感信息的问题。</p><p id="77df" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">6.尽量使用组件最少的基础映像。即使您已经安装了一些组件，很好地理解它们也是很重要的。因为如果你这样做，肯定会增加攻击面。</p><p id="0b5e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">7.用户可以使用允许系统调用来提升权限。您可以选择允许或拒绝系统调用。此外，就像在Linux中一样，您可以获得使用。bash_history文件，还可以监控系统命令的发出。</p><h1 id="6753" class="mg mb it bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">结论</h1><p id="c8f8" class="pw-post-body-paragraph jx jy it jz b ka nd kc kd ke ne kg kh ki nf kk kl km ng ko kp kq nh ks kt ku im bi translated">Docker让开发人员的开发和运营团队在生产服务器上的部署变得非常简单有效。从外面看起来可能很简单，事实也确实如此，但是忽略安全隐患可能非常容易。因此，在部署docker容器之前，考虑安全性问题非常重要。您可以从考虑上述安全措施开始。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h2 id="4760" class="np mb it bd mh nq nr dn ml ns nt dp mp ki nu nv mt km nw nx mx kq ny nz nb oa bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kv" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>