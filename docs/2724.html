<html>
<head>
<title>RPS — Binary Exploitation Challenge Writeup | PicoCTF 2022</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RPS —二进制开发挑战报告| PicoCTF 2022</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/rps-binary-exploitation-challenge-writeup-picoctf-2022-5e856321a644?source=collection_archive---------5-----------------------#2022-12-30">https://infosecwriteups.com/rps-binary-exploitation-challenge-writeup-picoctf-2022-5e856321a644?source=collection_archive---------5-----------------------#2022-12-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ef79" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">RPS—PicoCTF |方法中的简单二进制开发程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/5d6078c02b5666887d404a833077c28d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*Qw0cKg00yoBZfynWvA35vw.png"/></div></figure><h2 id="b063" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">描述:</strong></h2><ul class=""><li id="4096" class="lj lk iq ll b lm ln lo lp kw lq la lr le ls lt lu lv lw lx bi translated">这里有一个程序，和你玩石头、布、剪刀。</li><li id="ef98" class="lj lk iq ll b lm ly lo lz kw ma la mb le mc lt lu lv lw lx bi translated">我听说如果你连续赢5次会有好事发生。</li><li id="6127" class="lj lk iq ll b lm ly lo lz kw ma la mb le mc lt lu lv lw lx bi translated">用netcat连接到程序:<br/> <code class="fe md me mf mg b">$ nc saturn.picoctf.net 56981</code></li><li id="4f6f" class="lj lk iq ll b lm ly lo lz kw ma la mb le mc lt lu lv lw lx bi translated">该程序的源代码与标记编辑可以下载<a class="ae mh" href="https://artifacts.picoctf.net/c/444/game-redacted.c" rel="noopener ugc nofollow" target="_blank">在这里</a>。</li></ul><h2 id="7156" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">任务文件:</h2><p id="d76e" class="pw-post-body-paragraph mi mj iq ll b lm ln jr mk lo lp ju ml kw mm mn mo la mp mq mr le ms mt mu lt ij bi translated"><a class="ae mh" href="https://artifacts.picoctf.net/c/444/game-redacted.c" rel="noopener ugc nofollow" target="_blank">https://artifacts.picoctf.net/c/444/game-redacted.c</a></p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h2 id="dcef" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">分析:</h2><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="4fd0" class="ng ko iq mg b be nh ni l nj nk">#include &lt;stdio.h&gt;<br/>#include &lt;stdlib.h&gt;<br/>#include &lt;stdbool.h&gt;<br/>#include &lt;string.h&gt;<br/>#include &lt;time.h&gt;<br/>#include &lt;unistd.h&gt;<br/>#include &lt;sys/time.h&gt;<br/>#include &lt;sys/types.h&gt;<br/><br/><br/>#define WAIT 60<br/><br/>static const char* flag = "[REDACTED]";<br/><br/>char* hands[3] = {"rock", "paper", "scissors"};<br/>char* loses[3] = {"paper", "scissors", "rock"};<br/>int wins = 0;<br/><br/><br/>int tgetinput(char *input, unsigned int l)<br/>{<br/>    fd_set          input_set;<br/>    struct timeval  timeout;<br/>    int             ready_for_reading = 0;<br/>    int             read_bytes = 0;<br/>    <br/>    if( l &lt;= 0 )<br/>    {<br/>      printf("'l' for tgetinput must be greater than 0\n");<br/>      return -2;<br/>    }<br/>    <br/>    <br/>    /* Empty the FD Set */<br/>    FD_ZERO(&amp;input_set );<br/>    /* Listen to the input descriptor */<br/>    FD_SET(STDIN_FILENO, &amp;input_set);<br/><br/>    /* Waiting for some seconds */<br/>    timeout.tv_sec = WAIT;    // WAIT seconds<br/>    timeout.tv_usec = 0;    // 0 milliseconds<br/><br/>    /* Listening for input stream for any activity */<br/>    ready_for_reading = select(1, &amp;input_set, NULL, NULL, &amp;timeout);<br/>    /* Here, first parameter is number of FDs in the set, <br/>     * second is our FD set for reading,<br/>     * third is the FD set in which any write activity needs to updated,<br/>     * which is not required in this case. <br/>     * Fourth is timeout<br/>     */<br/><br/>    if (ready_for_reading == -1) {<br/>        /* Some error has occured in input */<br/>        printf("Unable to read your input\n");<br/>        return -1;<br/>    } <br/><br/>    if (ready_for_reading) {<br/>        read_bytes = read(0, input, l-1);<br/>        if(input[read_bytes-1]=='\n'){<br/>        --read_bytes;<br/>        input[read_bytes]='\0';<br/>        }<br/>        if(read_bytes==0){<br/>            printf("No data given.\n");<br/>            return -4;<br/>        } else {<br/>            return 0;<br/>        }<br/>    } else {<br/>        printf("Timed out waiting for user input. Press Ctrl-C to disconnect\n");<br/>        return -3;<br/>    }<br/><br/>    return 0;<br/>}<br/><br/><br/>bool play () {<br/>  char player_turn[100];<br/>  srand(time(0));<br/>  int r;<br/><br/>  printf("Please make your selection (rock/paper/scissors):\n");<br/>  r = tgetinput(player_turn, 100);<br/>  // Timeout on user input<br/>  if(r == -3)<br/>  {<br/>    printf("Goodbye!\n");<br/>    exit(0);<br/>  }<br/><br/>  int computer_turn = rand() % 3;<br/>  printf("You played: %s\n", player_turn);<br/>  printf("The computer played: %s\n", hands[computer_turn]);<br/><br/>  if (strstr(player_turn, loses[computer_turn])) {<br/>    puts("You win! Play again?");<br/>    return true;<br/>  } else {<br/>    puts("Seems like you didn't win this time. Play again?");<br/>    return false;<br/>  }<br/>}<br/><br/><br/>int main () {<br/>  char input[3] = {'\0'};<br/>  int command;<br/>  int r;<br/><br/>  puts("Welcome challenger to the game of Rock, Paper, Scissors");<br/>  puts("For anyone that beats me 5 times in a row, I will offer up a flag I found");<br/>  puts("Are you ready?");<br/>  <br/>  while (true) {<br/>    puts("Type '1' to play a game");<br/>    puts("Type '2' to exit the program");<br/>    r = tgetinput(input, 3);<br/>    // Timeout on user input<br/>    if(r == -3)<br/>    {<br/>      printf("Goodbye!\n");<br/>      exit(0);<br/>    }<br/>    <br/>    if ((command = strtol(input, NULL, 10)) == 0) {<br/>      puts("Please put in a valid number");<br/>      <br/>    } else if (command == 1) {<br/>      printf("\n\n");<br/>      if (play()) {<br/>        wins++;<br/>      } else {<br/>        wins = 0;<br/>      }<br/><br/>      if (wins &gt;= 5) {<br/>        puts("Congrats, here's the flag!");<br/>        puts(flag);<br/>      }<br/>    } else if (command == 2) {<br/>      return 0;<br/>    } else {<br/>      puts("Please type either 1 or 2");<br/>    }<br/>  }<br/><br/>  return 0;<br/>}</span></pre><p id="4df1" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">请注意下面的代码</p><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="28cd" class="ng ko iq mg b be nh ni l nj nk">if (wins &gt;= 5) {<br/>        puts("Congrats, here's the flag!");<br/>        puts(flag);<br/>      }</span></pre><p id="e340" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">如果<code class="fe md me mf mg b">wins ≥ 5</code>的值那么它将显示该标志。</p><p id="59da" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated"><strong class="ll ir">输出:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/8522c7935e344c947bed5feb677cfec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*QFTSMUA7Ow74qPvqs-5BGA.png"/></div></figure><p id="9c5f" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">为了得到这面旗帜，我们必须连续赢<strong class="ll ir"> <em class="nr"> 5次。<br/> </em> </strong>那么我们来分析一下<code class="fe md me mf mg b">play()</code>函数</p><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="8450" class="ng ko iq mg b be nh ni l nj nk">if (strstr(player_turn, loses[computer_turn])) {<br/>    puts("You win! Play again?");<br/>    return true;<br/>  } else {<br/>    puts("Seems like you didn't win this time. Play again?");<br/>    return false;<br/>  }</span></pre><p id="9f24" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">这里使用<code class="fe md me mf mg b">strstr()</code>函数来检查字符串<code class="fe md me mf mg b">loses[computer_turn]</code>是否在<code class="fe md me mf mg b">player_turn</code>的字符串中。如果存在，它将返回true</p><p id="79f5" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated"><strong class="ll ir">演示示例:</strong></p><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="7795" class="ng ko iq mg b be nh ni l nj nk">char* hands[3] = {"rock", "paper", "scissors"};<br/>char* loses[3] = {"paper", "scissors", "rock"};</span></pre><p id="64fd" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated"><code class="fe md me mf mg b">player_turn = rock<br/>computer_turn = 2--&gt; Means hand[2] -- scissors<br/>loses[computer_turn] = rock</code></p><p id="fdb3" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">因此，在这种情况下，字符串<code class="fe md me mf mg b">loses[computer_turn]</code>在<code class="fe md me mf mg b">player_turn</code>中，因此它将返回True，我们将获胜</p><p id="3d34" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">所以为了得到这个标志，我们必须使用字符串<code class="fe md me mf mg b">rockpaperscissors</code>作为<code class="fe md me mf mg b">5 Times</code>的输入</p><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="e204" class="ng ko iq mg b be nh ni l nj nk">rock is in rockpaperscissors<br/>paper is in rockpaperscissors<br/>scissors is in rockpaperscissors</span></pre><p id="fab5" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">所有的条件都为真，所以我们会得到旗子</p><p id="1485" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated"><strong class="ll ir">解决方案:</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d9af7eb724e3495a1088f6d8af0dc352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*93-HvwNDAA6An421OQNpcA.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/04a095b44dde6d6a9fc902349fdaad0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*wM02XkBv6QpefrbHsIpZ-w.png"/></div></figure><p id="8d39" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">所以在Netcat中这样做可以获得标志</p><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="4253" class="ng ko iq mg b be nh ni l nj nk">nc saturn.picoctf.net 56981</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/7c20fd345db8a64a495a3664049044e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*6e4A5h80TG4IGY3kiSjv9g.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d032800a8c5dca049ee8562e5deb16e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*HMI95Aj2coVL3_eDi5qrzg.png"/></div></figure><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="86d1" class="ng ko iq mg b be nh ni l nj nk">Ans: picoCTF{50M3_3X7R3M3_1UCK_C85AF58A}</span></pre></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="201d" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">请随时通过LinkedIn提出问题，并为我买一杯咖啡: )</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://buymeacoffee.com/cyberw1ng"><div class="gh gi nt"><img src="../Images/157c0859c9694d9e782f4c1b80b0bedf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bh2JPr6ctTzaPawJ.png"/></div></a></figure><p id="c8b3" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">感谢您的阅读！！</p><p id="02c7" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">快乐剥削~</p><pre class="kg kh ki kj gt nc mg nd bn ne nf bi"><span id="78af" class="ng ko iq mg b be nh ni l nj nk">Author: Karthikeyan Nagaraj ~ Cyberw1ng</span></pre><p id="bf40" class="pw-post-body-paragraph mi mj iq ll b lm nl jr mk lo nm ju ml kw nn mn mo la no mq mr le np mt mu lt ij bi translated">ctf，二进制开发，netcat，pico ctf，2022，捕捉旗帜，挑战，写文章，旗帜，karthikeyan nagaraj，cyberw1ng</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h2 id="d63a" class="kn ko iq bd kp kq kr dn ks kt ku dp kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mh" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>