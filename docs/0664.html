<html>
<head>
<title>Misconfigured S3 Bucket Access Controls to Critical Vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">严重漏洞的错误配置的S3存储桶访问控制</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/s3-bucket-misconfigured-access-controls-to-critical-vulnerability-6b535e3df9a5?source=collection_archive---------1-----------------------#2020-07-02">https://infosecwriteups.com/s3-bucket-misconfigured-access-controls-to-critical-vulnerability-6b535e3df9a5?source=collection_archive---------1-----------------------#2020-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/69fc987094ff85c0c81cbfe2c7fa3b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LYhF_lx-05g4DSSw9FssQQ.png"/></div></div></figure><p id="f941" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">亚马逊S3(简单存储服务)是一种流行和广泛使用的存储服务。许多公司使用S3存储桶来存储他们的资产，如用户资料图片、静态资源以及任何符合其业务逻辑和需求的东西。然而，如果桶没有正确配置，或无人认领，攻击者可能会执行一些有害的行动，如S3桶接管或S3内容接管。</p><p id="58b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗨，各位黑客和爱好者，在这篇文章中，我将谈论最近遇到的一个错误配置的S3桶允许我执行任何CRUD操作，从而导致一个严重的漏洞。</p><p id="5641" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里阅读更多关于亚马逊S3的信息。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="d1ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我测试的应用程序范围很广。这一发现与该计划的一个附属项目有关。姑且称这家子公司为“【subtarget.com】T2”。</p><p id="1b49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我用下面的命令从子域枚举和解析唯一子域开始:</p><blockquote class="le lf lg"><p id="e8d1" class="jy jz lh ka b kb kc kd ke kf kg kh ki li kk kl km lj ko kp kq lk ks kt ku kv ij bi translated">【subtarget.com-silent | httpx-follow-redirects-status-code-vhost-threads 300-silent | sort-u | grep "[200]" | cut-d[-f1&gt;resolved . txt</p></blockquote><p id="9443" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在那里，我找到了一个名为“https://QA-assets-us . subtarget . com”的子域，在导航到这个子域时，我注意到<strong class="ka ir">存储桶是打开的，并且我看到了“</strong> ListBucketResult”</p><p id="341b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，存储桶被用于静态资源，所以没有必要报告这一点，因为有时存储桶是故意打开的(至少他们是这么说的)。</p><p id="aa62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一步是查看下面的条目，它提供了<strong class="ka ir"> S3存储桶的名称:</strong></p><blockquote class="le lf lg"><p id="5c63" class="jy jz lh ka b kb kc kd ke kf kg kh ki li kk kl km lj ko kp kq lk ks kt ku kv ij bi translated"><strong class="ka ir"> &lt;姓名&gt;有人——姓名——此处&lt;/姓名&gt; </strong></p></blockquote><p id="7d14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，下一个过程是测试S3存储桶的访问控制。通常，bucket不得向未授权用户提供以下权限:</p><ul class=""><li id="2c02" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated">在桶上创造一些东西</li><li id="5ab8" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">修改桶上的东西</li><li id="a3e6" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">删除桶上的一些东西</li><li id="0a8b" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">读取铲斗上的一些敏感数据(具体情况具体分析)</li></ul><p id="14f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了测试<strong class="ka ir"> S3存储桶的访问控制，</strong>最好的方法是使用，<strong class="ka ir"> AWS CLI和默认命令。</strong></p><ol class=""><li id="2584" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lz lr ls lt bi translated">安装AWS CLI</li><li id="250c" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lz lr ls lt bi translated">提供AWS访问密钥和密码以配置AWS CLI</li></ol><p id="4f49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，使用以下命令检查我们是否有权在S3存储桶上上传(创建)某些内容:</p><blockquote class="le lf lg"><p id="752e" class="jy jz lh ka b kb kc kd ke kf kg kh ki li kk kl km lj ko kp kq lk ks kt ku kv ij bi translated"><strong class="ka ir">AWS S3 CP yourtest file . txt S3://bucket name</strong></p></blockquote><p id="8fa2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">成功后，您应该会看到类似这样的内容:</p><blockquote class="le lf lg"><p id="cb82" class="jy jz lh ka b kb kc kd ke kf kg kh ki li kk kl km lj ko kp kq lk ks kt ku kv ij bi translated"><strong class="ka ir">上传:。/yourtestfile.txt到S3://bucket name/your test file . txt</strong></p></blockquote><p id="d12f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，在本例中，我成功地将文件上传到了bucket。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="408f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，等等，让我们检查更多的权限以增加影响，让我们删除我们上传的文件，看看它是否有效。使用以下命令来完成此操作:</p><blockquote class="le lf lg"><p id="2d3c" class="jy jz lh ka b kb kc kd ke kf kg kh ki li kk kl km lj ko kp kq lk ks kt ku kv ij bi translated"><strong class="ka ir">AWS S3 RM S3://bucket name/yourtestfile . txt</strong></p></blockquote><p id="298a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们成功删除了文件。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mg mf l"/></div></figure><p id="0697" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，影响增加了，因为<strong class="ka ir">我可以删除原来的资源并上传一个新的攻击者定义的同名资源。无论应用程序在哪里引用该资源，它现在都会显示攻击者定义的资源。</strong></p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="f81e" class="mh mi iq bd mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne bi translated">外卖:</h1><ol class=""><li id="5ce4" class="ll lm iq ka b kb nf kf ng kj nh kn ni kr nj kv lz lr ls lt bi translated">检查S3开放时段并查找时段名称</li><li id="a552" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lz lr ls lt bi translated">使用AWS CLI检查S3存储桶访问控制</li><li id="4ead" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lz lr ls lt bi translated">通过查看所有C.R.U.D(创建、读取、更新和删除)操作来增加影响。</li></ol></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="77e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">时间线:</strong></p><p id="c1bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">报告了公司的&gt;拦截器对影响&gt;进行了分类&amp;被接受为P1 </strong></p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/8db6b3d8456e202556d48061a619f3da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PlQVrho4Yc8raZcSok83FQ.png"/></div></div></figure><p id="bb8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你学到了什么或喜欢阅读，请鼓掌、分享和关注。</p><p id="5230" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">推特:<a class="ae kw" href="https://www.twitter.com/harshbothra_" rel="noopener ugc nofollow" target="_blank">https://www.twitter.com/harshbothra_</a></p><p id="22af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">领英:<a class="ae kw" href="https://www.linkedin.com/in/harshbothra" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/harshbothra</a></p></div></div>    
</body>
</html>