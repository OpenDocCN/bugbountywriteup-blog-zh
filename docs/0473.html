<html>
<head>
<title>How I discovered an interesting account takeover flaw?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何发现一个有趣的帐户接管漏洞？</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-discovered-an-interesting-account-takeover-flaw-18a7fb1e5359?source=collection_archive---------0-----------------------#2020-01-14">https://infosecwriteups.com/how-i-discovered-an-interesting-account-takeover-flaw-18a7fb1e5359?source=collection_archive---------0-----------------------#2020-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="184d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，今天我将谈论一个有趣的帐户接管缺陷，这是我大约一年前发现的。此问题的根本原因在于生成密码重置令牌的算法。</p><p id="c7ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们把这个应用程序看作是<strong class="jp ir">program.com</strong></p><p id="2ace" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像网络上的其他应用程序一样，这个程序也有一个忘记密码的功能。我真的忘记了我的帐户的密码，并要求重置链接，奇怪的是，我注意到，每次我为这个帐户请求重置链接，令牌的前3个字符总是保持不变。这引起了我的注意，我开始挖掘。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="26eb" class="ku kv iq kq b gy kw kx l ky kz">https://program.com/forgot_password/&lt;TOKEN-HERE&gt;</span></pre><p id="bb05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几分钟后，我意识到这三个字符是我的电子邮件的第四封信到第二封信的倒序。例如，假设你有一个电子邮件地址johndoe@domain.com，你要求一个密码重置链接。该帐户令牌的前3个字符将始终是“nho”(没有引号)，应用程序所做的是，它选择电子邮件的第四个字母(n)并以相反的顺序遍历到第二个字母(o)</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi la"><img src="../Images/53a883f09e12ada8db46636e9e290379.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*HJabwSnIwi3rWrAyZAbAdg.png"/></div></figure><p id="5e3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发现这一点后，我想既然token的前3个字符不是随机的，那么剩下的字符可能也有意义。我用这个帐户和另一个测试帐户多次请求令牌，结果是，最后几个字符是时间戳。</p><p id="609e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在唯一需要弄清楚的是“nho”和时间戳之间的两个字符的含义。我做了很多事情，试图分析所有令牌的模式，但一切都是徒劳的。我找不到那两个字的意思(也许它们是随机的？)</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi le"><img src="../Images/d7f18ca85ab7320e7be77df1c38c5668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvrYHQ_7-T2Lc0XVJLSfmg.png"/></div></div></figure><p id="6fb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想为什么不为这两个角色简单地使用暴力呢？幸运的是，这个应用程序没有速率限制。</p><p id="a6ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我同时申请了两个相同的电子邮件地址(johndoe@domain.com和johndoe@domain2.com的密码重置链接。由于我们同时发送了请求，并且电子邮件的用户名部分是相同的，因此发送到两个帐户的令牌将是相同的，除了这两个随机字符。</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi lj"><img src="../Images/038a9cff3961711a0016e1da01a694c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3nuqVE2MllBOj8fyxuNFJw.png"/></div></div></figure><p id="6d33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查了第二封邮件的收件箱，拦截了点击重置链接的请求。然后，我向打嗝的入侵者发出请求，并开始对这两个角色进行暴力攻击。在发送了一些请求后，我看到了302响应，这意味着我能够成功地找到第一个帐户的重置令牌，并最终可以接管该帐户。</p><figure class="kl km kn ko gt lb gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/2c5670cc12c3925d9844e09e30a229b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*lWw4aHWq3fXL-TUIQtVlkA.png"/></div></figure><p id="76f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它被标记为P1/危急。我希望你喜欢这篇文章。</p><p id="f559" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以关注我<a class="ae ll" href="https://twitter.com/0xAkash" rel="noopener ugc nofollow" target="_blank"> @0xAkash </a></p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><p id="b5e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lt">关注</em> <a class="ae ll" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="lt"> Infosec报道</em> </a> <em class="lt">获取更多此类精彩报道。</em></p><div class="lu lv gp gr lw lx"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">信息安全报道</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">medium.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml lc lx"/></div></div></a></div></div></div>    
</body>
</html>