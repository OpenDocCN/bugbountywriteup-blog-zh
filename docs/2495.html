<html>
<head>
<title>How to Assess Active Directory for Vulnerabilities Using Tenable Nessus’ Active Directory Starter Scan Template</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Tenable Nessus的Active Directory Starter扫描模板评估Active Directory的漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-to-assess-active-directory-for-vulnerabilities-using-tenable-nessus-active-directory-starter-74b8bce2218a?source=collection_archive---------1-----------------------#2022-11-02">https://infosecwriteups.com/how-to-assess-active-directory-for-vulnerabilities-using-tenable-nessus-active-directory-starter-74b8bce2218a?source=collection_archive---------1-----------------------#2022-11-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/11e7856b23eee146e02bf09c66760cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bqx_uwhmLgXQP0ahnu_vTA.jpeg"/></div></div></figure><p id="22e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Tenable的Nessus漏洞扫描器是一种广为人知的工具，用于对网络和设备(如工作站、网络设备和服务器)进行漏洞评估。虽然Tenable有一个单独的Active Directory安全产品Tenable.ad，但Nessus(以及他们的企业解决方案Tenable.io)的一个很少被提及的功能是扫描Active Directory配置以发现漏洞。</p><h1 id="0948" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">漏洞覆盖率</h1><p id="2a8e" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">Nessus中包含一个名为“Active Directory Starter Scan”的扫描模板。出于某种原因，很难找到关于此模板的详细信息，但是，<a class="ae mc" href="https://www.tenable.com/blog/new-in-nessus-find-and-fix-these-10-active-directory-misconfigurations" rel="noopener ugc nofollow" target="_blank">根据Tenable </a>的一篇博客文章，此扫描对您的Active Directory配置运行以下十项检查:</p><ol class=""><li id="030a" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated"><strong class="kd iu">Kerberos认证:</strong>域管理员或企业管理员帐户容易受到Kerberos认证攻击</li><li id="07ac" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu">脆弱的Kerberos加密</strong>:Kerberos加密在一个用户帐户上太脆弱，导致潜在的凭证盗窃</li><li id="a6f6" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu"> Kerberos预认证验证:</strong>Kerberos预认证在一个用户帐户上被禁用，导致潜在的凭据被盗</li><li id="209b" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu">不过期的帐户密码:</strong>用户帐户可能永远不会更新其密码。</li><li id="c88a" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu">不受约束的委派:</strong>不受约束的委派在允许潜在的凭证盗窃的计算机帐户上是允许的</li><li id="c980" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu">空会话:</strong>Anonymous或Everyone组是允许空会话攻击的“Pre-Windows 2000 Compatible Access”的一部分</li><li id="9b16" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu">Kerberos KRBTGT:</strong>Kerberos主密钥太旧，可能会被用作后门</li><li id="569d" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu">危险的信任关系:</strong>在允许跨AD域横向移动的信任关系上没有激活任何安全机制</li><li id="21ac" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu">主要组ID完整性:</strong>在用户帐户上发现了使用组ID的潜在后门</li><li id="93bf" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><strong class="kd iu">空白密码:</strong>用户帐户可以使用空白密码在域上进行身份验证</li></ol><h1 id="f731" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">创建凭据</h1><p id="e9d7" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在使用Nessus设置Active Directory Starter扫描之前，您需要<a class="ae mc" href="https://docs.tenable.com/nessus/Content/Miscellaneous.htm" rel="noopener ugc nofollow" target="_blank">以ADSI </a>的形式向Nessus提供域管理员凭证。为此，我建议创建一个服务帐户供Nessus使用。</p><ol class=""><li id="2469" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">我在Active Directory中创建了一个名为“NessusScan”的新用户</li></ol><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/749a496c219a2221c15024357193d82f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*2sbv27TsBstmtwbCz7h20g.png"/></div></figure><p id="9ba6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.将用户帐户添加到“域管理员”组</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/15be6390fd5ccd6768e3dac68f3b7414.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*8wBY78mgWRgB0kwbK5OP4w.png"/></div></figure><h1 id="5d7a" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">配置扫描</h1><ol class=""><li id="3f04" class="md me it kd b ke lx ki ly km mx kq my ku mz ky mi mj mk ml bi translated">如果使用Nessus，请创建新的扫描</li></ol><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/f5598280330d7b6f3c86efe58efd1b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVwRnKm1fn0IF78RU62htg.png"/></div></div></figure><p id="5e01" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.选择“Active Directory启动程序扫描”</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/928e446d91c1d76f2cbdfe24ddce86d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVo3GyCn48wxnFmXoF-8jw.png"/></div></div></figure><p id="8ec8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.在“目标”下，输入域控制器的IP地址</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/7b4c97334f0ae43aa567fd269aa09ae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMjlq-bAdsei1dWRfi39aA.png"/></div></div></figure><p id="837f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.在凭据下，选择杂项类别，然后选择ADSI</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/0f0cbc09562b07b74f374a7344b894d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmBpZZyk9j2bbglCHa2SmQ.png"/></div></div></figure><p id="c5ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">四个必填字段是:</p><ul class=""><li id="0401" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky ne mj mk ml bi translated"><strong class="kd iu">域控制器:【ActiveSync的域控制器的名称</strong></li><li id="54e3" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky ne mj mk ml bi translated"><strong class="kd iu">域:【ActiveSync的NetBIOS域名</strong></li><li id="e21f" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky ne mj mk ml bi translated"><strong class="kd iu">域管理员:</strong>域管理员的用户名</li><li id="c9ad" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky ne mj mk ml bi translated"><strong class="kd iu">域密码:</strong>域管理员的密码</li></ul><p id="6e11" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于我的实验室，这看起来如下:</p><ul class=""><li id="8ae1" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky ne mj mk ml bi translated"><em class="nf">DC实验室</em></li><li id="ff86" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky ne mj mk ml bi translated"><em class="nf"> SECLAB </em></li><li id="012d" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky ne mj mk ml bi translated"><em class="nf">尼斯坎</em></li><li id="ce8e" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky ne mj mk ml bi translated"><em class="nf">*密码* </em></li></ul><p id="0a5e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">5.保存扫描并单击“启动”，或者在配置期间使用时间表功能</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/157a098f52ff920be792e247ed7f31ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3Pa6UvNwAV4jPb-SzahDg.png"/></div></div></figure><h1 id="ac8c" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结果</h1><p id="e911" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">将结果导出为HTML报告后，我们可以看到两台主机从扫描中返回:作为IP的活动目录域控制器和活动目录域控制器配置(在我的例子中，是DC实验室)。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/2cbef86c6e85c8ff5976fea9093b7298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1cvH9W7uOHaMfR1yhzS1Q.png"/></div></div></figure><p id="fd36" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">看一下DC资产实验室，我们看到了我有目的地引入到我的活动目录安全实验室环境中的各种漏洞。在这种情况下，我们的广告扫描发现了1个高严重性漏洞和3个中等严重性漏洞。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/d867cae7c0f720fe2f565e0269d78f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CuxBhvwLalRktsQ26I9p8g.png"/></div></div></figure><h2 id="4996" class="nj la it bd lb nk nl dn lf nm nn dp lj km no np ln kq nq nr lr ku ns nt lv nu bi translated">Kerberoasting</h2><p id="b37f" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们发现的高严重性漏洞是Kerberoasting认证。这是因为我们有一个或多个与服务主体名称(SPN)相关联的帐户，使得凭证容易受到暴力攻击。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/fca1c73a9f0deb1ea46d0f0517f474c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N1kQBLB5gAhdsDknwbwnYQ.png"/></div></div></figure><p id="7e35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要查看哪些帐户受到影响，我们可以向下滚动到输出部分。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/500634384d65af87671eb2b7d2a12f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BttZ55x8PPm_EkLI5sOdbQ.png"/></div></div></figure><h2 id="e669" class="nj la it bd lb nk nl dn lf nm nn dp lj km no np ln kq nq nr lr ku ns nt lv nu bi translated">Kerberos预认证验证</h2><p id="f3a6" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">发现的第一个中等严重性漏洞是(缺失)Kerberos身份验证前验证。这是创建新用户帐户时默认启用(并且应该启用)的设置，但是也可以将其关闭。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/cc8103f18c041a6169a69617abb38823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*da4crJIQdoT6T1ygrJL92g.png"/></div></div></figure><p id="5b01" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要查看哪些帐户受到影响，我们可以向下滚动到输出部分。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/7c38267d04211c315f0c0deea1a1695f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y6PaAE94MmGTdHAYCQFr0w.png"/></div></div></figure><h2 id="c6af" class="nj la it bd lb nk nl dn lf nm nn dp lj km no np ln kq nq nr lr ku ns nt lv nu bi translated">不过期的帐户密码</h2><p id="8769" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们发现的第二个中等严重性漏洞是过期帐户密码，这些帐户的密码不会过期，因此可以长时间保持不变。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/910669e38bceadb3843914c2c596c24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s3EoOEUJ9ohQ6tg4KSDY6A.png"/></div></div></figure><p id="39c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要查看哪些帐户受到影响，我们可以滚动到输出部分。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/91a4d0aafd96c53e2ac83982dd991e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Y87364KaE4IVFBGotF7wg.png"/></div></div></figure><h2 id="d868" class="nj la it bd lb nk nl dn lf nm nn dp lj km no np ln kq nq nr lr ku ns nt lv nu bi translated">弱Kerberos加密</h2><p id="66e5" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们发现的第三个也是最后一个中等严重性的漏洞是弱Kerberos加密。Kerberos可以配置为使用各种加密方法。仍然可以将帐户配置为使用DES加密，这是不安全的。默认情况下，新帐户不会被配置为使用DES。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/a1e6218cf7c3b56e7e3f877f43b6d046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2C8VHUhxzLqYURMJ4Gd2qw.png"/></div></div></figure><p id="aebb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要查看哪些帐户受到影响，我们可以滚动到输出部分。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nz"><img src="../Images/12a94e3797d41d5831b52e2aff398f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-VpF8hmlkop5NC_Ej6ZsWA.png"/></div></div></figure><h1 id="9db5" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="b061" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">Nessus和Tenable.io等其他Tenable产品被安全专业人员广泛用于进行漏洞评估。但是，有许多强大的功能，例如审计Active Directory配置，但这些功能通常不会被利用。下次如果您需要快速了解活动目录配置的安全问题，请使用Nessus扫描仪！</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><h2 id="04df" class="nj la it bd lb nk nl dn lf nm nn dp lj km no np ln kq nq nr lr ku ns nt lv nu bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mc" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>