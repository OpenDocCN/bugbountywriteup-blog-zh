<html>
<head>
<title>Complete take-over of Cisco Unified Communications Manager due consecutively misconfigurations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">由于连续的错误配置，思科统一通信管理器被完全接管</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/complete-take-over-of-cisco-unified-communications-manager-due-consecutively-misconfigurations-2a1b5ce8bd9a?source=collection_archive---------1-----------------------#2022-09-24">https://infosecwriteups.com/complete-take-over-of-cisco-unified-communications-manager-due-consecutively-misconfigurations-2a1b5ce8bd9a?source=collection_archive---------1-----------------------#2022-09-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a429d18fa02dc3e656fd188c988ddffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-ZWBFwxSPCx2jwdP.jpg"/></div></div></figure><p id="3ca1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在那里，这个路线图被开发来显示利用设备中的错误配置，个人可以完全接管管理控制系统。在本文中，我们将介绍思科VOIP电话和统一CM。</p><blockquote class="kw kx ky"><p id="cf62" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><a class="ae ld" href="https://www.cisco.com/c/en/us/products/unified-communications/unified-communications-manager-callmanager/index.html" rel="noopener ugc nofollow" target="_blank">产品概述</a>:思科统一通信管理器(CallManager)</p></blockquote><p id="8ceb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在内部网络上识别的范围内的内部侦察阶段，在激活所有主机后，在端口80和443上查找webapps是一个良好的开端，我能够通过抓取<a class="ae ld" href="https://nmap.org/nsedoc/scripts/http-title.html" rel="noopener ugc nofollow" target="_blank"> http-title nmap nse脚本</a>的结果来识别暴露于内部网络的所有VOIP电话设备。</p><p id="2023" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Cisco VOIP电话的公开web界面如下所示:</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi le"><img src="../Images/dce108f0b99cc70099ad33e93e8bfb40.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*ppmmgOeGReADtj93-INHVg.png"/></div></figure><p id="d294" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一些型号容易出现<a class="ae ld" href="https://sec-consult.com/vulnerability-lab/advisory/vulnerabilities-in-cisco-voip-phones-cve-2018-0461/" rel="noopener ugc nofollow" target="_blank">公开披露的已知漏洞</a>，但所有型号都打了补丁。</p><p id="f7b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在花了大量时间阅读我能接触到的所有设备的文档后，我发现如果VOIP电话配置没有采用默认值，并且没有加强安全性，它可能会泄漏一些有趣的信息。</p><p id="78b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，只要进入门户网站，我就可以阅读电话日志，在日志中，我可以找到带有调试信息的电话呼叫，这使我可以通过解析日志在列表中添加更多目标。我还可以从设备上下载完整的电话配置文件和思科UCM的未加密配置文件。</p><p id="0956" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们执行安全审计时，专注于阅读大量文档(我鼓励您也这样做，因为这样会让生活更轻松)，我找到了制造商的以下文章:</p><blockquote class="kw kx ky"><p id="5d6c" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">从CUCM获取手机配置文件的两种方法。</p></blockquote><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lj"><img src="../Images/2152d97d0e5bbf4388ed7b69d2b4257f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2o5X9bRr_ixbeCVCzblTyQ.png"/></div></div></figure><p id="9804" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在的问题是，我们从哪里获得呼叫管理器的IP？</p><p id="c3b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在VOIP电话暴露的网络面板中，许多IP地址被披露，我只是从目标列表中的所有设备上收集了所有地址，并扫描了所有这些IP地址，以搜索文档中所说的开放端口6970。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/fae77bda4a925e1d3c0b77e6a6cda358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*F8BFh-DJGbKoOAiydumvog.png"/></div></figure><p id="d7a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">经过几次测试后，我确认我找到了将为我们提供配置文件的API端点地址。在这些文件中，我们可以获得SSH和LDAP凭证。</p><p id="be45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我只是构建了一个脚本，用上面描述的黄金数据得到一个漂亮的终端打印。</p><ol class=""><li id="928b" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated">蜘蛛所有网络VOIP电话门户网站。</li><li id="4638" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">提取MAC地址。</li><li id="4da8" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">精心制作链接以获取配置文件。</li><li id="99bd" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">下载并解析配置文件。</li><li id="0633" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">以漂亮的方式打印重要数据。</li></ol><p id="83fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只需运行<code class="fe lz ma mb mc b">python3 ciscophonecfg.py -iL voip-phone-addr.txt</code></p><figure class="lf lg lh li gt jr"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="e45d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该脚本将读取目标voip电话文件(每条<br/>线一个电话)，然后将在暴露的门户网站上做一点刮擦，然后<br/>将基于上述详细信息建立链接。该脚本将从配置文件中提取关键数据。然后将显示每台设备的摘要。</p><p id="bf7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我开发的代码输出将信息打印为手机所有者的全名、SSH凭证和一个“密钥文件”。最后一个参数非常有趣，因为它在所有设备中都是相同的链接。这是配置管理器文件。</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/4245ea7707ecf516bbd9660507374922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpHgNuYltfNp45I0L21UJQ.png"/></div></div></figure><p id="24dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该密钥文件包含思科UCM的LDAP证书和其他非常有趣的信息。根据官方文件，这个文件可以从思科UCM配置加密，但由于配置错误，这个选项没有启用，并允许我们以明文读取文件。获取配置文件语法是:</p><p id="040c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ld" href="http://ip_callmanager:6970/@serviceProfileFile_value" rel="noopener ugc nofollow" target="_blank">http://IP _ call manager:6970/@ service profile file _ value</a></p><p id="def0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中@serviceProfileFile_Value是类似于<strong class="ka ir">SPD 95 f 326 b-655 f-2a 44-d529–78e 891d 75 b 26 . cn f . XML</strong>的文件名</p><p id="b6f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">至此，我们已经有了Cisco电话和管理系统使用的SSH和LDAP凭证。为了以防万一，我尝试使用在Cisco Unified communication s Manager门户中收集的信息登录，幸运的是，由于重复使用了凭据，我能够以管理员身份登录:</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/a02fe0ffcf82843ff453eb9db1e4fad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2m1rr5jHWEqw5_dLvCTlMw.png"/></div></div></figure><p id="7ee3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种错误配置还导致了其他一些行为，比如使用在旅途中开发的自定义脚本转储所有电话号码簿:</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/7bf76a9a7c94d65f5bcdbf142a4e658e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGjTSvWNOg6IHws0Ls7mZw.png"/></div></div></figure><p id="6cdd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在其他主机中重复使用SSH信用凭证:</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/ddf043388ced2626e21d82c0625e05bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*_Cm9cHL5MWeucTHjNpap1w.png"/></div></figure><p id="9219" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以及使用从未加密密钥文件中提取的思科UCM的LDAP凭证对Samba共享进行读写访问:</p><figure class="lf lg lh li gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/fefa01aa6fd162400d44bb8d4ea77092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMYtwCcBt4aeV_4fYxi7Iw.png"/></div></div></figure><h1 id="4149" class="mk ml iq bd mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh bi translated">参考</h1><div class="ni nj gp gr nk nl"><a href="https://www.cisco.com/c/en/us/td/docs/voice_ip_comm/cuipph/MPP/8800/english/AG/p881_b_8800-mpp-ag_new/p881_b_8800-mpp-ag_chapter_01.html" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">思科IP电话8800系列11.3(1)版和更高版本的多平台电话管理指南…</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">如果启用了该参数，则电话GUI会在以下情况下接受相关参数的用户访问属性</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.cisco.com</p></div></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://www.cisco.com/c/en/us/support/docs/unified-communications/unified-communications-manager-callmanager/200769-Two-Ways-to-Obtain-a-Phone-s-Configurati.html" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">从CUCM获取手机配置文件的两种方法</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">本文档描述了两种获取手机配置文件的方法。要求手机的…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.cisco.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jw nl"/></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://www.cisco.com/c/en/us/td/docs/voice_ip_comm/cucm/security/11_5_1/secugd/CUCM_BK_SEE2CFE1_00_cucm-security-guide-1151/CUCM_BK_SEE2CFE1_00_cucm-security-guide-1151_chapter_0111.html" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">思科统一通信管理器安全指南，版本11.5(1) -电话安全配置文件…</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">Unified Communications Manager管理将电话类型和协议的安全相关设置分组到…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.cisco.com</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz jw nl"/></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://www.cisco.com/c/en/us/support/docs/unified-communications/unified-communications-manager-callmanager/213527-changing-cucm-os-admin-and-security-pass.html" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">重置或更改CUCM操作系统管理员和安全密码</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">本文档介绍了如何重置或更改操作系统管理员密码和安全密码。思科建议您拥有…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.cisco.com</p></div></div><div class="nu l"><div class="ob l nw nx ny nu nz jw nl"/></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://www.cisco.com/c/en/us/support/docs/unified-communications/unified-communications-manager-callmanager/118929-technote-cucm-00.html" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">在CUCM上启用加密配置功能</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">本文描述了在Cisco统一通信管理器上使用加密的配置电话文件…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.cisco.com</p></div></div><div class="nu l"><div class="oc l nw nx ny nu nz jw nl"/></div></div></a></div><figure class="lf lg lh li gt jr"><div class="bz fp l di"><div class="od me l"/></div></figure></div><div class="ab cl oe of hu og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ij ik il im in"><h2 id="3331" class="ol ml iq bd mm om on dn mq oo op dp mu kj oq or my kn os ot nc kr ou ov ng ow bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ld" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>