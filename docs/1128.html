<html>
<head>
<title>RCE on a Laravel Private Program</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RCE参加了一个私人项目</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/rce-on-a-laravel-private-program-2fb16cfb9f5c?source=collection_archive---------0-----------------------#2021-02-20">https://infosecwriteups.com/rce-on-a-laravel-private-program-2fb16cfb9f5c?source=collection_archive---------0-----------------------#2021-02-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ed3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近的<a class="ae kl" href="https://nvd.nist.gov/vuln/detail/CVE-2021-3129" rel="noopener ugc nofollow" target="_blank"> Laravel CVE </a>使得远程攻击者能够利用使用Laravel的网站中的RCE缺陷。我已经阅读了<a class="ae kl" href="https://www.ambionics.io/blog/laravel-debug-rce" rel="noopener ugc nofollow" target="_blank">的文章</a>关于使用Laravel上点火库的开发过程。顺便说一下，这个帖子最初是在<a class="ae kl" href="https://zdresearch.com/rce-on-a-laravel-private-program/" rel="noopener ugc nofollow" target="_blank">这里</a>发表的，我也决定把它放在中型网站上。</p><p id="a464" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我浏览了我们的recon数据库，其中包含许多web应用程序的域和子域。我们建立了这个系统来抓虫子。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/f47c0f4e4f283aa1151b47dfe3563e0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWlIwq_jkn7BRuavN7ygOg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">包含域和资产的bug bounty数据库</figcaption></figure><p id="10df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有大约52.6万个实时资产需要过滤。方法很简单，向所有资产发送HTTP请求，寻找匹配的Laravel签名。MEG是获取大量URL的好工具。但是，我们运行的工具与MEG相似:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lc"><img src="../Images/46b186e37cd01dfd8cddbd951480df03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x7Xfdxt95RLVIUjPMHHqUQ.png"/></div></div></figure><p id="f411" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用20个线程运行脚本，寻找状态代码200和“text/html”内容类型。结果与各自的响应一起保存在不同的目录中</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ld"><img src="../Images/1f8a603dd7d642059d51555fef5bbbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4FMNzGKopqnRLJxTTgNOA.png"/></div></div></figure><p id="e02e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有许多方法可以检测Laravel，我通过以下命令找到了几个匹配项:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi le"><img src="../Images/30d0d62f69b8d92280d7c3c50439dd78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B64nrVpvYZWGClYizoPrmg.png"/></div></div></figure><p id="7e68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我一个一个地检查它们，看它们是否点火。</p><p id="5788" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个有趣的案例是我们最近发现的一个私人项目。由于道德问题，我不能说出网站/公司的名称，因此将编辑名称和网址。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lf"><img src="../Images/307ba05e4cb2e7843f146d419cb21bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f6dDhvpexq_RJ_zAajAaTA.png"/></div></div></figure><p id="0608" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我总是做的第一件事是检查web应用程序是否在调试模式下运行。有许多方法可以做到这一点。在Laravel上对我来说最方便的一个方法是向端点发送允许的HTTP方法(<a class="ae kl" href="https://laravel.com/docs/8.x/routing" rel="noopener ugc nofollow" target="_blank">需要更多信息吗？</a>)。</p><p id="f767" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我只是在向登录端点发送凭证时将POST方法更改为PUT，它返回了Laravel的调试错误，确认应用程序启用了调试模式:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lg"><img src="../Images/3fefc65145c96475edabc426f10d346f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gvk6IUIhVHbiVtIKOk76oA.png"/></div></div></figure><p id="c889" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以通过调试消息获得Laravel的版本，以及PHP和服务器操作系统和其他显示错误消息的额外信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lh"><img src="../Images/8cfff598284d0f6b2dae63df979d3945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qt6yhy-lkThDTUhG0ceEeQ.png"/></div></div></figure><p id="4765" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于私有程序的Laravel版本高于6，并且它也运行Ignition，我决定测试这个漏洞，幸运的是日志文件在默认路径上，我可以通过<a class="ae kl" href="https://github.com/ambionics/laravel-exploits" rel="noopener ugc nofollow" target="_blank">这个漏洞</a>利用它:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi li"><img src="../Images/0665a07d691f7f6132104308ef7def71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GhuVqNy87hfRJAboh4M2xQ.png"/></div></div></figure><p id="b579" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，如果日志文件路径不在默认位置，我将不得不强行猜测路径或尝试第二种方法，即使用FTP与PHP-FPM对话。</p></div></div>    
</body>
</html>