<html>
<head>
<title>Tryhackme Lazy Admin Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tryhackme惰性管理演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-lazy-admin-walkthrough-4da1b4854c40?source=collection_archive---------1-----------------------#2021-01-12">https://infosecwriteups.com/tryhackme-lazy-admin-walkthrough-4da1b4854c40?source=collection_archive---------1-----------------------#2021-01-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/548dd188ee17b5e11991ad72c89237b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0YcAu-3OP-idLx0zjSvPQ.jpeg"/></div></div></figure><p id="b687" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">玩家们好，在这个博客中我已经介绍了tryhackme中的<a class="ae kw" href="https://tryhackme.com/room/lazyadmin" rel="noopener ugc nofollow" target="_blank">懒惰管理</a>框，这是另一个初学者级别的机器，将涉及下面提到的主题</p><p id="1ca1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1.情报收集</p><p id="c2ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.扫描和计数</p><p id="8fca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.剥削</p><p id="ba58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.用户级访问</p><p id="19d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5.权限提升</p><p id="e7ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">6.根访问</p><p id="aeae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你不喜欢看博客，那就看视频吧</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div></figure><p id="cc18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像往常一样，将连接到tryhackme VPN并部署目标机器</p><h2 id="528d" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated"><strong class="ak">信息收集</strong></h2><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/12e909878edfed190e56a2b388d5b83a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*iWzSpci8YsyX9ULRUYJK8Q.png"/></div></figure><p id="1537" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们使用以下命令开始基本的Nmap扫描</p><p id="5fa1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">T4 Pn<machine ip=""/></p><p id="f0ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过这次扫描，我们得到了一些结果</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/c7a6319ece226ae6cdc3b5dfc99c5ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*IqHSnrZEvWZCUsoWvyW4-A.png"/></div></figure><p id="d48f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从上面的结果我们可以得出结论，有一个http服务正在机器上运行，让我们检查该服务，并开始枚举它。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/e42845eae90bce79667ac91e4767bbf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Q6Aj8BNMjWlk_hWOOHAfXA.png"/></div></figure><p id="d8b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于枚举，我们将使用我们最喜欢的工具gobuster找到web服务器的隐藏目录。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/6427419b75e5e2f330efb754e3081398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*BjB3mPirVaTRwPrgIhKWSA.png"/></div></figure><p id="9167" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从gobuster扫描中，我们发现有一个名为content lets check的目录</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/d417103fd45589689ad9a88e5ea9473f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*6B-zLXOpr_jL3tKvYb3k9A.png"/></div></figure><h2 id="0c7a" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">扫描和计数</h2><p id="7387" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">我想它有一个CMS面板，名为sweet rice，让我们进一步检查内容端点。为此，我们将再次使用gobuster工具来找出答案</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/30268eda3e8eb394bd3cc5a9b23d09bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*KdJ-_ZrYGKJQXH1mHQt_cA.png"/></div></figure><p id="58ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在gobuster扫描之后，我们发现了一些有趣的文件夹，其中有一个非常有趣的文件夹叫做/inc，让我们来看看它有什么</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/817a05f14ae8b4ba60f32c43d8e103e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Kgyt8QHbSKjEPe2JKby_fQ.png"/></div></figure><p id="df07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太好了，它有一个数据库相关的文件，让我们在这里检查mysqlbackup文件夹。它包含一个MYSQL备份文件，让我们下载它，看看它是否有任何有趣的信息</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/c5cb689693e9b5fec23f3cb2c97ca213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*l0TGCWLWAdEbZ0sJPmBEMg.png"/></div></figure><p id="0624" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同时，我们的gobuster扫描还发现了另一个名为/as的端点，它有一个用于sweet rice CMS的登录面板</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/55175d08c8a07ae767992f9d2a38fa46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*yWO9LuK7tHbixkMmyA1Bxw.png"/></div></figure><p id="d153" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的，它要求凭据，默认凭据在这里不起作用，所以我将检查我们从MYSQL备份文件夹中获得的备份SQL文件，幸运的是，它有一个经理角色的凭据</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/da772ad665c72fa2a3ebef5e79bc48c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*m6k-PG4QDyD8xfyJs598Dw.png"/></div></figure><p id="28a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是这里的密码是散列的，所以我们将使用<a class="ae kw" href="https://crackstation.net/" rel="noopener ugc nofollow" target="_blank">破解站</a>网站，通过使用这个我们找到了纯文本密码</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/c7bfba995aca0238bb212cb4da99637d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*HOSsV_b4Ij8FWnHtqCDTlg.png"/></div></figure><p id="1434" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用此凭据，我们已成功登录CMS面板</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/566b810f48e72d7f0b78c4bc02bbd2ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*nZgBUDxYLPLx024t_YJdEA.png"/></div></figure><p id="893c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是探索应用程序的时候了，在了解应用程序后，我创建了一个名为“ads”的功能，它具有将我们的php代码上传到网站的功能，所以这是我们感兴趣的地方。因此，现在我们将上传我们著名的反向shell代码，其中包含用于连接的机器IP和端口，并进行反向连接</p><h2 id="71f0" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">剥削</h2><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/2b880c4344c76ab42d9781f7f0bbeea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*9PpFVDXbp_mWjagQhK7kRQ.png"/></div></div></figure><p id="c147" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们启动Netcat监听器。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/7b4802008af364a15bf31f49bf00fa23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*qmyLtCUgagyu-2FF6Vo9yw.png"/></div></figure><p id="c062" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在访问文件的端点，您将得到一个反向的shell连接</p><p id="f03d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://machineip/content/inc/ads/" rel="noopener ugc nofollow" target="_blank">https://machine IP/content/Inc/ads/</a></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/c9ad0680d17992a5400698b699706e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*A8jCjab094ASH7sxYOeNJQ.png"/></div></figure><p id="3752" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在点击文件你将成功地获得Netcat上的反向连接。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/f5162d3853ac04dfbc2143b3d4bd6ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*SwmFnoG_JVCuU8OybnPq5Q.png"/></div></figure><p id="6f0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是获取用户标志的时候了，但是我没有在这里包含这个标志。但是可以通过cat命令获得。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/53f57fb9926e0a0600eb94452a91ab36.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*FhX2nOLrXHhMsOED0IozLQ.png"/></div></figure><h2 id="798a" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">权限提升</h2><p id="493d" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">现在是获取根特权和根标志的时候了，所以我开始枚举sudo权限。通过检查，我发现backup.pl文件可以使用我们的用户的sudo权限运行</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/762b548e3442d03a5ee70e05e32b02d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*gbNzOXCqnpYpRnNtDGWqpQ.png"/></div></figure><p id="0bab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们需要检查文件内容是什么，并发现它调用了一个copy.sh文件</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/cba4f4332933498c31ae738723f0db63.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*bSwS3Ue7YEu13eILGgXd9g.png"/></div></figure><p id="8c5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要检查copy.sh文件到底有什么，打开文件后，我们可以看到机器创建者制作的反向外壳代码，所以我们要做的只是将现有IP更改为我们的IP</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/3c30c2bf5c13a942b54b0c3e68828c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*O4pb_RrDx2sMeEzzgApdLw.png"/></div></figure><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/457a06a1cf7cd78c45ef2523159cd2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*ouRWyFvJPCtLvSA8sRM6dA.png"/></div></figure><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/4f2d70361cfefed3d8f321c308d87f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*oktZXEQeFrzQtP7bkF5Jcg.png"/></div></figure><p id="1ddf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，该文件对所有用户都有执行权限，所以让我们启动Netcat监听器来获得一个根shell连接</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/7c9362a6d0e7a6f2bead5faf5cba33c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*tvixWXvbtuAS8pbnjBL1iA.png"/></div></figure><p id="359c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将使用sudo权限运行backup.pl文件</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/44c4307f1de34b820af00c9f506757a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*g9jbo1T0gzeAPScu2YyV7A.png"/></div></figure><p id="58c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过使用sudo权限运行该文件，我们成功地从根用户那里获得了一个反向外壳。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/032fce61631101165c237a096ba21bbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*T1qWz7CEt-6mEt78JzPsfQ.png"/></div></figure><p id="8fa6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是时候设置一个根标志了，我不会在这里显示这个标志，您可以通过cat命令查看它</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/7d7acabad68e8ef27a689b0388f71aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*a1SgLRM_pB-MatCUGkMxCA.png"/></div></figure><p id="dcdc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是非常简单的初学者友好的机器，我希望你能学到一些新概念…祝黑客快乐，再见…</p></div></div>    
</body>
</html>