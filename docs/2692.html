<html>
<head>
<title>❗️Capture The Ether ❗️— Token Sale [Difficulty = Low-Medium]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">❗️Capture以太❗️—代币销售[难度=中低]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/%EF%B8%8Fcapture-the-ether-%EF%B8%8F-token-sale-difficulty-low-medium-adc2928bbcc9?source=collection_archive---------5-----------------------#2022-12-23">https://infosecwriteups.com/%EF%B8%8Fcapture-the-ether-%EF%B8%8F-token-sale-difficulty-low-medium-adc2928bbcc9?source=collection_archive---------5-----------------------#2022-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="7606" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">[注意] —如果你直接阅读这篇博客，而没有实际参与这个挑战，它对你没有帮助。我请求你尽最大努力，如果你面临任何困难，就回来。</p><blockquote class="ks kt ku"><p id="1b0b" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated"><strong class="jw ir">简介</strong>:</p></blockquote><p id="3d04" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你好，Hackers🥰，欢迎回到我们的Web3安全世界。今天我们将讨论“数学部分”的第一个挑战——代币销售。在我看来，这个挑战属于中低级别。但是，可能因人而异。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/b4c6b8586c498f930fff3186ce15f9e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UD79vNva_kUIBmT_"/></div></div></figure><blockquote class="ks kt ku"><p id="2481" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated"><strong class="jw ir">在尝试这个挑战之前，你需要知道些什么？</strong></p></blockquote><p id="1814" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的第一个也是最重要的建议是浏览“智能合同程序员”的视频，他详细解释了“溢出和下溢”漏洞。</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="ll lm l"/></div></figure><blockquote class="ks kt ku"><p id="6dd5" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated"><strong class="jw ir">现在让我们开始我们的挑战:</strong></p></blockquote><p id="2231" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">问题说，“这个代币合约允许你以每以太1代币的平均汇率买卖代币。</p><p id="bd36" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">合同开始时余额为1以太。看看你能不能带走一些。"</p><p id="7485" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">简单来说，<strong class="jw ir">这是一份交换合同，我们可以按照某种特定的比例(1:1) </strong>买卖代币。</p><ul class=""><li id="8c7e" class="ln lo iq jw b jx jy kb kc kf lp kj lq kn lr kr ls lt lu lv bi translated">比如<strong class="jw ir">如果我想买10个代币，我需要向交易所缴纳10个ETH。同样的，如果我持有100枚代币，卖掉后，我的账户里会有100枚代币。</strong></li><li id="e423" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">最初合同持有1 ETH，我们的目标是使合同余额少于1 ETH。</li></ul><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi mb"><img src="../Images/a578835836ea84227d66a203a5d2e83f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GkfxJwghPZ5P3lR1_3shg.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated"><strong class="bd mg">实利^0.8.0文件</strong></figcaption></figure><p id="8243" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">“如果你清楚地观察第一行，它说，对于uint32，它能容纳的最大值是2-1。”</p><ul class=""><li id="c105" class="ln lo iq jw b jx jy kb kc kf lp kj lq kn lr kr ls lt lu lv bi translated">如果我们把这个值增加1呢？很简单，它归零。</li></ul><blockquote class="ks kt ku"><p id="100a" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated"><strong class="jw ir">合同评审:</strong></p></blockquote><pre class="la lb lc ld gt mh mi mj bn mk ml bi"><span id="9826" class="mm mn iq mi b be mo mp l mq mr">pragma solidity ^0.4.21;<br/><br/>contract TokenSaleChallenge {<br/>    mapping(address =&gt; uint256) public balanceOf;<br/>    uint256 constant PRICE_PER_TOKEN = 1 ether;<br/><br/>    function TokenSaleChallenge(address _player) public payable {<br/>        require(msg.value == 1 ether);<br/>    }<br/><br/>    function isComplete() public view returns (bool) {<br/>        return address(this).balance &lt; 1 ether;<br/>    }<br/><br/>    function buy(uint256 numTokens) public payable {<br/>        require(msg.value == numTokens * PRICE_PER_TOKEN);<br/><br/>        balanceOf[msg.sender] += numTokens;<br/>    }<br/><br/>    function sell(uint256 numTokens) public {<br/>        require(balanceOf[msg.sender] &gt;= numTokens);<br/><br/>        balanceOf[msg.sender] -= numTokens;<br/>        msg.sender.transfer(numTokens * PRICE_PER_TOKEN);<br/>    }<br/>}</span></pre><ul class=""><li id="4ac3" class="ln lo iq jw b jx jy kb kc kf lp kj lq kn lr kr ls lt lu lv bi translated">首先，有3个函数(不包括构造函数)，即“isComplete()、buy()、sell()”。如果查看状态变量，会发现有一个映射，其中存储了每个地址持有的令牌数。和设置为1的常量变量。</li><li id="3c90" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">如果你擅长稳健，你也可以看到“没有可重入性漏洞的痕迹”。<strong class="jw ir">你应该记住“0.8.0之前的所有版本都容易出现上溢/下溢问题，除非它们使用数学库。”</strong></li><li id="0992" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">在buy()函数中，它的输入是“uint256 ”,这意味着它能容纳的最大值是(2 ⁵⁶ — 1)。如你所知，合同是1:1的比例，我们不能送那么多乙醚。</li></ul><p id="1f35" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">[注意] — EVM(以太坊虚拟机)将任何值转换为其低级值，这意味着“1 eth转换为10 ⁸的低级值”</p><ul class=""><li id="0c7a" class="ln lo iq jw b jx jy kb kc kf lp kj lq kn lr kr ls lt lu lv bi translated">现在让我们回到我们的声明。然而，我们不能发送uint256值，但是如果我们发送这个呢？<strong class="jw ir">【解释到底】</strong></li></ul><p id="f467" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">:2⁵⁶—1/10⁸</strong>:t0】</p><p id="0c2e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在buy()函数上传递这个值时，它再次乘以10 ⁸，这导致溢出问题。但是在这里，我们需要在wei中发送确切的eth数量，以使这个操作成功，也就是<code class="fe ms mt mu mi b">415992086870360064 wei(0.4 eth)</code></p><blockquote class="ks kt ku"><p id="67b7" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated"><strong class="jw ir">利用时间:</strong></p></blockquote><ul class=""><li id="6c67" class="ln lo iq jw b jx jy kb kc kf lp kj lq kn lr kr ls lt lu lv bi translated">调用buy()函数，取值为<code class="fe ms mt mu mi b"><strong class="jw ir">115792089237316195423570985008687907853269984665640564039459</strong></code> <strong class="jw ir"> </strong>，发送msg.value为<code class="fe ms mt mu mi b">415992086870360064 wei</code>。</li><li id="f79b" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">现在，如果您检查您的余额，结果是最大的数字(uint256值)。</li><li id="6532" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">要完成本部分，卖出1个ETH，最终使合约持有量少于1个ETH。</li></ul><blockquote class="ks kt ku"><p id="6225" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated"><strong class="jw ir">有什么具体原因吗？</strong></p></blockquote><p id="de94" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可能会问为什么我们要传递精确的值。你是怎么得到这个特定值的？为什么即使你给出一个小于1的数也不起作用？—这是答案</p><blockquote class="mv"><p id="6629" class="mw mx iq bd my mz na nb nc nd ne kr dk translated">"<strong class="ak">一个<em class="nf"> uint256 </em>变量的最大值为2 * * 256–1。所以为了让<em class="nf"> msg.value </em>溢出，我们需要确保<em class="nf"> numTokens </em>乘以10**18大于2 * * 256–1。为了得到该值，我们将2 * * 256–1除以10**18，得到:11579208923731619542357098500868790785326998465640564039458(舍入值)</strong></p><p id="a781" class="mw mx iq bd my mz na nb nc nd ne kr dk translated">“我们需要计算出<em class="nf"> msg.value </em>溢出的量，这样我们就可以在呼叫中发送正确的乙醚量。要计算溢出的数量，从我们刚刚计算出的巨大数字中减去2 * * 256–1。这样我们就剩下415992086870360064魏，这是我们调用<em class="nf"> buy() </em>时需要发送的魏数。</p></blockquote></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><blockquote class="ks kt ku"><p id="9623" class="ju jv kv jw b jx jy jz ka kb kc kd ke kw kg kh ki kx kk kl km ky ko kp kq kr ij bi translated">我什么时候能再见到你？</p></blockquote><p id="9f52" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">嗯，最有可能的是我会努力保持一致，但我不能保证，因为我的董事会考试真的很近。我会等待你的爱和支持，让我们一起学习和成长:)</p><p id="66a7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="kv">【随时联系我】~ </em> </strong></p><ul class=""><li id="bbe0" class="ln lo iq jw b jx jy kb kc kf lp kj lq kn lr kr ls lt lu lv bi translated">insta gram—<a class="ae ng" href="https://instagram.com/Gowtham_Ponnana" rel="noopener ugc nofollow" target="_blank">gow tham _ pon nana</a></li><li id="72f0" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">Twitter—<a class="ae ng" href="https://twitter.com/Gowtham_Ponnana" rel="noopener ugc nofollow" target="_blank">gow tham _ pon nana</a></li><li id="4528" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">LinkedIn—<a class="ae ng" href="https://www.linkedin.com/in/gowtham-ponnana/" rel="noopener ugc nofollow" target="_blank">gow tham-Ponnana</a></li><li id="c870" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">邮件—gowtham.official45@gmail.com</li></ul><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nh"><img src="../Images/9c295b4ff45df4882a29d51236b282e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WeDgp5jkWTtrK_HI"/></div></div></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h2 id="3576" class="ni mn iq bd mg nj nk dn nl nm nn dp no kf np nq nr kj ns nt nu kn nv nw nx ny bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ng" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>