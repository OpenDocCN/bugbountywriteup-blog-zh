<html>
<head>
<title>Team Tryhackme Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">团队Tryhackme记录</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/team-tryhackme-writeup-f36f26289b44?source=collection_archive---------2-----------------------#2021-04-22">https://infosecwriteups.com/team-tryhackme-writeup-f36f26289b44?source=collection_archive---------2-----------------------#2021-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4053" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">由沙姆谢尔汗这是一个Tryhackme室“团队”Tryhackme写</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/952004fb29ef3870bb4ebb71172b64eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*84fhMYnxeK0IXEKmzc397g.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated"><a class="ae kr" href="https://tryhackme.com/room/teamcw" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/teamcw</a></figcaption></figure><p id="4158" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">房间链接:</strong><a class="ae kr" href="https://tryhackme.com/room/teamcw" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/teamcw</a><br/><strong class="ku ir">注:此房免费</strong></p><h1 id="748f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">列举</h1><p id="2dd8" class="pw-post-body-paragraph ks kt iq ku b kv mg jr kx ky mh ju la lb mi ld le lf mj lh li lj mk ll lm ln ij bi translated">将目标添加到/etc/hosts文件</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="5dcb" class="mq lp iq mm b gy mr ms l mt mu">echo "10.10.132.103      team.thm" &gt;&gt; /etc/hosts</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/78935d95d82635fd9f5741c797f6a36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*Pbh2sH0WtXd7YQBXqQ7pLA.png"/></div></figure><p id="fa19" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">开放港口是</p><p id="209b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">FTP 21</p><p id="29e8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">SSH 22</p><p id="531d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir"> HTTP 80 </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/17d91a076d6832a599e1de5ab2fd3685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JK69tx6kHNlwu6cAqEoYPw.png"/></div></div></figure><h1 id="1690" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">Gobuster</h1><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="a85d" class="mq lp iq mm b gy mr ms l mt mu">gobuster dir -u <a class="ae kr" href="http://team.thm/" rel="noopener ugc nofollow" target="_blank">http://team.thm/</a> -w directory-list-2.3-medium.txt -x php,html,txt</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/6923e254e222a6b9c49cb56e353b0672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*r0Zed7E5-AVwz5nUHs_8Ng.png"/></div></figure><p id="fd50" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们检查robots.txt文件</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/2e71e6de1e9810855c62b2aa8d385387.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*GaN9kCvYYj-_UqsqIhYlhA.png"/></div></figure><p id="1a13" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">也许它的用户名，但什么FTP或SSH</p><p id="7d6b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated"><strong class="ku ir">子域暴力破解</strong></p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="5a73" class="mq lp iq mm b gy mr ms l mt mu">wfuzz -c --hw 977 -u <a class="ae kr" href="http://team.thm" rel="noopener ugc nofollow" target="_blank">http://team.thm</a> -H "Host: FUZZ.team.thm" -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nd"><img src="../Images/ec5c2e0fd23206c1e00fe254fdcba7bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*epAt4iR69kU4t0VILYGSIQ.png"/></div></div></figure><p id="c9c5" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">查看wfuzz的结果，我们得到了一个额外的虚拟主机，我将它添加到了hosts文件中</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/ab4fe04e1f3259627f5b4482f9192e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*Jt8t3Cs_IIy8wCGkO0kvCw.png"/></div></figure><p id="9642" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">并试图导航到虚拟主机</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/7d9be94c183e65270bbf8f18632d3fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*2NBmiZeOWTrxEC16EWEtxQ.png"/></div></figure><p id="e15d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">单击占位符链接，我们看到它使用了某种include来包含teamshare.php文件</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/78f546c8179de573f434a9fdd2460497.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*pgKElVIvgOVPZ8wrqU3Fug.png"/></div></figure><p id="eb67" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们检查一下<strong class="ku ir"> LFI漏洞</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/62a4ec22b16b2ae233d93ec5494e1b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*FBQfCsoAcrXSIrqSiAEgFg.png"/></div></figure><p id="3cde" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们现在确定web应用程序存在文件包含漏洞。考虑到这种脆弱性，我们想到了两件事:</p><ol class=""><li id="4fd2" class="ni nj iq ku b kv kw ky kz lb nk lf nl lj nm ln nn no np nq bi translated">我们可能不得不利用LFI漏洞通过各种方法远程执行代码，例如远程文件包含、php包装(<strong class="ku ir"> expect://，php://input) </strong>代码执行、日志中毒、泄露phpinfo文件等。</li><li id="d30e" class="ni nj iq ku b kv nr ky ns lb nt lf nu lj nv ln nn no np nq bi translated">利用这个漏洞读取一些敏感文件，这将导致我们危及盒子</li></ol><p id="0412" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">让我们尝试获取<strong class="ku ir"> User.txt </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nw"><img src="../Images/3cdd9d1c41bf15233b90e276d045c33f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cdu2thRIr7vthtr4z3SSiQ.png"/></div></div></figure><p id="5691" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">首先，我决定用一个单词表运行intruder(它是BurpSuite的fuzzer内建版本),以检查Linux系统上的常见文件</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/8facbe913d5dde6c34ce27699c7a4af4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*IGkh6WHMngw9UHWQOkrWbw.png"/></div></figure><p id="440a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我使用的单词表来自Seclists。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="4f92" class="mq lp iq mm b gy mr ms l mt mu">SecLists/Fuzzing/LFI/LFI-gracefulsecurity-linux.txt</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/70c80196a8b62b05b85498fc52e93797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*Z0m__PGfQHiUJt6WE5dDHA.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/6f2eed695139e493d776f32e21d2561b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*LWHDrcaXkKBUbTJ1SmddPA.png"/></div></figure><p id="3e4d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">不带打嗝套件</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="e1a5" class="mq lp iq mm b gy mr ms l mt mu">curl "<a class="ae kr" href="http://dev.team.thm/script.php?page=/etc/ssh/sshd_config" rel="noopener ugc nofollow" target="_blank">http://dev.team.thm/script.php?page=/etc/ssh/sshd_config</a>"</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oa"><img src="../Images/bbb5d408554cf8036815956a013e8c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HIl2dAglAlDspqtwtVNvlQ.png"/></div></div></figure><p id="fff8" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们为用户Dale获得一个SSH私有密钥。</p><p id="e0dd" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我将密钥复制到我的kali中，编辑删除了井号，并使用命令赋予它写权限</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="164f" class="mq lp iq mm b gy mr ms l mt mu">chmod 600 dale.key<br/>ssh</span></pre><p id="aa12" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">试着用钥匙登录盒子</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ob"><img src="../Images/ed56127130146ed5b27b6ebea0520354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cwnH3j1E4zPyp4KjZdYEiQ.png"/></div></div></figure><h1 id="c8ea" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">权限提升</h1><p id="2738" class="pw-post-body-paragraph ks kt iq ku b kv mg jr kx ky mh ju la lb mi ld le lf mj lh li lj mk ll lm ln ij bi translated">运行sudo -l，我们看到我们可以在用户Gyles时运行特定的bash脚本</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/3f40ac34610c3da96e310df6164764ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*eHLWk7bMUFP1OLl5F0e5zA.png"/></div></figure><p id="553b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">查看该脚本，我们可以看到在脚本中有三个可能的地方可以插入系统命令</p><p id="c0d6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">检查文件<strong class="ku ir">/home/gyles/admin _ checks</strong>的内容</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/919396d265fa7636b95cabe1e03fef36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*pi9cpDQC-S3c3ALoPPcfIw.png"/></div></figure><p id="ae87" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我将注入错误变量，因为我们看到该变量被直接传递给系统调用</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oe"><img src="../Images/27ec9be43ed017101c5a3a3a9f3a3e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EPGCMGcaBHhXiTJjM_sP8w.png"/></div></div></figure><p id="8c7e" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在我们有一个外壳作为gyles的用户。查看用户的主目录，我们看到作者离开了。bash_history意味着我们可以追踪作者在创建盒子时做了什么</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi of"><img src="../Images/f749fcfe73ffe990b2fba828ffd357c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXthqeRjKOQKO1bf5Nq1Cw.png"/></div></div></figure><p id="9602" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">浏览该文件，我们看到/usr/local/share中名为main_backup.sh的文件正在被编辑</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="1f05" class="mq lp iq mm b gy mr ms l mt mu">cat .bash_history</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/433c220e2d54b50377a37ddecfc53bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*n1fi8ImZkOeQVoO4tZ74vg.png"/></div></figure><p id="36e6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">我们还看到一些提到crontabs，这意味着可能有一个cronjob正在运行</p><p id="c14a" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">查看该文件的权限，我们看到它只能由根用户和管理组中的成员写入。gyles用户在管理组中，如下面的截图所示，这意味着我们可以修改文件的内容</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oh"><img src="../Images/08a6a396bf38444a3dc211b2a93333f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1y1SksumLRvVFgSoAuBRQQ.png"/></div></div></figure><p id="3e99" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">用vim文本编辑器查看该文件，我们看到这是一个bash脚本，它复制了一些备份，我决定编辑该文件并添加一个反向shell，因为我知道有一个cronjob正在执行</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8d856ab26f10bf3a24b0930c87ef233e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*GXb29gDmoB-V4UO38b0zzQ.png"/></div></figure><p id="35fb" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">接下来，我设置了一个netcat监听器</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oj"><img src="../Images/f481324d80ddd406187c77bf2a1c39ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*joGNt2-34be9OQXbUUr6Zw.png"/></div></div></figure><p id="b4de" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">嘣！我们有根壳</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/7ba4f3387f054f4aca2c01aa187edd90.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*JssnGBPpAbQPXuMqRSb1Ag.png"/></div></figure><p id="42aa" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">你可以在:<br/><strong class="ku ir">LinkedIn:-</strong><a class="ae kr" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="ku ir">Twitter:-</strong><a class="ae kr" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="ku ir">Tryhackme:-</strong><a class="ae kr" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/09e5bbba06c7688a702aeec8570d243c.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*Vve7XR6kstH7qA5iQQ-kYA.png"/></div></figure><p id="f184" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">如需更多演练，请在出发前继续关注…<br/>…</p><p id="5db0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">访问我的其他演练:-</p><p id="0d8d" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">感谢您花时间阅读我的演练。<br/>如果您觉得有帮助，请点击👏按钮👏(高达40倍)并分享<br/>给有类似兴趣的人帮助！+随时欢迎反馈！</p></div></div>    
</body>
</html>