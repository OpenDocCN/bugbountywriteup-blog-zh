<html>
<head>
<title>Conti Ransomware— Threat Hunting with Splunk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Conti勒索软件—使用Splunk搜索威胁</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/conti-ransomware-threat-hunting-with-splunk-5dfe72635dbe?source=collection_archive---------0-----------------------#2022-01-15">https://infosecwriteups.com/conti-ransomware-threat-hunting-with-splunk-5dfe72635dbe?source=collection_archive---------0-----------------------#2022-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/2e1c6fc8e0d5929fd697e803b26f5fcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*g9e2dowT5wAYOcYmm2a0oA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><a class="ae jy" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-spotlight%2F2021%2F05%2Fthreat-spotlight-conti-the-ransomware-used-in-the-hse-healthcare-attack%2F&amp;psig=AOvVaw3tGzY5fUvjXIrFzyd1iWPB&amp;ust=1642342583187000&amp;source=images&amp;cd=vfe&amp;ved=0CAsQjRxqFwoTCPCn5IX5s_UCFQAAAAAdAAAAABAI" rel="noopener ugc nofollow" target="_blank">康迪勒索软件笔记</a></figcaption></figure><p id="11fe" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这篇文章提供了我解决由<em class="kx"> heavenraiza </em>创建的标题为“<strong class="kb ir">孔蒂</strong><em class="kx">”</em>的TryHackMe房间的方法。一台Exchange服务器被勒索软件攻破，我们必须使用Splunk来调查攻击者是如何攻破服务器的。我还在最后提供了一个TryHackMe的链接，供有兴趣尝试这个房间的人使用。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="13a5" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">放弃</h1><p id="7858" class="pw-post-body-paragraph jz ka iq kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ij bi translated">我喜欢在一篇文章之前添加一个简短的免责声明，以鼓励人们在阅读本文之前尝试CTF，因为在这篇文章中显然会有<strong class="kb ir">剧透</strong><strong class="kb ir"/>。我相信，如果你先自己尝试，然后在遇到困难或需要提示时再来写这篇文章，你会更喜欢CTF。因此，没有任何进一步的拖延，让我们开始吧！</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="822c" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">挑战场景</h1><blockquote class="mi mj mk"><p id="6712" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">贵公司的一些员工报告他们无法登录Outlook。Exchange系统管理员还报告说，他无法登录到Exchange管理中心。经过初步分类后，他们发现Exchange服务器上有一些奇怪的自述文件。下面是勒索短信的复印件。</p></blockquote><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mo"><img src="../Images/ec58e422b98c0948b1061ce726059013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DcTsTaP2l9kobuSR.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">挑战勒索笔记。</figcaption></figure><blockquote class="mi mj mk"><p id="4e1a" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">你被指派调查这个情况。使用Splunk回答以下关于Conti勒索软件的问题。</p></blockquote></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="d2f5" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">初始设置</h1><p id="f96a" class="pw-post-body-paragraph jz ka iq kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ij bi translated">登录Splunk后，我决定从“<strong class="kb ir">设置→索引</strong>”开始。在这里，我可以看到正在使用的索引是"<strong class="kb ir"> main </strong>"，Splunk的默认索引，其中存储了所有已处理的数据。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mx"><img src="../Images/cbbc2b7b3a26b64e3710ec65b7b436da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QjjU31EqYWSVvY8bkBUmVQ.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">Splunk指数</figcaption></figure><p id="ede3" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">接下来，我检查了Splunk是否可以成功访问接收/加载的数据。我将时间范围更改为“<strong class="kb ir">所有时间</strong>”，然后提交以下搜索:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="0c14" class="nd lg iq mz b gy ne nf l ng nh">index="main" earliest=0</span></pre><p id="6a0b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我可以看到有<strong class="kb ir"> 28，145</strong>T20】事件，并且我确认Splunk可以成功访问摄取/加载的数据:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/9d4d982b6f6b167452b18946c6b25060.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*BkB-nxknCBT8FDLlto0qBA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">Splunk中的事件总数。</figcaption></figure><p id="be5e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">最后，我使用下面的搜索按照事件数量从高到低的顺序确定了所有的<strong class="kb ir">源类型</strong>(即数据类别):</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="8f11" class="nd lg iq mz b gy ne nf l ng nh">index="main" earliest=0 | stats count by sourcetype | sort -count</span></pre><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/9666df5c98a57281998706773b847d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*g1sZdfzhX5kHRItfGRrXUQ.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">Splunk中可用的源类型</figcaption></figure><p id="7740" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">源类型决定了Splunk Enterprise在索引过程中如何格式化数据。我们可以看到上面列出了七种可用的事件源类型:</p><ol class=""><li id="b25a" class="nk nl iq kb b kc kd kg kh kk nm ko nn ks no kw np nq nr ns bi translated"><strong class="kb ir"> "WinEventLog:Security" </strong>:包含与Windows身份验证和安全进程相关的事件。</li><li id="4b7b" class="nk nl iq kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated"><strong class="kb ir">" WinEventLog:Application "</strong>:包含由各种应用程序和/或用户程序记录的事件，包括应用程序被指定报告的任何错误或信息。</li><li id="9664" class="nk nl iq kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated"><strong class="kb ir">“WinEventLog:System”:</strong>包含各种Windows系统组件记录的事件。</li><li id="9f30" class="nk nl iq kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated"><strong class="kb ir">“iis”</strong>:包含来自互联网信息服务(IIS)、网页和应用的数据。它包括基本项目，如IP和用户名、请求日期和时间、服务状态和接收的字节数，以及目标文件的详细项目。</li><li id="4b3f" class="nk nl iq kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated"><strong class="kb ir">" WinEventLog:Mircrosoft-Windows-Sysmon/Operational ":</strong>Windows日志常用插件。使用Sysmon日志，您可以通过跟踪代码行为和网络流量来检测恶意活动，并根据恶意活动创建检测。</li><li id="a496" class="nk nl iq kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated"><strong class="kb ir"> "WinEventLog:Setup": </strong>包含Windows安装程序性能事件。</li><li id="a96f" class="nk nl iq kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated"><strong class="kb ir"> "misc_text" </strong>:包含与Splunk中任何预定义的源类型都不匹配的杂项文本。</li></ol></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="8a06" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">挑战问题</h1><blockquote class="mi mj mk"><p id="c719" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">1.你能确定勒索软件的位置吗？</p></blockquote><p id="5b79" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我首先使用SourceType <strong class="kb ir"> Sysmon </strong>并确定在字段“<strong class="kb ir"> EventCode </strong>”下有哪些事件代码:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="64c0" class="nd lg iq mz b gy ne nf l ng nh">index=main sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"</span></pre><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/74ac8fb8bc65db11219a3f9040b68c57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*Tal8hX2ysFjN1tvql0fwwg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">Sysmon事件ID。</figcaption></figure><p id="6d95" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">您可以使用下面的链接了解有关Sysmon ID的更多信息:</p><div class="nz oa gp gr ob oc"><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">Sysmon - Windows系统内部</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">发布时间:2021年12月16日下载Sysmon (3.1 MB)系统监视器(Sysmon)是一个Windows系统服务和设备…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">docs.microsoft.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq js oc"/></div></div></a></div><p id="9f35" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我可以看到<strong class="kb ir"> Event ID 11 FileCreate </strong>，它在文件被创建或覆盖时被记录，可以用来识别是否创建了任何可疑文件。我使用下面的搜索来过滤这种类型的事件:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="bc17" class="nd lg iq mz b gy ne nf l ng nh">index=main sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=11</span></pre><p id="9907" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">查看有趣的字段，我们看到在<strong class="kb ir">图像</strong>字段下，<strong class="kb ir">cmd.exe</strong>可执行文件存储在一个奇怪的位置:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi or"><img src="../Images/f1229149c4d852bc85558890937d142a.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*z6PPJqYIzsH7MAx7NlENUA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">勒索软件的位置。</figcaption></figure><blockquote class="mi mj mk"><p id="94f6" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">2.相关文件创建事件的Sysmon事件ID是什么？</p></blockquote><p id="6974" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">参考上述问题1的解决方案。</p><blockquote class="mi mj mk"><p id="ac7a" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">3.能找到勒索软件的MD5哈希吗？</p></blockquote><p id="0c57" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">为了找到勒索软件的md5散列，我在前面的问题1中包含了“<strong class="kb ir"> Image </strong>”值，并键入“MD5”来标识任何具有MD5散列值的字段:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="b124" class="nd lg iq mz b gy ne nf l ng nh">index=main sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational" Image="c:\\****\\***\\cmd.exe" md5</span></pre><p id="a878" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">返回一个包含勒索软件MD5哈希的事件:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi os"><img src="../Images/db7e02dbd170ede70433f0e05f61f55a.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/format:webp/1*OtXPJ2WSLO2ty_Fk6leH4g.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">勒索软件MD5哈希</figcaption></figure><blockquote class="mi mj mk"><p id="46d8" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">4.什么文件被保存到多个文件夹位置？</p></blockquote><p id="d41b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">仍然使用Sysmon事件ID 11，我发现了一个有趣的字段，名为“TargetFilename”。使用下面的搜索，我能够识别存储在多个位置的同一个文件名:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="c99a" class="nd lg iq mz b gy ne nf l ng nh">index=main sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=11 <br/>| stats count by TargetFilename</span></pre><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/9f03e59cbc07e793c2d28bf043acd39d.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*eeRjFUPHu2WisZMIym-SLg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">文件保存到多个文件夹位置。</figcaption></figure><blockquote class="mi mj mk"><p id="cdcf" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">5.攻击者使用什么命令向受损系统添加新用户？</p></blockquote><p id="0257" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在线执行快速搜索，我们看到windows <strong class="kb ir"> net </strong>命令用于向系统添加用户:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="b340" class="nd lg iq mz b gy ne nf l ng nh">net user username password /add</span></pre><p id="787d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">使用Sysmon，可以使用字段<strong class="kb ir">命令行</strong>来过滤命令。我在搜索查询中对命令行字段值使用了通配符，以查找包含“<strong class="kb ir"> /add </strong>”的任何命令:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="1eb7" class="nd lg iq mz b gy ne nf l ng nh">index=main sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational" CommandLine="*/add*"</span></pre><p id="1315" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">查看有趣的字段，我可以在“CommandLine”字段下看到用于向受损系统添加新用户的命令:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/bfbdb0ddce79a49ceabc1b3c3ea2f5f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*ciUmAjG1UyWm7YRo0f2azg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">攻击者用来向受损系统添加新用户的命令。</figcaption></figure><blockquote class="mi mj mk"><p id="7d69" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">6.攻击者为了更好的持久性迁移了流程。迁移后的进程镜像(可执行文件)是什么，攻击者上系统时的原始进程镜像(可执行文件)是什么？</p></blockquote><p id="31f6" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">要回答这个问题，我们可以使用Sysmon <strong class="kb ir">事件ID 8创建远程线程</strong>，它检测一个进程何时在另一个进程中创建一个线程。这种技术被恶意软件用来注入代码并隐藏在其他进程中。我使用下面的搜索来过滤事件ID 8:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="8f86" class="nd lg iq mz b gy ne nf l ng nh">index=main sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=8</span></pre><p id="34ee" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">只返回两个事件。我使用下面的搜索查询进一步细化了我的搜索，以确定源和目标流程:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="7dfc" class="nd lg iq mz b gy ne nf l ng nh">index=main sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=8<br/>| table SourceImage, TargetImage</span></pre><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ov"><img src="../Images/43eeca22767d8397ad973cdcb6a5dc14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l1kQK0YoIVR_LgG_5UEKaA.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">迁移的流程映像(可执行文件)和原始流程映像(可执行文件)。</figcaption></figure><p id="05ac" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">看上面的图片，我们看到<strong class="kb ir">powershell.exe</strong>被发射，然后我们被转移到<strong class="kb ir">unsecapp.exe</strong>。</p><blockquote class="mi mj mk"><p id="bfac" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">7.攻击者还获取了系统哈希。用于获取系统哈希的进程映像是什么？</p></blockquote><p id="2ab5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">如果我们参考前面问题6中使用的搜索的输出，我们可以看到第二个流程迁移发生在<strong class="kb ir">unsecapp.exe</strong>和<strong class="kb ir">lsass.exe</strong>之间:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ow"><img src="../Images/344408b8b659f29272a1a229b9c69ea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4g9A9fmpOGnE-hWLTv9H3g.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">迁移的流程映像(可执行文件)和原始流程映像(可执行文件)。</figcaption></figure><p id="ea57" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">本地安全机构子系统(LSASS)负责用户身份验证，并生成访问令牌，为用户和用户会话中产生的进程指定安全策略和/或限制。这个过程通常会受到黑客和恶意软件的攻击。它的目标是转储密码哈希，通常用于隐藏在众目睽睽之下。</p><blockquote class="mi mj mk"><p id="345c" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">8.漏洞利用部署到系统的web shell是什么？</p></blockquote><p id="f654" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我发现以下资源有助于识别web shells:</p><div class="nz oa gp gr ob oc"><a href="https://github.com/ThreatHuntingProject/ThreatHunting/blob/master/hunts/webshells.md" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">threahunting/web shell . MD位于主threahunting project/threahunting</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">确定web外壳(独立|注入)数据所需的Web服务器日志(apache、IIS等)。)收藏注意事项…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">github.com</p></div></div><div class="ol l"><div class="ox l on oo op ol oq js oc"/></div></div></a></div><p id="9549" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">为了回答这个问题，我首先将我的SourceType从Sysmon改为<strong class="kb ir"> IIS </strong> <strong class="kb ir"> events </strong>，因为它收集与网页相关的事件。接下来，我过滤了针对<strong class="kb ir"> POST </strong>请求和常见web shell文件类型的IIS事件。php，。asp，。aspx，。jsp):</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="c26e" class="nd lg iq mz b gy ne nf l ng nh">index=main sourcetype=iis cs_method=POST <br/>| search *.php* OR *.asp* OR *.aspx* OR *.jsp*</span></pre><p id="a905" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在“cs_uri_stem”字段下，我可以看到一个带有“<strong class="kb ir">的可疑文件名。aspx </strong>文件扩展名:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/dc23361e2873100fb484285e7d519de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*Uat2m2QBZc9hAxwdqd9icw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">Web外壳漏洞利用</figcaption></figure><blockquote class="mi mj mk"><p id="464f" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">9.执行这个web shell的命令行是什么？</p></blockquote><p id="3757" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我将SourceType改回Sysmon，并过滤掉。aspx web shell</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="76ea" class="nd lg iq mz b gy ne nf l ng nh">index=main i3gfPctK1c2x.aspx sourcetype="WinEventLog:Microsoft-Windows-Sysmon/Operational"</span></pre><p id="37ec" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在CommandLine字段下，我可以看到用于执行web shell的命令:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/02c4db9d00de241d2a57d205102eb648.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*Lk1Fh5G6ZEyx6i6t--WGWA.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">用于执行webshell的命令行。</figcaption></figure><blockquote class="mi mj mk"><p id="f234" class="jz ka kx kb b kc kd ke kf kg kh ki kj ml kl km kn mm kp kq kr mn kt ku kv kw ij bi translated">10.该漏洞利用了哪三份简历？</p></blockquote><p id="ca6f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我花了一些时间才找到，但在谷歌搜索引擎中搜索了<em class="kx"> conti勒索软件“CVE”列表</em>后，我找到了以下文章，其中包含了一些与conti勒索软件相关的CVE:</p><div class="nz oa gp gr ob oc"><a href="https://cybersecurityworks.com/blog/ransomware/is-conti-ransomware-on-a-roll.html" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">康迪勒索软件势如破竹吗？</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">2021年9月更新}:今年早些时候开始流行的康迪集团仍然保持强劲势头。在一个新的…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">cybersecurityworks.com</p></div></div><div class="ol l"><div class="pa l on oo op ol oq js oc"/></div></div></a></div></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="7490" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结束语</h1><p id="ad88" class="pw-post-body-paragraph jz ka iq kb b kc md ke kf kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw ij bi translated">我真的很喜欢在这个房间工作，并有机会了解更多关于使用Splunk搜索Conti勒索软件的信息。谢谢你一直读到最后，继续黑下去😄！</p><div class="nz oa gp gr ob oc"><a href="https://tryhackme.com/" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">网络安全培训</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">TryHackMe是一个免费的学习网络安全的在线平台，使用动手练习和实验室，通过您的…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">tryhackme.com</p></div></div><div class="ol l"><div class="pb l on oo op ol oq js oc"/></div></div></a></div></div></div>    
</body>
</html>