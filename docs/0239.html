<html>
<head>
<title>Opening Open Redirects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">打开打开的重定向</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/open-redirects-ups-and-downs-f47ee8f36a8b?source=collection_archive---------3-----------------------#2019-01-21">https://infosecwriteups.com/open-redirects-ups-and-downs-f47ee8f36a8b?source=collection_archive---------3-----------------------#2019-01-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3024" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:以下文章发表于2016年13月6日https://FogMarks.com</em><a class="ae km" href="https://fogmarks.com/2016/06/13/open-redirects-ups-and-downs/" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/78f52599b7de161dbe5b2f32b479549d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NbRa3dXxeAonUYGZTQNlIA.png"/></div></div></figure><p id="1f77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kz translated">几年前，当FogMarks在我的脑海中还不是一个微小的想法或愿景时，我曾经在Fiverr上做一些临时的编程工作。</p><p id="02d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我被要求做的工作之一是让from网站的用户被重定向到Facebook.com，然后在他不采取行动的情况下，被重定向到from网站。我当时不知道为什么会有人想要那种东西。为什么不直接把用户重定向到y.com呢？我问那个人为什么他会想做这样的事。他的回答改变了我(以及之后的FogMarks)对待和处理开放重定向的方式。他回答说，由于from的广告引擎强迫用户的请求来自脸书的网址，因此支付的费用要高得多，因为像脸书这样的热门网站已经把用户重定向到了from。</p><p id="4112" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个回答之前，我把开放重定向看作简单的安全问题，不会造成太大的损害。我知道无辜的用户会得到一个误导性的链接，比如:<em class="kl">“www . innocent . com？但是我相信任何有一点常识的人都会察觉到这种事情。这些类型的攻击大多被钓鱼网站用来尝试和模拟一个邪恶的页面实际上是由无辜的域(在这种情况下是innocent.com的<em class="kl">)托管的。</em></em></p><p id="2717" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个漫长的介绍之后，我想介绍今天的主题——打开重定向的简单解决方案。脸书在他们的Linkshim系统中做到了这一点，但我想介绍一个更简单的解决方案，你们任何人都可以使用。</p><blockquote class="li lj lk"><p id="378b" class="jn jo kl jp b jq jr js jt ju jv jw jx ll jz ka kb lm kd ke kf ln kh ki kj kk ij bi translated"><strong class="jp ir">旁注:谁不应该采用这种解决方案？</strong>希望自己的域名出现在推荐人标题上的网站。</p></blockquote><p id="164c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，我见过的阻止开放重定向的常规方法是创建一个令牌(就像YouTube和l.php脸书的页面)，禁止不包含网站主机的URL，只允许用户通过帖子请求被重定向。</p><p id="c7df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然创建一个退出令牌被认为是一个好的实践，但是处理和维护整个系统却是一件非常头疼的事情。你有更多的值存储在数据库中，你应该检查到期时间，IP地址和更多。</p><p id="ef73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一种方法是禁止重定向到不包含网站主机的URL。这是完全错误的。网站应该允许其他用户被重定向到另一个网站，而不仅仅是他们自己的页面。</p><p id="3249" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只允许用户在她发起一个动作(比如点击一个按钮)后被重定向，对你或用户来说并不总是那么方便。</p><h2 id="f173" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated"><strong class="ak">黄金解决方案</strong></h2><p id="fe51" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">老实说，你要说的第一句话是:“什么？这家伙疯了吗？”。但是下一件事将会是:“好吧，我应该试一试”。</p><p id="776e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，现在很多网站都提供免费的网址缩短服务。除此之外，他们还提供了一个免费的模块化且方便的API。<br/> <strong class="jp ir">我们为什么不用它们？！</strong></p><p id="c6ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而不是小心翼翼地创建一个退出令牌，禁止外部重定向或要求它们被后置启动(是的，我发明了这个动词！)，只需将任何外部URL翻译成某个URL缩短服务提供的缩短URL。如果你不想让第三方服务存储你的信息，<a class="ae km" href="https://github.com/thedevs-network/kutt" rel="noopener ugc nofollow" target="_blank">你可以使用开源系统建立一个你自己的</a>。<br/>只允许重定向<strong class="jp ir">到缩短的URL的域。这样你就不必担心打开重定向——它们永远不会直接从你的域中出现。</strong></p><p id="3d1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设您有一个名为“redirect_out.php”的页面，带有一个用户可以控制的r GET参数:</p><p id="abd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">www.my.com/redirect_out.php?r=http://bad.com</em></p><p id="5657" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，您还应该在这个请求中包含一个令牌，以及一个验证其来源和过期时间的机制。<br/>我说——接受用户的bad.com URL，然后<strong class="jp ir">自动</strong>将其翻译成一个<em class="kl">shorte.nd/XxXxX</em>URL。然后总是允许重定向到<em class="kl">short . nd</em>。许多缩短服务遵循安全准则，会比你更好地拒绝重定向到“不良网站”。相信我。</p><p id="ed25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想进一步加强这种方法，您可以向shortening服务添加一个白名单，并将其配置为只将请求定向到白名单中的主机。</p><h2 id="7060" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated"><strong class="ak">额外:使用知名起酥油服务的好处</strong></h2><p id="6899" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">如前所述，这个解决方案只提供给那些不希望自己的域名显示为推荐人的开发者。如果你担心直接的网络钓鱼攻击，这是一个不同的场景。</p><p id="a272" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过使用一个众所周知的缩短服务，管理已知“好的或坏的”域名的黑名单或白名单，您将获得两倍:</p><ul class=""><li id="e9b5" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">你的域名不会成为将用户重定向到“坏”网站的“罪魁祸首”(是的，谷歌也知道并检查了这一点)，尽管你也应该真正关心它。</li><li id="1e39" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">您将提高网站的网络钓鱼防护级别。您的用户将能够被重定向到“不良”网站，但缩短服务将拒绝它，或者至少警告那些用户(可选地，您也是)。</li></ul><h2 id="6be7" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">包裹</h2><p id="c64d" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">这个想法在开始时可能听起来有点奇怪，但它需要零开发时间(当选择使用商业服务时)。这里的主要思想是承认用户从一个站点到另一个站点的不必要的重定向可能发生，并且防止可能发生的最糟糕的事情(用户将到达<em class="kl">bad.com</em>)的最好方法是依靠一种机制</p><p id="7369" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我知道你对那件事的看法。</p></div></div>    
</body>
</html>