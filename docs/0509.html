<html>
<head>
<title>Extracting packer injected malware from memory [Remcos RAT]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从内存中提取打包程序注入的恶意软件[Remcos RAT]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/extracting-packer-injected-malware-from-memory-remcos-rat-aa87cb224b70?source=collection_archive---------2-----------------------#2020-03-07">https://infosecwriteups.com/extracting-packer-injected-malware-from-memory-remcos-rat-aa87cb224b70?source=collection_archive---------2-----------------------#2020-03-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="04ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从windows动态内存中提取注入的恶意PE(Remcos恶意软件)</p><h1 id="55cf" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">背景</h1><p id="a249" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">通常，恶意软件由一些打包程序打包，这些打包程序会混淆原始代码，并帮助它逃避反病毒软件或一般人类的怀疑。执行打包的二进制文件时，将实际的二进制文件注入内存，并从那里运行它。</p><h1 id="468b" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">我们将在这篇文章中讨论什么？</h1><ol class=""><li id="c7fb" class="lo lp iq jp b jq lj ju lk jy lq kc lr kg ls kk lt lu lv lw bi translated">在打包的二进制文件中设置断点以阻止恶意代码注入和执行的方法。</li><li id="a3b0" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">绕过恶意软件的<em class="mc">“调试器绕过技巧”</em></li><li id="38a0" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">从内存中定位并转储注入的代码。</li><li id="6255" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">进行必要的修补。</li></ol><p id="a4ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置环境:</p><blockquote class="md me mf"><p id="e1e1" class="jn jo mc jp b jq jr js jt ju jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">操作系统</em> </strong> <em class="iq"> : Windows 10，企业评测180914 </em> <strong class="jp ir"> <em class="iq">软件_武器库</em> </strong> <em class="iq"> : x32debugger，PE bear，十六进制编辑器HxD </em> <strong class="jp ir"> <em class="iq">恶意软件_二进制</em> </strong> <em class="iq"> : Remcos </em></p></blockquote><h1 id="456a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">什么是雷姆科斯鼠？</h1><p id="3217" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">给你—</p><div class="mj mk gp gr ml mm"><a href="https://blog.malwarebytes.com/detections/trojan-remcos/" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd ir gy z fp mr fr fs ms fu fw ip bi translated">木马。雷姆科斯</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">木马。Remcos通常通过在Office文档中嵌入特制的设置文件来感染系统，这…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">blog.malwarebytes.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na nb mm"/></div></div></a></div><h2 id="747e" class="nc km iq bd kn nd ne dn kr nf ng dp kv jy nh ni kz kc nj nk ld kg nl nm lh nn bi translated">想跟进这篇文章吗？</h2><p id="8366" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">这是你的恶意软件，小心处理。</p><p id="a5e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">https://malshare.com/sample.php?action=detail&amp;hash = 15 FD C5 c 025 e 9d 1645 df 07110 c 455 aa 09</p><h1 id="6569" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">实验室设置和初始检查</h1><p id="3f63" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们将使用我们的Windows 10虚拟机。我们将网络设置为“仅主机”,通过Python的SimpleHTTPServer将二进制文件传输到VM。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi np"><img src="../Images/cdcd8c37044788a10a29599d237548a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*diqgBrGTPCwzjJGAYxFbxA.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">主机中的python服务器</figcaption></figure><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oe"><img src="../Images/a8d905f075d14b433413cc0b5bedab36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mdrm2R22TaYYN2yLXMzyYA.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">正在虚拟机中下载二进制文件</figcaption></figure><p id="dcdd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了我们的二进制文件，在开始之前，我们将<strong class="jp ir"> <em class="mc">关闭VM </em> </strong>中的网络和文件夹共享，以防止出现混乱。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi of"><img src="../Images/a34b942d69180c1ed2c5985176de8720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E4-CrEFvjonmBBkqG3FyJA.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">将二进制文件重命名为RemCOS.bin</figcaption></figure><p id="64d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将我们的二进制文件重命名为<em class="mc"> RemCOS.bin </em>并用PE Bear开始调查。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi og"><img src="../Images/5d0578b9b2664e7c3d19b1fd9119dda8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B_E8ArBPGcNpJ5LmcLQINw.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">MSVBVM60。DLL指向VisualBasic6代码</figcaption></figure><p id="b4ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">二进制文件似乎是VB6打包程序。让我们启动x32debugger并在其中加载我们的二进制文件。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oh"><img src="../Images/c6ac0cdba0e4acf1e61b8ca210be9349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S7TM3SyUNdhvGnroDUBlXA.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">x32调试器中的RemCOS.bin</figcaption></figure><h1 id="eea7" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">在CreateProcessInternalW设置断点</h1><p id="42b7" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">什么是CreateProcessInternalW？给你-</p><div class="mj mk gp gr ml mm"><a href="https://attack.mitre.org/techniques/T1106/" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd ir gy z fp mr fr fs ms fu fw ip bi translated">通过API执行</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">对手工具可能直接使用Windows应用程序编程接口(API)来执行二进制文件。功能…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">attack.mitre.org</p></div></div><div class="mv l"><div class="oi l mx my mz mv na nb mm"/></div></div></a></div><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oj"><img src="../Images/f749a7c61c48d27c6b892531c9ef97de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUH4ZBp2sxWhY0ax97dp7A.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">src:<a class="ae no" href="https://www.geoffchappell.com/studies/windows/win32/kernel32/api/index.htm" rel="noopener ugc nofollow" target="_blank">https://www . geoffchappell . com/studies/windows/win32/kernel 32/API/index . htm</a></figcaption></figure><p id="1885" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个API调用允许程序从自身产生一个新的进程，通常打包程序使用这种方法在内存中注入实际的恶意代码，并使用CreateProcessInternalW执行它们。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/3c0d04a634652be40628005c00c26291.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*xCiuR-I0wHS5qbrCmUN48Q.png"/></div></figure><p id="70d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有更多的延迟，让我们在这里创建一个断点。类型:</p><p id="4681" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="mc">BP CreateProcessInternalW</em>T3】</strong></p><p id="54c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在cmd中。部分，然后按enter键。</p><h1 id="a1f7" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">绕过调试器检测</h1><p id="b422" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">当我们继续执行二进制文件时，我们偶然发现了一个有趣的异常。这可能是一种反调试器策略，或者只是某个VB6 APIs的随机异常。不管怎样，这阻碍了我们达到预期的转折点。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/6ea0cf2afb5bcb681c4c45b1d43357b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*OA_xBTt0ojDD3i_9yLOqlQ.png"/></div></figure><p id="4d0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要绕过这一点，请执行<strong class="jp ir"> <em class="mc">调试&gt;高级&gt;运行(通过异常)</em> </strong></p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi om"><img src="../Images/6992e07c2b5094847a8142f87a8a10ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZkkxfJU9hdxrum5iqNn-w.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">将所有异常传递给二进制文件，这样调试器就不会反击它</figcaption></figure><p id="a009" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将把所有异常传递给程序，就像在正常执行中一样。现在我们可以打出断点了:</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div class="gh gi on"><img src="../Images/3562b1bd894de11fdfe322911c56f75c.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*OsKEWja66BL5PRHLjOTbiw.png"/></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">活动断点@ CreateProcessInternalW</figcaption></figure><h1 id="fee7" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">查找和转储注入的代码</h1><p id="a6e5" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我们现在知道它试图从记忆中运行一些东西，我们需要找到它是什么。</p><p id="45b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于goto <strong class="jp ir"> <em class="mc">存储器映射</em> </strong>。众所周知，大多数可移植的可执行文件(PE文件)都有一个DOS头文件，上面写着类似<em class="mc">“这个程序不能在DOS模式下运行”</em>之类的内容。我们可以尝试在内存映射中搜索这个字符串，看看会得到什么。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oo"><img src="../Images/e3bad6b14486daa4d8ca12d6a0773e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1r1K9JRiYafo3vrMV3RL1Q.png"/></div></div></figure><p id="6802" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">搜索后，我们找到了以下匹配项:</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oe"><img src="../Images/6ab45d13845c73ae5137170e13445c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*daYJlZpCbuRPdoiXwWW0xg.png"/></div></div></figure><p id="65c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要找到我们注入的代码，但是这里有一个障碍:任何包含我们的字符串“This program ..”的文件将被列出，包括大部分微软自己的dll和支持库。</p><h1 id="c4f9" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">查找注入的可执行代码</h1><p id="d8e5" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">现在，我们必须跟踪每一次点击，以检查它是否是我们正在寻找的代码或其他东西。</p><p id="491e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从所有列出的条目中选择一个:<strong class="jp ir"> <em class="mc">跟随转储&gt;跟随内存映射</em> </strong></p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi op"><img src="../Images/8b00ec318b4ec4db03beacd49c923534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Afh9hdo_TOMPeep1mpWYag.png"/></div></div></figure><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/e575660e93844fb7f97475a65674b7ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*pF2iREtDJ8GHkIqwLvbykQ.png"/></div></figure><p id="5bcc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会知道什么时候你会发现一些不寻常的东西，比如:<em class="mc">内存中的未命名段</em>带有<strong class="jp ir"> R </strong> ead <strong class="jp ir"> W </strong> rite和<strong class="jp ir">E</strong>x可执行权限。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi or"><img src="../Images/e6b8847be10a4677dc6fdcece8baa831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fus50gUS58CCzroJ0JyyfQ.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">可疑的内存注入</figcaption></figure><p id="edf2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择<strong class="jp ir">和<em class="mc">将内存转储到</em>文件中</strong></p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi os"><img src="../Images/ad30485d7d28e3d58ef9b33ea5cf837a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*pjOOoq-wN6tIJEzDELYmFg.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk translated">转储到文件以供进一步分析</figcaption></figure><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi ot"><img src="../Images/f9b232d555510ea6d2b220589dff1b75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rKmW9wXkluX-nOOEYnCbTg.png"/></div></div></figure><p id="ca5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将其命名为“<em class="mc"> remcos_extracted.bin </em>”，让我们用PE Bear测试一下，确保它被注入了可执行文件:</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi ou"><img src="../Images/20c311c977818e1eaf69070265d5d1ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOa9LeBVpq7ClPjPUDauxA.png"/></div></div></figure><p id="12e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯……现在怎么办？但是我们找到了我们的DOS头文件，没事吧？</p><p id="d76d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在十六进制编辑器中检查文件</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oe"><img src="../Images/9d8d7c4b3fda22ad9c79c0b518bf201b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ipjycn3vKmR1FwMxK8Uhw.png"/></div></div></figure><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oe"><img src="../Images/bdeae087dd330b7fcd47d52a57fac5cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLprdOz8P0UyZibX4SfNFw.png"/></div></div></figure><p id="c59b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有了DOS头文件…然后呢？PE熊为什么不行？</p><p id="4776" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是因为文件签名或幻数不存在！！记住PE文件以<strong class="jp ir"> <em class="mc"> MZ开头。</em> </strong>“表头？</p><h1 id="c1d0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">修复提取的二进制文件[标头签名修复]</h1><p id="00cf" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">现在我们知道丢失了什么，让我们通过将丢失的头放在适当的位置来修复二进制文件。但是放在哪里呢？</p><p id="5881" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来检查列表方法:</p><ol class=""><li id="ca43" class="lo lp iq jp b jq jr ju jv jy ov kc ow kg ox kk lt lu lv lw bi translated">MZ标题通常与起始偏移量对齐。</li><li id="86fa" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">DOS报头前约60字节</li></ol><p id="5b75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae no" href="https://i.stack.imgur.com/0DdKh.png" rel="noopener ugc nofollow" target="_blank"> PE格式:https://i.stack.imgur.com/0DdKh.png</a></p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oe"><img src="../Images/df88bfa13ddffc8323bee7f820776491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PrBFxUXOvFotdMmVuhz-Fw.png"/></div></div></figure><p id="cd5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，让我们清除0x000600之前的所有零填充，因为这似乎是我们签名的好地方，符合我们的清单。</p><p id="f1e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">清除上面所有的填充，将前2个字节修改为<strong class="jp ir"><em class="mc">4D 5A</em>T3【十六进制】为<strong class="jp ir">T5【MZ】T6</strong>。</strong></p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oy"><img src="../Images/97ced8ff3fe656400e6d126a80fe96ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xng5ZjsiO9CorNTfNSw6qA.png"/></div></div></figure><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oz"><img src="../Images/bfc494fc9d06a00590a01ad51284e4d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWvk1kbCDw4f-RG2thpt7g.png"/></div></div></figure><p id="4925" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存文件，然后…现在让我们在PE BEAR中检查一下</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi pa"><img src="../Images/eb101cf1f51cb42935cfe889c6d2f65d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d9FEHk3tvzF-SKjdp9qibg.png"/></div></div></figure><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi pb"><img src="../Images/f7c36e5d59210be0a72423c052caeaba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lYxvu0zotmOzAAkD1BAcVw.png"/></div></div></figure><p id="23c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">酷！一切都很好。</p><p id="4c30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的内存被恶意软件公开注入！</p><p id="91f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以启动IDA或其他什么东西来进一步分析提取的恶意软件。</p><figure class="nq nr ns nt gt nu gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oe"><img src="../Images/dcf9201862a2284184ec6174674d77d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVcQFMYOL7U7Vb0uyx2rjw.png"/></div></div></figure><p id="59fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们将在另一篇文章中讨论这个问题，(因为你当然可以看到IDA对这只老鼠有多兴奋)清除所有这些疯狂的调用图将需要更多的空间和时间。</p><h1 id="f69e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="0bbc" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">希望这个能对某个人有用。这对我来说真是太酷了。</p><p id="3a04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最近在玩windows内存，以后会分享更多。在那之前…保持足够的咖啡因含量，继续在windows 的<em class="mc">记忆通道中漫游。</em></p><h1 id="3d08" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">参考</h1><p id="ee34" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">这是一个来自OA实验室的很棒的视频，它激励我写这篇文章。+其他资源，继续撰写本文。</p><figure class="nq nr ns nt gt nu"><div class="bz fp l di"><div class="pc pd l"/></div></figure><div class="mj mk gp gr ml mm"><a href="https://countuponsecurity.com/tag/finding-injected-code-into-memory/" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd ir gy z fp mr fr fs ms fu fw ip bi translated">寻找注入内存的代码——依靠安全性</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">在我们继续动手进行内存取证练习之前，最好先复习一些关于内存如何…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">countuponsecurity.com</p></div></div><div class="mv l"><div class="pe l mx my mz mv na nb mm"/></div></div></a></div><div class="mj mk gp gr ml mm"><a href="https://www.zdnet.com/article/code-injection-exposes-all-versions-of-windows-to-cyberattack/" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd ir gy z fp mr fr fs ms fu fw ip bi translated">新的代码注入方法将所有版本的Windows暴露在网络攻击之下</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">研究人员披露了一种针对微软视窗操作系统的新攻击，这种攻击可以被用来注入…</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">www.zdnet.com</p></div></div><div class="mv l"><div class="pf l mx my mz mv na nb mm"/></div></div></a></div></div></div>    
</body>
</html>