<html>
<head>
<title>Genymotion+Xposed+Inspeckage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">gen ymotion+exposed+inspeck age</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/genymotion-xposed-inspeckage-89f0c8decba7?source=collection_archive---------2-----------------------#2021-07-03">https://infosecwriteups.com/genymotion-xposed-inspeckage-89f0c8decba7?source=collection_archive---------2-----------------------#2021-07-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="e871" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://blog.secureitmania.com/" rel="noopener ugc nofollow" target="_blank">安卓应用黑客系列</a></h2><div class=""/><div class=""><h2 id="d47c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">基于windows的Android应用动态分析实验室设置</h2></div><p id="40d0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi ln translated"><span class="l lo lp lq bm lr ls lt lu lv di">到</span>执行android应用渗透测试，我们需要一个有根的android设备。但是把我们的个人设备作为根并不总是安全的。所以，我带来了一个解决方案，你来分析没有实际设备的android应用程序。在下面，我解释了在windows上设置实验的整个过程。</p><h2 id="031d" class="lw lx it bd ly lz ma dn mb mc md dp me la mf mg mh le mi mj mk li ml mm mn iz bi translated">要求:</h2><ol class=""><li id="5e01" class="mo mp it kt b ku mq kx mr la ms le mt li mu lm mv mw mx my bi translated">ADB <a class="ae mz" href="https://secureitmania.medium.com/android-hacking-fundamentals-part-2-bbc6c3ea0189" rel="noopener">安装阅读此</a></li><li id="d01d" class="mo mp it kt b ku na kx nb la nc le nd li ne lm mv mw mx my bi translated">安装Genymotion <a class="ae mz" href="https://www.genymotion.com/download/" rel="noopener ugc nofollow" target="_blank">从这里下载</a>(如果您的PC上已经安装了VirtualBox，则在没有VirtualBox 选项的情况下转到<strong class="kt jd">)。</strong></li><li id="daa0" class="mo mp it kt b ku na kx nb la nc le nd li ne lm mv mw mx my bi translated">在<a class="ae mz" href="https://www-v1.genymotion.com/account/create/" rel="noopener ugc nofollow" target="_blank"> Genymotion </a>上创建一个帐户。</li></ol><h2 id="9485" class="lw lx it bd ly lz ma dn mb mc md dp me la mf mg mh le mi mj mk li ml mm mn iz bi translated"><strong class="ak">Genymotion上的虚拟设备设置:</strong></h2><p id="a963" class="pw-post-body-paragraph kr ks it kt b ku mq kd kw kx mr kg kz la nf lc ld le ng lg lh li nh lk ll lm im bi translated">首先，我们必须登录Genymotion，然后我们将使用android版API级配置创建一个虚拟设备。因为<strong class="kt jd">检查包</strong>只在这个版本上运行良好。</p><p id="f1e2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">通过点击右上角的“+”图标，我们会看到下面的窗口。在“7.1-API 25”类别下选择谷歌Nexus 5X设备，然后点击“下一步”按钮</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi ni"><img src="../Images/43fdc8d92cd40812e9589cdc284c09d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H6VZeih-1sgTHQPGO7CzIw.png"/></div></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk translated">在Genymotion上创建android VD</figcaption></figure><p id="b0cf" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在“网络模式”选项中选择“NAT”选项，然后单击“安装”按钮。</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi ny"><img src="../Images/68b18ccbbab8f73422f6398835f74387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bRV4E4f8DPgbrQnSKU8Y7A.png"/></div></div></figure><p id="f7b1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">Genymotion将下载适当版本的VD，因此需要一段时间。</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nz"><img src="../Images/8e7cd6e97cbe03daaad9634396ba1a22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ziXlm07pKqK2iAyy1KRTxg.png"/></div></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk translated">VD on Genymotion</figcaption></figure><h2 id="ef45" class="lw lx it bd ly lz ma dn mb mc md dp me la mf mg mh le mi mj mk li ml mm mn iz bi translated">安装Xposed框架</h2><ol class=""><li id="f27b" class="mo mp it kt b ku mq kx mr la ms le mt li mu lm mv mw mx my bi translated">从<a class="ae mz" href="https://forum.xda-developers.com/attachments/xposedinstaller_3-1-5-apk.4393082/" rel="noopener ugc nofollow" target="_blank">这里</a>下载暴露的安装程序APK</li><li id="f82b" class="mo mp it kt b ku na kx nb la nc le nd li ne lm mv mw mx my bi translated">从<a class="ae mz" href="https://dl-xda.xposed.info/framework/sdk25/x86/xposed-v89-sdk25-x86.zip" rel="noopener ugc nofollow" target="_blank">这里</a>下载Xposed框架zip</li><li id="dbec" class="mo mp it kt b ku na kx nb la nc le nd li ne lm mv mw mx my bi translated">从github repo <a class="ae mz" href="https://github.com/ac-pm/Inspeckage/releases" rel="noopener ugc nofollow" target="_blank">这里</a>下载Inspeckage v2.4 APK</li></ol><p id="9bd2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">从菜单启动虚拟设备</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi oa"><img src="../Images/088397378fe905eb81de55a1a8cd87e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fprdQrerabZFKpDJSbHuA.png"/></div></div></figure><p id="4c10" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">确保设备为adb在线</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi ob"><img src="../Images/dc5921f6b9dc79df4917a952e4da1385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pt3zh1Od9ufQuo66rCge3g.png"/></div></div></figure><p id="8a04" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">将Xposed框架zip文件(<code class="fe oc od oe of b">xposed-vXX-sdkXX-x86.zip</code>)拖放到您的虚拟设备显示器上，以刷新设备。</p><p id="f5fe" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">拖放暴露的安装程序APK ( <code class="fe oc od oe of b">XposedInstaller_*.apk</code>)。这将安装并启动<em class="og"> Xposed Installer </em>应用程序。在这个阶段，它将显示Xposed框架已安装但被禁用:</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi oh"><img src="../Images/d570a5cd1225a41e5ae0c659cb069430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0ddJI69QvpxC8rXq.png"/></div></div></figure><p id="a896" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">用<code class="fe oc od oe of b">adb reboot</code>命令重启设备。<strong class="kt jd">不要从<em class="og">暴露的安装程序</em>重启，因为这会冻结设备。</strong></p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/60bee831327b1ecc29983f8f00cb33c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*V_jl42vdOcJLXvS0riI7Gg.png"/></div></figure><p id="b722" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">启动<em class="og">曝光的安装程序</em>。它应该显示“Xposed Framework版本XX是活动的”</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi oh"><img src="../Images/9becddc00c572eb962a9d587a23ea504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QUDB2ryUyIWz3nmZ.png"/></div></div></figure><p id="eae9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">将inspe package APK(app-release . apk)拖放到您的虚拟设备显示屏上以安装该应用程序。</p><p id="7efa" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">安装后，转到x暴露的安装程序→模块→激活模块→通过adb重新启动</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/af46a530fd179b168855413602636988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*7sO6IX46hciTBUtWoyLEFQ.png"/></div></figure><h2 id="7856" class="lw lx it bd ly lz ma dn mb mc md dp me la mf mg mh le mi mj mk li ml mm mn iz bi translated">使用Inspeckage进行动态分析</h2><p id="5fdc" class="pw-post-body-paragraph kr ks it kt b ku mq kd kw kx mr kg kz la nf lc ld le ng lg lh li nh lk ll lm im bi translated">之后，成功安装Inspeckage和Xposed安装程序。现在我们可以用Inspeackage挂接任何应用程序。为此，请遵循以下步骤</p><ol class=""><li id="7c60" class="mo mp it kt b ku kv kx ky la ok le ol li om lm mv mw mx my bi translated">从应用程序抽屉中启动Inspeckage应用程序</li><li id="e230" class="mo mp it kt b ku na kx nb la nc le nd li ne lm mv mw mx my bi translated">单击“选择目标”文本并选择目标应用程序</li></ol><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi on"><img src="../Images/5e148d454aa2daa1b608d1b5b71cef41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5J_rCHOC0ga0YJ5kbwqbQ.png"/></div></div></figure><p id="ffc5" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">3.然后使用adb将VD本地主机端口转发到主机</p><pre class="nj nk nl nm gt oo of op oq aw or bi"><span id="40a4" class="lw lx it of b gy os ot l ou ov">adb forward tcp:8008 tcp:8008</span></pre><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi ow"><img src="../Images/f408a3a6a455442b4440a2d7f33bd88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4lEvYQBILsyr3DqTdiOzig.png"/></div></div></figure><p id="d860" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">4.现在点击“<strong class="kt jd">启动应用</strong>按钮，然后访问<code class="fe oc od oe of b"><a class="ae mz" href="http://127.0.0.1:8008" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8008</a></code></p><p id="8454" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">5.现在点击打开按钮检查应用程序。(在“打开”之前，确保<code class="fe oc od oe of b">App is running:</code>状态应为<strong class="kt jd">真</strong></p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi ox"><img src="../Images/592d016fe3e8497a2e9ebb33fa205847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jCs1Qo4vlgKyb6yIGvIl4w.png"/></div></div></figure><h2 id="0259" class="lw lx it bd ly lz ma dn mb mc md dp me la mf mg mh le mi mj mk li ml mm mn iz bi translated">将Burp Suite CA安装到Android系统</h2><p id="9f34" class="pw-post-body-paragraph kr ks it kt b ku mq kd kw kx mr kg kz la nf lc ld le ng lg lh li nh lk ll lm im bi translated"><strong class="kt jd">导出并转换打嗝CA </strong>第一步是获得正确格式的打嗝CA。使用Burp Suite，以DER格式导出CA证书。我保存为<code class="fe oc od oe of b">cacert.der</code></p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi oy"><img src="../Images/1487a019dde9e58eb5d40deb0d6f7825.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fF0XN-wrU_TJFQB6Of828g.png"/></div></div></figure><p id="6278" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">Android希望证书采用PEM格式，并且文件名等于附加了<code class="fe oc od oe of b">.0</code>的<code class="fe oc od oe of b">subject_hash_old</code>值。</p><p id="7584" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">使用<code class="fe oc od oe of b">openssl</code>将DER转换为PEM，然后输出<code class="fe oc od oe of b">subject_hash_old</code>并重命名文件:</p><pre class="nj nk nl nm gt oo of op oq aw or bi"><span id="f259" class="lw lx it of b gy os ot l ou ov">openssl x509 -inform DER -in cacert.der -out cacert.pem<br/>openssl x509 -inform PEM -subject_hash_old -in cacert.pem</span></pre><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi oz"><img src="../Images/0b5b99ca7d092225531f6eb24f06c5a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ekwpy6HE091_ylVZ9Ag5Hw.png"/></div></div></figure><p id="e599" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在用<code class="fe oc od oe of b">&lt;hash&gt;.0</code>重命名cacert.pem文件</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi pa"><img src="../Images/bb8fd1d456ea9809f7a669c7e8457f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTKzxHONX7EKK5PJhbE-zQ.png"/></div></div></figure><p id="4dd1" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">将证书复制到设备</strong>我们可以使用<code class="fe oc od oe of b">adb</code>来复制证书，但是由于它必须被复制到<code class="fe oc od oe of b">/system</code>文件系统，我们必须将它重新挂载为可写。作为root用户，这对于<code class="fe oc od oe of b">adb remount</code>来说很容易。</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi pb"><img src="../Images/5165df639dcb26f59bffc1d0ceaebd24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z949fnqVQH3_37SymuQxsA.png"/></div></div></figure><p id="f855" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">然后放入一个shell ( <code class="fe oc od oe of b">adb shell</code>)并将文件移动到<code class="fe oc od oe of b">/system/etc/security/cacerts</code>并将其改为644:</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi pc"><img src="../Images/85d920ecedf0c8edd5e0c6b552c299f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s3lU6gDzN6nEff1XpKGgWw.png"/></div></div></figure><p id="c044" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">最后，我们必须通过<code class="fe oc od oe of b">adb reboot</code>或重启来完全重启设备。</p><h2 id="1091" class="lw lx it bd ly lz ma dn mb mc md dp me la mf mg mh le mi mj mk li ml mm mn iz bi translated">VD代理到Burp套件配置</h2><p id="af00" class="pw-post-body-paragraph kr ks it kt b ku mq kd kw kx mr kg kz la nf lc ld le ng lg lh li nh lk ll lm im bi translated">首先知道你的机器的IP地址，并把它添加到你的Burp代理中，并附上你想要的端口</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi pd"><img src="../Images/acd162cf721a4bd99786cc2cc6a75c5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e1Aq_f9Ak4YxGURihZLjkQ.png"/></div></div></figure><p id="0b74" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在进入Genymotion的设置菜单</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi pe"><img src="../Images/b8a3d42d05b031b6b38f3476e882282f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xtejWHYtjCmtVYhgSGsdw.png"/></div></div></figure><p id="980d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在网络设置中输入Burp Suite代理的IP端口</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi pf"><img src="../Images/8d82093c70a067e42793133469118164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjA_P55MIVKj7bpbohxWWw.png"/></div></div></figure><p id="9da0" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">此外，在虚拟设备上设置相同的代理配置。</p><p id="41f3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">导航至设置→ WIFI →长按“WiredSSID”→点击“修改网络”</p><p id="21a7" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">输入Burp Suite代理的IP端口并保存</p><figure class="nj nk nl nm gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi pg"><img src="../Images/460a01ca036c97fc62cbbce3ac2320c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOGBEhl1Rs4Kfl5L809_VA.png"/></div></div></figure><p id="c8ad" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在可以用Burp Suite设置代理所有应用流量了。</p></div><div class="ab cl ph pi hx pj" role="separator"><span class="pk bw bk pl pm pn"/><span class="pk bw bk pl pm pn"/><span class="pk bw bk pl pm"/></div><div class="im in io ip iq"><p id="53de" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">感谢阅读。如果你喜欢这篇<strong class="kt jd">报道</strong>，请关注我，继续关注更多<strong class="kt jd">黑客技术</strong>使用Inspeckage和查看<a class="ae mz" href="https://blog.secureitmania.com" rel="noopener ugc nofollow" target="_blank"> <strong class="kt jd">我的个人资料</strong> </a>了解更多秘密。</p><p id="49ae" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">关注我的<a class="ae mz" href="https://www.instagram.com/secureitmania/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt jd"> Instagram </strong> </a>，<a class="ae mz" href="https://twitter.com/secureitmania" rel="noopener ugc nofollow" target="_blank"> <strong class="kt jd"> Twitter </strong> </a>获取BugBountytips、infosec信息</p></div></div>    
</body>
</html>