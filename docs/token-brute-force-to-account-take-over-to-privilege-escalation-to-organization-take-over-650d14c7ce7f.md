# 令牌暴力从帐户接管到权限提升到组织接管

> 原文：<https://infosecwriteups.com/token-brute-force-to-account-take-over-to-privilege-escalation-to-organization-take-over-650d14c7ce7f?source=collection_archive---------3----------------------->

![](img/310c2e454eb13e5398e6f428f83af65b.png)

**TL；博士**，并不是所有的网络漏洞都是技术问题的结果，功能性错误会对业务产生重大影响。这是一个故事，讲述了简单问题和糟糕的设计缺陷如何导致帐户接管、权限提升和最终组织接管。

在开发一个私人项目时，我在 redacted.com 上测试一个产品，这基本上是一个在一个地方查看和管理从几个应用程序收集的所有商业数据的应用程序(想象一下有多少有价值的数据在那里)。公司能够在这个应用程序中创建一个工作空间或组织，然后管理员会邀请用户加入。

我经常从测试邀请功能开始，因为它经常导致严重的问题。只有两种可能的角色用户或管理员，起初邀请流看起来很稳定 CSRF 保护到位 CORS 配置正确看起来好像什么都没有，一切都很好，直到我发现第一个问题，邀请系统有一个巨大的问题，如果管理员邀请外部用户，邀请链接看起来像这样

> https://login.redacted.com/accounts/?service=product&digest = saaobexstzdrqgvlsrpagpsy 0
> 
> 很可靠，对吧？

接下来，我尝试邀请一个在 redacted.com 上拥有现有账户的用户，结果显示邀请完全不同，链接看起来像这样

> https://product.redacted.com/invitations?invite id = 160000002637191 & type = accept & source = mail
> 
> 没有签名没有哈希什么都没有！！！等等，哇！！！！！

你可以看到这是怎么回事。首先，在我们潜水之前，让我戴上我的特殊眼镜*普京*。

![](img/80aee0e0d683e5a204909ebd0609fcc5.png)

通过进一步检查，我得出结论，前 12 个数字是指组织，后 3 个数字是邀请 id，在这种情况下，160000002637 是组织 id，而 191 是邀请 id。这很容易被暴力破解。

通过更多的测试，我发现这个 id 不仅是难以破解的，如果其他人使用它，它也不会过期，所以如果管理员向 X 电子邮件发送邀请，但攻击者可以通过电子邮件 Y、Z 和 N 加入组织，那么在使用电子邮件 X 之前，该邀请仍然有效。这意味着攻击者可以暴力令牌渗透组织和管理员仍然会看到邀请待定，酷哈！总结一下这部分的场景

*   组织的管理员通过电子邮件 X 向用户 A 发送邀请
*   攻击者暴力邀请 ID
*   攻击者用电子邮件 Y 注册
*   攻击者在组织内部
*   管理员将看到邀请仍处于待定状态

你可能会认为这将导致组织接管或权限提升，该应用程序还有另一个问题，用户可以查看待定的邀请及其角色，一旦他找到一个管理邀请，他就可以利用它，并使用公开的电子邮件地址接管整个事情。换句话说，这将大大减少暴力攻击，一旦他找到一个有效的令牌，他将停止暴力加入该组织。如果邀请是针对管理员的，那么他就中了头彩。如果邀请是针对用户的，他将简单地继续检查未决邀请部分，直到他找到管理员邀请。鉴于一个组织可能有大量用户的事实，他有很大的机会保持不被注意。

作为一名赏金猎人，你也应该调查功能性错误，因为这些错误会导致严重的商业影响。

下次再见，
祝大家狩猎愉快，

[全会](https://medium.com/u/d5bc3c7f04c0?source=post_page-----650d14c7ce7f--------------------------------)