<html>
<head>
<title>Bug Bounty: Broken API Authorization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Bug赏金:API授权被破坏</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bug-bounty-broken-api-authorization-d30c940ccb42?source=collection_archive---------0-----------------------#2019-11-12">https://infosecwriteups.com/bug-bounty-broken-api-authorization-d30c940ccb42?source=collection_archive---------0-----------------------#2019-11-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0c3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，我想分享一下我是如何在一个私人程序中发现一个简单的API授权漏洞的，它影响了数千个子域，并允许我在没有用户交互的情况下利用过多的未受保护的功能，从帐户删除到接管和泄露有限的信息(全名、电子邮件id和雇主)。</p><p id="24be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Tl；dr: </strong>服务器没有检查授权承载令牌是属于普通用户还是超级用户。</p><p id="a9ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个私人项目，所以有些信息会被编辑，我会把这个网站称为“target.com”。</p><p id="a0b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在浏览academy.target.com的<br/><strong class="jp ir"/>时，在后台运行了一个<em class="kl"> dirsearch </em>扫描，以获得网站功能的概览。<br/>我注意到一个有趣的端点，比如:<strong class="jp ir">academy.target.com/api/docs</strong><br/>像这样的端点是一座金矿，因为它们有API文档，并指定请求和响应的结构。</p><p id="8b6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在浏览到端点时，我发现这个页面与Swagger UI极其相似(尽管这个站点没有使用Swagger)。它还有一个简单的名为“认证”的按钮，点击它会导航到一个登录页面，但如果我尝试登录，它会显示“帐户未授权”的消息。</p><p id="7674" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一些有趣的端点，比如:<br/><strong class="jp ir">/power user/add<br/>/power user/delete<br/>/user/delete<br/>/user/create<br/>/user/user _ logged _ in<br/>/user/profile</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/29c1e754fa191125c093a898d02ab330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81lZG5DOMtk5lbmW0-9IJQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">页面看起来有点像这样。</figcaption></figure><p id="2ddd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这让我措手不及，因为这些端点似乎应该只留给内部/高级用户使用。<br/>在没有任何API令牌或授权头的情况下直接调用端点导致:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lc"><img src="../Images/b383de74c90249cd1d9cf2433f2da284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgPXL8iHd57ZCNGDaPRhLg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">意料之中的令人失望的反应</figcaption></figure><p id="df46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该网站似乎没有提供任何API，我也找不到任何生成API令牌的方法，所以我决定以后再去看看。在广泛搜索了站点之后，我仍然无法在请求或响应中找到一个API令牌。<br/>然而，我注意到许多请求都有一个授权持有人令牌。</p><p id="e2c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定简单地复制这个头，并把它包含在对我找到的API端点的调用中。<br/>我创建了另一个账户，并试图更改其密码，向<strong class="jp ir"> api/user/edit </strong>发出<strong class="jp ir"> POST </strong>请求。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/9acab69b882f7fdc7059c560ad22059d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*iyuxE3Ekb8kFu__Lj_iuSQ.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">更改另一个用户密码的HTTP请求，这一次是使用不记名令牌的<strong class="bd le">。</strong></figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/9b3ebeb7e2cf26d1e5410303ac002ec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*l5tBlA1yF1rgJNQE72XOKQ.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">成功回复lol。</figcaption></figure><p id="e350" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">瞧啊。它非常有效。除了将我的帐户升级为超级用户之外，我还可以成功地调用几乎所有其他API端点。文档详细列出了我删除/接管/创建新账户以及做其他一些坏事所需的参数。</p><p id="fbd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定直接向供应商报告这个漏洞，结果发现他们有一个私人的漏洞奖励计划，并奖励了我440美元。</p><p id="8198" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><p id="003f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">关注</em> <a class="ae ln" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="kl"> Infosec报道</em> </a> <em class="kl">获取更多此类精彩报道。</em></p><div class="lo lp gp gr lq lr"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">信息安全报道</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">medium.com</p></div></div><div class="ma l"><div class="mb l mc md me ma mf kw lr"/></div></div></a></div></div></div>    
</body>
</html>