<html>
<head>
<title>Proxy: Accessing Network Connection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代理:访问网络连接</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/proxy-accessing-network-connection-a97e15f0cf73?source=collection_archive---------5-----------------------#2022-03-22">https://infosecwriteups.com/proxy-accessing-network-connection-a97e15f0cf73?source=collection_archive---------5-----------------------#2022-03-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f878" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇博客中，我将解释如何在Tryhackme/HTB/etc机器上访问网络连接。当我们尝试pwn机器或玩攻击/防御挑战时，有一个互联网连接将使它变得容易得多，尽管它可能很慢但很有效。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/176ba3844d054458af76f8a195c3c122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/0*e6S21Ex5UxvvaNEK"/></div></figure><h1 id="36be" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">设置</h1><p id="1f5c" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我正在我的机器上表演，它可以在TryHackMe链接上免费播放:<a class="ae lw" href="https://tryhackme.com/room/enpass" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> EnPass </strong> </a></p><p id="f59c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">机器启动了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi lx"><img src="../Images/48ae110c621428765d8dcd9b1fdccee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*48vEmbWAQD-ng2ul.png"/></div></div></figure><p id="3f80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们必须在本地机器上安装一个代理服务器。我将使用<em class="mc">鱿鱼代理</em>。我在wsl2上使用arch。</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="6981" class="mi ku iq me b gy mj mk l ml mm">For arch: sudo pacman <strong class="me ir">-Sy</strong> squid<br/>For ubuntu: sudo apt install squid <strong class="me ir">-y</strong></span></pre><p id="c0e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后启用squid服务并启动它。</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="b28a" class="mi ku iq me b gy mj mk l ml mm">sudo systemctl enable squid<br/>sudo systemctl start squid<br/>or<br/>sudo service squid start</span></pre><p id="13d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们局部检查它是否工作。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mn"><img src="../Images/874518bd608c0548121b4c781cdfa9fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KU_XwfbBqQMMTSGvcInNNg.png"/></div></div></figure><p id="ab91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，连接是通过squid代理建立的。正常情况下，它应该是这样的(没有Via: header)。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mo"><img src="../Images/6cf475f5217fc500219907ae8cc0b55b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTgxiKijkxpKZCwRgH9iYA.png"/></div></div></figure><p id="3ef3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，我们的设置很好。现在，让我们首先获得对远程机器的root访问权限。</p><h1 id="4702" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">受过训练会玩把戏的</h1><p id="286c" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">现在，我作为根用户在远程机器上。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/9c549f404dbd4a745e3cac5592af7ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*M1K3nUZ3aZtL3e5Ab7ZvTg.png"/></div></figure><p id="19d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> squid代理</strong>在端口3128上运行。我们必须首先通过ssh将我们的流量转发到远程机器。</p><p id="0e31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，它是一个<strong class="jp ir">远程端口</strong>转发，所有的流量/连接通过SSH客户端从SSH服务器传递到<br/>远程服务器。<br/>简而言之，我们向不能访问的人提供访问，而在<strong class="jp ir">本地端口转发</strong>中，我们访问我们不能访问的资源。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mq"><img src="../Images/cc48f268128228e7edc188604b19afad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yWF9UGg6dqlN1iNZESjDqw.png"/></div></div></figure><p id="59a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已成功进行端口转发。</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="c1a7" class="mi ku iq me b gy mj mk l ml mm">ssh <strong class="me ir">-R</strong> 3128:&lt;your-ip&gt;:3128 <strong class="me ir">-i</strong> id_rsa root@&lt;machine-ip&gt;<br/>ss <strong class="me ir">-ltnp</strong> | grep 3128</span></pre><p id="91c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们借助curl来确认一下。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mr"><img src="../Images/5dc6cf10ce0344e49fd9b8867e4b50f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rYzRuwRYeVxf-PFHW48j_A.png"/></div></div></figure><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="64a0" class="mi ku iq me b gy mj mk l ml mm">curl  <strong class="me ir">-x</strong> http://127.0.0.1:3128 http://www.google.com/ <strong class="me ir">-I</strong></span></pre><p id="579f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mc">我们对此很满意</em></p><p id="4a6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经成功地建立了网络连接。</p><h1 id="acea" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">额外的</h1><p id="da99" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">如果我们想下载软件包呢？没有互联网连接，apt cmdline 不会下载或更新任何东西。只需几个步骤，它就会开始工作。</p><p id="1472" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将以下行添加到“<em class="mc">/etc/profile”</em>中。这将使代理环境对全局所有用户启用。</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="3cf7" class="mi ku iq me b gy mj mk l ml mm">export http_proxy=http://127.0.0.1:3128/</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mr"><img src="../Images/2b31ec971746556a3a9a5938bf985d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rXK91j3OuMETzxWujGRfaQ.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ms"><img src="../Images/1444785275ef876a2452637befb812ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7U4zA_JWG0Knu-giZAxO8w.png"/></div></div></figure><p id="3191" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在不必提及“-x”标志。<br/> <em class="mc"> apt </em>现在也能工作了。可以看到<em class="mc"> Nmap </em>没有先安装。我们试试安装<strong class="jp ir"> Nmap </strong>吧。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi mt"><img src="../Images/e9beb6990c6d50fe336dcd7312d4e8de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aK7kv-86Rz1iwEKeiNdufA.png"/></div></div></figure><p id="6071" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，我们现在成功地获得了互联网连接。</p><p id="ccf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您不能安装任何包(<strong class="jp ir"> apt </strong>)，那么您可以尝试将下面一行添加到文件"<strong class="jp ir"> /etc/apt/apt.conf </strong>"中。<br/>找不到就创建。</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="8f3b" class="mi ku iq me b gy mj mk l ml mm">Acquire::http::Proxy "http://127.0.0.1:3128/";</span></pre><p id="d743" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读。:)</p><p id="3711" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你白天/晚上愉快。</p></div></div>    
</body>
</html>