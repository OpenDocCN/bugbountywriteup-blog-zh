<html>
<head>
<title>Android Pentesting 101 — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android Pentesting 101 —第1部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/android-pentesting-101-part-1-8e31b8cd8b2b?source=collection_archive---------1-----------------------#2022-10-22">https://infosecwriteups.com/android-pentesting-101-part-1-8e31b8cd8b2b?source=collection_archive---------1-----------------------#2022-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fefc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated">欢迎来到这个新的Android Pentesting系列。这个系列是关于你如何使用各种方法入侵Android并找到其中的漏洞。在这个系列中，我们的目标是实现所有你能找到的漏洞以及方法。在第一部分中，我们的目标是涵盖android pentesting是如何完成的以及执行它所需的所有工具的基本描述。所以，准备好并装载你的武器吧！！！</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/dc242221ef7ba3d13abebca1e19392a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*Qp-Pn82y2doe4I8U"/></div></figure><p id="a6d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单来说，移动应用程序通常有三种类型:</p><ol class=""><li id="6f98" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">本地应用程序:这些是为特定操作系统(OS)或平台开发的移动应用程序。他们通常需要一个模拟器，基于网络的攻击(如XSS)是不可能的。</li><li id="0298" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">基于网络的应用程序:这些是基于浏览器的应用程序，通常使用<a class="ae lq" href="https://developer.android.com/reference/android/webkit/WebView" rel="noopener ugc nofollow" target="_blank">WebView</a>(Android中的一个系统组件)在Android操作系统上显示网页。他们不需要模拟器，基于网络的攻击(如XSS)是可能的。</li><li id="02fc" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">混合应用程序:顾名思义，它们是上述两种应用程序的组合，通常需要一个仿真器来进行测试。这些是你在现实世界中会发现的应用。</li></ol><p id="e68f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，在我们了解android pentesting之前，了解一下<strong class="jp ir"> Android架构</strong>是如何工作的非常重要。我将给出每个组件的简短描述，但如果你想深入了解，你可以从<a class="ae lq" href="https://www.geeksforgeeks.org/android-architecture/" rel="noopener ugc nofollow" target="_blank">这里</a>了解。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lr"><img src="../Images/e73c61c2faafa02693aa1307edfe4e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jn1exwz9CvO_shdE.jpg"/></div></div></figure><ol class=""><li id="5eb8" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">应用程序:体系结构的最顶层，安装了所有第三方应用程序。例子包括Camera，WhatsApp，Google等。</li><li id="1151" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">应用程序框架:这是为Android应用程序的创建提供各种类的层。例如活动经理、内容提供商等。</li><li id="c4b7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Android运行时:最重要的一层由Dalvik VM组成。Dalvik虚拟机(DVM)类似于JVM，支持应用程序运行，并提供各种平台库，如SSL、SQLite、Media等。</li><li id="025d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Linux内核:这是android架构的核心，提供诸如安全性、内存管理、进程管理等特性。</li></ol><p id="fa66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们快速先睹为快各种<a class="ae lq" href="https://www.tutorialspoint.com/android/android_application_components.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">安卓组件</strong> </a>。</p><ol class=""><li id="a3f5" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">Activity:这些是java类，它们有一些预定义的函数，在不同的应用程序状态下被触发。总共有四种应用程序状态:活动、暂停、停止和销毁。可以调用的不同方法有onCreate()、onStart()、onResume()、onPause()、onStop()、onDestroy()。想象一个场景，当敏感数据正在传输，onPause()方法出现，n秒后onResume()方法被调用，应用程序将如何处理敏感数据？这可能是一个很好的检查案例。</li><li id="5437" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">服务:这些操作发生在后台，没有用户界面。服务至关重要，应该经常检查，因为攻击者通常会在这里植入恶意软件。一个示例场景是计算器应用程序请求呼叫日志许可。</li><li id="c31d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">意图:它们被绑定到应用程序中的不同组件，用于在不同的应用程序中执行不同种类的动作和调用活动。意图过滤器用于保护活动。</li><li id="7af6" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">内容提供者:作为中间层从各种来源访问数据。</li><li id="d768" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">广播接收器:这些接收器接收来自各种事件的广播消息，这些事件可能来自一个或多个应用程序。例如，当一个应用程序收到SMS时，它会向所有其他应用程序发送广播消息。</li></ol><p id="cc6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在来说说<strong class="jp ir"> Android文件系统。</strong>以下是文件层次结构中的文件夹:</p><ol class=""><li id="b8a5" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">/boot:由Android内核和ramdisk组成的可引导文件</li><li id="6c62" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">/system:整个Android操作系统都存储在这个文件夹中。它还包含预安装的系统应用程序，这些应用程序存储在/system/app中</li><li id="8839" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">/recovery:此文件夹是为备份而设计的，并被视为备用启动选项。</li><li id="ee07" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">/cache:此文件夹存储经常访问的应用程序数据和组件</li><li id="102c" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">/misc:包含杂项系统设置</li><li id="ca35" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">/sdcard:此文件夹是可供用户存储文件和数据的空间。</li><li id="6eb7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">/data:这个特定的文件夹包含所有用户数据。</li></ol><ul class=""><li id="347a" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lw li lj lk bi translated">/data/data:由用户安装的所有应用程序数据组成</li><li id="10c1" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lw li lj lk bi translated">/data/app:由用户安装的应用程序的所有apk组成</li><li id="119d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lw li lj lk bi translated">/data/system:由gesture.key、password.key等文件组成</li><li id="d8a5" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lw li lj lk bi translated">/data/local/tmp:可写临时</li></ul><p id="a16b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">某些重要的文件和文件夹通常是在创建应用程序时创建的。在我们的android测试中，查看这些文件和文件夹至关重要。不同的重要文件和文件夹如下:</p><ol class=""><li id="0e89" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">AndroidManifest.xml:具有应用程序的结构和元数据。通常，所有权限、API密钥等。存储在这个特定的文件中。</li><li id="bae7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Java:这个特定的文件夹包含Java源代码文件。</li><li id="8bf7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">可绘制:所有图片、视频、gif等。存储在这个特殊的文件夹里。</li><li id="8828" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">布局:布局定义了用户界面的视觉结构，比如Android应用程序的UI。</li><li id="5c06" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">mipmap:通常包含不同图标的图像资源文件夹。</li><li id="6a08" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">colors . XML:Android应用程序的颜色资源文件。</li><li id="65e3" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Android应用程序的字符串资源文件。</li><li id="e74b" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Android应用程序的样式资源文件。</li><li id="80f3" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">build.gradle:这个特殊的文件用于添加各种依赖项。该文件还包含SDKVersion号和其他重要的详细信息。</li></ol><p id="f04d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们来谈谈Android架构的最后一个话题，Android数据存储模型。Android以5种方式存储数据:</p><ol class=""><li id="f2c5" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">共享偏好:在设备上以键值对的形式存储私有数据。</li><li id="041e" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">内部存储:在设备的内存中存储私人数据。</li><li id="ab92" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">外部存储:在共享的外部存储上存储公共数据。</li><li id="82ea" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">SQLite数据库:存储在私有数据库中的结构化数据。</li><li id="8a2d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">网络连接:用你的网络服务器在网上存储数据。</li></ol><p id="b736" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们都知道，一旦创建了Android应用程序，就会生成一个. apk文件。有没有想过这到底是什么？apk文件？？apk文件只不过是源代码的zip文件，其中包含所有的资源、dex代码、资产、清单文件等等。下图显示了如何将Java源代码转换为APK文件。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lx"><img src="../Images/2377d45a08b524cc13b6301ef3ac87a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5Fmy2D7E5kWxb_vSGv5rQ.png"/></div></div></figure><p id="80a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完美！既然我们已经了解了整个android架构，那么让我们来了解一下实际的测试方法是如何工作的！！有两种类型的分析通常在执行Android pentesting时进行。</p><ol class=""><li id="0783" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">静态分析:这意味着查看APK的源代码，并通过检查APK找出漏洞。这有点类似于源代码审查。我们通常会留意不同的意图函数、源和接收器、危险的权限、硬编码的API密钥等。这就是我们深入研究Android架构细节的原因。(我知道这有点漫长和无聊，但也很有必要:P)</li></ol><p id="a067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.动态分析:动态分析就是处理请求和响应。但是这里有一个陷阱，就像普通的网页测试一样，在Android(以及iOS)中，请求和响应并不被直接捕获。我们首先需要绕过根检测，然后绕过SSL锁定。我们将在接下来的文章中了解更多。</p><p id="eec5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是时候拿起你的武器了；)以下是执行静态和动态分析所需的所有工具的精选列表。</p><ol class=""><li id="1b2b" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">Android设备:显然，您需要一个Android设备来执行测试。它可以是一个真正的android设备，也可以是一个模拟器。如果是真正的安卓设备，要确保安卓设备是rooted的。使用名为<a class="ae lq" href="https://magiskmanager.com/" rel="noopener ugc nofollow" target="_blank"> Magisk </a>的工具可以很容易地进行生根。对于仿真器，你可以使用<a class="ae lq" href="https://www.genymotion.com/" rel="noopener ugc nofollow" target="_blank"> Genymotion </a>。有时模拟器确实滞后，拥有一个真正的android设备会更有好处。</li><li id="58f6" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae lq" href="https://dl.google.com/android/repository/platform-tools-latest-windows.zip" rel="noopener ugc nofollow" target="_blank"> Android调试桥(ADB) </a>:用于与设备通信，并在设备上执行调试操作。</li><li id="2228" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae lq" href="https://github.com/pxb1988/dex2jar" rel="noopener ugc nofollow" target="_blank"> Dex2jar </a> : Dex2jar是一个很棒的工具，可以帮助你将Dex代码转换成jar格式，这样阅读源代码就更容易了。</li><li id="b802" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae lq" href="http://java-decompiler.github.io/" rel="noopener ugc nofollow" target="_blank"> JD-GUI </a> : JD-GUI是一个可以让你直接查看一个APK文件的java源代码的工具。</li><li id="78d6" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae lq" href="https://mobsf.github.io/docs/#/installation" rel="noopener ugc nofollow" target="_blank"> MobSF </a> : MobSF是一个多合一的安全工具，可以帮助你执行自动静态分析，让你的工作简单很多。</li><li id="1a19" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">drozer :用于Android安全的Metasploit框架(MSF ),允许您找到漏洞并利用它们。</li><li id="9c9f" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Frida :一个将会帮助绕过很多东西的工具；)</li><li id="f492" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae lq" href="https://github.com/sensepost/objection" rel="noopener ugc nofollow" target="_blank">异议</a>:又一个会帮我们绕过很多东西的工具；)</li><li id="25c4" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae lq" href="https://github.com/fornwall/apksigner" rel="noopener ugc nofollow" target="_blank"> apksigner </a>:用于对修改后的apk进行签名。</li><li id="8599" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae lq" href="https://portswigger.net/burp" rel="noopener ugc nofollow" target="_blank">打嗝组曲</a>:哦！别忘了上帝！！</li></ol><p id="bbba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是第一部分的所有人！我们希望你喜欢这篇文章！我们将很快返回另一部分，在那里我们将向您展示在执行Android Pentesting时的静态分析方法。</p><p id="e76d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">狩猎愉快！</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="7033" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">作者:</strong></p><p id="27b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">瓦伊巴夫·拉哈尼:<a class="ae lq" href="https://www.linkedin.com/in/vaibhav-lakhani" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/vaibhav-lakhani</a></p><p id="58c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lq" href="https://www.linkedin.com/in/dhir-parmar-925b171a4" rel="noopener ugc nofollow" target="_blank">迪尔·帕尔马</a>:<a class="ae lq" href="https://www.linkedin.com/in/dhir-parmar-925b171a4" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/dhir-parmar-925b171a4</a></p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h2 id="249b" class="mf mg iq bd mh mi mj dn mk ml mm dp mn jy mo mp mq kc mr ms mt kg mu mv mw mx bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lq" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>