<html>
<head>
<title>TryHackMe- Gaming Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe-游戏服务器</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-gaming-server-191d2f142a12?source=collection_archive---------1-----------------------#2020-12-03">https://infosecwriteups.com/tryhackme-gaming-server-191d2f142a12?source=collection_archive---------1-----------------------#2020-12-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="657e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本演练与来自Try Hack Me- Gaming Server的easy level box相关。根据这个房间里的标签，我们可以理解我们可以学习一些新概念来完成任务。让我们开始吧。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/933b7c5dd22589dfc0a01fb27b9e818e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*kb4VWQBpTMaAw9LVflgFeg.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">TryHackMe-游戏服务器</figcaption></figure><p id="eeb6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们部署机器并为开放端口运行Nmap。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="4780" class="lc ld iq ky b gy le lf l lg lh">nmap -sC -sV -Pn 10.10.75.194</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/639fab3827fc1b24740ae1c35a6938e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQiDsHdkvvFywjsq97YNUQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Nmap结果</figcaption></figure><p id="a9f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到22，80个端口处于打开状态。让我们运行gobuster进行目录枚举并导出输出。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="a3b3" class="lc ld iq ky b gy le lf l lg lh">gobuster dir -u <a class="ae ln" href="http://10.10.75.194" rel="noopener ugc nofollow" target="_blank">http://10.10.75.194</a> -w /usr/share/dirb/wordlists/common.txt | tee gobuster.txt</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/6adc561c810903e5c7566049dc935b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*VTwAZPUwJj48g8bkBQy9NQ.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">gobuster</figcaption></figure><p id="b761" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧…，我们得到了我们的gobuster结果。但是，在检查它们之前，让我们首先检查HTTP站点。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lp"><img src="../Images/ca9060d5d0edd8447ffb93a53945ee2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EEX6g1jRf_fQF48cUEdZwg.png"/></div></div></figure><p id="7a65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，看起来这是一个添加了多种内容的动态网站。让我们检查一下源代码，看看是否能找到什么。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lq"><img src="../Images/237b664a3d031e5b1b28d5dcd67f6044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-fyJ8gvwNG87v4hvJNpqwA.png"/></div></div></figure><p id="46c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">呼，我们收到了一条评论，其中突出显示了一个名叫“约翰”的人。让我们记下这个名字，以备将来使用。现在让我们一个一个地检查目录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/a71685516b9009cced5eb44d950a7704.png" data-original-src="https://miro.medium.com/v2/resize:fit:290/format:webp/1*0QoH6HCxHmOPKJ1bQcO6KA.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/c9423736ef16b07ef8b390fc8a512644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*FUyTioYuPwly_g-aAG5BIg.png"/></div></figure><p id="1a26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到robots.txt文件中有一个关于目录的条目。我已经导航到那里，看到有3个文件。其中一个是字典文件。</p><p id="2c48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们暂时把这个放在一边，探索一下这个奇怪的“秘密”目录。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/d946595461281d54765bda45c06b657c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*1BD1Pi7IwbKpe34iFIjqtA.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">秘密目录中的秘密密钥</figcaption></figure><p id="afe4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哦，太好了，我们有一把秘密钥匙。让我们抓住钥匙，用约翰来破解它。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lu"><img src="../Images/9adffad0b8ace607bf12fda8be9cd69f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FIr5CNxjKF2_GV0ZI5ylnw.png"/></div></div></figure><p id="9b08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从robots文件中获得了密钥和用户名“john”。让我们抓住宋承宪继续前进。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/3e32384a7c4ac90f74bbd963c5b7773e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*H4zxyjbKbuL1yqq6ztjZaQ.png"/></div></figure><p id="9e75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，终于得到了SSH会话。让我们找出我们的初始密钥。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lw"><img src="../Images/76948c263c2cfa85ea08915b1e944bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*3fgivhidkz1V3W73LIdqXg.png"/></div></div></figure><p id="ad27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要提升我们的特权。我试过经营sudo -l，但没有运气。我已经检查了这台机器的标签，注意到一个与lxd相关的标签。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="9c07" class="lc ld iq ky b gy le lf l lg lh"><strong class="ky ir">LXD</strong> is a next generation system container manager. It offers a user experience similar to virtual machines but using Linux containers instead. It's image based with pre-made images available for a wide number of Linux distributions and is built around a very powerful, yet pretty simple, REST API.</span></pre><p id="3dac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试了一些LXD的公共漏洞，发现了一个Ubuntu 18.04的漏洞。这是在alpine发行版上制作的，在那里我们需要构建Alpine并创建一个容器，该容器有一个获得root访问权限的脚本。让我们一步一步来。</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="4081" class="lc ld iq ky b gy le lf l lg lh">1.Firstly, we need to clone the required alphine git repo and build it on our machine(Attacker)<br/>2.Once we build it, we will have a compressed image file in tar format.<br/>3. We need to make a script which exploit the lxd group and send both of them to victim machine.<br/>4. Change the permission of the script and run it.<br/>5. Once you run the script, it will import the image and create the container with elevated access.<br/>6. Since the image have the admin access and it will mount the whole victim machine's root disk and give complete access.<br/>7. Now since we are root in this image with having access to our victim's machine's root directory, we can navigate it and get our final flag</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lx"><img src="../Images/ecd27aaf6cd8303f2e8a4be8c4cb3313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sH5olH6E5yWB5dDXtpmwaw.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/cbf7c387c579ad9d0bd807994133453a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*hLAYAzgV7MVfTz3cK9saBw.png"/></div></figure><p id="be60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们拿到了第二面旗子。我们可以在这台机器上进一步探索，了解这种级别的访问是如何工作的。我会尽快写下并分享更多关于LXD的事情。</p><p id="0328" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读此…:)</p></div></div>    
</body>
</html>