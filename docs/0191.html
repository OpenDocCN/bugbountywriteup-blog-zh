<html>
<head>
<title>DUPLICATE BUT STILL COOL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重复但仍然很酷</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/duplicate-but-still-cool-236835685075?source=collection_archive---------0-----------------------#2018-11-05">https://infosecwriteups.com/duplicate-but-still-cool-236835685075?source=collection_archive---------0-----------------------#2018-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/c2fb429fa335abe470856ebdc9374a6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*gZ8osYSbgvUglMeM_SEH3w.jpeg"/></div></figure><p id="432e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">TL；博士</strong>，从低影响到账户接管再到复制这里是我在<a class="ks kt ep" href="https://medium.com/u/6f816e37be2c?source=post_page-----236835685075--------------------------------" rel="noopener" target="_blank"> HackerOne </a>的一个私人程序上发现的一个很酷的bug的故事。</p><p id="e833" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">redacted.com公司为用户提供CRM服务，用户可以注册成为一个组织，然后邀请具有管理员角色或基本用户角色的团队成员。邀请过程一开始看起来没问题，一切都检查得很完美，邀请链接有32字节的字母数字令牌(没有办法强制使用)，csrf令牌检查正确，一切都很好，直到我发现第一个错误</p><h2 id="d6a8" class="ku kv iq bd kw kx ky dn kz la lb dp lc kf ld le lf kj lg lh li kn lj lk ll lm bi translated">IDOR在重新发送邀请时</h2><p id="395f" class="pw-post-body-paragraph ju jv iq jw b jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn lr kp kq kr ij bi translated">一个管理员有能力查看待定的邀请，他也可以重新发送邀请，似乎很好的职位请求如下</p><blockquote class="ls lt lu"><p id="2ed4" class="ju jv lv jw b jx jy jz ka kb kc kd ke lw kg kh ki lx kk kl km ly ko kp kq kr ij bi translated">POST/invitations/363484/resend HTTP/1.1【bugbounty.redacted.com】主持人:T4<br/>授权:无记名base64令牌</p></blockquote><blockquote class="lz"><p id="cb84" class="ma mb iq bd mc md me mf mg mh mi kr dk translated">JSON响应包含电子邮件{"status":"success "，" email":"email@example.com"}</p></blockquote><p id="9faa" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">问题是，如果你改变邀请id，你实际上可以看到其他注册在redacted.com的公司发出的邀请。创建多个邀请后，我注意到邀请id增加，这也证实了没有必要使用暴力简单地使用入侵者和增加/减少id来披露其他公司的邀请电子邮件。这本身并不重要，因为除了邮件，我们在回复中看不到任何重要信息。</p><h2 id="9f0c" class="ku kv iq bd kw kx ky dn kz la lb dp lc kf ld le lf kj lg lh li kn lj lk ll lm bi translated">用设计缺陷链接第一个bug</h2><p id="6104" class="pw-post-body-paragraph ju jv iq jw b jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn lr kp kq kr ij bi translated">现在真正有趣的事情开始了，我抓起回复中的邮件，然后在redacted.com上注册了一个账户。注册后，我被重定向到一个html页面，上面写着</p><blockquote class="lz"><p id="ed6c" class="ma mb iq bd mc md mo mp mq mr ms kr dk translated">X公司邀请您加入他们，请使用电子邮件中的链接。<br/>点击重新发送邀请，再次接收电子邮件</p></blockquote><p id="265a" class="pw-post-body-paragraph ju jv iq jw b jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr ij bi translated">复制了页面上的重新发送邀请链接，看起来像这样</p><blockquote class="ls lt lu"><p id="0dd3" class="ju jv lv jw b jx jy jz ka kb kc kd ke lw kg kh ki lx kk kl km ly ko kp kq kr ij bi translated">https://www.redacted.com/resend_invitation/TOKEN</p></blockquote><p id="4f4c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我去查看了我的邮件，它有相同的链接，除了他们用了<em class="lv">加入</em>而不是<em class="lv">重新发送邀请</em>，所以链接是这样的</p><blockquote class="ls lt lu"><p id="f6f9" class="ju jv lv jw b jx jy jz ka kb kc kd ke lw kg kh ki lx kk kl km ly ko kp kq kr ij bi translated">https://www.redacted.com/join/TOKEN</p></blockquote><p id="7890" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以我回到标签页，把resend_invitation换成了join和boom！我被录取了。攻击者只需利用第一个IDOR，注册json响应中反映的每封电子邮件，就可以利用该漏洞接管任意帐户。</p><p id="c570" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是一份重复的报告，但很酷。<br/> <em class="lv">给原记者如果你正在读这篇文章那么干得好；)</em></p><p id="39a7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><br/>下次见，祝大家狩猎愉快，</p><p id="fd5f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ks kt ep" href="https://medium.com/u/d5bc3c7f04c0?source=post_page-----236835685075--------------------------------" rel="noopener" target="_blank">增压室</a></p></div></div>    
</body>
</html>