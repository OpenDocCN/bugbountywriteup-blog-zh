<html>
<head>
<title>The Basics of Subdomain Takeovers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">子域接管的基础</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/the-basics-of-subdomain-takeovers-a0bbd4c84a4?source=collection_archive---------0-----------------------#2022-05-09">https://infosecwriteups.com/the-basics-of-subdomain-takeovers-a0bbd4c84a4?source=collection_archive---------0-----------------------#2022-05-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/7f5e44964b49cc5e899429ac2cd27209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*potLBQYjkgpwF0qgwJZMrA.png"/></div></div></figure><p id="ce1c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">子域接管是一个漏洞，它允许攻击者提供不属于该攻击者的子域的内容。使子域接管成为可能的最常见情况是:</p><p id="afe7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1)受影响子域的CNAME记录指向可能被攻击者声称的域</p><p id="2132" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2)A记录指向一个可以被攻击者注册的IP地址</p><p id="056c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">特别是第一种情况很常见，尤其是当您的子域指向云提供商(如Amazon AWS)的主机名时。所以让我们假设你在亚马逊的S3网站桶上运行一个博客，你已经给这个桶分配了主机名<em class="kz">myblog.amazonaws.com</em>。由于您希望这个博客在您自己的域名下是可访问的，所以您创建了blog.example.com的域名<em class="kz">和一个从该域名指向myblog.amazonaws.com的<em class="kz">的指针(通过CNAME记录)。现在，如果有人在浏览器中打开你的域名<em class="kz">blog.example.com</em>，浏览器知道它应该加载来自<em class="kz">myblog.amazonaws.com</em>的内容。</em></em></p><p id="50ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">稍后，您可能会决定关闭博客，并删除S3桶及其主机名<em class="kz">myblog.amazonaws.com</em>。因此，Amazon域再次变得可用，其他人可以注册该域，并为此主机名创建一个新的S3存储桶。现在，一个问题可能会出现。如果你忘记删除从<em class="kz">blog.example.com</em>到<em class="kz">myblog.amazonaws.com的指针(即CNAME记录)，那么</em>新的S3桶(现在已经不属于你了)的内容将会发送给访问你的域名<em class="kz">blog.example.com</em>的每个人。</p><p id="9691" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">攻击者可以利用这一点，通过您的子域发送他/她的S3桶中的恶意内容。</p><h1 id="b66c" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">子域接管的风险</h1><p id="f261" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">各种风险可能是子域接管的结果。</p><p id="08fe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">绕过CSRF保护</strong></p><p id="55a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">可能你已经决定信任你所有的子域，因此你只依靠同一个站点的cookies作为CSRF保护。由于SameSite仅保护您的web应用程序免受跨站点请求的CSRF攻击，攻击者可能会使用子域接管来通过同一站点的受损子域绕过CSRF保护。</p><p id="d6ea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您设置了cookie，并且您将域属性设置为您的主域，例如<em class="kz">example.com</em>，则访问和修改cookie所有子域也会收到此cookie。因此，攻击者可以使用受威胁的子域来访问所有这些cookies。此外，当受害者通过指定域属性访问受损域时，攻击者可以在受害者浏览器中为其他子域设置cookies。</p><p id="ab9f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">网络钓鱼</strong></p><p id="39a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于受危害的子域提供的内容来自受信任的(子)域，攻击者可以发起网络钓鱼攻击，窃取使用您的站点的受害者的凭据。</p><p id="de9a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">OAuth 2.0令牌泄露</strong></p><p id="8ba9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">OAuth 2.0是一种协议，它允许用户授权第三方应用程序访问用户的受保护资源，而无需向该应用程序提供用户的凭证。相反，用户在受信任的站点进行身份验证，然后用户被重定向到应用程序。重定向包含一个可用于访问资源的令牌(实际上，令牌被转换为访问令牌，但这与此无关)。</p><p id="19d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">仅当目标URL可信时，才会执行重定向。如果所有子域都被信任为目标URL，则攻击者可能能够通过指向受损子域的目标URL获得OAuth 2.0令牌。</p><p id="1b56" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">绕过内容安全策略</strong></p><p id="8b5b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">内容安全策略是一个HTTP响应头，您可以在其中指定允许加载JavaScript等内容的位置。这有助于减轻跨站点脚本(XSS)攻击。</p><p id="4631" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您已经将所有子域列入白名单，那么只需一个受损子域就足以绕过内容安全策略提供的保护。</p><h1 id="45e5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">一、AAAA和CNAME的记录</h1><p id="84da" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">正如已经提到的原因，它可能会来到一个子域接管漏洞是最常见的错误配置CNAME或A记录。随着IPv6的日益普及，AAAA记录也可能是一个原因。我们来看看为什么会这样。</p><p id="8fa6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当您注册一个域时，您可以在域名系统(DNS)中以记录的形式存储该域及其子域的各种信息。例如，一个域的IPv4地址存储在A记录中。浏览器使用这些记录将人类可读的主机名解析为机器可用的IPv4地址。与A记录非常相似，AAAA记录(也称为“quad-A”)存储IPv6地址。之所以使用AAAA这个名称，是因为IPv6地址占用16个字节(128位)，是IPv4地址的四倍，而IP v4地址只占用4个字节(32位)。</p><p id="ed38" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一种用于搜索子域接管漏洞的DNS记录类型是CNAME记录(“规范名称记录”)。该记录用于将一个域名映射到另一个域名。映射到第二个域名的域名通常被称为第二个域的“别名”，因为它是一个域的附加名称。</p><p id="cc83" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个域的记录可能如下例所示:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e519" class="mm lb it mi b gy mn mo l mp mq">NAME               TYPE<br/>-------------------------------------------<br/>bar.example.com    CNAME    foo.example.com<br/>foo.example.com    A        192.126.0.10</span></pre><p id="88d1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你在浏览器中输入bar.example.com<em class="kz">的地址</em>，浏览器首先试图获取这个地址的A记录。由于该地址只有一条指向<em class="kz">foo.example.com</em>的CNAME记录，浏览器将查找该域名的A记录。现在，这个域名有一个A记录，浏览器打开IP地址192.168.0.10。</p><p id="029a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">也有可能给两个主机名相同的A记录。然而，使用foo.example.com的CNAME记录的好处是，如果IP地址改变，你必须更新它。</p><p id="13ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">存在各种其他的DNS记录类型，你可以在维基百科上找到一个列表。然而，搜索子域接管漏洞的CNAME和一个域的记录是最有趣的一个。</p><h1 id="2418" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">用dig在Linux命令行上获取A和CNAME记录</h1><p id="40eb" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">当你使用Linux时，很容易得到一个域的A和CNAME记录，这是大多数Linux发行版默认安装的工具。您可以使用的一个流行的DNS查找工具是“dig”。</p><p id="51f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要查找www.cnn.com<a class="ae mr" href="http://www.cnn.com" rel="noopener ugc nofollow" target="_blank">域名</a>的DNS记录，您可以如下执行dig:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="77d4" class="mm lb it mi b gy mn mo l mp mq">dig <a class="ae mr" href="http://www.cnn.com" rel="noopener ugc nofollow" target="_blank">www.cnn.com</a></span></pre><p id="e05c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输出可能如下所示:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="cec2" class="mm lb it mi b gy mn mo l mp mq">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; www.cnn.com<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40442<br/>;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1</span><span id="e9dd" class="mm lb it mi b gy ms mo l mp mq">;; OPT PSEUDOSECTION:<br/>; EDNS: version: 0, flags:; udp: 65494<br/>;; QUESTION SECTION:<br/>;www.cnn.com.                   IN  A</span><span id="ac58" class="mm lb it mi b gy ms mo l mp mq">;; ANSWER SECTION:<br/>www.cnn.com.              23    IN  CNAME  turner-tls.map.fastly.net.<br/>turner-tls.map.fastly.net. 11	IN	A      151.101.13.67</span></pre><p id="4da1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有趣的内容位于以行开头的答案部分”；；回答部分:“。在本例中，查询的答案是:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7860" class="mm lb it mi b gy mn mo l mp mq">www.cnn.com.              23    IN  CNAME  turner-tls.map.fastly.net.<br/>turner-tls.map.fastly.net. 11	IN	A      151.101.13.67</span></pre><p id="990e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以看到www.cnn.com的<a class="ae mr" href="https://www.cnn.com/" rel="noopener ugc nofollow" target="_blank">只是turner-tls.map.fastly.net域名的别名，因为它只有一个指向这个域名的CNAME记录。在第二行中，我们可以看到A记录，它包含该域的IPv4地址。</a></p><p id="31ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">警告！</strong>dig的输出可能取决于您使用的名称服务器，因为名称服务器的行为可能会有所不同。例如，有时当被查询的域名只有CNAME记录时，答案部分可能是空的。在这种情况下，您应该尝试明确地查询CNAME记录。</p><h1 id="c6ee" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用摘要时指定记录类型</h1><p id="6d2d" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">要指定记录类型，您只需要添加记录类型的名称作为附加参数。例如，要仅查询CNAME记录，只需添加“cname”作为附加参数:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ada7" class="mm lb it mi b gy mn mo l mp mq">dig www.cnn.com cname</span></pre><p id="558e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，输出中的答案部分可能如下所示:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="83d0" class="mm lb it mi b gy mn mo l mp mq">;; ANSWER SECTION:<br/>www.cnn.com.    5    IN   CNAME    turner-tls.map.fastly.net.</span></pre><p id="a15c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个答案中，只显示了CNAME的记录。</p><p id="c07c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">除了“cname ”,您还可以使用“a”表示a记录，“aaaa”表示aaaa记录，“mx”表示mx记录，依此类推。如果您的名称服务器支持“任何”，将返回一个域的所有DNS记录。</p><h1 id="1133" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用dig时指定名称服务器</h1><p id="74cd" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果您的名称服务器不支持“any”，您可以尝试使用另一个名称服务器。例如，您可以指定Google域名服务器8.8.8.8的地址，方法是将该地址作为一个附加参数添加进来，并在地址前面加上一个@符号。这里有一个例子:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="fdf4" class="mm lb it mi b gy mn mo l mp mq">dig @8.8.8.8 www.cnn.com any</span></pre><p id="1d82" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">例如，当在我的ISP的名称服务器上查询域名<a class="ae mr" href="http://gmx.net/" rel="noopener ugc nofollow" target="_blank">gmx.net</a>的“any”时，我得到以下答案:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="bf12" class="mm lb it mi b gy mn mo l mp mq">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; gmx.net any<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 44888<br/>;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1</span><span id="99c9" class="mm lb it mi b gy ms mo l mp mq">;; OPT PSEUDOSECTION:<br/>; EDNS: version: 0, flags:; udp: 65494<br/>;; QUESTION SECTION:<br/>;gmx.net.			IN	ANY</span></pre><p id="db4d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如您所见，该回复不包含回答部分。相反，响应的状态是“SERVFAIL”(第四行)。但是，如果我使用名称服务器8.8.8.8，我会得到以下(简短的)响应:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="123a" class="mm lb it mi b gy mn mo l mp mq">dig @8.8.8.8 gmx.net any</span><span id="8b75" class="mm lb it mi b gy ms mo l mp mq">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; @8.8.8.8 gmx.net any<br/>; (1 server found)<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 61609<br/>;; flags: qr rd ra ad; QUERY: 1, ANSWER: 27, AUTHORITY: 0, ADDITIONAL: 1</span><span id="0cc1" class="mm lb it mi b gy ms mo l mp mq">;; OPT PSEUDOSECTION:<br/>; EDNS: version: 0, flags:; udp: 512<br/>;; QUESTION SECTION:<br/>;gmx.net.               IN  ANY</span><span id="5ed3" class="mm lb it mi b gy ms mo l mp mq">;; ANSWER SECTION:<br/>gmx.net.		21478	IN	A	82.165.229.87<br/>gmx.net.		21478	IN	RRSIG	A 8 2 86400 20220511065307 [...]<br/>gmx.net.		21478	IN	NS	ns-gmx.ui-dns.de.<br/>gmx.net.		21478	IN	NS	ns-gmx.ui-dns.biz.<br/>gmx.net.		21478	IN	NS	ns-gmx.ui-dns.com.<br/>gmx.net.		21478	IN	NS	ns-gmx.ui-dns.org.<br/>gmx.net.		21478	IN	RRSIG	NS 8 2 86400 20220511065307 [...]<br/>gmx.net.		21478	IN	SOA	ns-gmx.ui-dns.org. dnsadmin.1und1.de. [...]<br/>[...]</span></pre><p id="044e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意:即使状态为NOERROR，对于不同的域名服务器,“any”的响应也可能不同。这是我从我的ISP的域名服务器上得到的结果，如果我为google.com查询“任何”。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="040a" class="mm lb it mi b gy mn mo l mp mq">dig google.com any</span><span id="e073" class="mm lb it mi b gy ms mo l mp mq">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; google.com any<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 51127<br/>;; flags: qr rd ra; QUERY: 1, ANSWER: 8, AUTHORITY: 0, ADDITIONAL: 1<br/>[...]</span><span id="875f" class="mm lb it mi b gy ms mo l mp mq">;; ANSWER SECTION:<br/>google.com.		203	IN	A	142.250.185.206<br/>google.com.		113	IN	AAAA	2a00:1450:4001:82b::200e<br/>google.com.		136	IN	MX	10 smtp.google.com.<br/>google.com.		48	IN	SOA	ns1.google.com. dns-admin.google.com. [...]<br/>google.com.		63471	IN	NS	ns4.google.com.<br/>google.com.		63471	IN	NS	ns1.google.com.<br/>google.com.		63471	IN	NS	ns2.google.com.<br/>google.com.		63471	IN	NS	ns3.google.com.</span></pre><p id="f51d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是我使用名称服务器8.8.8.8得到的结果:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b58b" class="mm lb it mi b gy mn mo l mp mq">dig @8.8.8.8 google.com any</span><span id="6b2d" class="mm lb it mi b gy ms mo l mp mq">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; @8.8.8.8 google.com any<br/>; (1 server found)<br/>;; global options: +cmd<br/>;; Got answer:<br/>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 10356<br/>;; flags: qr rd ra; QUERY: 1, ANSWER: 18, AUTHORITY: 0, ADDITIONAL: 1</span><span id="6e50" class="mm lb it mi b gy ms mo l mp mq">;; OPT PSEUDOSECTION:<br/>; EDNS: version: 0, flags:; udp: 512<br/>;; QUESTION SECTION:<br/>;google.com.			IN	ANY</span><span id="1926" class="mm lb it mi b gy ms mo l mp mq">;; ANSWER SECTION:<br/>google.com.		265   IN	A	142.250.185.206<br/>google.com.		265   IN	AAAA	2a00:1450:4001:812::200e<br/>google.com.		3565  IN	TXT	"docusign=1b0a6754-49b1-4db5-8540-d2c12664b289"<br/>google.com.		3565  IN	TXT	"google-site-verification=TV9-DBe4R80X4v0M4U_bd_J9cpOJM0nikft0jAgjmsQ"<br/>google.com.		25    IN	SOA	ns1.google.com. dns-admin.google.com. 444806637 900 900 1800 60<br/>google.com.		3565  IN	TXT	"v=spf1 include:_spf.google.com ~all"<br/>google.com.		3565  IN	TXT	"docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e"<br/>google.com.		3565  IN	TXT	"MS=E4A68B9AB2BB9670BCE15412F62916164C0B20BB"<br/>google.com.		265   IN	MX	10 smtp.google.com.<br/>google.com.		21565 IN	NS	ns1.google.com.<br/>google.com.		3565  IN	TXT	"apple-domain-verification=30afIBcvSuDV2PLX"<br/>google.com.		21565 IN	NS	ns3.google.com.<br/>google.com.		3565  IN	TXT	"google-site-verification=wD8N7i1JTNTkezJ49swvWW48f8_9xveREV4oB-0Hf5o"<br/>google.com.		21565 IN	NS	ns4.google.com.<br/>google.com.		21565 IN	CAA	0 issue "pki.goog"<br/>google.com.		3565  IN	TXT	"facebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95"<br/>google.com.		21565 IN	NS	ns2.google.com.<br/>google.com.		3565  IN	TXT	"globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8=</span></pre><p id="4b1f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是，如果我显式地查询txt记录，我会从两个名称服务器得到相同的结果:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="28b2" class="mm lb it mi b gy mn mo l mp mq">;; ANSWER SECTION:<br/>google.com.		3600	IN	TXT	"globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8="<br/>google.com.		3600	IN	TXT	"google-site-verification=TV9-DBe4R80X4v0M4U_bd_J9cpOJM0nikft0jAgjmsQ"<br/>google.com.		3600	IN	TXT	"apple-domain-verification=30afIBcvSuDV2PLX"<br/>google.com.		3600	IN	TXT	"docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e"<br/>google.com.		3600	IN	TXT	"v=spf1 include:_spf.google.com ~all"<br/>google.com.		3600	IN	TXT	"google-site-verification=wD8N7i1JTNTkezJ49swvWW48f8_9xveREV4oB-0Hf5o"<br/>google.com.		3600	IN	TXT	"MS=E4A68B9AB2BB9670BCE15412F62916164C0B20BB"<br/>google.com.		3600	IN	TXT	"docusign=1b0a6754-49b1-4db5-8540-d2c12664b289"<br/>google.com.		3600	IN	TXT	"facebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95"</span></pre><p id="3a96" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，如您所见，任何查询都可能有问题，建议您明确查询您感兴趣的每条记录。另见<a class="ae mr" href="https://serverfault.com/a/294370" rel="noopener ugc nofollow" target="_blank">此处</a>和<a class="ae mr" href="https://blog.cloudflare.com/rfc8482-saying-goodbye-to-any/" rel="noopener ugc nofollow" target="_blank">此处</a>了解为什么任何查询都有问题的更多细节。</p><h1 id="a030" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">NXDOMAIN</h1><p id="3175" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果您在回答中得到NXDOMAIN状态，则无法使用DNS解析该域。NX代表“不存在”。实际上，名称“不存在”可能有点误导，因为即使该域名存在，您也可能会获得此状态，例如，当该域名存在，但只有一个指向无法解析的域名的CNAME记录时。</p><p id="92b4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从用户的角度来看，该域不存在或存在但只有一个指向无法解析的域的CNAME记录并没有什么区别。如果您在浏览器中输入这样的域，在两种情况下都会得到相同的结果。</p><p id="bb8c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，后者可能导致子域接管。因此，如果您在对DNS查询的响应中获得NXDOMAIN as状态，您应该验证该域没有受到可能的子域接管的影响。</p><h1 id="fcfd" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用dig检查可能的子域接管漏洞</h1><p id="8128" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">有了所有这些信息，您应该能够验证一个域没有受到可能的子域接管的影响。这些步骤是:</p><ol class=""><li id="9ea2" class="mt mu it kd b ke kf ki kj km mv kq mw ku mx ky my mz na nb bi translated">使用“挖掘A”来检查该域的A记录。如果存在未分配的IP，则该域可能容易被子域接管，因为攻击者可能能够注册该地址。</li><li id="1a94" class="mt mu it kd b ke nc ki nd km ne kq nf ku ng ky my mz na nb bi translated">使用“dig cname”来检查该域的cname记录。如果CNAME记录指向一个无法解析的域，攻击者就可能获得该域的所有权。例如，如果别名指向一个可以注册的域名，或者指向一个在亚马逊AWS上不存在的S3网站。然后，攻击者还可以创建一个S3存储桶，并重用该名称。</li></ol></div></div>    
</body>
</html>