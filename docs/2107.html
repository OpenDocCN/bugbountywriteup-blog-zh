<html>
<head>
<title>Capture the Ether — Challenge Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">捕捉以太——挑战记录</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/capture-the-ether-challenge-writeup-b10853807690?source=collection_archive---------1-----------------------#2022-05-30">https://infosecwriteups.com/capture-the-ether-challenge-writeup-b10853807690?source=collection_archive---------1-----------------------#2022-05-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/d6634a44045551b637a0894efce412ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*Q3IFpaR0r5HIzEGUJ8H07A.png"/></div></figure><p id="2150" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我开始专注于智能合同安全，这真的很有趣。</p><p id="ab2c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae kv" href="https://capturetheether.com/" rel="noopener ugc nofollow" target="_blank">capturethether</a>是以太坊智能合约安全的游戏。它有有趣的挑战。我解决了一些问题并做了记录。当我解决更多的挑战时，我会更新这篇文章。</p><p id="b4cd" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我从热身挑战开始，这些挑战简单明了。我将解释彩票部分的挑战。</p><ol class=""><li id="330e" class="kw kx it jz b ka kb ke kf ki ky km kz kq la ku lb lc ld le bi translated">猜猜这个数字:</li></ol><p id="10ef" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">他们给了我们一份智能合同和合同地址。我们必须猜这个数字。</p><p id="3cec" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">通过智能合同，我知道数字是42，我们必须猜测通过挑战。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="cc62" class="lo lp it lk b gy lq lr l ls lt">pragma solidity ^0.4.21;<br/><br/>contract GuessTheNumberChallenge {<br/>    uint8 answer = 42;<br/><br/>    function GuessTheNumberChallenge() public payable {<br/>        require(msg.value == 1 ether);<br/>    }<br/><br/>    function isComplete() public view returns (bool) {<br/>        return address(this).balance == 0;<br/>    }<br/><br/>    function guess(uint8 n) public payable {<br/>        require(msg.value == 1 ether);<br/><br/>        if (n == answer) {<br/>            msg.sender.transfer(2 ether);<br/>        }<br/>    }<br/>}</span></pre><p id="5938" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Guess函数将一个数字作为输入，它需要1个以太网来进行交易。</p><p id="c0bc" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为了与合同进行交互，我们可以使用Remix IDE。将智能合约复制到混音中，然后编译它。</p><p id="567b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">转到deploy部分，选择注入Web3的环境，这样它将与我们的Metamask帐户连接(留在Ropsten测试网络中)。你可以从Ropsten水龙头里拿到测试乙醚。</p><p id="f4bf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">由于此合同已经部署，我们有合同地址，我们可以通过将地址添加到Remix的“At Address”部分来与之交互。然后契约被设置为交互。现在我们来看看合同的功能。我们将调用guess函数，将数字42作为输入。此外，在“值”部分提到1个以太调用函数，这是一个要求。最后调用函数guess。</p><p id="8c33" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">您将从Metamask获得一个接受交易的弹出窗口，一旦交易完成，单击isComplete函数检查智能合约的余额是否为0。如果是真的，你做到了。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lu"><img src="../Images/98e85ce2c6ce2e3acbebf7d185e8867c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1aZV6RXsv7J5obfDW9Gjlg.png"/></div></div></figure><p id="e5d9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">进入挑战页面，点击“检查解决方案”。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lu"><img src="../Images/828cb76b8ab8d357d3e00cff9b5d3e2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lK2SVr-xJcGP5RS7Kr9_kg.png"/></div></div></figure><p id="3235" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">很好完成了第一次挑战。</p><p id="8b40" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">2.猜测秘密号码:</p><p id="a060" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这一次他们已经散列了我们必须猜测的数字。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="73f0" class="lo lp it lk b gy lq lr l ls lt">pragma solidity ^0.4.21;<br/><br/>contract GuessTheSecretNumberChallenge {<br/>    bytes32 answerHash = 0xdb81b4d58595fbbbb592d3661a34cdca14d7ab379441400cbfa1b78bc447c365;<br/><br/>    function GuessTheSecretNumberChallenge() public payable {<br/>        require(msg.value == 1 ether);<br/>    }<br/>    <br/>    function isComplete() public view returns (bool) {<br/>        return address(this).balance == 0;<br/>    }<br/><br/>    function guess(uint8 n) public payable {<br/>        require(msg.value == 1 ether);<br/><br/>        if (keccak256(n) == answerHash) {<br/>            msg.sender.transfer(2 ether);<br/>        }<br/>    }<br/>}</span></pre><p id="3b4b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">哈希值在智能协定中给出</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="5f45" class="lo lp it lk b gy lq lr l ls lt">0xdb81b4d58595fbbbb592d3661a34cdca14d7ab379441400cbfa1b78bc447c365</span></pre><p id="b59c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们能做的一件事就是用蛮力找到有这个散列的数字。正如我们所知，散列是不可逆的任务，我们必须强力多个输入匹配散列。</p><p id="75af" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">使用的散列技术是keccak256。我写了一个python代码来查找包含这个散列的数字。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lz"><img src="../Images/d8c0097961f49c37da1324eae4cfa003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WjWI17Pf6jAEaH3fLbnNBw.png"/></div></div></figure><p id="a6a1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们基本上使用了web3py python包中的keccak函数。然后我们检查与1到1000范围内的数字相匹配的散列。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ma"><img src="../Images/e2b52e92bca912557eacf3f2b57729e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHD-Y5na7ZyZp6ZzDFZcdw.png"/></div></div></figure><p id="a66d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">数字是170，它具有给定的散列。</p><p id="52b4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在我们可以像第一次挑战一样。部署契约，用170号调用函数guess。最终完成挑战。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mb"><img src="../Images/861c12366db61810852bb6ae39b2acc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BDBhDEzk5dsa2l5JbNXrkg.png"/></div></div></figure><p id="5a3c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">isComplete函数返回“true”。因此，答案是正确的，挑战完成。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lu"><img src="../Images/9fdd9b20026cc16f3c7eda2b29d5d283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*poF-JHcQJFkbxGbI9zEXnQ.png"/></div></div></figure><p id="e677" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">第二个挑战完成了。</p><p id="af8d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">3.猜测随机数:</p><p id="ea00" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在部署时通过块号生成一个随机数。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="bf1e" class="lo lp it lk b gy lq lr l ls lt">pragma solidity ^0.4.21;<br/><br/>contract GuessTheRandomNumberChallenge {<br/>    uint8 answer;<br/><br/>    function GuessTheRandomNumberChallenge() public payable {<br/>        require(msg.value == 1 ether);<br/>        answer = uint8(keccak256(block.blockhash(block.number - 1), now));<br/>    }<br/><br/>    function isComplete() public view returns (bool) {<br/>        return address(this).balance == 0;<br/>    }<br/><br/>    function guess(uint8 n) public payable {<br/>        require(msg.value == 1 ether);<br/><br/>        if (n == answer) {<br/>            msg.sender.transfer(2 ether);<br/>        }<br/>    }<br/>}</span></pre><p id="26ab" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这个数字是我们的答案，它是在通过协定的构造函数部署协定时创建的。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="16ee" class="lo lp it lk b gy lq lr l ls lt">block.number-1</span></pre><p id="252d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">上面一行指定了父块，我们正在获取父事务散列。</p><p id="ee54" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">所以我们知道我们可以在Etherscan中看到构造函数的值。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mc"><img src="../Images/0ae883b28c08fc72b0663321d3f6f396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hg9vf3OOxPSCjuSoEBJXug.png"/></div></div></figure><p id="cb64" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">转到内部事务并单击父事务哈希。然后在状态。这将包含存储的变量。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi md"><img src="../Images/3dcd973e101fff4ec91c53237f3f5928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uKfTH1cOofCFVaJXUSBXOg.png"/></div></div></figure><p id="63d9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在我的例子中，4是生成的随机数。粘贴这个数字并运行猜测功能。</p><p id="67d3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">挑战结束了。由于安全问题，这通常不是生成随机数的方式。</p></div></div>    
</body>
</html>