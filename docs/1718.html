<html>
<head>
<title>My [CVE-2021–45043] LFI Write-up</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的[CVE-2021–45043]LFI报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/my-cve-2021-45043-lfi-write-up-441dad30dd7f?source=collection_archive---------3-----------------------#2021-12-14">https://infosecwriteups.com/my-cve-2021-45043-lfi-write-up-441dad30dd7f?source=collection_archive---------3-----------------------#2021-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5882b436d42926f68cef49bb792daf63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rIq-gKlAT0_XWCF8ZF2FEg.png"/></div></div></figure><p id="142c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嘿，黑客和猎人们，</p><p id="d6d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天将是一篇不同的关于我的新[CVE-2021–45043]的文章，它是在(高清网络实时监控系统2.0)中发现的。这个CVE签名的本地文件包含漏洞，它允许我通过错误配置读取服务器中的敏感内部文件，稍后将在这篇文章中解释。</p><p id="a144" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我选择了一个产品，以便开始我的安全研究之旅，所以我决定从(高清网络实时监控系统2.0)产品开始，然后我想搜索/收集一些使用该系统的主机，所以我开始在一些目标上做一些指纹，我发现两个指纹应该可以让我过滤我的结果，以便只给我只使用该系统的主机。</p><ol class=""><li id="5c39" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">与本产品配合使用的所有产品的名称是:</li></ol><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/2b681a483750ba5b529f8bc49bc8f719.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*ZNuW3fazZ7kA5LxJlBcoUA.png"/></div></figure><p id="13e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.此外，当您浏览应用程序时，您会看到您查看了应用程序源代码，您会发现一个JavaScript文件名:<code class="fe lk ll lm ln b">setCookie.js</code>因此，在查看该脚本后，我看到有一段代码引起了我的注意，它是:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/ad201ae3acccfcc3ba654a764c8cb7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*yQyVe8ugXZZ60Gp5SigRuA.png"/></div></figure><p id="7541" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如你所看到的，这是一个注释代码，但它让我理解了这个web应用程序的逻辑，现在你可以看到开发人员使用了一个函数来获取包含首选用户语言的cookie <code class="fe lk ll lm ln b">s_language</code>值，然后最终基于这个cookie值生成内容语言，所以我尝试继续搜索另一个可能对我有用的JavaScript文件，例如我在一个名为<code class="fe lk ll lm ln b">common.js </code>的文件中发现了以下代码:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/adfcbb84aed5ce1c18c168db617340f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*EvOqcNLbMi5y9NdMcQp-Fw.png"/></div></div></figure><p id="39d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我想更深入地了解一下，我想知道服务器与哪个端点进行交互以获得用户的语言偏好，所以我打开了burp-suite spider并在web应用程序中开始爬行，直到我获得一个有吸引力的端点:<code class="fe lk ll lm ln b">/language/lang</code>，一旦打开它，您会发现以下内容:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/ddd3444c585a69cb71764201e595508d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hq1JNI2fd0k4U8yBSvPiAw.png"/></div></div></figure><p id="c030" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，它定义了应用程序翻译过程和其他应用程序功能中使用的所有变量，所以我认为应用程序已经设置了一个名为<code class="fe lk ll lm ln b">s_Language</code>的cookie参数，JavaScript处理该参数值，以便为用户提供具有首选语言的应用程序，现在端点<code class="fe lk ll lm ln b">/language/lang</code>似乎是真正定义翻译过程将如何在应用程序中进行的端点。 所以我想为什么不手动添加cookie: <code class="fe lk ll lm ln b">s_Language</code>然后尝试一些路径遍历，看看应用程序是否从前端脚本导入语言？ ，所以我这样做了，抓住你了！：</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/ea6f1502e051b198e7f1581e81ce91d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rlXmvx02LHTX_MXl9wwVA.png"/></div></div></figure><p id="ca9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所见，这个服务器中唯一存在的用户是<code class="fe lk ll lm ln b">root</code>用户，所以我想到为什么不看看影子是否可访问？让黑客妈妈吃惊的是:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/13e05058e3d0acc70501b2062a58ca92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGFqAre0aMOHbC_HpHtpTQ.png"/></div></div></figure><p id="979b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，我能够访问影子文件，因为<code class="fe lk ll lm ln b">root</code>是此服务器中的唯一用户，因此没有<code class="fe lk ll lm ln b">www-data</code>或任何其他服务器用户可以在此管理此web应用服务器。发生这种错误配置是因为产品为翻译/语言函数提供了对该函数输入的不安全处理，因为如果代码是这样的:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/1120e538bdda64db979defa95547b4db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*wu_Kkd16SbxCVewP2tjhTA.png"/></div></figure><p id="8a1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着服务器将包括cookie参数<code class="fe lk ll lm ln b">s_Language</code>中存在的任何文件，而不是从后端放入特定文件，以避免对该文件的操作，这非常简单，但你应该知道在哪里搜索。</p><blockquote class="lu lv lw"><p id="11c3" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">总是聪明地工作而不是努力地工作</p></blockquote><p id="4beb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后是alhamdulilah:</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/2551ef88efe0ea7cddb1103cbdb06dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fdt2CosjADo0RoVp"/></div></div></figure></div></div>    
</body>
</html>