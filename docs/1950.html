<html>
<head>
<title>Securing your Linux Servers Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保护您的Linux服务器第3部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/securing-your-linux-servers-part-3-23a711a701a7?source=collection_archive---------0-----------------------#2022-03-17">https://infosecwriteups.com/securing-your-linux-servers-part-3-23a711a701a7?source=collection_archive---------0-----------------------#2022-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/882d3cc78e0031a6245dccec057086c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z30flUXrV_-sM_lj"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kc" href="https://unsplash.com/@anagani_saikiran?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Sai Kiran Anagani </a>拍摄的照片</figcaption></figure><p id="63d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">简介</strong></p><p id="c219" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在开发应用程序、部署容器技术或在企业中工作时，Linux是许多开发人员的默认首选。它快速、简洁，需要更少的资源，并在用户手中提供更多的能力。通常，我们忘记意识到它预装了默认设置，这可能违反了您公司的安全策略。</p><p id="4552" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，建议遵循最佳的安全策略，并使用最新的安全功能来更新您自己和您的服务器。</p><p id="cf69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是保护Linux服务器系列文章的第3部分。前面两个部分可以在<a class="ae kc" href="https://securitylit.medium.com/securing-your-linux-server-with-these-best-practices-50b30e026bd" rel="noopener">这里</a>和<a class="ae kc" href="https://medium.com/codex/securing-your-linux-server-part-ii-48e45c581931" rel="noopener">这里</a>找到。这是前两篇博文的一个小小的进步，涵盖了一些你应该遵循的更好的安全实践，即使你是一个独立的开发者或者一个公司的管理员。</p><p id="11df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">禁用用户账户</strong></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/118d25f5d87fbfcf86399c33214c7bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18hfONv-73KLd1nrBhJH5w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">禁用用户帐户</figcaption></figure><p id="d3b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不同的公司有不同的政策来处理用户帐户，如果一个员工暂时休假或永久解雇。这里最常见的方法之一是至少禁用该员工的用户帐户，直到当局发出进一步通知。</p><p id="1c22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这实现了两个目标。该系统将受到多种方式的保护。首先，在所有者不在的情况下，任何人都不得进入，以确保员工的个人信息不会被编辑或干预。它还降低了休眠用户帐户导致用户帐户受损的可能性。如果您想禁用某个用户帐户，可以使用usermod或password命令。它们都执行一些不同的功能，其中之一是用户帐户的停用。要停用Jack的帐户，请按照以下步骤操作:</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="0628" class="ll lm iq lh b gy ln lo l lp lq">usermod –L jack</span><span id="c8ba" class="ll lm iq lh b gy lr lo l lp lq"><strong class="lh ir">or</strong></span><span id="30c8" class="ll lm iq lh b gy lr lo l lp lq">passwd –l jack</span></pre><p id="af16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">/etc/passwd文件用于跟踪Linux系统中注册的用户帐户。这些命令将做的是添加一个<strong class="kf ir">！/etc/passwd文件第二个字段中的</strong>(感叹号)。</p><p id="da72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然你可能认为这已经解决了问题。但是如果用户创建一个SSH密钥来登录他的帐户，禁用用户帐户将不起作用。在这种情况下，您需要使用chage–E0命令来禁用用户帐户。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="1c46" class="ll lm iq lh b gy ln lo l lp lq">chage –E0 jack</span></pre><p id="b3d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您使用chage命令时，它将对/etc/shadow文件做一个小的修改。通常为空的第八个字段将被设置为零，表示该账户已被有效关闭。选择此选项后，chage命令不仅会跟踪密码更改的间隔天数，还会提供帐户到期日期的信息。第八个字段中的零表示帐户在1970年1月的第一天到期，但也只是锁定帐户。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/9bab9877531f83c7ffb69d821299a0cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XVaxpC0At9q5RLTkKzG_w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">/etc/shadow文件的jack条目</figcaption></figure><p id="7c41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">删除用户账户</strong></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/e54960214ec37ca358c0536ef3cd3bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5hj8GBZGHiTwBA-7OCjmwg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">删除用户帐户</figcaption></figure><p id="27b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦您知道不再需要某个用户帐户，您可以将其删除。这将确保用户在被解雇后不会出于任何个人动机或怨恨而进行任何恶意活动。要删除一个用户帐户，您可以使用<strong class="kf ir"> userdel </strong>命令。要删除jack的帐户:</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="8d01" class="ll lm iq lh b gy ln lo l lp lq">userdel jack</span></pre><p id="3799" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要删除/home和/mail目录中jack的文件，可以使用–<strong class="kf ir">r</strong>标志</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="9326" class="ll lm iq lh b gy ln lo l lp lq">userdel –r jack</span></pre><p id="9f05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也可能有一些进程以用户的名义运行。因此，也有必要阻止它们，以消除将来可能出现的任何不一致。你可以使用<strong class="kf ir"> killall </strong>命令来实现。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="5a5e" class="ll lm iq lh b gy ln lo l lp lq">sudo killall –u jack`</span></pre><p id="d4b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一种方法是强制删除用户帐户以及在其权限下运行的所有进程，即使用户仍然登录。您可以使用<strong class="kf ir">–f(force)</strong>标志来这样做。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="c838" class="ll lm iq lh b gy ln lo l lp lq">userdel –f jack</span></pre><p id="3d07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">创建受限外壳</strong></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/1c33e67f6f4dc00eec71f3c96c14dd8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lUEorFTgC37PpSIsOrvoOw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">受限外壳</figcaption></figure><p id="6cca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在开始创建受限外壳之前，让我们先看看什么是受限外壳。顾名思义，限制性外壳是具有强加于其上的限制的外壳。由于对用户施加的限制，大量命令对用户不可用。当需要拒绝访客或普通用户访问任何可能用来损害文件、系统或网络的命令时，使用这种方法特别有用。你通常会在大学图书馆、网吧和其他类似的地方找到它们。Bash是大多数基于Linux的操作系统的默认shell，包括Ubuntu。因此，您可以利用<strong class="kf ir"> rbash </strong>，这也被称为受限bash。</p><p id="cf4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有几种方法可以实现受限制的shells。</p><p id="4c69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">类型1:创建新用户账户时。</strong> <br/>为用户或员工创建新的用户账户时，过程相当简单。创建访问受限的新用户帐户</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="6529" class="ll lm iq lh b gy ln lo l lp lq">sudo useadd jack –s /bin/rbash</span></pre><p id="3a9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为用户jack设置密码</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="703b" class="ll lm iq lh b gy ln lo l lp lq">sudo passwd j4cKP$$word`</span></pre><p id="74b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要为用户jack创建两个目录，即/home/jack和/home/jack/bin。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="1996" class="ll lm iq lh b gy ln lo l lp lq">sudo mkdir –p /home/jack/bin`</span></pre><p id="16be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将$PATH变量更改为/home/jack/bin，以便jack只能运行/home/jack/bin目录中的命令。否则，设置受限制的shell就没有任何意义，因为它很容易被绕过。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="0a86" class="ll lm iq lh b gy ln lo l lp lq">export PATH=$HOME/bin</span></pre><p id="24d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您可以添加希望jack运行的二进制文件/命令。您可以手动移动/home/jack/bin目录中的二进制文件，或者创建指向您的计算机或连接的文件系统上的另一个文件或文件夹的<strong class="kf ir">符号链接或符号链接</strong>。一个<strong class="kf ir">符号链接</strong>是Linux和Unix中的一种符号链接。</p><p id="5f0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，为了使用户插孔的<strong class="kf ir"> ping </strong>命令有效:</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="b1b0" class="ll lm iq lh b gy ln lo l lp lq">sudo cp /bin/ping /home/jack/bin</span></pre><p id="5217" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用符号链接:</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="ecef" class="ll lm iq lh b gy ln lo l lp lq">sudo ln –s /bin/ls /home/jack/bin</span></pre><p id="548c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">类型II:当已经创建了一个用户帐户<br/> </strong>来对现有用户施加限制时，可以使用usermod命令。要为tom实现rbash:</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="c8a9" class="ll lm iq lh b gy ln lo l lp lq">sudo usermod –s /bin/rbash tom</span></pre><p id="59cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">禁用u盘</strong></p><p id="a862" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据计算机的重要程度，建议且有必要禁用主机上的USB端口和记忆棒。u盘可能是恶意软件、勒索软件等的来源，我们通常会不假思索地插入我们发现的任何设备。</p><p id="7c01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要禁用u盘，可以使用Linux机器中的blacklist.conf文件。这些命令应该只由拥有admin或sudo权限的人运行。这些步骤是:</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="2ad1" class="ll lm iq lh b gy ln lo l lp lq">nano /etc/modprobe.d/blacklist.conf`</span></pre><p id="163d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当blacklist.conf文件打开时，在末尾添加以下行。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="41e8" class="ll lm iq lh b gy ln lo l lp lq">blacklist usb_storage`</span></pre><p id="9162" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下一步是打开rc.local文件。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="4c05" class="ll lm iq lh b gy ln lo l lp lq">nano /etc/rc.local</span></pre><p id="6fed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一步是添加下面两行。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="508c" class="ll lm iq lh b gy ln lo l lp lq">modprobe -r usb_storage<br/>exit 0</span></pre><p id="e9f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">结论</strong></p><p id="6c65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然前两篇博客更多地关注用于独立开发、web托管和其他相关目标的Linux服务器，但是与前两篇博客不同，这篇博客文章更多地关注Linux系统的企业安全性。</p></div></div>    
</body>
</html>