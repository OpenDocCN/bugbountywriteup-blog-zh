<html>
<head>
<title>How to Setup MFA for Linux Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为Linux机器设置MFA</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-to-setup-mfa-for-linux-machine-8b6e3294a5e0?source=collection_archive---------0-----------------------#2022-02-19">https://infosecwriteups.com/how-to-setup-mfa-for-linux-machine-8b6e3294a5e0?source=collection_archive---------0-----------------------#2022-02-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="26a5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Linux机器上设置google认证器的指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/6c2dd2f2b711470c71ee75be7a0f2198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N3QjC7tjSYSyngC3"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@jdent?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰森·登特</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="07a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有时，当你登录到一个系统，你必须输入密码，个人识别码或密钥。这种方法只是提供了一个因素认证你知道什么，你有什么或你是什么。如今，仅用一个因素认证就能让你的系统变得不安全。最好的方法是使用多因素认证(MFA ),这与您在进行网上银行交易或使用密码和认证程序登录您的工作帐户时必须输入密码和令牌是一样的。</p><p id="8596" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">【Linux机器怎么样？ <br/>你的Linux机器用MFA吗？</p><p id="ced2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你的答案是<strong class="ky ir">否</strong>，并且你对如何在Linux机器上设置MFA感兴趣，这篇文章适合你。</p><p id="239b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我将介绍在Linux中使用MFA登录的三种方式的设置。宋承宪<br/> 2。控制台<br/> 3。须藤</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="1fdc" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">设置Google认证器PAM模块</h2><p id="e480" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">首先，在你的智能手机上安装谷歌认证器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/396fb42ff44ff5c1c92460fe0ef7cc4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*QT30tDf7WwUD1rIRZ1DOtg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">智能手机中的谷歌认证器</figcaption></figure><p id="1393" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次，将Google Authenticator PAM模块安装到您的Linux机器中。此时此刻，我使用的是virtualbox中的Ubuntu 18.02服务器来完成本教程。</p><p id="d621" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了方便起见，我建议您对您的机器使用ssh。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="cf89" class="lz ma iq mz b gy nd ne l nf ng">sudo apt install libpam-google-authenticator</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/c8ae94c1c54e592d6c557c09bcd0c51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*axkGN-c3k2hNWpKLf56s7w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">正在安装google验证器PAM模块</figcaption></figure><p id="95e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后运行下面的命令并回答问题。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="e1d8" class="lz ma iq mz b gy nd ne l nf ng">google-authenticator</span></pre><p id="63e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">二维码会出现在你的终端上，所以只要扫描二维码，在你的谷歌认证器(在你的智能手机上)中添加一个帐户。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/8e2408e2f4574057ffbb951609157b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJdToaUf8GOmuKOls2_XkQ.png"/></div></div></figure><p id="b680" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安全地保存您的紧急暂存代码，因为如果您丢失了您的google认证器，您可以使用此代码找回它。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="8bbf" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">使用MFA设置SSH登录</h2><p id="6513" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">使用以下脚本在文件<code class="fe nj nk nl mz b">/etc/pam.d/sshd</code> <strong class="ky ir"> </strong>的最后一行添加新行:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="ae79" class="lz ma iq mz b gy nd ne l nf ng">auth required pam_google_authenticator.so <strong class="mz ir">nullok</strong></span></pre><p id="fd84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想强制每个用户在这个系统上使用MFA，只需删除<strong class="ky ir"> nullok </strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/79da6327dbf44200e7696f362d33c10e.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*UMRy6yoz8EbMrpqitbe2DA.png"/></div></figure><p id="157a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，配置<code class="fe nj nk nl mz b">/etc/ssh/sshd_config</code>并确保该行具有<strong class="ky ir"> yes </strong>值。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="6288" class="lz ma iq mz b gy nd ne l nf ng">ChallengeResponseAuthentication yes</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/7970dd9ddb58ae3107b97d80aec25089.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*2Zcw7PlEV3ZlxNOxoz8bQg.png"/></div></figure><p id="7a0b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，重新启动sshd服务，</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="5b0c" class="lz ma iq mz b gy nd ne l nf ng">sudo service sshd restart</span></pre><p id="7339" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它的工作，然后你会提示输入密码和验证码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/0a63948fdcdedc65bbc91df7431b5e43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*FrFcsNybzkum5CE8DqzMEg.png"/></div></figure><h2 id="461f" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">使用MFA设置控制台登录</h2><p id="7047" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">在文件<code class="fe nj nk nl mz b">/etc/pam.d/common-session</code> <strong class="ky ir"> </strong>的最后一行添加新的一行，用下面这个脚本:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="07d9" class="lz ma iq mz b gy nd ne l nf ng">auth required pam_google_authenticator.so <strong class="mz ir">nullok</strong></span></pre><p id="6d7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">和我之前说的一样，如果你想强迫每个用户在这个系统上使用MFA，只需删除<strong class="ky ir"> nullok </strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/bef7aa8eb8478f07a14c8e3018129b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*4takVSIyKI_lzFxlwy_nog.png"/></div></figure><p id="2b13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后保存文件配置，并尝试从控制台注销，然后再次尝试登录。<br/>我在智能手机里提示输入谷歌认证器的密码和验证码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/6c74d8689f3964ab35dbae692bf167f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LkscW5wNnWz9NEXB_F7DkQ.png"/></div></div></figure><h2 id="e69d" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">用MFA设置Sudo</h2><p id="3c51" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">与之前相同，只是在不同的文件中，在文件<code class="fe nj nk nl mz b">/etc/pam.d/common-auth</code> <strong class="ky ir"> </strong>的最后一行添加新行，脚本如下:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="847e" class="lz ma iq mz b gy nd ne l nf ng">auth required pam_google_authenticator.so <strong class="mz ir">nullok</strong></span></pre><p id="683c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你尝试命令sudo时，会提示你输入密码和验证码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/9243e46dbe7dfcb2bc2817e26a133ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*avdVVCXYz_xt5H9a8Vts5Q.png"/></div></figure><h2 id="a55a" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">警告！！！</h2><p id="632d" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">你必须处理好你的<strong class="ky ir">。google_authenticator </strong>文件，因为这个文件包含你的主验证码，会绕过你的google authenticator。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/5a4290d5cccfe9e45415723c29e009ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*nDxpfDBqjTzBmVOXQRIgGg.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/f4d31701d458c1c5f7466588e86fdc5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*mSot16aFacUCZp974DY7cw.png"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="2ff9" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">结论</h2><p id="ed92" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">MFA for Linux是为了提高系统中的安全设置。<br/>防止攻击者仅凭您的密码进入您的系统。但是，如果您有大量的服务器，您必须考虑认证器和紧急暂存代码。</p><p id="f765" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p><p id="14d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nu">参考</em>:<br/><a class="ae kv" href="https://www.redhat.com/sysadmin/mfa-linux" rel="noopener ugc nofollow" target="_blank"><em class="nu">https://www.redhat.com/sysadmin/mfa-linux</em></a><em class="nu"><br/></em><a class="ae kv" href="https://www.youtube.com/watch?v=wrx2cm3qDNI" rel="noopener ugc nofollow" target="_blank"><em class="nu">https://www.youtube.com/watch?v=wrx2cm3qDNI</em></a></p><div class="nv nw gp gr nx ny"><a href="https://python.plainenglish.io/execute-command-to-many-servers-with-python-675ac4b9730c" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">使用Python对许多服务器执行命令</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">使用Python对多个服务器运行命令的指南。</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">python .平原英语. io</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om kp ny"/></div></div></a></div></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="99c2" class="on ma iq bd mb oo op oq me or os ot mh jw ou jx mk jz ov ka mn kc ow kd mq ox bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae kv" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="nv nw gp gr nx ny"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">iwcon.live</p></div></div><div class="oh l"><div class="oy l oj ok ol oh om kp ny"/></div></div></a></div></div></div>    
</body>
</html>