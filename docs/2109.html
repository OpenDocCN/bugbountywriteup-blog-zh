<html>
<head>
<title>SSO: A Secure way for authentication and authorization?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SSO:一种安全的认证和授权方式？</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/sso-a-secure-way-for-authentication-and-authorization-6a4fb8794dd6?source=collection_archive---------0-----------------------#2022-05-31">https://infosecwriteups.com/sso-a-secure-way-for-authentication-and-authorization-6a4fb8794dd6?source=collection_archive---------0-----------------------#2022-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f76c75bb2888dc5dfe0b801c6bbe3eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Mp4aBiuz1aTEoDeV"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@mr_williams_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">迈卡·威廉姆斯</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><h1 id="9b6b" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h1><p id="15c7" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在企业环境中，您可能需要不同的服务来完成工作。这些服务通常需要身份验证。必须为每个服务(为每个员工)创建一个帐户，这不仅给IT人员带来了负担，而且还促进了密码的重复使用。这将意味着，如果只有一个服务/帐户的密码落入攻击者手中，他就可以危及所有其他服务。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/3f559ee2be2f434985f863d87b784ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yVzw3D6iPlw4N6APN6YTXQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://auth0.com/blog/what-is-and-how-does-single-sign-on-work/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="f905" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">例如，你在XYZ公司工作。<em class="mm"> XYZ </em>经营多种产品和服务，例如他们可能有一个管理假期和工资的门户，另一个门户可能是网站的分期版本，因此需要您登录不同的帐户才能完成工作。例如，早上第一件事就是登录公司的CRM，然后是电子邮件客户端、共享文件夹(每次访问都需要登录)等。</p><p id="e1f1" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">正如你能猜到的，这给用户带来了很多不便。为什么每次你需要使用这些服务时都要登录呢？难道没有更简单的解决方法吗？原来是有的。它被称为单点登录。</p><h1 id="1d7b" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">单点登录</strong></h1><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mn"><img src="../Images/68a390ec33f8521e8dd8ea1ae21e1b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0hJZg4b9MpP7ys0VvNPNtA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://www.geeksforgeeks.org/introduction-of-single-sign-on-sso/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="eac1" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">单点登录是一种认证方法，使用户能够使用一个ID登录到多个相互连接但独立运行的软件系统中的任何一个</strong>。使用真正的单点登录，用户只需登录一次即可访问服务，无需再次输入身份验证因素。</p><p id="eec3" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">更简单地说，你不必每天早上都登录CRM、电子邮件客户端或任何其他服务。你所要做的就是向身份提供者认证。登录后，您将获得一个会话ID，这将允许您访问您应该有权访问的所有服务，也就是说，有一些不同的方法可以执行，例如对于一些网站，您只需输入电子邮件地址，它会验证来自身份提供商的一切并让您登录。</p><p id="3e06" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">正如您所猜测的，<em class="mm">会话ID还记录了允许用户访问的内容。因此，它也有助于授权。</em>因此，在许多文章中，您可能还会看到SSO被定义为一种身份验证/授权方案。</p><h1 id="8ab1" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">单点登录的工作原理</strong></h1><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/636c082058c9127e231dc77809fb62f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d72uqBf7j_ZmPDnvw5AxuQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://auth0.com/blog/what-is-and-how-does-single-sign-on-work/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="1523" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">SSO登录涉及三个实体。</p><ol class=""><li id="3af2" class="mo mp it lg b lh mh ll mi lp mq lt mr lx ms mb mt mu mv mw bi translated">用户/用户浏览器(客户端)</li><li id="3d90" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated">身份提供者</li><li id="9b8b" class="mo mp it lg b lh mx ll my lp mz lt na lx nb mb mt mu mv mw bi translated">互联网服务商</li></ol><p id="201a" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">启动登录过程的实体称为用户或用户浏览器。发生这种情况时，会向身份提供者发送请求。要完成身份验证过程，用户必须首先登录身份提供者。身份提供者可能是同一家公司(您工作的公司)，也可能是购买或订阅的另一家公司。像这样的组织有几个，比如OKTA等等。在大多数情况下，用户名和密码是必需的，后面是双因素身份验证代码。</p><p id="60c4" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">最终的实体是服务提供商。服务提供商是您希望访问的服务，以前(在没有SSO的情况下)需要您登录。它们可以是非常简单的网站，比如HackerOne(如果您启用了SSO，它只要求您发送电子邮件)。现在有很多网站支持SSO，你也可以通过几个简单的步骤进行配置。</p><p id="b513" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">你的脑海中会出现一个问题。任何身份提供者都可以为任何服务提供会话令牌吗？不可以。要实现这一点，身份提供者和服务提供者之间必须存在信任关系。这是由建立SSO的开发人员建立的。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/8162a6ebecd89ba052baea8a2c3bdbcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*GaQzJJogKI7kMfkYs6Y9Og.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://www.netspi.com/wp-content/uploads/2017/02/img_589a44780e8eb.png" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="b2b2" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">从解释和图片中可以明显看出，需要传递一些消息来建立身份验证。这些消息以一种叫做SAML的格式传递。它代表<strong class="lg iu">安全断言标记语言。它是一种XML标记语言，内容是base64编码的。</strong></p><h1 id="e568" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak"> SAML组件</strong></h1><p id="2679" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">SAML是通过XML实现的，有几个组件。为了理解SAML，我们首先需要理解它的组件。SAML有三个主要组成部分。它们是SAML断言、SAML协议和SAML绑定。我们关心的最重要的组件是SAML断言。</p><p id="6158" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu"> SAML断言</strong>:简单地说，这是一个从身份提供者发送到服务提供者的XML文档。<em class="mm">本文件包含有关用户授权和认证的信息</em>。这意味着用户可以访问哪些服务和功能。</p><p id="55d8" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">当通信/消息通过用户的浏览器时，它们很容易被篡改，从而导致开发团队没有察觉或考虑到的意外副作用。</p><h1 id="ce06" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">单点登录中的安全问题</strong></h1><p id="9176" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">SSO是许多不同组织正在使用的同类最佳服务，但是它确实存在一些安全问题。下面是在SSO登录系统中发现的一些安全问题。</p><p id="e28e" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">错误授权</strong></p><p id="8147" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">主要的问题是关于授权。如果已经向用户提供了对超出其角色的服务和功能的访问。因此，在执行渗透测试时，列出用户应该访问哪些服务和功能以及他实际上可以访问哪些服务是很重要的。</p><p id="a010" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">消息到期</strong></p><p id="405b" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">这可以在SAML消息本身中看到。SAML消息必须包含一个时间戳，表明请求何时发出，或者何时到期。在后一种情况下，会话id将总是有效的，并可能导致危害。</p><p id="3809" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">因此，当通过代理拦截SAML消息时，请始终检查时间戳和过期时间。<strong class="lg iu"> IssueInstance，not nor after</strong>可能是要寻找的关键词。</p><p id="327d" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">消息重放攻击</strong></p><p id="dce5" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">断言应该包含一个惟一的ID(就像web应用程序中的nonce ),这个ID应该只被应用程序接受一次。如果应用程序不考虑唯一ID，那么这可能导致消息重放攻击，从而为同一个用户创建多个会话。</p><p id="7cd0" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">消息签名检查</strong></p><p id="61f0" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">就像JWT一样，SAML包含消息签名。如果消息签名丢失，服务提供商没有检查，那么您可以更改SAML消息的权限以提升您的权限。</p><p id="f71f" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated"><strong class="lg iu">无验证检查</strong></p><p id="4146" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">有些环境过于信任他们的用户。在这种情况下，服务提供者可能被配置为只检查有效的SAML消息。在这种情况下，攻击者可以伪造SAML消息来访问任何其他应用程序。然而，这也可能是错误配置问题的结果。</p><p id="f97e" class="pw-post-body-paragraph le lf it lg b lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb im bi translated">如果SAML消息中反映了一个用户ID，请尝试将其更改为另一个用户的ID。</p><h1 id="231b" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">结论</strong></h1><p id="cd1c" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在这篇博文中，我们讨论了单点登录(SSO)的基础知识，包括它是如何构建的、它的组件、它的安全性以及它可能如何被攻击。单点登录易受各种各样的漏洞的影响；上面列举的只是其中的一部分。总之，单点登录(SSO)简化了企业内部执行的各种任务，并有可能消除对密码管理器的需求。</p></div></div>    
</body>
</html>