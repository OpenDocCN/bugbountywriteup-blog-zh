<html>
<head>
<title>Stealing Chat session ID with CORS and execute CSRF attack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">窃取与CORS的聊天会话ID并执行CSRF攻击</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/stealing-chat-session-id-with-cors-and-execute-csrf-attack-f9f7ea229db1?source=collection_archive---------0-----------------------#2021-02-02">https://infosecwriteups.com/stealing-chat-session-id-with-cors-and-execute-csrf-attack-f9f7ea229db1?source=collection_archive---------0-----------------------#2021-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7b8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，希望你们都健康平安。今天的文章是我最近在Bugcrowd私人项目上的发现。这篇文章解释了我如何将CORS与CSRF攻击联系起来，窃取受害者用户的聊天会话Id，并代表受害者发送消息。不浪费时间，让我们进入漏洞的细节。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="3b2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一月的第二周，在探索<redacted>领域时。我发现目标域名有内置聊天功能。对于发送新消息，系统将发送如下POST请求:</redacted></p><p id="1372" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">POST /ha/chat/ <chat_session_id> HTTP/1.1 <br/>主机:&lt;编校&gt; <br/>用户代理:XXXXX <br/>接受:application/json，text/plain，<em class="ks"> / </em> <br/>接受-语言:en-US，en；q=0.5 <br/>接受-编码:gzip，deflate <br/>内容-类型:application/JSON；charset = utf-8<br/>Host-Site:XXX<br/>Content-Length:75<br/>Origin:XXXXX<br/>Connection:close<br/>Referer:XXXXXXX</chat_session_id></p><p id="8f6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">{"content":"HI "，" event":"MESSAGE "，" clientSideSequence":4，" role":"CUSTOMER"}</p><p id="0686" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过进一步的调查，我发现这个帖子的请求很容易受到CSRF的攻击。太好了。攻击者可以代表受害用户发送消息。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kt kr l"/></div></figure><p id="3a11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是等等！！如果您仔细观察，端点包括受害者的CHAT session _ id * */ha/CHAT/<chat_session_id>* *其格式如下:XXXXXX-CHAT _ xxxxxxxxxxxxx–XXXX-XXXX-XXXX-xxxxxxxxxxxxxxx</chat_session_id></p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ku kr l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">: (</figcaption></figure><p id="63c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我差一点就成功了，我不想放弃。此时此刻，我完全清楚，我需要做的就是找到一种方法来窃取受害者用户的聊天会话ID。所以继续探索，遇到了一个端点，它帮助我创建受害用户的聊天会话ID。* * https://<redacted>/ha/chat/create * *此外，端点没有CORS和CSRF保护。如此快速地创建了CORS POC代码并验证了该端点易受CORS攻击: )</redacted></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi kz"><img src="../Images/7dabb7c224ee3f534c37e9d680c54eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NAGbB2IaJfM6yTy2rpfbxw.png"/></div></div></figure><p id="3356" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> CORS POC代码示例:</strong> <em class="ks">【相应更改值】</em></p><p id="3c03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"> <br/> &lt;脚本&gt;<br/>var req = new XMLHttpRequest()；req.onload = reqListenerreq.open('GET/POST '，'&lt;漏洞URL &gt;'，true)；req.withCredentials = true<br/>req . send(' { } ')；函数req listener(){ alert(this . responsetext)；};<br/>&lt;/脚本&gt; <br/> &lt; /html &gt;</p><p id="e0a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结论</strong></p><p id="b85c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，为了造成影响，攻击者将首先窃取受害者用户的聊天会话Id，然后执行CSRF攻击，以受害者用户的身份发送消息。在完全弄清楚之后，很快在2021年1月12日发布了一份关于Bugcrowd的报告。Bugcrowd Triage团队于2021年1月26日根据严重程度P3对该报告进行了分类</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi lg"><img src="../Images/66c6b7fb1500754ac07b5f5459a3c952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhzGm20GSPr1KdDEaGmH4g.png"/></div></div></figure><p id="efcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你喜欢我的解释。如果你有任何疑问，可以在twitter上ping我:<a class="ae lh" href="https://twitter.com/sunilyedla2" rel="noopener ugc nofollow" target="_blank">https://twitter.com/sunilyedla2</a>。祝你愉快，传播积极情绪！</p></div></div>    
</body>
</html>