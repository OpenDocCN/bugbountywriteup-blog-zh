<html>
<head>
<title>Write-up: Web shell upload via Content-Type restriction bypass @ PortSwigger Academy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">推荐:通过内容类型限制旁路@ PortSwigger Academy进行Web shell上传</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/write-up-web-shell-upload-via-content-type-restriction-bypass-portswigger-academy-839365e13bc?source=collection_archive---------3-----------------------#2022-11-10">https://infosecwriteups.com/write-up-web-shell-upload-via-content-type-restriction-bypass-portswigger-academy-839365e13bc?source=collection_archive---------3-----------------------#2022-11-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c86e0b98d01e14f083ff4f2d0de1d9ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2T1OlTFTaUS4exab.png"/></div></div></figure><p id="e436" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇关于通过内容类型限制旁路的实验室<em class="kw"> Web shell上传的文章是我在<a class="ae kx" href="https://portswigger.net/web-security" rel="noopener ugc nofollow" target="_blank"> PortSwigger的Web安全学院</a>的演练系列的一部分。</em></p><p id="b60d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">学习路径</strong>:服务器端主题→文件上传漏洞</p><div class="ky kz gp gr la lb"><a href="https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-content-type-restriction-bypass" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">实验室:通过内容类型限制旁路上传Web shell | Web Security Academy</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">练习利用现实目标的弱点。记录你从学徒到专家的进步。看哪里…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">portswigger.net</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><p id="b3e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Python脚本:<a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/blob/main/08_file_upload_vulnerabilities/Web_shell_upload_via_Content-Type_restriction_bypass/script.py" rel="noopener ugc nofollow" target="_blank"> script.py </a></p><h1 id="8a3e" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">实验室描述</h1><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/93616b2b8a05c119aa69bf6828843f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tM1wPEXinC1Khd0q.png"/></div></div></figure><h1 id="dd76" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">步伐</h1><h1 id="3ab8" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">第一眼</h1><p id="959a" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">实验室应用程序是一个博客网站。在公共页面上，没有什么有趣的东西出现，我继续用已知的用户帐号<code class="fe my mz na nb b">wiener</code>登录。</p><p id="c51a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在帐户设置中，我可以为用户设置电子邮件地址和头像图片。</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="bd5c" class="lq lr iq bd ls lt nj lv lw lx nk lz ma mb nl md me mf nm mh mi mj nn ml mm mn bi translated">找出允许上传的内容</h1><p id="4678" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">首先，我试着上传<a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/blob/main/08_file_upload_vulnerabilities/Remote_code_execution_via_web_shell_upload/README.md" rel="noopener ugc nofollow" target="_blank">之前实验</a>的PHP脚本。这一次，有一些上传限制，我收到一条错误消息:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/b65ed4149ae13c2aaa678a18143310b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3s4z4mpwvY2-JbI_.png"/></div></div></figure><p id="1d8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，错误消息指出了一些细节</p><ol class=""><li id="d7f9" class="np nq iq ka b kb kc kf kg kj nr kn ns kr nt kv nu nv nw nx bi translated">第一个失败的检查验证内容类型，这是用户提供的值。</li><li id="0403" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">它显示了允许的内容类型的值。</li></ol></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h1 id="5585" class="lq lr iq bd ls lt nj lv lw lx nk lz ma mb nl md me mf nm mh mi mj nn ml mm mn bi translated">修改内容类型</h1><p id="f79e" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">下一步是将请求中的内容类型修改为允许的类型之一。</p><p id="db37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果这是执行的唯一检查，我将成功。否则，错误消息可能会再次给出如何继续的指示。</p><p id="9b64" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将上传请求加载到Repeater中，并更改内容类型。</p><p id="586b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">响应表示成功。这意味着内容类型验证是应用程序执行的唯一检查:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/fa59b7c59ac3e3a3f7fe9c19d9035013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VXdVAbBfdxmZ2w8s.png"/></div></div></figure><p id="0f68" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">文件名保持为<code class="fe my mz na nb b">shell.php</code>,以便服务器可以执行它。调用上传的脚本显示秘密数据:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/7a7a1363f023c58a99b33417217d3424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ctZTvj1prXKEnkmu.png"/></div></div></figure><p id="603f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">提交秘密后，实验室更新到</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/de7d026b89ef0f8795b52cc45183bc6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R3djnLZ-IqmO3DTM.png"/></div></div></figure></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="34dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">原载于</em><a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/tree/main/08_file_upload_vulnerabilities/Web_shell_upload_via_Content-Type_restriction_bypass" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://github.com</em></a><em class="kw">。</em></p><pre class="mp mq mr ms gt og nb oh oi aw oj bi"><span id="c347" class="ok lr iq nb b gy ol om l on oo"><a class="ae kx" href="https://medium.com/@frank.leitner/membership" rel="noopener">New to Medium? Become a Medium member to access all stories on the platform and support me at no extra cost for you!</a></span></pre></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><h2 id="a059" class="ok lr iq bd ls op oq dn lw or os dp ma kj ot ou me kn ov ow mi kr ox oy mm oz bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kx" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>