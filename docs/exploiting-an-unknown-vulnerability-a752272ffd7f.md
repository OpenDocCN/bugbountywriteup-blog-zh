# 利用未知漏洞

> 原文：<https://infosecwriteups.com/exploiting-an-unknown-vulnerability-a752272ffd7f?source=collection_archive---------0----------------------->

大约 2 个月前，我在一个咨询应用程序中发现了这个漏洞。他们的安全团队告诉我，这个应用程序已经过测试，如果我能找到一个漏洞，他们将奖励奖金。对于新的目标，我首先分析应用程序并制作其功能的数据流图，然后开始寻找漏洞。我广泛地测试逻辑漏洞，因为从我的经验来看，我知道会有一些关键的转换可能被应用程序开发人员或测试人员遗漏。

我把它命名为“未知”漏洞，因为我想把它作为一个练习和记录，这就是为什么我没有在标题中写细节。

有两种类型的用户角色:目标应用程序中的顾问和客户。该应用程序的核心功能是为各种客户提供咨询服务。

*   顾问们以硬币形式收取服务费。

```
**#** **consultant request**POST /set/fee/{"value": 5, "timing":2}
```

*   客户访问顾问的时间表，选择一个合适的时间段并预订该时间，硬币将根据时间表中显示的相应时间段的费用从客户的帐户中扣除。

```
**#** **client request**POST /consultant_username/book{"timing":2}
```

在进一步阅读之前，我建议你们写下自己的测试用例或者开发上述功能的方法。祝您好运👍

![](img/19d1f770b6d81353db72ed50cbc15764.png)

我想出了以下测试案例🤔。

1.  Sqli、命令注入等注入漏洞
2.  修改内容类型并将数据请求到 xml 以测试 XML 注入
3.  用更少的硬币预订顾问的更高价值的时间段
4.  从**顾问请求**中注入**值**参数，并在**客户请求**中使用
5.  参数污染通过注入两个**定时**值在**客户端**请求**中**
6.  使用**客户端** **请求**中的**计时**值进行基于数组的注入，即{"timing[0]":2}
7.  通过将 POST 改为 PUT 篡改 HTTP 方法
8.  通过播放多线程**客户端** **请求**预约同一个顾问的两个或多个时间段(竞争条件)
9.  通过播放多线程**客户端**请求**请求**预约两个不同的顾问时间段(竞争条件)

我敢肯定，你可能已经想出了不同的测试案例，所以请在下面评论你的测试案例。

不幸的是，上述测试案例都不适合我😥。可能是他们的安全团队缓解了这些漏洞，或者是有经验的开发人员构建了应用程序。

第二天，我再次查看，这次我的注意力更多地集中在预订请求上，因为请求中没有传递硬币，在提交**客户请求**后，硬币会自动从客户的账户中扣除。

```
POST /consultant_username/book{"timing":2}
```

**如果顾问在客户预定时间段**之前将费用调高，会发生什么情况。我很兴奋🤩我认为这应该行得通，但对我来说还是行不通。因为它显示了“这个位置的顾问费是 10 英镑”的信息。

![](img/bec71aeb4960da36ab474cfb4d22d215.png)

我本来打算放弃，但是**竞争条件**的想法出现在我的脑海中，为了测试它，我向 web 服务器发送了多线程请求，每次在四个不同的请求中有四个不同的咨询费(5，15，15，5)，并将这些请求放在一个循环中半小时。当客户在此期间访问顾问时间线时，有 50%的机会客户将最终支付更高的费用。通过这种方式，我成功地利用了😄这种漏洞通过快速改变咨询价格。应用程序也有一个提供功能，其中顾问可以设置一定时期的折扣。

# **攻击流**

1.  顾问为任何时间段“x”设置 5 个硬币的费用。
2.  顾问设定报价周期，即一天 30-60 分钟。
3.  客户在报价期间访问顾问时间表。
4.  顾问通过循环播放多线程**顾问请求**快速改变咨询价格，并发送给服务器。
5.  客户通过向服务器发送预订请求来支付费用。
6.  额外的硬币会从客户账户中扣除。

# **影响**

顾问可以欺骗客户支付比他们的服务时间表中显示的更高的金额。

# **外卖**

作为维护者，制作一个漏洞清单，并对应用程序中实现的每个功能进行测试。应该实现基于速率限制和竞争条件的锁定系统来防止这种类型的漏洞。

随着应用程序功能的增长，其复杂性呈指数级增长，在应用程序的设计、开发或安全测试阶段错过一些测试用例的机会也越来越多。通过反复查看请求历史来分析应用程序功能，了解应用程序中的数据流等。将你的精力和时间花在构建更智能的测试用例上，以打破应用程序的用例。

非常感谢！

学习、构建和突破！

> 最初发布于:[https://abhibundela . com/2018/09/25/exploining-an-unknown-vulnerability/](https://abhibundela.com/2018/09/25/exploiting-an-unknown-vulnerability/)