<html>
<head>
<title>Disclose Private Video Thumbnail from Facebook WorkPlace</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">披露脸书工作场所的私人视频缩略图</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/disclose-private-video-thumbnail-from-facebook-workplace-52b6ec4d73b7?source=collection_archive---------1-----------------------#2018-05-03">https://infosecwriteups.com/disclose-private-video-thumbnail-from-facebook-workplace-52b6ec4d73b7?source=collection_archive---------1-----------------------#2018-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5e67769c810a07636fcf4411a158dbc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cJ_L_iDNzDCQ1J1OkniMdw.png"/></div></div></figure><p id="55dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大家好，又是我<strong class="ka ir">萨马德·哈桑(</strong> <a class="ae kw" href="https://twitter.com/JubaBaghdad" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">朱巴巴格达</strong> </a> <strong class="ka ir"> ) </strong>，我想和大家分享一下<strong class="ka ir">我在<strong class="ka ir">脸书</strong>通过他们的<a class="ae kw" href="http://facebook.com/whitehat/dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> BugBounty程序</strong> </a> <strong class="ka ir">发现的第二个bug </strong>。</strong></p><p id="54ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个故事开始于我决定测试脸书页面的时候，因为我通过阅读大量的评论知道，当猎人在页面上找到有效的bug时，脸书会支付丰厚的赏金。</p><p id="f58e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以像往常一样，<strong class="ka ir">我为自己</strong>创建了一个测试页面，我检查了页面上的每个选项，看看是否能找到一些有趣的东西，甚至是有趣的信息。这可能会导致我有效的错误。</p><p id="399d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">过了一会儿，一个名为<a class="ae kw" href="https://www.facebook.com/business/learn/facebook-create-ad-canvas-ads" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">CANVAS</strong></a><strong class="ka ir"/>的选项引起了我的注意，基本上<strong class="ka ir">页面管理员甚至是广告商</strong>都可以创建<strong class="ka ir"> CANVAS </strong>，里面有一些上传照片或视频的选项</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/a52603ce1eb1eb356a972e8f9ae9f05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4uO89GgDkqJw1S11glG5A.png"/></div></div></figure><p id="d748" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我上传了我的测试视频并保存了它，然后我编辑了我创建的<strong class="ka ir">画布</strong>，<strong class="ka ir">之后我更改了画布的标题，然后用Burpsuite </strong>截取它以查看这个画布的机制和它里面的参数，请求如下:</p><p id="b698" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">POST /v2.11/{My_Page_ID}？Access _ Token = { My _ page _ Access _ Token } HTTP/1.1<br/>主机:graph.facebook.com<br/>用户代理:<br/>接受:*/* <br/>接受-语言:en-US，en；q = 0.5<br/>Referer:<a class="ae kw" href="https://www.facebook.com/" rel="noopener ugc nofollow" target="_blank">https://www.facebook.com/</a>T43】Content-type:application/x-www-form-urlencoded<br/>Content-Length:206<br/>Origin:<a class="ae kw" href="https://www.facebook.com" rel="noopener ugc nofollow" target="_blank">https://www.facebook.com</a><br/>Connection:close</p><p id="9d10" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">_ req name = object % 3a canvas _ Video &amp; _ req src = AdsCanvasElementDataLoader &amp; bottom _ padding = 0 &amp; locale = en _ US &amp; method = post &amp; name = Video &amp; pretty = 0 &amp; style = FIT _ TO _ WIDTH &amp; suppress _ http _ code = 1 &amp; top _ padding = 0 &amp;<strong class="ka ir">Video _ id = 956034724555363</strong></p><p id="fd06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所见，上面有一个名为<strong class="ka ir">video _ id = {视频id }，</strong>的参数，它负责我上传到画布中的视频</p><p id="df72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有一次我看到那个参数，就直接在我的虚拟盒子里打开了<strong class="ka ir">我的第二个测试账号</strong>，发了帖子上传了测试视频，复制了(<strong class="ka ir"> video_id)号</strong></p><p id="73fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就像<strong class="ka ir">:video-id = 130146294495198</strong>，替换到前面提到的<strong class="ka ir">video _ id = { video id }</strong>中，boooooooooooom，视频成功上传到我的页面画布中，响应如下:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/c4f1d6b9badeb6013166b51734bd70a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hoq6KDxqbpC5L46pbl2ZBQ.png"/></div></div></figure><p id="531b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我可以通过<strong class="ka ir">“视频id号”</strong>在我的画布中上传任何来自非我好友的用户的<strong class="ka ir">公开视频，以及来自我好友</strong>帖子的任何视频，如果他们<strong class="ka ir">将帖子隐私设置为“仅供好友使用”</strong></p><p id="2994" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我们在<strong class="ka ir"> (video_id=) </strong>参数中有一个<a class="ae kw" href="https://www.owasp.org/index.php/Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> IDOR </strong> </a> bug，这意味着两个视频，<strong class="ka ir">我的画布视频和我的第二个测试帐户的视频</strong>有相同的<strong class="ka ir"> video_id号，</strong>所以我说如果我删除我的画布视频，我的第二个测试帐户帖子中的视频也会被删除，因为逻辑上它们有相同的<strong class="ka ir"> video_id </strong>号，但不幸的是</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="1e76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯，我现在该做什么，好吧，让我们跳出框框思考，我必须把这个错误从<strong class="ka ir"> N/A变成一个有效的错误。</strong></p><p id="fc6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二天<a class="ae kw" href="https://www.facebook.com/workplace" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">脸书职场</strong> </a>子域进入我的脑海，因为我知道<strong class="ka ir">脸书职场</strong>的每个帖子都被认为是私人的，比如照片或视频，因为只有拥有相同电子邮件域的公司成员才能看到他们的帖子。</p><p id="1c2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">于是我在<strong class="ka ir">我的职场测试账号</strong>里发了一个视频帖子，看看我能否用CANVAS IDOR bug(通过video_id)公开视频，我从我的职场帖子里复制了<strong class="ka ir"> (video_id) </strong>号<strong class="ka ir">video _ id = 168712210608619</strong>替换到我上面提到的请求里，boooooom，回应如下:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/3d5621ad05e39a6898c7b59aa0f39e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jpu88aIFoFrdzhA14MZFUQ.png"/></div></div></figure><p id="43ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我刷新页面，点击查看选项，看看我是否可以查看视频<strong class="ka ir">(视频来自我的工作场所账户)</strong>，但我再次看不到视频<strong class="ka ir">，但我注意到一些有趣的事情</strong>见下图:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/f5dc0347b2c51438e9528c5baad19d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m9e43s-chvFI7kj0CfxHBw.png"/></div></div></figure><p id="7014" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如你在上面的照片中看到的，视频有一个旋转的图标，这意味着视频上传成功，但有东西阻止它预览，我对自己说我真的很接近了，我有<strong class="ka ir">来绕过这个狗屎</strong></p><p id="89de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">几分钟后，在我抽烟的时候<strong class="ka ir">一个想法</strong>出现在我的脑海里，我说如果我把我的画布发送到我的智能手机<strong class="ka ir">会怎么样</strong>(因为有一个选项可以将你的画布预览发送到你的移动设备)见下图:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/8bd49a135a7b5afd168ef3a1caeb1cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D9Ka0cxUVfHN63KoyBJjYA.png"/></div></div></figure><p id="04dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我将画布发送到我的智能手机时，我在手机中收到一个通知，告诉我<strong class="ka ir">“您的画布已经可以预览了”</strong>，我点击了它，booooooooom，我在我的设备中看到了视频，但我无法播放整个视频，我只能看到<a class="ae kw" href="https://support.office.com/en-us/article/capture-or-change-a-video-thumbnail-bbf52fe0-3dd6-4bd7-b199-ccde413f6b1e" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">视频缩略图，</strong> </a> <strong class="ka ir"> </strong>我就像这样:</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="li le l"/></div></figure><p id="0557" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我直接向<a class="ae kw" href="https://www.facebook.com/whitehat/dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">脸书安全团队</strong> </a>报告了这个bug，因为我知道这是一个有效的bug，为什么！！嗯(从我的角度来看)<strong class="ka ir">脸书工作场所</strong>是为组织或公司设计的，正如我上面提到的，工作场所的每个帖子都被认为是私人的，只有公司或组织的成员才能看到它们的内容，<strong class="ka ir">能够看到<strong class="ka ir">工作场所帖子</strong>中的视频缩略图</strong>被认为是一个安全问题，因为想象这些视频包含私人信息，如会议地点、私人电子邮件、公司的私人标题，如价格、预算、产品销售数字或任何私人信息。这不应该被公众看到，更不用说视频本身的私人内容。</p><p id="0c2c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">时间线:</strong> <br/>三月。2018年3月30日—初次报告<br/>4月。2018年05月——4月的报告审判<br/>。2018年4月10日—由脸书<br/>确定。2018年10月—固定确认<br/>五月。2018年03月-奖励3000美元</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/7eb6e14f185a27c4a548ecac13f6306c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*vc3OCNGd0a6PZyoXsHI0iw.png"/></div></figure><p id="6963" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我要感谢脸书安全团队的慷慨，谢谢你们</p><p id="31d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">概念验证视频:</strong></p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lk le l"/></div></figure><p id="cb81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">武道:</strong></p><p id="3b90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1-你必须知道你的目标，并检查它的每一个选项。</p><p id="b378" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2-有时你需要跳出框框思考。</p><p id="344b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3-始终确保你的bug会影响应用程序。美国用户或其系统</p><p id="7ff1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4-始终关注视频和照片ID，有机会看到流动在那里</p><p id="e510" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5-最重要的事情是“玩得开心”。</p><p id="808f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢你</p><p id="eccd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">萨尔马德·哈桑(朱巴巴格达)</p></div></div>    
</body>
</html>