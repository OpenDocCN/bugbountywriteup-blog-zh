<html>
<head>
<title>DomeCTF XII Writeup : The Matrix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DomeCTF XII撰写:矩阵</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/domectf-writeup-the-matrix-9f863a9fe6b4?source=collection_archive---------2-----------------------#2019-09-29">https://infosecwriteups.com/domectf-writeup-the-matrix-9f863a9fe6b4?source=collection_archive---------2-----------------------#2019-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="66fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">阿杜队</p><h1 id="fa80" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">它开始于…</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lj"><img src="../Images/545b0cdb16bb4d00ce4ae767447ccb45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_Wa6vfgWPJf_GnSZsrHhg.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">DOMECTF COCON XII</figcaption></figure><p id="193b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参加DomeCTF时，我从刚果开始。片名是“黑客帝国”，作为一个孩子，我喜欢这部电影，现在我有机会享受挑战。纯粹从它的名字来看，它成了我的首选。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lz"><img src="../Images/61bf8c9c1ec0a7006024a3a4fb496130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o7ld6Pp_oo33iDdvIEZrBA.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">问题陈述</figcaption></figure><p id="a2cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">链接指向了中的<a class="ae ma" href="https://matrix.domectf.in" rel="noopener ugc nofollow" target="_blank"/></p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi mb"><img src="../Images/314e7f8b79ade546a5467017e8755c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j3WjKhp-FiQFWjNutw5cyg.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">登录页面</figcaption></figure><p id="facd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到一个网站，我采取了双管齐下的方法。</p><p id="73b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重新检查网站和服务器。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="d408" class="kl km iq bd kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le mn lg lh li bi translated">侦察</h1><ul class=""><li id="6b5d" class="mo mp iq jp b jq mq ju mr jy ms kc mt kg mu kk mv mw mx my bi translated">今天，许多网站隐藏在Cloudflare之后，pinging服务器确认这也受到cloudflare的保护，嗯，这可能很难。在cloudflare IP上运行nmap毫无意义，因为它是共享的。那不会带我们去任何地方。</li></ul><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi mz"><img src="../Images/62c9292eb32997ebe1a2cea08af3091e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQuinNisE0KzpAKbO8OdmQ.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">ping到网站。Ip属于Cloudflare。</figcaption></figure><ul class=""><li id="7b33" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">然后我做了一个TXT记录搜索，寻找任何泄漏</li></ul><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nd"><img src="../Images/151d52da85ff1818e70ad552efef62d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDCb6Z4Aoxx53RTPlVwaPw.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">里面也什么都没有</figcaption></figure><ul class=""><li id="6231" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">所以基本上这必须是一个网络挑战，然后继续侦查，我启动了两个我最喜欢的程序，dirb和nikto。它们预装在任何Kali发行版上，非常棒。有些人会说有比dirb更好的程序，但当与cloudflare对抗时，其他程序往往会更快被阻止。所以迪布。</li></ul><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/2d77f6ad32fa0f967f5ec77025cf35f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*SS-BTvOo6k-fQhPasjrI5g.png"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">dirb找到备份目录</figcaption></figure><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nf"><img src="../Images/39d01451ad405b57231f9c6c17c333c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F_RyxgAvoZiSjh52e6IoGg.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">正如所料，备份有一个目录列表</figcaption></figure><ul class=""><li id="555a" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">同时，查看网站本身的链接也很重要，我们在主页上有https://matrix.domectf.in/register.php<a class="ae ma" href="https://matrix.domectf.in/register.php" rel="noopener ugc nofollow" target="_blank">的链接，让我们也来看看</a></li></ul><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi ng"><img src="../Images/015c7627d6295786879efae84df9895b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uqNfEpidYq15QqS-HwILmw.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">注册页面</figcaption></figure><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nh"><img src="../Images/07ad84669e80a8d1a45ea6563a894035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APBjocAaQhlhTRobG7Hhiw.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">注册页面显示我的用户名和密码。会有XSS吗？</figcaption></figure><ul class=""><li id="54cd" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">我试着看网站上的JS，但是网站上的所有东西都是服务器端的，一点都不好玩。</li></ul></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="976f" class="kl km iq bd kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le mn lg lh li bi translated">备用拉链</h1><ul class=""><li id="e2d4" class="mo mp iq jp b jq mq ju mr jy ms kc mt kg mu kk mv mw mx my bi translated">让我们看看在网站上找到的备份文件。</li></ul><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi ni"><img src="../Images/e8fd47d96c6459cb889b3d35894cf3ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmtQyGpG_424oblbEJ_IvQ.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">看起来我们找到了源代码</figcaption></figure><ul class=""><li id="1c61" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">提供源代码，意味着我们需要找到一种方法来绕过登录查看源代码。好了，让我们开始吧</li></ul><h1 id="feea" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">源代码</h1><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">index.php</figcaption></figure><ul class=""><li id="06bf" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">因此，如果我们提供正确的用户名和密码，我们将获得标志。</li><li id="3eab" class="mo mp iq jp b jq nl ju nm jy nn kc no kg np kk mv mw mx my bi translated">让我们进一步检查备份Zip中的其他文件</li><li id="9327" class="mo mp iq jp b jq nl ju nm jy nn kc no kg np kk mv mw mx my bi translated">functions.php定义了在index.php和register.php使用的各种功能</li></ul><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">register.php</figcaption></figure><ul class=""><li id="c49e" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">重要的部分在于第43 +行。如果用户注册成功，我们将看到用户名和密码。让我们检查functions.php，以了解注册函数返回代码和其他功能。</li></ul><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">functions.php</figcaption></figure><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">用户. dat</figcaption></figure><ul class=""><li id="f582" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">乍一看，注册函数似乎有些不合适。该程序将用户名转换为MD5，密码转换为base64，然后将其保存到pws.dat。我们只收到了users.dat的副本，这对于我们来说已经足够了。</li><li id="fc1f" class="mo mp iq jp b jq nl ju nm jy nn kc no kg np kk mv mw mx my bi translated">users.dat包含一个逗号分隔的列表。第一列是base64编码的用户名，第二列是base64编码的电子邮件地址，最后一列是布尔值1/0，表明用户是否已经过验证。</li></ul><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">这是我们的pws.dat在服务器上的样子</figcaption></figure><ul class=""><li id="a2e3" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">如果我们同时拥有users.dat和pws.dat，我们将把base64编码的用户名转换为clear，计算md5散列以在pws.dat中找到匹配项，转换相应的base64编码的密码并使用该密码登录。但是，唉，黑客的生活太简单了。</li></ul><h1 id="1e57" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">PHP类型杂耍</h1><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nq nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">关于PHP魔术的OWASP日演示</figcaption></figure><ul class=""><li id="ccf0" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">PHP支持类型杂耍，这就是漏洞所在。</li><li id="0d9e" class="mo mp iq jp b jq nl ju nm jy nn kc no kg np kk mv mw mx my bi translated">当使用==运算符进行检查时，看起来像数字的字符串将产生True。</li><li id="e249" class="mo mp iq jp b jq nl ju nm jy nn kc no kg np kk mv mw mx my bi translated">这对我们来说也是正确的。因此，让我们计算检索到的用户名的MD5散列。</li><li id="a914" class="mo mp iq jp b jq nl ju nm jy nn kc no kg np kk mv mw mx my bi translated">快速Python时间</li></ul><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">convert.py</figcaption></figure><ul class=""><li id="da44" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">我们将用户名转换为它们对应的md5散列，并检查是否有以0e开头的，因为0的任何次方始终是0</li></ul><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">转换的用户. dat</figcaption></figure><ul class=""><li id="3f76" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">我们创建一个generate.py来寻找一个hash，这个hash将生成一个try杂耍字符串。我们将测试多达10个字符的字符串，超过它，不可行。</li></ul><figure class="lk ll lm ln gt lo"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">generate.py</figcaption></figure><ul class=""><li id="4af4" class="mo mp iq jp b jq jr ju jv jy na kc nb kg nc kk mv mw mx my bi translated">程序继续运行，与此同时，我在谷歌上搜索了魔法哈希和MD5(240610708)= &gt; 0e 462097431906509019562988736854，这是一个数字<a class="ae ma" href="https://www.whitehatsec.com/blog/magic-hashes/" rel="noopener ugc nofollow" target="_blank">https://www.whitehatsec.com/blog/magic-hashes/</a></li></ul><h1 id="d417" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">标志时间</h1><ul class=""><li id="293d" class="mo mp iq jp b jq mq ju mr jy ms kc mt kg mu kk mv mw mx my bi translated">我们将尝试创建一个用户名为<strong class="jp ir"> 240610708 </strong>和随机密码的用户，并尝试通过GcY 获取用户<strong class="jp ir">的密码</strong></li></ul><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/6e98ef197d0fd6d6bdb64c217289f2bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*Wz0xoT4-qKoVys3Q1J-6iw.png"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated">我们有用户<strong class="bd kn"> byGcY </strong>的密码</figcaption></figure><p id="291d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">让我们来测试一下我们是否正确</strong></p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f8459fe349d0713f36d6a5973abdaba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*byDB9SsVEIR3cnWaadRq1A.png"/></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk translated"><strong class="bd kn">发现标志</strong></figcaption></figure><h1 id="6128" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">快乐的黑客们……</h1></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="1777" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nt">关注</em> <a class="ae ma" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="nt"> Infosec报道</em> </a> <em class="nt">获取更多此类精彩报道。</em></p><div class="nu nv gp gr nw nx"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">信息安全报道</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">medium.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol lt nx"/></div></div></a></div></div></div>    
</body>
</html>