<html>
<head>
<title>Testing EDRs for Linux — Things I wish I knew before getting started</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Linux测试EDRs我希望在开始之前就知道的事情</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/testing-edrs-for-linux-things-i-wish-i-knew-before-getting-started-3ab15112c183?source=collection_archive---------0-----------------------#2022-03-20">https://infosecwriteups.com/testing-edrs-for-linux-things-i-wish-i-knew-before-getting-started-3ab15112c183?source=collection_archive---------0-----------------------#2022-03-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6473" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些天来，我开始重新考虑发布可能对攻击者有用的信息。所以这次我会尝试一些不同的东西。我不会具体告诉你我们在Linux上发现了哪些特定EDRs的功能。如果你感兴趣，请随时联系我，一旦我知道这些信息会被妥善保管，我很乐意与你分享。</p><p id="100f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，我会用一个简单的<a class="ae kl" href="https://github.com/gmatuz/npm-initial-access" rel="noopener ugc nofollow" target="_blank">基础测试用例</a>来帮助你，你可以用它来大致了解一下，并有希望容易地扩展到一个适当的测试。我还添加了一些我们所做的观察，如果您决定自己测试它，可以减少一些复杂性。</p><p id="2c57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我决定选择这种形式的另一个原因是，如今安全工具经常被非安全人员选择，他们不一定具有建立真实测试用例的专业背景，也不一定能在比较产品时有效地集中精力。类似地，安全团队通常没有时间深入调查。有了<a class="ae kl" href="https://github.com/gmatuz/npm-initial-access" rel="noopener ugc nofollow" target="_blank">库</a>中的测试用例，我相信你可以用很少的背景知识进入后开发部分，这在很多方面对大多数人来说更容易理解和简单明了。</p><p id="223b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我鼓励你，如果你有一台EDR，并且你的商店运行Linux或macOS，花几天时间，带它去兜风！</p><p id="d96b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是TLDR，如果你在Linux上测试EDR，你不必关心这些:</p><ul class=""><li id="97a0" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">绝大多数检测都是基于原子操作，而不是过程树和评分:如果您想简化测试，只需直接从shell运行它们，并分别测试各个步骤。有点像<a class="ae kl" href="https://github.com/redcanaryco/atomic-red-team" rel="noopener ugc nofollow" target="_blank">原子红队</a>做的那样。</li><li id="a6a6" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">EDRs强调的不是网络的内容:从简单的HTTP开始，重用你的C2，直到遇到问题</li><li id="352c" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">功能的动态加载远不如Windows重要:只需从完整的有效负载开始，并在需要时添加</li><li id="cebe" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">提供商对您的测试是公平的，代理并不像人们想象的那样适应:您可以让您的测试机器只运行恶意行为。如果你想再次检查，只需重新运行测试用例，这避免了早期的检测，以查看盒子是否被污染。</li></ul><h1 id="8b5f" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么测试安全产品很耗时</h1><p id="b33c" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">当你在测试一些东西的时候，你想要确定你的测试用例代表了现实并且足够复杂。您不希望您的整个场景在开始时因为一个简单的文件哈希而被检测到，但是您也希望避免因为他们运气不好，没有检测到您的单个变体而得出产品无用的结论。</p><blockquote class="md me mf"><p id="f1f4" class="jn jo mg jp b jq jr js jt ju jv jw jx mh jz ka kb mi kd ke kf mj kh ki kj kk ij bi translated">如果你测试EDRs，你理想地建立一个现实的基线环境，并通过<a class="ae kl" href="https://en.wikipedia.org/wiki/Kill_chain" rel="noopener ugc nofollow" target="_blank">杀伤链</a>或<a class="ae kl" href="https://attack.mitre.org/" rel="noopener ugc nofollow" target="_blank">米特里ATT &amp; CK </a>的战术中的每一步，对于每一个阶段，你有相同步骤的不同版本，每一个都有不同的规避复杂程度。</p></blockquote><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mk"><img src="../Images/3c6c238fffcc1b22eadf7efd7435b10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xZ8MFEzIQJX9j6IM.png"/></div></div></figure><p id="23ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">显然，这导致了巨大的组合和巨大的工作量。所以你开始减少一些复杂性。</p><p id="fa04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以省略一些步骤或一些复杂程度。问题是，要么你因为切错了地方而浪费了时间，最后你得出的结论是工具比实际情况要好，要么你达到了产品的极限，最后你的自我批评，或者来自供应商的不可避免的抵制，会提醒你:事情没有被发现的原因可能是因为场景不够现实。对此有很好的论据:reverse shell本身没有恶意；你所做的事情并不是一种在野外实际使用的技术，也不是对真实行为的检测。这些都是公平点，所以现在你卡住了。你必须花更多的时间进行进一步的测试，或者相信表面上的论点。</p><h1 id="8dff" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">我是来帮你解决头痛的</h1><p id="9ee0" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">基于我们在测试中艰难学到的观察，你可以减少很多复杂性。如果你希望你的结果受到外部挑战，我也给你一个简单的测试案例，它可以解决你将要遇到的大多数争论。</p><p id="db86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/gmatuz/npm-initial-access" rel="noopener ugc nofollow" target="_blank">在这个库中</a>你会发现一个初始访问和执行的基本案例，结合了一些使用开源工具的基本C2设置。我相信你最好把时间花在剩下的事情上。</p><blockquote class="mw"><p id="a69f" class="mx my iq bd mz na nb nc nd ne nf kk dk translated"><strong class="ak">测试场景如下:</strong>攻击者发布和后门NPM包，这是你的依赖。该软件包使用恶意的预安装脚本来下载并运行一个脚本，该脚本会丢弃一个后门，该后门与常见的开源C2框架建立通信。</p></blockquote><p id="cc02" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">这个场景在现实中确实发生了:包<a class="ae kl" href="https://www.zdnet.com/article/malicious-npm-package-opens-backdoors-on-programmers-computers/" rel="noopener ugc nofollow" target="_blank">确实使用完全相同的方法被后门</a>，攻击者——我们从<a class="ae kl" href="https://www.redscan.com/news/key-insights-from-the-conti-ransomware-playbook-leak-foothold/" rel="noopener ugc nofollow" target="_blank"> conti leaks </a>中非常清楚地知道——确实使用了例如Metasploit。唯一的例外是，在Linux上，这些恶意软件包通常会窃取机密(包括ssh密钥)，但是您可以很容易地将其添加到开发后步骤中。</p><p id="5836" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还添加了一个易受攻击的VM，它使用了一些提升权限的方法，所以你也不必担心这个问题。</p><blockquote class="mw"><p id="78d7" class="mx my iq bd mz na nb nc nd ne nf kk dk translated">祝你考试顺利！</p></blockquote><p id="ec78" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">特别感谢安朵斯、基思、马库斯、马克和索特一路上的帮助和指导，这使我能够为你总结一个相当广泛的研究，并在最简单的场景中提炼出许多技术工作，你可以用它们来测试EDRs。</p></div></div>    
</body>
</html>