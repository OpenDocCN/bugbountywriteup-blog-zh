<html>
<head>
<title>LLMNR Poisoning and WPAD Spoofing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LLMNR中毒和WPAD恶搞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/llmnr-poisoning-and-wpad-spoofing-69bfd8d8c504?source=collection_archive---------0-----------------------#2019-08-13">https://infosecwriteups.com/llmnr-poisoning-and-wpad-spoofing-69bfd8d8c504?source=collection_archive---------0-----------------------#2019-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8d58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最近开始在【编辑】实习，作为一名Pentesting实习生。在开始之前，我知道Active Directory将会是一个巨大的目标，但是我还不知道可以可靠地在一个域中进行转换。我在的第三周被分配到一个内部的pentest，在那里我们给一个客户送去一个kali盒子，他们把它接入网络，它就给家里打电话。我被告知要做的第一件事是运行一个叫做responder的工具。我听说过它，但没有太多的经验使用它对一个领域。几乎同时，我们开始接收域外的凭证。哇！我听说过使用MiTM技术从一个活跃的域中获取凭证是多么容易，但这仍然让我大吃一惊。我们进行了pentest，得到了你想从一个域中得到的一切(我不是在开玩笑)。尽管浏览整个网络很有趣，但在我的内心深处，我仍然在想，“我们是如何如此容易地获得信用的？为什么会成功？”。</p><p id="797b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我决定研究这个工具，并学习它用来获得这些用户的技术。我首先调查的是一个叫LLMNR的东西。链路本地多播名称解析用于资源解析。例如，当用户寻找一个文件共享时，它会发出一个对资源来源的请求。默认情况下，Windows 7、8和10会启用此行为。很容易禁用这种行为，但这是一个简单的谷歌搜索了。如果您可以访问网络，理论上，您可以响应文件共享请求，并说“我有位置，但我需要您的凭证来验证您是用户。”这就是工具响应器的用武之地。Responder允许您监听这些事件，并向发出请求的人做出回应，获取用户的用户名和哈希。</p><p id="5f06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用标记“-h”启动响应器，我们可以看到此攻击的选项:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2a7e7e138d45949c7bbb7fa20b9b98c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jONnGpVKMOU6_WXJ.png"/></div></div></figure><p id="642e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于基本的LLMNR中毒，我们只需要一面旗帜:'-I '。用-I运行responder并指定连接到域的接口，我们监听网络上的事件。如果网络上没有服务器知道用户想要的共享在哪里，我们可以说“我知道它在哪里”并抓取认证。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kx"><img src="../Images/8a2c606dfc8d3dbe83157c603f45162c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XspM0LpcJ9RMDai6.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/292beca3877a628fa56ca4433bac1c94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4116tTAZ2zMpbPaH.png"/></div></div></figure><p id="5992" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，我们从响应者那里得到了用户名和散列值。这是因为用户登录的Windows计算机发出了一个文件共享位置的请求。没有其他服务器知道共享的位置，所以我们说我们知道它在哪里。然后，Windows机器向我们发送认证，我们捕获了该响应。这是一种非常简单的方法来获取用户在一个域中的散列值。我们可以破解哈希并获得用户名/密码，但是您可以看到哈希是NTLMv2。这些很难破解。下一个选择是什么？我们接下来可以利用一个叫做WPAD的东西。</p><p id="62aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">WPAD是一种用于发现网络上的web代理的协议。默认情况下，Windows配置为向域询问配置文件的位置，该文件包含Web代理在网络上使用的信息。Responder为我们提供了欺骗的选项，并要求再次验证。让我们在responder上强制WPAD，看看我们得到什么:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kz"><img src="../Images/a5c35625b09f3282161d28c2919cda02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*m8pl5Le7hULhXlBU.png"/></div></div></figure><p id="8c96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如我们所见，我们从服务器获得了明文凭证。让我们看看对用户来说是什么样的:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi la"><img src="../Images/77d58056855f7e1907735ccaf0072868.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/0*13Lnpo7giyRSi6C5.png"/></div></figure><p id="6334" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为responder正在运行一个假的HTTP服务器，并且表现得像是在为网络提供代理，所以我们在机器上弹出了一个基本的身份验证框。大多数刚上班的人会不假思索地输入用户名/密码。这将导致在攻击过程中无法访问互联网。一旦我们取消，他们就可以像往常一样访问网络。这两种攻击都很容易补救。对于LLMNR，禁用TCP/IP上的NETBIOS。这将阻止Windows使用LLMNR协议查找共享。对于WPAD，禁止在IE上通过网络查找wpad配置文件。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="f063" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="li">关注</em> <a class="ae lj" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="li"> Infosec报道</em> </a> <em class="li">获取更多此类精彩报道。</em></p><div class="lk ll gp gr lm ln"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="lo ab fo"><div class="lp ab lq cl cj lr"><h2 class="bd ir gy z fp ls fr fs lt fu fw ip bi translated">信息安全报道</h2><div class="lu l"><h3 class="bd b gy z fp ls fr fs lt fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="lv l"><p class="bd b dl z fp ls fr fs lt fu fw dk translated">medium.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb kv ln"/></div></div></a></div></div></div>    
</body>
</html>