<html>
<head>
<title>Advent of Cyber 2022 [Day 16] Secure Coding | SQLi’s the king, the carolers sing | Simple Write up</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Cyber 2022的来临[第16天]安全编码| SQLi的国王，颂歌者歌唱|简单的写作</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/advent-of-cyber-2022-day-16-secure-coding-sqlis-the-king-the-carolers-sing-simple-write-up-1de37365eb94?source=collection_archive---------3-----------------------#2022-12-16">https://infosecwriteups.com/advent-of-cyber-2022-day-16-secure-coding-sqlis-the-king-the-carolers-sing-simple-write-up-1de37365eb94?source=collection_archive---------3-----------------------#2022-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a3ab" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">任务21答案—网络2022的来临[第16天]安全编码| SQLi的《国王，颂歌者歌唱》—由Karthikeyan Nagaraj撰写</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5fdf8778ad266a4a7ccc838742200509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MYUutL-NAUbHpVT4.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kr"><img src="../Images/c87161116a63dc74314ef8ba861e64b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gW3B4tSYglxO3R0MP5KT9Q.png"/></div></div></figure><p id="f766" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">通过添加您的机器IP-<a class="ae lo" href="http://10-10-207-106.p.thmlabs.com/" rel="noopener ugc nofollow" target="_blank">http://&lt;Machine-IP&gt;. p . thm labs . com/</a>打开链接</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lp"><img src="../Images/f42c092bafe67a1bcd0fbe9f36bf0be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLYI0YV499HGNFOZHseDxw.png"/></div></div></figure><p id="91a3" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">凭据:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/87f692ca828186a2f84f9c5d330ed1ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*cGlorv1_aPa6r_v2tri1dQ.png"/></div></figure><h1 id="3c00" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">任务21【第16天】<strong class="ak">安全编码</strong> SQLi的国王，颂歌者歌唱</h1><h2 id="4a76" class="mj ls iq bd lt mk ml dn lx mm mn dp mb lb mo mp md lf mq mr mf lj ms mt mh mu bi translated">1.Flag1的值是多少？</h2><blockquote class="mv mw mx"><p id="2d96" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated"><em class="iq">我们可以合理地假设网站期望发送一个整数</em><code class="fe nc nd ne nf b"><em class="iq">id</em></code><em class="iq"/></p><p id="a646" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated"><em class="iq">为了避免注入，我们可以将用户在id参数中输入的任何内容转换为整数。所以为此，我们将使用</em> <code class="fe nc nd ne nf b"><em class="iq">intval()</em></code> <em class="iq">功能。</em></p><p id="2003" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated">这个函数将获取一个字符串，并尝试将其转换成一个整数。如果在字符串上没有找到有效的整数，它将返回0，这也是一个整数让我们打开 <code class="fe nc nd ne nf b"><em class="iq">search-toys.php</em></code> <em class="iq">并改变参数</em></p></blockquote><pre class="kg kh ki kj gt ng nf nh bn ni nj bi"><span id="59a1" class="nk ls iq nf b be nl nm l nn no">Change the $_GET['id'] to intval($_GET['id']) Everywhere on the elf.php File</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/75fb394568069bd1d4db8462b3a384f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*zUoWVKyyxAyIERsO3g7-Jw.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/5ce9ae9d39beb7b0f48906ffc0fe4728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*uVkn5OtFnA0ZDrC0MaxVeQ.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/537d1940e4395a4bc49f15f225e8347f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4KxOEdIj-CiVRP5UvQcJFQ.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">运行检查</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/9bb21626046533e80f3243a392f9d0b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*G7dAZ-odt0hFiPLB7yRlcw.png"/></div></figure><pre class="kg kh ki kj gt ng nf nh bn ni nj bi"><span id="0eaf" class="nk ls iq nf b be nl nm l nn no">Ans: THM{McCode, Elf McCode}</span></pre><h2 id="7950" class="mj ls iq bd lt mk ml dn lx mm mn dp mb lb mo mp md lf mq mr mf lj ms mt mh mu bi translated">2.Flag2的值是多少？</h2><blockquote class="mv mw mx"><p id="931c" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated"><em class="iq">首先，我们将修改初始查询，用一个带问号的占位符(</em> <code class="fe nc nd ne nf b"><em class="iq">?</em></code> <em class="iq">)替换任何参数。</em></p><p id="5e86" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated">这将告诉数据库我们想要运行一个以两个参数作为输入的查询。然后查询将被传递给 <code class="fe nc nd ne nf b"><em class="iq">mysqli_prepare()</em></code> <em class="iq">函数，而不是我们通常的</em> <code class="fe nc nd ne nf b"><em class="iq">mysqli_query()</em></code> <em class="iq">。</em></p><p id="fc8c" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated"><code class="fe nc nd ne nf b"><em class="iq">mysqli_prepare()</em></code> <em class="iq">不会运行查询，但会指示数据库使用给定的语法准备查询。该函数将返回一个准备好的语句。</em></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/9bf0fc70692588bb45a84bce4ea2258a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9UuCS0tIlz0hyLwa-QUmTQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/68bdf277349f6d2ed233d0c0fdeddbea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYSMMOgi-gHv6zh4mPjw9Q.png"/></div></div></figure><blockquote class="mv mw mx"><p id="f86b" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated">MySQL需要知道我们之前定义的每个占位符的值。所以我们可以使用 <code class="fe nc nd ne nf b"><em class="iq">mysqli_stmt_bind_param()</em></code> <em class="iq">函数给每个占位符附加变量。</em></p><p id="65c1" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated"><em class="iq">该函数需要您发送2个函数参数！！</em></p><p id="f24c" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated"><em class="iq">第一个参数应该是对准备好的语句的引用，变量将绑定到该语句。</em></p><p id="c986" class="ks kt my ku b kv kw jr kx ky kz ju la mz lc ld le na lg lh li nb lk ll lm ln ij bi translated"><em class="iq">第二个参数是一个字符串，由每个要绑定的占位符的一个字母组成，其中字母表示每个变量的数据类型。因为我们要传递两个字符串，所以我们将</em> <code class="fe nc nd ne nf b"><em class="iq">"ss"</em></code> <em class="iq">放在第二个参数中，其中每个“s”代表一个字符串类型的变量。您也可以使用字母“I”表示整数，或“d”表示浮点数</em></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/15e17cec85dda3e9c662acc4a129999e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*XfXGUgg6J3TP2AU4TeEBvQ.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">最终代码如下所示</figcaption></figure><pre class="kg kh ki kj gt ng nf nh bn ni nj bi"><span id="7bc0" class="nk ls iq nf b be nl nm l nn no">$q = "%".$_GET['q']."%";<br/>$query="select * from toys where name like ? or description like ?";<br/>$stmt = mysqli_prepare($db, $query);<br/>mysqli_stmt_bind_param($stmt, 'ss', $q, $q);<br/>mysqli_stmt_execute($stmt);<br/>$toys_rs=mysqli_stmt_get_result($stmt);</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/588919bb83707025b3494e54b7158967.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*DqtVGa-HKQ9nWTnuxZzrJw.png"/></div></figure><pre class="kg kh ki kj gt ng nf nh bn ni nj bi"><span id="3b7e" class="nk ls iq nf b be nl nm l nn no">Ans: THM{KodeNRoll}</span></pre><h2 id="e073" class="mj ls iq bd lt mk ml dn lx mm mn dp mb lb mo mp md lf mq mr mf lj ms mt mh mu bi translated">3.Flag3的价值是什么？</h2><p id="6178" class="pw-post-body-paragraph ks kt iq ku b kv ob jr kx ky oc ju la lb od ld le lf oe lh li lj of ll lm ln ij bi translated">我们也必须改变toys.php的参数</p><p id="753b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">更改以下参数$ _ GET[' id ']；</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/e6fd48381d3daf053e8e440574afbd0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*suQD4R857Y7kh9k02UcvJw.png"/></div></figure><p id="a443" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">to intval($ _ GET[' id '])；在<strong class="ku ir">处处都有</strong>的toys.php文件</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/28e44efd92b7af8f43c72512724ed232.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*ZPN9ajlGVCBSqQI49HkfUA.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/baa3252ddca388962d3b31eebe3cd0de.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*5kf2L9vaB8Zj4q3HibhCdg.png"/></div></figure><pre class="kg kh ki kj gt ng nf nh bn ni nj bi"><span id="1cbe" class="nk ls iq nf b be nl nm l nn no">Ans: THM{Are we secure yet?}</span></pre><h2 id="b8e8" class="mj ls iq bd lt mk ml dn lx mm mn dp mb lb mo mp md lf mq mr mf lj ms mt mh mu bi translated">4.Flag4的价值是什么？</h2><p id="9b6a" class="pw-post-body-paragraph ks kt iq ku b kv ob jr kx ky oc ju la lb od ld le lf oe lh li lj of ll lm ln ij bi translated">添加带有问号(<code class="fe nc nd ne nf b">?</code>)占位符的用户名和密码参数，其余参数与我们在第2个问题中所做的相同，我们将用户名和密码参数添加到mysqli_stmt_bind_param方法并执行它！！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/5bc47cc7f55bb58abe60d0cce2914f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCAB0D81ZKbLlC0UACZRFw.png"/></div></div></figure><p id="5d28" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">把上面的代码修改成下面的代码！！</p><pre class="kg kh ki kj gt ng nf nh bn ni nj bi"><span id="b612" class="nk ls iq nf b be nl nm l nn no">&lt;?php<br/>require_once("connection.php");<br/>session_start();<br/><br/>if(isset($_POST['username']) &amp;&amp; isset($_POST['password'])){<br/> $username=$_POST['username'];<br/> $password=$_POST['password'];<br/> $query="select * from users where username=? and password=?";<br/> $stmt = mysqli_prepare($db, $query);<br/> mysqli_stmt_bind_param($stmt, 'ss', $username, $password);<br/> mysqli_stmt_execute($stmt);<br/> <br/> $users_rs=mysqli_stmt_get_result($stmt);</span></pre><p id="30fc" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">现在快跑。！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/593316dd84c080e54b9454aacdab2a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*v0H-Rinc8Vs158GdwuXWaA.png"/></div></figure><pre class="kg kh ki kj gt ng nf nh bn ni nj bi"><span id="7dff" class="nk ls iq nf b be nl nm l nn no">Ans: THM{SQLi_who???}</span></pre></div><div class="ab cl ol om hu on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ij ik il im in"><p id="8a78" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">感谢您的阅读！！</p><p id="8485" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">黑客快乐~</p><pre class="kg kh ki kj gt ng nf nh bn ni nj bi"><span id="8244" class="nk ls iq nf b be nl nm l nn no">Author: Karthikeyan Nagaraj ~ Cyberw1ng</span></pre><p id="ef54" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">查询:</p><p id="dd93" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">THM，TryHackMe，TryHackMe 2022年网络时代的到来，TryHackMe 2022年网络时代的到来第4天第16课，道德黑客，写，走过，TryHackMe 2022年网络时代的到来第16天答案</p></div><div class="ab cl ol om hu on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="ij ik il im in"><h2 id="38c7" class="mj ls iq bd lt mk ml dn lx mm mn dp mb lb mo mp md lf mq mr mf lj ms mt mh mu bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lo" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>