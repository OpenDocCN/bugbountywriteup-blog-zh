<html>
<head>
<title>Why WordPress should abandon Old PHP Password encryption algorithms.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么WordPress应该放弃旧的PHP密码加密算法。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/why-wordpress-should-abandon-old-php-password-encryption-algorithms-ca3afa23e013?source=collection_archive---------4-----------------------#2022-12-19">https://infosecwriteups.com/why-wordpress-should-abandon-old-php-password-encryption-algorithms-ca3afa23e013?source=collection_archive---------4-----------------------#2022-12-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="977a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为一个硬化问题，可以公开讨论。</p><p id="d516" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">事实上，这个问题已经被公开讨论了很多年:</p><p id="32fd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://core.trac.wordpress.org/ticket/50027" rel="noopener ugc nofollow" target="_blank">https://core.trac.wordpress.org/ticket/50027</a></p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="4ae9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">WordPress使用可移植的php密码哈希框架，它使用bcrypt哈希算法等等，所以密码加密包括PHP函数调用password_hash脚本，使用PASSWORD_BCRYPT或PASSWORD_ARGON2I或PASSWORD_DEFAULT，最常见的是password_default作为单向哈希算法。</p><blockquote class="kt ku kv"><p id="026e" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">然而，如果一个攻击者破坏了一个数据库并导航到wordpress密码，这些密码是加密的，他/她找不到原始密码，这意味着他无论如何也不能登录wordpress网站。但如果他是从后往前做的呢？如果他设法使用自己的密码访问网站，并在密码发布或泄露中，他会发布他想要的真实用户名和密码(大多数情况下他会随机进行)，组合在wordpress登录中工作，从而“以某种方式”绕过使用php的wordpress加密算法。</p></blockquote><h1 id="4389" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">让我们快速简单地重现一下，解释一下:</h1><ol class=""><li id="fc87" class="ly lz iq jw b jx ma kb mb kf mc kj md kn me kr mf mg mh mi bi translated">创建网站/子域</li></ol><ul class=""><li id="4cef" class="ly lz iq jw b jx jy kb kc kf mj kj mk kn ml kr mm mg mh mi bi translated">例如:example.com现在做一个wordpress安装在example.com的根文件夹或子域。</li><li id="5bc2" class="ly lz iq jw b jx mn kb mo kf mp kj mq kn mr kr mm mg mh mi bi translated">自动创建了一个新用户(管理员),这次使用的用户名不是很常见，也很复杂。</li><li id="d895" class="ly lz iq jw b jx mn kb mo kf mp kj mq kn mr kr mm mg mh mi bi translated">比方说:<code class="fe ms mt mu mv b">admin_vzyog96</code>我的wordpress安装程序分配给我的。现在，新用户也有一个密码:我被分配了密码:<code class="fe ms mt mu mv b">pePi7TEmp3o$ez8o</code>，它在数据库中的加密版本是:<code class="fe ms mt mu mv b">$P$B.f9pHoT7fKNuCadbF8x3pGoe60tis1</code></li></ul><p id="aec3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在转到数据库，其中列出了用户:一个新安装的用户，作为一个攻击者访问数据库，我必须保持访问持续的数据提取，否则可能会发生数据泄露或勒索等。但是怎么做呢？因为存储的密码是单向散列的？</p><ul class=""><li id="b594" class="ly lz iq jw b jx jy kb kc kf mj kj mk kn ml kr mm mg mh mi bi translated">通过逆向计算得出。</li></ul><ol class=""><li id="b4ba" class="ly lz iq jw b jx jy kb kc kf mj kj mk kn ml kr mf mg mh mi bi translated">使用下面的简单PHP脚本生成一个随机密码:</li></ol><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="92ad" class="ne lb iq mv b be nf ng l nh ni">&lt;?php<br/><br/>// Get the new attacker password<br/>$password = 'mypassword';<br/><br/>// Generate the hash<br/> <br/>$hash = password_hash($password, PASSWORD_DEFAULT);<br/><br/>// Display hashed password to use<br/>echo $hash;<br/><br/>?&gt;</span></pre><p id="c3d0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我得到的密码是:<code class="fe ms mt mu mv b">$2y$10$k2JDEx4b8aI6rmFM942Inuy9./CazL1Dr3Pu9Qcl90W3zaJcq4q/e</code> 5。现在复制它，转到数据库并直接编辑密码(大多数数据库，sql，允许通过双击密码值字段进行编辑)。粘贴新密码；记住原来的是:<code class="fe ms mt mu mv b">mypassword</code></p><ol class=""><li id="5509" class="ly lz iq jw b jx jy kb kc kf mj kj mk kn ml kr mf mg mh mi bi translated">现在转到你网站的wordpress admin登录URL:ie。example.com/wp-admin使用从一开始分配的用户名:<code class="fe ms mt mu mv b">admin_vzyog96</code>和您生成的新密码<code class="fe ms mt mu mv b">$2y$10$k2JDEx4b8aI6rmFM942Inuy9./CazL1Dr3Pu9Qcl90W3zaJcq4q/e</code>。密码让你登录。作为攻击者，我现在可以拥有用户名:<code class="fe ms mt mu mv b">admin_vzyog96</code>和密码:<code class="fe ms mt mu mv b">$2y$10$k2JDEx4b8aI6rmFM942Inuy9./CazL1Dr3Pu9Qcl90W3zaJcq4q/e</code>，并且可以随心所欲地使用这些数据，现在我拥有了完整的登录组合集。</li></ol><p id="d63f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这算什么问题？？</p><blockquote class="kt ku kv"><p id="925d" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq">最初作为攻击者，我无法登录WordPress，因为我没有原始密码，我也无法仅用用户名和单向散列密码做任何事情，但现在我有了这两个密码，它们可以工作了。</em></p></blockquote><p id="69ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这很容易做到。</p><blockquote class="kt ku kv"><p id="48f4" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">有人可能也不知道受害者(考虑到wordpress基本上需要拖放知识和一点创造力)知道数据库受损的唯一方法是使用WordPress工具包的自动登录，这主要来自cpanel，而不是所有的WHM服务提供商。并不是所有的wordpress站点都用这个工具包来处理登录。</p></blockquote><p id="9ab7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我意识到MD5散列也可以代替WordPress散列密码，并且仍然认证，因为<code class="fe ms mt mu mv b">wp_includes/pluggable.php</code>将仍然处理MD5并加密，然后与数据库进行比较，没有任何错误，这意味着没有来自默认PHP密码散列框架的特殊密钥/安全性。</p><p id="0da6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这怎么证明不是php的特性呢？？</p><p id="71b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">试试crypt，一种使用php和密钥的散列算法:</p><pre class="mw mx my mz gt na mv nb bn nc nd bi"><span id="eea9" class="ne lb iq mv b be nf ng l nh ni">&lt;?php<br/><br/>// Get the password from the user<br/>$password = 'mypassword';<br/>$key = "khgfewtyui89283764treyduhjzksjahdgfret6738q29iojashdgftye7w8q9ioakjshdgfyrew8uioqwuehgyrfyewuiqouehgdfeyw78q9iowue8y7648392qiowushdgfshajk";<br/><br/>// Generate the hash<br/>$hash = crypt($password, $key);<br/><br/>// Print the hash to the screen<br/>echo $hash;<br/>?&gt;</span></pre><p id="08e6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">登录不起作用，无论您复制多少密码，哈希都不会被破解，攻击者只有无用的哈希密码和用户名。这是为什么呢？因为wordpress安装现在没有crypt密钥，并且角色互换，如果wordpress安装有密钥，而攻击者没有…他将永远无法生成密码散列。</p><blockquote class="kt ku kv"><p id="2c71" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">由此，我相信你理解了迄今为止所有WordPress版本密码加密不足背后的逻辑。</p></blockquote><h1 id="d793" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">建议</h1><blockquote class="kt ku kv"><p id="7e64" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq">也许WordPress DevOps团队应该考虑crypt或比crypt更好的密码哈希算法，因为它比当前WordPress版本中使用的密码哈希算法更安全，因为md5复制相同的密码，至于密钥，可以通过MD5或任何其他加密算法生成，以根据安装情况分配不同的密钥</em></p></blockquote><p id="387e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我相信，考虑到在新的场景中，攻击者不能以任何方式复制散列或向数据库添加任何散列，因为他的散列在与数据库中的散列字符串进行比较之前不会绕过密码散列中的crypt密钥，所以这将解决问题。crypt密钥是不能被绕过的，正如我提到的，为wordpress的所有新安装考虑一个随机的已经加密的密钥，这样没有两个安装共享相同的密钥，或者没有人复制安全密钥的随机分配。</p><blockquote class="kt ku kv"><p id="d280" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated"><em class="iq">我在WordPress 6.1.1上试过这个，意思是到目前为止所有的WordPress版本都受到这个问题的影响</em></p></blockquote><h1 id="a3ad" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">这能证明有什么安全影响吗？</h1><p id="146d" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf nj kh ki kj nk kl km kn nl kp kq kr ij bi translated">密码加密强度不足导致(但不限于):</p><ol class=""><li id="af2d" class="ly lz iq jw b jx jy kb kc kf mj kj mk kn ml kr mf mg mh mi bi translated">随着攻击者可以随意维护受害者数据库中的访问权限，攻击不断增加。</li><li id="27b8" class="ly lz iq jw b jx mn kb mo kf mp kj mq kn mr kr mf mg mh mi bi translated">所有wordpress安装都容易被接管，所有版本都容易被接管，因为我称之为“从后到前”的哈希和方法在wordpress的所有版本中都是可复制的，并且再次绕过了在数据库中存储“安全”密码的加密。这基本上是为了在入侵后阻止攻击者或在访问后修改凭据，但现在不再是这样了。</li><li id="49c4" class="ly lz iq jw b jx mn kb mo kf mp kj mq kn mr kr mf mg mh mi bi translated">攻击者现在可以用他们自己的密码组合来发布wordpress泄露的数据库，他们可以将密码更改为任何值，并且新值可以正确验证。</li></ol><ul class=""><li id="29c1" class="ly lz iq jw b jx jy kb kc kf mj kj mk kn ml kr mm mg mh mi bi translated">如果密码没有充分加密，个人信息(如姓名、地址和财务信息)可能会面临被未经授权的个人访问的风险，这些人现在可以设置任何密码，并根据自己的意愿保持访问。当某人的个人信息被用于实施欺诈或其他犯罪时，身份盗窃也会发生。机密信息的丢失:如果密码没有正确加密，未经授权的个人就有可能访问和泄露机密业务信息，从而导致潜在的财务损失和公司声誉受损</li></ul><p id="49d5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">旧的php加密已经存在了太长时间，攻击者已经掌握了利用它的艺术，开发者和WordPress社区仍然在争论它是否应该改变，或者有一个更好的加密算法，当然是基于php的。</p><blockquote class="kt ku kv"><p id="fd5e" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">有许多想法，但总的来说，关键是:是时候改进密码加密了</p></blockquote></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><figure class="mw mx my mz gt nn gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nm"><img src="../Images/a2ecd66079c11b33cfe5e595c2a5c6f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uv_lkAtxtk8A1_6h"/></div></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk translated">斯蒂芬·菲利普斯-Hostreviews.co.uk在<a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片<a class="ae ks" href="https://unsplash.com/@hostreviews?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure></div></div>    
</body>
</html>