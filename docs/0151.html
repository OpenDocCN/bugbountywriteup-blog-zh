<html>
<head>
<title>WhiteHat Grand Prix 2018 Quals Writeup — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">怀特哈特大奖赛2018年质量报告-第2部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/whitehat-grand-prix-2018-quals-writeup-part-2-4da3c66526cc?source=collection_archive---------0-----------------------#2018-08-26">https://infosecwriteups.com/whitehat-grand-prix-2018-quals-writeup-part-2-4da3c66526cc?source=collection_archive---------0-----------------------#2018-08-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c5cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">世界协调时+2时间2018年8月23日下午14:34</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/87c58721a79a61c68336429a855e07ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P4xix_v4MC9Vn0LI5tLtcQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">怀特哈特大奖赛2018年质量报告-第2部分</figcaption></figure><p id="54b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个故事中，我将讲述我是如何在怀特哈特大奖赛CTF站解决我的第一个任务的。虽然我花了很长时间去分析和理解它，但这是一个简单的任务。</p><p id="0847" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基于动态评分，因为来不及解出，我最后才得了100分。</p><h1 id="16b0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">re01</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/5adf13c28047620ca61f3a9911f48937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*Rw7To9ELcaSEI-To1QmXhQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">re01挑战赛</figcaption></figure><blockquote class="ma mb mc"><p id="76bc" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated"><strong class="jp ir">挑战:</strong>【material.grandprix.whitehatvn.com/re01】T2</p></blockquote><p id="931c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是逆向工程的挑战；为了找到隐藏的标志，我们必须反转二进制:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/2f60741b568526e7de6079a87789906f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*i_PL1fdO1tp5xup8Z0is9A.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">WhiteHat.exe</figcaption></figure><p id="d9b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">二进制文件是win32 GUI (PE ),其中有许多二进制文件；让我们使用<a class="ae mh" href="https://www.nirsoft.net/utils/resources_extract.html" rel="noopener ugc nofollow" target="_blank">资源提取</a>来提取它们:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/2539f37f310e4a330a940dbd0b1fdf0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*byo-OCM1T_rMfkQbqRUJKw.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">PEiD—WhiteHat.exe</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/771cbe33e96c29e65a96684ba52c1b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZad8h4PRWX7vIQvuz9zbg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">资源提取—WhiteHat.exe</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/0cb480b3ba376612b2893c731308d93d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8bs-lyueVsAZA_5jlqcug.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">从WhiteHat.exe提取的文件</figcaption></figure><p id="60f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过长时间使用ida pro分析，似乎主要功能是<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re01/sub_40111D.c" rel="noopener ugc nofollow" target="_blank"> <em class="md"> sub_40111D </em> </a>:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re01/sub_40111D.c" rel="noopener ugc nofollow" target="_blank"><em class="mo">sub _ 40111d</em></a><em class="mo">。c </em></figcaption></figure><p id="2c98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有两个有趣的文件，b.dll和There，加载并保存到There的第一个SYS资源。第二个系统资源已加载并存储到b.dll中。然后在最后一步，2.exe被处决了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mp"><img src="../Images/4b2ed962f6d800a50096177a66d4a3d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n4sOE037OLso2cfwk7YzpA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">IDA Pro 中<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re01/sub_40111D.c" rel="noopener ugc nofollow" target="_blank"><em class="mo">sub _ 40111d</em></a><em class="mo">功能的一部分</em></figcaption></figure><p id="0de9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么在这两个过程中都有一个XOR运算:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/cd370eb3ab65b2b82506faaff8b7126a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*abk9i5DBDO59Z9_QmTdWMQ.png"/></div></div></figure><p id="04ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们在这里的目标是找到隐藏的标志，它将在文件和密钥之间的xor结果中，文件是SYS资源，而密钥是一个未知的字节。我们从给定的二进制文件中提取了系统资源:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/32fe7b10dfe02579eb562ca175bce972.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*CYrkICOSpvDaPPByajZE4g.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">系统资源文件</figcaption></figure><p id="56dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们找到用于对系统资源进行XOR运算的确切密钥，我们必须知道字节的范围(可能性),以使用该范围的值对系统资源进行强制XOR运算。</p><blockquote class="ms"><p id="371a" class="mt mu iq bd mv mw mx my mz na nb kk dk translated">(1) =&gt; *(&amp;sys1 + i) ^=键—48；用0 &lt;= i &lt; 36</p><p id="a041" class="mt mu iq bd mv mw mx my mz na nb kk dk translated">So: key = i + 48 then: 48 &lt;= key &lt; 84</p><p id="c41d" class="mt mu iq bd mv mw mx my mz na nb kk dk translated">(2) =&gt; sys2[j] ^=键—47；其中0 &lt;= j &lt; 11</p><p id="e25e" class="mt mu iq bd mv mw mx my mz na nb kk dk translated">所以:key = i + 47那么:47 &lt;= key &lt; 58</p><p id="85a1" class="mt mu iq bd mv mw mx my mz na nb kk dk">*** *** *** *** *** *** *** *** *** *** *** ***</p><p id="3b7f" class="mt mu iq bd mv mw mx my mz na nb kk dk translated">从(1)和(2)我们得到:</p><p id="2ef8" class="mt mu iq bd mv mw mx my mz na nb kk dk translated">48 &lt;=键&lt; 58</p></blockquote><p id="eb76" class="pw-post-body-paragraph jn jo iq jp b jq nc js jt ju nd jw jx jy ne ka kb kc nf ke kf kg ng ki kj kk ij bi translated">让我们使用这个范围来强制执行xor密钥，并用这个密钥对系统资源进行XOR运算:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">re01.py</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/dc81d3ebface239bd3041033bc89e109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgpW6yZU6qch8o8htoR6sQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">re01.py输出(结果)</figcaption></figure><p id="93cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们把这些文件归档:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/6ec07fe83de0d7647e3bc9dd23d21ba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*qbW3Zv392Aqt4ZDNq0EfCQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">文件*</figcaption></figure><p id="13ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，有两个有趣的PNG文件:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/698a993a2c2821ace1cbdced12dcf639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*gZaWaohT5LA_EmFvanjQ_g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">PNG文件</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/27f0ed3fa9bb4c2c8870807cb66d5c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BvUGCd7kb0ImgDYANqYtaw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">显示res2_54.png(第一个png文件)</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/995317e21a37dba58bd3b5f603aa9b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GELUtMvXrdvyDqH41byoFQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">显示res5_54.png(第二个png文件)</figcaption></figure><p id="4022" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re01/res2_54.png" rel="noopener ugc nofollow" target="_blank"> res2_54.png </a>和<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re01/res5_54.png" rel="noopener ugc nofollow" target="_blank">res5 _ 54 . png</a>；key和SYS文件之间xor运算的两个结果，SYS文件是我们的SYS文件列表中的第<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re01/WhiteHat_138_SYS1.bin" rel="noopener ugc nofollow" target="_blank">第2</a>和第<a class="ae mh" href="https://github.com/Abdelkad3r/CTF/blob/master/WhiteHat%20Grand%20Prix%202018%20-%20Quals/re01/WhiteHat_30721_5.bin" rel="noopener ugc nofollow" target="_blank">第5</a>个文件:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/59f5a09b77272c79c6111eb7f7fd2437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*H339pKtmFW-ab6b7hGKh2g.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">系统资源文件，该文件在与键异或后给出PNG文件</figcaption></figure><blockquote class="ma mb mc"><p id="4fa1" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated"><strong class="jp ir">旗是:今天是好日子</strong></p></blockquote><p id="1dd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们制作正确的提交标志:<strong class="jp ir"> WhiteHat{sha1(flag)} </strong></p><blockquote class="ma mb mc"><p id="167f" class="jn jo md jp b jq jr js jt ju jv jw jx me jz ka kb mf kd ke kf mg kh ki kj kk ij bi translated">标志为:<strong class="jp ir">怀特哈特{ 9e 9453 a 6 ad 4 c 8 c 31 c 599 C4 a 4233027 b 6d 43 CDA 17 }</strong></p></blockquote><p id="3746" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个挑战是一个很好的逆向工程挑战，展示了我们如何使用XOR隐藏文件。查看我的最后一篇文章<a class="ae mh" href="https://medium.com/@Abdelkad3r/whitehat-grand-prix-2018-quals-writeup-part-1-f299f9126bbb" rel="noopener"> <strong class="jp ir">怀特哈特大奖赛2018 Quals Writeup —第1部分</strong> </a> <strong class="jp ir"> </strong>并享受阅读。</p></div></div>    
</body>
</html>