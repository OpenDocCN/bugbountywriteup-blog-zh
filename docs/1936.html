<html>
<head>
<title>Uncovering Digital Evidence: A Guide to Investigating Physical Hard Drives for Criminal Investigations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭露数字证据:刑事调查用物理硬盘调查指南</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hard-drive-forensics-7e5ffd6036fd?source=collection_archive---------0-----------------------#2022-03-10">https://infosecwriteups.com/hard-drive-forensics-7e5ffd6036fd?source=collection_archive---------0-----------------------#2022-03-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="bd91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">想象一下，你有一个硬盘，你需要检查刑事调查。就像处理所有证据一样，你需要非常小心地检查它，使用正确的工具，因为不恰当的方法会破坏它，使它变得无用。这篇文章是关于如何处理数字证据，特别是对物理硬盘的调查，而类似的方法也适用于其他存储设备。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/46d5c9433d1c31e96271c4162f55f7cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zZ_VMCudho7CEpNz.jpg"/></div></div></figure><p id="a6b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总结以下部分，我将向您展示如何:</p><ul class=""><li id="6260" class="la lb it js b jt ju jx jy kb lc kf ld kj le kn lf lg lh li bi translated">制作磁盘的副本</li><li id="f3bd" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">将磁盘映像绑定到块设备</li><li id="8040" class="la lb it js b jt lj jx lk kb ll kf lm kj ln kn lf lg lh li bi translated">在<a class="ae lo" href="https://libguestfs.org/" rel="noopener ugc nofollow" target="_blank"> libguestfs </a>中挂载并检查它</li></ul><p id="ad94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将在我的Linux Ubuntu机器上使用终端。如果你目前运行的是Windows，给自己设置一个虚拟机，安装你喜欢的任何Linux操作系统发行版——Ubuntu、Xubuntu和Debian应该可以，但是还有很多其他的软件也可以完成这项工作。</p><h2 id="f096" class="lp lq it bd lr ls lt dn lu lv lw dp lx kb ly lz ma kf mb mc md kj me mf mg mh bi translated">磁盘拷贝</h2><p id="c7ae" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">假设我们有一个存有数字证据的硬盘。我们需要做的第一件也是最重要的事情是将硬盘驱动器的完整副本制作成磁盘映像。为什么？嗯，我们几乎总是希望<strong class="js iu">对拷贝进行调查，因此如果出现任何问题(文件系统损坏)，原始文件仍然完好无损</strong>，我们可以从头开始。</p><p id="a3f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，当您将硬盘插入PC时，您应该能够在/dev目录下看到一个新的块设备:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="7599" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">ls -l /dev</strong></span></pre><p id="5711" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦你确定了它是哪一个，你可以通过使用<strong class="js iu"> cat </strong>或<a class="ae lo" href="https://www.geeksforgeeks.org/dd-command-linux/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> dd </strong> </a>命令来创建它的完整副本:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="f49c" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">cat /dev/&lt;your-device&gt; &gt; disk_image.raw</strong></span><span id="b1dd" class="lp lq it mo b gy mw mt l mu mv"># or</span><span id="0111" class="lp lq it mo b gy mw mt l mu mv"><strong class="mo iu">dd if=/dev/&lt;your-device&gt; of=disk_image.raw</strong></span></pre><p id="2814" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，您的主机(或VM)上应该有足够的内存空间，因为这些文件可能会变得很大，达到物理驱动器的大小。一旦命令完成，您现在就有了一个物理驱动器的完整副本，它存储在一个<strong class="js iu"> disk_image.raw </strong>文件中，稍后我将把它称为<strong class="js iu">磁盘映像(文件)</strong>。</p><h2 id="542c" class="lp lq it bd lr ls lt dn lu lv lw dp lx kb ly lz ma kf mb mc md kj me mf mg mh bi translated">绑定到块设备</h2><p id="31e6" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">对于磁盘映像，通常的做法是将它连接到一个块设备，挂载它，并检查它上面的文件系统。这种方法有什么问题？问题是<strong class="js iu">你对数字证据执行的每一个可能会修改它的操作都需要被记录或者被很好地记录并可重复，这样检察官就可以执行相同的操作并以相同的结果结束</strong>。</p><p id="aed7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好吧，但是为什么他能做到我上面提到的步骤呢？嗯，因为我们的电脑或任何你用来检查磁盘的硬件有时试图表现得有点太聪明了(显然是为了让我们的生活更容易)。让我们看看我的意思是什么。</p><p id="6eb3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我有一些文件<strong class="js iu"> disk_image.raw </strong>，我将对其进行检查。下面的命令是:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="92ed" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">modprobe nbd</strong> # Load the nbd module into kernel and create block devices</span><span id="af59" class="lp lq it mo b gy mw mt l mu mv"><strong class="mo iu">ls -l /dev/nbd*</strong> # List NBD devices</span><span id="4686" class="lp lq it mo b gy mw mt l mu mv"><strong class="mo iu">apt install qemu-utils</strong> # Install QEMU tool</span><span id="34d6" class="lp lq it mo b gy mw mt l mu mv"><strong class="mo iu">qemu-nbd -f raw -c /dev/nbdX disk_image.raw </strong># Connect .raw image to device</span><span id="83a7" class="lp lq it mo b gy mw mt l mu mv"><strong class="mo iu">lsblk </strong># Check available partitions on /dev/nbdX</span></pre><p id="5549" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们所做的一切都正确的话，块设备(文件)和磁盘映像应该还是一样的(如果你现在不相信，以后你会明白的)。</p><p id="af6c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过计算两者的散列来检查相等性:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="a42c" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">md5sum /dev/&lt;device-name&gt;</strong> <strong class="mo iu">disk_image.raw</strong></span></pre><p id="77be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">怎么了?为什么哈希值不同？我必须承认，有可能在你的情况下散列是相等的，你完全没问题，但是让我们暂时想象一下不是这样，因为这是新手经常犯的错误。</p><p id="4ff8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你没有做错任何事，但是你的操作系统“在幕后”做错了。当您将磁盘映像连接到文件时，操作系统开始自动检测分区，例如，如果它发现任何损坏的分区，它会尝试重建它们，LVM分区(如果存在)会自动合并到卷组和逻辑分区中，从而更改上次安装的时间，等等。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/dda6b4ae4ef1ba02fa12cbd8ee1afb86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*OOffziLN9cdYuiHTJOqbew.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">操作系统自动修复磁盘映像</figcaption></figure><p id="2132" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但如果你想正确的做法医调查，这不是你想要的。请记住，对证据(磁盘映像)执行的所有操作都需要记录或详细记录，并且是可重复的。如果我们让操作系统去做它的事情，就不能保证它会在所有机器上同样地处理它——换句话说，对证据的操作需要手动执行，任何后台的高级操作都是不希望的。</p><p id="409b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如何才能在“幕后”阻止这种行为？你应该<strong class="js iu">在一个最小的操作系统发行版上运行所有你确定没有你的批准不会自动执行的操作，或者你应该确保所有与LVM、RAID相关的服务都应该被禁用/停止</strong>。根据您的设置，做您喜欢的任何事情，我在我的电脑上禁用服务(如果您也这样做，请查找诸如md*、lvm2*之类的短语)。</p><p id="69b0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦你认为，你得到了它的权利，重新验证它通过计算哈希，如我们上面所做的，如果他们匹配你可以继续进行。</p><p id="eb25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，如果您有一些不同的磁盘映像文件格式，您总是可以将其转换为其他类型。比如从。vdi至。原始格式:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="f8af" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">qemu-img convert -f vdi -O raw disk_image.vdi disk_image.raw</strong></span></pre><p id="84a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这一步将改变磁盘映像散列，但这样做完全没问题，因为您可以记录它，检察官可以重复它并得到相同的结果。</p><p id="d971" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到目前为止，我们已经将磁盘映像绑定到了一个块设备，但是我们仍然需要挂载它才能看到文件系统。尽管这次行动看起来很无辜，但事实并非总是如此。</p><h2 id="31c3" class="lp lq it bd lr ls lt dn lu lv lw dp lx kb ly lz ma kf mb mc md kj me mf mg mh bi translated">安装在libguestfs内部</h2><p id="6c4c" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">可能发生的一个相当荒谬的情况是，磁盘映像上可能存储了一些<strong class="js iu">恶意代码，一旦你安装了它，它就会运行并损坏你的PC </strong>。我们如何防止这种情况发生，或者至少确保我们的主机操作系统完好无损？一种解决方案是创建一个虚拟机，并在其中运行所有操作，如果发生恶意事件，只有您的虚拟机会被破坏。这种方法一切都很好，但我认为对于我们试图实现的目标来说，这有点矫枉过正。我更喜欢使用<strong class="js iu"> libguestfs </strong> CLI工具，这是一个小的虚拟机，但你可以更快地设置它，并在出现故障时重启它(很像虚拟机与Docker引导时间，如果你知道我的意思)。</p><p id="0932" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们安装它:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="e7a5" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">apt install libguestfs-tools libvirt</strong></span></pre><p id="6c5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我们可以通过键入以下命令来检查我们的磁盘映像:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="c291" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">guestfish -a disk_image.raw</strong></span></pre><p id="87f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，在终端中模拟的一个小虚拟机应该启动了。要开始使用它，请键入:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="adf3" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">&gt;&lt;fs&gt; run </strong># &gt;&lt;fs&gt; is the prefix in terminal you should able to see</span></pre><p id="840c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">命令完成后，您应该能够使用以下命令列出块设备的文件系统(和类型):</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="4e7e" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">list-filesystems</strong></span></pre><p id="67bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要检查它们中的每一个，请在root下分别挂载它们(因为libguestfs虚拟机默认没有根文件系统):</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="c764" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">mount &lt;file-system&gt; /</strong></span></pre><p id="5bf0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，您可以使用以下命令列出文件:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="125d" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">ls /</strong></span></pre><p id="f19a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<strong class="js iu"> libguestfs </strong> UI中的一些动作非常乏味，它给你的感觉不像标准终端。我可能有点奇怪，但是如果您同意我的观点，您可以使用下面的命令挂载具有与guestfish相同功能的映像，只不过您是在相同的命令行环境中使用<a class="ae lo" href="https://libguestfs.org/guestmount.1.html" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> guestmount </strong> </a>进行操作:</p><pre class="kp kq kr ks gt mn mo mp mq aw mr bi"><span id="5f31" class="lp lq it mo b gy ms mt l mu mv"><strong class="mo iu">guestmount -a &lt;disk-image&gt; -m &lt;device&gt; &lt;mountpoint&gt;</strong></span></pre><p id="21fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是所有的乡亲。在接下来的文章中，我打算写一些关于研究Windows文件系统的内容，所以请继续关注，我会有更多的内容与你分享。</p><blockquote class="nc"><p id="bcb6" class="nd ne it bd nf ng nh ni nj nk nl kn dk translated">感谢阅读！:)如果你喜欢这篇文章，点击下面的按钮👏</p><p id="0f39" class="nd ne it bd nf ng nh ni nj nk nl kn dk translated">对我来说意义重大，也有助于其他人了解这个故事。在Instagram上打招呼</p><p id="fd50" class="nd ne it bd nf ng nh ni nj nk nl kn dk translated">是否要开始使用Medium？使用此<a class="ae lo" href="https://medium.com/@tp4348/membership" rel="noopener">推荐链接</a>🔗</p><p id="8807" class="nd ne it bd nf ng nh ni nj nk nl kn dk translated">如果你喜欢我的帖子，你可以<a class="ae lo" href="https://www.buymeacoffee.com/tp4348" rel="noopener ugc nofollow" target="_blank">给我买个热狗</a>🌭</p><p id="72f7" class="nd ne it bd nf ng nh ni nj nk nl kn dk translated">关注我更多相关内容，干杯！</p></blockquote></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="78ea" class="lp lq it bd lr ls lt dn lu lv lw dp lx kb ly lz ma kf mb mc md kj me mf mg mh bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lo" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>