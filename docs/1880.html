<html>
<head>
<title>A tale of 0-Click Account Takeover and 2FA Bypass.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个0-Click账户接管和2FA旁路的故事。</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/a-tale-of-0-click-account-takeover-and-2fa-bypass-b369cd70e42f?source=collection_archive---------0-----------------------#2022-02-12">https://infosecwriteups.com/a-tale-of-0-click-account-takeover-and-2fa-bypass-b369cd70e42f?source=collection_archive---------0-----------------------#2022-02-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="16ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">哎，好久没发表bug赏金特写了。我当时在实习期。所以，我有很多空闲时间。不管怎样，这篇文章是关于0点击账户接管和2FA旁路的。让我们开始吧。为了NDA我们假设</em></strong><a class="ae km" href="https://target.com" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl"/></strong></a><strong class="jp ir"><em class="kl">是目标。</em>T13】</strong></p><p id="4ce4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">帐户接管:</strong> <br/> -我开始测试做一些基本的事情，比如改变主机头，看看我是否可以暴力破解令牌，但似乎没有什么工作……(我不久前写了一篇文章，介绍了我测试密码重置功能的方法:<a class="ae km" href="https://medium.com/@fatnassifiras45/how-i-was-able-to-take-over-any-account-via-the-password-reset-functionality-ef1659f8b481" rel="noopener">https://medium . com/@ fatnassifaris 45/how-I-was-able-to-take-over-any-Account-via-the-password-reset-functional-ef 1659 F8 b481</a>)。<br/> -获取密码重置链接的请求如下所示:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/75c01cf7ab6d6dea4edcdb50b066b865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l9v_28QvSK0EkiBEm6x5cg.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">密码重置请求。</figcaption></figure><ul class=""><li id="d55c" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated">正如你所看到的，<strong class="jp ir"> <em class="kl">电子邮件</em> </strong>在一个名为<strong class="jp ir"> <em class="kl">电子邮件</em> </strong>的参数中使用JSON格式被发送到服务器，所以，我想如果我把那个参数的类型从<strong class="jp ir">字符串</strong>改为<strong class="jp ir">数组</strong>会怎么样。所以就会是这样:<strong class="jp ir">《电子邮件》:【】</strong><a class="ae km" href="mailto:my1stEmail1@gmail.com" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">my1stEmail1@gmail.com</strong></a><strong class="jp ir">，</strong><a class="ae km" href="mailto:my2ndEmail@gmail.com" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">my2ndEmail@gmail.com</strong></a><strong class="jp ir"/>。将请求主体更改为有效负载，发送请求，检查我的电子邮件，幸运的是，我收到了两个帐户的密码重置链接。</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lm"><img src="../Images/4fb49ed6b9228796d3ad1f9ec7da177b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qzLtvIOx_88AGt6S6ST9dA.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">将电子邮件从字符串改为数组。</figcaption></figure><p id="1497" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">攻击场景:</em> </strong></p><ul class=""><li id="5891" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated">攻击者请求密码重置链接，拦截该请求，并将电子邮件参数值更改为["<a class="ae km" href="mailto:victim@gmail.com" rel="noopener ugc nofollow" target="_blank">victim@gmail.com</a>"，"<a class="ae km" href="mailto:attacker@gmail.com" rel="noopener ugc nofollow" target="_blank">attacker@gmail.com</a>"]</li><li id="a710" class="ld le iq jp b jq ln ju lo jy lp kc lq kg lr kk li lj lk ll bi translated">密码重置链接将被发送到受害者和攻击者的电子邮件帐户，因此攻击者可以使用它并更改受害者的密码。</li></ul><p id="7ff1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我做了一个概念验证，报告了这个问题，看到来自triager的这样一条消息让我高兴不已:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ls"><img src="../Images/be4865478b7902cde8a7fdc540ba9523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-EmjDy1_mh7W8eJHjnza2w.png"/></div></div></figure><p id="c46d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2FA旁路:</strong><br/>——现在，转到2FA机构。在这里，我使用google authenticator应用程序在我的帐户上启用了2FA。是的，谷歌认证应用程序，所以代码将是<strong class="jp ir"> 6位数</strong> <em class="kl">(一百万种可能性)</em>这将需要相当长的时间来蛮力。此外，不要忘记速率限制，谷歌认证每60秒左右改变代码。我放弃了暴力，因为这在逻辑上是不可能的。并进入<strong class="jp ir">登录</strong>页面，放入我的<strong class="jp ir">凭证</strong>并拦截登录请求，以正确理解<strong class="jp ir">2FA</strong>T15】机制并测试几项内容，包括:</p><ul class=""><li id="b15f" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated">响应操作(例如，将参数值从假更改为真→“成功”:“真”。</li><li id="ee3d" class="ld le iq jp b jq ln ju lo jy lp kc lq kg lr kk li lj lk ll bi translated">强制浏览(身份验证后直接进入新选项卡中的仪表板页面。)</li><li id="bc38" class="ld le iq jp b jq ln ju lo jy lp kc lq kg lr kk li lj lk ll bi translated">代码泄漏响应。</li><li id="e995" class="ld le iq jp b jq ln ju lo jy lp kc lq kg lr kk li lj lk ll bi translated">搜索像“2FA_Enabled”这样的参数，所以如果我将它们更改为false，服务器会直接将我重定向到仪表板。</li></ul><p id="4adc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以上都不起作用。因此，我简单地截取了对登录请求的响应，令人惊讶的是有一些密钥泄露了，包括API密钥。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lt"><img src="../Images/9eb502b321b571b8ea2d82db3e0b8570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yi_K-ALeeLILp6QtQhnvPQ.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">API密钥/机密在响应中泄露。</figcaption></figure><p id="c7fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且已经阅读了目标的API文档，我知道如何使用这些键。因此，在这里，如果攻击者拥有受害者凭据，那么<strong class="jp ir"> <em class="kl"> 2FA机制</em> </strong>将毫无用处，因为攻击者可以获得受害者的<strong class="jp ir"> <em class="kl"> API密钥</em> </strong>，这将使他能够使用各种<em class="kl"> API端点执行许多操作。</em></p><p id="6455" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时候，你只需要仔细看看服务器返回给你的是什么:)。其他bug猎人对该程序进行了大量测试，但他们忽略了上述问题。所以，永远不要退出已经测试过的程序，因为每个人都有自己的<strong class="jp ir"> <em class="kl">方法论</em> </strong>和<strong class="jp ir"> <em class="kl">思维方式</em> </strong>！</p><p id="0343" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">绕过2FA </strong>的额外提示:如果目标允许<strong class="jp ir"> <em class="kl"> API认证</em> </strong>通过<strong class="jp ir"> <em class="kl">电子邮件</em></strong><strong class="jp ir"><em class="kl">密码</em> </strong>或<strong class="jp ir"> <em class="kl">基本</em> </strong>认证(base64Encode(用户名:密码))，尝试设置2FA，看看是否仍能使用<strong class="jp ir"> <em class="kl"> API </em> </strong>进行认证如果是这样的话，那么你已经<strong class="jp ir"> <em class="kl">绕过了</em></strong>2FA，因为大多数<strong class="jp ir"><em class="kl">API</em></strong>将允许你在web应用程序上执行相同的操作。</p><p id="8c22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为开发团队的专业精神欢呼吧，他们在不到两个小时的时间内高效地解决了上述问题，还有奖金:-)！</p><p id="b882" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我的推特:<a class="ae km" href="https://twitter.com/Fatnass1F1ras" rel="noopener ugc nofollow" target="_blank">https://twitter.com/Fatnass1F1ras</a>，如果你有任何问题，请联系我。</p><p id="7b4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">黑客快乐！</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="04be" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae km" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="mz na gp gr nb nc"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">iwcon.live</p></div></div><div class="nl l"><div class="nm l nn no np nl nq kx nc"/></div></div></a></div></div></div>    
</body>
</html>