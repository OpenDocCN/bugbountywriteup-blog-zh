<html>
<head>
<title>Write-up: Remote code execution via web shell upload @ PortSwigger Academy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">推荐:通过web shell upload @ ports wigger Academy远程执行代码</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/write-up-remote-code-execution-via-web-shell-upload-portswigger-academy-5fa00de47229?source=collection_archive---------0-----------------------#2022-11-01">https://infosecwriteups.com/write-up-remote-code-execution-via-web-shell-upload-portswigger-academy-5fa00de47229?source=collection_archive---------0-----------------------#2022-11-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bba567f4fd91ee9bbe328d2060a5beae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fWBoEprCe3v0XEJF.png"/></div></div></figure><p id="ccce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇关于实验室<em class="kw">通过web shell上传远程执行代码</em>的文章是我为<a class="ae kx" href="https://portswigger.net/web-security" rel="noopener ugc nofollow" target="_blank"> PortSwigger的web安全学院</a>所做的系列演练的一部分。</p><p id="1f60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">学习路径</strong>:服务器端主题→文件上传漏洞</p><div class="ky kz gp gr la lb"><a href="https://portswigger.net/web-security/file-upload/lab-file-upload-remote-code-execution-via-web-shell-upload" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">实验室:通过web shell上传远程执行代码|网络安全学院</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">练习利用现实目标的弱点。记录你从学徒到专家的进步。看哪里…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">portswigger.net</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><p id="12f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Python脚本:<a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/blob/main/08_file_upload_vulnerabilities/Remote_code_execution_via_web_shell_upload/script.py" rel="noopener ugc nofollow" target="_blank"> script.py </a></p><h1 id="becc" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">实验室描述</h1><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/005b8edd5748d33e66190a30c5732710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OmAb7X3ceA6sH9L1.png"/></div></div></figure><h1 id="6d81" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">步伐</h1><p id="cfb4" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">实验室应用程序是一个博客网站。在公共页面上，没有什么有趣的东西出现，我继续用已知的用户帐号<code class="fe my mz na nb b">wiener</code>登录。</p><p id="dd7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在帐户设置中，用户可以设置电子邮件地址以及上传头像图像:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/a722d58923f0512a0d92429cfae54751.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/0*T5YcfPCWKuAEQf-M.png"/></div></figure></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="f972" class="lq lr iq bd ls lt nk lv lw lx nl lz ma mb nm md me mf nn mh mi mj no ml mm mn bi translated">找出允许上传的内容</h1><p id="b334" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">可能有许多验证步骤来检查用户提供的输入是否是恶意的(忽略实验室描述中说没有验证的事实)。常见的验证类型有:</p><ul class=""><li id="32f8" class="np nq iq ka b kb kc kf kg kj nr kn ns kr nt kv nu nv nw nx bi translated">文件扩展名</li><li id="4523" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">内容类型</li><li id="4c91" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">Mime类型</li><li id="5a8a" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">签名(幻数，通常是文件的前几个字节，例如png使用<code class="fe my mz na nb b">89 50 4E 47 0D 0A 1A 0A</code>)</li><li id="cbfb" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">文件解析/重写</li></ul><p id="8c5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些可能的验证大多依赖于用户提供的信息。因此，它们不能可靠地用于验证输入。不幸的是，这并没有阻止很多web应用程序依赖它们。</p><p id="30fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为第一步，我需要找出什么是允许上传的。所以尝试一个简单的文本文件。应用程序确认上传:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/3bf8904173df378b9b75223adc2e42e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/0*Iqva-fjOVR7AfiMZ.png"/></div></figure><p id="6a84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">页面的HTML代码显示图片的URL为<code class="fe my mz na nb b">/files/avatars/file.txt</code>。浏览到这个文件显示我的文本文件。如果有任何上传限制，他们是非常宽松的。</p><p id="3e7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在理想的情况下，web应用程序应该执行一些事情:</p><ol class=""><li id="27d2" class="np nq iq ka b kb kc kf kg kj nr kn ns kr nt kv oe nv nw nx bi translated">理想情况下，通过执行一组非常严格的规则来确保没有代码文件被上传。</li><li id="5d3a" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv oe nv nw nx bi translated">防止任何可能漏过并最终出现在头像目录<code class="fe my mz na nb b">/files/avatars/</code>中的代码被执行。</li></ol></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h1 id="25b3" class="lq lr iq bd ls lt nk lv lw lx nl lz ma mb nm md me mf nn mh mi mj no ml mm mn bi translated">上传web shell</h1><p id="f143" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">考虑到这是一个学徒级别的实验室，我尝试上传一个简单的PHP文件，该文件调用一个shell命令:</p><p id="35cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">响应相当清楚，我被允许执行shell命令:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/5d0669246252711b69a32c7a643ed3a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/0*ILD0ibas8X0H5cak.png"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">RCE证实</figcaption></figure><p id="570e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我将原始上传请求发送到Burp Repeater，并更改命令以输出秘密:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/93c8e3ca9ad3d022985355ba6f8a45cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8vnOvS5mRh-i1CCG.png"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">上传了恶意负载</figcaption></figure><p id="3f66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">调用该文件将输出秘密文件的内容:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/1ca2a3cdb846e45d5b024133bd994760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TxKdDJJa0Zwaa5NK.png"/></div></div></figure><p id="d6e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">提交信息后，实验室更新到</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/1824b6b02b4ab547205065d01a1666e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MYCEKsIIHVe4DDIq.png"/></div></div></figure></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><p id="440d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">原载于【https://github.com】<a class="ae kx" href="https://github.com/frank-leitner/portswigger-websecurity-academy/tree/main/08_file_upload_vulnerabilities/Remote_code_execution_via_web_shell_upload" rel="noopener ugc nofollow" target="_blank"><em class="kw"/></a><em class="kw">。</em></em></p><p id="498e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe my mz na nb b"><a class="ae kx" href="https://medium.com/@frank.leitner/membership" rel="noopener">New to Medium? Become a Medium member to access all stories on the platform and support me at no extra cost for you!</a></code></p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="0cce" class="on lr iq bd ls oo op dn lw oq or dp ma kj os ot me kn ou ov mi kr ow ox mm oy bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kx" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>