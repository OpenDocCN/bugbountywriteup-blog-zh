<html>
<head>
<title>OTP Bypass and Account Takeover at <redacted>Hospital</redacted></title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在<redacted>医院</redacted>进行OTP旁路和账户接管</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/otp-bypass-and-account-takeover-at-redacted-hospital-a49253411212?source=collection_archive---------0-----------------------#2022-03-18">https://infosecwriteups.com/otp-bypass-and-account-takeover-at-redacted-hospital-a49253411212?source=collection_archive---------0-----------------------#2022-03-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5c71" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">举报固定|赏金间接拒绝。|要求删除书面报告</h2></div><p id="9b73" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要了解我的更多信息，可以问谷歌助手“谁是克里希纳德夫·P·梅勒维拉”或者在谷歌上搜索我的名字。</p><p id="812b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们开始吧！！</p><p id="907d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注:本报告为转贴！由于医院的要求，原始报告被删除了。他们告诉我，如果我不删除报道，他们将合法搬迁。(太失望了)</p><blockquote class="lb lc ld"><p id="fdf8" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kh ir">漏洞:OTP旁路和账户接管</strong></p><p id="c2ce" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kh ir">冲击:零点一天</strong></p><p id="fe57" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kh ir">风险:患者敏感数据</strong></p><p id="0266" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kh ir">优先级:P0 </strong></p><p id="1bc6" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kh ir">范围:病历、扫描报告、检验报告、其他患者敏感信息</strong></p></blockquote><p id="4996" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">从攻击者角度重现的步骤:</strong></p><ol class=""><li id="a558" class="li lj iq kh b ki kj kl km ko lk ks ll kw lm la ln lo lp lq bi translated"><strong class="kh ir">访问</strong><a class="ae lr" href="https://patientportal.rajagirihospital.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir">https://patient portal。&lt;修订了&gt;。</strong>com/</a></li><li id="7ae3" class="li lj iq kh b ki ls kl lt ko lu ks lv kw lw la ln lo lp lq bi translated"><strong class="kh ir">点击忘记/新用户</strong></li></ol><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/3a460b27a34b2ef45c61b40aee8339cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*Q_StCCxWovwr1rqLGu4JTQ.png"/></div></figure><p id="c0aa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 3。输入任何有效的UHID进行测试，我使用的是R***192***** </strong></p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/60b6b93e7d65bb330ec4ea38f507f5e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*U1JJPTbxiqwPxxoCJYZvFg.png"/></div></figure><p id="6e0f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 4。它需要手机号码的最后4位数字才能获得动态口令。攻击者还可以使用响应操作绕过这一点，这将在接下来的步骤中使用。但在这里，我将通过另一种方法检索患者的手机号码。</strong></p><p id="39fd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 5。请访问https://patientportal。&lt;修订了&gt;。com/consumeable billing/consumeable billing</strong><strong class="kh ir">并输入UHID，然后点击“GO”并在burpsuite </strong>等网络拦截工具上拦截该请求</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/01a70c92caff26ab412f846e0933858d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*YUDYzvGlRY9tlAfny4xKGQ.png"/></div></figure><p id="304b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 6。在拦截上述请求的响应后(拦截与上述步骤相关的每个请求)，我们得到如下响应:</strong></p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="219a" class="mm mn iq mi b gy mo mp l mq mr"><strong class="mi ir">HTTP/1.1 200 OK<br/>Cache-Control: private<br/>Content-Type: text/html; charset=utf-8<br/>Server: Microsoft-IIS/8.5<br/>X-AspNetMvc-Version: 5.2<br/>X-AspNet-Version: 4.0.30319<br/>X-Powered-By: ASP.NET<br/>Date: Tue, 15 Mar 2022 02:45:40 GMT<br/>Connection: close<br/>Content-Length: 125</strong></span><span id="86ad" class="mm mn iq mi b gy ms mp l mq mr"><strong class="mi ir">[{"Pcellno":"9447******","PPhone":"","PEMail":"","HSPLocationId":7,"patientNm":"Mr.Va******.","sex":1,"age":63,"Agetype":1}]</strong></span></pre><p id="f66c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">7.<strong class="kh ir">这里明确提到了他的电话号码(出于安全考虑，我在这篇文章中隐藏了“PCellno ”,但在实际攻击中，它是完全可见的。)，所以我们可以回到第3步，输入最后4位数字。</strong></p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/3a5f384ff8cf6c2c6c62d53e1c76a6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*RNT4fQ6ImLZ49gc1bQxzeA.png"/></div></figure><p id="2367" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 8。移动验证后，我们会得到一个如下图的进入OTP的界面:</strong></p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/3d755f1b24cb381dfcbae3abceec799a.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*hvkgagnzsG4gy4ai890ksg.png"/></div></figure><p id="728a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 9。在这里输入任意随机数，如‘1234’并截取该请求的响应</strong></p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/7e09373cb7137de0937728077ddc6020.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*Oit5XDma3qk_SOP3r5vuHw.png"/></div></figure><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="46fc" class="mm mn iq mi b gy mo mp l mq mr"><strong class="mi ir">HTTP/1.1 200 OK<br/>Cache-Control: private<br/>Content-Type: text/html; charset=utf-8<br/>Server: Microsoft-IIS/8.5<br/>X-AspNetMvc-Version: 5.2<br/>X-AspNet-Version: 4.0.30319<br/>X-Powered-By: ASP.NET<br/>Date: Tue, 15 Mar 2022 02:51:06 GMT<br/>Connection: close<br/>Content-Length: 1</strong></span><span id="7aab" class="mm mn iq mi b gy ms mp l mq mr"><strong class="mi ir">0</strong></span></pre><p id="7fdd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 10。在拦截响应的过程中，我们在末尾得到一个数字“0”，将其更改为“1”，然后将响应转发给客户端。您将可以更改密码。</strong></p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/d929c7d68c0011080ccbb0816188ecce.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*pjkAVzu-Uy6xUCRnpQCPRQ.png"/></div></figure><p id="0a7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> 11。现在设置一个新密码，并使用我们现在设置的UHID和密码直接从登录门户登录。</strong></p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/464c97653e6e39fcf06554badc38fcec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*kNbE_h5spd8aTmycJxGUgQ.png"/></div></figure><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi my"><img src="../Images/ffe1ce2292cc95a1ef4b98f5b28cc650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*eGVNtV5gslA7__Tj-0TafA.png"/></div></figure><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/3fc177ccc17631043686d114425b09e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*5XZlkkPsam3dBxQKdjiWUw.png"/></div></figure><p id="79dd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">额外:电话号码枚举实际上是不需要的(即步骤5到6可以省略)。我们可以使用与步骤9中相同的响应操作技术来绕过移动验证。</strong></p><blockquote class="lb lc ld"><p id="7616" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kh ir">来自&lt;编辑&gt; IT团队的回应1:</strong>当我问他们是否为我的工作提供了任何奖金时，他们回答说，他们不敢向管理团队报告，因为他们不知道管理团队对这份报告的反应。</p><p id="209c" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kh ir">来自&lt;编审&gt;管理团队的回应(我直接汇报) :如果我不删除报告，他们将合法搬迁。(所以我把这个做成了匿名揭发报告)</strong></p><p id="6279" class="kf kg le kh b ki kj jr kk kl km ju kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><strong class="kh ir">由&lt;编辑的&gt; IT团队采取的行动:</strong>网站现已关闭，他们正在修复。</p></blockquote><p id="bab3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有人都在这里，</p><p id="5d29" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="le">别忘了在medium等社交媒体上关注我。也请为这篇文章鼓掌50次，这是我写更多的灵感！！</em>T11】</strong></p><p id="38b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我需要你的支持来写更多，请给我买杯咖啡吧:<a class="ae lr" href="https://www.buymeacoffee.com/krishnadevpm" rel="noopener ugc nofollow" target="_blank">https://www.buymeacoffee.com/krishnadevpm</a></p><p id="dd98" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="le">我的Instagram手柄:</em><a class="ae lr" href="https://instagram.com/krishnadev_p_melevila" rel="noopener ugc nofollow" target="_blank"><em class="le">https://instagram.com/krishnadev_p_melevila</em></a></p><p id="209f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="le">我的推特手柄:【https://twitter.com/Krishnadev_P_M】<a class="ae lr" href="https://twitter.com/Krishnadev_P_M" rel="noopener ugc nofollow" target="_blank"><em class="le"/></a></em></p><p id="a76d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="le">我的LinkedIn手柄:</em><a class="ae lr" href="https://www.linkedin.com/in/krishnadevpmelevila/" rel="noopener ugc nofollow" target="_blank"><em class="le">https://www.linkedin.com/in/krishnadevpmelevila/</em></a></p><p id="ed42" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="le">我的人事网站:</em><a class="ae lr" href="http://krishnadevpmelevila.com/" rel="noopener ugc nofollow" target="_blank"><em class="le">http://krishnadevpmelevila.com/</em></a></p></div></div>    
</body>
</html>