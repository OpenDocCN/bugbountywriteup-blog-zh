<html>
<head>
<title>Chatterbox From Hackthebox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子里的话匣子</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/chatterbox-hackthebox-4d5050018438?source=collection_archive---------1-----------------------#2022-10-26">https://infosecwriteups.com/chatterbox-hackthebox-4d5050018438?source=collection_archive---------1-----------------------#2022-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e8cf7d592798968eeb8f1cc8ae0e2949.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJRxrbLVD2f6-tMt-KcSFQ.png"/></div></div></figure><p id="f04e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大家好，这是Hac，今天我们要做的是hackthebox的Chatterbox，它是一个退役的windows box，所以解决它应该很有趣。</p><p id="1537" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Nmap扫描输出:-</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="f499" class="lf lg iq lb b gy lh li l lj lk">└─$ sudo nmap -sC -sV -p- 10.129.108.170 --min-rate 10000 -oA nmap<br/>[sudo] password for kali: <br/>Starting Nmap 7.93 ( <a class="ae ll" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2022-10-26 02:33 EDT<br/>Warning: 10.129.108.170 giving up on port because retransmission cap hit (10).<br/>Nmap scan report for 10.129.108.170<br/>Host is up (0.076s latency).<br/>Not shown: 65514 closed tcp ports (reset)<br/>PORT      STATE    SERVICE      VERSION<br/>135/tcp   open     msrpc        Microsoft Windows RPC<br/>139/tcp   open     netbios-ssn  Microsoft Windows netbios-ssn<br/>445/tcp   open     microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)<br/>2010/tcp  filtered search<br/>5826/tcp  filtered unknown<br/>9255/tcp  open     http         AChat chat system httpd<br/>|_http-server-header: AChat<br/>|_http-title: Site doesn't have a title.<br/>9256/tcp  open     achat        AChat chat system<br/>14496/tcp filtered unknown<br/>17058/tcp filtered unknown<br/>23978/tcp filtered unknown<br/>28255/tcp filtered unknown<br/>34469/tcp filtered unknown<br/>39101/tcp filtered unknown<br/>39782/tcp filtered unknown<br/>45438/tcp filtered unknown<br/>49152/tcp open     msrpc        Microsoft Windows RPC<br/>49153/tcp open     msrpc        Microsoft Windows RPC<br/>49154/tcp open     msrpc        Microsoft Windows RPC<br/>49155/tcp open     msrpc        Microsoft Windows RPC<br/>49156/tcp open     msrpc        Microsoft Windows RPC<br/>49157/tcp open     msrpc        Microsoft Windows RPC<br/>Service Info: Host: CHATTERBOX; OS: Windows; CPE: cpe:/o:microsoft:windows</span><span id="a7a1" class="lf lg iq lb b gy lm li l lj lk">Host script results:<br/>|_clock-skew: mean: 6h20m00s, deviation: 2h18m34s, median: 5h00m00s<br/>| smb-security-mode: <br/>|   account_used: &lt;blank&gt;<br/>|   authentication_level: user<br/>|   challenge_response: supported<br/>|_  message_signing: disabled (dangerous, but default)<br/>| smb2-security-mode: <br/>|   210: <br/>|_    Message signing enabled but not required<br/>| smb2-time: <br/>|   date: 2022-10-26T11:35:12<br/>|_  start_date: 2022-10-26T11:30:51<br/>| smb-os-discovery: <br/>|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)<br/>|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional<br/>|   Computer name: Chatterbox<br/>|   NetBIOS computer name: CHATTERBOX\x00<br/>|   Workgroup: WORKGROUP\x00<br/>|_  System time: 2022-10-26T07:35:09-04:00</span><span id="fd93" class="lf lg iq lb b gy lm li l lj lk">Service detection performed. Please report any incorrect results at <a class="ae ll" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .<br/>Nmap done: 1 IP address (1 host up) scanned in 85.27 seconds</span></pre><p id="1b09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">赫克吨的开放港口的，所以让我们尝试探索从最知道的港口，如445。所以我尝试列出smb共享，但列表被禁用，现在我试图运行enum4linux，希望找到一些东西，但也没有运气。现在，两个端口9255和9256看起来很有趣，一个名为“achat”的服务正在运行，http也有一些问题，所以我试图在浏览器中访问端口9255，但什么也没有得到(没有响应)，现在我试图访问端口9256，但得到的响应是“错误”。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/55e2008062ac39107dd8a1b8ee45809d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*vMLnliw74dZGq9HqPNxNGA.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">端口9255</figcaption></figure><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/9fbab76187777c4a8f3b37335066f632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTKcIl8ssEwxEqCREVZJwQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">端口9256“错误”</figcaption></figure><p id="330f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想运行gobuster并寻找一个隐藏的目录。但是为“achat”寻找公共漏洞总是一个好主意。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/41c965f695af7b6f607b6fc1107efa41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ap0p4xH7MtDIsBoFWpi2MQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">searchsploit</figcaption></figure><p id="176c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们尝试用两种不同的方法来开发这个系统，有和没有metasploit。</p><p id="78e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们将使用metasploit 。你可能想知道为什么？？？？因为它很可爱。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/4c14d482695d16e11c8f9cd7389c87d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MyykZOz3vLeTsSH6V823DQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">msfconsole</figcaption></figure><p id="3c58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯我得到了一个错误“<strong class="ka ir"> [-]利用失败:windows/meter preter/reverse _ TCP:所有编码器编码失败。</strong>“我可以通过更改我的有效负载来修复它”<strong class="ka ir">设置有效负载窗口/meter preter/reverse _ TCP _ all ports</strong>”<a class="ae ll" href="https://github.com/rapid7/metasploit-framework/issues/14130" rel="noopener ugc nofollow" target="_blank">https://github.com/rapid7/metasploit-framework/issues/14130</a>(您可能需要多次运行漏洞来获取shell)</p><p id="90a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">哦，boi米普雷特尔炮弹根本不稳定，炮弹不断死亡。</p><p id="ffb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我试着用手动的方法，希望得到稳定的外壳。</p><p id="7035" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用"<strong class="ka ir">searchsploit-m windows/remote/36025 . py</strong>"将有效负载复制到您的本地机器上</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lv"><img src="../Images/f8b8d6c0a60ae2351767faed92e023df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OTY9NUKsMoF0ZX-zNtlIMw.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">应对bof对本地系统的利用</figcaption></figure><p id="2e5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要稍微修改一下剧本。有一个非常好的github回购可以帮你做到这一点，只要按照回购作者https://github.com/Juggernoobs/achat_reverse_tcp_exploit的指示去做就行了</p><p id="9d85" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样的问题连续抄表员不断死亡:(</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/a6a1dfe9829004bd312785cd6113489a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VHVveFsUIcL2m-1zOKrhoA.png"/></div></div></figure><p id="db43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我能够通过迁移过程获得稳定的外壳。你需要非常快，因为壳……</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lx"><img src="../Images/00599c568f70f39b82a8c19caf62ada9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TuXFRsQC0UfbykjSiJSTHg.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">米普雷特尔ps</figcaption></figure><p id="6972" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从1936年迁徙到692年</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/04cb3b129dbdc497574bc3fbf7b8e16c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*EMrrpT4wC9JtJVL_ORR1VQ.png"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">迁移到692</figcaption></figure><p id="4601" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在"<strong class="ka ir">C:\ Users \ Alfred \ Desktop</strong>中获取User.txt</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/a6515a36bc7abd39b3fa308a1871bcbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dpUkwem5y5KQbQRjPdGImg.png"/></div></div></figure><p id="4ace" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我把<strong class="ka ir">winPEASx86.exe</strong>上传到盒子上。为了列举系统。</p><p id="8517" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">得到一个明文默认密码“Welcome1！”。我在想我该如何利用它。也许是密码复用？？但是我可以在哪里使用密码呢？？。因为我们知道这个盒子上只有两个用户“alfred”和“administrator”。我想“也许”管理员会使用该凭证登录，但问题是我将在哪里使用该凭证。也许我可以使用psexec来获得shell，但是我们需要向前移植。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/d34284f6917d969a180aff8a98416be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46qyaOlw0bYn9YbkRyZevA.png"/></div></div></figure><p id="a2be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用metasploit进行端口转发。</p><ol class=""><li id="dd13" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">在meter preter "<strong class="ka ir">run autoroute-s 127 . 0 . 0 . 1</strong>中使用该命令。</li></ol><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/acbcaa3ba5ea4d9d1ddabdfc32f25ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0inyf_aVZcv3wBDkPiLUw.png"/></div></div></figure><p id="7dad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.现在搜索“辅助/服务器/socks _代理”</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/50f45ce7dc3bf0f97b7fe0cce4e22f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_V_gQMabPQaTiBojmy-A4g.png"/></div></div></figure><p id="a8d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.确保将版本更改为“4a”。</p><p id="66ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.现在你需要在“<strong class="ka ir"> /etc/proxychains4.conf </strong>”做一些修改</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/1791b4763a0c2d49422ab9a0dc38839a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dagVfgfC2zR6ZkcGiEK4IQ.png"/></div></div></figure><p id="bd7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在运行快速nmap扫描，以确保您的代理正在工作。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/97c87a89a013810b14c603dd242da581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SdH3p_Asd8xHKdHmyJwPig.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">代理链</figcaption></figure><p id="7177" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们试着列出中小企业股"<strong class="ka ir">proxy chains SMB client-L 10 . 129 . 138 . 92-U Alfred-p welcome 1！</strong>”。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/2c63c98b5c4dc4206eba394e7a078561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eapo0Gr-cnPGrDIg65hJpQ.png"/></div></div></figure><p id="fc9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们尝试psexec以管理员身份获取shell。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="390d" class="lf lg iq lb b gy lh li l lj lk">python3 ~/impacket/examples/psexec.py administrator:'Welcome1!'<a class="ae ll" href="http://twitter.com/10" rel="noopener ugc nofollow" target="_blank">@10</a>.129.138.92</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/790412b17118c5dc6a9e903d5aa045fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hBPJC2pvm_V5z3YRosAIig.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">使用psexec以管理员身份获取shell</figcaption></figure><p id="f501" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到了贝壳。有许多非metasploit方法来进行端口转发，或者可能有不同的方法来获得这个机器上的root，但是metasploit方法对我来说要容易得多。但是在以后的文章中，我会尝试更多的手动方式，例如:-我们可以使用plink.exe进行端口转发。</p><p id="2313" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">遗憾的是，我们无法获得root.txt的内容。让我们试试不同的方法。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="1dc8" class="lf lg iq lb b gy lh li l lj lk">proxychains winexe  -U Administrator%Welcome1! //127.0.0.1 "cmd.exe"</span></pre><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/98019081a8ccec23e6e4b40699516da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H78VxxcAshFf_hcsCx9xUQ.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">使用winexe</figcaption></figure><p id="2381" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望你喜欢这篇文章，感谢阅读:)</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h2 id="2df0" class="lf lg iq bd my mz na dn nb nc nd dp ne kj nf ng nh kn ni nj nk kr nl nm nn no bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ll" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>