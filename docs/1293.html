<html>
<head>
<title>XSS Through Parameter Pollution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">XSS通过参数污染</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/xss-through-parameter-pollution-9a55da150ab2?source=collection_archive---------1-----------------------#2021-05-05">https://infosecwriteups.com/xss-through-parameter-pollution-9a55da150ab2?source=collection_archive---------1-----------------------#2021-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fce3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，</p><p id="14fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是<a class="ae kl" href="https://twitter.com/saajanbhujel" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">萨扬·布杰尔</strong> </a>。</p><p id="8e6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">商学学士(B.Com)的学生，我也是一名昆虫赏金猎人。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/5c0adf738f1fde5f7bd8fdb9851e3706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gc6hgw9PgimjDitC3P6BhA.png"/></div></div></figure><p id="631e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我的第二篇博客，如果你发现任何拼写错误，请耐心等待几分钟。而且，我也在<strong class="jp ir"> VDP项目</strong>中发现了这个漏洞。但是在开始这篇博客之前，我想提供一些关于跨站脚本(XSS)和HTTP参数污染(HPP)的基本信息。</p><h2 id="cb0a" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">什么是跨站点脚本(XSS)？</h2><p id="5d33" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">跨站点脚本(也称为XSS)是一个web安全漏洞，使得攻击者能够向易受攻击的web应用程序中注入恶意代码。</p><p id="3796" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">XSS攻击主要有三种类型。这些是:</strong></p><ul class=""><li id="4e38" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated"><a class="ae kl" href="https://portswigger.net/web-security/cross-site-scripting#reflected-cross-site-scripting" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">反映了XSS </strong> </a> <strong class="jp ir"> : </strong>恶意脚本来自当前的HTTP请求。</li><li id="3f0c" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><a class="ae kl" href="https://portswigger.net/web-security/cross-site-scripting#stored-cross-site-scripting" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">存储的XSS </strong> </a> <strong class="jp ir"> : </strong>恶意脚本来自网站的数据库。</li><li id="bd9a" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><a class="ae kl" href="https://portswigger.net/web-security/cross-site-scripting#dom-based-cross-site-scripting" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">基于DOM的XSS </strong> </a> <strong class="jp ir"> : </strong>漏洞存在于客户端代码而非服务器端代码。</li></ul><h2 id="4511" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">什么是HTTP参数污染(HPP)？</h2><p id="4f39" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="https://www.acunetix.com/blog/whitepaper-http-parameter-pollution/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> HTTP参数污染</strong> </a>顾名思义，污染web应用的HTTP参数，以执行或实现与web应用预期行为不同的特定恶意任务/攻击。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="3782" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们开始写博客吧…</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mr"><img src="../Images/50f5c47cf9a034b823a6e828b402ee40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ZcCBX204u75iWJ0obv4Qw.jpeg"/></div></div></figure><p id="5cc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Hackerone和Bugcrowd的项目上呆了几天之后。我在这些程序上发现了一些漏洞，比如CSRF和商业逻辑缺陷。但是，我所有的报告都有副本。然后，我对自己说，这次去找一些VDP的节目。</p><p id="4515" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">于是，我开始搜寻VDP程序中的一些bug。经过2-3个小时的搜寻，我发现一个域名正在使用URL中的<strong class="jp ir">回调</strong>参数将用户重定向到另一个子域。</p><p id="67b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有，我不能透露目标的名字。所以，让我们假设目标是<strong class="jp ir">site.com</strong>。这个网址看起来是这样的:</p><blockquote class="ms mt mu"><p id="85cc" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">https://site.com/out?回调=https://subdomain.site.com</p></blockquote><p id="5025" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且，如果我打开上面的链接。然后，它会把我重定向到subdomain.site.com。</p><p id="ebc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在看到这个重定向之后，<strong class="jp ir">我试图用https://bing.com</strong>改变回调参数的值。因为我想确认一下，网站是否在做任何形式的验证。如果该网站正在进行验证或重定向只允许site.com的子域，那么该网站可能不容易被打开重定向。而且，如果网站没有进行任何形式的验证，那么该网站就是易受攻击的。</p><p id="c4fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并且，在更改回调参数的值之后。现在，网址是这样的:</p><blockquote class="ms mt mu"><p id="da88" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">https://site.com/out?callback=https://bing.com</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mz"><img src="../Images/a58be8ea4392fdc02009bea1283c4676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LyfsNx8V4ZY2jLJObpAorQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">回调参数的值反映在响应中</figcaption></figure><p id="78e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且，如果我打开上面的链接。然后，它还会把我重定向到bing.com。这意味着网站没有进行任何形式的验证，容易被打开重定向。但是，在看到它在博客上的回应后。我想，<strong class="jp ir">也许这也容易受到跨站脚本</strong>的攻击，因为回调参数的值也反映到了响应中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/a81298d05a9999d646f0f7f2b5283db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/1*80ttM3GVWATvLaXIY2Ol6g.gif"/></div></figure><p id="2109" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以首先，我试图破解代码，因为值反映在<strong class="jp ir">脚本</strong>标签中。对于，break变量callbackUrl，我简单的放<strong class="jp ir">any thing % 22；</strong>在<strong class="jp ir">中</strong>回调参数。但是，在发送这个请求后，我得到了一个阻止我的请求的错误。此外，对于其他一些值[如<strong class="jp ir"> ' </strong>、<strong class="jp ir"> " </strong> ]，我也得到同样的错误。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/f8c81b44da4ef7973f4a074b9f7b382a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lW0_Y6RIM4mKaYKsRCKd4g.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">阻止我的请求的错误</figcaption></figure><p id="41e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">现在，我只有两个选择:</strong></p><ul class=""><li id="d2e9" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated">第一种选择是将此问题报告为开放重定向。</li><li id="0952" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated">第二个选择是找到一个获得XSS的旁路。</li></ul><p id="d630" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我记得几周前，我在<a class="ae kl" href="https://www.youtube.com/watch?v=QVZBl8yxVX0" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> HTTP参数污染</strong> </a>上看了<a class="ae kl" href="https://www.youtube.com/channel/UCW6MNdOsqv2E9AjQkv9we7A/videos" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Pwnfunction </strong> </a>的视频。所以，我选择的第二个方案是找到一个获得XSS的旁路。此外，我还在URL中添加了一个回调参数，用于进行<strong class="jp ir">参数污染攻击</strong>。现在，网址是这样的:</p><blockquote class="ms mt mu"><p id="dac9" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">https://site.com/out?回调=任何东西&amp;回调=随机</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/96c7d9203e64ec93ec6cce3dc331413e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DMv6NhPs5yFQbjdNmoQ4Ig.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">两个回调参数的响应</figcaption></figure><p id="4ec4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我注意到如果我在URL中添加两个相同的参数。然后，我将得到响应中两个参数的值，用逗号分隔。</p><p id="1503" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且，你也知道，当我使用这些值[如<strong class="jp ir"> ' </strong>，<strong class="jp ir"> " </strong> ]时，我得到了一个错误，阻止了我的请求。但是现在，我有两个相同的参数。</p><p id="cc52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我再次尝试中断变量callbackUrl。但是这一次，我把<strong class="jp ir">% 22；<strong class="jp ir"> </strong>中的东西%2f%2f </strong>第二个回调参数。添加值后，现在URL是这样的:</p><blockquote class="ms mt mu"><p id="3ac4" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">https://site.com/out?callback = any &amp; callback = % 22；一些东西%2f%2f</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/ca0f93dddbd25c9edbd5fbf83fa61c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yyUJXtZi6wXHPZIpUZaHXQ.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">能够中断callbackUrl变量</figcaption></figure><p id="5ab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且，它的工作，我能够打破代码或绕过过滤器。<strong class="jp ir">表示网站没有对第二个回调参数进行任何验证。</strong></p><p id="176b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在这一次，为了得到一个XSS警报，我把<strong class="jp ir">% 22；警报% 281% 29；第二个回调参数中的% 2f % 2f<strong class="jp ir">中的</strong>。现在，网址是这样的:</strong></p><blockquote class="ms mt mu"><p id="64ef" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">https://site.com/out?callback = any &amp; callback = % 22；警报% 281% 29；%2f%2f</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ni"><img src="../Images/69d1bf7d8714cf368dbafba134b9bba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E260qVpkRWl7WIewCxyxbA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">再次收到阻塞请求</figcaption></figure><p id="82ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网站再次阻止了我使用括号的请求。所以，我把括号<strong class="jp ir"> </strong>换成了URL编码或者<strong class="jp ir"> ` ` </strong>。但是，我还是会出错。因为网站还在对所有参数做一些验证。</p><p id="667c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我再次使用带有URL编码的<strong class="jp ir">`</strong>。最后，我成功绕过了过滤器。最后的URL是这样的:</p><blockquote class="ms mt mu"><p id="452c" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">https://site.com/out?callback = any &amp; callback = % 22；alert % 60 XSS _ POC _ BY _ SAAJAN _ BHUJEL % 60；%2f%2f</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nj"><img src="../Images/66583e575cee8917366cb5bdc6c89693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gbQwYzrGaBXlwZU5phqllA.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">绕过过滤器</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nk"><img src="../Images/04932a082e75b5f885d44c518fe0a8b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7puGW9FjoKmwBwB5MJzug.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">获得XSS警报</figcaption></figure><p id="8126" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我成功地绕过滤波器，通过参数污染执行XSS。在我的例子中，我能够通过参数污染攻击绕过一些值的过滤器[如<strong class="jp ir"> ' </strong>、<strong class="jp ir"> " </strong> ]。</p><p id="586e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提示:- 如果你发现你的目标正在对参数进行某种验证检查。然后，尝试添加一个或多个相同的参数。要查看网站响应的任何变化，也许您可以绕过验证检查。</p><p id="f887" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢你阅读这篇博客，我希望你能学到一些东西。</p><p id="8513" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你愉快！….</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/e8253efd3eb4dbeeda0d92305b8d0fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*3OiLpGeBfCE6NNrFJmyz1Q.gif"/></div></figure></div></div>    
</body>
</html>