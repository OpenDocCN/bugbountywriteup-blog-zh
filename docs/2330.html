<html>
<head>
<title>AWS Attribute-Based Access Control (ABAC) With Tags</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带标签的基于属性的访问控制(ABAC)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/aws-attribute-based-access-control-abac-with-tags-f4340385011e?source=collection_archive---------3-----------------------#2022-08-30">https://infosecwriteups.com/aws-attribute-based-access-control-abac-with-tags-f4340385011e?source=collection_archive---------3-----------------------#2022-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/1cf08ace30fa74ea8d2a4233709ae92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*2NPPEE5_asBokXWcjQkH-A.png"/></div></figure><p id="4370" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">基于属性的访问控制(ABAC)是一种授权策略，用于管理对AWS资源的访问和权限。您或AWS可以将自定义属性标签分配给AWS资源。每个标记由两部分组成:标记键和标记值。两者都区分大小写。标签可用于按所有者、环境或其他标准对资源进行分类。通过使用将不同属性结合在一起的ABAC策略，标记还允许有条件地访问AWS资源。</p><p id="2409" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这篇博文向您展示了如何在AWS secrets manager中使用标签来限制对机密的访问，以及如何限制用户使用允许的属性来标记/取消标记机密，因此希望您能够更好地了解如何使用标签来扩展对ABAC域中所有AWS资源的授权。</p><h1 id="e8a3" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">方案</h1><p id="be7a" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">AWS秘密管理器中有3个秘密。作为一名经验丰富的IAM管理员，您希望限制IAM用户在secrets manager中访问他们自己的机密，IAM用户只能添加或删除他们机密上的“date”标记。为了实现这一点，您决定使用ABAC策略，允许带有principal标记的IAM用户访问带有匹配标记的secret。</p><h1 id="dd6e" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">ABAC实施</h1><p id="f9b0" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">从AWS secrets manager开始，为这三个秘密添加标签。awsseclabsec和awsseclabsec-1与项目<strong class="jw ir"> peg </strong>和团队<strong class="jw ir"> eng </strong>相关联。</p><p id="7d69" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面列出了这三个带有附加标签的秘密:</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lv"><img src="../Images/d2ffc4e593f962bd243f2a16f1d0983a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YSdHhWT0xlq618iW3ttkQ.png"/></div></div></figure><p id="7ce9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一个名为awsSecLab的IAM用户在拥有项目<strong class="jw ir"> peg </strong>的团队<strong class="jw ir"> eng </strong>中，他需要访问awsseclabsec和awsseclabsec-1机密。因此，您将以下标记附加到IAM用户:</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/a23874b8d6584d34c555d7ed7db131d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*4PvYBPsvIwQ15WwrfIDE2g.png"/></div></figure><p id="69b4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在是时候制定ABAC政策了。要了解哪些标记条件键可以在策略中用于每个服务的操作和资源，请参见<a class="ae mf" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_actions-resources-contextkeys.html" rel="noopener ugc nofollow" target="_blank">AWS服务的操作、资源和条件键</a>。导航至机密管理器部分以获取更多详细信息。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/25f2028673f417cb66ca0f58c7708c6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bU-gJloFQ2U_5cMh4_5mGQ.png"/></div></div></figure><p id="294d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了确保IAM用户awsSecLab遵循您制定的秘密访问规则，您可以向IAM用户添加以下策略。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mh"><img src="../Images/3611333c38ab2ae2189b9ce8b103fe67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bfIDEIwJ6qakIxbbPIqLGA.png"/></div></div></figure><p id="2ee0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在创建策略中的条件部分时，您会发现对于像DescribeSecret这样的一些操作，在下面的条件键列中有<strong class="jw ir">secrets manager:resource tag</strong>/tag-key和<strong class="jw ir">AWS:resource tag</strong>/$ { TagKey}。您可能会对这两个条件键之间的区别感到困惑，AWS对它们的解释也很模糊。在实践中，我们发现，只要AWS支持指定的操作，它们就可以互换。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mi"><img src="../Images/106d7731a413889d9db662bc48ff2478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DVgLQwlo0spl4QUaFZUYdw.png"/></div></div></figure><p id="3657" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">关于aws:TagKeys条件键，它只对CreateSecret、TagResource和UntagResource三个动作有效，不影响上面提到的DescribeSecret之类的其他动作。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mj"><img src="../Images/a28865c5766d5a7c0240f1450178ea06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D292hepi5NvKX1PVkFDFpA.png"/></div></div></figure><h1 id="6e26" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">验证ABAC战略</h1><p id="a9ee" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">在将上述策略应用到IAM用户AWS clab之后，您让IAM用户AWS clab尝试一下。</p><p id="118d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">测试1 —尝试在机密管理器中访问三个机密</strong></p><p id="c6a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，IAM用户访问他自己的秘密:awsseclabsec和awsseclabsec-1，一切都很好，因为这两个秘密都有匹配的标记:project=peg和team=eng用于DescribeSecret操作。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mk"><img src="../Images/61fc402d92480b838cd3886c67b8c1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpHVT1zhSZf5d4i2vlNaTg.png"/></div></div></figure><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi ml"><img src="../Images/3d6f8ffdd17ba4e08343001d6e72ccd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MYfVSj6pwjp6Q-0fnxKvfw.png"/></div></div></figure><p id="759f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是当他试图访问appseclab时，由于不匹配的标记，尝试失败了。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mm"><img src="../Images/c8987fef7a54a85d6bec42768572c5b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zD1FYlpqgyFrnjHrfXrDw.png"/></div></div></figure><p id="cb9e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">错误消息“您没有权限在机密管理器中描述机密。您没有权限查看机密详细信息。请与您的管理员联系以获得DescribeSecret访问权限。出现在秘密的图形用户界面上。</p><p id="c5d0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">测试2 —尝试更改awsseclabsec和awsseclabsec-1的标签</strong></p><p id="a484" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">IAM用户希望从awsseclabsec中删除owner标记，但更新失败，因为策略不允许他标记Resource/UntagResource，除非标记在标记关键字列表中:“project”、“team”、“date”。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mj"><img src="../Images/3b035cab1b0b6a2a85b70ea94aa99626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*20TvztoeixAp2q6L4_cuyA.png"/></div></div></figure><p id="e58c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">他导航到awsseclabsec-1并试图将“date”标记添加到秘密中。操作成功，因为它符合权限策略。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mn"><img src="../Images/570e5b15fb8b3951e03d59f065460769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HNRFPDk3Zg0AcG8mLM7Fzg.png"/></div></div></figure><h1 id="4693" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">摘要</h1><p id="3443" class="pw-post-body-paragraph ju jv iq jw b jx lq jz ka kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr ij bi translated">现在你已经学会了如何使用标签来实现ABAC。你对你的本金和资源实施了ACAB策略。如果你认为这篇博文有帮助，请点击拍手👏按钮下面几下，以示支持！</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><p id="1ca1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mv">来自Infosec的报道:Infosec上每天都有很多事情发生，很难跟上。</em> <a class="ae mf" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> <em class="mv">加入我们的每周简讯</em> </strong> </a> <em class="mv">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>