<html>
<head>
<title>Let’s Bypass CSRF Protection &amp; Password Confirmation to Takeover Victim Accounts :D</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们绕过CSRF保护和密码确认接管受害者帐户:D</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/lets-bypass-csrf-protection-password-confirmation-to-takeover-victim-accounts-d-4a21297847ff?source=collection_archive---------0-----------------------#2020-06-12">https://infosecwriteups.com/lets-bypass-csrf-protection-password-confirmation-to-takeover-victim-accounts-d-4a21297847ff?source=collection_archive---------0-----------------------#2020-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9c338c359dfd26d4f3ebf3ddd8ca02a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HsBJTyn9B9ON313-KMJyKw.png"/></div></div></figure><p id="c0a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">跨站点请求伪造(CSRF)在新的框架中很少出现，但是仍然像过去一样可以利用。CSRF，长话短说，这是一种攻击，攻击者制作一个请求并发送给受害者，服务器接受请求，就好像是受害者请求的一样，并对其进行处理。为了缓解这种情况，部署了多种保护机制，其中一种是<strong class="ka ir">反CSRF令牌。</strong></p><p id="14a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">亲爱的黑客和安全爱好者们，今天我将讲述我是如何绕过CSRF保护成功执行一次CSRF攻击的，并且在客户端验证绕过的帮助下，我能够通过更改密码执行一次完整的帐户接管。在开始攻击场景之前，让我们看看更多关于反CSRF令牌和可能的旁路。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><blockquote class="ld le lf"><p id="8b5b" class="jy jz lg ka b kb kc kd ke kf kg kh ki lh kk kl km li ko kp kq lj ks kt ku kv ij bi translated">如果你喜欢读我的文章，请在推特上关注:【https://www.twitter.com/harshbothra_】<strong class="ka ir"/></p></blockquote></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="2d00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">反CSRF令牌</strong>是一种允许服务器唯一区分谁真正请求执行资源/动作以抵御CSRF攻击的方式。但是，由于应用程序中的弱实现，有几种方法可以绕过反CSRF令牌，例如:</p><ul class=""><li id="ae6b" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated">移除反CSRF令牌</li><li id="fe5b" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">通过改变几个比特来欺骗反CSRF令牌</li><li id="f7fc" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">使用相同的反CSRF令牌</li><li id="5bd6" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">生成反CSRF令牌的弱加密技术</li><li id="fe58" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">可猜测的反CSRF代币</li><li id="4ae8" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">偷令牌与其他攻击，如XSS。</li><li id="fbab" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated"><strong class="ka ir">将POST请求转换为GET请求，以绕过CSRF令牌检查。</strong> <em class="lg">(这是我们将在本文中看到的)</em></li></ul><blockquote class="ld le lf"><p id="9f1a" class="jy jz lg ka b kb kc kd ke kf kg kh ki lh kk kl km li ko kp kq lj ks kt ku kv ij bi translated"><em class="iq">附言:可能有其他旁路可用。我提到了一些我记得在我的头顶。如果你知道任何其他的，请回复以帮助读者，或者留下一个便条，这样我可以用适当的学分更新这个列表。:)</em></p></blockquote><p id="46ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以让我们称目标为<strong class="ka ir">target.com。</strong>摆弄完应用程序后，我发现<strong class="ka ir"> /editprofile </strong>端点有这样的请求:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="cc50" class="mi mj iq me b gy mk ml l mm mn">POST /editprofile HTTP/1.1<br/>Host: target.com<br/><strong class="me ir">&lt;redacted&gt;</strong></span><span id="75bb" class="mi mj iq me b gy mo ml l mm mn">username=test&amp;description=&lt;some_text&gt;&amp;phone=1231231231&amp;anti_csrf=&lt;token&gt;</span></pre><p id="597d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为您可以观察到<strong class="ka ir"> anti_csrf </strong>令牌存在，并且服务器正在验证<strong class="ka ir">令牌是否丢失或伪造。</strong>所以基本上没有运气。然后我简单地改变了POST中的<strong class="ka ir">请求方法，使&amp;移除了anti_csrf参数</strong>，伪造的请求看起来像:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="462b" class="mi mj iq me b gy mk ml l mm mn">GET /editprofile?username=test&amp;description=&lt;some_text&gt;&amp;phone=1231231231 HTTP/1.1<br/>Host: target.com<br/><strong class="me ir">&lt;redacted&gt;</strong></span></pre><p id="c86d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们成功地绕过了它。CSRF剥削了。</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="2088" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，等等，它的严重性较低，因为除了更改一些配置文件信息之外，我们还不能做太多事情。在寻找更多的东西后，我检查了<strong class="ka ir">密码重置功能</strong>，但它再次要求在能够更改密码之前获得<strong class="ka ir">当前密码</strong>。因此，最初的密码更改请求如下所示:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="ba22" class="mi mj iq me b gy mk ml l mm mn">POST /changepassword HTTP/1.1<br/>Host: target.com<br/><strong class="me ir">&lt;redacted&gt;</strong></span><span id="0de1" class="mi mj iq me b gy mo ml l mm mn">current_password=currentpassword&amp;new_password=new_password&amp;confirm_password=new_password&amp;anti_csrf=&lt;token&gt;</span></pre><p id="927e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我简单地删除了<strong class="ka ir">当前密码</strong>字段，它成功地重置了密码。</p><p id="219c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以现在我们有两件事:</p><ol class=""><li id="9d73" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv mr lr ls lt bi translated">旁路和执行旁路的方式</li><li id="cbe9" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv mr lr ls lt bi translated">更改密码时绕过当前密码的方法</li></ol><p id="2bf7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以简单地链接问题<strong class="ka ir">来更改使用CSRF的受害者用户的密码，伪造的请求将看起来像:</strong></p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="9048" class="mi mj iq me b gy mk ml l mm mn">GET /changepassword?new_password=new_password&amp;confirm_password=new_password HTTP/1.1<br/>Host: target.com<br/><strong class="me ir">&lt;redacted&gt;</strong></span></pre><p id="2fa7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只需使用Burp套件生成一个CSRF PoC，或者您可以使用自己的方式来完成并将其发送给受害者。一旦受害者导航到攻击者的crafter URL，他的密码就会被更改。</p><p id="6e1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">介质的初始严重度现在为高。</strong></p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="ms mq l"/></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="0e08" class="mt mj iq bd mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np bi translated"><strong class="ak">外卖:</strong></h1><ul class=""><li id="9a59" class="ll lm iq ka b kb nq kf nr kj ns kn nt kr nu kv lq lr ls lt bi translated">永远不要忽视易受攻击的漏洞，因为它们可以用来在很大程度上增加影响。</li><li id="8eb5" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">绕过CSRF保护的方法。</li><li id="2b83" class="ll lm iq ka b kb lu kf lv kj lw kn lx kr ly kv lq lr ls lt bi translated">永远不要放弃学习新事物。</li></ul><p id="6321" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢阅读文章<strong class="ka ir">，请鼓掌并关注<em class="lg">媒体和Twitter: </em> </strong></p><p id="545e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="lg">碎碎念:</em></strong><a class="ae lk" href="https://www.twitter.com/harshbothra_" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="lg">https://www.twitter.com/harshbothra_</em></strong></a></p><p id="7aca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="lg">领英:</em></strong><a class="ae lk" href="https://www.linkedin.com/in/harshbothra" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="lg">https://www.linkedin.com/in/harshbothra</em></strong></a></p><p id="b529" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="lg">网址:</em></strong><a class="ae lk" href="https://harshbothra.tech" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="lg">https://harshbothra . tech</em></strong></a></p></div></div>    
</body>
</html>