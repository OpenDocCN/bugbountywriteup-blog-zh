<html>
<head>
<title>XSS WAF &amp; Character limitation bypass like a boss</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">XSS WAF &amp;像老板一样绕过性格限制</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/xss-waf-character-limitation-bypass-like-a-boss-2c788647c229?source=collection_archive---------0-----------------------#2020-03-27">https://infosecwriteups.com/xss-waf-character-limitation-bypass-like-a-boss-2c788647c229?source=collection_archive---------0-----------------------#2020-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ef16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated"><span class="l km kn ko bm kp kq kr ks kt di"> H </span> <strong class="jp ir"> ello各位黑客！</strong></p><p id="7d74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于冠状病毒在世界范围内爆发，我在房间里呆了3天，感觉很无聊。所以我想为什么不写一篇我很久以前承诺过的文章呢🤭。几个月前，在我的推特上，我分享了一个在私人bug bounty网站上找到的绕过XSS WAF字符限制的方法。今天我将分享更多关于旁路的技术细节。希望你们会喜欢😇</p><p id="df70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">早在2019年，我测试了一个网络应用程序，允许用户创建相册并上传照片，界面看起来像下面的截图-</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi kv"><img src="../Images/353638ee86b37d8d56dbebf9fa1f2064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TgfWUB90iYNDpm6mJsiauQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated"><strong class="bd ll">应用界面🤔</strong></figcaption></figure><p id="668d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我点击<strong class="jp ir">编辑</strong>时，还有重命名图片的选项，所以通常任何研究人员都会在这里测试XSS，因为有一种方法可以改变照片名称。所以我把照片的名字改成了下面的有效载荷-</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="0146" class="lr ls iq ln b gy lt lu l lv lw">xsstest'"&gt;{{7*7}}</span></pre><blockquote class="lx ly lz"><p id="364a" class="jn jo ma jp b jq jr js jt ju jv jw jx mb jz ka kb mc kd ke kf md kh ki kj kk ij bi translated"><strong class="jp ir">然后我注意到了下面的事情——</strong></p></blockquote><ul class=""><li id="0fc4" class="me mf iq jp b jq jr ju jv jy mg kc mh kg mi kk mj mk ml mm bi translated">输入中有15个字符限制，所以我能够注入<code class="fe mn mo mp ln b"><strong class="jp ir">xsstest'"&gt;{{7*7</strong></code>这些字符。</li><li id="954a" class="me mf iq jp b jq mq ju mr jy ms kc mt kg mu kk mj mk ml mm bi translated">所有特殊字符都被正确转义。</li><li id="8157" class="me mf iq jp b jq mq ju mr jy ms kc mt kg mu kk mj mk ml mm bi translated">最后我被重定向到了<strong class="jp ir"> /error.aspx？code=500 </strong>当我试图再次加载相册时，由于WAF的原因，我必须将图像重命名为<strong class="jp ir">xst est</strong>，这样我就可以再次加载相册了。</li></ul><p id="036d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来这个输入很好地防止了XSS攻击。然后我开始玩其他可用的选项，将<strong class="jp ir">打嗝套装工具</strong>与我的浏览器连接，并保持它打开，以捕捉<strong class="jp ir"> HTTP历史</strong>中的所有后台请求。然后，当我浏览HTTP历史选项卡时，一个后台请求端点引起了我的注意，看起来像是https://subdomain.company.com/ajax/generateImageList.ashx?JSON = { albums:[{ " ID ":"&lt;picture _ ID&gt;，" value":"on"}]} 。该请求针对相册<strong class="jp ir">幻灯片</strong>选项，端点页面源为:-</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="3610" class="lr ls iq ln b gy lt lu l lv lw">&lt;a href="https://image-link.com/image.jpg" title="xsstest" rel="lightbox[gallery]"&gt;84**00000&lt;/a&gt;</span></pre><p id="bfd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看<strong class="jp ir">标题</strong>属性值我们在那个相册里的图像名称是什么。因此，我再次将我的图片名称重命名为<code class="fe mn mo mp ln b"><strong class="jp ir">xsstest'"&gt;</strong></code>，并再次检查了<strong class="jp ir">Ajax/generateimagelist . ashx</strong>页面源代码，这次是-</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="e4ed" class="lr ls iq ln b gy lt lu l lv lw">&lt;a href="https://image-link.com/image.jpg" title="xsstest'"&gt;" rel="lightbox[gallery]"&gt;84**00000&lt;/a&gt;</span></pre><blockquote class="lx ly lz"><p id="adac" class="jn jo ma jp b jq jr js jt ju jv jw jx mb jz ka kb mc kd ke kf md kh ki kj kk ij bi translated"><strong class="jp ir">所以在这个新的generateImageList.ashx端点——</strong></p></blockquote><ul class=""><li id="309a" class="me mf iq jp b jq jr ju jv jy mg kc mh kg mi kk mj mk ml mm bi translated">用户输入没有正确转义。</li><li id="46f1" class="me mf iq jp b jq mq ju mr jy ms kc mt kg mu kk mj mk ml mm bi translated">没有晶片检测。</li></ul><p id="1665" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们仍然有15个字符的限制，这使得这个xss没有用。我们能想到的最小xss有效载荷是<code class="fe mn mo mp ln b"><strong class="jp ir">"oncut="alert()</strong></code>，当我们在键盘上按下<strong class="jp ir">窗口</strong>窗口&amp;窗口<code class="fe mn mo mp ln b">COMMAND+X</code>窗口<strong class="jp ir"> OS X </strong>窗口<code class="fe mn mo mp ln b">CTRL+X</code>时，会弹出一个空白窗口</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="23d6" class="lr ls iq ln b gy lt lu l lv lw">&lt;a href="https://image-link.com/image.jpg" title=""oncut="alert()" rel="lightbox[gallery]"&gt;84**00000&lt;/a&gt;</span></pre><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi mv"><img src="../Images/c0e1c1113078b80eae1b72a9b19967db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lUxbUwcWLrFarRIDaGpmw.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated"><strong class="bd ll">空白弹出框😪</strong></figcaption></figure><p id="5af0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试了所有可能的方法来绕过这个字符限制，但无法做到这一点。我在这里停止了测试，并在我的<strong class="jp ir">待办事项列表</strong>中保存了关于这个端点的信息，以便在我再次测试这个资产时在这里查看。大约七个月后，我再次开始测试这个资产，并再次在这个端点上工作。现在我注意到我可以上传相册中的多张照片，通过选择相册中的所有照片，<strong class="jp ir">幻灯片显示</strong>选项请求端点更改为<strong class="jp ir">https://subdomain . company . com/Ajax/generatealbumimagelist . ashx？JSON = { albums:[{ " ID ":"&lt;album _ ID&gt;，" value":"on"}]} </strong>，页面来源:-</p><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="3fd0" class="lr ls iq ln b gy lt lu l lv lw">&lt;a href="https://image-link.com/image.jpg" title="xsstest'"&gt;" rel="lightbox[gallery]"&gt;84**00000&lt;/a&gt;&lt;a href="https://image-link.com/image.jpg" title="xsstest'"&gt;" rel="lightbox[gallery]"&gt;84**00001&lt;/a&gt;</span></pre><p id="d708" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以现在我们有多次注射。那么为什么不上传相册中的5张图片，并使用<a class="ae ku" href="https://twitter.com/prial261/status/1172973681200418819" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">我的推文</strong> </a>提到的有效载荷呢？</p><blockquote class="lx ly lz"><p id="2dd2" class="jn jo ma jp b jq jr js jt ju jv jw jx mb jz ka kb mc kd ke kf md kh ki kj kk ij bi translated"><strong class="jp ir">有效载荷:</strong></p></blockquote><ul class=""><li id="a6ee" class="me mf iq jp b jq jr ju jv jy mg kc mh kg mi kk mj mk ml mm bi translated"><strong class="jp ir">第一次注射:</strong> <code class="fe mn mo mp ln b">*/&lt;/script&gt;&lt;!--</code></li><li id="1933" class="me mf iq jp b jq mq ju mr jy ms kc mt kg mu kk mj mk ml mm bi translated"><strong class="jp ir">第二次注射:</strong> <code class="fe mn mo mp ln b">*/.domain)/*xxx</code></li><li id="e220" class="me mf iq jp b jq mq ju mr jy ms kc mt kg mu kk mj mk ml mm bi translated"><strong class="jp ir">第三次注射:</strong> <code class="fe mn mo mp ln b">*/(document/*xx</code></li><li id="59ee" class="me mf iq jp b jq mq ju mr jy ms kc mt kg mu kk mj mk ml mm bi translated"><strong class="jp ir">第四次注射:</strong> <code class="fe mn mo mp ln b">*/prompt/*xxxxx</code></li><li id="cd7f" class="me mf iq jp b jq mq ju mr jy ms kc mt kg mu kk mj mk ml mm bi translated"><strong class="jp ir">第5次注射:</strong> <code class="fe mn mo mp ln b">"&gt;&lt;script&gt;/*xss</code></li></ul><blockquote class="lx ly lz"><p id="4118" class="jn jo ma jp b jq jr js jt ju jv jw jx mb jz ka kb mc kd ke kf md kh ki kj kk ij bi translated"><strong class="jp ir">页面源在最终注入后变成:- </strong></p></blockquote><pre class="kw kx ky kz gt lm ln lo lp aw lq bi"><span id="4eb3" class="lr ls iq ln b gy lt lu l lv lw">&lt;a href="<a class="ae ku" href="https://image-link.com/image.jpg" rel="noopener ugc nofollow" target="_blank">https://image-link.com/image.jpg</a>" title="<strong class="ln ir">"&gt;&lt;script&gt;/*xss</strong>" rel="lightbox[gallery]"&gt;84**00000&lt;/a&gt;&lt;a href="<a class="ae ku" href="https://image-link.com/image.jpg" rel="noopener ugc nofollow" target="_blank">https://image-link.com/image.jpg</a>" title="<strong class="ln ir">*/prompt/*xxxxx</strong>" rel="lightbox[gallery]"&gt;84**00001&lt;/a&gt;&lt;a href="<a class="ae ku" href="https://image-link.com/image.jpg" rel="noopener ugc nofollow" target="_blank">https://image-link.com/image.jpg</a>" title="<strong class="ln ir">*/(document/*xx</strong>" rel="lightbox[gallery]"&gt;84**00002&lt;/a&gt;&lt;a href="<a class="ae ku" href="https://image-link.com/image.jpg" rel="noopener ugc nofollow" target="_blank">https://image-link.com/image.jpg</a>" title="<strong class="ln ir">*/.domain)/*xxx</strong>" rel="lightbox[gallery]"&gt;84**00003&lt;/a&gt;&lt;a href="<a class="ae ku" href="https://image-link.com/image.jpg" rel="noopener ugc nofollow" target="_blank">https://image-link.com/image.jpg</a>" title="<strong class="ln ir">*/&lt;/script&gt;&lt;!--</strong>" rel="lightbox[gallery]"&gt;84**00004&lt;/a&gt;</span></pre><p id="db52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在访问<strong class="jp ir">https://subdomain . company . com/Ajax/generatealbumimagelist . ashx？JSON = { albums:[{ " ID ":"&lt;album _ ID&gt;，" value":"on"}]} </strong>将执行我们使用的有效负载:-</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="gh gi mw"><img src="../Images/2af67b78da6b812b4bc2cec33981f81a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5ikNtfjcBMRolm2Ccg7FQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated"><strong class="bd ll">繁荣😎🔥</strong></figcaption></figure><p id="5bbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你可能会问为什么我在<strong class="jp ir">第二到第五</strong>有效载荷中多次使用<code class="fe mn mo mp ln b">x</code>字符？答案是相册图片是根据名称长度+上传时间排序的。所以我多次使用<code class="fe mn mo mp ln b">x</code>字符来使所有图片名称长度相同，这样当我上传图片时，它会根据图片上传时间排序。</p><p id="8a74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你们喜欢这个。PM我在<a class="ae ku" href="https://twitter.com/prial261/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ma">推特</em> </strong> </a>或<a class="ae ku" href="https://www.facebook.com/prial261" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">脸书</strong> </a>如果你有任何问题。</p><p id="8b8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ma"># Stay _ Home<br/># Stay _ Safe<br/># Wash _ Your _ Hand _ frequency<br/># Hack _ The _ Planet</em><strong class="jp ir">🔥</strong></p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="41eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ma">关注</em> <a class="ae ku" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="ma"> Infosec报道</em> </a> <em class="ma">获取更多此类精彩报道。</em></p><div class="ne nf gp gr ng nh"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="ni ab fo"><div class="nj ab nk cl cj nl"><h2 class="bd ir gy z fp nm fr fs nn fu fw ip bi translated">信息安全报道</h2><div class="no l"><h3 class="bd b gy z fp nm fr fs nn fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="np l"><p class="bd b dl z fp nm fr fs nn fu fw dk translated">medium.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv lf nh"/></div></div></a></div></div></div>    
</body>
</html>