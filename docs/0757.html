<html>
<head>
<title>Cache poisoning of wget</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">wget的缓存中毒</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cache-poisoning-of-wget-94a4d70104b1?source=collection_archive---------1-----------------------#2020-08-12">https://infosecwriteups.com/cache-poisoning-of-wget-94a4d70104b1?source=collection_archive---------1-----------------------#2020-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6605dc46623071e57406005dac4700b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6sMfBC_W_hCOGejER3YlNw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">(编辑以隐藏受影响的公司)缓存病毒检测的真实示例</figcaption></figure><p id="1560" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">另一个有趣的缓存中毒案例(你可以在这里阅读第一个<a class="ae ld" href="https://medium.com/bugbountywriteup/cache-poisoning-with-xss-a-peculiar-case-eb5973850814" rel="noopener"/>)。然而，这一个没有前一个“性感”。你已经被警告了。</p><p id="042c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">有时候，burp和web浏览器(无论是firefox还是chrome)在如何呈现对发出的请求的响应上不太一致(特别是当请求有xss有效负载时)。这是其中的一个故事。</p><p id="719b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我搜索bug的默认方法是用burp作为代理浏览目标网站。而且，如果waf是如此的友好，我可以在不被阻止的情况下启用Param Miner，并且选中“尝试缓存中毒”复选框。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/0f5b51988f4578f48bd062a3cd1f2135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4lwSeSCcUSSXrBQr7L-tsA.png"/></div></div></figure><p id="416a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">而且，如果web服务器配置不正确，或者老实说，如果星星是对齐的，结果是一个有用的缓存毒药，就像前面的链接一样。但是，这不是故事。不是说这个故事里的案例没用，只是更难卖而已。</p><p id="9375" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">闲聊/阐述到此为止，让我们深入探讨:</strong></p><p id="7cd2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在浏览了目标网站并做了各种测试后，一无所获，我想是时候复习了。我检查了burp pro仪表板，作为一个很好的激励，我注意到Param Miner发现了一些东西。但是，根据过去的经验，我已经知道现在兴奋还为时过早。</p><p id="c8cf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在回顾了这一发现，并做了一些额外的测试以确保它不是可怕的假阳性，我发现自己与缓存毒药是一个开放的重定向，但更好。访问website.com会将访问者/受害者重定向到我在隐藏标题中指定的内容。最初的影响:DoS的一个版本，但它不是通过使服务器崩溃来拒绝服务，而是通过将用户重定向到另一个网站来拒绝服务。其他影响可能是网络钓鱼，具体取决于各种因素。但是，唉，我很快就知道了一个丑陋的事实。</p><p id="aa5d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">打嗝复读机v网络浏览器:</strong></p><p id="cc3a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我喜欢在任何网络浏览器上使用burp repeater来搜索bug。我可以立即看到页面的源代码、响应时间(在测试基于时间的sqli/rce时很有用)、标题(在测试cors、csrf时很有用)，并且响应上有一个很好的搜索框功能(当文本改变时自动滚动以匹配，在其他事情中对xss测试很有用)。</p><p id="bc36" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">但是，虽然响应甚至可以在html代码中显示您的xss有效负载没有编码，甚至在浏览器中显示响应也可能导致xss触发，但它可能是误报。唯一确定的方法是直接在firefox、chrome等中尝试带有xss有效负载的url。如果它仍然能在一个或多个浏览器中运行，那就很好。该写报告了。否则，事情就复杂了。</p><p id="5f1a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">有限制的概念验证:</strong></p><p id="7a84" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">问题中的隐藏标头— x-forwarded-scheme</p><p id="cb6f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用curl作为毒害缓存的方法的攻击(必须重复多次，或者可以包装在一个循环中):</p><p id="5428" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">curl-header " x-forwarded-scheme:https://burp collab . net "<a class="ae ld" href="https://website.com/" rel="noopener ugc nofollow" target="_blank">https://website.com/</a></p><p id="0af6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">结果:</p><p id="d96c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">https://website.com卷曲<a class="ae ld" href="https://website.com/" rel="noopener ugc nofollow" target="_blank">显示https://burpcollab.net</a><a class="ae ld" href="https://burpcollab.net/" rel="noopener ugc nofollow" target="_blank">内容</a></p><p id="0d9b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">wget<a class="ae ld" href="https://website.com/" rel="noopener ugc nofollow" target="_blank">https://website.com</a>保存一个文件，内容为<a class="ae ld" href="https://burpcollab.net/" rel="noopener ugc nofollow" target="_blank">https://burpcollab.net</a></p><p id="f84b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">PoC结果中缺少什么？你发现了吗？同样的事情，但有一个浏览器。显然，这不仅仅是因为它需要用gif或youtube剪辑进行一些熟练的编辑，还因为它不能在浏览器上工作。我尝试了所有的浏览器，总是得到同样无聊的回应。</p><p id="8dd5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">还有一些更多的限制:</strong></p><p id="72cd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">除了它只能与curl和wget一起工作，没有尝试telnet和类似的，还有另一个限制。X-forwarded-scheme其实就是http或者https。类似于x-forwarded-proto。也就是说，不是拥有<a class="ae ld" href="https://website.com/" rel="noopener ugc nofollow" target="_blank">https://website.com</a>，值为<a class="ae ld" href="https://burpcollab.net/" rel="noopener ugc nofollow" target="_blank">https://burpcollab.net</a>，结果是重定向到<a class="ae ld" href="https://burpcollab.net://website.com" rel="noopener ugc nofollow" target="_blank">https://burpcollab . net://website . com</a>(而不是<a class="ae ld" href="https://website.com/" rel="noopener ugc nofollow" target="_blank">https://website.com</a>或<a class="ae ld" href="http://website.com/" rel="noopener ugc nofollow" target="_blank">http://website.com</a>)，并且burpcollaborator被配置为忽略所有类型的畸形请求。因此://website.com部分被忽略。解决方案是以#或%23结尾的有效负载，这取决于另一端如何解释它。</p><p id="9b3c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">额外收获:还有一个限制是，攻击者的网站必须是ssl/https，无论出于什么原因，它都不能与http一起工作。</p><p id="acea" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">如何利用？</strong></p><p id="983b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">不容易。攻击者必须以某种方式欺骗受害者使用wget访问相关网站，然后在不验证其内容的情况下打开下载的html文件，而事实上，该html文件将包含xss有效负载，如<a class="ae ld" href="https://beefproject.com/" rel="noopener ugc nofollow" target="_blank"> BeEF </a>或类似内容，这样攻击者就可以控制受害者的浏览器。但这太牵强了。然而，我已经试着这样卖了。我记得，当我写下痛苦的复制步骤和直接来自好莱坞电影的场景时(jk，但你明白这一点)，我非常确定我只是在做一些写作/打字练习。不过，我确实得到了一些不错的荣誉点数:)</p></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><p id="89ef" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">不是所有的虫子都值得悬赏，但是别忘了，猎虫子是为了乐趣和利益，而不仅仅是利益，除非利益也是知识。</p><p id="26bf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">参考资料:【https://portswigger.net/web-security/web-cache-poisoning T2】</p></div></div>    
</body>
</html>