<html>
<head>
<title>Log4j Exploitation Walkthrough(CVE-2021–44228) — INE Labs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Log4j开发演练(CVE-2021–44228)—INE实验室</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/log4j-exploitation-walkthrough-cve-2021-44228-ine-labs-f883a6afa6db?source=collection_archive---------2-----------------------#2021-12-18">https://infosecwriteups.com/log4j-exploitation-walkthrough-cve-2021-44228-ine-labs-f883a6afa6db?source=collection_archive---------2-----------------------#2021-12-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="22af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">软件开发人员使用Log4j框架来记录用户活动和应用程序的行为，以供后续审查。下面是log4j的工作原理。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2560d576d46da162587b8625807cdbbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bB35myXt4lphx3da.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图片来自GovCERT.ch</figcaption></figure><p id="68e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试着利用INE实验室的Log4j，如果你想尝试，点击这里的链接<a class="ae lb" href="https://my.ine.com/CyberSecurity/courses/ebd09929/log4j-vulnerability-log4shell" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="5b5e" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated"><strong class="ak">第一阶段——信息收集</strong></h2><ol class=""><li id="cb91" class="lv lw iq jp b jq lx ju ly jy lz kc ma kg mb kk mc md me mf bi translated">将demo.ine.local作为有漏洞的服务器打开。</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mg"><img src="../Images/e86d6470bcd776a438ff608e01b728db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GXaNO3wmmXenmPO6WKP1Rw.png"/></div></div></figure><p id="4dee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.尝试登录，我们看到web服务器可以访问命令。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mh"><img src="../Images/0d4b7f890682d74e6e4c62a475089093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQmnuJIvxCodx7Bd6Abs7A.png"/></div></div></figure><p id="43c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.用nmap -sV <target>收集信息，寻找web服务器版本，我们得到了包含log4j的Tomcat 8.5.3。</target></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mi"><img src="../Images/1fab61f8d3c71a04b7fdef0d703e7f45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4D71xnVeLPsxfwVNUFFzJw.png"/></div></div></figure><h2 id="3901" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated"><strong class="ak">第二阶段—概念验证</strong></h2><ol class=""><li id="237e" class="lv lw iq jp b jq lx ju ly jy lz kc ma kg mb kk mc md me mf bi translated">在端口1234上设置netcat监听器</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mj"><img src="../Images/46b81d89322db73b6312bdb89eabeed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8a40jHT0J3haeyBlMKcaoQ.png"/></div></div></figure><p id="3135" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.使用curl和log4j有效负载向端口1234发出http请求</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mk"><img src="../Images/af8ef64a004798a32fad41bb6edefa73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-_fvfL5CMLnBLHkO-i8yg.png"/></div></div></figure><p id="867c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.Netcat用随机字符获得一些连接，因为有效负载需要ldap服务器。所以，这意味着我们可以利用log4j的方式:)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/7262543559203569ec96928ba471a0da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQU-A7NQBDUp7HBAaAmH6g.png"/></div></div></figure><h2 id="43c8" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated"><strong class="ak">阶段3 —利用log4j </strong></h2><ol class=""><li id="4562" class="lv lw iq jp b jq lx ju ly jy lz kc ma kg mb kk mc md me mf bi translated">运行恶意的LDAP参考服务器和包含java漏洞类的恶意http服务器。</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/fa41e2f0f7524c10a9daa5714cae6c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r98EaY85Jz-gRlWY0BHHgA.png"/></div></div></figure><p id="65af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.用Exploit.java创建反向壳</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/73da40fbbe6765e0234f8562d83839d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*lcRvZwry37Ks1CBC1_ZuQw.png"/></div></figure><p id="cb72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.用源java版本8和目标java版本8编译java文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/7dd945bcd57a4c3c8933096f0367b651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qeuCVKziigi2nZIEcZ6SRA.png"/></div></div></figure><p id="f4a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.在端口8080上创建简单的python http服务器</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mp"><img src="../Images/a5e43bfd7a29a9617f54d93a0eb635dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJuXd1f--kMXgiP0CkNMhQ.png"/></div></div></figure><p id="bc03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.在端口<strong class="jp ir"> 1111上设置netcat监听器。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/5c3a84aad60b73698ebfc597c94eb300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*nVUSjUn4S9ebynzchdDUXg.png"/></div></figure><p id="f502" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.使用curl和ldap服务器运行完整的jndi有效负载</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/b64863bdf38e86b9ade51a44e761456a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ZVYb_jTSdP0x5RQ69Q6BA.png"/></div></div></figure><p id="d95f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.LDAP参考服务器接收连接并重定向到我们的http服务器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ms"><img src="../Images/9a0042bb22bf1f48efee9c1fc0520ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDyUaTLmQBSM_OyHvAZvhA.png"/></div></div></figure><p id="edcc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.Http服务器接收连接</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/667296ce2da08cef5dab3d260ed80aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7goYQAn3rUhH3g4oE2PLOA.png"/></div></div></figure><p id="cc2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.Netcat监听器也有连接。运行python稳定器，获得一个方便的shell。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mu"><img src="../Images/cc2e88a64174c5a36b8032542d7e8e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vmk42ScsXDqAlaieL6UwVA.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/54ab720241c806e0b5ad1b8b436e416b.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*V5X0v94X5tlaTZclRM6xeg.png"/></div></figure><h2 id="c4a8" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">结论</h2><p id="267b" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy mw ka kb kc mx ke kf kg my ki kj kk ij bi translated">Log4j与CVE-2021–44228是2021年底的一个著名漏洞。如此多的应用程序受到影响，因为使用java版本8和log4j 2，有人会利用此漏洞获得RCE(远程代码执行)。<br/>今天学到了什么？<br/>不断学习的人..</p><p id="e9a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢</p></div></div>    
</body>
</html>