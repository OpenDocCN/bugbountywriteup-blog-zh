<html>
<head>
<title>How to Install Elastic Stack on Ubuntu 22.04 LTS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Ubuntu 22.04 LTS上安装弹性堆栈</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-to-install-elastic-stack-on-ubuntu-22-04-lts-a2f1b00eced?source=collection_archive---------0-----------------------#2022-07-28">https://infosecwriteups.com/how-to-install-elastic-stack-on-ubuntu-22-04-lts-a2f1b00eced?source=collection_archive---------0-----------------------#2022-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c99af8b5271ef7fce99ca59bde239adb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NuWVQu34L5YWWAh_.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://blog.knoldus.com/how-to-deploy-elk-stack-on-kubernetes/" rel="noopener ugc nofollow" target="_blank">图像来源</a></figcaption></figure><p id="d99c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">什么是弹性叠加？</strong></p><p id="a4e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">被称为elk stack的elastic stack是一组免费的开源工具，旨在实时收集数据、分析和可视化。工具说明如下:</p><ul class=""><li id="495b" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">Elasticsearch —用于在弹性数据库中存储数据</li><li id="bf58" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">Logstash —用于从不同来源收集数据</li><li id="d998" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">Kibana —用于可视化弹性搜索中存储的数据</li></ul><p id="7934" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">*安装ELK SIEM***</p><h2 id="8726" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"># 1:安装所需的模块</h2><p id="710f" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">更新系统包；<br/> <code class="fe mn mo mp mq b">sudo apt-get update</code></p><p id="18c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">先安装openjdk等依赖，再安装elastic stack<br/><code class="fe mn mo mp mq b">sudo apt-get install openjdk-11-jdk</code><br/><br/><code class="fe mn mo mp mq b">sudo apt-get install apt-transport-https</code><br/><code class="fe mn mo mp mq b">sudo apt-get install curl</code><br/><code class="fe mn mo mp mq b">sudo apt-get install gnupg2</code></p><p id="6d4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在一个命令中安装上面列出的所有模块；<br/> <code class="fe mn mo mp mq b">sudo apt-get install openjdk-11-jdk wget apt-transport-https curl gnupg2 -y</code></p><p id="a4bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查java版本；<br/> <code class="fe mn mo mp mq b">java -version</code></p><h2 id="3f81" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"># 2:在Ubuntu上安装和配置ElasticSearch</h2><p id="af53" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">首先，我们必须添加一个签名密钥，并且必须在我们的系统中添加存储库，因为Elasticsearch没有预装在Ubuntu中，我们必须手动完成。</p><p id="1213" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">按照以下命令添加elasticsearch签名密钥；<br/> <code class="fe mn mo mp mq b">wget -qO — <a class="ae kc" href="https://artifacts.elastic.co/GPG-KEY-elasticsearch" rel="noopener ugc nofollow" target="_blank">https://artifacts.elastic.co/GPG-KEY-elasticsearch</a> — no-check-certificate | sudo apt-key add -</code></p><p id="095b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来使用下面的命令将存储库添加到/etc/apt/sources . list . d/elastic-7 . x . list中；<br/> <code class="fe mn mo mp mq b">echo “deb <a class="ae kc" href="https://artifacts.elastic.co/packages/7.x/apt" rel="noopener ugc nofollow" target="_blank">https://artifacts.elastic.co/packages/7.x/apt</a> stable main” | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list</code></p><p id="db56" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行回购后，更新系统包；<br/> <code class="fe mn mo mp mq b">sudo apt-get update -y</code></p><p id="645d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装elasticsearch<br/> <code class="fe mn mo mp mq b">sudo apt-get install elasticsearch -y</code></p><p id="79fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对elesticsearch配置文件进行修改；<br/> <code class="fe mn mo mp mq b">sudo nano /etc/elasticsearch/elasticsearch.yml</code></p><p id="dce4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在“网络”部分更改这些行；<br/> <code class="fe mn mo mp mq b">network.host: localhost<br/>#http.port: 9200(remove ‘#’ here)</code></p><p id="f5ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在“发现”部分添加此行；<br/> <code class="fe mn mo mp mq b">discovery.type: single-node</code></p><p id="e8fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保存配置文件并退出。</p><p id="0870" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动elacticsearch服务；<br/> <code class="fe mn mo mp mq b">sudo systemctl start elasticsearch</code></p><p id="b1f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在系统启动时启用elacticsearch<br/> <code class="fe mn mo mp mq b">sudo systemctl enable elasticsearch</code></p><p id="6f62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查elasticsearch服务状态；<br/> <code class="fe mn mo mp mq b">sudo systemctl status elasticsearch</code></p><h2 id="2e97" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"># 3:在Ubuntu上安装和配置Kibana</h2><p id="25bc" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">在Ubuntu上安装kibana<br/>T3】</p><p id="3eb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对kibana配置文件进行修改；<br/> <code class="fe mn mo mp mq b">sudo nano /etc/kibana/kibana.yml</code></p><p id="6d5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">删除以下行中的“#”；<br/> <code class="fe mn mo mp mq b">server.port: 5601<br/>server.host: “localhost”<br/>elasticsearch.hosts: [“<a class="ae kc" href="http://localhost:9200" rel="noopener ugc nofollow" target="_blank">http://localhost:9200</a>"]</code></p><p id="0717" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保存配置文件并退出。</p><p id="fce7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动基巴纳服务；<br/> <code class="fe mn mo mp mq b">sudo systemctl start kibana</code></p><p id="d424" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在系统启动时启用kibana<br/> <code class="fe mn mo mp mq b">sudo systemctl enable kibana</code></p><p id="c26d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查kibana服务的状态；<br/> <code class="fe mn mo mp mq b">sudo systemctl status kibana</code></p><h2 id="27ca" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"># 4:在Ubuntu上安装和配置Logstash</h2><p id="e1b4" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">在ubuntu上安装logstash<br/> <code class="fe mn mo mp mq b">sudo apt-get install logstash</code></p><p id="5933" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建下面的配置文件并插入下面的行来加载日志存储节拍；<br/> <code class="fe mn mo mp mq b">sudo nano /etc/logstash/conf.d/2-beats-input.conf</code></p><blockquote class="mr ms mt"><p id="04e4" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">输入{</p><p id="1f72" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">节拍{</p><p id="0ae8" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">端口=&gt; 5044</p><p id="8675" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi">}</p><p id="c0cc" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi">}</p></blockquote><p id="ae11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保存并关闭文件。</p><p id="b093" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建下面的配置文件并插入以下行来过滤logstash输入并生成输出；<br/> <code class="fe mn mo mp mq b">sudo nano /etc/logstash/conf.d/2-elasticsearch-output.conf</code></p><blockquote class="mr ms mt"><p id="074a" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">输出{</p><p id="1c5a" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">弹性搜索{</p><p id="11ef" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">hosts =&gt; ["localhost:9200"]</p><p id="df34" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">管理模板= &gt;假</p><p id="dd12" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi translated">index = &gt; " {[<a class="ae kc" href="http://twitter.com/metadata" rel="noopener ugc nofollow" target="_blank">@元数据</a>][节拍]}-% {[<a class="ae kc" href="http://twitter.com/metadata" rel="noopener ugc nofollow" target="_blank">@元数据</a>][版本]}-%{+YYYY。MM.dd} "</p><p id="6879" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi">}</p><p id="f205" class="kd ke mu kf b kg kh ki kj kk kl km kn mv kp kq kr mw kt ku kv mx kx ky kz la ij bi">}</p></blockquote><p id="7ce9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保存并关闭编辑器。</p><p id="1191" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动logstash服务；<br/> <code class="fe mn mo mp mq b">sudo systemctl start logstash</code></p><p id="d79f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在系统启动时启用logstash<br/> <code class="fe mn mo mp mq b">sudo systemctl enable logstash</code></p><p id="d867" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">停止logstash服务；<br/> <code class="fe mn mo mp mq b">sudo systemctl stop logstash</code>(除非必要，否则不要运行)</p><p id="a66c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查日志的状态；<br/> <code class="fe mn mo mp mq b">sudo systemctl status logstash</code></p><h2 id="fc17" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"># 5:在Ubuntu上安装和配置Filebeat</h2><p id="1011" class="pw-post-body-paragraph kd ke iq kf b kg mi ki kj kk mj km kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">安装Filebeat将日志发送到Logstash<br/> <code class="fe mn mo mp mq b">sudo apt-get install filebeat</code></p><p id="c848" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对filebeat配置文件进行修改；<br/> <code class="fe mn mo mp mq b">sudo nano /etc/filebeat/filebeat.yml</code></p><p id="8fad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注释下面的行</p><p id="4a9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mn mo mp mq b">#output.elasticsearch:<br/> #Array of hosts to connect to.<br/> #hosts: [“localhost:9200”]</code></p><p id="18de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">取消下列行的注释</p><p id="af24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mn mo mp mq b">output.logstash:<br/>hosts: [“localhost:5044”]</code></p><p id="6478" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保存并退出编辑器。</p><p id="50c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动filebeat服务；<br/> <code class="fe mn mo mp mq b">sudo systemctl start filebeat</code></p><p id="ca75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在系统启动时启用filebeat<br/>T3】</p><p id="072e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查filebeat服务的状态；<br/> <code class="fe mn mo mp mq b">sudo systemctl status filebeat</code></p><p id="835d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启用filebeat系统模块；<br/>T5】</p><p id="c233" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启用filebeat logstash模块；<br/> <code class="fe mn mo mp mq b">sudo filebeat modules enable logstash</code></p><p id="0c5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">加载索引模板；<br/> <code class="fe mn mo mp mq b">filebeat setup — index-management -E output.logstash.enabled=false -E ‘output.elasticsearch.hosts=[“localhost:9200”]’</code></p><p id="c82a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动filebeat服务；<br/> <code class="fe mn mo mp mq b">sudo service filebeat start</code></p><p id="7fea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查elasticsearch是否正在从filebeat接收datalog<br/> <code class="fe mn mo mp mq b">curl -XGET <a class="ae kc" href="http://localhost:9200/_cat/indices?v" rel="noopener ugc nofollow" target="_blank">http://localhost:9200/_cat/indices?v</a></code></p><p id="5d8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用网址<br/><a class="ae kc" href="http://localhost:5601" rel="noopener ugc nofollow" target="_blank">http://localhost:5601</a>访问基巴纳网络界面</p><p id="6dde" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果集成检查出现错误，执行以下命令<br/>启用filebeat kibana模块；<br/> <code class="fe mn mo mp mq b">sudo filebeat modules enable kibana</code></p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="d80c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在YouTube上观看分步指南；</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="b972" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你喜欢这篇文章，请给我一两个掌声</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="7da2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mu">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae kc" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mu">加入我们的每周简讯</em> </strong> </a> <em class="mu">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>