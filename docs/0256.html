<html>
<head>
<title>Jumping Over The Fence</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跳过栅栏</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/jumping-over-the-fence-ce0fe5f9a3a2?source=collection_archive---------0-----------------------#2019-02-05">https://infosecwriteups.com/jumping-over-the-fence-ce0fe5f9a3a2?source=collection_archive---------0-----------------------#2019-02-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f45f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:以下文章发表于2016年13月9日https://FogMarks.com</em><a class="ae km" href="https://fogmarks.com/2016/09/13/jumping-over-the-fence/" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/3681b13cf2f0e93f0372115d6ca3d9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eiaZKbFGY7EnVnss"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">鸣谢:谷歌图片</figcaption></figure><blockquote class="ld le lf"><p id="11e7" class="jn jo kl jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">“栅栏是用来被跳过的”——约翰·多伊</p></blockquote><p id="5e03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi lj translated"><span class="l lk ll lm bm ln lo lp lq lr di">正如</span> <br/>你可能已经猜到了(或者没有猜到)，今天的案例研究是关于开放重定向，以及绕过为防止它们而设计的机制。好玩！</p><p id="9132" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经和你分享了我对开放重定向及其对网站总体安全的影响的想法。<br/>现在是展示如何通过操纵AOR(反开放重定向)机制实现开放重定向的时候了。</p><p id="65bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大AOR的一个很好的例子是脸书的linkshim系统。它基本上是在脸书上发布的每个URL上附加一个访问令牌。<br/>访问令牌是个人，因此只有现在查看链接的用户可以点击它并被重定向到它的目的地；其他人没有。此外，linkshim机制检查用户的目的地，并防止用户被重定向到恶意网站。是的，很酷。</p><h1 id="8126" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">嗯，直到现在阳光明媚，我们都在海滩上玩得很开心</h1><p id="2f28" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">把啤酒递给我，好吗？<br/>但是，当我们如此信任的责任区机制被操纵而采取不同的行动时，会发生什么？这正是我们今天要见证的。</p><p id="9e28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">遗憾的是，大多数使用AOR的网站只管理发布给它们的链接<strong class="jp ir">，如果这些链接是第三方网站的话。这意味着，如果我在x.com网站上发布了一个到x.com网站的链接，这个链接将会出现在x . com上:x.com/out?url=y.com</strong></p><p id="21be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是如果我发布一个指向同一个域名的链接(在x.com上发布x.com/blabla ),链接会显示为:x.com/blabla</p><p id="f687" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发生这种情况的原因是因为网站通常相信自己会在内部重定向用户。他们认为将访问令牌附加到将用户重定向到同一个域的链接上是“安全的”和“无意义的”。你可以像很多人一样同意他们的观点。我已经无数次听到这样的说法:“如果某个页面容易受到开放重定向的攻击，那么就没有理由检查到它的重定向”。但现在我要彻底改变这种想法。</p><h1 id="0bdd" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">一个非常受欢迎的设计网站</h1><p id="a40e" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">不幸的是，我不能透露它的名字，它有这个确切的弱点。该网站允许“内部链接”在没有任何访问令牌或验证的情况下被重定向，但要求推荐者是同一个域。相当聪明。<br/>但是AOR机制允许任何内部链接被重定向，<strong class="jp ir">只要它的域名是该公司的域名或子域之一。</strong></p><p id="559e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用一个域枚举软件，我能够检测到网站的一个子域，其中包含该公司员工的邮件服务，并且<strong class="jp ir">该邮件服务在其注销页面上有一个开放重定向漏洞</strong>——即使用户没有登录，当注销页面被访问时，带有“重定向后”GET参数，用户被重定向到任何其他页面，甚至是第三方网站。顺便说一下，邮件服务并不认为这种行为是开放重定向漏洞。去想想。</p><p id="e28a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我在一个子域页面上有了一个开放的重定向，我怎样才能让它从主域上落下来呢？</p><p id="52e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">答案很简单——我将简单地利用AOR机制的逻辑缺陷将用户重定向到子域，并从那里重定向到第三方站点。</p><p id="be6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但还是有一个问题——正如我之前所说，AOR机制允许链接被重定向到一个子域，但前提是引用者是同一个网站。</p><h1 id="7350" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated"><strong class="ak">那么我做了什么？</strong></h1><p id="65e1" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated"><strong class="jp ir">我只是将用户重定向到同一个页面，然后他再次被重定向。</strong></p><p id="1782" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:<br/>如果2个易受攻击的页面是:<br/> <strong class="jp ir">易受攻击的邮件服务:</strong><a class="ae km" href="http://mail.x.com/out?url=y.com" rel="noopener ugc nofollow" target="_blank">http://mail.x.com/out?url=y.com</a><br/><strong class="jp ir">【域内易受攻击的】页面:</strong>【http://x.com/redirect?to=mail.x.com/out?url=y.com】T21</p><p id="de17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二页要求推荐人标题来自from，我只是发布了以下网址:</p><p id="594e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="http://x.com/redirect?to=x.com/redirect?to=mail.x.com/out?url=y.com" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">http://x.com/redirect?to=x.com/redirect？to=mail.x.com/out？URL = y . com</strong>T26】</a></p><p id="0418" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。</p><p id="b8e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个AOR机制中简单易用的逻辑缺陷的例子。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mv"><img src="../Images/b800e701dc2fdf5a2232b6f9bb0b05ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FXP2-FmMDKiw9OBr.png"/></div></div></figure><p id="b8f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一如既往，</p><p id="d9ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干杯！</p></div></div>    
</body>
</html>