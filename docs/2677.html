<html>
<head>
<title>Understanding Memcache Injection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解Memcache注入</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/understanding-memcache-injection-d4d8f57595f0?source=collection_archive---------6-----------------------#2022-12-20">https://infosecwriteups.com/understanding-memcache-injection-d4d8f57595f0?source=collection_archive---------6-----------------------#2022-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/83a6c562261eb9962add5330e7c6b512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fk3p9socaQoznWDIYSZYUQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">工程</figcaption></figure><p id="203c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在本文中，我将讨论memcached注入。Memcache注入是一种针对Memcache分布式内存缓存系统的注入攻击。Memcache是一个流行的系统，用于在分布式缓存中存储和检索数据，以提高web应用程序的速度。</p><p id="040a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在Memcache注入攻击中，攻击者可以向使用Memcache的web应用程序发送恶意数据，然后将这些数据存储在缓存中。恶意数据可以是web应用程序从缓存中检索数据时执行的命令或查询的形式。这使得攻击者能够未经授权访问敏感信息，修改或删除数据，或者执行其他恶意操作。</p><p id="d81f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了防止Memcache注入攻击，在将用户提供的输入存储到缓存中之前，对其进行适当的净化是非常重要的。这可以通过使用<code class="fe la lb lc ld b">mysql_real_escape_string</code>或<code class="fe la lb lc ld b">addslashes</code>等函数来转义在Memcache上下文中有特殊含义的特殊字符来实现。</p><p id="51f4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用准备好的语句和参数化的查询将数据从查询中分离出来，并使用强密钥哈希函数来确保密钥是唯一的并且不容易被攻击者猜到，这也是一个好主意。</p><p id="7770" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">此外，您应该使Memcache服务器和任何其他依赖项保持最新，以确保您免受已知漏洞的攻击。</p><p id="8fb7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">总之，Memcache注入是一种针对Memcache系统的注入攻击。为了防止这种类型的攻击，正确地净化用户提供的输入、使用准备好的语句和参数化的查询，以及保持Memcache服务器和依赖项最新是很重要的。</p><p id="c3ac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面是PHP中Memcache注入攻击的一个例子:</p><pre class="le lf lg lh gt li ld lj bn lk ll bi"><span id="fda7" class="lm ln iq ld b be lo lp l lq lr">$key = $_POST['key'];<br/>$value = $_POST['value'];<br/><br/>// The attacker can send a key that includes a command or query<br/>// For example: "key; delete users; key"<br/><br/>$memcache = new Memcache();<br/>$memcache-&gt;connect('localhost', 11211);<br/>$memcache-&gt;set($key, $value);<br/><br/>// The malicious command or query will be stored in the cache and may be executed later</span></pre><p id="0b81" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了防止这种类型的攻击，您可以通过转义在Memcache上下文中有特殊含义的特殊字符来净化用户提供的输入。例如:</p><pre class="le lf lg lh gt li ld lj bn lk ll bi"><span id="ee3b" class="lm ln iq ld b be lo lp l lq lr">$safe_key = addslashes($_POST['key']);<br/>$safe_value = addslashes($_POST['value']);<br/><br/>$memcache = new Memcache();<br/>$memcache-&gt;connect('localhost', 11211);<br/>$memcache-&gt;set($safe_key, $safe_value);</span></pre><p id="d4a3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">值得注意的是，从PHP 7.4开始，<code class="fe la lb lc ld b">mysql_real_escape_string</code>和<code class="fe la lb lc ld b">addslashes</code>都被弃用，不应再使用。相反，您应该使用准备好的语句和参数化的查询，它们更安全、更易于使用。预处理语句允许您将数据从查询中分离出来，数据库引擎会自动处理数据的正确转义。</p><p id="61f9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">要在Memcache中使用预处理语句和参数化查询，可以使用带有<code class="fe la lb lc ld b">MEMCACHE_COMPRESSED</code>标志的<code class="fe la lb lc ld b">memcache_set</code>函数。</p><p id="f8a5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">例如:</p><pre class="le lf lg lh gt li ld lj bn lk ll bi"><span id="c85b" class="lm ln iq ld b be lo lp l lq lr">$memcache = new Memcache();<br/>$memcache-&gt;connect('localhost', 11211);<br/><br/>$stmt = $memcache-&gt;prepare("set key:? 0 600 9");<br/>$stmt-&gt;bind_param("s", $key);<br/>$stmt-&gt;send_long_data(0, $value);<br/>$stmt-&gt;execute();</span></pre><p id="debd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">总之，正确清理用户提供的输入以防止Memcache注入攻击是很重要的。您可以使用预处理语句和参数化查询将数据从查询中分离出来，并确保数据被正确转义。</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/0f6294b80b7b0d843996809af6a00bc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*wNGiiV0LVOIhWEjqfLZoUw.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">运河加</figcaption></figure><p id="dfd2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章中，我谈到了memcached注射，在我的下一篇文章中再见，照顾好自己。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h2 id="975c" class="ma ln iq bd mb mc md dn me mf mg dp mh kn mi mj mk kr ml mm mn kv mo mp mq mr bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae ms" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>