<html>
<head>
<title>CyberTalent — Exploiting MS17_010(Eternal Blue) on a Remote Server(Mature Blue Lab)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CyberTalent —利用远程服务器上的MS17_010(永恒之蓝)(成熟之蓝实验室)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cybertalent-exploiting-ms17-010-eternal-blue-on-a-remote-server-mature-blue-lab-18dee68da431?source=collection_archive---------2-----------------------#2021-07-07">https://infosecwriteups.com/cybertalent-exploiting-ms17-010-eternal-blue-on-a-remote-server-mature-blue-lab-18dee68da431?source=collection_archive---------2-----------------------#2021-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0375d4dabbc17dcb99306813f6b81c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gruWm7TwnL-qT3Psk7HtPg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:https://www.cybertalents.com</figcaption></figure><blockquote class="kc kd ke"><p id="7983" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">成熟蓝是cyber talent上被评为难搞机器的机器。它呈现了一个微软漏洞(CVE-2017–0143)。今天(2021年7月6日)，我将利用这台IP地址为18.193.114.151<strong class="ki ir">的机器。</strong></p></blockquote><p id="5b57" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated"><strong class="ki ir">枚举</strong></p><p id="c397" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated"><strong class="ki ir"> Nmap </strong></p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/37f4ff3a4f48f864d85d429a786bcf15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J8Va70pVALesJXyKdLrMlQ.png"/></div></div></figure><p id="9abc" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">所以我对机器的前1000个端口进行了端口扫描，发现有3个端口是打开的。之后，我不得不使用Nmap脚本引擎和Nmap版本扫描对我发现的开放端口进行更多的枚举。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/3b9ec5f32decf1cc8ea83185657a5fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iF9BUF0KtLZs9PjBJ4DCsw.png"/></div></div></figure><p id="1ad0" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">根据我们的结果，我们有1个漏洞<a class="ae ln" href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2017-0143#:~:text=A%20remote%20code%20execution%20vulnerability,code%20on%20the%20target%20server." rel="noopener ugc nofollow" target="_blank">CVE-2017–0143</a>(也称为MS17_010)。在谷歌上简单搜索，我们可以看到CVE-2017–0413是微软一个名为永恒之蓝的流行漏洞，允许远程代码执行。永恒之蓝看起来多汁，所以我决定尝试一下。</p><p id="0951" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated"><strong class="ki ir">剥削</strong></p><p id="ef19" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated"><strong class="ki ir"> Metasploit </strong></p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/01296ab79d1511a55e5828ac7d0371bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1YrbzXjXzl2uNrkB-Tmc3g.png"/></div></div></figure><p id="9f25" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">我使用<strong class="ki ir">search&lt;keyword&gt;</strong>命令对Metasploit进行了搜索，发现Metasploit上存在几个针对ms17_010的漏洞利用代码。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/24b5c18547eac0f3e0123941b280afe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LklZdu9tgAKGMK6qI3j3Q.png"/></div></div></figure><p id="9886" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">我决定选择“exploit/windows/SMB/ms17 _ 010 _ eternal blue”，查看选项<strong class="ki ir"> LHOST </strong>和<strong class="ki ir"> LPORT </strong>是我感兴趣的，因为我的目标在远程服务器上。如果我将<strong class="ki ir"> LPORT </strong>和<strong class="ki ir"> LHOST </strong>设置到我的本地机器，我的kali防火墙将限制所有来自reverse_shell有效负载的<strong class="ki ir">入站流量</strong>。因此，如果我要获得一个会话，我必须将我的流量通过隧道传输到<a class="ae ln" href="https://ngrok.com/download" rel="noopener ugc nofollow" target="_blank"> <strong class="ki ir"> ngrok </strong> </a>。下载配置好ngrok后，我运行了<strong class="ki ir"> <em class="kh">。/ngrok tcp 4444 </em> </strong>建立隧道。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/2b22042465e55bdaeba8ce391906741c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*HfsmWSPN541Urm0rDGOdIQ.png"/></div></div></figure><p id="b0a6" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">在成功地用ngrok建立了一个隧道之后，我不得不为永恒之蓝漏洞利用设置选项，将ngrok URL用作我的<strong class="ki ir"> LHOST </strong>并将ngrok端口用作我的<strong class="ki ir"> LPORT </strong>。此外，我必须设置我的<strong class="ki ir"> RHOST </strong>和有效载荷。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/56fcd2a082bf3b7d551cb94e7d8c7f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6zhMYzcx0uXt2PLlTXpag.png"/></div></div></figure><p id="6e61" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">我成功地将我的连接隧道化到ngrok，但是如果我要从有效负载获得连接，我必须让ngrok将所有入站流量转发到我的本地机器。为了实现这一点，我打开了另一个metasploit实例来运行另一个侦听器，该侦听器具有与第一个metasploit实例相同的负载。请注意，用于LPORT的端口与用于ngrok命令的端口相同。<strong class="ki ir">T1。/ngrok TCP 4444T3】</strong></p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/aef7a83e0f70ea29f28ab8283177865d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sLLOQQISf0cphjJnq9tQQ.png"/></div></div></figure><p id="6d56" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">在我的multi/handler上运行exploit -j -z之后，我得到了一个“在127.0.0.1:4444上开始反向tcp处理程序”,这是一个好迹象。现在我必须等待，并在我的另一个metasploit实例上运行“exploit”来开始利用。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lt"><img src="../Images/a140e5eb408d8df2ae90254ed168bfb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iBIJZHDZUS2A6oo2xLoWYw.png"/></div></div></figure><p id="27dd" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">等等！！！我在metasploit eternal blue实例上得到一个“fail ”,但是当我查看我的另一个metasploit实例时，我得到一个meterpreter会话。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/0ad2a1e3bce9257d0692526a9cec81fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ptbrSXwbL2ZSBWsvEiDmWw.png"/></div></div></figure><p id="a7af" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated">哦对了，我还找到了旗子。感谢阅读，我希望你喜欢阅读。</p><h1 id="8f03" class="lv lw iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated"><strong class="ak">参考文献</strong></h1><p id="3534" class="pw-post-body-paragraph kf kg iq ki b kj mt kl km kn mu kp kq le mv kt ku lf mw kx ky lg mx lb lc ld ij bi translated"><a class="ae ln" href="https://ngrok.com/download" rel="noopener ugc nofollow" target="_blank">https://ngrok.com/download</a></p><p id="47ba" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated"><a class="ae ln" href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2017-0143#:~:text=A%20remote%20code%20execution%20vulnerability,code%20on%20the%20target%20server" rel="noopener ugc nofollow" target="_blank">https://msrc . Microsoft . com/update-guide/vulnerability/CVE-2017-0143 #:~:text = A % 20 remote % 20 code % 20 execution % 20 vulnerability，code % 20 on % 20 the % 20 target % 20 server</a>。</p><p id="777a" class="pw-post-body-paragraph kf kg iq ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld ij bi translated"><a class="ae ln" href="https://www.exploit-db.com/exploits/41891" rel="noopener ugc nofollow" target="_blank">https://www.exploit-db.com/exploits/41891</a></p></div></div>    
</body>
</html>