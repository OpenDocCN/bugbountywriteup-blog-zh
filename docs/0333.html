<html>
<head>
<title>API — A. P.otentially I.diotic — Threat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">API —潜在威胁</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/api-a-p-otentially-i-diotic-threat-de19b7f3687e?source=collection_archive---------0-----------------------#2019-07-02">https://infosecwriteups.com/api-a-p-otentially-i-diotic-threat-de19b7f3687e?source=collection_archive---------0-----------------------#2019-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8e4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:以下文章发表于2016年12月25日https://FogMarks.com</em><a class="ae km" href="https://fogmarks.com/2016/12/25/api-a-p-otentially-i-diotic-threat/" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/de06d2f4b669e1c45ba2ad9e322f47aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p6rfOhbWXxbw3hhu.jpg"/></div></div></figure><p id="585b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kz translated">祝大家光明节快乐，圣诞快乐！</p><p id="471c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">年底总是总结事情并为下一年设定目标的好时机。当然，也是为了喝个大醉。</p><p id="13cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在今天的假日特别案例研究中，我们将研究一个案例，攻击者可以从一个网站影响整个其他网站，而根本不用访问第二个网站。但在此之前，我们需要谈谈赛尔夫·XSS。</p><p id="3202" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，自我XSS是一个愚蠢的弱点。通常，要受到攻击，受害者需要将“恶意”JS代码粘贴到他们浏览器的开发人员控制台(F12)中，这将导致代码在开发人员控制台所在页面的上下文中执行。<br/>当自我XSS攻击开始时，用户被劝说粘贴JS代码，以便在网站上获得某种“黑客攻击”。为了解决这个问题，直到今天，脸书还会在每个页面的开发者控制台上打印一个警告，以警告用户:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi li"><img src="../Images/ad1b97957b2dfec2d4b0c7080e3fff8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x_oT2s7pKwqa4SDz.png"/></div></div></figure><p id="7451" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为网站无法避免用户向DC(开发者控制台)粘贴恶意JS代码，所以Self XSS (SXSS)漏洞不被认为是高危漏洞。</p><h2 id="d5d7" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">但是今天我们将从一个不同的角度来探讨SXSS</h2><p id="3923" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我们将看到网站如何无辜地误导受害者粘贴攻击者植入的“恶意”JS代码。一些网站允许用户在自己的网站或个人博客中植入HTML或其他类型的代码。这种HTML代码通常由网站自己生成，并在文本框中按原样交给用户。用户所要做的就是简单地复制代码并粘贴到他们想要的位置。<br/>现在，我知道这不是API的准确定义，但在这个案例研究中，这是我对它的解释——一个第三方网站向另一个网站提供提供某种服务的代码。</p><h2 id="0638" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">所以，</h2><p id="877a" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">一些非常有名的公司还不允许我透露它的名字，但已经允许用户从一个用户所属或参与的团体获取包含数据的HTML代码。<br/>当粘贴到网站中时，HTML表示该组中最后的热门消息——它们的标题和消息正文的介绍。</p><p id="1125" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当“恶意”代码被放在标题中时，比如:<code class="fe mh mi mj mk b">"/&gt;&lt;img src=x onerror=alert(1)/&gt;</code> -公司网站上什么也没发生-他们正确地清理并逃脱了整个恶意有效载荷。</p><p id="bc28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">但是！</strong>当HTML表示最后的消息时，根本没有逃脱的余地，突然之间，攻击者可以将恶意JS代码从网站A运行到网站B的上下文中，只需将代码植入他们创建的组消息主题的标题中。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/f9c2215796531a226e36193d46776efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/0*s9laEpWfjw-H2LoV.png"/></div></figure><h2 id="cf67" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated"><strong class="ak">该怪谁？</strong></h2><p id="fe40" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">好吧，这两个网站应该得到一个禁忌的谈话。<br/>网站A提供了一个“API”——HTML代码，该代码显示了来自其自身托管的群组的最后消息，但该API无法正确逃脱恶意有效载荷。但是网站B违反了第一条规则——永远不要相信第三方网站来做你的工作。网站B添加了一个未知的代码(不是作为iframe，而是作为一个脚本),并且没有说明任何基本规则——它盲目地执行给它的代码。</p><h2 id="2437" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">那么我们怎么能相信不可信的人呢？</h2><p id="25c4" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">几周前，某个客户问我这个问题。<br/>她说:</p><blockquote class="mm"><p id="7b3d" class="mn mo iq bd mp mq mr ms mt mu mv kk dk translated">"<strong class="ak">我必须使用不是iframe的第三方代码，我该怎么做才能保证我的网站安全？"</strong></p></blockquote><p id="6a03" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">在你的网站上执行第三方JS代码总是一种不好的做法(当然，我不是在谈论像jQuery或javascript依赖这样的代码，尽管我最近正在写一篇非常有趣的文章来解决这个问题。敬请期待)。我建议的解决方案是:简单地将这段代码植入沙盒页面，然后打开该页面的iframe。就这么简单！</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/468464894701dd65acf2b8b37b65b261.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/0*1szT7pCkZNJjCrft.png"/></div></figure><p id="dfe3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，即使网站A不会像预期的那样逃脱它的内容，沙箱，网站C将是受到打击的一方。<br/>当然，这并不适用于网站B的上下文对于网站A来说是必须的场景，但是它在95%的情况下都是有效的。</p><h2 id="13a5" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">那么，为什么我把这个案例研究的弱点归类为自我XSS呢？</h2><p id="a1cc" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">仅仅因为我相信当你在你的网站上放一个第三方代码的时候，你就是在自我欺骗你自己和你所有的用户。在我看来，自我XSS不仅仅是一个愚蠢的“控制台粘贴”漏洞，它还在自己的环境中使用了未知的第三方JS代码。</p><p id="2dd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章是2016年的最后一篇。我要感谢大家，感谢你们让我度过了美好的一年。请不要喝得太多，如果你喝得太多的话— <strong class="jp ir">不要喝酒和打虫子！(虽然，说实话，那个</strong> <a class="ae km" href="https://fogmarks.com/2016/02/13/json-escaping-out-in-the-wild/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> 10分钟XSS我在Soundcloud </strong> </a> <strong class="jp ir">上发现是在一个晚上出来之后。哎呀。)</strong></p><p id="9ab7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">节日快乐，当然还有——新年快乐成功！</p></div></div>    
</body>
</html>