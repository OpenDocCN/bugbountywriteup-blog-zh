<html>
<head>
<title>HTB OpenkeyS [writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTB·开克斯[报道]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/htb-openkeys-writeup-531264648200?source=collection_archive---------0-----------------------#2020-12-12">https://infosecwriteups.com/htb-openkeys-writeup-531264648200?source=collection_archive---------0-----------------------#2020-12-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0e19" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">OpenBSD身份验证旁路| HTTP头篡改|内核操作系统本地根漏洞</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e73685fc37030647c6eb61c4261fadf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NjovmHvjtM9Lu3Xkoc3oyg.png"/></div></div></figure><h1 id="6323" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated"><strong class="ak">总结</strong></h1><p id="28cf" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><strong class="lo iu">用户- </strong>这台机器正在运行OpenBSD httpd站点，该站点有一个登录门户，只有登录功能有效。经过研究，发现它有一个漏洞，暴露了用户的私钥，使我们能够使用SSH登录。</p><p id="9453" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu"> Root - </strong>发现openbsd的本地漏洞；执行哪个给了我根！</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="7b35" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">使用的工具:</strong> <code class="fe mu mv mw mx b">nmap</code> | <code class="fe mu mv mw mx b">ssh</code> | <code class="fe mu mv mw mx b">dirbuster</code> | <code class="fe mu mv mw mx b">wget</code></p><p id="25dd" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu"> CVE(美国):</strong><a class="ae my" href="https://github.com/bcoles/local-exploits/blob/master/CVE-2019-19520/openbsd-authroot" rel="noopener ugc nofollow" target="_blank">CVE-2019-19520</a>|<a class="ae my" href="https://github.com/bcoles/local-exploits/blob/master/CVE-2019-19520/openbsd-authroot" rel="noopener ugc nofollow" target="_blank">CVE-2019–19521</a></p><p id="9aa6" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">关键词:</strong> openbsd httpd | ssh | jennifer</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="5bc0" class="ku kv it bd kw kx mz kz la lb na ld le jz nb ka lg kc nc kd li kf nd kg lk ll bi translated">侦察列举</h1><p id="aa30" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated"><strong class="lo iu"> Nmap扫描TCP输出</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/2d836c1d5acc1895b4d62aef91e7c75c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FnYc8guQMoktlsqAhp1EAQ.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><p id="4be7" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu"> **************端口80 OpenBSD httpd * * * * * * * * * * * * * * * * * * * * * * * * * *</strong></p><p id="dddf" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">该网站有一个登录门户。</p><p id="47aa" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">尝试了一些常用的凭证，但没有工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/ca7d82b07433a33021eefee9156f7641.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gjk2hb99ww8c0BVCUeujyw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/f0aa907c9773c71661960fa8118d2aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8AM7GgY2XeAYYWaNZlIR6A.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated"><strong class="bd kw"> robots.txt </strong></figcaption></figure><p id="c1a2" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><code class="fe mu mv mw mx b">dirbuster</code>透露了一个文件/includes/auth.php.swp曝光了<strong class="lo iu">用户名</strong>、<strong class="lo iu">主机名</strong>和<strong class="lo iu">其他数据</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/4b26172a4dd11c981303826ffc8947e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pg4h2NglKPGFoXbOz2Ok-g.png"/></div></div></figure><h1 id="3c33" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">据点</h1><blockquote class="nm"><p id="414e" class="nn no it bd np nq nr ns nt nu nv mh dk translated">CVE-2019–19521:OpenBSD认证旁路</p></blockquote><p id="7646" class="pw-post-body-paragraph lm ln it lo b lp nw ju lr ls nx jx lu lv ny lx ly lz nz mb mc md oa mf mg mh im bi translated"><a class="ae my" href="https://www.secpod.com/blog/openbsd-authentication-bypass-and-local-privilege-escalation-vulnerabilities/" rel="noopener ugc nofollow" target="_blank"> secpod </a>的一篇文章展示了如何通过输入<strong class="lo iu"> -schallenge </strong>作为用户名和任意随机密码来绕过openbsd服务器上运行的登录门户。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/42fcf88901a4cadac20c0ef3123d001e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pZOaz5NNQsZzkw3Dd8wb-Q.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/00a911e6cacfb0432a5b1df7b5c821ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QykCBSnAHlfqA6puH5wUew.png"/></div></div></figure><p id="9239" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">登录成功，但显示<strong class="lo iu">“找不到user -schallege的OpenSSH密钥”。</strong></p><p id="1dc2" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">记得找到的用户名是<strong class="lo iu">詹妮弗</strong></p><h1 id="c523" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">SSH Shell</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/db994b1ad9c6245ea2c3f4dae46f3e31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_NewbcGxHqwrRZDzEPr5qg.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oe"><img src="../Images/cafb7cf772360fb5f01ca5b45b4e5588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73Lz-BUVk3wA2QEEbOlP4g.png"/></div></div></figure><p id="b05d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">将私钥复制到一个文件中并命名为<em class="of"> jennifer.keys </em>，将权限更改为<em class="of"> 600 </em>并通过<strong class="lo iu"> ssh </strong>登录</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/c9e234bc49161f3f0945cd7236927df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MsavIut6UW-EwDBGahxpSw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/bb81f9c95f6e4d17b8d1132a77ca1544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*EuSW9rKb6Zvrfw-hZ3ENCw.png"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk translated"><strong class="bd kw">成功了！！！</strong></figcaption></figure><h1 id="2d95" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">横向运动</h1><h2 id="6660" class="oi kv it bd kw oj ok dn la ol om dp le lv on oo lg lz op oq li md or os lk ot bi translated">下载并执行LinEnum.sh</h2><p id="4c7c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">使用<code class="fe mu mv mw mx b">ksh</code>执行<em class="of"> LinEnum.sh </em>脚本，因为这是OpenBSD。</p><p id="55d5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><code class="fe mu mv mw mx b">ksh ./LinEnum.sh</code></p><h1 id="c396" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">权限提升</h1><blockquote class="nm"><p id="10f1" class="nn no it bd np nq nr ns nt nu nv mh dk translated">找到正确的利用方式</p></blockquote><p id="0f01" class="pw-post-body-paragraph lm ln it lo b lp nw ju lr ls nx jx lu lv ny lx ly lz nz mb mc md oa mf mg mh im bi translated">在github搜索中专门搜索了cve漏洞2019–19520/2019–19522后，终于找到了正在工作的<a class="ae my" href="https://github.com/bcoles/local-exploits/tree/master/CVE-2019-19520" rel="noopener ugc nofollow" target="_blank">漏洞</a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/0d2335ac9b4f80d8119fbd3e825ecf29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nne7tQTWa9vFV5yG8tVC1Q.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/55542efb0936ca2b21b1abe2efdad95f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YD6Qt8EkYglXJlTuvjMTIQ.png"/></div></div></figure></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h1 id="7866" class="ku kv it bd kw kx mz kz la lb na ld le jz nb ka lg kc nc kd li kf nd kg lk ll bi translated">补救</h1><ul class=""><li id="5baf" class="ow ox it lo b lp lq ls lt lv oy lz oz md pa mh pb pc pd pe bi translated">确保使用的版本没有过时或没有任何已知的CVE。</li><li id="10f9" class="ow ox it lo b lp pf ls pg lv ph lz pi md pj mh pb pc pd pe bi translated">通过HTTP使用HTTPS</li><li id="49de" class="ow ox it lo b lp pf ls pg lv ph lz pi md pj mh pb pc pd pe bi translated">在网页上显示用户的私钥有安全风险。</li></ul></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pk"><img src="../Images/7464be6e99e675c0bbd5b2186f57fe25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5XHahTI0o4BM2lelFnwiVQ.gif"/></div></div></figure></div></div>    
</body>
</html>