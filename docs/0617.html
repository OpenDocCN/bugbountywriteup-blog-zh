<html>
<head>
<title>The forgotten content : information disclosure and reflected XSS on Tokopedia</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">被遗忘的内容:东京媒体上的信息披露与反思XSS</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/information-disclosure-and-reflected-xss-on-tokopedia-1b3a00ec64c6?source=collection_archive---------1-----------------------#2020-06-01">https://infosecwriteups.com/information-disclosure-and-reflected-xss-on-tokopedia-1b3a00ec64c6?source=collection_archive---------1-----------------------#2020-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="01b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">Tl；博士:我是如何在Tokopedia的网站上发现“应该删除”的内容，这些内容泄露了一些敏感信息，容易受到XSS的影响。</em></p><p id="0897" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Assalamualaikum Wr。Wb。(亲爱的读者，愿你平安)</p><p id="7a0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我之前关于Tokopedia上的子域接管的文章中，我提到我也发现了一些有趣的子域，其中之一是accounts-REDACTED.tokopedia.com的<em class="kl"/>。</p><p id="e30f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为有趣的子域名，我决定在这个特殊的子域名中挖掘更多。嗯，首页只显示<strong class="jp ir"> 410消失</strong> http代码，其他什么都没有，所以这意味着这个子域上的资源已经被有意移除，应该被清除。</p><p id="539b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我没有就此止步，我用了一些工具进行目录蛮力，dirbuster，dirsearch等。并且所有的暴力破解路径都返回<strong class="jp ir"> 410消失</strong>，除了这个<strong class="jp ir"> </strong>路径，<em class="kl">accounts-REDACTED.tokopedia.com/docs/</em>，返回不同的响应，一个<strong class="jp ir"> 200 OK </strong> http代码。</p><p id="88f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在浏览器上打开了路径，但它返回<strong class="jp ir"> 410消失</strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/bdf87bc74cbf4b1b4f53353aeecd5812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ck1KSO_my7JzsPbpkiaIw.jpeg"/></div></div></figure><p id="6a8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我很确定这不是假阳性。经过仔细检查，发现它是在不同的港口提供的。端口<strong class="jp ir"> 80 (http) </strong>返回<strong class="jp ir"> 200 OK </strong>，端口<strong class="jp ir"> 443 (https) </strong>返回<strong class="jp ir"> 410 Gone </strong>，我不直接指定我的浏览器自动重定向到https。</p><p id="9b09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我使用<strong class="jp ir"> http </strong>协议打开路径，我注意到端口<strong class="jp ir"> 80 </strong>上的<em class="kl"> /docs/ </em>路径是一个使用Swagger UI的API文档，这是一个开源项目，可以可视化地呈现用OpenAPI (Swagger)规范定义的API的文档。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ky"><img src="../Images/ebd7d325ebb17fa496aa1f66f9abaddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6v0n7yHBllc3jRb3Z4GvQ.png"/></div></div></figure><p id="436b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">令人惊讶的是，它包含一些敏感的API，如检索用户数据，以及其他敏感的PII，如国民身份号码等。这是给Tokopedia的第三方合作伙伴的。它甚至包含用于授权的客户端ID和客户端机密。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/2e913a8df68f389e8006ee5051d3ce23.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*feTyBpnCJReRvq5xAUjyDw.gif"/></div></figure><p id="6966" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，在我检查之后，API不再工作了。实际上，根据我以前在Tokopedia上的搜索经验，他们现在使用的是GraphQL，与我找到的这个不同。我检查了变更日志，他们的员工最后一次更新是在2019年6月左右。我晚了，晚了两个月，他们已经改变了他们的网络架构。<strong class="jp ir"> 410消失</strong>状态码现在有意义了，这个资源应该被删除，但不知何故还在那里。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi la"><img src="../Images/c16ad86958003f419bdbc3d38b565c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Tx7a91Flz6iFokj7Gi3vg.jpeg"/></div></div></figure><p id="83de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我开始在这个特别版本的Swagger UI中寻找CVE。我实际上找到了一个XSS CVE，但在我尝试后，又一次失望，它不起作用。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/367574da977d08df424299659643eee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*H2NsulI7l1Nu0PQAoYtIng.jpeg"/></div></figure><p id="275a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这让我很好奇，为什么它不起作用？因为这个版本容易受到攻击。<em class="kl"> </em>经过进一步挖掘，我认为他们已经定制了这个大摇大摆的用户界面，他们甚至在部分公开的源代码上使用了他们员工的名字。所以<em class="kl">也许</em>，这个霸气的UI和正式版不一样。</p><p id="aac6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我不会放弃。</p><p id="45db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">事实上，我确实休息了大约1-2周。</em></p><p id="2dbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从那以后，我开始挖掘更多。我注意到这个文档是开放的，这意味着任何人都可以修改或更新文档，而不必登录或注册。我其实有一次不小心把整个文档都删了，还好我可以从changelog下载过去的数据，重新导入。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/b900218697ced9671d8ea791803353a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*mCX65MYG1UAq-Yd9cPjTlg.jpeg"/></div></figure><p id="904e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在导入功能中发现了这个有趣的URL:</p><p id="0c9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ld" href="http://accounts-staging.tokopedia.com/docs/index.php?url=%" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a><em class="kl">file . YAML</em></p><p id="69ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试图寻找LFI和SSRF的网址参数，没有工作。但是我注意到文件名反映在html页面上，所以我试图插入XSS有效载荷，然而另一个失望的是，<strong class="jp ir">没有</strong>弹出出现。</p><p id="922b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是当我检查元素来检查反射的结果时，发现XSS实际上被解雇了，但是被Chrome的XSS审计员阻止了。它在另一个浏览器如Firefox等上运行良好。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ky"><img src="../Images/70aec928578f9c1c84b0920475b557b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9Isu7SR7tz2o5PapphE4g.png"/></div></div></figure><p id="ae09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终的有效载荷如下所示:</p><p id="5dbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ld" href="http://accounts-staging.tokopedia.com/docs/index.php?url=%" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a><em class="kl">=['&lt;脚本&gt;alert(document . cookie)&lt;/脚本&gt; '] </em></p><p id="1e67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在最新版本的Swagger UI上尝试了这一点，但它不起作用，而且我在旧版本上找不到任何记录该漏洞的CVE。所以<em class="kl">也许</em>我是对的，他们的版本已经被定制了(或者也许还没有人指定CVE？或者我在这里遗漏了什么\_(ツ)_/)。</p><p id="d847" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论如何，我向他们的安全团队报告了这一情况，20分钟后得到了回复<strong class="jp ir"><em class="kl"/></strong>告诉我这一报告被核实为中等严重程度。很好的反应时间。</p><p id="c006" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Wassalamualaikum Wr。Wb。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><p id="335f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">时间线:</strong></p><ul class=""><li id="3993" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated"><strong class="jp ir">2019年8月29日:</strong>报告已发送。</li><li id="9d28" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">2019年8月29日:</strong>安全团队验证了该报告，有效，严重性为中。</li><li id="f407" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">2019年9月17日:</strong> Bug修复，他们让我重新测试Bug。他们还询问了我发送奖励的银行信息。</li><li id="e665" class="ll lm iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">2019年11月20日:</strong> $$$获奖。</li></ul><p id="9654" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请原谅我对模因的过度使用，在这种艰难的情况下，我们需要更多的微笑。注意安全，洗手！:D </p></div></div>    
</body>
</html>