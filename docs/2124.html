<html>
<head>
<title>How I was able to edit the website’s AWS files from the file upload function?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何通过文件上传功能编辑网站的AWS文件？</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bug-bounty-how-i-was-able-edit-awss-files-from-file-upload-function-cb33bc3bd3a9?source=collection_archive---------1-----------------------#2022-06-10">https://infosecwriteups.com/bug-bounty-how-i-was-able-edit-awss-files-from-file-upload-function-cb33bc3bd3a9?source=collection_archive---------1-----------------------#2022-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6a02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好。这是<a class="kl km ep" href="https://medium.com/u/d96c4a8eb315?source=post_page-----cb33bc3bd3a9--------------------------------" rel="noopener" target="_blank"> Alp </a>！我很久没来了。我终于有时间和社区分享一篇文章了。</p><p id="df24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将与你分享我是如何通过文件上传功能来编辑网站的AWS文件的。</p><p id="5e05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，它是一个bug bounty平台中的外部程序，是一个与网站相关的加密程序。</p><p id="51f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我已经注册，看看是否找到一些东西。然后，我面对一个KYC(身份验证)页面。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/8665042846061cea2dcf3dc190c83826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Pv3_lwn4SDGoXw2LjBbaw.jpeg"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">KYC验证</figcaption></figure><p id="b500" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在那里看到一个上传文件的东西。我曾尝试上传一个XSS文件，但不幸被Cloudflare阻止:/</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi ld"><img src="../Images/f72b7b98e86e71f6fb2685f2c0f1acec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3BzS0_CTGPxzoCncY1E3A.jpeg"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">文件上传请求被Cloudflare WAF阻止</figcaption></figure><p id="375b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所知，Cloudflare对于WAF来说太难绕过了。所以，我没有试图绕过它，测试文件上传请求中的其他参数。然后，我意识到URL中有一个带有“national_id_front”值的<code class="fe le lf lg lh b">name</code>参数。</p><p id="1f7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你上传一个文件时，它在响应中给出了这个结果。</p><pre class="ko kp kq kr gt li lh lj lk aw ll bi"><span id="7869" class="lm ln iq lh b gy lo lp l lq lr">{"path_full":"https:\/\/target-website.s3.eu-central-1.amazonaws.com\/kyc\/users\/1729\/1729_national_id_front.jpg","path":"kyc\/users\/1729\/1729_national_id_front.jpg","filename":"1729_national_id_front.jpg"}</span></pre><p id="af2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我将<code class="fe le lf lg lh b">name</code>参数的值改为另一个文本，并观察响应。网络服务器正在监听<code class="fe le lf lg lh b">name</code>参数的值来给上传的文件命名。因此，这意味着您可以通过路径遍历将任何文件上传到back paths。</p><p id="d08a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是访问资产文件夹中图像的最终有效负载:</p><blockquote class="ls lt lu"><p id="7eed" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated"><code class="fe le lf lg lh b">/../../../../assets/images/coins/btc</code></p></blockquote><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi lz"><img src="../Images/6a635c181557c0bae38d2149fee551bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18_yJxqunzghVcYslR6Tfw.jpeg"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">响应中的最终结果</figcaption></figure><p id="a1d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您在响应中看到的，通过使用路径遍历，我们的文件作为btc.png上传到了<code class="fe le lf lg lh b">assets/images/coins/btc.png</code>目录。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/5dbaa3e4c068d137429a7b336a1edd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*6QI-SSzvtcSnIYxIdqwJ5w.png"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">这是我的个人资料图片，然后我不得不回到默认的比特币图标lol。(对不起亲爱的开发者)</figcaption></figure><blockquote class="ls lt lu"><p id="fb1b" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated"><strong class="jp ir">影响:</strong></p></blockquote><p id="ac45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以最后，当用户在网站上看到受影响的图像时，他们会看到我们的文件。攻击者可以更改从AWS服务器获得的所有文件，并在受害者的网站上提供他们自己的文件。</p><blockquote class="ls lt lu"><p id="9798" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated"><strong class="jp ir">时间线:</strong></p></blockquote><p id="71b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">已报告</strong> 09.06.2022</p><p id="9a84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2022年6月10日</p><p id="8bd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">2022年6月10日</strong>解决，并根据CVSS计算器授予400美元的P3奖励，因为您可以编辑的文件因WAF和web文件而受到限制。</p><p id="1b83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！欢迎在我们的Discord服务器或Twitter上与我们交流！</p><blockquote class="ls lt lu"><p id="9507" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated"><strong class="jp ir">社交:</strong></p></blockquote><p id="905a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特:<a class="ae mb" href="https://twitter.com/alp0x01" rel="noopener ugc nofollow" target="_blank">https://twitter.com/alp0x01</a></p></div></div>    
</body>
</html>