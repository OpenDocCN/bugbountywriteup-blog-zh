<html>
<head>
<title>Google Books X-Hacking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌图书X-黑客</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/google-books-x-hacking-29c249862f19?source=collection_archive---------1-----------------------#2019-03-21">https://infosecwriteups.com/google-books-x-hacking-29c249862f19?source=collection_archive---------1-----------------------#2019-03-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5e3af61038df95547f43a5e1688251dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*efKJlQDYmlG_xjDKJxgO6Q.png"/></div></div></figure><p id="ccb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近，我一直在参与开放漏洞奖励计划，主要关注<strong class="ka ir">跨站点搜索攻击</strong> ( <a class="ae kw" href="https://www.owasp.org/images/a/a7/AppSecIL2015_Cross-Site-Search-Attacks_HemiLeibowitz.pdf" rel="noopener ugc nofollow" target="_blank"> XS搜索</a>)。这篇文章是在books.google.com网站上展示成功的跨站点搜索的第一篇。攻击背后的想法来自于在<a class="ae kw" href="https://archive.aachen.ccc.de/35c3ctf.ccc.ac" rel="noopener ugc nofollow" target="_blank"> 35c3ctf </a>期间提出的<a class="ae kw" href="https://youtu.be/HcrQy0C-hEA" rel="noopener ugc nofollow" target="_blank">文件管理器</a>任务，该任务基于<strong class="ka ir">滥用铬</strong> <a class="ae kw" href="https://www.chromium.org/developers/design-documents/xss-auditor" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> XSS审计员</strong> </a> <strong class="ka ir">。通过利用这个漏洞，攻击者可以泄露用户的私人藏书以及阅读历史。</strong></p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="lb lc l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">实践中的概念证明</figcaption></figure><h1 id="87c9" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">脆弱点</h1><p id="3ac3" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">在检查页面的源代码时，我注意到了代码源之间有趣的差异。其中之一是当一个搜索查询产生至少一本书时，一个特定的<strong class="ka ir"> JavaScript代码</strong>被添加，否则就不会被添加。插入的代码以:<br/> <code class="fe mk ml mm mn b">&lt;script&gt;if (window['_OC_registerHover']){_OC_registerHover({"title":"&lt;title&gt;"</code>开头，其中<code class="fe mk ml mm mn b">&lt;title&gt;</code>是第一个显示结果的书名。</p><p id="138e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于给定的<code class="fe mk ml mm mn b">&lt;title&gt;</code>和用户的<code class="fe mk ml mm mn b">&lt;uid&gt;</code>，我能够创建一个链接<code class="fe mk ml mm mn b">https://books.google.com/books?uid=&lt;uid&gt;&amp;num=1&amp;q=&lt;title&gt;&amp;x=&lt;script&gt;if (window['_OC_registerHover']){_OC_registerHover({"title":"&lt;title&gt;"</code>，当被访问时，窗口将被<em class="mo"> XSS审计器</em>阻塞(因为检测到了‘反射’参数<code class="fe mk ml mm mn b">xss</code>),如果搜索查询的第一个结果有标题<code class="fe mk ml mm mn b">&lt;title&gt;</code>，否则不会。</p><p id="23a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一个或多或少重要的观察是，当页面被<em class="mo"> XSS审计器</em>阻塞时，<code class="fe mk ml mm mn b">window.length</code>保持<code class="fe mk ml mm mn b">0</code>(这意味着没有内嵌iframes)。由于谷歌在他们的网站中插入了大量的框架，这个数字通常比<code class="fe mk ml mm mn b">0</code>要高，因此，通过读取提到的<code class="fe mk ml mm mn b">window.length</code>属性来检测状态是很简单的，因为它是跨站点可访问的。<br/> <em class="mo">在我合作的GitHub </em> <a class="ae kw" href="https://github.com/xsleaks/xsleaks/wiki/Browser-Side-Channels" rel="noopener ugc nofollow" target="_blank"> <em class="mo">资源库</em> </a> <em class="mo">中可以找到允许检测错误页面的其他方法。</em></p><p id="fa41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种攻击的主要缺点是攻击者必须知道用户的<code class="fe mk ml mm mn b">&lt;uid&gt;</code>,使得攻击范围变小。为了扩大范围，我仔细研究了<code class="fe mk ml mm mn b">uid=</code>参数，以下是我的发现:</p><ul class=""><li id="1ec9" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated">【https://books.google.com/books?uid=vulnerability】T21——<strong class="ka ir">无限重定向到自身。</strong></li><li id="163b" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><a class="ae kw" href="https://books.google.com/books?uid=%2b" rel="noopener ugc nofollow" target="_blank">https://books.google.com/books?uid=%2B</a>—重定向至<code class="fe mk ml mm mn b">https://books.google.com/books?uid=&lt;uid&gt;&amp;hl=en</code>。</li><li id="9ddc" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><a class="ae kw" href="https://books.google.com/books?uid=%2b1" rel="noopener ugc nofollow" target="_blank">https://books.google.com/books?uid=%2B1</a>——抛出404回应。</li><li id="88f2" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><a class="ae kw" href="https://books.google.com/books?uid=1%2b1" rel="noopener ugc nofollow" target="_blank">https://books.google.com/books?uid=1%2B1</a>—重定向至<code class="fe mk ml mm mn b">https://books.google.com/books?uid=&lt;uid&gt;&amp;hl=en</code></li><li id="6c2c" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><a class="ae kw" href="https://books.google.com/books?uid=%27&amp;q=hack" rel="noopener ugc nofollow" target="_blank">https://books.google.com/books?uid='&amp;q =黑客</a> —重定向到<code class="fe mk ml mm mn b">https://www.google.com/search?tbo=p&amp;tbm=bks&amp;q=hack</code></li><li id="7ab4" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><a class="ae kw" href="https://books.google.com/books?uid=vulnerability&amp;q=hack" rel="noopener ugc nofollow" target="_blank">https://books.google.com/books?uid=vulnerability&amp;q = hack</a>—<strong class="ka ir">显示登录用户的结果，不改变网址</strong>(已修复)</li></ul><p id="13d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，通过将列表中的最后一个漏洞与<em class="mo"> XSS审计员滥用</em>结合起来，攻击者可以在不知道受害者的<code class="fe mk ml mm mn b">&lt;uid&gt;</code>的情况下，对受害者的账户执行成功的<em class="mo">跨站点搜索</em>。</p><h1 id="9796" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">攻击场景</h1><p id="36c4" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">攻击可能在以下情况下进行:</p><blockquote class="nd"><p id="22d6" class="ne nf iq bd ng nh ni nj nk nl nm kv dk translated">Google Books的一个普通用户访问了一个恶意网站。一旦发生任何交互，就会在后台打开一个新窗口，通过操纵cross-origin <code class="fe mk ml mm mn b"><strong class="ak"><em class="nn">location</em></strong></code>属性，网页可以轻松利用前面提到的漏洞，从而泄露用户的敏感数据。</p></blockquote><p id="182e" class="pw-post-body-paragraph jy jz iq ka b kb no kd ke kf np kh ki kj nq kl km kn nr kp kq kr ns kt ku kv ij bi translated">被过滤的数据可以包括<strong class="ka ir">搜索的书籍</strong>、<strong class="ka ir">私人藏书</strong>、<strong class="ka ir">购买的书籍、阅读的书籍等信息。</strong></p><p id="8876" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">攻击者可以利用这些信息来<strong class="ka ir">为难</strong>、<strong class="ka ir">勒索</strong>、<strong class="ka ir">威胁</strong>甚至<strong class="ka ir">让受害者承担法律后果</strong>，因为特定的一组书籍在某些国家可能会被禁止(<a class="ae kw" href="https://en.wikipedia.org/wiki/List_of_books_banned_by_governments" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/List _ of _ books _ banned _ by _ governments</a>)。</p><h1 id="51d5" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">攻击实施和改进</h1><p id="90bf" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">在一个查询中提供多个“反射”参数是可能的，因此，执行<strong class="ka ir">二分搜索法</strong>算法以获得有效的信息过滤(在我包含的视频中你可能已经注意到了)。在我提交给谷歌的原始报告中可以找到一个概念验证和更详细的攻击描述:<a class="ae kw" href="https://terjanq.github.io/Bug-Bounty/Google/books-xs-search-enpgws9jw5mb/index.html" rel="noopener ugc nofollow" target="_blank">https://terjanq . github . io/Bug-Bounty/Google/books-xs-search-enp GWS 9 jw5mb/index . html</a></p><h1 id="f2b4" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">来自谷歌的重要更新</h1><p id="d4b3" class="pw-post-body-paragraph jy jz iq ka b kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv ij bi translated">至于我和其他研究人员加剧了<em class="mo">跨站点</em> <em class="mo">搜索</em>攻击的工作，谷歌决定通过实施针对这些攻击的一系列防御措施来改善他们的服务。可悲的是，但这一行动的一个自然结果是，他们将不再奖励新的XS搜索报告，而是将它们视为重复。</p><blockquote class="nd"><p id="d9dc" class="ne nf iq bd ng nh ni nj nk nl nm kv dk translated">因此，该领域的<strong class="ak">漏洞报告很可能是重复的</strong>，除非它们显著改变了我们对防御和缓解措施的理解。我们将在该页面发布我们认为已受到适当保护、可抵御XS搜索的web应用程序和终端，我们还将发放<a class="ae kw" href="https://www.google.com/about/appsecurity/research-grants/" rel="noopener ugc nofollow" target="_blank">漏洞研究资助</a>来审计我们防御措施的有效性，但在此之前，我们不建议bug猎人在这方面花太多时间(以避免重复劳动)。<a class="ae kw" href="https://sites.google.com/site/bughunteruniversity/nonvuln/xsleaks" rel="noopener ugc nofollow" target="_blank">【1】</a></p></blockquote><h1 id="2e04" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls nt lu lv lw nu ly lz ma nv mc md me bi translated">时间表</h1><ul class=""><li id="002e" class="mp mq iq ka b kb mf kf mg kj nw kn nx kr ny kv mu mv mw mx bi translated"><em class="mo">2019年1月27日晚上11点—报道</em></li><li id="d99d" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><em class="mo">2019年1月28日上午10点16分—已分庭</em></li><li id="5168" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><em class="mo">2019年1月30日02:18AM —已接受</em></li><li id="6cef" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><em class="mo">2019年2月5日06:20PM —奖励500美元</em></li><li id="2db6" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><em class="mo">2019年3月5日晚上10点47分—已修复</em></li><li id="bd9b" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated"><em class="mo">2019年3月19日06:20PM —额外奖励837美元，总计1337美元</em></li></ul><p id="cf8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢谷歌！</p></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="745d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mo">关注</em> <a class="ae kw" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="mo"> Infosec报道</em> </a> <em class="mo">获取更多此类精彩报道。</em></p><div class="og oh gp gr oi oj"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">信息安全报道</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox jw oj"/></div></div></a></div></div></div>    
</body>
</html>