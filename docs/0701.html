<html>
<head>
<title>The $1,000 worth cookie</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">价值1000美元的饼干</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/the-1-000-worth-cookie-6cf48af08e08?source=collection_archive---------0-----------------------#2020-07-19">https://infosecwriteups.com/the-1-000-worth-cookie-6cf48af08e08?source=collection_archive---------0-----------------------#2020-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="54d0" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">多姆·XSS的故事</h1><p id="c1eb" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">直到加入HackerOne平台一年后，我才开始积极寻找bug。当时，我对每天向平台上的程序报告的各种服务器和客户端错误类别完全陌生。在当时披露的漏洞中，跨站点脚本，通常被称为XSS，似乎是一个非常受欢迎的漏洞，许多猎人都在寻找。因此，当我着手在俄罗斯最大的互联网公司的顶级域名中寻找一个跨站脚本漏洞时，我一点也不知道我的新手运气会让我在搜索的几分钟内发现一个易受攻击的头参数，并在这个过程中为我赢得第一笔奖金。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/c3cafec933840bf143752c8be7e1cf00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*mIuxNgbq59ibEHHKK6untw.png"/></div></figure><h2 id="d2ce" class="lr jo iq bd jp ls lt dn jt lu lv dp jx kw lw lx kb la ly lz kf le ma mb kj mc bi translated">寻找易受攻击的参数。</h2><p id="8eba" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在浏览<a class="ae md" href="https://mail.ru." rel="noopener ugc nofollow" target="_blank"> https://mail.ru. </a>时，我在burpsuite中处理请求并观察它们的响应。为了找到隐藏的参数，我使用了这个名为param miner的有用扩展(<a class="ae md" href="https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943" rel="noopener ugc nofollow" target="_blank">https://ports wigger . net/bapp store/17d 2949 a 985 C4 b 7 ca 092728 DBA 871943</a>)，作者是PortSwigger Web Security的James‘albino wax’Kettle。在burpsuite中查看该问题的标签显示了一些参数，这些参数被该扩展强行使用并发现是有效的。其中之一是名为“gp”的cookie HTTP请求头。这一点特别令人感兴趣，因为它的价值反映在对任何包含它的请求的响应中，从而使它成为XSS的潜在候选人。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h2 id="d123" class="lr jo iq bd jp ls lt dn jt lu lv dp jx kw lw lx kb la ly lz kf le ma mb kj mc bi translated">验证XSS漏洞。</h2><p id="3c42" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">测试反射XSS时，一个有用的技巧是一次一个地向易受攻击的参数抛出危险字符，以便确定哪些字符被Web应用程序防火墙过滤掉(如果存在)。一旦你知道哪些字符被过滤掉，哪些字符被接受，你就能更好地设计一个绕过WAF的有效载荷。幸运的是，我测试的应用程序并非如此。作为当时的新手，我不理解与跨站脚本漏洞相关的上下文的概念。我试图通过在Cookie参数的值中插入以下有效负载来测试它。</p><p id="7308" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated"><code class="fe mq mr ms mt b">&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></p><p id="2745" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated">我在burpsuite中点击响应，选择“在浏览器中显示响应”，然后在Firefox中加载生成的链接。我给了它几秒钟的加载时间，但是一旦它加载，就没有弹出提示框显示我的cookies了。在我决定休息一天之前，我在我的有效载荷上尝试了几个变化，在脸书bug bounty论坛上发布了我的问题，试图寻求帮助。</p><p id="d2bb" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated">这是请求和响应的样子</p><pre class="lk ll lm ln gt mu mt mv mw aw mx bi"><span id="f35d" class="lr jo iq mt b gy my mz l na nb">GET / HTTP/1.1 <br/>Host: mail.ru <br/>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0 <br/>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em class="nc">/</em>;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Cookie: <strong class="mt ir">gp= some alpha numeric string</strong>; <br/>Connection: close <br/>Upgrade-Insecure-Requests: 1 <br/>Cache-Control: max-age=0</span><span id="3241" class="lr jo iq mt b gy nd mz l na nb">200 OK<br/>&lt;/script&gt;&lt;script id="script:globals"&gt;var mr={:{BUILD:"307ad21",VERSION:1566410797,TIMESTAMP:1567848214281,TIMESTAMP_LOCAL: Date.now(),TIMEZONE:10800,AUTH:!1,CITY:"Кампала",REGION_ID:233, PAGE_ID: "15678651219031568689886875",ACC_CNT: false,MEDIA_ORDER:"regional,regional,auto,auto,lady,lady,deti,deti,health,health,sport,sport,cinema,cinema,hitech,hitech,games,games",INCUT_ORDER:"incut,stub",WIDGET_ORDER:"horo,tv,torg",FEATURE_ORDER:"auto,lady,sport,cinema,hitech,games",TARGET:"default",SITEZONE:15,SITEID:169,DEVICE:"desktop",BROWSER:"Firefox",PLATFORM:"Linux",REGION_LEVEL_ID:188,<strong class="mt ir">GP:"Payload gets reflected here ;</strong>",CSRF:"3b021e69c3bf49fe900037b18fc581be",MANUAL_REGION_NOT_RUSSIA:true,HONEYPOT: '.gridmain-col .tgb, .grid .grid_main-col</span></pre><p id="f7eb" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated">第二天我回到测试中，突然想到我必须关闭最初的脚本标签，然后引入一个新标签。我迅速将我的有效载荷修改为<code class="fe mq mr ms mt b">&lt;/script&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;</code></p><p id="39e3" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated">激发请求，并观察它在响应中得到正确的反映。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/ac28de08fc8326950ebf4da8636bcd78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VM7ZKh8coVIdLB1qFW5O3A.png"/></div></div></figure><p id="02f3" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated">在浏览器中加载响应最终弹出了警告框和域名，上面的有效负载在该域名上触发了XSS。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nj"><img src="../Images/540cdb92f0a5a541aaa6a4a1787e72ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BfEFV7845HY6adiOooRRUg.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">显示用户cookies的有效负载的输出</figcaption></figure><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nj"><img src="../Images/346c91e52249a3ef64b72fc35c5aa295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hUzZntAm7HchfA6KsZNRdg.png"/></div></div></figure><p id="b274" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated">我向Mail.ru报告了这一点，并对它是否会得到奖励表示怀疑，因为这充其量只是一个自我XSS的问题。然而，在阅读了一些报告后，我的希望增加了，在这些报告中，bug bounty hunters向Mail.ru展示了中间人攻击载体可用于向合法用户发起攻击——利用他们网站基础设施中易受攻击的cookie参数。我在这篇文章的结尾提供了一个进一步阅读的链接。</p><p id="fea1" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated"><strong class="kn ir"> <em class="nc">时间轴:</em> </strong></p><p id="77cf" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated"><em class="nc">2019年9月7日—已上报。</em></p><p id="7a8d" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated"><em class="nc">2019年9月8日—分庭。</em></p><p id="473f" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated"><em class="nc">2019年9月26日——奖金发放</em></p><p id="52eb" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated"><em class="nc">2019年9月27日—问题已修复</em></p><p id="ec39" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated">链接到我的黑客报告<a class="ae md" href="https://hackerone.com/reports/690072" rel="noopener ugc nofollow" target="_blank">https://hackerone.com/reports/690072</a></p><p id="04b9" class="pw-post-body-paragraph kl km iq kn b ko ml kq kr ks mm ku kv kw mn ky kz la mo lc ld le mp lg lh li ij bi translated">如需进一步阅读，请查看以下来自<a class="no np ep" href="https://medium.com/u/8801da5fc3a6?source=post_page-----6cf48af08e08--------------------------------" rel="noopener" target="_blank"> Max </a>的信息媒体报道:</p><div class="nq nr gp gr ns nt"><a href="https://medium.com/@iSecMax/%D1%81ookie-based-xss-exploitation-2300-bug-bounty-story-9bc532ffa564" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">基于ookie的XSS开发|＄2300 Bug赏金故事</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">很长一段时间以来，我一直在寻找HackerOne平台上的漏洞，分配了一定数量的…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh lp nt"/></div></div></a></div></div></div>    
</body>
</html>