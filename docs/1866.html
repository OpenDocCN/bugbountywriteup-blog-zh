<html>
<head>
<title>Host Header Injection Attacks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">主机标头注入攻击</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/host-header-injection-attacks-7160f9fcf63e?source=collection_archive---------2-----------------------#2022-02-05">https://infosecwriteups.com/host-header-injection-attacks-7160f9fcf63e?source=collection_archive---------2-----------------------#2022-02-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="575b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主机标头注入不是您通常在CTFs或安全挑战中发现的攻击类型。然而，它在野生网络中广泛存在。一旦您遇到一个易受攻击的web服务器，利用它也不是非常困难，本文稍后将展示这一点。</p><p id="87c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们进入攻击部分之前，让我们首先了解什么是主机报头，以及它的作用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/15130f15fd41e71de5d9ed1b4f8206b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/0*-YkLVOQpWhVOOSr-.jpg"/></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h1 id="cc25" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">HTTP主机标头</h1><p id="d53e" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">主机头是web客户端应该包含在其HTTP请求中的必填字段。它向web服务器指示客户端正在尝试连接到哪个域。这在多个网站托管在同一个web服务器上的情况下非常有用。它们可以共享相同的IP地址，但域名不同。</p><p id="0916" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">带有主机头的HTTP请求应该是这样的:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="e3ba" class="mi lb iq me b gy mj mk l ml mm">GET /index.html HTTP/1.1<br/>Host : patchthenet.com</span></pre><p id="6129" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Web应用程序通常不托管在独立的服务器上。相反，你会经常发现它们运行在共享服务器上。因此，这些应用程序将共享相同的IP地址。因此，为了区分传入请求的目的地，web服务器将依赖HTTP主机头。</p><p id="bd97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，一些网站可能只能通过处理来自客户端的流量的中间系统来访问。这些系统可能是负载平衡器、反向代理或WAFs。在这种情况下，所有这些网站将共享一个IP地址。再一次，HTTP主机头将帮助将请求路由到它们预期的目的地。</p><p id="2e99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，现在我们已经看到了这个头文件的效用，让我们继续下去，看看它如何给web应用程序的安全性带来风险。</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h1 id="a2bc" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">HTTP主机报头注入攻击</h1><p id="99be" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">有时，web应用程序需要知道它们所在的域。当他们需要通过绝对路径引用资源时尤其如此。</p><p id="c25b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，web应用程序通常会从HTTP主机头值中获取这个域名。</p><p id="f8b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个web应用程序如何实现这一点的示例:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="8a46" class="mi lb iq me b gy mj mk l ml mm">&lt;a href="http://&lt;?php echo $_SERVER['Host']; ?&gt;/absolute/path/to/a/resource"&gt;Link&lt;/a&gt;</span></pre><p id="6a4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这条看似无害的线背后，隐藏着一个可能一开始并不明显的重大漏洞。</p><p id="902a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">web应用程序将检索主机头值:<code class="fe mn mo mp me b">$_SERVER['Host']</code>，并将其插入代码中。</p><p id="f67a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，正如我们之前看到的，这个值是用户可以控制的。这意味着用户可以在发送请求之前修改它。</p><p id="9ca1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者可以简单地注入一个恶意的有效负载作为主机头值，web应用程序会无意中处理并执行它。</p><h2 id="d842" class="mi lb iq bd lc mq mr dn lg ms mt dp lk jy mu mv lo kc mw mx ls kg my mz lw na bi translated">x转发主机</h2><p id="31ec" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">另一种改变主机头值的方法是使用<code class="fe mn mo mp me b">X-Forwarded-Host</code>。代理使用这个头将HTTP请求转发到web服务器，同时保留web浏览器提供的原始主机值。</p><p id="7f43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者可以使用此报头和恶意负载来覆盖主机报头。</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="2b6a" class="mi lb iq me b gy mj mk l ml mm">GET /index.html HTTP/1.1<br/>Host : patchthenet.com<br/>X-Forwarded-Host : malicious.com</span></pre><p id="6d7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以前面的例子为例，用上面的值更改主机变量，我们将得到以下结果:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="6ab2" class="mi lb iq me b gy mj mk l ml mm">&lt;a href=”http://malicious.com/absolute/path/to/a/resource"&gt;Link&lt;/a&gt;</span></pre><p id="0ded" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">攻击者可以使用主机标头作为引发各种攻击的方式。最常见的情况是，攻击者会注入主机标头，以实现web缓存中毒、SSRF或密码重置中毒。</p><h2 id="8fc3" class="mi lb iq bd lc mq mr dn lg ms mt dp lk jy mu mv lo kc mw mx ls kg my mz lw na bi translated">剥削</h2><p id="c63f" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">一旦发现有漏洞的网站，利用它其实很简单。使用本地代理，您可以在网站离开您的机器之前拦截您对网站的请求。</p><p id="1098" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，下图显示了使用Burp拦截的对我的网站的请求:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/36dad51f87753c52d8324243844e0a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s7yk8TnCwkeMpOk7.png"/></div></div></figure><p id="8d89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，攻击者可以简单地用他们控制的域名改变主机头的值，这里写着:<code class="fe mn mo mp me b">www.patchthenet.com</code>。然后，他们可以转发请求。</p><p id="ce7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，这在这里是行不通的，而且对大多数网站也是无效的，因为网站管理员实施了许多安全控制措施来保护他们的网站免受这些攻击。</p><p id="c00d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我们接下来要讨论的内容。</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h1 id="5f0a" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">防止主机标头注入攻击</h1><p id="d76e" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">幸运的是，主机标头注入攻击并非不可避免。通过遵循某些安全措施，您可以保护您的web应用程序，并降低发生HTTP主机头攻击的风险。</p><p id="6d2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以设置的最安全的措施是首先避免使用HTTP主机头。在调用资源时，您应该经常问自己是否真的需要包含绝对路径。</p><p id="de76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您真的需要依赖主机头时，那么您应该确保验证主机头，就像您验证任何其他用户提供的输入一样。</p><p id="a6de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还应该考虑对照已知域的白名单检查HTTP主机头。web应用程序将只处理白名单中的域名。</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="dce0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ng">原载于2022年2月5日【https://patchthenet.com】<a class="ae nh" href="https://patchthenet.com/articles/host-header-injection-attacks/" rel="noopener ugc nofollow" target="_blank"><em class="ng"/></a><em class="ng">。</em></em></p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h1 id="4a4c" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">🔈 🔈Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。<a class="ae nh" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank">查看更多详情并在此注册。</a></h1><div class="ni nj gp gr nk nl"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">iwcon.live</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz kr nl"/></div></div></a></div></div></div>    
</body>
</html>