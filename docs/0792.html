<html>
<head>
<title>How To Hack: Bastion From HackTheBox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何入侵:来自黑客盒子的堡垒</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-to-hack-bastion-from-hackthebox-729cd2317c6e?source=collection_archive---------1-----------------------#2020-08-28">https://infosecwriteups.com/how-to-hack-bastion-from-hackthebox-729cd2317c6e?source=collection_archive---------1-----------------------#2020-08-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5bf9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我的OSCP认证之旅</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/80e6408c8f7ab7b9f5acbb2ca0bc7aff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/0*8twLHsMizvK5cbKX.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">堡垒</figcaption></figure><h1 id="fcf3" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="2fae" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">欢迎阅读我在Medium上的第二篇文章。今天我们将看看黑客盒子里的堡垒。在我看来，这是一个相当现实的盒子，它给我们带来了很多乐趣。这篇文章将与我的第一篇文章相似，因为我将提供更多关于这个盒子的信息，以及为什么它容易受到攻击。但是，下面的文章不会给出我将使用的不同工具的太多信息。你可以在我的<a class="ae mf" href="https://medium.com/@marvingerlach/hackthebox-popcorn-f1ace3de846d" rel="noopener"> <strong class="ll ir">系列的第一篇</strong> </a>中查找。您可以在Kali提供的工具中找到备忘单和有用的信息。这会节省一些时间。所以让我们开始吧:</p><h1 id="e25e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">设置</h1><p id="d343" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在我们开始之前，对我的设置说几句话:</p><ul class=""><li id="3111" class="mg mh iq ll b lm mi lp mj ls mk lw ml ma mm me mn mo mp mq bi translated">虚拟机上的Kali Linux</li><li id="8eb6" class="mg mh iq ll b lm mr lp ms ls mt lw mu ma mv me mn mo mp mq bi translated"><a class="ae mf" href="https://github.com/gnunn1/tilix" rel="noopener ugc nofollow" target="_blank"> Tilix </a>:一个面向Linux的分块终端仿真器</li><li id="3e50" class="mg mh iq ll b lm mr lp ms ls mt lw mu ma mv me mn mo mp mq bi translated">记笔记的樱桃树，我强烈推荐来自<a class="ae mf" href="https://411hall.github.io/OSCP-Preparation/" rel="noopener ugc nofollow" target="_blank">詹姆斯霍尔</a>的模板</li></ul><h1 id="a046" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">列举</h1><p id="ef42" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">今天，我们将从HackTheBox了解Bastion，因此，请启动并运行您的VPN。</p><p id="5bbf" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">首先，让我们从枚举开始，以便获得尽可能多的关于机器的信息。第一步是使用nmap。我的nmap方法如下:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="7d55" class="ne ks iq na b gy nf ng l nh ni">nmap -A -oA nmap 10.10.10.134</span></pre><p id="a591" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">这种扫描设置运行非常快，并显示重要的结果。我们可以使用以下命令查看我们的扫描:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="f420" class="ne ks iq na b gy nf ng l nh ni">less nmap.nmap</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nj"><img src="../Images/a1694db8986ab11b7597fea0c6a0124a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7taGhnGal9Qy4nmY2C_esQ.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">Nmap端口扫描</figcaption></figure><h1 id="167f" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">调查的结果</h1><p id="5435" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">Cherry Tree中有一些有趣的发现需要记录下来，这些发现也将记录在pentest报告中:</p><ul class=""><li id="385e" class="mg mh iq ll b lm mi lp mj ls mk lw ml ma mm me mn mo mp mq bi translated">端口22是开放的，这是ssh。系统使用OpenSSH for windows。大多数Unix系统使用OpenSSH，而不是Windows系统。</li><li id="5fa6" class="mg mh iq ll b lm mr lp ms ls mt lw mu ma mv me mn mo mp mq bi translated">端口135上的远程过程调用</li><li id="1130" class="mg mh iq ll b lm mr lp ms ls mt lw mu ma mv me mn mo mp mq bi translated">端口139 (NetBios)和端口445上的SMB</li><li id="c799" class="mg mh iq ll b lm mr lp ms ls mt lw mu ma mv me mn mo mp mq bi translated">没有网络服务器在运行，这很奇怪</li><li id="cc38" class="mg mh iq ll b lm mr lp ms ls mt lw mu ma mv me mn mo mp mq bi translated">Nmap给了我们更多关于这个系统的信息:这是一个Windows server 2016，计算机名是Bastion</li></ul><p id="1623" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我会仔细看看中小企业。有时SMB上有匿名访问，但是OpenSSH上几乎总是有某种认证。</p><p id="8d26" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">电脑的名字好像很可疑。如果你不知道:堡垒是防御工事的一部分，例如城堡。它的主要目的是保护城堡免受攻击者的攻击。这种技术也在IT中使用。堡垒主机是网络上的一台计算机，专门设计和配置来抵御攻击。计算机通常托管单个应用程序，例如代理服务器，并且移除或限制所有其他服务以减少对计算机的威胁。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/28d7f3e7eec28c2794cbbd3f94b79c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*zNNpsi9OGe9zNqL9.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">堡垒主机</figcaption></figure><p id="d121" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">Henrik Sylvester Pedersen写了一篇关于这个主题的很好的文章，他在文章中解释说堡垒主机真的没有存在的必要。</p><h1 id="07b7" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">回到黑客</h1><p id="6f42" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">每当445端口(SMB)打开时，我喜欢使用一个叫做smbclient的工具。它是中小企业/CIFS共享的控制台客户端。它还允许访问共享，而不必将它们装载到文件系统上。smbclient最初是作为测试和调试工具设计的，现在也变成了一个通用shell，其命令集可以与FTP相媲美。要检查系统中的共享，我们将使用以下命令:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="1a2e" class="ne ks iq na b gy nf ng l nh ni">smbclient -L //10.10.10.134</span></pre><p id="8b5b" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">L列出了股份。我只是按了工作组密码上的回车键，让它空着。结果如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/54cc9b636a8f68fd2d30bd29941a3868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*u-IBiNRR1SIF5ZSCohC8YQ.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">SMB客户端</figcaption></figure><p id="1fa7" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">ADMIN $ C $和IPC$都是所有默认共享。备份是一个独特的共享。我喜欢在还没有挂载的情况下查看共享。这也可以使用smbclient来完成:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a007" class="ne ks iq na b gy nf ng l nh ni">smbclient //10.10.10.134/backups</span></pre><p id="8c9d" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我们现在在SMB中，使用“ls”命令，我们可以列出备份共享中的所有文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nq"><img src="../Images/1b857823952f011f9d31c0ed2f15c658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqJ54cCxOdPOKKsHBD5irA.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">备份共享中的文件</figcaption></figure><p id="4322" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">note.txt看起来很有意思。为了阅读它，我们首先必须使用“get”命令将它下载到我们的机器上:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nr"><img src="../Images/a270afafd2a08cc5d915bb04a2732b04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Tfh43KviFzFf9SzYtYVOQ.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">系统管理员注释</figcaption></figure><p id="c76a" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">感谢您的注意，系统管理员。现在我们知道不应该在本地传输备份文件。</p><h1 id="b516" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">增加</h1><p id="a310" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">下一步是装载备份共享。首先，我们将使用以下命令创建一个新目录:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="934a" class="ne ks iq na b gy nf ng l nh ni">mkdir /mnt/smb</span></pre><p id="15f6" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">“mkdir”代表make目录，“mnt”代表mount，“smb”显然代表SMB。</p><p id="d002" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">然后，我们将使用以下命令将其挂载到新目录中:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="6659" class="ne ks iq na b gy nf ng l nh ni">mount -t cifs //10.10.10.134/Backups /mnt/smb</span></pre><p id="48ec" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">“-t”代表类型，类型为cifs，因为正在使用Windows。然后，我们将指定IP地址、我们想要装载的共享以及我们新创建的目录/mnt/smb。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ns"><img src="../Images/754f99e3411fb29052d688ccf542e19a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzW7tHimyMzKZPVV0H5nnw.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">装载备份共享</figcaption></figure><p id="e7a7" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">只需输入根密码。</p><p id="0e8b" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">如果我们键入“ls /mnt/smb ”,我们可以看到这些文件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7b89019aa73a4934f22c646484a7e2c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*8Swy2XRu4iaPBdmZHbhZPA.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">文件</figcaption></figure><p id="13c1" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我们已经签出了note.txt，所以让我们使用“ls”命令来仔细看看WindowsImageBackup目录:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/9cb235143583d8663ccc394b890737c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*dvsA_JZdL8IsQaTyk3xq4Q.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">WindowsImageBackup</figcaption></figure><p id="af86" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我们可以看到来自“L4mpje-PC”的备份。我又四处看了看，找到了一个电脑备份文件夹:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nv"><img src="../Images/f1eabdcbd98b2ded2d9c655cea147744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1VvHVi1AFDpVBTZ1MMCZOQ.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">备份目录中的文件</figcaption></figure><p id="9547" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">“ls -la”命令向我们显示所有文件，甚至是隐藏的文件。两个。vhd文件看起来很有趣。“Vhd”代表虚拟硬盘。我们可以安装到。vhd文件使用命令“guestmount”。您必须首先使用以下命令安装它:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a8e4" class="ne ks iq na b gy nf ng l nh ni">apt install libguestfs-tools</span></pre><p id="3741" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">在我们安装这两个之前。vhw文件，我们应该先创建一个新目录:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="7cbb" class="ne ks iq na b gy nf ng l nh ni">mkdir /mnt/vhd</span></pre><p id="21a2" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">现在，我们可以使用以下命令挂载这两个文件:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="732c" class="ne ks iq na b gy nf ng l nh ni">guestmount --add 9b9cfbc3–369e-11e9-a17c-806e6f6e6963.vhd -inspector -ro -v /mnt/vhd</span></pre><p id="16ed" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">和</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="ec0b" class="ne ks iq na b gy nf ng l nh ni">guestmount --add 9b9cfbc4–369e-11e9-a17c-806e6f6e6963.vhd -inspector -ro -v /mnt/vhd</span></pre><p id="7158" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">— add指定vhd文件，— inspector检查磁盘以查找操作系统并装载文件系统，就像它们将被装载在真实的虚拟机上一样，-ro代表只读，-v代表详细模式。之后，我们只需要指定我们的目录/mnt/vhd。装载可能需要几分钟。如果这是一个真正的pentest或OSCP考试，我会继续寻找漏洞，并进一步列举。</p><p id="6344" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">现在，我们可以进入目录，使用以下命令检查文件:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="929f" class="ne ks iq na b gy nf ng l nh ni">cd /mnt/vhd<br/>ls</span></pre><p id="5fd0" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">这是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nw"><img src="../Images/4916b5eda641898383b708c5d4eb6c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dkcLjlUsoaKCk0Ul1nwgXw.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">挂载的目录</figcaption></figure><p id="779d" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我们显然是在Windows C:/驱动器中。稍微找了一下，找到一个名为“Users”的目录，里面有一个用户叫“L4mpje”。桌面上和documents directoy中的文件总是非常有趣，所以让我们使用这个命令来查找一些文件:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="2002" class="ne ks iq na b gy nf ng l nh ni">find Desktop/ Downloads/ Documents/ -ls</span></pre><p id="d6ea" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">遗憾的是，我们没有发现什么太有趣的东西:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nx"><img src="../Images/a8af2b458b2b5a1410ed03ad434982b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z8IIHD1gfPeRDYPSzlfOTQ.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">在桌面上查找文件、文档、下载</figcaption></figure><h1 id="6215" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">密码</h1><p id="81fc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们可以尝试做的一件事是提取这个用户的密码。为此，我们必须进入/Windows/System32/config目录:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi ny"><img src="../Images/5eeee26fd048a4c8b0c0b31f888d6043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*55gKKxbScs-FQZ1aLFTlgg.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">系统32/配置</figcaption></figure><p id="4a2d" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">两个有趣的文件是“SAM”和“SYSTEM”。“SAM”文件是安全帐户管理器，它包含登录名和密码散列。用户密码以散列格式存储在注册表配置单元中，作为LM散列或NTLM散列。“系统”文件包含启动时已经需要的Windows设置，例如通过驱动程序和服务。</p><p id="96a4" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">如果我在域控制器上，我还会获取“ntds.dit”文件，这是Active Directory数据库文件。有了这三个文件，我就能够解密广告数据库。但是现在，让我们使用这个命令将这两个文件复制到我们的linux机器上:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="4b0a" class="ne ks iq na b gy nf ng l nh ni">cp SAM SYSTEM /root/htb/boxes/bastion</span></pre><p id="34a8" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">“cp”代表复制，然后我们必须指定我们想要复制的文件和位置。</p><p id="8c7c" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我决定在我的机器上创建一个新的目录来保持有序:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="0dcc" class="ne ks iq na b gy nf ng l nh ni">mkdir dump</span></pre><p id="7477" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">将文件移动到这个位置也很容易:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="b5c0" class="ne ks iq na b gy nf ng l nh ni">mv SAM SYSTEM /dump</span></pre><p id="23cf" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我们现在要做的就是将cd放入目录，并从SAM文件中转储密码散列。有几种方法可以做到这一点。有一个非常酷的python脚本叫做“<a class="ae mf" href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py" rel="noopener ugc nofollow" target="_blank"> SecretsDump </a>”。您可以从github页面克隆它，但是Kali linux已经安装了它。该命令如下所示:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="c715" class="ne ks iq na b gy nf ng l nh ni">impacket-secretsdump -sam SAM -system SYSTEM local</span></pre><p id="86e0" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">脚本运行得非常快，给了我们这些结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nz"><img src="../Images/49c2abd51c263be1a64b339442f7dc0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOPmCKK7iEwh6Dn8l2wWCA.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">来自SAM文件的解密哈希</figcaption></figure><p id="1fc1" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">NTLM哈希“31 D6 cf E0 d 16 AE 931 b 73 c 59d 7 E0 c 089 c 0”是一个空白/空密码。LM哈希“aad3b 435 b 51404 eeaad3b 435 b 51404 ee”也是如此。这可能意味着管理员帐户被禁用。然而，我们从用户“L4mpje”那里获得了NTLM散列。我们来试着解密一下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi oa"><img src="../Images/3047797ac19eedc46bedd03a6259d92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*buFiZl82-GgzTv_kghybmQ.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">NTLM哈希破解</figcaption></figure><p id="ef15" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我使用了一个随机的hash cracker，几秒钟后我得到了被破解的hash，也就是“bureaulampje”。我在Cherry Tree中写下了凭证“l4mpje:bureaulampje ”,并尝试使用这些凭证通过ssh进行连接:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="10de" class="ne ks iq na b gy nf ng l nh ni">ssh l4mpje@10.10.10.134</span></pre><p id="c866" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我立即获得了访问权限:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/e3ced2e65d65b193e154063881c14358.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*g8WP6-aBJ81HofB00XlR4w.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">用户L4mpje</figcaption></figure><p id="485c" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">出于本文的考虑，我将继续获取user.txt，然后转到特权提升部分来获取root.txt。</p><p id="f2e0" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">如果我们进入用户目录，我们将找到我们的用户“L4mpje”。user.txt应该在他的桌面上:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/a7c461c604392448f4edd41a36e0f08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*YZXQ8MATDB99wPIbK2qx1g.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">User.txt</figcaption></figure><p id="33ad" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我找了很长时间，查看了备份、日志和程序文件目录。我发现了一个有趣的应用程序，名为“mRemoteNG”:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b93fabb6ac47def314e46018d834ed89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*U5UJL169atJSeyGpr-GLcg.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">姆雷莫滕</figcaption></figure><h1 id="0fe1" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">姆雷莫滕</h1><p id="daa3" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这是一个用于Windows的开源、多协议、远程连接管理器。堡垒主机通常被用作带有远程管理工具的跳转主机，因此它们可以访问其他机器。</p><p id="495b" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">有一篇关于这个话题的有趣的<a class="ae mf" href="https://hackersvanguard.com/mremoteng-insecure-password-storage/" rel="noopener ugc nofollow" target="_blank">博文</a>。基本上，mRemoteNG使用不安全的方法来存储密码，并可以在评估或比赛期间提供大量有效的凭证。密码的位置在C:\ Users \ AppData \ Roaming \ mRemoteNG中。AppData是一个隐藏目录，所以你必须使用命令“cd /a”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/526cb72769fec93adc9ae21add47590d.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*vjvVNvwQRcxdcVjzoowRtg.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">姆雷莫滕</figcaption></figure><p id="d6f6" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">连接配置文件名为confCons.xml:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi of"><img src="../Images/64e06443568671dee48903b7ed10806f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FmDyGQVhYNUfm2KtdrPLcA.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">confCons.xml</figcaption></figure><p id="f769" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">使用“type”命令，我们可以打印出配置文件的内容。我们可以看到管理员密码“aewnfv 5 ugcjuhf 0 us 17 qtdt 9 kvqtkcpeoc 0 NW 5 dmapfjnq 2 kt/zo5 xdqe 4 hdvmhaowvrdc 7 emf 7 lwwa 10 dqkiw = =”</p><p id="825f" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">有一个很酷的<a class="ae mf" href="https://github.com/haseebT/mRemoteNG-Decrypt" rel="noopener ugc nofollow" target="_blank"> python脚本</a>，你可以从github克隆它来解密管理员密码。该命令如下所示:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="8dcb" class="ne ks iq na b gy nf ng l nh ni">python3 mremoteng_decrypt.py -s aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==</span></pre><p id="4bc3" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">密码是“thXLHM96BeKL0ER2”。</p><p id="6056" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">我们现在可以使用ssh连接到管理员帐户:</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="a448" class="ne ks iq na b gy nf ng l nh ni">ssh administrator@10.10.10.134</span></pre><p id="2a1d" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">现在获取admin.txt非常容易:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/4663c9929ba8ade08be95a117c4f88fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*AvYFRDNzLX0t8fr3hWySEA.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">管理. txt</figcaption></figure><h1 id="a2ef" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">摘要</h1><p id="3045" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这真是一个有趣的盒子！快速回顾导致我们拥有这台机器的所有漏洞:</p><p id="2eac" class="pw-post-body-paragraph lj lk iq ll b lm mi jr lo lp mj ju lr ls mw lu lv lw mx ly lz ma my mc md me ij bi translated">由于匿名登录SMB，我们可以访问备份目录。没有密码的访客身份验证不是一个好主意，尤其是如果有一个包含敏感信息的目录。之后，我们得到了用户L4mpje的NTLM密码哈希。这是一个非常弱的密码，所以只需要几秒钟就可以解密。始终使用安全的密码。最佳做法是使用至少12个字符长的密码，包括数字和特殊字符。多因素身份认证也是一种很好的应对措施。然后我们使用mRemoteNG应用程序获取管理员密码。使用具有已知漏洞的应用程序并不明智，尤其是当它存储的密码具有弱散列时。所有这些因素导致我们获得了管理员权限。请继续关注我的系列文章的第三部分。</p></div></div>    
</body>
</html>