<html>
<head>
<title>Exploiting an unknown vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用未知漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-an-unknown-vulnerability-a752272ffd7f?source=collection_archive---------0-----------------------#2018-10-03">https://infosecwriteups.com/exploiting-an-unknown-vulnerability-a752272ffd7f?source=collection_archive---------0-----------------------#2018-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="eecf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大约2个月前，我在一个咨询应用程序中发现了这个漏洞。他们的安全团队告诉我，这个应用程序已经过测试，如果我能找到一个漏洞，他们将奖励奖金。对于新的目标，我首先分析应用程序并制作其功能的数据流图，然后开始寻找漏洞。我广泛地测试逻辑漏洞，因为从我的经验来看，我知道会有一些关键的转换可能被应用程序开发人员或测试人员遗漏。</p><p id="5b48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我把它命名为“未知”漏洞，因为我想把它作为一个练习和记录，这就是为什么我没有在标题中写细节。</p><p id="6feb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有两种类型的用户角色:目标应用程序中的顾问和客户。该应用程序的核心功能是为各种客户提供咨询服务。</p><ul class=""><li id="4113" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">顾问们以硬币形式收取服务费。</li></ul><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="505f" class="ld le iq kz b gy lf lg l lh li"><strong class="kz ir">#</strong> <strong class="kz ir">consultant request</strong></span><span id="15f1" class="ld le iq kz b gy lj lg l lh li">POST /set/fee/</span><span id="ac07" class="ld le iq kz b gy lj lg l lh li">{"value": 5, "timing":2}</span></pre><ul class=""><li id="d037" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">客户访问顾问的时间表，选择一个合适的时间段并预订该时间，硬币将根据时间表中显示的相应时间段的费用从客户的帐户中扣除。</li></ul><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="4f5f" class="ld le iq kz b gy lf lg l lh li"><strong class="kz ir">#</strong> <strong class="kz ir">client request</strong></span><span id="cb2c" class="ld le iq kz b gy lj lg l lh li">POST /consultant_username/book</span><span id="c227" class="ld le iq kz b gy lj lg l lh li">{"timing":2}</span></pre><p id="da19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在进一步阅读之前，我建议你们写下自己的测试用例或者开发上述功能的方法。祝您好运👍</p><figure class="ku kv kw kx gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lk"><img src="../Images/19d1f770b6d81353db72ed50cbc15764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYxxMeg9CDzX_NLhCap3Sw.jpeg"/></div></div></figure><p id="d54b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想出了以下测试案例🤔。</p><ol class=""><li id="66ac" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk ls kr ks kt bi translated">Sqli、命令注入等注入漏洞</li><li id="6a44" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">修改内容类型并将数据请求到xml以测试XML注入</li><li id="f50a" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">用更少的硬币预订顾问的更高价值的时间段</li><li id="42ca" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">从<strong class="jp ir">顾问请求</strong>中注入<strong class="jp ir">值</strong>参数，并在<strong class="jp ir">客户请求</strong>中使用</li><li id="2b08" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">参数污染通过注入两个<strong class="jp ir">定时</strong>值在<strong class="jp ir">客户端</strong>请求<strong class="jp ir">中</strong></li><li id="3fe9" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">使用<strong class="jp ir">客户端</strong> <strong class="jp ir">请求</strong>中的<strong class="jp ir">计时</strong>值进行基于数组的注入，即{"timing[0]":2}</li><li id="c10f" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">通过将POST改为PUT篡改HTTP方法</li><li id="acb0" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">通过播放多线程<strong class="jp ir">客户端</strong> <strong class="jp ir">请求</strong>预约同一个顾问的两个或多个时间段(竞争条件)</li><li id="2c78" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">通过播放多线程<strong class="jp ir">客户端</strong>请求<strong class="jp ir">请求</strong>预约两个不同的顾问时间段(竞争条件)</li></ol><p id="c233" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我敢肯定，你可能已经想出了不同的测试案例，所以请在下面评论你的测试案例。</p><p id="5350" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，上述测试案例都不适合我😥。可能是他们的安全团队缓解了这些漏洞，或者是有经验的开发人员构建了应用程序。</p><p id="3e85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二天，我再次查看，这次我的注意力更多地集中在预订请求上，因为请求中没有传递硬币，在提交<strong class="jp ir">客户请求</strong>后，硬币会自动从客户的账户中扣除。</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="2967" class="ld le iq kz b gy lf lg l lh li">POST /consultant_username/book</span><span id="41b3" class="ld le iq kz b gy lj lg l lh li">{"timing":2}</span></pre><p id="f0ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如果顾问在客户预定时间段</strong>之前将费用调高，会发生什么情况。我很兴奋🤩我认为这应该行得通，但对我来说还是行不通。因为它显示了“这个位置的顾问费是10英镑”的信息。</p><figure class="ku kv kw kx gt ll gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/bec71aeb4960da36ab474cfb4d22d215.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*W7JE1YcyRLtdXm5G9zfpQg.png"/></div></figure><p id="0f26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我本来打算放弃，但是<strong class="jp ir">竞争条件</strong>的想法出现在我的脑海中，为了测试它，我向web服务器发送了多线程请求，每次在四个不同的请求中有四个不同的咨询费(5，15，15，5)，并将这些请求放在一个循环中半小时。当客户在此期间访问顾问时间线时，有50%的机会客户将最终支付更高的费用。通过这种方式，我成功地利用了😄这种漏洞通过快速改变咨询价格。应用程序也有一个提供功能，其中顾问可以设置一定时期的折扣。</p><h1 id="cc80" class="lz le iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated"><strong class="ak">攻击流</strong></h1><ol class=""><li id="a493" class="kl km iq jp b jq mw ju mx jy my kc mz kg na kk ls kr ks kt bi translated">顾问为任何时间段“x”设置5个硬币的费用。</li><li id="cd32" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">顾问设定报价周期，即一天30-60分钟。</li><li id="ce35" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">客户在报价期间访问顾问时间表。</li><li id="ce9f" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">顾问通过循环播放多线程<strong class="jp ir">顾问请求</strong>快速改变咨询价格，并发送给服务器。</li><li id="bac6" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">客户通过向服务器发送预订请求来支付费用。</li><li id="de55" class="kl km iq jp b jq lt ju lu jy lv kc lw kg lx kk ls kr ks kt bi translated">额外的硬币会从客户账户中扣除。</li></ol><h1 id="867b" class="lz le iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated"><strong class="ak">影响</strong></h1><p id="4e7f" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy nb ka kb kc nc ke kf kg nd ki kj kk ij bi translated">顾问可以欺骗客户支付比他们的服务时间表中显示的更高的金额。</p><h1 id="621a" class="lz le iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated"><strong class="ak">外卖</strong></h1><p id="280d" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy nb ka kb kc nc ke kf kg nd ki kj kk ij bi translated">作为维护者，制作一个漏洞清单，并对应用程序中实现的每个功能进行测试。应该实现基于速率限制和竞争条件的锁定系统来防止这种类型的漏洞。</p><p id="be1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着应用程序功能的增长，其复杂性呈指数级增长，在应用程序的设计、开发或安全测试阶段错过一些测试用例的机会也越来越多。通过反复查看请求历史来分析应用程序功能，了解应用程序中的数据流等。将你的精力和时间花在构建更智能的测试用例上，以打破应用程序的用例。</p><p id="6464" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">非常感谢！</p><p id="6790" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">学习、构建和突破！</p><blockquote class="ne nf ng"><p id="adf3" class="jn jo nh jp b jq jr js jt ju jv jw jx ni jz ka kb nj kd ke kf nk kh ki kj kk ij bi translated">最初发布于:<a class="ae nl" href="https://abhibundela.com/2018/09/25/exploiting-an-unknown-vulnerability/" rel="noopener ugc nofollow" target="_blank">https://abhibundela . com/2018/09/25/exploining-an-unknown-vulnerability/</a></p></blockquote></div></div>    
</body>
</html>