<html>
<head>
<title>OpenAdmin — HackTheBox Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenAdmin — HackTheBox编写</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/openadmin-hackthebox-writeup-ffbc3f9c84c9?source=collection_archive---------2-----------------------#2020-05-02">https://infosecwriteups.com/openadmin-hackthebox-writeup-ffbc3f9c84c9?source=collection_archive---------2-----------------------#2020-05-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="11df" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">OpenAdmin是一个本周即将退休的简单机器。我们通过利用<a class="ae kf" href="https://www.exploit-db.com/exploits/47691" rel="noopener ugc nofollow" target="_blank"> OpenNetAdmin RCE </a>获得了最初的立足点，并通过密码重用升级到用户jimmy。机器上的内部服务Port forwarding为我们提供了一个加密的SSH密钥，我们通过破解这个密钥以joanna用户的身份获得访问权。通过<code class="fe kg kh ki kj b">nano</code>命令的sudo pwnage获得root权限。</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/68899295940fb5d794f71644a84eb496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQJl_9ovLOHstmP4POIBRw.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">信息卡</figcaption></figure><h1 id="18a3" class="la lb iq bd lc ld le lf lg lh li lj lk jw ll jx lm jz ln ka lo kc lp kd lq lr bi translated">侦察</h1><p id="281f" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi mo translated">像往常一样，让我们从Nmap扫描开始。</p><pre class="kl km kn ko gt mx kj my mz aw na bi"><span id="a408" class="nb lb iq kj b gy nc nd l ne nf">Nmap scan report for 10.10.10.171<br/>Host is up (0.25s latency).</span><span id="9adf" class="nb lb iq kj b gy ng nd l ne nf">PORT   STATE SERVICE VERSION<br/>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)<br/>|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)<br/>|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)<br/>80/tcp open  http    Apache/2.4.29 (Ubuntu)<br/>|_http-server-header: Apache/2.4.29 (Ubuntu)<br/>|_http-title: Apache2 Ubuntu Default Page: It works<br/>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></pre><p id="c811" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">SSH和HTTP端口是打开的。让我们从80端口开始。</p><h2 id="be3a" class="nb lb iq bd lc nm nn dn lg no np dp lk mb nq nr lm mf ns nt lo mj nu nv lq nw bi translated">人工访问</h2><p id="b189" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">在访问页面时，我们会看到默认的Apache安装页面。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nx"><img src="../Images/a3dfde1fc1431ded4c08c9a5720a04df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_TjGh4ETbqkCTRdzPX0r-A.png"/></div></div></figure><h2 id="848e" class="nb lb iq bd lc nm nn dn lg no np dp lk mb nq nr lm mf ns nt lo mj nu nv lq nw bi translated">Gobuster</h2><p id="9660" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">这是gobuster的输出，</p><pre class="kl km kn ko gt mx kj my mz aw na bi"><span id="d4d6" class="nb lb iq kj b gy nc nd l ne nf">/music (Status: 301)<br/>/artwork (Status: 301)<br/>/sierra (Status: 301)<br/>/server-status (Status: 403)</span></pre><p id="2ae0" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">参观/音乐</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ny"><img src="../Images/68c0a98292ea8edf0ffd268a9acbef0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDw7mL2mSi_4ELL9XvIR8g.png"/></div></div></figure><p id="11bc" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">有一个登录按钮，点击它可以进入<code class="fe kg kh ki kj b"><a class="ae kf" href="http://10.10.10.171/ona" rel="noopener ugc nofollow" target="_blank">http://10.10.10.171/ona</a></code></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nz"><img src="../Images/3c7de8711c21f813ae00dc9acbfd1933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAKQW411k-rvXV3LVpCRDQ.png"/></div></div></figure><p id="2cb5" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">软件版本暴露。快速的谷歌搜索向我们展示了一个远程代码执行漏洞。</p><p id="6774" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">我利用了这个。</p><div class="oa ob gp gr oc od"><a href="https://github.com/amriunix/ona-rce" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">amriunix/ona-rce</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">OpenNetAdmin 18.1.1 -远程代码执行https://amriunix.com/检查-验证目标是否易受攻击…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">github.com</p></div></div><div class="om l"><div class="on l oo op oq om or ku od"/></div></div></a></div><p id="6cf2" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">只需通过拦截请求来更新漏洞利用中的<code class="fe kg kh ki kj b">xajxr</code>的值。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi os"><img src="../Images/67ba5b332cec07eb4842d0108772ee76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aBOkc4ZTdoUDCWF2opafLg.png"/></div></div></figure><h1 id="e005" class="la lb iq bd lc ld le lf lg lh li lj lk jw ll jx lm jz ln ka lo kc lp kd lq lr bi translated">作为www-data的Shell</h1><p id="48e3" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">利用上述漏洞，我们可以在机器上执行代码。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ot"><img src="../Images/9c1924d6ca4bc231fdd25771783ea669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k8dzd4Rd-fGxWRP2dWFU_A.png"/></div></div></figure><p id="f181" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">是时候拿个反壳了。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ou"><img src="../Images/0802f4eb3b7bcd8f4ab4747c99acd320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Htu4TLBMEHU2qP4lrMYjg.png"/></div></div></figure><p id="189b" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">看来我们找到了一些用户名和密码。让我们在SSH上尝试一下，看看是否有可能重用密码。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/e805d1bdbaaf6d16ca9ea1ba872ab5a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*l5opauRlxX2UaiHMYTtdIA.png"/></div></figure><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ow"><img src="../Images/c1461294a6a9a48226e82fb0281f6cba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9jd-uoh7i1InLgNW79SeCA.png"/></div></div></figure><h1 id="0c93" class="la lb iq bd lc ld le lf lg lh li lj lk jw ll jx lm jz ln ka lo kc lp kd lq lr bi translated">扮演吉米</h1><p id="91e7" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">这些凭证适用于SSH上的jimmy用户。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ox"><img src="../Images/ce5fe99908a05362fab40bcd84a5f4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S4jOtILZHkV8Kj4PVpigfA.png"/></div></div></figure><h2 id="f33d" class="nb lb iq bd lc nm nn dn lg no np dp lk mb nq nr lm mf ns nt lo mj nu nv lq nw bi translated">内部服务</h2><p id="d299" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">在运行linpeas时，我们可以看到在端口52846上有一个本地运行的服务。让我们把它转接到我们的信箱，看看里面有什么。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi oy"><img src="../Images/a2100475721c5cbb8b1c6fd87dc584d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3KVqece4Qh6eUD92j-lddQ.png"/></div></div></figure><h2 id="9af2" class="nb lb iq bd lc nm nn dn lg no np dp lk mb nq nr lm mf ns nt lo mj nu nv lq nw bi translated">端口转发</h2><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi oz"><img src="../Images/152b38b21e9f1e51ae3782daa805dcad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vaqFjS2lci0dGukCQt-0cw.png"/></div></div></figure><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pa"><img src="../Images/8919b259cac6db68abbb5930f150385f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QMRFQ8tJi59zuwY71RGIbQ.png"/></div></div></figure><p id="c275" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">我们看到了一个登录页面，通常的admin:admin、admin:password等在这里不起作用。继续列举。</p><p id="77e0" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">我们从<code class="fe kg kh ki kj b">/var/www/internal/index.php</code>中发现了这条有趣的线</p><pre class="kl km kn ko gt mx kj my mz aw na bi"><span id="2537" class="nb lb iq kj b gy nc nd l ne nf">&lt;?php<br/>      $msg = '';</span><span id="0159" class="nb lb iq kj b gy ng nd l ne nf">      if (isset($_POST['login']) &amp;&amp; !empty($_POST['username']) &amp;&amp; !empty($_POST['password'])) {<br/>      if ($_POST['username'] == 'jimmy' &amp;&amp; hash('sha512',$_POST['password']) == '00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1') {<br/>                  $_SESSION['username'] = 'jimmy';<br/>                  header("Location: /main.php");<br/>              } else {<br/>                  $msg = 'Wrong username or password.';<br/>              }<br/>            }</span></pre><p id="8357" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">哈希被破解了</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pb"><img src="../Images/572d929e6eb91ba35388b8592bab9133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mArIr7wYzKBI-4-SQ7oV2Q.png"/></div></div></figure><p id="60a9" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">我们现在也可以登录了，</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pc"><img src="../Images/bdf0a0457af2a5c646660baeb62135cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SfWVbO4vmUNbwu9MigQk5A.png"/></div></div></figure><h1 id="1477" class="la lb iq bd lc ld le lf lg lh li lj lk jw ll jx lm jz ln ka lo kc lp kd lq lr bi translated">乔娜·谢尔</h1><p id="3ef8" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">上面的SSH密钥是乔安娜的，但它是加密的。约翰和约翰该去工作了。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pd"><img src="../Images/9832bb672638ad7e64d6d1af4bc4a7db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pAI9cnmBZBV9_f6bxPPM7w.png"/></div></div></figure><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pe"><img src="../Images/68c459129e91dfddbf6827b96142c029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q2VnSU961BW-ezRtxf-w8g.png"/></div></div></figure><h1 id="2eac" class="la lb iq bd lc ld le lf lg lh li lj lk jw ll jx lm jz ln ka lo kc lp kd lq lr bi translated">Root权限</h1><p id="90e8" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">乔安娜在<code class="fe kg kh ki kj b">nano</code>上有sudo权限</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pf"><img src="../Images/4b44c6ee1c0df3d499d73cfca1a7c994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uNU-fqjdicVhhHGMYez5Mw.png"/></div></div></figure><p id="fdf5" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">跟随<a class="ae kf" href="https://gtfobins.github.io/gtfobins/nano/#sudo" rel="noopener ugc nofollow" target="_blank">https://gtfobins.github.io/gtfobins/nano/#sudo</a>，我们得到根壳，</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pg"><img src="../Images/7e0936b89302c2bba7c84a0ca50fdf45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZRZ5vjrGDo-vh4wqFHw56Q.png"/></div></div></figure><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ph"><img src="../Images/c9aaa8ffead44b52a88fbdfb3f0d82c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w4jQW1T1e3T1bETPXIrmtg.png"/></div></div></figure><p id="a411" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">如果你喜欢这篇文章，请留下你的掌声，你可以关注我在<a class="ae kf" href="https://twitter.com/cyber01_" rel="noopener ugc nofollow" target="_blank">https://twitter.com/cyber01_</a>的更新:)</p><p id="d7c6" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">感谢和问候，</p><p id="585d" class="pw-post-body-paragraph ls lt iq lu b lv nh jr lx ly ni ju ma mb nj md me mf nk mh mi mj nl ml mm mn ij bi translated">普雷瑟姆</p></div></div>    
</body>
</html>