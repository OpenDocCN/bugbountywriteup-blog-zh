<html>
<head>
<title>Detecting Web Attacks Using A Convolutional Neural Network</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用卷积神经网络检测Web攻击</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/detecting-web-attacks-using-a-convolutional-neural-network-c778c73e2e2a?source=collection_archive---------2-----------------------#2022-01-06">https://infosecwriteups.com/detecting-web-attacks-using-a-convolutional-neural-network-c778c73e2e2a?source=collection_archive---------2-----------------------#2022-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4f30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">简介</strong></p><p id="1192" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天，我们将讨论卷积神经网络及其在网络安全领域的应用方式。正如你们中的一些人可能知道的，用于网络安全的机器学习应用程序在过去几年里变得非常流行。许多不同类型的模型用于检测不同类型的攻击。</p><p id="8656" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们今天重点关注的特定攻击媒介是web利用。由于现在大多数应用程序是web应用程序，并且由于它们暴露于万维网，许多网络攻击的目标是利用面向公众的web应用程序。web利用技术的一些例子是诸如SQL注入之类的攻击，在这种攻击中，攻击者试图利用网页的输入，从而可以通过将SQL注入特定的输入区域来查询或更改敏感数据。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/e8681207dba06e8946640c094f3aceaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*ZJXZUtvgB93mikxDmWF_ng.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">作者图片</figcaption></figure><p id="aaa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的示例中，一个特制的URL查询被发送到web服务器，以便利用它们的输入并查询敏感数据。</p><p id="2643" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一种类型的web利用技术是XSS(跨站脚本),这种攻击使攻击者能够将客户端脚本插入其他用户查看的网页中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/687459078832757776e3b3e43767cd5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*3usjJa6C9S2lU_H_alW-gA.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">作者图片</figcaption></figure><p id="7fe8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的示例中，当攻击者试图发送包含HTML的字符串时，HTML标记被传递到URL中，该字符串稍后将被另一个客户端解析，代码可能会在他的工作站上执行。</p><p id="6953" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我建议使用机器学习模型来检测这些攻击。我将在github上找到的数据集上训练该模型。数据集包含网络攻击的样本。它包含的查询不是恶意的，有些是，我强烈建议检查一下。</p><div class="ky kz gp gr la lb"><a href="https://github.com/faizann24/Fwaf-Machine-Learning-driven-Web-Application-Firewall" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">GitHub-faiz an 24/Fwaf-机器学习驱动-Web-应用-防火墙:机器学习驱动…</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">github.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp kr lb"/></div></div></a></div><p id="66e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您在下面看到的，这是数据集中一些查询的示例</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi lq"><img src="../Images/5abbdfbfe8ebbe3cc14e5b7d1e34aeba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSIEzgSllT3DIKWVEd1NGg.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">作者图片</figcaption></figure><p id="76da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本质上，这些都只是针对一些网络应用程序的URL。</p><p id="7ccb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用的模型是一个卷积神经网络来检测恶意请求。</p><p id="7a7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">为什么是卷积神经网络？</strong></p><p id="6189" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CNN通常用于视觉领域。其用法的一个例子是在经典的MNIST问题中，它被用来对手写数字进行分类。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi lv"><img src="../Images/7d2d2d224e1fdf18fdcd6d01d64344c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VQ5ZTghN9dl1mcES.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">张量流图像</figcaption></figure><p id="7000" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但想到的一个明显的问题是，如果一个URL具有恶意意图，如何使用这些神经网络进行分类？这是一个很好的问题，也很奇怪，因为图像本质上是矩阵，包含0-255之间的单元值，这些值改变了黑白的程度。这些值然后被输入到一个复杂的函数(神经网络)中，该函数输出关于图像的相关信息。例如，在MNIST问题中，神经网络必须知道如何对数字进行分类，因此图像作为输入给出，数字作为输出给出。关于卷积神经网络如何工作的更深入的解释，请查看本文:<a class="ae lw" href="https://towardsdatascience.com/convolutional-neural-networks-explained-9cc5188c4939" rel="noopener" target="_blank">https://towardsdatascience . com/convolutionary-Neural-Networks-explained-9cc 5188 c 4939</a></p><p id="aa50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题仍然存在，我们如何将URL的数据编码成卷积神经网络可以处理的数据？</p><p id="871d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本质上，我们要做的是使用每个字符的Unicode编码(Unicode表中代表该字符的数字)。这将是我们预处理的一部分，因为神经网络并不真正理解单词，而是理解数字、向量和矩阵等数学对象的函数。神经网络然后学习基于该编码区分恶意和非恶意查询所必需的特征。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/af82271d468f6087051c4378ecb3644d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*ONHaEcTWb7d_9unkUAWF_A.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">作者图片</figcaption></figure><p id="460a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与其他编码类型相比，这是<strong class="jp ir">更好的选择</strong>，例如字符嵌入、单词嵌入和明显的hot编码。它更好的原因是它的存储效率很高。普通的字符嵌入通常会将字符编码成某种向量，这已经比仅仅将字符嵌入其Unicode数字表示中的成本更高。更不用说在这种情况下更加困难的单词嵌入了，因为我们处理的是URL，而不是句子。</p><p id="8339" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将把编码的查询格式化成28x28矩阵，以便更容易与我们现有的MNIST神经网络一起使用(是的，我们采用几乎相同的架构)。</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="e2ed" class="md me iq lz b gy mf mg l mh mi">from keras.models import Sequential,Model</span><span id="75b8" class="md me iq lz b gy mj mg l mh mi">from keras.layers import Dense, Conv2D, Flatten, MaxPool2D</span><span id="b1af" class="md me iq lz b gy mj mg l mh mi">model = Sequential()</span><span id="a166" class="md me iq lz b gy mj mg l mh mi">model.add(layers.Input(shape=(28,28,1)))</span><span id="390b" class="md me iq lz b gy mj mg l mh mi">model.add(Conv2D(64, (5, 5), activation='relu', kernel_initializer='he_uniform'))</span><span id="0585" class="md me iq lz b gy mj mg l mh mi">model.add(layers.BatchNormalization())</span><span id="9f33" class="md me iq lz b gy mj mg l mh mi">model.add(Conv2D(32, (5, 5), activation='relu'))</span><span id="3431" class="md me iq lz b gy mj mg l mh mi">model.add(layers.Dropout(0.2))</span><span id="5098" class="md me iq lz b gy mj mg l mh mi">model.add(MaxPool2D((3,3)))</span><span id="2035" class="md me iq lz b gy mj mg l mh mi">model.add(Flatten())</span><span id="a09c" class="md me iq lz b gy mj mg l mh mi">model.add(Dense(100, activation='relu', kernel_initializer='he_uniform'))</span><span id="5c59" class="md me iq lz b gy mj mg l mh mi">model.add(Dense(2, activation='softmax'))</span><span id="6aea" class="md me iq lz b gy mj mg l mh mi"># compile model</span><span id="6fbf" class="md me iq lz b gy mj mg l mh mi">model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy',metrics.Recall(),metrics.Precision()])</span></pre><p id="8d83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，数据集的预处理我们将使用我编写的生成数据集函数，该函数获取包含原始命令和标签的数据集，并将所有内容编码为UNICODE并附加标签。</p><pre class="km kn ko kp gt ly lz ma mb aw mc bi"><span id="0b9a" class="md me iq lz b gy mf mg l mh mi">def generate_dataset(df):</span><span id="02c4" class="md me iq lz b gy mj mg l mh mi">tensorlist = []</span><span id="a6e0" class="md me iq lz b gy mj mg l mh mi">labelist = []</span><span id="5010" class="md me iq lz b gy mj mg l mh mi"># Generating our dataset sample by sample</span><span id="cd73" class="md me iq lz b gy mj mg l mh mi">for row in df.values:</span><span id="5052" class="md me iq lz b gy mj mg l mh mi">query = row[0]</span><span id="16bd" class="md me iq lz b gy mj mg l mh mi">label = row[1]</span><span id="9cd6" class="md me iq lz b gy mj mg l mh mi"># Encode characters into their UNICODE value</span><span id="25e6" class="md me iq lz b gy mj mg l mh mi">url_part = [ord(x) if (ord(x) &lt; 129) else 0 for x in query[:784]]</span><span id="60db" class="md me iq lz b gy mj mg l mh mi"># Pad with zeroes the remaining data in order for us to have a full 28*28 image.</span><span id="9e2f" class="md me iq lz b gy mj mg l mh mi">url_part += [0] * (784 - len(url_part))</span><span id="2c68" class="md me iq lz b gy mj mg l mh mi">maxim = max(url_part)</span><span id="20b1" class="md me iq lz b gy mj mg l mh mi">if maxim &gt; maxabs:</span><span id="aca4" class="md me iq lz b gy mj mg l mh mi">maxabs = maxim</span><span id="ecac" class="md me iq lz b gy mj mg l mh mi">x = np.array(url_part).reshape(28,28)</span><span id="d511" class="md me iq lz b gy mj mg l mh mi"># label y</span><span id="f57d" class="md me iq lz b gy mj mg l mh mi">if label == 1:</span><span id="2968" class="md me iq lz b gy mj mg l mh mi">y = np.array([0, 1], dtype=np.int8)</span><span id="15fb" class="md me iq lz b gy mj mg l mh mi">else :</span><span id="b95c" class="md me iq lz b gy mj mg l mh mi">y = np.array([1, 0], dtype=np.int8)</span><span id="b58a" class="md me iq lz b gy mj mg l mh mi">tensorlist.append(x)</span><span id="4fda" class="md me iq lz b gy mj mg l mh mi">labelist.append(y)</span><span id="3960" class="md me iq lz b gy mj mg l mh mi">return tensorlist,labelist</span></pre><p id="b656" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，现在我们有了数据集，一切都准备好了，应该是训练和测试模型的时候了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi mk"><img src="../Images/00fe15241c77b12d919837b0be45816b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vA26Gt1xbXskv8GS1DJ1qw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">作者图片</figcaption></figure><p id="995c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如你所看到的，在仅仅2个时期内，神经网络已经表现得令人难以置信。</p><p id="5ad6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看github上的代码:</p><p id="cc57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【https://github.com/tentacool9/MLWAF/tree/master T4】</p></div></div>    
</body>
</html>