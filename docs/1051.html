<html>
<head>
<title>Internet Bank Account Takeover of +1M Users Without User Interaction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在没有用户交互的情况下接管超过100万用户的互联网银行账户</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/internet-bank-account-takeover-of-1m-users-without-user-interaction-75bd184936c5?source=collection_archive---------0-----------------------#2021-01-03">https://infosecwriteups.com/internet-bank-account-takeover-of-1m-users-without-user-interaction-75bd184936c5?source=collection_archive---------0-----------------------#2021-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/498b2db778538452feb41f3dc0f4bba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NvVhYt0bwUF1YrCrHJNL7Q.jpeg"/></div></div></figure><p id="4616" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OAuth是一个开放的协议，允许以简单的标准方法从web、移动和桌面应用程序进行授权。OAuth是一种开放的访问授权标准，通常用于互联网用户授权网站或应用程序访问他们在其他网站上的信息，但不需要给他们密码。亚马逊、谷歌、脸书、微软和Twitter等公司使用这种机制来允许用户与第三方应用程序或网站共享其帐户信息。[维基百科]</p><p id="e30d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OpenID Connect 1.0是OAuth 2.0协议之上的一个简单的身份层。它允许客户端基于授权服务器执行的身份验证来验证最终用户的身份，并以可互操作和类似REST的方式获取关于最终用户的基本配置文件信息。OpenID Connect允许所有类型的客户端(包括基于Web的客户端、移动客户端和JavaScript客户端)请求和接收关于经过身份验证的会话和最终用户的信息。[https://openid.net/]</p><p id="8d56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">著名的网上银行应用之一是使用OAuth 2.0协议和OpenID Connect 1.0对用户进行认证和授权。让我解释一下这个场景。</p><p id="22f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">银行授权服务器接受包含OAuth 2.0和OpenID Connect 1.0规范定义的参数的身份验证请求。您必须输入包含用户名/身份证号和密码的凭据才能登录您的网上银行帐户。</p><p id="0ff4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您已经被识别并在银行注册，您可以使用您的用户名/身份证和密码登录您的帐户。</p><p id="fbd6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我点击“忘记密码了？”按钮。在此步骤中，用户必须输入她/他的身份证和手机号码来更改密码，同时为了确认输入的信息，会向用户的手机号码发送一个OTP代码。</p><p id="9f53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我输入身份信息，得到这个错误信息:“手机和用户名不匹配”。原因是我的手机号码在数据库中不存在，我没有用这个手机号码注册。</p><p id="a31b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请求如下:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/92a17cd8d566f339941ec0eec03569f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dAgnRMrsK9SQq_pRpPQR5w.png"/></div></div></figure><p id="3265" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">答案是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/c8b1638ee47174ad3aa6b33ee48b5e95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-2oOw2dfPUqLvui0aoMUzA.png"/></div></div></figure><p id="1ad6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OMG！当我再次点击登录按钮时，状态代码变为302，并成功登录到我的互联网银行帐户！发生了什么事？</p><p id="cfa0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请求如下:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/e7243b5832790f9db350de700f2f0292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMwW82ZTMohafMs9J9Uonw.png"/></div></div></figure><p id="7f1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回应是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ld"><img src="../Images/74fe35c75e87a5d9aa8f47ee96cdd490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2dSc_snLadRiHBleUy0Hg.png"/></div></div></figure><p id="2a6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而下一个请求和响应如下。</p><p id="cd4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要求是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ld"><img src="../Images/8d4d5625e12b71e2c19d9698d35952b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iuQNkMbLSchT3KR1c5uUnQ.png"/></div></div></figure><p id="8065" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回应是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lc"><img src="../Images/066ff1a141a80fbed10fcc9fed1e4c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sq9i3BBlB8cI9vEtwO8gNA.png"/></div></div></figure><p id="d8ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我登录了我的网上银行账户。</p><p id="c7ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要求是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi le"><img src="../Images/1b52fc6bb3ae5cb3a8b26d46a9a00886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A8Y6kueX9BPGkBkwjr-tIA.png"/></div></div></figure><p id="2320" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回应是:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/a7b8a37b10f3ff8f1cfea16c12b4a284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tBwthMXNWmc1zn2SvxFww.png"/></div></div></figure><p id="fef0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我使用了一个国家ID数据库，并编写了一个方便的漏洞来入侵<strong class="ka ir"> +1M </strong>账户。在图1到图3中，你可以看到一些被入侵的账户。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/af6cab5f03cf3ba9974ebe58205e2f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NNnV6cpdRb9mYZgUxWhhw.png"/></div></div></figure><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/b995ca4566621cb176ee3e61c0b30706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1UgVn2yOZKJiywC-y-f6w.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">图2:受害者账户被接管</figcaption></figure><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lm"><img src="../Images/19f0ddb4b2b379dd4982293b9bba6620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*emPxR4kBGe6P2BHFApcYBA.png"/></div></div><figcaption class="li lj gj gh gi lk ll bd b be z dk translated">图3:受害者账户被接管</figcaption></figure><p id="5021" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的。造成这种漏洞的原因是什么？</p><p id="0a85" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OAuth协议的不正确实现是这一安全漏洞的原因。在这种情况下，开发人员在将OTP发送到电话号码进行验证之前，会为用户帐户分配一个访问令牌。如果受害者的国家ID在数据库中，它将由OpenID进行身份验证，用户将通过URL片段中的访问令牌重定向回应用程序。这是OAuth的隐式授权类型！</p><p id="b26b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:该漏洞已被修补，本文仅供研究和学习之用。</p></div></div>    
</body>
</html>