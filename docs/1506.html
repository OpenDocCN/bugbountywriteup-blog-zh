<html>
<head>
<title>GCP Inspector | Auditing Publicly Exposed GCP Bucket</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP督察|审计公开曝光GCP水桶</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/gcp-inspector-auditing-publicly-exposed-gcp-bucket-ac6cad55618c?source=collection_archive---------4-----------------------#2021-08-03">https://infosecwriteups.com/gcp-inspector-auditing-publicly-exposed-gcp-bucket-ac6cad55618c?source=collection_archive---------4-----------------------#2021-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="116b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">安装</em><strong class="jp ir"><em class="kl">【GCP】督察</em> </strong> <em class="kl">及列举公开曝光的GCP水桶基础知识。</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/9f05a8cb2c1b9b1864dc65983cd4c0cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*iuHMDDfla-ZHWzZy4TtJZA.png"/></div></figure><p id="aa8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在玩<a class="ae ku" href="https://thunder-ctf.cloud/ ." rel="noopener ugc nofollow" target="_blank">雷霆CTF </a>的时候，我创建了一个<strong class="jp ir">简单的python工具</strong>，它可以审计可公开访问的GCP存储桶。<br/>雷霆CTF允许玩家在谷歌云平台(GCP)环境下练习攻击易受攻击的云项目。在每个级别，玩家的任务是利用云部署来找到存储在其中的“秘密”整数。</p><h2 id="cc07" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">他的博客还会带你了解如何安装GCP检查器，这是一个python工具，用于枚举可公开访问的GCP桶。</h2><blockquote class="lw lx ly"><p id="a6e6" class="jn jo kl jp b jq jr js jt ju jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj kk ij bi translated"><strong class="jp ir">工具:</strong>【https://github.com/justmorpheus/gcp-inspector】<strong class="jp ir"/></p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="https://github.com/justmorpheus/gcp-inspector"><div class="gh gi mc"><img src="../Images/b9f12d28fae654c75baca168d581ae65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eyqgkdM6skIpWQRb7E1czg.png"/></div></a></figure><h2 id="10d1" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">假设</h2><ol class=""><li id="22b3" class="md me iq jp b jq mf ju mg jy mh kc mi kg mj kk mk ml mm mn bi translated">已经有了GCP水桶的清单。</li><li id="cd0d" class="md me iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">已经有GCP控制台访问(外壳)与计费帐户。</li><li id="555e" class="md me iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">“gsutil”安装在本地。</li><li id="4243" class="md me iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">访问需要审计的环境中的存储桶列表。这就需要默认范围:<a class="ae ku" href="https://www.googleapis.com/auth/devstorage.full_control" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/devstorage.full_control</a>。这将提供对给定项目的所有存储桶的列表访问。</li></ol><blockquote class="lw lx ly"><p id="aac6" class="jn jo kl jp b jq jr js jt ju jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj kk ij bi translated">这些桶可以保存在file.txt中，供以后在GCP检查器中使用。</p></blockquote><pre class="kn ko kp kq gt mt mu mv mw aw mx bi"><span id="e85a" class="kv kw iq mu b gy my mz l na nb">1. Open the shell of audit environment.<br/>2. Run <!-- -->gcloud config set project [PROJECT_ID]<br/>3. gsutil ls</span></pre><h2 id="074c" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">列举GCP桶的步骤</h2><ol class=""><li id="0db4" class="md me iq jp b jq mf ju mg jy mh kc mi kg mj kk mk ml mm mn bi translated">通过<code class="fe nc nd ne mu b">python3 -m pip install gsutil</code>安装python3和gsutil。</li><li id="6f74" class="md me iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">登录到另一个GCP帐户(外部攻击者)。在运行gsutil config之后，这将是必需的。</li><li id="4527" class="md me iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">通过<code class="fe nc nd ne mu b">gsutil config</code>配置终端使用gsutil。如果未配置或凭据已过期，则会显示错误。</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="https://github.com/justmorpheus/gcp-inspector"><div class="gh gi nf"><img src="../Images/e97f8b3c32389f8d89bbc19a42dd8d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvdGmDNYOVRFImDTOyHiNQ.png"/></div></a><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">认证错误</figcaption></figure><p id="4e54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.验证GCP并完成所需的详细信息，如授权码等。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="https://github.com/justmorpheus/gcp-inspector"><div class="gh gi nk"><img src="../Images/2b19d770f8f3f68c14a88a6f1389d0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rjTyBbSQC4ozn3X8F0nxxw.png"/></div></a><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">验证本地外壳</figcaption></figure><p id="ba69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.一旦完成，我们就可以开始了，运行下面提到的命令来激活虚拟环境并运行GCP检查器。</p><pre class="kn ko kp kq gt mt mu mv mw aw mx bi"><span id="9769" class="kv kw iq mu b gy my mz l na nb">git clone https://github.com/justmorpheus/GCP-Inspector<br/>cd GCP-Inspector<br/>mkdir gcp_inspect<br/>virtualenv -v gcp_inspect<br/>source gcp_inspect/bin/activate<br/>python3 -m pip install -r requirements.txt<br/>python3 gcp_inspector.py -r sample_file.txt</span></pre><p id="2d3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.<strong class="jp ir"> Sample_file.txt </strong>是从审计环境中保存的带有GCP存储桶的文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="https://github.com/justmorpheus/gcp-inspector"><div class="gh gi nl"><img src="../Images/d16bc7f7d1f61edcd438096973b9fada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8CFWqdGPuAmvWqZIfP5rDA.png"/></div></a><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">GCP检查员在行动</figcaption></figure><h2 id="773c" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">Google存储的参考命令</h2><ol class=""><li id="5763" class="md me iq jp b jq mf ju mg jy mh kc mi kg mj kk mk ml mm mn bi translated">将GCP公共存储桶数据复制到本地的命令:</li></ol><pre class="kn ko kp kq gt mt mu mv mw aw mx bi"><span id="197d" class="kv kw iq mu b gy my mz l na nb">gsutil cp -r gs://[BucketName] .</span></pre><p id="46de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.列出bucket中文件总大小的命令(可读)。</p><pre class="kn ko kp kq gt mt mu mv mw aw mx bi"><span id="3a1f" class="kv kw iq mu b gy my mz l na nb">gsutil du -h gs://[BucketName]</span></pre><p id="45dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在谷歌云存储中预览文件的命令。</p><pre class="kn ko kp kq gt mt mu mv mw aw mx bi"><span id="6a06" class="kv kw iq mu b gy my mz l na nb">gsutil cat gs://[BucketName]/folder/filename</span></pre><p id="f2bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.通过端点访问可公开访问的<a class="ae ku" href="https://stackoverflow.com/questions/20478369/how-do-you-get-or-generate-a-url-to-the-object-in-a-bucket" rel="noopener ugc nofollow" target="_blank"> GCP桶。</a></p><pre class="kn ko kp kq gt mt mu mv mw aw mx bi"><span id="d5b0" class="kv kw iq mu b gy my mz l na nb">http://BUCKET_NAME.storage.googleapis.com/OBJECT_NAME</span><span id="6ac2" class="kv kw iq mu b gy nm mz l na nb">or </span><span id="d63e" class="kv kw iq mu b gy nm mz l na nb">http://storage.googleapis.com/BUCKET_NAME/OBJECT_NAME</span></pre><blockquote class="lw lx ly"><p id="fb72" class="jn jo kl jp b jq jr js jt ju jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj kk ij bi translated">最后，我们可以运行grep或任何其他工具来查找谷歌存储中的秘密和任何其他关键数据。</p></blockquote><p id="b6dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注:这是一个审计工具，用于检查GCP环境中公开暴露的GCP存储桶。</p><h2 id="a446" class="kv kw iq bd kx ky kz dn la lb lc dp ld jy le lf lg kc lh li lj kg lk ll lm ln bi translated">荣誉提名</h2><ul class=""><li id="3350" class="md me iq jp b jq mf ju mg jy mh kc mi kg mj kk nn ml mm mn bi translated"><a class="ae ku" href="https://docs.google.com/presentation/d/1R7mSTbra24z5uj9N6botjkaXuneSvVV6AK5siKnFrcw/htmlpresent" rel="noopener ugc nofollow" target="_blank">https://docs . Google . com/presentation/d/1r 7m stbr a24z 5 uj 9n 6 botjkasxuenesvvvv 6 AK 5 sik nfrcw/html present</a></li><li id="b8c1" class="md me iq jp b jq mo ju mp jy mq kc mr kg ms kk nn ml mm mn bi translated">https://github.com/clario-tech/s3-inspector<a class="ae ku" href="https://github.com/clario-tech/s3-inspector" rel="noopener ugc nofollow" target="_blank"/></li><li id="26f1" class="md me iq jp b jq mo ju mp jy mq kc mr kg ms kk nn ml mm mn bi translated">【https://github.com/NicholasSpringer/thunder-ctf T4】</li></ul><p id="9248" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">免责声明:<em class="kl">未经所有者事先同意，请勿在生产环境中执行扫描。所有提供的信息仅用于教育目的。</em></strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="https://www.buymeacoffee.com/justmorpheus"><div class="gh gi no"><img src="../Images/fe2c0c4f41838bb80bac13088c6bf046.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*qZ3zBcej_3YvyWiN.png"/></div></a></figure></div></div>    
</body>
</html>