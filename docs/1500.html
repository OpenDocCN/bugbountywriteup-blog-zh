<html>
<head>
<title>How I found Reflected XSS on a WebGIS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何在网络地理信息系统上找到XSS的</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-found-reflected-xss-on-a-webgis-26030bf8f0a9?source=collection_archive---------1-----------------------#2021-08-02">https://infosecwriteups.com/how-i-found-reflected-xss-on-a-webgis-26030bf8f0a9?source=collection_archive---------1-----------------------#2021-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dc4f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated"><strong class="ak">注意</strong>:该漏洞已上报并已修复。</h2></div><p id="450a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">大家好，</p><p id="f349" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我将分享我是如何在一个使用地理信息系统(WebGIS)的网站上发现一个XSS漏洞的。</p><p id="7831" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在浏览脸书的新闻时，我看到了一个粉丝页面上的新帖子，介绍了一个新的WebGIS，它刚刚在以下网站发布:</p><p id="8375" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b"><a class="ae lf" href="https://mevietnamanhhung.hcmgis.vn" rel="noopener ugc nofollow" target="_blank">https://mevietnamanhhung.hcmgis.vn</a></code></p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="ab gu cl ll"><img src="../Images/734fcbb9b7d64d53658079dcb62ceb7a.png" data-original-src="https://miro.medium.com/v2/0*TFcdhlhhGtbqgDKs"/></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">我在脸书上看到的关于WebGIS的帖子</figcaption></figure><p id="fff7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">带着一点好奇，我决定去看看这个网站。主页看起来是这样的:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/cf50600efbeee762733cd31c8344359a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gdH0C9N7dSaJVKpc"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">主页</figcaption></figure><p id="a81b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在那里没有收集到太多信息，所以我切换到了<strong class="kh ir">插图</strong>页面:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/3459a96b89c2fe4d6b166fec9fc85a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Aj5dasMUu4n5nvM8"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">艺术品页面</figcaption></figure><p id="b1d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，该网站展示了几幅属于越南英雄母亲(VHM)短篇故事的肖像。请注意，在这个页面的顶部，有一个搜索栏，允许按VHM的名字进行搜索。</p><p id="48ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我没有输入任何东西，只是点击了搜索按钮。现在，URL出现了许多参数值对，如下所示:</p><pre class="lg lh li lj gt lx le ly lz aw ma bi"><span id="c39c" class="mb mc iq le b gy md me l mf mg"><a class="ae lf" href="https://mevietnamanhhung.hcmgis.vn/cms/tac-pham?page=1&amp;name=&amp;province=&amp;district=&amp;from=01/01/2010&amp;to=30/11/2020&amp;storage=&amp;on=&amp;sort=lastest" rel="noopener ugc nofollow" target="_blank">https://mevietnamanhhung.hcmgis.vn/cms/tac-pham?page=1&amp;name=&amp;province=&amp;district=&amp;from=01/01/2010&amp;to=30/11/2020&amp;storage=&amp;on=&amp;sort=lastest</a></span></pre><p id="66dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看页面源代码后，我意识到有一段javascript代码需要注意，包括函数中的参数值对，它们直接放在URL中，然后通过GET方法向服务器发送请求:</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="9c35" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据我的经验，这可能反映了XSS的脆弱性。由于这段代码已经在一个<code class="fe lb lc ld le b">&lt;script&gt;</code>标签中，所以我只需要从string - &gt; object - &gt;函数中转义就可以插入恶意代码了。</p><p id="f77e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用这个有效载荷在搜索栏中输入:</p><pre class="lg lh li lj gt lx le ly lz aw ma bi"><span id="0b48" class="mb mc iq le b gy md me l mf mg">a'}}})});alert('Tri ân Mẹ Việt Nam Anh hùng');$(function(){var a = new Vue({b:{c:{d:'e</span></pre><p id="defa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果是:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/14cba3f4dbd694ce92290e97ea6f35ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wKNOPBle4C1P-Plt"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">反映了XSS！</figcaption></figure><p id="d543" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我立即向HCM地理信息系统(HCMGIS)的网站管理员报告了这个漏洞。3天后收到胡志明市科技部HCMGIS中心技术开发部负责人的感谢邮件，确认bug已经修复。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mj"><img src="../Images/53f7fc6132c02384f33a2c5b47bf5088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xtoytywgohdnkwh_Mifbhg.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">感谢信证实了漏洞已经被修复</figcaption></figure><p id="0660" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一周后，我回到网站，检查我之前报告的XSS漏洞是否已被修复。</p><p id="fe50" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，在更深入地查看URL以及上面的源代码之后，除了<code class="fe lb lc ld le b"><strong class="kh ir">name</strong></code>参数之外，XSS漏洞很可能也发生在<code class="fe lb lc ld le b"><strong class="kh ir">page</strong></code>参数处。</p><p id="ccad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于管理员已经通过过滤<code class="fe lb lc ld le b">'</code>字符修复了XSS漏洞，我将通过使用以下有效负载来设置<code class="fe lb lc ld le b"><strong class="kh ir">page</strong></code>参数的值，从而绕过该过滤器:</p><pre class="lg lh li lj gt lx le ly lz aw ma bi"><span id="c95d" class="mb mc iq le b gy md me l mf mg">5}}})});alert(String.fromCharCode(88,83,83));$(function(){var a = new Vue({b:{c:{d:5</span></pre><p id="3ab3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在网址变成了:</p><pre class="lg lh li lj gt lx le ly lz aw ma bi"><span id="e53d" class="mb mc iq le b gy md me l mf mg"><a class="ae lf" href="https://mevietnamanhhung.hcmgis.vn/cms/tac-pham?page=5%7D%7D%7D)%7D);alert(String.fromCharCode(88,83,83));%24(function()%7Bvar%20a%20=%20new%20Vue(%7Bb:%7Bc:%7Bd:5name=&amp;province=&amp;district=&amp;from=01/01/2010&amp;to=30/11/2020&amp;storage=&amp;on=&amp;sort=lastest" rel="noopener ugc nofollow" target="_blank">https://mevietnamanhhung.hcmgis.vn/cms/tac-pham?page=5}}})});alert(String.fromCharCode(88,83,83));$(function(){var%20a%20=%20new%20Vue({b:{c:{d:5name=&amp;province=&amp;district=&amp;from=01/01/2010&amp;to=30/11/2020&amp;storage=&amp;on=&amp;sort=lastest</a></span></pre><p id="5ce1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果是:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/15c5b12315eabe52792f3fa937cd0749.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BwugHP75pK_kp26R"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">反映了XSS！</figcaption></figure><p id="21e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">是时候向HCMGIS报告此事了。两周后，我收到了第二封感谢信，确认bug已经修复。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mk"><img src="../Images/4959e23eb80730fbe91253eb3fbb36b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bGwDZ9sOcvgRyUnxjIdQmg.png"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">感谢信证实了漏洞已经被修复</figcaption></figure><h1 id="f9f3" class="ml mc iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">共享时间</h1><p id="8940" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">在向HCMGIS报告了第二个XSS漏洞大约一个半月后，我开始写这篇文章。但是，当时网站已经无法访问，只显示了如下所示的错误:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ls"><img src="../Images/1c64b559900304a9dc52c4a76d37d2b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XDqDf0BqSmu2KeNm"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk translated">访问<a class="ae lf" href="https://mevietnamanhhung.hcmgis.vn" rel="noopener ugc nofollow" target="_blank">https://mevietnamanhung . HCM GIS . VN</a>网站时出现错误信息</figcaption></figure><p id="dddb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了让写上去更直观，我用了Wayback机器找到了这个网站的快照。幸运的是，在以下地址保存了一个快照:</p><pre class="lg lh li lj gt lx le ly lz aw ma bi"><span id="28f0" class="mb mc iq le b gy md me l mf mg"><a class="ae lf" href="https://web.archive.org/web/20201031194708/https://mevietnamanhhung.hcmgis.vn/cms/tac-pham" rel="noopener ugc nofollow" target="_blank">https://web.archive.org/web/20201031194708/https://mevietnamanhhung.hcmgis.vn/cms/tac-pham</a></span></pre><h1 id="100c" class="ml mc iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">2020年12月28日更新:</h1><p id="5cd9" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">越南英雄母亲网站现已开通，新地址:<code class="fe lb lc ld le b"><a class="ae lf" href="https://chandungme.vn" rel="noopener ugc nofollow" target="_blank">https://chandungme.vn</a></code></p><h1 id="609e" class="ml mc iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">时间表</h1><ul class=""><li id="fbb7" class="nh ni iq kh b ki nc kl nd ko nj ks nk kw nl la nm nn no np bi translated"><strong class="kh ir">2020年1月11日:</strong>首次向HCMGIS中心报告。</li><li id="5c47" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated"><strong class="kh ir">2020年3月11日:</strong>网络管理员确认该漏洞已被修复。</li><li id="e034" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated"><strong class="kh ir">2020年10月11日:</strong>第二次向HCMGIS中心报告。</li><li id="504b" class="nh ni iq kh b ki nq kl nr ko ns ks nt kw nu la nm nn no np bi translated"><strong class="kh ir">2020年11月23日:</strong>网络管理员确认漏洞已被修复。</li></ul><p id="522e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您花时间阅读这篇文章！喜欢就给我<strong class="kh ir">鼓掌</strong>！👏</p><p id="93d9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">干杯！</p></div></div>    
</body>
</html>