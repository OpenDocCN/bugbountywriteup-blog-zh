<html>
<head>
<title>Improper Authorization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不当授权</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/improper-authorization-d659445901f4?source=collection_archive---------3-----------------------#2022-04-13">https://infosecwriteups.com/improper-authorization-d659445901f4?source=collection_archive---------3-----------------------#2022-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="978e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个博客将展示一个有趣的案例，其中授权没有被正确地实现。成功利用此问题会导致权限提升(水平和垂直)以及web应用程序中的IDOR。</p><h2 id="8942" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">正常流量</h2><p id="bb7a" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated">这是应用程序正常流程的总结:</p><p id="4355" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，当用户A登录到应用程序时，他/她会收到一个JWT令牌，该令牌随后被用于授权他/她的身份以进行后续请求。因此，当用户A试图访问其他用户的资源(例如-&gt;用户B的配置文件细节)时，应用程序会以一条未经授权的错误消息进行响应。</p><h2 id="9f23" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated">应用程序中的漏洞</h2><p id="8337" class="pw-post-body-paragraph jn jo iq jp b jq le js jt ju lf jw jx jy lg ka kb kc lh ke kf kg li ki kj kk ij bi translated"><strong class="jp ir">请注意:仅出于演示目的，我使用了果汁店应用程序</strong><a class="ae lj" href="https://juice-shop.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"/></a></p><p id="7780" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">逐步流程- &gt;用户A点击他的购物篮查看里面的物品。</strong></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/071285ff4f556f27bce47a00bf34e337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z88Lf1yr7_8fm6NzMNnzDA.png"/></div></div></figure><p id="eba7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是使用Burpsuite获取购物篮细节的截取请求的屏幕截图。在这里，您可以观察到JWT令牌是在带有“Authorization”HTTP头的HTTP GET请求中发送的。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lw"><img src="../Images/e2e3a4e70fd3feb7ac85749ca31e9eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HA0FNPJNlxRroU1RIv3wWg.png"/></div></div></figure><p id="8de6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将截取的请求发送到Burpsuite中的“Repeater”选项卡，以观察正常的响应。在这里，当JWT令牌有效并且用户A被授权查看他/她的购物篮时，您可以在repeater选项卡中观察到一个成功的响应。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lx"><img src="../Images/81d40ba11f5b56077063655d64c4b9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aYxtW5iKShfeX_FgbQ7UMA.png"/></div></div></figure><p id="e685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当请求中的JWT令牌被其他用户B(在易受攻击的应用程序中未被授权查看用户A的购物篮)的令牌替换时，服务器会以未经授权的消息做出响应。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/c39c6b617a4e1274fe9e1ca7305b0e8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*bwG4e5P55rxOySFpU3GRbw.png"/></div></figure><p id="130e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，当请求被稍微修改时，如图所示(在授权HTTP头中，用base64编码的凭证格式“username:password”替换基本和JWT令牌之后的Bearer关键字)。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/961edaa265b988567cf49bcd6ee6bcfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*mmopuFpFufkTJeo5AqKIPg.png"/></div></figure><p id="7652" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我得到了一个与我们之前看到的类似的成功响应(这只是之前请求的截图，用于演示相同的情况)</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/a49da695f3f7cc1cb1e783c2249dece7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*ecfvJLDebN9kVJ0saqF-dw.png"/></div></figure><p id="6424" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。感谢阅读！</p><p id="339c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如需反馈/建议，请发送电子邮件至:<a class="ae lj" href="mailto:psdoom@protonmail.com" rel="noopener ugc nofollow" target="_blank">psdoom@protonmail.com</a></p></div></div>    
</body>
</html>