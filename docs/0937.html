<html>
<head>
<title>CTF Forensic challenge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CTF法医挑战赛</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/ii-national-cyberleague-ctf-forensic-challenge-a0febba1e9f?source=collection_archive---------1-----------------------#2020-11-08">https://infosecwriteups.com/ii-national-cyberleague-ctf-forensic-challenge-a0febba1e9f?source=collection_archive---------1-----------------------#2020-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fa88" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">来自西班牙国家CTF的法医挑战</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d49a40c16c959cb0809b6f5c60a6234d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E1BhHySLxKtThD067wyq2g.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">米卡·鲍梅斯特在<a class="ae ky" href="https://unsplash.com/s/photos/hacking?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="48d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上周，西班牙国民卫队组织了一次CTF活动，即第二届全国网络联赛。这个挑战是面向学生的，因此我不能参加。但是我有一个朋友参加了，他知道我喜欢法医挑战，所以他给我发了一个挑战，这是比赛的一部分。他们的团队未能解决这一挑战，所以让我们来看看是怎么回事以及如何解决它。</p><h1 id="9528" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">证据</h1><p id="b13c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有两个文件:</p><ul class=""><li id="31e6" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">容器</li><li id="50f1" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">snap.vmem</li></ul><p id="8d61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你玩过其他CTF挑战赛，这似乎有点明显，但让它分成几个部分。容器似乎是一个加密的容器，snap.vmem是一个RAM采集。</p><p id="0330" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">记忆中的秘密一直是个问题。在数字取证调查中，获取RAM可以为我们提供很多信息。我们可以发现进程运行，转储文件，秘密，连接和许多有用的信息。最流行的记忆分析工具是<a class="ae ky" href="https://www.volatilityfoundation.org/" rel="noopener ugc nofollow" target="_blank">波动</a>。volatile是一个开源项目，背后有一个伟大而活跃的社区，有像<a class="ae ky" href="http://www.rekall-forensic.com/" rel="noopener ugc nofollow" target="_blank">recall</a>这样的替代方案，但我个人更喜欢volatile。</p><p id="6ecf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在<a class="ae ky" href="https://github.com/volatilityfoundation/volatility3" rel="noopener ugc nofollow" target="_blank"> Volatility有一个3.0 </a>版本，有很多改进，但它还在测试阶段。正因为如此，我使用了最新的稳定版本Volatility 2.6。</p><h1 id="8a94" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">波动性分析</h1><p id="1ab2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们需要做的第一件事是识别操作系统，以便正确地分析实时内存请求。每个操作系统都以不同的方式处理内存。运行<em class="ng">图像信息</em>将为我们提供建议的操作系统配置文件。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="ce77" class="nm lw it ni b gy nn no l np nq">./volatility_2.6 -f evidencias/snap.vmem imageinfo </span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/ae84f6c3399aaa91fcd57713113de69d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQ15PCJekckzsMTMRlI02g.png"/></div></div></figure><p id="05a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建议的配置文件与Windows XP相关，我们可以使用其中一个WinXPSP2x86或WinXPSP3x86。</p><p id="c7bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">了解了操作系统，我们就可以开始提取有用的信息。我总是从pstree开始。这将让我们知道系统中正在运行什么进程。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="42a7" class="nm lw it ni b gy nn no l np nq">./volatility_2.6 -f evidencias/snap.vmem --profile WinXPSP2x86 pstree</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/1f17f573700498f39655ffb8d12695f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcW0o5sC9K-Vlw-I1lAj7w.png"/></div></div></figure><p id="39e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查找最有趣的进程是TrueCrypt。TrueCrypt是一个允许我们创建加密容器和分区的程序。现在它已经停产，被<a class="ae ky" href="https://www.veracrypt.fr/code/VeraCrypt/" rel="noopener ugc nofollow" target="_blank"> Veracrypt </a>取代。有人认为Truecrypt有隐藏的漏洞，但历史长，时间短，<a class="ae ky" href="https://www.schneier.com/blog/archives/2015/04/truecrypt_secur.html" rel="noopener ugc nofollow" target="_blank">什么也没发现</a>。</p><p id="6e7c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">无论哪种方式，Volatility都有一些集中于分析Truecrypt处理的命令:</p><ul class=""><li id="525f" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">truecryptsummary</li><li id="40b4" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">真正的密码大师</li><li id="4bd7" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated">truecryptpassphrase</li></ul><p id="e3cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">truecryptsummary可以给我们关于TrueCrypt进程的信息。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="2eba" class="nm lw it ni b gy nn no l np nq">./volatility_2.6 -f evidencias/snap.vmem --profile WinXPSP2x86 truecryptsummary</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/908f98bb09df07f1c0d0305e50b4de5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9B6JvpkhzfEMmPPs9Asvw.png"/></div></div></figure><p id="846a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以看到Truecrypt容器被打开并安装了2020年10月11日。这是至关重要的，因为如果容器没有安装，我们就无法检索打开它的密钥。</p><p id="f0a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">知道我们可以启动truecryptpassphrase来检索用于打开容器的密码。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="4494" class="nm lw it ni b gy nn no l np nq">./volatility_2.6 -f evidencias/snap.vmem --profile WinXPSP2x86 truecryptpassphrase</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/e8491e33f22bcfb34958fbb9351764dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAlsNwXpHynyi05HjkLyBQ.png"/></div></div></figure><p id="05eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们获得<strong class="lb iu">密码:13576479 </strong>。使用这个密码，我们应该能够打开容器，但我们可以使用truecryptmaster检索更多信息和主密钥。</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="24cb" class="nm lw it ni b gy nn no l np nq">./volatility_2.6 -f evidencias/snap.vmem --profile WinXPSP2x86 truecryptmaster </span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/b4a194528d896306d97605a8b982e936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K22Mi6ULXW76Cp9w6FBGIw.png"/></div></div></figure><p id="eb8d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这也将为我们提供有关加密算法、AES和所用算法模式XTS的信息。在这种情况下，这是不必要的，但在我们无法检索主密钥或密码的真实场景中，这些信息总是有用的。利用这些信息，我们可以对容器发起暴力攻击。</p><p id="2669" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，我们有一个密码、一个主密钥、加密算法和一个容器。至此，让我澄清一下，这不是一个Truecrypt漏洞。管理实时记忆中的秘密这是一个困难而富有挑战性的过程。现在一些系统使用硬件安全模块来实现这一点，但这并不是一个已解决的问题。</p><p id="afea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们打开容器，使用Veracrypt我们可以打开它。只要选择容器，指定密码，记得勾选Truecrypt模式，因为是TrueCrypt容器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/475f50cfa318585715f8f7401b43583f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B_QQQQbuW2JvT-r_W3rE-A.png"/></div></div></figure><p id="c237" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将在我们的系统上安装容器，使我们能够访问两个文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/e58fcd13a930d380e1aee3a459b302cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ls1lOccd8cZbQNGFrWgcZQ.png"/></div></div></figure><p id="8012" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我原以为会在这一点上找到旗子，但它离我不远了。如果我们打开Readme.txt，我们可以看到他们正在寻找与IP:48.37.29.153相关的密码。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/39256368cc31ddcafebd06c2dbff5f20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7KG5XyOVg8eVjcvENXYJhw.png"/></div></div></figure><p id="1a41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个文件是XML格式的用户和密码列表。只要找IP就会给我们密码，V8M0VH。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/ab160dc89108f3540ed783a156330890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sBFFzuvxT07fju1CKnJgIg.png"/></div></div></figure><p id="9039" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们所有的旗帜<strong class="lb iu"> V8M0VH </strong>。</p><h1 id="1b9b" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="0ab3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">至少对我来说，这是一个有趣又简单的挑战。CTF的挑战通常集中在Web和逆向上，但是取证呢？我总是喜欢玩取证和内存分析挑战。</p><p id="2a28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，这复制了一个真实的场景。这个挑战使得寻找容器的过程变得最容易，但是在真实的场景中，你可以通过加密的容器获得一些证据。例如，在西班牙，<a class="ae ky" href="https://www.xataka.com/seguridad/discos-duros-villarejo-parecen-inexpugnables-desempolvan-misterio-truecrypt-su-supuesta-inseguridad" rel="noopener ugc nofollow" target="_blank">我们有一个真实的案例，嫌疑人使用Truecrypt </a>并且不可能打开这些集装箱。我更喜欢在CTF挑战赛中复制和解决真实的场景，而不是非常奇怪的场景。</p><p id="8a6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这些，希望你喜欢这篇文章；)</p></div></div>    
</body>
</html>