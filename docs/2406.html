<html>
<head>
<title>Orange Arbitrary Command Execution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">橙色任意命令执行</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/orange-arbitrary-command-execution-75ba7f283d53?source=collection_archive---------0-----------------------#2022-09-29">https://infosecwriteups.com/orange-arbitrary-command-execution-75ba7f283d53?source=collection_archive---------0-----------------------#2022-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bfa7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，奥马尔·哈什姆在这里，我将在这篇文章中与大家分享我是如何在不同的公司使用相同的技术获得超过10个RCE的。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/eae2632212b4bb0579e448e7a285c132.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EOflShfPinMWjw6adQfTrQ.png"/></div></figure><p id="12e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你不知道Orange，简而言之，它是一家跨国电信公司，在全球拥有2.66亿客户</p><p id="99b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以开始了</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="2ee5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我开始做一些外部网络扫描</p><h1 id="0184" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Nmap扫描:</h1><blockquote class="ly lz ma"><p id="bcd5" class="jn jo mb jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated"><strong class="jp ir"><em class="iq">nmap-A-P0–65535 77 . pool 85–54–17 . dynamic . orange . es</em>T3】</strong></p></blockquote><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="0e8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是输出结果:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/169d6e7e9215267dca6fcae712ad4a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ypBAmjo1pF62Yh7OeFg2dA.png"/></div></div></figure><p id="3911" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现有一些有趣的端口被公开披露，大部分时间被用作内部API，比如docker的2375和MySQL服务的3306</p><p id="37a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我开始测试想要访问数据库的Mysql服务，所以我从一些常见的错误配置开始，比如在没有密码的情况下访问数据库(空根密码)</p><blockquote class="ly lz ma"><p id="79bd" class="jn jo mb jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated"><strong class="jp ir">┌──(omar㉿kali)-[~】<br/>└─$<em class="iq">MySQL-h 77 . pool 85–54–17 . dynamic . orange . es-u root-p 3306</em></strong></p></blockquote><p id="845c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但不幸的是没有奏效</p><h1 id="6629" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">蛮喷<strong class="ak"> : </strong></h1><p id="285b" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">这是一个使用普通用户名和密码来暴力破解网络服务的工具</p><p id="01f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一次尝试失败后，我开始使用brutespray，但在我通过从SecList添加(M <a class="ae mr" href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/mysql-betterdefaultpasslist.txt" rel="noopener ugc nofollow" target="_blank"> ysql更好的默认通过列表</a>)来编辑自定义单词列表后</p><blockquote class="ly lz ma"><p id="7bb9" class="jn jo mb jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated"><strong class="jp ir">┌──(omar㉿kali)-[~】<br/>└─$·布鲁特普雷—文件nmap-output.xml —服务mysql —线程5 </strong></p></blockquote><p id="6c49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但我也一无所获</p><p id="4b16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之后，我开始在谷歌上搜索常见的漏洞，并使用MySQL版本的searchspolit和MySQL的一些插件，如“mysql_native_password ”,以获得任何形式的认证旁路</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ms"><img src="../Images/fd42c7cc633a97b144b36a3e9a627b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xc1W-ijBakkiDkPiHU96qg.png"/></div></div></figure><p id="383f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">搜索可能包含插件或MySQL版本的漏洞</p><blockquote class="ly lz ma"><p id="48a3" class="jn jo mb jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated"><strong class="jp ir">┌──(omar㉿kali)-[~】<br/>└─$ searchsploit ' MySQL ' | egrep ' native | pass | auth | 5.5 '</strong></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mt"><img src="../Images/33acdcfc6535005cae20bd4d339d12a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4CvySytG41o3SiBiuGkEA.png"/></div></div></figure><p id="26e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">插件“mysql_native_password”没有公开漏洞，但是mysql服务有两个有趣的漏洞[第二个漏洞(绕过授权)和第三个漏洞(RCE) ]</p><p id="9aa8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我两个都试过了，但也一无所获</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mu mg l"/></div></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mu mg l"/></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="57dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之后，我开始查看docker引擎</p><p id="a781" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但在此之前，让我们了解</p><h1 id="71d3" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是docker:</h1><p id="f321" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Docker是一个开源软件平台，用于在通用操作系统(OS)上创建、部署和管理虚拟化应用程序容器</p><p id="a49f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单来说，它通常在开发人员和开发人员之间使用，以解决开发人员面临的问题，如他们的应用程序代码是否可以在一台机器上工作，而不能在其他机器上工作[根据缺失的包和库]，Docker旨在解决这个问题</p><p id="62d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看nmap的输出</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mv"><img src="../Images/1bae5f5f53f4b61ef1d77f8f34c6b20f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QLdWVcsQfLtRTe5C7g0s2g.png"/></div></div></figure><h1 id="0115" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">公开的Docker API:</h1><p id="8fad" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">当您在一个系统上安装docker时，它会在您的本地主机上公开一个位于端口2375的API。这个API可以用来与docker引擎交互，它基本上给了你做任何你想做的事情的权利。在这种情况下，任何外部团体都无法访问你的docker API，因为它并不对外公开。但是，在某些情况下，可以更改此API，以便外部资源可以访问它。如果操作不当，这将把docker API暴露给世界[公共互联网]</p><p id="2654" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们现在需要测试这种在没有任何认证的情况下公开docker API的错误配置</p><p id="d064" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们获取运行容器列表</p><blockquote class="ly lz ma"><p id="16a4" class="jn jo mb jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated">ps:允许我们列出正在运行的容器</p></blockquote><p id="a771" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">docker -H <host> : <port> ps</port></host></p><blockquote class="ly lz ma"><p id="62b8" class="jn jo mb jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated">└─$码头工人-h 77 . pool 85–54–17 . dynamic . orange . es:2375 PS</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mw"><img src="../Images/27202a9d70f70c889e0bf2c5e30b3b7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rmbve6HBPem4_0-03UoZzA.png"/></div></div></figure><p id="bf65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它的工作，并发现有7个容器在那里运行</p><p id="2ba9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们要试着得到一个壳</p><blockquote class="ly lz ma"><p id="7f93" class="jn jo mb jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated">exec:允许我们在运行容器中运行命令</p></blockquote><p id="882c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">docker-H<host>:<port>exec-it<container name=""><command/></container></port></host></p><blockquote class="ly lz ma"><p id="c29f" class="jn jo mb jp b jq jr js jt ju jv jw jx mc jz ka kb md kd ke kf me kh ki kj kk ij bi translated">┌──(omar㉿kali)-[~]<br/>└─$<strong class="jp ir">docker-h<em class="iq">77 . pool 85–54–17 . dynamic . orange . es</em>:2375 exec-it ' limpid _ age last '/bin/bash</strong></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mx"><img src="../Images/ecf4b7278bf5365e287cf32caffaf5b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QTLG8fGfS-k9Vwnyvk2TSg.png"/></div></div></figure><p id="989e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们获得了具有root权限的容器外壳，这还不是结束，因为我能够用源代码和公司的其他私有数据组成其他容器</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mu mg l"/></div></figure><p id="73be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你们喜欢这篇报道</p><p id="7433" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">别忘了在Twitter上关注</p><p id="3285" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特:<a class="ae mr" href="https://twitter.com/OmarHashem666" rel="noopener ugc nofollow" target="_blank"> @OmarHashem666 </a></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="my mg l"/></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><h2 id="258b" class="mz lb iq bd lc na nb dn lg nc nd dp lk jy ne nf lo kc ng nh ls kg ni nj lw nk bi translated"><strong class="ak">保持联系</strong></h2><p id="348a" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated"><a class="ae mr" href="https://www.linkedin.com/in/omar-1-hashem/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Linkedin</strong></a><strong class="jp ir">|</strong><a class="ae mr" href="https://www.youtube.com/channel/UCJ1yNtgZP5LRO7ebZXSnAZQ" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Youtube</strong></a><strong class="jp ir">|</strong><a class="ae mr" href="https://twitter.com/OmarHashem666" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">Twitter</strong></a></p><h2 id="92a2" class="mz lb iq bd lc na nb dn lg nc nd dp lk jy ne nf lo kc ng nh ls kg ni nj lw nk bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae mr" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>