<html>
<head>
<title>How LUKS works with Full Disk Encryption in Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LUKS如何在Linux中使用全磁盘加密</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-luks-works-with-full-disk-encryption-in-linux-6452ad1a42e8?source=collection_archive---------1-----------------------#2021-09-16">https://infosecwriteups.com/how-luks-works-with-full-disk-encryption-in-linux-6452ad1a42e8?source=collection_archive---------1-----------------------#2021-09-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/adbeba59ad0d61e425ef2ee8faef9cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*ighFjLp4k6pi56XEqhA9CA.png"/></div></figure><h1 id="81f6" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">全磁盘加密</h1><p id="3655" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="ku ir">全磁盘加密</strong>是磁盘级别的加密(顾名思义)，它对用户是透明的，因为它在文件系统层之下运行。基本上，它是一个<strong class="ku ir">块设备加密</strong>，这意味着当从磁盘读取(或写入)块时，内核级的加密模块为我们工作，就像一个翻译器。</p><blockquote class="lq lr ls"><p id="0d2f" class="ks kt lt ku b kv lu kx ky kz lv lb lc lw lx lf lg ly lz lj lk ma mb ln lo lp ij bi translated">这种加密不区分敏感信息和非敏感信息，它只是加密所有信息。</p></blockquote><p id="bcf8" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">虽然<strong class="ku ir">基于文件的加密</strong>必须由开发者(使用库)为每场比赛实现，如果没有正确实现，就无法在其他计算机上工作，但全磁盘加密加密所有内容，并且它是文件系统不可知的(因为你在设备上加密块)，如果你想有一个<strong class="ku ir">加密的LVM设置</strong>或分区表，这很有帮助。</p><p id="6ac8" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">全磁盘加密的一个缺点是当系统启动时磁盘是解锁的，而基于文件的加密每次需要使用时都必须解密。<br/>本质上，全磁盘加密仅在系统关闭时保护您，因此万一有人偷走您的笔记本电脑或pc，您的文件是安全的(嗯，这取决于一些其他因素)。</p><h2 id="9716" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">dm-crypt概述</h2><p id="9755" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Linux中默认的标准设备映射器加密是由Linux内核中的<strong class="ku ir"> dm-crypt </strong>提供的，所以如果你想完全控制分区和密钥管理，这是你应该使用的。<br/>DM-crypt的管理通过<em class="lt"> cryptsetup </em>完成:<strong class="ku ir"> LUKS </strong>是<em class="lt"> dm-crypt </em>的附加前端，目的是简化所有的加密过程。<br/>下图描述了上面提到的层(文件系统、目录、块设备等)。):</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/892422823d5bcc72becd1ccd1048baca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*dF1UojoSEku9HLZo.png"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">加密层是如何组织的</figcaption></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="d88e" class="ju jv iq bd jw jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr bi translated">LUKS是如何运作的</h1><p id="f93f" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="ku ir"> LUKS </strong> ( <em class="lt"> Linux统一密钥设置</em>)，特别是LUKS2，在磁盘上的专用区域提供通用密钥存储，能够使用多个密码来解锁存储的密钥。LUKS2有一种更灵活的存储元数据的方式(在元数据区损坏的情况下提供恢复的冗余信息)。</p><p id="465e" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">LUKS报头为加密设置提供元数据。以下是一些功能:</p><ul class=""><li id="83e7" class="nj nk iq ku b kv lu kz lv ld nl lh nm ll nn lp no np nq nr bi translated">检测报头中的损坏和操纵的校验和机制</li><li id="76f4" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated">元数据区域存储为两个副本，以备可能的恢复</li><li id="1010" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated">元数据以JSON格式存储。它允许在不修改二进制结构的情况下进行扩展</li><li id="af40" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated">头包含名为<em class="lt">令牌</em>的对象，它包含从哪里获得解锁密码短语的信息</li></ul><h1 id="e541" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">页眉</h1><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi nx"><img src="../Images/e843f16b6aefbd1ff4371623ce6ad42e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*84JXyKYNBwdh2k6Q3CYn-w.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">LUKS头球解说</figcaption></figure><p id="d3d0" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">LUKS报头基本上分为三个部分:</p><ul class=""><li id="82f0" class="nj nk iq ku b kv lu kz lv ld nl lh nm ll nn lp no np nq nr bi translated">二进制报头(4096字节，仅使用512字节)</li><li id="1989" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated">JSON中的元数据</li><li id="4ef3" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated">键槽区</li></ul><p id="9ae5" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">如上图所示，二进制和JSON区域存储了两次，在正常情况下，它们包含相同的值。</p><p id="900f" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">二进制头的大小确保它总是只被写入一个扇区(<em class="lt">原子写入</em>)以防止错误和/或损坏。</p><h2 id="8a19" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated"><strong class="ak">二进制报头</strong></h2><p id="35b6" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">二进制报头包含通知系统将要接近LUKS设备所需的所有信息。此处保存的信息是基本信息，如标签、表明这是LUKS设备的签名、报头大小和元数据校验和(<em class="lt">非常重要！</em>)。</p><p id="46aa" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">主报头必须存储在设备的扇区0中，第二个报头从第一个JSON区域之后的固定偏移位置开始，如下所示:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="5d7c" class="mc jv iq od b gy oh oi l oj ok">Offset  | JSON<br/>[bytes] | [kB]<br/>---------------<br/>16384   |   12<br/>32768   |   28<br/>65536   |   60<br/>131072  |  124<br/>262144  |  252<br/>524288  |  508<br/>1048576 | 1020<br/>2097152 | 2044<br/>4194304 | 4092</span></pre><h2 id="78e0" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated"><strong class="ak"> JSON区</strong></h2><p id="2239" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">JSON区域在二进制头之后开始，结尾必须与4096字节的扇区偏移量对齐，因此JSON区域大小为</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="64e1" class="mc jv iq od b gy oh oi l oj ok">JSON_Area_size = header_size - 4096</span></pre><p id="fbe4" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">所以第二个二进制头开始的偏移量(在上表中报告)现在有意义了:JSON size + bin_header_size (4096字节)必须与偏移量匹配。未使用的空间用零填充。</p><h2 id="a9b8" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">键槽区</h2><p id="1ed4" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">密钥槽区域是磁盘上可以为密钥槽中的二进制数据分配的空间，事实上，这里存储了从密钥槽元数据引用的加密密钥。</p><p id="d03d" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">分配的区域由包含偏移(从设备开始)和大小字段的区域对象在密钥槽中定义，这两个字段都必须有效，否则将被拒绝。</p><h2 id="74f0" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">对齐填充</h2><p id="f942" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="ku ir">对齐填充符</strong>的目的是将加密数据在块的开始处(块被逐个加密，通常一个块是512字节)与正确的偏移对齐，以使LUKS正确地与加密扇区一起工作。</p><h1 id="0f71" class="ju jv iq bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">[计]元数据</h1><p id="725c" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="ku ir"> LUKS元数据</strong>允许定义具有特定功能的对象。未被识别的对象被忽略，但仍保留在JSON元数据中。</p><p id="e8b0" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">在更新磁盘头之前，实现必须验证JSON结构。</p><p id="9133" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">LUKS有一些强制性目标如下:</p><ul class=""><li id="adb3" class="nj nk iq ku b kv lu kz lv ld nl lh nm ll nn lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">配置</em> </strong> —包含持久报头配置属性</li><li id="ae00" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"><em class="lt">key slot</em></strong>——描述加密密钥存储区域的对象</li><li id="90ad" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">摘要</em> </strong> —用于验证解密后的密钥是否正确</li><li id="044f" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">段</em> </strong> —描述磁盘上包含用户加密数据的区域</li><li id="4a7a" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">令牌</em> </strong> —可以选择性地包括附加元数据、到其他系统的绑定</li></ul><p id="944a" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">JSON中的二进制数据以Base64编码存储，64位整数以十进制表示法存储为字符串。</p><p id="c784" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">以下是对LUKS元数据中的必备对象的深入分析:</p><h2 id="7ec1" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">配置对象</h2><p id="6bd7" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">配置对象包含这些字段，这些字段对于LUKS设备是全局的:</p><ul class=""><li id="a777" class="nj nk iq ku b kv lu kz lv ld nl lh nm ll nn lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt"> json_size </em> </strong> — JSON区大小(以字节为单位)，该字段必须等于二进制头</li><li id="2c7e" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt"> keyslots_size </em> </strong> —二进制keyslot区大小(以字节为单位)，必须对齐到4096字节</li><li id="023f" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">标志</em> </strong> —带有设备持久标志的字符串对象数组</li><li id="630c" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">需求</em></strong>—LUKS设备所需附加功能的字符串对象数组</li></ul><h2 id="7987" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">键槽对象</h2><p id="8533" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">密钥槽对象包含关于存储的密钥、存储二进制密钥槽的区域、加密类型、使用的反取证功能、基于密码的密钥派生功能和相关参数的信息。</p><p id="c007" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">每个keyslot对象包含:</p><ul class=""><li id="2416" class="nj nk iq ku b kv lu kz lv ld nl lh nm ll nn lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">类型</em> </strong> —键槽类型</li><li id="3795" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt"> key_size </em> </strong> —存储在keyslot中的密钥大小(字节)</li><li id="7d17" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">区</em> </strong> —二进制键槽区中的分配区</li><li id="d94c" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt"> kdf </em> </strong> — PBKDF</li><li id="6b5d" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt"> af </em> </strong> —反法医。现代系统中未使用(LUKS2)</li><li id="ad58" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">优先级</em> </strong> —是键槽优先级:0 =忽略，1 =正常，2 =高。</li></ul><h2 id="e5f7" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">摘要对象</h2><p id="ac0c" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为了验证解密密钥(来自密钥槽)是否正确，LUKS使用digests对象。这些对象被分配给键槽和段，如果没有分配给段，则摘要用于未绑定的键。</p><p id="f045" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">摘要对象包含这些字段:</p><ul class=""><li id="9784" class="nj nk iq ku b kv lu kz lv ld nl lh nm ll nn lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">型</em> </strong> —消化型</li><li id="7dc2" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">键槽</em> </strong> —分配给摘要的键槽对象名数组</li><li id="8bd9" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">段</em> </strong> —分配给摘要的段对象名称的数组</li><li id="ffec" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">盐</em> </strong> —用于消化的二元盐</li><li id="5d79" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">摘要</em> </strong> —二进制摘要数据</li></ul><h2 id="7bcd" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">分段对象</h2><p id="e967" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Segment对象包含磁盘上加密区域的定义。对于正常的LUKS设备，只存在一个数据段。</p><p id="c3ec" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">这些是字段:</p><ul class=""><li id="65c0" class="nj nk iq ku b kv lu kz lv ld nl lh nm ll nn lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">型</em> </strong> —分段型(目前仅使用<em class="lt">地穴</em>)</li><li id="1cec" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">偏置</em> </strong> —从设备开始到段开始的偏置</li><li id="8eb8" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">大小</em> </strong> —段大小(以字节为单位)或<em class="lt">动态</em>(用于设备的动态调整大小)</li><li id="06ac" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"><em class="lt">iv _ tweak</em></strong>-初始化向量的起始偏移</li><li id="4eb5" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">加密</em></strong>—<em class="lt">DM-crypt</em>符号中的分段加密算法</li><li id="60be" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"><em class="lt"/></strong>—段的扇区大小(512、1024、2048或4096字节)</li><li id="82f3" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">完整性</em> </strong> — LUKS2用户数据完整性保护</li><li id="c951" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">标志</em> </strong> —包含段附加信息的字符串对象数组</li></ul><h2 id="e9e4" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">令牌对象</h2><p id="1650" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">令牌对象是一个对象，它描述了如何获得一个密码来解锁一个特定密钥槽，且可以包含附加的JSON元数据。<br/>这些是必填字段:</p><ul class=""><li id="b421" class="nj nk iq ku b kv lu kz lv ld nl lh nm ll nn lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">类型</em> </strong> —定义令牌类型</li><li id="943b" class="nj nk iq ku b kv ns kz nt ld nu lh nv ll nw lp no np nq nr bi translated"><strong class="ku ir"> <em class="lt">键槽</em> </strong> —分配给令牌的键槽对象名称数组</li></ul></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="b9f0" class="ju jv iq bd jw jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr bi translated">LUKS备份和还原</h1><h2 id="f897" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">LUKS头球备份</h2><p id="13b6" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">LUKS标题备份是有用的，以防你损坏或删除你的标题。如果您出于任何原因直接在磁盘上工作(而不是在设备映射器上),这可以在发生不好的事情时节省您的时间。</p><p id="e3cf" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">这将创建一个带有LUKS标题的文件:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="af6b" class="mc jv iq od b gy oh oi l oj ok">sudo cryptsetup luksHeaderBackup /dev/MY_DRIVE --header-backup-file /path/to/backup-file</span></pre><p id="6a40" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">您也可以使用<em class="lt"> dd </em>命令备份您的LUKS标题:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="7dee" class="mc jv iq od b gy oh oi l oj ok">sudo dd if=/dev/MY_DRIVE of=/path/to/backup-file bs=X count=Y</span></pre><p id="8158" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">用<em class="lt"> dd </em>你应该知道你的头的大小，以确保你复制所有的数据。使用<em class="lt"> luksDump </em>获取尺寸和偏置信息。</p><h2 id="774f" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">LUKS标题恢复</h2><p id="3141" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这是你可能面临的最糟糕的情况之一:你丢失/损坏了你的LUKS页眉。如果您有备份副本，您可以从实时操作系统启动来恢复它们，此过程将恢复您的头文件。</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="5021" class="mc jv iq od b gy oh oi l oj ok">sudo cryptsetup luksHeaderRestore /dev/<!-- -->MY_DRIVE<!-- --> --header-backup-file <!-- -->/path/to/backup-file</span></pre><p id="42f6" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">LUKS会要求确认命令:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="7263" class="mc jv iq od b gy oh oi l oj ok">WARNING!<br/>========<br/>Device /dev/MY_DRIVE already contains LUKS2 header. Replacing header will destroy existing keyslots.<br/><br/>Are you sure? (Type uppercase yes): </span></pre></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="9d9d" class="ju jv iq bd jw jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr bi translated">如何擦除LUKS加密硬盘</h1><p id="3f4e" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果你有一个<strong class="ku ir"> LUKS加密硬盘</strong>，你有两种方法可以擦除它:删除位于加密盘开头的LUKS头，或者你可以像擦除标准盘一样擦除整个盘。</p><h2 id="517e" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">删除LUKS标题</h2><p id="f313" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如上所述，标题包含了解锁磁盘的所有信息，没有这些信息(特别是密钥)几乎不可能恢复数据。<br/>所以可能足以擦除表头:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="2e68" class="mc jv iq od b gy oh oi l oj ok">sudo shred --size=LUKS_HEADER_SIZE /dev/MY_DRIVE</span></pre><blockquote class="lq lr ls"><p id="fd53" class="ks kt lt ku b kv lu kx ky kz lv lb lc lw lx lf lg ly lz lj lk ma mb ln lo lp ij bi translated">如果您有多个分区，请确保您只粉碎LUKS分区，而不是整个磁盘或分区表！</p></blockquote><p id="7cb2" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">您也可以使用<em class="lt">密码设置</em>来擦除您的密钥，如下所示:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="0e13" class="mc jv iq od b gy oh oi l oj ok">sudo cryptsetup erase <em class="lt">/dev/MY_DRIVE</em></span></pre><p id="c28f" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">此外，您可以用<em class="lt"> wipefs </em>移除所有LUKS割台:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="750b" class="mc jv iq od b gy oh oi l oj ok">sudo wipefs -a <em class="lt">/dev/MY_DRIVE</em></span></pre><h2 id="7056" class="mc jv iq bd jw md me dn ka mf mg dp ke ld mh mi ki lh mj mk km ll ml mm kq mn bi translated">擦除磁盘</h2><p id="f550" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">擦除磁盘将是最简单的解决方案，但不是最快的。为了继续擦除您的磁盘，您需要从实时操作系统启动。</p><p id="d884" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">用<em class="lt">粉碎</em>我们可以擦除我们的磁盘并阻止任何取证数据恢复:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="b54d" class="mc jv iq od b gy oh oi l oj ok">sudo shred /dev/MY_DRIVE</span></pre><p id="0dd5" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">同样<em class="lt"> dd </em>可用于此目的，输入源应为urandom/random或零:</p><pre class="mp mq mr ms gt oc od oe of aw og bi"><span id="d70b" class="mc jv iq od b gy oh oi l oj ok">sudo dd if=/dev/urandom of=/dev/MY_DRIVE</span><span id="e5df" class="mc jv iq od b gy ol oi l oj ok">OR</span><span id="84c4" class="mc jv iq od b gy ol oi l oj ok">sudo dd if=/dev/zero of=/dev/MY_DRIVE</span></pre></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="9075" class="ju jv iq bd jw jx ne jz ka kb nf kd ke kf ng kh ki kj nh kl km kn ni kp kq kr bi translated">结论</h1><p id="193b" class="pw-post-body-paragraph ks kt iq ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在本文中，我们探讨了LUKS，一个有效的全磁盘加密前端。确保您的LUKS配置是安全的(强密码)是很重要的；如果您不需要第一版LUKS的明确功能，请使用LUKS2。</p><p id="d5b7" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">我们还看到，擦除LUKS分区可能比普通磁盘更容易、更快，这是一个有趣的点，因为目前(2021年)没有办法恢复加密数据。</p><p id="652b" class="pw-post-body-paragraph ks kt iq ku b kv lu kx ky kz lv lb lc ld lx lf lg lh lz lj lk ll mb ln lo lp ij bi translated">如果你想了解如何保护你的<strong class="ku ir"> Linux系统</strong>，而不仅仅是启用<strong class="ku ir">全磁盘加密</strong>，请看这篇文章:</p><div class="om on gp gr oo op"><a href="https://mattiazignale.medium.com/introduction-to-linux-security-hardening-635af8e6e885" rel="noopener follow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd ir gy z fp ou fr fs ov fu fw ip bi translated">Linux安全性和强化简介</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">如何开始强化您Linux系统？Linux安全性介绍</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">mattiazignale.medium.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd js op"/></div></div></a></div></div></div>    
</body>
</html>