<html>
<head>
<title>Unvalidated Redirects and Forwards</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">未经验证的重定向和转发</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/unvalidated-redirects-and-forwards-4cad5eb66b64?source=collection_archive---------3-----------------------#2022-11-29">https://infosecwriteups.com/unvalidated-redirects-and-forwards-4cad5eb66b64?source=collection_archive---------3-----------------------#2022-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/6e9d005fd0c6b2871cceb02f90ba926b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*IUwdvvr7TngPdmQQ.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">杰佛森·桑多斯在<a class="ae kb" href="https://unsplash.com/@jefflssantos?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="20bd" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">简介</strong></p><p id="ab02" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">未经验证的重定向和转发可能不再像2013年和2017年那样在OWASP十大最常见漏洞中占据一席之地，但它会损害您的声誉。为了知道它是什么以及它如何影响你的声誉，让我们来理解重定向和转发。您可能想了解302响应状态代码，它指的是临时重定向。</p><p id="1ff9" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">什么是重定向和转发？</strong></p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi la"><img src="../Images/0f4f87222ffed8caa6ef7575b49ead9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hpm4viqLVKCMcpkz.png"/></div></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://i.stack.imgur.com/a3pCn.png" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="5829" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">为了这个论点，让我们考虑鲍勃，网站bob.com的管理员。他想暂时修复他的站点，但同时又不想让用户因为停机而遭受损失。他突然想到一个主意。他想把他的流量重定向到他的朋友爱丽丝的网站，名为<strong class="ke iu">alice.com。</strong></p><p id="a322" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">因此，他所做的是，打开他的管理面板，并设置一个302重定向到<strong class="ke iu">alice.com</strong>的任何传入请求到bob.com。</p><p id="eb07" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">这将做的是，如果我，作为一个用户，在我的网络浏览器中输入<strong class="ke iu">bob.com</strong>，它将把我带到bob.com，但鲍勃的服务器，而不是返回我的网页，将返回我一个302状态代码，和一个位置头<strong class="ke iu">alice.com</strong>。这将指示我的浏览器访问alice.com。简而言之，这被称为重定向。</p><p id="bddd" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">另一方面，forward可以指两种情况。第一个是bob在主页上制作了一个到<strong class="ke iu">/登录</strong>页面的链接。当用户点击它时，他会被带到<strong class="ke iu">bob.com/login</strong>。在这种情况下，用户将被转到或带到同一网站的某个页面。在第二个场景中，鲍勃制作了一个指向<a class="ae kb" href="http://www.google.com/" rel="noopener ugc nofollow" target="_blank">www.google.com</a>的外部链接。当用户点击它时，他会被带到google.com。</p><p id="0eaf" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">在第二个场景中，Bob也可以根据自己的喜好使用302重定向。</p><p id="6099" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">差别很小，许多人甚至不认为重定向和转发有什么不同，而是经常互换使用。</p><p id="c7a7" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">什么是未验证的重定向和转发？</p><p id="f777" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">未验证的重定向和转发，也称为URL重定向，是一种web应用程序漏洞，当应用程序没有验证或验证它是否应该将用户重定向到提供的域时，这就像输入验证漏洞，其中网站信任网站提供的输入，并直接将用户重定向到提供的网站。与其他漏洞不同，这不会以任何方式影响您的网站。但是，它可以被黑客用来危害他的帐户，将恶意软件下载到他的计算机上，并用于网络钓鱼目的。</p><p id="f033" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">让我们考虑一下鲍勃的网站<strong class="ke iu">bob.com</strong>。它有一个重定向参数，将用户重定向/转发到用户成功登录后提供的URL。</p><p id="9e4a" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">https://www.bob.com/login?redirect=bob.com/dashboard<a class="ae kb" href="https://www.bob.com/login?redirect=bob.com/dashboard" rel="noopener ugc nofollow" target="_blank"/></p><p id="9d0a" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">正如您所知，在用户成功登录后，他将被带到bob.com/dashboard.</p><p id="a441" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">从开发人员的角度来看，这是安全的，并且应该如预期的那样工作。但是克里斯是一名安全研究员。他知道重定向参数是易受攻击的。所以，他所做的就是试图把bob.com/dashboard改成chiristhehaceker.com的T4。结果是<a class="ae kb" href="https://www.bob.com/login?redirect=christhehacker.com" rel="noopener ugc nofollow" target="_blank"><strong class="ke iu"/></a></p><p id="bfb1" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">他登录后，发现自己被重定向到了<strong class="ke iu">christthehacker.com。</strong></p><p id="9c1c" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">他们是如何被剥削的？</strong></p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/9749750782ed7abad883322ad2dd4589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*WIj5idLDUInx6e2m.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://1tskcg39n5iu1jl9xp2ze2ma-wpengine.netdna-ssl.com/wp-content/uploads/2019/03/open-redirection-vulnerability.png" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="0df0" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">从攻击者的角度来看，他中了大奖。他可以用URL重定向实现不可想象的事情。</p><p id="a26b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">他不再需要引诱你点击christhehacker.com。他可以利用你对bob.com的信任，通过简单的社会工程技术，你将被重定向到他的恶意网站。由于受信任的网站会将您重定向到christhehacker.com，因此您很容易相信第二个网站是受信任的，并且您可能会提供敏感信息，如信用卡、登录凭据等。</p><p id="1a9a" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">他可以把网站做得和Bob的差不多，卖给你假新闻，下载恶意软件，甚至泄露敏感信息。</p><p id="c629" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">不久前看起来无害的URL重定向可能会被黑客利用来实现难以想象的事情。</p><p id="8bff" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">URL重定向也可用于绕过CSP。什么是CSP？CSP代表内容安全策略，可以认为是一种帮助浏览器决定从哪个源获取资源并执行它们的策略。这是防止XSS袭击的好方法。如果CSP中列出的某个域存在URL重定向问题，攻击者就可以利用它来绕过CSP。</p><p id="dacf" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">OAuth中的开放重定向同样可以被利用，但在这里它会导致帐户被接管。你可以在这里查看我们在OAuth上的博客(提供链接)。</p><p id="ec4c" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated"><strong class="ke iu">补救</strong></p><p id="63d5" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">既然我们已经讨论了一些利用方法、URL重定向及其影响，那么让我们来看看可以采取哪些步骤或措施来防止它们。</p><ol class=""><li id="2355" class="lk ll it ke b kf kg kj kk kn lm kr ln kv lo kz lp lq lr ls bi translated">如果可能，尽量避免转发和重定向。它可能看起来像功能，但对黑客来说却充满了机会。</li><li id="3015" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">如果出于某种原因，你可以放开它，白名单的网址，网站可以重定向。</li><li id="ff13" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">您可以存储映射到每个URL并存储在数据库中的令牌ID。如果令牌ID与URL不匹配，您可以停止URL重定向。</li><li id="7913" class="lk ll it ke b kf lt kj lu kn lv kr lw kv lx kz lp lq lr ls bi translated">如果URL列表非常大，然后将它们存储在数据库中，然后一次检查一个会增加延迟，那么你可以做的就是根本不存储它们。相反，您可以做的是，每当用户被重定向到与您的域名不匹配的域时，向他显示一条消息。</li></ol></div><div class="ab cl ly lz hx ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="im in io ip iq"><h2 id="e7f8" class="mf mg it bd mh mi mj dn mk ml mm dp mn kn mo mp mq kr mr ms mt kv mu mv mw mx bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae kb" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>