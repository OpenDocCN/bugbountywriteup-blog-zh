<html>
<head>
<title>HTTP Headers : Web App Security Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTP头:Web应用程序安全基础</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/http-headers-web-app-security-basics-d3d08ffc38ea?source=collection_archive---------1-----------------------#2020-10-26">https://infosecwriteups.com/http-headers-web-app-security-basics-d3d08ffc38ea?source=collection_archive---------1-----------------------#2020-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/00da4068464f23333f6ef829df9051c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KF3cQxLrRLAcngVhkbP3Kg.png"/></div></div></figure><p id="6cd8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> HTTP headers </strong>让客户机和服务器通过HTTP请求或响应传递附加信息。HTTP头由不区分大小写的名称、冒号和值组成。</p><p id="4365" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="73f2" class="lf lg iq lb b gy lh li l lj lk">Strict-Transport-Security: max-age=<!-- -->31536000</span></pre><p id="6d3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一些与隐私和安全间接相关的HTTP头也可以被认为是HTTP安全头。通过在web应用程序和web服务器设置中启用合适的头，可以改进web应用程序针对常见漏洞的防御机制。以下是一些常见的安全标头:</p><ul class=""><li id="bf73" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">内容-安全-策略</strong> </a>(响应头):这允许网站管理员控制允许用户代理为给定页面加载的资源。CSP提供了一个额外的安全层来抵御多种漏洞，如XSS、点击劫持、协议降级和帧注入。它也可以作为安全头的替代品，如<em class="lv"> X-Frame-Options </em>和<em class="lv"> X-XSS-Protection。</em></li></ul><p id="4c8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在CSP中，白名单用于定义规则。我们可以过滤掉任何不符合我们规则的资源。</p><p id="acc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a60f" class="lf lg iq lb b gy lh li l lj lk">Content-Security-Policy: &lt;policy-directive&gt;; &lt;policy-directive&gt;<br/>&lt;policy-directive&gt;<!-- --> consists of: <!-- -->&lt;directive&gt; &lt;value&gt;<!-- --> with no internal punctuation.<strong class="lb ir"><br/>Content-Security-Policy: script-src 'self' https://example.com</strong></span><span id="0233" class="lf lg iq lb b gy lw li l lj lk">#Few Policy-directives and their details:<br/>- <strong class="lb ir">frame-ancestors: </strong>specifies the sites that have the authority to load the current page in a  frame, iframe, object, embed, and applet tag. It is a substitute for  X-Frame-Options, since it can also help prevent Clickjacking and UI  Redressing attacks.<br/>- <strong class="lb ir">object-src: </strong>defines or restricts the sources from &lt;object&gt;,  &lt;embed&gt;, and &lt;applet&gt;, which helps preventing Cross-Site  Scripting attacks.<br/>- <strong class="lb ir">upgrade-insecure-requests:</strong> Instructs user agents to treat all of a site's insecure URLs (those  served over HTTP) as though they have been replaced with secure URLs(those served over HTTPS).</span></pre><ul class=""><li id="2f68" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">X-Frame-Options</strong></a>(Response Header):这可以用来表示是否允许浏览器在&lt;框架&gt;、&lt; iframe &gt;、&lt; embed &gt;或&lt; object &gt;中呈现页面。应用程序可以利用这一点来避免<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/Security/Types_of_attacks#Click-jacking" rel="noopener ugc nofollow" target="_blank">点击劫持</a>攻击。</li></ul><p id="d485" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="9cc3" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">X-Frame-Options: DENY | SAMEORIGIN | ALLOW-FROM URL</strong><br/>#Further Details:<br/>- <strong class="lb ir">Deny</strong>: <!-- -->The page cannot be displayed in a frame, regardless of the site attempting to do so.<br/>- <strong class="lb ir">SAMEORIGIN</strong>: <!-- -->The page can only be displayed in a frame on the same origin as the page itself.<br/>- <strong class="lb ir">ALLOW-FROM-URL</strong>: The website can only be framed by the URL specified here.</span></pre><p id="2e03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意</strong>:Content-Security-Policy HTTP报头有一个frame-ancestors指令，它废弃了这个报头以支持浏览器。</p><ul class=""><li id="fc05" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">X-XSS-保护</strong> </a>(响应头):这个头是Internet Explorer、Chrome和Safari的一个功能，当它们检测到反射的跨站脚本(<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Glossary/XSS" rel="noopener ugc nofollow" target="_blank"> XSS </a>)攻击时，会阻止页面加载。</li></ul><p id="3a2e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="2d9c" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">X-XSS-Protection: 0 | 1 | 1; mode=block | 1; report=&lt;reporting-uri&gt;</strong><br/>#Further Details:<br/><strong class="lb ir">0</strong>: Disables XSS filtering.<br/><strong class="lb ir">1</strong>: Enables XSS filtering.<br/><strong class="lb ir">1; mode=block</strong>: Enables XSS filtering. In case of attack, the browser will prevent rendering of the page, rather than sanitizing the page.<br/><strong class="lb ir">1; report=&lt;reporting-URI&gt;</strong> (Chromium only): Enables XSS filtering. If a XSS attack is detected, the  browser will sanitize the page and report the violation.</span></pre><ul class=""><li id="c12e" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> HTTP严格的传输安全</strong> </a>(响应头):HSTS告诉浏览器只能使用HTTPS访问网站，而不能使用HTTP。</li></ul><p id="4133" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="ac75" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">Strict-Transport-Security: max-age=63072000; includeSubDomains; preload</strong><br/>#Further Details:<br/>- <strong class="lb ir">max-age=&lt;expire-time&gt;</strong> : <!-- -->The time, in seconds, that the browser should remember that a site is only to be accessed using HTTPS (Recommendation of 2 years of time period).<br/>- <strong class="lb ir">includeSubDomains </strong>(<!-- -->optional parameter<!-- -->):<!-- --> rule applies to all of the site's subdomains as well.<br/>- <strong class="lb ir">Preload</strong>: whether the site should be included in the HSTS preload list</span></pre><p id="8d76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意</strong> : HSTS是基于第一次使用的信任(豆腐)，这意味着我们必须手动重定向用户，在他们的第一个HTTP请求，到我们网站的HTTPS版本。在它的响应中，会有一个HSTS头，浏览器会把它存储在缓存中。下一次出现不安全(HTTP)连接时，它将自动重定向到安全连接。攻击者可以对第一个HTTP请求使用MITM攻击，并使用SSL剥离或SSL劫持等技术。为了防止这种情况，我们需要将站点添加到<a class="ae lu" href="https://hstspreload.org/" rel="noopener ugc nofollow" target="_blank"> <em class="lv"> HSTS预加载列表</em> </a>中，并在标题中添加预加载指令。浏览器将检查该站点是否在预加载列表中，并拒绝通过不安全的连接加载它。</p><ul class=""><li id="9521" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">X-Content-Type-Options</strong></a>(Response Header):用于控制web浏览器中的MIME类型嗅探功能。如果<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" rel="noopener ugc nofollow" target="_blank"> <em class="lv">内容类型</em> </a>标题为空或缺失，浏览器会“嗅探”内容并尝试以最合适的方式显示源文件。要防止浏览器嗅探页面内容并决定使用哪种MIME类型，请使用带有'<em class="lv"> nosniff' </em>指令的X-Content-Type-Options头:</li></ul><p id="f92b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="2e1f" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">X-Content-Type-Options: nosniff</strong></span></pre><ul class=""><li id="73d9" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Expect-CT </strong> </a>(响应头):允许站点选择报告和/或执行<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency" rel="noopener ugc nofollow" target="_blank">证书透明度</a>要求，以防止该站点使用错误颁发的证书而不被注意到。当一个站点启用Expect-ct报头时，它们请求浏览器检查该站点的任何证书是否出现在<a class="ae lu" href="https://www.certificate-transparency.org/known-logs" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">公共CT日志</strong> </a>中。</li></ul><p id="84f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="17bc" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">Expect-CT: report-uri="&lt;uri&gt;",enforce, max-age=&lt;age&gt;</strong><br/>#Further Details:<br/>- max-age: <!-- -->This is the duration (in seconds) of the data being stored in the browser cache.<br/>- <strong class="lb ir">report-uri: </strong>This is the URL to which the breach report will be sent.<br/>- <strong class="lb ir">enforce: </strong>This indicates whether the connection should be established, if a certificate that doesn’t comply with CT is present.</span></pre><p id="79c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注</strong>:Expect-CT很可能在2021年6月被淘汰。自2018年5月起，预计新证书将默认支持SCT。2018年3月之前的证书的有效期为39个月，这些证书将于2021年6月到期。</p><ul class=""><li id="81fe" class="ll lm iq ka b kb kc kf kg kj ln kn lo kr lp kv lq lr ls lt bi translated"><a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Access-Control-Allow-Origin</strong></a>(Response header):表示响应是否可以与来自给定<a class="ae lu" href="https://developer.mozilla.org/en-US/docs/Glossary/origin" rel="noopener ugc nofollow" target="_blank">原点</a>的请求代码共享。</li></ul><p id="6600" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="2773" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">Access-Control-Allow-Origin: * | &lt;origin&gt; | null</strong><br/>#Further Details:<br/><strong class="lb ir">*: </strong>Allows request code from any origin to access the resource.<br/><strong class="lb ir">&lt;origin&gt;</strong>: Specifies an origin. Only a single origin can be specified.</span></pre><p id="d5bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参考资料:</p><div class="lx ly gp gr lz ma"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">HTTP标题</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">HTTP头让客户机和服务器通过HTTP请求或响应传递附加信息。一个HTTP头…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">developer.mozilla.org</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo jw ma"/></div></div></a></div><div class="lx ly gp gr lz ma"><a href="https://infosec.mozilla.org/guidelines/web_security" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab fo"><div class="mc ab md cl cj me"><h2 class="bd ir gy z fp mf fr fs mg fu fw ip bi translated">网络安全</h2><div class="mh l"><h3 class="bd b gy z fp mf fr fs mg fu fw dk translated">本文档的目标是帮助运营团队创建安全的web应用程序。所有Mozilla网站和…</h3></div><div class="mi l"><p class="bd b dl z fp mf fr fs mg fu fw dk translated">infosec.mozilla.org</p></div></div></div></a></div></div></div>    
</body>
</html>