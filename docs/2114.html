<html>
<head>
<title>Kubernetes 101 | Setting up Kubernetes Cluster Locally</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes 101 |在本地建立Kubernetes集群</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/kubernetes-101-setting-up-kubernetes-cluster-locally-aa8c34c89862?source=collection_archive---------1-----------------------#2022-06-01">https://infosecwriteups.com/kubernetes-101-setting-up-kubernetes-cluster-locally-aa8c34c89862?source=collection_archive---------1-----------------------#2022-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="f4fb" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">这篇博客是关于使用Kind、Minikube、Kubeadm &amp; K3s等多种工具设置<strong class="jw iu">本地Kubernetes集群</strong>用于学习&amp;测试。</p></blockquote><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/42018bb085ffc359b2dc6f8bc0525b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C5qJjcTuJvY7Xh0hFmwjGQ.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">图片来自<a class="ae li" href="https://www.jambit.com/en/latest-info/toilet-papers/minikube-vs-kind-vs-k3s-which-local-kubernetes-cluster-should-i-use/" rel="noopener ugc nofollow" target="_blank">https://www . jambit . com/en/latest-info/toilet-papers/minikube-vs-kind-vs-k3s-which-local-kubernetes-cluster-should-I-use/</a></figcaption></figure><h1 id="905d" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">种类</h1><blockquote class="jq jr js"><p id="670f" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated"><a class="ae li" href="https://sigs.k8s.io/kind" rel="noopener ugc nofollow" target="_blank"> kind </a>是一个使用Docker容器“节点”运行本地Kubernetes集群的工具。Kind主要是为测试Kubernetes本身而设计的，但也可以用于本地开发或CI。</p><p id="0b69" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">kind通过使用Docker容器作为“节点”来运行本地Kubernetes集群。</p></blockquote><p id="eb6a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">先决条件</p><p id="da9d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">此设置基于ubuntu 18.04。在本练习中，我们将在本地创建一个Kubernetes集群，然后研究集群中的基本组件，之后我们将使用YAML文件在集群中创建一个nginx pod，然后我们将销毁该集群。要在本地创建Kubernetes集群，请使用下面提到的命令:</p><ul class=""><li id="9fc5" class="mk ml it jw b jx jy kb kc mh mm mi mn mj mo kr mp mq mr ms bi translated">Ubuntu Linux 18.04</li><li id="7d24" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated">码头工人</li></ul><p id="bbc2" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">装置</p><ul class=""><li id="05d6" class="mk ml it jw b jx jy kb kc mh mm mi mn mj mo kr mp mq mr ms bi translated">安装docker</li></ul><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="3760" class="nd lk it mz b gy ne nf l ng nh">#apt update -y<br/>#apt update docker.io</span></pre><ul class=""><li id="31e7" class="mk ml it jw b jx jy kb kc mh mm mi mn mj mo kr mp mq mr ms bi translated">安装<a class="ae li" href="https://kind.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank">种类</a></li></ul><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="7148" class="nd lk it mz b gy ne nf l ng nh">#curl -Lo ./kind <a class="ae li" href="https://kind.sigs.k8s.io/dl/v0.14.0/kind-linux-amd64" rel="noopener ugc nofollow" target="_blank">https://kind.sigs.k8s.io/dl/v0.14.0/kind-linux-amd64</a><br/>#chmod +x ./kind<br/>#mv ./kind  /usr/bin/kind</span></pre><ul class=""><li id="10d4" class="mk ml it jw b jx jy kb kc mh mm mi mn mj mo kr mp mq mr ms bi translated">如果没有安装，请安装Kubectl</li></ul><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="8f3c" class="nd lk it mz b gy ne nf l ng nh">#curl -LO "https://dl.k8s.io/release/<strong class="mz iu">$(</strong>curl -L -s https://dl.k8s.io/release/stable.txt<strong class="mz iu">)</strong>/bin/linux/amd64/kubectl"</span><span id="ab1a" class="nd lk it mz b gy ni nf l ng nh">#sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nj"><img src="../Images/4fbf0612425ed3db069958121cde6fd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZSH4p0jAGwn1h28kYrRhzQ.png"/></div></div></figure><h2 id="199b" class="nd lk it bd ll nk nl dn lp nm nn dp lt mh no np lx mi nq nr mb mj ns nt mf nu bi translated">1)在本地创建集群</h2><ul class=""><li id="308a" class="mk ml it jw b jx nv kb nw mh nx mi ny mj nz kr mp mq mr ms bi translated">运行kind命令创建集群</li></ul><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="2e2a" class="nd lk it mz b gy ne nf l ng nh">#kind create cluster</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oa"><img src="../Images/e3df31c0be5c89bab92a63bd94c1e2d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5sGLlWSf7iJ98IXfd_xdfA.png"/></div></div></figure><ul class=""><li id="bc75" class="mk ml it jw b jx jy kb kc mh mm mi mn mj mo kr mp mq mr ms bi translated">在本地部署我们的集群后，我们可以使用下面提到的命令来枚举该集群中的pod数量:</li></ul><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="c1ea" class="nd lk it mz b gy ne nf l ng nh">#kubectl get pods </span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ob"><img src="../Images/725d31b2a87ea40c560d13857787a5d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j7_D8zOCcTbIqMq2__GFVQ.png"/></div></div></figure><p id="f040" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">在默认命名空间中未找到资源，因此，我们没有在默认命名空间中安排任何pod，让我们尝试使用下面提到的命令列出此群集的所有命名空间中存在的所有pod:</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="5348" class="nd lk it mz b gy ne nf l ng nh">#kubectl get pods -A</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oc"><img src="../Images/6dd124e1f93510535552c0cc933618c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xah_qzRSZF-Aqik4qzVHqw.png"/></div></div></figure><p id="5814" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">检查此群集中存在的节点数量:</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="6452" class="nd lk it mz b gy ne nf l ng nh">#kubectl get nodes -o wide</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi od"><img src="../Images/cccb038d1ea4b782b4e1264763fc2228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XEQEtOR67V5W3HT5j6HmWA.png"/></div></div></figure><p id="94ae" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">目前，我们没有在集群的默认名称空间中运行的pods，但是在kube-system名称空间中运行了多个容器。</p><p id="dc6e" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">创建一个YAML文件，以便在Kubernetes集群中创建nginx pod:</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="aa01" class="nd lk it mz b gy ne nf l ng nh">cat &lt;&lt;EOF &gt;/tmp/nginx-web.yaml<br/>apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: nginx<br/>spec:<br/>  containers:<br/>    - name: static-web<br/>      image: nginx<br/>EOF</span></pre><h2 id="e704" class="nd lk it bd ll nk nl dn lp nm nn dp lt mh no np lx mi nq nr mb mj ns nt mf nu bi translated">使用下面提到命令在我们的集群中创建nginx pod:</h2><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="de9e" class="nd lk it mz b gy ne nf l ng nh">kubectl create -f /tmp/nginx-web.yaml</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oe"><img src="../Images/b1824bb1c9f3f86a10663624346373c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RELPw4l-h8hgUV5cRsWolA.png"/></div></div></figure><p id="0a2d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">检查集群内的pod:</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="47b1" class="nd lk it mz b gy ne nf l ng nh">kubectl get pods</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi of"><img src="../Images/605a6fd8daf18b0d8d72445d50c16933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_N6rWGtPp79QKo_PPYOtA.png"/></div></div></figure><p id="9a8f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">因此，我们在集群内部创建了一个pod。</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="d07e" class="nd lk it mz b gy ne nf l ng nh">kind delete cluster</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi og"><img src="../Images/4ea3d504d1ed79fa6ddea750633271f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_ocd70zguCG4XakDEriFw.png"/></div></div></figure><h1 id="d87d" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">2.迷你库贝</h1><p id="ba0c" class="pw-post-body-paragraph jt ju it jw b jx nv jz ka kb nw kd ke mh oh kh ki mi oi kl km mj oj kp kq kr im bi translated"><strong class="jw iu"> Minikube </strong>是一个<strong class="jw iu"> Kubernetes SIGs项目</strong>，它产生了一个VM，该VM本质上是一个<strong class="jw iu">单节点K8s集群</strong>。它使用可以在所有主要操作系统上使用的<strong class="jw iu">虚拟机管理程序</strong>。您可以<strong class="jw iu">并行创建多个实例</strong>。</p><h2 id="bf05" class="nd lk it bd ll nk nl dn lp nm nn dp lt mh no np lx mi nq nr mb mj ns nt mf nu bi translated">额外补贴</h2><ul class=""><li id="37c6" class="mk ml it jw b jx nv kb nw mh nx mi ny mj nz kr mp mq mr ms bi translated"><strong class="jw iu"> 2个或更多CPU</strong></li><li id="b15b" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated">2GB的可用内存</li><li id="32e8" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated">20GB的可用磁盘空间</li><li id="9d9f" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated">容器或虚拟机管理器，如:<a class="ae li" href="https://minikube.sigs.k8s.io/docs/drivers/docker/" rel="noopener ugc nofollow" target="_blank"> Docker </a>、<a class="ae li" href="https://minikube.sigs.k8s.io/docs/drivers/hyperkit/" rel="noopener ugc nofollow" target="_blank"> Hyperkit </a>、<a class="ae li" href="https://minikube.sigs.k8s.io/docs/drivers/hyperv/" rel="noopener ugc nofollow" target="_blank"> Hyper-V </a>、<a class="ae li" href="https://minikube.sigs.k8s.io/docs/drivers/kvm2/" rel="noopener ugc nofollow" target="_blank"> KVM </a>、<a class="ae li" href="https://minikube.sigs.k8s.io/docs/drivers/parallels/" rel="noopener ugc nofollow" target="_blank"> Parallels </a>、<a class="ae li" href="https://minikube.sigs.k8s.io/docs/drivers/podman/" rel="noopener ugc nofollow" target="_blank"> Podman </a>、<a class="ae li" href="https://minikube.sigs.k8s.io/docs/drivers/virtualbox/" rel="noopener ugc nofollow" target="_blank"> VirtualBox </a>或<a class="ae li" href="https://minikube.sigs.k8s.io/docs/drivers/vmware/" rel="noopener ugc nofollow" target="_blank">VMware Fusion/Workstation</a></li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ok"><img src="../Images/66d0a669fddffbaa4b332da60314e220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ugc4U75NceBh5yAFHwy0ww.png"/></div></div></figure><ul class=""><li id="bc4b" class="mk ml it jw b jx jy kb kc mh mm mi mn mj mo kr mp mq mr ms bi translated">安装docker以避免错误。</li></ul><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="b3db" class="nd lk it mz b gy ne nf l ng nh">#apt install docker.io</span><span id="10f7" class="nd lk it mz b gy ni nf l ng nh">#sudo usermod -aG docker $USER &amp;&amp; newgrp docker</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ol"><img src="../Images/6771b3a7a6fa745857c34ae4e8a0de60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1UVyBPmVRH8eQ6HF3a3QA.png"/></div></div></figure><h2 id="220f" class="nd lk it bd ll nk nl dn lp nm nn dp lt mh no np lx mi nq nr mb mj ns nt mf nu bi translated">装置</h2><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="eed7" class="nd lk it mz b gy ne nf l ng nh">curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube_latest_amd64.deb<br/>sudo dpkg -i minikube_latest_amd64.deb</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi om"><img src="../Images/539e9b37c5ed9b5cabb29723ef81522f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DzYKLKUVqBj1JumV90b28Q.png"/></div></div></figure><p id="a690" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">启动minikube以创建集群</p><blockquote class="jq jr js"><p id="7b6a" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">以非root用户身份运行minikube。</p></blockquote><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="ebec" class="nd lk it mz b gy ne nf l ng nh">#minikube start</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi on"><img src="../Images/0bb0fe0b8396c0d1029fc45e1121ae3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lA6ZpQdcPreixeiDnT8Giw.png"/></div></div></figure><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="7a4c" class="nd lk it mz b gy ne nf l ng nh">kubectl get nodes -o wide</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oo"><img src="../Images/85fb7f644ea91a57a532b3c7b0b7c649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xyUf6qdZIHYpH_oTxEa2dg.png"/></div></div></figure><p id="53a6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">让我们创建一个YAML文件，以便在Kubernetes集群中创建nginx pod:</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="1c81" class="nd lk it mz b gy ne nf l ng nh">cat &lt;&lt;EOF &gt;/tmp/nginx-web.yaml<br/>apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: nginx<br/>spec:<br/>  containers:<br/>    - name: static-web<br/>      image: nginx<br/>EOF</span></pre><h2 id="079d" class="nd lk it bd ll nk nl dn lp nm nn dp lt mh no np lx mi nq nr mb mj ns nt mf nu bi translated">使用上述文件安排nginx pod:</h2><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="e8d3" class="nd lk it mz b gy ne nf l ng nh">kubectl create -f /tmp/nginx-web.yaml</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi op"><img src="../Images/bac653c26a58d07dc439e589d1c05122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDaFM_b8PWAWDOfPI5yMqw.png"/></div></div></figure><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="80ca" class="nd lk it mz b gy ne nf l ng nh">kubectl get pods</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oq"><img src="../Images/c292cf522d54167f9ec0b1ad7a675445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kyXsWhnIL3K5t5nQG3RQlg.png"/></div></div></figure><h1 id="46d7" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">3.Kubeadm</h1><h2 id="85bd" class="nd lk it bd ll nk nl dn lp nm nn dp lt mh no np lx mi nq nr mb mj ns nt mf nu bi translated">额外补贴</h2><ul class=""><li id="6924" class="mk ml it jw b jx nv kb nw mh nx mi ny mj nz kr mp mq mr ms bi translated">2个或更多CPU</li><li id="6a3e" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated">2GB的可用内存</li><li id="1388" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated">20GB的可用磁盘空间</li></ul><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="bc5a" class="nd lk it mz b gy ne nf l ng nh">#sudo apt-get update<br/>#sudo apt-get install -y apt-transport-https ca-certificates</span><span id="89cf" class="nd lk it mz b gy ni nf l ng nh"># Remove all other versions of docker from your system<br/>sudo apt-get remove -y docker docker-engine \<br/>  <!-- -->docker.io containerd runc<br/><br/># Add docker GPG key<br/>curl -fsSL https://download.docker.com/linux/ubuntu/gpg \<br/>  <!-- -->| sudo gpg --dearmor \<br/>  <!-- -->-o /usr/share/keyrings/docker-archive-keyring.gpg<br/><br/># Add docker apt repository<br/>echo \<br/>  <!-- -->"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" \<br/>  <!-- -->| sudo tee /etc/apt/sources.list.d/docker.list<br/><br/># Fetch the package lists from docker repository<br/>sudo apt-get update<br/><br/># Install docker and containerd<br/>sudo apt-get install -y docker-ce docker-ce-cli containerd.io</span></pre><h1 id="394b" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">为kubeadm配置docker</h1><p id="a7be" class="pw-post-body-paragraph jt ju it jw b jx nv jz ka kb nw kd ke mh oh kh ki mi oi kl km mj oj kp kq kr im bi translated">我们必须对docker进行一些配置更改，以使其与Kubernetes一起工作，否则kubeadm飞行前检查将会失败。</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="9dfe" class="nd lk it mz b gy ne nf l ng nh"># Configure docker to use overlay2 storage and systemd<br/>sudo mkdir -p /etc/docker<br/>cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json<br/>{<br/>    <!-- -->"exec-opts": ["native.cgroupdriver=systemd"],<br/>    <!-- -->"log-driver": "json-file",<br/>    <!-- -->"log-opts": {"max-size": "100m"},<br/>    <!-- -->"storage-driver": "overlay2"<br/>}<br/>EOF</span><span id="3cc1" class="nd lk it mz b gy ni nf l ng nh"># Restart docker to load new configuration<br/>sudo systemctl restart docker</span><span id="33bb" class="nd lk it mz b gy ni nf l ng nh"># Add docker to start up programs<br/>sudo systemctl enable docker</span><span id="1e3c" class="nd lk it mz b gy ni nf l ng nh"># Allow current user access to docker command line<br/>sudo usermod -aG docker $USER</span></pre><h1 id="c798" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">安装kubeadm、kubelet和kubectl</h1><p id="479e" class="pw-post-body-paragraph jt ju it jw b jx nv jz ka kb nw kd ke mh oh kh ki mi oi kl km mj oj kp kq kr im bi translated">您需要确保kubeadm、kubelet和kubectl的版本是兼容的。</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="d424" class="nd lk it mz b gy ne nf l ng nh"># Add Kubernetes GPG key<br/>sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg \<br/>  <a class="ae li" href="https://packages.cloud.google.com/apt/doc/apt-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/apt/doc/apt-key.gpg</a></span><span id="06a8" class="nd lk it mz b gy ni nf l ng nh"># Add Kubernetes apt repository<br/>echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] <a class="ae li" href="https://apt.kubernetes.io/" rel="noopener ugc nofollow" target="_blank">https://apt.kubernetes.io/</a> kubernetes-xenial main" \<br/>  | sudo tee /etc/apt/sources.list.d/kubernetes.list</span><span id="d0db" class="nd lk it mz b gy ni nf l ng nh"># Fetch package list<br/>sudo apt-get update</span><span id="d8e3" class="nd lk it mz b gy ni nf l ng nh">sudo apt-get install -y kubelet kubeadm kubectl</span><span id="2225" class="nd lk it mz b gy ni nf l ng nh"># Prevent them from being updated automatically<br/>sudo apt-mark hold kubelet kubeadm kubectl</span></pre><h1 id="6f02" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">确保禁用交换</h1><p id="30ea" class="pw-post-body-paragraph jt ju it jw b jx nv jz ka kb nw kd ke mh oh kh ki mi oi kl km mj oj kp kq kr im bi translated">必须禁用交换功能，因为Kubernetes不支持它。详见<a class="ae li" href="https://github.com/kubernetes/kubernetes/issues/53533" rel="noopener ugc nofollow" target="_blank">关于Kubernetes </a>上swap的GitHub问题。</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="740a" class="nd lk it mz b gy ne nf l ng nh"># See if swap is enabled<br/>swapon --show</span><span id="ae19" class="nd lk it mz b gy ni nf l ng nh"># Turn off swap<br/>sudo swapoff -a</span><span id="01fb" class="nd lk it mz b gy ni nf l ng nh"># Disable swap completely<br/>sudo sed -i -e '/swap/d' /etc/fstab</span></pre><p id="d5a8" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">运行下面提到的命令以避免错误:</p><blockquote class="jq jr js"><p id="b6e5" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">此外，在Kubeadm未知服务运行时的情况下，v1alpha2.RuntimeService #4581错误</p></blockquote><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="fd0d" class="nd lk it mz b gy ne nf l ng nh">rm /etc/containerd/config.toml<br/>systemctl restart containerd<br/>kubeadm init</span></pre><h1 id="2d47" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">使用kubeadm创建集群</h1><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="2b80" class="nd lk it mz b gy ne nf l ng nh">kubeadm init --pod-network-cidr=10.244.0.0/16</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi or"><img src="../Images/b0fdc308faa23c6ccbdcb5c461f18845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ao6h0ovV4U6264y7GX9XeQ.png"/></div></div></figure><p id="9cd0" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">然后重新运行该命令</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="a9b9" class="nd lk it mz b gy ne nf l ng nh">mkdir -p $HOME/.kube<br/>cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/>chown $(id -u):$(id -g) $HOME/.kube/config<br/>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml<br/>kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/k8s-manifests/kube-flannel-rbac.yml<br/>kubectl taint nodes --all node-role.kubernetes.io/master-<br/>kubectl get nodes</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi os"><img src="../Images/ec1d3a11e6ca7ee26329fe5b54e3ad63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3C6lBcOvnyV-UKrbv6hsBw.png"/></div></div></figure><p id="bd04" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">要重置集群，请执行以下操作:</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="e8a3" class="nd lk it mz b gy ne nf l ng nh">kubeadm reset</span></pre><h1 id="a279" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">4.K3s</h1><p id="3d21" class="pw-post-body-paragraph jt ju it jw b jx nv jz ka kb nw kd ke mh oh kh ki mi oi kl km mj oj kp kq kr im bi translated">K3s是经过认证的高可用性Kubernetes发行版，专为无人值守、资源有限、远程位置或物联网设备内部的生产工作负载而设计。</p><p id="7566" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">运行命令，安装完成。</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="bb3a" class="nd lk it mz b gy ne nf l ng nh">curl -sfL https://get.k3s.io | sh -</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ot"><img src="../Images/e715b566b9453d2900a17c494b363f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwrh1vP2kya5gD6a72yPFA.png"/></div></div></figure><p id="5a58" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke mh kg kh ki mi kk kl km mj ko kp kq kr im bi translated">现在，让我们创建一个YAML文件来在Kubernetes集群中创建nginx pod:</p><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="c235" class="nd lk it mz b gy ne nf l ng nh">cat &lt;&lt;EOF &gt;/tmp/nginx-web.yaml<br/>apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: nginx<br/>spec:<br/>  containers:<br/>    - name: static-web<br/>      image: nginx<br/>EOF</span></pre><h2 id="3a27" class="nd lk it bd ll nk nl dn lp nm nn dp lt mh no np lx mi nq nr mb mj ns nt mf nu bi translated">使用上述文件安排nginx pod:</h2><pre class="kt ku kv kw gt my mz na nb aw nc bi"><span id="ba27" class="nd lk it mz b gy ne nf l ng nh">kubectl create -f /tmp/nginx-web.yaml</span><span id="d26d" class="nd lk it mz b gy ni nf l ng nh">kubectl get pods</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ou"><img src="../Images/f27d825966d84c6dcdbf997b9eee30a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5N9PXySt3oa0KCAgY7vfDg.png"/></div></div></figure><h2 id="01e5" class="nd lk it bd ll nk nl dn lp nm nn dp lt mh no np lx mi nq nr mb mj ns nt mf nu bi translated">参考:</h2><ul class=""><li id="cc56" class="mk ml it jw b jx nv kb nw mh nx mi ny mj nz kr mp mq mr ms bi translated"><a class="ae li" href="https://blog.radwell.codes/2021/05/provisioning-single-node-kubernetes-cluster-using-kubeadm-on-ubuntu-20-04/" rel="noopener ugc nofollow" target="_blank">https://blog . rad well . codes/2021/05/provisioning-single-node-kubernetes-cluster-using-kube ADM-on-Ubuntu-20-04/</a></li><li id="5806" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated"><a class="ae li" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank">https://k3s.io/</a></li><li id="8138" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated"><a class="ae li" href="https://www.containiq.com/post/kubeadm" rel="noopener ugc nofollow" target="_blank">https://www.containiq.com/post/kubeadm</a></li><li id="953c" class="mk ml it jw b jx mt kb mu mh mv mi mw mj mx kr mp mq mr ms bi translated"><a class="ae li" href="https://www.jambit.com/en/latest-info/toilet-papers/minikube-vs-kind-vs-k3s-which-local-kubernetes-cluster-should-i-use/" rel="noopener ugc nofollow" target="_blank">https://www . jambit . com/en/latest-info/toilet-papers/minikube-vs-kind-vs-k3s-which-local-kubernetes-cluster-should-I-use/</a></li></ul></div></div>    
</body>
</html>