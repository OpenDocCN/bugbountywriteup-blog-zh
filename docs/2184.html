<html>
<head>
<title>How I found my first RCE!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何找到我的第一个RCE的！</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/how-i-found-my-first-rce-c063546114ef?source=collection_archive---------0-----------------------#2022-07-13">https://infosecwriteups.com/how-i-found-my-first-rce-c063546114ef?source=collection_archive---------0-----------------------#2022-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4cda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">远程代码执行(rce)是所有人的梦想，但只有一部分人找到了它。这个故事是关于我如何能够找到我的RCE使用简单的模糊技术和一点点侦察。所以我们开始吧…</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/7afe6da7f659452fea1d8d82a0a37dd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*8qjdds8s4qEkojdN"/></div></figure><p id="a353" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我的方法论:</strong></p><ol class=""><li id="55f9" class="kt ku iq jp b jq jr ju jv jy kv kc kw kg kx kk ky kz la lb bi translated">已收集范围内的域。</li><li id="2ce5" class="kt ku iq jp b jq lc ju ld jy le kc lf kg lg kk ky kz la lb bi translated">开始主动和被动子域枚举。用于被动子域枚举的工具:<a class="ae lh" href="https://github.com/projectdiscovery/subfinder" rel="noopener ugc nofollow" target="_blank"> subfinder </a>(带有Shodan、Chaos、GitHub、Sublist3r等不同服务的API Keys)。对于活动子域枚举，使用了来自<a class="ae lh" href="https://wordlists.assetnote.io/" rel="noopener ugc nofollow" target="_blank">资产注释词表</a>的<a class="ae lh" href="https://wordlists-cdn.assetnote.io/data/manual/best-dns-wordlist.txt" rel="noopener ugc nofollow" target="_blank">最佳DNS词表</a>。</li><li id="3bf3" class="kt ku iq jp b jq lc ju ld jy le kc lf kg lg kk ky kz la lb bi translated">大约有219个子域名被发现</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/b7af39bf8bc3a42e68931ae7dc8d2871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRfI04miCx_xB-Ti76ViMQ.png"/></div></div></figure><p id="46cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.下一步是根据状态代码过滤掉实时域。</p><p id="a9fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.很快，我发现子域accounts.example.com与状态代码403禁止。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ln"><img src="../Images/fd9a20200b4f610b89a7dcf76fba7f38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CR_fhFJz9xyzkYct7hVlaw.png"/></div></div></figure><p id="695f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.这是真正的旅程开始的地方。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/de46e9b45b58d3d2abe8f9b84f65ac36.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*cnegMzNa37QqDJq2"/></div></figure><p id="8ac0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我准备好了<a class="ae lh" href="https://github.com/ffuf/ffuf" rel="noopener ugc nofollow" target="_blank"> FFuF </a>和著名的<a class="ae lh" href="https://github.com/danielmiessler/SecLists" rel="noopener ugc nofollow" target="_blank">seclist</a>中的单词表，开始了模糊扫描。发现一个似乎易受CVE攻击的端点<em class="lo">/file upload/tools any</em>-2022–29464。</p><p id="bccb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lh" href="https://docs.wso2.com/display/Security/Security+Advisory+WSO2-2021-1738" rel="noopener ugc nofollow" target="_blank">CVE-2022–29464</a>是由<a class="ae lh" href="https://twitter.com/orange_8361" rel="noopener ugc nofollow" target="_blank">橙仔</a>发现的WSO2上的一个关键漏洞。该漏洞是一个未经验证的无限制的任意文件上传，使得未经验证的攻击者能够通过上传恶意JSP文件在WSO2服务器上获得RCE。</p><p id="223a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">易受攻击的端点是/fileupload，攻击者可以使用该端点上传。jsp文件，这可能导致受害者机器的反向外壳。</p><p id="d10a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我确认了这个漏洞，下一个任务就是找到一个合适的漏洞。有两种方法可以做到这一点，要么在Burp中捕获请求并修改请求，要么使用开发的漏洞。让我们来了解一下这两者的步骤</p><p id="7585" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">方法1:使用打嗝</strong></p><ol class=""><li id="ffe4" class="kt ku iq jp b jq jr ju jv jy kv kc kw kg kx kk ky kz la lb bi translated">在Burp Suite中捕获端点请求</li><li id="903a" class="kt ku iq jp b jq lc ju ld jy le kc lf kg lg kk ky kz la lb bi translated">将方法从GET更改为POST</li><li id="c8da" class="kt ku iq jp b jq lc ju ld jy le kc lf kg lg kk ky kz la lb bi translated">在Content-Disposition头中，输入端点名以及文件名和文件名。例如:</li></ol><p id="5328" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">内容-处置:形式-数据；name= "../../../../repository/deployment/server/web apps/authenticationendpoint/my shell . JSP "；filename="MyShell.jsp "</p><p id="6a8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.在POST主体中输入file.jsp应该执行的命令。例如:</p><p id="3e40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"/><p id="33e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.导航到端点accounts.example.com/authenticationendpoint/MyShell.jsp，您的命令将被执行</p><p id="5a55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">方法二:利用漏洞</strong></p><ol class=""><li id="885c" class="kt ku iq jp b jq jr ju jv jy kv kc kw kg kx kk ky kz la lb bi translated">导航到<a class="ae lh" href="https://github.com/hakivvi/CVE-2022-29464" rel="noopener ugc nofollow" target="_blank">https://github.com/hakivvi/CVE-2022-29464</a></li><li id="e4b2" class="kt ku iq jp b jq lc ju ld jy le kc lf kg lg kk ky kz la lb bi translated">Git将文件克隆到本地机器上</li><li id="cf30" class="kt ku iq jp b jq lc ju ld jy le kc lf kg lg kk ky kz la lb bi translated">使用python 3 exploit . py https://accounts.example.com MyShell.jsp运行漏洞</li><li id="92f1" class="kt ku iq jp b jq lc ju ld jy le kc lf kg lg kk ky kz la lb bi translated">请访问端点https://accounts . example . com/authenticationendpoint/my shell . JSP</li><li id="6a8f" class="kt ku iq jp b jq lc ju ld jy le kc lf kg lg kk ky kz la lb bi translated">您将能够运行任何命令</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lp"><img src="../Images/da33140e6ae92f91fca8774c0a5f2691.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KrohRWWoc5sqUCSUuWQdFg.png"/></div></div></figure><p id="b13e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与此同时，我正在利用RCE，我在同一个域名accounts.example.com上使用了<a class="ae lh" href="https://github.com/tomnomnom/waybackurls" rel="noopener ugc nofollow" target="_blank"> waybackurls </a>，下面的端点吸引了我的眼球。https://accounts.example.com/shindig/gadgets/proxy?container = default&amp;URL = https://Google . com</p><p id="b2fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我迅速打开<a class="ae lh" href="https://app.interactsh.com/#/" rel="noopener ugc nofollow" target="_blank"> Interactsh客户端</a>并粘贴有效载荷。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ln"><img src="../Images/06a0639755306ba56c5f0a1f7efacb2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQJNUV_FkDr1eOXuqHfcjA.png"/></div></div></figure><p id="2505" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有嘣<strong class="jp ir"> SSRF </strong>！事实证明，同样的WSO2也容易受到SSRF的攻击。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lq"><img src="../Images/4fca0edb4f89b1b65023aec06f7adb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vYAzxYtaLXIZ0AGY"/></div></div></figure><p id="51ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">时间线</strong></p><p id="a591" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发现的两个漏洞:2022年7月10日</p><p id="dc4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">报告日期:2022年7月10日</p><p id="323c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">初次答复:2022年7月11日</p><p id="5a1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">授予名人堂+推荐信:2022年7月13日</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="a974" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lo">来自Infosec的报道:Infosec上每天都会出现很多难以跟上的内容。</em> <a class="ae lh" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="lo">加入我们的每周简讯</em> </strong> </a> <em class="lo">以5篇文章、4个线程、3个视频、2个Github Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</em></p></div></div>    
</body>
</html>