<html>
<head>
<title>Bug Hunting with Param Miner: Cache poisoning with XSS, a peculiar case</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Param Miner搜索bug:XSS缓存中毒，一个特例</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cache-poisoning-with-xss-a-peculiar-case-eb5973850814?source=collection_archive---------1-----------------------#2020-08-08">https://infosecwriteups.com/cache-poisoning-with-xss-a-peculiar-case-eb5973850814?source=collection_archive---------1-----------------------#2020-08-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/581517c571a14654d2ad401efce202e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Fqjju2FPzMFmXvQQ6mK5A.png"/></div></div></figure><p id="fe08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你听说过缓存中毒，在我看来，这种bug存在的时间比大多数人意识到的要长得多，就像这种性质的许多其他情况一样。但是，这篇文章不是关于一堂历史课；然而，有几个教训，也许更多，你可能会发现有用。</p><p id="8ce6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">带边的参数挖掘器:</strong></p><p id="7e4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">看到我做了什么吗？没关系，它很快就会被发现的。</p><p id="e2b4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是真实世界的例子。当然，我不能透露问题中的bbp，但攻击的细节不会使它有必要这样做。</p><p id="02da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我使用的是Param Miner，它是burp pro的扩展(从技术上来说，它在burp community edition中也可以工作，但有很多限制)。此外，除了测试隐藏参数，它还测试缓存中毒，然后有burp pro和它的扫描仪测试xss。把它们加在一起，你可以得到一些不错的奖金。但是，它仍然需要一些跑腿的工作。</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/15ff994b89d446b9b8663e14a1ad16e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*MtUyOGSPHHWH_xRYF9Zwgg.png"/></div></figure><p id="d127" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当你看到这个的时候，你的心脏会不会因为肾上腺素分泌的增加而膨胀起来，或者它会颤动，或者它会开始跳得更强。无论哪种方式，都意味着一个好消息。对我来说是的。在最初的(握手)审查，原来这不是一个假阳性。Param miner发现了一个隐藏的header参数，它反映了网站主页正文(情节扭曲)中的值。额外的好处:xss的值没有被正确地净化。耶。</p><p id="9527" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是，对于最初的审查，我一直使用打嗝中继器进行验证，这是一个需要时间来解决的错误。我确实花了一些时间。当使用firefox完成时，尝试复制结果(即使用xss呈现网站主页)失败。我检查了源代码，没有那个参数的踪迹，因此没有xss。发生了什么事？</p><p id="a5ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">验证，实际上是一个概念验证:</strong></p><p id="d51b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当有疑问时，喝一些咖啡，然后再喝一些咖啡，也许检查一下在讨论的那个星期有什么视频游戏打折，然后回到1和0的泥淖中(不是真正的1和0，除非如果你正在做一些严重的事情，可能会让你远离这篇文章)。然后——卷曲。</p><p id="ec1e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">更准确地说，</p><p id="b9ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用curl命令攻击网站的bash脚本:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/f70c3ff3fb48dd421266ef1a1d0a2f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kMNp88v1G-hgkhNkH-63bg.png"/></div></div></figure><p id="8030" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">curl和grep检查响应(手动完成):</p><p id="1c23" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">卷发【https://website.com】T4| grep "&lt;/脚本&gt;测试"</p><p id="cf1d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第一个回答没什么好grep的。但是，然后…突出显示的红色字体是什么？会不会是？但是接下来的几个回答什么都没有，然后又有几个回答什么都没有。事实证明，缓存被清除得相当快，但还不够快:)</p><p id="85fc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">让PoC真正影响网站访问者:</strong></p><p id="1797" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">回到手头的问题。让burp入侵者无限运行，curl响应包含隐藏参数，而firefox和chrome仍然在渲染没有隐藏参数的网站，这怎么能用来攻击任何人呢？它不能。仅仅这两件事是不够的。</p><p id="9c32" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> MS Edge来营救(？):</strong></p><p id="18df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在你明白前面的内容了:)没关系。</p><p id="855d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在花了一些时间咒骂和被手边的问题弄得不知所措之后，当然也试图找出如何在一份报告中呈现它而不被标记为不适用或信息丰富，我记得我没有试过所有的浏览器。而且，虽然我不是windows的粉丝，但我确实有windows，我总是可以指望它会失败，因此不会有令人不愉快的意外:)</p><p id="5aaf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就是我最终选择Edge女士的原因。我打开了MS Edge，我打开了受影响的网站。没什么。当然，缓存清理得太快或者我的curl脚本太慢。关键是，bash脚本的最终curl有效负载是:</p><pre class="la lb lc ld gt lg lh li lj aw lk bi"><span id="facd" class="ll lm it lh b gy ln lo l lp lq">curl -H “User-Agent: tester” -H “hidden-header: &lt;/script&gt;&lt;h2&gt;TESTERING2333&lt;img src=x onerror=alert(document.domain)&gt;” <a class="ae lf" href="https://website.com/" rel="noopener ugc nofollow" target="_blank">https://website.com/</a></span></pre><p id="655c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">刷新几次后，瞧:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/581517c571a14654d2ad401efce202e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Fqjju2FPzMFmXvQQ6mK5A.png"/></div></div></figure><p id="e717" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我报告了这件事，但是……他们无法复制。我制作了一些视频，当然，在测试缓存中毒和响应时，我还结合了vps和本地环境，以确保它不是本地缓存中毒。但是，最后，不管是什么原因(也许是服务器的位置)，为什么他们不能复制它的答案，最初，与他们在美国以外的国家尝试它有关。他们联系了位于美国的同事，他们没有问题复制它。电脑，去想想。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="8ec2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">希望，这给了你一些新的想法和/或重新点燃旧的。此外，如果你还没有这样做(或者你忘记了，这发生在我身上)，那么这里有一个提醒:当其他浏览器失败时，一定要尝试edge(只要问题中的bbp不排除它，不，Edge不是IE)，它可能就是你需要的Edge。</p><p id="6d20" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">很抱歉这些双关语，但它们有时会让我微笑:)</p></div></div>    
</body>
</html>