<html>
<head>
<title>Business Logic Error on Registration Leads to SMS Validation Bypass</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">注册时的业务逻辑错误导致绕过SMS验证</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/business-logic-error-on-registration-leads-to-sms-validation-bypass-80380b3ff629?source=collection_archive---------1-----------------------#2021-03-10">https://infosecwriteups.com/business-logic-error-on-registration-leads-to-sms-validation-bypass-80380b3ff629?source=collection_archive---------1-----------------------#2021-03-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="9685" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你好，猎人们。是时候再写一篇了。这基本上是一个商业逻辑错误，让我绕过注册时的短信验证。让我们开始吧。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ks"><img src="../Images/babd5c78085022060303a6ccfe955c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*JNXHNwnvZgypuNq8gjAuGg.jpeg"/></div></figure><h2 id="e04e" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">目标</h2><p id="d92c" class="pw-post-body-paragraph ju jv iq jw b jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ij bi translated">这一次，我的目标是一家金融服务公司，这与故事无关。他们范围内的资产非常少。注册/登录面板和一些没有任何功能的静态网站。因为只有注册面板有功能，所以我决定简单地测试一下，然后转向其他程序。我不会透露任何来自应用程序的截图，因为它不允许我透露关于错误的细节。然而，故事中会有我的打嗝套件日志的片段。目标网站将被称为<strong class="jw ir">" rededited . com "</strong>。</p><h2 id="534f" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">注册流程</h2><p id="43b2" class="pw-post-body-paragraph ju jv iq jw b jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ij bi translated">测试功能或应用的第一件事是像普通用户一样使用它，并彻底理解流程。我启动了我的Burp套件，按照下面的说明完成了注册过程，同时记录了所有的请求和响应:</p><p id="40f4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">1-导航到redacted.com/registration的<strong class="jw ir"><br/></strong>2-要求用户输入他/她的名字、姓氏、电子邮件地址和电话号码。应用程序将用户转发到<strong class="jw ir">redacted.com/registration/api/email-confirmation</strong><br/>3-在提供所需信息后，首先，一个6位数字的字母数字确认码被发送到您的电子邮件地址。用户输入代码并在另一个端点上进行下一步，该端点是<strong class="jw ir">redacted.com/registration/api/confirm-mobile</strong>T10】4-在这一步，一个6位数字确认码通过SMS发送到用户的手机。用户输入代码并被重定向到<strong class="jw ir">redacted.com/registration/api/user-credentials<br/></strong>5-作为最后一步，用户被要求输入他/她的用户名和密码。当用户提供凭证时，注册过程完成。</p><h2 id="e49a" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">剥削</h2><p id="530e" class="pw-post-body-paragraph ju jv iq jw b jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ij bi translated">在<strong class="jw ir">步骤3 </strong>中，当用户输入发送到其电子邮件的确认码时，会发送一个POST请求，请求正文如下:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/31bc3c448ba73ac3a4feecd8217d66fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*fJoBSa7tfRXKoZMav_uNjw.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">步骤3)电子邮件确认</figcaption></figure><p id="0f74" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">很简单，对吧？当前步骤、下一步和可选参数真的无关紧要。唯一重要的部分是当前步骤和下一步。</p><p id="b694" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<strong class="jw ir">步骤4 </strong>中，当确认通过短信发送的代码时，会发起另一个POST请求，其正文如下:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi md"><img src="../Images/697faa87afc5dbf033b46afdc383d5fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*FDc1602KNqBZQ5yNycvwNg.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">步骤4)短信确认</figcaption></figure><p id="d084" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有相似之处，对吗？有趣的部分来了，就是剥削。以下是我遵循的步骤:</p><p id="6f20" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">1- On <strong class="jw ir">步骤3 </strong>，<strong class="jw ir">打开拦截</strong>，输入发送到你邮箱的确认码。在正文中，如上面第一张图所示，当前步骤被指定为电子邮件确认。现在，在转发请求之前，将图1中突出显示的区域替换为第二张图中突出显示的区域。转发请求。<br/> 2-要求用户输入通过短信发送的验证码，这意味着用户当前处于<strong class="jw ir">步骤4 </strong>。目前网址是<strong class="jw ir">redacted.com/registration/api/confirm-mobile</strong>。<br/> 3-不输入SMS代码，导航至<strong class="jw ir">redacted.com/registration</strong>。</p><p id="8b07" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第3步之后，系统提示我输入我的帐户的用户名和密码，这表明我成功绕过了短信验证。</p><h2 id="58db" class="la lb iq bd lc ld le dn lf lg lh dp li kf lj lk ll kj lm ln lo kn lp lq lr ls bi translated">为什么会这样呢？</h2><p id="0db9" class="pw-post-body-paragraph ju jv iq jw b jx lt jz ka kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ij bi translated">当我将电子邮件确认请求的正文更改为SMS确认请求的正文时，应用程序认为电子邮件代码是有效的。然而，它也假设短信确认也做了，因为我已经改变了身体参数，并得到了成功的回应。当我手动输入网址<strong class="jw ir">redacted.com/registration</strong>时，应用程序认为我已经完成了短信代码验证，因此将我重定向到要求我输入用户名和密码的页面。</p><h1 id="4be0" class="me lb iq bd lc mf mg mh lf mi mj mk li ml mm mn ll mo mp mq lo mr ms mt lr mu bi translated">外卖食品</h1><ul class=""><li id="a244" class="mv mw iq jw b jx lt kb lu kf mx kj my kn mz kr na nb nc nd bi translated">当一个程序在其作用域中有一个特定的功能或一个端点时，尽可能地尝试使用它。由于这个功能是在范围中直接指定的，所以我的报告非常重要，因此我得到了$ $ $ $的报酬。</li></ul><p id="2f20" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我希望这篇文章对您的bug搜索之旅有所帮助，并让您感受到业务逻辑漏洞有多种用途。在未来的文章中再见！</p><p id="e2a4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以在推特上关注我。<a class="ae ne" href="https://twitter.com/pleorqy" rel="noopener ugc nofollow" target="_blank"> @pleorqy </a></p></div></div>    
</body>
</html>