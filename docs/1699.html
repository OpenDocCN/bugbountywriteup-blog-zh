<html>
<head>
<title>ByPass SSL Pinning with IP Forwarding | iptables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过IP转发绕过SSL锁定| iptables</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62?source=collection_archive---------0-----------------------#2021-12-06">https://infosecwriteups.com/bypass-ssl-pinning-with-ip-forwarding-iptables-568171b52b62?source=collection_archive---------0-----------------------#2021-12-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="66a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在努力使用常用工具绕过SSL锁定后，因为我测试的应用程序不会显示我试图捕获的一些HTTPS流量。</p><p id="846b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我像往常一样使用Frida，它在另一个应用程序上运行良好，只是我测试过了。</p><p id="37bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我的团队“紫色团队”决定通过使用kali中的IP转发功能来配置透明代理。我很惊讶的结果，它工作顺利，因为它没有注入任何脚本到应用程序中。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="9b2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想试试，这就是我们在移动应用中绕过SSL锁定的方法。</p><ol class=""><li id="4d13" class="ks kt iq jp b jq jr ju jv jy ku kc kv kg kw kk kx ky kz la bi translated">在genymotion中创建Android模拟器时，我使用Google Pixel (8.0 API 26)作为我的Android虚拟设备</li><li id="fada" class="ks kt iq jp b jq lb ju lc jy ld kc le kg lf kk kx ky kz la bi translated">打开虚拟盒子，机器列表里有安卓谷歌Pixel。并选择“设置”选项卡，将adapter1和adapter2配置为仅主机适配器。请确保名称不同(适配器1的vboxnet0和适配器2的vboxnet1)</li></ol><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/d8440878b8eae7b6cd29ef25e891a90c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4JlUVU9Hg5BpyZAzN5Sgqw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">Oracle VirtualBox管理器中的Google Pixel</figcaption></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lw"><img src="../Images/52fd30478b9611fc43c8a381359bacdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DKuQ_PRUaHbvBPpsvj-hTg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">适配器1配置(默认)</figcaption></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lw"><img src="../Images/60435e891d724be20500ffd5af84cc13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPK-do6cmdxQugk5w1SE0g.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">适配器2配置(仅从NAT更改为主机)</figcaption></figure><p id="46ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你不能在你的android虚拟机器中找到适配器2，只要进入虚拟机器文件-&gt;主机网络管理器。而在网络窗口上，选择<strong class="jp ir">创建</strong>做一个新的适配器，别忘了启用DHCP。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lx"><img src="../Images/8612541a6e0f690c1212c9aaf2995578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_8xnDLpvPY8vzLKIRFoozw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">android虚拟盒中的网络适配器配置</figcaption></figure><p id="6644" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在Genymotion中启动您的android模拟器</p><p id="b0c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.导出burp证书，作为可信证书安装在android系统中。(网上有这么多这方面的教程)。</p><p id="6a5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.下一步是配置我们将使用什么端口来拦截从android设备到我们的burp代理的连接。我通常使用8081端口进行移动连接。所以，在burp代理打开代理选项卡-&gt;选项-&gt;代理监听器-&gt;添加</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ly"><img src="../Images/6fee93273ad5edbf1db9a58b83d620e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jfzSdSb3SCs4X8YXfxdhdw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">绑定到8081和所有接口的端口</figcaption></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ly"><img src="../Images/28087e1115527d292c7439f46b8fa0ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Y9TIgBnziHuchpnHgdmow.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">选中支持不可见代理复选框</figcaption></figure><p id="ca42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.现在，移动到您的kali，用ifconfig -a命令查看所有接口的IP地址，确保有2个适配器名称与vboxnet。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lz"><img src="../Images/131a4c625a064837b5b9491159c32019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azUMSWTzg4KX_24cPgFVlQ.png"/></div></div></figure><p id="a982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">wlan0是用于连接到互联网的适配器，vboxnet0和vboxnet1是来自android模拟器设备的适配器。</p><p id="0691" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.让我们配置我们的android网络</p><p id="d372" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将Wifi配置更改为我使用的静态IP地址192.168.57.2将自动设置默认网关和DNS。(参见vboxnet1中的IP地址)</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/05d0e7f5714b313bf0444ffee8ae8bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*SzFhDMYNBdmtKDHK2RWhWA.png"/></div></figure><p id="a659" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择SAVE按钮，像往常一样，在进入下一步之前重启android虚拟机。</p><p id="8070" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.现在有趣的部分来了。我们将在Kali Linux机器中配置IP转发规则。</p><p id="6297" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在kali Linux中打开您的终端，使用以下命令将IP转发设置为1 (true)(需要root权限):</p><p id="d76f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">echo 1 &gt;/proc/sys/net/IP v4/IP _ forward</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mb"><img src="../Images/2065367273c8439160f76631631baf58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*un0P6efhXCC89TmGUGEv8w.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">将IP转发设置为真</figcaption></figure><p id="b755" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.通过执行以下命令，退出root用户，并为80和443端口连接设置IP表</p><h2 id="4bf2" class="mc md iq bd me mf mg dn mh mi mj dp mk jy ml mm mn kc mo mp mq kg mr ms mt mu bi translated">sudo iptables-t NAT-A post routing-o WLAN 0-j假面舞会</h2><h2 id="97f5" class="mc md iq bd me mf mg dn mh mi mj dp mk jy ml mm mn kc mo mp mq kg mr ms mt mu bi translated">sudo iptables -t nat -A预路由-p TCP-I vbox net 1-dport 80-j重定向-到端口8081</h2><h2 id="3785" class="mc md iq bd me mf mg dn mh mi mj dp mk jy ml mm mn kc mo mp mq kg mr ms mt mu bi translated">sudo iptables -t nat -A预路由-p TCP-I vbox net 1-dport 443-j重定向-到端口8081</h2><blockquote class="mv"><p id="c1c6" class="mw mx iq bd my mz na nb nc nd ne kk dk translated"><em class="nf">您可以将wlan0更改为eth0(用于互联网连接的设备)</em></p></blockquote><p id="ae8b" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">现在你可以检查你的HTTPS流量从你的android被拦截到你的打嗝代理。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nl"><img src="../Images/bb4a3f60e3804f193e6a184b99791965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-CLZnJlFK1RrAInLPiyKTg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">所有http/https都被拦截</figcaption></figure><p id="39f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，希望这个技巧可以成为绕过SSL锁定问题的替代方法。</p></div></div>    
</body>
</html>