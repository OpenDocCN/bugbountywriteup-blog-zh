<html>
<head>
<title>Continuous CTF challenge deployments using Github Workflows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github工作流的持续CTF挑战部署</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/continuous-ctf-challenge-deployments-using-github-workflows-aa8306fd58b6?source=collection_archive---------2-----------------------#2020-11-15">https://infosecwriteups.com/continuous-ctf-challenge-deployments-using-github-workflows-aa8306fd58b6?source=collection_archive---------2-----------------------#2020-11-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/55bd50fada12f87c871fbdd5466b54f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RpdCB8ssHVk6dpHL31rKbA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@yancymin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">扬西·敏</a>在<a class="ae kf" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="1ee5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di"> D </span> evOps是任何软件工程项目的重要方面。在这一点上，CTF挑战赛设计也不例外。能够在CTF挑战赛中持续推送更新，同时临时部署以供测试，这不仅可以实现更好的质量保证实践，而且还可以让作者在将更新发送给其他黑客进行测试时获得满足感(和吹嘘的权利)!</p><p id="88c4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，这篇文章提供了一个教程，介绍如何使用Github Workflows环境通过(ab)持续部署您的挑战。Github的<em class="ln">工作流</em>功能允许开发人员使用<em class="ln"> Github动作</em>作为构建模块，在受控环境中定义和运行工作流管道。实际上，GitHub免费提供了一个短暂的虚拟机来运行你的工作流。有趣的是，Github(或者我应该说……微软)已经慷慨地提供了6小时的工作流调用超时！现在，用于打包、部署和测试的大多数更常见的工作流的运行时间都不超过一小时。但是如果……我们充分利用这一工作流程时间来主持几个小时的挑战？然而，问题是，工作流环境不允许任何进入流量，所以即使我们在那里举办，人们如何访问挑战？嗯…可能有解决的办法…继续读下去。</p><h1 id="0deb" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">挑战设置</h1><p id="1bec" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">首先，你得创造一个挑战，对吗？希望您已经经历了挑战设计和实施的麻烦，因此您应该已经准备好了要部署的挑战！但如果不是，也没什么好担心的！您可以使用我为测试目的创建的<a class="ae kf" href="https://github.com/apogiatzis/pwn_test_chall" rel="noopener ugc nofollow" target="_blank">虚拟pwn挑战</a>来跟进。这是一个容器化的pwn挑战，它只是在任何成功的TCP连接上打印回“你好，朋友…”。</p><p id="c40c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在任何情况下，我都非常鼓励你总是用Docker来容器化你的挑战，这样你就可以完全控制你的代码运行的环境。关于如何做到这一点的细节超出了这篇文章的范围，因此，我相信你这样做是合适的。请随意调整挑战的代码，将您的挑战嵌入到dockerized环境中。</p><h1 id="0cfc" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">使用Ngrok的TCP隧道</h1><p id="d145" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">还记得上面说的问题吗？为了便于外部访问我们的工作流环境，我们可以使用一个极其方便的工具，叫做<a class="ae kf" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> ngrok </strong> </a>！通过Ngrok，我们可以绕过防火墙/NAT规则，将本地主机暴露给互联网，如下图所示:</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/3e6733177391c249676c73e7376ff268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fKwt0djeDQXhLaEt.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来源:<a class="ae kf" href="https://medium.com/better-programming/ngrok-make-your-localhost-accessible-to-anyone-333b99e44b07" rel="noopener">https://medium . com/better-programming/ngrok-make-your-localhost-accessible-to-any one-333 b 99 e 44 b 07</a></figcaption></figure><p id="0166" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果这听起来很有趣，我会鼓励你通过访问标题中给出的上述图像的原始帖子来探索进一步的细节。</p><p id="f497" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于Ngrok只允许注册会员免费使用TCP隧道(当然有一些限制),请点击这里<a class="ae kf" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank">https://ngrok.com/</a>注册一个Ngrok账户。登录后，您应该能够在Ngrok仪表板中找到授权令牌。</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/d5eaa3a92face1fedadb2b90b7d664b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7TMEuHxEE5AoIoR2I5NhA.png"/></div></div></figure><p id="5d04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意down，因为它将在接下来的步骤中使用。</p><h1 id="e3bb" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">部署工作流程</h1><p id="ab57" class="pw-post-body-paragraph kg kh it ki b kj mm kl km kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">现在我们有了一个工作容器化的挑战，需要通过在<code class="fe mx my mz na b">.github/workflows/ </code>目录中创建一个新的YAML文件来定义Github工作流。在<code class="fe mx my mz na b">.github/workflows/</code>中创建一个名为<code class="fe mx my mz na b">deploy.yaml</code>的新文件，并粘贴以下工作流定义:</p><figure class="ms mt mu mv gt ju"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="7f2f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的工作流定义中，我们定义了两个作业，每当在存储库中执行新的推送时，这两个作业将按顺序运行。<code class="fe mx my mz na b">cancel</code>作业是一个可选步骤，用于确保取消任何仍在运行的先前工作流，以避免同时运行多个工作流。更重要的是，<code class="fe mx my mz na b">deploy</code>的工作是所有奇迹发生的地方:</p><ol class=""><li id="eb19" class="nd ne it ki b kj kk kn ko kr nf kv ng kz nh ld ni nj nk nl bi translated"><strong class="ki iu">仓库已签出</strong></li><li id="30a6" class="nd ne it ki b kj nm kn nn kr no kv np kz nq ld ni nj nk nl bi translated"><strong class="ki iu">通过运行</strong> <code class="fe mx my mz na b"><strong class="ki iu">docker-compose up -d</strong></code> <strong class="ki iu">部署挑战。</strong>请注意，这里可以使用任何其他命令来部署您的挑战，但我总是尝试使用单个命令部署，因为这使过程变得容易得多。</li><li id="27fa" class="nd ne it ki b kj nm kn nn kr no kv np kz nq ld ni nj nk nl bi translated"><strong class="ki iu">运行一个定制的Github动作，该动作运行ngrok并通过隧道传输来自/去往端口4000的任何TCP流量。</strong>这是我最近发布的一个Github动作，抽象出了一些实现细节，但是如果你感兴趣，你可以在这里看到动作<a class="ae kf" href="https://github.com/apogiatzis/ngrok-tunneling-action" rel="noopener ugc nofollow" target="_blank">的完整源代码。</a></li></ol><p id="f503" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可能已经注意到了<strong class="ki iu">ngrok-tunneling-action</strong>中提供的参数，所以让我们花些时间来解释这些参数:</p><p id="5c45" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">超时:</strong>记住<code class="fe mx my mz na b">deploy</code>作业的隧道挖掘步骤被阻塞，这意味着如果不取消，工作流程将继续运行，直到超时6小时。当不需要全部6小时时，此参数允许您指定较短的超时时间。它接受许多时间单位，如秒或小时，即<code class="fe mx my mz na b">100s</code>、<code class="fe mx my mz na b">2h</code></p><p id="53f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">端口:</strong>这指定了流量将通过隧道传输到/来自的端口。这应该是您的挑战通过docker容器公开的端口。</p><p id="a60b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> ngrok_authtoken: </strong>这只是从前面的步骤中获得的ngrok授权令牌。当然，由于令牌不应该以纯文本形式显示，因此请通过导航到您的存储库设置- &gt;机密- &gt;新存储库机密，确保在您的存储库机密中定义了令牌</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/830b42688ffa159850b3609ad7783fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PPSd5o4CKSI3XeOTPAKnA.png"/></div></div></figure><p id="6e02" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们快完成了！现在，每当一个新的推送到达存储库时，这个工作流就应该被触发！如果一切按计划进行，你应该能够导航到你的Ngrok仪表板，并找到你的隧道的URL，可用于访问你的挑战！</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/f04cc8374d9af8775dc2fad2cece227a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Sb_e7bxUXhhlM-br08QIQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Ngrok tcp隧道</figcaption></figure><p id="dc0a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来测试一下吧！</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/bb8ec4f683a2680045043f30fa0d6817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wh1-XfkzSMUGd7iUzpuGCA.png"/></div></div></figure><p id="f6e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">厉害！作品如魅！您可以在这个资源库中找到这篇文章的完整代码:</p><div class="nu nv gp gr nw nx"><a href="https://github.com/apogiatzis/pwn-chall-auto-deployment" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd iu gy z fp oc fr fs od fu fw is bi translated">apogiatzis/pwn-chall-自动部署</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">在GitHub工作流环境中部署的测试pwn挑战Github是超过5000万开发人员的家园…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol jz nx"/></div></div></a></div><p id="1df3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">肯定还有很大的改进空间，所以你可以随意调整/扩展你喜欢的任何东西。请记住，工作流定义可以被修改，以便只有当一个新的发布被创建时才被触发，如果那更适合您的用例的话。</p><p id="e7cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">任何反馈总是非常感谢！</p></div></div>    
</body>
</html>