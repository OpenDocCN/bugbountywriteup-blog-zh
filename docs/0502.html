<html>
<head>
<title>Mobile Malware Analysis - Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移动恶意软件分析-书面报告</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/mobile-malware-analysis-writeup-by-josue-martins-5574865ae0f1?source=collection_archive---------1-----------------------#2020-02-29">https://infosecwriteups.com/mobile-malware-analysis-writeup-by-josue-martins-5574865ae0f1?source=collection_archive---------1-----------------------#2020-02-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="f4bd" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">恶意软件文件信息</h1><p id="4e4d" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">文件名:09024538768–1107749532 . apk</em></p><p id="540b" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj">大小:0.12MB </em></p><p id="03d3" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj">MD5:65a 92 BAE FD 41 EB 8 C1 a9 df 6 c 266992730</em></p><p id="0d84" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj">SHA1:117 a2 BDB 1550534 c 0945 DD 210 C2 e 9 B1 e 58 c 50431</em></p><p id="ad8d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj">sha 256:60 df 17 A8 d 53 BF 179 c 5025 ba F9 b 0 fbfc 9 BD C4 CFB 483 b 059 ab 2c 58 bfdf 375 c8 c 76</em></p><p id="d295" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> App名称:Roblox </em></p><p id="c435" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj">包名:com.lob.roblox </em></p><h1 id="78cf" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">恶意软件的静态分析</h1><p id="3a13" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">上述恶意软件是通过下载用户安装在智能手机上的恶意应用程序从移动网络中提取的。</p><p id="57a4" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir">应用程序是从下面的服务器分发的:</strong></p><p id="dbf8" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><a class="ae lp" href="http://173.255.243.60/public/silent_apk/2059/631023079870014__null__11880__v18_20151127/apk/2019/12/09024538768--1107749532.apk" rel="noopener ugc nofollow" target="_blank">http://173 . 255 . 243 . 60/public/silent _ apk/2059/631023079870014 _ _ null _ _ 11880 _ _ v18 _ 2015 11 27/apk/2019/12/09024538768-1107749532 . apk</a></p><h1 id="6ec8" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">ANDROID清单文件分析</h1><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/cf4c539de471be46aff19282d2502a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ON9CSIZ21mGXitRAkCQZrA.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">Android清单</figcaption></figure><p id="2432" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">阅读清单后，我注意到以下几点:</p><h2 id="7185" class="mg jo iq bd jp mh mi dn jt mj mk dp jx kw ml mm kb la mn mo kf le mp mq kj mr bi translated">恶意软件请求以下权限:</h2><p id="1114" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><uses-permission android:name="”android.permission.ACCESS_WIFI_STATE”/"/></p><p id="a636" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">— <em class="lj">让应用程序能够检查wifi的当前状态</em>。</p><h2 id="4b23" class="mg jo iq bd jp mh mi dn jt mj mk dp jx kw ml mm kb la mn mo kf le mp mq kj mr bi translated"><strong class="ak">以下所有权限都是危险权限，经常被恶意软件使用。</strong></h2><p id="99b9" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><uses-permission android:name="”android.permission.WRITE_EXTERNAL_STORAGE”/"/></p><p id="31d1" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —使应用程序能够写入外部存储器。</em></p><p id="4c1e" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><uses-permission android:name="”android.permission.INTERNET”/"/></p><p id="b00a" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —使应用程序能够连接到互联网并创建socks。</em></p><p id="18fd" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><uses-permission android:name="”android.permission.READ_PHONE_STATE”/"/></p><p id="ccee" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —使应用程序能够检查智能手机的当前状态以及智能手机的其他详细信息。</em></p><p id="ff11" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><uses-permission android:name="”android.permission.READ_EXTERNAL_STORAGE”/"/></p><p id="f1e0" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —使应用程序能够从外部存储器读取文件，如SDCARD等。</em></p><p id="9c7e" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><uses-permission android:name="”android.permission.MOUNT_UNMOUNT_FILESYSTEMS”/"/></p><p id="1cc4" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —使应用程序能够在设备上安装和卸载文件。</em></p><p id="cec0" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">只要看一下这段代码，我们就可以假设这个恶意软件想要从设备中读取和写入，并且它使用互联网。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/2c208c6a20d36d28bbf5cba3b6df784e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*kzRlBu-9n9E54Xmc9m6LPA.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">服务优先级</figcaption></figure><p id="4aaf" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">该应用程序还将此类“com.lob.roblox.TaskService”作为优先级为1000的服务运行。</p><p id="2dd7" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">这段代码"<strong class="kn ir"> <em class="lj"> &lt;【意向过滤Android:priority = " 1000 "&gt;</em></strong>"用于使服务在后台以高优先级运行。</p><h1 id="8d08" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">活性分析</h1><p id="2a45" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">正如我们从清单文件中看到的，我们可以看到主要的活动，让我们阅读java代码，看看它是如何工作的。</p><p id="b7c5" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><activity android:label="”@string/app_name”" android:name="”.MainActivity”"/></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/55c0b6350102e36a7097d846159d2bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*VmGkltq0UihXQIhuPcuDuw.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">主要活动</figcaption></figure><p id="0013" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">主活动启动TaskService类，并在智能手机的菜单上隐藏应用程序的图标。</p><p id="f9a7" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">下面的代码运行RobloxUtils类的一个实例，RobloxUtils类是恶意软件从智能手机中提取信息的地方。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/3c9634a74b0369442d9f723dce4fc20e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*g-exEdunYoZSuVOvOE_ElQ.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">任务服务</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/4007720d3aaf3505eff26a466ce970ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*qAfr6lHiweAZrWMljJYtZw.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">Cookie提取</figcaption></figure><p id="0d5e" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">查看代码的第一行，很明显是提取脸书应用程序的cookies。</p><p id="ff0d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">下面的代码用提取的信息创建了一个zip文件。</p><p id="d918" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">File file = new ZipUtils()。zipAllConfigFile(this.mContext，“file . zip”)；</p><p id="6522" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">这是用于将信息上传到在HttpUtils类中找到的服务器“<a class="ae lp" href="https://api-resource.youzicheng.net/api/exception/add" rel="noopener ugc nofollow" target="_blank">https://api-resource.youzicheng.net/api/exception/add</a>”的代码，这就是调用下面的方法的原因。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/946e8d134a8725eff565f5a5f325e371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*2aS0d-jKijT6HRIE4yvvZg.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">开始方法</figcaption></figure><p id="ad50" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi">HttpUtils.updateLog(“文件为空，没有收集到ZIP”, getSettingsAndroidId(this.mContext));</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/e1e8d8f104ca033bfeeac487faffd69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*rqWlX6r6Dpu5n4n98_94tw.png"/></div></figure><p id="441d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">ZipUtils用于从安装在智能手机上的浏览器中提取信息来创建zip文件，并通过以下方法(使用HttpUtils.updateLog())上传到黑客的服务器。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/2f3c32a4faa157941d7ef2d18d4107f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*wWYRortaVZBhKHL4BNIskQ.png"/></div></figure><p id="7b17" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">HttpUtils类在将信息上传到攻击者的服务器之前检查是否有连接，该服务器已经被声明为私有静态最终变量“【https://api-resource.youzicheng.net/api/exception/add】<a class="ae lp" href="https://api-resource.youzicheng.net/api/exception/add" rel="noopener ugc nofollow" target="_blank"/>”。</p><h1 id="ffd3" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">概述静态分析</h1><p id="ac2f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">恶意软件使用的主要java类有:</p><ol class=""><li id="8fcc" class="my mz iq kn b ko lk ks ll kw na la nb le nc li nd ne nf ng bi translated">com/lob/roblox/HttpUtils.java</li></ol><p id="1ff0" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —这个类用来与服务器通信。</em></p><p id="906c" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">2.com/lob/roblox/main activity . Java</p><p id="50d1" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —这是启动应用程序的主要活动。</em></p><p id="c6a7" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">3.com/lob/roblox/robloxutils . Java</p><p id="6ca6" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —这个类用于将提取的信息上传到服务器(C &amp; C)。</em></p><p id="1751" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">4.com/lob/roblox/task service . Java</p><p id="3268" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —这是服务的绑定器类。</em></p><p id="2033" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">5.com/lob/roblox/ZipUtils.java</p><p id="a844" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —这是一个用提取的信息创建zip文件的类，它还能够上传文件。</em></p><p id="b043" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">6.com/sdk/def/DefSdk.java</p><p id="4548" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —这是一个运行命令的助手类。</em></p><p id="10d4" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">7.com/sdk/def/EXPSDK.java</p><p id="2059" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="lj"> —这是提取设备信息的类，比如IMSI、智能手机品牌等等。</em></p><h1 id="8666" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="23fc" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这种恶意软件从脸书应用程序和安装在智能手机上的浏览器中提取cookies。除了提取cookie之外，它还提取设备的标识符和SIM(即智能手机的品牌、SDK版本号和IMSI ),以便正确关联信息。</p><p id="8d63" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">应尽快在您的网络中阻止上述C&amp;C，因为提取的信息可用于各种恶意行为，如出售用户信息、利用IMSI作为参数进行各种SS7和DIAMETER协议攻击。</p></div></div>    
</body>
</html>