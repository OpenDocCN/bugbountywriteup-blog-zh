<html>
<head>
<title>flipkart’s CTF @ nullcon’18 [writeup]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">flipkart的CTF @ nullcon ' 18[特写]</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/flipkarts-ctf-nullcon-18-writeup-452b4e108fb?source=collection_archive---------0-----------------------#2018-03-05">https://infosecwriteups.com/flipkarts-ctf-nullcon-18-writeup-452b4e108fb?source=collection_archive---------0-----------------------#2018-03-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9f15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Web 1:(旅行者)</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/5cb2545eea4cad9686617cb5215d7ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJD94DfJrLyLqabKymUDNA.png"/></div></div></figure><p id="a626" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是第一次网络挑战赛的任务。<em class="kx">【从这里开始旅程】</em>的链接登陆如下页面。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/a6f4c4ee6cea0b4244984494feacaadc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0j9Eq2FXG_Z8-hgbACLlbA.png"/></div></div></figure><p id="5cc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在检查点击下载按钮后触发的请求时，显然这是一个路径遍历挑战。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kz"><img src="../Images/51461c5ebd925d4302a286479d43154d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KIMcSE2AkBKF6ujg7hvkeg.png"/></div></div></figure><p id="5273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向下滚动到页面底部时，标记位置被添加了注释。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi la"><img src="../Images/10740151ab007431266691a5d2fd8836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*oOFK5UkH0oANYoJBXde6jg.png"/></div></figure><p id="4a1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以想法是使用路径遍历攻击到达<em class="kx"> ctf </em>目录下的<em class="kx">标志文件</em>。但是扭曲正是我们需要操纵参数的地方。</p><p id="a238" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最初试图操作filename参数，</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lb"><img src="../Images/85555080d79da2bd9687e2fc1d92e87c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fIz5B4xx2VKsDNpkr6UULQ.png"/></div></div></figure><p id="c56c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但如果参数包含<strong class="jp ir"> "/ctf" </strong>或"<strong class="jp ir">.. "则返回beep</strong>。试着编码这些东西。但是失败了。稍后检查请求上的<strong class="jp ir"> x用户</strong> cookie。更改cookie时返回完整性检查失败</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lc"><img src="../Images/612bf0983c1064774371ec4ec0f37dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GUmlBbVclXVr038RaXRTzg.png"/></div></div></figure><p id="6199" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原来如此！以下是xuser cookie的结构:</p><p id="3c37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">x-用户:<filename> - <md5/></filename></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ld"><img src="../Images/fbf194e6c4ec99f036ec683b2c4f68be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60eoTr3VddDHYeEUuiD45g.png"/></div></div></figure><p id="304d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以尝试用<strong class="jp ir">遍历文件路径../../../../../../../../../ctf/flag </strong>。但是他们去掉了“..”后面的“/”</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi le"><img src="../Images/369cea56b3bc0eae954a5fffc2eade52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OkV2tWfTIRl2B526h8VcQ.png"/></div></div></figure><p id="c073" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在同一个有效载荷上尝试了“/”的双重编码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lf"><img src="../Images/5ecf75a4477dedf16753983d1ca0ca37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ehv8AykfDLCvzejDPFShUA.png"/></div></div></figure><p id="7160" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哦耶！我们拿到旗子了😎</p><p id="dd5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Web 3:(抢旗)</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lg"><img src="../Images/36e581e7be3859d42d941ea093b99fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y13q7FKkkE8x9QtGlMQiwg.png"/></div></div></figure><p id="c378" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以这有点像SSRF的弱点。该链接位于以下页面</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lh"><img src="../Images/11c5d6321d78c5b77c8c32b12428efba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ka0Jwd30nDqpu5PtNy63DQ.png"/></div></div></figure><p id="686a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">任务是在同一个web根目录下读取“flag.php”。但是当从浏览器直接访问时会被阻止(这就是任务)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi li"><img src="../Images/0137e31928f6ef503f27babcf3a957d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F7FBaRKMlViNsFGdJOSlsw.png"/></div></div></figure><p id="ec64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以在获取URL上尝试了<a class="ae lj" href="http://127.0.0.1/flag.php" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1/flag . PHP</a>，它返回了以下内容。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lk"><img src="../Images/8b915304aaa4b5df5f666090fb686309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*673GIoEz0yzSn6bwZlqFzg.png"/></div></div></figure><p id="2719" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以干脆用0.0.0.0代替127.0.0.1地狱耶！成功了😎我们拿到旗子了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ll"><img src="../Images/14072918fecf14523afc8f4c00bbdd15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LcF-5e4Xj8-ykgTqOGPC9g.png"/></div></div></figure><blockquote class="lm ln lo"><p id="c783" class="jn jo kx jp b jq jr js jt ju jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj kk ij bi translated">你真的认为会那么容易吗？</p></blockquote><p id="7817" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不，但它是😂 😂</p><p id="26e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢挑战flipkart安全团队！</p><p id="d8d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-H4 ckx 0 r 5团队</p></div></div>    
</body>
</html>