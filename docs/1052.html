<html>
<head>
<title>Remote Code Execution Through Cross-Site Scripting In Electron Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过电子应用程序中的跨站点脚本远程执行代码</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/remote-code-execution-through-cross-site-scripting-in-electron-f3b891ad637?source=collection_archive---------0-----------------------#2021-01-05">https://infosecwriteups.com/remote-code-execution-through-cross-site-scripting-in-electron-f3b891ad637?source=collection_archive---------0-----------------------#2021-01-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="956b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><a class="ae ki" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-35717" rel="noopener ugc nofollow" target="_blank">CVE-2020–35717</a>—RCE通过XSS在<a class="ae ki" href="https://www.electronjs.org/apps/zonote" rel="noopener ugc nofollow" target="_blank"> zonote </a>电子App</h2></div><p id="9f91" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">对于那些不熟悉这个术语的人来说，<em class="lf"> CVE </em>代表<em class="lf">共同的脆弱和暴露。</em>每个<em class="lf"> CVE </em>记录都包含一个标准标识符、一个简要描述以及相关漏洞报告和咨询的参考。<a class="ae ki" href="https://cve.mitre.org/cve/" rel="noopener ugc nofollow" target="_blank"><em class="lf">MITRE</em></a>corporation保存了一份记录所有公开披露的漏洞的列表，可以免费使用。</p><p id="1159" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><em class="lf"> CVE </em>列表提供给<em class="lf">美国国家漏洞数据库(</em><a class="ae ki" href="https://nvd.nist.gov/" rel="noopener ugc nofollow" target="_blank"><em class="lf">NVD</em></a><em class="lf">)</em>，该数据库还提供了每个<em class="lf"> CVE </em>的分数。这个分数(称为<a class="ae ki" href="https://www.first.org/cvss/specification-document" rel="noopener ugc nofollow" target="_blank"> <em class="lf">、CVSS </em> </a>)分为三类——基础、时间和环境——并定义了漏洞的影响。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/1867fb3b0d84dd53f2821ddd6bc8bfa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JaVSdfkVOaV6ujvu"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">一直想提交一张我发现的CVE——图片由<a class="ae ki" href="https://unsplash.com/photos/JJPqavJBy_k" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>提供</figcaption></figure><p id="4a47" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><a class="ae ki" href="https://github.com/zonetti/zonote" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> zonote </em> </a>是一款跨平台的桌面笔记app。虽然最基本的用途是保存一个简单的文本注释，但是你可以使用<em class="lf"> Markdown </em>代码或者嵌入任何种类的<em class="lf"> HTML </em>。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="lw lx l"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">任何一种<em class="ly"> HTML </em>？🤔</figcaption></figure><p id="17ca" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">这最后一个事实让我想到<em class="lf"> zonote </em>是否容易受到<em class="lf">跨站脚本的攻击。跨站脚本</em>或<em class="lf"> XSS </em>是web应用中最常见的漏洞之一，在<a class="ae ki" href="https://owasp.org/www-project-top-ten/" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> OWASP十大Web应用安全风险</em> </a>中排名第七。</p><p id="5749" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">一次<em class="lf"> XSS </em>攻击包括执行攻击者注入的任意<em class="lf"> JavaScript </em>代码，而<a class="ae ki" href="https://owasp.org/www-community/attacks/xss/" rel="noopener ugc nofollow" target="_blank"> OWASP </a>定义如下:</p><blockquote class="lz ma mb"><p id="f139" class="kj kk lf kl b km kn ju ko kp kq jx kr mc kt ku kv md kx ky kz me lb lc ld le im bi translated">跨站脚本(XSS)攻击是一种注入，其中恶意脚本被注入到良性和可信的网站中。</p><p id="1fa2" class="kj kk lf kl b km kn ju ko kp kq jx kr mc kt ku kv md kx ky kz me lb lc ld le im bi translated">当攻击者使用web应用程序向不同的最终用户发送恶意代码(通常以浏览器端脚本的形式)时，就会发生XSS攻击。</p></blockquote><h2 id="9f19" class="mf mg it bd mh mi mj dn mk ml mm dp mn ks mo mp mq kw mr ms mt la mu mv mw mx bi translated">剥削</h2><p id="2a97" class="pw-post-body-paragraph kj kk it kl b km my ju ko kp mz jx kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">在互联网上有很多参考资料，你可以找到<a class="ae ki" href="https://github.com/payloadbox/xss-payload-list" rel="noopener ugc nofollow" target="_blank"><em class="lf"/>XSS【有效载荷】</a>，所以这是一个非常简单的攻击。</p><pre class="lh li lj lk gt nd ne nf ng aw nh bi"><span id="fc89" class="mf mg it ne b gy ni nj l nk nl"><em class="lf">// Simple XSS payload</em><br/>&lt;a onmouseover="alert('Hi!')"&gt;<br/>  HOVER ME<br/>&lt;/a&gt;</span></pre><p id="6a90" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为了测试<em class="lf"> zonote </em>是否容易受到这种攻击，我创建了一个新的笔记，并插入了我最喜欢的<em class="lf"> XSS </em>有效负载之一，当用户悬停在一个链接上时，它会执行一些代码。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nm"><img src="../Images/b050b623bf261025f363effcf75ddcb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*lSvPx08V5MDZL5V5wZ69RQ.gif"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">XSS有效载荷内部的警报被成功执行，证实了zonote易受XSS攻击</figcaption></figure><h2 id="32ae" class="mf mg it bd mh mi mj dn mk ml mm dp mn ks mo mp mq kw mr ms mt la mu mv mw mx bi translated">将XSS攻击升级为远程代码执行攻击</h2><p id="5818" class="pw-post-body-paragraph kj kk it kl b km my ju ko kp mz jx kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">这个发现之后，我想到的第一个问题是:</p><blockquote class="nn"><p id="5f77" class="no np it bd nq nr ns nt nu nv nw le dk translated">这是个大问题吗？</p></blockquote><p id="29d8" class="pw-post-body-paragraph kj kk it kl b km nx ju ko kp ny jx kr ks nz ku kv kw oa ky kz la ob lc ld le im bi translated">当然这是一个问题，但是<em class="lf"> XSS </em>攻击非常普遍，它们的威力<em class="lf">通常</em>受限于它们被执行的范围。但是<em class="lf"> zonote </em>是一个<em class="lf">电子</em> app，正如<a class="ae ki" href="https://www.electronjs.org/docs/tutorial/security" rel="noopener ugc nofollow" target="_blank">电子<em class="lf">安全文档</em></a>中指出的:</p><blockquote class="lz ma mb"><p id="751d" class="kj kk lf kl b km kn ju ko kp kq jx kr mc kt ku kv md kx ky kz me lb lc ld le im bi translated">如果攻击者能够跳出渲染器进程并在用户计算机上执行代码，那么跨站点脚本(XSS)攻击就更加危险。</p><p id="934c" class="kj kk lf kl b km kn ju ko kp kq jx kr mc kt ku kv md kx ky kz me lb lc ld le im bi translated">禁用Node.js集成有助于防止XSS升级为所谓的“远程代码执行”(RCE)攻击。</p></blockquote><p id="8c18" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">因此，如果启用了Node.js 集成，这可能会更加有害。因为我可以访问代码，所以搜索属性<em class="lf"> nodeIntegration </em>很简单。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi oc"><img src="../Images/934a9a83f7e6afbc14fe43a4ccf349f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*JCD2pKGJ8vsggPGoU5H50Q.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">允许完全访问<em class="ly"> Node.js API的属性被设置为true </em>，打开了<em class="ly">远程代码执行</em>的大门</figcaption></figure><p id="6f00" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在确认<em class="lf"> Node.js </em>集成被启用后，我可以稍微修改一下之前的<em class="lf"> XSS </em>有效载荷，要求<a class="ae ki" href="https://www.electronjs.org/docs/api/shell" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> shell </em> </a>模块在<em class="lf">电子</em>中，并查看暴露的方法列表。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nm"><img src="../Images/df0a94cc983ce7180e444527f6be098d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FTFGr_JLIgvZQjtT9O6wng.gif"/></div></div></figure><p id="1de5" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">此时，我们已经确认通过<em class="lf"> XSS </em>访问<em class="lf"> Node.js API </em>是可能的。作为<em class="lf">远程代码执行</em>的简单<em class="lf">概念验证</em>，我们可以打开<em class="lf">计算器</em> app。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nm"><img src="../Images/dd350a3e8abd232e28ad9bda44f37a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gFtHgAgsjhVy0kkk0GmTdA.gif"/></div></div></figure><p id="c416" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">最后，为了确认该漏洞是跨平台可利用的，我只导出了一个带有<em class="lf"> XSS </em>有效载荷的笔记，以打开<em class="lf"> Windows </em>计算器，并将其导入到<em class="lf"> Windows </em> <em class="lf"> OS </em>中。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi od"><img src="../Images/b7b9285c6b6f5654c2990a75e51cd6b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*dM8wLlSBxJSel03J5Hllag.gif"/></div></div></figure><h2 id="5526" class="mf mg it bd mh mi mj dn mk ml mm dp mn ks mo mp mq kw mr ms mt la mu mv mw mx bi translated">漏洞的影响</h2><p id="9db0" class="pw-post-body-paragraph kj kk it kl b km my ju ko kp mz jx kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">用于演示目的的<em class="lf"> XSS </em>有效负载需要用户交互才能执行，但是我们可以使用另一个有效负载，它会在注释被处理后立即执行。</p><p id="aa77" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们已经将calculator应用程序作为<em class="lf">远程代码执行</em>的<em class="lf"> PoC </em>打开，但是我们可以执行一个有效载荷来获得对受害者系统的远程访问。因此，此漏洞对机密性、完整性和可用性的影响应被视为很高。</p><h2 id="ff1e" class="mf mg it bd mh mi mj dn mk ml mm dp mn ks mo mp mq kw mr ms mt la mu mv mw mx bi translated">披露时间表</h2><ul class=""><li id="d6ea" class="oe of it kl b km my kp mz ks og kw oh la oi le oj ok ol om bi translated">2020–12–26发现问题并联系业主</li><li id="b90a" class="oe of it kl b km on kp oo ks op kw oq la or le oj ok ol om bi translated">2020–12–26所有者表达了既不维护存储库也不修复漏洞的意图</li><li id="4ede" class="oe of it kl b km on kp oo ks op kw oq la or le oj ok ol om bi translated">2020–12–26保留的CVE标识符<a class="ae ki" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-35717" rel="noopener ugc nofollow" target="_blank">CVE-2020–35717</a></li><li id="ebe2" class="oe of it kl b km on kp oo ks op kw oq la or le oj ok ol om bi translated">2021–01–01公开披露漏洞</li></ul></div></div>    
</body>
</html>