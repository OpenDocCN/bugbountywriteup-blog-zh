<html>
<head>
<title>The Cod Caper Tryhackme Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">鳕鱼雀跃试跳演练</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/the-cod-caper-tryhackme-walkthrough-e4e92e760e0c?source=collection_archive---------1-----------------------#2020-07-10">https://infosecwriteups.com/the-cod-caper-tryhackme-walkthrough-e4e92e760e0c?source=collection_archive---------1-----------------------#2020-07-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/93a65ea4c652f4f77c33b281122ad87e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UejP4dq7uJ7CFibiQUd8wg.png"/></div></div></figure><p id="0cc5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我们将解决来自Tryhackme的Cod Caper room。</p><h2 id="8633" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">主机枚举</h2><p id="75c8" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">因此，我们首先从Nmap扫描开始，以查看打开的端口和机器上正在运行的服务。</p><blockquote class="lu lv lw"><p id="a197" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">我们用来扫描目标机器的标志</p><p id="69cf" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">"-P1–1000 "用于指定要检查的端口。</p><p id="9701" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">"-sC "在端口上运行默认脚本。“-A”攻击性模式，试图获取尽可能多的信息。</p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/bf0b9a1413f94d857c2327e34e151670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*hJWe37H0ccymWPR1z2VwuQ.png"/></div></figure><p id="2f4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目标计算机上有两个开放的端口，我们可以看到“ssh”服务版本、web服务器版本。</p><h2 id="4b8e" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">Web枚举</h2><p id="b9bf" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">端口80是打开的，所以我们在浏览器中检查。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/dd042df9a3e580904ceb9e9ca8bb2bd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vfm54VXzsjW_J6aF3xrOww.png"/></div></div></figure><p id="ebad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Apache的默认网页就在那里，所以我们可以尝试从“gobuster”工具中获取目录。</p><blockquote class="lu lv lw"><p id="d683" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">我们使用的标志:</p><p id="ee31" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">“— URL”来指定URL</p><p id="6724" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">“—单词列表”单词列表的路径</p><p id="2050" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">“-x”指定文件扩展名</p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/8be06ba34e2d3689d3205165bff48aec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bfCCbrv2VVUEvLe-thAIzg.png"/></div></div></figure><h2 id="f311" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">网络开发</h2><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/b0258b83ee0f4248c4be0ed9cbe66f58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*VsoHYuFrkUtt5HiN04sG3g.png"/></div></figure><p id="22a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到了管理员登录页面，但我们没有登录的凭证，所以我们尝试使用“sqlmap”工具做SQL注入。</p><blockquote class="lu lv lw"><p id="1147" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">我们使用的旗帜</p><p id="faff" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">“-u”来指定URL。</p><p id="f56a" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">"— forms "来自动选择参数。</p><p id="4a0d" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">“—转储”以在找到SQLI后获取数据。</p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/90452f29bd81571f87541a0e44f2b61a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*rldTuQnZaOZS_vX6BGv8Yg.png"/></div></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/a591c563ba86cac160f251562fb6af8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*JbApm-TcAArVMEACE-FJig.png"/></div></figure><h2 id="34bc" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">命令执行</h2><p id="de0a" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">我们得到了登录的用户名和密码</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/cfbdf894a0bb91b21485e847b9d63fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*6kIWaQUgsBpAsO8PZy7CYw.png"/></div></figure><p id="ee0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">登录后，我们有一个命令提示，似乎我们已经有能力运行命令。我们执行了一个命令“id ”,我们得到了正确的结果，所以我们尝试执行<a class="ae mm" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" rel="noopener ugc nofollow" target="_blank"> python reverse </a> shell。在执行完命令后，我们得到了一个reverse shell。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/959068b9e7fa2f65880ce328838e48ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*ddoRhG-p58AwVp4Om1KjEA.png"/></div></figure><p id="b280" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们使用这个命令来检查用户的CD/home；ls "</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/cc97a41922e1df8bb9f40b8cfb3a62c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:514/format:webp/1*ayXpuXYWOzoCk4lYRhreJw.png"/></div></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/ae4e4fa1b23cf784b28b60d3cf4e0307.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*2JlBg7kBQRaiBHikLWGxYg.png"/></div></figure><p id="e539" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们有两个用户，现在我们必须找到用户Pingu的密码</p><blockquote class="lu lv lw"><p id="21dc" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">find/-用户" www-data "-名称" *" 2&gt;/dev/null</p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/6402d7eb6766add818e10929f44c5630.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*rjPBKN58LhGzRPEZr6FPQg.png"/></div></figure><p id="c97f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">执行该命令后，我们发现密码存储在/var/hidden/pass中</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/7e843716d3732cbbb28e0c6d77ce1d45.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*ANFPY2llpt31t92GXkhFcQ.png"/></div></div></figure><p id="c0a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在获得了位于“/home/pingu/中的文件后，我们获得了Pingu的SSH的密码。ssh/id_rsa "</p><p id="04c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将我们保存为“ssh_key”的“id_rsa”文件内容复制并保存在您的桌面上</p><p id="711d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以现在我们可以通过SSH登录</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/4af8e96b6767bea04d48a661d53ce758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*ZaJ_BqYiDtU78I_ZHFtKJg.png"/></div></figure><p id="68f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们以用户Pingu的身份登录。现在，我们检查了特权，但我们什么也没有，所以我们检查了“SUID”二进制文件。</p><blockquote class="lu lv lw"><p id="ef0a" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">find/-perm-u = s-type F2 &gt;/dev/null</p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/107d0321cf196e7e083c24fb2cc4d820.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*EYhp0F153kfmVyX7pBrEoQ.png"/></div></figure><p id="6a0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们发现了一个有趣的文件“/opt/secret/root ”,正如Tryhackme中所解释的，这个文件期望输入32个字符，现在我们使用“gdb”来分析。</p><p id="8ced" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行“gdb /opt/secret/root ”,您应该会看到这样的结果</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/0849f015896c2deea73f4e40ec266662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*RL2nQWSmmZimGX_IWHs2Hw.png"/></div></figure><p id="f5ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一个过程是检查当我们发送超过32个字符时是否发生了什么，因此要这样做，请键入“r &lt; </p><p id="2380" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行该命令后，您会看到类似这样的内容</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/1fe01527236b268439eb6a009265be6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gsphZiKQmuS_f3_8U-SIQw.png"/></div></div></figure><p id="414e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">似乎我们已经改写了EIP。EIP是一个指导指针，它告诉程序接下来要执行哪个内存位，我们可以覆盖它，这样我们就可以执行程序的任何部分。回想一下源代码中的shell函数，如果我们可以重写EIP来指向shell函数，我们就可以让它执行。回想一下，循环输入是4个字符/字节序列，我们能够准确地找到在覆盖EIP之前我们想要提供多少个字符。</p><p id="1129" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Cyclic使用“-l”标志来提供这种质量，运行“cyclic -l 0x6161616c”将告诉我们要提供多少字符来覆盖EIP。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/c3014303022b72d52b27b3c256ac2e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*f3oj2gx52sb9iLKyIbdZjQ.png"/></div></figure><p id="ba38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以用44个字符覆盖EIP。</p><p id="4a69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们必须找出shell函数在内存中的位置，这样我们就知道要把EIP设置成什么了。GDB支持这一点，也“拆解”命令。</p><p id="cb49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">输入“拆卸外壳”</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2d2bbe540b08ae14fa379d200c7d5282.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*afSRTr0ozR9PtbdfJp9Spg.png"/></div></figure><p id="1ec8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们对十六进制内存地址感兴趣，我们知道在shell函数应该执行之后，我们必须输入44个字符和“0x080484cb”。</p><p id="7aca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:-现代CPU架构是“小端”的，意味着字节是向后的。例如“0x080484cb”将变成“cb840408 ”,我们可以用python来实现。</p><p id="c74c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">输入退出</p><p id="0282" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和类型</p><blockquote class="lu lv lw"><p id="d0ab" class="jy jz lx ka b kb kc kd ke kf kg kh ki ly kk kl km lz ko kp kq ma ks kt ku kv ij bi translated">python-c ' print " A " * 44+" \ xcb \ x84 \ x04 \ x08 " '</p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/54f1261b7a297660d81310428f0a4cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6fJYVMakxxERS8wZV7bNEg.png"/></div></div></figure><p id="36ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们做到了！</p><p id="86c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了散列中的密码，所以您可以使用“hashcat”来破解它。</p><p id="287c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">黑客快乐！</p><p id="0bb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">推特- <a class="ae mm" href="https://twitter.com/akshaykerkar13" rel="noopener ugc nofollow" target="_blank">阿克谢·卡卡尔</a></p></div></div>    
</body>
</html>