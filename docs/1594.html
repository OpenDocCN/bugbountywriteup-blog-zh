<html>
<head>
<title>Windows Threat Hunting : Processes of Interest (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Windows威胁追踪:感兴趣的进程(第2部分)</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/windows-threat-hunting-processes-of-interest-part-2-b45d6fcd4e9?source=collection_archive---------0-----------------------#2021-09-27">https://infosecwriteups.com/windows-threat-hunting-processes-of-interest-part-2-b45d6fcd4e9?source=collection_archive---------0-----------------------#2021-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d123" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">常见Windows进程以及黑客如何恶意使用它们的列表</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/7865a541776bc839e3e7ceea7b260ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oBrhQK9GA3-W86qmeGcQYg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">(来源:<a class="ae kv" href="https://www.google.co.in/url?sa=i&amp;url=https%3A%2F%2Fwww.pinterest.com%2Fpin%2F516647388497512938%2F&amp;psig=AOvVaw1zSt8fwysjPo-IOj3uVsV_&amp;ust=1632730140732000&amp;source=images&amp;cd=vfe&amp;ved=0CAsQjRxqFwoTCMj42vSXnPMCFQAAAAAdAAAAABAz" rel="noopener ugc nofollow" target="_blank"> 1920 × 1080 </a>)</figcaption></figure><p id="c48d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将继续我们在<a class="ae kv" href="https://inf0spec.medium.com/windows-threat-hunting-processes-of-interest-4577fe35d32f" rel="noopener"> <strong class="ky ir"> <em class="ls">第1部分</em> </strong> </a>中列出的进程，并讨论一些更合法的Windows进程及其恶意用例，以及一些有助于侦察的替代方法和进程。</p><h2 id="3108" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/vssadmin" rel="noopener ugc nofollow" target="_blank"> vssadmin </a></h2><p id="5d2d" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">vssadmin是一个内置的Windows实用程序，用于管理计算机上存储文件的卷影副本。这些卷影副本用作备份，有助于在数据丢失的情况下恢复损坏的文件。勒索软件攻击旨在通过加密系统上的数据和文件，然后索要赎金来释放对数据的控制，从而劫持对这些数据和文件的访问。拥有文件和数据的最新备份会阻碍攻击者的目标，因为数据很容易恢复。这就是为什么在勒索病毒活动中，攻击者试图使用vssadmin删除这些备份和卷影副本，以便受害者无法恢复文件。</p><p id="9f75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">检测方法:</strong>监控<code class="fe mr ms mt mu b">vssadmin delete shadows</code>等卷影副本删除命令有助于检测勒索软件攻击。</p><h2 id="8918" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec" rel="noopener ugc nofollow" target="_blank"> psexec </a></h2><p id="6c77" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">psexec是一个独立的Windows实用程序，允许在远程系统上执行进程，并提供对远程主机上程序的交互式访问。对手经常滥用<em class="ls"> psexec </em>在网络内进行横向移动，并在网络上的其他机器上执行命令。下面是<em class="ls"> psexec的用法示例。</em></p><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="472f" class="lt lu iq mu b gy mz na l nb nc">psexec \\192.168.0.26 ipconfig /all <em class="ls">(Run command on remote host)</em></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/55c571ed49d19de12535ca038e9f4d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKNokjEWvFMQHRfKrZa97Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">工作流-启动psexec服务(来源:<a class="ae kv" href="https://assets.extrahop.com/images/blogart/psexec/workflow-launching-psexec.jpg" rel="noopener ugc nofollow" target="_blank">工作流-启动-psexec </a>)</figcaption></figure><p id="3989" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">检测方法:</strong>监控远程服务创建的Sysmon事件和系统日志— psexesvc事件(代码:7045)</p><h2 id="455b" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks" rel="noopener ugc nofollow" target="_blank">施塔克斯</a>和<a class="ae kv" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/at" rel="noopener ugc nofollow" target="_blank">在</a></h2><p id="f037" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated"><em class="ls">位于</em>的schtasks 和<em class="ls">是Windows命令行实用程序，用于在Windows系统上创建和管理计划任务。对手可以使用计划任务来保持持久性，并可以通过执行计划任务来保持访问。任务计划程序还允许在特定用户环境下创建任务，并可用于权限提升。计划任务是Windows操作系统不可或缺的一部分，不能关闭或阻止。由于这个原因，恶意任务通常会与各种其他必要的合法计划任务混合在一起。</em></p><p id="d72c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">检测方法:</strong>通过Windows事件日志监控计划任务的创建、修改、删除和使用。<em class="ls">PowerShell Get-scheduled task</em>可用于使用PS remoting从多个远程主机收集和检查计划任务列表。</p><h2 id="2f1b" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmic" rel="noopener ugc nofollow" target="_blank"> wmic </a></h2><p id="d2e1" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated"><em class="ls"> wmic </em>代表Windows管理规范命令，为WMI提供命令行界面，用于管理本地和远程Windows机器。它的功能包括显示系统设置、控制进程和执行脚本。它可以用于提取有关计算机的信息，也可以进行配置更改。它的特征可以被威胁者滥用于横向移动、发现和持续。</p><p id="29d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">检测方法:</strong>监控WMI活动日志(事件ID 5861)</p><h2 id="0186" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">尤蒂尔曼</h2><p id="b0ea" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated"><em class="ls">当点击登录屏幕上的“轻松访问”按钮时，utilman.exe</em>启动。默认情况下，utilman以完全管理员权限执行。攻击者可以利用这一点，将System32文件夹中的utilman.exe可执行文件替换为cmd.exe，这将允许攻击者只需单击锁定屏幕上的轻松访问按钮，就可以使用管理员权限启动<em class="ls"> cmd </em>。通过这种访问，可以更改密码、创建新用户并赋予管理员权限等。这对Windows系统构成了严重威胁，并允许绕过身份验证。可以看一个<a class="ae kv" href="https://www.eventsentry.com/videos/Final.mp4" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">攻击模拟</strong> </a> <strong class="ky ir"> </strong>更好的了解。</p><p id="f8b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">检测方法:</strong>监控System32文件夹中文件的更改以及对<em class="ls">utilman.exe</em>的任何修改</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="c49c" class="nl lu iq bd lv nm nn no ly np nq nr mb jw ns jx me jz nt ka mh kc nu kd mk nv bi translated">其他代码执行替代方案:</h1><h2 id="b86c" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wscript" rel="noopener ugc nofollow" target="_blank">脚本</a>和<a class="ae kv" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/cscript" rel="noopener ugc nofollow" target="_blank">脚本</a></h2><p id="ded5" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated"><em class="ls"> wscript </em>是Windows脚本宿主。它可以用来执行各种语言的脚本。<br/> <em class="ls"> cscript </em>是一个命令行工具，可以用来触发脚本，它有许多脚本参数，可以指定这些参数来定义脚本将如何执行。cscript和wscript的不同之处在于，cscript是一个纯命令行工具，而wscript也可以提供交互式输出。它们主要被攻击者用来运行恶意的Javascript或VBscript，因为它们是内置的合法工具，如果目标环境中的检测方法不考虑它们的使用，它们可能会被规避。</p><h2 id="c233" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/compiler-options/" rel="noopener ugc nofollow" target="_blank">csc.exe</a></h2><p id="2fa7" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated"><em class="ls"> csc </em>是一个内置的命令行工具，可以用来编译C#代码，然后作为<em class="ls">执行。exe </em>或<em class="ls">。dll </em>文件。攻击者可以利用它来绕过原本不允许代码执行的防范措施。下面是一些使用方法的例子。</p><pre class="kg kh ki kj gt mv mu mw mx aw my bi"><span id="db3b" class="lt lu iq mu b gy mz na l nb nc"><strong class="mu ir">csc -out:code.exe filename.cs</strong> (Compile filename.cs<!-- --> and output to an executable<!-- -->)</span><span id="ebff" class="lt lu iq mu b gy nw na l nb nc"><strong class="mu ir">csc -target:library filename.cs</strong> (Compile filename.cs<!-- --> and output to a dll file<!-- -->)</span></pre></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="4829" class="nl lu iq bd lv nm nn no ly np nq nr mb jw ns jx me jz nt ka mh kc nu kd mk nv bi translated">有助于侦查的流程:</h1><h2 id="05c7" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/whoami" rel="noopener ugc nofollow" target="_blank"> whoami </a></h2><p id="98c8" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">whoami命令返回关于当前登录到系统的用户及其权限的信息。攻击者通常使用whoami来发现用户和验证提升的权限。</p><h2 id="1217" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">系统信息</h2><p id="2c58" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">systeminfo命令显示关于系统的许多信息，如IP地址、操作系统名称和版本、域名等。这对于攻击者收集信息和枚举以计划横向移动是有用的。</p><h2 id="d9b6" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc732101(v=ws.11)" rel="noopener ugc nofollow" target="_blank"> csvde </a></h2><p id="776f" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated"><em class="ls"> csvde </em>是一个命令行实用程序，允许从活动目录服务导入和导出数据。这对于信息收集以及用户和域发现来说是一个有用的工具。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="87bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有太多这样的合法程序可以被伪装成恶意程序使用。了解这些可以帮助我们更好地识别威胁，拥有一个描述这些威胁的列表可以证明是有帮助的。请提供反馈，并让我知道是否有更多的流程可以添加到此列表中。</p><h2 id="069a" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">感谢阅读！:)</h2></div></div>    
</body>
</html>