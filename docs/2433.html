<html>
<head>
<title>EXPLOITING OS COMMAND INJECTION VULNERABILITIES</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用操作系统命令注入漏洞</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/exploiting-os-command-injection-vulnerabilities-14195c9a410b?source=collection_archive---------0-----------------------#2022-10-09">https://infosecwriteups.com/exploiting-os-command-injection-vulnerabilities-14195c9a410b?source=collection_archive---------0-----------------------#2022-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bb6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨！我叫哈沙尔·穆贾希德。今天我们将学习什么是<strong class="jp ir">操作系统命令注入</strong>以及我们如何利用它们。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7fae0fcd5c6869e7efa46b2a35a28f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fsDcLw9CU5hxtTs-.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">旗帜</figcaption></figure><h2 id="29c5" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">什么是OS命令注入？</h2><p id="58ce" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">操作系统命令注入是一个漏洞，允许攻击者直接在服务器上执行任意命令。如果你还没有意识到，如果攻击者能够在服务器上执行恶意代码，他可以很容易地得到一个反向外壳或后门进入服务器。</p><p id="2484" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在bug-bounty和渗透期间发现操作系统命令注入被标记为关键漏洞。</p><h2 id="2ce1" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">示例:</h2><p id="78ef" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">就像在这个简单的实验中，服务器允许用户执行所有命令，而不仅仅是白名单中的命令。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lz"><img src="../Images/c250222044f7a8b148c1504ac27991dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4Pktd7Fg-F5ll_3Ibenbg.png"/></div></div></figure></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="7581" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">使用完整命令:</h2><p id="3ce4" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">攻击者可以运行一些命令来获取用户和目标操作系统的相关信息。</p><blockquote class="mh mi mj"><p id="832d" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">当前用户的姓名<code class="fe mo mp mq mr b">whoami</code></p><p id="fe24" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">操作系统<code class="fe mo mp mq mr b">uname -a</code></p><p id="3eaa" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">网络配置<code class="fe mo mp mq mr b">ifconfig</code></p><p id="2418" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">网络连接<code class="fe mo mp mq mr b">netstat -an</code></p><p id="e50c" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">运行进程<code class="fe mo mp mq mr b">ps -ef</code></p></blockquote><h2 id="887d" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">Post请求参数中的OS命令注入:</h2><p id="d140" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">在本实验中，我们可以看到，当我们输入值时，会发出post请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ms"><img src="../Images/89efd501111fe3a69f4343d6770361c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uErjgnrjaDtK1mV91RIlVQ.png"/></div></div></figure><p id="167f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以确定这一点，因为在GET请求中，参数列在URL中，而在POST请求中，参数没有列在URL中。</p><pre class="km kn ko kp gt mt mr mu mv aw mw bi"><span id="0f8f" class="lb lc iq mr b gy mx my l mz na">GET</span><span id="5334" class="lb lc iq mr b gy nb my l mz na"><a class="ae nc" href="http://124.221.152.247:5001/CMD-1/index.php?cmd=ls" rel="noopener ugc nofollow" target="_blank">http://124.221.152.247:5001/CMD-1/index.php?cmd=ls</a></span><span id="ee48" class="lb lc iq mr b gy nb my l mz na">POST</span><span id="f93d" class="lb lc iq mr b gy nb my l mz na"><a class="ae nc" href="http://124.221.152.247:5001/CMD-1/index.php?cmd=ls" rel="noopener ugc nofollow" target="_blank">http://124.221.152.247:5001/CMD-1/index.php</a></span></pre><p id="b3c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在的问题是</p><h2 id="c886" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">如何检测命令注入漏洞:</h2><p id="8a2e" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">这个问题没有具体的答案。如果怀疑某些功能正在使用易受攻击的函数，请尝试理解应用程序的逻辑，例如</p><blockquote class="mh mi mj"><p id="65a4" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">eval()</p><p id="66cd" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">系统()</p><p id="e0d4" class="jn jo mk jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">通过()</p></blockquote><p id="6f3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以尝试注入命令并测试这些参数。</p><h2 id="483f" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">打破现有的命令:</h2><p id="5b1f" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">有时，如果代码执行在公开的功能中非常重要，应用程序会设置一个预设的命令路径，并从用户那里获取查询。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/18dd2412112170f91aba0760e8f98cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7TbSjXwfhuwfzVeaIw4eQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">Whois</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/1801ea75b3c6449a99dd074e9b86dfa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4jE0X4KfKzhWnSH-LS1eEA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">谷歌Whois</figcaption></figure><p id="f309" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在要执行命令，我们需要使用一些绕过技术，这样我们就可以执行代码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/6a9f99bfff1cc0dc59ed5d563aea1488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0f1ZKXzzNSrswIewKvxKw.png"/></div></div></figure><p id="ed2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用<code class="fe mo mp mq mr b">;</code>符号来结束一个命令的执行并添加我们的命令。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/9d6fe3429f40c721b00a76451a129736.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mYDK_NPaaLdRbIp3MhNOYg.png"/></div></div></figure><p id="d83e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们的代码被执行。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="282d" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">盲目操作系统命令注入漏洞:</h2><p id="6302" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">OS命令注入很多情况都是盲漏洞。这表明应用程序不在其HTTP响应中包含命令的输出。盲目的漏洞仍然可以被利用，但它采取了不同的方法。</p><h2 id="70af" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">检测盲目操作系统注入漏洞:</h2><p id="086e" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">现在，您应该问自己，我们如何检测盲目的操作系统命令注入漏洞。</p><p id="de9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简单的答案是注入可能导致一些延迟的命令。</p><h2 id="518f" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">例如:</h2><p id="7042" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">您可以尝试像这样注入睡眠命令</p><pre class="km kn ko kp gt mt mr mu mv aw mw bi"><span id="aadb" class="lb lc iq mr b gy mx my l mz na">vulnerableweb.com/command?cmd=;sleep(5)</span></pre><p id="f340" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将导致服务器在5秒钟后响应。</p><p id="d0a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者你可以尝试注入一个ping命令来与公共IP进行交互，看看你是否从web应用程序中获得了连接。</p><pre class="km kn ko kp gt mt mr mu mv aw mw bi"><span id="3ea4" class="lb lc iq mr b gy mx my l mz na">vulnerableweb.com/command?cmd=;&amp; ping -c 10 IP</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/b4dc342b9e49be328af4ab9ceda616e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xYLt9GNNASe8ameMzEed1g.png"/></div></div></figure><p id="3a72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到我们的10次pings导致了服务器上大约10秒的延迟。</p><h2 id="ff67" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">有效载荷:</h2><pre class="km kn ko kp gt mt mr mu mv aw mw bi"><span id="c09d" class="lb lc iq mr b gy mx my l mz na">email=test@mail.com||ping+-c+10+127.0.0.1||</span></pre><h2 id="d189" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">注入操作系统命令的方式:</h2><p id="acb9" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">有时应用程序会阻止“；”符号来防止攻击者注入命令。</p><p id="bef4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以尝试注射。</p><ul class=""><li id="4ed1" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated"><code class="fe mo mp mq mr b">&amp;</code></li><li id="6a1e" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><code class="fe mo mp mq mr b">&amp;&amp;</code></li><li id="a178" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><code class="fe mo mp mq mr b">|</code></li><li id="a02c" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated"><code class="fe mo mp mq mr b">||</code></li><li id="5417" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi">``</li></ul><h2 id="6251" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">如何防止操作系统命令注入攻击:</h2><p id="0ffe" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">尽量不要调用操作系统命令，但是如果不可避免，开发人员可以尝试一些技术。</p><ul class=""><li id="8836" class="nf ng iq jp b jq jr ju jv jy nh kc ni kg nj kk nk nl nm nn bi translated">根据允许值的白名单进行验证。</li><li id="437b" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">验证输入是一个数字。</li><li id="fdb8" class="nf ng iq jp b jq no ju np jy nq kc nr kg ns kk nk nl nm nn bi translated">验证输入只包含字母数字字符，没有其他语法或空白。</li></ul><p id="95b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将带着利用网络漏洞的新技术回来。</p><p id="f0e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之前，快乐的黑客❤.</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nt nu l"/></div></figure></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h2 id="5080" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae nc" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周时事通讯</a>以5篇文章、4个线程、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>