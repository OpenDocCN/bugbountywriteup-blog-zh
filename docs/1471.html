<html>
<head>
<title>They are all Injection Vulnerabilities!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">都是注入漏洞！</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/they-are-all-injection-vulnerabilities-ddcef366e39e?source=collection_archive---------2-----------------------#2021-07-16">https://infosecwriteups.com/they-are-all-injection-vulnerabilities-ddcef366e39e?source=collection_archive---------2-----------------------#2021-07-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5f9e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">XSS，RCE，SQL注入。探究注入漏洞的根源。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/457218cd8ce90ca2c6c03fa88858fe19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vi8JAK9m00ReYsEi"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">曼努埃尔·钦奇利亚在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="8808" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL注入、命令注入和跨站点脚本有什么共同点？答案是都是注入漏洞！</p><p id="e2a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近，我一直在思考如何教授安全性。我认为在学习安全性时，最重要的是理解事情发生的基本原因。因此，您不需要了解单一的技术或漏洞类别，而是希望了解导致这些问题的潜在机制，以及为什么某种攻击会以这种方式运行。</p><h2 id="2cc5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">注射的基本原理</h2><p id="9930" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">注射问题非常普遍。它们是现实应用程序中大量漏洞的潜在问题。所以今天，让我们深入了解注射缺陷的基本机制。</p><p id="5339" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">简而言之，当应用程序无法正确区分不受信任的用户数据和代码时，就会发生注入。</p><h2 id="227b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">不受信任的用户数据</h2><p id="e2b1" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">因此，等式的第一部分是不可信的用户数据。不受信任的用户数据可能以HTTP请求参数、HTTP头和cookies的形式出现。它们也可以来自用户可以修改的数据库或存储文件。如果应用程序在将不受信任的用户数据插入到命令或查询中之前没有正确处理这些数据，程序的解释器会将用户输入混淆为命令或查询的一部分。在这种情况下，攻击者可以通过改变命令含义的方式向应用程序发送数据。</p><p id="ada6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，在SQL注入攻击中，攻击者注入数据来操纵SQL命令。在XSS攻击中，攻击者注入操纵HTML文档中脚本逻辑的数据。因此，任何将用户数据与编程命令或代码相结合的程序都有潜在的漏洞。</p><p id="8030" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，重要的是要记住，这种操作可能在处理或使用这段数据的任何时候发生。即使恶意用户数据没有被应用程序立即使用，不受信任的数据也可能最终在程序中的某个地方传播，在那里它可能会做一些不好的事情，例如危险的函数或不受保护的查询。这就是它们对应用程序、数据或用户造成损害的地方。</p><h2 id="f642" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">防止注入漏洞</h2><p id="932d" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这就是为什么打针这么难预防。不受信任的数据可以攻击它接触到的任何应用程序组件。对于应用程序收到的每一份不可信数据，它都需要检测并消除针对应用程序每一部分的攻击。应用程序可能认为一段数据是安全的，因为它不包含任何用于触发XSS的特殊字符，而攻击者打算触发SQL注入。确定什么数据是安全的，什么数据是不安全的，并不总是那么简单，因为安全和不安全的数据在应用程序的不同部分看起来非常不同。</p><p id="c709" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输入验证</strong></p><p id="57f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那么，如何抵御这些威胁呢？您可以做的第一件事是验证不可信的数据。这意味着您要么实现一个<em class="mt">阻止列表</em>来拒绝任何包含可能影响应用程序组件的危险字符的输入。或者实现一个<em class="mt"> allowlist </em>，它只允许输入具有已知良好字符的字符串。例如，假设您正在实现一个注册功能。因为您知道数据将被插入到SQL查询中，所以您拒绝任何在SQL中是特殊字符的用户名输入，比如单引号。或者，您可以实现一个只允许字母数字字符的规则。</p><p id="e212" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但有时阻止列表很难做到，因为您并不总是知道哪些字符对应用程序组件很重要。如果您只是漏掉了一个特殊字符，攻击者就可以绕过保护。</p><p id="7b22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在某些情况下，allowlists可能过于严格，有时您可能需要在用户输入字段中接受特殊字符，如单引号。例如，如果一个名叫柯南·奥布莱恩的用户正在注册，他应该被允许在他的名字中使用单引号。</p><p id="5e2f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">参数化</strong></p><p id="52c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">防止注入的另一个可能的方法是参数化。参数化是指在插入任何用户提供的参数之前编译命令的代码部分。</p><p id="0a65" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着，您不是将用户输入连接到程序命令中，然后将其发送到服务器进行编译，而是首先定义所有的逻辑，编译它，然后在执行之前将用户输入插入到命令中。在用户输入被插入到最终命令中之后，该命令将不再被解析和编译。原始语句中没有的任何内容都将被视为字符串数据，而不是可执行代码。所以你的命令的程序逻辑部分将保持不变。</p><p id="3e5f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这允许数据库区分命令的代码部分和数据部分，而不管用户输入是什么样子。这种方法在防止一些注入漏洞方面非常有效，但是不能在代码中的每个上下文中使用。</p><p id="9af1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">逃逸</strong></p><p id="8fdf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，您可以对特殊字符进行转义。转义意味着对用户输入中的特殊字符进行编码，以便将它们视为数据而不是特殊字符。通过使用特殊的标记和语法来标记用户输入中的特殊字符，转义让解释器知道数据不打算被执行。</p><p id="e3ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是这种方法也有它的问题。首先，必须为每个下游解析器使用精确的编码语法，否则解析器可能会误解编码值。您可能还会忘记对某些字符进行转义，攻击者可以利用这些字符来压制您的编码尝试。因此，防止注入漏洞的一个关键是理解不同语言的解析器是如何工作的，以及哪些解析器在您的进程中首先运行。</p><p id="6548" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天的安全课到此结束。这篇博文可能有点笼统，但是理解注入漏洞的基本原理将为您开始研究更复杂、更怪异的注入漏洞案例打下良好的基础。因此，我希望这有助于您对注入攻击和防护如何工作有一个直观的认识。感谢阅读！</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="0040" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您还想了解其他哪些安全概念？我很想知道。随时在Twitter<a class="ae ky" href="https://twitter.com/vickieli7" rel="noopener ugc nofollow" target="_blank">@ vickie i7</a>上联系。</p></div></div>    
</body>
</html>