<html>
<head>
<title>Independence Is Not a Dirty Word</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">独立不是一个肮脏的词</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/independence-is-not-a-dirty-word-82869c611129?source=collection_archive---------0-----------------------#2019-10-15">https://infosecwriteups.com/independence-is-not-a-dirty-word-82869c611129?source=collection_archive---------0-----------------------#2019-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fe73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">注:以下文章发表于2017年16月1日https://FogMarks.com</em><a class="ae km" href="https://fogmarks.com/2017/01/16/independence-is-not-a-dirty-word/" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/ce71f435d26ff4dadfa2d16c9b2a30c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jvAZUBbUzxyBJUIF.jpg"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">信用:<a class="ae km" href="http://www.picpedia.org/highway-signs/i/independence.html" rel="noopener ugc nofollow" target="_blank">http://www.picpedia.org/highway-signs/i/independence.html</a></figcaption></figure><blockquote class="ld le lf"><p id="e3ee" class="jn jo kl jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">正如在<a class="ae km" href="https://medium.com/bugbountywriteup/api-a-p-otentially-i-diotic-threat-de19b7f3687e" rel="noopener">上一个案例研究</a>中所承诺的，今天我们将看到一个非常有趣的案例研究，有一个有趣的转折。</p></blockquote><p id="5470" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi lj translated">每个人似乎都喜欢jQuery。这个令人敬畏的Javascript库无处不在——成千上万的公司在他们的网站应用程序中使用它，它非常方便——尤其是在AJAX请求方面——导入jQuery让我们的生活变得更加轻松。</p><h1 id="b6ee" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">图书馆中的图书馆</h1><p id="9106" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">jQuery并不孤单。谷歌和微软(有时还有Mozilla和苹果，脸书和Twitter)一直在发布新的JS库，并建议开发人员使用它们并将其导入到他们的产品中。例如，如果你想播放QuickTime视频，你应该导入<a class="ae km" href="https://developer.apple.com/library/content/samplecode/HTML_video_example/Listings/ac_quicktime_js.html" rel="noopener ugc nofollow" target="_blank">苹果的QuickTime JS库</a>，如果你想要那个简洁的jQuery DatePicker，你应该从Google、jQuery或任何其他镜像导入那个库。</p><p id="81ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">统计一下我在最后一段中使用单词'<strong class="jp ir"> import </strong>'的次数。完成了吗？4次。<br/>每当我们想要使用某个公共JS库，这个库属于某个公司或服务，我们就直接从那个公司导入。<br/>为了更清楚，我们简单地在我们的网站上放置一个&lt;脚本&gt;标签，带有一个指向JS文件地址的“src”属性:</p><blockquote class="ld le lf"><p id="a7f4" class="jn jo kl jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated"><em class="iq"> &lt;脚本src = " http/s://trustworthydomain . com/path/to/js/file . js&gt;&lt;/脚本&gt; </em></p></blockquote><p id="e025" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你拿到了吗？我们正在将另一个网站(第三方网站)的脚本加载到我们网站的上下文中。我们违反了网络安全的第一准则——我们信任其他网站！</p><h1 id="d8c7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">这听起来可能有点愚蠢</h1><p id="8624" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">为什么我不能从像jQuery、微软或谷歌这样值得信赖的公司导入脚本？你是对的。算是吧。</p><p id="d90f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你从一个值得信赖的公司导入一个脚本时，90%的情况下你会从该公司的CDN导入它。<br/> CDNs代表内容交付网络，它是(引用:)“基于用户的地理位置、网页的来源和内容交付服务器向用户交付网页和其他网络内容的分布式服务器(网络)系统。”</p><p id="5a73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一种托管服务，根据客户的位置和其他一些因素为他们提供存储服务。<strong class="jp ir">你正在导入的JS文件并没有保存在公司的官方服务器</strong>上(还是那句话——大多数时候)。</p><h1 id="15a4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">在这个案例研究中，我们将看到一家非常受欢迎的公司是如何陷入困境的</h1><p id="44ce" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">这家公司(当然，我们不能透露)开发了一个流行的JS库，并将其托管在他们购买的第三方CDN上。CDN是“智能”的，根据用户的位置将用户重定向到最近的服务器:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi mv"><img src="../Images/89ff9744af87fa9e0c3a04d1363cd07b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GzIZTdqB0phRbx0hFkkiIw.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">CDNs简单插图</figcaption></figure><p id="6979" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当请求到达主服务器时，服务器确定请求的IP地址，然后根据确定的位置将请求路由到最近的服务器。</p><p id="d32f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几十个网站在它们的源代码中植入了一个<script src="">标签，指向那家公司的主服务器CDN，它为它们的用户提供了必要的JS库。&lt;/root&gt;</script></p><h1 id="787d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">令人(不)愉快的惊喜</h1><p id="c097" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">在对安装在服务器C上的Apache服务器(图中的副本C)做了一些研究后，我们得出结论，它的版本确实过时了，并且容易受到任意文件上传攻击，这允许我们将文件上传到CDN ( <strong class="jp ir">，但不执行代码</strong>)。乍一看，没那么严重。</p><p id="4e16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">但是！</strong>当我们检查文件上传的方式时，当然是未经授权的，我们发现在文件路径上使用<a class="ae km" href="https://en.wikipedia.org/wiki/Directory_traversal_attack" rel="noopener ugc nofollow" target="_blank">目录遍历</a>是可能的。我们简单地将文件名改为../../../ &lt;公司域名&gt; / &lt;产品名称&gt; / &lt;版本&gt; / &lt; jsfilename &gt;。我们能够用一个恶意的js文件替换公司的合法JS文件。</p><p id="a376" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，我们在几十个网站和公司上有一个XSS，甚至没有对他们进行一分钟的研究。有趣的是，这种攻击只影响被定向到易受攻击的服务器(服务器C)的用户。</p><h1 id="df75" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">从中我们能学到什么(TL；博士)</h1><p id="55c1" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">永远不要相信第三方网站和服务来做你的工作！我已经告诉你无数次了。要独立。做一个可以独自呆在家里的大男孩。</p><p id="ac81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最安全的解决方案是手动下载您使用的JS库文件，并将它们保存在您的服务器上。</p><h1 id="e2a2" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">但是当我使用的JS库更新时会发生什么呢？</h1><p id="bfe9" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">显然，除了使用像<a class="ae km" href="https://bower.io/" rel="noopener ugc nofollow" target="_blank">鲍尔</a>这样的<strong class="jp ir">包管理器</strong>之外，使用建议的方法没有简单的方法来跟踪它。你所要做的就是每隔一段时间同步你的库。</p><blockquote class="ld le lf"><p id="931f" class="jn jo kl jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated"><em class="iq">在Javascript包管理器流行之前，我建议我的一个朋友简单地写一个cronjob或python脚本，检查公司服务器上可用的JS库的最新版本，然后将其与本地版本进行比较。如果版本不同，脚本会向技术团队发送电子邮件。<br/> </em> <strong class="jp ir"> <em class="iq">大型JS库不会经常更新。</em> </strong></p></blockquote><p id="37fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，在你刚刚看完恐怖电影之后，除了喝咖啡，你要做的下一件事就是把你的第三方库下载到你的服务器上。</p><p id="12f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干杯。</p></div><div class="ab cl mw mx hu my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ij ik il im in"><p id="84e4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">关注</em> <a class="ae km" href="https://medium.com/bugbountywriteup" rel="noopener"> <em class="kl"> Infosec报道</em> </a> <em class="kl">获取更多此类精彩报道。</em></p><div class="nd ne gp gr nf ng"><a href="https://medium.com/bugbountywriteup" rel="noopener follow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">信息安全报道</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">收集了世界上最好的黑客的文章，主题从bug奖金和CTF到vulnhub…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kx ng"/></div></div></a></div></div></div>    
</body>
</html>