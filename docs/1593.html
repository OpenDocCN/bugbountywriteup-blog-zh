<html>
<head>
<title>Quick Guide For Running Clair Scanner via Katacoda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Katacoda运行Clair扫描仪的快速指南</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/quick-guide-for-running-clair-scanner-via-katacoda-a074bd256eff?source=collection_archive---------2-----------------------#2021-09-26">https://infosecwriteups.com/quick-guide-for-running-clair-scanner-via-katacoda-a074bd256eff?source=collection_archive---------2-----------------------#2021-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8b7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本指南讲述了如何设置Clair扫描器，并对易受攻击的DVWA容器执行扫描。现在也可以在katacoda上进行实际操作演示。</p><p id="c670" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在Katacoda上运行演示。要运行演示，请访问<a class="ae kl" href="https://www.katacoda.com/justmorpheus" rel="noopener ugc nofollow" target="_blank">https://www.katacoda.com/justmorpheus</a></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><a href="https://twitter.com/justm0rph3u5"><div class="gh gi km"><img src="../Images/aeca1ce3e20889db3873239772cbfea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_HEClpmqL-YkBsf8EL9nMg.png"/></div></a></figure><h1 id="6468" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">设置Clair服务器或在本地使用。</h1><blockquote class="ls lt lu"><p id="6233" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated">科洛斯·克莱尔·https://github.com/coreos/clair</p><p id="bb51" class="jn jo lv jp b jq jr js jt ju jv jw jx lw jz ka kb lx kd ke kf ly kh ki kj kk ij bi translated">克莱尔扫描https://github.com/arminc/clair-scanner</p></blockquote><p id="805f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以运行带有数据库的专用Clair服务器，并在ci/cd管道中使用该服务器，但是如果您希望将Clair作为ci/cd管道的一部分运行，那么您将会大吃一惊:</p><ul class=""><li id="2931" class="lz ma iq jp b jq jr ju jv jy mb kc mc kg md kk me mf mg mh bi translated">从头开始启动Clair大约需要20到30分钟，因为数据库需要用CVE填充。</li><li id="d9c3" class="lz ma iq jp b jq mi ju mj jy mk kc ml kg mm kk me mf mg mh bi translated">Clair需要访问容器层，因此您需要从Clair远程访问您的构建作业。</li></ul><h1 id="d1ae" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">如何扫描集装箱</h1><ul class=""><li id="75cf" class="lz ma iq jp b jq mn ju mo jy mp kc mq kg mr kk me mf mg mh bi translated">在本地或运行作业时启动Clair数据库和Clair。</li></ul><p id="9e6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">docker run -d --name clair-db arminc/clair-db:latest</code></p><p id="e937" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">docker run -p 6060:6060 --link clair-db:postgres -d --name clair arminc/clair-local-scan:v2.0.8_fe9b059d930314b54c78f75afe265955faf4fdc1</code></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/05fa9db361f1d1521d13786192def5c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPlqIIx9-4gsU_7UHirLgw.png"/></div></div></figure><ul class=""><li id="79d7" class="lz ma iq jp b jq jr ju jv jy mb kc mc kg md kk me mf mg mh bi translated">扫描易受攻击的图像</li></ul><p id="5196" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要一个脆弱的形象。几乎没有易受攻击的图像，包括该死的易受攻击的Web应用程序。我们可以用它来测试克莱尔扫描仪。它在设计上是易受攻击的。</p><p id="195c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要从Ubuntu服务器指定要扫描的易受攻击的图像，请使用以下命令。</p><p id="da37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">docker pull infoslack/dvwa</code></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nb"><img src="../Images/1fa5b83918609d7ec022eb9e50f2b0d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tPgEOF39Rswpc5EzpsDggw.png"/></div></div></figure><ul class=""><li id="5e51" class="lz ma iq jp b jq jr ju jv jy mb kc mc kg md kk me mf mg mh bi translated">运行附加命令下载Clair-scanner二进制文件并执行扫描。</li></ul><p id="c690" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">mkdir clair &amp;&amp; cd clair</code></p><p id="1f48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">wget https://github.com/arminc/clair-scanner/releases/download/v12/clair-scanner_linux_386 -O /usr/local/bin/clair-scanner</code></p><p id="7f99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">chmod +x /usr/local/bin/clair-scanner</code></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nc"><img src="../Images/7507985f787807f19fb962be52651755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIdlyLP4Q59W-bgLLgkntQ.png"/></div></div></figure><ul class=""><li id="8b39" class="lz ma iq jp b jq jr ju jv jy mb kc mc kg md kk me mf mg mh bi translated">检查Clair-local-scan容器是否正在运行，否则将会出现错误。该命令将获取容器id，并在退出时启动容器。</li></ul><p id="e386" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">CONTAINER="$(docker ps -a | grep -i "clair-local-scan" | awk ' { print $1 }')"</code></p><p id="3d58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">if sudo docker inspect --format="{{.State.Running}}" $CONTAINER; then docker start $CONTAINER; else echo "Container is already running, proceed with next command"; fi</code></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nd"><img src="../Images/b3d0265eebe1c5cc466e2b12ba61a45e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edIGec12dxzvuvBJKaj1qg.png"/></div></div></figure><h1 id="1043" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">运行以下命令为易受攻击的infoslack/dvwa映像生成报告</h1><ul class=""><li id="11ae" class="lz ma iq jp b jq mn ju mo jy mp kc mq kg mr kk me mf mg mh bi translated">此命令会将IP保存在变量中，这是以下操作所必需的:</li></ul><p id="17af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">IP="$(ip addr show ens3 | awk '$1 == "inet" {gsub(/\/.*$/, "", $2); print $2}')"</code></p><ul class=""><li id="568c" class="lz ma iq jp b jq jr ju jv jy mb kc mc kg md kk me mf mg mh bi translated">运行Clair-scanner，这将生成保存在clair_report.json中的报告。</li></ul><p id="71d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">clair-scanner --ip $IP -r clair_report.json infoslack/dvwa</code></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ne"><img src="../Images/baa0292dca88cd15f07a963501d5a0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aedah3uoV5o5YrAvBoS9Tw.png"/></div></div></figure><h1 id="d880" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">现在我们的报告准备好了，我们可以通过以下方式阅读:</h1><p id="815e" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy nf ka kb kc ng ke kf kg nh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">cat clair_report.json</code></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ni"><img src="../Images/5bccb7b4a9d8795b36d6602bd924f9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SlcHrOP4ACVIY8yun8QTdQ.png"/></div></div></figure></div></div>    
</body>
</html>