<html>
<head>
<title>Broken Authentication: It’s Not What You Think Is!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">破认证:不是你想的那样！</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/broken-authentication-its-not-what-you-think-is-4d64be3583ec?source=collection_archive---------4-----------------------#2021-04-18">https://infosecwriteups.com/broken-authentication-its-not-what-you-think-is-4d64be3583ec?source=collection_archive---------4-----------------------#2021-04-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="d40f" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><p id="b8b6" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">OWASP对身份认证中断的定义非常深入，虽然这通常对pentesters来说不是问题，因为他们需要报告任何事情，并让客户决定采取什么行动。如果我们谈论bug赏金猎人，这些漏洞对我们也是有用的，但可能不是立即有用。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lm"><img src="../Images/93b0558c758f4e45bc967ceb90779910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aWQtOPqUxSBzbqOe"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk translated">菲利普·卡岑伯格在<a class="ae mc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="99ba" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">OWASP所指的身份验证被破坏可能与大多数人头脑中的定义不同，所以让我们更深入地了解它们的实际含义。OWASP基本上是在说糟糕的会话管理。似乎主要是关于无效会话验证。通常我会想到像破坏访问控制这样的事情，但是这些都在第五章中单独的一章里。</p><h1 id="f029" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">攻击类型</h1><h1 id="5106" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">凭据填充和弱密码</h1><p id="cc33" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">当攻击者拥有一系列密码和用户名时，由于服务器允许自动攻击，攻击者可能会尝试所有密码和用户名。这被称为凭证填充，服务器应该通过在几次失败的登录尝试后启用验证码来防止这种情况。</p><p id="a344" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">允许暴力强制或自动化脚本是一个安全缺陷，它可能不会在bug奖金中被接受，但作为pentesters，我们确实需要报告它们并正确分类它们的严重性。</p><p id="bdb5" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">我们也应该永远不能注册弱密码，如“管理/管理”或“密码1”。这将更容易暴力破解不想创建正确密码的懒惰员工的密码。</p><h1 id="7aed" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">密码恢复选项</h1><p id="761c" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">还可能发生的情况是，我们的目标使用弱密码恢复选项，如基于知识的恢复。这时，服务器会要求您设置几个安全问题和答案。这个系统的问题是，人们经常设置并忘记这些问题。这使得攻击者能够找出问题，并在漫不经心的对话中简单地询问受害者。如果受害者忘记了他们有一个安全问题，要求他们的第一只狗的名字，攻击者可以开始一个关于宠物的对话，并很容易地知道答案。</p><p id="dc40" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">解决这些密码恢复问题的一个好方法是依靠二级备份选项，如备份电子邮件地址或电话号码。这将增加攻击者的难度，因为他们必须侵入受害者的第二电子邮件地址甚至电话。</p><h1 id="a6f3" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">密码加密薄弱或没有加密</h1><p id="f779" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我喜欢谈论的另一个有趣的事情是弱密码加密。一些初学编程的人不知道密码的敏感性，也不知道如果密码泄露会有多糟糕，因为现在人们似乎对所有事情都使用同一个密码。</p><p id="629c" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">一个有趣的例子是我正在测试的一个网站，在那里我点击了“忘记密码”，我填写了我的电子邮件地址，然后我看到电子邮件进来了。唯一的问题是，他们可以用明文告诉我我的密码！正常的散列法不容易被逆转，这就是为什么大多数密码在输入数据库时被散列和加盐。如果应用程序不这样做，这是一个非常不好的迹象。我会转身尽可能快地跑。这个缺陷的最大问题是很难被注意到。如果应用程序没有正确处理您的密码，通常您不会知道这一点，因为您无法访问数据库。</p><h1 id="ef51" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">多因素认证</h1><p id="2df2" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们还可以看看多因素身份认证。如果它不见了，作为一个pentester，我们肯定可以报告这是一个最佳做法。然而，如果提供了它，我们必须检查它是否正常工作。我们可以看看是否仍然可以在不输入MFA参数的情况下发出要求MFA(多因素身份验证)的请求。我们可以将其留空，将其更改为随机值，甚至完全删除该参数。我们需要在所有需要MFA的请求上尝试这种方法，如果其中任何一个在改变参数后仍然有效，我们就有了一个漏洞。它的严重程度会稍微低一些，因为它确实需要被攻击的帐户已经被破坏。</p><h1 id="3e3e" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">把那个SessionID递给我</h1><p id="6d1a" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">有时，公司有两个应用程序，有时你登录其中一个，需要切换到另一个。在这种情况下，有几种方法可以处理身份验证，最不安全的方法是将会话ID作为GET参数发送。在正常情况下，这不会造成太大的威胁，因为当使用HTTPS流量时，URL会被加密。但是，在使用常规HTTP流量的情况下，或者如果攻击者能够执行MiTM(中间人)攻击，帐户可能会以这种方式受到威胁。作为一个圣灵降临者，我们肯定可以再次报告这是一个最佳实践，但是作为臭虫赏金猎人，这个问题将不会被接受，因为有一个MiTM攻击的要求。</p><h1 id="87fb" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">会议</h1><p id="4bd3" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们还需要谈一谈服务器是如何处理会话的。有时，开发人员会错误地配置他们的会话处理，这可能会导致以下任何一种情况:</p><ul class=""><li id="31c9" class="mi mj it kq b kr md kv me kz mk ld ml lh mm ll mn mo mp mq bi translated">注销后会话可能不会失效，这意味着如果攻击者能够获取sessionID(例如通过XSS窃取)，攻击者能够继续使用sessionID登录到帐户，而不会使其失效。这是虫类赏金猎人应该记住但不要报告的事情，另一方面，圣灵降临者应该报告这一点。对于bug赏金猎人来说，这将提升像账户接管这样的bug的严重性。</li><li id="f364" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">会话没有很快失效，这意味着几乎与前一个例子相同，但不同的是，我们没有一个永恒的帐户接管，而是一个有限的，虽然仍然太长了。会话应该在用户注销时失效，理想的情况是在会话期间失效，此时后台会调用身份验证服务器获取新的sessionID。这是虫类赏金猎人应该记住但不要报告的事情，另一方面，圣灵降临者应该报告这一点。对于bug赏金猎人来说，这将提升像账户接管这样的bug的严重性。</li><li id="5038" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">SessionID太容易预测了，我们有一定的技术来确定sessionID样本的随机程度，如果不够随机，我们可以猜测sessionID。这是值得报告的错误奖金，并肯定从pentesters。</li><li id="3ad9" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">SessionID在一段时间不活动后不会失效，有关严重性和报告准则，请参见第一点。</li></ul><h1 id="0621" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">防御机制</h1><p id="833b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们可以给出几个通用的提示，所以如果你愿意，可以跳过下一章，但是我建议你通读一下，因为它包含了一些你可能没有想到的边缘情况。</p><ul class=""><li id="91f3" class="mi mj it kq b kr md kv me kz mk ld ml lh mm ll mn mo mp mq bi translated">只要有可能，就实施多因素身份认证，并很好地实施。作为攻击者，我们的工作是在每次发生MFA时测试它是否以正确的方式实现。</li><li id="14f8" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">更改任何默认密码，不要使用像admin/admin或test/test这样的弱凭据</li><li id="118a" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">您应该确保用户不能输入弱密码。在执行这些规则时，请记住，使用很长的密码比使用带有奇怪字符的短密码更安全。有些应用程序甚至不允许你输入一个很长的密码，这是令人震惊的。如果您的应用程序允许您创建一个类似“test”的密码，您应该明确地将其报告为一个pentester，而不是一个bug赏金猎人，因为这是一个最佳实践。关于推荐密码要求的完整指南可在<a class="ae mc" href="https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret" rel="noopener ugc nofollow" target="_blank">https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret</a>找到</li><li id="aeaa" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">确保你永远不会给出一个特定的错误信息，并且这个信息对于所有的结果都是一样的。例如，如果您登录，用户名是正确的，但密码是错误的，您的错误消息应该永远不会提到这一点，而是类似于“您的用户名/密码不正确”。如果您给出唯一的响应，可能会导致攻击者枚举用户名。对于bug赏金猎人，这通常列在范围外部分，而对于pentesting，这可以作为最佳实践报告。</li><li id="58b5" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">当攻击者无法登录时，您应该通过实施captcha和/或时间限制来限制他们的登录尝试，例如，在5次失败尝试后的10分钟内不允许任何登录尝试。一个好的做法是，当受害者下次登录时，如果发生了几次失败的尝试，要求更改密码，以赶走任何可能的入侵者。作为一个虫子赏金猎人，这不是你应该报告的事情，但作为一个圣灵降临者，这可以再次作为最佳实践。</li><li id="ba39" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">您应该实现一个安全的服务器端会话管理器，并确保会话ID足够随机。作为一个臭虫赏金猎人，这可能是一个感兴趣的领域，因为在这一部分的妥协将直接产生重大影响。作为一个测试者，这方面的缺陷通常会被报告为高风险。但是有时它们的严重性很低，所以要仔细判断每个缺陷。</li><li id="c9c6" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">请确保在注销和一段时间不活动后使您的会话无效。作为一个虫子赏金猎人，记住这一点可能很有趣，但我不会报告这一点，因为大多数程序不会接受这一最佳实践。作为一名圣灵降临者，我会将此作为最佳实践进行报告。</li></ul><h1 id="e023" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">一般</h1><p id="1d1b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">总的来说，我们绝不应该允许像管理员这样可以执行有影响或敏感操作的帐户通过前端系统登录。这将防止攻击者强行打开帐户，但这是一个最佳实践，因此这通常只对pentesters有用。就这一点而言，开发人员还应该确保后端(内部)和前端(外部)登录系统是不同的，并且它们使用不同的身份验证机制。</p><p id="b8b5" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">当我们谈论身份验证时，非常重要的是，我们从不给出详细的错误消息，我们必须确保我们总是提供相同的错误消息。例如，如果用户没有提供正确的密码，但有一个现有的用户名，我们不应该告诉他们密码不正确，而只是告诉他们密码或用户名不正确。这让他们猜测哪些帐户名是有效的。</p><h1 id="6f80" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">密码机制</h1><p id="2c32" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">至于密码，你应该要求最少8个字符，但密码是目前最安全的选择，因为它需要很长时间来暴力破解。知道这一点，我们应该允许用户输入至少64个字符，允许他们使用字母数字，但也需要1个特殊字符，以使暴力破解这些密码更加困难。设置最大密码长度非常重要，否则bug bounty hunters和pentesters等可能会通过用超长密码溢出您的数据库服务器来发起应用程序级DoS攻击。</p><p id="9480" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">为了使密码更加安全，您可以要求用户经常更换密码，但是不要太频繁地更换密码是很重要的，因为这可能会惹恼用户并产生负面影响，而且用户可能会输入一个较弱的密码来更好地记住它。</p><p id="494b" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">如果您有一个敏感的功能，如更改电子邮件地址或确认购买操作，通常最佳做法是再次要求用户输入密码。这将阻止任何想要在某个帐户上执行敏感功能的攻击者，该帐户是某人在无人看管其计算机时留下的登录帐户。</p><h1 id="ec70" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">密码恢复机制</h1><p id="d208" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">正如我们之前所讨论的，实现适当的密码恢复机制非常重要。简单的恢复问题机制通常是不够的，因为用户经常不记得他们自己的安全问题，因此可以容易地被操纵来揭示这些问题的答案。理想情况下，设置一个备用电话或电子邮件地址，以便用户可以从那里恢复他们的密码，如果他们无法访问他们的备份帐户，要求他们联系客户支持是一个好主意。</p><h1 id="2d08" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">储存我们的密码。</h1><p id="f9f0" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们需要确保安全地存储用户密码，他们非常信任我们，我们必须确保满足客户的期望。我们应该以一种安全的方式存储他们的密码，这种方式只能以一种方式执行，这意味着一旦密码被加密，我们就不能对其进行解密。为了以后检查密码，您需要对用户提供的密码进行加密，并使用您存储在数据库中的密码检查加密的密码。</p><p id="f0a6" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">这通常通过散列密码来实现，但是如果我们散列一些东西，我们总是得到相同的值。这意味着黑客可以构建所谓的彩虹表。这些表将包含密码及其散列值的列表。为了解决这个问题，公司可以在你的密码中添加“盐”。这基本上是一个随机字符串，开发人员将它与哈希密码一起存储在数据库中。每当加密密码时，他们会将该值添加到您的密码中，以确保密码不会在彩虹表中被轻易找到。</p><p id="7faf" class="pw-post-body-paragraph ko kp it kq b kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll im bi translated">OWASP提供了一些确保密码安全的一般提示:</p><ul class=""><li id="c1dc" class="mi mj it kq b kr md kv me kz mk ld ml lh mm ll mn mo mp mq bi translated">有一个最大输入长度，可以防止输入过长的拒绝服务攻击。</li><li id="70f7" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">显式设置这两个变量的类型，以防止类型混淆攻击，例如PHP中的<a class="ae mc" href="https://www.whitehatsec.com/blog/magic-hashes/" rel="noopener ugc nofollow" target="_blank">魔法哈希</a>。</li><li id="ce38" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">以常数时间返回，以防止计时攻击。</li></ul><h1 id="91af" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">坦克激光瞄准镜（Tank Laser-Sight的缩写）</h1><p id="c595" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">出于安全原因，始终通过HTTPS/TLS传输任何流量非常重要。这将防止攻击者分析您的web应用程序和受害者之间的流量，如果他们能够执行MiTM攻击的话。这也变得越来越有可能在最近一段时间，由于很多咖啡店突然出现了免费的无线网络，这是不是很安全。</p><h1 id="b30f" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">防范自动攻击</h1><p id="cda0" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">实现一些安全措施真的很重要，这些措施将挫败现有的很大一部分自动化脚本。</p><ul class=""><li id="2a6c" class="mi mj it kq b kr md kv me kz mk ld ml lh mm ll mn mo mp mq bi translated">我们需要限制用户可以发出的请求数量。例如，如果他们在任何时候每秒发出2个以上的请求，他们可能会超时，或者如果他们发出一定数量的请求，如果防御机制必须是极端的，他们也可能会被ip禁止。</li><li id="b94a" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">我们需要在任何需要密码的地方正确地实施多因素身份认证。这不仅会增加应用程序的复杂性，还会增加安全性。</li><li id="87ec" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">如果用户经常尝试使用不正确的密码登录，该帐户可能无法从该特定ip地址登录，或者根本无法登录，但要小心，因为如果您禁止该帐户登录，您需要确保该帐户名称永远不会被泄露。如果有人知道受害者的帐户名称，他们可以继续禁用受害者的帐户，有效地永远锁定他们。</li><li id="efe2" class="mi mj it kq b kr mr kv ms kz mt ld mu lh mv ll mn mo mp mq bi translated">我们可以实现一个验证码机制，或者直接触发，或者在几次失败的登录尝试后触发，这将使脚本更难自动测试密码</li></ul><h1 id="3da5" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">跟踪攻击</h1><p id="d3bb" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们记录并调查每一次失败的登录尝试是非常重要的。有些只是帐户所有者的诚实错误，但有些可能是攻击，可能会导致对攻击者采取某些措施。</p><h1 id="2d21" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">便利贴上的密码太过时了</h1><p id="b876" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">玩笑归玩笑，使用安全密码后，你可能会发现很难记住所有的密码，也很难跟踪所有需要密码的软件，因为每个应用程序都应该使用不同的密码。为了解决这个问题，你可以使用密码管理器。密码管理器可以存储和生成密码，这是非常值得投资的密码管理器，因为它将帮助您管理大量的密码</p><h1 id="0f3b" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">其他认证机制</h1><p id="bb73" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">根据oAuth、SAML或LDAP等身份验证类型的实现，我们可能会有其他一些安全缺陷。为了解决这些问题，强烈建议完整阅读文档，因为它通常包含关于可能出现的安全问题的章节，但是最好投资一个专家来调查您的安全机制，因为这不是您希望出错的事情。这可以通过雇佣一个pentester或者加入一个bug赏金计划来实现。</p></div></div>    
</body>
</html>