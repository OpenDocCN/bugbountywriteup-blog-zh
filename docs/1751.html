<html>
<head>
<title>Carnage — Network Traffic Analysis with Wireshark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大屠杀—使用Wireshark进行网络流量分析</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/carnage-network-traffic-analysis-with-wireshark-5fe97e530499?source=collection_archive---------0-----------------------#2021-12-30">https://infosecwriteups.com/carnage-network-traffic-analysis-with-wireshark-5fe97e530499?source=collection_archive---------0-----------------------#2021-12-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/14429dcda4e61ce7b04cb248ef100394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f-DWX1cfurH48wRp1Ch_4g.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">leTamique 的大屠杀粉丝艺术。</figcaption></figure><p id="ab7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近，我做了一些关于网络流量分析的研究。为了获得更多的实践，我决定尝试由<em class="lb"> heavenraiza </em>和<em class="lb"> RussianPanda创建的名为“<strong class="kf ir"/><em class="lb"/>的免费TryHackMe房间。</em>本文介绍了我使用Wireshark解决这个房间的方法，我还在最后提供了一个TryHackMe的链接，供有兴趣尝试这个房间的人使用。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="eeda" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">放弃</h1><p id="9e5c" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">我喜欢在一篇文章之前添加一个简短的免责声明，以鼓励人们在阅读本文之前尝试一下这个房间，因为在这篇文章中显然会有<strong class="kf ir">剧透</strong><strong class="kf ir"/>。我相信，如果你先自己尝试，然后在遇到困难或需要提示时再来写这篇文章，你会更喜欢CTF。因此，没有任何进一步的拖延，让我们开始吧！</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="0c92" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">挑战描述</h1><blockquote class="mm mn mo"><p id="b32f" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">Bartell Ltd采购部的Eric Fischer收到了一封来自已知联系人的电子邮件，其中附有一份Word文档附件。打开文档时，他不小心点击了“启用内容”SOC部门立即收到来自端点代理的警报，称Eric的工作站正在进行可疑的出站连接。pcap已从网络传感器中检索出来，并交给您进行分析。</p><p id="6d54" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated"><strong class="kf ir">任务:</strong>调查数据包捕获并揭露恶意活动。</p></blockquote></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="c2a5" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">交通分析</h1><blockquote class="mm mn mo"><p id="19ee" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">1.第一次HTTP连接到恶意IP的日期和时间是什么？(<strong class="kf ir">回答格式</strong> : yyyy-mm-dd hh:mm:ss)</p></blockquote><p id="fe7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我首先在Wireshark中导航到“<em class="lb">统计数据&gt;端点&gt; IPV4选项卡】</em>。然后我按数据包的数量排列了显示的地址:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/59634a5e9819ed1f11b02fc478b4daee.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*bdGuqq9ofZ9F5AcWJRhAAQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">按数据包数量排序的端点。</figcaption></figure><p id="1666" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我可以看到分配了IP地址<em class="lb"> 10.9.23.102 </em>的端点发送/接收了大量流量。我决定关注这个端点，并使用Wireshark过滤器来显示该端点的所有HTTP流量:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="18d0" class="nc lk iq my b gy nd ne l nf ng">ip.addr==10.9.23.102 &amp;&amp; http</span></pre><p id="0a72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此端点有相当多的HTTP流量，但时间列没有提供所需的答案格式:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/75c5b0e47145e6b276ddc452f4db2110.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/format:webp/1*CG1CEDEaXPIM8QFJKz_39A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">时间显示格式:从捕获开始的秒数。</figcaption></figure><p id="fe22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我可以导航到“<em class="lb">查看&gt;时间显示格式</em>，并将格式更改为答案所需的格式。这为我们提供了与恶意IP的第一次HTTP连接的时间和日期:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/24748cfaa2f4ad90e0a1a4629f5d0ba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*gZ6KQYc-4LzAxzCC_i31Yw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">时间显示格式:日期和时间。</figcaption></figure><blockquote class="mm mn mo"><p id="d7a3" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">2.下载的zip文件的名称是什么？</p></blockquote><p id="1ef5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们查看带有恶意IP的第一个HTTP数据包，并跟踪HTTP流，我们可以看到发出了一个GET请求来下载一个ZIP文件:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/49e8eb8ab1192927564e1abd57ecd50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*i9pn0YhBLLhhvOtXsEvbsQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">HTTP流获取请求ZIP文件。</figcaption></figure><blockquote class="mm mn mo"><p id="ae8d" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">3.托管恶意zip文件的域是什么？</p></blockquote><p id="2fac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们查看带有恶意IP的第一个HTTP数据包中的<strong class="kf ir">主机</strong>请求头值，我们还可以看到恶意文件所在的域(见上图)。</p><blockquote class="mm mn mo"><p id="957e" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">4.不下载文件，zip文件中的文件名是什么？</p></blockquote><p id="a8ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们进一步查看第一个HTTP数据包，查看恶意IP对来自端点的GET请求的响应，我们可以看到ZIP文件的开头(由PK头表示)和ZIP文件中的文件名:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/1f4f9a2b4460a2f45b39cfc463ed37fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*LelvpgA8nWMEd2RNU9nK6Q.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">下载的zip文件中的文件名。</figcaption></figure><blockquote class="mm mn mo"><p id="de04" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">5.下载zip文件的恶意IP的web服务器的名称是什么？</p></blockquote><p id="2906" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，如果我们进一步查看第一个HTTP数据包，查看恶意IP对来自端点的GET请求的响应，我们可以看到下载zip文件的恶意IP的web服务器的名称:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/ab5071eec39fb12c02b88d21e7a59232.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*PGIvUwdyC3JGV13ayehpGA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">恶意IP使用的web服务器的名称。</figcaption></figure><blockquote class="mm mn mo"><p id="5737" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">6.上一个问题中的web服务器版本是什么？</p></blockquote><p id="dcac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以看到web服务器的版本正在查看由<strong class="kf ir"> x-powered-by </strong>响应头:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/c754a8c66402e140054545a19972163f.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*kBJQoKU4jnxxbwZgwk79Dg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">X-Powered-By响应标头。</figcaption></figure><blockquote class="mm mn mo"><p id="eb34" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">7.恶意文件从多个域下载到受害者主机。这项活动涉及的三个<strong class="kf ir"> </strong>领域是什么？</p></blockquote><p id="447d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的第一反应是查看我可以导出哪些HTTP对象，但是我没有看到任何与答案格式匹配的域。查看Wireshark中的网络对话窗口("<em class="lb">Statistics&gt;Conversations&gt;TCP "</em>)并根据数据包数量进行过滤，我可以看到第二个顶级对话使用的是HTTPS(即端口443):</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/c2b937b3d68cc0d5eab8ec1630eced3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*m0K9rn6c_Squx4OVw2Ckcw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Wireshark对话。</figcaption></figure><p id="d04f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这表明这些文件可能是使用HTTPS下载的。我使用Wireshark过滤器查看了与受害主机IP 10.9.23.102相关的端口443上的所有流量:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="ea55" class="nc lk iq my b gy nd ne l nf ng">ip.addr==10.9.23.102 &amp;&amp; tcp.port==443</span></pre><p id="3ba8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我启用了“<em class="lb">视图&gt;名称解析&gt;解析网络地址</em>”菜单中的<strong class="kf ir">解析网络地址</strong>，因为默认情况下此选项是禁用的。这使得更容易找到域名。然后，我开始向下滚动HTTPS的流量，直到我找到所有三个符合答案格式的域名。</p><blockquote class="mm mn mo"><p id="b8cf" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">8.前一个问题中哪个证书颁发机构向第一个域颁发了SSL证书？</p></blockquote><p id="9970" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我执行了DNS查找，它提供了颁发SSL证书的证书颁发机构的名称:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/dea14b444f561bcd8442b2679c0c358a.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*vp0JtsaQTQ00QGo7fXhsKw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">DNS查找。</figcaption></figure><blockquote class="mm mn mo"><p id="d4a2" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">9.钴击服务器的两个IP地址是什么？使用VirusTotal(社区选项卡)确认IP是否被识别为Cobalt Strike C2服务器。(答案格式:按顺序输入IP地址)</p></blockquote><p id="ab03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据米特ATT和CK，钴罢工使用HTTP，HTTPS和DNS进行通信:</p><div class="np nq gp gr nr ns"><a href="https://attack.mitre.org/software/S0154/" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">钴罢工</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">Cobalt Strike是一个商业的、全功能的远程访问工具，自称是“对手模拟软件…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">attack.mitre.org</p></div></div><div class="ob l"><div class="oc l od oe of ob og jw ns"/></div></div></a></div><p id="38a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用这些信息，我们可以转到"<em class="lb">统计数据&gt;对话&gt; TCP" </em>并开始查找符合此描述的IP地址，然后将它们提交给VirusTotal进行确认:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/3ecf890f8371ce29aca9f529733a22e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*NRgj5K9nTAnwMQDesARtwg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">钴击服务器IP地址。</figcaption></figure><blockquote class="mm mn mo"><p id="385d" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">10.前一个问题中第一个Cobalt Strike IP地址的主机报头是什么？</p></blockquote><p id="5a20" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用以下Wireshark过滤器来查找与第一个Cobalt Strike IP地址相关的HTTP流量:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="abd4" class="nc lk iq my b gy nd ne l nf ng">ip.addr==&lt;IP_ADDRESS&gt; &amp;&amp; http</span></pre><p id="2b12" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">跟随第一个数据包的HTTP流，我可以看到主机头值:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/83bc47ca6a06550acc3e56655c3549eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*jaA1CDpo8vTf89UFne-N_g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">第一个Cobalt Strike IP地址的主机标头。</figcaption></figure><blockquote class="mm mn mo"><p id="2022" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">11.Cobalt Strike服务器第一个IP地址的域名是什么？您可以使用VirusTotal来确认它是否是Cobalt Strike服务器(查看“社区”选项卡)。</p></blockquote><p id="e8d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">仍然查看上一个问题的第一个数据包，我们可以在source列中看到用于Cobalt Strike服务器的第一个IP地址的域:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/ecf1825744de6acb6f20e2e3d0127ccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*xVF07rARGwaXyhKn9SJ51Q.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Cobalt Strike服务器第一个IP地址的域名。</figcaption></figure><blockquote class="mm mn mo"><p id="65b9" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">12.第二部钴击服务器IP的域名是什么？您可以使用VirusTotal来确认它是否是Cobalt Strike服务器(查看“社区”选项卡)。</p></blockquote><p id="66c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以应用前面看到的相同过程，使用下面的查询，然后引用source列:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="5103" class="nc lk iq my b gy nd ne l nf ng">ip.addr==&lt;IP_ADDRESS&gt; &amp;&amp; http</span></pre><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/6de8e80c868e8cfb0254b28bf24edc58.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*1EBARcZEmtiuls5DBs-c_w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Cobalt Strike服务器第二个IP地址的域名。</figcaption></figure><blockquote class="mm mn mo"><p id="6964" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">13.感染后流量的域名是什么？</p></blockquote><p id="8680" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在查看之前可以导出的HTTP对象时，我看到了与特定主机名相关的奇怪的base64编码流量:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/7b052d58e435045cc7b7d54f02b5ac13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-gEShRuyF2JUPVklNWm64A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">HTTP对象。</figcaption></figure><p id="4e6d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当攻击者使用HTTP从受损的主机中泄漏数据时，通常可以观察到网络上的POST请求发送到web服务器，而主机以前没有与之通信过。我们还可以使用下面的Wireshark过滤器来过滤POST请求，并查找感染后流量的域名:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="6d0c" class="nc lk iq my b gy nd ne l nf ng">ip.addr==10.9.23.102 &amp;&amp; http.request.method=="POST"</span></pre><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/ec783cb3473cd255ebcc8a9cce8e1c26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p7_FFcwr6owOynahBG2NcA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">感染后流量的域名。</figcaption></figure><blockquote class="mm mn mo"><p id="a348" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">14.受害主机向感染后流量中涉及的恶意域发送的前11个字符是什么？</p></blockquote><p id="1cd7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过查看上图并计算受害主机向恶意域发出的POST请求中的前11个字符来回答这个问题。</p><blockquote class="mm mn mo"><p id="83e1" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">15.发送到C2服务器的第一个数据包的长度是多少？</p></blockquote><p id="80d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们可以通过查看上图并确定第一个数据包的长度来回答这个问题。</p><blockquote class="mm mn mo"><p id="d530" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">16.前一个问题中恶意域的服务器头是什么？</p></blockquote><p id="11e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以跟踪前面看到的感染后流量中第一个数据包的HTTP流，并查看<strong class="kf ir">服务器</strong>响应头:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/130b23edda8678ffead84b4048c06bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*izTch5xmjm1Vt24uOdzuUA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">服务器响应标头。</figcaption></figure><blockquote class="mm mn mo"><p id="ce5d" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">17.恶意软件使用API来检查受害者机器的IP地址。对IP检查域进行<strong class="kf ir"> </strong> DNS <strong class="kf ir"> </strong>查询的日期和时间是什么时候？(<strong class="kf ir">回答格式</strong> : yyyy-mm-dd hh:mm:ss UTC)</p></blockquote><p id="afb8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从过滤受害者的IP地址和DNS流量开始。然后，我们可以通过检查是否有任何帧包含关键字“<strong class="kf ir"> api </strong>”来进一步细化我们的搜索:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="106b" class="nc lk iq my b gy nd ne l nf ng">ip.addr==10.9.23.102 &amp;&amp; dns &amp;&amp; frame contains "api"</span></pre><p id="71b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该Wireshark过滤器提供以下输出:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/93813d72c737cd92eb144ae34d642d94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OkcYfnwESmPcTYpHoCAQAw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用于检查受害者机器的IP地址的API。</figcaption></figure><blockquote class="mm mn mo"><p id="d39d" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">18.前一个问题中的DNS查询中的域是什么？</p></blockquote><p id="f880" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用与上一个问题相同的查询和输出来回答这个问题。</p><blockquote class="mm mn mo"><p id="22dd" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">19.似乎有一些恶意垃圾邮件(malspam)活动正在进行。在流量中观察到的第一个邮件发件人地址是什么？</p></blockquote><p id="7ce4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在处理数据包捕获时，我注意到使用端口25(即简单邮件传输协议)的流量。我们可以过滤与受害主机相关的SMTP流量:</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="dbb6" class="nc lk iq my b gy nd ne l nf ng">ip.addr==10.9.23.102 &amp;&amp; smtp</span></pre><p id="7613" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">往下看包裹，我们可以看到第一封邮件的发件地址:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi op"><img src="../Images/50cd1394098261563c7edb38f9ec63b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*--wPzgbF8JawPSzSNATppQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">发件人地址。</figcaption></figure><blockquote class="mm mn mo"><p id="473d" class="kd ke lb kf b kg kh ki kj kk kl km kn mp kp kq kr mq kt ku kv mr kx ky kz la ij bi translated">20.SMTP <strong class="kf ir"> </strong>流量观察到多少数据包？</p></blockquote><p id="29ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用前一个问题中看到的相同Wireshark过滤器，我们可以简单地查看Wireshark状态行<strong class="kf ir">,它将</strong>指示显示的数据包数量:</p><figure class="mt mu mv mw gt jr gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/5f8595bf2139423e907edd9daff47785.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*89NueKywtEkSFYuyYjd7eQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Wireshark状态线。</figcaption></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="7f57" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结束语</h1><p id="87c5" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">我真的很喜欢在这个房间工作，并有机会了解更多关于网络流量分析和Wireshark功能的信息。谢谢你一直读到最后，继续黑下去😄！</p><div class="np nq gp gr nr ns"><a href="https://tryhackme.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">网络安全培训</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">TryHackMe是一个免费的学习网络安全的在线平台，使用动手练习和实验室，通过您的…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">tryhackme.com</p></div></div><div class="ob l"><div class="or l od oe of ob og jw ns"/></div></div></a></div></div></div>    
</body>
</html>