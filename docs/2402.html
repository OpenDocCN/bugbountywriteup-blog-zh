<html>
<head>
<title>Writing and Using Python Burp Extension — Adding a Custom Header Field</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写和使用Python Burp扩展-添加自定义头字段</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/writing-and-using-python-burp-extension-adding-a-custom-header-field-770fe1cbabc9?source=collection_archive---------4-----------------------#2022-09-28">https://infosecwriteups.com/writing-and-using-python-burp-extension-adding-a-custom-header-field-770fe1cbabc9?source=collection_archive---------4-----------------------#2022-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2ed1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你在一个bugbounty程序中，请求是通过在每个请求的头中添加一个常量值来进行的。我们能做什么？</p><p id="12cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们可以在Burp中的Proxy -&gt; Options选项卡中添加一个新的头，然后在“Match and Replace”字段中按add按钮。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/bc7f6ec263f4babc0b929edb0f4b91bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*7Al4myJHYze1kks2f1kzDw.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">耶尼·库拉尔·埃克莱姆</figcaption></figure><p id="6621" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们查看HTTP历史记录时，虽然我们看不到请求中的报头，但是我们可以看到我们用wireshark添加到pcap记录报头中的字段。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/935421cabddc21efe00d2ff2fee36f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*C16KHKqWBhJRj7XOB05AQw.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">打嗝请求</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ky"><img src="../Images/ba395fdfd675e0f99c3965c9a23b595e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TyuOz78VyT8VoafPs0y1ig.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Wireshark结果</figcaption></figure><p id="7612" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者第二种方法，这篇文章的主题是写一个打嗝插件。你可以通过下面的链接访问python代码，这是一个具有相同功能的插件。</p><div class="ld le gp gr lf lg"><a href="https://github.com/anil-yelken/burp-extensions/blob/main/add-header.py" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd ir gy z fp ll fr fs lm fu fw ip bi translated">主anil-yelken/burp-extensions处的burp-extensions/add-header.py</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">github.com</p></div></div><div class="lp l"><div class="lq l lr ls lt lp lu kr lg"/></div></div></a></div><p id="d5b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们下载Jython Standalone来安装Python Burp插件。</p><p id="5011" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lv" href="https://repo1.maven.org/maven2/org/python/jython-standalone/2.7.3/jython-standalone-2.7.3.jar" rel="noopener ugc nofollow" target="_blank">https://repo 1 . maven . org/maven 2/org/python/jython-standalone/2 . 7 . 3/jython-standalone-2 . 7 . 3 . jar</a></p><p id="762b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Extender -&gt; Options菜单中，我们使jar文件能够显示在Python环境字段中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lw"><img src="../Images/9fc4475db0b2d3e86bc480268825f9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NFUI2kEkYn2gQn0g0xE38Q.png"/></div></div></figure><p id="7d2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过单击Extender -&gt; Extensions部分中的Add按钮，我们确保我们的代码显示在扩展文件字段中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lx"><img src="../Images/4703a86555c8d02416ec783d692bc82d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9XO2UIVIGBcgvJV_X656g.png"/></div></div></figure><p id="ce42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该文件已添加如下。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ly"><img src="../Images/26e065c235bea7a3e323a15213367b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLwv2wGs50lXiD4BiHtx4g.png"/></div></div></figure><p id="7bdd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，为了在项目中使用这个扩展，让我们转到“项目选项”选项卡，并按下“会话处理规则”部分中的Add按钮。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lz"><img src="../Images/d24069436b5fe4a1686ea1b491711e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*siM8E4sKa5Gs9gXxGPFz-w.png"/></div></div></figure><p id="c902" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在规则定义中写下“Add Header”并选择“Invoke a Burp Extension”来使用插件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ma"><img src="../Images/de17cc14d6494ed8926ae08bef346e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCxmAnTSZN_mqL7I9CiGOA.png"/></div></div></figure><p id="1f80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于扩展处理，我们选择“添加‘Bugbounty’头”选项，这是代码中getActionName中指定的表达式。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ma"><img src="../Images/581391a5ccdbbb07c9921ebc34e76711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ktQUVJdhXWdBwNuZc2eyPw.png"/></div></div></figure><p id="a9a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按下OK按钮，我们来到“Scope”选项卡。我们如下组织潜望镜选项卡。它会将此标题添加到我们在所有URL中选择的Burp工具中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ma"><img src="../Images/e94ac4ce6e561b6d4465f012f583d2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twUj3cRPLKIz-FaBdgkRTA.png"/></div></div></figure><p id="c30e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过单击“打开会话跟踪器”按钮来跟踪请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi mb"><img src="../Images/df6fdb651d21925eb799f3635a2a7c4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVAIChvAIWQbZCVXYhWGdw.png"/></div></div></figure><p id="71d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">观察到请求中报头字段的变化如下:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi mc"><img src="../Images/8c3f99746f5f4ebbc3ca03d7fe6059da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RqXTpVu9WHE8idSGIVetRA.png"/></div></div></figure><p id="0096" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们在Wireshark中检查相同的流程时，我们可以看到header字段。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi md"><img src="../Images/bcbf3b3d227bacf2d096c7e4eddd81b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0VJDY6oH6wT9qkgHtQ6W-g.png"/></div></div></figure><p id="0b2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我对内容的误用不负任何责任。</p><p id="560e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过下面的链接访问我开发的易受攻击的web应用程序:</p><div class="ld le gp gr lf lg"><a href="https://github.com/anil-yelken/Vulnerable-Flask-App" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd ir gy z fp ll fr fs lm fu fw ip bi translated">GitHub-Anil-yelken/Vulnerable-Flask-App:Erlik 2-Vulnerable-Flask-App</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">erlik 2-Vulnerable-Flask-App Tested-Kali 2022.1它是一个易受攻击的Flask Web App。这是一个创建的实验室环境…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">github.com</p></div></div><div class="lp l"><div class="me l lr ls lt lp lu kr lg"/></div></div></a></div><div class="ld le gp gr lf lg"><a href="https://github.com/anil-yelken/Vulnerable-Soap-Service" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd ir gy z fp ll fr fs lm fu fw ip bi translated">GitHub-Anil-yelken/Vulnerable-Soap-Service:Erlik-Vulnerable Soap Service</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">Erlik -易受攻击的Soap服务已测试- Kali 2022.1这是一个易受攻击的SOAP web服务。这是一个实验室环境…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">github.com</p></div></div><div class="lp l"><div class="mf l lr ls lt lp lu kr lg"/></div></div></a></div></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><h2 id="6473" class="mn mo iq bd mp mq mr dn ms mt mu dp mv jy mw mx my kc mz na nb kg nc nd ne nf bi translated">来自Infosec的报道:Infosec每天都有很多内容，很难跟上。<a class="ae lv" href="https://weekly.infosecwriteups.com/" rel="noopener ugc nofollow" target="_blank">加入我们的每周简讯</a>以5篇文章、4条线索、3个视频、2个GitHub Repos和工具以及1个工作提醒的形式免费获取所有最新的Infosec趋势！</h2></div></div>    
</body>
</html>