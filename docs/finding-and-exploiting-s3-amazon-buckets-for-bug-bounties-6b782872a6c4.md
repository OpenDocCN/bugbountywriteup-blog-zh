# 寻找和利用 S3 亚马逊昆虫奖励桶

> 原文：<https://infosecwriteups.com/finding-and-exploiting-s3-amazon-buckets-for-bug-bounties-6b782872a6c4?source=collection_archive---------2----------------------->

## 许多网站都有私人 S3 桶，里面装着秘密。我们想要他们。

![](img/7c1bf7ad5b878dfdbb8e777d5bb6f237.png)

克里斯蒂安·威迪格在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

# 什么是亚马逊 S3 桶？

是一种公共静态云文件存储资源，可在亚马逊网络服务的( **AWS** )简单存储服务( **S3** )中获得，这是一种对象存储产品。 **S3 桶**，类似于文件夹，存储对象，由数据及其描述性元数据组成。

亚马逊 S3 使用与 Amazon.com 相同的可扩展存储基础设施来运行其全球电子商务网络。它可以用来存储任何类型的对象，允许用户存储互联网应用程序、备份和恢复、灾难恢复、数据归档、[数据湖](https://en.wikipedia.org/wiki/Data_lake)分析和[混合云存储](https://en.wikipedia.org/wiki/Cloud_computing#Hybrid_cloud)。

# 最薄弱的环节

许多 web 开发人员使用这项服务来托管像 JavaScript、HTML、图像、CSS 这样的文件。

```
.s3.amazonaws.com/js/main.js
```

创建 S3 存储桶时，开发人员有时会为公共用户配置不必要的策略和配置。这会导致未经授权的文件**访问**、**上传**、**删除**。

# 如何利用这一点？

实际上，有许多方法可以做到这一点，但是今天我们将构建一个 python 脚本来帮助我们完成这项任务。该应用程序将使用正则表达式找到 s3 桶及其秘密。

> *一个* ***正则表达式*** *是一个特殊的字符序列，它使用一个* ***模式*** *中的特殊语法来帮助你匹配或查找其他字符串或字符串集。……****Python****模块 re 全面支持****Python****中的类 Perl****正则表达式*** *。*

# 第 1.0 部分

在使用任何 s3 buckets 之前，您需要有一个 amazon 帐户。登录到您的帐户并创建一个访问密钥和秘密密钥。现在，我们需要配置 **AWS-CLI** 。

打开您的**终端**并运行以下代码:

它会要求您输入访问密钥和秘密密钥。只需添加先前制作的密钥。

# 第 1.5 部分

在开始构建应用程序之前，我们需要编写一个正则表达式来帮助检测 s3 存储桶。我们将在 python 应用程序中使用它来查找它们。在虚拟托管式请求中，存储段名称是 URL 中域名的一部分。虚拟托管样式的 URL 遵循如下所示的格式。

```
[https://bucket-name.s3.Region.amazonaws.com/](https://bucket-name.s3.Region.amazonaws.com/) #key name
```

在本例中，`my-bucket`是存储桶名称，US West (Oregon)是地区，而`puppy.png`是关键字名称:

```
[https://my-bucket.s3.us-west-2.amazonaws.com/puppy.png](https://my-bucket.s3.us-west-2.amazonaws.com/puppy.png)
```

> ***【S3 木桶访问】有:***
> 
> *虚拟托管式请求。*
> 
> *路径式请求。*
> 
> *对互联网协议版本 6 (IPv6)和 IPv4 进行请求。*

# 正则表达式

当制作正则表达式时，我们需要覆盖所有和任何可能的匹配来命中 URLs s3 桶。对于这个任务，我们将创建一个正则表达式。

```
[\w\-\.]+\.s3\.?(?:[\w\-\.]+)?\.amazonaws\.com|
(?<!\.)s3\.?(?:[\w\-\.]+)?\.amazonaws\.com\\?\/[\w\-\.]+
```

# Java Script 语言

大多数 s3 存储桶隐藏在 JavaScript 文件中。首先，让我们找到这些 js 路径，其次，我们需要收集这些 js 文件，并检查其中隐藏的桶。让我们写一个正则表达式来找到这些。我们的 js 路径。

```
(?<=src=[‘\”])[a-zA-Z0–9_\.\-\:\/]+\.js
```

# 创建应用程序

让我们编写代码来检测 s3 存储桶。在本节中，我们将编写实际的应用程序，并将所有内容嵌入在一起，使其工作并找到这些桶。

# HTML 表单编码

表单的编码类型由属性`enctype`决定。它可以有三个值。 **URL 编码格式**、**多部分格式、文本/普通格式**

*   `application/x-www-form-urlencoded` -代表一个 URL 编码形式。如果`enctype`属性没有设置为任何值，这就是默认值。
*   `multipart/form-data` -代表多部分形式。这种类型的表单在用户想要上传文件时使用
*   `text/plain`-html 5 中引入的一种新的表单类型，顾名思义，它只是发送数据而不进行任何编码

正如您在**第 2 行**中看到的，来自 **urllib** **模块**的 **unquote** 函数被导入，因为大部分 **Html** 内容是以 **urlencoded** 格式。这需要解码，否则，我们以前的正则表达式将永远不会得到匹配。**第 4 行，*Domains-to-test . txt***将是保存您想要测试 s3 存储桶的域的文件。

发现网页隐藏 s3 桶后，可以手动测试漏洞。让我们使用之前在**第 1.0 部分**中配置的 **AWS-CLI** 来完成此任务。

# 剥削

要测试任何找到的桶，打开您的**终端**并运行以下命令。

```
aws s3 ls s3://whateverbucketname
```

检查是否存在任何敏感文件，如果有，尝试将其下载到您的邮箱中

```
aws s3 cp s3://whateverbucketname/secret.txt
```

你也可以上传文件，为此只需运行、

```
aws s3 mv Exploit.txt s3://whateverbucketname/
```

# 结论

当然，这也可以使用像 **BurpSuite** 这样的工具来完成，但是除非你有 **Pro** 版本，否则你无法做到这一点。而且，当我使用自制的工具、脚本工作时，我感到更加满意。

享受吧，祝狩猎愉快！