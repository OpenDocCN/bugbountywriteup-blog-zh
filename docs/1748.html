<html>
<head>
<title>CTF Write-Up: Kryptonite</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CTF报道:氪石</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/ctf-write-up-kryptonite-293f2f66c004?source=collection_archive---------3-----------------------#2021-12-29">https://infosecwriteups.com/ctf-write-up-kryptonite-293f2f66c004?source=collection_archive---------3-----------------------#2021-12-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><ul class=""><li id="cf44" class="jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">ctf-mystiko.com有CTF挑战赛。</li><li id="4e76" class="jn jo iq jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">挑战名称:氪星石</li><li id="5862" class="jn jo iq jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">类别:安卓</li><li id="2602" class="jn jo iq jp b jq kf js kg ju kh jw ki jy kj ka kb kc kd ke bi translated">源代码:<a class="ae kk" href="https://github.com/dh0ck/Mystiko-CTF-challenges/tree/main/kryptonite" rel="noopener ugc nofollow" target="_blank">https://github . com/dh0ck/Mystiko-CTF-挑战/tree/main/kryptonite </a></li></ul><p id="4fcd" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi">— — — — -</p><h2 id="0c68" class="la lb iq bd lc ld le dn lf lg lh dp li ju lj lk ll jw lm ln lo jy lp lq lr ls bi translated"><strong class="ak">介绍和设置</strong></h2><p id="5cf9" class="pw-post-body-paragraph kl km iq jp b jq lt kn ko js lu kp kq ju lv ks kt jw lw kv kw jy lx ky kz ka ij bi translated">这项挑战旨在展示如何枚举android应用程序来搜索隐藏信息。</p><p id="d3f4" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">免责声明:这篇文章显示了专门用于测试Android应用程序的工具，这些工具需要单独安装。安装步骤因主机操作系统而异。网上解释的很清楚，如果没有安装这些工具就谷歌一下。<br/>安装apk的方法是将它拖到Genymotion或其他模拟器上，或者使用以下命令将其安装到物理设备上:</p><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="8615" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">设备上会出现一个新图标:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/d87e15af4f8a0b2ac41c505a3866192e.png" data-original-src="https://miro.medium.com/v2/resize:fit:418/format:webp/1*t2kuxmkonXSxk4sixWIx7w.png"/></div></figure><p id="1221" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">我们继续运行应用程序。文字写在1337额外的haX0r感觉。标题有435 = 1337年AES这个词。这给出了关于应用程序中使用的加密的提示。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/469b0946bbda9ad8784038382a34412a.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*u55rgUXRGzcJdo62ZUze3Q.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">应用程序的主要活动</figcaption></figure><p id="7b75" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">我们可以输入消息和密钥，并用AES加密消息。应用程序的Java代码中使用的函数是:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/6bbb5bbd724a86497bf6aaafa7e88ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DUa3bH0pQmbcrZVjqw55Pw.png"/></div></div></figure><p id="1364" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">存在更强的密码，例如CBC模式。同样，用同样的算法输入一个加密的文本就可以解密它。在这两种情况下，结果都显示在下方的文本框中。AES要求密钥长度为16、24或32字节。否则，我们会收到一条祝酒辞警告:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/c351fc5bc7018e0938ce4fcbef51596e.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*xEhcVhFGY81I5p2zYsntwA.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">使用的密钥长度错误</figcaption></figure><p id="782d" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">在提供密钥的有效长度后，我们看到加密的消息:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/0ac49343053681e9fb8cc709501d0bd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*jXM0EhAw8gWm_AGLIYAqXA.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">有效的密钥长度会产生加密的消息</figcaption></figure><h2 id="290f" class="la lb iq bd lc ld le dn lf lg lh dp li ju lj lk ll jw lm ln lo jy lp lq lr ls bi translated">列举</h2><p id="80c0" class="pw-post-body-paragraph kl km iq jp b jq lt kn ko js lu kp kq ju lv ks kt jw lw kv kw jy lx ky kz ka ij bi translated">当测试移动应用程序时，在开始测试错误之前，像普通用户一样使用它们总是一个好主意。通常情况下，应用程序开始在本地存储数据，存储数据的方式可能会出现错误。如果我们不首先使用应用程序特性生成这些数据，我们可能会错过这些数据。</p><p id="5dcb" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">我们需要检查应用程序的内存。为此，我们需要使用android调试桥(ADB)通过USB访问手机。我们在手机里装了一个外壳:</p><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="a9de" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">Android应用程序安装在/data/data中。我们需要找到我们的目标应用程序，为此我们可以简单地将ls与grep结合起来，查找应用程序名称。<br/>文件夹数据库已由应用程序创建，其中包含一个sqlite数据库。使用:</p><p id="dba3" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">sqlite3 default.db</p><p id="8ec7" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">命令我们可以访问它。<br/>。表显示数据库中可用的表。<br/>我们看到表测试的所有记录</p><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="d34c" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">在新创建的记录之前，已经存在三个记录(在下一张图中用蓝色标记)，包含我们输入的加密消息(在下一张图中用红色标记)。请注意，default.db在应用程序安装后并不存在。由此可见，在分析应用程序以查找漏洞之前，先使用它是多么重要:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mu"><img src="../Images/d684fd00f52bc5069f2b8a70f18b43a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_Fqt-evonx9UUcn_eFvcg.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">与SQLite数据库的交互</figcaption></figure><p id="0942" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">在该表中，在创建它的用户名的右侧，有以下三个可疑字符串:</p><p id="2674" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated"><em class="mv">xac 860 TQ 62 havtjogv 5 egywxxws 0 huc 6 yor/0 eu 5 AQM =<br/>bq 3g 0 iikekfb 4 bjcqvpsziahzlesezfxry 21d 9 yv3g =<br/>vepr 9 q 0 dvmsb 7 pdyqz 7 ttjwehxzz 03 udcksstparvo =</em></p><p id="b6d1" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">它们似乎被加密了，可能使用了应用程序使用的相同算法。它代表了懒惰的管理员可能留在那里进行测试的一些剩菜。或者，他们可能是因为该应用程序的测试版本在正式生产之前就已经发布了。</p><p id="7c85" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">如果字符串真的是AES加密的，我们需要密钥来解密它。要找到它，需要更多的枚举。可以使用apktool (apktool d kryptonite.apk)或jadx-gui之类的工具反编译该应用程序，并检查清单。<br/>manifest . XML文件包含关于应用程序的结构和配置的信息。如果。apk文件被简单地提取，这个文件被编码并且不可见，但是前述的工具解码它。jadx-gui中的清单文件如下所示:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mw"><img src="../Images/7345ef76ff136b648cc30560b30eaf2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nEPAIXK3K_HFSqmObsRHyA.png"/></div></div></figure><p id="0f5b" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">红色标记的是活动(即应用程序中包含的不同“窗口”)。MainActivity是任何app的起点。有H1dD3n活性。应用程序已创建，因此不能通过任何方式从MainActivity窗口访问此活动。同样，这可能代表了在复杂的应用程序中被懒惰的管理员遗忘的一些剩余活动。如果我们知道任何活动的名称，我们就可以打开它，而不管如何以合法的方式访问它。为此，我们再次使用“adb shell”访问手机外壳</p><p id="2aa3" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">从那里，我们运行这个命令:</p><figure class="ly lz ma mb gt mc"><div class="bz fp l di"><div class="md me l"/></div></figure><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mx"><img src="../Images/f3491715e6c69c3c17cac9eeea69f8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zy72FBqVAvGkZJIzH19hBQ.png"/></div></div></figure><p id="a485" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">请注意，模拟器上已经打开了一个新的活动。am命令是活动管理器，使用am start，我们可以通过提供应用程序名称(如/data/data目录中所示)和活动名称(注意“.”来打开活动在活动名称之前，它不是名称的一部分，必须在那里。</p><p id="4e1d" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">虽然看起来可能不像，但是活动顶部的图像实际上是一个按钮。不要忘记点击/轻击任何地方，这样你就不会错过任何东西。点击它会显示一条祝酒辞:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi my"><img src="../Images/febae2b3a64c787a7f49ec98a3e93ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*e8oJ6uN7jlp25LofP_uYhg.png"/></div></figure><p id="55c2" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">该消息提示检查日志。检查真实应用程序的日志也是一个好主意，在大量的消息中可以找到重要的调试信息。<br/>在这种情况下，点击按钮时会显示这一信息(检查日志，并保持日志打开，以便从手机外壳外部使用adb logcat命令查看实时更新):</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mz"><img src="../Images/d197fa95c10898e8ce10a658b0f65166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sQt-aU4H3LUsfjnvJ2iKCA.png"/></div></div></figure><p id="c983" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">继续挑战的氪元素主题，当氪元素显示在气体列表中时，会出现错误(所有内容都是硬编码的，没有真正的错误发生)。显示一个可疑字符串:</p><p id="5a6c" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated"><em class="mv">kryp 70 n1 T3 _ k1LLz _ $ uPerM4N&amp;h4ck 3r</em></p><p id="5058" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">利用这个字符串和一点想象力，我们可以想象它是先前在数据库中找到的三个字符串的解密密钥:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi na"><img src="../Images/3ad7a6f9417eab38302428cce42a5a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*EwrDI2L9_XKcps23sWzMbg.png"/></div></figure><p id="65f3" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">解密给出:</p><p id="bcbe" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">密文:xac 860 TQ 62 havtjogv 5 egywxxws 0 huc 6 yor/0 eu 5 AQM =</p><p id="611a" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">明文:Pl4N37_kRYp70N_X-P70d3d</p><p id="b861" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi">……….</p><p id="6b02" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">密文:bq 3g 0 iikekfb 4 bjcqvpsziahzlesezxry 21d 9 yv3g =</p><p id="343e" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">明文:(%)KrYpT0NyT3_4_L1F3~</p><p id="186c" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi">………</p><p id="3079" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">密文:vepr 9 q 0 dvmsb 7 pdyqz 7 ttjwehxzz 03 udcksstparvo =</p><p id="888d" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">明文:# 36氪_ GaZ _ 4 _午餐？@</p><p id="c642" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">最后，H1dD3n活动中的文本是加密标志。它被分割成块，并以图像的形式呈现，以阻止使用字符串和grep等命令，并迫使人们更深入地挖掘和理解android应用程序的结构。然而，仔细检查资源和源代码仍然可以检索图像，但这是预期的路径，用活动管理器生成隐藏的活动。在隐藏活动中键入消息后(注意在出现的一个事件中尝试小写“L”或大写“I”):</p><p id="af54" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">ousrurhh<br/>NCtyyvHM<br/>Qq3G+9QC<br/>E0z+tuHB<br/>/bwq 8 ezg<br/>3 ygg/4 h1<br/>uflzq 1nz<br/>T2 faktmy</p><p id="1676" class="pw-post-body-paragraph kl km iq jp b jq jr kn ko js jt kp kq ju kr ks kt jw ku kv kw jy kx ky kz ka ij bi translated">将它重写为一行，并使用在上一步中找到的第三个纯文本<br/>密码对其进行解密，以检索该标志:</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/50f867270bf9a280cd751d78f90b0b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*VlW9LBmrnUdnDFJDhErn2g.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">最终旗帜</figcaption></figure></div></div>    
</body>
</html>