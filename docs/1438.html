<html>
<head>
<title>Using tmux for automating interactive reverse shells</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用tmux自动化交互式反向外壳</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/using-tmux-for-automating-interactive-reverse-shells-630260740af3?source=collection_archive---------1-----------------------#2021-07-02">https://infosecwriteups.com/using-tmux-for-automating-interactive-reverse-shells-630260740af3?source=collection_archive---------1-----------------------#2021-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a829" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">将非交互式反向外壳转换为完全交互式TTY的过程自动化。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/d72f46b76da0236548c4b34052fdd710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*NRbYPaweiL76Qh-RIFCY5g.png"/></div></figure><h1 id="78d8" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">介绍</h1><p id="41d7" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我最近读了一篇关于使用“expect”命令行工具将非交互式反向shell转换为完全交互式TTY的文章，这意味着通过这样做，可以使用标签完成、历史导航、清空屏幕等功能，还可以在不丢失访问权限的情况下点击<strong class="lh ir"> <em class="mc">、Ctrl-c </em> </strong>，这让我非常高兴。</p><p id="2d38" class="pw-post-body-paragraph lf lg iq lh b li md jr lk ll me ju ln lo mf lq lr ls mg lu lv lw mh ly lz ma ij bi translated">我发现这个帖子非常有趣，因为它使用了一种我从未见过的完全不同的方法。因此，由于我也有一个自动化这个过程的技术，我决定分享它，因为它是一个不同的视角，它也依赖于命令行实用程序:<a class="ae mb" href="https://github.com/tmux/tmux/wiki" rel="noopener ugc nofollow" target="_blank"> tmux </a>。</p><h1 id="7ed2" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">手动过程</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/c7915cd5c46b820f0733b01bd62c419a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oOdObCxGdkI6y2ogdF-Zdw.gif"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">手动创建交互式反向壳</figcaption></figure><p id="6b51" class="pw-post-body-paragraph lf lg iq lh b li md jr lk ll me ju ln lo mf lq lr ls mg lu lv lw mh ly lz ma ij bi translated">上面的gif展示了如何将一个非交互式的反向外壳转换成交互式的。虽然这是一个相当简单的过程，但如果你需要经常这样做，它就会变成一种痛苦。</p><h1 id="2371" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">输入tmux</h1><p id="4c9a" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Tmux是一个终端多路复用器命令行实用程序，它允许您在一个屏幕上创建/控制多个shells。它最强大的特性之一是能够自动将击键组合发送到shells中。除此之外，我还可以创建内部环境变量，这些变量可以作为大型命令的简短版本:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/f378e24d4990c6bf5e2c4a830e8366f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*_e4dvKKDBEcKG4Qsm-QIKQ.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">命令字符串存储为环境变量</figcaption></figure><p id="ddf2" class="pw-post-body-paragraph lf lg iq lh b li md jr lk ll me ju ln lo mf lq lr ls mg lu lv lw mh ly lz ma ij bi translated">现在，我只需打开tmux命令提示符，将其中一个字符串发送到当前活动的tmux窗格中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/a4c3aaa0071c76be2b7af2b190673424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7oi2fFbRNkF9aRkkk89Lnw.gif"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">使用tmux将字符串发送到shells中</figcaption></figure><h1 id="93c7" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">tmux自动化的魔力</h1><p id="6349" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我们知道了tmux需要使用的所有特性，我们可以构建tmux快捷方式，或者键绑定，以便触发发送击键到当前活动窗格的动作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/8540be22abbf67b70f2823d4f35e6522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*H_zhGZ35Hza9TgdlsLz3uA.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">用于发送击键的Tmux键绑定</figcaption></figure><p id="90f9" class="pw-post-body-paragraph lf lg iq lh b li md jr lk ll me ju ln lo mf lq lr ls mg lu lv lw mh ly lz ma ij bi translated">上面的“tmux.conf”行由两个环境变量组成，这两个环境变量包含稍后将发送到终端的两个字符串，以及将首先发送密钥序列<strong class="lh ir"><em class="mc">python 3-c’import pty的两个密钥绑定；pty . spawn(\ "/bin/bash \ ")'</em></strong>后跟一个<strong class="lh ir"> <em class="mc"> &lt;回车&gt; </em> </strong>，然后发送序列<strong class="lh ir"> <em class="mc"> C-z "stty raw -echo "回车fg回车reset回车$shellexports回车</em> </strong>。注意“Enter”不是单词本身，而是*击键*，也就是换行符。Tmux有一组单词，它可以识别为某些键盘按键，“Enter”就是其中之一。</p><p id="8130" class="pw-post-body-paragraph lf lg iq lh b li md jr lk ll me ju ln lo mf lq lr ls mg lu lv lw mh ly lz ma ij bi translated">第一个<em class="mc"> bind </em>命令必须在前缀组合键之后执行，在标准tmux中是<strong class="lh ir"> <em class="mc"> Ctrl-b </em> </strong>，但在我的例子中是<strong class="lh ir"> <em class="mc"> Ctrl-a </em> </strong>。第二个<em class="mc">绑定</em>命令，有标志<em class="mc"> -n </em>可以不使用前缀组合执行。</p><p id="e54d" class="pw-post-body-paragraph lf lg iq lh b li md jr lk ll me ju ln lo mf lq lr ls mg lu lv lw mh ly lz ma ij bi translated">这里你可能会想:“但是为什么你使用两个快捷方式，而不是一次发送所有内容？”答案很简单:我无法通过只使用一个键绑定来让它工作。如果你找到了方法，请联系我，因为我很想知道我错过了什么。</p><h1 id="1737" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">最后的结果</h1><p id="0afc" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在每次你得到一个非交互的shell，你可以简单的点击<strong class="lh ir"> <em class="mc"> Ctrl-aqq </em> </strong>来触发第一次绑定(<strong class="lh ir"> <em class="mc"> Ctrl-aq </em> </strong>)然后发送第二部分(<strong class="lh ir"> <em class="mc"> Ctrl-q </em> </strong>)。享受:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mt"><img src="../Images/bc4b97d7ee432a617a6b91232c129e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*m6JNfZPRqZ6B5ahCfP2CMQ.gif"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">完全自动化的交互式外壳，而非交互式外壳</figcaption></figure></div><div class="ab cl mu mv hu mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ij ik il im in"><p id="4b93" class="pw-post-body-paragraph lf lg iq lh b li md jr lk ll me ju ln lo mf lq lr ls mg lu lv lw mh ly lz ma ij bi translated">\ x07 \ x44 \ x42 \ x01 \ x59 \ x13 \ x44<br/></p></div></div>    
</body>
</html>