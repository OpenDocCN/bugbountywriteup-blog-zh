<html>
<head>
<title>From SSRF To AWS Credentials Disclosure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从SSRF到AWS凭据披露</h1>
<blockquote>原文：<a href="https://infosecwriteups.com/from-ssrf-to-aws-credentials-disclosure-64c51e1bf5dc?source=collection_archive---------0-----------------------#2019-06-03">https://infosecwriteups.com/from-ssrf-to-aws-credentials-disclosure-64c51e1bf5dc?source=collection_archive---------0-----------------------#2019-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cc62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你好，信息安全社区</p><p id="7c7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将描述一种攻击网站安全的攻击方法，更确切地说，是用吉拉软件配置的，识别出SSRF漏洞</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="26a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">吉拉软件是由Atlassian开发的专有问题跟踪产品，允许bug跟踪和敏捷项目管理。<br/>所以从一个易受攻击的吉拉软件中我们会得到AWS实例凭证</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="638a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们将采取的5个攻击阶段:从侦察到AWS实例的命令和控制</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/63a407645c13113411691e44645c7091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0thuuk2MZeKyf2d4bDt6w.png"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><ol class=""><li id="196f" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk lj lk ll lm bi translated">侦察</li></ol><ul class=""><li id="9934" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">这里我们使用nmap网络扫描仪，因此我们需要获取更多关于我们正在测试的产品的具体信息。</li><li id="2f78" class="le lf iq jp b jq lo ju lp jy lq kc lr kg ls kk ln lk ll lm bi translated">很明显，它托管在Amazon Web Services上，有两个开放的端口:80 HTTP &amp; 443 HTTPS</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/6ad3360103120841af7613214026e9f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ar2BHNowRX2rSXdm"/></div></div><figcaption class="lu lv gj gh gi lw lx bd b be z dk">1</figcaption></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="d115" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.我们在浏览器中打开IP，吉拉软件出现了！</p><ul class=""><li id="e21f" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">如在任何基本测试中，应该看到什么版本包含软件产品等。<br/>吉拉的版本是7.1.2</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/c365648d88eafdef4de2f241afb5395e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u7jxsxWyU0jeG_F_"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="3ae2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.吉拉软件漏洞研究</p><ul class=""><li id="6d29" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">在这里，我们对该版本进行了一些研究，我们发现所有早于7.3.6的版本都会受到SSRF漏洞的影响。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/b3af85e17654cff23d1e1c24bb0bde7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6IC5x2a4fqMpO0-Q"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="bee2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.在consumerUri =参数中发现了SSRF漏洞</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/bbaea0d3d1ecfc4fc3780dcc46f83414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qp2Jyuk9DhDlWnV7"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="4ef2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.武器化——测试脆弱性</p><ul class=""><li id="9fd1" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">我们在google.com网站上用一个开放重定向测试了这个参数，它在那里工作</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/f3a64dd531da55d103f7e102fadddd34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*brpF3iEFegitQSCX"/></div></div></figure><ul class=""><li id="380e" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">对其他弱点的测试使我们能够创建一个开放的重定向，从而创建一个指向该参数的XSS有效载荷！</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ly"><img src="../Images/a11d44461b6d467cd7b93cde091df926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WRAOlSVpTsgNUaq9"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="0e1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.交付—在AWS实例上交付SSRF攻击！</p><ul class=""><li id="6a34" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">我们必须将漏洞发送到AWS实例，确切地说是与亚马逊服务相关的IP 169.254.169.254。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/0eb35462c82229fbcc80ed7b06673be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R1HxhfU0fL_3NiHp"/></div></div></figure><p id="9846" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.Exploitation-利用AWS实例，参数consumerUri=</p><ul class=""><li id="7590" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">因此，它工作成功，正如我们在这里看到的，有关于实例的信息，如私有IP、版本、InstanceId等。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/0ab3be0e4bc80e9648e8414229561b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ydlpEaWuus2m5kXu"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><ul class=""><li id="06f4" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">获取AWS实例的凭证<br/>——我们将尝试获取AWS实例的凭证，但是可以看到访问密钥id和秘密访问密钥，这是访问它的基础。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ly"><img src="../Images/2cc4ea0b207dd9d87f253fe43f4120c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3dQwzFd1WYvV_Pg1"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="c20d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.命令和控制AWS实例的配置</p><ul class=""><li id="6e8c" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">apt更新awscli</li><li id="8b2a" class="le lf iq jp b jq lo ju lp jy lq kc lr kg ls kk ln lk ll lm bi translated">在这里，我们将在终端中配置AWS CLI。</li><li id="dfcd" class="le lf iq jp b jq lo ju lp jy lq kc lr kg ls kk ln lk ll lm bi translated">导出我们之前看到的凭据。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/a60117895f55c1ecd5820ee84bf4eb08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ntw6oGxOKxcBmfIn"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="26cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.命令和控制—获得对AWS的完全访问权限！</p><ul class=""><li id="05fc" class="le lf iq jp b jq jr ju jv jy lg kc lh kg li kk ln lk ll lm bi translated">最后，在配置之后，这使我们能够访问AWS实例，严格控制网站。</li><li id="1a65" class="le lf iq jp b jq lo ju lp jy lq kc lr kg ls kk ln lk ll lm bi translated">我们可以进一步上传任何shell，但所有这些测试都是在客户自己的监督下完成的，这足以证明这一点，并进一步升级这一弱点。</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lt"><img src="../Images/6e1477c2faf13a75d0616953349784f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jjzUCbHGVoHALy0a"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="cee5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">11.预防方法—一些不受此漏洞影响的方法</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/aa0f0211389c4170abd83fc30962aec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*_yU6VdBoCWddXe__hZHBtQ.png"/></div></figure><p id="c82e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">//希望，你在阅读这篇文章的时候过得很愉快，并且学到了新的东西。<br/>//非常感谢。</p></div></div>    
</body>
</html>